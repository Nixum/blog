<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
    <channel>
        <title>Nixum Blog</title>
        <link>http://nixum.cc/</link>
        <description>Recent content on Nixum Blog</description>
        <generator>Hugo -- gohugo.io</generator>
        <language>en-us</language>
        <lastBuildDate>Thu, 01 May 2025 00:00:00 +0000</lastBuildDate><atom:link href="http://nixum.cc/index.xml" rel="self" type="application/rss+xml" /><item>
        <title>å…¬å‘Š</title>
        <link>http://nixum.cc/p/%E5%85%AC%E5%91%8A/</link>
        <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
        
        <guid>http://nixum.cc/p/%E5%85%AC%E5%91%8A/</guid>
        <description></description>
        </item>
        <item>
        <title>AIåŸºç¡€æ¦‚å¿µæ•´ç†</title>
        <link>http://nixum.cc/p/ai%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/</link>
        <pubDate>Thu, 01 May 2025 00:00:00 +0000</pubDate>
        
        <guid>http://nixum.cc/p/ai%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86/</guid>
        <description>&lt;h1 id=&#34;åŸºç¡€æ¦‚å¿µ&#34;&gt;åŸºç¡€æ¦‚å¿µ&lt;/h1&gt;
&lt;h2 id=&#34;1-æ¨¡å‹çš„å‚æ•°&#34;&gt;1. æ¨¡å‹çš„å‚æ•°&lt;/h2&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/%e7%a5%9e%e7%bb%8f%e7%bd%91%e7%bb%9c.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/%e7%a5%9e%e7%bb%8f%e7%bd%91%e7%bb%9c.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å‚æ•°æ˜¯ä»€ä¹ˆï¼Ÿ&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¤§æ¨¡å‹å°±åƒä¸€ä¸ªè¶…çº§å¤æ‚çš„â€œå…¬å¼ + ç¥ç»ç½‘ç»œå¤§è„‘â€ã€‚&lt;/li&gt;
&lt;li&gt;é‡Œé¢æœ‰æ— æ•°ä¸ªå¯ä»¥è°ƒæ•´çš„â€œå°æ—‹é’®â€ï¼Œæ¯ä¸ªæ—‹é’®çš„æ•°å€¼å°±æ˜¯ä¸€ä¸ªâ€œå‚æ•°â€ã€‚&lt;/li&gt;
&lt;li&gt;æ¯ä¸ªå‚æ•°éƒ½æ˜¯ä¸€ä¸ªæ•°å­—ï¼ˆé€šå¸¸æ˜¯ 16 æˆ– 32 ä½æµ®ç‚¹æ•°ï¼‰ï¼Œå®ƒä»¬æœ¬èº«æ˜¯æ²¡æœ‰ä»»ä½•å«ä¹‰çš„ã€‚&lt;/li&gt;
&lt;li&gt;â€œ70B å‚æ•°æ¨¡å‹â€ = æœ‰ 700 äº¿ä¸ªè¿™æ ·çš„æ•°å­—å‚ä¸è®¡ç®—ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿™äº›å‚æ•°æœ¬è´¨ä¸Šå°±æ˜¯â€œæ¨¡å‹è®°ä½çš„ä¸œè¥¿â€å’Œâ€œæ¨¡å‹å¦‚ä½•å˜æ¢ä¿¡æ¯çš„æ–¹å¼â€ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å‚æ•°æ˜¯æ€ä¹ˆæ¥çš„ï¼Ÿ&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å‚æ•°æ˜¯&lt;strong&gt;è®­ç»ƒ&lt;/strong&gt;å‡ºæ¥çš„ï¼Œä¸æ˜¯äººä¸ºå†™çš„ï¼Œè®­ç»ƒçš„æ—¶å€™åªçŸ¥é“è¾“å…¥å’Œè¾“å‡ºï¼Œé€šè¿‡è®­ç»ƒåå¾—åˆ°å‚æ•°ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/LLM%e8%ae%ad%e7%bb%83.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/LLM%e8%ae%ad%e7%bb%83.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸€å¼€å§‹å‚æ•°æ˜¯éšæœºçš„ â†’ æ¨¡å‹å•¥éƒ½ä¸ä¼šã€‚&lt;/li&gt;
&lt;li&gt;é€šè¿‡â€œé¢„æµ‹ä¸‹ä¸€ä¸ªè¯/ä¸‹ä¸€ä¸ª tokenâ€è¿™ä¸ªä»»åŠ¡ï¼Œä¸æ–­ä¿®æ­£å‚æ•°ã€‚&lt;/li&gt;
&lt;li&gt;è®­ç»ƒè§„æ¨¡è¶Šå¤§ã€æ•°æ®è¶Šä¸°å¯Œï¼Œæ¨¡å‹è¶Šâ€œèªæ˜â€ã€‚&lt;/li&gt;
&lt;li&gt;æˆ‘ä»¬å¸¸è¯´æ¨¡å‹å¼€æºï¼Œå¼€æºçš„å°±æ˜¯è®­ç»ƒåçš„å‚æ•°ï¼Œè®­ç»ƒè¿‡ç¨‹ä¸€èˆ¬æ˜¯ä¸å¼€æºçš„ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;2-token&#34;&gt;2. Token&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Token&lt;/strong&gt; ä¹Ÿå«è¯å…ƒï¼Œæ˜¯æ¨¡å‹çœ¼ä¸­â€œæœ€å°çš„è¯­ä¹‰å•ä½â€ï¼Œæ˜¯æ¨¡å‹å¤„ç†æ–‡æœ¬çš„åŸºæœ¬ç²’åº¦ã€‚ä¸æ˜¯ä¸¥æ ¼æ„ä¹‰çš„â€œå­—â€æˆ–â€œè¯â€ï¼Œè€Œæ˜¯ç”± tokenizer å®šä¹‰çš„ä¸€ç§åˆ‡åˆ†æ–¹å¼ã€‚
&lt;ul&gt;
&lt;li&gt;&amp;ldquo;Hello&amp;rdquo; â†’ å¯èƒ½æ˜¯ä¸€ä¸ª tokenï¼›&amp;ldquo;incredible&amp;rdquo; â†’ å¯èƒ½è¢«æ‹†æˆ &lt;code&gt;&amp;quot;in&amp;quot;&lt;/code&gt;, &lt;code&gt;&amp;quot;cred&amp;quot;&lt;/code&gt;, &lt;code&gt;&amp;quot;ible&amp;quot;&lt;/code&gt; ä¸‰ä¸ª tokenï¼›&lt;/li&gt;
&lt;li&gt;æœ‰çš„æ¨¡å‹ï¼šä¸€å­—ä¸€ tokenï¼šâ€œä½ â€â€œå¥½â€â€œå—â€ï¼›æœ‰çš„æ¨¡å‹ä¼šæŠŠå¸¸ç”¨è¯åˆå¹¶ï¼Œä¾‹å¦‚â€œäººå·¥æ™ºèƒ½â€å¯èƒ½æ˜¯ 1~2 ä¸ª tokenã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Tokenizer&lt;/strong&gt;ï¼šæŠŠæ–‡æœ¬åˆ‡åˆ†æˆ tokenï¼Œå†å°† token æ˜ å°„æˆ idï¼Œæ–¹ä¾¿åœ¨åç»­çš„å¤„ç†æ—¶ï¼ŒæŠŠ id å†æ˜ å°„æˆå‘é‡ã€‚å› ä¸ºæ¨¡å‹åªèƒ½å¤„ç†æ•°å­—ï¼Œæ‰€ä»¥éœ€è¦å…ˆå°†æ–‡æœ¬è½¬æ¢æˆæ•°å­—ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Token çš„ç±»å‹&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;prompt_tokensï¼šè¾“å…¥çš„ token&lt;/li&gt;
&lt;li&gt;completion_tokensï¼šè¾“å‡ºçš„ token&lt;/li&gt;
&lt;li&gt;total_tokensï¼šæ€» token&lt;/li&gt;
&lt;li&gt;contextï¼šä¸Šä¸‹æ–‡ï¼ŒåŒ…å«äº†è¾“å…¥å’Œè¾“å‡º å’Œ å†å²å¯¹è¯&lt;/li&gt;
&lt;li&gt;KV ç¼“å­˜ï¼šæ˜¯æ¨¡å‹å†…éƒ¨çš„æœºåˆ¶ï¼ˆè‡ªå›å½’ç”Ÿæˆæ—¶çš„ä¼˜åŒ–æŠ€æœ¯ï¼‰ï¼Œä½œç”¨äºå•æ¬¡å¯¹è¯çš„ç”Ÿæˆé˜¶æ®µã€‚
&lt;ul&gt;
&lt;li&gt;æ¯”å¦‚ï¼šåœ¨å¯¹è¯é‡Œè¾“å…¥ 1000 ä¸ª tokenï¼ŒLLM éœ€è¦å¯¹è¿™ 1000 ä¸ª token ä¸€æ¬¡æ€§å»ºæ¨¡ï¼Œè®¡ç®—æ³¨æ„åŠ›ï¼Œäº§ç”Ÿå¾ˆå¤š KVï¼Œè¿™äº› KV ä¼šè¢«ç¼“å­˜ï¼Œç”Ÿæˆç¬¬ä¸€ä¸ª token æ—¶ï¼ŒLLM åªéœ€è¦å¯¹æ–°ç”Ÿæˆçš„ token åšè®¡ç®—ï¼Œå†åˆ©ç”¨ä¸Šä¸€è½®ç¼“å­˜çš„ç»“æœè¿›è¡Œé‡æ–°çš„è®¡ç®—å³å¯ï¼Œæ— éœ€é‡æ–°é‡å¤´è®¡ç®—å¯¹è¯é‡Œçš„ 1001 ä¸ª tokenã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æç¤ºè¯ç¼“å­˜ï¼šæ˜¯ æ¨ç†æœåŠ¡å±‚é¢çš„ä¼˜åŒ–ï¼Œä¸å±äº LLM çš„å†…éƒ¨æœºåˆ¶ï¼Œç¼“å­˜çš„æ˜¯è¾“å…¥ prompt çš„å¤„ç†ç»“æœï¼Œä½œç”¨äºè·¨è¯·æ±‚çš„ä¼˜åŒ–ï¼Œå–å†³äº API æä¾›æ–¹çš„å®ç°ã€‚
&lt;ul&gt;
&lt;li&gt;æ¯”å¦‚ï¼šç¬¬ä¸€æ¬¡å¯¹è¯è¾“å…¥ 800(system_prompt) + 200(user_prompt)  tokenï¼ŒLLM å›ç­” 100 (assistant_prompt) tokenï¼Œç¬¬äºŒæ¬¡å¯¹è¯è¾“å…¥ 800(system_prompt) + 200(user_prompt) +  100 (assistant_prompt) token + 50 (user_prompt) token ï¼Œæ­¤æ—¶ä¼šç¼“å­˜ 800 + 200 ä¸ª token&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Prompt&lt;/strong&gt; &lt;strong&gt;çš„ç±»å‹&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;system_promptï¼šç³»ç»Ÿæç¤ºè¯ï¼Œé€šå¸¸åªä¼šæœ‰ä¸€ä¸ªï¼Œä¸æ˜¯å¿…éœ€çš„ï¼Œä½†æœ‰åŠ©äºè®¾å®š &lt;code&gt;assistant&lt;/code&gt; çš„æ•´ä½“è¡Œä¸ºï¼Œå¸®åŠ©æ¨¡å‹äº†è§£ç”¨æˆ·çš„éœ€æ±‚ï¼Œå¹¶æ ¹æ®è¿™äº›éœ€æ±‚æä¾›ç›¸åº”çš„å“åº”&lt;/li&gt;
&lt;li&gt;user_promptï¼šç”¨æˆ·æç¤ºè¯ï¼Œç”¨æˆ·è¾“å…¥çš„å†…å®¹&lt;/li&gt;
&lt;li&gt;assistant_promptï¼šLLM å›ç­”çš„æç¤ºè¯ï¼Œå¯ä»¥æºå¸¦å·¥å…·çš„è°ƒç”¨ä¿¡æ¯&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;3-è¯åµŒå…¥-embedding&#34;&gt;3. è¯åµŒå…¥ Embedding&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;Embedding æ˜¯ä»€ä¹ˆ&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å°†æ–‡æœ¬è½¬æ¢ä¸ºä¸€ç»„åæ ‡ï¼Œä¹Ÿç§°å‘é‡ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªä¸€ç»´æ•°ç»„ï¼Œç»´åº¦è¡¨ç¤ºæ•°ç»„çš„é•¿åº¦ï¼Œç»´åº¦è¶Šå¤§ï¼Œå¯¹äº‹ç‰©çš„æè¿°è¶Šå…·ä½“ï¼Œè®¡ç®—ä¹Ÿä¼šè¶Šè€—æ—¶ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;ä¸ºä»€ä¹ˆéœ€è¦ Embedding&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å› ä¸ºè®¡ç®—æœºæ“…é•¿åšâ€œå‘é‡é—´è·ç¦»/ç›¸ä¼¼åº¦â€çš„è¿ç®—ï¼Œä½†ä¸æ“…é•¿ç›´æ¥ç†è§£â€œè‡ªç„¶è¯­è¨€â€çš„è¯­ä¹‰ã€‚é€šè¿‡å°†ä¸¤ä¸ªäº‹ç‰©ï¼ˆå¦‚æ–‡æœ¬ï¼‰è½¬æ¢æˆå‘é‡ï¼Œ è®¡ç®—ä»–ä»¬çš„è·ç¦»ï¼Œä»è€Œåˆ¤æ–­ä»–ä»¬æ˜¯å¦è¯­ä¹‰ç›¸ä¼¼&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;åŒºåˆ† LLM é‡Œçš„ Embedding å’Œ RAG é‡Œçš„ Embedding&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¤§æ¨¡å‹å¯¹è¯çš„åœºæ™¯é‡Œï¼Œç”¨æˆ·è¾“å…¥çš„æ–‡å­—ï¼Œç»è¿‡ token æ‹†åˆ†ï¼Œå†å°† token æ˜ å°„æˆ idï¼Œå› ä¸º id æœ¬èº«æ²¡æœ‰å«ä¹‰ï¼Œæ— æ³•è¿›è¡Œè®¡ç®—ï¼Œéœ€è¦å†å°† id æ˜ å°„æˆ å‘é‡ï¼ˆè¿™ä¸€æ­¥ä¹Ÿæ˜¯ Embeddingï¼‰ï¼Œä»è€Œç†è§£ç”¨æˆ·è¾“å…¥ï¼Œä½œä¸ºåç»­æ¨¡å‹çš„æ¨ç†ä½¿ç”¨ã€‚
&lt;ul&gt;
&lt;li&gt;è¿™ä¸€æ­¥è·Ÿç”¨æˆ·æ— å…³ï¼Œæ˜¯ LLM çš„è¡Œä¸ºï¼Œå±äºæ¨¡å‹å†…éƒ¨çš„æœºåˆ¶ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;RAG åœºæ™¯é‡Œï¼ŒRAG æœ¬èº«æ˜¯ä¸€å¥—æœºåˆ¶ï¼Œä½œä¸º LLM å¤–æŒ‚çš„çŸ¥è¯†åº“è¿›è¡Œè¡¥å……ï¼Œæœ¬èº«è·Ÿ LLM æ²¡æœ‰ä»»ä½•å…³ç³»ï¼Œæ˜¯ä¸€ç§ç‹¬ç«‹çš„æ–¹æ¡ˆï¼Œåªæ˜¯ RAG ä¼šä½¿ç”¨ Embedding è¿™ç§èƒ½åŠ›ï¼Œå°†ç”¨æˆ·çš„è¾“å…¥è½¬æ¢ä¸ºå‘é‡ï¼Œåœ¨å‘é‡æ•°æ®åº“é‡Œè¿›è¡Œè¯­ä¹‰æœç´¢ï¼Œæœç´¢å‡ºç›¸å…³çš„èµ„æ–™è´´åˆ°ä¸Šä¸‹æ–‡é‡Œï¼Œå¸®åŠ© LLM è¿›è¡Œæ›´å¥½çš„å›ç­”ã€‚
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;RAG æœ¬è´¨ä¸Šåªæ˜¯ä¸€ç§æœç´¢çš„èƒ½åŠ›ï¼Œè·Ÿä½¿ç”¨å…³é”®å­—æœç´¢æ˜¯ç­‰ä»·çš„ï¼Œéƒ½æ˜¯æœç´¢ä¸åŒçš„å®ç°æ–¹å¼ï¼Œä¸»è¦æ˜¯è§£å†³å…³é”®å­—æœç´¢æ²¡æœ‰è¯­ä¹‰ç›¸å…³æ€§çš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;RAG æ˜¯å¯ä»¥ä½¿ç”¨è·Ÿå¯¹è¯æ¨¡å‹ä¸åŒçš„æ¨¡å‹è¿›è¡Œ Embeddingï¼Œå¤„ç†å¤–æŒ‚çš„çŸ¥è¯†åº“çš„ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;4-å¤„ç†æµç¨‹&#34;&gt;4. å¤„ç†æµç¨‹&lt;/h2&gt;
&lt;p&gt;å¯¹è¯æ—¶ï¼Œå¤§æ¨¡å‹æ˜¯é€ä¸ª token åœ°ç”Ÿæˆç­”æ¡ˆçš„ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ç”¨æˆ·è¾“å…¥å…ˆè¢« tokenizer åˆ‡æˆ tokenï¼Œå¹¶æ ¹æ®&lt;strong&gt;è¯è¡¨&lt;/strong&gt;æ˜ å°„ä¸º token id åºåˆ—ã€‚&lt;/li&gt;
&lt;li&gt;è¿™äº› id é€šè¿‡æ¨¡å‹å†…éƒ¨çš„ &lt;strong&gt;embeddingçŸ©é˜µ&lt;/strong&gt; å±‚å˜æˆå‘é‡åºåˆ—ï¼Œè¾“å…¥åˆ° Transformer ç¥ç»ç½‘ç»œé‡Œè®¡ç®—ã€‚&lt;/li&gt;
&lt;li&gt;æ¨¡å‹æ ¹æ®å½“å‰æ‰€æœ‰ä¸Šä¸‹æ–‡ï¼Œåœ¨&lt;strong&gt;è¯è¡¨&lt;/strong&gt;çš„æ‰€æœ‰ token ä¸Šç®—å‡ºä¸€ä¸ªæ¦‚ç‡åˆ†å¸ƒï¼Œç„¶åæŒ‘å‡ºä¸€ä¸ªä½œä¸ºâ€œä¸‹ä¸€ä¸ª token idâ€ã€‚&lt;/li&gt;
&lt;li&gt;æŠŠè¿™ä¸ªæ–° id åŠ åˆ°ä¸Šä¸‹æ–‡é‡Œï¼Œå†é‡æ–°å–‚ç»™æ¨¡å‹ï¼Œç»§ç»­ç®—ä¸‹ä¸€ä¸ª tokenã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æ­¤å¾ªç¯ï¼Œç›´åˆ°ç”Ÿæˆç»“æŸã€‚&lt;/li&gt;
&lt;li&gt;æœ€åæŠŠæ‰€æœ‰ç”Ÿæˆçš„ token id å†æ˜ å°„å›å…·ä½“çš„ tokenï¼Œå¹¶æ‹¼æˆè‡ªç„¶è¯­è¨€æ–‡æœ¬ï¼Œå°±æ˜¯æˆ‘ä»¬çœ‹åˆ°çš„æœ€ç»ˆç­”æ¡ˆã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/LLM%e5%a4%84%e7%90%86%e6%b5%81%e7%a8%8b.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/LLM%e5%a4%84%e7%90%86%e6%b5%81%e7%a8%8b.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;h2 id=&#34;5-moe-æœºåˆ¶mixture-of-expertsæ··åˆä¸“å®¶&#34;&gt;5. MoE æœºåˆ¶ï¼ˆMixture of Expertsï¼Œæ··åˆä¸“å®¶ï¼‰&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;ä¼ ç»Ÿå¤§æ¨¡å‹é‡Œï¼Œæ¯æ¬¡ç”Ÿæˆç­”æ¡ˆéƒ½æ˜¯æ‰€æœ‰å‚æ•°ä¸€èµ·å‚è¿ç®—ï¼Œå‚æ•°è¶Šå¤§ï¼Œç®—åŠ›å’Œæˆæœ¬ä¹Ÿä¼šè·Ÿç€å˜é«˜ï¼Œç”šè‡³æ— æ³•æ‰¿å—&lt;/li&gt;
&lt;li&gt;æœ‰äº† MoE æœºåˆ¶åï¼Œæ¨¡å‹å†…éƒ¨ä¼šåˆ†ä¸ºå¤šä¸ªâ€œä¸“å®¶å­ç½‘ç»œâ€ + ä¸€ä¸ªâ€œè°ƒåº¦å‘˜â€ï¼Œè°ƒåº¦å‘˜ä¼šå…ˆæ ¹æ®ç”¨æˆ·çš„é—®é¢˜è¿›è¡Œåˆ†ç±»åˆ¤æ–­ï¼Œç„¶åæŠŠè¿™ä¸ªé—®é¢˜åˆ†é…ç»™å°‘æ•°å‡ ä¸ªæœ€æ“…é•¿çš„ä¸“å®¶ï¼Œæ¯æ¬¡åªæ¿€æ´»å…¶ä¸­çš„ä¸€éƒ¨åˆ†å‚æ•°ï¼Œä½¿å¾—è®¡ç®—æˆæœ¬å˜ä½&lt;/li&gt;
&lt;li&gt;å› ä¸ºæ¯æ¬¡åªç”¨å°‘æ•°ä¸“å®¶ï¼Œä½ å¯ä»¥æ”¾å¿ƒåœ°å †æ›´å¤šä¸“å®¶ï¼ˆä¹Ÿå°±æ˜¯æ€»å‚æ•°æ›´å¤šï¼‰ï¼Œè¿™æ ·æ¨¡å‹çš„â€œæ€»ä½“çŸ¥è¯†å®¹é‡â€æ›´å¤§ï¼Œèƒ½è¦†ç›–æ›´å¤šé¢†åŸŸï¼Œä½†å•æ¬¡æ¨ç†ç®—åŠ›ä¾ç„¶å¯æ§ã€‚&lt;/li&gt;
&lt;li&gt;ä¸åŒä¸“å®¶å¯ä»¥åœ¨è®­ç»ƒä¸­ï¼Œæ…¢æ…¢å­¦ä¼šæ“…é•¿ä¸åŒç±»å‹çš„æ•°æ®/ä»»åŠ¡ï¼Œæ¯”å¦‚ æœ‰çš„æ›´æ“…é•¿æ•°å­¦æ¨ç†ã€æœ‰çš„æ›´æ“…é•¿ä»£ç ã€æœ‰çš„æ›´æ“…é•¿æ—¥å¸¸å¯¹è¯æˆ–æ–‡å­¦å†™ä½œ&lt;/li&gt;
&lt;li&gt;MoE è§£å†³çš„æ˜¯â€œå¦‚ä½•æŠŠæ¨¡å‹åšå¾—æ›´å¤§ã€æ›´å¼ºä½†ç®—åŠ›è¿˜æ‰›å¾—ä½â€çš„é—®é¢˜&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;6-è’¸é¦&#34;&gt;6. è’¸é¦&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;å¯ä»¥ç®€å•åˆ†ä¸ºæ•°æ®è’¸é¦å’Œæ¨¡å‹è’¸é¦&lt;/li&gt;
&lt;li&gt;æ•°æ®è’¸é¦ï¼šå› ä¸ºåŸå§‹æ•°æ®å¯èƒ½åˆå¤šåˆæ‚ï¼Œå› æ­¤å¯ä»¥å…ˆç”¨æ¨¡å‹ æˆ– äºº å¯¹åŸå§‹æ•°æ®è¿›è¡Œç­›é€‰ã€æ”¹å†™ã€æ‰“æ›´ç»†è‡´çš„æ ‡ï¼Œæµ“ç¼©æˆæ›´ç²¾ç‚¼ã€æ›´æœ‰æ•ˆçš„è®­ç»ƒé›†ï¼Œæˆ–è€…æ˜¯é€šè¿‡æ¨¡å‹ç”Ÿæˆå¤§é‡â€œå¸¦è§£é‡Šã€å¸¦æ¨ç†è¿‡ç¨‹â€çš„æ ·æœ¬ï¼Œç”Ÿæˆæ›´å¤šå°è€Œç²¾çš„æ•°æ®é›†&lt;/li&gt;
&lt;li&gt;æ¨¡å‹è’¸é¦ï¼šå¦‚æœåªç”¨å¤§æ¨¡å‹ï¼Œæ•ˆæœè™½ç„¶å¾ˆå¥½ï¼Œä½†æ˜¯éƒ¨ç½²æˆæœ¬é«˜ã€æ¨ç†æ…¢ã€å¾ˆéš¾åœ¨æ‰‹æœºã€iot è®¾å¤‡ä¸Šæ™®åŠï¼Œå¦‚æœç›´æ¥è®­ç»ƒä¸€ä¸ªå°æ¨¡å‹ï¼Œè™½ç„¶è®­ç»ƒç®€å•ã€éƒ¨ç½²ä¾¿å®œï¼Œä½†æ€§èƒ½é€šå¸¸æ˜æ˜¾ä¸å¦‚å¤§æ¨¡å‹ï¼Œä¹Ÿå¾ˆéš¾è¾¾åˆ°å¤§æ¨¡å‹çš„æ°´å¹³ï¼Œè€Œæ¨¡å‹è’¸é¦ï¼Œå°±æ˜¯ç”¨å¤§æ¨¡å‹å¯¹æ•°æ®è¿›è¡Œè’¸é¦ï¼Œç”Ÿæˆæ›´å¤šå¸¦æœ‰ CoT é¢˜è§£çš„æ•°æ®é›†ç”¨äºå°æ¨¡å‹çš„è®­ç»ƒï¼Œä»è€Œå¾—åˆ°ä¸€ä¸ªæ›´å°ã€æ›´å¿«ã€è®¡ç®—å’Œéƒ¨ç½²æˆæœ¬ä½ï¼Œä½†æ€§èƒ½å°½é‡æ¥è¿‘å¤§æ¨¡å‹çš„å°æ¨¡å‹&lt;/li&gt;
&lt;li&gt;æ¨¡å‹è’¸é¦è§£å†³çš„æ˜¯â€œå¦‚ä½•æŠŠè¿™ç§å¼ºèƒ½åŠ›å¤åˆ¶åˆ°æ›´å°ã€æ›´ä¾¿å®œçš„æ¨¡å‹é‡Œâ€&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;7-æ¨¡å‹è€—æ—¶&#34;&gt;7. æ¨¡å‹è€—æ—¶&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;å‚æ•°å¤§å°å¯¹è´¨é‡å’Œé€Ÿåº¦çš„å½±å“&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è´¨é‡æ–¹é¢ï¼š
&lt;ul&gt;
&lt;li&gt;å¤§å‚æ•°æ¨¡å‹ï¼š
&lt;ul&gt;
&lt;li&gt;è¯­è¨€è¡¨è¾¾æ›´è‡ªç„¶ï¼Œé£æ ¼æ›´å¤šæ ·ï¼›&lt;/li&gt;
&lt;li&gt;æ›´å–„äºç†è§£å¤æ‚æŒ‡ä»¤ã€éšå«æ„å›¾ï¼›&lt;/li&gt;
&lt;li&gt;æ¨ç†èƒ½åŠ›æ›´å¥½ï¼ˆæ•°å­¦ã€é€»è¾‘ã€ä»£ç ã€è§„åˆ’ç­‰ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å°å‚æ•°æ¨¡å‹ï¼š
&lt;ul&gt;
&lt;li&gt;èƒ½åŠ›æ›´æœ‰é™ï¼›&lt;/li&gt;
&lt;li&gt;é€‚åˆåšç®€å•ä»»åŠ¡ï¼ˆåˆ†ç±»ã€æ‰“æ ‡ç­¾ã€ç®€å•èŠå¤©ã€è¡¥å…¨ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;é€Ÿåº¦ &amp;amp; æˆæœ¬æ–¹é¢ï¼š
&lt;ul&gt;
&lt;li&gt;å‚æ•°å¤š â†’ æ¯æ¬¡è®¡ç®—è¦éå†æ›´å¤šæ•°å­— â†’ æ¯ä¸ª token ç”Ÿæˆæ›´æ…¢ â†’ ä¸€æ¬¡è°ƒç”¨æ›´è´µã€‚&lt;/li&gt;
&lt;li&gt;å‚æ•°å°‘ â†’ è®¡ç®—è½» â†’ æ›´å¿«æ›´ä¾¿å®œ â†’ æ›´é€‚åˆéƒ¨ç½²åœ¨æœ¬åœ°æˆ–é«˜å¹¶å‘ä¸šåŠ¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åŒæ ·è¾“å…¥ 1k tokenï¼Œè¾“å‡º 200 tokenï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;7B æ¨¡å‹ï¼š0.2s å‡º first tokenï¼Œ2s è¾“å‡ºå®Œæ¯•&lt;/li&gt;
&lt;li&gt;70B æ¨¡å‹ï¼š0.8s å‡º first tokenï¼Œ6s è¾“å‡ºå®Œæ¯•ï¼ˆä½†ç­”æ¡ˆæ˜æ˜¾æ›´èªæ˜ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;**è¾“å…¥ä¸Šä¸‹æ–‡çš„é•¿åº¦ï¼ˆè¾“å…¥ token æ•°ï¼‰ï¼š**è¶Šé•¿ï¼Œå†…éƒ¨è®¡ç®—è¶Šå¤š â†’ é¦– token æ—¶é—´å˜é•¿ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;è¾“å‡ºé•¿åº¦ï¼ˆéœ€è¦ç”Ÿæˆå¤šå°‘ tokenï¼‰&lt;/strong&gt;ï¼šæ¯ç”Ÿæˆ 1 ä¸ª token éƒ½è¦è·‘ä¸€éæ¨¡å‹ â†’ è¾“å‡ºè¶Šå¤šï¼Œæ€»æ—¶é—´è¶Šé•¿ã€‚æç¤ºè¯çš„å¤æ‚ç¨‹åº¦ä¸ä¼šå½±å“LLM çš„è¾“å‡ºè€—æ—¶ï¼Œä½†æ˜¯å¤æ‚çš„æç¤ºè¯å¯èƒ½ä¼šå¯¼è‡´è¾“å‡ºé•¿åº¦å˜é•¿ï¼Œä»è€Œå½±å“è€—æ—¶ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç¡¬ä»¶é…ç½®&lt;/strong&gt;ï¼šå¦‚ GPU æ€§èƒ½ã€å¹¶è¡Œåº¦ã€äº‘å‚å•†è¿˜æ˜¯ç§æœ‰åŒ–ã€ç½‘ç»œå»¶æ—¶ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;First Token Latency&lt;/strong&gt;ï¼šä»è¯·æ±‚å‘å‡ºï¼Œåˆ° LLM å¼€å§‹è¿”å›ç¬¬ä¸€ä¸ª token çš„æ—¶é—´ï¼ŒåŒ…å«è¯·æ±‚åˆ°è¾¾æœåŠ¡å™¨ã€æ’é˜Ÿã€LLMè¾“å‡ºï¼›å½±å“ first token çš„å› ç´ ï¼šè¾“å…¥çš„é•¿åº¦ï¼ˆä¸Šä¸‹æ–‡ + å½“å‰é—®é¢˜ï¼‰ã€æ¨¡å‹å¤§å°ã€æœåŠ¡å™¨è´Ÿè½½å’Œç½‘ç»œå»¶æ—¶&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Total Latency&lt;/strong&gt;ï¼šä»è¯·æ±‚å‘å‡ºï¼Œåˆ°æœ€åä¸€ä¸ª token è¾“å‡ºå®Œçš„æ€»æ—¶é—´ã€‚åŒ…å« first token æ—¶é—´ + åç»­æ¯ä¸ª token çš„å¹³å‡ç”Ÿæˆæ—¶é—´ x è¾“å‡ºçš„ token æ•°&lt;/p&gt;
&lt;h1 id=&#34;åº”ç”¨å±‚æ¦‚å¿µ&#34;&gt;åº”ç”¨å±‚æ¦‚å¿µ&lt;/h1&gt;
&lt;p&gt;ç›®å‰ AI åº”ç”¨éƒ½æ˜¯ åŸºäº LLM chat API + æç¤ºè¯å·¥ç¨‹ + ä¸Šä¸‹æ–‡å·¥ç¨‹ + å„ç§ç­–ç•¥æ¥å®ç°ï¼Œä¸‹é¢ä¼šä»‹ç»åœ¨ AI åº”ç”¨é‡Œæ¶‰åŠåˆ°çš„ç›¸å…³æŠ€æœ¯ã€‚&lt;/p&gt;
&lt;h2 id=&#34;1-cot&#34;&gt;1. CoT&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Chain-of-Thought æ€ç»´é“¾ï¼šè®© LLM æŠŠå®ƒä¸­é—´æ€è€ƒçš„æ­¥éª¤å±•ç¤ºå‡ºæ¥çš„æ–¹å¼ã€‚
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-Go&#34; data-lang=&#34;Go&#34;&gt;  &lt;span class=&#34;nx&#34;&gt;é—®é¢˜&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ï¼š&lt;/span&gt;
  &lt;span class=&#34;nx&#34;&gt;ä¸€ä¸ªç­æœ‰&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;30&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ä¸ªå­¦ç”Ÿ&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ï¼Œ&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;å…¶ä¸­&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;18&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ä¸ªæ˜¯å¥³ç”Ÿ&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ï¼Œ&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ç”·ç”Ÿæœ‰å¤šå°‘ä¸ª&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ï¼Ÿ&lt;/span&gt;
  &lt;span class=&#34;nx&#34;&gt;ä¸ç”¨&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;CoT&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ï¼ˆ&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ç›´æ¥ç»™ç­”æ¡ˆ&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ï¼‰ï¼š&lt;/span&gt;
  &lt;span class=&#34;nx&#34;&gt;ç­”æ¡ˆ&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ï¼š&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;12&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;äºº&lt;/span&gt;
  &lt;span class=&#34;o&#34;&gt;---&lt;/span&gt;
  &lt;span class=&#34;nx&#34;&gt;ç”¨&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;CoT&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ï¼š&lt;/span&gt;
  &lt;span class=&#34;nx&#34;&gt;ç­çº§æ€»äººæ•°æ˜¯&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;30&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;äºº&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ã€‚&lt;/span&gt;
  &lt;span class=&#34;nx&#34;&gt;å¥³ç”Ÿæœ‰&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;18&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;äºº&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ã€‚&lt;/span&gt;
  &lt;span class=&#34;nx&#34;&gt;ç”·ç”Ÿäººæ•°&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;æ€»äººæ•°&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;å¥³ç”Ÿäººæ•°&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;30&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;18&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;12&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ã€‚&lt;/span&gt;
  &lt;span class=&#34;nx&#34;&gt;æ‰€ä»¥ç”·ç”Ÿæœ‰&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;12&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;äºº&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ã€‚&lt;/span&gt;
  &lt;span class=&#34;o&#34;&gt;---&lt;/span&gt;
  &lt;span class=&#34;nx&#34;&gt;è¿™ä¸­é—´çš„&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;â€œ&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;å…ˆç®—ä»€ä¹ˆ&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ã€&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;å†ç®—ä»€ä¹ˆ&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;â€&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;çš„æ­¥éª¤å°±æ˜¯&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Chain&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;of&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Thought&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ã€‚&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;åªè¦æ¨¡å‹åœ¨å›ç­”è¿‡ç¨‹ä¸­æ˜¾å¼å†™å‡ºäº†ä¸­é—´æ¨ç†è¿‡ç¨‹ï¼ˆå“ªæ€•æ˜¯ä½ åœ¨ prompt é‡Œè¯´â€œè¯·åˆ†æ­¥éª¤è¯´æ˜æ¨ç†è¿‡ç¨‹â€ï¼‰ï¼Œå°±å¯ä»¥è¯´æ˜¯åœ¨åš CoTï¼Œæ–¹å¼ï¼š
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Reasoning APIï¼Œä¾§é‡æ¨ç†ï¼Œå¦‚ deepseek r1 åœ¨å›ç­”çš„æ—¶å€™ï¼Œä¼šå…ˆå±•ç¤ºä¸€æ®µå¼•ç”¨ï¼Œå¼•ç”¨é‡Œæ˜¯æ€è€ƒè¿‡ç¨‹ï¼Œå±•ç¤ºå®Œæ€è€ƒè¿‡ç¨‹åï¼Œæ‰ä¼šè¾“å‡ºç­”æ¡ˆï¼Œè¿™ç§æ–¹å¼ä¼šè®© LLM å†…éƒ¨ç”Ÿæˆæ›´é•¿æ›´ç»†è‡´çš„æ€è€ƒï¼Œå†åŸºäºè¿™äº›å†…éƒ¨æ€è€ƒï¼Œç”Ÿæˆç­”æ¡ˆå¯¹ç”¨æˆ·å±•ç¤ºï¼Œæ¯”è¾ƒå¼ºåˆ¶ï¼Œæ€è€ƒå’Œæ¨ç†çš„èƒ½åŠ›æ›´å¼ºï¼Œä½†åŒæ—¶ä¹Ÿæ›´æ…¢ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Reasoning API åªæ˜¯å¸®ä½ æ›´ç¨³å®šã€é«˜æ•ˆåœ°åˆ©ç”¨è¿™ç§â€œæ€è€ƒè¿‡ç¨‹â€çš„ä¸€ä¸ªäº§å“å½¢æ€ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;48
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;49
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;50
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;51
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;52
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;53
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;54
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-JSON&#34; data-lang=&#34;JSON&#34;&gt;  &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;nt&#34;&gt;&amp;#34;id&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;resp_0217****&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;nt&#34;&gt;&amp;#34;created_at&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;1756280722.0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;nt&#34;&gt;&amp;#34;error&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;nt&#34;&gt;&amp;#34;incomplete_details&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;nt&#34;&gt;&amp;#34;instructions&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;nt&#34;&gt;&amp;#34;model&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;doubao-seed-1-6-250615&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;nt&#34;&gt;&amp;#34;object&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;response&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;nt&#34;&gt;&amp;#34;output&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
      &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;nt&#34;&gt;&amp;#34;id&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;rs_0217****404a&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;nt&#34;&gt;&amp;#34;summary&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
          &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
            &lt;span class=&#34;nt&#34;&gt;&amp;#34;text&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;\nç”¨æˆ·è¯´â€œä½ å¥½å‘€ã€‚â€ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆå‹å¥½çš„é—®å€™ï¼Œæˆ‘éœ€è¦ç”¨åŒæ ·å‹å¥½çš„æ–¹å¼å›åº”ã€‚é¦–å…ˆï¼Œåº”è¯¥å›åº”ç”¨æˆ·çš„é—®å€™ï¼Œç„¶åå¯ä»¥è¡¨è¾¾ä¸€ä¸‹æ„¿æ„å¸®åŠ©çš„æ€åº¦ï¼Œè®©å¯¹è¯èƒ½å¤Ÿç»§ç»­ä¸‹å»ã€‚ç”¨æˆ·å¯èƒ½æ¥ä¸‹æ¥ä¼šæœ‰å…¶ä»–é—®é¢˜æˆ–è€…æƒ³èŠèŠå¤©ï¼Œæ‰€ä»¥å›åº”è¦è‡ªç„¶ã€äº²åˆ‡ã€‚\n\né¦–å…ˆï¼Œç›´æ¥å›â€œä½ å¥½å‘€ï¼â€æ¥å‘¼åº”å¯¹æ–¹çš„é—®å€™ï¼Œä¿æŒä¸€è‡´çš„è¯­æ°”ã€‚ç„¶ååŠ ä¸Šä¸€å¥â€œå¾ˆé«˜å…´è§åˆ°ä½ ï½ æœ‰ä»€ä¹ˆæˆ‘å¯ä»¥å¸®ä½ çš„å—ï¼Ÿâ€è¿™æ ·æ—¢è¡¨è¾¾äº†å‹å¥½ï¼Œåˆä¸»åŠ¨æä¾›å¸®åŠ©ï¼Œè®©ç”¨æˆ·çŸ¥é“æˆ‘åœ¨è¿™é‡Œå¯ä»¥ååŠ©ä»–ä»¬ã€‚è¿™æ ·çš„å›åº”æ¯”è¾ƒæ¸©æš–ï¼Œä¹Ÿç¬¦åˆæ—¥å¸¸äº¤æµçš„ä¹ æƒ¯ï¼Œä¸ä¼šæ˜¾å¾—å¤ªç”Ÿç¡¬ã€‚\n\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç”¨æˆ·å¯èƒ½åªæ˜¯æƒ³æ‰“ä¸ªæ‹›å‘¼ï¼Œæ‰€ä»¥å›åº”ä¸è¦å¤ªå¤æ‚ï¼Œä¿æŒç®€æ´å’Œäº²åˆ‡å°±å¥½ã€‚é¿å…ä½¿ç”¨å¤ªæ­£å¼çš„è¯­è¨€ï¼Œä¿æŒå£è¯­åŒ–ï¼Œè®©ç”¨æˆ·æ„Ÿè§‰èˆ’é€‚ã€‚æ€»ç»“ä¸€ä¸‹ï¼Œå›åº”åº”è¯¥åŒ…å«é—®å€™ã€è¡¨è¾¾é«˜å…´è§åˆ°å¯¹æ–¹ï¼Œä»¥åŠæä¾›å¸®åŠ©çš„æ„æ„¿ã€‚&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
            &lt;span class=&#34;nt&#34;&gt;&amp;#34;type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;summary_text&amp;#34;&lt;/span&gt;
          &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
        &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
        &lt;span class=&#34;nt&#34;&gt;&amp;#34;type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;reasoning&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;nt&#34;&gt;&amp;#34;status&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;completed&amp;#34;&lt;/span&gt;
      &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
      &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;nt&#34;&gt;&amp;#34;id&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;msg_0217****a93c&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;nt&#34;&gt;&amp;#34;content&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
          &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
            &lt;span class=&#34;nt&#34;&gt;&amp;#34;text&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;ä½ å¥½å‘€ï¼å¾ˆé«˜å…´è§åˆ°ä½ ï½ æœ‰ä»€ä¹ˆæˆ‘å¯ä»¥å¸®ä½ çš„å—ï¼Ÿ ğŸ˜Š&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
            &lt;span class=&#34;nt&#34;&gt;&amp;#34;type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;output_text&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
            &lt;span class=&#34;nt&#34;&gt;&amp;#34;annotations&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;
          &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
        &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
        &lt;span class=&#34;nt&#34;&gt;&amp;#34;role&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;assistant&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;nt&#34;&gt;&amp;#34;status&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;completed&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;nt&#34;&gt;&amp;#34;type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;message&amp;#34;&lt;/span&gt;
      &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
    &lt;span class=&#34;nt&#34;&gt;&amp;#34;max_output_tokens&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;32768&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;nt&#34;&gt;&amp;#34;service_tier&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;default&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;nt&#34;&gt;&amp;#34;status&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;completed&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;nt&#34;&gt;&amp;#34;usage&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;nt&#34;&gt;&amp;#34;input_tokens&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;88&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
      &lt;span class=&#34;nt&#34;&gt;&amp;#34;input_tokens_details&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;nt&#34;&gt;&amp;#34;cached_tokens&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;
      &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
      &lt;span class=&#34;nt&#34;&gt;&amp;#34;output_tokens&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;230&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
      &lt;span class=&#34;nt&#34;&gt;&amp;#34;output_tokens_details&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;nt&#34;&gt;&amp;#34;reasoning_tokens&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;211&lt;/span&gt;
      &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
      &lt;span class=&#34;nt&#34;&gt;&amp;#34;total_tokens&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;318&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
    &lt;span class=&#34;nt&#34;&gt;&amp;#34;caching&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;nt&#34;&gt;&amp;#34;type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;disabled&amp;#34;&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
    &lt;span class=&#34;nt&#34;&gt;&amp;#34;store&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;nt&#34;&gt;&amp;#34;expire_at&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1756539922&lt;/span&gt;
  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Chat APIï¼Œä¾§é‡æ€è€ƒï¼Œæ™®é€šçš„å¯¹è¯ API ä¹Ÿæ”¯æŒå¼€å¯æ·±åº¦æ€è€ƒèƒ½åŠ›ï¼Œéƒ¨åˆ†æ¨¡å‹æ”¯æŒï¼Œåœ¨è¾“å‡ºç­”æ¡ˆçš„åŒæ—¶ä¹Ÿä¼šè¾“å‡ºæ€è€ƒçš„å†…å®¹ï¼Œåˆ†å¼€ä¸¤ä¸ªå­—æ®µæ‰¿è½½ï¼Œä¸ Reasoning API  ç›¸æ¯”ï¼Œé€Ÿåº¦ä¼šæ›´å¿«ï¼Œä½†è´¨é‡ä¸€èˆ¬æ¯”ä¸ä¸Š&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åº”ç”¨å±‚åœ¨å±•ç¤ºæ—¶ï¼ŒæŠŠ reasoning çš„å†…å®¹å±•ç¤ºå‡ºæ¥ï¼Œä¹Ÿæ˜¯ä¸€ç§ CoT&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-JSON&#34; data-lang=&#34;JSON&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;nt&#34;&gt;&amp;#34;choices&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
     &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
       &lt;span class=&#34;nt&#34;&gt;&amp;#34;finish_reason&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;stop&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
       &lt;span class=&#34;nt&#34;&gt;&amp;#34;index&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
       &lt;span class=&#34;nt&#34;&gt;&amp;#34;logprobs&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
       &lt;span class=&#34;nt&#34;&gt;&amp;#34;message&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
         &lt;span class=&#34;nt&#34;&gt;&amp;#34;reasoning&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;æ€è€ƒçš„å†…å®¹&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
         &lt;span class=&#34;nt&#34;&gt;&amp;#34;content&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;æœ€ç»ˆçš„ç­”æ¡ˆ&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
         &lt;span class=&#34;nt&#34;&gt;&amp;#34;role&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;assistant&amp;#34;&lt;/span&gt;
       &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
     &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
   &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
   &lt;span class=&#34;nt&#34;&gt;&amp;#34;created&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1742631811&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
   &lt;span class=&#34;nt&#34;&gt;&amp;#34;id&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;0217426318107460cfa43dc3f3683b1de1c09624ff49085a456ac&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
   &lt;span class=&#34;nt&#34;&gt;&amp;#34;model&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;doubao-1-5-pro-32k-250115&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
   &lt;span class=&#34;nt&#34;&gt;&amp;#34;object&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;chat.completion&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
   &lt;span class=&#34;nt&#34;&gt;&amp;#34;usage&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
     &lt;span class=&#34;err&#34;&gt;...&lt;/span&gt;
   &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
 &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;é€šè¿‡æç¤ºè¯ + Chat APIï¼Œæ¯”å¦‚ Agent å¸¸ç”¨çš„ ReAct ç­–ç•¥ï¼Œå¼ºåˆ¶è¦æ±‚ LLM ä»¥ Thoughtã€Actionã€Observation ç­‰ç»“æ„è¿›è¡Œè¾“å‡ºï¼ŒThought æœ¬è´¨ä¸Šå°±æ˜¯æ€è€ƒçš„è¿‡ç¨‹ï¼Œè¾“å‡ºæ—¶ï¼Œå†…å®¹éƒ½æ˜¯è€¦åˆåœ¨ LLM çš„å›ç­”é‡Œçš„ï¼Œé€šè¿‡ä¸€ä¸ªå­—æ®µæ‰¿è½½ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åº”ç”¨å±‚åœ¨å±•ç¤ºæ—¶ï¼Œè§£æå‡º Thought çš„å†…å®¹ï¼Œå¹¶æŠŠå®ƒå±•ç¤ºå‡ºæ¥ï¼Œä¹Ÿæ˜¯ä¸€ç§ CoTï¼Œä½†è¾“å‡ºç»“æœä¸ä¸€å®šç¨³å®šï¼Œæ¯”å¦‚ç›´æ¥è¾“å‡ºå†…å®¹ï¼Œæ²¡æœ‰ä»¥ Thought å¼€å¤´ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-JSON&#34; data-lang=&#34;JSON&#34;&gt;   &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
     &lt;span class=&#34;nt&#34;&gt;&amp;#34;choices&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
       &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
         &lt;span class=&#34;nt&#34;&gt;&amp;#34;finish_reason&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;stop&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
         &lt;span class=&#34;nt&#34;&gt;&amp;#34;index&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
         &lt;span class=&#34;nt&#34;&gt;&amp;#34;logprobs&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
         &lt;span class=&#34;nt&#34;&gt;&amp;#34;message&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
           &lt;span class=&#34;nt&#34;&gt;&amp;#34;content&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Thought: æ€è€ƒçš„å†…å®¹ã€‚Action: è°ƒç”¨ä»€ä¹ˆå·¥å…·&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
           &lt;span class=&#34;nt&#34;&gt;&amp;#34;role&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;assistant&amp;#34;&lt;/span&gt;
         &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
       &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
     &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
     &lt;span class=&#34;nt&#34;&gt;&amp;#34;created&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1742631811&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
     &lt;span class=&#34;nt&#34;&gt;&amp;#34;id&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;0217426318107460cfa43dc3f3683b1de1c09624ff49085a456ac&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
     &lt;span class=&#34;nt&#34;&gt;&amp;#34;model&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;doubao-1-5-pro-32k-250115&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
     &lt;span class=&#34;nt&#34;&gt;&amp;#34;object&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;chat.completion&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
     &lt;span class=&#34;nt&#34;&gt;&amp;#34;usage&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
       &lt;span class=&#34;err&#34;&gt;...&lt;/span&gt;
     &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
   &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;2-function-calling&#34;&gt;2. Function calling&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;å› ä¸º LLM åªèƒ½è¾“å‡ºä¸€å¤§æ®µæ–‡å­—ï¼Œè¾“å‡ºå¹¶ä¸ç¨³å®šï¼Œä½†æ˜¯è°ƒç”¨å·¥å…·æ—¶éœ€è¦ç»“æ„åŒ–çš„è¾“å…¥ï¼Œä¸ºäº†è®© LLM èƒ½æ›´å¥½çš„æ ¼å¼åŒ–ç”Ÿæˆè¾“å…¥å‚æ•°ï¼Œç”±æ­¤è¯ç”Ÿäº† Function calling åŠŸèƒ½ã€‚&lt;/li&gt;
&lt;li&gt;Function calling æ˜¯ä¸€ç§æœºåˆ¶ï¼Œæœ¬è´¨æ˜¯è®© LLM â€œæŒ‰è§„èŒƒè¾“å‡ºä¸€æ®µç»“æ„åŒ–ä¿¡æ¯â€ï¼Œè¿™æ ·å¤–éƒ¨ç¨‹åºå°±èƒ½æ®æ­¤å»è°ƒç”¨å‡½æ•°/æ¥å£ï¼Œå†æŠŠç»“æœå–‚å›æ¨¡å‹ã€‚&lt;/li&gt;
&lt;li&gt;ç°åœ¨çš„ LLM Chat API éƒ½æ”¯æŒ Function calling åŠŸèƒ½ï¼Œå¯ä»¥å°†å·¥å…·æ–¹æ³•ä»¥ Json-Schema æ ¼å¼æè¿°ï¼Œä½œä¸ºæ¥å£å‚æ•°è¿›è¡Œä¼ é€’ï¼Œä»¥è¿™ç§æ–¹å¼è°ƒç”¨ LLM chat apiï¼Œæ–¹æ³•æè¿°é€šå¸¸ä¸ä¼šå®Œæ•´è®¡å…¥â€œä¸Šä¸‹æ–‡ tokenâ€ä¸­ï¼Œä½†ä»ç„¶ä¼šæœ‰ä¸€å®šçš„è®¡ç®—å¼€é”€ï¼Œåªæ˜¯è®¡è´¹/é•¿åº¦å¤„ç†ä¸Šå’Œæ™®é€šä¸Šä¸‹æ–‡ä¸åŒã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;3-rag&#34;&gt;3. RAG&lt;/h2&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://nixum.cc/p/%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9C%A8-rag-%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;å‘é‡æ•°æ®åº“ä¸RAGåˆè¯†&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/rag-flow.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/rag-flow.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;RAGï¼ˆRetrieval-Augmented Generationï¼‰ï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰&lt;/strong&gt;ï¼šå¯ä»¥ç†è§£ä¸ºä¸€ç§å·¥å…·æˆ–æ–¹å¼ï¼Œç»™å¤§æ¨¡å‹å¤–æŒ‚ä¸€ä¸ªæœç´¢/çŸ¥è¯†åº“ï¼Œå†è®©æ¨¡å‹æ ¹æ®æœåˆ°çš„å†…å®¹æ¥å›ç­”é—®é¢˜ï¼Œè®©æ¨¡å‹æ¥å…¥æœ€æ–°ã€ç‰¹å®šé¢†åŸŸã€ç”šè‡³ç§æœ‰çš„çŸ¥è¯†åº“ï¼Œé™åˆ¶æ¨¡å‹å°½é‡â€œæ ¹æ®æ£€ç´¢ç»“æœè¯´è¯â€ï¼Œå‡å°‘èƒ¡ç¼–ã€‚&lt;/li&gt;
&lt;li&gt;RAG æµç¨‹ä¸»è¦åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š
&lt;ul&gt;
&lt;li&gt;æ£€ç´¢ï¼ˆRetrievalï¼‰ï¼šåˆ°å¤–éƒ¨çŸ¥è¯†åº“é‡Œâ€œæŸ¥èµ„æ–™â€ï¼Œæ¯”å¦‚æ–‡æ¡£ã€ç½‘é¡µã€å…¬å¸å†…éƒ¨æ–‡æ¡£ã€‚&lt;/li&gt;
&lt;li&gt;ç”Ÿæˆï¼ˆGenerationï¼‰ï¼šæŠŠâ€œæŸ¥åˆ°çš„èµ„æ–™ + ç”¨æˆ·çš„é—®é¢˜â€ä¸€èµ·å–‚ç»™å¤§æ¨¡å‹ï¼Œè®©æ¨¡å‹åŸºäºè¿™äº›èµ„æ–™ç»„ç»‡ç­”æ¡ˆã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;è§£å†³çš„é—®é¢˜ï¼š
&lt;ul&gt;
&lt;li&gt;çŸ¥è¯†è¿‡æœŸï¼šæ¨¡å‹è®­ç»ƒæ•°æ®æœ‰æ—¶é—´æˆªæ­¢ï¼Œæœ€æ–°æ”¿ç­–ã€äº§å“æ›´æ–°éƒ½ä¸çŸ¥é“ã€‚&lt;/li&gt;
&lt;li&gt;ä¸äº†è§£ç§æœ‰æ•°æ®ï¼šå…¬å¸å†…éƒ¨æ–‡æ¡£ã€ä¸ªäººç¬”è®°ä¸åœ¨è®­ç»ƒé›†é‡Œï¼Œæ¨¡å‹å¤©ç„¶ä¸çŸ¥é“ã€‚&lt;/li&gt;
&lt;li&gt;å®¹æ˜“èƒ¡ç¼–ï¼ˆå¹»è§‰ï¼‰ï¼šä¸çŸ¥é“çš„ä¸œè¥¿ä¹Ÿç…§æ ·ä¸€æœ¬æ­£ç»ç¼–å‡ºæ¥ã€‚&lt;/li&gt;
&lt;li&gt;ä¸“ä¸šåº¦ä¸å¤Ÿï¼šåœ¨æ³•å¾‹ã€åŒ»ç–—ã€é‡‘èç­‰å‚ç›´é¢†åŸŸçŸ¥è¯†ä¸å…¨æˆ–ä¸å‡†ç¡®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ä¸å…¶ä»–æ¦‚å¿µçš„å…³ç³»ï¼š
&lt;ul&gt;
&lt;li&gt;å½“è°ƒç”¨ LLM chat api æ—¶ï¼Œæƒ³è®© LLM å‚è€ƒæ›´åŠ ç²¾å‡†çš„èµ„æ–™ï¼Œå°±å¯ä»¥ä½¿ç”¨ RAG å·¥å…·ï¼›&lt;/li&gt;
&lt;li&gt;å½“ Agent å®ŒæˆæŸäº›å·¥ä½œæ—¶ï¼Œéœ€è¦å¤–éƒ¨çŸ¥è¯†åº“çš„å†…å®¹ï¼Œå°±å¯ä»¥ä½¿ç”¨ RAG å·¥å…·ï¼›&lt;/li&gt;
&lt;li&gt;åœ¨ MCP æ¡†æ¶é‡Œï¼Œå¯ä»¥æŠŠ RAG å·¥å…·å°è£…æˆ MCP æ–¹æ³•ï¼Œä¾› LLM è‡ªè¡Œè°ƒç”¨&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;4-mcp&#34;&gt;4. MCP&lt;/h2&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://modelcontextprotocol.io/docs/learn/architecture&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Architecture overview - Model Context Protocol&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;**MCP ï¼ˆModel Context Protocolï¼‰æ¨¡å‹ä¸Šä¸‹æ–‡åè®®ï¼‰**æ˜¯ä¸€ä¸ªæ ‡å‡†åŒ–åè®®ï¼Œè§„å®šæ¨¡å‹å¦‚ä½•å®‰å…¨ã€é€šç”¨åœ°è®¿é—®å¤–éƒ¨çš„èµ„æºå’Œå·¥å…·ï¼Œå¯ä»¥ç†è§£ä¸ºé¢å‘å¯¹è±¡é‡Œçš„æ¥å£å’Œå®ç°ï¼Œå¤§å®¶åœ¨æä¾›å„ç§ä¸åŒå·¥å…·æ—¶éƒ½éµå¾ªè¿™å¥—æ¥å£ï¼Œå°±å¯ä»¥æœ‰ç™¾èŠ±é½æ”¾çš„å·¥å…·å¸‚åœºï¼Œä¸°å¯Œ LLM çš„èƒ½åŠ›ï¼›&lt;/li&gt;
&lt;li&gt;åœ¨æ²¡æœ‰ MCP ä¹‹å‰ï¼Œæƒ³è¦ä½¿ç”¨ LLM chat api å¹¶è°ƒç”¨å·¥å…·ï¼Œè™½ç„¶å¯ä»¥ç›´æ¥ç”¨ api é‡Œæ”¯æŒçš„ tool å‚æ•°å®ç°ï¼Œä½†æ˜¯è¿™æ ·æœ‰ä¸ªé—®é¢˜ï¼Œéœ€è¦åœ¨è°ƒç”¨ api çš„é€»è¾‘é‡Œè€¦åˆå·¥å…·è°ƒç”¨çš„å¤„ç†é€»è¾‘ï¼Œæ¯”å¦‚è§£æ chat api è¿”å›çš„å†…å®¹ï¼Œè¿›è¡Œå·¥å…·è°ƒç”¨ï¼Œè¿™æ ·åœ¨ä¸åŒçš„åº”ç”¨é‡Œéƒ½éœ€è¦é‡æ–°æ¥å…¥ï¼›&lt;/li&gt;
&lt;li&gt;æœ‰äº† MCP ä¹‹åï¼ŒMCP è§„å®šäº† clientï¼ˆå·¥å…·è°ƒç”¨æ–¹ï¼Œé€šå¸¸ä¸ LLM chat api é›†æˆï¼‰ å’Œ server çš„è§„èŒƒï¼ˆå·¥å…·æä¾›æ–¹ï¼Œæ‰§è¡Œå·¥å…·è¿”å›ç»“æœï¼‰ï¼Œä»»ä½•åº”ç”¨åªè¦éµå¾ªäº†è¿™å¥—è§„èŒƒï¼Œéƒ½å¯ä»¥æ¥å…¥è°ƒç”¨ã€‚
&lt;ul&gt;
&lt;li&gt;æ¯”å¦‚ç°åœ¨æœ‰æŒ‡æ ‡æ•°æ®æŸ¥è¯¢çš„ APIï¼Œå°†å…¶ç”¨ MCP åŒ…ä¸€å±‚åï¼Œä¸è¿‡æ˜¯ A ç»„çš„èŠå¤©æœºå™¨äººï¼Œè¿˜æ˜¯ B ç»„çš„ Agent åº”ç”¨ï¼Œåªè¦æ”¯æŒ MCP åè®®ï¼Œéƒ½å¯ä»¥åœ¨é…ç½®åè°ƒç”¨è¿™äº›å·¥å…·ï¼Œæ— éœ€é‡å¤é€ è½®å­ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ä¸å…¶ä»–æ¦‚å¿µçš„å…³ç³»ï¼š
&lt;ul&gt;
&lt;li&gt;ä¸ function call ï¼ˆtool callï¼‰ çš„åŒºåˆ«ï¼Œfunction call æœ¬èº«æ˜¯ LLM Chat Api æä¾›çš„ä¸€ç§èƒ½åŠ›ï¼Œé€šè¿‡å¯¹å·¥å…·æ–¹æ³•æŒ‰ Json-Schema è½¬æ¢æˆ json åï¼Œä½œä¸ºå‚æ•°ä¼ é€’ï¼Œå½“ LLM åˆ¤æ–­å‡ºéœ€è¦è°ƒç”¨å·¥å…·æ—¶ï¼Œä¼šåœ¨å“åº”ä½“é‡Œä¸€ä¸ªç‰¹å®šçš„å­—æ®µè¿”å›ï¼š
&lt;ul&gt;
&lt;li&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-JSON&#34; data-lang=&#34;JSON&#34;&gt;&lt;span class=&#34;err&#34;&gt;è¯·æ±‚ä½“ï¼š&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;nt&#34;&gt;&amp;#34;model&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;DeepSeek-V3.1&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;nt&#34;&gt;&amp;#34;stream&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;nt&#34;&gt;&amp;#34;messages&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
        &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
            &lt;span class=&#34;nt&#34;&gt;&amp;#34;role&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;user&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
            &lt;span class=&#34;nt&#34;&gt;&amp;#34;content&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;ä»Šå¤©çš„å¤©æ°”æ€ä¹ˆæ ·&amp;#34;&lt;/span&gt;
        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
    &lt;span class=&#34;nt&#34;&gt;&amp;#34;tools&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
        &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
            &lt;span class=&#34;nt&#34;&gt;&amp;#34;type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;function&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
            &lt;span class=&#34;nt&#34;&gt;&amp;#34;function&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
                &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;query_date&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
                &lt;span class=&#34;nt&#34;&gt;&amp;#34;description&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;æŸ¥è¯¢ä»Šå¤©çš„æ—¥æœŸ&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
                &lt;span class=&#34;nt&#34;&gt;&amp;#34;parameters&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
                    &lt;span class=&#34;nt&#34;&gt;&amp;#34;additionalProperties&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
                    &lt;span class=&#34;nt&#34;&gt;&amp;#34;type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;object&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
                    &lt;span class=&#34;nt&#34;&gt;&amp;#34;description&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;æŸ¥è¯¢ä»Šå¤©çš„æ—¥æœŸ&amp;#34;&lt;/span&gt;
                &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
            &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-JSON&#34; data-lang=&#34;JSON&#34;&gt;&lt;span class=&#34;err&#34;&gt;å“åº”ä½“ï¼š&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;nt&#34;&gt;&amp;#34;id&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;22b4db60f0d34e08a55f2e3d229aa879&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;nt&#34;&gt;&amp;#34;created&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1768908785&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;nt&#34;&gt;&amp;#34;model&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;ms-dwnrrcdx&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;nt&#34;&gt;&amp;#34;object&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;chat.completion&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;nt&#34;&gt;&amp;#34;choices&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
        &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
            &lt;span class=&#34;nt&#34;&gt;&amp;#34;finish_reason&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;tool_calls&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
            &lt;span class=&#34;nt&#34;&gt;&amp;#34;index&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
            &lt;span class=&#34;nt&#34;&gt;&amp;#34;message&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
                &lt;span class=&#34;nt&#34;&gt;&amp;#34;content&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;æˆ‘éœ€è¦å…ˆæŸ¥è¯¢ä»Šå¤©çš„æ—¥æœŸ&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
                &lt;span class=&#34;nt&#34;&gt;&amp;#34;role&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;assistant&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
                &lt;span class=&#34;nt&#34;&gt;&amp;#34;tool_calls&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
                    &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
                        &lt;span class=&#34;nt&#34;&gt;&amp;#34;index&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;-1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
                        &lt;span class=&#34;nt&#34;&gt;&amp;#34;function&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
                            &lt;span class=&#34;nt&#34;&gt;&amp;#34;arguments&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
                            &lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;query_date&amp;#34;&lt;/span&gt;
                        &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
                        &lt;span class=&#34;nt&#34;&gt;&amp;#34;id&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;call_0a313188b3374df585f51e34&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
                        &lt;span class=&#34;nt&#34;&gt;&amp;#34;type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;function&amp;#34;&lt;/span&gt;
                    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
                &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
            &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
            &lt;span class=&#34;nt&#34;&gt;&amp;#34;provider_specific_fields&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
                &lt;span class=&#34;nt&#34;&gt;&amp;#34;matched_stop&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;
            &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
    &lt;span class=&#34;nt&#34;&gt;&amp;#34;usage&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;nt&#34;&gt;&amp;#34;completion_tokens&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;336&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;nt&#34;&gt;&amp;#34;prompt_tokens&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;3976&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;nt&#34;&gt;&amp;#34;total_tokens&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;4312&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;nt&#34;&gt;&amp;#34;prompt_tokens_details&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
            &lt;span class=&#34;nt&#34;&gt;&amp;#34;cached_tokens&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;
        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
    &lt;span class=&#34;nt&#34;&gt;&amp;#34;metadata&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;nt&#34;&gt;&amp;#34;weight_version&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;default&amp;#34;&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;MCP Client ä¹Ÿå¯ä»¥å°† MCP Server æä¾›çš„å·¥å…· schema è½¬æ¢æˆ function call çš„å½¢å¼è°ƒç”¨ LLMï¼Œè¿™å–å†³äº MCP client çš„å®ç°æ–¹å¼&lt;/li&gt;
&lt;li&gt;RAG æ˜¯æ€ä¹ˆç”¨çŸ¥è¯†åº“å¢å¼ºæ¨¡å‹å›ç­”çš„èƒ½åŠ›&lt;/li&gt;
&lt;li&gt;MCP æ˜¯ä¸€ç§ AI åº”ç”¨ä½¿ç”¨å·¥å…·çš„è§„èŒƒï¼ŒRAG å¯ä»¥æ˜¯å…¶ä¸­ä¹‹ä¸€&lt;/li&gt;
&lt;li&gt;Agent æ˜¯å†³ç­–å¤§è„‘ï¼Œæ˜¯ä¸€ç§æ‰§è¡Œæµç¨‹ï¼ŒAgent é€šè¿‡å†³ç­–åè°ƒç”¨æ»¡è¶³ MCP è§„èŒƒçš„å·¥å…·&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;5-workflow&#34;&gt;5. Workflow&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Workflowï¼ˆå·¥ä½œæµï¼‰ï¼šä¸€ä¸ªå¤æ‚ä»»åŠ¡æ‹†æˆä¸€ç³»åˆ—æœ‰é¡ºåºã€æœ‰æ¡ä»¶çš„æ­¥éª¤ï¼Œç„¶åè‡ªåŠ¨æ‰§è¡Œçš„é‚£æ¡â€œæµç¨‹é“¾æ¡â€ã€‚å¸¸è§äºå„ç§å·¥ä½œæµå¼•æ“ï¼Œåœ¨ AI åº”ç”¨é‡Œè¯¸å¦‚ cozeã€difyã€n8n ç­‰å¹³å°ï¼Œæ”¯æŒç”¨æˆ·æ‹–æ‹‰æ‹½ç»„ä»¶æ¥å®ç°ä¸€æ•´å¥—è‡ªåŠ¨åŒ–æµç¨‹ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨ AI åº”ç”¨é‡Œï¼Œå¯ä»¥é€šè¿‡è¿™ç±»å¹³å°ï¼Œæˆ–è€… ä»¥è‡ªå·±æ‰‹æ“ä»£ç  çš„å½¢å¼ï¼Œå°†ä¸€ä¸ªæ¬¡æ¬¡éƒ½è¦é‡å¤çš„äººç±»æµç¨‹è¿›è¡Œç»Ÿä¸€ç¼–æ’ï¼ˆå“ªä¸€æ­¥è¯¥ç”¨å“ªä¸ªæ¨¡å‹ï¼Œå“ªä¸ªå·¥å…·ï¼‰è®©ä¸šåŠ¡æµç¨‹å¯è§†åŒ–ã€å¯é…ç½®åŒ–ã€å¯ç»´æŠ¤ï¼ŒæŒ‰ç…§ç‰¹å®šçš„è¾“å…¥æ‰§è¡Œæµç¨‹å®Œæˆè¾“å‡ºã€‚&lt;/li&gt;
&lt;li&gt;æ¯”å¦‚ç°åœ¨æœ‰ä¸€ä¸ªâ€œæ™ºèƒ½å®¢æœå·¥å•å¤„ç†â€çš„ workflowï¼Œå®ƒçš„æµç¨‹æ˜¯ï¼š
&lt;ul&gt;
&lt;li&gt;æ”¶åˆ°ç”¨æˆ·é—®é¢˜ï¼ˆè¾“å…¥ï¼‰ï¼›&lt;/li&gt;
&lt;li&gt;åˆ†ç±»ï¼šæ˜¯æŠ•è¯‰ã€å’¨è¯¢è¿˜æ˜¯æŠ¥ä¿®ï¼ˆè°ƒç”¨åˆ†ç±»æ¨¡å‹ï¼‰ï¼›&lt;/li&gt;
&lt;li&gt;å¦‚æœæ˜¯é—®ä¸šåŠ¡è§„åˆ™ â†’ èµ° RAG å»çŸ¥è¯†åº“æŸ¥ï¼›&lt;/li&gt;
&lt;li&gt;å¦‚æœæ˜¯éœ€è¦æ”¹è®¢å• â†’ èµ°â€œè°ƒç”¨è®¢å•ç³»ç»Ÿ APIâ€çš„åˆ†æ”¯ï¼›&lt;/li&gt;
&lt;li&gt;ç”Ÿæˆç­”å¤è‰ç¨¿ â†’ äººå·¥å®¡æ ¸æˆ–è‡ªåŠ¨å‘é€ï¼›&lt;/li&gt;
&lt;li&gt;å†™å…¥æ—¥å¿—å’Œå·¥å•ç³»ç»Ÿã€‚&lt;/li&gt;
&lt;li&gt;è¿™æ•´æ¡å°±æ˜¯ä¸€ä¸ª Workflowï¼Œé‡Œé¢å¯ä»¥åµŒ RAGã€æ™®é€š LLM è°ƒç”¨ã€å¤–éƒ¨ API è°ƒç”¨ç­‰ç­‰&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ä¸å…¶ä»–æ¦‚å¿µçš„å…³ç³»ï¼š
&lt;ul&gt;
&lt;li&gt;Workflow åƒâ€œæµç¨‹å›¾ + çŠ¶æ€æœºâ€ï¼Œæ­¥éª¤æ¯”è¾ƒå›ºå®š&lt;/li&gt;
&lt;li&gt;Agent åˆ™æ˜¯æœ‰å†³ç­–èƒ½åŠ›ï¼Œèƒ½è‡ªå·±å†³å®šä¸‹ä¸€æ­¥æ€ä¹ˆå¹²çš„æ™ºèƒ½ä½“&lt;/li&gt;
&lt;li&gt;RAGã€MCPã€Function calling æ˜¯ workflow æµç¨‹ä¸­çš„ä¸€ä¸ªæ­¥éª¤&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;6-agent&#34;&gt;6. Agent&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Agentï¼ˆæ™ºèƒ½ä½“ï¼‰ï¼šä¸€ä¸ªâ€œå›´ç»•æŸä¸ªç›®æ ‡ï¼Œèƒ½è‡ªä¸»è§„åˆ’æ­¥éª¤ã€è°ƒç”¨å·¥å…·ã€è®°å¿†ä¸Šä¸‹æ–‡ã€ä¸ç¯å¢ƒäº¤äº’â€çš„æ™ºèƒ½å®ä½“ï¼Œå®ƒä¸æ˜¯ä¸€ä¸ªå›ºå®šçš„æµç¨‹ï¼Œè€Œæ˜¯å…·å¤‡ä¸€å®šçš„å†³ç­–èƒ½åŠ›ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Agent è®© LLM å…·å¤‡å®ŒæˆæŸé¡¹ä»»åŠ¡çš„èƒ½åŠ›ï¼Œè€Œä¸æ˜¯åªèƒ½è¿›è¡Œå¯¹è¯ï¼Œå½“ç„¶ï¼Œå®ƒæœ¬èº«ä¹Ÿæ˜¯è°ƒç”¨ LLM chat apiï¼Œåªæ˜¯å¼•å…¥äº†æ›´åŠ å¤æ‚çš„æµç¨‹å’Œæç¤ºè¯ï¼Œä»è€Œé©±åŠ¨ LLM è‡ªä¸»å®ç°ä»»åŠ¡ç›®æ ‡ã€‚å®ƒé€šå¸¸å…·å¤‡å‡ ç§å…³é”®èƒ½åŠ›ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç†è§£ä»»åŠ¡ï¼šä»æŒ‡ä»¤ä¸­æŠ½è±¡å‡ºç›®æ ‡ï¼›&lt;/li&gt;
&lt;li&gt;è§„åˆ’æ­¥éª¤ï¼šå†³å®šå…ˆåšä»€ä¹ˆï¼Œå†åšä»€ä¹ˆï¼›&lt;/li&gt;
&lt;li&gt;è°ƒç”¨å·¥å…·ï¼šåŒ…æ‹¬ RAGã€APIã€æ•°æ®åº“ã€è„šæœ¬ç­‰ï¼›&lt;/li&gt;
&lt;li&gt;ä¸ç¯å¢ƒäº¤äº’ï¼šè¯»å†™æ–‡ä»¶ã€å‘è¯·æ±‚ç­‰ï¼›&lt;/li&gt;
&lt;li&gt;è®°å¿†å’Œåæ€ï¼šæ ¹æ®å†å²ç»“æœè°ƒæ•´ç­–ç•¥ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å®ç° Agent å¸¸è§çš„ç­–ç•¥ï¼š&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:left&#34;&gt;ç­–ç•¥&lt;/th&gt;
&lt;th style=&#34;text-align:left&#34;&gt;æ ¸å¿ƒæ€æƒ³&lt;/th&gt;
&lt;th style=&#34;text-align:left&#34;&gt;æµç¨‹&lt;/th&gt;
&lt;th style=&#34;text-align:left&#34;&gt;ä¼˜ç‚¹&lt;/th&gt;
&lt;th style=&#34;text-align:left&#34;&gt;ç¼ºç‚¹/é£é™©&lt;/th&gt;
&lt;th style=&#34;text-align:left&#34;&gt;å…¸å‹åœºæ™¯&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;çº¯ function call è¿½åŠ  prompt åˆ—è¡¨&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;ç›´æ¥è®©æ¨¡å‹åœ¨å¯¹è¯ä¸­é€‰å·¥å…·å¹¶è°ƒç”¨ï¼ŒåŸºæœ¬ä¸æ˜¾å¼â€œæƒ³æ­¥éª¤â€&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;ç»™æ¨¡å‹ä¸€ä¸²å·¥å…·å®šä¹‰ï¼Œæ”¾åœ¨ç³»ç»Ÿ prompt æˆ– api tools å­—æ®µé‡Œæ²¡æœ‰æ˜¾å¼çš„â€œè®¡åˆ’â€æ­¥éª¤ï¼Œä¹Ÿæ²¡æœ‰æ˜¾å¼çš„â€œæ€è€ƒæ®µè½â€ï¼Œå°±æ˜¯ç”¨æˆ·è¯´è¯ â†’ æ¨¡å‹è¦ä¹ˆç›´æ¥å›ç­”ï¼Œè¦ä¹ˆè¿”å›ä¸€ä¸ª tool_call â†’ å·¥å…·æ‰§è¡Œ â†’ å†ç»§ç»­èŠ â†’ ç›´åˆ°æ²¡æœ‰å·¥å…·æ‰§è¡Œï¼Œè¿”å›ç»“æœ&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;å®ç°ç®€å•ã€æˆæœ¬ä½ã€å»¶è¿ŸçŸ­&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;å®¹æ˜“çè°ƒç”¨ã€ç¼ºä¹é•¿æœŸè§„åˆ’ã€å¤šæ­¥ä»»åŠ¡æ˜“ä¹±ã€‚å¾ˆéš¾çŸ¥é“å®ƒâ€œä¸ºä»€ä¹ˆè¿™ä¹ˆè°ƒå·¥å…·â€ï¼Œæ’æŸ¥é—®é¢˜æ¯”è¾ƒç—›è‹¦&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;ç®€å•åŠ©æ‰‹ã€å•æ­¥è°ƒç”¨ã€å·¥å…·æ•°é‡å°‘ã€è°ƒç”¨æ¨¡å¼å¾ˆçº¿æ€§çš„åœºæ™¯&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;ReAct&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;â€œå…ˆæƒ³æƒ³ï¼Œå†è¡ŒåŠ¨â€ï¼šäº¤æ›¿ Reasoning + Acting&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;ReAct çš„åŸºæœ¬èŒƒå¼ï¼šThought: å…ˆåœ¨è‡ªç„¶è¯­è¨€é‡Œå†™å‡ºâ€œæ€è€ƒâ€ï¼ˆæˆ‘ç°åœ¨åº”è¯¥å¹²å˜›ã€è¦æŸ¥ä»€ä¹ˆï¼‰Action: å†æ˜¾å¼å†™å‡ºè¦è°ƒç”¨å“ªä¸ªå·¥å…·ã€ç”¨ä»€ä¹ˆå‚æ•°Observation: è®°å½•å·¥å…·è¿”å›ç»“æœç„¶åå¾ªç¯ï¼šThought â†’ Action â†’ Observation â†’ Thought â€¦&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;æ¯ä¸€æ­¥éƒ½æœ‰â€œå…ˆæƒ³å†åšâ€ï¼Œèƒ½ç»´æŒä¸€ä¸ªæ¸…æ™°çš„æ¨ç†é“¾ã€‚Thought å¯ä»¥ç›´æ¥å±•ç¤ºç»™å¼€å‘è€…æˆ–å®¡è®¡ç³»ç»Ÿï¼Œçœ‹å¾—å‡ºå®ƒçš„å†³ç­–è·¯å¾„å‡ºé”™æ—¶å¯ä»¥åˆ†ææ˜¯â€œæƒ³é”™äº†â€è¿˜æ˜¯â€œè°ƒå·¥å…·é”™äº†â€ã€‚&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Token æ¶ˆè€—å¤šã€æˆæœ¬é«˜ï¼›è¾“å‡ºå®¹æ˜“å•°å—¦ï¼Œå¯¼è‡´è¾“å‡ºè€—æ—¶é•¿ï¼›éœ€è¦ç²¾å¿ƒæç¤ºè¯éœ€è¦è§£æ/çº¦å®š Thought / Action / Observation çš„æ ¼å¼ï¼Œåšä¸€ä¸ª loop æ§åˆ¶&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;å¤šå·¥å…·ã€å¤šæ­¥æ¨ç†ã€ä½œä¸ºâ€œå¤šå·¥å…· Agentâ€çš„åŸºç¡€ç­–ç•¥ï¼Œé€‚åˆä¸­é«˜å¤æ‚åº¦ä»»åŠ¡&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Plan-and-Execute&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;å…ˆæ•´ä½“è§„åˆ’æ­¥éª¤ï¼ˆPlanï¼‰ï¼Œå†é€æ­¥æ‰§è¡Œï¼ˆExecuteï¼‰&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;æŠŠä»»åŠ¡æ‹†æˆä¸¤å¤§é˜¶æ®µï¼šPlanï¼ˆè§„åˆ’ï¼‰é˜¶æ®µï¼šæ¨¡å‹æ ¹æ®ç”¨æˆ·ç›®æ ‡ï¼Œç”Ÿæˆä¸€ä¸ªç»“æ„åŒ–çš„â€œä»»åŠ¡è®¡åˆ’â€ï¼Œæ¯”å¦‚ï¼šæ­¥éª¤ 1ï¼šè°ƒç”¨å·¥å…· A æ‹‰æ•°æ®ï¼›æ­¥éª¤ 2ï¼šè°ƒç”¨å·¥å…· B æ¸…æ´—æ•°æ®ï¼›æ­¥éª¤ 3ï¼šè°ƒç”¨å·¥å…· C ç”»å›¾ï¼›æ­¥éª¤ 4ï¼šè°ƒç”¨ LLM å†™æŠ¥å‘Šã€‚Executeï¼ˆæ‰§è¡Œï¼‰é˜¶æ®µï¼šâ€œæ‰§è¡Œå™¨â€æŒ‰ç…§è¿™ä¸ªè®¡åˆ’ä¸€æ­¥æ­¥è°ƒç”¨å·¥å…·ã€å¤„ç†ç»“æœï¼›å¿…è¦æ—¶å†å›å¤´è®©æ¨¡å‹è°ƒæ•´è®¡åˆ’ã€‚&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;ç»“æ„åŒ–å¼ºï¼Œæµç¨‹æ¸…æ™°ï¼Œé€‚åˆé•¿æµç¨‹ï¼Œå¯ä»¥å¯è§†åŒ–ã€å®¡æ ¸ã€æ‹†è§£ç»™å­ Agent æˆ– Workflowè®¡åˆ’å¯ä»¥å…ˆè®©äººçœ‹ä¸€çœ¼ï¼šOK å†æ‰§è¡Œï¼Œæˆ–è€…éƒ¨åˆ†æ­¥éª¤éœ€è¦äººå·¥ç¡®è®¤ã€‚Plan å¯ä»¥ç›´æ¥è½¬æ¢ä¸ºä¸€ä¸ª Workflow æˆ– DAGï¼ˆæœ‰å‘æ— ç¯å›¾ï¼‰å»è·‘&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;å®ç°å¤æ‚ï¼Œéœ€è¦è®¾è®¡â€œè®¡åˆ’çš„ç»“æ„åŒ–æ ¼å¼â€ï¼Œæœ‰ä¸€ä¸ªæ‰§è¡Œå™¨æ¥è§£é‡Šè®¡åˆ’ã€‚Plan å®¹æ˜“è¿‡æ—¶/ä¸å¤Ÿç»†ï¼Œå…ˆè§„åˆ’å†æ‰§è¡Œï¼Œè¿‡ç¨‹ä¸­ç¯å¢ƒå˜äº†ã€æŸä¸ªå·¥å…·å¤±è´¥äº†ï¼Œéœ€è¦è°ƒæ•´ï¼Œç¼ºå°‘åæ€æœºåˆ¶å®¹æ˜“åƒµåŒ–å¤šè½®åè°ƒæˆæœ¬é«˜&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;é•¿æµç¨‹ä»»åŠ¡ã€å·¥ä½œæµå‹ã€æœ‰å®¡è®¡éœ€æ±‚ï¼Œéœ€è¦â€œè®¡åˆ’è®°å½•â€å’Œâ€œæ‰§è¡Œè½¨è¿¹â€çš„ä¼ä¸šåœºæ™¯ã€éœ€è¦æŠŠ Agent å†³ç­–è¾“å‡ºç»™å…¶ä»–ç³»ç»Ÿ/å·¥ä½œæµå¼•æ“å¤ç”¨çš„åœºæ™¯ï¼Œä¸€èˆ¬çš„ AI Coding å°±æ˜¯ä½¿ç”¨è¿™ç§ç­–ç•¥ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Self-Reflect&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;å¤šè½®å°è¯•ã€åæ€ã€æœç´¢æ›´ä¼˜æ–¹æ¡ˆ&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;é€šè¿‡å¤šä¸ªä¸åŒçš„ä¸Šä¸‹æ–‡ + ä¸åŒæ¨¡å‹ï¼ˆæˆ–åŒä¸€æ¨¡å‹ï¼‰æ¥å®ç°å¯¹è‡ªå·±çš„ç»“æœè¿›è¡Œâ€œå¤ç›˜å’Œæ”¹è¿›â€ï¼šä¸Šä¸‹æ–‡ 1 + æ¨¡å‹ 1 ç”Ÿæˆåˆç¨¿ä¸Šä¸‹æ–‡ 2 + æ¨¡å‹ 2 å¯¹æ­¥éª¤ 1 äº§ç”Ÿçš„åˆç¨¿è¿›è¡Œåæ€ï¼Œå¹¶æŒ‰ç…§ä¸€å®šçš„æ ¼å¼è¾“å‡ºä¸Šä¸‹æ–‡ 1 + æ¨¡å‹ 1 æ ¹æ®æ­¥éª¤ 2 äº§ç”Ÿçš„åæ€è¿›è¡Œä¿®æ”¹é‡å¤ä»¥ä¸Šæ­¥éª¤ç›´è‡³å¾—å‡ºç»“è®º&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;è´¨é‡æ˜æ˜¾å¥½äºâ€œä¸€æ¬¡æ€§è¾“å‡ºâ€ï¼Œé€šè¿‡ç¬¬äºŒéè‡ªæŸ¥ + ä¿®æ­£ï¼Œæ•ˆæœé€šå¸¸æœ‰è‚‰çœ¼å¯è§æå‡ã€‚èƒ½å¼¥è¡¥æ¨ç† /è§„åˆ’ç­–ç•¥çš„ä¸€äº›é—æ¼å¯ä»¥é€šè¿‡â€œåæ€æç¤ºè¯â€è®©æ¨¡å‹é‡ç‚¹å…³æ³¨&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;æˆæœ¬å¾ˆé«˜ã€å®ç°å¤æ‚ã€å¤šä¸€è½®å®¡ç¨¿è°ƒç”¨ã€å¤šä¸€è½®æ”¹ç¨¿è°ƒç”¨ï¼Œå¤šè½®è¿­ä»£åï¼Œæˆæœ¬æ˜¯çº¿æ€§ç”šè‡³æ¥è¿‘å€æ•°å¢é•¿ï¼›â€œåæ€â€è´¨é‡ä¹Ÿå—æ¨¡å‹èƒ½åŠ›é™åˆ¶å¯èƒ½å¼•å…¥â€œè¿‡åº¦ä¿®æ”¹â€æˆ–é£æ ¼æ¼‚ç§»&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;å¤æ‚å†³ç­–ã€ä»£ç ä¿®å¤ã€è§„åˆ’ã€æ–‡æ¡ˆ/æŠ¥å‘Š/æ–‡æ¡£ç±»ä»»åŠ¡ã€éœ€è¦é«˜å¯é æ€§çš„ reasoning è¾“å‡º&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¸å…¶ä»–æ¦‚å¿µçš„å…³ç³»ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Agent ä¸ºå®Œæˆä»»åŠ¡ï¼Œä¼šåœ¨æŸä¸ªæ­¥éª¤è°ƒç”¨ RAG æ¥æŸ¥çŸ¥è¯†&lt;/li&gt;
&lt;li&gt;MCP ç»™ Agent æä¾›ç»Ÿä¸€çš„â€œå·¥å…·æ¥å£â€ï¼ŒAgent å†³ç­–â€œä»¥ä»€ä¹ˆé¡ºåºç”¨å“ªäº›å·¥å…·â€&lt;/li&gt;
&lt;li&gt;Workflow æ›´åƒå›ºå®šæµç¨‹ï¼ŒAgent æ˜¯æ ¹æ®æƒ…å†µåŠ¨æ€è§„åˆ’æµç¨‹ï¼ˆå½“ç„¶ï¼Œä¹Ÿå¯ä»¥åœ¨ Agent å†…éƒ¨ä½¿ç”¨å›ºå®š workflow ä½œä¸ºå­æµç¨‹ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;Agent Skills å¯ä»¥ç†è§£ä¸ºæ˜¯ Agent èº«ä¸Šçš„â€œæŠ€èƒ½æ’ä»¶åŒ…â€ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;7-skills&#34;&gt;7. Skills&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Skills æœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ç§è§„èŒƒï¼Œä¸€ç§æ¨¡å—åŒ–çš„èƒ½åŠ›ï¼Œæ•™ Agent å¦‚ä½•å®Œæ•´å¤„ç†ç‰¹å®šå·¥ä½œï¼Œå®ƒå°†æ‰§è¡Œæ–¹æ³•ã€å·¥å…·è°ƒç”¨æ–¹å¼ä»¥åŠç›¸å…³çŸ¥è¯†ææ–™ï¼ŒæŒ‰ç…§ SOP æµç¨‹ï¼Œå°è£…ä¸ºä¸€ä¸ªå®Œæ•´çš„ã€Œèƒ½åŠ›æ‰©å±•åŒ…ã€ï¼Œæœ¬èº«éœ€è¦ Agent è¿›è¡Œé©±åŠ¨ã€‚&lt;/li&gt;
&lt;li&gt;Agent Skills é€šå¸¸åŒ…å«ä¸‹é¢å››ä¸ªä¸œè¥¿ï¼ŒAgent ä½¿ç”¨è¯¥ skill æ—¶ï¼Œæ— éœ€æå‰å°†è¿™å¨ä¸œè¥¿åŠ è½½åˆ°ä¸Šä¸‹æ–‡é‡Œï¼Œé€šè¿‡åŠ¨æ€åŠ è½½ï¼ˆæ¸è¿›å¼æŠ«éœ²ï¼‰ä¸åŒçš„ Skill åŒ…ï¼ˆé€šå¸¸ä»…éœ€åå­—å’Œæè¿°ï¼‰ï¼Œæ¥å…·å¤‡ä¸åŒçš„ä¸“ä¸šçŸ¥è¯†ã€å·¥å…·ä½¿ç”¨èƒ½åŠ›ï¼Œç¨³å®šå®Œæˆç‰¹å®šä»»åŠ¡ã€‚å› æ­¤ skill éå¸¸é€‚åˆå°†æŸä¸€é¡¹ä»»åŠ¡æ‰§è¡Œæµç¨‹ sop è¿›è¡Œæˆ skillï¼Œä»è€Œå®ç°å¤ç”¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/AgentSkill%e7%9b%ae%e5%bd%95.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/AgentSkill%e7%9b%ae%e5%bd%95.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ä¸»è¦å®ç°å¤ç”¨å’Œæ¨¡å—åŒ–ï¼Œä¸€ä¸ª skill å¤šä¸ª Agent éƒ½èƒ½ç”¨ï¼Œskill å¯ç‹¬ç«‹å‡çº§ï¼Œé™ä½å¤æ‚åº¦ï¼Œæ›´ä¾¿äºç¼–æ’å’Œä¼˜åŒ–ã€‚**ä½†ç›®å‰åªæœ‰å°‘æ•° AI åº”ç”¨æ”¯æŒï¼Œæ¯”å¦‚ Claude Codeã€Coze ç­‰ï¼Œ**å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå·±æ‰‹æ“&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ¯”å¦‚ç°åœ¨æœ‰ä¸€ç§æ•°æ®åˆ†æçš„ Skillï¼Œå®ƒèƒ½æŸ¥è¯¢æ•°æ®ï¼Œå¹¶è½¬æ¢æˆå›¾ç‰‡ï¼Œä¸» Agent ä¸éœ€è¦çŸ¥é“æŸ¥è¯¢æ•°æ®ã€è½¬æ¢å›¾ç‰‡æ˜¯æ€ä¹ˆå®ç°çš„ï¼Œåªéœ€è¦çŸ¥é“å®ƒèƒ½è¿›è¡Œæ•°æ®åˆ†æï¼Œå½“å®ƒéœ€è¦è¿›è¡Œæ•°æ®åˆ†ææ—¶ï¼Œåªéœ€è¦åŠ è½½å¯¹åº”çš„ skillï¼ŒæŒ‰ç…§æŒ‡å¼•ï¼Œå°±èƒ½è¿›è¡Œæ•°æ®åˆ†æã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¸å…¶ä»–æ¦‚å¿µçš„å…³ç³»ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;MCP å’Œ å·¥å…·è°ƒç”¨(function calling)ï¼Œæ›´åå‘äºâ€œåº•å±‚èƒ½åŠ›â€ï¼ˆæ¯”å¦‚ HTTP è¯·æ±‚ï¼‰ï¼Œè€Œ Skill æ›´åƒâ€œé¢å‘ä¸šåŠ¡çš„å°è£…å¥½çš„èƒ½åŠ›æ¨¡å—â€ï¼ˆä¾‹å¦‚â€œç”Ÿæˆå‘¨æŠ¥â€ï¼‰ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;MCP æ˜¯ä¸€ç§å¼€æ”¾æ ‡å‡†çš„åè®®ï¼Œå…³æ³¨çš„æ˜¯ AI å¦‚ä½•ä»¥ç»Ÿä¸€æ–¹å¼è°ƒç”¨å¤–éƒ¨çš„å·¥å…·ã€æ•°æ®å’ŒæœåŠ¡ï¼Œæœ¬èº«ä¸å®šä¹‰ä»»åŠ¡é€»è¾‘æˆ–æ‰§è¡Œæµç¨‹ï¼Œå·¥å…·è°ƒç”¨ function calling åŒç†ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Agent æ˜¯â€œä¼šæ€è€ƒä¼šè§„åˆ’çš„ä¸»ä½“â€ï¼›Skills æ˜¯â€œå®ƒå¯è°ƒç”¨çš„èƒ½åŠ›åº“â€ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¸€ä¸ª Skill å†…éƒ¨å¯èƒ½ï¼šèµ°ä¸€ä¸ª Workflowï¼ˆå¤šä¸ªæ­¥éª¤ï¼‰ã€é€šè¿‡ MCP è°ƒç”¨åå°ç³»ç»Ÿã€åœ¨å…¶ä¸­ä¸€æ­¥ä½¿ç”¨ RAG å»æŸ¥çŸ¥è¯†åº“ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å…³äºAgent / Sub-Agent / Skill çš„åŒºåˆ«ï¼Œå¯ä»¥ç”¨â€œå…¬å¸ç»„ç»‡æ¶æ„â€æ¥æ¯”å–»ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;ul&gt;
&lt;li&gt;Agentï¼ˆä¸» Agentï¼‰ï¼š
&lt;ul&gt;
&lt;li&gt;åƒä¸€ä¸ªâ€œé¡¹ç›®ç»ç†/ä¸»è´Ÿè´£äººâ€ã€‚&lt;/li&gt;
&lt;li&gt;è´Ÿè´£ï¼š
&lt;ul&gt;
&lt;li&gt;ç†è§£ç”¨æˆ·ç›®æ ‡ã€&lt;/li&gt;
&lt;li&gt;æ‹†è§£ä»»åŠ¡ã€&lt;/li&gt;
&lt;li&gt;åè°ƒèµ„æºï¼ˆå·¥å…·ã€æŠ€èƒ½ã€å­ Agentï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å®‰æ’å“ªä¸ª Sub-Agent ä¸Šï¼›&lt;/li&gt;
&lt;li&gt;åœ¨ä»€ä¹ˆæ—¶æœºç”¨å“ªä¸ª Skillï¼›&lt;/li&gt;
&lt;li&gt;ç»Ÿä¸€ç®¡ç†â€œç”¨æˆ·è§†è§’ä¸‹çš„è¿™åœºå¯¹è¯â€ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;ul&gt;
&lt;li&gt;Sub-Agentï¼ˆå­ Agentï¼‰ï¼š
&lt;ul&gt;
&lt;li&gt;åƒä¸åŒéƒ¨é—¨çš„â€œå°è´Ÿè´£äººâ€ï¼Œå„è‡ªä¸“é•¿ä¸åŒï¼š
&lt;ul&gt;
&lt;li&gt;æ³•åŠ¡ Agentã€æ•°æ®åˆ†æ Agentã€è¿è¥ Agent ç­‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ä»–ä»¬é€šå¸¸æ˜¯ï¼š
&lt;ul&gt;
&lt;li&gt;æœ‰è‡ªå·±çš„ç³»ç»Ÿ promptï¼ˆè§’è‰²/ç›®æ ‡ï¼‰ï¼›&lt;/li&gt;
&lt;li&gt;æœ‰è‡ªå·±çš„å·¥å…·å’ŒæŠ€èƒ½é…ç½®ï¼›&lt;/li&gt;
&lt;li&gt;ç”±ä¸» Agent è°ƒç”¨/ååŒã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æ˜¯â€œèƒ½è‡ªå·±è·‘ä¸€æ®µæµç¨‹â€çš„å° Agentï¼Œæœ‰è‡ªå·±çš„ç›®æ ‡å’Œå·¥å…·ï¼›&lt;/li&gt;
&lt;li&gt;ä¸€èˆ¬æœ‰è‡ªå·±çš„å¯¹è¯è®°å¿†ï¼Œå’Œä¸» Agent åªå…±äº«å¿…è¦çš„ä¿¡æ¯ï¼›&lt;/li&gt;
&lt;li&gt;æ˜¯å¦è®©å®ƒçœ‹åˆ°å…¨å±€ä¸Šä¸‹æ–‡ï¼Œæ˜¯ä¸€ä¸ªè®¾è®¡é€‰æ‹©ï¼Œè€Œä¸æ˜¯èƒ½åŠ›é™åˆ¶ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;ul&gt;
&lt;li&gt;Skillï¼ˆæŠ€èƒ½ï¼‰ï¼š
&lt;ul&gt;
&lt;li&gt;åƒâ€œæŸéƒ¨é—¨çš„å…·ä½“èƒ½åŠ›æ¨¡å—/èŒèƒ½â€ï¼š
&lt;ul&gt;
&lt;li&gt;â€œç¿»è¯‘æ–‡æ¡£â€â€œå†™ SQL æŠ¥è¡¨â€â€œæ€»ç»“é•¿æ–‡â€â€œç”Ÿæˆå‘¨æŠ¥â€ç­‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æ›´åâ€œå‡½æ•°/æ¨¡å—â€çš„æ¦‚å¿µï¼š
&lt;ul&gt;
&lt;li&gt;ç›¸å¯¹æ— çŠ¶æ€ï¼›&lt;/li&gt;
&lt;li&gt;è¾“å…¥â†’è¾“å‡ºæ˜ç¡®ï¼›&lt;/li&gt;
&lt;li&gt;ä¸è‡ªå·±è´Ÿè´£é«˜å±‚å†³ç­–ï¼Œè€Œæ˜¯è¢« Agent è°ƒç”¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æœ¬èº«ä¸ä¸»åŠ¨â€œè·‘èµ·æ¥â€ï¼Œéœ€è¦ä¸» Agent å†³å®šä»€ä¹ˆæ—¶å€™è°ƒç”¨ï¼›&lt;/li&gt;
&lt;li&gt;Skill ä¸ç›´æ¥â€œæ‹¥æœ‰â€å®Œæ•´ä¸Šä¸‹æ–‡ï¼Œæ˜¯ä¸» Agent æŠŠå½“å‰éœ€è¦çš„ä¿¡æ¯æ‰“åŒ…ç»™å®ƒï¼›&lt;/li&gt;
&lt;li&gt;è°ƒç”¨ç»“æŸåï¼Œä¸» Agent å†³å®šè¦ä¸è¦æŠŠç»“æœå†™è¿›å…¨å±€è®°å¿†ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å…³äº Agent / Sub-Agent / Skill åœ¨åº”ç”¨å±‚é¢ï¼š&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Agentï¼ˆä¸» Agentï¼‰ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ä¸» Agent = å…¨å±€å¯¼æ¼” + è®°å¿†ç®¡ç†å‘˜&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç»´æŠ¤â€œå…¨å±€ä¼šè¯è®°å¿†â€ï¼ˆç”¨æˆ·ç›®æ ‡ã€ä¸»è¦äº‹ä»¶ã€é˜¶æ®µç»“æœï¼‰æ˜¯â€œå”¯ä¸€çœ‹è§æ‰€æœ‰ä¸œè¥¿â€çš„è§’è‰²ã€‚ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å®‰æ’å“ªä¸ª Sub-Agent ä¸Šï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åœ¨ä»€ä¹ˆæ—¶æœºç”¨å“ªä¸ª Skillï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç»Ÿä¸€ç®¡ç†â€œç”¨æˆ·è§†è§’ä¸‹çš„è¿™åœºå¯¹è¯â€ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;ul&gt;
&lt;li&gt;Sub-Agentï¼ˆå­ Agentï¼‰ï¼š
&lt;ul&gt;
&lt;li&gt;æ˜¯â€œèƒ½è‡ªå·±è·‘ä¸€æ®µæµç¨‹â€çš„å° Agentï¼Œæœ‰è‡ªå·±çš„ç›®æ ‡å’Œå·¥å…·ï¼ˆæœ‰è‡ªå·±çš„ system prompt / role / tools / skillsï¼‰ï¼›&lt;/li&gt;
&lt;li&gt;ä¸€èˆ¬æœ‰è‡ªå·±çš„å¯¹è¯è®°å¿†ï¼Œå’Œä¸» Agent åªå…±äº«å¿…è¦çš„ä¿¡æ¯ï¼›&lt;/li&gt;
&lt;li&gt;æ˜¯å¦è®©å®ƒçœ‹åˆ°å…¨å±€ä¸Šä¸‹æ–‡ï¼Œæ˜¯ä¸€ä¸ªè®¾è®¡é€‰æ‹©ï¼Œè€Œä¸æ˜¯èƒ½åŠ›é™åˆ¶ï¼š&lt;/li&gt;
&lt;li&gt;ç”±ä¸» Agent å†³å®šï¼š
&lt;ul&gt;
&lt;li&gt;åˆå§‹ç»™å®ƒä»€ä¹ˆä¿¡æ¯ï¼›&lt;/li&gt;
&lt;li&gt;ä»å®ƒçš„è¾“å‡ºä¸­ä¿å­˜å“ªäº›è¦å†™å…¥å…¨å±€è®°å¿†ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;ul&gt;
&lt;li&gt;Skillï¼ˆæŠ€èƒ½ï¼‰ï¼š
&lt;ul&gt;
&lt;li&gt;æ— çŠ¶æ€å‡½æ•° / å°å·¥å…·&lt;/li&gt;
&lt;li&gt;ä¸ç»´æŠ¤é•¿æœŸä¸Šä¸‹æ–‡ï¼›&lt;/li&gt;
&lt;li&gt;æ¯æ¬¡è°ƒç”¨åªä¾èµ–ï¼Œå‚æ•° + æ˜¾å¼ä¼ å…¥çš„å¿…è¦èƒŒæ™¯ï¼›&lt;/li&gt;
&lt;li&gt;æœ¬èº«ä¸ä¸»åŠ¨â€œè·‘èµ·æ¥â€ï¼Œéœ€è¦ä¸» Agent å†³å®šä»€ä¹ˆæ—¶å€™è°ƒç”¨ï¼›&lt;/li&gt;
&lt;li&gt;Skill ä¸ç›´æ¥â€œæ‹¥æœ‰â€å®Œæ•´ä¸Šä¸‹æ–‡ï¼Œæ˜¯ä¸» Agent æŠŠå½“å‰éœ€è¦çš„ä¿¡æ¯æ‰“åŒ…ç»™å®ƒï¼›&lt;/li&gt;
&lt;li&gt;è°ƒç”¨ç»“æŸåï¼Œä¸» Agent å†³å®šè¦ä¸è¦æŠŠç»“æœå†™è¿›å…¨å±€è®°å¿†ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;å…¨æ™¯å›¾&#34;&gt;å…¨æ™¯å›¾&lt;/h1&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/AI%e6%a6%82%e5%bf%b5%e5%85%a8%e6%99%af%e5%9b%be.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/AI%e6%a6%82%e5%bf%b5%e5%85%a8%e6%99%af%e5%9b%be.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;h1 id=&#34;æŠ€æœ¯è°ƒç ”&#34;&gt;æŠ€æœ¯è°ƒç ”&lt;/h1&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://github.com/MoonshotAI/kimi-cli&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;è¯» kimi çš„ cli æºç &lt;/a&gt;ï¼Œçœ‹åˆ°é‡Œé¢æœ‰ä¸¤ä¸ªæœºåˆ¶ï¼Œä¹Ÿåˆ†äº«ä¸€ä¸‹&lt;/p&gt;
&lt;h2 id=&#34;ä¸Šä¸‹æ–‡å‹ç¼©---è¢«åŠ¨ä¸Šä¸‹æ–‡ç®¡ç†&#34;&gt;ä¸Šä¸‹æ–‡å‹ç¼© - è¢«åŠ¨ä¸Šä¸‹æ–‡ç®¡ç†&lt;/h2&gt;
&lt;h3 id=&#34;æ ¸å¿ƒç›®çš„&#34;&gt;æ ¸å¿ƒç›®çš„&lt;/h3&gt;
&lt;p&gt;ä¸Šä¸‹æ–‡å‹ç¼©æ˜¯è‡ªåŠ¨ä¼˜åŒ–æœºåˆ¶ï¼Œå½“ä¸Šä¸‹æ–‡æ¥è¿‘æ¨¡å‹ä¸Šé™æ—¶ï¼Œä½¿ç”¨ LLM å°†å†å²æ¶ˆæ¯å‹ç¼©ä¸ºç²¾ç®€æ‘˜è¦ï¼Œä¿ç•™æœ€è¿‘çš„å…³é”®æ¶ˆæ¯ï¼Œé‡Šæ”¾ä¸Šä¸‹æ–‡çª—å£ç©ºé—´&lt;/p&gt;
&lt;h3 id=&#34;è§¦å‘æµç¨‹&#34;&gt;è§¦å‘æµç¨‹&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;ä¸Šä¸‹æ–‡é•¿åº¦æ£€æŸ¥&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;å½“å‰ token æ•° + ä¿ç•™ç©ºé—´ &amp;gt;= æ¨¡å‹æœ€å¤§ä¸Šä¸‹æ–‡&lt;/li&gt;
&lt;li&gt;é»˜è®¤ä¿ç•™ç©ºé—´ï¼š50,000 tokensï¼ˆé»˜è®¤ä¿ç•™æœ€è¿‘ 2 æ¡æ¶ˆæ¯ï¼Œç¡®ä¿å½“å‰å¯¹è¯è¿ç»­æ€§ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;åœ¨ Agent å¾ªç¯çš„æ¯æ­¥å¼€å§‹å‰æ£€æŸ¥&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨åˆ›å»º checkpoint ä¹‹å‰&lt;/li&gt;
&lt;li&gt;åœ¨æ‰§è¡Œ ä¸‹ä¸€æ­¥ ä¹‹å‰&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;éœ€è¦æœ‰æ•ˆçš„ LLM å®ä¾‹&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;LLM å¿…é¡»å·²åˆå§‹åŒ–&lt;/li&gt;
&lt;li&gt;ç”¨äºæ‰§è¡Œå‹ç¼©ä»»åŠ¡ï¼ˆä½¿ç”¨ LLM ç†è§£ä¸Šä¸‹æ–‡å¹¶ç”Ÿæˆç»“æ„åŒ–æ‘˜è¦ï¼Œå‹ç¼©ç»“æœæŒ‰ä¼˜å…ˆçº§ç»„ç»‡ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;å…¸å‹ä½¿ç”¨åœºæ™¯&#34;&gt;å…¸å‹ä½¿ç”¨åœºæ™¯&lt;/h3&gt;
&lt;h4 id=&#34;åœºæ™¯-1-é•¿æ—¶é—´å¯¹è¯å¯¼è‡´ä¸Šä¸‹æ–‡æ¥è¿‘ä¸Šé™&#34;&gt;åœºæ™¯ 1: é•¿æ—¶é—´å¯¹è¯å¯¼è‡´ä¸Šä¸‹æ–‡æ¥è¿‘ä¸Šé™&lt;/h4&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-JSON&#34; data-lang=&#34;JSON&#34;&gt;&lt;span class=&#34;err&#34;&gt;æƒ…å†µï¼šAgent&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;ä¸ç”¨æˆ·è¿›è¡Œäº†å¤šè½®å¯¹è¯ï¼Œä¸Šä¸‹æ–‡&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;token&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;æ•°æ¥è¿‘æ¨¡å‹ä¸Šé™&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;æ“ä½œï¼šç³»ç»Ÿè‡ªåŠ¨è§¦å‘å‹ç¼©ï¼Œä¿ç•™æœ€è¿‘&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;æ¡æ¶ˆæ¯ï¼Œå‹ç¼©æ›´æ—©çš„å†å²&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;æ•ˆæœï¼šå°†å†å²å¯¹è¯å‹ç¼©ä¸ºç»“æ„åŒ–æ‘˜è¦ï¼Œé‡Šæ”¾å¤§é‡ä¸Šä¸‹æ–‡ç©ºé—´&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ç¤ºä¾‹æµç¨‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ç”¨æˆ·ä¸ Agent è¿›è¡Œäº† 50 è½®å¯¹è¯&lt;/li&gt;
&lt;li&gt;ä¸Šä¸‹æ–‡ token æ•°è¾¾åˆ° 180,000ï¼ˆä¸Šé™ 200,000ï¼Œä¿ç•™ 50,000ï¼‰&lt;/li&gt;
&lt;li&gt;ç³»ç»Ÿæ£€æµ‹åˆ°ï¼štoken_count + reserved &amp;gt;= max_context_size&lt;/li&gt;
&lt;li&gt;è‡ªåŠ¨è§¦å‘å‹ç¼©æµç¨‹&lt;/li&gt;
&lt;li&gt;ä¿ç•™æœ€è¿‘ 2 æ¡æ¶ˆæ¯ï¼ˆç”¨æˆ·é—®é¢˜å’Œ Agent å›ç­”ï¼‰&lt;/li&gt;
&lt;li&gt;å°†å‰ 48 è½®å¯¹è¯å‹ç¼©ä¸ºç»“æ„åŒ–æ‘˜è¦&lt;/li&gt;
&lt;li&gt;å‹ç¼©åçš„ä¸Šä¸‹æ–‡ï¼š2 æ¡å®Œæ•´æ¶ˆæ¯ + 1 æ¡å‹ç¼©æ‘˜è¦ï¼ˆçº¦ 10,000 tokensï¼‰&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;åœºæ™¯-2-å¤§é‡ä»£ç å’Œæ–‡ä»¶æ“ä½œåéœ€è¦ç»§ç»­å¯¹è¯&#34;&gt;åœºæ™¯ 2: å¤§é‡ä»£ç å’Œæ–‡ä»¶æ“ä½œåéœ€è¦ç»§ç»­å¯¹è¯&lt;/h4&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-JSON&#34; data-lang=&#34;JSON&#34;&gt;&lt;span class=&#34;err&#34;&gt;æƒ…å†µï¼šAgent&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;è¯»å–äº†å¤šä¸ªå¤§æ–‡ä»¶ã€è¿›è¡Œäº†å¤§é‡ä»£ç ä¿®æ”¹ï¼Œä¸Šä¸‹æ–‡å·²æ»¡&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;æ“ä½œï¼šè‡ªåŠ¨å‹ç¼©ï¼Œä¿ç•™å½“å‰ä»»åŠ¡çŠ¶æ€ï¼Œå‹ç¼©å†å²æ“ä½œç»†èŠ‚&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;æ•ˆæœï¼šä¿ç•™å…³é”®ä¿¡æ¯ï¼ˆé”™è¯¯ã€è§£å†³æ–¹æ¡ˆã€æœ€ç»ˆä»£ç ï¼‰ï¼Œåˆ é™¤ä¸­é—´è¿‡ç¨‹&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ç¤ºä¾‹æµç¨‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Agent è¯»å–äº† 10 ä¸ªæ–‡ä»¶ï¼ˆæ¯ä¸ª 1000 è¡Œï¼‰&lt;/li&gt;
&lt;li&gt;è¿›è¡Œäº† 20 æ¬¡ä»£ç ä¿®æ”¹å’Œè°ƒè¯•&lt;/li&gt;
&lt;li&gt;ä¸Šä¸‹æ–‡æ¥è¿‘ä¸Šé™&lt;/li&gt;
&lt;li&gt;ç³»ç»Ÿè§¦å‘å‹ç¼©&lt;/li&gt;
&lt;li&gt;å‹ç¼©æç¤ºè¯æŒ‡å¯¼ LLMï¼š&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;ä¿ç•™ï¼šå½“å‰ä»»åŠ¡çŠ¶æ€ã€é”™è¯¯å’Œè§£å†³æ–¹æ¡ˆã€æœ€ç»ˆä»£ç ç‰ˆæœ¬&lt;/li&gt;
&lt;li&gt;åˆ é™¤ï¼šä¸­é—´è°ƒè¯•è¿‡ç¨‹ã€å†—ä½™è§£é‡Š&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start=&#34;6&#34;&gt;
&lt;li&gt;å‹ç¼©ç»“æœï¼šç»“æ„åŒ–æ‘˜è¦ï¼ˆå½“å‰ç„¦ç‚¹ã€ç¯å¢ƒã€å·²å®Œæˆä»»åŠ¡ã€ä»£ç çŠ¶æ€ç­‰ï¼‰&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;åœºæ™¯-3-å¤šæ­¥éª¤ä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ä¸Šä¸‹æ–‡æº¢å‡º&#34;&gt;åœºæ™¯ 3: å¤šæ­¥éª¤ä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ä¸Šä¸‹æ–‡æº¢å‡º&lt;/h4&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-JSON&#34; data-lang=&#34;JSON&#34;&gt;&lt;span class=&#34;err&#34;&gt;æƒ…å†µï¼šå¤æ‚ä»»åŠ¡éœ€è¦å¤šæ­¥éª¤æ‰§è¡Œï¼Œæ¯æ­¥éƒ½äº§ç”Ÿå¤§é‡ä¸Šä¸‹æ–‡&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;æ“ä½œï¼šåœ¨å…³é”®æ­¥éª¤å‰è‡ªåŠ¨å‹ç¼©ï¼Œç¡®ä¿æœ‰è¶³å¤Ÿç©ºé—´ç»§ç»­æ‰§è¡Œ&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;æ•ˆæœï¼šä¿ç•™ä»»åŠ¡è¿›åº¦å’Œå…³é”®å†³ç­–ï¼Œå‹ç¼©æ‰§è¡Œç»†èŠ‚&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ç¤ºä¾‹æµç¨‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä»»åŠ¡ï¼šé‡æ„å¤§å‹é¡¹ç›®ï¼ˆéœ€è¦ 100+ æ­¥éª¤ï¼‰&lt;/li&gt;
&lt;li&gt;æ‰§è¡Œåˆ°ç¬¬ 30 æ­¥æ—¶ï¼Œä¸Šä¸‹æ–‡æ¥è¿‘ä¸Šé™&lt;/li&gt;
&lt;li&gt;ç³»ç»Ÿåœ¨ Step 31 å¼€å§‹å‰è‡ªåŠ¨å‹ç¼©&lt;/li&gt;
&lt;li&gt;ä¿ç•™ï¼šæœ€è¿‘ 2 æ¡æ¶ˆæ¯ï¼ˆå½“å‰æ­¥éª¤ï¼‰&lt;/li&gt;
&lt;li&gt;å‹ç¼©ï¼šå‰ 28 æ­¥çš„æ‰§è¡Œå†å²&lt;/li&gt;
&lt;li&gt;å‹ç¼©æ‘˜è¦åŒ…å«ï¼šå·²å®Œæˆçš„é‡æ„ä»»åŠ¡ã€é‡åˆ°çš„é”™è¯¯ã€è®¾è®¡å†³ç­–ã€å½“å‰ä»£ç çŠ¶æ€&lt;/li&gt;
&lt;li&gt;Agent ç»§ç»­æ‰§è¡Œï¼Œæœ‰è¶³å¤Ÿä¸Šä¸‹æ–‡ç©ºé—´&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;d-mailæ¶ˆæ¯å›æº¯--ä¸»åŠ¨ä¸Šä¸‹æ–‡ç®¡ç†&#34;&gt;D-Mailï¼ˆæ¶ˆæ¯å›æº¯ï¼‰- ä¸»åŠ¨ä¸Šä¸‹æ–‡ç®¡ç†&lt;/h2&gt;
&lt;h3 id=&#34;æ ¸å¿ƒç›®çš„-1&#34;&gt;æ ¸å¿ƒç›®çš„&lt;/h3&gt;
&lt;p&gt;D-Mail ç”¨äºä¸»åŠ¨ç®¡ç†ä¸Šä¸‹æ–‡çª—å£ï¼Œå½“ Agent å‘ç°ä¸Šä¸‹æ–‡ä¸­æœ‰å¤§é‡ä¸ç›¸å…³ä¿¡æ¯æ—¶ï¼Œå¯ä»¥å›æ»šåˆ°ä¹‹å‰çš„ checkpointï¼Œå¹¶ç”¨ä¸€æ¡ç²¾ç®€æ¶ˆæ¯æ›¿æ¢ä¸­é—´çš„å¤šæ¡æ¶ˆæ¯ã€‚&lt;/p&gt;
&lt;h3 id=&#34;è§¦å‘æµç¨‹-1&#34;&gt;è§¦å‘æµç¨‹&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;Agent ä¸»åŠ¨è°ƒç”¨ SendDMail å·¥å…·&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;éœ€è¦ Agent åˆ¤æ–­ä¸Šä¸‹æ–‡ä¸­æœ‰å†—ä½™ä¿¡æ¯&lt;/li&gt;
&lt;li&gt;éœ€è¦ Agent è¯†åˆ«åˆ°åˆé€‚çš„ checkpoint&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;å·¥å…·æ‰§è¡ŒæˆåŠŸ&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;å·¥å…·æœªè¢«ç”¨æˆ·æ‹’ç»&lt;/li&gt;
&lt;li&gt;Checkpoint ID æœ‰æ•ˆ&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;å½“å‰ Step å®Œæˆ&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;æ‰€æœ‰å·¥å…·è°ƒç”¨å®Œæˆ&lt;/li&gt;
&lt;li&gt;ä¸Šä¸‹æ–‡å·²æ›´æ–°&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;å…¸å‹ä½¿ç”¨åœºæ™¯-1&#34;&gt;å…¸å‹ä½¿ç”¨åœºæ™¯&lt;/h3&gt;
&lt;h4 id=&#34;åœºæ™¯-1-è¯»å–å¤§æ–‡ä»¶åå‘ç°å†…å®¹ä¸ç›¸å…³&#34;&gt;åœºæ™¯ 1: è¯»å–å¤§æ–‡ä»¶åå‘ç°å†…å®¹ä¸ç›¸å…³&lt;/h4&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-JSON&#34; data-lang=&#34;JSON&#34;&gt;&lt;span class=&#34;err&#34;&gt;æƒ…å†µï¼šAgent&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;è¯»å–äº†ä¸€ä¸ªå¾ˆå¤§çš„æ–‡ä»¶ï¼Œä½†å‘ç°å¤§éƒ¨åˆ†å†…å®¹ä¸å½“å‰ä»»åŠ¡æ— å…³&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;æ“ä½œï¼šå‘é€&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;D-Mail&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;åˆ°è¯»å–æ–‡ä»¶ä¹‹å‰çš„&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;checkpoint&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;å†…å®¹ï¼šåªå‘Šè¯‰&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;è¿‡å»çš„è‡ªå·±&amp;#34;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;æ–‡ä»¶ä¸­ä¸ä»»åŠ¡ç›¸å…³çš„å…³é”®ä¿¡æ¯&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;æ•ˆæœï¼šåˆ é™¤æ–‡ä»¶è¯»å–çš„å®Œæ•´å†…å®¹ï¼Œåªä¿ç•™æœ‰ç”¨ä¿¡æ¯&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ç¤ºä¾‹æµç¨‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Checkpoint 0: ç”¨æˆ·è¦æ±‚&amp;quot;åˆ†æé¡¹ç›®ç»“æ„&amp;quot;&lt;/li&gt;
&lt;li&gt;Agent è¯»å– large_file.pyï¼ˆ5000è¡Œä»£ç ï¼‰&lt;/li&gt;
&lt;li&gt;Agent å‘ç°åªæœ‰ 50 è¡Œç›¸å…³&lt;/li&gt;
&lt;li&gt;Agent è°ƒç”¨ SendDMailï¼Œå›æ»šåˆ° Checkpoint 0&lt;/li&gt;
&lt;li&gt;D-Mail æ¶ˆæ¯ï¼š&amp;ldquo;æˆ‘è¯»å–äº† large_file.pyï¼Œåªæœ‰ç¬¬ 100-150 è¡Œä¸ä»»åŠ¡ç›¸å…³ï¼š&amp;hellip;&amp;rdquo;&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;åœºæ™¯-2-ç½‘ç»œæœç´¢ç»“æœè¿‡å¤§&#34;&gt;åœºæ™¯ 2: ç½‘ç»œæœç´¢ç»“æœè¿‡å¤§&lt;/h4&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-JSON&#34; data-lang=&#34;JSON&#34;&gt;&lt;span class=&#34;err&#34;&gt;æƒ…å†µ&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;Aï¼šæœç´¢åˆ°äº†éœ€è¦çš„ä¿¡æ¯ï¼Œä½†ç»“æœå¾ˆé•¿&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;æ“ä½œï¼šå‘é€&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;D-Mail&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;åˆ°æœç´¢ä¹‹å‰çš„&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;checkpoint&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;å†…å®¹ï¼šåªä¿ç•™æœç´¢ç»“æœä¸­çš„å…³é”®ä¿¡æ¯&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;æƒ…å†µ&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;Bï¼šæœç´¢æ²¡æœ‰æ‰¾åˆ°éœ€è¦çš„ä¿¡æ¯&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;æ“ä½œï¼šå‘é€&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;D-Mail&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;åˆ°æœç´¢ä¹‹å‰çš„&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;checkpoint&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;å†…å®¹ï¼šå‘Šè¯‰&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;è¿‡å»çš„è‡ªå·±&amp;#34;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;å°è¯•ä¸åŒçš„æœç´¢æŸ¥è¯¢&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ç¤ºä¾‹æµç¨‹ï¼ˆæƒ…å†µ Aï¼‰ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Checkpoint 1: ç”¨æˆ·è¦æ±‚&amp;quot;æŸ¥æ‰¾ Python å¼‚æ­¥ç¼–ç¨‹æœ€ä½³å®è·µ&amp;quot;&lt;/li&gt;
&lt;li&gt;Agent è°ƒç”¨ SearchWebï¼Œè¿”å› 20 æ¡ç»“æœ&lt;/li&gt;
&lt;li&gt;Agent åˆ†æåæ‰¾åˆ° 3 æ¡ç›¸å…³&lt;/li&gt;
&lt;li&gt;Agent å‘é€ D-Mail å›æ»šåˆ° Checkpoint 1&lt;/li&gt;
&lt;li&gt;D-Mail æ¶ˆæ¯ï¼š&amp;ldquo;æˆ‘æœç´¢äº†ç½‘ç»œï¼Œä»¥ä¸‹æ˜¯ 3 æ¡ç›¸å…³çš„æœ€ä½³å®è·µï¼š&amp;hellip;&amp;rdquo;&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;åœºæ™¯-3-ä»£ç è°ƒè¯•è¿‡ç¨‹å†—é•¿ä¸”ä¸ç›¸å…³&#34;&gt;åœºæ™¯ 3: ä»£ç è°ƒè¯•è¿‡ç¨‹å†—é•¿ä¸”ä¸ç›¸å…³&lt;/h4&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-JSON&#34; data-lang=&#34;JSON&#34;&gt;&lt;span class=&#34;err&#34;&gt;æƒ…å†µï¼šå†™äº†ä¸€æ®µä»£ç ï¼Œä½†æœ‰é—®é¢˜ï¼Œç»è¿‡å¾ˆå¤šæ­¥éª¤æ‰ä¿®å¤&lt;/span&gt;
      &lt;span class=&#34;err&#34;&gt;è¿™äº›è°ƒè¯•è¿‡ç¨‹å¯¹æœ€ç»ˆç›®æ ‡ä¸é‡è¦&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;æ“ä½œï¼šå‘é€&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;D-Mail&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;åˆ°å†™ä»£ç ä¹‹å‰çš„&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;checkpoint&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;å†…å®¹ï¼šå‘Šè¯‰&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;è¿‡å»çš„è‡ªå·±&amp;#34;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;æœ€ç»ˆçš„æ­£ç¡®ä»£ç ç‰ˆæœ¬ï¼Œå¹¶è¯´æ˜å·²ç»å†™å…¥æ–‡ä»¶ç³»ç»Ÿ&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;æ•ˆæœï¼šåˆ é™¤æ‰€æœ‰è°ƒè¯•æ­¥éª¤ï¼Œåªä¿ç•™æœ€ç»ˆç»“æœ&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ç¤ºä¾‹æµç¨‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Checkpoint 2: ç”¨æˆ·è¦æ±‚&amp;quot;å®ç°ä¸€ä¸ªæ’åºå‡½æ•°&amp;quot;&lt;/li&gt;
&lt;li&gt;Agent ç¼–å†™ä»£ç ï¼ˆStep 1-5ï¼‰&lt;/li&gt;
&lt;li&gt;ä»£ç æœ‰ bugï¼ŒAgent è°ƒè¯•ï¼ˆStep 6-20ï¼‰&lt;/li&gt;
&lt;li&gt;æœ€ç»ˆä¿®å¤æˆåŠŸï¼ˆStep 21ï¼‰&lt;/li&gt;
&lt;li&gt;Agent å‘é€ D-Mail å›æ»šåˆ° Checkpoint 2&lt;/li&gt;
&lt;li&gt;D-Mail æ¶ˆæ¯ï¼š&amp;ldquo;æˆ‘å·²ç»å®ç°äº†æ’åºå‡½æ•°å¹¶å†™å…¥æ–‡ä»¶ï¼Œæœ€ç»ˆç‰ˆæœ¬å¦‚ä¸‹ï¼š&amp;hellip;ï¼ˆä»£ç ï¼‰ã€‚ä¸éœ€è¦å†å†™ä¸€éäº†ã€‚&amp;rdquo;&lt;/li&gt;
&lt;/ol&gt;
</description>
        </item>
        <item>
        <title>å‘é‡æ•°æ®åº“åœ¨ RAG ä¸­çš„åº”ç”¨</title>
        <link>http://nixum.cc/p/%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9C%A8-rag-%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/</link>
        <pubDate>Sat, 22 Jun 2024 00:00:00 +0000</pubDate>
        
        <guid>http://nixum.cc/p/%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9C%A8-rag-%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/</guid>
        <description>&lt;p&gt;[TOC]&lt;/p&gt;
&lt;h2 id=&#34;ä¸€ç†è§£å‡ ä¸ªåŸºæœ¬æ¦‚å¿µ&#34;&gt;ä¸€ã€ç†è§£å‡ ä¸ªåŸºæœ¬æ¦‚å¿µ&lt;/h2&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.bilibili.com/video/BV1CVAUeuECE?spm_id_from=333.788.videopod.sections&amp;amp;vd_source=a870d050aec1403366ebea0f42b4cdaf&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://www.bilibili.com/video/BV1CVAUeuECE?spm_id_from=333.788.videopod.sections&amp;vd_source=a870d050aec1403366ebea0f42b4cdaf&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.bilibili.com/video/BV1smXUYSEGi/?spm_id_from=333.1387.upload.video_card.click&amp;amp;vd_source=a870d050aec1403366ebea0f42b4cdaf&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://www.bilibili.com/video/BV1smXUYSEGi/?spm_id_from=333.1387.upload.video_card.click&amp;vd_source=a870d050aec1403366ebea0f42b4cdaf&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.bilibili.com/video/BV1bfoQYCEHC/?spm_id_from=333.1387.upload.video_card.click&amp;amp;vd_source=a870d050aec1403366ebea0f42b4cdaf&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://www.bilibili.com/video/BV1bfoQYCEHC/?spm_id_from=333.1387.upload.video_card.click&amp;vd_source=a870d050aec1403366ebea0f42b4cdaf&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.bilibili.com/video/BV1CpAnebEpJ/?spm_id_from=333.1387.upload.video_card.click&amp;amp;vd_source=a870d050aec1403366ebea0f42b4cdaf&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://www.bilibili.com/video/BV1CpAnebEpJ/?spm_id_from=333.1387.upload.video_card.click&amp;vd_source=a870d050aec1403366ebea0f42b4cdaf&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;äºŒgptçš„å±€é™æ€§&#34;&gt;äºŒã€GPTçš„å±€é™æ€§&lt;/h2&gt;
&lt;p&gt;è™½ç„¶ç›®å‰ChatGPTç­‰å¤§è¯­è¨€æ¨¡å‹å·²ç»ååˆ†å¥½ç”¨äº†ï¼Œæ— è®ºæ˜¯å“åº”é€Ÿåº¦å’Œå›ç­”çš„è´¨é‡ï¼ŒåŸºæœ¬ä¸Šèƒ½è§£å†³æˆ‘ä»¬æ—¥å¸¸ä¸€äº›é—®é¢˜å’Œç®€å•çš„å·¥ä½œï¼Œä½†ä¸å¯å¦è®¤ï¼Œç›®å‰çš„å¤§è¯­è¨€æ¨¡å‹ä»ç„¶æœ‰å¾ˆå¤šç¼ºé™·ï¼Œæ¯”å¦‚ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å›ç­”å¹»è§‰ï¼šå¤§è¯­è¨€æ¨¡å‹å›ç­”é—®é¢˜çš„æœ¬è´¨ä¸Šæ˜¯åŸºäºå…¶å·²æœ‰çš„è®­ç»ƒæ•°æ®ï¼Œ&lt;strong&gt;é¢„æµ‹&lt;/strong&gt;(æ¦‚ç‡è®¡ç®—)å‡ºå“ªäº›å¯èƒ½çš„æ–‡å­—ä½œä¸ºç­”æ¡ˆï¼Œæ‰€ä»¥éš¾å…ä¼šå‡ºç°å¼ å† ææˆ´ã€èƒ¡è¯´å…«é“çš„æƒ…å†µï¼Œç‰¹åˆ«æ˜¯åœ¨å¤§æ¨¡å‹ä¸æ“…é•¿çš„é¢†åŸŸã€‚&lt;/p&gt;
&lt;p&gt;æœ€å…¸å‹çš„æ¯”å¦‚ä½ åœ¨ ChatGPT-3.5é—®ä»–â€œè¥¿çº¢æŸ¿ç‚’é’¢ä¸çƒè¦æ€ä¹ˆåšâ€œï¼Œå®ƒä¼šååˆ†æ­£ç»çš„å›ç­”å‡ºè®©äººå“­ç¬‘ä¸å¾—çš„ç­”æ¡ˆï¼Œåˆæˆ–è€…é—®ä¸€äº›ä»£ç é—®é¢˜ï¼Œå®ƒæœ‰æ—¶ä¼šå›ç­”å‡ºä¸€äº›ä¸å­˜åœ¨çš„è¯­æ³•æˆ–è€…æ–¹æ³•çš„è°ƒç”¨ï¼Œäº§ç”Ÿä¸æ­£ç¡®çš„ç­”æ¡ˆï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¸Šä¸‹æ–‡é™åˆ¶ï¼šç”±äºç¡¬ä»¶é™åˆ¶å’Œæ¨¡å‹åº•å±‚æ¶æ„é™åˆ¶ï¼Œä¸Šä¸‹æ–‡è¶Šé•¿ï¼Œè®¡ç®—æ—¶ï¼Œå…¶å†…å­˜éœ€æ±‚ã€è®¡ç®—é‡ç­‰ä¼šå‰§å¢ï¼Œç¡¬ä»¶èµ„æºéš¾ä»¥è´Ÿè·ï¼Œå¦å¤–ï¼ŒTransformeræ¶æ„åœ¨å¤„ç†é•¿åºåˆ—æ—¶ï¼Œå¦‚æœä¿¡æ¯è·ç¦»å¤ªè¿œï¼Œä¼šå‡ºç°ä¿¡æ¯ç¨€é‡Šæˆ–ä¸¢å¤±ï¼Œå¯¼è‡´ç”Ÿæˆçš„å†…å®¹è¿è´¯æ€§å’Œå‡†ç¡®æ€§é™ä½ï¼Œå› æ­¤å¤§æ¨¡å‹éƒ½ä¼šé™åˆ¶ä¸Šä¸‹æ–‡çš„é•¿åº¦ï¼Œä»¥ä¿è¯ç”Ÿæˆçš„ç»“æœã€‚&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚Chat GPT-3.5 Turboçš„ä¸Šä¸‹æ–‡é™åˆ¶æ˜¯4K tokensï¼ˆå¤§æ¦‚3000å­—ï¼‰ï¼ŒGPT-4 Turboçš„ä¸Šä¸‹æ–‡é™åˆ¶æ˜¯128K tokensï¼ˆå¤§æ¦‚9.6ä¸‡å­—ï¼‰ï¼Œè¿™æ„å‘³ç€å…¶æœ€å¤šåªèƒ½å¤„ç†ï¼ˆè®°å¿†ï¼‰è¿™ä¹ˆå¤šå­—çš„å†…å®¹ï¼Œä¸”éšç€å¤„ç†çš„ä¸Šä¸‹æ–‡è¶Šå¤šï¼Œå“åº”é€Ÿåº¦ä¹Ÿä¼šè¶Šæ¥è¶Šæ…¢ï¼Œæˆæœ¬è¶Šæ¥è¶Šé«˜ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è®­ç»ƒçš„è¯­æ–™æ›´æ–°ä¸å¤ŸåŠæ—¶ï¼šæ¯”å¦‚Chat GPT-3.5 Turboè®­ç»ƒçš„è¯­æ–™åº“åªè®°å½•äº†2021å¹´9æœˆä¹‹å‰çš„æ•°æ®ï¼ŒGPT-4 Turboåˆ™æ˜¯2023å¹´4æœˆï¼Œè¿™æ„å‘³ç€åœ¨æ­¤ä¹‹åäº§ç”Ÿçš„æ•°æ®æ¨¡å‹æ˜¯ä¸çŸ¥é“çš„ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åœ¨æŸäº›é¢†åŸŸè¿˜ä¸å¤Ÿä¸“ä¸šï¼šæ¯”å¦‚æŸäº›å‚ç›´é¢†åŸŸçš„è®­ç»ƒè¯­æ–™å¾€å¾€æ¯”è¾ƒå°é—­ï¼Œä¸å¯¹å¤–å…¬å¼€ï¼Œåˆæˆ–è€…æ˜¯ä¼ä¸šçš„å†…éƒ¨æ•°æ®ï¼Œå¤„äºå¯¹æ•°æ®çš„å®‰å…¨æ€§çš„è€ƒé‡ï¼Œå¹¶ä¸å¸Œæœ›ä¸Šä¼ åˆ°ç¬¬ä¸‰æ–¹å¹³å°è¿›è¡Œè®­ç»ƒï¼Œå¤§æ¨¡å‹æ— æ³•è·å–è¿™äº›æ•°æ®è¿›è¡Œè®­ç»ƒï¼Œæ­¤æ—¶åªä¾èµ–é€šç”¨å¤§æ¨¡å‹çš„èƒ½åŠ›ï¼Œå›ç­”çš„è´¨é‡å°±ä¼šå¤§æ‰“æŠ˜æ‰£ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸ºäº†ä¼˜åŒ–ä¸Šè¿°é—®é¢˜ï¼Œæå‡å¤§è¯­è¨€æ¨¡å‹å›ç­”çš„è´¨é‡ï¼Œå…¶ä¸­ä¸€ç§è§£å†³æ–¹æ¡ˆå°±æ˜¯å¤–æŒ‚ä¸€ä¸ªçŸ¥è¯†åº“ï¼Œåœ¨æé—®æ—¶å…ˆæ ¹æ®é—®é¢˜ï¼Œæ£€ç´¢å‡ºç›¸å…³æ›´åŠ å‡†ç¡®ä¸”æ ¸å¿ƒçš„èµ„æ–™ï¼ŒæŒ‡å¯¼å¤§è¯­è¨€æ¨¡å‹ç”Ÿæˆæ›´åŠ å‡†ç¡®çš„ç­”æ¡ˆã€‚&lt;/p&gt;
&lt;h2 id=&#34;äºŒragçš„åŸºæœ¬åŸç†&#34;&gt;äºŒã€RAGçš„åŸºæœ¬åŸç†&lt;/h2&gt;
&lt;p&gt;ä¸‹é¢æ˜¯ä¸€ä¸ªæœ€ç®€å•çš„RAGåŸºæœ¬æµç¨‹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/rag-flow.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/rag-flow.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;h3 id=&#34;é˜¶æ®µä¸€&#34;&gt;é˜¶æ®µä¸€&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;ç»“æ„åŒ–æ•°æ®å¹¶è¿›è¡Œæ–‡æœ¬åˆ†å‰²ï¼šå°†å¤§é‡æ–‡æ¡£ï¼ˆå¯èƒ½æ˜¯pdfã€wordã€æ–‡æœ¬ã€ç½‘é¡µç­‰ç­‰ï¼‰è¿›è¡Œç»“æ„åŒ–ï¼Œç»Ÿä¸€æ•°æ®ç»“æ„ï¼Œåˆ†å‰²æˆå¤šä¸ªæ–‡æœ¬å—ï¼›&lt;/li&gt;
&lt;li&gt;å°†æ–‡æœ¬å—å‘é‡åŒ–ï¼šä½¿ç”¨Embeddingæ¨¡å‹ï¼Œå°†åˆ†å‰²åçš„æ–‡æœ¬å—è½¬æ¢æˆå‘é‡ï¼Œé€šè¿‡å‘é‡å°†ä¸åŒæ–‡æœ¬å—è¿›è¡Œå…³è”ï¼›&lt;/li&gt;
&lt;li&gt;å­˜å…¥å‘é‡æ•°æ®åº“ï¼šå°†å‘é‡ä»¥åŠå¯¹åº”çš„æ–‡æœ¬å—ï¼ˆå…ƒæ•°æ®ï¼‰ï¼Œé€‰æ‹©åˆé€‚çš„ç®—æ³•ï¼Œå­˜å…¥åˆ°å‘é‡æ•°æ®åº“ä¸­ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;é˜¶æ®µäºŒ&#34;&gt;é˜¶æ®µäºŒ&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;ç”¨æˆ·æé—®å‘é‡åŒ–ï¼šç”¨æˆ·æå‡ºé—®é¢˜æ—¶ï¼Œä½¿ç”¨é˜¶æ®µä¸€ä¸­ç›¸åŒçš„Embeddingæ¨¡å‹ï¼Œå°†é—®é¢˜è½¬æˆå‘é‡ï¼›&lt;/li&gt;
&lt;li&gt;æ£€ç´¢å¬å›ï¼šå°†é—®é¢˜è½¬æ¢åçš„å‘é‡ï¼Œåœ¨å‘é‡æ•°æ®åº“ä¸­è¿›è¡Œæ£€ç´¢ï¼Œé€‰æ‹©åˆé€‚çš„ç®—æ³•ï¼Œè®¡ç®—å‘é‡é—´çš„è·ç¦»ï¼Œå¾—åˆ°ä¸ä¹‹ç›¸ä¼¼çš„å‘é‡ä»¥åŠå¯¹åº”çš„æ–‡æœ¬å—ï¼›&lt;/li&gt;
&lt;li&gt;æç¤ºè¯å¢å¼ºï¼šå°†ç”¨æˆ·çš„é—®é¢˜ä»¥åŠä¸Šä¸€æ­¥æ£€ç´¢åˆ°çš„æ–‡æœ¬æ•°æ®ï¼Œè¿›è¡Œæç¤ºè¯ä¼˜åŒ–ï¼Œæ„å»ºå‡ºæœ€ç»ˆçš„æç¤ºè¯ï¼Œå‘é€ç»™å¤§æ¨¡å‹ï¼Œç”±å¤§æ¨¡å‹ç”Ÿæˆæœ€ç»ˆçš„ç»“æœå¹¶è¿”å›ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;æ ¸å¿ƒæ­¥éª¤&#34;&gt;æ ¸å¿ƒæ­¥éª¤&lt;/h3&gt;
&lt;p&gt;åœ¨ä¸Šé¢æ•´ä¸ªæµç¨‹ä¸­ï¼Œæœ‰å‡ ä¸ªæ ¸å¿ƒæ­¥éª¤å†³å®šäº†æœ€ç»ˆRAGçš„è´¨é‡ï¼ŒåŒ…æ‹¬åç»­çš„ä¼˜åŒ–ï¼Œä¹Ÿæ˜¯ä»è¿™ä¸‰ä¸ªæ­¥éª¤å…¥æ‰‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;æ–‡æœ¬çš„å¤„ç†å’Œç´¢å¼•ï¼šå¦‚ä½•æ›´å¥½çš„æŠŠæ–‡æœ¬æ•°æ®å­˜èµ·æ¥&lt;/p&gt;
&lt;p&gt;æ–‡æœ¬åˆ†å‰²çš„ç›®çš„ï¼Œä¸€ä¸ªæ˜¯å› ä¸ºè§£å†³å¤§æ¨¡å‹è¾“å…¥é•¿åº¦çš„é™åˆ¶ï¼Œå¦ä¸€ä¸ªåœ¨ä¿æŒè¯­ä¹‰è¿è´¯çš„åŒæ—¶ï¼Œå‡å°‘åµŒå…¥å†…å®¹çš„å™ªå£°ï¼Œæ›´åŠ æœ‰æ•ˆçš„æ£€ç´¢åˆ°ç”¨æˆ·é—®é¢˜æ›´ç›¸å…³çš„æ–‡æœ¬èµ„æ–™ï¼›&lt;/p&gt;
&lt;p&gt;æ€ä¹ˆåˆ†å‰²æ˜¯ä¸€ä¸ªå–èˆçš„é—®é¢˜ï¼Œå¦‚æœåˆ†å—å¤ªå¤§ï¼Œå¯èƒ½ä¼šå¯¼è‡´åˆ†å—åŒ…å«äº†å¤ªå¤šä¿¡æ¯ï¼Œé™ä½æ£€ç´¢çš„å‡†ç¡®æ€§ï¼Œåˆ†å—å¤ªå°åˆå¯èƒ½ä¼šä¸¢å¤±å¿…è¦çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œå¯¼è‡´æœ€ç»ˆç”Ÿæˆçš„å›ç­”ç¼ºä¹è¿è´¯æ€§æˆ–æ·±åº¦ï¼›&lt;/p&gt;
&lt;p&gt;åˆ†å‰²åçš„æ–‡æœ¬æœ€ç»ˆéœ€è¦è¢«æ£€ç´¢ï¼Œå› æ­¤éœ€è¦å°†æ–‡æœ¬è½¬æ¢ä¸ºå‘é‡ï¼Œè¿™ä¹Ÿä¾èµ–embeddingæ¨¡å‹çš„èƒ½åŠ›ï¼Œè€Œembeddingæ¨¡å‹çš„è®­ç»ƒè¯­æ–™ã€å‚æ•°çš„æ•°é‡çº§ï¼Œå†³å®šäº†è½¬æ¢å‡ºæ¥çš„å‘é‡çš„å…³è”æ€§ï¼Œæœ€ç»ˆå½±å“æ–‡æœ¬é—´çš„è¯­ä¹‰ç›¸ä¼¼åº¦ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ£€ç´¢ä¸å¬å›ï¼šå¦‚ä½•åœ¨å¤§é‡çš„æ–‡æœ¬æ•°æ®ä¸­ï¼Œæ‰¾åˆ°ä¸€å°éƒ¨åˆ†æœ‰ç”¨çš„æ•°æ®ï¼Œç»™åˆ°æ¨¡å‹å‚è€ƒ&lt;/p&gt;
&lt;p&gt;å‘é‡å’Œå¯¹åº”æ–‡æœ¬çš„å­˜å‚¨å’Œæ£€ç´¢ï¼Œåˆä¾èµ–å‘é‡æ•°æ®åº“ï¼Œéœ€è¦è§£å†³ä¸åŒæ•°é‡çº§ç»´åº¦çš„å‘é‡è¦å¦‚ä½•å­˜å‚¨ï¼Œå¦‚ä½•æ‰èƒ½å¿«é€Ÿè®¡ç®—å…¶ç›¸ä¼¼åº¦ï¼Œå¿«é€Ÿç²¾ç¡®çš„å®šä½å’Œæ£€ç´¢æ•°æ®çš„é—®é¢˜ï¼Œç”šè‡³ä¸ºäº†è¿›ä¸€æ­¥æå‡æ£€ç´¢çš„è´¨é‡ï¼Œé™¤äº†éœ€è¦æä¾›ç›¸ä¼¼åº¦æ£€ç´¢ï¼Œè¿˜éœ€è¦æä¾›ä¼ ç»Ÿçš„å…³é”®å­—æ£€ç´¢ç­‰ï¼›&lt;/p&gt;
&lt;p&gt;å•çº¯çš„å‘é‡å¬å›å­˜åœ¨ç²¾åº¦é—®é¢˜ï¼Œå› æ­¤å¯èƒ½éœ€è¦å¤šç§å¬å›çš„æ–¹å¼ï¼Œæ¯”å¦‚åˆ†è¯å¬å›ã€å›¾è°±å¬å›ç­‰ï¼Œå¯¹äºå¬å›å‡ºæ¥çš„æ•°æ®ï¼Œå¯èƒ½è¿˜éœ€è¦è¿›ä¸€æ­¥çš„å¤„ç†ï¼Œè¿›è¡Œå„ç§å»é‡ã€åˆå¹¶å’Œé‡æ’ç­‰ï¼Œæ£€ç´¢å‡ºåˆ°æ›´åŠ ç²¾ç¡®çš„æ•°æ®ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å†…å®¹çš„ç”Ÿæˆï¼šå¦‚ä½•è®©å¤§æ¨¡å‹ç”Ÿæˆæ›´æœ‰ç”¨çš„ç­”æ¡ˆ&lt;/p&gt;
&lt;p&gt;é€šè¿‡æç¤ºè¯ä¼˜åŒ–ï¼ŒæŒ‡å¯¼å¤§æ¨¡å‹å¦‚ä½•åˆ©ç”¨è¿™äº›æ£€ç´¢å‡ºæ¥çš„æ•°æ®ï¼Œå¦‚ä½•æ’é™¤æ— å…³çš„æ•°æ®ï¼Œå¦‚ä½•æ›´å¥½çš„å›ç­”é—®é¢˜ç­‰ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/RAG%e6%a0%b8%e5%bf%83%e6%b5%81%e7%a8%8b.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/RAG%e6%a0%b8%e5%bf%83%e6%b5%81%e7%a8%8b.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;h2 id=&#34;ä¸‰ä¸ºä»€ä¹ˆè¦ä½¿ç”¨å‘é‡æ•°æ®åº“&#34;&gt;ä¸‰ã€ä¸ºä»€ä¹ˆè¦ä½¿ç”¨å‘é‡æ•°æ®åº“&lt;/h2&gt;
&lt;p&gt;æˆ–è®¸ä½ å¯èƒ½ä¼šç–‘æƒ‘ï¼Œå¦‚æœç”¨ä¼ ç»Ÿæ•°æ®åº“æˆ–è€…esç­‰æœç´¢å‡ºå…³è”çš„ä¿¡æ¯ï¼Œå†è·Ÿç€é—®é¢˜ä¸€èµ·å‘é€ç»™å¤§è¯­è¨€æ¨¡å‹ï¼Œä¹Ÿèƒ½å®ç°ç±»ä¼¼çš„æ•ˆæœï¼Œè¿™æ ·è¡Œä¸è¡Œï¼Ÿç­”æ¡ˆå½“ç„¶æ˜¯å¯ä»¥ï¼Œä½†å®ƒä¸æ˜¯æœ€ä¼˜çš„ï¼Œå‡ºæ¥çš„æ•ˆæœä¹Ÿå¹¶ä¸å¥½ï¼ŒåŸå› åœ¨äºä¼ ç»Ÿæ•°æ®åº“çš„æœç´¢åŠŸèƒ½éƒ½æ˜¯åŸºäºå…³é”®å­—æœç´¢ï¼Œåªèƒ½åŒ¹é…å‡ºå¯¹åº”çš„æ–‡æœ¬ï¼Œè¯­ä¹‰ä¸Šçš„è”ç³»å…¶å®éå¸¸å¼±ã€‚&lt;/p&gt;
&lt;p&gt;ä¼ ç»Ÿæ•°æ®åº“éƒ½æ˜¯åŸºäºB+æ ‘æˆ–è€…åˆ†è¯+å€’æ’ç´¢å¼•çš„æ–¹å¼è¿›è¡Œå…³é”®å­—åŒ¹é…å’Œæ’åºï¼Œå¾—åˆ°æœ€ç»ˆç»“æœï¼Œä¾‹å¦‚ï¼Œé€šè¿‡ä¼ ç»Ÿæ•°æ®åº“æœç´¢â€å¸ƒå¶çŒ«â€œï¼Œåªèƒ½åŒ¹é…å¾—åˆ°å¸¦æœ‰â€é“¶æ¸å±‚â€œè¿™ä¸ªå…³é”®å­—ç›¸å…³çš„ç»“æœï¼Œæ— æ³•å¾—åˆ°â€é“¶æ¸å±‚â€œã€â€è“çŒ«â€œç­‰ç»“æœï¼Œå› ä¸ºä»–ä»¬æ˜¯ä¸åŒçš„è¯ï¼Œä¼ ç»Ÿæ•°æ®åº“æ— æ³•è¯†åˆ«ä»–ä»¬çš„è¯­ä¹‰å…³ç³»ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/rag-%e7%bb%b4%e5%ba%a61.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/rag-%e7%bb%b4%e5%ba%a61.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;è€Œå‘é‡æ•°æ®åº“æ˜¯åŸºäºå‘é‡æœç´¢çš„ï¼Œéœ€è¦æˆ‘ä»¬äº‹å…ˆå°†â€è“çŒ«â€œï¼Œâ€é“¶æ¸å±‚â€œï¼Œâ€å¸ƒå¶â€œï¼Œæ ¹æ®ä»–ä»¬çš„ç‰¹å¾æ¯”å¦‚å¤§å°ã€æ¯›å‘é•¿çŸ­ã€é¢œè‰²ã€ä¹ æ€§ã€è„¸å‹ç­‰ç»´åº¦ï¼Œè®¡ç®—å‡ºä¸€ç»„æ•°å­—åä½œä¸ºä»–ä»¬çš„ä»£è¡¨è¿›è¡Œå­˜å‚¨ï¼ˆè¿™ç»„æ•°å­—ä¹Ÿè¢«ç§°ä¸ºå‘é‡ï¼‰ï¼Œåªè¦åˆ†è§£çš„ç»´åº¦è¶³å¤Ÿå¤šï¼Œå°±èƒ½å°†æ‰€æœ‰çŒ«åŒºåˆ†å‡ºæ¥ï¼Œç„¶åé€šè¿‡è®¡ç®—å‘é‡é—´çš„è·ç¦»æ¥åˆ¤æ–­ä»–ä»¬çš„ç›¸ä¼¼åº¦ï¼Œäº§ç”Ÿè¯­ä¹‰ä¸Šçš„è”ç³»ï¼›&lt;/p&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/rag-%e7%bb%b4%e5%ba%a62.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/rag-%e7%bb%b4%e5%ba%a62.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;å‘é‡æ•°æ®åº“å¹¶ä¸æ˜¯ä»€ä¹ˆç‰¹åˆ«æ–°çš„æŠ€æœ¯ï¼Œæ—©åœ¨æœºå™¨å­¦ä¹ åœºæ™¯ä¸­å°±æœ‰å¹¿æ³›åº”ç”¨ï¼Œæ¯”å¦‚äººè„¸è¯†åˆ«ã€ä»¥å›¾æœå›¾ã€éŸ³ä¹è½¯ä»¶çš„å¬éŸ³è¯†æ›²ç­‰éƒ½æœ‰åº”ç”¨åˆ°ï¼Œåªæ˜¯æœ€è¿‘è¢«å¤§æ¨¡å‹å¸¦ç«äº†ä¸€æŠŠã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å‘é‡æ•°æ®åº“ç”¨ä¸“é—¨çš„æ•°æ®ç»“æ„å’Œç®—æ³•æ¥å¤„ç†å‘é‡ä¹‹é—´çš„ç›¸ä¼¼æ€§è®¡ç®—å’ŒæŸ¥è¯¢ã€‚ é€šè¿‡æ„å»ºç´¢å¼•ç»“æ„ï¼Œå‘é‡æ•°æ®åº“å¯ä»¥å¿«é€Ÿæ‰¾åˆ°æœ€ç›¸ä¼¼çš„å‘é‡ï¼Œä»¥æ»¡è¶³å„ç§åº”ç”¨åœºæ™¯ä¸­çš„æŸ¥è¯¢éœ€æ±‚ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä¸Šé¢æ˜¯AWSä¸Šæ‰¾åˆ°çš„å¯¹å‘é‡æ•°æ®åº“çš„æè¿°ï¼Œåœ¨RAGçš„åœºæ™¯ä¸‹ï¼Œå‘é‡æ•°æ®åº“çš„æ ¸å¿ƒä½œç”¨ï¼Œå°±æ˜¯å°†ç”¨æˆ·å‡†å¤‡å¥½çš„å¼ºç›¸å…³æ€§çš„æ–‡æœ¬è½¬æˆå‘é‡ï¼Œå­˜å‚¨åˆ°æ•°æ®åº“ä¸­ï¼Œå½“ç”¨æˆ·è¾“å…¥é—®é¢˜æ—¶ï¼Œä¹Ÿå°†é—®é¢˜è½¬æˆå‘é‡ï¼Œç„¶ååœ¨æ•°æ®åº“ä¸­è¿›è¡Œ&lt;strong&gt;ç›¸ä¼¼æ€§æœç´¢&lt;/strong&gt;ï¼Œæ‰¾åˆ°ç›¸å…³è”çš„å‘é‡å’Œä¸Šä¸‹æ–‡ï¼Œè¿›è€Œæ‰¾åˆ°å¯¹åº”çš„æ–‡æœ¬ï¼Œæœ€åè·Ÿç€é—®é¢˜ä¸€èµ·å‘é€ç»™å¤§è¯­è¨€æ¨¡å‹ï¼Œä»è€Œè¾¾åˆ°å‡å°‘æ¨¡å‹çš„è®¡ç®—é‡ï¼Œæå‡ç†è§£èƒ½åŠ›å’Œå“åº”é€Ÿåº¦ï¼Œé™ä½æˆæœ¬ï¼Œç»•è¿‡tokensé™åˆ¶ï¼Œæé«˜å›ç­”è´¨é‡çš„ç›®çš„ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å››å‘é‡æ•°æ®åº“çš„æ ¸å¿ƒè¦ç‚¹&#34;&gt;å››ã€å‘é‡æ•°æ®åº“çš„æ ¸å¿ƒè¦ç‚¹&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;å°†äº‹ç‰©æ ¹æ®ç‰¹å¾è½¬æ¢ä¸ºä¸åŒç»´åº¦çš„å‘é‡çš„è¿‡ç¨‹ï¼Œå°±å«åš&lt;strong&gt;vector embeddingå‘é‡åµŒå…¥&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;é€šè¿‡è®¡ç®—å¤šä¸ªå‘é‡ä¹‹é—´çš„è·ç¦»æ¥åˆ¤æ–­å®ƒä»¬çš„ç›¸ä¼¼åº¦ï¼Œå°±å«åš&lt;strong&gt;similarity searchç›¸ä¼¼æ€§æœç´¢&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿™ä¸¤ä¸ªæ­¥éª¤ï¼Œéƒ½å†³å®šç€æœç´¢è´¨é‡çš„å¥½åã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ–‡æœ¬åˆ†å‰²ä¸å‘é‡åµŒå…¥&#34;&gt;æ–‡æœ¬åˆ†å‰²ä¸å‘é‡åµŒå…¥&lt;/h3&gt;
&lt;p&gt;ä»¥å¤§è¯­è¨€æ¨¡å‹å¯¹è¯çš„åœºæ™¯æ¥è¯´ï¼Œæ¶‰åŠçš„è¯­æ–™å°±æ˜¯å¤§é‡çš„æ–‡æœ¬äº†ï¼Œè€Œæ–‡æœ¬åŒ…å«çš„ç‰¹å¾å¯ä»¥æ˜¯è¯æ±‡ã€è¯­æ³•ã€è¯­ä¹‰ã€æƒ…æ„Ÿã€æƒ…ç»ªã€ä¸»é¢˜ã€ä¸Šä¸‹æ–‡ç­‰ç­‰ï¼Œè¿™äº›ç‰¹å¾å¤ªå¤šäº†ï¼Œå¯èƒ½éœ€è¦å‡ ç™¾ä¸Šåƒä¸ªç‰¹å¾æ‰èƒ½åŒºåˆ†å‡ºä¸€æ®µæ–‡æœ¬è¡¨è¾¾çš„å«ä¹‰ï¼Œå¾ˆéš¾è¿›è¡Œäººä¸ºçš„æ ‡æ³¨ï¼Œå› æ­¤éœ€è¦æœ‰ä¸€ç§è‡ªåŠ¨åŒ–çš„æ–¹å¼æ¥æå–è¿™äº›ç‰¹å¾ï¼Œè¿™å°±å¯ä»¥é€šè¿‡ vector embeddingæ¥å®ç°ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ä¸€æ­¥å…¶å®å¹¶ä¸å±äºå‘é‡æ•°æ®åº“çš„åŠŸèƒ½ï¼Œæ›´åƒæ˜¯æ•°æ®å…¥åº“å‰çš„å‰ç½®æ“ä½œï¼Œå‘é‡æ•°æ®åº“æœ¬äº‹åªæä¾›å­˜å‚¨å‘é‡å’Œæœç´¢çš„åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;p&gt;ç°åœ¨å¸¸ç”¨çš„å¤§è¯­è¨€æ¨¡å‹ï¼ŒåŸºæœ¬éƒ½æä¾›äº†embeddingæ¥å£ï¼Œä¾›ç”¨æˆ·æŠŠæ–‡æœ¬è½¬æ¢ä¸ºå‘é‡ï¼Œæ¯”å¦‚ OpenAIçš„text-embedding-ada-002æ¨¡å‹å¯ä»¥æŠŠæ–‡æœ¬åˆ†è§£æˆ1536ç»´çš„å‘é‡ï¼Œç½‘æ˜“çš„bce-embedding-base_v1æ¨¡å‹ï¼Œå¯ä»¥æŠŠæ–‡æœ¬åˆ†è§£ä¸º768ç»´çš„å‘é‡ç­‰ç­‰ï¼Œå…·ä½“æ’åå¯ä»¥å‚è€ƒ&lt;a class=&#34;link&#34; href=&#34;https://huggingface.co/spaces/mteb/leaderboard&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;HuggingFaceçš„å¤§æ–‡æœ¬åµŒå…¥æ’è¡Œ&lt;/a&gt;ï¼Œå¤šå°‘ç»´å…¶å®å°±æ˜¯ä¸€ä¸ªé•¿åº¦å¤šå°‘çš„æµ®ç‚¹ç±»å‹æ•°ç»„ï¼Œæ•°ç»„å†…çš„æ¯ä¸ªå…ƒç´ ï¼Œåˆ™ä»£è¡¨è¢«åˆ†è§£çš„æ–‡æœ¬çš„ç‰¹å¾ï¼Œå…±åŒç»„æˆä¸€ä¸ªä¿¡æ¯å¯†é›†çš„è¡¨ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;é‚£å¯¹äºç»™å®šçš„æ–‡æœ¬ï¼Œè¦å¦‚ä½•åˆ†å‰²ï¼Œä»¥åŠåˆ†è§£å‡ºå¤šå°‘ä¸ªå‘é‡åˆé€‚å‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;å¦‚æœæ–‡æœ¬åˆ†å‰²çš„ç²’åº¦æŠŠæ§ä¸å¥½ï¼Œå¯èƒ½ä¼šå¯¼è‡´åˆ†å‰²å‡ºæ¥çš„æ— ç”¨ä¿¡æ¯å¤ªå¤šï¼Œæˆ–è€…è¯­ä¹‰ä¸¢å¤±ï¼Œè¯­ä¹‰å…³è”æ€§ä¸å¤§ç­‰é—®é¢˜ã€‚å¯¹äºæ–‡æœ¬åˆ†å‰²ï¼Œè¿™é‡Œæ‰¾åˆ°äº†ä¸€ç¯‡å†™å¾—å¾ˆå¥½çš„æ–‡ç« ï¼š&lt;a class=&#34;link&#34; href=&#34;https://baoyu.io/translations/rag/5-levels-of-text-splitting&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;æ–‡æœ¬åˆ†å‰²çš„äº”ä¸ªå±‚æ¬¡&lt;/a&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç¬¬ 1 å±‚ï¼šå­—ç¬¦åˆ†å‰²ï¼Œæ¯”å¦‚æŒ‰ä¸€å®šçš„å­—ç¬¦æ•°ã€å—å¤§å°åˆ†å‰²æ–‡æœ¬ï¼Œä¸è€ƒè™‘å…¶å†…å®¹å’Œå½¢å¼ã€‚&lt;/li&gt;
&lt;li&gt;ç¬¬ 2 å±‚ï¼šåŸºäºåˆ†éš”ç¬¦åˆ†å‰²ï¼Œæ¯”å¦‚æŒ‰å¥å·ã€æ¢è¡Œç¬¦ã€ç©ºæ ¼ç­‰è¿›è¡Œæ–‡æœ¬åˆ‡å‰²ã€‚&lt;/li&gt;
&lt;li&gt;ç¬¬ 3 å±‚ï¼šæ–‡æ¡£ç±»å‹åˆ†å‰²ï¼Œæ¯”å¦‚PDFã€Markdownéƒ½æœ‰ç‰¹å®šçš„è¯­æ³•è¡¨ç¤ºè¯­ä¹‰åˆ†å‰²ï¼Œä½¿å¾—åˆ†å‰²å‡ºæ¥çš„æ–‡æœ¬å…³è”æ€§æ›´å¼ºã€‚&lt;/li&gt;
&lt;li&gt;ç¬¬ 4 å±‚ï¼šè¯­ä¹‰åˆ†å‰²ï¼Œæ¯”å¦‚æ¯ä¸‰å¥è¯è½¬æˆå‘é‡ï¼Œç„¶åå»æ‰ç¬¬ä¸€å¥ï¼ŒåŠ ä¸Šä¸‹ä¸€å¥ï¼Œå†è½¬æˆå‘é‡ï¼Œæ¯”è¾ƒä¸¤ä¸ªå‘é‡çš„è·ç¦»ï¼Œå¦‚æœè·ç¦»è¶…è¿‡ä¸€å®šçš„é˜ˆå€¼ï¼Œè¯´æ˜æ‰¾åˆ°åˆ†å‰²ç‚¹ã€‚&lt;/li&gt;
&lt;li&gt;ç¬¬ 5 å±‚ï¼šä½¿ç”¨å¤§è¯­è¨€æ¨¡å‹åˆ†å‰²ï¼Œä½¿ç”¨é€‚åˆçš„promptæŒ‡å¯¼å¤§è¯­è¨€æ¨¡å‹æ¨ç†åˆ†å‰²ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç®€å•æ¥è¯´ï¼Œæˆ‘ä»¬æ›´å€¾å‘äºæŠŠä¸Šä¸‹æ–‡å…³è”æ€§å¼ºçš„æ–‡æœ¬åˆä¸€èµ·åˆ†å‰²ï¼Œå¾—åˆ°çš„æ•´ä½“æ•ˆæœæœ€å¥½ï¼Œä¸‹é¢çš„demoï¼Œå°±æ˜¯æŒ‰ç¬¬4å±‚çš„åˆ†å‰²æ–¹å¼ï¼Œå¯ä»¥å‚è€ƒä¸€ä¸‹ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ç›¸ä¼¼æ€§æœç´¢&#34;&gt;ç›¸ä¼¼æ€§æœç´¢&lt;/h3&gt;
&lt;p&gt;å…·ä½“å¯ä»¥çœ‹è¿™ä¸ª&lt;a class=&#34;link&#34; href=&#34;https://www.bilibili.com/video/BV11a4y1c7SW&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;è§†é¢‘&lt;/a&gt;ï¼Œæœ‰ä¸Šä¸‹ä¸¤é›†ï¼Œè®²å¾—éå¸¸å®¹æ˜“ç†è§£ï¼Œè¿™é‡Œä»…ä½œç®€å•å½’çº³ã€‚&lt;/p&gt;
&lt;p&gt;ç°åœ¨æˆ‘ä»¬å·²ç»å°†æ–‡æœ¬è½¬æ¢ä¸ºå‘é‡å­˜å‚¨åœ¨å‘é‡æ•°æ®åº“ä¸­ï¼Œå¦‚æœæƒ³è¦åœ¨æµ·é‡çš„æ•°æ®é‡Œæ‰¾åˆ°æŸä¸ªç›¸ä¼¼çš„å‘é‡ï¼Œè®¡ç®—é‡ä¼šéå¸¸å¤§ï¼Œå› æ­¤éœ€è¦ä¸€ç§é«˜æ•ˆçš„ç®—æ³•æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œç±»æ¯”åˆ°ä¼ ç»Ÿæ•°æ®åº“ï¼Œå°±æ˜¯é€šè¿‡B+æ ‘å»ºç«‹ç´¢å¼•è¿›è¡ŒæŸ¥æ‰¾ï¼Œæœ¬è´¨éƒ½æ˜¯å‡å°‘æŸ¥è¯¢èŒƒå›´ï¼Œä»è€Œå¿«é€Ÿæ‰¾åˆ°ç»“æœã€‚&lt;/p&gt;
&lt;p&gt;åœ¨å‘é‡æ•°æ®åº“ä¸­æœ‰ä¸¤ç§ä¸»è¦çš„æœç´¢æ–¹å¼ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å‡å°‘å‘é‡å¤§å°ï¼Œå¯¹å‘é‡é™ç»´ï¼›&lt;/li&gt;
&lt;li&gt;å‡å°‘æœç´¢èŒƒå›´ï¼Œé€šè¿‡èšç±»æˆ–è€…å°†å‘é‡ç»„ç»‡æˆæ ‘å½¢ã€å›¾å½¢ç»“æ„å®ç°ï¼Œé™åˆ¶æœç´¢èŒƒå›´åªåœ¨ç‰¹å®šçš„èšç±»ä¸­è¿‡æ»¤ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;è¿™é‡Œç®€å•ä»‹ç»å‡ ç§ç®—æ³•ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;K-Meansï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åœ¨ä¿å­˜å‘é‡æ•°æ®åï¼Œå¯¹å‘é‡æ•°æ®å…ˆè¿›è¡Œèšç±»ï¼ˆæ¯”å¦‚éšæœºé€‰æ‹©æŸå‡ ä¸ªç‚¹ï¼‰ï¼Œç„¶åå°†è¿™å‡ ä¸ªç‚¹æœ€è¿‘çš„å‘é‡åˆ†é…åˆ°è¿™ä¸ªèšç±»ä¸­ï¼Œç„¶åä¸æ–­è°ƒæ•´èšç±»çš„è´¨å¿ƒï¼Œå½¢æˆä¸åŒçš„ç°‡ï¼Œè¿™æ ·ï¼Œæ¯æ¬¡æœç´¢æ—¶ï¼Œåªè¦å…ˆåˆ¤æ–­è¦æœç´¢çš„å‘é‡å±äºå“ªä¸ªç°‡ï¼Œç„¶åå†åœ¨ç°‡ä¸­è¿›è¡Œæœç´¢ï¼Œä»è€Œå‡å°‘æœç´¢èŒƒå›´ã€‚å¦‚æœè¦æœç´¢çš„å‘é‡åˆšå¥½å¤„åœ¨ä¸¤ä¸ªèšç±»çš„è¾¹ç•Œä¸Šï¼Œåˆ™åªèƒ½åŠ¨æ€è°ƒæ•´æœç´¢èŒƒå›´ï¼Œæœç´¢å…¶ä»–ç°‡&lt;/p&gt;
&lt;p&gt;å¦‚ä¸‹å›¾ï¼Œåœ¨ä¸€ä¸ªäºŒç»´åæ ‡ç³»ä¸­åˆ’å®š4ä¸ªèšç±»ä¸­å¿ƒï¼Œå½¢æˆ4ä¸ªç°‡ï¼›&lt;/p&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/rag-%e7%b0%87.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/rag-%e7%b0%87.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç§¯é‡åŒ–Product Quantizationï¼ŒPQï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;éšç€æ•°æ®è§„æ¨¡çš„å¢å¤§å’Œç»´åº¦çš„å¢åŠ ï¼Œæ•°æ®ç‚¹é—´çš„è·ç¦»ä¹Ÿä¼šå‘ˆæŒ‡æ•°çº§å¢é•¿ï¼Œèšç±»ç®—æ³•éœ€è¦åˆ†å‰²æ›´å¤šçš„èšç±»ï¼ˆå¦åˆ™ä¼šå¯¼è‡´å‘é‡å’Œè‡ªå·±èšç±»çš„ä¸­å¿ƒè·ç¦»å¤ªè¿œï¼Œé™ä½æœç´¢é€Ÿåº¦å’Œè´¨é‡ï¼‰ï¼Œè€Œä¸”æ¶ˆè€—çš„å†…å­˜ä¹Ÿä¼šå¢åŠ ï¼Œè§£å†³è¿™ä¸ªé—®é¢˜çš„æ–¹æ³•æ˜¯å°†å‘é‡åˆ†è§£ä¸ºå¤šä¸ªå­å‘é‡ï¼Œç„¶åå†å¯¹æ¯ä¸ªå­å‘é‡ç‹¬ç«‹è¿›è¡Œé‡åŒ–ï¼ˆé‡åŒ–çš„æ„æ€å°±æ˜¯é€šè¿‡è´¨å¿ƒè¿›è¡Œç¼–å·å½¢æˆç æœ¬ï¼Œåœ¨æ­¤èšç±»ä¸­çš„å‘é‡éƒ½å¯¹åº”è¿™ä¸ªç¼–å·ï¼Œä»è€Œä¸ç”¨å­˜å‚¨å®Œæ•´å‘é‡ï¼‰ï¼Œä»è€Œå®ç°é™ç»´ï¼Œä½†ä»£ä»·å°±æ˜¯æœç´¢çš„è´¨é‡ä¼šä¸‹é™ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚ä¸‹å›¾ï¼Œåœ¨ä¸€ä¸ªäºŒç»´çš„åæ ‡ç³»ä¸­çš„å››ä¸ªèšç±»ï¼Œæ¯ä¸ªèšç±»ä¸­çš„å‘é‡éƒ½ç”¨è´¨å¿ƒå‘é‡æ¥æ›¿ä»£è¡¨ç¤ºï¼Œè¿™æ ·å°±åªå‰©ä¸‹4ä¸ªå‘é‡äº†ï¼Œç„¶ååªè¦ç»´æŠ¤å¥½è¿™4ä¸ªå‘é‡å½¢æˆçš„ç æœ¬ï¼Œå°±èƒ½æå¤§çš„é™ä½å†…å­˜å¼€é”€ã€‚(ç æœ¬çš„ä½œç”¨æ˜¯è®°å½•åŸå§‹å‘é‡å¯¹è´¨å¿ƒçš„æ˜ å°„ï¼Œæœ‰ç‚¹ç±»ä¼¼æ“ä½œç³»ç»Ÿä¸­çš„å†…å­˜å¤šçº§åˆ†é¡µç®—æ³•)&lt;/p&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/rag-%e8%81%9a%e7%b1%bb1.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/rag-%e8%81%9a%e7%b1%bb1.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/rag-%e8%81%9a%e7%b1%bb2.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/rag-%e8%81%9a%e7%b1%bb2.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;å½“å‘é‡çš„ç»´åº¦è¶Šé«˜ï¼Œå‘é‡åˆ†å¸ƒè¶Šç¨€ç–ï¼Œå½¢æˆçš„èšç±»ä¹Ÿå°±è¶Šå¤šï¼Œå•çº¯æ ¹æ®è´¨å¿ƒæ„å»ºç æœ¬çš„æ–¹å¼ä¼šå¯¼è‡´ç æœ¬çš„å­˜å‚¨å¼€é”€è¶Šæ¥è¶Šå¤§ï¼Œæ¯”å¦‚ä¸€ä¸ª128ç»´çš„å‘é‡ç©ºé—´ï¼Œå¦‚æœç›´æ¥æŒ‰èšç±»åˆ†éœ€è¦åˆ†ä¸º2^64ä¸ªè´¨å¿ƒæ‰èƒ½ä¿è¯æœç´¢è´¨é‡ï¼Œæ­¤æ—¶çš„è´¨å¿ƒç¼–ç å’Œå‘é‡å€¼çš„ç æœ¬çš„å†…å­˜æ¶ˆè€—å°†å·¨å¤§ï¼Œç”šè‡³å¤§äºé‡åŒ–æœ¬èº«æ‰€èŠ‚çœä¸‹æ¥çš„å†…å­˜ï¼›&lt;/p&gt;
&lt;p&gt;æ­¤æ—¶å°±éœ€è¦é™ç»´ï¼Œå°†128ç»´çš„å‘é‡åˆ†æˆ8ä¸ª16ç»´çš„å­å‘é‡ï¼Œå†å¯¹8ä¸ª16ç»´çš„å­ç©ºé—´ä¸­è¿›è¡Œk-meansèšç±»è®­ç»ƒï¼Œä»è€Œé™ä½èšç±»çš„æ•°é‡ï¼Œæ­¤æ—¶ä¸€ä¸ªå‘é‡è¢«é‡åŒ–ä¸º8ä¸ªç¼–ç å€¼ï¼ŒåŒæ—¶æ¯ä¸ªå­ç©ºé—´ä¹Ÿä¼šæ„å»ºè‡ªå·±çš„å­ç æœ¬ï¼ˆæ­¤æ—¶åªéœ€è¦ä¿å­˜è¿™8ä¸ªå­ç æœ¬å³å¯ï¼‰ï¼Œä½¿ç”¨æ—¶ç”¨8ä¸ªç¼–ç å€¼åˆ†åˆ«ä»å¯¹åº”çš„å­ç æœ¬ä¸­æŸ¥è¯¢å‡º8ä¸ª16ç»´çš„å­å‘é‡å†æ‹¼èµ·æ¥å¤åŸå‡ºä¸€ä¸ª128ç»´çš„å‘é‡ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/rag-%e9%99%8d%e7%bb%b41.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/rag-%e9%99%8d%e7%bb%b41.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/rag-%e9%99%8d%e7%bb%b42.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/rag-%e9%99%8d%e7%bb%b42.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å±€éƒ¨æ•æ„Ÿå“ˆå¸ŒLocality Sensitive Hashingï¼ŒLSH&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¯ä»¥ç†è§£ä¸ºåå‘å“ˆå¸Œï¼Œä»¥å¾€æˆ‘ä»¬éƒ½æœŸæœ›å¾€å“ˆå¸Œè¡¨é‡Œæ·»åŠ æ•°æ®ï¼Œéƒ½æœŸæœ›å‡å°‘å“ˆå¸Œç¢°æ’çš„æ¬¡æ•°ï¼Œå³æ¡¶ä¸Šçš„æ•°æ®è¶Šå°‘è¶Šå¥½ï¼Œè¿™æ ·æ–¹ä¾¿æˆ‘ä»¬å¿«é€Ÿæ‰¾åˆ°å¯¹åº”çš„valueï¼Œä½†æ˜¯åœ¨å‘é‡æœç´¢ä¸­ï¼Œå› ä¸ºæ˜¯ä¸ºäº†æ‰¾åˆ°ç›¸ä¼¼çš„å‘é‡ï¼Œæ‰€ä»¥æˆ‘ä»¬æœŸæœ›å“ˆå¸Œç¢°æ’çš„æ¬¡æ•°å°½å¯èƒ½çš„é«˜ï¼Œè¿™æ ·ç›¸ä¼¼çš„å‘é‡éƒ½ä¼šè½åœ¨ä¸€ä¸ªæ¡¶ä¸Šã€‚&lt;/p&gt;
&lt;p&gt;è¿™äº›ç®—æ³•æœ¬èº«å°±åœ¨æŸ¥è¯¢é€Ÿåº¦ã€æŸ¥è¯¢è´¨é‡ã€å†…å­˜å¼€é”€ä¸Šè¿›è¡Œå–èˆï¼Œåšå‡ºä¸€ä¸ªæƒè¡¡ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ç›¸ä¼¼æ€§åº¦é‡&#34;&gt;ç›¸ä¼¼æ€§åº¦é‡&lt;/h3&gt;
&lt;p&gt;åˆ¤æ–­ä¸¤ä¸ªå‘é‡æ˜¯å¦ç›¸ä¼¼ï¼Œå…¶å®å°±æ˜¯è®¡ç®—å‡ºä¸¤ä¸ªå‘é‡é—´çš„è·ç¦»ï¼Œæ ¹æ®è·ç¦»æ¥åˆ¤æ–­ä»–ä»¬çš„ç›¸ä¼¼åº¦ï¼Œå¸¸è§çš„æœ‰ä¸‰ç§ç›¸ä¼¼åº¦ç®—æ³•ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ¬§å‡ é‡Œå¾—è·ç¦»ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ¬§å‡ é‡Œå¾—è·ç¦»æ˜¯æŒ‡ä¸¤ä¸ªå‘é‡ä¹‹é—´çš„è·ç¦»ï¼Œå®ƒçš„è®¡ç®—å…¬å¼ä¸ºï¼šğ‘‘(ğ´,ğµ)=âˆ‘ğ‘–=1ğ‘›(ğ´ğ‘–âˆ’ğµğ‘–)2&lt;em&gt;d&lt;/em&gt;(&lt;strong&gt;A&lt;/strong&gt;,&lt;strong&gt;B&lt;/strong&gt;)=&lt;em&gt;i&lt;/em&gt;=1âˆ‘&lt;em&gt;n&lt;/em&gt;(&lt;em&gt;Ai&lt;/em&gt;âˆ’&lt;em&gt;Bi&lt;/em&gt;)2&lt;/p&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/rag-%e6%ac%a7%e5%87%a0%e9%87%8c%e5%be%97.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/rag-%e6%ac%a7%e5%87%a0%e9%87%8c%e5%be%97.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;æ¬§å‡ é‡Œå¾—è·ç¦»ç®—æ³•çš„ä¼˜ç‚¹æ˜¯å¯ä»¥åæ˜ å‘é‡çš„ç»å¯¹è·ç¦»ï¼Œé€‚ç”¨äºéœ€è¦è€ƒè™‘å‘é‡é•¿åº¦çš„ç›¸ä¼¼æ€§è®¡ç®—ã€‚ä¾‹å¦‚æ¨èç³»ç»Ÿä¸­ï¼Œéœ€è¦æ ¹æ®ç”¨æˆ·çš„å†å²è¡Œä¸ºæ¥æ¨èç›¸ä¼¼çš„å•†å“ï¼Œè¿™æ—¶å°±éœ€è¦è€ƒè™‘ç”¨æˆ·çš„å†å²è¡Œä¸ºçš„æ•°é‡ï¼Œè€Œä¸ä»…ä»…æ˜¯ç”¨æˆ·çš„å†å²è¡Œä¸ºçš„ç›¸ä¼¼åº¦ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;ä½™å¼¦ç›¸ä¼¼åº¦ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä½™å¼¦ç›¸ä¼¼åº¦æ˜¯æŒ‡ä¸¤ä¸ªå‘é‡ä¹‹é—´çš„å¤¹è§’ä½™å¼¦å€¼ï¼Œå®ƒçš„è®¡ç®—å…¬å¼ä¸ºï¼šcosâ¡(ğœƒ)=ğ´â‹…ğµâˆ£ğ´âˆ£âˆ£ğµâˆ£cos(&lt;em&gt;Î¸&lt;/em&gt;)=âˆ£Aâˆ£âˆ£Bâˆ£Aâ‹…B&lt;/p&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/rag-%e4%bd%99%e5%bc%a6.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/rag-%e4%bd%99%e5%bc%a6.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ä½™å¼¦ç›¸ä¼¼åº¦å¯¹å‘é‡çš„é•¿åº¦ä¸æ•æ„Ÿï¼Œåªå…³æ³¨å‘é‡çš„æ–¹å‘ï¼Œå› æ­¤é€‚ç”¨äºé«˜ç»´å‘é‡çš„ç›¸ä¼¼æ€§è®¡ç®—ã€‚ä¾‹å¦‚è¯­ä¹‰æœç´¢å’Œæ–‡æ¡£åˆ†ç±»ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;ç‚¹ç§¯ç›¸ä¼¼åº¦ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å‘é‡çš„ç‚¹ç§¯ç›¸ä¼¼åº¦æ˜¯æŒ‡ä¸¤ä¸ªå‘é‡ä¹‹é—´çš„ç‚¹ç§¯å€¼ï¼Œå®ƒçš„è®¡ç®—å…¬å¼ä¸ºï¼šğ´â‹…ğµ=âˆ‘ğ‘–=1ğ‘›ğ´ğ‘–ğµğ‘–&lt;strong&gt;A&lt;/strong&gt;â‹…&lt;strong&gt;B&lt;/strong&gt;=&lt;em&gt;i&lt;/em&gt;=1âˆ‘&lt;em&gt;nAiBi&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/rag-%e7%82%b9%e7%a7%af.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/rag-%e7%82%b9%e7%a7%af.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ç‚¹ç§¯ç›¸ä¼¼åº¦ç®—æ³•çš„ä¼˜ç‚¹åœ¨äºå®ƒç®€å•æ˜“æ‡‚ï¼Œè®¡ç®—é€Ÿåº¦å¿«ï¼Œå¹¶ä¸”å…¼é¡¾äº†å‘é‡çš„é•¿åº¦å’Œæ–¹å‘ã€‚å®ƒé€‚ç”¨äºè®¸å¤šå®é™…åœºæ™¯ï¼Œä¾‹å¦‚å›¾åƒè¯†åˆ«ã€è¯­ä¹‰æœç´¢å’Œæ–‡æ¡£åˆ†ç±»ç­‰ã€‚ä½†ç‚¹ç§¯ç›¸ä¼¼åº¦ç®—æ³•å¯¹å‘é‡çš„é•¿åº¦æ•æ„Ÿï¼Œå› æ­¤åœ¨è®¡ç®—é«˜ç»´å‘é‡çš„ç›¸ä¼¼æ€§æ—¶å¯èƒ½ä¼šå‡ºç°é—®é¢˜ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;éƒ½æ˜¯çº¯æ•°å­¦çš„ç›´æ¥ä»£å…¥å…¬å¼å³å¯å¾—å‡ºç»“æœï¼Œè®¡ç®—å‡ºä¸€ä¸ªæ•°å€¼ï¼Œç„¶åè·Ÿæˆ‘ä»¬è®¾å®šçš„ç›¸ä¼¼åº¦é˜ˆå€¼åšæ¯”è¾ƒï¼Œå°äºè¯¥é˜ˆå€¼è¯´æ˜éå¸¸ç›¸ä¼¼ï¼Œå¤§äºé˜ˆå€¼è¯´æ˜ä¸ç›¸ä¼¼ï¼Œæ¯ä¸€ç§ç›¸ä¼¼æ€§æµ‹é‡ç®—æ³•éƒ½æœ‰å…¶ä¼˜ç‚¹å’Œç¼ºç‚¹ï¼Œéœ€è¦å¼€å‘è€…æ ¹æ®è‡ªå·±çš„æ•°æ®ç‰¹å¾å’Œä¸šåŠ¡åœºæ™¯æ¥é€‰æ‹©ã€‚&lt;/p&gt;
&lt;h3 id=&#34;è¿‡æ»¤&#34;&gt;è¿‡æ»¤&lt;/h3&gt;
&lt;p&gt;å‘é‡æ•°æ®åº“ä¹Ÿå…·å¤‡ä¼ ç»Ÿæ•°æ®åº“é‚£ç§å¯ä»¥æ ¹æ®éƒ¨åˆ†ä¸šåŠ¡å­—æ®µè¿›è¡Œè¿‡æ»¤ï¼Œä¹‹åå†è¿›è¡Œç›¸ä¼¼æ€§æŸ¥è¯¢ï¼Œè¿™äº›å­—æ®µæ„æˆçš„å°±ç§°ä¸ºå…ƒæ•°æ®ï¼Œæ‰€ä»¥å‘é‡æ•°æ®åº“é€šå¸¸éœ€è¦ç»´æŠ¤ä¸¤ä¸ªç´¢å¼•ï¼Œä¸€ä¸ªæ˜¯å‘é‡ç´¢å¼•ï¼Œå¦ä¸€ä¸ªæ˜¯å…ƒæ•°æ®ç´¢å¼•ï¼Œä¸¤è€…ç›¸ç»“åˆä»è€Œå¿«é€Ÿæ‰¾åˆ°éœ€è¦çš„æ•°æ®ã€‚&lt;/p&gt;
&lt;h2 id=&#34;äº”å¸¸è§çš„å‘é‡æ•°æ®åº“&#34;&gt;äº”ã€å¸¸è§çš„å‘é‡æ•°æ®åº“&lt;/h2&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;DB&lt;/th&gt;
&lt;th&gt;æ˜¯å¦å¼€æº&lt;/th&gt;
&lt;th&gt;åŠŸèƒ½ç®€è¿°&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a class=&#34;link&#34; href=&#34;https://github.com/chroma-core/chroma&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Chroma&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;æ˜¯&lt;/td&gt;
&lt;td&gt;ç®€å•ï¼šç±»å‹å®Œæ•´ã€æµ‹è¯•å…¨é¢ã€æ–‡æ¡£å®Œæ•´æ•´åˆï¼šæ”¯æŒLangChainï¼ˆpythonå’Œjsï¼‰ã€LlamaIndexç­‰ç­‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.pinecone.io/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Pinecone&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;å¦&lt;/td&gt;
&lt;td&gt;ç›¸ä¼¼æ€§æœç´¢ã€æ¨èç³»ç»Ÿã€ä¸ªæ€§åŒ–å’Œè¯­ä¹‰æœç´¢å…è´¹ç‰ˆå¯ä»¥æ”¯æŒ500wçš„å‘é‡å­˜å‚¨ï¼Œå…¶ç”¨æ³•ç®€å•ï¼Œä»·æ ¼ä½å»‰ï¼Œå¯ä»¥å¿«é€Ÿæ”¯æŒå‘é‡æ£€ç´¢ä¸šåŠ¡çš„éªŒè¯ä¸å°è¯•ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a class=&#34;link&#34; href=&#34;https://github.com/weaviate/weaviate&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Weaviate&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;æ˜¯&lt;/td&gt;
&lt;td&gt;å‘é‡æœç´¢ï¼Œè¯­ä¹‰æœç´¢ã€æ¨èç³»ç»Ÿå¯ä»¥å­˜å‚¨å¯¹è±¡ã€å‘é‡ï¼Œæ”¯æŒå°†çŸ¢é‡æœç´¢ä¸ç»“æ„åŒ–è¿‡æ»¤ä¸äº‘åŸç”Ÿæ•°æ®åº“å®¹é”™å’Œå¯æ‹“å±•æ€§ç­‰èƒ½åŠ›ç›¸ç»“åˆã€‚ æ”¯æŒGraphQLã€RESTå’Œå„ç§è¯­è¨€çš„å®¢æˆ·ç«¯è®¿é—®&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a class=&#34;link&#34; href=&#34;https://github.com/milvus-io/milvus&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Milvus&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;æ˜¯ï¼Œäº‘åŸç”Ÿç‰ˆæœ¬ä¸ºzilliz&lt;/td&gt;
&lt;td&gt;å¯¹åŒ…å«æ•°ç™¾ä¸‡ã€æ•°åäº¿ç”šè‡³æ•°ä¸‡äº¿ä¸ªå‘é‡çš„å¯†é›†å‘é‡æ•°æ®é›†è¿›è¡Œç›¸ä¼¼æ€§æœç´¢ï¼›æ”¯æŒä¸‡äº¿å‘é‡æ•°æ®é›†ä¸Šçš„æ¯«ç§’çº§æœç´¢ï¼šåœ¨ä¸‡äº¿å‘é‡æ•°æ®é›†ä¸Šæµ‹è¯•å¹³å‡å»¶è¿Ÿï¼ˆæ¯«ç§’çº§ï¼‰äº‘åŸç”Ÿç‰ˆæœ¬æœ‰å…è´¹é¢åº¦ï¼Œä¸è¿‡åªæ”¯æŒåˆ›å»ºä¸¤ä¸ªcollection&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a class=&#34;link&#34; href=&#34;https://github.com/facebookresearch/faiss&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Faiss&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;æ˜¯&lt;/td&gt;
&lt;td&gt;å›¾åƒè¯†åˆ«ã€è¯­ä¹‰æœç´¢FacebookèƒŒä¹¦&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a class=&#34;link&#34; href=&#34;https://github.com/spotify/annoy&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Annoy&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;æ˜¯&lt;/td&gt;
&lt;td&gt;SpotifyèƒŒä¹¦ï¼ŒåŸºäºéšæœºæŠ•å½±å’Œæ ‘çš„ç®—æ³•ï¼Œæ”¯æŒå¤šç§ç›¸ä¼¼ç®—æ³•ä½ç»´åº¦æ•ˆæœä¼šæ›´å¥½ï¼ˆæ¯”å¦‚&amp;lt;=100ï¼‰ï¼Œä½†å³ä½¿æ˜¯1000ç»´çš„ç»´åº¦ï¼Œå®ƒçš„è¡¨ç°ä¹Ÿè¿˜æ˜¯éå¸¸ä¼˜ç§€&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a class=&#34;link&#34; href=&#34;https://github.com/elastic/elasticsearch&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Elasticsearch  8.0 ä»¥ä¸Šç‰ˆæœ¬&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;æ˜¯&lt;/td&gt;
&lt;td&gt;å®ç°æ–‡æœ¬çš„è¯­ä¹‰æœç´¢æˆ–è€…å›¾åƒã€è§†é¢‘æˆ–éŸ³é¢‘çš„ç›¸ä¼¼åº¦æœç´¢æä¾›äº†åŸºç¡€&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a class=&#34;link&#34; href=&#34;https://supabase.com/blog/openai-embeddings-postgres-vector&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;PostgreSQL + pgvectoræ’ä»¶&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;æ˜¯&lt;/td&gt;
&lt;td&gt;æ”¯æŒç²¾ç¡®å’Œè¿‘ä¼¼æœ€è¿‘æœç´¢ï¼ˆANN)ï¼Œæä¾›ä¸‰ç§è·ç¦»å³ä½¿æ–¹æ³•ï¼šæ¬§å‡ é‡Œå¾—è·ç¦»ã€ä½™å¼¦è·ç¦»ã€å†…ç§¯&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id=&#34;å…­rag-å®æˆ˜&#34;&gt;å…­ã€RAG å®æˆ˜&lt;/h2&gt;
&lt;p&gt;å¼ºçƒˆå»ºè®®å¯ä»¥çœ‹&lt;a class=&#34;link&#34; href=&#34;https://python.langchain.com/v0.2/docs/introduction/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;langchainçš„å®˜æ–¹æ–‡æ¡£&lt;/a&gt;ï¼Œå†™å¾—éå¸¸è¯¦ç»†ä¸”æ¸…æ™°ï¼Œdemoä¹Ÿå¾ˆå®¹æ˜“è·‘èµ·æ¥ï¼Œè€Œä¸”ä¹Ÿå¯ä»¥åœ¨ä»–ä»¬çš„å®˜æ–¹æ–‡æ¡£ä¸Šä½“éªŒä¸€ä¸‹ç›¸ä¼¼æ€§æœç´¢ã€‚&lt;/p&gt;
&lt;p&gt;è¿™é‡Œä¹ŸåŸºäºlangchainæ¡†æ¶ï¼Œä½¿ç”¨chromaä½œä¸ºå‘é‡æ•°æ®åº“ï¼Œä½¿ç”¨ollamaç®¡ç†çš„æœ¬åœ°å¤§æ¨¡å‹llama2-chineseï¼ˆä¹Ÿç”¨å®ƒä½œä¸ºvector embeddingï¼‰ï¼Œæ–‡æœ¬é¢„å¤„ç†ä½¿ç”¨&lt;a class=&#34;link&#34; href=&#34;https://baoyu.io/translations/rag/5-levels-of-text-splitting&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;æ–‡æœ¬åˆ†å‰²çš„äº”ä¸ªå±‚æ¬¡&lt;/a&gt;æåˆ°çš„ç¬¬å››åœºçš„æ–¹æ³•ï¼Œç„¶åæŒ‰ç…§ä¸‹é¢çš„æµç¨‹ï¼Œå®ç°ä¸€ä¸ªç®€å•çš„RAG demoã€‚&lt;/p&gt;
&lt;p&gt;åªæ˜¯ä¸€ä¸ªå°demoï¼Œä½“éªŒä¸€ä¸‹RAGçš„æµç¨‹è€Œå·²ï¼Œå‡ºæ¥çš„æ•ˆæœä¸ä¸€å®šå¾ˆå¥½å“ˆã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/rag-flow.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/rag-flow.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å®‰è£…ollamaä½œä¸ºæœ¬åœ°LLMï¼Œè·Ÿç€å®ƒ&lt;a class=&#34;link&#34; href=&#34;https://github.com/ollama/ollama&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;github&lt;/a&gt;ä¸Šçš„æ­¥éª¤è¿›è¡Œå®‰è£…å³å¯ï¼Œæˆ‘æµ‹è¯•çš„æ—¶å€™æ˜¯ç”¨dockerè¿›è¡Œå®‰è£…çš„ï¼Œç„¶åæŒ‡å®šå®ƒè·‘åœ¨GPUä¸Šï¼Œä¸ç„¶æ¨ç†ç­”æ¡ˆçš„é€Ÿåº¦å¤ªæ…¢äº†ï¼›&lt;/li&gt;
&lt;li&gt;å‡†å¤‡ä¸€ç¯‡markdownæ–‡ç« ï¼Œå°±å¯ä»¥å¼€å§‹å†™ä»£ç äº†ï¼Œè¿™é‡ŒæŠŠæ•´ä¸ªæµç¨‹åˆ†å‰²æˆå¤šä¸ªæ­¥éª¤ï¼Œæ¯ä¸ªæ­¥éª¤å¯ä»¥ç‹¬ç«‹è¿è¡Œï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;ol&gt;
&lt;li&gt;å°†markdownæ–‡ç« è¿›è¡Œé¢„å¤„ç†ï¼Œåˆ†å‰²æˆæ–‡æœ¬å—ï¼š&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-Python&#34; data-lang=&#34;Python&#34;&gt;&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;langchain_community.llms&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Ollama&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;langchain_core.prompts&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ChatPromptTemplate&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;langchain_core.output_parsers&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;StrOutputParser&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;langchain_community.document_loaders&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;UnstructuredMarkdownLoader&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;langchain_text_splitters&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;RecursiveCharacterTextSplitter&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;langchain_community.vectorstores&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Chroma&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;langchain_community.embeddings&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;OllamaEmbeddings&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;langchain.chains&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;create_retrieval_chain&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;langchain.chains.combine_documents&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;create_stuff_documents_chain&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;json&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;codecs&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# è§£æ md å†…å®¹ï¼Œå¹¶llama2-chineseä½œä¸ºåµŒå…¥æ¨¡å‹è®¡ç®—å‘é‡ï¼Œç„¶åè½¬æˆ json æ–‡ä»¶&lt;/span&gt;

&lt;span class=&#34;n&#34;&gt;markdown_path&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;markdownæ–‡ç« çš„è·¯å¾„&amp;#34;&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;loader&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;UnstructuredMarkdownLoader&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;markdown_path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;mode&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;elements&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;data&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;loader&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;load&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;

&lt;span class=&#34;n&#34;&gt;embeddings&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;OllamaEmbeddings&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;model&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;llama2-chinese&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;sentences&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;item&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;enumerate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;vectors&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;embeddings&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;embed_documents&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;item&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;page_content&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;sentences&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;append&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;({&lt;/span&gt;
                &lt;span class=&#34;s1&#34;&gt;&amp;#39;sentence&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;item&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;page_content&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
                &lt;span class=&#34;s1&#34;&gt;&amp;#39;index&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
                &lt;span class=&#34;s1&#34;&gt;&amp;#39;vectors&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;vectors&lt;/span&gt;
        &lt;span class=&#34;p&#34;&gt;})&lt;/span&gt;
        &lt;span class=&#34;c1&#34;&gt;# æ‰“å°å†…å®¹åŠå…¶è½¬æ¢çš„å‘é‡&lt;/span&gt;
        &lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;item&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;page_content&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;  &amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;vectors&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# å°†è½¬æ¢ç»“æœå†™å…¥jsonæ–‡ä»¶ä¸­&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;sentencesJson&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;json&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;dumps&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sentences&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ensure_ascii&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;False&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;with&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;codecs&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;open&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;sentences.json&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;w&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;utf-8&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;as&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;write&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sentencesJson&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;å°†ä¸Šä¸€æ­¥å¾—åˆ°çš„æ–‡æœ¬ + åµŒå…¥çš„å‘é‡ï¼Œå­˜å…¥åˆ° chroma DBä¸­ï¼š&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-Python&#34; data-lang=&#34;Python&#34;&gt;&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;langchain_community.llms&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Ollama&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;langchain_core.prompts&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ChatPromptTemplate&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;langchain_core.output_parsers&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;StrOutputParser&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;langchain_community.document_loaders&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;UnstructuredMarkdownLoader&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;langchain_text_splitters&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;RecursiveCharacterTextSplitter&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;langchain_community.vectorstores&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Chroma&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;langchain_community.embeddings&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;OllamaEmbeddings&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;langchain.chains&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;create_retrieval_chain&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;langchain.chains.combine_documents&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;create_stuff_documents_chain&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;json&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;codecs&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;chromadb&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# åŠ è½½ä¸Šä¸€æ­¥æ‹†åˆ†å‡ºæ¥çš„æ–‡æœ¬åŠå…¶å‘é‡å€¼&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;sentences&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;with&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;open&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;sentences.json&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;rb&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;as&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;sentence&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;json&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;load&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# æ„å»ºä¸€ä¸ªchroma dbå®ä¾‹&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;client&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;chromadb&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PersistentClient&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;./chroma_db&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;# è·å–è¦å­˜å‚¨çš„collection&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;collection&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;client&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;get_or_create_collection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;demo&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;# æ„å»ºè¦ä¿å­˜çš„å†…å®¹&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;embeddingList&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;docList&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;ids&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;item&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;enumerate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sentences&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;embeddingList&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;append&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;item&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;vectors&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;docList&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;append&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;item&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;sentence&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;ids&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;append&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;1-&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;str&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;item&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;index&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]))&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;# ä¿å­˜åˆ°chromaä¸­&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;collection&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;add&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;embeddings&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;embeddingList&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;documents&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;docList&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;ids&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ids&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;å‘ ollama æé—®ï¼Œæ­¤æ—¶ä¼šå…ˆåŸºäºé—®é¢˜ï¼Œä½¿ç”¨llama2-chineseåµŒå…¥æ¨¡å‹è½¬æ¢ä¸ºå‘é‡ï¼Œåœ¨chroma ä¸­è¿›è¡Œç›¸ä¼¼æ€§æœç´¢ï¼ŒæŸ¥æ‰¾å‡ºå¯¹åº”çš„æ–‡æœ¬ï¼Œç„¶åå°†æ£€ç´¢å¾—åˆ°çš„æ–‡æœ¬ + é—®é¢˜ï¼Œä¸€èµ·å‘ç»™ollamaï¼Œç”±ollamaçš„llama2-chineseæ¨¡å‹æ¨ç†ç»™å‡ºç­”æ¡ˆï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-Python&#34; data-lang=&#34;Python&#34;&gt;&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;langchain_community.llms&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Ollama&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;langchain_core.prompts&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ChatPromptTemplate&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;langchain_core.output_parsers&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;StrOutputParser&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;langchain_community.document_loaders&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;UnstructuredMarkdownLoader&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;langchain_text_splitters&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;RecursiveCharacterTextSplitter&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;langchain_community.vectorstores&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Chroma&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;langchain_community.embeddings&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;OllamaEmbeddings&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;langchain.chains&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;create_retrieval_chain&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;langchain.chains.combine_documents&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;create_stuff_documents_chain&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# åŠ è½½åµŒå…¥æ¨¡å‹ï¼Œå°†é—®é¢˜è½¬æ¢æˆå‘é‡ï¼Œè¿™ä¸€æ­¥åªæ˜¯ä¸ºäº†æ‰“å°ç›¸ä¼¼æ€§æœç´¢çš„ç»“æœ&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;embeddings&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;OllamaEmbeddings&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;model&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;llama2-chinese&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;db&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Chroma&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;persist_directory&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;./chroma_db&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;collection_name&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;demo&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;embedding_function&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;embeddings&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;query&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;è¿™é‡Œæ”¹æˆæƒ³è¦é—®çš„é—®é¢˜&amp;#34;&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;docs&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;db&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;similarity_search&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;query&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;æ ¹æ®é—®é¢˜ä»dbä¸­ç›¸ä¼¼æ€§æœç´¢å‡ºæ¥çš„æ–‡æœ¬ï¼š&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;docs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;page_content&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# ----------------------------------------------------------&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;# åŠ è½½LLMæ¨¡å‹&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;llm&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Ollama&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;model&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;llama2-chinese&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;prompt&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ChatPromptTemplate&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;from_template&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&amp;#34;ä»…ä¾æ®ä¸‹é¢æä¾›çš„ä¸Šä¸‹æ–‡ï¼Œå›ç­”æˆ‘æ¥ä¸‹æ¥çš„é—®é¢˜:
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;lt;context&amp;gt;
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{context}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;lt;/context&amp;gt;
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;é—®é¢˜: &lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{input}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# è¿™é‡Œlangchainå·²ç»å¸®æˆ‘ä»¬æ•´åˆäº† â€œæ ¹æ®é—®é¢˜ä»dbä¸­ç›¸ä¼¼æ€§æœç´¢å‡ºæ¥çš„ç­”æ¡ˆâ€ è¿™ä¸ªæ­¥éª¤äº†&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;document_chain&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;create_stuff_documents_chain&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;llm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;prompt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;retriever&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;db&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;as_retriever&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;retrieval_chain&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;create_retrieval_chain&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;retriever&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;document_chain&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;# å‘é€é—®é¢˜+ç›¸å…³è”çš„æ–‡æœ¬ï¼Œä»è€Œå®ç°æ£€ç´¢å¢å¼ºï¼Œå³RAG&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;response&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;retrieval_chain&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;invoke&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;({&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;input&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;query&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;})&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;response&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;answer&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id=&#34;ä¸ƒragçš„å±€é™æ€§&#34;&gt;ä¸ƒã€RAGçš„å±€é™æ€§&lt;/h2&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/RAG%e7%9a%84%e5%9b%9b%e4%b8%aa%e6%9f%a5%e8%af%a2%e7%ba%a7%e5%88%ab.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/RAG%e7%9a%84%e5%9b%9b%e4%b8%aa%e6%9f%a5%e8%af%a2%e7%ba%a7%e5%88%ab.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;ç”¨æˆ·çš„ä»»ä½•é—®é¢˜å¯ä»¥å¤§è‡´åˆ†ä¸ºå››ç±»ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;æ˜¾æ€§äº‹å®æŸ¥è¯¢ï¼š&lt;/p&gt;
&lt;p&gt;æœ€ç®€å•æŸ¥è¯¢ï¼Œå¯ä»¥ç›´æ¥ä»æä¾›çš„æ•°æ®ä¸­æ£€ç´¢åˆ°æ˜ç¡®çš„äº‹å®ä¿¡æ¯ï¼Œæ— éœ€å¤æ‚çš„æ¨ç†å’Œæ€è€ƒï¼Œéš¾ç‚¹åœ¨äºæ£€ç´¢çš„å‡†ç¡®æ€§å’Œé«˜æ•ˆæ€§ã€‚&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚é—®â€æŸé—¨åº—ä¸Šä¸ªæœˆçš„è¥ä¸šé¢æ˜¯å¤šå°‘ï¼Ÿâ€œè¿™ç§é—®é¢˜ï¼Œå¯ä»¥ç›´æ¥ä»æ•°æ®æºä¸­è·å–ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;éšæ€§äº‹å®æŸ¥è¯¢ï¼š&lt;/p&gt;
&lt;p&gt;éšæ€§äº‹å®å¹¶ä¸ä¼šåœ¨åŸå§‹æ•°æ®ä¸­æ˜¾ç°ï¼Œæ¨å¯¼éšæ€§äº‹å®çš„ä¿¡æ¯å¯èƒ½ä¼šåˆ†æ•£åœ¨å¤šä¸ªæ®µè½æˆ–æ•°æ®è¡¨ä¸­ï¼Œéœ€è¦è¿›è¡Œå…³è”ã€å°‘é‡çš„æ¨ç†å’Œé€»è¾‘åˆ¤æ–­å¾—å‡ºã€‚&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚é—®â€æŸ¥è¯¢è¿‡å»ä¸€å¹´è¥æ”¶å¢é•¿ç‡æœ€é«˜çš„é—¨åº—æ˜¯å“ªä¸€å®¶ï¼Ÿâ€œï¼Œæ­¤æ—¶å°±éœ€è¦å‘LLMæä¾›è¿‡å»ä¸€å¹´æ‰€æœ‰é—¨åº—çš„è¥ä¸šé¢ï¼Œå¸®åŠ©LLMè®¡ç®—æ¯ä¸ªé—¨åº—çš„å¢é•¿ç‡ï¼Œæœ€åå¾—å‡ºç»“è®º&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¯è§£é‡Šæ€§æ¨ç†æŸ¥è¯¢ï¼š&lt;/p&gt;
&lt;p&gt;å¯è§£é‡Šæ€§æ¨ç†ï¼Œæ˜¯æŒ‡æ— æ³•ä»æ˜¾æ€§äº‹å®å’Œéšæ€§äº‹å®ä¸­è·å–ï¼Œéœ€è¦ç»¼åˆå¤šæ–¹æ•°æ®è¿›è¡Œè¾ƒä¸ºå¤æ‚çš„æ¨ç†ã€å½’çº³å’Œæ€»ç»“çš„é—®é¢˜ï¼Œå¹¶ä¸”æ¨ç†è¿‡ç¨‹å…·å¤‡ä¸šåŠ¡å¯è§£é‡Šæ€§ã€‚&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚é—®â€è¿‡å»ä¸€å¹´ï¼ŒæŸåœ°åŒºé—¨åº—è¥ä¸šé¢æ”¶å…¥ä¸‹æ»‘5%çš„åŸå› æ˜¯ä»€ä¹ˆï¼Ÿâ€œè¿™ç§é—®é¢˜æ— æ³•ä»æ•°æ®æºä¸­ç›´æ¥è·å–ï¼Œä½†å¯ä»¥é€šè¿‡å…¶ä»–æ–¹å¼è¿›è¡Œæ¨ç†ï¼Œæ¯”å¦‚å‘Šè¯‰LLM æ€»è¥æ”¶ç”±ä»€ä¹ˆéƒ¨åˆ†ç»„æˆï¼Œè®©LLMç›´æ¥ä»è¿™äº›éƒ¨åˆ†è¿›è¡Œæ¨æ–­ï¼Œæœ€ç»ˆå¾—å‡ºç»“è®ºï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;éšæ€§æ¨ç†æŸ¥è¯¢ï¼š&lt;/p&gt;
&lt;p&gt;éšæ€§æ¨ç†æŸ¥è¯¢ï¼Œæ˜¯æŒ‡éš¾ä»¥é€šè¿‡äº‹å…ˆçº¦å®šçš„ä¸šåŠ¡è§„åˆ™æˆ–å†³ç­–é€»è¾‘è¿›è¡Œåˆ¤æ–­ï¼Œè€Œå¿…é¡»ä»å¤–éƒ¨æ•°æ®ä¸­è¿›è¡Œè§‚å¯Ÿå’Œåˆ†æï¼Œæœ€ç»ˆæ¨ç†å‡ºç»“è®ºã€‚&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚é—®â€é¢„æµ‹æŸåœ°åŒºæœªæ¥ä¸‰ä¸ªæœˆå†…å¯èƒ½å…³é—­çš„é—¨åº—ï¼Œå¹¶è¯´æ˜åŸå› â€œï¼Œè¿™ç§é—®é¢˜ï¼Œé™¤äº†éœ€è¦ç»™LLMæä¾›å„é—¨åº—çš„ç»è¥æ•°æ®ï¼Œè¿˜éœ€è¦LLMç»“åˆå¤–éƒ¨æ•°æ®å¦‚å¸‚åœºè°ƒç ”æŠ¥å‘Šã€æ–°é—»æŠ¥é“ã€æ”¿ç­–ä¿¡æ¯ç­‰ï¼Œè¿›è¡Œæ·±åº¦åˆ†æå’Œæ¨ç†æ‰èƒ½å¾—å‡ºç»“è®ºï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/RAG%e5%9b%9b%e4%b8%aa%e6%9f%a5%e8%af%a2%e7%ba%a7%e5%88%ab%e5%af%b9%e5%ba%94%e7%9a%84%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/RAG%e5%9b%9b%e4%b8%aa%e6%9f%a5%e8%af%a2%e7%ba%a7%e5%88%ab%e5%af%b9%e5%ba%94%e7%9a%84%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;å¯ä»¥çœ‹åˆ°ï¼ŒRAGè¿˜æ˜¯æœ‰å…¶å±€é™æ€§ï¼Œæœ€åŸºç¡€çš„RAGæµç¨‹è™½ç„¶å®ç°ç®€å•ï¼Œä½†å¤§éƒ¨åˆ†æƒ…å†µä¸‹åªèƒ½è§£å†³æ˜¾æ€§äº‹å®æŸ¥è¯¢å’Œéƒ¨åˆ†éšæ€§äº‹å®æŸ¥è¯¢ï¼ŒRAGçš„å‘å±•ï¼Œä»Naive RAGï¼Œåˆ°Advanced RAGï¼Œå†åˆ°Module RAGï¼Œéƒ½æ˜¯åœ¨å°½é‡ä¼˜åŒ–è¿™äº›é—®é¢˜ï¼Œä½†å¯¹äºç”¨æˆ·æ¥è¯´ï¼Œå¤§å¤šæ•°æœ‰ä»·å€¼çš„é—®é¢˜éƒ½å±äºå¯è§£é‡Šæ€§æ¨ç†å’Œéšæ€§æ¨ç†æŸ¥è¯¢ï¼Œå¯¹äºè¿™äº›éœ€è¦æ¨ç†æŸ¥è¯¢çš„é—®é¢˜ï¼ŒRAGå°±æ— æ³•è§£å†³äº†ï¼Œåªèƒ½ä¾é å…¶ä»–æ›´å¤æ‚å’Œæ›´æœ‰é’ˆå¯¹æ€§çš„è§£å†³æ–¹æ¡ˆï¼›&lt;/p&gt;
&lt;h2 id=&#34;å…«å‚è€ƒ&#34;&gt;å…«ã€å‚è€ƒ&lt;/h2&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.bilibili.com/video/BV1JF4m177Wd&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;RAG + å‘é‡æ•°æ®åº“ç§‘æ™®&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://juejin.cn/post/7250794190120353847&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;åŸºäºlangchain çš„æ–‡æ¡£é—®ç­” æœ€ä½³å®è·µ&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://cloud.tencent.com/developer/article/2311302&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;ç”¨GPT-4å’ŒChromaDBä¸æ–‡æœ¬æ–‡ä»¶å¯¹è¯æ•™ç¨‹&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://zhuanlan.zhihu.com/p/651179780&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;åŸºäºLLM+å‘é‡åº“çš„æ–‡æ¡£å¯¹è¯ç—›ç‚¹åŠè§£å†³æ–¹æ¡ˆ&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://zhuanlan.zhihu.com/p/641132245&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;LLM+Embeddingæ„å»ºé—®ç­”ç³»ç»Ÿçš„å±€é™æ€§åŠä¼˜åŒ–æ–¹æ¡ˆ&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://python.langchain.com/v0.2/docs/how_to/markdown_header_metadata_splitter/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;langchain - How to split Markdown by Headers&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://aitutor.liduos.com/02-langchain/02-1.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;langchainå…¥é—¨&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.wehelpwin.com/article/4387&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;chatgptåŸç†1&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://brightliao.com/2023/04/25/chatgpt-a-technical-summary/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;chatgptåŸç†2&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://arxiv.org/html/2409.14924v1&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Retrieval Augmented Generation (RAG) and Beyond: A Comprehensive Survey on How to Make your LLMs use External Data More Wisely&lt;/a&gt;&lt;/p&gt;
</description>
        </item>
        <item>
        <title>ç³»ç»Ÿè®¾è®¡</title>
        <link>http://nixum.cc/p/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/</link>
        <pubDate>Tue, 01 Oct 2024 00:00:00 +0000</pubDate>
        
        <guid>http://nixum.cc/p/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/</guid>
        <description>&lt;p&gt;[TOC]&lt;/p&gt;
&lt;h1 id=&#34;æ€è€ƒçš„ç»´åº¦&#34;&gt;æ€è€ƒçš„ç»´åº¦&lt;/h1&gt;
&lt;ol&gt;
&lt;li&gt;æ˜ç¡®éœ€æ±‚ï¼Œç¡®å®šæ ¸å¿ƒåŠŸèƒ½å’Œéæ ¸å¿ƒåŠŸèƒ½&lt;/li&gt;
&lt;li&gt;å®¹é‡ä¼°ç®—ï¼Œæ¯”å¦‚ç”¨æˆ·æ•°ï¼Œqpsï¼Œè¯»å†™æ¯”ä¾‹ï¼ŒDBå­˜å‚¨å®¹é‡ï¼Œç½‘ç»œå¸¦å®½&lt;/li&gt;
&lt;li&gt;æ¶æ„è®¾è®¡ï¼Œç¡®å®šæœ‰ä»€ä¹ˆæ¨¡å—ï¼ŒæœåŠ¡çš„å®šä½å’ŒåŠŸèƒ½ï¼ŒDBï¼Œç¼“å­˜ï¼ŒMQï¼Œä¸å¤–éƒ¨æœåŠ¡çš„äº¤äº’ï¼ŒAPIä¸é€šä¿¡åè®®ï¼Œ&lt;/li&gt;
&lt;li&gt;é’ˆå¯¹æŸä¸€ä¸ªæ¨¡å—æ·±å…¥æ€è€ƒç»†èŠ‚&lt;/li&gt;
&lt;li&gt;æ‰©å±•è®¾è®¡ï¼Œéœ€è¦è€ƒè™‘å¯é æ€§ã€å¯æ‰©å±•æ€§ã€å®‰å…¨æ€§ã€æˆæœ¬ç­‰æ–¹é¢&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h1&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://github.com/ByteByteGoHq/system-design-101&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://github.com/ByteByteGoHq/system-design-101&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://github.com/checkcheckzz/system-design-interview&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://github.com/checkcheckzz/system-design-interview&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://github.com/ashishps1/awesome-system-design-resources&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://github.com/ashishps1/awesome-system-design-resources&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md&lt;/a&gt;&lt;/p&gt;
</description>
        </item>
        <item>
        <title>Kuberneteså’ŒIstio</title>
        <link>http://nixum.cc/p/kubernetes%E5%92%8Cistio/</link>
        <pubDate>Wed, 22 Jul 2020 00:00:00 +0000</pubDate>
        
        <guid>http://nixum.cc/p/kubernetes%E5%92%8Cistio/</guid>
        <description>&lt;p&gt;[TOC]&lt;/p&gt;
&lt;h1 id=&#34;kubernetes&#34;&gt;Kubernetes&lt;/h1&gt;
&lt;p&gt;å½“å‰Kubernetesç¤¾åŒºå¯¹å¤–å®£ä¼ æ˜¯å•ä¸ªé›†ç¾¤æœ€å¤šæ”¯æŒ5000ä¸ªèŠ‚ç‚¹ï¼ŒPodæ€»æ•°ä¸è¶…è¿‡150kï¼Œå®¹å™¨æ€»æ•°ä¸è¶…è¿‡300kï¼Œå•èŠ‚ç‚¹Podæ•°é‡ä¸è¶…è¿‡100ä¸ªã€‚&lt;/p&gt;
&lt;h2 id=&#34;åŸºæœ¬&#34;&gt;åŸºæœ¬&lt;/h2&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/k8s%e9%a1%b9%e7%9b%ae%e6%9e%b6%e6%9e%84.jpg&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/k8s%e9%a1%b9%e7%9b%ae%e6%9e%b6%e6%9e%84.jpg&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å®¹å™¨çš„æœ¬è´¨æ˜¯è¿›ç¨‹ï¼ŒKubernetesç›¸å½“äºæ“ä½œç³»ç»Ÿ&lt;/strong&gt;ï¼Œç®¡ç†è¿™äº›è¿›ç¨‹ç»„ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;CNIï¼šContainer Network Interfaceï¼Œå®¹å™¨ç½‘ç»œæ¥å£è§„èŒƒï¼Œå¦‚ Flannelã€Calicoã€AWS VPC CNI&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;CRIï¼šContainer Runtime Interfaceï¼Œå®¹å™¨è¿è¡Œæ—¶çš„å„é¡¹æ ¸å¿ƒæ“ä½œçš„æ¥å£è§„èŒƒï¼Œæ˜¯ä¸€ç»„gRPCæ¥å£ã€‚åŒ…å«ä¸¤ç±»æœåŠ¡ï¼Œé•œåƒæœåŠ¡å’Œè¿è¡Œæ—¶æœåŠ¡ã€‚é•œåƒæœåŠ¡æä¾›ä¸‹è½½ã€æ£€æŸ¥å’Œåˆ é™¤é•œåƒçš„RPCæ¥å£ï¼›è¿è¡Œæ—¶æœåŠ¡åŒ…å«ç”¨äºç®¡ç†å®¹å™¨ç”Ÿå‘½å‘¨æœŸï¼Œä¸å®¹å™¨äº¤äº’çš„è°ƒç”¨çš„RPCæ¥å£ï¼ˆexec / attach / port-forwardç­‰ï¼‰ã€‚dockershimã€containerdã€cri-oéƒ½æ˜¯éµå¾ªCRIçš„å®¹å™¨è¿è¡Œæ—¶ï¼Œç§°ä¸ºé«˜å±‚çº§è¿è¡Œæ—¶ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;CSIï¼šContainer Storage Interfaceï¼Œå®¹å™¨å­˜å‚¨çš„æ¥å£è§„èŒƒï¼Œå¦‚PVã€PVC&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;OCIï¼šOpen Container Initiativeï¼Œå®¹å™¨è¿è¡Œæ—¶å’Œé•œåƒæ“ä½œè§„èŒƒï¼Œé•œåƒè§„èŒƒè§„å®šé«˜å±‚çº§è¿è¡Œæ—¶ä¼šä¸‹è½½ä¸€ä¸ªOCIé•œåƒï¼Œå¹¶æŠŠå®ƒè§£å‹ç§°OCIè¿è¡Œæ—¶æ–‡ä»¶ç³»ç»ŸåŒ…ï¼›è¿è¡Œæ—¶è§„èŒƒæè¿°å¦‚ä½•ä»OCIè¿è¡Œæ—¶æ–‡ä»¶ç³»ç»ŸåŒ…è¿è¡Œå®¹å™¨ç¨‹åºï¼Œå¹¶ä¸”å®šä¹‰å…¶é…ç½®ã€è¿è¡Œç¯å¢ƒå’Œç”Ÿå‘½å‘¨æœŸã€‚å®šä¹‰æ–°å®¹å™¨çš„namespacesã€cgroupså’Œæ ¹æ–‡ä»¶ç³»ç»Ÿï¼›å®ƒçš„ä¸€ä¸ªå‚è€ƒå®ç°æ˜¯runCï¼Œç§°ä¸ºåº•å±‚çº§è¿è¡Œæ—¶ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;CRDï¼šCustom Resource Definitionï¼Œè‡ªå®šä¹‰çš„èµ„æºå¯¹è±¡ï¼Œå³yamlæ–‡ä»¶ä¸­çš„Kindï¼Œå¦‚Operatorå°±æ˜¯å®ç°CRDçš„æ§åˆ¶å™¨ï¼Œä¹‹åç›´æ¥ä½¿ç”¨Operatoråˆ›å»ºçš„CRDå£°æ˜å¯¹è±¡å³å¯ä½¿ç”¨&lt;/p&gt;
&lt;p&gt;æ¯ä¸€ä¸ªå¯¹è±¡éƒ½åŒ…å«ä¸¤ä¸ªåµŒå¥—å¯¹è±¡æ¥æè¿°è§„æ ¼ï¼ˆSpecï¼‰å’ŒçŠ¶æ€ï¼ˆStatusï¼‰ï¼Œå¯¹è±¡çš„è§„æ ¼å°±ç®—æˆ‘ä»¬æœŸæœ›çš„ç›®æ ‡çŠ¶æ€ï¼Œè€ŒçŠ¶æ€æè¿°äº†å¯¹è±¡å½“å‰çŠ¶æ€ï¼Œè¿™ä¸€éƒ¨åˆ†ç”±Kubernetesæœ¬èº«æä¾›å’Œç®¡ç†ï¼Œé€šè¿‡describeæ‰èƒ½çœ‹åˆ°Statusçš„ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;7
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Deployment&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;metav1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;TypeMeta&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;`json:&amp;#34;,inline&amp;#34;`&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;metav1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ObjectMeta&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;`json:&amp;#34;metadata,omitempty&amp;#34; protobuf:&amp;#34;bytes,1,opt,name=metadata&amp;#34;`&lt;/span&gt;

	&lt;span class=&#34;nx&#34;&gt;Spec&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;DeploymentSpec&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;`json:&amp;#34;spec,omitempty&amp;#34; protobuf:&amp;#34;bytes,2,opt,name=spec&amp;#34;`&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;Status&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;DeploymentStatus&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;`json:&amp;#34;status,omitempty&amp;#34; protobuf:&amp;#34;bytes,3,opt,name=status&amp;#34;`&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;MasterèŠ‚ç‚¹ä½œç”¨ï¼šç¼–æ’ã€ç®¡ç†ã€è°ƒåº¦ç”¨æˆ·æäº¤çš„ä½œä¸š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Schedulerï¼šç¼–æ’å’Œè°ƒåº¦Podï¼ŒåŸºæœ¬åŸç†æ˜¯é€šè¿‡ç›‘å¬api-serverè·å–å¾…è°ƒåº¦çš„podï¼Œç„¶ååŸºäºä¸€ç³»åˆ—ç­›é€‰å’Œè¯„ä¼˜ï¼Œä¸ºpodåˆ†é…æœ€ä½³çš„nodeèŠ‚ç‚¹ï¼Œåœ¨æ¯æ¬¡éœ€è¦è°ƒåº¦Podæ—¶æ‰§è¡Œã€‚&lt;/li&gt;
&lt;li&gt;API-Serverï¼šæä¾›é›†ç¾¤å¯¹å¤–è®¿é—®çš„APIæ¥å£å®ç°å¯¹é›†ç¾¤èµ„æºçš„CRUDä»¥åŠwatchï¼Œæ˜¯é›†ç¾¤ä¸­å„ä¸ªç»„ä»¶æ•°æ®äº¤äº’å’Œé€šä¿¡çš„æ¢çº½ï¼Œå½“æ”¶åˆ°ä¸€ä¸ªåˆ›å»ºpodçš„è¯·æ±‚æ—¶ä¼šè¿›è¡Œè®¤è¯ã€é™é€Ÿã€æˆæƒã€å‡†å…¥æœºåˆ¶ç­‰æ£€æŸ¥åï¼Œå†™å…¥etcdã€‚å”¯ä¸€ä¸€ä¸ªä¸etcdé›†ç¾¤é€šä¿¡çš„ç»„ä»¶ã€‚&lt;/li&gt;
&lt;li&gt;Controller Managerï¼šç®¡ç†æ§åˆ¶å™¨çš„ï¼Œæ¯”å¦‚Deploymentã€Jobã€CronbJobã€RCã€StatefulSetã€Daemonç­‰ï¼Œæ ¸å¿ƒæ€æƒ³æ˜¯ç›‘å¬ã€æ¯”è¾ƒèµ„æºå®é™…çŠ¶æ€ä¸æœŸæœ›çŠ¶æ€æ˜¯å¦ä¸€è‡´ï¼Œå¦åˆ™è¿›è¡Œåè°ƒã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Device Pluginï¼šç®¡ç†èŠ‚ç‚¹ä¸Šçš„ç¡¬ä»¶è®¾å¤‡ï¼Œæ¯”å¦‚GPU&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;NodeèŠ‚ç‚¹ä½œç”¨ï¼šè¿è¡Œæˆ–æ‰§è¡Œç”¨æˆ·ä½œä¸š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;kubeletï¼šè´Ÿè´£åˆ›å»ºã€ç®¡ç†å„ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œæ—¶çš„å®¹å™¨å’ŒPodï¼Œè¿™ä¸ªäº¤äº’ä¾èµ–CRIçš„è¿œç¨‹è°ƒç”¨æ¥å£ï¼Œé€šè¿‡Socketå’ŒCRIé€šä¿¡ï¼›&lt;/p&gt;
&lt;p&gt;å‘¨æœŸæ€§åœ°ä»API Serveræ¥æ”¶æ–°çš„æˆ–è€…ä¿®æ”¹çš„Podè§„èŒƒå¹¶ä¸”ä¿è¯èŠ‚ç‚¹ä¸Šçš„Podå’Œå…¶ä»–å®¹å™¨çš„æ­£å¸¸è¿è¡Œï¼Œä¿è¯èŠ‚ç‚¹ä¼šå‘ç›®æ ‡çŠ¶æ€è¿ç§»ï¼Œå‘MasterèŠ‚ç‚¹å‘é€å®¿ä¸»æœºçš„å¥åº·çŠ¶æ€ï¼›ï¼ˆå¤„ç†Masterä¸‹å‘åˆ°æœ¬èŠ‚ç‚¹çš„ä»»åŠ¡ï¼Œç®¡ç†Podå’ŒPodä¸­çš„å®¹å™¨ï¼‰&lt;/p&gt;
&lt;p&gt;kubelet ä½¿ç”¨cAdvisorå¯¹workerèŠ‚ç‚¹èµ„æºè¿›è¡Œç›‘æ§ã€‚åœ¨ Kubernetes ç³»ç»Ÿä¸­ï¼ŒcAdvisor å·²è¢«é»˜è®¤é›†æˆåˆ° kubelet ç»„ä»¶å†…ï¼Œå½“ kubelet æœåŠ¡å¯åŠ¨æ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨å¯åŠ¨ cAdvisor æœåŠ¡ï¼Œç„¶å cAdvisor ä¼šå®æ—¶é‡‡é›†æ‰€åœ¨èŠ‚ç‚¹çš„æ€§èƒ½æŒ‡æ ‡åŠåœ¨èŠ‚ç‚¹ä¸Šè¿è¡Œçš„å®¹å™¨çš„æ€§èƒ½æŒ‡æ ‡ã€‚ï¼ˆç›‘æ§å’Œå®šæœŸå‘Masteræ±‡æŠ¥èŠ‚ç‚¹èµ„æºä½¿ç”¨ç‡ï¼‰&lt;/p&gt;
&lt;p&gt;kubelet è¿˜é€šè¿‡ gRPC åè®®åŒä¸€ä¸ªå«ä½œ Device Plugin çš„æ’ä»¶è¿›è¡Œäº¤äº’ã€‚è¿™ä¸ªæ’ä»¶ï¼Œæ˜¯ Kubernetes é¡¹ç›®ç”¨æ¥ç®¡ç† GPU ç­‰å®¿ä¸»æœºç‰©ç†è®¾å¤‡çš„ä¸»è¦ç»„ä»¶ï¼›
kubelet çš„å¦ä¸€ä¸ªé‡è¦åŠŸèƒ½ï¼Œåˆ™æ˜¯è°ƒç”¨ç½‘ç»œæ’ä»¶å’Œå­˜å‚¨æ’ä»¶ä¸ºå®¹å™¨é…ç½®ç½‘ç»œå’ŒæŒä¹…åŒ–å­˜å‚¨ï¼Œäº¤äº’çš„æ¥å£æ˜¯CNIå’ŒCSIï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Kube-Proxyï¼šä½œä¸ºdaemonsetéƒ¨ç½²åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šï¼Œè´Ÿè´£å®¿ä¸»æœºçš„å­ç½‘ç®¡ç†ï¼Œç”¨äºä¸ºPodåˆ›å»ºä»£ç†æœåŠ¡ï¼ŒåŒæ—¶ä¹Ÿèƒ½å°†æœåŠ¡æš´éœ²ç»™å¤–éƒ¨ï¼Œå…¶åŸç†å°±æ˜¯åœ¨å¤šä¸ªéš”ç¦»çš„ç½‘ç»œä¸­æŠŠè¯·æ±‚è½¬å‘ç»™æ­£ç¡®çš„Podæˆ–å®¹å™¨ï¼›&lt;/p&gt;
&lt;p&gt;ä»API-Serverè·å–æ‰€æœ‰serviceä¿¡æ¯ï¼Œåˆ›å»ºEndpointsï¼Œè½¬å‘serviceåˆ°Podé—´çš„è¯·æ±‚ï¼Œé»˜è®¤ä½¿ç”¨iptablesæ¨¡å¼ï¼Œä½†å½“serviceæ•°é‡å˜å¤šæ—¶æœ‰æ€§èƒ½é—®é¢˜ï¼Œ1.8ç‰ˆæœ¬åä½¿ç”¨IPVSæ¨¡å¼æå‡æ€§èƒ½ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;coreDNSï¼šä½ç‰ˆæœ¬çš„kubernetesä½¿ç”¨kube-dnsï¼Œ1.12åé»˜è®¤ä½¿ç”¨coreDNSï¼Œç”¨äºå®ç°åŸŸåæŸ¥æ‰¾åŠŸèƒ½&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;æ ¸å¿ƒç»„ä»¶çš„åä½œæµç¨‹&#34;&gt;æ ¸å¿ƒç»„ä»¶çš„åä½œæµç¨‹&lt;/h3&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/Kubenetes%e7%bb%84%e4%bb%b6%e5%8d%8f%e4%bd%9c%e6%b5%81%e7%a8%8b.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/Kubenetes%e7%bb%84%e4%bb%b6%e5%8d%8f%e4%bd%9c%e6%b5%81%e7%a8%8b.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä»¥åˆ›å»ºDeploymentä¸ºä¾‹ï¼Œç”¨æˆ·æˆ–æ§åˆ¶å™¨é€šè¿‡kubectlã€RestAPIæˆ–è€…å…¶ä»–å®¢æˆ·ç«¯å‘API-Serverå‘èµ·åˆ›å»ºdeploymentçš„è¯·æ±‚ï¼›&lt;/li&gt;
&lt;li&gt;API-Serveræ”¶åˆ°åˆ›å»ºè¯·æ±‚åï¼Œç»è¿‡è®¤è¯ã€é‰´æƒã€å‡†å…¥ä¸‰ä¸ªç¯èŠ‚åï¼Œå°†deploymentå¯¹è±¡ä¿å­˜åˆ°etcdä¸­ï¼Œè§¦å‘watchæœºåˆ¶ï¼Œé€šçŸ¥API-Serverï¼ŒAPI-Serverå†è°ƒç”¨ControllerManagerå¯¹åº”çš„deploymentæ§åˆ¶å™¨è¿›è¡Œæ“ä½œï¼›&lt;/li&gt;
&lt;li&gt;ControllerManagerä¸­çš„DeploymentControllerä¼šç›‘å¬API-Serverä¸­æ‰€æœ‰Deploymentçš„äº‹ä»¶å˜æ›´ï¼Œå½“æ”¶åˆ°è¯¥deploymentå¯¹è±¡çš„åˆ›å»ºäº‹ä»¶åï¼Œå°±ä¼šæ£€æŸ¥å½“å‰namespaceä¸­æ‰€æœ‰çš„ReplicaSetå¯¹è±¡ï¼Œåˆ¤æ–­å…¶å±æ€§æ˜¯å¦å­˜åœ¨è¯¥deploymentå¯¹è±¡ï¼Œå¦‚æœæ²¡æœ‰ï¼ŒDeploymentControllerä¼šå‘API-Serverå‘èµ·åˆ›å»ºReplicaSetå¯¹è±¡çš„è¯·æ±‚ï¼Œç»è¿‡API-Serverçš„æ£€æŸ¥åï¼Œå°†è¯¥ReplicaSetå¯¹è±¡ä¿å­˜åœ¨etcdä¸­ï¼Œè§¦å‘watchæœºåˆ¶é€šçŸ¥API-Serverè°ƒç”¨æ§åˆ¶å™¨&amp;hellip;ï¼›&lt;/li&gt;
&lt;li&gt;åŒä¸Šï¼Œä¼šè§¦å‘ReplicaSet Controllerçš„æ£€æŸ¥ï¼Œæœ€ååˆ›å»ºä¸€ä¸ªPodå¯¹è±¡ï¼Œä¿å­˜åœ¨etcdä¸­ï¼›&lt;/li&gt;
&lt;li&gt;Schedulerç›‘å¬åˆ°API-Serverä¸­æœ‰æ–°çš„Podå¯¹è±¡è¢«åˆ›å»ºï¼Œå°±ä¼šæŸ¥çœ‹Podæ˜¯å¦è¢«è°ƒåº¦ï¼Œå¦‚æœæ²¡æœ‰ï¼ŒSchedulerå°±ä¼šç»™å®ƒåˆ†é…ä¸€ä¸ªæœ€ä¼˜èŠ‚ç‚¹ï¼Œå¹¶æ›´æ–°Podå¯¹è±¡çš„&lt;code&gt;spec.nodeName&lt;/code&gt;å±æ€§ï¼Œéšåè¯¥Podå¯¹è±¡è¢«åŒæ­¥å›API-Serveré‡Œï¼Œå¹¶ä¿å­˜åœ¨etcdä¸­ï¼›&lt;/li&gt;
&lt;li&gt;æœ€åï¼ŒèŠ‚ç‚¹çš„kubeletä¼šä¸€ç›´ç›‘å¬API-Serverçš„Podèµ„æºå˜åŒ–ï¼Œå½“å‘ç°æœ‰æ–°çš„Podå¯¹è±¡åˆ†é…åˆ°è‡ªå·±æ‰€åœ¨çš„èŠ‚ç‚¹æ—¶ï¼Œkubeletå°±ä¼šé€šè¿‡gRPCé€šä¿¡ï¼Œé€šè¿‡CRIå‘å®¹å™¨è¿è¡Œæ—¶åˆ›å»ºå®¹å™¨ï¼Œè¿è¡Œèµ·æ¥ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;api-server&#34;&gt;API-Server&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;API-Server ä½œä¸ºç»Ÿä¸€å…¥å£ï¼Œä»»ä½•å¯¹æ•°æ®çš„æ“ä½œéƒ½å¿…é¡»ç»è¿‡ API-Serverã€‚API-Serverè´Ÿè´£å„ä¸ªæ¨¡å—ä¹‹é—´çš„é€šä¿¡ï¼Œé›†ç¾¤é‡Œçš„åŠŸèƒ½æ¨¡å—é€šè¿‡API-Serverå°†ä¿¡æ¯å­˜å…¥åˆ°etcdä¸­ï¼Œetcd å­˜å‚¨é›†ç¾¤çš„æ•°æ®ä¿¡æ¯ï¼Œå…¶ä»–æ¨¡å—é€šè¿‡API-Serverè¯»å–è¿™äº›ä¿¡æ¯ï¼Œå®ç°æ¥æ¨¡å—ä¹‹é—´çš„äº¤äº’ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä¸»è¦åœºæ™¯ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;èŠ‚ç‚¹ä¸Šçš„ Kubelet ä¼šå‘¨æœŸæ€§çš„è°ƒç”¨API-Serverçš„æ¥å£ï¼Œä¸ŠæŠ¥èŠ‚ç‚¹ä¿¡æ¯ï¼ŒAPI-Serverå°†èŠ‚ç‚¹ä¿¡æ¯æ›´æ–°åˆ°etcdä¸­&lt;/li&gt;
&lt;li&gt;èŠ‚ç‚¹ä¸Šçš„ Kubelet ä¼šé€šè¿‡API-Serverä¸Šçš„Watchæ¥å£ï¼Œç›‘å¬Podä¿¡æ¯ï¼Œåˆ¤æ–­Podæ˜¯è¦ä»æœ¬èŠ‚ç‚¹è¿›è¡Œè°ƒåº¦ã€åˆ é™¤è¿˜æ˜¯ä¿®æ”¹&lt;/li&gt;
&lt;li&gt;Controller Managerçš„Node-Controlleræ¨¡å—ä¼šé€šè¿‡API-Serverçš„Watchæ¥å£ï¼Œç›‘æ§èŠ‚ç‚¹ä¿¡æ¯ï¼Œè¿›è¡Œç›¸åº”çš„å¤„ç†&lt;/li&gt;
&lt;li&gt;Scheduleré€šè¿‡API-Serverçš„Watchæ¥å£ï¼Œç›‘å¬Podçš„ä¿¡æ¯è¿›è¡Œè°ƒåº¦&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;åŸç†&#34;&gt;åŸç†&lt;/h3&gt;
&lt;p&gt;API-Serveræœ¬è´¨ä¸Šä¹Ÿæ˜¯æ§åˆ¶å™¨é‚£ä¸€å¥—ï¼Œé€šè¿‡List-Watchå’Œç¼“å­˜æœºåˆ¶ï¼Œæ¥è§£å†³è¢«å¤§é‡è°ƒç”¨çš„é—®é¢˜ï¼Œä¿è¯æ¶ˆæ¯å®æ—¶æ€§ã€å¯é æ€§ã€é¡ºåºæ€§å’Œæ€§èƒ½ï¼Œå¦å¤–å…¶ä»–æ¨¡å—ä¹Ÿæ˜¯å·®ä¸å¤šçš„æœºåˆ¶ï¼Œå¯¹é›†ç¾¤ä¿¡æ¯è¿›è¡Œäº†ç¼“å­˜ï¼Œé€šè¿‡List-Watchè¿›è¡Œæ›´æ–°è¿›è¡Œä¿è¯ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æµç¨‹&#34;&gt;æµç¨‹&lt;/h3&gt;
&lt;p&gt;api-serveråœ¨æ”¶åˆ°è¯·æ±‚åï¼Œä¼šè¿›è¡Œä¸€ç³»åˆ—çš„æ‰§è¡Œé“¾è·¯ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;è®¤è¯ï¼šæ ¡éªŒå‘èµ·è¯·æ±‚çš„ç”¨æˆ·èº«ä»½æ˜¯å¦åˆæ³•ï¼Œæ”¯æŒå¤šç§æ–¹å¼å¦‚x509å®¢æˆ·ç«¯è¯ä¹¦è®¤è¯ã€é™æ€tokenè®¤è¯ã€webhookè®¤è¯&lt;/li&gt;
&lt;li&gt;é™é€Ÿï¼šé»˜è®¤è¯» 400/sï¼Œå†™ 200/sï¼Œ1.19ç‰ˆæœ¬ä»¥å‰ä¸æ”¯æŒæ ¹æ®è¯·æ±‚ç±»å‹è¿›è¡Œåˆ†ç±»ã€æŒ‰ä¼˜å…ˆçº§é™é€Ÿï¼Œ1.19ç‰ˆæœ¬ä»¥åæ”¯æŒå°†è¯·æ±‚æŒ‰é‡è¦ç¨‹åº¦åˆ†ç±»é™é€Ÿï¼Œæ”¯æŒå¤šç§Ÿæˆ·ï¼Œå¯æœ‰æ•ˆä¿éšœLeaderé€‰ä¸¾ä¹‹ç±»çš„é«˜ä¼˜å…ˆçº§è¯·æ±‚å¾—åˆ°åŠæ—¶å“åº”ï¼Œé˜²æ­¢ä¸€ä¸ªå¼‚å¸¸clientå¯¼è‡´æ•´ä¸ªé›†ç¾¤è¢«é™é€Ÿã€‚&lt;/li&gt;
&lt;li&gt;å®¡è®¡ï¼šè®°å½•ç”¨æˆ·å¯¹èµ„æºçš„è¯¦ç»†æ“ä½œè¡Œä¸º&lt;/li&gt;
&lt;li&gt;æˆæƒï¼šæ£€æŸ¥ç”¨æˆ·æ˜¯å¦æœ‰æƒé™å¯¹å…¶è®¿é—®çš„èµ„æºè¿›è¡Œç›¸å…³æ“ä½œï¼Œæ”¯æŒRBACã€ABACã€webhookï¼Œ1.12ç‰ˆæœ¬åé»˜è®¤æˆæƒæœºåˆ¶æ˜¯RBAC&lt;/li&gt;
&lt;li&gt;å‡†å…¥æ§åˆ¶ï¼šæä¾›åœ¨è®¿é—®èµ„æºå‰æ‹¦æˆªè¯·æ±‚çš„é™æ€å’ŒåŠ¨æ€æ‰©å±•èƒ½åŠ›ï¼Œå¦‚é•œåƒæ‹‰å–ç­–ç•¥ã€‚&lt;/li&gt;
&lt;li&gt;ä¸etcdäº¤äº’&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;è°ƒåº¦å™¨scheduler&#34;&gt;è°ƒåº¦å™¨Scheduler&lt;/h2&gt;
&lt;p&gt;ä¸»è¦èŒè´£å°±æ˜¯ä¸ºæ–°åˆ›å»ºçš„Podå¯»æ‰¾åˆé€‚çš„èŠ‚ç‚¹ï¼Œé»˜è®¤è°ƒåº¦å™¨ä¼šå…ˆè°ƒç”¨ä¸€ç»„å«Predicateçš„è°ƒåº¦ç®—æ³•æ£€æŸ¥æ¯ä¸ªNodeï¼Œå†è°ƒç”¨ä¸€ç»„å«Priorityçš„è°ƒåº¦ç®—æ³•ä¸ºä¸Šä¸€æ­¥ç»“æœé‡Œçš„æ¯ä¸ªNodeæ‰“åˆ†å’Œæ’åºï¼Œå°†æ–°åˆ›å»ºçš„Podè°ƒåº¦åˆ°å¾—åˆ†æœ€é«˜çš„Nodeä¸Šã€‚&lt;/p&gt;
&lt;h3 id=&#34;åŸç†-1&#34;&gt;åŸç†&lt;/h3&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/k8s%e9%bb%98%e8%ae%a4%e8%b0%83%e5%ba%a6%e5%8e%9f%e7%90%86.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/k8s%e9%bb%98%e8%ae%a4%e8%b0%83%e5%ba%a6%e5%8e%9f%e7%90%86.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ç¬¬ä¸€ä¸ªæ§åˆ¶å¾ªç¯å«Informer Pathï¼Œå®ƒä¼šå¯åŠ¨ä¸€ç³»åˆ—Informerï¼Œç›‘å¬etcdä¸­çš„Podã€Nodeã€Serviceç­‰ä¸è°ƒåº¦ç›¸å…³çš„APIå¯¹è±¡çš„å˜åŒ–ï¼Œå°†æ–°åˆ›å»ºçš„Podæ·»åŠ è¿›è°ƒåº¦é˜Ÿåˆ—ï¼Œé»˜è®¤çš„è°ƒåº¦é˜Ÿåˆ—æ˜¯ä¼˜å…ˆçº§é˜Ÿåˆ—ï¼›&lt;/p&gt;
&lt;p&gt;æ­¤å¤–ï¼Œè¿˜ä¼šå¯¹è°ƒåº¦å™¨ç¼“å­˜è¿›è¡Œæ›´æ–°ï¼Œå› ä¸ºéœ€è¦å°½æœ€å¤§å¯èƒ½å°†é›†ç¾¤ä¿¡æ¯CacheåŒ–ï¼Œä»¥æé«˜ä¸¤ä¸ªè°ƒåº¦ç®—æ³•ç»„çš„æ‰§è¡Œæ•ˆç‡ï¼Œè°ƒåº¦å™¨åªæœ‰åœ¨æ“ä½œCacheæ—¶ï¼Œæ‰ä¼šåŠ é”ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç¬¬äºŒä¸ªæ§åˆ¶å¾ªç¯å«Scheduling Pathï¼Œæ˜¯è´Ÿè´£Podè°ƒåº¦çš„ä¸»å¾ªç¯ï¼Œå®ƒä¼šä¸æ–­ä»è°ƒåº¦é˜Ÿåˆ—é‡Œå‡ºé˜Ÿä¸€ä¸ªPodï¼Œè°ƒç”¨&lt;strong&gt;Predicateç®—æ³•&lt;/strong&gt;ï¼ˆé¢„é€‰ï¼‰è¿›è¡Œè¿‡æ»¤ï¼ŒéªŒè¯Podæ˜¯å¦çœŸçš„èƒ½å¤Ÿåœ¨è¯¥èŠ‚ç‚¹ä¸Šè¿è¡Œï¼Œæ¯”å¦‚èµ„æºæ˜¯å¦å¯ç”¨ï¼Œç«¯å£æ˜¯å¦å ç”¨ä¹‹ç±»çš„é—®é¢˜ï¼Œå¾—åˆ°å¯ç”¨çš„Nodeï¼ŒPredicateç®—æ³•éœ€è¦çš„Nodeä¿¡æ¯ï¼Œéƒ½æ˜¯ä»Cacheé‡Œç›´æ¥æ‹¿åˆ°ï¼›&lt;/p&gt;
&lt;p&gt;ç„¶åè°ƒç”¨&lt;strong&gt;Prioritiesç®—æ³•&lt;/strong&gt;ï¼ˆä¼˜é€‰ï¼‰ä¸ºè¿™äº›é€‰å‡ºæ¥çš„Nodeè¿›è¡Œæ‰“åˆ†ï¼Œå¾—åˆ†æœ€é«˜çš„Nodeå°±æ˜¯æ­¤æ¬¡è°ƒåº¦çš„ç»“æœã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¾—åˆ°å¯è°ƒåº¦çš„Nodeåï¼Œè°ƒåº¦å™¨å°±ä¼šå°†Podå¯¹è±¡çš„nodeNameå­—æ®µçš„å€¼ï¼Œä¿®æ”¹ä¸ºNodeçš„åå­—ï¼Œå®ç°ç»‘å®šï¼Œæ­¤æ—¶ä¿®æ”¹çš„æ˜¯Cacheé‡Œçš„å€¼ï¼Œä¹‹åæ‰ä¼šåˆ›å»ºä¸€ä¸ªgoroutineå¼‚æ­¥å‘API Serverå‘èµ·æ›´æ–°Podçš„è¯·æ±‚ï¼Œå®ŒæˆçœŸæ­£çš„ç»‘å®šå·¥ä½œï¼›è¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºä¹è§‚ç»‘å®šã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Schedulerå†…ç½®å„ä¸ªé˜¶æ®µçš„æ’ä»¶ï¼ŒPredicateé¢„é€‰é˜¶æ®µå’ŒPrioritiesä¼˜é€‰é˜¶æ®µå°±ç®—éå†å›è°ƒæ’ä»¶æ±‚å‡ºå¯ç”¨çš„Nodeç»“æœã€‚æ‰€ä»¥å½“èŠ‚ç‚¹å¾ˆå¤šçš„æ—¶å€™ï¼Œå¦‚æœæ‰€æœ‰èŠ‚ç‚¹éƒ½éœ€è¦å‚ä¸é¢„å…ˆè°ƒåº¦çš„è¿‡ç¨‹ï¼Œå°±ä¼šå¯¼è‡´è°ƒåº¦çš„å»¶æ—¶å¾ˆé«˜ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/K8s%e8%b0%83%e5%ba%a6%e5%99%a8%e6%a1%86%e6%9e%b6%e6%89%a9%e5%b1%95%e7%82%b9.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/K8s%e8%b0%83%e5%ba%a6%e5%99%a8%e6%a1%86%e6%9e%b6%e6%89%a9%e5%b1%95%e7%82%b9.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;æ¯”å¦‚å¤§é›†ç¾¤æœ‰ 2500 ä¸ªèŠ‚ç‚¹, æ³¨å†Œçš„æ’ä»¶æœ‰ 10 ä¸ª, é‚£ä¹ˆ ç­›é€‰ Filter å’Œ æ‰“åˆ† Score è¿‡ç¨‹éœ€è¦è¿›è¡Œ 2500 * 10 * 2 = 50000 æ¬¡è®¡ç®—, æœ€åé€‰å®šä¸€ä¸ªæœ€é«˜åˆ†å€¼çš„èŠ‚ç‚¹æ¥ç»‘å®š pod. k8s scheduler è€ƒè™‘åˆ°äº†è¿™æ ·çš„æ€§èƒ½å¼€é”€, æ‰€ä»¥åŠ å…¥äº†ç™¾åˆ†æ¯”å‚æ•°æ§åˆ¶å‚ä¸é¢„é€‰çš„èŠ‚ç‚¹æ•°.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;numFeasibleNodesToFind&lt;/code&gt; æ–¹æ³•æ ¹æ®å½“å‰é›†ç¾¤çš„èŠ‚ç‚¹æ•°è®¡ç®—å‡ºå‚ä¸é¢„é€‰çš„èŠ‚ç‚¹æ•°é‡, æŠŠå‚ä¸ Filter çš„èŠ‚ç‚¹èŒƒå›´ç¼©å°, æ— éœ€å…¨é¢æ‰«ææ‰€æœ‰çš„èŠ‚ç‚¹, è¿™æ ·é¿å… k8s é›†ç¾¤ nodes å¤ªå¤šæ—¶, é€ æˆæ— æ•ˆçš„è®¡ç®—èµ„æºå¼€é”€.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;numFeasibleNodesToFind&lt;/code&gt; ç­–ç•¥æ˜¯è¿™æ ·çš„, å½“é›†ç¾¤èŠ‚ç‚¹å°äº 100 æ—¶, é›†ç¾¤ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹éƒ½å‚ä¸é¢„é€‰. è€Œå½“å¤§äº 100 æ—¶, åˆ™ä½¿ç”¨ä¸‹é¢çš„å…¬å¼è®¡ç®—æ‰«ææ•°. scheudler çš„ &lt;code&gt;percentageOfNodesToScore&lt;/code&gt; å‚æ•°é»˜è®¤ä¸º 0, æºç ä¸­ä¼šèµ‹å€¼ä¸º 50 %.&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;numAllNodes * (50 - numAllNodes/125) / 100
&lt;/code&gt;&lt;/pre&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;æ•´ä¸ª kubernetes scheduler è°ƒåº¦å™¨åªæœ‰ä¸€ä¸ªåç¨‹å¤„ç†ä¸»è°ƒåº¦å¾ªç¯ &lt;code&gt;scheduleOne&lt;/code&gt;, è™½ç„¶ kubernetes scheduler å¯ä»¥å¯åŠ¨å¤šä¸ªå®ä¾‹, ä½†å¯åŠ¨æ—¶éœ€è¦ leaderelection é€‰ä¸¾, åªæœ‰ leader æ‰å¯ä»¥å¤„ç†è°ƒåº¦, å…¶ä»–èŠ‚ç‚¹ä½œä¸º follower ç­‰å¾… leader å¤±æ•ˆ. ä¹Ÿå°±æ˜¯è¯´æ•´ä¸ª k8s é›†ç¾¤è°ƒåº¦æ ¸å¿ƒçš„å¹¶å‘åº¦ä¸º 1 ä¸ª.&lt;/p&gt;
&lt;p&gt;äº‘åŸç”Ÿç¤¾åŒºä¸­æœ‰äººä½¿ç”¨ kubemark æ¨¡æ‹Ÿ 2000 ä¸ªèŠ‚ç‚¹çš„è§„æ¨¡æ¥å‹æµ‹ kube-scheduler å¤„ç†æ€§èƒ½åŠæ—¶å»¶, æµ‹è¯•ç»“æœæ˜¯ 30s å†…å®Œæˆ 15000 ä¸ª pod è°ƒåº¦ä»»åŠ¡. è™½ç„¶ kube-scheduler æ˜¯å•å¹¶å‘æ¨¡å‹, ä½†ç”±äºé¢„é€‰å’Œä¼˜é€‰éƒ½å±äºè®¡ç®—å‹ä»»åŠ¡éé˜»å¡IO, åˆæœ‰ &lt;code&gt;percentageOfNodesToScore&lt;/code&gt; å‚æ•°ä¼˜åŒ–, æœ€é‡è¦çš„æ˜¯åˆ›å»º pod çš„æ“ä½œé€šå¸¸ä¸ä¼šå¤ªé«˜å¹¶å‘. è¿™å‡ ç‚¹ä¸‹æ¥å•å¹¶å‘æ¨¡å‹çš„ scheduler ä¹Ÿè¿˜å¯ä»¥æ¥å—çš„.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;è°ƒåº¦ç­–ç•¥&#34;&gt;è°ƒåº¦ç­–ç•¥&lt;/h3&gt;
&lt;p&gt;è°ƒåº¦çš„æœ¬è´¨æ˜¯è¿‡æ»¤ï¼Œé€šè¿‡ç­›é€‰æ‰€æœ‰èŠ‚ç‚¹ç»„ï¼Œé€‰å‡ºç¬¦åˆæ¡ä»¶çš„èŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;Predicatesé˜¶æ®µï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;code&gt;findNodesThatFitPod&lt;/code&gt; æ–¹æ³•ç”¨æ¥å®ç°è°ƒåº¦å™¨çš„é¢„é€‰è¿‡ç¨‹ï¼Œå…¶å†…éƒ¨è°ƒç”¨æ’ä»¶çš„ PreFilter å’Œ Filter æ–¹æ³•æ¥ç­›é€‰å‡ºç¬¦åˆ pod è¦æ±‚çš„ node èŠ‚ç‚¹é›†åˆã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;GeneralPredicatesç®—æ³•ç»„ï¼Œæœ€åŸºç¡€çš„è°ƒåº¦ç­–ç•¥ï¼Œç”±Admitæ“ä½œæ‰§è¡Œ
&lt;ul&gt;
&lt;li&gt;PodFitsResourcesï¼šæ£€æŸ¥èŠ‚ç‚¹æ˜¯å¦æœ‰Podçš„requestså­—æ®µæ‰€éœ€çš„èµ„æº&lt;/li&gt;
&lt;li&gt;PodFitsHostï¼šæ£€æŸ¥èŠ‚ç‚¹çš„å®¿ä¸»æœºåç§°æ˜¯å¦å’ŒPodçš„&lt;code&gt;spec.nodeName&lt;/code&gt;ä¸€è‡´&lt;/li&gt;
&lt;li&gt;PodFitsHostPortsï¼šæ£€æŸ¥Podç”³è¯·çš„å®¿ä¸»æœºç«¯å£&lt;code&gt;spec.nodePort&lt;/code&gt;æ˜¯å¦å·²ç»è¢«å ç”¨&lt;/li&gt;
&lt;li&gt;PodMatchNodeSelectorï¼šæ£€æŸ¥Podçš„nodeSelectoræˆ–nodeAffinityæŒ‡å®šçš„èŠ‚ç‚¹æ˜¯å¦ä¸å¾…è€ƒå¯ŸèŠ‚ç‚¹åŒ¹é…&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Volumeçš„æ£€æŸ¥
&lt;ul&gt;
&lt;li&gt;NodeDiskConflictï¼šæ£€æŸ¥å¤šä¸ªPodå£°æ˜çš„æŒä¹…åŒ–Volumeæ˜¯å¦æœ‰å†²çªï¼Œæ¯”å¦‚ä¸€ä¸ªAWS EBSä¸å…è®¸è¢«å¤šä¸ªPodä½¿ç”¨&lt;/li&gt;
&lt;li&gt;MaxPDVolumeCountPredicateï¼šæ£€æŸ¥èŠ‚ç‚¹ä¸ŠæŸä¸€ç±»å‹çš„æŒä¹…åŒ–Volumeæ˜¯å¦è¶…è¿‡è®¾å®šå€¼ï¼Œè¶…è¿‡åˆ™ä¸å…è®¸åŒç±»å‹Volumeçš„Podè°ƒåº¦åˆ°ä¸Šé¢å»&lt;/li&gt;
&lt;li&gt;VolumeZonePredicateï¼šæ£€æŸ¥æŒä¹…åŒ–Volumeçš„å¯ç”¨åŒº(Zone)æ ‡ç­¾ï¼Œæ˜¯å¦ä¸å¾…è€ƒå¯ŸèŠ‚ç‚¹çš„æ ‡ç­¾åŒ¹é…&lt;/li&gt;
&lt;li&gt;VolumeBindingPredicateï¼šæ£€æŸ¥Podå¯¹åº”çš„PVçš„nodeAffinityæ˜¯å¦ä¸æŸä¸ªèŠ‚ç‚¹çš„æ ‡ç­¾åŒ¹é…&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ä¸Nodeç›¸å…³çš„è§„åˆ™
&lt;ul&gt;
&lt;li&gt;PodToleratesNodeTaintsï¼šæ£€æŸ¥Podçš„Tolerationå­—æ®µæ˜¯å¦ä¸Nodeçš„Taintå­—æ®µåŒ¹é…&lt;/li&gt;
&lt;li&gt;NodeMeemoryPressurePredicateï¼šæ£€æŸ¥å½“å‰èŠ‚ç‚¹çš„å†…å­˜æ˜¯å¦å……è¶³&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ä¸Podç›¸å…³çš„è§„åˆ™ï¼Œä¸GeneralPredicatesç±»ä¼¼
&lt;ul&gt;
&lt;li&gt;PodAffinityPredicateï¼šæ£€æŸ¥å¾…è°ƒåº¦çš„Podä¸Nodeä¸Šå·²æœ‰çš„Podçš„äº²å’Œ(affinity)å’Œåäº²å’Œ(anti-affinity)çš„å…³ç³»&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç­›é€‰å‡ºå¯ç”¨Nodeä¹‹åï¼Œä¸ºè¿™äº›Nodeè¿›è¡Œæ‰“åˆ†&lt;/p&gt;
&lt;p&gt;Prioritiesé˜¶æ®µ(æ‰“åˆ†è§„åˆ™)ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;code&gt;prioritizeNodes&lt;/code&gt; æ–¹æ³•ä¸ºè°ƒåº¦å™¨çš„ä¼˜é€‰é˜¶æ®µçš„å®ç°. å…¶å†…éƒ¨ä¼šéå†è°ƒç”¨ framework çš„ PreScore æ’ä»¶é›†åˆé‡Œ &lt;code&gt;PeScore&lt;/code&gt; æ–¹æ³•, ç„¶åå†éå†è°ƒç”¨ framework çš„ Score æ’ä»¶é›†åˆçš„ &lt;code&gt;Score&lt;/code&gt; æ–¹æ³•. ç»è¿‡ Score æ‰“åˆ†è®¡ç®—åå¯ä»¥æ‹¿åˆ°å„ä¸ª node çš„åˆ†å€¼.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;LeastRequestedPriorityï¼šé€‰å‡ºç©ºé—²èµ„æºï¼ˆCPUå’ŒMemoryï¼‰æœ€å¤šçš„å®¿ä¸»æœºã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;score = (cpu((capacity - sum(requested))10 / capacity) + memory((capacity-sum(requested))10 / capacity)) / 2&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;BalancedResourceAllocationï¼šè°ƒåº¦å®Œæˆåï¼ŒèŠ‚ç‚¹å„ç§èµ„æºåˆ†é…æœ€å‡è¡¡çš„èŠ‚ç‚¹ï¼Œé¿å…å‡ºç°æœ‰äº›èŠ‚ç‚¹èµ„æºè¢«å¤§é‡åˆ†é…ï¼Œæœ‰äº›èŠ‚ç‚¹åˆ™å¾ˆç©ºé—²ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;score = 10 - variance(cpuFraction, memoryFraction, volumeFraction) * 10ï¼ŒFraction=Podè¯·æ±‚èµ„æº / èŠ‚ç‚¹ä¸Šå¯ç”¨èµ„æºï¼Œvariance=è®¡ç®—æ¯ä¸¤ç§Factionèµ„æºå·®æœ€å°çš„èŠ‚ç‚¹&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¯ä»¥ä¿®æ”¹è°ƒåº¦å™¨çš„é…ç½®ï¼Œè®©è°ƒåº¦å™¨åœ¨Predicatesæˆ–Prioritiesé˜¶æ®µé€‰æ‹©ä¸åŒçš„ç­–ç•¥ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å¸¸è§çš„è°ƒåº¦æ–¹å¼&#34;&gt;å¸¸è§çš„è°ƒåº¦æ–¹å¼&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Deploymentæˆ–RCï¼šè¯¥è°ƒåº¦ç­–ç•¥ä¸»è¦åŠŸèƒ½å°±æ˜¯è‡ªåŠ¨éƒ¨ç½²ä¸€ä¸ªå®¹å™¨åº”ç”¨çš„å¤šä»½å‰¯æœ¬ï¼Œä»¥åŠæŒç»­ç›‘æ§å‰¯æœ¬çš„æ•°é‡ï¼Œåœ¨é›†ç¾¤å†…å§‹ç»ˆç»´æŒç”¨æˆ·æŒ‡å®šçš„å‰¯æœ¬æ•°é‡ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;NodeSelectorï¼šå®šå‘è°ƒåº¦ï¼Œå½“éœ€è¦æ‰‹åŠ¨æŒ‡å®šå°†Podè°ƒåº¦åˆ°ç‰¹å®šNodeä¸Šï¼Œå¯ä»¥é€šè¿‡Nodeçš„æ ‡ç­¾ï¼ˆLabelï¼‰å’ŒPodçš„nodeSelectorå±æ€§ç›¸åŒ¹é…ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;NodeAffinityäº²å’Œæ€§è°ƒåº¦ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;requiredDuringSchedulingIgnoredDuringExecutionï¼šç¡¬è§„åˆ™ï¼Œå¿…é¡»æ»¡è¶³æŒ‡å®šçš„è§„åˆ™ï¼Œè°ƒåº¦å™¨æ‰å¯ä»¥è°ƒåº¦Podè‡³Nodeä¸Šï¼ˆç±»ä¼¼nodeSelectorï¼Œè¯­æ³•ä¸åŒï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;preferredDuringSchedulingIgnoredDuringExecutionï¼šè½¯è§„åˆ™ï¼Œä¼˜å…ˆè°ƒåº¦è‡³æ»¡è¶³çš„Nodeçš„èŠ‚ç‚¹ï¼Œä½†ä¸å¼ºæ±‚ï¼Œå¤šä¸ªä¼˜å…ˆçº§è§„åˆ™è¿˜å¯ä»¥è®¾ç½®æƒé‡å€¼ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Taintså’ŒTolerationsï¼ˆæ±¡ç‚¹å’Œå®¹å¿ï¼‰ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Taintï¼šä½¿Nodeæ‹’ç»ç‰¹å®šPodè¿è¡Œï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Tolerationï¼šä¸ºPodçš„å±æ€§ï¼Œè¡¨ç¤ºPodèƒ½å®¹å¿ï¼ˆè¿è¡Œï¼‰æ ‡æ³¨äº†Taintçš„Nodeã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;ä¼˜å…ˆçº§ä¸æŠ¢å æœºåˆ¶&#34;&gt;ä¼˜å…ˆçº§ä¸æŠ¢å æœºåˆ¶&lt;/h3&gt;
&lt;p&gt;ç»™Podè®¾ç½®ä¼˜å…ˆçº§ï¼Œä½¿å¾—é«˜ä¼˜å…ˆçº§çš„Podå¯ç”¨å…ˆè°ƒåº¦ï¼Œå³ä½¿è°ƒåº¦å¤±è´¥ä¹Ÿæ¯”ä½ä¼˜å…ˆçº§çš„Podæœ‰ä¼˜å…ˆè°ƒåº¦çš„æœºä¼šã€‚&lt;/p&gt;
&lt;p&gt;éœ€è¦å…ˆå®šä¹‰ä¸€ä¸ªPriorityClassçš„APIå¯¹è±¡æ‰èƒ½ç»™Podè®¾ç½®ä¼˜å…ˆçº§ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;scheduling.k8s.io/v1beta1 &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;PriorityClass &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;high-priority &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1000000&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;globalDefault&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;description&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;This priority class should be used for high priority service pods only.&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;---&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Podå†…&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;containers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;priorityClassName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;high-priority&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;PriorityClassé‡Œçš„valueå€¼è¶Šé«˜ï¼Œä¼˜å…ˆçº§è¶Šå¤§ï¼Œä¼˜å…ˆçº§æ˜¯ä¸€ä¸ª32bitçš„æ•´æ•°ï¼Œæœ€å¤§ä¸è¶…è¿‡ 10äº¿ï¼Œè¶…è¿‡10äº¿çš„å€¼æ˜¯Kubernetesä¿ç•™ç»™ç³»ç»ŸPodä½¿ç”¨ï¼Œä¿è¯ç³»ç»ŸPodä¸ä¼šè¢«ç”¨æˆ·PodæŠ¢å ï¼›globalDefaultä¸ºtrueè¡¨ç¤ºè¯¥PriorityClassçš„å€¼ä¼šæˆä¸ºç³»ç»Ÿé»˜è®¤å€¼ï¼Œä¸ºfalseè¡¨ç¤ºåªæœ‰ä½¿ç”¨äº†è¯¥PriorityClassçš„Podæ‰æœ‰ä¼˜å…ˆçº§ï¼Œæ²¡æœ‰å£°æ˜åˆ™é»˜è®¤æ˜¯0ã€‚&lt;/p&gt;
&lt;h4 id=&#34;æŠ¢å è¿‡ç¨‹&#34;&gt;æŠ¢å è¿‡ç¨‹&lt;/h4&gt;
&lt;p&gt;å½“ä¸€ä¸ªé«˜ä¼˜å…ˆçº§çš„Podè°ƒåº¦å¤±è´¥æ—¶ï¼Œè°ƒåº¦å™¨ä¼šè¯•å›¾ä»å½“å‰é›†ç¾¤é‡Œå¯»æ‰¾ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå½“è¯¥èŠ‚ç‚¹ä¸Šçš„ä¸€ä¸ªæˆ–å¤šä¸ªä½ä¼˜å…ˆçº§çš„Podè¢«åˆ é™¤åï¼Œå¾…è°ƒåº¦çš„é«˜ä¼˜å…ˆçº§çš„Podå¯ä»¥è¢«è°ƒåº¦åˆ°è¯¥èŠ‚ç‚¹ä¸Šï¼Œä½†æ˜¯æŠ¢å è¿‡ç¨‹ä¸æ˜¯ç«‹å³å‘ç”Ÿï¼Œè€Œåªæ˜¯åœ¨å¾…è°ƒåº¦çš„é«˜ä¼˜å…ˆçº§çš„Podä¸Šå…ˆè®¾ç½®&lt;code&gt;spec.nominatedNodeName=Nodeåå­—&lt;/code&gt;ï¼Œç­‰åˆ°ä¸‹ä¸€ä¸ªè°ƒåº¦å‘¨æœŸå†å†³å®šæ˜¯å¦é’ˆå¯¹è¦è¿è¡Œåœ¨è¯¥èŠ‚ç‚¹ä¸Šï¼Œä¹‹æ‰€ä»¥è¿™ä¹ˆåšæ˜¯å› ä¸ºè¢«åˆ é™¤çš„Podæœ‰é»˜è®¤çš„30ç§’ä¼˜é›…é€€å‡ºæ—¶é—´ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œå¯èƒ½æœ‰æ–°çš„æ›´åŠ è¢«é€‚åˆç»™é«˜ä¼˜å…ˆçº§è°ƒåº¦çš„èŠ‚ç‚¹åŠ å…¥ã€‚&lt;/p&gt;
&lt;h4 id=&#34;æŠ¢å åŸç†&#34;&gt;æŠ¢å åŸç†&lt;/h4&gt;
&lt;p&gt;æŠ¢å ç®—æ³•çš„å®ç°åŸºäºä¸¤ä¸ªé˜Ÿåˆ—ï¼Œä¸€ä¸ªæ˜¯activeQé˜Ÿåˆ—ï¼Œå­˜æ”¾ä¸‹ä¸€ä¸ªè°ƒåº¦å‘¨æœŸé‡Œéœ€è¦è°ƒåº¦çš„Podï¼›å¦ä¸€ä¸ªæ˜¯unschedulableQé˜Ÿåˆ—ï¼Œå­˜æ”¾è°ƒåº¦å¤±è´¥çš„Podï¼Œå½“ä¸€ä¸ªunschedulableQé‡Œçš„Podè¢«æ›´æ–°ä¹‹åï¼Œè°ƒåº¦å™¨å°±ä¼šæŠŠè¯¥Podç§»åŠ¨åˆ°activeQé‡Œï¼›&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å½“è°ƒåº¦å¤±è´¥æ—¶ï¼ŒæŠ¢å ç®—æ³•å¼€å§‹å·¥ä½œï¼Œé¦–å…ˆä¼šæ£€æŸ¥è°ƒåº¦å¤±è´¥çš„åŸå› ï¼Œåˆ¤æ–­æ˜¯å¦å¯ä»¥ä¸ºè°ƒåº¦å¤±è´¥çš„Podå¯»æ‰¾ä¸€ä¸ªæ–°èŠ‚ç‚¹ï¼›&lt;/li&gt;
&lt;li&gt;ä¹‹åè°ƒåº¦å™¨ä¼šæŠŠè‡ªå·±ç¼“å­˜çš„æ‰€æœ‰èŠ‚ç‚¹ä¿¡æ¯å¤åˆ¶ä¸€ä»½ï¼Œé€šè¿‡è¿™ä»½å‰¯æœ¬æ¨¡æ‹ŸæŠ¢å è¿‡ç¨‹ï¼Œæ‰¾å‡ºå¯ä»¥ä½¿ç”¨çš„èŠ‚ç‚¹å’Œéœ€è¦è¢«åˆ é™¤çš„Podåˆ—è¡¨ï¼Œç¡®å®šæŠ¢å æ˜¯å¦å¯ä»¥å‘ç”Ÿï¼›&lt;/li&gt;
&lt;li&gt;æ‰§è¡ŒçœŸæ­£çš„æŠ¢å å·¥ä½œï¼Œæ£€æŸ¥è¦è¢«åˆ é™¤çš„Podåˆ—è¡¨ï¼ŒæŠŠè¿™äº›Podçš„nominatedNodeNameå­—æ®µæ¸…é™¤ï¼Œä¸ºé«˜ä¼˜å…ˆçº§çš„Podçš„nominatedNodeNameå­—æ®µè®¾ç½®ä¸ºèŠ‚ç‚¹åç§°ï¼Œä¹‹åå¯åŠ¨ä¸€ä¸ªåç¨‹ï¼Œç§»é™¤éœ€è¦åˆ é™¤çš„Podã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ç¬¬2æ­¥å’Œç¬¬3æ­¥éƒ½æ‰§è¡Œäº†æŠ¢å ç®—æ³•Predicatesï¼Œåªæœ‰è¿™ä¸¤éæŠ¢å ç®—æ³•éƒ½é€šè¿‡ï¼Œæ‰ç®—æŠ¢å æˆåŠŸï¼Œä¹‹æ‰€ä»¥è¦ä¸¤æ¬¡ï¼Œæ˜¯å› ä¸ºéœ€è¦æ»¡è¶³InterPodAntiAffinityè§„åˆ™å’Œä¸‹ä¸€æ¬¡è°ƒåº¦å‘¨æœŸä¸ä¸€å®šä¼šè°ƒåº¦åœ¨è¯¥èŠ‚ç‚¹çš„æƒ…å†µã€‚&lt;/p&gt;
&lt;h3 id=&#34;è‡ªå®šä¹‰è°ƒåº¦&#34;&gt;è‡ªå®šä¹‰è°ƒåº¦&lt;/h3&gt;
&lt;p&gt;K8sæœ‰é»˜è®¤çš„è°ƒåº¦å™¨ï¼Œget Pod -o yamlæ—¶èƒ½çœ‹åˆ°ï¼Œ &lt;code&gt;pod.spec.schedulerName: default-scheduler&lt;/code&gt;ï¼Œæ‰€ä»¥å¯ä»¥è®¾ç½®è¯¥å€¼æ¥é€‰æ‹©å…·ä½“æŸä¸€ä¸ªè°ƒåº¦å™¨æ¥å®ç°è°ƒåº¦ã€‚&lt;/p&gt;
&lt;p&gt;æœ‰ä¸¤ç§æ–¹å¼å®ç°è‡ªå®šä¹‰è°ƒåº¦ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;é€šè¿‡K8sé»˜è®¤è°ƒåº¦å™¨Pluginæœºåˆ¶å®ç°ï¼Œscheduling-frameworkåœ¨è°ƒåº¦å‘¨æœŸå’Œç»‘å®šå‘¨æœŸæä¾›äº†å¾ˆå¤šä¸°å¯Œçš„æ‰©å±•ç‚¹ï¼Œåœ¨è¿™äº›æ‰©å±•ç‚¹ä¸Šå¯ä»¥å®ç°è‡ªå®šä¹‰è°ƒåº¦é€»è¾‘ã€‚&lt;/p&gt;
&lt;p&gt;è‡ªå®šä¹‰æ’ä»¶æœ‰ä¸‰ä¸ªæ­¥éª¤ï¼š1ã€å†™ä¸€ä¸ªgoç¨‹åºï¼Œå®ç°è°ƒåº¦å™¨çš„æ’ä»¶æ¥å£ï¼›2ã€ç¼–å†™é…ç½®æ–‡ä»¶&lt;code&gt;KubeSchedulerConfiguration&lt;/code&gt;ï¼›3ã€å°†è‡ªå®šä¹‰æ’ä»¶ç¼–è¯‘è¿›é»˜è®¤è°ƒåº¦å™¨ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;K8sä¹Ÿæ”¯æŒéƒ¨ç½²å¤šä¸ªè°ƒåº¦å™¨ï¼Œä¹Ÿå¯ä»¥åŸºäºscheduling-frameworkç¼–å†™ä¸€ä¸ªæ–°çš„è°ƒåº¦å™¨ï¼Œä»¥podçš„å½¢å¼éƒ¨ç½²åˆ°é›†ç¾¤ï¼Œé€šè¿‡podçš„&lt;code&gt;pod.spec.schedulerName&lt;/code&gt;æŒ‡å®šè°ƒåº¦å™¨ï¼Œè‡ªå®šä¹‰çš„è°ƒåº¦å™¨åªèƒ½ä»¥ä¸»å¤‡çš„æ–¹å¼éƒ¨ç½²ï¼ŒLeaderåªèƒ½æœ‰ä¸€ä¸ªï¼Œä¿è¯ä¸ä¼šå¹¶å‘å¤„ç†ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;kubeletå’Œcri&#34;&gt;Kubeletå’ŒCRI&lt;/h2&gt;
&lt;p&gt;Kubeletæœ¬è´¨ä¹Ÿæ˜¯ä¸€ä¸ªæ§åˆ¶å¾ªç¯SyncLoopï¼Œåœ¨è¿™ä¸ªæ§åˆ¶å¾ªç¯é‡ŒåˆåŒ…å«äº†å¾ˆå¤šå°çš„æ§åˆ¶å¾ªç¯ï¼Œæ¯ä¸ªæ§åˆ¶å¾ªç¯æœ‰è‡ªå·±çš„èŒè´£ï¼Œæ¯”å¦‚Volume Managerã€Image Managerã€Node Status Managerã€CPU Managerç­‰ï¼Œè€Œé©±åŠ¨æ•´ä¸ªä¸»çš„æ§åˆ¶å¾ªç¯çš„äº‹ä»¶æœ‰å››ç§ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Podçš„æ›´æ–°äº‹ä»¶&lt;/li&gt;
&lt;li&gt;Podç”Ÿå‘½å‘¨æœŸå˜åŒ–&lt;/li&gt;
&lt;li&gt;Kubeletæœ¬èº«è®¾ç½®çš„æ‰§è¡Œå‘¨æœŸ&lt;/li&gt;
&lt;li&gt;å®šæœŸçš„æ¸…ç†äº‹ä»¶&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æ¯ä¸ªèŠ‚ç‚¹ä¸Šçš„Kubeleté‡Œçš„SyncLoopä¸»æ§åˆ¶å¾ªç¯é€šè¿‡Watchæœºåˆ¶ï¼Œç›‘å¬nodeNameæ˜¯è‡ªå·±èŠ‚ç‚¹çš„Podï¼Œåœ¨å†…å­˜é‡Œç¼“å­˜è¿™äº›Podçš„ä¿¡æ¯å’ŒçŠ¶æ€ï¼Œå½“æ¥æ”¶åˆ°æ–°äº‹ä»¶æ—¶ï¼Œæ‰§è¡Œç›¸åº”çš„æ“ä½œã€‚åœ¨ç®¡ç†Podå†…çš„å®¹å™¨æ—¶ï¼Œä¸ä¼šç›´æ¥è°ƒç”¨dockerçš„APIï¼Œè€Œæ˜¯é€šè¿‡CRIçš„grpcæ¥å£æ¥é—´æ¥æ‰§è¡Œï¼Œè¿™æ ·æ— è®ºåº•å±‚å®¹å™¨å¯ä»¥ç®€å•çš„ä»dockeræ¢æˆå…¶ä»–å®¹å™¨ç¨‹åºã€‚&lt;/p&gt;
&lt;p&gt;æ¯å°å·¥ä½œèŠ‚ç‚¹ä¸Šçš„dockerå®¹å™¨ä¼šä½¿ç”¨dockershimæä¾›CRIæ¥å£ï¼Œæ¥ä¸kubeletäº¤äº’ï¼Œå¦‚æœä¸æ˜¯ä½¿ç”¨dockerå®¹å™¨ï¼Œåˆ™éœ€è¦é¢å¤–éƒ¨ç½²CRI shimæ¥å¤„ç†ï¼Œé€šè¿‡è¿™äº›shimè½¬å‘kubeletçš„è¯·æ±‚æ¥æ“ä½œå®¹å™¨ã€‚&lt;/p&gt;
&lt;p&gt;CRIæ˜¯å¯¹å®¹å™¨æ“ä½œç›¸å…³çš„æ¥å£ï¼Œè€Œä¸æ˜¯å¯¹äºPodï¼Œåˆ†ä¸ºä¸¤ç»„ç±»å‹çš„APIï¼Œ&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;RuntimeServiceï¼šå¤„ç†å®¹å™¨ç›¸å…³æ“ä½œï¼Œæ¯”å¦‚åˆ›å»ºå’Œå¯åŠ¨å®¹å™¨ï¼Œåˆ é™¤å®¹å™¨ï¼Œæ‰§è¡Œå‘½ä»¤&lt;/li&gt;
&lt;li&gt;ImageServiceï¼šå¤„ç†å®¹å™¨é•œåƒçš„ç›¸å…³æ“ä½œï¼Œæ¯”å¦‚æ‹‰å–é•œåƒã€åˆ é™¤é•œåƒ&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/CRI_work_flow.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/CRI_work_flow.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;h3 id=&#34;execå‘½ä»¤æ‰§è¡ŒåŸç†&#34;&gt;execå‘½ä»¤æ‰§è¡ŒåŸç†&lt;/h3&gt;
&lt;p&gt;å¯¹æ ‡dockerçš„execå‘½ä»¤ï¼Œdockerçš„execåŸç†ï¼šä¸€ä¸ªè¿›ç¨‹å¯ä»¥é€‰æ‹©åŠ å…¥æŸä¸ªè¿›ç¨‹å·²æœ‰çš„Namespaceä¸­ï¼Œä»è€Œè¾¾åˆ°è¿›å…¥å®¹å™¨çš„ç›®çš„ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/kubectl_exec_%e5%91%bd%e4%bb%a4%e5%8e%9f%e7%90%86.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/kubectl_exec_%e5%91%bd%e4%bb%a4%e5%8e%9f%e7%90%86.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;è¿™é‡Œä»¥dockerä½œä¸ºå®¹å™¨å¼•æ“ä¸ºä¾‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;kubectlæ‰§è¡Œexecå‘½ä»¤åï¼Œé¦–å…ˆå‘é€Getè¯·æ±‚åˆ°API-Serverï¼Œè·å–podçš„ç›¸å…³ä¿¡æ¯ï¼›&lt;/li&gt;
&lt;li&gt;è·å–åˆ°ä¿¡æ¯åï¼Œkubectlå†å‘é€Postè¯·æ±‚ï¼ŒAPI-Serverè¿”å›&lt;code&gt;101 upgrade&lt;/code&gt;å“åº”ç»™kubectlï¼Œè¡¨ç¤ºåˆ‡æ¢åˆ° SPDY åè®®ã€‚SPDYåè®®å…è®¸åœ¨å•ä¸ªTCPè¿æ¥ä¸Šå¤ç”¨ç‹¬ç«‹çš„ stdin / stdout / stderr / spdy-err æµã€‚&lt;/li&gt;
&lt;li&gt;API-Serveræ‰¾åˆ°å¯¹åº”çš„Podå’Œå®¹å™¨ï¼Œå°†Postè¯·æ±‚è½¬å‘åˆ°èŠ‚ç‚¹çš„Kubeletï¼Œå†è½¬å‘åˆ°å‘å¯¹åº”å®¹å™¨çš„Docker shimè¯·æ±‚ä¸€ä¸ªæµå¼ç«¯ç‚¹URLï¼Œå¹¶å°†execè¯·æ±‚è½¬å‘åˆ°Docker exec APIã€‚Kubeletå†å°†è¿™ä¸ªURLä»¥ redirect çš„æ–¹å¼è¿”å›ç»™API-Serverï¼Œè¯·æ±‚å°±ä¼šé‡å®šå‘åˆ°å¯¹åº”çš„Streaming Serverä¸Šå‘èµ·execè¯·æ±‚ï¼Œå¹¶ç»´æŠ¤é•¿è¿æ¥ï¼Œä¹‹åå°±æ˜¯åœ¨è¿™ä¸ªé•¿è¿æ¥çš„åŸºç¡€ä¸Šæ‰§è¡Œå‘½ä»¤å’Œè·å–ç»“æœäº†ã€‚&lt;/li&gt;
&lt;li&gt;ä¹‹åï¼Œç”¨æˆ·ç«¯å°±å¯ä»¥å’ŒAPI-Serveré€šä¿¡ï¼Œæ¯”å¦‚æ‰§è¡Œå®¹å™¨é‡Œçš„å‘½ä»¤ï¼ŒAPI-Serverä¼šè½¬å‘å‘½ä»¤åˆ°å®¹å™¨ï¼Œæˆ–è€…è½¬å‘å®¹å™¨å†…çš„æ‰§è¡Œç»“æœç»™ç”¨æˆ·ç«¯ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;é™¤äº†execå‘½ä»¤æ„å¤–ï¼Œå…¶ä»–çš„å¦‚ attachã€port-forwardã€logs ç­‰å‘½ä»¤ä¹Ÿæ˜¯ç±»ä¼¼çš„æ¨¡å¼ã€‚&lt;/p&gt;
&lt;h3 id=&#34;èŠ‚ç‚¹notreadyåŸå› &#34;&gt;èŠ‚ç‚¹NotReadyåŸå› &lt;/h3&gt;
&lt;p&gt;notReadyä¸€èˆ¬æ˜¯å› ä¸ºèŠ‚ç‚¹çš„Kubeletæ— æ³•ä¸API-Serveré€šä¿¡ï¼Œå¯¼è‡´æ²¡åŠæ³•æŠŠèŠ‚ç‚¹çš„ä¿¡æ¯åŠæ—¶åŒæ­¥ç»™API-Serverï¼Œæ­¤æ—¶èŠ‚ç‚¹å°±ä¼šè¢«æ ‡è®°ä¸ºNotReadyï¼Œæ‰€ä»¥é—®é¢˜å°±å˜æˆäº†ï¼Œä¸ºå•¥Kubeletæ— æ³•ä¸API-Serveré€šä¿¡ï¼ŒåŸå› ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Kubeletå¯åŠ¨å¤±è´¥&lt;/li&gt;
&lt;li&gt;ç½‘ç»œç»„ä»¶æ•…éšœï¼Œå¯¼è‡´æ— æ³•é€šä¿¡&lt;/li&gt;
&lt;li&gt;é›†ç¾¤ç½‘ç»œåˆ†åŒº&lt;/li&gt;
&lt;li&gt;èŠ‚ç‚¹OOM&lt;/li&gt;
&lt;li&gt;Kubeletä¸å®¹å™¨é€šä¿¡æ—¶å“åº”è¶…æ—¶ï¼Œæ­»é”ï¼Œå¯¼è‡´æ— æ³•å¤„ç†å…¶ä»–äº‹æƒ…&lt;/li&gt;
&lt;li&gt;èŠ‚ç‚¹ä¸ŠPodçš„æ•°é‡å¤ªå¤šï¼Œå¯¼è‡´relistæ“ä½œæ— æ³•åœ¨3åˆ†é’Ÿå†…å®Œæˆ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å½“èŠ‚ç‚¹å‡ºç°NotReadyæ—¶ï¼ŒèŠ‚ç‚¹ä¸Šçš„å®¹å™¨ä¾ç„¶å¯ä»¥æä¾›æœåŠ¡ï¼Œåªæ˜¯è„±ç¦»äº†Kubenetesçš„è°ƒåº¦ï¼Œä¸ä¼šåšä»»ä½•æ”¹å˜ï¼Œæ­¤æ—¶Kubernetesä¼šå°†NotReadyèŠ‚ç‚¹ä¸Šçš„Podè°ƒåº¦åˆ°å…¶ä»–æ­£å¸¸çš„èŠ‚ç‚¹ä¸Šã€‚&lt;/p&gt;
&lt;p&gt;æ—¶é—´æ®µï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Kubeleté»˜è®¤æ¯&lt;strong&gt;10s&lt;/strong&gt;ä¼šä¸ŠæŠ¥ä¸€æ¬¡èŠ‚ç‚¹çš„æ•°æ®åˆ°API-Serverï¼Œå¯ä»¥é€šè¿‡å‚æ•°&lt;code&gt;--node-status-update-frequency&lt;/code&gt;é…ç½®ä¸ŠæŠ¥é¢‘ç‡ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Controller-Managerä¼šå®šæ—¶æ£€æŸ¥Kubeletçš„çŠ¶æ€ï¼Œé»˜è®¤æ˜¯&lt;strong&gt;5s&lt;/strong&gt;ï¼Œå¯ä»¥é€šè¿‡å‚æ•°&lt;code&gt;--node-monitor-period&lt;/code&gt;é…ç½®ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Kubeletåœ¨æ›´æ–°çŠ¶æ€å¤±è´¥æ—¶ï¼Œä¼šè¿›è¡Œé‡è¯•ï¼Œé»˜è®¤æ˜¯&lt;strong&gt;5æ¬¡&lt;/strong&gt;ï¼Œå¯é€šè¿‡å‚æ•°&lt;code&gt;nodeStatusUpdateRetry&lt;/code&gt;é…ç½®ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å½“èŠ‚ç‚¹å¤±è”ä¸€æ®µæ—¶é—´åï¼ŒèŠ‚ç‚¹å°±ä¼šè¢«åˆ¤å®šä¸ºNotReadyçŠ¶æ€ï¼Œé»˜è®¤æ—¶é—´æ˜¯&lt;strong&gt;40s&lt;/strong&gt;ï¼Œå¯é€šè¿‡å‚æ•°&lt;code&gt;--node-monitor-grace-period&lt;/code&gt;é…ç½®ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;NotReadyä¸€æ®µæ—¶é—´åï¼ŒèŠ‚ç‚¹çš„çŠ¶æ€è½¬ä¸ºUnHealthyçŠ¶æ€ï¼Œé»˜è®¤æ—¶é—´æ˜¯&lt;strong&gt;1m&lt;/strong&gt;ï¼Œå¯é€šè¿‡å‚æ•°&lt;code&gt;--node-startup-grace-period&lt;/code&gt;é…ç½®ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å½“èŠ‚ç‚¹UnHealthyçŠ¶æ€ä¸€æ®µæ—¶é—´åï¼ŒèŠ‚ç‚¹ä¸Šçš„Podå°†è¢«è½¬ç§»ï¼Œé»˜è®¤æ˜¯&lt;strong&gt;5m&lt;/strong&gt;ï¼Œå¯é€šè¿‡å‚æ•°&lt;code&gt;--pod-eviction-timeout&lt;/code&gt;é…ç½®ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç”±äºController-Managerå’ŒKubeletæ˜¯å¼‚æ­¥å·¥ä½œï¼Œå¯èƒ½å­˜åœ¨ä¿¡æ¯è·å–çš„å»¶è¿Ÿï¼Œæ‰€ä»¥Podæ•´ä½“è¢«è¿ç§»çš„æ—¶é—´ä¹Ÿä¼šæœ‰å»¶è¿Ÿã€‚&lt;/p&gt;
&lt;p&gt;Kubernetes 1.13ç‰ˆæœ¬åï¼ŒèŠ‚ç‚¹å¤„äºä¸åŒçš„çŠ¶æ€æ—¶å°†è¢«æ‰“ä¸Šä¸åŒçš„æ±¡ç‚¹ï¼ŒèŠ‚ç‚¹ä¸Šçš„Podå°±å¯ä»¥åŸºäºæ±¡ç‚¹åœ¨ä¸åŒçš„çŠ¶æ€è¢«é©±é€äº†ï¼Œè¿™ä¸ªæ—¶å€™Podè¢«è¿ç§»çš„æ—¶é—´å°±ä¸å®šäº†ã€‚&lt;/p&gt;
&lt;h2 id=&#34;etcd&#34;&gt;etcd&lt;/h2&gt;
&lt;p&gt;etcdä½œä¸ºKubernetesçš„å…ƒæ•°æ®å­˜å‚¨ï¼ŒAPI-Serveræ˜¯å”¯ä¸€ç›´æ¥è·Ÿetcdäº¤äº’çš„ç»„ä»¶ï¼ŒAPI-Serverå¯¹å¤–æä¾›çš„ç›‘å¬æœºåˆ¶åº•å±‚å®ç°å°±æ˜¯etcdçš„watchã€‚&lt;/p&gt;
&lt;h3 id=&#34;èµ„æºå­˜å‚¨æ ¼å¼&#34;&gt;èµ„æºå­˜å‚¨æ ¼å¼&lt;/h3&gt;
&lt;p&gt;èµ„æºä»¥ &lt;code&gt;prefix + / + èµ„æºç±»å‹ + / + namespace + / + å…·ä½“èµ„æºåç§°&lt;/code&gt; ç»„æˆï¼Œä½œä¸ºkeyã€‚åŸºäºetcdæä¾›çš„èŒƒå›´æŸ¥è¯¢èƒ½åŠ›ï¼Œæ”¯æŒæŒ‰å…·ä½“èµ„æºåç§°æŸ¥è¯¢ã€namespaceæŸ¥è¯¢ã€‚é»˜è®¤çš„prefixæ˜¯ /registryã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºåŸºäºlabelæŸ¥è¯¢ï¼Œæ˜¯ç”±API-Serveré€šè¿‡èŒƒå›´æŸ¥è¯¢éå†etcdè·å–åŸå§‹æ•°æ®ï¼Œç„¶åå†é€šè¿‡labelè¿‡æ»¤ã€‚&lt;/p&gt;
&lt;h3 id=&#34;èµ„æºåˆ›å»ºæµç¨‹&#34;&gt;èµ„æºåˆ›å»ºæµç¨‹&lt;/h3&gt;
&lt;p&gt;åˆ›å»ºèµ„æºæ—¶ï¼Œä¼šç»è¿‡ BeforeCreate ç­–ç•¥åšetcdçš„åˆå§‹åŒ–å·¥ä½œï¼ŒStorgae.Createæ¥å£è°ƒç”¨etcdè¿›è¡Œå­˜å‚¨ï¼Œæœ€ååœ¨ç»è¿‡AfterCreateå’ŒDecoratorã€‚&lt;/p&gt;
&lt;p&gt;ç”±äºputå¹¶ä¸æ˜¯å¹¶å‘å®‰å…¨çš„æ¥å£ï¼Œå¹¶å‘æ—¶å¯èƒ½å¯¼è‡´keyè¦†ç›–ï¼Œæ‰€ä»¥API-Serverä¼šè°ƒç”¨Txnæ¥å£å°†æ•°æ®å†™å…¥etcdã€‚&lt;/p&gt;
&lt;p&gt;å½“èµ„æºä¿¡æ¯å†™å…¥etcdåï¼ŒAPI-Serverå°±ä¼šè¿”å›ç»™å®¢æˆ·ç«¯äº†ã€‚èµ„æºçš„çœŸæ­£åˆ›å»ºæ˜¯åŸºäºetcdçš„Watchæœºåˆ¶ã€‚&lt;/p&gt;
&lt;p&gt;controller-managerå†…é…å¤‡å¤šç§èµ„æºæ§åˆ¶å™¨ï¼Œå½“è§¦å‘etcdçš„Watchæœºåˆ¶æ—¶ä¼šé€šçŸ¥api-serverï¼Œapi-serveråœ¨è°ƒç”¨å¯¹åº”çš„æ§åˆ¶å™¨è¿›è¡Œèµ„æºçš„åˆ›å»ºã€‚æ¯”å¦‚ï¼Œå½“æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªdeploymentèµ„æºå†™å…¥etcdï¼Œé€šè¿‡Watchæœºåˆ¶ï¼Œé€šçŸ¥ç»™api-serverï¼Œapi-serverè°ƒç”¨controller-manageré‡Œçš„deployment-controlleråˆ›å»ºReplicaSetèµ„æºå¯¹è±¡ï¼Œå†™å…¥etcdï¼Œå†æ¬¡è§¦å‘Watchæœºåˆ¶ï¼Œç»è¿‡api-serverè°ƒç”¨ReplicaSet-controllerï¼Œåˆ›å»ºä¸€ä¸ªå¾…è°ƒåº¦çš„Podèµ„æºï¼Œå†™å…¥etcdï¼Œè§¦å‘Watchæœºåˆ¶ï¼Œç»è¿‡api-serverï¼Œschedulerç›‘å¬åˆ°å¾…è°ƒåº¦çš„Podï¼Œå°±ä¼šä¸ºå…¶åˆ†é…èŠ‚ç‚¹ï¼Œé€šè¿‡api-serverçš„Bindæ¥å£ï¼Œå°†è°ƒåº¦åçš„èŠ‚ç‚¹IPç»‘å®šåˆ°Podèµ„æºä¸Šã€‚kubeleté€šè¿‡åŒæ ·çš„Watchæœºåˆ¶æ„ŸçŸ¥åˆ°æ–°å»ºçš„Podï¼Œå‘èµ·Podåˆ›å»ºæµç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;Kubernetesä¸­ä½¿ç”¨Resource Versionå®ç°å¢é‡ç›‘å¬é€»è¾‘ï¼Œé¿å…å®¢æˆ·ç«¯å› ä¸ºç½‘ç»œç­‰å¼‚å¸¸å‡ºç°ä¸­æ–­åï¼Œæ•°æ®æ— æ³•åŒæ­¥çš„é—®é¢˜ï¼›åŒæ—¶ï¼Œå®¢æˆ·ç«¯å¯é€šè¿‡å®ƒæ¥åˆ¤æ–­èµ„æºæ˜¯å¦å‘ç”Ÿå˜åŒ–ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨Getè¯·æ±‚ä¸­ResourceVersionæœ‰ä¸‰ç§å–å€¼ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;æœªæŒ‡å®šï¼Œé»˜è®¤ä¸ºç©ºä¸²ï¼šAPI-Serveræ”¶åˆ°åä¼šå‘etcdå‘èµ·å…±è¯†è¯»/çº¿æ€§è¯»ï¼Œè·å–é›†ç¾¤æœ€æ–°æ•°æ®ï¼Œæ‰€ä»¥åœ¨é›†ç¾¤è§„æ¨¡è¾ƒå¤§æ—¶ï¼ŒæœªæŒ‡å®šæŸ¥çš„æ€§èƒ½ä¼šæ¯”è¾ƒå·®ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;=å­—ç¬¦ä¸²0ï¼šAPI-Serveræ”¶åˆ°åä¼šè¿”å›ä»»æ„èµ„æºç‰ˆæœ¬å·çš„æ•°æ®ï¼Œä¼˜å…ˆè¿”å›æœ€æ–°ç‰ˆæœ¬ï¼›ä¸€èˆ¬æƒ…å†µä¸‹å…ˆä»API-Serverç¼“å­˜ä¸­è·å–æ•°æ®è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œæœ‰å¯èƒ½è¯»åˆ°è¿‡æœŸæ•°æ®ï¼Œé€‚ç”¨äºä¸€è‡´æ€§è¦æ±‚ä¸é«˜çš„åœºæ™¯ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;=é0å­—ç¬¦ä¸²ï¼šAPI-Serveræ”¶åˆ°åï¼Œä¼šä¿è¯Cacheä¸­çš„æœ€æ–°ResouorceVersionå¤§äºç­‰äºè¯·æ±‚ä¸­çš„ResourceVersionï¼Œç„¶åä»Cacheä¸­æŸ¥è¯¢è¿”å›ã€‚&lt;/p&gt;
&lt;p&gt;Cacheçš„åŸç†æ˜¯åŸºäºetcdçš„Watchæœºåˆ¶æ¥æ›´æ–°ï¼Œ=é0å­—ç¬¦ä¸²ä¸”Cacheä¸­çš„ResourceVersionæ²¡æœ‰å¤§äºè¯·æ±‚ä¸­çš„ResourceVersionæ—¶ï¼Œä¼šè¿›è¡Œæœ€å¤š3ç§’çš„ç­‰å¾…ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;è‹¥ä½¿ç”¨çš„Getæ¥å£ï¼Œé‚£ä¹ˆAPI-Serverä¼šå–èµ„æºkeyçš„ModRevisionå­—æ®µå¡«å……Kubernetesèµ„æºçš„ResourceVersionå­—æ®µï¼ˆ v1. meta/ ObjectMeta.ResourceVersionï¼‰ã€‚è‹¥ä½ ä½¿ç”¨çš„æ˜¯Listæ¥å£ï¼ŒAPI-Serverä¼šåœ¨æŸ¥è¯¢æ—¶ï¼Œä½¿ç”¨etcdå½“å‰ç‰ˆæœ¬å·å¡«å……ListMeta.ResourceVersionå­—æ®µï¼ˆ v1. meta/ ListMeta.ResourceVersionï¼‰ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;åœ¨Watchè¯·æ±‚ä¸­ResourceVersionçš„ä¸‰ç§å–å€¼ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æœªæŒ‡å®šï¼Œé»˜è®¤ä¸ºç©ºä¸²ï¼šä¸€æ˜¯ä¸ºäº†å¸®åŠ©å®¢æˆ·ç«¯å»ºç«‹åˆå§‹çŠ¶æ€ï¼Œå°†å½“å‰å·²å­˜åœ¨çš„èµ„æºé€šè¿‡Addäº‹ä»¶è¿”å›ç»™å®¢æˆ·ç«¯ï¼›äºŒæ˜¯ä¼šä»å½“å‰ç‰ˆæœ¬å·å¼€å§‹ç›‘å¬ï¼Œåç»­æ–°å¢å†™è¯·æ±‚å¯¼è‡´æ•°æ®å˜åŒ–æ—¶ä¼šåŠæ—¶æ¨ç»™å®¢æˆ·ç«¯ã€‚&lt;/li&gt;
&lt;li&gt;=å­—ç¬¦ä¸²0ï¼šå¸®åŠ©å®¢æˆ·ç«¯å»ºç«‹åˆå§‹çŠ¶æ€ï¼Œä½†å®ƒä¼šä»ä»»æ„ç‰ˆæœ¬å·å¼€å§‹ç›‘å¬ï¼Œæ¥ä¸‹æ¥çš„è¡Œä¸ºå’Œ æœªæŒ‡å®š æ—¶ä¸€è‡´ã€‚&lt;/li&gt;
&lt;li&gt;=é0å­—ç¬¦ä¸²ï¼šä»ç²¾ç¡®çš„ç‰ˆæœ¬å·å¼€å§‹ç›‘å¬ï¼Œåªä¼šè¿”å›å¤§äºç­‰äºç²¾ç¡®ç‰ˆæœ¬å·çš„å˜æ›´äº‹ä»¶ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;pod&#34;&gt;Pod&lt;/h2&gt;
&lt;p&gt;Podæ˜¯æœ€å°çš„APIå¯¹è±¡ã€‚Podä¸­çš„å®¹å™¨ä¼šä½œä¸ºä¸€ä¸ªæ•´ä½“è¢«Masteræ‰“åŒ…è°ƒåº¦åˆ°ä¸€ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œã€‚&lt;/p&gt;
&lt;p&gt;ç”±äºä¸åŒå®¹å™¨é—´éœ€è¦å…±åŒåä½œï¼Œå¦‚waråŒ…å’Œtomcatï¼Œå°±éœ€è¦æŠŠå®ƒä»¬åŒ…è£…æˆä¸€ä¸ªpodï¼Œæ¦‚å¿µç±»ä¼¼äºè¿›ç¨‹ä¸è¿›ç¨‹ç»„ï¼Œpodå¹¶ä¸æ˜¯çœŸå®å­˜åœ¨çš„ï¼Œåªæ˜¯é€»è¾‘åˆ’åˆ†ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;åŒä¸€ä¸ªpodé‡Œçš„æ‰€æœ‰å®¹å™¨ï¼Œå…±äº«åŒä¸€ä¸ªNetwork Namespaceï¼Œä¹Ÿå¯ä»¥å…±äº«åŒä¸€ä¸ªVolume&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ç§æŠŠå¤šä¸ªå®¹å™¨ç»„åˆæ‰“åŒ…åœ¨ä¸€èµ·ç®¡ç†çš„æ¨¡å¼ä¹Ÿç§°ä¸ºå®¹å™¨è®¾è®¡æ¨¡å¼ã€‚&lt;/p&gt;
&lt;p&gt;å¦å¤–è¿˜æœ‰é™æ€Podï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;é™æ€podæ˜¯ç”±kubeletè¿›è¡Œç®¡ç†çš„ä»…å­˜åœ¨äºç‰¹å®šNodeçš„Podä¸Šï¼Œä»–ä»¬ä¸èƒ½é€šè¿‡API-Serverè¿›è¡Œç®¡ç†ï¼Œæ— æ³•ä¸ReplicationControllerã€Deploymentæˆ–è€…DaemonSetè¿›è¡Œå…³è”ï¼Œå¹¶ä¸”kubeletæ— æ³•å¯¹ä»–ä»¬è¿›è¡Œå¥åº·æ£€æŸ¥ã€‚é™æ€Podæ€»æ˜¯ç”±kubeletè¿›è¡Œåˆ›å»ºï¼Œå¹¶ä¸”æ€»æ˜¯åœ¨kubeletæ‰€åœ¨çš„Nodeä¸Šè¿è¡Œã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;åŸç†-2&#34;&gt;åŸç†&lt;/h3&gt;
&lt;p&gt;ç”±äºä¸åŒå®¹å™¨é—´å¯èƒ½å­˜åœ¨ä¾èµ–å…³ç³»ï¼ˆå¦‚å¯åŠ¨é¡ºåºçš„ä¾èµ–ï¼‰ï¼Œå› æ­¤k8sä¼šèµ·ä¸€ä¸ªä¸­é—´å®¹å™¨Infraå®¹å™¨ï¼Œæ¥å…³è”å…¶ä»–å®¹å™¨ï¼Œinfraå®¹å™¨ä¸€å®šæ˜¯æœ€å…ˆèµ·çš„ï¼Œå…¶ä»–å®¹å™¨é€šè¿‡Join Network Namespaceçš„æ–¹å¼ä¸Infaå®¹å™¨è¿›è¡Œå…³è”ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ä¸€ä¸ª Pod åªæœ‰ä¸€ä¸ª IP åœ°å€ï¼Œç”±Podå†…å®¹å™¨å…±äº«ï¼ŒPod çš„ç”Ÿå‘½å‘¨æœŸåªè·Ÿ Infra å®¹å™¨ä¸€è‡´ï¼ŒInfraç®¡ç†å…±äº«èµ„æº&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;kubeletä¼šä¸ºæ¯ä¸ªèŠ‚ç‚¹ä¸Šåˆ›å»ºä¸€ä¸ªåŸºæœ¬çš„cbr0ç½‘æ¡¥ï¼Œå¹¶ä¸ºæ¯ä¸€ä¸ªPodåˆ›å»ºvethè™šæ‹Ÿç½‘ç»œè®¾å¤‡ï¼Œç»‘å®šä¸€ä¸ªIPåœ°å€ï¼ŒåŒä¸€ä¸ªPodä¸­çš„æ‰€æœ‰å®¹å™¨ä¼šé€šè¿‡è¿™ä¸ªç½‘ç»œè®¾å¤‡å…±äº«ç½‘ç»œï¼Œä»è€Œèƒ½é€šè¿‡localhostç›¸äº’è®¿é—®å½¼æ­¤æš´éœ²çš„ç«¯å£å’ŒæœåŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºinitContainerå‘½ä»¤çš„ä½œç”¨æ˜¯æŒ‰é…ç½®é¡ºåºæœ€å…ˆæ‰§è¡Œï¼Œæ‰§è¡Œå®Œä¹‹åæ‰ä¼šæ‰§è¡Œcontainerå‘½ä»¤ï¼Œä¾‹å¦‚ï¼Œå¯¹waråŒ…æ‰€åœ¨å®¹å™¨ä½¿ç”¨initContainerå‘½ä»¤ï¼Œå°†waråŒ…å¤åˆ¶åˆ°æŒ‚è½½çš„å·ä¸‹åï¼Œå†æ‰§è¡Œtomcatçš„containerå‘½ä»¤å¯åŠ¨tomcatä»¥æ­¤æ¥å¯åŠ¨webåº”ç”¨ï¼Œè¿™ç§å…ˆå¯åŠ¨ä¸€ä¸ªè¾…åŠ©å®¹å™¨æ¥å®Œæˆä¸€äº›ç‹¬ç«‹äºä¸»è¿›ç¨‹ï¼ˆä¸»å®¹å™¨ï¼‰ä¹‹å¤–çš„å·¥ä½œï¼Œç§°ä¸ºsidecarï¼Œè¾¹è½¦ã€‚&lt;/p&gt;
&lt;p&gt;Podå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªæœºå™¨ï¼Œå®¹å™¨æ˜¯é‡Œé¢çš„è¿›ç¨‹ï¼Œå‡¡æ˜¯è°ƒåº¦ã€ç½‘ç»œã€å‚¨å­˜ã€å®‰å…¨ç›¸å…³ã€è·Ÿnamespaceç›¸å…³çš„å±æ€§ï¼Œéƒ½æ˜¯Podçº§åˆ«çš„ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;PID Namespaceï¼šé»˜è®¤ä¸å…±äº«ï¼Œä½†æ˜¯å¯ä»¥è°ƒå‚&lt;code&gt;shareProcessNamespace=true&lt;/code&gt;æ‰“å¼€ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå®¹å™¨å†…çš„PIDä¸€è‡´ï¼Œä½†æ˜¯PIDåè¯ç©ºé—´ä¸ä¸€è‡´ï¼›&lt;/li&gt;
&lt;li&gt;Network Namespaceï¼šPodä¸­çš„å¤šä¸ªå®¹å™¨å…±äº«åŒä¸€ä¸ªIPå’Œç«¯å£èŒƒå›´ï¼›&lt;/li&gt;
&lt;li&gt;IPC Namespaceï¼šPodä¸­çš„å¤šä¸ªå®¹å™¨èƒ½å¤Ÿä½¿ç”¨å…±äº«å†…å­˜ï¼Œä¿¡å·é‡ï¼Œæ¶ˆæ¯é˜Ÿåˆ—ç­‰IPCæœºåˆ¶è¿›è¡Œé€šä¿¡ï¼›&lt;/li&gt;
&lt;li&gt;UTS Namespaceï¼šPodä¸­çš„å¤šä¸ªå®¹å™¨å…±äº«ä¸€ä¸ªä¸»æœºåå’ŒåŸŸåï¼›&lt;/li&gt;
&lt;li&gt;Mount Namespaceï¼šPodä¸­çš„å„ä¸ªå®¹å™¨å¯ä»¥è®¿é—®åœ¨Podçº§åˆ«å®šä¹‰çš„Volumesï¼›&lt;/li&gt;
&lt;li&gt;User Namespaceï¼šç®—æ˜¯æ¯”è¾ƒç‰¹æ®Šçš„ï¼Œé«˜ç‰ˆæœ¬æ‰æœ‰ï¼ŒæŠŠå®¿ä¸»æœºçš„ä¸€ä¸ªæ™®é€šç”¨æˆ·æ˜ å°„åˆ°å®¹å™¨ä¸­çš„rootç”¨æˆ·ï¼Œè¿™æ ·å®¹å™¨è¿›ç¨‹ä»¥ä¸ºè‡ªå·±æ˜¯rootå¹¶ä¸”åœ¨å®ƒæ‰€åœ¨çš„åç§°ç©ºé—´å†…æœ‰å„ç§æƒé™ï¼Œä»¥æ­¤æ§åˆ¶å®¹å™¨çš„ç”¨æˆ·æƒé™&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;å…³äºpauseå®¹å™¨--infraå®¹å™¨&#34;&gt;å…³äºPauseå®¹å™¨ / Infraå®¹å™¨&lt;/h3&gt;
&lt;p&gt;pauseå®¹å™¨ï¼Œä¹Ÿå«Infraå®¹å™¨ï¼Œæ¯ä¸ªPodéƒ½ä¼šè‡ªåŠ¨åˆ›å»ºçš„å®¹å™¨ï¼Œä½†ä¸å±äºç”¨æˆ·è‡ªå®šä¹‰å®¹å™¨ã€‚å› ä¸ºPodçš„ä½œç”¨ï¼Œå°±æ˜¯ç®¡ç†Podå†…å¤šä¸ªå®¹å™¨ä¹‹é—´æœ€é«˜æ•ˆçš„å…±äº«æŸäº›èµ„æºå’Œæ•°æ®ï¼Œè€ŒPodå†…çš„å®¹å™¨æ˜¯è¢«namespaceå’Œcgroupséš”å¼€çš„ã€‚Infraå®¹å™¨åœ¨Podä¸­æ‹…ä»»Linux Namespaceå…±äº«çš„åŸºç¡€ï¼Œå¯ç”¨Pid namespaceï¼Œå¼€å¯initè¿›ç¨‹ã€‚Infraå®¹å™¨å¯ä½¿å¾—Podå†…çš„å®¹å™¨å…±äº«pid namespaceã€network namespaceã€ipc namespace(ç”¨äºå…±äº«systemV IPCæˆ–POSIXæ¶ˆæ¯é˜Ÿåˆ—è¿›è¡Œé€šä¿¡)ã€uts namespace(å…±äº«ä¸»æœºå)ã€å…±äº«Podçº§åˆ«çš„Volumesã€‚&lt;/p&gt;
&lt;p&gt;ä»¥network namespaceä¸ºä¾‹ï¼Œå¦‚æœé‡Œé¢åªæœ‰ç”¨æˆ·è‡ªå·±çš„å®¹å™¨ï¼Œæ²¡æœ‰Infraå®¹å™¨è¿™ä¸ªç¬¬ä¸‰æ–¹å®¹å™¨ï¼Œåªè¦networkçš„ownerå®¹å™¨é€€å‡ºäº†ï¼ŒPodå†…çš„å…¶ä»–å®¹å™¨çš„ç½‘ç»œå°±éƒ½å¼‚å¸¸äº†ï¼Œè¿™æ˜¾ç„¶ä¸åˆç†ã€‚æ‰€ä»¥åœ¨åŒä¸€ä¸ªPodå†…çš„å…¶ä»–å®¹å™¨é€šè¿‡ join namespaceçš„æ–¹å¼åŠ å…¥åˆ°Infra containerçš„netword namespaceä¸­ï¼Œè¿™æ ·ï¼ŒPodå†…çš„æ‰€æœ‰å®¹å™¨å…±äº«åŒä¸€ä»½ç½‘ç»œèµ„æºï¼ŒPodçš„IPåœ°å€ = Podç¬¬ä¸€æ¬¡åˆ›å»ºçš„Infra containerçš„IPåœ°å€ã€‚&lt;/p&gt;
&lt;p&gt;Infra containeræ˜¯ä¸€ä¸ªåªæœ‰700KBå·¦å³çš„é•œåƒï¼Œæ°¸è¿œå¤„äºpauseçŠ¶æ€ã€‚æ•´ä¸ªPodçš„ç”Ÿå‘½å‘¨æœŸç­‰äºInfra containerçš„ç”Ÿå‘½å‘¨æœŸï¼Œä¸å†…éƒ¨çš„å…¶ä»–å®¹å™¨æ— å…³ï¼Œä¸”Infra conatinerä¸€å®šæ˜¯ç¬¬ä¸€ä¸ªå¯åŠ¨çš„ï¼Œè¿™ä¹Ÿæ˜¯Kubernetesé‡Œè¿è¡Œæ›´æ–°Podé‡Œçš„æŸä¸€ä¸ªé•œåƒï¼Œè€Œæ•´ä¸ªPodä¸ä¼šè¢«é‡å»ºå’Œé‡å¯çš„åŸå› ã€‚å³ä½¿æŠŠPodé‡Œçš„æ‰€æœ‰ç”¨æˆ·å®¹å™¨éƒ½killæ‰ï¼ŒPodä¹Ÿä¸ä¼šé€€å‡ºã€‚&lt;/p&gt;
&lt;h3 id=&#34;podåœ¨k8sä¸­çš„ç”Ÿå‘½å‘¨æœŸ&#34;&gt;Podåœ¨K8sä¸­çš„ç”Ÿå‘½å‘¨æœŸ&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Pendingï¼šPodçš„yamlæ–‡ä»¶å·²ç»æäº¤ç»™k8säº†ï¼ŒAPIå¯¹è±¡å·²ç»è¢«åˆ›å»ºä¿å­˜åœ¨etcdä¸­ï¼Œä½†æ˜¯è¿™ä¸ªPodé‡Œæœ‰å®¹å™¨å› ä¸ºæŸäº›åŸå› å¯¼è‡´ä¸èƒ½è¢«é¡ºåˆ©åˆ›å»ºã€‚&lt;/li&gt;
&lt;li&gt;Runningï¼šPodå·²ç»è°ƒåº¦æˆåŠŸï¼Œè·Ÿä¸€ä¸ªå…·ä½“çš„èŠ‚ç‚¹ç»‘å®šï¼Œå†…éƒ¨å®¹å™¨åˆ›å»ºæˆåŠŸï¼Œå¹¶ä¸”è‡³å°‘æœ‰ä¸€ä¸ªæ­£åœ¨è¿è¡Œã€‚&lt;/li&gt;
&lt;li&gt;Succeededï¼šPodé‡Œæ‰€æœ‰å®¹å™¨éƒ½æ­£å¸¸è¿è¡Œå®Œæ¯•ï¼Œå¹¶ä¸”å·²ç»é€€å‡ºï¼Œåœ¨è¿è¡Œä¸€æ¬¡æ€§ä»»åŠ¡æ—¶æ¯”è¾ƒå¸¸è§ã€‚&lt;/li&gt;
&lt;li&gt;Failedï¼šPodé‡Œè‡³å°‘æœ‰ä¸€ä¸ªå®¹å™¨ä»¥ä¸æ­£å¸¸çš„çŠ¶æ€é€€å‡ºï¼Œéœ€è¦æŸ¥çœ‹Eventså’Œæ—¥å¿—æŸ¥çœ‹åŸå› ã€‚&lt;/li&gt;
&lt;li&gt;Unknownï¼šå¼‚å¸¸çŠ¶æ€ï¼ŒPodçš„çŠ¶æ€ä¸èƒ½æŒç»­é€šè¿‡kubeletæ±‡æŠ¥ç»™API-Serverï¼Œå¯èƒ½æ˜¯ä¸»ä»èŠ‚ç‚¹é—´é€šä¿¡å‡ºç°é—®é¢˜ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é™¤æ­¤ä¹‹å¤–ï¼ŒPodçš„statuså­—æ®µè¿˜èƒ½ç»†åˆ†ä¸€ç»„Conditionsï¼Œä¸»è¦æ˜¯æè¿°é€ æˆå½“å‰statusçš„å…·ä½“åŸå› ï¼Œæ¯”å¦‚PodScheduledã€Readyã€Initializedä»¥åŠUnschedulableã€‚&lt;/p&gt;
&lt;p&gt;åœ¨Podçš„containerså®šä¹‰ä¸­ï¼Œæœ‰ä¸ªlifecycleå­—æ®µï¼Œç”¨äºå®šä¹‰å®¹å™¨çš„çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶äº§ç”Ÿçš„hookã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Podè¢«åˆ é™¤æ—¶çš„æµç¨‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;Pod è¢«åˆ é™¤ï¼ŒçŠ¶æ€å˜ä¸º &lt;code&gt;Terminating&lt;/code&gt;ã€‚é€šè¿‡API-Serverä¿®æ”¹Podçš„ä¿¡æ¯ï¼Œè®¾ç½®DeletionTimestampå’ŒDeletionGracePeriodSecondsä¿¡æ¯ï¼Œç»™Podæ ‡è®°ä¸Šåˆ é™¤æ—¶é—´ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;endpoint-controlleræ¥æ”¶åˆ°Podåˆ é™¤çš„é€šçŸ¥ï¼Œå‘API-Serverå‘é€è¯·æ±‚ï¼Œä¿®æ”¹serviceçš„endpointså¯¹è±¡ï¼Œåˆ é™¤è¯¥Podçš„endpointã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;kube-proxyä¹Ÿä¼šæ¥æ”¶åˆ°Podåˆ é™¤çš„é€šçŸ¥ï¼Œå¼€å§‹æ›´æ–°è½¬å‘è§„åˆ™ï¼Œä¿®æ”¹æœ¬æœºçš„iptables / ipvsè§„åˆ™ï¼Œå°† Pod ä» service çš„ endpoint åˆ—è¡¨ä¸­æ‘˜é™¤æ‰ï¼Œæ–°çš„æµé‡ä¸å†è½¬å‘åˆ°è¯¥ Podã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;kubelet watch åˆ°äº†å°±å¼€å§‹é”€æ¯ Podã€‚&lt;/p&gt;
&lt;p&gt;3.1. å¦‚æœ Pod ä¸­æœ‰ container é…ç½®äº† [preStop Hook] å°†ä¼šæ‰§è¡Œï¼ˆè¿™é‡Œçš„ä½œç”¨ï¼Œæ¯”å¦‚è¯´kube-proxyå¤„ç†å¾—å¤ªæ…¢ï¼Œä¼šå¯¼è‡´Podè¢«åˆ é™¤äº†ï¼Œä½†æ˜¯iptablesçš„è§„åˆ™è¿˜åœ¨ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡åœ¨è¿™é‡Œé…ç½®å¤„ç†ï¼‰&lt;/p&gt;
&lt;p&gt;3.2. å‘é€ &lt;code&gt;SIGTERM&lt;/code&gt; ä¿¡å·ç»™å®¹å™¨å†…ä¸»è¿›ç¨‹ä»¥é€šçŸ¥å®¹å™¨è¿›ç¨‹&lt;strong&gt;å¼€å§‹ä¼˜é›…åœæ­¢&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;3.3. ç­‰å¾… container ä¸­çš„ä¸»è¿›ç¨‹å®Œå…¨åœæ­¢ï¼Œå¦‚æœåœ¨ &lt;code&gt;terminationGracePeriodSeconds&lt;/code&gt; å†… (é»˜è®¤ 30s) è¿˜æœªå®Œå…¨åœæ­¢ï¼Œå°±å‘é€ &lt;code&gt;SIGKILL&lt;/code&gt; ä¿¡å·å°†å…¶å¼ºåˆ¶æ€æ­»ã€‚&lt;/p&gt;
&lt;p&gt;3.4. æ‰€æœ‰å®¹å™¨è¿›ç¨‹ç»ˆæ­¢ï¼Œæ¸…ç† Pod èµ„æºã€‚&lt;/p&gt;
&lt;p&gt;3.5. é€šçŸ¥ API-Server Pod é”€æ¯å®Œæˆï¼Œåˆ é™¤etcdä¸­Podçš„ä¿¡æ¯ï¼Œå®Œæˆ Pod åˆ é™¤ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;side-car&#34;&gt;Side Car&lt;/h3&gt;
&lt;p&gt;åœ¨å£°æ˜å®¹å™¨æ—¶ï¼Œä½¿ç”¨initContainerså£°æ˜ï¼Œç”¨æ³•åŒcontainersï¼ŒinitContainersä½œä¸ºè¾…åŠ©å®¹å™¨ï¼Œå¿…å®šæ¯”containerså…ˆå¯åŠ¨ï¼Œå¦‚æœå£°æ˜äº†å¤šä¸ªinitContainersï¼Œåˆ™ä¼šæŒ‰é¡ºåºå…ˆå¯åŠ¨ï¼Œå½“æ‰€æœ‰initContainerséƒ½è¿è¡ŒæˆåŠŸåï¼Œæ‰ä¼šå¼€å§‹åˆå§‹åŒ–Podçš„å„è‡ªä¿¡ï¼Œå¹¶åˆ›å»ºå’Œå¯åŠ¨containersã€‚&lt;/p&gt;
&lt;p&gt;å› ä¸ºPodå†…æ‰€æœ‰å®¹å™¨å…±äº«åŒä¸€ä¸ªNetwork Namespaceçš„ç‰¹æ€§ï¼ŒinitContainersè¾…åŠ©å®¹å™¨å¸¸ç”¨äºä¸Podç½‘ç»œç›¸å…³çš„é…ç½®å’Œç®¡ç†ï¼Œæ¯”å¦‚å¸¸è§çš„å®ç°æ˜¯Istioã€‚&lt;/p&gt;
&lt;h3 id=&#34;podä¸­çš„projected-volumeæŠ•å°„æ•°æ®å·&#34;&gt;Podä¸­çš„Projected Volume(æŠ•å°„æ•°æ®å·)&lt;/h3&gt;
&lt;p&gt;k8så°†é¢„å…ˆå®šä¹‰å¥½çš„æ•°æ®æŠ•å°„è¿›å®¹å™¨ï¼Œæ”¯æŒçš„ç§ç±»ï¼šsecretã€ConfigMapã€Downward APIï¼Œè¿™ä¸‰ç§PVä¸€èˆ¬å­˜æ”¾ä¸ç»å¸¸æ›´æ–°çš„æ•°æ®ï¼ŒServiceAccountTokenåˆ™æ˜¯åœ¨è®¿é—®Kubernetes API Serveræ—¶ä¼šä½¿ç”¨åˆ°ã€‚&lt;/p&gt;
&lt;h4 id=&#34;secret&#34;&gt;Secret&lt;/h4&gt;
&lt;p&gt;å°†Podæƒ³è¦è®¿é—®çš„åŠ å¯†æ•°æ®ï¼Œå­˜æ”¾åˆ°etcdä¸­ï¼Œé€šè¿‡åœ¨Podä¸­çš„å®¹å™¨é‡ŒæŒ‚è½½Volumeçš„æ–¹å¼è®¿é—®è¿™äº›æ•°æ®ã€‚å¦‚æœetcdé‡Œçš„è¿™äº›æ•°æ®å‘ç”Ÿäº†æ”¹å˜ï¼ŒæŒ‚è½½åˆ°å®¹å™¨é‡Œçš„æ•°æ®ä¼šåœ¨ä¸€å®šçš„å»¶æ—¶åè¿›è¡Œæ›´æ–°ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Pod&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;test-projected-volume &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;containers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;test-secret-volume&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;image&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;busybox&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;sleep&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;86400&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;volumeMounts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;mysql-cred&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;mountPath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;/projected-volume&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;readOnly&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;volumes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;mysql-cred&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;projected&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;sources&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;secret&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;user&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;secret&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;pass&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;è¿™é‡Œæ˜¯æŒ‚è½½äº†ä¸€ä¸ªç±»å‹ä¸ºprojectedçš„volumeï¼Œå­˜æ”¾æ•°æ®çš„sourcesæ˜¯ä¸€ä¸ªsecretå¯¹è±¡(æœ‰å±æ€§name)ï¼Œnameçš„å€¼è¡¨ç¤ºæ•°æ®å­˜æ”¾çš„åå­—ï¼Œæ¯”å¦‚é€šè¿‡è¿™ä¸ªåå­—å–å¾—å¯¹äºçš„å€¼ï¼ˆå€¼å¯ä»¥æ˜¯å¯¹åº”çš„å­˜æ”¾æ•°æ®çš„æ–‡ä»¶è·¯å¾„ï¼‰ï¼Œ&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;å¦‚ï¼škubectl create secret generic user --from-file=./username.txt
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä¹Ÿå¯ç›´æ¥åœ¨yamlæ–‡ä»¶ä¸­å®šä¹‰ secretå¯¹è±¡ï¼Œå¦‚ä¸‹ï¼Œé€šè¿‡dataå­—æ®µå®šä¹‰ï¼Œkindæ˜¯secretï¼Œå€¼éœ€è¦ç»è¿‡base64ç¼–ç &lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;8
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Secret&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;mysecret&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Opaque&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;user&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;YWRtaW4=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;pass&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;MWYyZDFlMmU2N2Rm&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;é€šè¿‡è¿™ç§æ–¹å¼è¿›è¡Œå®šä¹‰å¹¶è¿è¡Œåï¼Œä¼šå…ˆå°†ä¿¡æ¯ä¿å­˜åˆ°ectdä¸­ï¼Œç„¶ååœ¨ä»¥æ–‡ä»¶çš„å½¢å¼æŒ‚è½½åœ¨å®¹å™¨çš„Volumeç›®å½•é‡Œï¼Œæ–‡ä»¶åæ˜¯${name}æˆ–è€…${data.key}ã€‚&lt;/p&gt;
&lt;h4 id=&#34;configmap&#34;&gt;configMap&lt;/h4&gt;
&lt;p&gt;configMapçš„ä½œç”¨ã€ç”¨æ³•åŒsecretï¼Œåªæ˜¯å…¶å†…å®¹ä¸éœ€è¦ç»è¿‡åŠ å¯†&lt;/p&gt;
&lt;h4 id=&#34;downward-api&#34;&gt;downward API&lt;/h4&gt;
&lt;p&gt;è®©Podé‡Œçš„å®¹å™¨èƒ½å¤Ÿç›´æ¥è·å–åˆ°è¿™ä¸ªPod APIå¯¹è±¡æœ¬èº«çš„ä¿¡æ¯ï¼Œåªèƒ½è·å–Podå¯åŠ¨ä¹‹å‰å°±èƒ½ç¡®å®šçš„ä¿¡æ¯ï¼ŒPodè¿è¡Œä¹‹åçš„ä¿¡æ¯åªèƒ½é€šè¿‡sidecarå®¹å™¨è·å–ã€‚&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚ä¸‹é¢è¿™ä»½é…ç½®ï¼Œvolumeçš„ç±»å‹æ˜¯projectedï¼Œæ•°æ®æ¥æºæ˜¯downwardAPIï¼Œå£°æ˜è¦æš´éœ²çš„ä¿¡æ¯æ˜¯å½“å‰yamlæ–‡ä»¶å®šä¹‰çš„metadata.labelsä¿¡æ¯ï¼ŒK8Sä¼šè‡ªåŠ¨æŒ‚è½½ä¸ºå®¹å™¨é‡Œçš„/podInfo/labelsæ–‡ä»¶ã€‚&lt;/p&gt;
&lt;p&gt;Downward APIæ”¯æŒçš„å­—æ®µæ˜¯å›ºå®šçš„ï¼Œä½¿ç”¨fieldRefå­—æ®µå¯ä»¥æŸ¥çœ‹å®¿ä¸»æœºåç§°ã€IPã€Podçš„æ ‡ç­¾ç­‰ä¿¡æ¯ï¼›resourceFieldRefå­—æ®µå¯ä»¥æŸ¥çœ‹å®¹å™¨CPUã€å†…å­˜ç­‰ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Pod&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;test-downwardapi-volume&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;zone&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;us-est-coast&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;cluster&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;test-cluster1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;rack&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;rack-22&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;containers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;client-container&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;volumeMounts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;podinfo&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;mountPath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;/podInfo&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;volumes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;podinfo&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;projected&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;sources&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;downwardAPI&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;items&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;labels&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;fieldRef&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;fieldPath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;metadata.labels&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h4 id=&#34;serviceaccounttoken&#34;&gt;serviceAccountToken&lt;/h4&gt;
&lt;p&gt;serviceAccountTokenæ˜¯ä¸€ç§ç‰¹æ®Šçš„Secretï¼Œä¸€èˆ¬ç”¨äºè®¿é—®Kubernetes API Serveræ—¶æä¾›tokenä½œä¸ºéªŒè¯çš„å‡­è¯ã€‚Kubernetsæä¾›äº†ä¸€ä¸ªé»˜è®¤çš„default Service Accountï¼Œä»»ä½•è¿è¡Œåœ¨Kubernetsä¸­çš„Podéƒ½å¯ä»¥ä½¿ç”¨ï¼Œæ— éœ€æ˜¾å¼å£°æ˜æŒ‚è½½äº†å®ƒã€‚&lt;/p&gt;
&lt;p&gt;é»˜è®¤æŒ‚è½½è·¯å¾„ï¼š&lt;code&gt;/var/run/secrets/kubernetes.io/serviceaccount&lt;/code&gt;ï¼Œé‡Œé¢åŒ…å«äº†&lt;code&gt;ca.crtï¼Œnamespaceï¼Œtoken&lt;/code&gt;ä¸‰ä¸ªæ–‡ä»¶ï¼Œç”¨äºæˆæƒå½“å‰Podè®¿é—®API Serverã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœè¦è®©Podæ‹¥æœ‰ä¸åŒè®¿é—®API Serverçš„æƒé™ï¼Œå°±éœ€è¦ä¸åŒçš„service accountï¼Œä¹Ÿå°±éœ€è¦ä¸åŒçš„tokenäº†ã€‚&lt;/p&gt;
&lt;h4 id=&#34;æŒ‚è½½å®¿ä¸»æœºä¸Šçš„ç›®å½•&#34;&gt;æŒ‚è½½å®¿ä¸»æœºä¸Šçš„ç›®å½•&lt;/h4&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Pod&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;two-containers&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;restartPolicy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Never&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;containers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;nginx-container&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;image&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;nginx&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;volumeMounts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;shared-data&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;mountPath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/usr/share/nginx/html&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;debian-container&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;image&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;debian&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;volumeMounts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;shared-data&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;mountPath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/pod-data&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;command&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;/bin/sh&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;-c&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;echo Hello from the debian container &amp;gt; /pod-data/ index.html&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;volumes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;shared-data&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hostPath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/data&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;å£°æ˜äº†ä¸¤ä¸ªå®¹å™¨ï¼Œéƒ½æŒ‚è½½äº†shared-dataè¿™ä¸ªVolumeï¼Œä¸”è¯¥Volumeæ˜¯hostPathï¼Œå¯¹åº”å®¿ä¸»æœºä¸Šçš„/dataç›®å½•ï¼Œæ‰€ä»¥ä¹ˆï¼Œnginx-container å¯ ä»¥ ä» å®ƒ çš„&lt;code&gt;/usr/share/ nginx/html&lt;/code&gt; ç›® å½• ä¸­ï¼Œ è¯»å–åˆ°debian-containerç”Ÿ æˆ çš„ index.htmlæ–‡ä»¶ã€‚&lt;/p&gt;
&lt;h3 id=&#34;podçš„èµ„æºåˆ†é…-qos&#34;&gt;Podçš„èµ„æºåˆ†é… QoS&lt;/h3&gt;
&lt;p&gt;Podçš„èµ„æºåˆ†é…ç”±å®šä¹‰çš„Containerå†³å®šï¼Œæ¯”å¦‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;nn&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;containers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;resources&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;requests&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;memory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;64Mi&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# å•ä½æ˜¯bytesï¼Œæ³¨æ„1Mi=1024*1024ï¼Œ1M=1000*1000&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;cpu&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;250m&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# å•ä½æ˜¯ä¸ªæ•°ï¼Œ250mè¡¨ç¤º250millicpuï¼Œä½¿ç”¨0.25ä¸ªCPUçš„ç®—åŠ›ï¼Œä¹Ÿå¯ä»¥ç›´æ¥å†™æˆ0.25ï¼Œé»˜è®¤æ˜¯1ï¼Œä¸”æ˜¯cpu shareçš„&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;limits&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;memory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;128Mi&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;cpu&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;500m&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;CPUå±äºå¯å‹ç¼©èµ„æºï¼Œå½“CPUä¸è¶³æ—¶ï¼ŒPodåªä¼š&amp;quot;é¥¥é¥¿&amp;quot;ï¼Œä¸ä¼šé€€å‡ºï¼›&lt;/p&gt;
&lt;p&gt;å†…å­˜æ•°ä¸ä¸å¯å‹ç¼©èµ„æºï¼Œå½“å†…å­˜ä¸è¶³æ—¶ï¼ŒPodä¼šå› ä¸ºOOMè€Œè¢«killæ‰ï¼›&lt;/p&gt;
&lt;p&gt;Matserçš„kube-schedulerä¼šæ ¹æ®requestsçš„å€¼è¿›è¡Œè®¡ç®—ï¼Œæ ¹æ®limitsè®¾ç½®cgroupçš„é™åˆ¶ï¼Œå³requestç”¨äºè°ƒåº¦ï¼Œlimitç”¨äºé™åˆ¶ï¼Œä¸åŒçš„requestså’Œlimitsè®¾ç½®æ–¹å¼ï¼Œä¼šå°†Podåˆ’åˆ†ä¸ºä¸åŒçš„QoSç±»å‹ï¼Œç”¨äºå¯¹Podè¿›è¡Œèµ„æºå›æ”¶å’Œè°ƒåº¦ã€‚QoSæŒ‰ä¼˜å…ˆçº§ä»é«˜åˆ°ä½ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;Guaranteedï¼šåªè®¾ç½®äº†limitsæˆ–è€…limitså’Œrequestsçš„å€¼ä¸€è‡´ï¼›&lt;/p&gt;
&lt;p&gt;åœ¨ä¿è¯æ˜¯Guaranteedç±»å‹çš„æƒ…å†µä¸‹ï¼Œrequestså’Œlimitsçš„CPUå’Œå†…å­˜è®¾ç½®ç›¸ç­‰ï¼Œæ­¤æ—¶æ˜¯cpusetè®¾ç½®ï¼Œå®¹å™¨ä¼šç»‘åˆ°æŸä¸ªCPUæ ¸ä¸Šï¼Œä¸ä¼šä¸å…¶ä»–å®¹å™¨å…±äº«CPUç®—åŠ›ï¼Œå‡å°‘CPUä¸Šä¸‹æ–‡åˆ‡æ¢çš„æ¬¡æ•°ï¼Œæå‡æ€§èƒ½ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç»‘æ ¸åªä¼šåœ¨è®¾ç½®çš„å€¼æ˜¯æ•´æ•°æ—¶æ‰ä¼šç”Ÿæ•ˆã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Burstableï¼šä¸æ»¡è¶³Guaranteedçº§åˆ«ï¼Œä½†è‡³å°‘æœ‰ä¸€ä¸ªContainerè®¾ç½®äº†requestsï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Best-Effortï¼šrequestså’Œlimitséƒ½æ²¡æœ‰è®¾ç½®ï¼Œå½“èŠ‚ç‚¹èµ„æºå……è¶³æ—¶å¯ä»¥å……åˆ†ä½¿ç”¨ï¼Œä½†æ˜¯å½“èŠ‚ç‚¹è¢«Guaranteedæˆ–Burstable PodæŠ¢å æ—¶ï¼Œèµ„æºå°±ä¼šè¢«å‹ç¼©ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å½“è®¾ç½®&lt;code&gt;limits&lt;/code&gt;è€Œæ²¡æœ‰è®¾ç½®&lt;code&gt;requests&lt;/code&gt;æ—¶ï¼ŒKubernetes é»˜è®¤ä»¤&lt;code&gt;requests&lt;/code&gt;ç­‰äº&lt;code&gt;limits&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;K8sä¼šå°†èŠ‚ç‚¹ä¸Šçš„CPUèµ„æºåˆ†æˆä¸¤ç±»ï¼šå…±äº«æ± å’Œç‹¬äº«æ± ï¼Œå¦‚æœåœ¨Guaranteedä¸Šè®¾ç½®äº†ç»‘æ ¸ï¼Œå°±ä¼šå ç”¨ç‹¬äº«æ± ï¼Œå¦åˆ™æ˜¯ä½¿ç”¨å…±äº«æ± ï¼Œæ‰€ä»¥ï¼Œå¦‚æœä¸€ä¸ªèŠ‚ç‚¹ä¸Šæœ‰æ¯”è¾ƒå¤šçš„Podè®¾ç½®ç»‘æ ¸ï¼Œä¼šå¯¼è‡´éç»‘æ ¸çš„Podéƒ½ä½¿ç”¨å…±äº«æ± ï¼Œä½¿å¾—ç«äº‰ä¸¥é‡ï¼Œä½¿ç”¨å…±äº«æ± çš„Podæ€§èƒ½ä¸‹é™ã€‚&lt;/p&gt;
&lt;p&gt;èŠ‚ç‚¹ä¸Šé™¤äº†è¿è¡Œç”¨æˆ·å®¹å™¨ï¼Œè¿˜è¿è¡Œäº†å…¶ä»–ç³»ç»Ÿè¿›ç¨‹ï¼Œæ¯”å¦‚kubeletã€sshç­‰ï¼Œä¸ºäº†ä¿è¯è¿™äº›å¤–éƒ¨çš„è¿›ç¨‹æœ‰è¶³å¤Ÿçš„èµ„æºè¿è¡Œï¼ŒKuberneteså¼•å…¥ Eviction Policyç‰¹æ€§ï¼Œè®¾ç½®äº†é»˜è®¤çš„èµ„æºå›æ”¶é˜ˆå€¼ï¼Œå½“Kubernetesæ‰€ç®¡ç†çš„ä¸å¯å‹ç¼©èµ„æºçŸ­ç¼ºæ—¶ï¼Œå°±ä¼šè§¦å‘Evictionæœºåˆ¶ï¼Œä¸å¯å‹ç¼©èŠ‚ç‚¹èµ„æºæœ‰ï¼šå†…å­˜ã€ç£ç›˜ã€å®¹å™¨è¿è¡Œé•œåƒçš„å­˜å‚¨ç©ºé—´ç­‰ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;æ¯ä¸ªè¿è¡ŒçŠ¶æ€å®¹å™¨éƒ½æœ‰å…¶ OOM å¾—åˆ†ï¼Œå¾—åˆ†è¶Šé«˜è¶Šä¼šè¢«ä¼˜å…ˆæ€æ­»ï¼›å…¶ä¸­Guaranteedçº§åˆ«çš„Podå¾—åˆ†æœ€ä½ï¼ŒBestEffortçº§åˆ«çš„Podå¾—åˆ†æœ€é«˜ï¼Œæ‰€ä»¥ä¼˜å…ˆçº§Guaranteed&amp;gt; Burstable&amp;gt; Best-Effortï¼Œä¼˜å…ˆçº§ä½çš„Podä¼šåœ¨èµ„æºä¸è¶³æ—¶ä¼˜å…ˆè¢«æ€æ­»ï¼›åŒç­‰çº§åˆ«ä¼˜å…ˆçº§çš„ Pod èµ„æºåœ¨ OOM æ—¶ï¼Œä¸è‡ªèº«çš„ requests å±æ€§ç›¸æ¯”ï¼Œå…¶å†…å­˜å ç”¨æ¯”ä¾‹æœ€å¤§çš„ Pod å¯¹è±¡å°†è¢«é¦–å…ˆæ€æ­»ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;kubeleté»˜è®¤çš„èµ„æºå›æ”¶é˜ˆå€¼&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;&lt;code&gt;memory.available &amp;lt; 100Mi&lt;/code&gt;ï¼›&lt;code&gt;nodefs.available &amp;lt; 10%&lt;/code&gt;ï¼›&lt;code&gt;nodefs.inodesFree &amp;lt; 5%&lt;/code&gt;ï¼›&lt;code&gt;imagefs.available &amp;lt; 15%ï¼›&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;è¾¾åˆ°é˜ˆå€¼åï¼Œä¼šå¯¹nodeè®¾ç½®çŠ¶æ€ï¼Œé¿å…æ–°çš„Podè¢«è°ƒåº¦åˆ°è¿™ä¸ªnodeä¸Šã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å½“å‘ç”Ÿèµ„æºï¼ˆEvictionï¼‰å›æ”¶æ—¶çš„ç­–ç•¥ï¼š&lt;/p&gt;
&lt;p&gt;é¦–å½“å…¶å†²çš„ï¼Œè‡ªç„¶æ˜¯BestEffortç±»åˆ«çš„Podã€‚&lt;/p&gt;
&lt;p&gt;å…¶æ¬¡ï¼Œæ˜¯å±äºBurstableç±»åˆ«ã€å¹¶ä¸”å‘ç”Ÿâ€œé¥¥é¥¿â€çš„èµ„æºä½¿ç”¨é‡å·²ç»è¶…å‡ºäº†requestsçš„Podã€‚&lt;/p&gt;
&lt;p&gt;æœ€åï¼Œæ‰æ˜¯Guaranteedç±»åˆ«ã€‚å¹¶ä¸”ï¼ŒKubernetesä¼šä¿è¯åªæœ‰å½“Guaranteedç±»åˆ«çš„Podçš„èµ„æºä½¿ç”¨é‡è¶…è¿‡äº†å…¶limitsçš„é™åˆ¶ï¼Œæˆ–è€…å®¿ä¸»æœºæœ¬èº«æ­£å¤„äºMemory PressureçŠ¶æ€æ—¶ï¼ŒGuaranteedçš„Podæ‰å¯èƒ½è¢«é€‰ä¸­è¿›è¡ŒEvictionæ“ä½œã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;podä¸­çš„å¥åº·æ£€æŸ¥&#34;&gt;Podä¸­çš„å¥åº·æ£€æŸ¥&lt;/h3&gt;
&lt;p&gt;å¯¹äºWebåº”ç”¨ï¼Œæœ€ç®€å•çš„å°±æ˜¯ç”±Webåº”ç”¨æä¾›å¥åº·æ£€æŸ¥çš„æ¥å£ï¼Œæˆ‘ä»¬åœ¨å®šä¹‰çš„APIå¯¹è±¡çš„æ—¶å€™è®¾ç½®å®šæ—¶è¯·æ±‚æ¥æ£€æŸ¥è¿è¡Œåœ¨å®¹å™¨ä¸­çš„webåº”ç”¨æ˜¯å¦å¥åº·ï¼Œä¸»è¦æ˜¯ä¸ºäº†é˜²æ­¢æœåŠ¡æœªå¯åŠ¨å®Œæˆå°±è¢«æ‰“å…¥æµé‡æˆ–è€…é•¿æ—¶é—´æœªå“åº”ä¾ç„¶æ²¡æœ‰é‡å¯ç­‰é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;livenessProbeï¼šä¿æ´»æ¢é’ˆï¼Œå½“ä¸æ»¡è¶³æ£€æŸ¥è§„åˆ™æ—¶ï¼Œç›´æ¥é‡å¯Podï¼›&lt;/p&gt;
&lt;p&gt;readnessProbeï¼šåªè¯»æ¢é’ˆï¼Œå½“ä¸æ»¡è¶³æ£€æŸ¥è§„åˆ™æ—¶ï¼Œä¸æ”¾æµé‡è¿›Podï¼›&lt;/p&gt;
&lt;p&gt;startupProbeï¼šå¯åŠ¨æ£€æŸ¥æ¢é’ˆï¼Œåº”ç”¨ä¸€äº›å¯åŠ¨ç¼“æ…¢çš„ä¸šåŠ¡ï¼Œé¿å…ä¸šåŠ¡é•¿æ—¶é—´å¯åŠ¨è€Œè¢«ä¸Šé¢ä¸¤ç±»æ¢é’ˆkillæ‰ï¼›&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;nn&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;livenessProbe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;     &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;httpGet&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# é™¤æ­¤ä¹‹å¤–è¿˜æœ‰Execå‘½ä»¤ã€TCPSocketä¸¤ç§ä¸åŒçš„probeæ–¹å¼&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;       &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/healthz&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;       &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8080&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;       &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;httpHeaders&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;       &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;X-Custom-Header&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;         &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Awesome&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;       &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;initialDelaySeconds&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# å®¹å™¨å¯åŠ¨åå¤šä¹…å¼€å§‹æ¢æµ‹&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;       &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;periodSeconds&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# æ¢æµ‹å‘¨æœŸ&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h3 id=&#34;podçš„æ¢å¤æœºåˆ¶&#34;&gt;Podçš„æ¢å¤æœºåˆ¶&lt;/h3&gt;
&lt;p&gt;APIå¯¹è±¡ä¸­&lt;code&gt;spec.restartPolicy&lt;/code&gt;å­—æ®µç”¨æ¥æè¿°Podçš„æ¢å¤ç­–ç•¥ï¼Œé»˜è®¤æ˜¯alwaysï¼Œå³å®¹å™¨ä¸åœ¨è¿è¡ŒçŠ¶æ€åˆ™é‡å¯ï¼ŒOnFailureæ˜¯åªæœ‰å®¹å™¨å¼‚å¸¸æ—¶æ‰è‡ªåŠ¨é‡å¯ï¼ŒNeveræ˜¯ä»æ¥ä¸é‡å¯å®¹å™¨&lt;/p&gt;
&lt;p&gt;Podçš„æ¢å¤è¿‡ç¨‹ï¼Œæ°¸è¿œå‘ç”Ÿåœ¨å½“å‰èŠ‚ç‚¹ï¼Œå³è·Ÿç€APIå¯¹è±¡å®šä¹‰çš„&lt;code&gt;spec.node&lt;/code&gt;çš„å¯¹åº”çš„èŠ‚ç‚¹ï¼Œå¦‚æœè¦å‘ç”Ÿåœ¨å…¶ä»–èŠ‚ç‚¹ï¼Œåˆ™éœ€è¦deploymentçš„å¸®åŠ©ã€‚&lt;/p&gt;
&lt;p&gt;å½“Podçš„restartPolicyæ˜¯alwaysæ—¶ï¼ŒPodå°±ä¼šä¿æŒRunningçŠ¶æ€ï¼Œæ— è®ºé‡Œé¢æŒ‚æ‰å¤šå°‘ä¸ªï¼Œå› ä¸ºPodæ€»ä¼šé‡å¯è¿™äº›å®¹å™¨ï¼›å½“restartPolicyæ˜¯neveræ—¶ï¼ŒPodé‡Œçš„æ‰€æœ‰å®¹å™¨éƒ½æŒ‚äº†ï¼Œæ‰ä¼šå˜æˆFailedï¼Œåªæœ‰ä¸€ä¸ªå®¹å™¨æŒ‚äº†ä¹Ÿæ˜¯Runningã€‚&lt;/p&gt;
&lt;p&gt;ä¸èƒ½ç®€å•çš„ä¾èµ–Podçš„statuså­—æ®µï¼Œè€Œæ˜¯è¦é€šè¿‡livenessProbeæˆ–è€…readnessProbeæ¥çš„å¥åº·æ£€æŸ¥æ¥åˆ¤æ–­æ˜¯å¦éœ€è¦æ¢å¤ã€‚&lt;/p&gt;
&lt;h3 id=&#34;podpreset&#34;&gt;PodPreset&lt;/h3&gt;
&lt;p&gt;é¢„ç½®ç±»å‹çš„Podï¼Œæ˜¯Podé…ç½®æ–‡ä»¶ä¸Šè¿½åŠ å­—æ®µçš„é¢„ç½®æ¨¡æ¿ï¼ŒPodPreseté‡Œå®šä¹‰çš„å†…å®¹ï¼Œåªä¼šåœ¨Podå¯¹è±¡è¢«åˆ›å»ºä¹‹å‰è¿½åŠ åœ¨è¿™ä¸ªå¯¹è±¡æœ¬èº«ï¼Œä¸ä¼šå½±å“ä»»ä½•Podæ§åˆ¶å™¨çš„å®šä¹‰ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€ä¸ªPodå¯ä»¥å¯¹åº”å¤šä¸ªPodPresetï¼Œå¤šä¸ªPodPreseté—´ä¼šè¿›è¡Œåˆå¹¶ï¼Œå¦‚æœæœ‰å†²çªå­—æ®µï¼Œåˆ™åé¢æ‰§è¡Œçš„PodPresetä¸ä¼šä¿®æ”¹å‰é¢çš„å­—æ®µã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;settings.k8s.io/v1alpha1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;PodPreset&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;allow-database&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;matchLabels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;role&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;frontend &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;env&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;DB_PORT &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;6379&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;volumeMounts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;mountPath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/cache &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;cache-volume &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;volumes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;cache-volume &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;emptyDir&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{}&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;åœ¨å…ˆåˆ›å»ºå®Œè¿™ä¸ªAPIå¯¹è±¡åï¼Œåœ¨åˆ›å»ºå¯¹åº”Podï¼Œè¿™ä¸ªPodPresetä¼šæ ¹æ®selectorï¼Œé€‰æ‹©lablesä¸­æœ‰role: frontendçš„Podï¼Œä¸ºå…¶æ·»åŠ envã€volumeMountsã€volumesç­‰å£°æ˜ã€‚&lt;/p&gt;
&lt;h3 id=&#34;podçš„é€šä¿¡&#34;&gt;Podçš„é€šä¿¡&lt;/h3&gt;
&lt;p&gt;Kubernetesä¸Šçš„CNIç½‘æ¡¥ç›¸å½“äºdocker0ç½‘æ¡¥ï¼Œå®¹å™¨(Pod)ä¸å®¿ä¸»æœºé€šä¿¡ï¼Œä»ç„¶ä½¿ç”¨VethPairè®¾å¤‡ï¼ŒCNIç½‘æ¡¥ä¼šæ¥ç®¡æ‰€æœ‰CNIæ’ä»¶è´Ÿè´£çš„å®¹å™¨(Pod)ï¼Œä¸»è¦æ˜¯ä¸Podä¸­çš„Infraå®¹å™¨çš„Network Namespaceäº¤äº’ã€‚&lt;/p&gt;
&lt;p&gt;CNIç½‘ç»œæ–¹æ¡ˆä¸»è¦ç”±ä¸¤éƒ¨åˆ†å·¥ä½œ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;1ï¼šå®ç°ç½‘ç»œæ–¹æ¡ˆï¼Œæ¯”å¦‚åˆ›å»ºå’Œé…ç½®æ‰€éœ€è¦çš„è™šæ‹Ÿè®¾å¤‡ã€é…ç½®è·¯ç”±è¡¨ã€ARPå’ŒFDBè¡¨ï¼›&lt;/li&gt;
&lt;li&gt;2ï¼šå®ç°å¯¹åº”çš„CNIæ’ä»¶ï¼Œæ¯”å¦‚é€šè¿‡è¯¥æ’ä»¶å¯ä»¥é…ç½®Infraå®¹å™¨é‡Œçš„ç½‘ç»œæ ˆï¼Œå¹¶æŠŠå®ƒè¿æ¥åœ¨CNIç½‘æ¡¥ä¸Šã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æœ¬è´¨ä¸ŠKubernetesçš„ç½‘ç»œè·Ÿdockeræ˜¯ç±»ä¼¼çš„ï¼Œåœ¨é›†ç¾¤ä¸­ï¼Œæ‰€æœ‰çš„å®¹å™¨éƒ½å¯ä»¥ç›´æ¥ä½¿ç”¨IPåœ°å€ä¸å…¶ä»–å®¹å™¨é€šä¿¡ï¼Œè€Œæ— éœ€IPæ˜ å°„ï¼›å®¿ä¸»æœºä¹Ÿå¯ç›´æ¥ä½¿ç”¨IPä¸æ‰€æœ‰å®¹å™¨é€šä¿¡ï¼Œè€Œæ— éœ€IPæ˜ å°„ï¼›æ¯ä¸ªå®¹å™¨éƒ½æ‹¥æœ‰è‡ªå·±çš„IPåœ°å€ï¼Œä¸”åœ¨å…¶ä»–å®¹å™¨ï¼Œå®¿ä¸»æœºçœ‹åˆ°çš„æ˜¯ä¸€æ ·çš„ã€‚&lt;/p&gt;
&lt;h4 id=&#34;podå†…çš„å®¹å™¨é—´é€šä¿¡&#34;&gt;Podå†…çš„å®¹å™¨é—´é€šä¿¡&lt;/h4&gt;
&lt;p&gt;Podå†…éƒ¨å®¹å™¨æ˜¯å…±äº«ä¸€ä¸ªç½‘ç»œå‘½åç©ºé—´çš„ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨Podå†…éƒ¨æœ‰ä¸€ä¸ªé»˜è®¤çš„å«Pauseçš„å®¹å™¨ï¼Œä½œä¸ºç‹¬ç«‹å…±äº«çš„ç½‘ç»œå‘½åç©ºé—´ï¼Œå…¶ä»–å®¹å™¨å¯åŠ¨æ—¶ä½¿ç”¨ -net=containerå°±å¯ç”¨è®©å½“å‰å®¹å™¨åŠ å…¥çš„Pauseå®¹å™¨ï¼Œä»¥æ­¤æ‹¥æœ‰åŒä¸€ä¸ªç½‘ç»œå‘½åç©ºé—´ï¼Œæ‰€ä»¥Podä¸­çš„å®¹å™¨å¯ä»¥é€šè¿‡localhostæ¥äº’ç›¸é€šä¿¡ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹å®¹å™¨æ¥è¯´ï¼Œhostnameå°±æ˜¯Podçš„åç§°ã€‚å› ä¸ºPodä¸­çš„æ‰€æœ‰å®¹å™¨å…±äº«åŒä¸€ä¸ªIPåœ°å€å’Œç«¯å£ç©ºé—´ï¼Œæ‰€ä»¥éœ€è¦ä¸ºæ¯ä¸ªéœ€è¦æ¥æ”¶è¿æ¥çš„å®¹å™¨åˆ†é…ä¸åŒçš„ç«¯å£ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒPodå†…çš„å®¹å™¨åº”ç”¨éœ€è¦è‡ªå·±åè°ƒç«¯å£çš„ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;å¦å¤–ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨PVå’ŒPVCæ¥å®ç°é€šä¿¡ã€‚&lt;/p&gt;
&lt;h4 id=&#34;åŒä¸€èŠ‚ç‚¹ä¸‹podé—´çš„é€šä¿¡&#34;&gt;åŒä¸€èŠ‚ç‚¹ä¸‹Podé—´çš„é€šä¿¡&lt;/h4&gt;
&lt;p&gt;é€šè¿‡èŠ‚ç‚¹ä¸Šçš„ç½‘æ¡¥å’ŒPodä¸Šçš„ Veth Pair å®ç°ï¼Œæ•´ä½“è·ŸåŒä¸€èŠ‚ç‚¹ä¸Šå®¹å™¨é—´çš„é€šä¿¡ å¾ˆåƒï¼Œåªä¸è¿‡ Veth Pair æ˜¯æŒ‚åœ¨Podçš„å…±äº«ç½‘ç»œç©ºé—´ä¸Šçš„ã€‚Veth Pairå°†èŠ‚ç‚¹ä¸Šçš„ç½‘æ¡¥å’ŒPodä¸Šçš„å…±äº«ç½‘ç»œç©ºé—´è¿›è¡Œè¿æ¥ï¼Œå†é€šè¿‡ç½‘æ¡¥ï¼Œè¿æ¥ä¸åŒçš„Podçš„å…±äº«ç½‘ç»œç©ºé—´ï¼Œå®ç°ä¸åŒPodé—´ç½‘ç»œé€šä¿¡ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/%e5%90%8c%e4%b8%80%e8%8a%82%e7%82%b9%e4%b8%8bPod%e9%97%b4%e9%80%9a%e4%bf%a1.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/%e5%90%8c%e4%b8%80%e8%8a%82%e7%82%b9%e4%b8%8bPod%e9%97%b4%e9%80%9a%e4%bf%a1.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;h4 id=&#34;ä¸åŒèŠ‚ç‚¹ä¸‹podé—´çš„é€šä¿¡&#34;&gt;ä¸åŒèŠ‚ç‚¹ä¸‹Podé—´çš„é€šä¿¡&lt;/h4&gt;
&lt;p&gt;ä¸åŒçš„èŠ‚ç‚¹ä¸‹Podé—´çš„é€šä¿¡ï¼Œé€šè¿‡ä¸€å¥—æ¥å£è§„èŒƒï¼ˆCNI, Container Network Interfaceï¼‰æ¥å®ç°ï¼Œå¸¸è§çš„æœ‰CNIæ’ä»¶å®ç°æœ‰Flannelã€Calicoä»¥åŠAWS VPC CNIã€‚&lt;/p&gt;
&lt;p&gt;å…¶ä¸­ï¼Œflannelæœ‰VXLANã€host-gwã€UDPä¸‰ç§å®ç°ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;flannel UDPæ¨¡å¼ä¸‹çš„è·¨ä¸»æœºé€šä¿¡&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ä¸‹å›¾container-1å‘é€è¯·æ±‚ç»™container-2æµç¨‹:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;container-1å‘é€æ•°æ®åŒ…ï¼Œæºï¼š100.96.1.2ï¼Œç›®æ ‡ï¼š100.96.2.3ï¼Œç»è¿‡docker0ï¼Œå‘ç°ç›®æ ‡IPä¸å­˜åœ¨ï¼Œæ­¤æ—¶ä¼šæŠŠè¯¥æ•°æ®åŒ…äº¤ç”±å®¿ä¸»æœºå¤„ç†ã€‚&lt;/li&gt;
&lt;li&gt;é€šè¿‡å®¿ä¸»æœºä¸Šçš„è·¯ç”±è¡¨ï¼Œå‘ç°flannel0è®¾å¤‡å¯ä»¥å¤„ç†è¯¥æ•°æ®åŒ…ï¼Œå®¿ä¸»æœºå°†è¯¥æ•°æ®åŒ…å‘é€ç»™flannel0è®¾å¤‡ã€‚&lt;/li&gt;
&lt;li&gt;flannel0è®¾å¤‡ï¼ˆTUMï¼‰ç”±flanneldè¿›ç¨‹ç®¡ç†ï¼Œæ•°æ®åŒ…çš„å¤„ç†ä»å†…æ ¸æ€(Linuxæ“ä½œç³»ç»Ÿ)è½¬å‘ç”¨æˆ·æ€(flanneldè¿›ç¨‹)ï¼Œflanneldè¿›ç¨‹çŸ¥é“ç›®æ ‡IPåœ¨å“ªä¸ªèŠ‚ç‚¹ï¼Œå°±æŠŠè¯¥æ•°æ®åŒ…å‘å¾€node2ã€‚&lt;/li&gt;
&lt;li&gt;node2å¯¹è¯¥æ•°æ®åŒ…çš„å¤„ç†ï¼Œåˆ™è·Ÿnode1ç›¸åï¼Œæœ€åcontainer2æ”¶åˆ°æ•°æ®åŒ…ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/flannel_udp%e8%b7%a8%e4%b8%bb%e6%9c%ba%e9%80%9a%e4%bf%a1.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/flannel_udp%e8%b7%a8%e4%b8%bb%e6%9c%ba%e9%80%9a%e4%bf%a1.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;flanneldé€šè¿‡ä¸ºå„ä¸ªå®¿ä¸»æœºå»ºç«‹å­ç½‘ï¼ŒçŸ¥é“äº†å„ä¸ªå®¿ä¸»æœºèƒ½å¤„ç†çš„IPèŒƒå›´ï¼Œå­ç½‘ä¸å®¿ä¸»æœºçš„å¯¹åº”å…³ç³»ï¼Œéƒ½ä¼šä¿å­˜åœ¨etcdä¸­ï¼Œflanneldå°†åŸæ•°æ®åŒ…å†æ¬¡å°è£…æˆä¸€ä¸ªUDPåŒ…ï¼ŒåŒæ—¶å¸¦ä¸Šç›®æ ‡èŠ‚ç‚¹çš„çœŸå®IPï¼Œå‘å¾€å¯¹åº”èŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;å†ç”±fannelç®¡ç†çš„å®¹å™¨ç½‘ç»œé‡Œï¼Œä¸€ä¸ªèŠ‚ç‚¹ä¸Šçš„æ‰€æœ‰å®¹å™¨ï¼Œéƒ½å±äºè¯¥å®¿ä¸»æœºè¢«åˆ†é…çš„ä¸€ä¸ªå­ç½‘ã€‚flannelä¼šåœ¨å®¿ä¸»æœºä¸Šæ³¨å†Œä¸€ä¸ªflannel0è®¾å¤‡ï¼Œä¿å­˜å„ä¸ªèŠ‚ç‚¹çš„å®¹å™¨å­ç½‘ä¿¡æ¯ï¼Œflanneldè¿›ç¨‹ä¼šå¤„ç†ç”±flannel0ä¼ å…¥çš„IPåŒ…ï¼ŒåŒ¹é…åˆ°å¯¹åº”çš„å­ç½‘ï¼Œä»etcdä¸­æ‰¾åˆ°è¯¥å­ç½‘å¯¹åº”çš„å®¿ä¸»æœºçš„IPï¼Œå°è£…æˆä¸€ä¸ªUDPåŒ…ï¼Œäº¤ç”±flannel0ï¼Œæ¥ç€å°±è·ŸèŠ‚ç‚¹é—´çš„ç½‘ç»œé€šä¿¡ä¸€æ ·ï¼Œå‘é€ç»™ç›®æ ‡èŠ‚ç‚¹äº†ã€‚å› ä¸ºå¤šäº†ä¸€æ­¥flanneldçš„å¤„ç†ï¼Œæ¶‰åŠåˆ°äº†å¤šæ¬¡ç”¨æˆ·æ€ä¸å†…æ ¸æ€é—´çš„æ•°æ®æ‹·è´ï¼Œå¯¼è‡´æ€§èƒ½é—®é¢˜ï¼Œä¼˜åŒ–çš„åŸåˆ™æ˜¯å‡å°‘åˆ‡æ¢æ¬¡æ•°ï¼Œæ‰€ä»¥æœ‰äº†VXLANæ¨¡å¼ã€host-gwæ¨¡å¼ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;UDPæ¨¡å¼ä¸‹ï¼Œåœ¨å‘é€IPåŒ…çš„è¿‡ç¨‹ï¼Œç»è¿‡ä¸‰æ¬¡ç”¨æˆ·æ€ä¸å†…æ ¸æ€çš„æ•°æ®æ‹·è´&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ç”¨æˆ·æ€çš„å®¹å™¨è¿›ç¨‹å‘å‡ºIPåŒ…ç»è¿‡docker0ç½‘æ¡¥è¿›å…¥å†…æ ¸æ€&lt;/li&gt;
&lt;li&gt;IPåŒ…æ ¹æ®è·¯ç”±è¡¨è¿›å…¥flannel0è®¾å¤‡ï¼Œä»è€Œå›åˆ°ç”¨æˆ·æ€çš„flanneldè¿›ç¨‹&lt;/li&gt;
&lt;li&gt;flanneldè¿›è¡ŒUDPå°åŒ…åé‡æ–°è¿›å…¥å†…æ ¸æ€ï¼Œå°†UDPåŒ…é€šè¿‡å®¿ä¸»æœºçš„eth0å‘é€å‡ºå»&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;flannel VXLANæ¨¡å¼ä¸‹çš„è·¨ä¸»æœºé€šä¿¡&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;é€šè¿‡VXLANæ¨¡å¼ï¼ˆVirtual Extensible LANï¼‰è§£å†³UDPæ¨¡å¼ä¸‹ä¸Šä¸‹æ–‡åˆ‡æ¢é¢‘ç¹å¸¦æ¥çš„æ€§èƒ½é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;åŸç†æ˜¯é€šè¿‡åœ¨äºŒå±‚ç½‘ç»œä¸Šå†è®¾ç½®ä¸€ä¸ªVTEPè®¾å¤‡ï¼Œè¯¥è®¾å¤‡æ˜¯Linuxå†…æ ¸ä¸­ä¸€ä¸ªæ¨¡å—ï¼Œå¯ä»¥åœ¨å†…æ ¸æ€å®Œæˆæ•°æ®çš„å°è£…å’Œè§£å°ã€‚flannel.1è®¾å¤‡ï¼ˆVTEPï¼‰æ—¢æœ‰IPåœ°å€åˆæœ‰MACåœ°å€ï¼Œåœ¨æ•°æ®åŒ…å‘å¾€flannel.1è®¾å¤‡æ—¶ï¼Œé€šè¿‡äºŒå±‚æ•°æ®å¸§ï¼Œå°†åŸæ•°æ®åŒ…åŠ ä¸Šç›®æ ‡èŠ‚ç‚¹çš„MVCåœ°å€ï¼Œå†åŠ ä¸ŠVTEPæ ‡è¯†ï¼Œå°è£…æˆä¸€ä¸ªäºŒå±‚æ•°æ®å¸§ï¼Œç„¶åå†å°è£…æˆå®¿ä¸»æœºç½‘ç»œé‡Œçš„æ™®é€šUDPæ•°æ®åŒ…ï¼Œå‘é€ç»™ç›®æ ‡èŠ‚ç‚¹ï¼Œç›®æ ‡èŠ‚ç‚¹åœ¨å†…æ ¸ç½‘ç»œæ ˆä¸­å‘ç°äº†VTEPæ ‡è¯†ï¼Œå°±çŸ¥é“å¯ä»¥åœ¨å†…æ ¸æ€å¤„ç†äº†ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/flannel_vxlan%e8%b7%a8%e4%b8%bb%e6%9c%ba%e9%80%9a%e4%bf%a1.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/flannel_vxlan%e8%b7%a8%e4%b8%bb%e6%9c%ba%e9%80%9a%e4%bf%a1.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;æ•°æ®åŒ…çš„å‘é€éƒ½è¦ç»è¿‡OSIé‚£å‡ å±‚æ¨¡å‹çš„ï¼Œç»è¿‡çš„æ¯ä¸€å±‚éƒ½éœ€è¦è¿›è¡ŒåŒ…è£…å’Œè§£å°ï¼Œæ‰èƒ½å¾—åˆ°åŸå§‹æ•°æ®ï¼Œåœ¨è¿™æœŸé—´äºŒå±‚ç½‘ç»œ(æ•°æ®é“¾è·¯å±‚)æ˜¯åœ¨å†…æ ¸æ€å¤„ç†ï¼Œä¸‰å±‚ç½‘ç»œ(ç½‘ç»œå±‚)æ˜¯åœ¨ç”¨æˆ·æ€å¤„ç†ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;flannel host-gwæ¨¡å¼ï¼ˆä¸‰å±‚ç½‘ç»œæ–¹æ¡ˆï¼‰&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;äºŒå±‚æŒ‡çš„æ˜¯åœ¨çŸ¥é“ä¸‹ä¸€è·³çš„IPå¯¹åº”çš„MACåœ°å€åï¼Œç›´æ¥åœ¨æ•°æ®é“¾è·¯å±‚é€šä¿¡ï¼Œå¦‚æœä¸çŸ¥é“ï¼Œå°±éœ€è¦åœ¨ç½‘ç»œå±‚è®¾ç½®è·¯ç”±è¡¨ï¼Œé€šè¿‡è·¯ç”±é€šä¿¡ï¼Œæ­¤æ—¶å°±æ˜¯ä¸‰å±‚ç½‘ç»œã€‚&lt;/p&gt;
&lt;p&gt;å°†æ¯ä¸ªFlannelå­ç½‘çš„ä¸‹ä¸€è·³è®¾ç½®æˆè¯¥å­ç½‘å¯¹åº”çš„å®¿ä¸»æœºçš„IPåœ°å€ï¼Œç”¨è¿™å°å®¿ä¸»æœºå……å½“ç½‘å…³ï¼ŒFlannelå­ç½‘å’Œä¸»æœºä¿¡æ¯éƒ½ä¿å­˜åœ¨ETCDä¸­ï¼Œç”±flanneldè¿›ç¨‹WATCHè¿™äº›æ•°æ®çš„å˜åŒ–ï¼Œå®æ—¶æ›´æ–°è·¯ç”±è¡¨ï¼Œè¿™ç§æ–¹æ¡ˆçš„æ€§èƒ½æœ€å¥½ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/flannel_host_gw%e8%b7%a8%e4%b8%bb%e6%9c%ba%e9%80%9a%e4%bf%a1.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/flannel_host_gw%e8%b7%a8%e4%b8%bb%e6%9c%ba%e9%80%9a%e4%bf%a1.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;calicoçš„è·¨ä¸»æœºé€šä¿¡&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ç±»ä¼¼flannel host-gwæ¨¡å¼ï¼Œcalicoä¼šåœ¨å®¿ä¸»æœºä¸Šåˆ›å»ºä¸€ä¸ªè·¯ç”±è¡¨ï¼Œç»´æŠ¤é›†ç¾¤å†…å„ä¸ªç‰©ç†æœºã€å®¹å™¨çš„è·¯ç”±è§„åˆ™ï¼Œé€šè¿‡è¿™å¼ è·¯ç”±è¡¨å®ç°è·¨ä¸»æœºé€šä¿¡ã€‚é€šè¿‡è¾¹ç•Œç½‘å…³åè®®BGPï¼Œåœ¨é›†ç¾¤çš„å„ä¸ªèŠ‚ç‚¹ä¸­å®ç°è·¯ç”±ä¿¡æ¯å…±äº«ã€‚&lt;/p&gt;
&lt;p&gt;å› æ­¤calicoä¸éœ€è¦åœ¨å®¿ä¸»æœºä¸Šåˆ›å»ºä»»ä½•ç½‘æ¡¥è®¾å¤‡ï¼Œé€šè¿‡Veth Pairè®¾å¤‡ + è·¯ç”±è¡¨çš„æ–¹å¼ï¼Œå³å¯å®ŒæˆèŠ‚ç‚¹IPå¯»æ‰¾å’Œè½¬å‘ã€‚&lt;/p&gt;
&lt;p&gt;ä½†è¿™ç§æ–¹æ¡ˆä¼šé‡åˆ°è·¯ç”±è¡¨çš„è§„æ¨¡é—®é¢˜ï¼Œä¸”æœ€ä¼˜æƒ…å†µæ˜¯é›†ç¾¤èŠ‚ç‚¹åœ¨åŒä¸€ä¸ªå­ç½‘ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/calico%e8%b7%a8%e4%b8%bb%e6%9c%ba%e9%80%9a%e4%bf%a1.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/calico%e8%b7%a8%e4%b8%bb%e6%9c%ba%e9%80%9a%e4%bf%a1.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;h3 id=&#34;podä¸­çš„ç½‘ç»œéš”ç¦»&#34;&gt;Podä¸­çš„ç½‘ç»œéš”ç¦»&lt;/h3&gt;
&lt;p&gt;é€šè¿‡NetworkPolicyå¯¹è±¡æ¥å®ç°ï¼Œæ§åˆ¶Podçš„å…¥ç«™å’Œå‡ºç«™è¯·æ±‚ï¼Œå®ç°äº†NetworkPolicyçš„ç½‘ç»œæ’ä»¶åŒ…æ‹¬Calicoã€Weaveï¼Œä¸åŒ…æ‹¬Flannelã€‚é€šè¿‡NetworkPolicy Controllerç›‘æ§NetworkPolicyï¼Œä¿®æ”¹å®¿ä¸»æœºä¸Šçš„iptableã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.k8s.io/v1 &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;NetworkPolicy &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;test-network-policy &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;default &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;podSelector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;matchLabels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;role: db # æ ‡ç­¾ä¸ºrole&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;dbçš„Podæ‹¥æœ‰è¯¥NetworkPolicyï¼Œå¦‚æœä¸ºç©ºï¼Œåˆ™è¯¥namespaceä¸‹æ‰€æœ‰Podéƒ½æ— æ³•é€šä¿¡&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;policyTypes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;Ingress &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;Egress &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ingress&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;from&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# fromæ•°ç»„å†…å…ƒç´ æ˜¯orå…³ç³»ï¼Œå…ƒç´ å†…å¯ä»¥åŒ…å«å…¶ä»–Selectorï¼Œä»–ä»¬æ˜¯andå…³ç³»&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;ipBlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;cidr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;172.17.0.0&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/16&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# åªå…è®¸è¿™ä¸ªç½‘æ®µçš„èŠ‚ç‚¹è®¿é—®ï¼Œä¸”ä¸å…è®¸172.17.1.0/24ç½‘æ®µçš„èŠ‚ç‚¹è®¿é—®&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;except&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- &lt;span class=&#34;m&#34;&gt;172.17.1.0&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/24&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;namespaceSelector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;matchLabels: # åªå…è®¸æ ‡ç­¾ä¸º project&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;myproject çš„Podè®¿é—®&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;project&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;myproject &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;podSelector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;matchLabels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;role&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;frontend &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# åªå…è®¸è®¿é—®è¿™äº›podçš„6379ç«¯å£&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;TCP &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;6379&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;egress&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;to&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;ipBlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;cidr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;10.0.0.0&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/24&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# åªå…è®¸è¿™äº›Podå¯¹å¤–è®¿é—®è¿™ä¸ªç½‘æ®µçš„èŠ‚ç‚¹ï¼Œä¸”ç«¯å£æ˜¯5978&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;TCP &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;5978&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id=&#34;pvpvcstoageclass&#34;&gt;PVã€PVCã€StoageClass&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;PVCï¼ˆPersistent Volume Claimï¼‰ï¼šå®šä¹‰æŒä¹…åŒ–å·çš„å£°æ˜ï¼Œä½œç”¨ç±»ä¼¼äºæ¥å£ï¼Œå¼€å‘äººå‘˜ç›´æ¥ä½¿ç”¨è€Œä¸ç”¨çŸ¥é“å…¶å…·ä½“å®ç°ï¼Œæ¯”å¦‚å®šä¹‰äº†æ•°æ®åº“çš„ç”¨æˆ·åå’Œå¯†ç ä¹‹ç±»çš„å±æ€§ã€‚&lt;/p&gt;
&lt;p&gt;PVCçš„å‘½åæ–¹å¼ï¼š&lt;code&gt;&amp;lt;PVCåå­—&amp;gt;-&amp;lt;StatefulSetåå­—&amp;gt;-&amp;lt;ç¼–å·&amp;gt;&lt;/code&gt;ï¼ŒStatefulSetåˆ›å»ºå‡ºæ¥çš„æ‰€æœ‰Podéƒ½ä¼šä½¿ç”¨æ­¤PVCï¼ŒKubernetesé€šè¿‡Dynamic Provisioningçš„æ–¹å¼ä¸ºè¯¥PVCåŒ¹é…å¯¹åº”çš„PVã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;PVï¼ˆPersistent Volumeï¼‰ï¼šæŒä¹…åŒ–å·çš„å…·ä½“å®ç°ï¼Œå³å®šä¹‰äº†æŒä¹…åŒ–æ•°æ®çš„ç›¸å…³å±æ€§ï¼Œå¦‚æ•°æ®åº“ç±»å‹ã€ç”¨æˆ·åå¯†ç ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;StorageClassï¼šåˆ›å»ºPVçš„æ¨¡æ¿ï¼Œåªæœ‰åŒå±äºä¸€ä¸ªStorageClassçš„PVå’ŒPVCï¼Œæ‰å¯ä»¥ç»‘å®šåœ¨ä¸€èµ·ï¼ŒK8så†…é»˜è®¤æœ‰ä¸€ä¸ªåå­—ä¸ºç©ºä¸²çš„DefaultStorageClassã€‚&lt;/p&gt;
&lt;p&gt;StorageClassç”¨äº&lt;strong&gt;è‡ªåŠ¨&lt;/strong&gt;åˆ›å»ºPVï¼ŒStorageClassçš„å®šä¹‰æ¯”PVæ›´åŠ é€šç”¨ï¼Œä¸€ä¸ªStorageClasså¯ä»¥å¯¹åº”å¤šä¸ªPVï¼Œè¿™æ ·å°±æ— éœ€æ‰‹åŠ¨åˆ›å»ºå¤šä¸ªPVäº†ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é›†ç¾¤ä¸­çš„æ¯ä¸€ä¸ªå·åœ¨è¢«Podä½¿ç”¨æ—¶éƒ½ä¼šç»å†å››ä¸ªæ“ä½œï¼šé™„ç€Attachã€æŒ‚è½½Mountã€å¸è½½Unmountå’Œåˆ†ç¦»Detachï¼›&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å¦‚æœ Pod ä¸­ä½¿ç”¨çš„æ˜¯ EmptyDirã€HostPath è¿™ç§ç±»å‹çš„å·ï¼Œé‚£ä¹ˆè¿™äº›å·å¹¶ä¸ä¼šç»å†é™„ç€å’Œåˆ†ç¦»çš„æ“ä½œï¼Œå®ƒä»¬åªä¼šè¢«æŒ‚è½½å’Œå¸è½½åˆ°æŸä¸€ä¸ªçš„ Pod ä¸­ï¼› EmptyDirã€HostPathã€ConfigMap å’Œ Secretï¼Œè¿™äº›å·ä¸æ‰€å±çš„ Pod å…·æœ‰ç›¸åŒçš„ç”Ÿå‘½å‘¨æœŸï¼Œå¯¹äºConfigMapå’ŒSercetï¼Œåœ¨æŒ‚è½½æ—¶ä¼šåˆ›å»ºä¸´æ—¶çš„volumeï¼Œéšç€Podçš„åˆ é™¤è€Œåˆ é™¤ï¼Œè€Œä¸ä¼šå½±å“æœ¬èº«çš„ConfigMapå’ŒSecretå¯¹è±¡ï¼›&lt;/p&gt;
&lt;p&gt;å¦‚æœä½¿ç”¨çš„äº‘æœåŠ¡å•†æä¾›çš„å­˜å‚¨æœåŠ¡ï¼Œè¿™äº›æŒä¹…å·åªæœ‰é™„ç€åˆ°æŸä¸€ä¸ªèŠ‚ç‚¹ä¹‹åæ‰å¯ä»¥è¢«æŒ‚åœ¨åˆ°ç›¸åº”çš„ç›®å½•ä¸‹ï¼Œä¸è¿‡åœ¨å…¶ä»–èŠ‚ç‚¹ä½¿ç”¨è¿™äº›å·æ—¶ï¼Œè¯¥å­˜å‚¨èµ„æºéœ€è¦å…ˆä¸å½“å‰çš„èŠ‚ç‚¹åˆ†ç¦»ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;pvcä¸pvçš„ç»‘å®šæ¡ä»¶&#34;&gt;PVCä¸PVçš„ç»‘å®šæ¡ä»¶&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;PVå’ŒPVCçš„specå­—æ®µè¦åŒ¹é…ï¼Œæ¯”å¦‚å­˜å‚¨çš„å¤§å°&lt;/li&gt;
&lt;li&gt;PVå’ŒPVCçš„storageClassNameå­—æ®µå¿…é¡»ä¸€æ ·&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;Volume çš„åˆ›å»ºå’Œç®¡ç†åœ¨ Kubernetes ä¸­ä¸»è¦ç”±å·ç®¡ç†å™¨ VolumeManager å’Œ AttachDetachController å’Œ PVControllerä¸‰ä¸ªç»„ä»¶è´Ÿè´£ã€‚å…¶ä¸­VolumeManager ä¼šè´Ÿè´£å·çš„åˆ›å»ºå’Œç®¡ç†çš„å¤§éƒ¨åˆ†å·¥ä½œï¼Œè€Œ AttachDetachController ä¸»è¦è´Ÿè´£å¯¹é›†ç¾¤ä¸­çš„å·è¿›è¡Œ Attach å’Œ Detachï¼ŒPVController è´Ÿè´£å¤„ç†æŒä¹…å·çš„å˜æ›´ã€‚&lt;/p&gt;
&lt;p&gt;å½“ç”¨æˆ·æäº¤è¯·æ±‚åˆ›å»ºpodï¼ŒKuberneteså‘ç°è¿™ä¸ªpodå£°æ˜ä½¿ç”¨äº†PVCï¼Œé‚£å°±é PersistentVolumeControllerå¸®å®ƒæ‰¾ä¸€ä¸ªPVé…å¯¹ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœæ²¡æœ‰ç°æˆçš„PVï¼Œå°±å»æ‰¾å¯¹åº”çš„StorageClassï¼Œå¸®å®ƒæ–°åˆ›å»ºä¸€ä¸ªPVï¼Œç„¶åå’ŒPVCå®Œæˆç»‘å®šã€‚&lt;/p&gt;
&lt;p&gt;æ–°åˆ›å»ºçš„PVï¼Œè¿˜åªæ˜¯ä¸€ä¸ªAPI å¯¹è±¡ï¼Œéœ€è¦ç»è¿‡â€œä¸¤é˜¶æ®µå¤„ç†â€å˜æˆå®¿ä¸»æœºä¸Šçš„â€œæŒä¹…åŒ– Volumeâ€æ‰çœŸæ­£æœ‰ç”¨ï¼š
ç¬¬ä¸€é˜¶æ®µAttachï¼šç”±è¿è¡Œåœ¨masterä¸Šçš„AttachDetachControllerè´Ÿè´£ï¼Œä¸ºè¿™ä¸ªPVå®Œæˆ Attach æ“ä½œï¼Œä¸ºå®¿ä¸»æœºæŒ‚è½½è¿œç¨‹ç£ç›˜ï¼›
ç¬¬äºŒé˜¶æ®µMountï¼šè¿è¡Œåœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Škubeletç»„ä»¶çš„å†…éƒ¨ï¼ŒæŠŠç¬¬ä¸€æ­¥attachçš„è¿œç¨‹ç£ç›˜ mount åˆ°å®¿ä¸»æœºç›®å½•ã€‚è¿™ä¸ªæ§åˆ¶å¾ªç¯å«VolumeManagerReconcilerï¼Œè¿è¡Œåœ¨ç‹¬ç«‹çš„Goroutineï¼Œä¸ä¼šé˜»å¡kubeletä¸»å¾ªç¯ã€‚&lt;/p&gt;
&lt;p&gt;å®Œæˆè¿™ä¸¤æ­¥ï¼ŒPVå¯¹åº”çš„â€œæŒä¹…åŒ– Volumeâ€å°±å‡†å¤‡å¥½äº†ï¼ŒPodå¯ä»¥æ­£å¸¸å¯åŠ¨ï¼Œå°†â€œæŒä¹…åŒ– Volumeâ€æŒ‚è½½åœ¨å®¹å™¨å†…æŒ‡å®šçš„è·¯å¾„ã€‚å½“éœ€è¦å¸è½½æ—¶ï¼Œåˆ™å…ˆUnmountå†è¿›è¡ŒDettachã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;è®¿é—®æ¨¡å¼&#34;&gt;è®¿é—®æ¨¡å¼&lt;/h3&gt;
&lt;p&gt;ç”±å·çš„æä¾›å•†æä¾›ï¼Œæ¯”å¦‚AWSçš„EBSä¸­çš„GP2ã€GP3ç£ç›˜ï¼Œæ˜¯ReadWriteOnceæ¨¡å¼ï¼Œæ‰€ä»¥ä¸€ä¸ªå·åªèƒ½è¢«ä¸€ä¸ªèŠ‚ç‚¹ä½¿ç”¨ï¼Œå¦åˆ™ä¼šå‡ºç°å†™å†²çªï¼Œå³ä½¿ç”¨podçš„å¤åˆ¶é›†åªèƒ½è®¾ç½®ä¸º1ï¼Œä¸”æ›´æ–°ç­–ç•¥ä¸ºrecreateï¼Œä¿è¯åªæœ‰ä¸€ä¸ªpodä½¿ç”¨æ‰è¡Œï¼›è€Œå¦‚æœæ˜¯ReadWriteManyæ¨¡å¼ï¼Œæ¯”å¦‚AWSçš„EFSï¼ˆEFSæœ¬è´¨ä¸Šæ˜¯AWSå¯¹NFSçš„ä¸€æ¬¡å°è£…ï¼‰ï¼Œåˆ™å…è®¸å¤šä¸ªpodå…±äº«åŒä¸€ä¸ªæŒä¹…å·&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ReadWriteOnceï¼šå·å¯ä»¥è¢«ä¸€ä¸ªèŠ‚ç‚¹ä»¥è¯»å†™æ–¹å¼æŒ‚è½½ï¼Œå…è®¸åŒä¸€ä¸ªèŠ‚ç‚¹ä¸Šçš„å¤šä¸ªPodè®¿é—®ï¼›&lt;/li&gt;
&lt;li&gt;ReadOnlyManyï¼šå·å¯ä»¥è¢«å¤šä¸ªèŠ‚ç‚¹ä»¥åªè¯»æ–¹å¼æŒ‚è½½ï¼›&lt;/li&gt;
&lt;li&gt;ReadWriteManyï¼šå·å¯ä»¥è¢«å¤šä¸ªèŠ‚ç‚¹ä»¥è¯»å†™æ–¹å¼æŒ‚è½½ï¼›&lt;/li&gt;
&lt;li&gt;ReadWriteOncePodï¼šå·å¯ä»¥è¢«å•ä¸ª Pod ä»¥è¯»å†™æ–¹å¼æŒ‚è½½ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;å›æ”¶ç­–ç•¥&#34;&gt;å›æ”¶ç­–ç•¥&lt;/h3&gt;
&lt;p&gt;å½“PVCå¯¹è±¡è¢«åˆ é™¤æ—¶ï¼Œkuberneteså°±éœ€è¦å¯¹å·è¿›è¡Œå›æ”¶ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Retainï¼šä¿ç•™PVä¸­çš„æ•°æ®ï¼Œå¦‚æœPVæƒ³è¢«é‡æ–°ä½¿ç”¨ï¼Œç³»ç»Ÿç®¡ç†å‘˜å°±éœ€è¦åˆ é™¤è¢«ä½¿ç”¨çš„PVå¯¹è±¡ï¼Œå¹¶æ‰‹åŠ¨æ¸…é™¤å­˜å‚¨å’Œç›¸å…³å­˜å‚¨ä¸Šçš„æ•°æ®ã€‚&lt;/li&gt;
&lt;li&gt;Deleteï¼šPVå’Œç›¸å…³çš„å­˜å‚¨ä¼šè¢«è‡ªåŠ¨åˆ é™¤ï¼Œå¦‚æœå½“å‰PVä¸Šçš„æ•°æ®ç¡®å®ä¸å†éœ€è¦ï¼Œä½¿ç”¨æ­¤ç­–ç•¥å¯ä»¥èŠ‚çœæ‰‹åŠ¨å¤„ç†çš„æ—¶é—´å¹¶å¿«é€Ÿé‡Šæ”¾æ— ç”¨çš„èµ„æºã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;48
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;49
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;50
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;51
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;52
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;53
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;54
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;55
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;56
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;57
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;58
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;59
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;60
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;61
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;apps/v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;StatefulSet&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;web &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;serviceName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;nginx&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;replicas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;matchLabels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;nginx &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# å£°æ˜Pod&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;template&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;nginx &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;containers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;nginx &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;image&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;nginx:1.9.1 &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;containerPort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;80&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;web &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;volumeMounts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;www &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;mountPath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/usr/share/nginx/html&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# å£°æ˜æŒ‚è½½çš„PVC&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;volumeClaimTemplates&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;www &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;accessModes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;ReadWriteOnce &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;resources&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;requests&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;storage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;10Gi&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;---&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# å£°æ˜è¦æŒ‚è½½çš„PV&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;PersistentVolume&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;nginx-pv&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;nginx&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;capacity&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;storage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;500Gi&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;volumeMode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Filesystem&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;accessModes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;ReadWriteMany&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;persistentVolumeReclaimPolicy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Retain&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;storageClassName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;efs-sc&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;csi&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;driver&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;efs.csi.aws.com&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;volumeHandle&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;fs-09b712ab658f73e6f::fsap-xxx&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;---&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# å£°æ˜è¦æŒ‚è½½çš„StorageClass&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;StorageClass&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;storage.k8s.io/v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;efs-sc&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;provisioner&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;efs.csi.aws.com&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id=&#34;æ§åˆ¶å™¨æ¨¡å‹&#34;&gt;æ§åˆ¶å™¨æ¨¡å‹&lt;/h2&gt;
&lt;p&gt;å¸¸è§çš„æ§åˆ¶å™¨æœ‰Deploymentã€Jobã€CronbJobã€ReplicaSetã€StatefulSetã€DaemonSetç­‰ï¼Œä»–ä»¬æ˜¯ç”¨äºåˆ›å»ºå’Œç®¡ç†Podçš„å®ä¾‹ï¼Œèƒ½å¤Ÿåœ¨é›†ç¾¤å±‚é¢æä¾›å¤åˆ¶ã€å‘å¸ƒä»¥åŠå¥åº·æ£€æŸ¥ç­‰åŠŸèƒ½ï¼Œè¿™äº›æ§åˆ¶å™¨éƒ½è¿è¡Œåœ¨Kubernetesé›†ç¾¤çš„MasterèŠ‚ç‚¹ä¸Šï¼Œè¿™äº›æ§åˆ¶å™¨ä¼šéšController Managerçš„å¯åŠ¨è€Œè¿è¡Œï¼Œç›‘å¬é›†ç¾¤çŠ¶æ€çš„å˜æ›´æ¥è°ƒæ•´å¯¹åº”å¯¹è±¡çš„çŠ¶æ€ã€‚&lt;/p&gt;
&lt;h3 id=&#34;åŸç†-3&#34;&gt;åŸç†&lt;/h3&gt;
&lt;p&gt;æ§åˆ¶å¾ªç¯ï¼šåœ¨ä¸€ä¸ªæ— é™å¾ªç¯å†…ä¸æ–­çš„è½®è¯¢é›†ç¾¤ä¸­çš„å¯¹è±¡ï¼Œå°†å…¶çŠ¶æ€ä¸æœŸæœ›çš„çŠ¶æ€åšå¯¹æ¯”åï¼Œå¯¹è¯¥å¯¹è±¡é‡‡å–ç›¸åº”çš„æ“ä½œã€‚å®é™…çŠ¶æ€æ¥è‡ªé›†ç¾¤æœ¬èº«ï¼Œå¦‚Kubeletæ±‡æŠ¥çš„å®¹å™¨çŠ¶æ€ã€èŠ‚ç‚¹çŠ¶æ€ï¼Œç›‘æ§ç³»ç»Ÿçš„ç›‘æ§æ•°æ®ï¼›æœŸæœ›çŠ¶æ€æ¥è‡ªç”¨æˆ·æäº¤çš„yamlæ–‡ä»¶ï¼›å¯¹è±¡XæŒ‡çš„æ˜¯Podæˆ–æ˜¯å…¶ä»–å—æ§åˆ¶å™¨æ§åˆ¶çš„å¯¹è±¡ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;9
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; 
    &lt;span class=&#34;nx&#34;&gt;å®é™…çŠ¶æ€&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;è·å–é›†ç¾¤ä¸­å¯¹è±¡Xçš„å®é™…çŠ¶æ€&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ï¼ˆ&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Actual&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;State&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ï¼‰&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;æœŸæœ›çŠ¶æ€&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;è·å–é›†ç¾¤ä¸­å¯¹è±¡Xçš„æœŸæœ›çŠ¶æ€&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ï¼ˆ&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Desired&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;State&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ï¼‰&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;å®é™…çŠ¶æ€&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;æœŸæœ›çŠ¶æ€&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;nx&#34;&gt;ä»€ä¹ˆéƒ½ä¸åš&lt;/span&gt; 
    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; 
        &lt;span class=&#34;nx&#34;&gt;æ‰§è¡Œç¼–æ’åŠ¨ä½œ&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ï¼Œ&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;å°†å®é™…çŠ¶æ€è°ƒæ•´ä¸ºæœŸæœ›çŠ¶æ€&lt;/span&gt; 
    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; 
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ä¸äº‹ä»¶é©±åŠ¨çš„åŒºåˆ«ï¼šäº‹ä»¶é©±åŠ¨æ˜¯è¢«åŠ¨å‹ï¼Œæ¥æ”¶åˆ°äº‹ä»¶å°±æ‰§è¡Œç›¸åº”çš„æ“ä½œï¼Œäº‹ä»¶æ˜¯ä¸€æ¬¡æ€§ï¼Œå› æ­¤æ“ä½œå¤±è´¥æ¯”è¾ƒéš¾å¤„ç†ï¼Œæ§åˆ¶å¾ªç¯æ˜¯ä¸æ–­è½®è¯¢åˆ¤æ–­å®é™…çŠ¶æ€æ˜¯å¦ä¸æœŸæœ›ä¸€è‡´ã€‚&lt;/p&gt;
&lt;h3 id=&#34;deployment&#34;&gt;Deployment&lt;/h3&gt;
&lt;p&gt;æœ€åŸºæœ¬çš„æ§åˆ¶å™¨å¯¹è±¡ï¼Œç®¡ç†Podçš„å·¥å…·ï¼Œæ¯”å¦‚ç®¡ç†å¤šä¸ªç›¸åŒPodçš„å®ä¾‹ï¼ŒDeploymentå’ŒReplicaSetéƒ½èƒ½æ§åˆ¶Podçš„æ•°é‡ï¼Œä½†ä¸€èˆ¬æˆ‘ä»¬ä½¿ç”¨çš„è¿˜æ˜¯Deploymentï¼Œå› ä¸ºå…¶è¿˜æœ‰å…¶ä»–åŠŸèƒ½ï¼Œæ¯”å¦‚æ»šåŠ¨æ›´æ–°ã€å›æ»šã€æš‚åœå’Œæ¢å¤ç­‰ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;apps/v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Deployment&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;nginx-deployment&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;paused&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# æš‚åœï¼šfalse&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# é€šè¿‡spec.selector.matchLabelsæ ¹æ®Podçš„æ ‡ç­¾é€‰æ‹©Pod&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;matchLabels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;nginx&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;replicas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# ä¸Šé¢çš„éƒ¨åˆ†å®šä¹‰äº†æ§åˆ¶å†…å®¹ï¼Œåˆ¤æ–­å®é™…ä¸æœŸæœ›ï¼Œå¹¶è¿›è¡Œç›¸åº”çš„æ“ä½œï¼Œä¸‹é¢æ˜¯è¢«æ§åˆ¶çš„å¯¹è±¡&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;template&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;nginx&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;containers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;nginx&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;image&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;nginx:1.7.9&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;containerPort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;80&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;strategy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;RollingUpdate&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;rollingUpdate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# å¯ä½¿ç”¨å€¼ä¹Ÿå¯ä»¥ä½¿ç”¨ç™¾åˆ†æ¯”ï¼Œä½¿ç”¨ç™¾åˆ†æ¯”æ—¶ï¼Œä¸replcaå€¼ç›¸ä¹˜å¾—åˆ°æœ€ç»ˆçš„å€¼&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;maxUnavailable&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;25&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;%&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# åœ¨æ›´æ–°è¿‡ç¨‹ä¸­èƒ½å¤Ÿè¿›å…¥ä¸å¯ç”¨çŠ¶æ€çš„Podçš„æœ€å¤§å€¼&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;maxSurge&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;25&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;%&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# èƒ½é¢å¤–åˆ›å»ºçš„Podçš„ä¸ªæ•°&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;Deploymentæƒ³è¦å®ç°æ°´å¹³æ‰©å±•/æ”¶ç¼©ï¼Œå®é™…æ“æ§çš„æ˜¯ReplicaSetå¯¹è±¡ï¼Œè€ŒReplicaSetç®¡ç†ç€å®šä¹‰æ•°é‡çš„Podï¼Œæ‰€ä»¥å®ƒæ˜¯ä¸€ç§ä¸‰å±‚ç»“æ„ï¼ŒDeployment -&amp;gt; ReplicaSet -&amp;gt; å¤šä¸ªå¹³è¡Œçš„Podï¼ŒDeploymentæ˜¯ä¸€ä¸ªä¸¤å±‚æ§åˆ¶å™¨ï¼ŒDeploymentæ§åˆ¶çš„æ˜¯RepliocaSetçš„ç‰ˆæœ¬ï¼ŒReplicaSetæ§åˆ¶çš„æ˜¯Podçš„æ•°é‡ã€‚&lt;/p&gt;
&lt;p&gt;ReplicaSetè¡¨ç¤ºç‰ˆæœ¬ï¼Œæ¯”å¦‚ä¸Šé¢é‚£ä»½é…ç½®ï¼Œ&lt;code&gt;replicas: 2&lt;/code&gt;æ˜¯ä¸€ä¸ªç‰ˆæœ¬ï¼Œ&lt;code&gt;replicas: 3&lt;/code&gt;æ˜¯ä¸€ä¸ªç‰ˆæœ¬ï¼Œè¿™é‡Œæ˜¯å› ä¸ºæ•°é‡ä¸åŒäº§ç”Ÿä¸¤ä¸ªç‰ˆæœ¬ï¼Œæ¯ä¸€ä¸ªç‰ˆæœ¬å¯¹åº”ç€ä¸€ä¸ªReplicaSetï¼Œç”±Deploymentç®¡ç†ã€‚&lt;/p&gt;
&lt;p&gt;ReplicaSetæ˜¯ReplicationControllerçš„å‡çº§ç‰ˆï¼Œéƒ½ç”¨äºç¡®ä¿è¿è¡ŒæŒ‡å®šæ•°é‡çš„Podå‰¯æœ¬ï¼ˆåƒæ»šåŠ¨æ›´æ–°ã€å›æ»šã€å¯åŠ¨ã€æš‚åœä¹‹ç±»çš„åŠŸèƒ½åˆ™ç”±Deploymentæä¾›ï¼‰ï¼ŒReplicationControlleråªæ”¯æŒåŸºäºç­‰å¼çš„selectorï¼Œæ¯”å¦‚&lt;code&gt;xxx = yyyæˆ–xxx != yyy&lt;/code&gt;ï¼Œè€ŒReplicaSetæ”¯æŒåŸºäºé›†åˆçš„selectorï¼Œæ¯”å¦‚ &lt;code&gt;matchExpressions: {key: tier, operator: In, values: [frontend]}&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å½“æˆ‘ä»¬ä¿®æ”¹Deploymentçš„replicaså­—æ®µæ—¶ï¼Œä¼šè§¦å‘æ°´å¹³æ‰©å±•/æ”¶ç¼©ï¼Œä¿®æ”¹&lt;code&gt;template.Image&lt;/code&gt;æˆ–è€…ç‰ˆæœ¬å·æ—¶ï¼Œå°±ä¼šè§¦å‘æ»šåŠ¨æ›´æ–°ï¼Œé»˜è®¤æ˜¯æ»šåŠ¨æ›´æ–°RollingUpdateï¼Œå¦å¤–è¿˜èƒ½è®¾ç½®æˆé‡å»ºRecreateï¼Œè¡¨ç¤ºDeploymentåœ¨æ›´æ–°Podæ—¶ï¼Œå…ˆkillæ‰æ‰€æœ‰åœ¨è¿è¡Œçš„Podï¼Œç„¶ååˆ›å»ºæ–°çš„Podã€‚&lt;/p&gt;
&lt;p&gt;Controller Managerä¸­çš„DeploymentControllerä½œä¸ºç®¡ç†Deploymentèµ„æºçš„æ§åˆ¶å™¨ï¼Œä¼šåœ¨å¯åŠ¨æ—¶é€šè¿‡Informerç›‘å¬Podã€ReplicaSetå’ŒDeploymentçš„å˜æ›´ï¼Œä¸€æ—¦å˜æ›´å°±ä¼šè§¦å‘DeploymentControllerä¸­çš„å›è°ƒï¼›&lt;/p&gt;
&lt;p&gt;åˆå§‹åŒ–åˆ›å»ºDeploymentæ—¶ï¼ŒKubernetesä¼šåˆ›å»ºäº†ä¸€ä¸ªReplicaSetï¼Œå¹¶æŒ‰ç”¨æˆ·çš„éœ€æ±‚åˆ›å»ºäº†å¯¹åº”æ•°é‡çš„Podå‰¯æœ¬ï¼Œå½“Deploymentæ›´æ–°æ—¶ï¼ŒKubernetesä¼šå†åˆ›å»ºä¸€ä¸ªæ–°çš„ReplicaSetï¼Œç„¶åæŒ‰ç…§ç›¸åŒçš„æ›´æ–°ç­–ç•¥é€ä¸ªè°ƒæ•´ï¼Œå°†è€çš„ReplicaSetçš„å‰¯æœ¬æ•°-1ï¼Œæ–°ReplicaSetçš„å‰¯æœ¬æ•°+1ï¼Œç›´åˆ°æ–°çš„ReplicaSetçš„å‰¯æœ¬æ•°ç¬¦åˆé¢„æœŸï¼Œè€çš„ReplicaSetå‰¯æœ¬æ•°ç¼©å‡ä¸º0ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;9
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;c&#34;&gt;# è®¾ç½®æ›´æ–°ç­–ç•¥&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;strategy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;RollingUpdate&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# æ»šåŠ¨æ›´æ–°ç­–ç•¥&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;rollingUpdate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;maxSurge&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# æŒ‡å®šDesiredæ•°é‡ï¼Œ&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;maxUnavailable&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# ä¸€æ¬¡æ›´æ–°ä¸­ï¼Œå¯ä»¥åˆ é™¤çš„æ—§çš„Podçš„æ•°é‡&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;Deploymentåªé€‚åˆæ§åˆ¶æ— çŠ¶æ€çš„Podï¼Œå¦‚æœæ˜¯Podä¸Podä¹‹é—´æœ‰ä¾èµ–å…³ç³»ï¼Œæˆ–è€…æœ‰çŠ¶æ€æ—¶ï¼Œdeploymentå°±ä¸èƒ½éšä¾¿æ€æ‰ä»»æ„çš„Podå†èµ·æ–°çš„Podï¼Œæ¯”å¦‚å¤šä¸ªæ•°æ®åº“å®ä¾‹ï¼Œå› ä¸ºæ•°æ®åº“æ•°æ®æ˜¯å­˜åœ¨ç£ç›˜ï¼Œå¦‚æœæ€æ‰åé‡å»ºï¼Œä¼šå‡ºç°å®ä¾‹ä¸æ•°æ®å…³ç³»ä¸¢å¤±ï¼Œå› æ­¤å°±éœ€è¦StatefulSetã€‚&lt;/p&gt;
&lt;h3 id=&#34;statefulset&#34;&gt;StatefulSet&lt;/h3&gt;
&lt;p&gt;StatefulSetå¯ä»¥è§£å†³ä¸¤ç§æƒ…å†µä¸‹çš„çŠ¶æ€ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;æ‹“æ‰‘çŠ¶æ€ï¼Œå¦‚æœPodAå’ŒPodBæœ‰å¯åŠ¨çš„å…ˆåé¡ºåºï¼Œå½“å®ƒä»¬è¢«å†æ¬¡åˆ›å»ºå‡ºæ¥æ—¶ä¹Ÿä¼šæŒ‰ç…§è¿™ä¸ªé¡ºåºè¿›è¡Œå¯åŠ¨ï¼Œä¸”æ–°åˆ›å»ºçš„Podå’ŒåŸæ¥çš„Podæ‹¥æœ‰åŒæ ·çš„ç½‘ç»œæ ‡è¯†ï¼ˆæ¯”å¦‚DNSè®°å½•ï¼‰ï¼Œä¿è¯åœ¨ä½¿ç”¨åŸæ¥çš„æ–¹å¼é€šä¿¡ä¹Ÿå¯è¡Œã€‚&lt;/p&gt;
&lt;p&gt;StatefulSeté€šè¿‡Headless Serviceï¼Œä½¿ç”¨è¿™ä¸ªDNSè®°å½•ç»´æŒPodçš„æ‹“æ‰‘çŠ¶æ€ã€‚åœ¨å£°æ˜StatefulSetæ—¶ï¼Œåœ¨&lt;code&gt;spec.serviceName&lt;/code&gt;é‡ŒæŒ‡å®šHeadless Serviceçš„åç§°ï¼Œå› ä¸ºserviceNameçš„å€¼æ˜¯å›ºå®šçš„ï¼ŒStatefulSetåœ¨ä¸ºPodèµ·åå­—çš„æ—¶å€™åˆä¼šæŒ‰é¡ºåºç¼–å·ï¼Œä¸ºæ¯ä¸ªPodç”Ÿæˆä¸€æ¡DNSè®°å½•ï¼Œé€šè¿‡DNSè®°å½•é‡Œçš„Podç¼–å·æ¥è¿›è¡Œé¡ºåºå¯åŠ¨ã€‚&lt;/p&gt;
&lt;p&gt;StatefulSetåªä¼šä¿è¯DNSè®°å½•ä¸å˜ï¼ŒPodå¯¹åº”çš„IPè¿˜æ˜¯ä¼šéšç€é‡å¯å‘ç”Ÿæ”¹å˜çš„ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å­˜å‚¨çŠ¶æ€ï¼ŒPodAç¬¬ä¸€æ¬¡è¯»å–åˆ°çš„æ•°æ®ï¼Œéš”äº†ä¸€æ®µæ—¶é—´åè¯»å–åˆ°çš„ä»ç„¶æ˜¯åŒä¸€ä»½ï¼Œæ— è®ºå…¶ä»–æœ‰æ²¡æœ‰è¢«é‡å»ºè¿‡ã€‚&lt;/p&gt;
&lt;p&gt;StatefulSeté€šè¿‡PVC + PV + ç¼–å·çš„æ–¹å¼ï¼Œå®ç° æ•°æ®å­˜å‚¨ä¸Podçš„ç»‘å®šã€‚æ¯ä¸ªPodéƒ½ä¼šæ ¹æ®ç¼–å·ä¸å¯¹åº”çš„PVCç»‘å®šï¼Œå½“Podè¢«åˆ é™¤æ—¶ï¼Œå¹¶ä¸ä¼šåˆ æ‰å¯¹åº”çš„PVï¼Œå› æ­¤åœ¨èµ·æ–°çš„Podçš„æ—¶å€™ï¼Œä¼šæ ¹æ®PVCæ‰¾åˆ°åŸæ¥çš„PVã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;StatefulSetç›´æ¥ç®¡ç†Pod&lt;/strong&gt;ï¼Œæ¯ä¸ªPodä¸å†è®¤ä¸ºåªæ˜¯å¤åˆ¶é›†ï¼Œè€Œæ˜¯ä¼šæœ‰hostnameã€åå­—ã€ç¼–å·ç­‰çš„ä¸åŒï¼Œå¹¶ç”Ÿæˆå¯¹åº”çš„å¸¦æœ‰ç›¸åŒç¼–å·çš„DNSè®°å½•ï¼Œå¯¹åº”çš„å¸¦æœ‰ç›¸åŒç¼–å·çš„PVCï¼Œä¿è¯æ¯ä¸ªPodéƒ½æ‹¥æœ‰ç‹¬ç«‹çš„Volumeã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºä¸€ä¸ªå‰¯æœ¬æ•°ä¸ºnçš„StatefulSetï¼ŒPodè¢«éƒ¨ç½²æ—¶æ˜¯æŒ‰ç…§0~n-1çš„åºå·é¡ºåºåˆ›å»ºçš„ï¼Œä¼šç­‰å¾…å‰ä¸€ä¸ªPodå˜ä¸ºRunningå’ŒReadyæ‰ä¼šå¯åŠ¨ä¸‹ä¸€ä¸ªPodã€‚ä½¿ç”¨é…ç½®&lt;code&gt;spec.podManagementPolicy: &amp;quot;Parallel&amp;quot;&lt;/code&gt;åˆ™å¯ä»¥ä½¿å¾—PodåŒæ—¶åˆ›å»ºã€‚&lt;/p&gt;
&lt;p&gt;StatefulSetçš„æ»šåŠ¨æ›´æ–°ï¼Œä¼šæŒ‰ç…§ä¸Podç¼–å·ç›¸åçš„é¡ºåºï¼Œé€ä¸€æ›´æ–°ï¼Œå¦‚æœå‘ç”Ÿé”™è¯¯ï¼Œæ»šåŠ¨æ›´æ–°ä¼šåœæ­¢ï¼›&lt;/p&gt;
&lt;p&gt;StatefulSetæ”¯æŒæŒ‰æ¡ä»¶æ›´æ–°ï¼Œé€šè¿‡å¯¹&lt;code&gt;spec.updateStrategy.rollingUpdateçš„partitionå­—æ®µ&lt;/code&gt;è¿›è¡Œé…ç½®ï¼Œå¯å®ç°é‡‘ä¸é›€éƒ¨ç½²æˆ–ç°åº¦å‘å¸ƒã€‚æ¯”å¦‚ï¼š&lt;code&gt;{&amp;quot;spec&amp;quot;:{&amp;quot;updateStrategy&amp;quot;:{&amp;quot;type&amp;quot;:&amp;quot;RollingUpdate&amp;quot;,&amp;quot;rollingUpdate&amp;quot;:{&amp;quot;partition&amp;quot;:3}}}}&lt;/code&gt;è¿›è¡Œè®¾ç½®åï¼Œå†ç»§ç»­å¯¹&lt;code&gt;spec.template&lt;/code&gt;é‡Œè¿›è¡Œä¿®æ”¹ï¼ŒStatefulSetä¼šå¯¹åºå·å¤§äºæˆ–ç­‰äºæ­¤åºå·çš„Podè¿›è¡Œæ›´æ–°ï¼Œå°äºæ­¤åºå·çš„ä¿å­˜æ—§ç‰ˆæœ¬ä¸å˜ï¼Œå³ä½¿è¿™äº›Podè¢«åˆ é™¤å’Œé‡å»ºï¼Œä¹Ÿæ˜¯ç”¨çš„æ—§ç‰ˆæœ¬ã€‚&lt;/p&gt;
&lt;p&gt;ä¹Ÿå¯ä»¥è®¾ç½®&lt;code&gt;spec.updateStrategy.type: OnDelete&lt;/code&gt;æ—¶ï¼Œå½“&lt;code&gt;spec.template&lt;/code&gt;å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒPodä¸ä¼šè¿›è¡Œæ›´æ–°ï¼Œéœ€è¦æ‰‹åŠ¨åˆ é™¤ï¼Œè®©StatefulSetæ¥é‡æ–°äº§ç”ŸPodï¼Œæ‰ä¼šä½¿ç”¨æ–°çš„è®¾ç½®ã€‚&lt;/p&gt;
&lt;p&gt;StatefulSetå¯ç”¨äºéƒ¨ç½²æœ‰çŠ¶æ€çš„åº”ç”¨ï¼Œæ¯”å¦‚æœ‰ä¸»ä»èŠ‚ç‚¹MySQLé›†ç¾¤ï¼Œåœ¨è¿™ä¸ªcaseä¸­ï¼Œè™½ç„¶Podä¼šæœ‰ç›¸åŒçš„templateï¼Œä½†æ˜¯ä¸»ä»Podé‡Œçš„sidecaræ‰§è¡Œçš„åŠ¨ä½œä¸ä¸€æ ·ï¼Œè€Œä¸»ä»Podå¯ä»¥æ ¹æ®ç¼–å·æ¥å®ç°ï¼Œä¸åŒç±»å‹çš„Podå­˜å‚¨é€šè¿‡PVC + PVå®ç°ã€‚&lt;/p&gt;
&lt;p&gt;StatefulSetçš„åˆ é™¤æ”¯æŒçº§è”å’Œéçº§è”ä¸¤ç§ï¼Œéçº§è”åˆ é™¤æ—¶ï¼Œåªä¼šåˆ é™¤StatefulSetæ§åˆ¶å™¨ï¼Œä¸ä¼šåˆ é™¤å¯¹åº”çš„Podï¼Œéœ€è¦ä½¿ç”¨å‚æ•°&lt;code&gt;--cascade=orphan&lt;/code&gt;ã€‚å½“StatefulSetè¢«é‡æ–°åˆ›å»ºæ—¶ï¼Œä¼šå†æ‰§è¡Œä¸€éPodçš„åˆ›å»ºï¼ŒåŒæ—¶ä¸‹æ‰ä¹‹å‰éçº§è”åˆ é™¤çš„Podã€‚&lt;strong&gt;éçº§è”åˆ é™¤StatefulSetæ—¶ï¼Œä¸ä¼šåˆ é™¤å…¶å¯¹åº”çš„Podç›¸å…³è”çš„PVå·&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;StatefulSetä¸»è¦ç”±StatefulSetControllerã€StatefulSetControlå’ŒStatefulPodControlä¸‰ä¸ªç»„ä»¶åä½œæ¥å®Œæˆï¼›StatefulSetçš„ç®¡ç†ï¼ŒStatefulSetControllerä¼šåŒæ—¶ä»PodInformerå’ŒReplicaSetInformerä¸­æ¥å—å¢åˆ æŸ¥æ”¹äº‹ä»¶å¹¶å°†äº‹ä»¶æ¨é€åˆ°é˜Ÿåˆ—ä¸­ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;apps/v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;StatefulSet&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;web&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;serviceName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;nginx&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;replicas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;matchLabels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;nginx&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;template&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;nginx&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;containers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;nginx&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;image&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;k8s.gcr.io/nginx-slim:0.8&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;volumeMounts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;www&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;mountPath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/usr/share/nginx/html&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;volumeClaimTemplates&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;www&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;accessModes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;ReadWriteOnce&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;resources&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;requests&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;storage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;1Gi&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h3 id=&#34;daemonset&#34;&gt;DaemonSet&lt;/h3&gt;
&lt;p&gt;ä¸€èˆ¬çš„Podéƒ½éœ€è¦èŠ‚ç‚¹å‡†å¤‡å¥½äº†(å³nodeçš„çŠ¶æ€æ˜¯Ready)æ‰å¯ä»¥è°ƒåº¦ä¸Šå»ï¼Œä½†æ˜¯æœ‰äº›Podéœ€è¦åœ¨èŠ‚ç‚¹è¿˜æ²¡å‡†å¤‡å¥½çš„æ—¶å€™å°±éœ€è¦éƒ¨ç½²ä¸Šå»ï¼Œæ¯”å¦‚ç½‘ç»œç›¸å…³çš„Podï¼Œå› æ­¤éœ€è¦ä½¿ç”¨DaemonSetã€‚&lt;/p&gt;
&lt;p&gt;DaemonSet çš„ä¼šåœ¨Kubernetes é›†ç¾¤é‡Œçš„æ¯ä¸ªèŠ‚ç‚¹éƒ½è¿è¡Œä¸€ä¸ª Daemon Podï¼Œæ¯ä¸ªèŠ‚ç‚¹åªå…è®¸ä¸€ä¸ªï¼Œå½“æœ‰æ–°çš„èŠ‚ç‚¹åŠ å…¥é›†ç¾¤åï¼Œè¯¥Podä¼šåœ¨æ–°èŠ‚ç‚¹ä¸Šè¢«åˆ›å»ºå‡ºæ¥ï¼ŒèŠ‚ç‚¹è¢«åˆ é™¤ï¼Œè¯¥Podä¹Ÿè¢«åˆ é™¤ã€‚&lt;/p&gt;
&lt;p&gt;DaemonSet Controlleré€šè¿‡ æ§åˆ¶å¾ªç¯ï¼Œåœ¨etcdä¸Šè·å–æ‰€æœ‰Nodeåˆ—è¡¨ï¼Œåˆ¤æ–­èŠ‚ç‚¹ä¸Šæ˜¯å¦å·²ç»è¿è¡Œäº†æ ‡ç­¾ä¸ºxxxçš„Podï¼Œæ¥ä¿è¯æ¯ä¸ªèŠ‚ç‚¹ä¸Šåªæœ‰ä¸€ä¸ªã€‚å¯ä»¥é€šè¿‡åœ¨Podä¸Šå£°æ˜nodeSelectorã€nodeAffinityã€tolerationså­—æ®µå‘Šè¯‰æ§åˆ¶å™¨å¦‚ä½•é€‰æ‹©nodeã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨nodeä¸Šæ‰“ä¸Šæ ‡ç­¾ï¼Œå³å¯é€šè¿‡nodeSelectoré€‰æ‹©å¯¹åº”çš„nodeï¼›&lt;/li&gt;
&lt;li&gt;nodeAffinityçš„åŠŸèƒ½æ¯”nodeSelectorå¼ºå¤§ï¼Œæ”¯æŒæ›´åŠ çµæ´»çš„è¡¨è¾¾å¼æ¥é€‰æ‹©èŠ‚ç‚¹ï¼›&lt;/li&gt;
&lt;li&gt;tolerationsæ¥å®¹å¿Podåœ¨è¢«æ‰“ä¸Šæ±¡ç‚¹æ ‡ç­¾çš„èŠ‚ç‚¹ä¹Ÿå¯ä»¥éƒ¨ç½²ï¼Œå› ä¸ºä¸€èˆ¬æœ‰æ±¡ç‚¹çš„èŠ‚ç‚¹æ˜¯ä¸å…è®¸å°†Podéƒ¨ç½²åœ¨ä¸Šé¢çš„ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;DaemonSetæ˜¯ç›´æ¥ç®¡ç†Podçš„&lt;/strong&gt;ï¼ŒDaemonSetæ‰€ç®¡ç†çš„Podçš„è°ƒåº¦è¿‡ç¨‹ï¼Œéƒ½ç”±å®ƒè‡ªå·±å®Œæˆï¼Œè€Œä¸æ˜¯é€šè¿‡Kube-Schedulerå®Œæˆï¼Œ æ˜¯å› ä¸ºDaemonSetåœ¨åˆ›å»ºPodæ—¶ï¼Œä¼šä¸ºå…¶å¢åŠ &lt;code&gt;spce.nodeName&lt;/code&gt;å­—æ®µï¼Œæ­¤æ—¶ä»¥åŠæ˜ç¡®äº†è¯¥Podè¦è¿è¡Œåœ¨å“ªä¸ªèŠ‚ç‚¹ï¼Œå°±ä¸éœ€è¦kube-scheduleræ¥è°ƒåº¦äº†ï¼Œä½†ä¹Ÿå¸¦äº†é—®é¢˜ï¼Œæ— è®ºèŠ‚ç‚¹å¯ä¸å¯ç”¨ï¼ŒDaemonSetéƒ½ä¼šå°†è¯¥Podå¾€ä¸Šé¢è°ƒåº¦ã€‚&lt;/p&gt;
&lt;p&gt;DaemonSetçš„åº”ç”¨ä¸€èˆ¬æ˜¯ç½‘ç»œæ’ä»¶çš„Agentç»„ä»¶ã€å­˜å‚¨æ’ä»¶çš„Agentç»„ä»¶ã€èŠ‚ç‚¹ç›‘æ§ç»„ä»¶ã€èŠ‚ç‚¹æ—¥å¿—æ”¶é›†ç­‰ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;apps/v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;DaemonSet&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;fluentd-elasticsearch&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;kube-system&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;matchLabels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;fluentd-elasticsearch&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;template&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;fluentd-elasticsearch&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;containers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;fluentd-elasticsearch&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;image&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;k8s.gcr.io/fluentd-elasticsearch:1.20&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;volumeMounts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;varlog&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;mountPath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/var/log&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;readOnly&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;volumes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;varlog&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hostPath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/var/log&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h3 id=&#34;job&#34;&gt;Job&lt;/h3&gt;
&lt;p&gt;Jobæ˜¯ä¸€ç§ç‰¹æ®Šçš„Podï¼Œå³é‚£äº›è®¡ç®—å®Œæˆä¹‹åå°±é€€å‡ºçš„Podï¼ŒçŠ¶æ€å˜ä¸ºcomplatedã€‚&lt;/p&gt;
&lt;p&gt;Job ä¼šä½¿ç”¨è¿™ç§æºå¸¦äº† UID çš„ Labelï¼Œä¸ºäº†é¿å…ä¸åŒ Job å¯¹è±¡æ‰€ç®¡ç†çš„ Pod å‘ç”Ÿé‡åˆï¼ŒJobæ˜¯ç›´æ¥æ§åˆ¶Podçš„ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;backoffLimit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;//é»˜è®¤æ˜¯6&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;activeDeadlineSeconds&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;100&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;//å•ä½ï¼šç§’&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;parallelism&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;completions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;backoffLimitè¡¨ç¤ºå¤±è´¥åçš„é‡è¯•æ¬¡æ•°ï¼Œä¸‹ä¸€æ¬¡é‡è¯•çš„åŠ¨ä½œåˆ†åˆ«å‘ç”Ÿåœ¨10sã€20sã€40s&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;activeDeadlineSecondsè¡¨ç¤ºæœ€é•¿è¿è¡Œçš„æ—¶é—´ï¼Œå¦‚æœè¶…è¿‡è¯¥é™å®šæ—¶é—´ï¼Œåˆ™ä¼šç«‹å³ç»“æŸ&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;parallelismè¡¨ç¤ºä¸€ä¸ª Job åœ¨ä»»æ„æ—¶é—´æœ€å¤šå¯ä»¥å¯åŠ¨å¤šå°‘ä¸ª Pod åŒæ—¶è¿è¡Œ&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;completionsè¡¨ç¤º Job è‡³å°‘è¦å®Œæˆçš„ Pod æ•°ç›®ï¼Œå³ Job çš„æœ€å°å®Œæˆæ•°&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Job Controller åœ¨æ§åˆ¶å¾ªç¯ä¸­è¿›è¡Œçš„è°ƒè°ï¼ˆReconcileï¼‰æ“ä½œï¼Œæ˜¯æ ¹æ®å®é™…åœ¨ Running çŠ¶æ€ Pod çš„æ•°ç›®ã€å·²ç»æˆåŠŸé€€å‡ºçš„ Pod çš„æ•°ç›®ï¼Œä»¥åŠ parallelismã€completions å‚æ•°çš„å€¼å…±åŒè®¡ç®—å‡ºåœ¨è¿™ä¸ªå‘¨æœŸé‡Œï¼Œåº”è¯¥åˆ›å»ºæˆ–è€…åˆ é™¤çš„ Pod æ•°ç›®ï¼Œç„¶åè°ƒç”¨ Kubernetes API æ¥æ‰§è¡Œè¿™ä¸ªæ“ä½œï¼Œå½“Jobæ‰§è¡Œå®Œå¤„äºcomplateçŠ¶æ€æ—¶ï¼Œå¹¶ä¸ä¼šé€€å‡ºã€‚&lt;/p&gt;
&lt;h3 id=&#34;cronjob&#34;&gt;CronJob&lt;/h3&gt;
&lt;p&gt;å¦‚æœä»ç„¶ä½¿ç”¨Deploymentç®¡ç†ï¼Œå› ä¸ºå®ƒä¼šå¯¹é€€å‡ºçš„Podè¿›è¡Œæ»šåŠ¨æ›´æ–°ï¼Œæ‰€ä»¥å¹¶ä¸åˆé€‚ï¼Œå› æ­¤éœ€è¦ä½¿ç”¨CronJobï¼Œä½œç”¨ç±»ä¼¼äºJobç±»ä¼¼äºPodï¼ŒCronJobç±»ä¼¼äºDeploymentï¼›&lt;/p&gt;
&lt;p&gt;Cronjobä¼šæ¯éš”10sä»api-serverä¸­å–å‡ºèµ„æºå¹¶è¿›è¡Œæ£€æŸ¥æ˜¯å¦è§¦å‘è°ƒåº¦åˆ›å»ºæ–°çš„èµ„æºï¼Œæ‰€ä»¥&lt;strong&gt;Cronjobå¹¶ä¸èƒ½ä¿è¯åœ¨å‡†ç¡®çš„ç›®æ ‡æ—¶é—´æ‰§è¡Œï¼Œæœ‰ä¸€å®šçš„æ»åæ€§&lt;/strong&gt;ï¼›&lt;/p&gt;
&lt;p&gt;CronJobä½¿ç”¨ &lt;code&gt;spec.schedule&lt;/code&gt; æ¥æ§åˆ¶ï¼Œä½¿ç”¨jobTemplateæ¥å®šä¹‰jobæ¨¡æ¿ï¼Œ&lt;code&gt;spec.concurrencyPolicy&lt;/code&gt;æ¥æ§åˆ¶å¹¶è¡Œç­–ç•¥&lt;/p&gt;
&lt;p&gt;&lt;code&gt;spec.concurrencyPolicy&lt;/code&gt;ï¼š=Allowï¼šä¸€ä¸ªJobæ²¡æ‰§è¡Œå®Œï¼Œæ–°çš„Jobå°±èƒ½äº§ç”Ÿã€=Forbiï¼šæ–°Jobä¸ä¼šè¢«åˆ›å»ºã€Replaceï¼šæ–°çš„Jobä¼šæ›¿æ¢æ—§çš„ï¼Œæ²¡æœ‰æ‰§è¡Œå®Œçš„Jobï¼›&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;batch/v1beta1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;CronJob&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;order-cronjob-auto-close-order&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;regoo&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;order&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;schedule&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;*/5 * * * *&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;successfulJobsHistoryLimit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;failedJobsHistoryLimit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;completions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# å½“å‰ä»»åŠ¡è¦ç­‰å¾…1ä¸ªpodçš„æˆåŠŸæ‰§è¡Œ&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;parallelism&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# æœ€å¤šæœ‰1ä¸ªå¹¶å‘æ‰§è¡Œçš„ä»»åŠ¡ï¼Œæ­¤æ—¶æ‰€æœ‰ä»»åŠ¡ä¼šä¾æ¬¡é¡ºåºè¿›è¡Œï¼Œåªæœ‰å‰ä¸€ä¸ªæˆåŠŸæ‰èƒ½æ‰§è¡Œä¸‹ä¸€ä¸ª&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;concurrencyPolicy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Forbid&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;startingDeadlineSeconds&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;120&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;suspend&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# æ˜¯å¦æš‚åœ&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;jobTemplate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;template&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;annotations&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;sidecar.istio.io/inject&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;false&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;order&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;containers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;image&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;curlimages/curl:7.77.0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;curl&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;imagePullPolicy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;IfNotPresent&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;command&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;curl&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;-X&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;POST&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;http://order:8080/order/schedule/auto_close_order&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;restartPolicy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;OnFailure&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h3 id=&#34;operator-ä¸-æ§åˆ¶å™¨åŸç†&#34;&gt;Operator ä¸ æ§åˆ¶å™¨åŸç†&lt;/h3&gt;
&lt;p&gt;æœ¬è´¨æ˜¯ä¸€ä¸ªæ§åˆ¶å™¨ï¼Œæ§åˆ¶è‡ªå®šä¹‰çš„CRDçš„æµç¨‹æ§åˆ¶ï¼Œæ‰§è¡Œè‡ªå®šä¹‰CRDçš„è¡Œä¸ºã€‚&lt;/p&gt;
&lt;p&gt;CRDï¼ˆ Custom Resource Definitionï¼‰ï¼Œä¸€ç§APIæ’ä»¶æœºåˆ¶ï¼Œå…è®¸ç”¨æˆ·åœ¨k8sä¸­æ·»åŠ ä¸€ä¸ªè·ŸPodã€Nodeç±»å‹çš„ï¼Œæ–°çš„APIèµ„æºï¼Œå³kindä¸ºCustomResourceDefinitionï¼Œç±»ä¼¼äºç±»çš„æ¦‚å¿µï¼Œè¿™æ ·å°±å¯ä»¥é€šè¿‡è¿™ä¸ªç±»ï¼Œæ¥åˆ›å»ºå±äºè¿™ä¸ªç±»çš„å®ä¾‹(ç¼–å†™yamlæ–‡ä»¶)ï¼Œè¿™ä¸ªå®ä¾‹å°±ç§°ä¸ºCRã€‚&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚æœ‰CRDä¸º&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;apiextensions.k8s.io/v1beta1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;CustomResourceDefinition&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networks.samplecrd.k8s.io&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;group&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;samplecrd.k8s.io&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;names&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Network&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;plural&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networks&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;scope&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Namespaced&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;CRä¸º&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;7
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;samplecrd.k8s.io/v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Network&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;example-network&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;cidr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;192.168.0.0/16&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;gateway&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;192.168.0.1&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;å…¶ä¸­çš„èµ„æºç±»å‹ã€ç»„ã€ç‰ˆæœ¬å·è¦ä¸€ä¸€å¯¹åº”&lt;/p&gt;
&lt;p&gt;ä¸Šé¢è¿™äº›æ“ä½œåªæ˜¯å‘Šè¯‰k8sæ€ä¹ˆè®¤è¯†yamlæ–‡ä»¶ï¼Œæ¥ç€å°±éœ€è¦ç¼–å†™ä»£ç ï¼Œè®©k8sèƒ½å¤Ÿé€šè¿‡yamlé…ç½®ç”ŸæˆAPIå¯¹è±¡ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨è¿™äº›é…ç½®çš„å­—æ®µå±æ€§äº†ï¼Œæ¥ç€ï¼Œè¿˜éœ€è¦ç¼–å†™æ“ä½œè¯¥APIå¯¹è±¡çš„æ§åˆ¶å™¨ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å…³äºWebhook&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Operatorä¸­çš„Webhookï¼Œå¤–éƒ¨å¯¹CRDèµ„æºçš„å˜æ›´ï¼Œåœ¨Controllerå¤„ç†ä¹‹å‰éƒ½ä¼šäº¤ç»™Webhookæå‰å¤„ç†ï¼Œå³ï¼šWebhookçš„å¤„ç†æ—©äºControllerçš„Reconcileæ–¹æ³•æ‰§è¡Œã€‚&lt;/p&gt;
&lt;p&gt;Webhookçš„èŒè´£æ˜¯ä¿®æ”¹å’ŒéªŒè¯ï¼Œå¯ä»¥é›†æˆåœ¨Operatorä¸­ã€‚&lt;/p&gt;
&lt;h4 id=&#34;client-go&#34;&gt;Client-Go&lt;/h4&gt;
&lt;p&gt;ç¼–å†™ä¸€ä¸ªOperatoræ—¶ï¼Œéœ€è¦ç”¨åˆ°Client-Goï¼Œå®ç°ä¸API-Serverçš„äº¤äº’ã€‚Client-Goæä¾›äº†4ç§äº¤äº’å¯¹è±¡ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;RESTClientï¼šæœ€åŸºç¡€çš„å®¢æˆ·ç«¯ï¼Œå¯¹HTTPè¯·æ±‚åšå°è£…ï¼Œæ”¯æŒJsonå’ŒProtobufæ ¼å¼ï¼Œæ˜¯å¯¹DiscoveryClientã€ClientSetã€DynamicClientçš„å°è£…ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;DiscoveryClientï¼šå‘ç°å®¢æˆ·ç«¯ï¼Œè´Ÿè´£å‘ç°API-Serveræ”¯æŒçš„æ”¯æ´ç»„ã€ç‰ˆæœ¬å’Œèµ„æºä¿¡æ¯ï¼Œç­‰åŒäº&lt;code&gt;kubectl api-resources&lt;/code&gt;ï¼›ç”±äºGVRæ•°æ®å¾ˆå°‘å˜åŠ¨ï¼Œæ‰€ä»¥å¯ä»¥å°†GVRæ•°æ®ç¼“å­˜åœ¨æœ¬åœ°ï¼Œå‡å°‘Clientä¸API-Serverçš„äº¤äº’ã€‚ä½¿ç”¨CachedDiscoveryClientå’ŒMemCacheClientè¯·æ±‚æ—¶ï¼Œä¼šå…ˆä»ç¼“å­˜é‡Œå–ï¼Œå–ä¸åˆ°æ‰è¯·æ±‚API-Serverã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ä½¿ç”¨kubectlå‘½ä»¤æ—¶ï¼Œä¹Ÿä¼šè¿›è¡Œç¼“å­˜ï¼Œä»¥jsonæ–‡ä»¶çš„å½¢å¼ç¼“å­˜å­˜åœ¨ &lt;code&gt;~/.kube/cache&lt;/code&gt; ä¸­ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ClientSetï¼šè´Ÿè´£æ“ä½œKuberneteså†…ç½®çš„èµ„æºå¯¹è±¡ï¼Œå¦‚Podã€Serviceç­‰ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;DynamicClientï¼šåŠ¨æ€å®¢æˆ·ç«¯ï¼Œå¯ä»¥å¯¹ä»»æ„çš„Kubernetesèµ„æºå¯¹è±¡è¿›è¡Œé€šç”¨æ“ä½œï¼ŒåŒ…æ‹¬CRDï¼›æœ¬è´¨æ˜¯é€šè¿‡ä¸€ä¸ªåµŒå¥—çš„&lt;code&gt;map[string]interface{}&lt;/code&gt;å¯¹è±¡å­˜å‚¨API-Serverçš„è¿”å›å€¼ï¼Œå†ä½¿ç”¨åå°„æœºåˆ¶è¿›è¡Œæ•°æ®ç»‘å®šï¼Œè™½ç„¶çµæ´»ï¼Œä½†æ— æ³•è·å–å¼ºæ•°æ®ç±»å‹çš„æ£€æŸ¥å’ŒéªŒè¯ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æœ¬è´¨ä¸Šéƒ½æ˜¯å‘é€HTTPè¯·æ±‚ç»™API-Serverï¼Œåªæ˜¯RESTClientæ¯”è¾ƒåŸå§‹ï¼Œå…¶ä»–Clientéƒ½å¯¹å…·ä½“èµ„æºåšäº†ç»“æ„ä½“å°è£…ã€‚&lt;/p&gt;
&lt;h4 id=&#34;æ§åˆ¶å™¨çš„åŸç†&#34;&gt;æ§åˆ¶å™¨çš„åŸç†&lt;/h4&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/%e6%8e%a7%e5%88%b6%e5%99%a8%e5%b7%a5%e4%bd%9c%e6%b5%81%e7%a8%8b.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/%e6%8e%a7%e5%88%b6%e5%99%a8%e5%b7%a5%e4%bd%9c%e6%b5%81%e7%a8%8b.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Informer&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;æ§åˆ¶å™¨é€šè¿‡Watchæœºåˆ¶ï¼Œä¸API-Serveräº¤äº’ï¼Œè·å–å®ƒæ‰€å…³å¿ƒçš„å¯¹è±¡ï¼Œä¾é Informeré€šçŸ¥å™¨æ¥å®Œæˆï¼ŒInformerä¸APIå¯¹è±¡ä¸€ä¸€å¯¹åº”ï¼›&lt;/p&gt;
&lt;p&gt;Informeræ˜¯ä¸€ä¸ªè‡ªå¸¦ç¼“å­˜å’Œç´¢å¼•æœºåˆ¶ï¼Œé€šè¿‡å¢é‡é‡Œçš„äº‹ä»¶è§¦å‘ Handler çš„å®¢æˆ·ç«¯åº“ï¼ŒæŸ¥è¯¢æ—¶ï¼Œä¼˜å…ˆä»æœ¬åœ°ç¼“å­˜é‡ŒæŸ¥æ‰¾æ•°æ®ï¼Œè€Œåˆ›å»ºã€æ›´æ–°ã€åˆ é™¤æ“ä½œï¼Œåˆ™æ ¹æ®äº‹ä»¶é€šçŸ¥æœºåˆ¶å†™å…¥é˜Ÿåˆ—DeltaFIFOä¸­ï¼ŒåŒæ—¶ï¼Œå½“å¯¹åº”çš„äº‹ä»¶å¤„ç†åï¼Œæ›´æ–°æœ¬åœ°ç¼“å­˜ï¼Œä½¿å¾—æœ¬åœ°ç¼“å­˜ä¸etcdé‡Œçš„æ•°æ®ä¸€è‡´ï¼›&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªæœ¬åœ°ç¼“å­˜åœ¨ Kubernetes ä¸­ä¸€èˆ¬è¢«ç§°ä¸º LocalStoreï¼Œç´¢å¼•ä¸€èˆ¬è¢«ç§°ä¸º Indexerï¼›ä¸€èˆ¬æ˜¯ä¸€ä¸ªèµ„æºä¸€ä¸ªInformerï¼›&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Reflector&lt;/strong&gt;ï¼šé€šè¿‡ &lt;strong&gt;List-Watch&lt;/strong&gt; æœºåˆ¶ç›‘å¬å¹¶è·å–API-Serverä¸­èµ„æºçš„createã€updateã€deleteäº‹ä»¶ï¼Œå¹¶é’ˆå¯¹äº‹ä»¶ç±»å‹è°ƒç”¨å¯¹åº”çš„å¤„ç†å‡½æ•°ï¼Œæ˜¯k8sç»Ÿä¸€çš„å¼‚æ­¥æ¶ˆæ¯å¤„ç†æœºåˆ¶ï¼Œä¿è¯äº†æ¶ˆæ¯çš„å®æ—¶æ€§ã€å¯é æ€§ï¼Œä¿è¯æœ¬åœ°ç¼“å­˜æ•°æ®çš„å‡†ç¡®æ€§ã€é¡ºåºæ€§å’Œä¸€è‡´æ€§ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Listï¼šè·å–èµ„æºçš„å…¨é‡åˆ—è¡¨æ•°æ®ï¼Œå¹¶åŒæ­¥åˆ°æœ¬åœ°ç¼“å­˜ä¸­ï¼›ListåŸºäºHTTPçŸ­è¿æ¥å®ç°ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Watchï¼šè´Ÿè´£ç›‘å¬å˜åŒ–çš„æ•°æ®ï¼Œå½“Watchçš„èµ„æºå‘ç”Ÿå˜åŒ–æ—¶ï¼Œå¹¶å°†èµ„æºå¯¹è±¡çš„å˜åŒ–äº‹ä»¶å­˜æ”¾åˆ°æœ¬åœ°é˜Ÿåˆ—DeltaFIFOä¸­ï¼Œè§¦å‘å¯¹åº”çš„å˜æ›´äº‹ä»¶è¿›è¡Œå¤„ç†ï¼ŒåŒæ—¶æ›´æ–°æœ¬åœ°ç¼“å­˜ï¼Œä½¿å¾—æœ¬åœ°ç¼“å­˜ä¸etcdé‡Œçš„æ•°æ®ä¸€è‡´ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Watchçš„åŸç†&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;WatchåŸºäºHTTPé•¿é“¾æ¥ï¼Œ1.5ä»¥å‰ä½¿ç”¨HTTP1.1ï¼Œå¹¶é‡‡ç”¨åˆ†å—ä¼ è¾“ç¼–ç &lt;code&gt;å“åº”å¤´åŠ ä¸ŠTransfer-Encoding=chunkedåŸºäºHTTP/1.1ï¼Œå› ä¸ºåœ¨çŸ­è¿æ¥é‡Œï¼Œå®¢æˆ·ç«¯éœ€è¦é€šè¿‡Content-Lengthæˆ–è¿æ¥æ˜¯å¦å…³é—­æ¥åˆ¤æ–­æ˜¯å¦æ¥æ”¶å®Œæˆï¼Œå¯ä»¥å…³æ‰ï¼Œä½¿ç”¨chunkedåï¼ŒæœåŠ¡ç«¯æ— éœ€ä½¿ç”¨æ¥å‘Šè¯‰å®¢æˆ·ç«¯å“åº”ä½“çš„ç»“æŸä½ç½®ï¼Œç»“æŸä½ç½®é€šè¿‡/n, /ræˆ–0æ¥è¡¨ç¤º&lt;/code&gt;ï¼Œå°†æ•°æ®åˆ†è§£æˆä¸€ç³»åˆ—æ•°æ®å—ï¼Œä¸€ä¸ªæˆ–å¤šä¸ªåœ°å‘é€ã€‚&lt;/p&gt;
&lt;p&gt;1.5ä»¥åä½¿ç”¨HTTP/2ï¼Œå¼•å…¥FrameäºŒè¿›åˆ¶å¸§ä¸ºå•ä½è¿›è¡Œä¼ è¾“ï¼Œetcd v3çš„gRPC streamåè®®ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å®šæ—¶åŒæ­¥ï¼šå®šæ—¶å™¨è§¦å‘åŒæ­¥æœºåˆ¶ï¼Œå®šæ—¶æ›´æ–°ç¼“å­˜æ•°æ®ï¼Œå®šæ—¶åŒæ­¥çš„å‘¨æœŸæ—¶é—´å¯é…ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ•°æ®æ›´æ–°çš„ä¾æ®æ¥æºäº ResourceVersionï¼Œå½“èµ„æºå‘ç”Ÿå˜åŒ–æ—¶ï¼ŒResourceVersionå°±ä¼šä»¥é€’å¢çš„å½¢å¼æ›´æ–°ï¼Œä¿è¯äº‹ä»¶çš„é¡ºåºæ€§ï¼Œé€šè¿‡æ¯”è¾ƒè¿™ä¸ªå€¼ï¼Œæ¥åˆ¤æ–­èµ„æºæ˜¯å¦æœ‰å˜åŒ–ã€‚&lt;/p&gt;
&lt;p&gt;List-Watchå¿…é¡»ä¸€èµ·é…åˆæ‰èƒ½ä¿è¯æ¶ˆæ¯çš„å¯é æ€§ï¼Œå¦‚æœä»…ä¾é Watchï¼Œå½“è¿æ¥æ–­å¼€åï¼Œæ¶ˆæ¯å°±æœ‰å¯èƒ½ä¸¢å¤±ï¼Œæ­¤æ—¶é€šè¿‡Listæ¥è·å–æ‰€æœ‰æ•°æ®ï¼Œè¿˜æœ‰åˆ¤æ–­ResourceVersionçš„å€¼ï¼Œçº æ­£æ•°æ®ä¸ä¸€è‡´ï¼Œä¿è¯äº‹ä»¶ä¸ä¸¢å¤±ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;DeltaFIFO&lt;/strong&gt;ï¼šå¢é‡é˜Ÿåˆ—ï¼Œè®°å½•èµ„æºå˜åŒ–ï¼ŒRelectorç›¸å½“äºé˜Ÿåˆ—çš„ç”Ÿäº§è€…ï¼›&lt;/p&gt;
&lt;p&gt;Deltaæ˜¯èµ„æºå¯¹è±¡å­˜å‚¨ï¼Œä¿å­˜å­˜å‚¨å¯¹è±¡çš„æ¶ˆè´¹ç±»å‹ï¼Œä½œä¸ºé˜Ÿåˆ—é‡Œçš„æ¶ˆæ¯ä½“ï¼Œæœ‰ä¸¤ä¸ªå±æ€§ï¼ŒTypeè¡¨ç¤ºäº‹ä»¶ç±»å‹ï¼Œæ¯”å¦‚&lt;code&gt;Addedã€Updatedã€Deletedã€Replacedã€Sync&lt;/code&gt;ï¼ŒObjectè¡¨ç¤ºèµ„æºå¯¹è±¡ï¼Œå¦‚Podã€Serviceï¼›&lt;/p&gt;
&lt;p&gt;FIFOé˜Ÿåˆ—è´Ÿè´£æ¥æ”¶Reflectorä¼ é€’è¿‡æ¥çš„äº‹ä»¶ï¼Œå¹¶å°†å…¶æŒ‰é¡ºåºå­˜å‚¨ï¼Œç„¶åç­‰å¾…äº‹ä»¶çš„å¤„ç†å‡½æ•°è¿›è¡Œå¤„ç†ï¼Œå¦‚æœå‡ºç°å¤šä¸ªç›¸åŒäº‹ä»¶ï¼Œåˆ™åªä¼šè¢«å¤„ç†ä¸€æ¬¡ï¼›&lt;/p&gt;
&lt;p&gt;DeltaFIFOåªä¼šå­˜å‚¨Watchè¿”å›çš„å„ç§äº‹ä»¶ï¼Œè€ŒLocalStoraeåªä¼šè¢«Listerçš„List/gGetæ–¹æ³•è®¿é—®ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Indexer&lt;/strong&gt;ï¼šç”¨æ¥å­˜å‚¨èµ„æºå¯¹è±¡ï¼Œå¹¶è‡ªå¸¦ç´¢å¼•åŠŸèƒ½çš„æœ¬åœ°å­˜å‚¨LocalStoreï¼Œå¯ä»¥ç†è§£ä¸ºé‡Œé¢æœ‰å¾ˆå¤šmapç»„æˆçš„å€’æ’ç´¢å¼•å’Œå¯¹åº”çš„ç´¢å¼•å¤„ç†å™¨ï¼›&lt;/p&gt;
&lt;p&gt;IndexFuncï¼šç´¢å¼•å™¨å‡½æ•°ï¼Œç”¨äºè®¡ç®—èµ„æºå¯¹è±¡çš„ç´¢å¼•åˆ—è¡¨ï¼›&lt;/p&gt;
&lt;p&gt;Indexï¼šå­˜å‚¨æ•°æ®ï¼Œæ¯”å¦‚ï¼šè¦æŸ¥æ‰¾æŸä¸ªå‘½åç©ºé—´ä¸‹çš„Podï¼Œå¯¹åº”çš„Indexç±»å‹å¯ä»¥æ˜¯&lt;code&gt;map[{namespace}]{sets.pod}&lt;/code&gt;ï¼›&lt;/p&gt;
&lt;p&gt;Indexersï¼šå­˜å‚¨ç´¢å¼•å™¨ï¼Œkeyä¸ºç´¢å¼•å™¨åç§°ï¼Œvalueä¸º IndexFuncï¼Œ æ¯”å¦‚&lt;code&gt;map[&amp;quot;namespace&amp;quot;]{IndexFunc}&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Indicesï¼šå­˜å‚¨ç¼“å­˜å™¨ï¼Œkeyä¸ºç´¢å¼•å™¨åç§°ï¼Œvalueä¸ºç¼“å­˜çš„æ•°æ®ï¼Œæ¯”å¦‚ï¼š&lt;code&gt;map[&amp;quot;namespace&amp;quot;]map[{namespace}]{sets.pod}&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;SharedInformer&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;åœ¨K8sä¸­ï¼Œæ¯ä¸€ä¸ªèµ„æºéƒ½æœ‰ä¸€ä¸ªInformerï¼ŒInformerä½¿ç”¨Reflectoræ¥ç›‘å¬èµ„æºï¼Œå¦‚æœç»Ÿä¸€èµ„æºçš„Informerå®ä¾‹åŒ–å¤ªå¤šæ¬¡ï¼Œå°±ä¼šæœ‰å¾ˆå¤šé‡å¤çš„æ­¥éª¤ã€‚ä¸ºäº†è§£å†³å¤šä¸ªæ§åˆ¶å™¨æ“ä½œåŒä¸€èµ„æºçš„é—®é¢˜ï¼Œå¯¼è‡´å¯¹åŒä¸€èµ„æºçš„é‡å¤æ“ä½œï¼Œæ¯”å¦‚é‡å¤ç¼“å­˜ã€‚ä½¿ç”¨SharedInformeråï¼Œä¸ç®¡æœ‰å¤šå°‘ä¸ªæ§åˆ¶å™¨åŒæ—¶è¯»å–äº‹ä»¶ï¼Œéƒ½åªä¼šè°ƒç”¨ä¸€ä¸ªWatch APIæ¥Watchä¸Šæ¸¸çš„API-Serverï¼Œé™ä½Api-Serverçš„è´Ÿè½½ï¼Œæ¯”å¦‚ Controller-Managerã€‚&lt;/p&gt;
&lt;p&gt;Informeræ˜¯ä¸€ç§æœºåˆ¶ï¼ŒSharedInformeræ˜¯å…¶ä¸­ä¸€ç§å®ç°ã€‚&lt;/p&gt;
&lt;p&gt;é€šå¸¸è‡ªå®šä¹‰Controllerè¦æ±‚åªæœ‰ä¸€ä¸ªå®ä¾‹åœ¨è¿è¡Œï¼Œå› ä¸ºå½“å‡ºç°å¤šä¸ªå®ä¾‹çš„æ—¶å€™ï¼Œä¼šå‡ºç°å¹¶å‘é—®é¢˜ï¼Œé‡å¤æ¶ˆè´¹äº‹ä»¶ï¼Œå¦‚æœè¦å®ç°é«˜å¯ç”¨ï¼Œéœ€è¦ä¸»ä»éƒ¨ç½²ï¼Œåªæœ‰ä¸»æœåŠ¡å¤„äºå·¥ä½œçŠ¶æ€ï¼Œä»æœåŠ¡å¤„äºæš‚åœçŠ¶æ€ï¼Œå½“ä¸»æœåŠ¡å‡ºç°é—®é¢˜æ—¶ï¼Œå®ç°ä¸»ä»åˆ‡æ¢ã€‚Client-Goæœ¬èº«æä¾›äº†leaderelectionæœºåˆ¶æ¥å®ç°ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;WorkQueue&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;WorkQueueæ”¯æŒä¸‰ç§é˜Ÿåˆ—ï¼šFIFOé˜Ÿåˆ—ã€å»¶æ—¶é˜Ÿåˆ—ã€é™é€Ÿé˜Ÿåˆ—ï¼Œä¾›ä¸åŒåœºæ™¯ä¸‹ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;ä»event handlerè§¦å‘çš„äº‹ä»¶ä¼šå…ˆæ”¾å…¥WorkQueueä¸­ï¼ŒWorkQueueæ˜¯ä¸€ä¸ªå»é‡é˜Ÿåˆ—ï¼Œå†…éƒ¨é™¤äº† Queueé˜Ÿåˆ— å¤–è¿˜å¸¦æœ‰ Processing Set å’Œ Dirty Setè®°å½•ï¼Œç”¨æ¥å®ç°åŒä¸€ä¸ªèµ„æºå¯¹è±¡çš„å¤šæ¬¡äº‹ä»¶è§¦å‘ï¼Œå…¥é˜Ÿåˆ—åä¼šå»é‡ï¼Œä¸ä¼šè¢«å¤šä¸ªworkeråŒæ—¶å¤„ç†ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Queueé˜Ÿåˆ—ï¼šå®é™…å­˜å‚¨å…ƒç´ çš„åœ°æ–¹ï¼Œä¿è¯å…ƒç´ æœ‰åºï¼Œæœ¬è´¨æ˜¯ä¸€ä¸ªsliceï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Dirty Setï¼šä¿è¯å»é‡ï¼Œè¿˜èƒ½ä¿è¯å¤„ç†ä¸€ä¸ªå…ƒç´ ä¹‹å‰å“ªæ€•è¢«æ·»åŠ å¤šæ¬¡ï¼ˆå¹¶å‘ï¼‰ï¼Œä¹Ÿåªä¼šè¢«å¤„ç†ä¸€æ¬¡ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Processing Setï¼šæ ‡è®°æœºåˆ¶ï¼Œæ ‡è®°ä¸€ä¸ªå…ƒç´ æ˜¯å¦è¢«å¤„ç†ï¼Œä¿è¯åªæœ‰ä¸€ä¸ªå…ƒç´ åœ¨Queueé˜Ÿåˆ—é‡Œè¢«å¤„ç†ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;å¹¶å‘å¤„ç†æµç¨‹ï¼š&lt;/p&gt;
&lt;p&gt;Addæ–¹æ³•ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å…ƒç´ è¢«Addæ—¶ï¼Œé¦–å…ˆä¼šæ£€æŸ¥å…¶æ˜¯å¦å­˜åœ¨äºDirty Setä¸­ï¼Œå¦‚æœå­˜åœ¨åˆ™ç›´æ¥ä¸¢å¼ƒï¼Œä¸å­˜åœ¨æ‰åŠ å…¥ï¼Œä¿è¯Dirty Setä¸­ä¸ä¼šæœ‰å¤šä¸ªæŒ‡å‘åŒä¸€resourceçš„ç›¸åŒå…ƒç´ å­˜åœ¨ï¼›&lt;/li&gt;
&lt;li&gt;å…ƒç´ è¢«æ·»åŠ è¿›Dirty Setåï¼Œå†åˆ¤æ–­Processing Setæ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨åˆ™è·³å‡ºï¼Œé˜²æ­¢åŒä¸€å…ƒç´ è¢«å¹¶å‘å¤„ç†ï¼Œä¸å­˜åœ¨åˆ™åŠ å…¥Queueé˜Ÿåˆ—ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Getæ–¹æ³•ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å…ƒç´ è¢«Getæ—¶ï¼ŒReconcile Loopä»Queueé˜Ÿåˆ—é˜Ÿé¦–ä¸­å–å‡ºå…ƒç´ ï¼Œå¹¶æ”¾å…¥Processing Setä¸­ï¼Œé˜²æ­¢å¹¶å‘å¤„ç†åŒä¸€å…ƒç´ ï¼›&lt;/li&gt;
&lt;li&gt;æœ€åä»Dirty Setä¸­åˆ é™¤è¯¥å…ƒç´ ï¼Œå› ä¸º Dirty Set æ˜¯ä¸ºäº†å®ç°çš„å¾…æ¶ˆè´¹å»é‡, æ—¢ç„¶ä» Queueé˜Ÿåˆ— æ‹¿èµ°å…ƒç´ , Dirty Set ä¹Ÿéœ€è¦åˆ é™¤ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Doneæ–¹æ³•ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;Reconcile Loopå¤„ç†ç»“æŸåï¼Œä»Processing Setä¸­åˆ é™¤å…ƒç´ ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¦‚æœ Dirty Set ä¸­å­˜åœ¨ç›¸åŒresourceçš„å…ƒç´ ï¼Œå°±ä¼šè¢«æ”¾å…¥Queueé˜Ÿåˆ—ï¼Œæ­¤æ—¶Dirty Setå’ŒQueueæŒæœ‰åŒä¸€ä»½å…ƒç´ ï¼›&lt;/p&gt;
&lt;p&gt;è¿™é‡Œçš„æ„æ€æ˜¯ï¼Œå¦‚æœä¸€ä¸ªå…ƒç´ æ­£åœ¨è¢«å¤„ç†ï¼Œåˆå†æ¬¡åŠ å…¥äº†ç›¸åŒçš„å…ƒç´ ï¼Œç”±äºè¯¥å…ƒç´ è¿˜æ²¡å¤„ç†å®Œï¼Œåªèƒ½æŠŠè¯¥å…ƒç´ å…ˆæ”¾å…¥Dirty Setä¸­ï¼Œå› ä¸ºQueueé˜Ÿåˆ—ä¼šè¢«å¤šä¸ªåç¨‹æ¶ˆè´¹ï¼Œåªæ”¾åœ¨Dirty Setä¸­ä¿è¯åŒä¸€å…ƒç´ ä¸ä¼šè¢«å¹¶å‘æ¶ˆè´¹ï¼Œå½“å…ƒç´ å¤„ç†å®Œæ—¶ï¼Œå†é‡æ–°è¿›å…¥Queueé˜Ÿåˆ—ï¼Œå› ä¸ºæ­¤æ—¶è¯¥å…ƒç´ å·²ç»è¢«å¤„ç†è¿‡ï¼Œæ˜¯æœ€æ–°çš„äº†ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;è¿™æ ·å°±è§£å†³äº†å»é‡çš„é—®é¢˜ï¼Œè¿˜è§£å†³äº†åŒä¸€ä¸ªå¯¹è±¡å¹¶å‘å¤„ç†çš„é¡ºåºé—®é¢˜ï¼Œåªä¸è¿‡å¯èƒ½å’ŒåŸæ¥è¯·æ±‚çš„é¡ºåºä¸å¤ªä¸€è‡´ï¼Œç›¸åŒèµ„æºçš„è¯·æ±‚è¢«delayäº†ï¼Œä½†æ˜¯ä¸å½±å“æœ€ç»ˆç»“æœï¼Œä¹Ÿå®ç°äº†æ— é”çš„æ“ä½œã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;æ•´ä½“æµç¨‹&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Reflectoré€šè¿‡Listç½—åˆ—èµ„æºï¼Œé€šè¿‡Watchç›‘å¬èµ„æºçš„å˜æ›´äº‹ä»¶ï¼Œå°†ç»“æœæ”¾åˆ°DeltaFIFOé˜Ÿåˆ—ä¸­ï¼›&lt;/li&gt;
&lt;li&gt;ç„¶åä» DeltaFIFOä¸­ å°†æ¶ˆè´¹å‡ºæ¥çš„èµ„æºå¯¹è±¡å­˜å‚¨åˆ°Indexerä¸­ï¼ŒIndexeræŠŠå¢é‡é‡Œçš„APIå¯¹è±¡ä¿å­˜åˆ°æœ¬åœ°ç¼“å­˜ï¼Œå¹¶åˆ›å»ºç´¢å¼•ï¼›&lt;/li&gt;
&lt;li&gt;Indexerä¸etcdä¸­çš„æ•°æ®å®Œå…¨ä¿æŒä¸€è‡´ï¼Œhandlerå¤„ç†æ—¶ï¼Œå…ˆä»æœ¬åœ°ç¼“å­˜é‡Œæ‹¿ï¼Œæ‹¿ä¸åˆ°å†è¯·æ±‚API-Serverï¼Œå‡å°‘Client-Goä¸API-Serveräº¤äº’çš„å‹åŠ›ã€‚&lt;/li&gt;
&lt;li&gt;Informer ä¸æˆ‘ä»¬è¦ç¼–å†™çš„æ§åˆ¶å¾ªç¯ControlLoopä¹‹é—´ï¼Œåˆ™ä½¿ç”¨äº†ä¸€ä¸ªå·¥ä½œé˜Ÿåˆ—WorkQæ¥è¿›è¡ŒååŒï¼Œå®é™…åº”ç”¨ä¸­ï¼Œinformersã€listersã€clientsetéƒ½æ˜¯é€šè¿‡CRDä»£ç ç”Ÿæˆï¼Œå¼€å‘è€…åªéœ€è¦å…³æ³¨æ§åˆ¶å¾ªç¯çš„å…·ä½“å®ç°å°±è¡Œã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;leaderelectionæœºåˆ¶&#34;&gt;leaderelectionæœºåˆ¶&lt;/h4&gt;
&lt;p&gt;ä¸€äº›ç‰¹å®šçš„ç»„ä»¶éœ€è¦ç¡®ä¿åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªå®ä¾‹åœ¨å·¥ä½œï¼Œå°±éœ€è¦é€šè¿‡leaderelectionæœºåˆ¶æ¥å®ç°ã€‚&lt;/p&gt;
&lt;p&gt;åŸç†æ˜¯é€šè¿‡K8sçš„ &lt;code&gt;endpointsã€configmapæˆ–lease&lt;/code&gt;å®ç°ä¸€ä¸ªåˆ†å¸ƒå¼é”ï¼ˆé€šè¿‡resourceVersion + ä¹è§‚é”å®ç°ï¼Œåˆ¤æ–­èµ„æºçš„idå’Œè‡ªå·±æ‰€æŒæœ‰çš„idæ˜¯å¦ä¸€è‡´ï¼‰ï¼Œåªæœ‰æŠ¢åˆ°é”çš„æœåŠ¡æ‰èƒ½æˆä¸ºleaderï¼Œå¹¶å®šæœŸæ›´æ–°ï¼ˆæ¯”å¦‚2sä¸€æ¬¡ï¼‰ï¼Œè€ŒæŠ¢ä¸åˆ°çš„èŠ‚ç‚¹ä¼šå‘¨æœŸæ€§çš„æ£€æŸ¥æ˜¯å¦èƒ½æ›´æ–°ä»¥æˆä¸ºæ–°Leaderã€‚&lt;/p&gt;
&lt;p&gt;æŠ¢é”updateæ—¶ï¼Œé‡‡ç”¨ä¹è§‚é”æœºåˆ¶ï¼Œé€šè¿‡resourceVersionå­—æ®µåˆ¤æ–­å¯¹è±¡æ˜¯å¦å·²è¢«ä¿®æ”¹ã€‚&lt;/p&gt;
&lt;p&gt;å½“ leader å› ä¸ºæŸäº›å¼‚å¸¸åŸå› æŒ‚æ‰åï¼Œç§Ÿçº¦åˆ°æœŸï¼Œå…¶ä»–èŠ‚ç‚¹ä¼šå°è¯•æŠ¢é”ï¼Œæˆä¸ºæ–°çš„ leaderï¼Œæˆä¸ºleaderæ—¶ï¼Œå¯¹åº”podçš„annotationsä¼šæ›´æ–°&lt;code&gt;control-plane.alpha.kubernetes.io/leader&lt;/code&gt;å­—æ®µï¼Œå€¼ä¸ºè¯¥Podçš„ä¸€äº›ä¿¡æ¯ï¼Œå¦‚ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;9
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;err&#34;&gt;//&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;Leaderçš„Id&lt;/span&gt;
    &lt;span class=&#34;nt&#34;&gt;&amp;#34;holderIdentity&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;instance-o24xykos-3_9d68-33ec5eadb906&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
 	&lt;span class=&#34;err&#34;&gt;//&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;Followerè·å¾—leadershipéœ€è¦çš„ç­‰å¾…LeaseDurationæ—¶é—´ï¼ŒLeaderä»¥leaseDurationä¸ºå‘¨æœŸä¸æ–­çš„æ›´æ–°renewTimeçš„å€¼&lt;/span&gt;
    &lt;span class=&#34;nt&#34;&gt;&amp;#34;leaseDurationSeconds&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;15&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;nt&#34;&gt;&amp;#34;acquireTime&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;2020-04-23T06:45:07Z&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; 
    &lt;span class=&#34;nt&#34;&gt;&amp;#34;renewTime&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;2020-04-25T07:55:58Z&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; 
    &lt;span class=&#34;nt&#34;&gt;&amp;#34;leaderTransitions&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;æ‰€è°“çš„é€‰ä¸»ï¼Œå°±çœ‹å“ªä¸ªFollowerèƒ½å°†è‡ªå·±çš„ä¿¡æ¯æ›´æ–°åˆ°&lt;code&gt;endpointsã€configmapæˆ–lease&lt;/code&gt;çš„&lt;code&gt;control-plane.alpha.kubernetes.io/leader&lt;/code&gt;ä¸Šã€‚&lt;/p&gt;
&lt;h2 id=&#34;service&#34;&gt;Service&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å·¥ä½œåœ¨ç¬¬å››å±‚ï¼Œä¼ è¾“å±‚ï¼Œä¸€èˆ¬è½¬å‘TCPã€UDPæµé‡ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ¯æ¬¡Podçš„é‡å¯éƒ½ä¼šå¯¼è‡´IPå‘ç”Ÿå˜åŒ–ï¼Œå¯¼è‡´IPæ˜¯ä¸å›ºå®šçš„ï¼ŒServiceå¯ä»¥ä¸ºä¸€ç»„ç›¸åŒçš„Podå¥—ä¸Šä¸€ä¸ªå›ºå®šçš„IPåœ°å€å’Œç«¯å£ï¼ˆè¿™ä¸ªIPå°±æ˜¯clusterIPï¼‰ï¼Œè®©æˆ‘ä»¬èƒ½å¤Ÿä»¥&lt;strong&gt;TCP/IP&lt;/strong&gt;è´Ÿè½½å‡è¡¡çš„æ–¹å¼è¿›è¡Œè®¿é—®ã€‚&lt;/p&gt;
&lt;p&gt;è™½ç„¶Serviceæ¯æ¬¡é‡å¯IPä¹Ÿä¼šå‘ç”Ÿå˜åŒ–ï¼Œä½†æ˜¯ç›¸æ¯”Podä¼šæ›´åŠ ç¨³å®šã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åˆ›å»ºä¸€ä¸ªæ–°çš„Serviceå¯¹è±¡éœ€è¦ä¸¤å¤§æ¨¡å—åŒæ—¶åä½œï¼Œä¸€ä¸ªæ˜¯æ§åˆ¶å™¨ï¼Œå®ƒéœ€è¦åœ¨æ¯æ¬¡å®¢æˆ·ç«¯åˆ›å»ºæ–°çš„Serviceå¯¹è±¡æ—¶ï¼Œç”Ÿæˆå…¶ä»–ç”¨äºæš´éœ²ä¸€ç»„Podçš„å¯¹è±¡ï¼Œå³Endpointï¼›å¦ä¸€ä¸ªæ˜¯kube-proxyï¼Œå®ƒè¿è¡Œåœ¨é›†ç¾¤çš„æ¯ä¸ªèŠ‚ç‚¹ä¸Šï¼Œæ ¹æ®Serviceå’ŒEndpointçš„å˜åŠ¨æ”¹å˜èŠ‚ç‚¹ä¸Šiptablesæˆ–è€…ipvsä¸­ä¿å­˜çš„è§„åˆ™ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¸€èˆ¬æ˜¯PodæŒ‡å®šä¸€ä¸ªè®¿é—®ç«¯å£å’Œlabelï¼ŒServiceçš„selectoræŒ‡æ˜ç»‘å®šçš„Podï¼Œé…ç½®ç«¯å£æ˜ å°„ï¼ŒServiceå¹¶ä¸ç›´æ¥è¿æ¥Podï¼Œè€Œæ˜¯åœ¨selectoré€‰ä¸­çš„Podä¸Šäº§ç”Ÿä¸€ä¸ªEndpointsèµ„æºå¯¹è±¡ï¼Œé€šè¿‡Serviceçš„clusterIPå°±èƒ½è®¿é—®å®ƒä»£ç†çš„Podäº†ã€‚&lt;/p&gt;
&lt;p&gt;Serviceå¯¹åº”çš„å›ºå®šIPå°±æ˜¯clusterIPï¼ŒclusterIP + Endpointçš„è®°å½•ä¼šè¢«kube-proxyè½¬æˆå®¿ä¸»æœºä¸Šçš„iptablesè§„åˆ™ï¼Œå¦‚æœæ˜¯Headless Serviceï¼Œkube-proxyåˆ™ä¸ä¼šå¤„ç†å®ƒï¼Œä¹Ÿä¸ä¼šç”Ÿæˆiptablesè§„åˆ™ï¼›&lt;/p&gt;
&lt;p&gt;åªæœ‰åœ¨Serviceä¸­è®¾ç½®äº†selectorï¼Œæ‰ä¼šåˆ›å»ºEndpointè®°å½•ï¼ŒEndpointä¸ServiceåŒåï¼Œè·ŸServiceä¸€æ ·çš„ç”Ÿå‘½å‘¨æœŸï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;serviceè´Ÿè½½åˆ†å‘ç­–ç•¥æœ‰ä¸¤ç§æ¨¡å¼ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;RoundRobinï¼šè½®è¯¢æ¨¡å¼ï¼Œå³è½®è¯¢å°†è¯·æ±‚è½¬å‘åˆ°åç«¯çš„å„ä¸ªpodä¸Šï¼ˆé»˜è®¤æ¨¡å¼ï¼‰&lt;/li&gt;
&lt;li&gt;SessionAffinityï¼šåŸºäºå®¢æˆ·ç«¯IPåœ°å€è¿›è¡Œä¼šè¯ä¿æŒçš„æ¨¡å¼ï¼Œç¬¬ä¸€æ¬¡å®¢æˆ·ç«¯è®¿é—®åç«¯æŸä¸ªpodï¼Œä¹‹åçš„è¯·æ±‚éƒ½è½¬å‘åˆ°è¿™ä¸ªpodä¸Š&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å…³äºgRPCçš„è´Ÿè½½å‡è¡¡ï¼š&lt;/p&gt;
&lt;p&gt;å¯¹äºHTTP/1.1 + KeepAliveçš„é•¿è¿æ¥ï¼Œè¿˜æ˜¯å¯ä»¥å®ç°è´Ÿè½½å‡è¡¡çš„ï¼Œå› ä¸ºHTTP/1.1æ˜¯ä¸²è¡Œçš„ï¼Œå½“è¯·æ±‚åˆ°è¾¾æ—¶ï¼Œå¦‚æœæ²¡æœ‰ç©ºé—²è¿æ¥ï¼Œé‚£å°±æ–°å»ºä¸€ä¸ªè¿æ¥ï¼Œå¦‚æœæœ‰ç©ºé—²å°±å¤ç”¨ï¼ŒåŒä¸€ä¸ªæ—¶é—´ç‚¹ï¼Œä¸€ä¸ªè¿æ¥æœ€å¤šåªèƒ½æ‰¿è½½ä¸€ä¸ªè¯·æ±‚ï¼Œæ‰€ä»¥HTTP/1.1å¯ä»¥è¿æ¥å¤šä¸ªPodï¼›&lt;/p&gt;
&lt;p&gt;ç”±äºgRPCæ˜¯åŸºäºHTTP/2å®ç°çš„ï¼Œè¯·æ±‚å‘èµ·åæ˜¯é•¿è¿æ¥ï¼Œå¤šä¸ªè¯·æ±‚å‘èµ·åè¿›è¡Œå¤šè·¯å¤ç”¨ï¼Œç»“æœå°±åªè¿æ¥äº†ä¸€ä¸ªPodï¼Œæ— æ³•å®ç°è´Ÿè½½å‡è¡¡ï¼Œè§£å†³æ–¹æ³•æœ‰ä¸¤ç§ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æœåŠ¡ç«¯è´Ÿè½½å‡è¡¡ï¼šæ¥å…¥istio-proxyï¼ŒæœåŠ¡ä¸side carç»§ç»­ä¿æŒé•¿è¿æ¥ï¼Œç”±side carå‘è¯·æ±‚çš„æœåŠ¡å®ç°è´Ÿè½½å‡è¡¡ï¼›&lt;/li&gt;
&lt;li&gt;å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ï¼šNameResolver + Headless-Serviceæ–¹æ¡ˆï¼šHeadless-Serviceä¸ºæœåŠ¡ç«¯æ¯ä¸ªPodå®ä¾‹çš„IPä»¥Aè®°å½•å½¢å¼å­˜å‚¨ï¼Œå®¢æˆ·ç«¯é€šè¿‡NameResolverè§£æå‡ºæœåŠ¡ç«¯å¯¹åº”çš„IPåœ°å€åˆ—è¡¨ï¼Œä¸å„ä¸ªIPå»ºç«‹é•¿è¿æ¥ï¼Œå®ç°è´Ÿè½½å‡è¡¡ï¼Œä½†è¿™ç§æ–¹æ¡ˆå­˜åœ¨é—®é¢˜æ˜¯å½“Podæ‰©å®¹ä¹‹åï¼Œå®¢æˆ·ç«¯ä¸èƒ½æ„ŸçŸ¥ï¼ˆç¼©å®¹æ˜¯å¯ä»¥çš„ï¼Œå› ä¸ºgRPCå¯ä»¥æ„ŸçŸ¥è¿æ¥æ–­å¼€ï¼‰ï¼Œè§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨kuberesolverï¼Œé€šè¿‡å®ƒæ¥æ£€æŸ¥Serviceå¯¹åº”çš„Endpointså˜åŒ–ï¼ŒåŠ¨æ€æ›´æ–°è¿æ¥ä¿¡æ¯ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;order&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;regoo&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;order&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;TCP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8080&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;targetPort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8080&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;order&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;NodePort&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;sessionAffinity&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;None&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;externalTrafficPolicy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Cluster&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h3 id=&#34;kube-proxy&#34;&gt;kube-proxy&lt;/h3&gt;
&lt;p&gt;Kubernetesé›†ç¾¤ä¸­æ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½è¿è¡Œç€ä¸€ä¸ªkube-proxyï¼Œè¿™ä¸ªè¿›ç¨‹è´Ÿè´£ç›‘å¬&lt;strong&gt;Serviceçš„å¢åŠ å’Œåˆ é™¤äº‹ä»¶å¹¶ä¿®æ”¹è¿è¡Œä»£ç†çš„é…ç½®ï¼Œæ¯”å¦‚èŠ‚ç‚¹çš„iptablesæˆ–ipvsï¼Œä¸ºèŠ‚ç‚¹å†…çš„å®¢æˆ·ç«¯æä¾›æµé‡è½¬å‘å’Œè´Ÿè½½å‡è¡¡ç­‰åŠŸèƒ½&lt;/strong&gt;ï¼Œkube-proxyæœ‰ä¸‰ç§æ¨¡å¼ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;userspaceï¼šè¿è¡Œåœ¨ç”¨æˆ·ç©ºé—´çš„ä»£ç†ï¼Œå¯¹äºæ¯ä¸€ä¸ªServiceéƒ½ä¼šåœ¨å½“å‰çš„èŠ‚ç‚¹ä¸Šå¼€å¯ä¸€ä¸ªç«¯å£ï¼Œæ‰€æœ‰è¿æ¥åˆ°å½“å‰ä»£ç†ç«¯å£çš„è¯·æ±‚éƒ½ä¼šè¢«è½¬å‘åˆ°serviceèƒŒåçš„ä¸€ç»„podä¸Šï¼Œæœ¬è´¨ä¸Šæ˜¯åœ¨èŠ‚ç‚¹çš„iptableä¸Šæ·»åŠ ä¸€æ¡è§„åˆ™ï¼Œé€šè¿‡iptableså°†æµé‡è½¬å‘ç»™kube-proxyå¤„ç†ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœé€‰æ‹©userspaceæ¨¡å¼ï¼Œæ¯å½“æœ‰æ–°çš„serviceè¢«åˆ›å»ºæ—¶ï¼Œkube-proxyå°±ä¼šå¢åŠ ä¸€æ¡iptablesè®°å½•å¹¶å¯åŠ¨ä¸€ä¸ªgoroutineï¼Œå‰è€…ç”¨äºå°†èŠ‚ç‚¹ä¸­æœåŠ¡å¯¹å¤–å‘å‡ºçš„æµé‡è½¬å‘ç»™kube-proxyï¼Œå†ç”±åè€…ä¸€ç³»åˆ—goroutineå°†æµé‡è½¬å‘åˆ°ç›®æ ‡çš„podä¸Šã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;iptablesï¼šï¼ˆé»˜è®¤ï¼‰ç›´æ¥ä½¿ç”¨iptablesè½¬å‘å½“å‰èŠ‚ç‚¹ä¸Šçš„å…¨éƒ¨æµé‡ï¼Œæ¯”userspaceæ¨¡å¼æœ‰æ›´é«˜çš„ååé‡ï¼Œç›¸æ¯”userspaceæ¨¡å¼ï¼Œæ˜¯ç›´æ¥è½¬å‘æµé‡ï¼Œä¸ç”¨ç»è¿‡Kube-proxyè½¬å‘ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœé€‰æ‹©iptablesæ¨¡å¼ï¼Œæ‰€æœ‰æµé‡ä¼šå…ˆç»è¿‡PREROUTINGæˆ–è€…OUTPUTé“¾ ï¼Œéšåè¿›å…¥Kubernetesè‡ªå®šä¹‰çš„é“¾å…¥å£KUBE_SERVICESã€å•ä¸ªServiceå¯¹åº”çš„é“¾KUBE-SVC-XXXä»¥åŠæ¯ä¸ªpodå¯¹åº”çš„é“¾KUBE-SEP-XXXï¼Œç»è¿‡è¿™äº›é“¾çš„å¤„ç†ï¼Œæœ€ç»ˆæ‰èƒ½è®¿é—®ä¸€ä¸ªæœåŠ¡çœŸæ­£çš„IPåœ°å€ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ipvsï¼šè§£å†³åœ¨å¤§é‡ Service æ—¶ï¼Œiptables è§„åˆ™åŒæ­¥å˜å¾—ä¸å¯ç”¨çš„æ€§èƒ½é—®é¢˜ï¼Œipvs çš„å®ç°è™½ç„¶ä¹ŸåŸºäº netfilter çš„é’©å­å‡½æ•°ï¼Œä½†æ˜¯å®ƒå´ä½¿ç”¨å“ˆå¸Œè¡¨ä½œä¸ºåº•å±‚çš„æ•°æ®ç»“æ„ï¼Œä½¿ç”¨ipsetæ¥ç”Ÿæˆè§„åˆ™é“¾ï¼ˆipsetå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªIPæ®µçš„é›†åˆï¼Œè¿™ä¸ªé›†åˆå¯ä»¥æ˜¯IPåœ°å€ã€ç½‘æ®µã€ç«¯å£ç­‰ï¼Œå¯ä»¥åŠ¨æ€ä¿®æ”¹ï¼‰ï¼Œå¹¶ä¸”å·¥ä½œåœ¨å†…æ ¸æ€ï¼Œè€Œiptablesè§„åˆ™é“¾æ˜¯ä¸€ä¸ªçº¿æ€§çš„æ•°æ®ç»“æ„ï¼ŒæŸ¥æ‰¾æ˜¯éœ€è¦éå†æŸ¥æ‰¾ï¼Œè¿™ä¹Ÿå°±æ˜¯è¯´ ipvs åœ¨é‡å®šå‘æµé‡å’ŒåŒæ­¥ä»£ç†è§„åˆ™æœ‰ç€æ›´å¥½çš„æ€§èƒ½ã€‚&lt;/p&gt;
&lt;p&gt;é™¤äº†èƒ½å¤Ÿæå‡æ€§èƒ½ä¹‹å¤–ï¼Œipvs ä¹Ÿæä¾›äº†å¤šç§ç±»å‹çš„è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œé™¤äº†æœ€å¸¸è§çš„ Round-Robin ä¹‹å¤–ï¼Œè¿˜æ”¯æŒæœ€å°è¿æ¥ã€ç›®æ ‡å“ˆå¸Œã€æœ€å°å»¶è¿Ÿç­‰ç®—æ³•ï¼Œèƒ½å¤Ÿå¾ˆå¥½åœ°æå‡è´Ÿè½½å‡è¡¡çš„æ•ˆç‡ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;endpointsçš„ä½œç”¨&#34;&gt;Endpointsçš„ä½œç”¨&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;å½“serviceä½¿ç”¨äº†selectoræŒ‡å®šå¸¦æœ‰å¯¹åº”labelçš„podæ—¶ï¼Œendpoint controlleræ‰ä¼šè‡ªåŠ¨åˆ›å»ºå¯¹åº”çš„endpointå¯¹è±¡ï¼Œäº§ç”Ÿä¸€ä¸ªendpointsï¼Œendpointsä¿¡æ¯å­˜å‚¨åœ¨etcdä¸­ï¼Œç”¨æ¥è®°å½•ä¸€ä¸ªserviceå¯¹åº”çš„æ‰€æœ‰podçš„è®¿é—®åœ°å€&lt;/strong&gt;ï¼›&lt;/p&gt;
&lt;p&gt;è¯´ç™½äº†ï¼Œå› ä¸ºPod ipæ¯”è¾ƒå®¹æ˜“å˜åŒ–ï¼Œè€ŒEndpointçš„ä½œç”¨å°±æ˜¯ç»´æŠ¤Serviceå’Œä¸€ç»„Podçš„æ˜ å°„ï¼Œä¸ç”¨é¢‘ç¹ä¿®æ”¹Serviceã€‚&lt;/p&gt;
&lt;p&gt;Endpoints controllerçš„ä½œç”¨ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è´Ÿè´£ç”Ÿæˆå’Œç»´æŠ¤æ‰€æœ‰endpointå¯¹è±¡çš„æ§åˆ¶å™¨ï¼›&lt;/li&gt;
&lt;li&gt;è´Ÿè´£ç›‘å¬serviceå’Œå¯¹åº”podçš„å˜åŒ–ï¼›&lt;/li&gt;
&lt;li&gt;ç›‘å¬åˆ°serviceè¢«åˆ é™¤ï¼Œåˆ™åˆ é™¤å’Œè¯¥serviceåŒåçš„endpointå¯¹è±¡ï¼›&lt;/li&gt;
&lt;li&gt;ç›‘å¬åˆ°æ–°çš„serviceè¢«åˆ›å»ºï¼Œåˆ™æ ¹æ®æ–°å»ºserviceä¿¡æ¯è·å–ç›¸å…³podåˆ—è¡¨ï¼Œç„¶ååˆ›å»ºå¯¹åº”endpointå¯¹è±¡ï¼›&lt;/li&gt;
&lt;li&gt;ç›‘å¬åˆ°serviceè¢«æ›´æ–°ï¼Œåˆ™æ ¹æ®æ›´æ–°åçš„serviceä¿¡æ¯è·å–ç›¸å…³podåˆ—è¡¨ï¼Œç„¶åæ›´æ–°å¯¹åº”endpointå¯¹è±¡ï¼›&lt;/li&gt;
&lt;li&gt;ç›‘å¬åˆ°podäº‹ä»¶ï¼Œåˆ™æ›´æ–°å¯¹åº”çš„serviceçš„endpointå¯¹è±¡ï¼Œå°†pod IPè®°å½•åˆ°endpointä¸­ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;serviceçš„å®ç°&#34;&gt;Serviceçš„å®ç°&lt;/h3&gt;
&lt;p&gt;Serviceç”±kube-proxyç»„ä»¶ + kube-dnsç»„ä»¶(coreDNS) + iptablesæˆ–IPVSå…±åŒå®ç°ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;coreDNSåˆ›å»ºæ—¶ä¼šè°ƒç”¨kubeletä¿®æ”¹æ¯ä¸ªèŠ‚ç‚¹çš„&lt;code&gt;/etc/resolv.conf&lt;/code&gt;æ–‡ä»¶ï¼Œæ·»åŠ coreDNSçš„Serviceçš„clusterIPä½œä¸ºDNSæœåŠ¡çš„IPï¼›&lt;/li&gt;
&lt;li&gt;coreDNSä¼šç›‘å¬serviceå’Œendpointsçš„å˜åŒ–ï¼Œç¼“å­˜åˆ°å†…å­˜ä¸­ï¼Œä¸»è¦æ˜¯Serviceåç§°ä¸å…¶clusterIPçš„æ˜ å°„ï¼›&lt;/li&gt;
&lt;li&gt;kube-proxyä¹Ÿä¼šç›‘å¬Serviceå’ŒEndpointsçš„å˜åŒ–ï¼Œç„¶åæ›´æ–°ç”±Serviceåˆ°Podè·¯ç”±è§„åˆ™ï¼Œå¹¶æ·»åŠ åˆ°å®¿ä¸»æœºçš„iptablesä¸­ï¼›&lt;/li&gt;
&lt;li&gt;é€šè¿‡ServiceåŸŸåè¯·æ±‚æ—¶ï¼Œä¼šå…ˆè¯·æ±‚coreDNSæœåŠ¡è·å–å¯¹åº”Serviceçš„clusterIPï¼Œå†æ ¹æ®è¿™ä¸ªipåœ¨iptablesä¸­è½¬å‘åˆ°å¯¹åº”çš„podï¼Œiptablesä¼šè´Ÿè´£è´Ÿè½½å‡è¡¡ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;kube-proxyåªæ˜¯controllerï¼Œå¯¹iptablesè¿›è¡Œæ›´æ–°ï¼ŒåŸºäºiptablesçš„kube-proxyçš„ä¸»è¦èŒè´£åŒ…æ‹¬ä¸¤å¤§å—ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ç›‘å¬Serviceæ›´æ–°äº‹ä»¶ï¼Œå¹¶æ›´æ–°Serviceç›¸å…³çš„iptablesè§„åˆ™ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç›‘å¬Endpointæ›´æ–°äº‹ä»¶ï¼Œæ›´æ–°Endpointç›¸å…³çš„iptablesè§„åˆ™ï¼Œç„¶åå°†åŒ…è¯·æ±‚è½¬å…¥Endpointå¯¹åº”çš„Podï¼›&lt;/p&gt;
&lt;p&gt;å¦‚æœæŸä¸ªServiceå°šæ²¡æœ‰Podåˆ›å»ºï¼Œé‚£ä¹ˆé’ˆå¯¹æ­¤Serviceçš„è¯·æ±‚å°†ä¼šè¢«ä¸¢å¼ƒã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;kube-proxyå¯¹iptablesçš„é“¾è¿›è¡Œäº†æ‰©å……ï¼Œè‡ªå®šä¹‰äº†KUBE-SERVICESï¼ŒKUBE-NODEPORTSï¼ŒKUBE-POSTROUTINGï¼ŒKUBE-MARK-MASQå’ŒKUBE-MARK-DROPäº”ä¸ªé“¾ï¼Œå¹¶ä¸»è¦é€šè¿‡ä¸ºKUBE-SERVICES chainå¢åŠ ruleæ¥é…åˆ¶traffic routing è§„åˆ™ã€‚é€šè¿‡iptablesï¼Œä¿®æ”¹æµå…¥çš„IPåŒ…çš„ç›®çš„åœ°å€å’Œç«¯å£ï¼Œä»è€Œå®ç°è½¬å‘ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;é¦–å…ˆç»™ Service åˆ†é…ä¸€ä¸ªVIPï¼Œç„¶åå¢åŠ  iptables è§„åˆ™å°†è®¿é—®è¯¥ IP çš„è¯·æ±‚è½¬å‘åˆ°åç»­çš„ iptables é“¾ã€‚&lt;/p&gt;
&lt;p&gt;KUBE-SERVICES æˆ–è€… KUBE-NODEPORTS è§„åˆ™å¯¹åº”çš„ Service çš„å…¥å£é“¾ï¼Œè¿™ä¸ªè§„åˆ™åº”è¯¥ä¸ VIP å’Œ Service ç«¯å£ä¸€ä¸€å¯¹åº”ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;iptables é“¾å®é™…æ˜¯ä¸€ä¸ªé›†åˆï¼ŒåŒ…å«äº†å„ä¸ª Pod çš„IPï¼ˆè¿™äº›ç§°ä¸º Service çš„ Endpointsï¼‰ï¼Œä½¿ç”¨ Round Robin æ–¹å¼çš„è´Ÿè½½å‡è¡¡ã€‚&lt;/p&gt;
&lt;p&gt;KUBE-SEP-(hash) è§„åˆ™å¯¹åº”çš„ DNAT é“¾ï¼Œè¿™äº›è§„åˆ™åº”è¯¥ä¸ Endpoints ä¸€ä¸€å¯¹åº”ï¼›
KUBE-SVC-(hash) è§„åˆ™å¯¹åº”çš„è´Ÿè½½å‡è¡¡é“¾ï¼Œè¿™äº›è§„åˆ™çš„æ•°ç›®åº”è¯¥ä¸ Endpoints æ•°ç›®ä¸€è‡´ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç„¶åï¼Œè¿™äº› Endpoints å¯¹åº”çš„ iptables è§„åˆ™ï¼Œæ­£æ˜¯ kube-proxy é€šè¿‡ç›‘å¬ Pod çš„å˜åŒ–äº‹ä»¶ï¼Œåœ¨å®¿ä¸»æœºä¸Šç”Ÿæˆå¹¶ç»´æŠ¤çš„ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;p&gt;å¤§é‡çš„Podä¼šäº§ç”Ÿå¤§é‡çš„iptableså¯¼è‡´æ€§èƒ½é—®é¢˜ï¼Œå› ä¸ºå…¶å®ç°æ–¹å¼æ˜¯å…¨é‡çš„ï¼Œä¼šå¯¹æ–‡ä»¶ä¸Šé”ï¼ŒæŠŠiptablesé‡Œçš„å†…å®¹æ‹·è´å‡ºæ¥è¿›è¡Œä¿®æ”¹ï¼Œç„¶åå†ä¿å­˜å›å»ï¼Œå½“æœ‰5000ä¸ªæœåŠ¡æ—¶ï¼Œå°±è¦è€—æ—¶11åˆ†é’Ÿäº†ï¼Œæ‰€ä»¥kube-proxyä½¿ç”¨IPVSæ¨¡å¼æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚IPVS æ˜¯å»ºç«‹äº Netfilterä¹‹ä¸Šçš„é«˜æ•ˆå››å±‚è´Ÿè½½å‡è¡¡å™¨ï¼Œæ”¯æŒ TCP å’Œ UDP åè®®ï¼Œæ”¯æŒ3ç§è´Ÿè½½å‡è¡¡æ¨¡å¼ï¼šNATã€ç›´æ¥è·¯ç”±ï¼ˆé€šè¿‡ MAC é‡å†™å®ç°äºŒå±‚è·¯ç”±ï¼‰å’ŒIP éš§é“ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å…³äºheadless&#34;&gt;å…³äºHeadless&lt;/h3&gt;
&lt;p&gt;Serviceåœ¨é›†ç¾¤å†…éƒ¨è¢«è®¿é—®ï¼Œæœ‰ä¸¤ç§æ–¹å¼&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Serviceçš„VIPï¼Œå³clusterIPï¼Œè®¿é—®è¯¥IPæ—¶ï¼ŒServiceä¼šæŠŠè¯·æ±‚è½¬å‘åˆ°å…¶ä»£ç†çš„æŸä¸ªPodä¸Šã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Serviceçš„DNSæ–¹å¼ï¼Œæ¯”å¦‚Serviceæœ‰&lt;code&gt;[svcåç§°].[namespaceåç§°].svc.cluster.local&lt;/code&gt;è¿™æ¡DNSè®°å½•ï¼Œè®¿é—®è¿™æ¡DNSè®°å½•ï¼Œæ ¹æ®è¿™æ¡DNSè®°å½•ï¼ŒæŸ¥è¯¢å‡ºå¯¹åº”çš„clusterIPï¼Œæ ¹æ®clusterIP + iptablesè½¬å‘ç»™å¯¹åº”çš„podï¼Œå®ç°è´Ÿè½½å‡è¡¡ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœè¿™æ¡DNSè®°å½•æ²¡æœ‰å¯¹åº”çš„Service VIPï¼Œå³Serviceçš„clusterIPæ˜¯Noneï¼Œåˆ™ç§°ä¸ºHeadless Serviceï¼Œæ­¤æ—¶çš„DNSè®°å½•æ ¼å¼ä¸º&lt;code&gt;&amp;lt;pod-name&amp;gt;.&amp;lt;svc-name&amp;gt;.&amp;lt;namespace &amp;gt;.svc.cluster.local&lt;/code&gt;ï¼Œç›´æ¥æ˜ å°„åˆ°è¢«ä»£ç†çš„æŸä¸ªPodçš„IPï¼Œç”±å®¢æˆ·ç«¯æ¥å†³å®šè‡ªå·±è¦è®¿é—®å“ªä¸ªpodï¼Œå¹¶ç›´æ¥è®¿é—®ã€‚é€šè¿‡headless serviceè®¿é—®ä¸ä¼šè¿›è¡Œè´Ÿè½½å‡è¡¡ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Serviceå’ŒPodéƒ½ä¼šè¢«Kubernetesåˆ†é…å¯¹åº”çš„DNS Aè®°å½•ã€‚&lt;/p&gt;
&lt;p&gt;ClusterIpæ¨¡å¼ä¸‹çš„Aè®°å½•&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Serviceï¼š.. svc.cluster.localï¼Œå¯¹åº”Cluster IP&lt;/li&gt;
&lt;li&gt;Podï¼š.. pod.cluster.localï¼Œå¯¹åº”Podçš„IP&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Headlessæ¨¡å‹ä¸‹çš„Aè®°å½•&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Serviceï¼š.. svc.cluster.localï¼Œå¯¹åº”çš„æ˜¯æ‰€æœ‰è¢«ä»£ç†çš„Podçš„IPåœ°å€çš„é›†åˆ&lt;/li&gt;
&lt;li&gt;Podï¼š.. svc.cluster.localï¼Œå¯¹åº”Podçš„IP&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;serviceçš„å‡ ç§è®¾ç½®&#34;&gt;Serviceçš„å‡ ç§è®¾ç½®&lt;/h3&gt;
&lt;p&gt;Serviceçš„æœ¬è´¨æ˜¯é€šè¿‡kube-proxyåœ¨å®¿ä¸»æœºä¸Šè®¾ç½®iptablesè§„åˆ™ã€DNSæ˜ å°„ï¼Œå·¥ä½œåœ¨ç¬¬å››å±‚ä¼ è¾“å±‚ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;type=ClusterIPï¼Œæ­¤æ—¶è¯¥serviceåªèƒ½åœ¨é›†ç¾¤å†…éƒ¨è¢«è®¿é—®&lt;/strong&gt;ï¼Œå¦‚æœé›†ç¾¤å¤–æƒ³è®¿é—®ï¼Œåªèƒ½é€šè¿‡kubernetesçš„proxyæ¨¡å¼æ¥è®¿é—®ï¼Œæ¯”å¦‚å…ˆå¼€å¯&lt;code&gt;kubectl proxy --port=8080&lt;/code&gt;åœ¨æœ¬æœºæ‰“å¼€é›†ç¾¤è®¿é—®çš„ä»£ç†ï¼Œç„¶åé€šè¿‡è¯¥ç«¯å£è¿›è¡Œè®¿é—®ï¼Œkubernetesä¼šå¸®æˆ‘ä»¬è½¬å‘åˆ°å¯¹åº”çš„podä¸Šï¼š&lt;code&gt;curl http://localhost:8080/api/v1/proxy/namespaces/{åç§°ç©ºé—´}/services/{serviceåç§°}/{path}&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;type=NodePortï¼Œé›†ç¾¤å¤–éƒ¨ä½¿ç”¨ &lt;code&gt;{ä»»ä½•ä¸€ä¸ªèŠ‚ç‚¹çš„IP}:{nodePort}&lt;/code&gt; è®¿é—®è¿™ä¸ªservice&lt;/strong&gt;ï¼Œä¼šå°†è¯·æ±‚è½¬å‘åˆ°å¯¹åº”çš„Podï¼Œæœ¬è´¨ä¸Šæ˜¯kube-proxyä¸ºè¯¥æ¨¡å¼é…ç½®ä¸€æ¡iptablesè§„åˆ™ï¼›&lt;/p&gt;
&lt;p&gt;é»˜è®¤ä¸‹nodePortä¼šä½¿ç”¨ä¸»æœºçš„ç«¯å£èŒƒå›´ï¼š30000 - 32767ï¼›&lt;/p&gt;
&lt;p&gt;åœ¨è¿™é‡Œï¼Œè¯·æ±‚å¯èƒ½ä¼šç»è¿‡SNATæ“ä½œï¼Œå› ä¸ºå½“clienté€šè¿‡node2çš„åœ°å€è®¿é—®ä¸€ä¸ªServiceï¼Œnode2å¯èƒ½ä¼šè´Ÿè½½å‡è¡¡å°†è¯·æ±‚è½¬å‘ç»™node1ï¼Œnode1å¤„ç†å®Œï¼Œç»è¿‡SNATï¼Œå°†å“åº”è¿”å›ç»™node2ï¼Œå†ç”±node2å“åº”å›clientï¼Œä¿è¯äº†clientè¯·æ±‚node2åå¾—åˆ°çš„å“åº”ä¹Ÿæ˜¯node2çš„ï¼Œæ­¤æ—¶PodåªçŸ¥é“è¯·æ±‚çš„æ¥æºï¼Œå¹¶ä¸çŸ¥é“çœŸæ­£çš„å‘èµ·æ–¹ï¼›&lt;/p&gt;
&lt;p&gt;å¦‚æœServiceè®¾ç½®äº†&lt;code&gt;spec.extrnalTrafficPolicy=local&lt;/code&gt;ï¼ŒPodæ¥æ”¶åˆ°è¯·æ±‚ï¼Œå¯ä»¥çŸ¥é“çœŸæ­£çš„å¤–éƒ¨å‘èµ·æ–¹æ˜¯è°äº†ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;type=LoadBalancerï¼Œè®¾ç½®ä¸€ä¸ªå¤–éƒ¨å‡è¡¡æœåŠ¡ï¼Œè¿™ä¸ªä¸€èˆ¬ç”±å…¬æœ‰äº‘æä¾›&lt;/strong&gt;ï¼Œæ¯”å¦‚awsçš„NLBï¼Œé˜¿é‡Œäº‘çš„LBæœåŠ¡ï¼Œæ­¤æ—¶ä¼šæœ‰ExternalIPï¼Œæ‰§è¡ŒLBçš„åŸŸåã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;**type=ExternalNameï¼Œ**å¹¶è®¾ç½®externalNameçš„å€¼ï¼Œæ­¤æ—¶ä¸ä¼šäº§ç”ŸEndPointsã€clusterIPï¼Œ&lt;strong&gt;ä½œç”¨æ˜¯ä¸ºè¿™ä¸ªexternalNameè®¾ç½®äº†CNameï¼Œä¸»è¦ç”¨äºé›†ç¾¤å†…çš„Podè®¿é—®é›†ç¾¤å¤–çš„æœåŠ¡&lt;/strong&gt;ã€‚æ¯”å¦‚ExternalNameè®¾ç½®ä¸ºwww.google.comï¼Œæ­¤æ—¶podå¯ä»¥ç›´æ¥é€šè¿‡&lt;code&gt; [svcåç§°].[namespaceåç§°].svc.cluster.local&lt;/code&gt;å³å¯è®¿é—®www.google.com&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è®¾ç½®externalIPsçš„å€¼ï¼Œè¿™æ ·ä¹Ÿèƒ½é€šè¿‡è¯¥ipè¿›è¡Œè®¿é—®ï¼Œå‰ææ˜¯è¯¥IPå¯¹å…¬ç½‘æš´éœ²ï¼Œæ¯”å¦‚awsçš„å¼¹æ€§ipã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;é€šè¿‡port forwardçš„æ–¹å¼ï¼Œå°†Podç«¯å£è½¬å‘åˆ°æ‰§è¡Œå‘½ä»¤çš„é‚£å°æœºå™¨ä¸Šï¼Œé€šè¿‡ç«¯å£æ˜ å°„æä¾›è®¿é—®ï¼Œè€Œä¸éœ€è¦Serviceã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ£€æŸ¥ç½‘ç»œæ˜¯å¦æœ‰é—®é¢˜ï¼Œä¸€èˆ¬å…ˆæ£€æŸ¥MasterèŠ‚ç‚¹çš„Service DNSæ˜¯å¦æ­£å¸¸ã€kube-dns(coreDns)çš„è¿è¡ŒçŠ¶æ€å’Œæ—¥å¿—ï¼›&lt;/p&gt;
&lt;p&gt;å½“æ— æ³•é€šè¿‡ClusterIPè®¿é—®Serviceè®¿é—®æ—¶ï¼Œæ£€æŸ¥Serviceæ˜¯å¦æœ‰Endpointsï¼Œæ£€æŸ¥Kube-proxyæ˜¯å¦æ­£ç¡®è¿è¡Œï¼›&lt;/p&gt;
&lt;p&gt;æœ€åæ£€æŸ¥å®¿ä¸»æœºä¸Šçš„iptablesã€‚&lt;/p&gt;
&lt;h3 id=&#34;å…³äºæœåŠ¡å‘ç°&#34;&gt;å…³äºæœåŠ¡å‘ç°&lt;/h3&gt;
&lt;p&gt;Kubernetesæ”¯æŒä¸¤ç§æœåŠ¡å‘ç°ï¼šç¯å¢ƒå˜é‡å’ŒDNSæœåŠ¡&lt;/p&gt;
&lt;h4 id=&#34;ç¯å¢ƒå˜é‡&#34;&gt;ç¯å¢ƒå˜é‡&lt;/h4&gt;
&lt;p&gt;åˆ›å»ºServiceæ—¶ï¼Œä¼šåœ¨Service selectorçš„Podä¸­çš„å®¹å™¨æ³¨å…¥åŒä¸€namespaceä¸‹æ‰€æœ‰serviceçš„IPå’Œç«¯å£ä½œä¸ºç¯å¢ƒå˜é‡ï¼Œè¯¥ç¯å¢ƒå˜é‡ä¼šéšç€Serviceçš„IPå’Œç«¯å£çš„æ”¹å˜è€Œæ”¹å˜ï¼Œä½†è®¾ç½®åˆ°å®¹å™¨é‡Œçš„ç¯å¢ƒå˜é‡ä¸ä¼šã€‚&lt;/p&gt;
&lt;p&gt;å¯ä»¥ä½¿ç”¨&lt;code&gt;kubectl exec -it {podåå­—} -n {åç§°ç©ºé—´} env&lt;/code&gt;æŸ¥çœ‹ï¼ŒHOSTä¸ºserviceçš„cluster-IP&lt;/p&gt;
&lt;p&gt;Kubernetesä¼šè®¾ç½®ä¸¤ç±»ç¯å¢ƒå˜é‡ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;serviceç¯å¢ƒå˜é‡&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-ini&#34; data-lang=&#34;ini&#34;&gt;&lt;span class=&#34;na&#34;&gt;{serviceåç§°}_SERVICE_HOST&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;172.20.97.162&lt;/span&gt;
&lt;span class=&#34;na&#34;&gt;{serviceåç§°}_SERVICE_PORT&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;8080&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Docker Linkç¯å¢ƒå˜é‡&lt;/p&gt;
&lt;p&gt;DockerLinkçš„ä½œç”¨ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;åŒä¸€ä¸ªå®¿ä¸»æœºä¸Šçš„å¤šä¸ªdockerå®¹å™¨ä¹‹é—´å¦‚æœæƒ³è¿›è¡Œé€šä¿¡ï¼Œå¯ä»¥é€šè¿‡ä½¿ç”¨å®¹å™¨çš„ipåœ°å€æ¥é€šä¿¡ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å®¿ä¸»æœºçš„ipåŠ ä¸Šå®¹å™¨æš´éœ²å‡ºçš„ç«¯å£å·æ¥é€šä¿¡ï¼Œå‰è€…ä¼šå¯¼è‡´ipåœ°å€çš„ç¡¬ç¼–ç ï¼Œä¸æ–¹ä¾¿è¿ç§»ï¼Œå¹¶ä¸”å®¹å™¨é‡å¯åipåœ°å€ä¼šæ”¹å˜ï¼Œé™¤éä½¿ç”¨å›ºå®šçš„ipï¼Œåè€…çš„é€šä¿¡æ–¹å¼æ¯”è¾ƒå•ä¸€ï¼Œåªèƒ½ä¾é ç›‘å¬åœ¨æš´éœ²å‡ºçš„ç«¯å£çš„è¿›ç¨‹æ¥è¿›è¡Œæœ‰é™çš„é€šä¿¡ã€‚é€šè¿‡dockerçš„linkæœºåˆ¶å¯ä»¥é€šè¿‡ä¸€ä¸ªnameæ¥å’Œå¦ä¸€ä¸ªå®¹å™¨é€šä¿¡ï¼Œlinkæœºåˆ¶æ–¹ä¾¿äº†å®¹å™¨å»å‘ç°å…¶å®ƒçš„å®¹å™¨å¹¶ä¸”å¯ä»¥å®‰å…¨çš„ä¼ é€’ä¸€äº›è¿æ¥ä¿¡æ¯ç»™å…¶å®ƒçš„å®¹å™¨ã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨æ—¶éœ€è¦å…ˆè¿æ¥å®¹å™¨ï¼Œä½¿ç”¨å‘½ä»¤&lt;code&gt;docker run -d --name {å®¹å™¨åç§°} --link {å¦ä¸€ä¸ªå®¹å™¨åç§°}&lt;/code&gt;ï¼Œä¹‹ååœ¨å®¹å™¨å†…å³å¯ä½¿ç”¨å¯¹æ–¹å®¹å™¨çš„åç§°è¿›è¡Œé€šä¿¡&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-ini&#34; data-lang=&#34;ini&#34;&gt;&lt;span class=&#34;na&#34;&gt;{serviceåç§°}_PORT_8080_TCP_ADDR&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;172.20.97.162&lt;/span&gt;
&lt;span class=&#34;na&#34;&gt;{serviceåç§°}_PORT_8080_TCP_PORT&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;8080&lt;/span&gt;
&lt;span class=&#34;na&#34;&gt;{serviceåç§°}_PORT_8080_TCP_PROTO&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;tcp&lt;/span&gt;
&lt;span class=&#34;na&#34;&gt;{serviceåç§°}_PORT&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;tcp://10.100.251.57:8080&lt;/span&gt;
&lt;span class=&#34;na&#34;&gt;{serviceåç§°}_PORT_8080_TCP&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;tcp://10.100.251.57:8080&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç„¶åï¼ŒæœåŠ¡å³å¯é€šè¿‡ç¯å¢ƒå˜é‡è·å–è¦è®¿é—®çš„æœåŠ¡çš„IPå’Œç«¯å£ï¼Œä½†æ˜¯è¿™ç§æœåŠ¡å‘ç°æ–¹å¼æœ‰ä¸€äº›&lt;strong&gt;ç¼ºç‚¹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å…ˆå‰çš„æœåŠ¡å¿…é¡»å…ˆè¿è¡Œèµ·æ¥ï¼Œå¦åˆ™ç¯å¢ƒå˜é‡æ— æ³•è¢«æ³¨å…¥ï¼Œå¯¼è‡´Podæ— æ³•ä½¿ç”¨è¯¥ç¯å¢ƒå˜é‡ï¼›&lt;/li&gt;
&lt;li&gt;å¦‚æœä¾èµ–çš„serviceè¢«åˆ äº†æˆ–ç»‘å®šäº†æ–°åœ°å€ï¼Œç¯å¢ƒå˜é‡ä¸ä¼šè¢«ä¿®æ”¹ï¼Œä»ç„¶ä½¿ç”¨æ—§æœ‰åœ°å€ï¼›&lt;/li&gt;
&lt;li&gt;åªæœ‰åœ¨åŒä¸€namespaceä¸‹çš„Podå†…æ‰å¯ä»¥ä½¿ç”¨æ­¤ç¯å¢ƒå˜é‡è¿›è¡Œè®¿é—®ï¼Œä¸åŒnamespaceä¸‹æ— æ³•é€šè¿‡å˜é‡è®¿é—®ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;dnsæœåŠ¡&#34;&gt;DNSæœåŠ¡&lt;/h4&gt;
&lt;p&gt;ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¼šä½¿ç”¨CoreDNSä½œä¸ºKubernetesé›†ç¾¤çš„DNSï¼Œ&lt;strong&gt;CoreDNSé»˜è®¤é…ç½®çš„ç¼“å­˜æ—¶é—´æ˜¯30s&lt;/strong&gt;ï¼Œå¢å¤§cacheæ—¶é—´å¯¹åŸŸåè§£æTTLæ•æ„Ÿå‹çš„åº”ç”¨æœ‰ä¸€å®šçš„å½±å“ï¼Œä¼šå»¶ç¼“åº”ç”¨æ„ŸçŸ¥åŸŸåè§£æé…ç½®å˜æ›´æ—¶é—´ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Kubernetes é€šè¿‡ä¿®æ”¹æ¯ä¸ª Pod ä¸­æ¯ä¸ªå®¹å™¨çš„åŸŸåè§£æé…ç½®æ–‡ä»¶&lt;code&gt;/etc/resolv.conf&lt;/code&gt; æ¥è¾¾åˆ°æœåŠ¡å‘ç°çš„ç›®çš„&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-ini&#34; data-lang=&#34;ini&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# /etc/resolv.conf&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;# nameserverè¡¨ç¤ºDNSæœåŠ¡å™¨&lt;/span&gt;
&lt;span class=&#34;na&#34;&gt;nameserver 172.20.0.10&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;# ä¸»æœºåæŸ¥è¯¢åˆ—è¡¨ï¼Œé»˜è®¤åªåŒ…å«æœ¬åœ°åŸŸåï¼Œé˜ˆå€¼ä¸º6ä¸ªï¼Œ256ä¸ªå­—ç¬¦ï¼Œä¼šä»¥ {åç§°ç©ºé—´}.svc.cluster.localã€svc.cluster.localã€cluster.local 3ä¸ªåç¼€ï¼Œæœ€å¤šè¿›è¡Œ8æ¬¡æŸ¥è¯¢ (IPV4å’ŒIPV6æŸ¥è¯¢å„å››æ¬¡) æ‰èƒ½å¾—åˆ°æ­£ç¡®è§£æç»“æœ&lt;/span&gt;
&lt;span class=&#34;na&#34;&gt;search {åç§°ç©ºé—´}.svc.cluster.local svc.cluster.local cluster.local&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;# é˜ˆå€¼ä¸º 15&lt;/span&gt;
&lt;span class=&#34;na&#34;&gt;options ndots:5&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;# ç­‰å¾… DNS æœåŠ¡å™¨å“åº”çš„è¶…æ—¶æ—¶é—´ï¼Œå•ä½ä¸ºç§’ã€‚é˜ˆå€¼ä¸º 30 sã€‚&lt;/span&gt;
&lt;span class=&#34;na&#34;&gt;options timeout: 30&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;# å‘åŒä¸€ä¸ª DNS æœåŠ¡å™¨å‘èµ·é‡è¯•çš„æ¬¡æ•°ï¼Œå•ä½ä¸ºæ¬¡ã€‚é˜ˆå€¼ä¸º 5ã€‚&lt;/span&gt;
&lt;span class=&#34;na&#34;&gt;options attempts: 1&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;nameserveræŒ‡å‘çš„IPï¼Œå°±æ˜¯ coreDNS çš„serviceçš„ClusterIPï¼Œæ‰€æœ‰çš„åŸŸåè§£æéƒ½éœ€è¦ç»è¿‡coreDNSçš„ClusterIPæ¥è¿›è¡Œè§£æï¼Œä¸è®ºæ˜¯Kuberneteså†…éƒ¨åŸŸåè¿˜æ˜¯å¤–éƒ¨åŸŸåï¼›&lt;/p&gt;
&lt;p&gt;coreDNSä¼šç›‘å¬é›†ç¾¤å†…æ‰€æœ‰ServiceAPIï¼Œä»¥åœ¨æœåŠ¡ä¸å¯ç”¨æ—¶ç§»é™¤è®°å½•ï¼Œåœ¨æ–°æœåŠ¡åˆ›å»ºæ—¶æ’å…¥æ–°è®°å½•ï¼Œè®°å½•å­˜å‚¨åœ¨coreDNSçš„æœ¬åœ°ç¼“å­˜ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨è¿™ä¸ª&lt;code&gt;/etc/resolv.conf&lt;/code&gt;é‡Œé…ç½®å«ä¹‰ä¸ºï¼šDNSæœåŠ¡å™¨ä¸º172.20.0.10ï¼Œå½“æŸ¥è¯¢çš„å…³é”®è¯ä¸­çš„ &lt;code&gt;.&lt;/code&gt; çš„æ•°é‡å°‘äº5ä¸ªï¼Œåˆ™æ ¹æ®searchä¸­é…ç½®çš„åŸŸåè¿›è¡ŒæŸ¥è¯¢ï¼Œå½“æŸ¥è¯¢éƒ½æ²¡æœ‰è¿”å›æ­£ç¡®å“åº”æ—¶å†å°è¯•æŸ¥è¯¢å…³é”®è¯æœ¬èº«ï¼Œæ¯”å¦‚æ‰§è¡Œ&lt;code&gt;host -v cn.bing.com&lt;/code&gt;ï¼Œä¼šå¾—åˆ°&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-ini&#34; data-lang=&#34;ini&#34;&gt;&lt;span class=&#34;na&#34;&gt;Trying &amp;#34;cn.bing.com.{åç§°ç©ºé—´}.svc.cluster.local&amp;#34;&lt;/span&gt;
&lt;span class=&#34;na&#34;&gt;Trying &amp;#34;cn.bing.com.svc.cluster.local&amp;#34;&lt;/span&gt;
&lt;span class=&#34;na&#34;&gt;Trying &amp;#34;cn.bing.com.cluster.local&amp;#34;&lt;/span&gt;
&lt;span class=&#34;na&#34;&gt;Trying &amp;#34;cn.bing.com.us-west-2.compute.internal&amp;#34;&lt;/span&gt;
&lt;span class=&#34;na&#34;&gt;Trying &amp;#34;cn.bing.com&amp;#34;&lt;/span&gt;
&lt;span class=&#34;na&#34;&gt;...&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;æ‰€ä»¥ï¼Œç›´æ¥è¯·æ±‚é›†ç¾¤å†…éƒ¨åŒä¸€namespaceä¸‹çš„åŸŸåæ—¶æ•ˆç‡æœ€é«˜ï¼Œå› ä¸ºåªéœ€è¦æŸ¥è¯¢ä¸€æ¬¡å³å¯æ‰¾åˆ°ï¼Œæ¯”å¦‚åœ¨åŒä¸€namespaceä¸‹ç›´æ¥&lt;code&gt;curl {æœåŠ¡serviceå} &lt;/code&gt;çš„æ•ˆç‡æ˜¯æ¯”&lt;code&gt;curl {æœåŠ¡serviceå}.{namespace}&lt;/code&gt;è¦é«˜ï¼Œå› ä¸ºå°‘äº†ä¸€æ¬¡åŸŸåæŸ¥è¯¢ã€‚è¿™ç§DNSæŸ¥è¯¢è§£æå«&lt;strong&gt;éå…¨é™å®šåŸŸåæŸ¥æ‰¾&lt;/strong&gt;ï¼Œå› ä¸ºæˆ‘ä»¬é…ç½®äº†&lt;code&gt;ndots=5&lt;/code&gt;ï¼Œæ‰€ä»¥å½“åŸŸåä¸­&lt;code&gt;.&lt;/code&gt; çš„ä¸ªæ•°å°äº5ä¸ªï¼Œå°±ä¼šèµ°searchæŸ¥è¯¢è§£æï¼Œå¦‚æœè¦ä½¿ç”¨å…¨é™å®šåŸŸåæŸ¥æ‰¾ï¼Œåˆ™éœ€è¦åœ¨åŸŸååé¢åŠ &lt;code&gt;.&lt;/code&gt;ï¼Œå°±ä¸ä¼šèµ°searchæŸ¥è¯¢è§£æäº†ï¼Œæ¯”å¦‚å½“&lt;code&gt;cn.bing.com.&lt;/code&gt;æ­¤æ—¶å°±åªä¼šæŸ¥è¯¢ä¸€æ¬¡äº†ï¼ŒæŸ¥ä¸åˆ°æ‰ä¼šèµ°searchæŸ¥è¯¢ã€‚ä¹Ÿå¯ä»¥é€šè¿‡ä¿®æ”¹&lt;code&gt;ndots&lt;/code&gt;çš„æ•°é‡ï¼Œæ¥å‡å°‘åŸŸåæŸ¥è¯¢æ¬¡æ•°çš„é—®é¢˜ï¼Œå¯ä»¥åœ¨Podçš„é…ç½®ä¸­æ·»åŠ &lt;code&gt;dnsConfig&lt;/code&gt;ä¿®æ”¹&lt;code&gt;ndots&lt;/code&gt;çš„å€¼ã€‚å½“å®¹å™¨å†…éƒ¨çš„&lt;code&gt;/etc/resolv.config&lt;/code&gt;éƒ½æ‰¾ä¸åˆ°æ—¶ï¼Œå°±ä¼šä½¿ç”¨å®¿ä¸»æœºçš„&lt;code&gt;/etc/resolv.config&lt;/code&gt;è¿›è¡ŒæŸ¥æ‰¾ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Kubernetes é›†ç¾¤ä¸­æ”¯æŒé€šè¿‡ dnsPolicy å­—æ®µä¸ºæ¯ä¸ª Pod é…ç½®ä¸åŒçš„ DNS ç­–ç•¥ã€‚ç›®å‰æ”¯æŒå››ç§ç­–ç•¥ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ClusterFirstï¼šé€šè¿‡é›†ç¾¤ DNS æœåŠ¡æ¥åšåŸŸåè§£æï¼ŒPod å†… /etc/resolv.conf é…ç½®çš„ DNS æœåŠ¡åœ°å€æ˜¯é›†ç¾¤ DNS æœåŠ¡çš„ CoreDNS åœ°å€ã€‚è¯¥ç­–ç•¥æ˜¯é›†ç¾¤å·¥ä½œè´Ÿè½½çš„é»˜è®¤ç­–ç•¥ï¼›&lt;/li&gt;
&lt;li&gt;Noneï¼šå¿½ç•¥é›†ç¾¤ DNS ç­–ç•¥ï¼Œéœ€è¦æ‚¨æä¾› dnsConfig å­—æ®µæ¥æŒ‡å®š DNS é…ç½®ä¿¡æ¯ï¼›&lt;/li&gt;
&lt;li&gt;Defaultï¼šPod ç›´æ¥ç»§æ‰¿é›†ç¾¤èŠ‚ç‚¹çš„åŸŸåè§£æé…ç½®ã€‚å³åœ¨é›†ç¾¤ç›´æ¥ä½¿ç”¨èŠ‚ç‚¹çš„ /etc/resolv.conf æ–‡ä»¶ï¼›&lt;/li&gt;
&lt;li&gt;ClusterFirstWithHostNetworkï¼šå¼ºåˆ¶åœ¨ hostNetWork ç½‘ç»œæ¨¡å¼ä¸‹ä½¿ç”¨ ClusterFirst ç­–ç•¥ï¼ˆé»˜è®¤ä½¿ç”¨ Default ç­–ç•¥ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;å¦å¤–ï¼ŒKubernatesçš„DNSæœåŠ¡æ”¯æŒServiceçš„Aè®°å½•ã€SRVè®°å½•ï¼ˆç”¨äºé€šç”¨åŒ–åœ°å®šä½æœåŠ¡ï¼‰å’ŒCNAMEè®°å½•ã€‚&lt;/p&gt;
&lt;p&gt;å½“è®¾ç½®äº†serviceå¹¶selectäº†ä¸€ç±»podä¹‹åï¼ŒDNSæœåŠ¡å°±ä¼šäº§ç”Ÿä»¥ä¸‹Aè®°å½•å’ŒSRVè®°å½•&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-ini&#34; data-lang=&#34;ini&#34;&gt;&lt;span class=&#34;na&#34;&gt;{serviceåç§°}.{åç§°ç©ºé—´}.svc.cluster.local. 5 IN A 10.100.71.56&lt;/span&gt;
&lt;span class=&#34;na&#34;&gt;_http._tcp.{serviceåç§°}.{åç§°ç©ºé—´}.svc.cluster.local. 30 IN SRV 10 100 443 {serviceåç§°}.{åç§°ç©ºé—´}.svc.cluster.local.&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;å¦‚æœæ˜¯headless serviceï¼Œåˆ™ç”Ÿæˆçš„Aè®°å½•å¦‚ä¸‹&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-ini&#34; data-lang=&#34;ini&#34;&gt;&lt;span class=&#34;na&#34;&gt;{serviceåç§°}.{åç§°ç©ºé—´}.svc.cluster.local. 5 IN A 192.168.62.111&lt;/span&gt;
&lt;span class=&#34;na&#34;&gt;{serviceåç§°}.{åç§°ç©ºé—´}.svc.cluster.local. 5 IN A 192.168.62.112&lt;/span&gt;
&lt;span class=&#34;na&#34;&gt;{serviceåç§°}.{åç§°ç©ºé—´}.svc.cluster.local. 5 IN A 192.168.62.113&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id=&#34;ingress&#34;&gt;Ingress&lt;/h2&gt;
&lt;p&gt;å·¥ä½œåœ¨ç¬¬ä¸ƒå±‚ï¼Œåº”ç”¨å±‚ï¼Œå³ä¸€èˆ¬ä»£ç†HTTPæµé‡ã€‚&lt;/p&gt;
&lt;p&gt;ä½œç”¨ä¸Serviceç±»ä¼¼ï¼Œä¸»è¦æ˜¯ç”¨äºå¯¹å¤šä¸ªserviceçš„åŒ…è£…ï¼Œä½œä¸ºserviceçš„serviceï¼Œè®¾ç½®ä¸€ä¸ªç»Ÿä¸€çš„è´Ÿè½½å‡è¡¡ï¼ˆè¿™æ ·å¯ä»¥é¿å…æ¯ä¸ªServiceéƒ½è®¾ç½®ä¸€ä¸ªLBï¼Œä¹Ÿå¯ä»¥é¿å…å› ä¸ºèŠ‚ç‚¹æ‰©ç¼©å®¹å¯¼è‡´serviceçš„ç«¯å£å˜åŒ–éœ€è¦ä¿®æ”¹è®¿é—®é…ç½®ï¼‰ï¼Œè®¾ç½®Ingress ruleï¼Œè¿›è¡Œåå‘ä»£ç†ï¼Œå®ç°çš„æ˜¯HTTPè´Ÿè´£å‡è¡¡ã€‚&lt;/p&gt;
&lt;p&gt;Ingressæ˜¯åå‘ä»£ç†çš„è§„åˆ™ï¼ŒIngress Controlleræ˜¯è´Ÿè´£è§£æIngressçš„è§„åˆ™åè¿›è¡Œè½¬å‘ã€‚å¯ä»¥ç†è§£ä¸ºNginxï¼Œæœ¬è´¨æ˜¯å°†è¯·æ±‚é€šè¿‡ä¸åŒçš„è§„åˆ™è¿›è¡Œè·¯ç”±è½¬å‘ã€‚å¸¸è§çš„Ingress Classå®ç°æœ‰Nginx-Ingress-Controllerã€AWS-LB-Ingress-Controllerï¼Œä½¿ç”¨Ingressæ—¶ä¼šåœ¨é›†ç¾¤ä¸­åˆ›å»ºå¯¹åº”çš„controller podã€‚&lt;/p&gt;
&lt;p&gt;Ingress Controllerå¯åŸºäºIngressèµ„æºå®šä¹‰çš„è§„åˆ™å°†å®¢æˆ·ç«¯è¯·æ±‚æµé‡ç›´æ¥è½¬å‘åˆ°Serviceå¯¹åº”çš„åç«¯Podèµ„æºä¸Šï¼ˆæ¯”å¦‚aws-lb-ingress-controller çš„ IP modeï¼‰ï¼Œå…¶ä¼šç»•è¿‡Serviceèµ„æºï¼Œç›´æ¥è½¬å‘åˆ°Podä¸Šï¼Œçœå»äº†kube-proxyå®ç°çš„ç«¯å£ä»£ç†å¼€é”€ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;c&#34;&gt;# ä½¿ç”¨aws albä½œä¸ºingressï¼Œå¹¶å°†æµé‡è½¬å‘istio-ingressgateway service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;extensions/v1beta1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Ingress&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-system&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-api&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-api&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;annotations&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kubernetes.io/ingress.class&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;alb&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;alb.ingress.kubernetes.io/load-balancer-name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;online-api&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;alb.ingress.kubernetes.io/target-type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;instance&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;alb.ingress.kubernetes.io/listen-ports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;[{&amp;#34;HTTPS&amp;#34;:443}, {&amp;#34;HTTP&amp;#34;:80}]&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;alb.ingress.kubernetes.io/certificate-arn&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;xxx&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;alb.ingress.kubernetes.io/scheme&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;internet-facing&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;alb.ingress.kubernetes.io/tags&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;app=eks&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;alb.ingress.kubernetes.io/load-balancer-attributes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;deletion_protection.enabled=true,access_logs.s3.enabled=true,access_logs.s3.bucket=regoo-logs,access_logs.s3.prefix=alb&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;rules&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;paths&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/*&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;backend&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;serviceName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-ingressgateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;servicePort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;80&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/*&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;backend&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;serviceName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-ingressgateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;servicePort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;443&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h3 id=&#34;å’Œistio-ingressgatewayçš„åŒºåˆ«&#34;&gt;å’ŒIstio Ingressgatewayçš„åŒºåˆ«&lt;/h3&gt;
&lt;p&gt;Istio Ingressgatewayæ˜¯Kubernate Ingress Controllerçš„ä¸€ç§å®ç°ï¼Œèƒ½å¤Ÿæ”¯æŒæ›´å¤šæ–¹å¼çš„æµé‡ç®¡ç†ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;/th&gt;
&lt;th&gt;Nginx Ingress Controller&lt;/th&gt;
&lt;th&gt;Istio Ingressgateway&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;æ ¹æ®HTTP Headeré€‰æ‹©è·¯ç”±è§„åˆ™&lt;/td&gt;
&lt;td&gt;ä¸æ”¯æŒ&lt;/td&gt;
&lt;td&gt;æ”¯æŒ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Headerè§„åˆ™æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼&lt;/td&gt;
&lt;td&gt;ä¸æ”¯æŒ&lt;/td&gt;
&lt;td&gt;æ”¯æŒ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æœåŠ¡ä¹‹é—´è®¾ç½®æƒé‡æ‹†åˆ†æµé‡&lt;/td&gt;
&lt;td&gt;ä¸æ”¯æŒ&lt;/td&gt;
&lt;td&gt;æ”¯æŒ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Headerå’Œæƒé‡è§„åˆ™ç»„åˆä½¿ç”¨&lt;/td&gt;
&lt;td&gt;ä¸æ”¯æŒ&lt;/td&gt;
&lt;td&gt;æ”¯æŒ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;è·¯ç”±è§„åˆ™æ£€æŸ¥&lt;/td&gt;
&lt;td&gt;ä¸æ”¯æŒ&lt;/td&gt;
&lt;td&gt;æ”¯æŒ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;è·¯ç”±è§„åˆ™ç²’åº¦&lt;/td&gt;
&lt;td&gt;Service&lt;/td&gt;
&lt;td&gt;Serviceä¸‹çš„ä¸åŒPod&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æ”¯æŒçš„åè®®&lt;/td&gt;
&lt;td&gt;HTTP1.1/HTTP2/gRpc&lt;!-- raw HTML omitted --&gt;TCP/Websockets&lt;/td&gt;
&lt;td&gt;HTTP1.1/HTTP2/gRpc&lt;!-- raw HTML omitted --&gt;TCP/Websockets/MongoDB&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id=&#34;rbac&#34;&gt;RBAC&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Roleå’ŒRoleBindingï¼šåªé’ˆå¯¹æŸä¸€namespaceçš„æ“ä½œæˆæƒï¼Œnamespaceåªæ˜¯é€»è¾‘ä¸Šçš„éš”ç¦»&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä»¥ä¸‹é…ç½®å°±æ˜¯ç»™ç”¨æˆ·åä¸ºexample-userç»‘å®šäº†ä¸€ä¸ªexample-roleçš„è§’è‰²ï¼Œè¯¥è§’è‰²åªèƒ½æ“ä½œnamespaceä¸ºmynamespaceä¸‹çš„podçš„æ‰€æœ‰è¯»æ“ä½œã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;rbac.authorization.k8s.io/v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Role &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;mynamespace &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;example-role &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;rules&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;apiGroups&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;resources&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;pods&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;verbs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;get&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;watch&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;list&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;---&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;rbac.authorization.k8s.io/v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;RoleBinding&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;example-rolebinding &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;mynamespace &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;subjects&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;User &lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# è¿™é‡Œçš„Userï¼Œæ˜¯Kuberneteså†…ç½®çš„ç”¨æˆ·ç±»å‹ï¼Œåªæ˜¯ä¸€ä¸ªæˆæƒçš„é€»è¾‘æ¦‚å¿µ&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;example-user &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiGroup&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;rbac.authorization.k8s.io&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;roleRef&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Role &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;example-role &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiGroup&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;rbac.authorization.k8s.io&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ClusterRoleå’ŒClusterRoleBindingï¼šé’ˆå¯¹çš„æ˜¯æ•´ä¸ªé›†ç¾¤çš„æ“ä½œçš„æˆæƒ&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä»¥ä¸‹é…ç½®å°±æ˜¯ç»™ç”¨æˆ·åä¸ºexample-userç»‘å®šäº†ä¸€ä¸ªexample-roleçš„è§’è‰²ï¼Œè¯¥è§’è‰²èƒ½å¯¹æ•´ä¸ªé›†ç¾¤ä¸‹çš„Podè¿›è¡Œè¯»æ“ä½œã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;rbac.authorization.k8s.io/v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ClusterRole &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;example-clusterrole &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;rules&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;apiGroups&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;resources&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;pods&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;verbs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;get&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;watch&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;list&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;---&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;rbac.authorization.k8s.io/v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ClusterRoleBinding&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;example-clusterrolebinding &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;subjects&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;User &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;example-user &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiGroup&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;rbac.authorization.k8s.io &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;roleRef&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ClusterRole &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;example-clusterrole &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiGroup&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;rbac.authorization.k8s.io&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;verbsæ“ä½œå¯ä»¥æœ‰getã€listã€watchã€createã€updateã€patchã€deleteã€‚&lt;/p&gt;
&lt;p&gt;resourcesæŒ‡çš„æ˜¯configmapsã€podsã€servicesã€deploymentsã€nodesï¼Œå³æ‰€æœ‰å®šä¹‰çš„CRDã€‚&lt;/p&gt;
&lt;p&gt;resourceNamesæŒ‡å®šæ˜¯å¯¹åº”èµ„æºçš„åç§°ã€‚&lt;/p&gt;
&lt;p&gt;subjectsçš„ç±»å‹ä¸æ­¢æœ‰Userï¼Œä¹Ÿå¯ä»¥æ˜¯ServiceAccountï¼Œåˆ›å»ºè¯¥serviceåï¼Œk8sä¼šè‡ªåŠ¨ä¸ºå…¶åˆ†é…ä¸€ä¸ªSecretå¯¹è±¡ï¼Œè¯¥å­—æ®µä¿å­˜ä¸€ä¸ªç”¨æ¥ä¸API Serveräº¤äº’çš„tokenï¼Œtokençš„å†…å®¹å¯ä»¥æ˜¯è¯ä¹¦æˆ–è€…å¯†ç ï¼Œä»¥Secretå¯¹è±¡çš„æ–¹å¼ä¿å­˜åœ¨etcdä¸­ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨Podä¸­ä¹Ÿå¯ä»¥ä½¿ç”¨ServiceAccountï¼Œé€šè¿‡serviceAccountNameå­—æ®µé…ç½®ä½¿ç”¨ï¼Œå¦‚æœPodæ²¡æœ‰æ˜¾å¼ä½¿ç”¨ServiceAccountï¼ŒK8sä¼šä½¿ç”¨é»˜è®¤çš„æ‹¥æœ‰ç»å¤§å¤šæ•°æƒé™çš„default ServiceAccountã€‚åˆ›å»ºå®ŒServiceAccountåï¼Œä¼šåœ¨K8sä¸­äº§ç”Ÿä¸€ä¸ªç”¨æˆ·åå’Œç”¨æˆ·ç»„ï¼Œ&lt;/p&gt;
&lt;p&gt;ç”¨æˆ·åï¼šsystem:serviceaccount:&amp;lt;Namespaceåå­—&amp;gt;:&amp;lt;ServiceAccountåå­—&amp;gt;&lt;/p&gt;
&lt;p&gt;ç”¨æˆ·ç»„ï¼šsystem:serviceaccount:&amp;lt;Namespaceåå­—&amp;gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1 &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ServiceAccount &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;mynamespace &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;example-user&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;åœ¨K8så†…ï¼Œå·²ç»å†…ç½®äº†å¾ˆå¤šç³»ç»Ÿä¿ç•™çš„ClusterRoleï¼Œç»™MasterèŠ‚ç‚¹å†…çš„ç»„ä»¶ä½¿ç”¨ï¼Œä»¥system:å¼€å¤´ï¼›æ­¤å¤–ï¼Œè¿˜æœ‰ä¸€äº›æƒé™ç²’åº¦æ¯”è¾ƒå¤§çš„ClusterRoleï¼Œå¦‚cluster-admin(æ‹¥æœ‰æœ€é«˜æƒé™)ã€adminã€editã€view&lt;/p&gt;
&lt;h2 id=&#34;å£°æ˜å¼api&#34;&gt;å£°æ˜å¼API&lt;/h2&gt;
&lt;p&gt;é€šè¿‡ç¼–æ’å¯¹è±¡ï¼Œåœ¨ä¸ºå®ƒä»¬å®šä¹‰æœåŠ¡çš„è¿™ç§æ–¹æ³•ï¼Œå°±ç§°ä¸ºå£°æ˜å¼APIã€‚&lt;/p&gt;
&lt;p&gt;Podå°±æ˜¯ä¸€ç§APIå¯¹è±¡ï¼Œæ¯ä¸€ä¸ªAPIå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªMetadataå­—æ®µï¼Œè¡¨ç¤ºå…ƒæ•°æ®ï¼Œé€šè¿‡é‡Œé¢çš„labelså­—æ®µï¼ˆé”®å€¼å¯¹ï¼‰æ¥æ‰¾åˆ°è¿™ä¸ªAPIå¯¹è±¡ï¼›æ¯ä¸€ä¸ªAPIå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªSpecå­—æ®µï¼Œæ¥é…ç½®è¿™ä¸ªå¯¹è±¡ç‹¬æœ‰çš„é…ç½®ï¼Œå¦‚ä¸ºPodæ·»åŠ æŒ‚è½½çš„Volumeã€‚&lt;/p&gt;
&lt;p&gt;å‘½ä»¤å¼é…ç½®æ–‡ä»¶æ“ä½œï¼šç¼–å†™ä¸€ä¸ªyamlé…ç½®ï¼Œä½¿ç”¨&lt;code&gt;kubectl create -f config.yaml&lt;/code&gt;åˆ›å»ºcontrollerå’ŒPodï¼Œç„¶åä¿®æ”¹yamlé…ç½®ï¼Œä½¿ç”¨&lt;code&gt;kubectl replace -f config.yaml&lt;/code&gt;ï¼Œæ›´æ–°controllerå’ŒPodï¼ŒAPI-Serverä¸€æ¬¡åªèƒ½å¤„ç†ä¸€ä¸ªå‘½ä»¤ï¼›æˆ–è€…ç›´æ¥ä½¿ç”¨å‘½ä»¤ &lt;code&gt;kubectl set image ... &lt;/code&gt;æˆ– &lt;code&gt;kubectl edit ...&lt;/code&gt; è¿™äº›éƒ½å±äºå‘½ä»¤å¼çš„ã€‚&lt;/p&gt;
&lt;p&gt;å£°æ˜å¼é…ç½®æ–‡ä»¶æ“ä½œï¼šç¼–å†™yamlé…ç½®å’Œæ›´æ–°yamlé…ç½®å‡ä½¿ç”¨&lt;code&gt;kubectl apply -f config.yaml&lt;/code&gt;ï¼ŒAPI-Serverä¸€æ¬¡å¤„ç†å¤šä¸ªå‘½ä»¤ï¼Œå¹¶ä¸”å…·å¤‡mergeèƒ½åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;å‘½ä»¤å¼æ˜¯å‘Šè¯‰API-Serveræˆ‘è¦åšä»€ä¹ˆæ“ä½œï¼Œè€Œå£°æ˜å¼æ˜¯å‘Šè¯‰API-Serveræˆ‘è¦è¾¾åˆ°ä»€ä¹ˆæ ·çš„æ•ˆæœï¼Œå¹‚ç­‰çš„æ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥å£°æ˜å¼APIå¯ä»¥è§£å†³å‘½ä»¤å¼APIå› ä¸ºåå¤é‡è¯•å¯¼è‡´çš„é”™è¯¯ï¼Œæˆ–è€… å¹¶å‘æ‰§è¡Œæ—¶äº§ç”Ÿçš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å·¥ä½œåŸç†&#34;&gt;å·¥ä½œåŸç†&lt;/h3&gt;
&lt;p&gt;k8sæ ¹æ®æˆ‘ä»¬æäº¤çš„yamlæ–‡ä»¶åˆ›å»ºå‡ºä¸€ä¸ªAPIå¯¹è±¡ï¼Œä¸€ä¸ªAPIå¯¹è±¡åœ¨etcdé‡Œçš„å®Œæ•´èµ„æºè·¯å¾„æ˜¯ç”±Groupï¼ˆAPI ç»„ï¼‰ã€Versionï¼ˆAPI ç‰ˆæœ¬ï¼‰å’Œ Resourceï¼ˆAPI èµ„æºç±»å‹ï¼‰ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆçš„ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€ä¸ªèµ„æºå¯ä»¥æœ‰å¤šä¸ªç‰ˆæœ¬ï¼Œç‰ˆæœ¬å’Œèµ„æºçš„ä¿¡æ¯ä¼šå­˜å‚¨åœ¨etcdä¸­ï¼Œä½†&lt;strong&gt;etcdåªä¼šå­˜å‚¨èµ„æºçš„ä¸€ä¸ªæŒ‡å®šç‰ˆæœ¬&lt;/strong&gt;ï¼Œå½“å®¢æˆ·ç«¯ä¼ å…¥çš„yamlæ–‡ä»¶ä¸­æŒ‡å®šçš„èµ„æºç‰ˆæœ¬å’Œå®¢æˆ·ç«¯å‘API-Serverè¯·æ±‚çš„èµ„æºç‰ˆæœ¬å¯èƒ½å¹¶ä¸æ˜¯etcdä¸­å­˜å‚¨çš„ç‰ˆæœ¬æ—¶ï¼Œä¼šè¿›è¡Œç‰ˆæœ¬è½¬æ¢ï¼ˆé€šè¿‡åœ¨èµ„æºä¸­å®šä¹‰ &lt;code&gt;servedï¼šæ§åˆ¶æŸä¸ªç‰ˆæœ¬æ˜¯å¦å¯è¯»å†™ï¼›storageï¼šåˆ¤æ–­æ˜¯å¦æœ‰å¤šä¸ªç‰ˆæœ¬&lt;/code&gt;ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;API-Serverä¼šç»´æŠ¤ä¸€ä¸ªinternalç‰ˆæœ¬ï¼Œå½“éœ€è¦ç‰ˆæœ¬è½¬æ¢æ—¶ï¼Œä»»æ„ç‰ˆæœ¬éƒ½ä¼šå…ˆè½¬æ¢ä¸ºinternalç‰ˆæœ¬ï¼Œå†ç”±internalç‰ˆæœ¬è½¬æ¢ä¸ºæŒ‡å®šçš„ç›®æ ‡ç‰ˆæœ¬ï¼Œæ‰€ä»¥åªè¦ä¿è¯æ¯ä¸ªç‰ˆæœ¬éƒ½èƒ½è½¬æ¢æˆinternalç‰ˆæœ¬ï¼Œå³å¯æ”¯æŒä»»æ„ç‰ˆæœ¬é—´çš„è½¬æ¢äº†ï¼Œå¯¹åº”çš„CRDä»£ç ä¹Ÿè¦æ”¯æŒæ–°è€ç‰ˆæœ¬çš„åˆ‡æ¢ã€‚éœ€è¦ç¼–å†™conversion webhookï¼Œè¿™æ ·è¯·æ±‚åœ¨åˆ°è¾¾controlleræ—¶ï¼Œå°±ä¼šç»è¿‡webhookè¿›è¡Œè½¬æ¢ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/API%e5%af%b9%e8%b1%a1%e6%a0%91%e5%bd%a2%e7%bb%93%e6%9e%84.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/API%e5%af%b9%e8%b1%a1%e6%a0%91%e5%bd%a2%e7%bb%93%e6%9e%84.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;Gï¼šgroupã€Vï¼šversionã€Rï¼šresourceã€Kï¼škind&lt;/p&gt;
&lt;p&gt;åˆ†ä¸ºæœ‰ç»„åï¼Œæ¯”å¦‚&lt;code&gt;/apis/app/v1/deployment&lt;/code&gt; å’Œ æ— ç»„åï¼Œæ¯”å¦‚&lt;code&gt;/api/v1/pods&lt;/code&gt;ï¼Œæ— ç»„åä¹Ÿè¢«ç§°ä¸ºæ ¸å¿ƒèµ„æºç»„ï¼ŒCoreGroupã€‚&lt;/p&gt;
&lt;p&gt;æ¥å£è°ƒç”¨æ—¶ï¼Œåªéœ€è¦çŸ¥é“GVRå³å¯ï¼Œé€šè¿‡GVRæ“ä½œèµ„æºå¯¹è±¡ã€‚é€šè¿‡GVKä¿¡æ¯è·å–è¦è¯»å–çš„èµ„æºå¯¹è±¡çš„GVRï¼Œè¿›è€Œæ„å»ºRESTful APIè¯·æ±‚è·å–å¯¹åº”çš„èµ„æºï¼Œé€šè¿‡GVKå’ŒGVRçš„æ˜ å°„å«åšRESTMapperï¼Œå…¶ä½œç”¨æ˜¯åœ¨ListerWatcheræ—¶ï¼Œæ ¹æ®Schemaå®šä¹‰çš„ç±»å‹GVKè§£æå‡ºGVRï¼Œå‘API-Serverå‘èµ·HTTPè¯·æ±‚è·å–èµ„æºï¼Œç„¶åWatchã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;batch/v2alpha1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;CronJob&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ä»¥ä¸Šé¢çš„é…ç½®ä¸ºä¾‹ï¼ŒCronJobæ˜¯APIå¯¹è±¡çš„èµ„æºç±»å‹ã€batchæ˜¯ç»„ã€v2alpha1æ˜¯ç‰ˆæœ¬&lt;/p&gt;
&lt;p&gt;æ ¸å¿ƒAPIå¯¹è±¡å¦‚Podã€Nodeæ˜¯æ²¡æœ‰Groupçš„ï¼Œk8sæ˜¯ç›´æ¥åœ¨/apiè¿™ä¸ªå±‚çº§è¿›è¡Œä¸‹ä¸€æ­¥çš„åŒ¹é…&lt;/p&gt;
&lt;p&gt;è¿‡ç¨‹æ­¥éª¤ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;yamlæ–‡ä»¶è¢«æäº¤ç»™API-Serverï¼ŒAPI-Serveræ¥æ”¶åˆ°åå®Œæˆå‰ç½®å·¥ä½œï¼Œå¦‚æˆæƒã€è¶…æ—¶å¤„ç†ã€å®¡è®¡ï¼›&lt;/li&gt;
&lt;li&gt;è¿›å…¥MUXå’ŒRoutesæµç¨‹ï¼ŒAPI-Serveræ ¹æ®yamlæä¾›çš„ä¿¡æ¯ï¼Œä½¿ç”¨ä¸Šè¿°çš„åŒ¹é…è¿‡ç¨‹ï¼Œæ‰¾åˆ°CronJobçš„ç±»å‹å®šä¹‰ï¼›&lt;/li&gt;
&lt;li&gt;API-Serveræ ¹æ®è¿™ä¸ªç±»å‹å®šä¹‰ï¼Œæ ¹æ®yamlé‡ŒCronJobçš„ç›¸å…³å­—æ®µï¼Œåˆ›å»ºä¸€ä¸ªCronJobå¯¹è±¡ï¼ŒåŒæ—¶ä¹Ÿä¼šåˆ›å»ºä¸€ä¸ªSuperVersionå¯¹è±¡ï¼Œå®ƒæ˜¯APIèµ„æºç±»å‹æ‰€æœ‰ç‰ˆæœ¬çš„å­—æ®µå…¨é›†ï¼Œç”¨äºå¤„ç†ä¸åŒç‰ˆæœ¬çš„yamlè½¬æˆçš„CronJobå¯¹è±¡ï¼›&lt;/li&gt;
&lt;li&gt;API-Server ä¼šå…ˆåè¿›è¡Œ Admission() å’Œ Validation() æ“ä½œï¼Œè¿›è¡Œåˆå§‹åŒ–å’Œæ ¡éªŒå­—æ®µåˆæ³•æ€§ï¼ŒéªŒè¯è¿‡åä¿å­˜åœ¨Registryçš„æ•°æ®ç»“æ„ä¸­ï¼›&lt;/li&gt;
&lt;li&gt;API-ServeræŠŠéªŒè¯è¿‡çš„APIå¯¹è±¡è½¬æ¢æˆç”¨æˆ·æœ€åˆæäº¤çš„ç‰ˆæœ¬ï¼Œè¿›è¡Œåºåˆ—åŒ–æ“ä½œï¼Œä¿å­˜åœ¨etcdä¸­ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;é…ç½®ç›¸å…³&#34;&gt;é…ç½®ç›¸å…³&lt;/h2&gt;
&lt;h3 id=&#34;podçº§åˆ«ä¸‹çš„ä¸€äº›é…ç½®å³å½“kind-pod&#34;&gt;Podçº§åˆ«ä¸‹çš„ä¸€äº›é…ç½®ï¼Œå³å½“kind: Pod&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;NodeSelector&lt;/strong&gt;ï¼šå°†Podå’ŒNodeè¿›è¡Œç»‘å®šçš„å­—æ®µ&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Pod&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;nodeSelector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;disktype&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ssd&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;è¡¨ç¤ºè¯¥Podåªèƒ½è¿è¡Œåœ¨æºå¸¦äº†disktype:ssdæ ‡ç­¾çš„èŠ‚ç‚¹ä¸Šï¼Œå¦åˆ™å®ƒå°†è°ƒåº¦å¤±è´¥&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;HostAliases&lt;/strong&gt;ï¼šå®šä¹‰äº†Podçš„hostsæ–‡ä»¶ï¼ˆæ¯”å¦‚/etc/hostsï¼‰é‡Œçš„å†…å®¹&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hostAliases&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;10.1.2.3&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hostnames&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;foo.remote&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;bar.remote&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;è¡¨ç¤ºåœ¨/etc/hostsæ–‡ä»¶çš„å†…å®¹æ˜¯å°† ip 10.1.2.3æ˜ å°„ä¸º foo.remoteå’Œbar.remote&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;shareProcessNamespace&lt;/strong&gt;: trueï¼ŒPodé‡Œé¢çš„å®¹å™¨å…±äº«PID namespaceï¼Œå³åœ¨åŒä¸€ä¸ªPodé‡Œçš„å®¹å™¨å¯ä»¥ç›¸äº’çœ‹åˆ°å¯¹æ–¹&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;hostNetwork&lt;/strong&gt;: trueã€hostIPC: trueã€hostPID: trueè¡¨ç¤ºå…±äº«å®¿ä¸»æœºçš„networkã€IPCã€namespace&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ImagePullPolicy&lt;/strong&gt;=alaways(é»˜è®¤)ã€neverã€ifNotPresentï¼Œæ¯æ¬¡åˆ›å»ºPodéƒ½ä¼š${value}æ‹‰å–é•œåƒ&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Lifecycle&lt;/strong&gt;: å®¹å™¨çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶è§¦å‘çš„ä¸€ç³»åˆ—é’©å­ï¼Œå±äºcontainerçº§åˆ«&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Pod&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;lifecycle-demo&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;containers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;lifecycle-demo-container&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;image&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;nginx&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;lifecycle&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;postStart&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;exec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;command&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;/bin/sh&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;-c&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;echo Hello from the postStart handler &amp;gt; /usr/share/message&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;preStop&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;exec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;command&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;/usr/sbin/nginx&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;-s&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;quit&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;åœ¨lifecycleé‡Œçš„postStartï¼ŒæŒ‡çš„æ˜¯å®¹å™¨å¯åŠ¨åï¼Œè¦æ‰§è¡Œçš„æ“ä½œï¼Œä½†æ˜¯å®ƒä¸æ˜¯ä¸²è¡Œçš„ï¼Œå³åœ¨dockerçš„ENTRYPOINTå‘½ä»¤æ‰§è¡Œåå°±å¼€å§‹æ‰§è¡Œäº†ï¼Œæ­¤æ—¶ENTRYPOINTå‘½ä»¤æ‰§è¡Œçš„åŠ¨ä½œå¯èƒ½è¿˜æ²¡å®Œæˆï¼›preStartï¼ŒæŒ‡çš„æ˜¯åœ¨å®¹å™¨è¢«æ€æ­»ä¹‹å‰ï¼Œè¦æ‰§è¡Œçš„æ“ä½œï¼Œåªæœ‰è¿™ä¸ªåŠ¨ä½œæ‰§è¡Œå®Œæˆï¼Œæ‰å…è®¸å®¹å™¨è¢«æ€æ­»&lt;/p&gt;
&lt;h2 id=&#34;å¸¸ç”¨å‘½ä»¤&#34;&gt;å¸¸ç”¨å‘½ä»¤&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;48
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;49
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;50
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;51
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;52
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;53
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;54
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;55
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;56
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;57
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;58
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;59
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;60
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;61
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;62
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;63
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;64
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;65
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;l&#34;&gt;å¯¹äºå¤„äºterminatingçš„podæˆ–namespaceçš„åˆ é™¤æ–¹æ³•&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;. å°†å¯¹åº”çš„podæˆ–namespaceè½¬æˆjsonå½¢å¼ï¼Œå°†å±æ€§finalizersæ”¹ä¸º[]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;kubectl get [podæˆ–namespace] [å¯¹åº”çš„åç§°]  -o json |jq &amp;#39;.spec = {&amp;#34;finalizers&amp;#34;:[]}&amp;#39; &amp;gt; jsonæ–‡ä»¶å.json&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;2.&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;æ‰“å¼€å¦ä¸€ä¸ªçª—å£ï¼Œèµ·ä¸€ä¸ªä»£ç†&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;kubectl proxy --port=8081&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;3.&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;è®¿é—®kubeletæ¥å£è¿›è¡Œåˆ é™¤&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;curl -k -H &amp;#34;Content-Type: application/json&amp;#34; -X PUT --data-binary @jsonæ–‡ä»¶.json 127.0.0.1:8081/api/v1/[podæˆ–namespaces]/[å¯¹åº”çš„åç§°]/finalize&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;æˆ–è€…ï¼š&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;åˆ é™¤çŠ¶æ€ä¸ºTerminatingçš„å‘½åç©ºé—´&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;kubectl get ns [å‘½åç©ºé—´çš„å€¼] -o json &amp;gt; xxxx.jsonï¼Œä¿®æ”¹finializeä¸ºç©ºæ•°ç»„[]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;kubectl replace --raw &amp;#34;/api/v1/namespaces/[å‘½åç©ºé—´çš„å€¼]/finalize&amp;#34; -f xxx.json&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;åˆ é™¤æŒ‡å®šå‘½åç©ºé—´ä¸‹æ‰€æœ‰èµ„æºä¾‹å¦‚podã€deploymentã€svcï¼ŒåŒ…æ‹¬é‡Œé¢æ‰€æœ‰å‰¯æœ¬&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;kubectl delete all -n [å‘½åç©ºé—´] --all&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;åˆ é™¤å‘½åç©ºé—´ä¸‹çš„event&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;kubectl delete events -n [å‘½åç©ºé—´] --all&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;å¯åŠ¨busyboxè°ƒè¯•ç½‘ç»œ&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;kubectl run -it --rm --restart=Never busybox --image=busybox sh&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;æŸ¥çœ‹nodeæ ‡ç­¾&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;kubectl get nodes --show-labels&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ç»™nodeè®¾ç½®æ ‡ç­¾&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;kubectl label nodes &amp;lt;your-node-name&amp;gt; disktype=ssd&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;åˆ é™¤èŠ‚ç‚¹&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;. å…ˆæ’å¹²ä¸Šé¢çš„pod&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;kubectl drain nodeåç§° --delete-local-data --force --ignore-daemonsets&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;. åˆ é™¤&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;kubectl delete node nodeåç§° &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;æŸ¥çœ‹æ»šåŠ¨æ›´æ–°çš„æµç¨‹&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;kubectl describe deploy [deployåç§°] -n [åç§°ç©ºé—´]æˆ–è€…kubectl rollout status deploy [deployåç§°] -n [åç§°ç©ºé—´]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;å½“æ–°çš„ç‰ˆæœ¬æœ‰é—®é¢˜æ—¶ï¼Œå›æ»šåˆ°ä¸Šä¸ªç‰ˆæœ¬&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;kubectl rollout undo deploy [deployåç§°] [--to-revision=n]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;æŸ¥çœ‹æ¯æ¬¡å˜æ›´çš„ç‰ˆæœ¬ï¼Œä½†æœ€å¥½åœ¨æ‰§è¡Œapply -f deployment.yamlååŠ ä¸Š-recordå‚æ•°ï¼›&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;kubectl rollout history&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;å¦‚æœä¸æƒ³æ¯æ¬¡ä¿®æ”¹éƒ½è§¦å‘æ»šåŠ¨æ›´æ–°ï¼Œå¯ä»¥å…ˆä½¿ç”¨`kubectl rollout pause deploy xx -n yy`æš‚åœDdeploymentçš„è¡Œä¸ºï¼Œä¿®æ”¹ä¸ºyamlåä½¿ç”¨`kubectl rollout resume deploy xx -n yy`æ¢å¤ï¼Œè®©å…¶åªè§¦å‘ä¸€æ¬¡ä¿®æ”¹ã€‚&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;å°†é•œåƒæ‰“æˆå‹ç¼©åŒ…&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;docker save -o å‹ç¼©åŒ…åå­—  é•œåƒåå­—:æ ‡ç­¾&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;è¿˜åŸæˆé•œåƒ&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;docker load &amp;lt; å‹ç¼©åŒ…åå­—&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ç›´æ¥ä½¿ç”¨å‘½ä»¤ï¼Œä¸ä¿æŒå®¹å™¨å¯åŠ¨&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;docker run --rm --name kubectl bitnami/kubectl:latest version&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;å¯åŠ¨æ—¶ä¿®æ”¹entrypoint&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;docker run --rm -it --entrypoint env é•œåƒ:tag /bin/bash&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;æ„å»ºé•œåƒ&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;docker build -t xxx:tag .&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ä»å®¹å™¨é‡Œå¤åˆ¶æ–‡ä»¶å‡ºæ¥&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;docker cp å®¹å™¨id:/å®¹å™¨å†…æ–‡ä»¶è·¯å¾„/æ–‡ä»¶å /å®¿ä¸»æœºè·¯å¾„/æ–‡ä»¶å&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;æ»šåŠ¨æ›´æ–°&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;kubectl patch deployment $APP-stable -n $NAMESPACE --patch &amp;#39;{&amp;#34;spec&amp;#34;: {&amp;#34;template&amp;#34;: {&amp;#34;metadata&amp;#34;: {&amp;#34;labels&amp;#34;:{&amp;#34;cm&amp;#34;:&amp;#34;stable&amp;#34;},&amp;#34;annotations&amp;#34;: {&amp;#34;version/config&amp;#34;: &amp;#34;&amp;#39;$DATE&amp;#39;&amp;#34; }}}}}&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;å¤åˆ¶podé‡Œçš„æ–‡ä»¶åˆ°å½“å‰æœºå™¨&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;kubectl cp [podåå­—]:[work_dir]/æ–‡ä»¶å -n [åç§°ç©ºé—´] -c [å®¹å™¨åç§°] ./å¤åˆ¶åçš„æ–‡ä»¶å&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h1 id=&#34;servicemersh&#34;&gt;ServiceMersh&lt;/h1&gt;
&lt;h2 id=&#34;åŸºæœ¬-1&#34;&gt;åŸºæœ¬&lt;/h2&gt;
&lt;p&gt;Service Meshæœ¬è´¨ä¸Šæ˜¯åˆ†å¸ƒå¼çš„å¾®æœåŠ¡&lt;strong&gt;ç½‘ç»œæ§åˆ¶çš„ä»£ç†&lt;/strong&gt;ï¼Œä»¥side carçš„æ–¹å¼å®ç°ï¼šé€šè¿‡envoy+iptableå¯¹æµé‡è¿›è¡ŒåŠ«æŒï¼Œé€šè¿‡å¯¹æµé‡çš„æ§åˆ¶ï¼Œå®ç°è¯¸å¦‚æ³¨å†Œä¸­å¿ƒã€è´Ÿè½½å‡è¡¡å™¨ã€è·¯ç”±ç­–ç•¥ã€ç†”æ–­é™çº§ã€é™æµã€æœåŠ¡è¿½è¸ªç­‰åŠŸèƒ½ï¼Œè€Œä¸éœ€è¦è€¦åˆåœ¨å…·ä½“çš„ä¸šåŠ¡æœåŠ¡ä¸­ï¼Œè€ŒIstioæ˜¯å…¶ä¸­ä¸€ç§å®ç°ã€‚&lt;/p&gt;
&lt;p&gt;ä¼˜ç‚¹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä¸šåŠ¡æ— éœ€æ„ŸçŸ¥å¾®æœåŠ¡ç»„ä»¶ï¼Œè¯¸å¦‚é™æµã€ç†”æ–­ã€å®¹é”™ã€é™çº§ã€è´Ÿè½½å‡è¡¡ç­‰æœåŠ¡æ²»ç†ç›¸å…³çš„ä¸­é—´ä»¶ï¼Œè¿™äº›åŠŸèƒ½å…¨ç”±ServiceMershæä¾›&lt;/li&gt;
&lt;li&gt;ä¸é™åˆ¶å¼€å‘è¯­è¨€å’Œæ¡†æ¶ï¼Œæä¾›å¤šè¯­è¨€æœåŠ¡æ²»ç†èƒ½åŠ›&lt;/li&gt;
&lt;li&gt;æœåŠ¡é›¶æˆæœ¬å‡çº§ï¼Œå¯¹æœåŠ¡æ— ä¾µå…¥ï¼Œä¸ä¼šäº§ç”ŸSDKä¾èµ–&lt;/li&gt;
&lt;li&gt;ä½¿å¾—å¾®æœåŠ¡ä½“ç³»ç»Ÿä¸€ç®¡ç†å’Œæ¼”è¿›&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ç¼ºç‚¹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;éƒ¨ç½²å¤æ‚ï¼Œæ¯”å¦‚è·¨é›†ç¾¤ã€è·¨æœºæˆ¿ç­‰ä¸€äº›å¤æ‚ç¯å¢ƒè¦†ç›–ä¸æ˜“&lt;/li&gt;
&lt;li&gt;æ¯æ¬¡ç½‘ç»œè¯·æ±‚ä¼šå¤šä¸€è·³ï¼Œå¸¦æ¥ä¸€å®šçš„èµ„æºæ¶ˆè€—å’Œå»¶æ—¶&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;åœ¨æ²¡æœ‰Service Meshçš„æƒ…å†µä¸‹ï¼ŒKubernetesä»…ä¾é kube-proxy + iptable + service + ingressæ¥å®ç°å¯¹æµé‡çš„ç®¡ç†ï¼Œç®¡ç†çš„æ˜¯è¿›å‡ºé›†ç¾¤çš„æµé‡ï¼Œè€ŒService Mershé€šè¿‡iptables + sidecarçš„æ–¹å¼æ§åˆ¶çš„æ˜¯è¿›å‡ºpodçš„æµé‡ï¼Œæ§åˆ¶çš„ç²’åº¦ä¼šæ›´ç»†ã€‚&lt;/p&gt;
&lt;p&gt;kube-proxyçš„è®¾ç½®æ˜¯å…¨å±€çš„ï¼Œå¦‚æœè½¬å‘çš„podä¸èƒ½æ­£å¸¸æœåŠ¡ï¼Œå®ƒä¸ä¼šè‡ªåŠ¨å°è¯•å…¶ä»–podï¼›å¦å¤–ï¼Œkube-proxyå®ç°çš„æ˜¯é›†ç¾¤å†…å¤šä¸ªpodå®ä¾‹ä¹‹é—´çš„æµé‡è´Ÿè½½å‡è¡¡ï¼Œä½†æ— æ³•å¯¹æœåŠ¡ä¹‹é—´æµé‡çš„ç²¾ç»†åŒ–æ§åˆ¶ï¼Œæ¯”å¦‚ç°åº¦å‘å¸ƒã€è“ç»¿å‘å¸ƒç­‰ã€‚&lt;/p&gt;
&lt;h1 id=&#34;istio&#34;&gt;Istio&lt;/h1&gt;
&lt;p&gt;upstreamå’Œdownstreamæ˜¯é’ˆå¯¹Envoyè€Œè¨€çš„ï¼Œ&lt;/p&gt;
&lt;p&gt;upstreamï¼šEnvoyå‘é€è¯·æ±‚ç»™æœåŠ¡ï¼Œå‘å‡ºçš„æµé‡æ˜¯upstream&lt;/p&gt;
&lt;p&gt;downstreamï¼šå‘é€è¯·æ±‚ç»™Envoyï¼ŒEnvoyæ¥æ”¶çš„æµé‡æ˜¯downstream&lt;/p&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/envoy%e6%b5%81%e9%87%8f%e6%a8%a1%e5%9e%8b.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/envoy%e6%b5%81%e9%87%8f%e6%a8%a1%e5%9e%8b.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;xDSï¼šæ§åˆ¶å¹³é¢ä¸æ•°æ®å¹³é¢é€šä¿¡çš„ç»Ÿä¸€APIæ ‡å‡†ï¼ŒåŒ…æ‹¬ LDSï¼ˆç›‘å¬å™¨å‘ç°æœåŠ¡ï¼‰ã€CDSï¼ˆé›†ç¾¤å‘ç°æœåŠ¡ï¼‰ã€EDSï¼ˆèŠ‚ç‚¹å‘ç°æœåŠ¡ï¼‰ã€SDSï¼ˆå¯†é’¥å‘ç°æœåŠ¡ï¼‰å’Œ RDSï¼ˆè·¯ç”±å‘ç°æœåŠ¡ï¼‰&lt;/p&gt;
&lt;p&gt;Istioæ ¸å¿ƒåŠŸèƒ½ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æµé‡æ§åˆ¶ï¼šè·¯ç”±ï¼ˆå¦‚ç°åº¦å‘å¸ƒã€è“ç»¿éƒ¨ç½²ã€ABæµ‹è¯•ï¼‰ã€æµé‡è½¬ç§»ã€å¼¹æ€§ï¼ˆå¦‚è¶…æ—¶é‡è¯•ã€ç†”æ–­ï¼‰æµ‹è¯•ï¼ˆå¦‚æ•…éšœæ³¨å…¥ã€æµé‡é•œåƒï¼Œæ¨¡æ‹Ÿç”Ÿäº§ç¯å¢ƒçš„æµé‡è¿›è¡Œæµ‹è¯•ï¼‰&lt;/li&gt;
&lt;li&gt;å®‰å…¨ï¼šè®¤è¯ã€æˆæƒ&lt;/li&gt;
&lt;li&gt;å¯è§‚å¯Ÿï¼šæŒ‡æ ‡ã€æ—¥å¿—ã€è¿½è¸ª&lt;/li&gt;
&lt;li&gt;ç­–ç•¥ï¼šé™æµã€é»‘ç™½åå•&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Istioåˆ†ä¸ºæ§åˆ¶å¹³é¢control planeå’Œæ•°æ®å¹³é¢data planeï¼Œæ§åˆ¶é¢ä¸»è¦è´Ÿè´£èµ„æºç®¡ç†ã€é…ç½®ä¸‹å‘ã€è¯ä¹¦ç®¡ç†ã€æ§åˆ¶æ•°æ®é¢çš„è¡Œä¸ºç­‰ï¼Œæ•°æ®é¢åˆ™è´Ÿè´£æµé‡å‡ºå…¥å£ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ§åˆ¶å¹³é¢&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;åœ¨ä½ç‰ˆæœ¬ä¸­åˆ†ä¸ºPilotã€Mixerã€Citadelï¼›&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Pilotè´Ÿè´£é…ç½®ä¸‹å‘ï¼Œå°†é…ç½®æ–‡ä»¶è½¬åŒ–ä¸ºIstioå¯è¯†åˆ«çš„é…ç½®é¡¹ï¼Œåˆ†å‘ç»™å„ä¸ªsidecarä»£ç†(piloy-agent)ï¼›Pilotèƒ½ä¸ºsidecaræä¾›æœåŠ¡å‘ç°ã€æ™ºèƒ½è·¯ç”±ã€æµé‡ç®¡ç†ã€è¶…æ—¶ã€é‡è¯•ã€ç†”æ–­ç¯åŠŸèƒ½ï¼ŒåŸç†æ˜¯å°†è¿™äº›åŠŸèƒ½è½¬åŒ–ä¸ºè·¯ç”±è§„åˆ™é…ç½®ï¼Œä¸‹å‘åˆ°å„ä¸ªsidecarä¸­ï¼›&lt;/p&gt;
&lt;p&gt;pilotæœ‰ä¸¤ä¸ªå­ç»„ä»¶ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;pilot-discoveryï¼šæ˜¯æ§åˆ¶é¢ä¸æ•°æ®é¢çš„æ¡¥æ¢ï¼Œä»kubernetesä¸­è·å–æœåŠ¡ä¿¡æ¯ï¼Œå¦‚serviceã€endpointã€podã€nodeçš„èµ„æºä¿¡æ¯ï¼›ç›‘æ§istioæ§åˆ¶é¢çš„ä¿¡æ¯ï¼Œå¦‚vsã€gwã€drç­‰ï¼Œå°†æœåŠ¡ä¿¡æ¯å’Œæµé‡è§„åˆ™ä¿¡æ¯è½¬åŒ–ä¸ºæ•°æ®é¢å¯ä»¥ç†è§£çš„æ ¼å¼ï¼Œé€šè¿‡xDSä¸‹å‘åˆ°å„ä¸ªsidecarä¸­ï¼›&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;pilot-agentï¼šæ ¹æ®API-Serverä¸­é…ç½®çš„ä¿¡æ¯ç”Ÿæˆsidecaré…ç½®æ–‡ä»¶ï¼Œè´Ÿè´£å¯åŠ¨ã€ç›‘æ§sidecarè¿›ç¨‹ï¼Œæ˜¯istio-proxyçš„ä¸€éƒ¨åˆ†ï¼Œæ³¨å…¥åˆ°podä¸­ï¼›&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;pilot-proxyï¼šå³podä¸­çš„istio-proxyï¼Œè´Ÿè´£æµé‡ä»£ç†ï¼Œç›´æ¥è¿æ¥pilot-discoveryï¼Œé—´æ¥è·å–é›†ç¾¤ä¸­å„ä¸ªå¾®æœåŠ¡çš„æ³¨å†Œæƒ…å†µï¼›istio-proxyå‘èµ·çš„è¿æ¥éƒ½æ˜¯é•¿è¿æ¥ï¼Œä¸å—ä¸šåŠ¡æœåŠ¡çš„å½±å“ï¼Œé€šè¿‡è¿æ¥æ± ç»´æŠ¤ï¼›&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Citadelè´Ÿè´£å®‰å…¨ã€æˆæƒè®¤è¯ï¼Œæ¯”å¦‚è¯ä¹¦çš„åˆ†å‘å’Œè½®æ¢ï¼Œè®©sidecarä»£ç†ä¸¤ç«¯å®ç°åŒå‘TLSè®¤è¯ã€è®¿é—®æˆæƒï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Galleryè´Ÿè´£é…ç½®ç®¡ç†ï¼Œè´Ÿè´£å°†istioç»„ä»¶ä¸åº•å±‚å¹³å°å¦‚Kubernetesè·å–ç”¨æˆ·é…ç½®çš„ç»†èŠ‚éš”ç¦»å¼€ï¼Œå¯¹é…ç½®ä¿¡æ¯æ ¼å¼å’Œæ­£ç¡®æ€§æ ¡éªŒï¼Œå°†é…ç½®ä¿¡æ¯æä¾›pilotä½¿ç”¨ï¼Œåªä¸æ§åˆ¶é¢çš„å…¶ä»–ç»„ä»¶æ‰“äº¤é“ï¼Œå®ç°ä¸åº•å±‚å¹³å°è§£è€¦ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;sidecar injectorï¼šåœ¨ä¸ºé…ç½®äº†istioè‡ªåŠ¨æ³¨å…¥çš„podè‡ªåŠ¨æ³¨å…¥istio-proxyï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Mixerè´Ÿè´£ä»æ•°æ®å¹³é¢æ”¶é›†æ•°æ®æŒ‡æ ‡ä»¥åŠæµé‡ç­–ç•¥ï¼Œæ˜¯ä¸€ç§æ’ä»¶ç»„ä»¶ï¼Œæ’ä»¶æä¾›äº†å¾ˆå¥½çš„æ‰©å±•æ€§ï¼Œç‹¬ç«‹éƒ¨ç½²ï¼Œä½†æ¯æ¬¡ä¿®æ”¹éœ€è¦é‡æ–°éƒ¨ç½²ï¼Œä¹‹å1.1ç‰ˆæœ¬å°†æ’ä»¶æ¨¡å—ç‹¬ç«‹ä¸€ä¸ªadaptorå’ŒGalleryï¼Œä½†æ˜¯Mixerç”±äºéœ€è¦é¢‘ç¹çš„ä¸sidecarè¿›è¡Œé€šä¿¡ï¼Œåˆæ˜¯éƒ¨ç½²åœ¨åº”ç”¨è¿›ç¨‹å¤–çš„ï¼Œå› æ­¤æ€§èƒ½ä¸é«˜ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é«˜ç‰ˆæœ¬1.5åä¸­åˆ†ä¸ºå°†Pilotã€Citadelã€Galleryæ•´åˆä¸ºistiodï¼ŒåŒæ—¶istiodé‡Œä¹ŸåŒ…å«äº†CAã€API-Serverï¼Œé…åˆingressgatewayã€egressgatewayç®¡ç†æµé‡ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ•°æ®å¹³é¢&lt;/strong&gt;ï¼šPodä¸­çš„æ¯ä¸ªEnvoyå®¹å™¨ï¼Œå³istio-proxyï¼›Envoyä¼šä»¥side carçš„æ–¹å¼è¿è¡Œåœ¨Podä¸­ï¼Œåˆ©ç”¨Podä¸­çš„æ‰€æœ‰å®¹å™¨å…±äº«åŒä¸€ä¸ªNetwork Namespaceçš„ç‰¹æ€§ï¼Œé€šè¿‡é…ç½®Podé‡Œçš„iptablesè§„åˆ™ï¼Œç®¡ç†è¿›å‡ºPodçš„æµé‡ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/Istio-%e6%9e%b6%e6%9e%84.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/Istio-%e6%9e%b6%e6%9e%84.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;istio-proxyçš„ä½œç”¨ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å®¢æˆ·ç«¯åŠŸèƒ½ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å‘ç°å’Œè´Ÿè½½å¹³è¡¡ã€‚ä»£ç†å¯ä»¥ä½¿ç”¨å‡ ä¸ªæ ‡å‡†çš„æœåŠ¡å‘ç°å’Œè´Ÿè½½å¹³è¡¡APIï¼Œä»¥æœ‰æ•ˆåœ°å°†æµé‡åˆ†é…ç»™æœåŠ¡ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å‡­è¯æ³¨å…¥ã€‚ä»£ç†å¯ä»¥é€šè¿‡è¿æ¥éš§é“æˆ–ç‰¹å®šäºåè®®çš„æœºåˆ¶ï¼ˆä¾‹å¦‚HTTPè¯·æ±‚çš„JWTä»¤ç‰Œï¼‰æ³¨å…¥å®¢æˆ·ç«¯èº«ä»½ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è¿æ¥ç®¡ç†ã€‚ä»£ç†ç®¡ç†ä¸æœåŠ¡çš„è¿æ¥ï¼Œå¤„ç†è¿è¡ŒçŠ¶å†µæ£€æŸ¥ï¼Œé‡è¯•ï¼Œæ•…éšœè½¬ç§»å’Œæµæ§åˆ¶ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç›‘æ§å’Œè®°å½•ã€‚ä»£ç†å¯ä»¥æŠ¥å‘Šå®¢æˆ·ç«¯æŒ‡æ ‡å¹¶è®°å½•åˆ°æ··åˆå™¨ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æœåŠ¡å™¨ç«¯åŠŸèƒ½ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é€Ÿç‡é™åˆ¶å’Œæµé‡æ§åˆ¶ã€‚ä»£ç†å¯ä»¥é˜²æ­¢åç«¯ç³»ç»Ÿè¿‡è½½ï¼Œå¹¶æä¾›å®¢æˆ·ç«¯æ„ŸçŸ¥çš„é€Ÿç‡é™åˆ¶ã€‚&lt;/li&gt;
&lt;li&gt;åè®®ç¿»è¯‘ã€‚ä»£ç†æ˜¯gRPCç½‘å…³ï¼Œæä¾›JSON-RESTå’ŒgRPCä¹‹é—´çš„è½¬æ¢ã€‚&lt;/li&gt;
&lt;li&gt;è®¤è¯ä¸æˆæƒã€‚ä»£ç†æ”¯æŒå¤šç§èº«ä»½éªŒè¯æœºåˆ¶ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨å®¢æˆ·ç«¯èº«ä»½é€šè¿‡æ··åˆå™¨æ‰§è¡Œæˆæƒæ£€æŸ¥ã€‚&lt;/li&gt;
&lt;li&gt;ç›‘æ§å’Œè®°å½•ã€‚ä»£ç†å¯ä»¥æŠ¥å‘ŠæœåŠ¡å™¨ç«¯æŒ‡æ ‡å¹¶è®°å½•åˆ°æ··åˆå™¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;è‡ªåŠ¨æ³¨å…¥å®ç°&#34;&gt;è‡ªåŠ¨æ³¨å…¥å®ç°&lt;/h2&gt;
&lt;p&gt;ä¾èµ–Kubernetesä¸­çš„Dynamic Admission Controlçš„åŠŸèƒ½ï¼Œä¹Ÿå«Initializerã€‚&lt;/p&gt;
&lt;p&gt;Istioä¼šå°†Envoyå®¹å™¨æœ¬èº«çš„å®šä¹‰ï¼Œä»¥configMapçš„æ–¹å¼è¿›è¡Œä¿å­˜ï¼Œå½“ç”¨æˆ·æäº¤è‡ªå·±çš„Podæ—¶ï¼ŒKuberneteså°±ä¼šé€šè¿‡ç±»ä¼¼git mergeçš„æ–¹å¼å°†ä¸¤ä»½é…ç½®è¿›è¡Œåˆå¹¶ã€‚è¿™ä¸ªåˆå¹¶çš„æ“ä½œä¼šç”±envoy-initializerçš„Podæ¥å®ç°ï¼Œè¯¥Podä½¿ç”¨ å¾ªç¯æ§åˆ¶ï¼Œä¸æ–­è·å–ç”¨æˆ·æ–°åˆ›å»ºçš„Podï¼Œè¿›è¡Œé…ç½®åˆå¹¶ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ ¸å¿ƒcrd&#34;&gt;æ ¸å¿ƒCRD&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;VirtualService&lt;/strong&gt;ï¼šè·¯ç”±è§„åˆ™ï¼Œä¸»è¦æ˜¯æŠŠè¯·æ±‚çš„æµé‡è·¯ç”±åˆ°æŒ‡å®šçš„ç›®æ ‡åœ°å€ï¼Œè§£è€¦è¯·æ±‚åœ°å€ä¸å·¥ä½œè´Ÿè½½ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;DistinationRule&lt;/strong&gt;ï¼šå®šä¹‰äº†VirtualServiceé‡Œé…ç½®çš„å…·ä½“çš„ç›®æ ‡åœ°å€å½¢æˆå­é›†ï¼Œè®¾ç½®è´Ÿè½½å‡è¡¡æ¨¡å¼ï¼Œé»˜è®¤æ˜¯éšæœºç­–ç•¥ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸Šé¢ä¸¤ä¸ªä¸»è¦æ˜¯ç®¡ç†æœåŠ¡ç½‘æ ¼å†…éƒ¨çš„æµé‡ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Gatewayï¼ˆingress gatewayï¼‰&lt;/strong&gt;ï¼šæ˜¯ç½‘æ ¼çš„è¾¹ç•Œï¼Œç®¡ç†è¿›å‡ºç½‘æ ¼çš„æµé‡ï¼Œæ¯”å¦‚ä¸ºè¿›å‡ºçš„æµé‡å¢åŠ è´Ÿè½½å‡è¡¡çš„èƒ½åŠ›ï¼Œå¢åŠ è¶…æ—¶é‡è¯•çš„èƒ½åŠ›ï¼Œæœ‰ingress gatewayå’Œegress gatewayåˆ†åˆ«ç®¡ç†ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ä¸k8s Ingressçš„åŒºåˆ«&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;k8s Ingressåªæ”¯æŒ7å±‚åè®®ï¼Œæ¯”å¦‚http/httpsï¼Œä¸æ”¯æŒtcpã€udpè¿™äº›ï¼Œæ²¡æœ‰VirtualServiceï¼Œç›´æ¥å¯¹çš„Service&lt;/li&gt;
&lt;li&gt;Gatewayæ”¯æŒ 4 - 6 å±‚åè®®ï¼Œåªè®¾ç½®å…¥å£ç‚¹ï¼Œé…åˆVirtualServiceè§£è€¦è·¯ç”±è§„åˆ™çš„ç»‘å®šï¼Œå®ç°è·¯ç”±è§„åˆ™å¤ç”¨ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ServiceEntry&lt;/strong&gt;ï¼šé¢å‘æœåŠ¡ï¼Œå°†å¤–éƒ¨çš„æœåŠ¡æ³¨å†Œåˆ°æœåŠ¡ç½‘æ ¼ä¸­ï¼Œä¸ºå…¶è½¬å‘è¯·æ±‚ï¼Œæ·»åŠ è¶…æ—¶é‡è¯•ç­‰ç­–ç•¥ï¼Œæ‰©å±•ç½‘æ ¼ï¼Œæ¯”å¦‚è¿æ¥ä¸åŒçš„é›†ç¾¤ï¼Œä½¿ç”¨åŒä¸€ä¸ªistioç®¡ç†ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Sidecarä½¿ç”¨Envoyï¼Œä»£ç†æœåŠ¡çš„ç«¯å£å’Œåè®®ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;48
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;49
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;50
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;51
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;52
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;53
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;54
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;55
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;56
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;57
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.istio.io/v1alpha3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Gateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;public-api-gateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;regoo&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-ingressgateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;istio&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ingressgateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# å…¥å£é…ç½®&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;servers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;number&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8080&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;HTTP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;api.xxx.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;---&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.istio.io/v1alpha3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;VirtualService&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;order&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;regoo&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;order&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# åªå…è®¸è¯·æ±‚æ¥è‡ªè¯¥hostçš„æµé‡&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;*&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# ç»‘å®šGateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;gateways&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;public-api-gateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  	&lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# è·¯ç”±åŒ¹é…&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;match&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;uri&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;prefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/order/v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;route&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;number&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8080&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;order&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;subset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;stable&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;---&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.istio.io/v1alpha3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;DestinationRule&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;order&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;regoo&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;order&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;order&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;subsets&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;stable&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;stable&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id=&#34;åº”ç”¨åœºæ™¯&#34;&gt;åº”ç”¨åœºæ™¯&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;VirtualServiceå’ŒDestinationRuleï¼šæŒ‰æœåŠ¡ç‰ˆæœ¬è·¯ç”±ã€æŒ‰æ¯”ä¾‹åˆ‡åˆ†æµé‡ã€æ ¹æ®åŒ¹é…è§„åˆ™è¿›è¡Œè·¯ç”±(æ¯”å¦‚è¯·æ±‚å¤´å¿…é¡»åŒ…å«xx)ã€è·¯ç”±ç­–ç•¥(å¦‚è´Ÿè½½å‡è¡¡ï¼Œè¿æ¥æ± )&lt;/p&gt;
&lt;p&gt;è“ç»¿éƒ¨ç½²ï¼šåŒæ—¶å‡†å¤‡ä¸¤å¥—ç¯å¢ƒï¼Œæ§åˆ¶æµé‡æµå‘ä¸åŒç¯å¢ƒæˆ–ç‰ˆæœ¬ï¼šä¸¤å¥—é›†ç¾¤ï¼Œä¸€å¥—æ˜¯ç°æœ‰åœ¨ä½¿ç”¨çš„é›†ç¾¤ï¼ˆè“è‰²ï¼‰ï¼Œå¦ä¸€å¥—ç”¨äºä¸Šçº¿å‰çš„æµ‹è¯•å’ŒéªŒè¯åè¿›è¡Œåˆ‡æ¢çš„é›†ç¾¤ï¼ˆç»¿è‰²ï¼‰ï¼Œéƒ½å¯ä»¥æ¥å—æµé‡ï¼Œå…ˆæ”¾å°‘é‡æµé‡åˆ°ç»¿è‰²é›†ç¾¤ï¼Œæ²¡é—®é¢˜ä¹‹åå†æŠŠè“è‰²é›†ç¾¤çš„æ‰€æœ‰æµé‡åˆ‡åˆ°ç»¿è‰²é›†ç¾¤ï¼Œè“è‰²é›†ç¾¤å†è¿›è¡Œå‡çº§ï¼›&lt;/p&gt;
&lt;p&gt;ç°åº¦å‘å¸ƒ(é‡‘ä¸é›€å‘å¸ƒ)ï¼šå°èŒƒå›´æµ‹è¯•å’Œå‘å¸ƒï¼Œå³æŒ‰æ¯”ä¾‹åˆ‡åˆ†æµé‡ï¼›è®©ä¸€éƒ¨åˆ†ç”¨æˆ·å…ˆç”¨è€æœåŠ¡Aï¼Œä¸€éƒ¨åˆ†ç”¨æ–°æœåŠ¡Bï¼Œåé¢å†æ ¹æ®å…·ä½“æƒ…å†µï¼Œå…¨éƒ¨è¿ç§»åˆ°Bï¼›&lt;/p&gt;
&lt;p&gt;A/Bæµ‹è¯•ï¼šç±»ä¼¼ç°åº¦å‘å¸ƒï¼Œåªæ˜¯ä¾§é‡ç‚¹ä¸åŒï¼Œç°åº¦å‘å¸ƒæœ€ç»ˆæµé‡ä¼šæµå‘æœ€æ–°ç‰ˆæœ¬ï¼Œè€ŒA/Bæµ‹è¯•åªæ˜¯ç”¨äºæµ‹è¯•Aã€Bä¸¤ä¸ªç¯å¢ƒå¸¦æ¥çš„å½±å“ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ä¸¤ä¸ªå¯ä»¥ç”¨äºingressgatewayæˆ–egressgateway&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Gatewayï¼šæš´éœ²é›†ç¾¤å†…çš„æœåŠ¡ç»™å¤–ç•Œè®¿é—®ã€å°†é›†ç¾¤å†…éƒ¨çš„æœåŠ¡ä»¥httpsçš„æ–¹å¼æš´éœ²ã€ä½œä¸ºç»Ÿä¸€åº”ç”¨å…¥å£ã€APIèšåˆ&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ServiceEntryï¼šæ·»åŠ å¤–éƒ¨çš„æœåŠ¡åˆ°ç½‘æ ¼ï¼Œä»è€Œç®¡ç†å¤–éƒ¨æœåŠ¡çš„è¯·æ±‚ï¼Œæ‰©å¤§ç½‘æ ¼ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒIstioå…è®¸ç½‘æ ¼å†…çš„æœåŠ¡è®¿é—®å¤–éƒ¨æœåŠ¡ï¼Œå½“å…¨éƒ¨ç¦æ­¢åï¼Œéœ€è¦ä½¿ç”¨ServiceEntryæ³¨å†Œå¤–éƒ¨æœåŠ¡ï¼Œä»¥ä¾›ç½‘æ ¼å†…éƒ¨çš„æœåŠ¡ä½¿ç”¨ï¼Œä¸€èˆ¬é…åˆengressgatewayï¼Œæ§åˆ¶ç½‘æ ¼å†…éƒ¨å‘å¤–éƒ¨æœåŠ¡å‘å‡ºçš„è¯·æ±‚ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è¶…æ—¶å’Œé‡è¯•ï¼šé€šè¿‡virtualServiceçš„routeé…ç½®&lt;code&gt;timemout&lt;/code&gt;è®¾ç½®æœåŠ¡æ¥æ”¶è¯·æ±‚å¤„ç†çš„è¶…æ—¶æ—¶é—´ï¼Œ&lt;code&gt;retries.attempts&lt;/code&gt;å’Œ&lt;code&gt;retries.perTryTimeout&lt;/code&gt;è®¾ç½®é‡è¯•æ¬¡æ•°å’Œé‡è¯•æ—¶é—´é—´éš”ï¼Œ&lt;code&gt;retries.retryOn&lt;/code&gt;è®¾ç½®é‡è¯•æ¡ä»¶&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç†”æ–­ï¼šé€šè¿‡DestinationRuleçš„trafficPolicyé‡ŒconnectionPoolå’ŒoutlierDectionçš„é…ç½®å®ç°&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.istio.io/v1alpha3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;DestinationRule&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;httpnin&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;httpbin&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;trafficPolicy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;connectionPool&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;tcp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;maxConnections&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 	&lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# tcpæœ€å¤§è¿æ¥æ•°&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;http1MaxPendingRequests&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# æ¯ä¸ªè¿æ¥èƒ½å¤„ç†çš„è¯·æ±‚æ•°&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;maxRequestsPerConnection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# æœ€å¤§è¢«é˜»æŒ¡çš„è¯·æ±‚æ•°&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;outlierDetection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;consecutiveErrors&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# å…è®¸å‡ºé”™çš„æ¬¡æ•°&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;interval&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;1s&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# å¤±è´¥æ¬¡æ•°è®¡æ•°æ—¶é—´&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;baseEjectionTime&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;3m&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# æœ€å°é©±é€æ—¶é—´ï¼Œç»è¿‡æ­¤æ—¶é—´åå°†podé‡æ–°åŠ å…¥ï¼Œé»˜è®¤30sï¼Œä¹˜äºè§¦å‘æ¬¡æ•°åä½œä¸ºç†”æ–­æŒç»­æ—¶é—´&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;maxEjectionPercent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;100&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# ç†”æ–­è§¦å‘æ—¶é©±é€podçš„æ¯”ä¾‹&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ•…éšœæ³¨å…¥ï¼šé€šè¿‡VirtualServiceçš„faulté…ç½®å®ç°&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æµé‡é•œåƒï¼šé€šè¿‡VirtualServiceçš„&lt;code&gt;mirror&lt;/code&gt;å’Œ&lt;code&gt;mirrorPercentage&lt;/code&gt;é…ç½®ï¼Œæ¯”å¦‚å°†å‘é€ç»™v1ç‰ˆæœ¬çš„çœŸå®æµé‡é•œåƒä¸€ä»½ç»™v2&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;é™æµï¼š1.5ä¹‹å‰æœ‰Mixeræä¾›ï¼Œä½†æ˜¯1.5ä¹‹åç§»é™¤äº†Mixerï¼Œåªèƒ½ä½¿ç”¨Envoy + filterå®ç°ï¼Œä¸å±äºistioç”Ÿæ€çš„äº†&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æˆæƒè®¤è¯ï¼ŒIstioçš„è®¤è¯æ›´å¤šçš„æ˜¯æœåŠ¡é—´çš„è®¿é—®è®¤è¯ï¼Œå¯æ ¹æ®namespaceã€å…·ä½“çš„æœåŠ¡ã€æœåŠ¡çš„æ¥å£ã€è¯·æ±‚æ–¹æ³•ã€è¯·æ±‚å¤´ã€è¯·æ±‚æ¥æºç­‰è¿›è¡Œè®¾ç½®&lt;/p&gt;
&lt;p&gt;å¯¹å¤–æä¾›HTTPS mTLSè®¿é—®æ–¹å¼ï¼Œè®¾ç½®åŸŸåè¯ä¹¦å’ŒGatewayå³å¯ï¼›è®¾ç½®ç½‘æ ¼å†…éƒ¨çš„mTLSåŒå‘è®¤è¯ï¼›è®¾ç½®JWTè®¤è¯ï¼Œä½¿ç”¨RequestAuthenticationèµ„æºè¿›è¡Œè®¤è¯é…ç½®ï¼Œä½¿ç”¨AuthorizationPolicy èµ„æºè¿›è¡Œæˆæƒé…ç½®ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;è°ƒè¯•&#34;&gt;è°ƒè¯•&lt;/h2&gt;
&lt;p&gt;ä½¿ç”¨istioctlçš„dashboardå·¥å…·ã€Envoyçš„adminæ¥å£ã€Pilotçš„debugæ¥å£ç­‰ï¼ŒæŸ¥çœ‹ç½‘æ ¼çš„ä¿¡æ¯ï¼Œæ¯”å¦‚èµ„æºä½¿ç”¨ç‡ã€æ—¥å¿—çº§åˆ«ã€Envoyæ€§èƒ½ç›¸å…³ä¿¡æ¯ç­‰&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;istioctl x describe pod [podåç§°]&lt;/code&gt;ï¼ŒæŸ¥çœ‹podæ˜¯å¦åœ¨ç½‘æ ¼å†…ï¼ŒéªŒè¯å…¶VirtualServiceã€DestinationRuleã€è·¯ç”±ç­‰&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;istioctl analyze [-n å‘½åç©ºé—´åç§°] æˆ– [å…·ä½“çš„yamlæ–‡ä»¶] æˆ– --use-kube=false [yamlæ–‡ä»¶]ï¼›åªåˆ†ææ–‡ä»¶&lt;/code&gt;è¿›è¡Œç½‘æ ¼é…ç½®çš„è¯Šæ–­&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;istioctl d [istiodçš„podåç§°] -n istio-system&lt;/code&gt;ä½¿ç”¨controlZå¯è§†åŒ–è‡ªæ£€å·¥å…·ï¼Œè°ƒæ•´æ—¥å¿—è¾“å‡ºçº§åˆ«ã€å†…å­˜ä½¿ç”¨æƒ…å†µã€ç¯å¢ƒå˜é‡ã€å†…å­˜ä¿¡æ¯&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;istioctl d envoy [podåç§°].[å‘½åç©ºé—´] &lt;/code&gt;ä½¿ç”¨Envoyçš„adminæ¥å£ï¼Œè¿›è¡ŒEnvoyçš„æ—¥å¿—çº§åˆ«è°ƒæ•´ã€æ€§èƒ½æ•°æ®åˆ†æã€é…ç½®ã€æŒ‡æ ‡ä¿¡æ¯çš„æŸ¥çœ‹&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;kubectl port-forward service/istio-pilot -n istio-system ç«¯å£:ç«¯å£&lt;/code&gt;ä½¿ç”¨pilotçš„debugæ¥å£ï¼ŒæŸ¥çœ‹xDSå’Œé…ç½®ä¿¡æ¯ã€æ€§èƒ½é—®é¢˜åˆ†æã€é…ç½®åŒæ­¥æƒ…å†µ&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;istioctl dashboard [controlZ/envoy/Grafana/jaeger/kiali/Prometheus/zipkin]&lt;/code&gt;ä½¿ç”¨istioæä¾›çš„å·¥å…·&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;istioctl ps(proxy-statusçš„ç¼©å†™) [podåç§°]&lt;/code&gt;è¿›è¡Œé…ç½®åŒæ­¥æ£€æŸ¥ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;istioctl pc(proxy-configçš„ç¼©å†™) [cluster/route...] [podåç§°].[å‘½åç©ºé—´]&lt;/code&gt;æŸ¥çœ‹é…ç½®è¯¦æƒ…ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;istioctl proxy-config routes [istio-ingressgateway podçš„åå­—] -n istio-system&lt;/code&gt;æŸ¥çœ‹istioæ•´ä¸ªæœåŠ¡ç½‘æ ¼çš„é…ç½®&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;envoyè°ƒè¯•&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;è¿›åˆ°podé‡Œä¹‹åï¼Œä¿®æ”¹envoyçš„æ—¥å¿—çº§åˆ«
curl -XPOST http://localhost:15000/logging?level=debug
curl -XPOST http://localhost:15000/logging?level=info
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h1&gt;
&lt;p&gt;æå®¢æ—¶é—´-æ·±å…¥å‰–æk8s-å¼ ç£Š&lt;/p&gt;
&lt;p&gt;æå®¢æ—¶é—´-ServiceMeshå®æˆ˜-é©¬è‹¥é£&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.lixueduan.com/post/kubernetes/04-service-core/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Serviceæ ¸å¿ƒåŸç†&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://zhuanlan.zhihu.com/p/80141656&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;KubeDNSå’ŒCoreDNS&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://draveness.me/kubernetes-volume/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;è¯¦è§£ Kubernetes Volume çš„å®ç°åŸç†&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://draveness.me/kubernetes-replicaset/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;è¯¦è§£ Kubernetes ReplicaSet çš„å®ç°åŸç†&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://draveness.me/kubernetes-garbage-collector/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;è¯¦è§£ Kubernetes åƒåœ¾æ”¶é›†å™¨çš„å®ç°åŸç†&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://draveness.me/kubernetes-daemonset/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;è¯¦è§£ Kubernetes DaemonSet çš„å®ç°åŸç†&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://draveness.me/kubernetes-deployment/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;è¯¦è§£ Kubernetes Deployment çš„å®ç°åŸç†&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://draveness.me/kubernetes-service/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;è¯¦è§£ Kubernetes Service çš„å®ç°åŸç†&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://draveness.me/kubernetes-pod/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;è¯¦è§£ Kubernetes Pod çš„å®ç°åŸç†&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://draveness.me/understanding-kubernetes/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;è°ˆ Kubernetes çš„æ¶æ„è®¾è®¡ä¸å®ç°åŸç†&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://kingjcy.github.io/post/cloud/paas/base/kubernetes/k8s-apiserver/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;äº‘è®¡ç®—K8sç»„ä»¶ç³»åˆ—ï¼ˆä¸€ï¼‰&amp;mdash;- K8s apiserver è¯¦è§£&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://github.com/rfyiamcool/notes/blob/main/kubernetes_client_go_workqueue_code.md&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;æºç åˆ†æ kubernetes client-go workqueue çš„å®ç°åŸç†&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://github.com/rfyiamcool/notes/blob/main/kubernetes_scheduler_code.md&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;æºç åˆ†æ kubernetes scheduler æ ¸å¿ƒè°ƒåº¦å™¨çš„å®ç°åŸç†&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.infoq.cn/article/cpxr35bwjttgncltyekz&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;gRPC é•¿è¿æ¥åœ¨å¾®æœåŠ¡ä¸šåŠ¡ç³»ç»Ÿä¸­çš„å®è·µ&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.hwchiu.com/k8s-network-issue.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;å¾ç¶²è·¯è§€é»ä¾†çœ‹å°å…¥ Kubernetes çš„å¯èƒ½ç—›é»&lt;/a&gt;&lt;/p&gt;
</description>
        </item>
        <item>
        <title>æ¯•ä¸šåå››å¹´å·¥ä½œæ€»ç»“ - ç¬¬ä¸€é˜¶æ®µç»“æŸ</title>
        <link>http://nixum.cc/p/%E6%AF%95%E4%B8%9A%E5%90%8E%E5%9B%9B%E5%B9%B4%E5%B7%A5%E4%BD%9C%E6%80%BB%E7%BB%93-%E7%AC%AC%E4%B8%80%E9%98%B6%E6%AE%B5%E7%BB%93%E6%9D%9F/</link>
        <pubDate>Tue, 09 May 2023 00:00:00 +0000</pubDate>
        
        <guid>http://nixum.cc/p/%E6%AF%95%E4%B8%9A%E5%90%8E%E5%9B%9B%E5%B9%B4%E5%B7%A5%E4%BD%9C%E6%80%BB%E7%BB%93-%E7%AC%AC%E4%B8%80%E9%98%B6%E6%AE%B5%E7%BB%93%E6%9D%9F/</guid>
        <description>&lt;h2 id=&#34;å·¥ä½œç»å†&#34;&gt;å·¥ä½œç»å†&lt;/h2&gt;
&lt;p&gt;ä»19å¹´æ¯•ä¸šçš„æ—¶å€™ï¼Œç»™è‡ªå·±å®šäº†ä¸€ä¸ªæœŸé™ï¼Œå¸Œæœ›èƒ½åœ¨ç¬¬ä¸‰å¹´åšå‡ºç‚¹æˆç»©ï¼Œæˆ–è€…èƒ½è·³åˆ°ä¸€å®¶å¥½ä¸€ç‚¹çš„å‚å­ï¼Œè™½ç„¶æ¯”é¢„æœŸæ™šäº†è¿‘ä¸€å¹´ï¼Œä½†è¿˜ç®—åŸºæœ¬å®ç°ï¼ˆè‡ªè®¤ä¸ºï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;ç›®å‰ä¸ºæ­¢(2023.05.09)ï¼Œä¸»è¦çš„æŠ€æœ¯æ ˆè¿˜æ˜¯å›´ç»•ç€åç«¯ + äº‘åŸç”Ÿå±•å¼€ï¼Œç»å†çš„ä¸šåŠ¡æ˜¯å¹¿å‘Š + ç”µå•†ï¼Œå¹¸å¥½ï¼Œæ¯•ä¸šä¹‹åé‡åˆ°çš„å›¢é˜Ÿéƒ½éå¸¸ä¸é”™ï¼Œå‡ ä»»ä¸»ç®¡éƒ½å¾ˆniceï¼ˆå·§çš„æ˜¯ä»–ä»¬å‡ ä¹éƒ½æ˜¯ä¹‹å‰UCç³»çš„ï¼‰ï¼Œéƒ½ç»™äº†æˆ‘éå¸¸å¤§çš„å¸®åŠ©ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;2018.07 ~ 2020.05&lt;/p&gt;
&lt;p&gt;ä»å®ä¹ åˆ°æ ¡æ‹›ä¹ƒè‡³æ¯•ä¸šçš„ç¬¬ä¸€å¹´ï¼Œåšçš„æ˜¯å¹¿å‘Šæ–¹å‘çš„ä¸šåŠ¡ï¼Œç±»ä¼¼ç½‘ç›Ÿå¹³å°ï¼Œä½†ä¸»è¦æ˜¯ä¸šåŠ¡æ¡†æ¶çš„å¼€å‘ï¼Œæ¯”å¦‚ç±»GraphQLåè®®è¯­æ³•ç³–çš„å®ç°ã€è´¦å·æœåŠ¡æ¶æ„ã€å¹¿å‘Šä¸»æ¥å…¥æµç¨‹ä½ä»£ç ç­‰æ–¹é¢ï¼Œé‡çš„è¯ï¼Œé«˜å³°æ—¶ä¸€å¤©æœ‰ä¸€äº¿ç‚¹å‡»ï¼Œè¿˜æ˜¯å¾ˆçŒ›çš„ã€‚&lt;/p&gt;
&lt;p&gt;å¼€å‘ä½¿ç”¨çš„æ˜¯Javaï¼Œä½†åˆä¸ä½¿ç”¨ Spring å…¨å®¶æ¡¶ï¼Œé™¤äº†åº•å±‚çš„Webæ¡†æ¶ç”¨çš„æ˜¯Nettyï¼Œåƒå¾®æœåŠ¡é—´çš„é€šä¿¡åè®®ã€RPCã€ä¸šåŠ¡æ¡†æ¶å•¥çš„ï¼Œéƒ½æ˜¯å›¢é˜Ÿè‡ªç ”çš„ã€‚CTOå¸¦é˜Ÿï¼Œå½“æ—¶çš„Leaderå’ŒCTOæœ¬èº«å¯¹æŠ€æœ¯å¾ˆæœ‰è¿½æ±‚ï¼Œå¯¹æ–¹æ¡ˆçš„è®¾è®¡å’Œä»£ç çš„åˆç†æ€§éƒ½éå¸¸ä¸¥æ ¼ï¼Œè¿™å¯¹åˆšæ¯•ä¸šçš„æˆ‘æ¥è¯´æˆé•¿ä¸Šå¸®åŠ©æ¯”è¾ƒå¤§ã€‚&lt;/p&gt;
&lt;p&gt;è‡ªç ”çš„æ¡†æ¶åœ¨æˆ‘çœ‹æ¥ï¼Œæ•´ä½“ä¸Šæ˜¯ä¸€ä¸ªå¤šReactorå¤šçº¿ç¨‹ + äº‹ä»¶é©±åŠ¨ + çŠ¶æ€æœºçš„æ¨¡å‹ï¼ˆblogä¸Šæœ‰è¿™ä¸ªæ¨¡å‹çš„ç®€åŒ–ç‰ˆç±»å›¾ï¼‰ï¼Œèƒ½æå¤§ç¨‹åº¦å‹æ¦¨CPUçš„æ€§èƒ½ï¼Œæ•´ä½“ä¸Šååç¡®å®æ¯”Springå…¨å®¶æ¡¶é‚£å¥—è¦é«˜ä¸€ç‚¹ï¼Œè®¾è®¡ä¸Šç¡®å®æŒºå·§å¦™çš„ï¼Œåæ¥ç”šè‡³æŠŠæ•´ä¸ªäº‹ä»¶é©±åŠ¨æŠ½å‡ºæ¥åšæˆä¸€ä¸ªPaaSæ¡†æ¶ï¼Œ æ­é…è‡ªç ”çš„ç±» GraphQL æ¥å£ï¼Œå®ç°ä½ä»£ç çš„åŠŸèƒ½ï¼Œä»»ä½•æ–¹å‘çš„ä¸šåŠ¡å†™å®Œé…ç½®å°±èƒ½ç›´æ¥å¾€é‡Œå¥—ï¼Œå°±æœ‰CRUDæ¥å£å¯ä»¥ç”¨äº†ï¼Œå½“ç„¶ï¼Œä»£ä»·å°±æ˜¯å®ç°å¾ˆå¤æ‚ï¼Œå†™å¾—æˆ‘åŠå…¶ç—›è‹¦ã€‚&lt;/p&gt;
&lt;p&gt;è¿™å¯¹äºåˆšæ¯•ä¸šçš„æˆ‘æ¥è¯´çœŸçš„é«˜ç»´æ‰“å‡»ï¼Œå¾ˆå¤šä¸œè¥¿éƒ½ä¸æ‡‚ï¼Œæ¯å¤©éƒ½è¦å¹²å¾—å¾ˆæ™šï¼Œç”šè‡³ä¼šä¸ºæŸä¸€ä¸ªåŠŸèƒ½å®ç°ä¸å‡ºæ¥æ„Ÿåˆ°ç„¦è™‘ï¼Œè¶³å¤Ÿéš¾ï¼Œä½†ä¹Ÿè¶³å¤Ÿæœ‰è¶£ï¼Œæ˜¯æˆé•¿å¾—æ¯”è¾ƒå¿«çš„ä¸€ä¸ªé˜¶æ®µã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;2020.05 ~ 2020.11&lt;/p&gt;
&lt;p&gt;ç”±äºå…¬å¸å†…éƒ¨åŸå› ï¼Œä¹‹å‰æ‰€åœ¨çš„åŸºç¡€æ¶æ„éƒ¨é—¨è§£æ•£äº†ï¼Œå½“æ—¶åˆç”±äºç–«æƒ…åˆšå¼€å§‹ï¼Œè¿˜æ˜¯æœ‰ç‚¹å®³æ€•å¤±ä¸šçš„ï¼Œè¿˜å¥½åé¢è½¬å…¥ä¸šåŠ¡éƒ¨é—¨ï¼Œä¸è¿‡ä¹Ÿä»Javaè½¬æˆgo + giné‚£ä¸€å¥—ï¼Œä»äº‹è·¨å¢ƒç”µå•†æ–¹å‘çš„ä¸šåŠ¡å¼€å‘ã€‚&lt;/p&gt;
&lt;p&gt;ä¸šåŠ¡æ–¹é¢æ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œéš¾åº¦å¯¹æ¯”ä¹‹å‰çœŸçš„é™ç»´æ‰“å‡»ï¼Œå½“ç„¶æˆé•¿ä¹Ÿæ¯”è¾ƒæ…¢ï¼Œå¥½å¤„æ˜¯è¿™ä¸ªé˜¶æ®µå¼€å§‹æ¥è§¦åˆ°äº‘åŸç”Ÿã€Kubernetes + Istioé‚£ä¸€å¥—ï¼Œè¿™ä¸ªæ—¶å€™è¿˜åªæ˜¯ä»¥ç”¨ä¸ºä¸»ï¼Œåˆæ­¥å¯¹è¿™äº›ä¸œè¥¿æœ‰äº†æ¦‚å¿µï¼Œå½“æ—¶çš„Leaderä¹Ÿå¾ˆæ”¯æŒæˆ‘ä»¬è‡ªå·±å»æ¢ç´¢ï¼Œå°±åˆ©ç”¨å…¬å¸é—²ç½®çš„KVMæ­äº†ä¸€å¥—K8sé›†ç¾¤ï¼Œç®—æ˜¯å…¥äº†ä¸ªé—¨ï¼Œå¼€å§‹äº‘åŸç”Ÿæ¢ç´¢é“è·¯ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;2020.11 ~ 2023.04&lt;/p&gt;
&lt;p&gt;åœ¨å½“æ—¶å…¬å¸ç”µå•†ä¸šåŠ¡æŠ€æœ¯è´Ÿè´£äººçš„é‚€è¯·ä¸‹ä¸€èµ·è·³æ§½åˆ°ä¸€å®¶åšå‡ºæµ·çš„åˆ›ä¸šå…¬å¸ï¼Œä¸»è¦ä¹Ÿæ˜¯ä»äº‹è·¨å¢ƒç”µå•†æ–¹å‘çš„ä¸šåŠ¡å¼€å‘ï¼Œè‡ªç ”ç”µå•†å¹³å°ï¼Œåˆ›ä¸šçš„æ–¹å‘æ€»ä½“è¿˜æ˜¯å›´ç»•ç€ç”µå•†åœ¨åšï¼Œä»æ•°ç 3cç”µå•†å¹³å°åˆ°æœ¬åœ°ç”Ÿæ´»ç±»å‹çš„ç”µå•†å¹³å°ï¼Œå› æ­¤ä¹Ÿæœ‰å¹¸å‚ä¸åˆ°äº†æ•´ä¸ªä¸šåŠ¡çº¿ã€åç«¯åŸºå»ºçš„ä»0åˆ°1ã€‚&lt;/p&gt;
&lt;p&gt;å¾—ç›Šäºä¹‹å‰çš„ç»å†ï¼Œè¿›å…¥å…¬å¸çš„ç¬¬ä¸€ä»¶äº‹å°±æ˜¯ä¸ºåç«¯å›¢é˜Ÿæ­å»ºåŸºç¡€è®¾æ–½ï¼Œä½¿ç”¨AWS EKSæ­å»ºäº†kubernetesç¯å¢ƒï¼Œåœ¨æ­¤åŸºç¡€ä¸Šï¼Œé‡‡ç”¨EFKæ–¹æ¡ˆåšæ—¥å¿—æ”¶é›†ã€é‡‡ç”¨Prometheusã€Grafanaæ–¹æ¡ˆåšæŒ‡æ ‡é‡‡é›†å’Œèµ„æºåˆ©ç”¨ç‡çœ‹æ¿ç­‰ä¸€ç³»åˆ—çš„ç›‘æ§å‘Šè­¦å·¥å…·ï¼ŒåŸºäº Gitlab æ­å»ºæ•´å¥—CI/CDæµç¨‹ï¼Œç®—æ˜¯åŸºæœ¬æŠŠæ•´ä¸ªåç«¯çš„åŸºå»ºæ­å»ºèµ·æ¥ï¼Œæœ‰äº†ç›‘æ§å‘Šè­¦å’Œæ—¥å¿—æŸ¥è¯¢ï¼ŒåŠ¨æ€æ‰©ç¼©å®¹ï¼ŒåŸºæœ¬ä¸ŠæœåŠ¡å¼€å‘åå°±æ²¡æœ‰çƒ¦æ¼ï¼Œè‡ªåŠ¨åŒ–éƒ¨ç½²å’Œç»´æŠ¤èµ·æ¥çœŸçš„å¾ˆæ–¹ä¾¿ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æ­¤æœŸé—´ä¹Ÿé‡æ–°è®¤è¯†äº†kubernetesï¼Œå¯¹å®ƒæ•´ä¸ªæ¶æ„å’ŒåŸç†æœ‰äº†æ›´æ·±ä¸€æ­¥çš„ç†è§£ï¼ŒåŸºæœ¬ä¸Šä¸€äº›å¸¸è§„çš„é—®é¢˜å’Œæ’æŸ¥æ€è·¯éƒ½éå¸¸ç†Ÿæ‚‰ï¼Œä¸å¾—ä¸è¯´ï¼ŒKubernetesçœŸçš„æ˜¯ä¸€åº§å¤§å±±ï¼Œé‡Œé¢çš„ç†å¿µå’Œæ–¹æ¡ˆè®¾è®¡çœŸçš„æŒ–éƒ½æŒ–ä¸å®Œï¼Œä½†æ˜¯ï¼Œä¸ªäººæ„Ÿè§‰åƒKubernetesè¿™ä¸€å—ï¼Œå¦‚æœæƒ³è¦æ›´è¿›ä¸€æ­¥çš„æå‡ï¼Œè¿˜å¾—æœ‰è¶³å¤Ÿå¤æ‚çš„åœºæ™¯æ‰è¡Œï¼Œåªä¾èµ–ä¸€ä¸¤ä¸ªdemoæˆ–è€…æˆ‘ä»¬è¿™ç§å°é›†ç¾¤ï¼ˆ10å°æœºå™¨ï¼‰è¿˜æ˜¯è¿œè¿œä¸å¤Ÿï¼›&lt;/p&gt;
&lt;p&gt;åŸºå»ºæ­å®Œä¹‹åï¼Œé€æ¸è½¬å‘ä¸šåŠ¡å¼€å‘ï¼Œå…ˆæ˜¯åŸºäºä»¥å‰çš„é¡¹ç›®æŠ½å‡ºä¸€å¥—ä¸šåŠ¡å¼€å‘çš„è„šæ‰‹æ¶ï¼Œå¯¹åº”çš„ç›®å½•ç»“æ„åšåˆ†å±‚ï¼Œå›¢é˜Ÿçš„å°ä¼™ä¼´éœ€è¦èµ·æ–°æœåŠ¡æ—¶ç›´æ¥å‘½ä»¤å¼ç”Ÿæˆè„šæ‰‹æ¶ï¼Œå¯ä»¥ç›´æ¥è¿›è¡Œä¸šåŠ¡ä»£ç çš„å¼€å‘å³å¯ï¼›ï¼ˆè¿™é‡Œä¹Ÿç«‹ä¸€ä¸‹Flagï¼Œæœªæ¥æœ‰æ—¶é—´è¦ç»§ç»­å®Œå–„ä¸€ä¸‹é‚£ä¸ªè„šæ‰‹æ¶ï¼Œåæ­£åé¢åšå‰¯ä¸šå¯èƒ½ä¹Ÿä¼šç”¨åˆ°ï¼‰&lt;/p&gt;
&lt;p&gt;ä¹‹åæ‰æ˜¯çœŸæ­£çš„åšä¸šåŠ¡å¼€å‘ï¼Œè´Ÿè´£å¹³å°çš„æ ¸å¿ƒäº¤æ˜“çº¿ï¼Œä¸»å¯¼å¼€å‘äº†è®¢å•å’Œæ”¯ä»˜æœåŠ¡ï¼Œè¿™é‡Œæ¯”è¾ƒå¥½çš„ä¸€ç‚¹æ˜¯å‰æœŸè®¾è®¡çš„æ—¶å€™å°±è€ƒè™‘ä¸­å°çš„æ–¹æ¡ˆï¼Œå°½é‡å°†æ•´ä¸ªäº¤æ˜“æµç¨‹æ ‡å‡†åŒ–ï¼Œå¹¶æä¾›ä¸€å¥—æ¥å£æ–¹ä¾¿å„ä¸ªä¸šåŠ¡æ–¹æ¥å…¥ï¼Œåœ¨åé¢å…¬å¸é¢‘ç¹å˜æ¢æ–¹å‘çš„æ—¶å€™ï¼Œä»ç„¶èƒ½æä¾›å¾ˆå¥½çš„è®¢å•å’Œæ”¯ä»˜åŠŸèƒ½çš„æ”¯æ’‘ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ€»ä¹‹ï¼Œè¿™å››å¹´æ€»ç»“ä¸‹æ¥ï¼ŒåŸºæœ¬ä¸Šä»åç«¯çš„å¼€å‘åˆ°äº‘åŸç”Ÿçš„å¼€å‘éƒ¨ç½²è¿ç»´è¿™ä¸€å—ï¼Œéƒ½æœ‰ä¸€å®šçš„ç†è§£ï¼Œå¯¹æ–¹æ¡ˆçš„è®¾è®¡ï¼Œæ¶æ„ï¼Œè®¾è®¡æ¨¡å¼ï¼Œä»£ç çš„ç»„ç»‡ä¹Ÿæœ‰äº†è‡ªå·±çš„æ€è€ƒï¼Œå…·å¤‡ç‹¬ç«‹è§„åˆ’å’Œå®Œæˆçš„èƒ½åŠ›ï¼Œåœ¨åç«¯ä¸­kubernetesè¿˜ç®—æ˜¯ç©å¾—æ¯”è¾ƒæºœï¼ˆå½“ç„¶äº‘åŸç”Ÿè¿™å—è¿˜æ˜¯æ¯”ä¸äº†ä¸“é—¨æå®¹å™¨å¼€å‘çš„ï¼Œä½†å¯¹äºä¸€ä¸ªåç«¯æ¥è¯´æš‚æ—¶å¤Ÿç”¨äº†ï¼‰ï¼›ä¸šåŠ¡æ–¹é¢ä¹Ÿç†Ÿæ‚‰äº†äº¤æ˜“ï¼Œå±¥çº¦ç›¸å…³çš„åŠŸèƒ½ï¼Œå¯¹ç”µå•†å’Œå¹¿å‘Šæœ‰ä¸€å®šçš„è®¤è¯†ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;æ±‚èŒæ„Ÿæƒ³&#34;&gt;æ±‚èŒæ„Ÿæƒ³&lt;/h2&gt;
&lt;p&gt;ä»ç¦»èŒåˆ°å…¥èŒï¼Œä¸­é—´gapä¸€ä¸ªæœˆï¼Œå°±é ç€å¹³æ—¶çš„ç§¯ç´¯ï¼Œç¦»èŒåå¤ä¹ äº†ä¸€å‘¨å°±å¼€å§‹æŠ•ç®€å†ï¼Œä»Šå¹´è¡Œæƒ…ç¡®å®å¾ˆå·®ï¼Œæ²¡é‚£ä¹ˆå¤šæœºä¼šäº†ï¼ŒBossä¸Šæ¥æ¥å»å»ä¹Ÿæ˜¯é‚£å‡ å®¶ï¼Œç„¶åæˆ‘è¿˜æ˜¯ç„å‡†äº†ç™¾äººä»¥ä¸Šï¼Œæœ‰ä¸€å®šè§„æ¨¡ä¸”ç›ˆåˆ©çš„å…¬å¸ï¼Œé€‰æ‹©å°±æ›´å°‘äº†ï¼Œè¿›é¢çš„æœ‰13å®¶å·¦å³ï¼Œæœ€ç»ˆofferå››å®¶ï¼Œè¿˜æœ‰ä¸¤å®¶æ˜¯æ‹¿åˆ°å¿ƒä»ªofferåæ²¡æœ‰ç»§ç»­æ¨è¿›é¢è¯•æµç¨‹çš„ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æ•´ä¸ªæ±‚èŒè¿‡ç¨‹ï¼Œä¹Ÿæ˜¯ä¸æ–­å‘ç°ä¸è¶³å’Œè¡¥é½ä¸è¶³çš„è¿‡ç¨‹ï¼Œç”šè‡³æ¯”ä¸Šç­è¿˜ç´¯ï¼Œæ¯ä¸€æ¬¡é¢å®Œéƒ½å¿«è™šè„±ï¼Œå›å¤´è¿˜å¾—å¤ç›˜å’Œå¤ä¹ ï¼Œæ¯ä¸€æ¬¡é¢è¯•æ²¡è¿‡å°±æ„å‘³ç€å°‘äº†ä¸€æ¬¡æœºä¼šï¼Œå¼‚å¸¸ç„¦è™‘ï¼Œæ—¶åˆ»å¤„äºè‡ªæˆ‘æ€€ç–‘å’Œä¿¡å¿ƒåè¶³çš„è·Œå®•èµ·ä¼ä¸­&amp;hellip;&lt;/p&gt;
&lt;p&gt;ä»Šæ—¶ä»Šæ—¥ï¼Œé¢è¯•å·²ç»ä¸åƒä»¥å‰é‚£ä¹ˆå®¹æ˜“ï¼Œæœºä¼šæ˜¯é¢ä¸€ä¸ªå°‘ä¸€ä¸ªï¼Œå¦‚æœæƒ³æå‡é¢è¯•æˆåŠŸç‡ï¼Œæ‹¿åˆ°æ›´å¤šçš„offerï¼Œå¹³æ—¶å°±è¦æœ‰æ‰€ç§¯ç´¯äº†ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å¯¹äºç®€å†&lt;/strong&gt;ï¼Œä¸ªäººæ¨èæ˜¯åŠå¹´æ›´æ–°ä¸€æ¬¡ï¼Œå³ä½¿æ²¡æœ‰è·‘è·¯çš„æ„æ„¿ä¹Ÿéœ€è¦æ›´æ–°ï¼Œå†ä¸æµä¹Ÿè¦è®°å½•ä¸€ä¸‹è¿™æ®µæ—¶é—´çš„å·¥ä½œå†…å®¹ã€‚è®°å½•æ—¶ï¼Œä»¥STARæ³•åˆ™ä½œä¸ºçº¿ç´¢å»å†™ï¼Œå°±ç®—æ˜¯æ™®é€šçš„CRUDï¼Œä¹Ÿå¯ä»¥é€šè¿‡è®¾è®¡æ¨¡å¼å»ç¾åŒ–å®ƒï¼Œå½“ç„¶å‰æè¿˜æ˜¯éœ€è¦ä½ çœŸçš„èƒ½ç†è§£ã€‚&lt;/p&gt;
&lt;p&gt;è®°å½•çš„æ—¶å€™ï¼Œéœ€è¦è®°ä¸¤ä»½ï¼Œä¸€ä»½æ˜¯ç”¨STARæ³•åˆ™è®°å½•è¯¦ç»†çš„å†…å®¹ï¼ŒåŒ…æ‹¬èƒŒæ™¯å’Œåœºæ™¯ã€å®ç°ã€ä¼˜ç¼ºç‚¹ã€å¯æ”¹è¿›çš„ç‚¹ï¼Œè¿™ä¸€ä»½æ˜¯é’ˆå¯¹é¢è¯•å®˜è¯¢é—®çš„æ—¶å€™ï¼Œèƒ½ç‰¢ç‰¢æŠŠæ¡ä½ä½ ç»å†çš„é¡¹ç›®å†…å®¹ï¼Œä¸ä¼šä¸€é—®ä¸‰ä¸çŸ¥ï¼Œè®²è¿°çš„æ—¶å€™ä¹Ÿè¦å¯ä»¥æŒ‰ç…§STARæ³•åˆ™å»è®²ï¼Œè¿™æ ·å°±èƒ½å¾ˆæ¸…æ™°çš„è®²å‡ºæ¥ï¼Œé¢è¯•è¿‡ç¨‹ä¸­èƒ½æµåˆ©çš„è¡¨è¾¾ä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆé‡è¦çš„ç‚¹ï¼›å¦ä¸€ä»½æ˜¯å¯¹è¯¦ç»†å†…å®¹çš„æµ“ç¼©ï¼Œæç‚¼æˆä¸€å¥æœ‰äº®ç‚¹çš„è¯å†™åœ¨ç®€å†ä¸Šçš„ã€‚ç®€å†é€šå¸¸éœ€è¦ä¸æ–­ä¿®æ”¹ï¼Œå¯ä»¥ç»™å…¶ä»–äººçœ‹ï¼Œæ ¹æ®ä»–äººçš„å»ºè®®è¿›è¡Œä¿®æ”¹ï¼Œä¸€ä»½å¥½çš„ç®€å†åŸºæœ¬æ˜¯è¦è¿­ä»£ä¸ªä¸‰å››éå§ã€‚&lt;/p&gt;
&lt;p&gt;å¦å¤–ï¼Œç®€å†ä¸Šä¸å®œå‡ºç°è¿‡å¤šä¸šåŠ¡åè¯ï¼Œé™¤éæ˜¯å¯¹å£çš„ä¸šåŠ¡æ–¹å‘ï¼Œå› ä¸ºé¢è¯•çš„å…¬å¸ä¸åŒï¼Œä¸šåŠ¡ä¹Ÿä¸åŒï¼Œä¸åŒä¸šåŠ¡çš„é¢è¯•å®˜å¯èƒ½ä¼šçœ‹ä¸æ‡‚è¿™äº›åè¯ï¼Œæœ€å¥½çš„æ–¹å¼æ˜¯å°†ä¸šåŠ¡æŠ½è±¡ä¸ºæŠ€æœ¯æ¨¡å‹ï¼Œæ€è€ƒå®ƒçš„ä¼˜ç¼ºç‚¹ï¼Œè¿™æ ·çš„å¥½å¤„æ˜¯ï¼Œå¦‚æœé‡åˆ°ç›¸åŒçš„ä¸šåŠ¡åœºæ™¯ï¼Œä¸ç®¡æ˜¯åœ¨é¢è¯•ä¸­è¿˜æ˜¯å·¥ä½œä¸­ï¼Œéƒ½å¯ä»¥å»å¥—ç”¨ï¼Œä¹Ÿèƒ½å¼•å¯¼é¢è¯•å®˜ä»æŠ€æœ¯è§’åº¦æé—®ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å¯¹äºåŸºç¡€&lt;/strong&gt;ï¼Œæ•°æ®åº“ã€ç½‘ç»œã€æ“ä½œç³»ç»Ÿæ˜¯å¿…é—®çš„ï¼Œå æ¯”å¤§æ¦‚æ˜¯50%ã€30%ã€20%ï¼Œè¿™ä¸€å—å°±æ¯”è¾ƒåƒåŸºç¡€äº†ï¼Œå¾®æœåŠ¡ã€æœåŠ¡æ²»ç†ã€åˆ†å¸ƒå¼æ¶æ„ã€äº‘åŸç”Ÿï¼Œç”šè‡³ä¸€äº›ä¸šåŠ¡è§£å†³æ–¹æ¡ˆï¼Œéƒ½æ˜¯åœ¨è¿™äº›åŸºç¡€ä¸Šè¿›è¡Œå»¶ç”³å’Œå€Ÿé‰´çš„ï¼Œæ‰“å¥½åŸºç¡€çœŸçš„å¾ˆé‡è¦ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœæƒ³è¦é€Ÿæˆï¼Œæ¨èå°æ—codingé‚£å‡ ä¸ªä¸“é¢˜ï¼Œåº”è¯¥è¶³å¤Ÿåº”ä»˜å¤§å¤šæ•°åœºæ™¯äº†ã€‚å¦‚æœæƒ³æ›´è¿›ä¸€æ­¥ï¼Œå°±æ€¥ä¸æ¥äº†ï¼Œä¸€äº›MITçš„è¯¾ç¨‹ï¼Œä¸€äº›ç»å…¸çš„ä¹¦ï¼Œåšå®¢æ–‡ç« ï¼Œæ…¢æ…¢å•ƒå§ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å¯¹äºå…«è‚¡&lt;/strong&gt;ï¼Œè¯´å®è¯æˆ‘ç°åœ¨è¿˜æ˜¯ä¸å¤ªæ¸…æ¥šå…«è‚¡æ˜¯ä¸æ˜¯æŒ‡åˆ«äººæ•´ç†å¥½çš„ä¸€äº›çš„é¢è¯•é¢˜Q&amp;amp;Aï¼Œå¦‚æœå…‰é è¿™äº›Q&amp;amp;Açš„è¯ï¼Œæˆ‘è§‰å¾—æ˜¯è¿œè¿œä¸å¤Ÿçš„ï¼Œè¿™ç§ç¨å¾®é—®æ·±ä¸€ç‚¹å°±å¾—éœ²é¦…äº†å§ã€‚å½“ç„¶ï¼ŒQè¿˜æ˜¯æœ‰å¾ˆå¥½çš„æç¤ºä½œç”¨çš„ï¼Œè‡³å°‘Qå¯ä»¥æŠ„ï¼Œä½†Aè¿˜æ˜¯å¾—è‡ªå·±å»æ‰¾ï¼Œä¸æ–­çš„å»æ€è€ƒï¼Œç†è§£å’Œå»¶ç”³ï¼Œä¸æ–­çš„ä»Qé‡Œè¿›è¡Œå‘æ•£ï¼Œæ‰èƒ½çœŸæ­£è½¬æ¢ä¸ºè‡ªå·±çš„ä¸œè¥¿ï¼›&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å¯¹äºsystem design&lt;/strong&gt;ï¼Œè¿™ä¸ªå°±æ¯”è¾ƒåƒå·¥ä½œç»éªŒäº†ï¼Œæœ‰äº›åœºæ™¯ä½ æ²¡é‡åˆ°è¿‡ï¼Œæ²¡ä»”ç»†æ€è€ƒè¿‡ï¼Œå½“åœºå›ç­”èµ·æ¥æ˜¯æ¯”è¾ƒè´¹æ—¶è´¹åŠ›çš„ï¼Œæ•ˆæœä¹Ÿä¸å¤ªå¥½ã€‚&lt;/p&gt;
&lt;p&gt;è§£å†³åŠæ³•å¯ä»¥æ˜¯ä¸Šé¢æœ‰æåˆ°çš„æŠŠè‡ªå·±é‡åˆ°ä¸šåŠ¡åœºæ™¯è½¬æ¢ä¸ºæŠ€æœ¯æ¨¡å‹ï¼Œå¹³æ—¶å¤šçœ‹ç‚¹ç³»ç»Ÿè®¾è®¡çš„ä¹¦ï¼Œä¸€äº›å¤§ä½¬çš„è§£å†³æ–¹æ¡ˆï¼Œæˆ–è€…æ˜¯å¹³æ—¶è‡ªå·±çœ‹åˆ°çš„ä¸€äº›åŠŸèƒ½ï¼Œæ€è€ƒä¸€ä¸‹åˆ«äººæ˜¯æ€ä¹ˆå®ç°ï¼Œé€šè¿‡è¿™äº›æ–¹å¼æ¥ç§¯ç´¯äº†ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ç›®å‰åšçš„ä¸å¤Ÿå¥½çš„ï¼Œè¿˜éœ€è¦æ€»ç»“å‡ºä¸€ä¸ªæŒ‡å¯¼æ€æƒ³å‡ºæ¥ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å¯¹äºç®—æ³•&lt;/strong&gt;ï¼Œè¿™ä¸ªçœŸçš„æ˜¯æ€§ä»·æ¯”æä½çš„æŠ•å…¥ï¼Œæä½çš„ROIï¼ŒåŸºæœ¬éƒ½æ˜¯é é‡å †èµ·æ¥çš„ï¼Œé é‡å˜å¼•èµ·è´¨å˜ï¼Œåæ­£ä¸ªäººèƒ½åŠ›æœ‰é™ï¼Œè·Ÿå¤§ä½¬ä»¬è¿˜æ˜¯æ²¡å¾—æ¯”ï¼ŒåŸºæœ¬éƒ½æ˜¯åˆ·äº†å¿˜ï¼Œå¿˜äº†åˆ·ï¼Œé™¤å¼€é‚£äº›ç®€å•é¢˜ï¼Œå¾ˆå°‘èƒ½è¾¾åˆ°ä¸€æ¬¡æ€§bug freeçš„ç¨‹åº¦ï¼Œä½†æ˜¯è‡³å°‘ï¼Œä¸ªäººè§‰å¾—leetcode Top 100è¿˜æ˜¯è¦è¿‡ä¸ªå‡ éæ¥ä¿æŒæ‰‹æ„Ÿçš„ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å¯¹äºé¢è¯•&lt;/strong&gt;ï¼Œé¢è¯•è¿‡ç¨‹èƒ½å½•éŸ³æœ€ä½³ï¼Œé¢è¯•å®Œå°±è¦åŠæ—¶å¤ç›˜ï¼ŒåŠæ—¶è®°å½•ï¼Œæœ‰æ—¶å€™è‡ªå·±è§‰å¾—å¾ˆæœ‰ä¿¡å¿ƒçš„é¢˜ç›®ï¼Œå®é™…ä¸Šå›ç­”æ—¶å´ç£•ç£•ç»Šç»Šï¼Œé—æ¼ç»†èŠ‚ï¼Œæ²¡æœ‰æ¡ç†ï¼Œæ‰€ä»¥æ‰éœ€è¦åŠæ—¶å¤ç›˜ï¼Œå½¢æˆä¸€ä¸ªå›ç­”é—®é¢˜çš„æŒ‡å¯¼æ€æƒ³ï¼Œä¸ªäººè§‰å¾—STARç®—ä¸€ä¸ªæ¯”è¾ƒå¥½çš„å›ç­”æ–¹å¼ã€‚&lt;/p&gt;
&lt;p&gt;æ€»ä¹‹ï¼Œé¢è¯•è¿™ç§ä¸œè¥¿ï¼Œä¸€æ–¹é¢çœ‹ç§¯ç´¯ï¼Œä¸€æ–¹é¢é¢çš„å¤šäº†ï¼Œç†Ÿæ‚‰äº†å›ç­”çš„ä¸€ä¸ªå¤§æ¦‚æ€è·¯ï¼Œè‡ªç„¶å°±æ‡‚å¾—ä¸€äº›å¥—è·¯ï¼Œ&lt;strong&gt;æœ€æœ€æœ€é‡è¦çš„è¿˜æ˜¯è¿æ°”&lt;/strong&gt;å“ˆå“ˆå“ˆï¼Œæ¯•ç«Ÿå‰æœŸå†å¤šçš„å‡†å¤‡ä¹Ÿåªæ˜¯ç»™è‡ªå·±ä¸€äº›åº•æ°”ç½¢äº†ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æœªæ¥æœŸæœ›&#34;&gt;æœªæ¥æœŸæœ›&lt;/h2&gt;
&lt;p&gt;ç¬¬ä¸€é˜¶æ®µå°±ç®—æ˜¯ç»“æŸäº†ï¼Œä¸‹ä¸€ä¸ªé˜¶æ®µè¿˜æ²¡æƒ³å¥½è¦å®šå¤šä¹…ï¼Œå¯èƒ½3å¹´ï¼Œæˆ–è€…4å¹´ï¼Ÿç›®å‰å¥½åƒè¿˜çœ‹ä¸åˆ°å¤ªè¿œï¼Œèº«è¾¹ä¹Ÿæ²¡æœ‰å¯ä»¥å‚è€ƒçš„ç›®æ ‡ç³»ã€‚&lt;/p&gt;
&lt;p&gt;å½“ç„¶ï¼Œè‡ªå·±æœ¬èº«å¥½å¥‡å¿ƒä¹Ÿè¿˜æ˜¯æœ‰ï¼Œå¯¹å¾ˆå¤šä¸œè¥¿éƒ½å¾ˆæ„Ÿå…´è¶£ï¼Œè™½ç„¶ï¼Œå¤§éƒ¨åˆ†è¿˜æ˜¯å¤„äºå…‰è¯´ä¸ç»ƒçš„å‡æŠŠå¼çŠ¶æ€å“ˆå“ˆå“ˆã€‚æœŸæœ›æ˜¯èƒ½åœ¨ç¬¬äºŒé˜¶æ®µæ‰¾åˆ°ä¸€ä»½èƒ½åšä¸‹å»çš„å‰¯ä¸šï¼Œæˆ–è€…èƒ½æŒç»­æ¢ç´¢çš„æŠ€æœ¯æ–¹å‘ã€‚&lt;/p&gt;
&lt;p&gt;åšæŠ€æœ¯æœ‰ä¸ªå¥½å¤„ä¹Ÿæœ‰åå¤„ï¼Œå¥½å¤„æ˜¯æœ‰ä»€ä¹ˆäº§å“çš„æƒ³æ³•å¯ä»¥å¿«é€Ÿé€šè¿‡è‡ªå·±çš„æŠ€æœ¯å»å®ç°ï¼Œæœ€è¿‘ä¹Ÿå’Œæœ‹å‹åˆä½œäº†ä¸€æ¬¾å°å“çº§åº”ç”¨ï¼Œå·²å®ŒæˆåŸºæœ¬çš„å¼€å‘ã€ç›‘æ§å’Œå‘Šè­¦ï¼Œå°è¯•æ¨å¹¿ä¸­ï¼Œç›®æ ‡æ˜¯ä»Šå¹´èƒ½æœ‰å°ä¸€åƒçš„ç”¨æˆ·ï¼Œè¿™æ ·æœåŠ¡å™¨æˆæœ¬ä¹Ÿèƒ½coveräº†ï¼Œèƒ½èµšç‚¹ç‚¹é›¶èŠ±é’±ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹æˆ‘æ¥è¯´ï¼Œæ¯”è¾ƒæ„Ÿå…´è¶£çš„ä¸œè¥¿è¿˜æ˜¯ååº•å±‚ï¼Œæˆ–è€…æ¡†æ¶ç±»å‹è¿™ç§è„±ç¦»ä¸šåŠ¡èŒƒç•´ï¼Œåé€šç”¨ä¸€ç‚¹çš„ä¸œè¥¿ï¼Œæ¯”å¦‚äº‘åŸç”Ÿç›¸å…³ã€ä¸­é—´ä»¶ã€æ¡†æ¶åŸºå»ºç±»çš„åº”ç”¨å®ç°ï¼Œä½†è¦çœŸæ­£çš„è½åœ°ï¼Œè¿˜æ˜¯éœ€è¦æœ‰å¤§è§„æ¨¡çš„é‡æ¥è¿›è¡ŒéªŒè¯ï¼ŒçœŸæ­£æŠ•å…¥åˆ°ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæ‰èƒ½çŸ¥é“è‡ªå·±çš„å®ç°çš„æ–¹æ¡ˆå¥½è¿˜æ˜¯ä¸å¥½ï¼Œè¿™ç‚¹åªèƒ½å°½é‡åœ¨å·¥ä½œä¸­æ‰¾æ‰¾æœºä¼šäº†ã€‚&lt;/p&gt;
&lt;p&gt;ç„¶åï¼Œä¹Ÿç½—åˆ—ä¸€ä¸‹æ¥ä¸‹æ¥æƒ³è¦å»åšçš„ä¸œè¥¿ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ç›®å‰è¿™ä»½å·¥ä½œä¸šåŠ¡æ–¹å‘æ˜¯é‡‘èç›¸å…³çš„ï¼Œæ‰€ä»¥æœŸæœ›è‡ªå·±èƒ½å¤šå­¦ä¹ ä¸€äº›è‚¡ç¥¨ã€åŸºé‡‘ç±»ç›¸å…³çŸ¥è¯†ï¼Œæœ¬èº«ç†è´¢ä¹Ÿæ˜¯æŒºé‡è¦çš„ä¸€ç¯ï¼›&lt;/li&gt;
&lt;li&gt;å·¥ä½œè¿˜æ˜¯ä¸šåŠ¡ä¾§ç›¸å…³çš„å¼€å‘ä¸ºä¸»ï¼Œåº”è¯¥ä¼šéå¸¸æ— èŠï¼Œä¸šä½™åº”è¯¥ä¼šå°è¯•ä»ï¼šéŸ³è§†é¢‘ã€å­˜å‚¨ã€IMã€ES ã€k8sä¸€äº›ç»„ä»¶è¿›è¡Œç›¸å…³çš„å­¦ä¹ ï¼›&lt;/li&gt;
&lt;li&gt;è‹±è¯­ï¼Œç›®å‰æ¥çœ‹è‹±è¯­è¿˜æ˜¯éå¸¸é‡è¦çš„ï¼Œæ— è®ºæ˜¯ä¿¡æ¯è·å–è¿˜æ˜¯æ—¥å¸¸ä½¿ç”¨ï¼Œå…‰ä¼šè¯»å†™è¿˜æ˜¯ä¸å¤ªè¡Œï¼Œæ¥ä¸‹æ¥ç›®æ ‡æ˜¯è¾¾åˆ°ä¸€ä¸ªéå¸¸ç†Ÿç»ƒçš„å¬è¯´è¯»å†™ï¼ŒæœŸæœ›æ˜¯èƒ½è¾¾åˆ°å¼ å£å°±æ¥ï¼Œä¸€å¬å°±æ‡‚é‚£ç§ï¼›&lt;/li&gt;
&lt;li&gt;AI æˆ–è€… Web3ï¼Œè¿™ä¸¤ä¸ªæ–¹å‘æœ¬èº«å°±æœ‰æ¯”è¾ƒå¤§çš„æœªçŸ¥å’Œå¯èƒ½çš„å­˜åœ¨ï¼Œå¦‚æœä½œä¸ºç‹¬ç«‹å¼€å‘è€…æ¥è¯´ï¼Œå¯èƒ½åŸºäºè¿™ä¸¤ä¸ªæ–¹å‘å¯ä»¥åšä¸€äº›åº”ç”¨å±‚ç›¸å…³çš„å¼€å‘ï¼Œä¼šæœ‰æ¯”è¾ƒå¤§çš„å›æŠ¥ï¼Ÿ&lt;/li&gt;
&lt;li&gt;å‘å±•ç‚¹å…¶ä»–å…´è¶£çˆ±å¥½ï¼Œæ¯”å¦‚ç£¨ç»ƒä¸€ä¸‹æ‹ç…§æŠ€æœ¯ã€ç¾½æ¯›çƒç”šè‡³ç¤¾äº¤ï¼Œå¥èº«å¥½åƒä¹Ÿå¯ä»¥çº³å…¥è®¡åˆ’ä¸­äº†ï¼›&lt;/li&gt;
&lt;/ol&gt;
</description>
        </item>
        <item>
        <title>å®¹å™¨</title>
        <link>http://nixum.cc/p/%E5%AE%B9%E5%99%A8/</link>
        <pubDate>Sat, 06 Nov 2021 00:00:00 +0000</pubDate>
        
        <guid>http://nixum.cc/p/%E5%AE%B9%E5%99%A8/</guid>
        <description>&lt;p&gt;[TOC]&lt;/p&gt;
&lt;h1 id=&#34;åº•å±‚åŸç†&#34;&gt;åº•å±‚åŸç†&lt;/h1&gt;
&lt;p&gt;å®¹å™¨æŠ€æœ¯çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œå°±æ˜¯é€šè¿‡çº¦æŸå’Œä¿®æ”¹è¿›ç¨‹çš„åŠ¨æ€è¡¨ç°ï¼Œä»è€Œä¸ºå…¶åˆ›é€ å‡ºä¸€ä¸ªè¾¹ç•Œã€‚&lt;/p&gt;
&lt;h2 id=&#34;namespace---éš”ç¦»&#34;&gt;Namespace - éš”ç¦»&lt;/h2&gt;
&lt;p&gt;è¿›ç¨‹åªèƒ½çœ‹åˆ°è¢«è§„å®šçš„è§†å›¾ï¼Œå³ éš”ç¦»ï¼Œæ¯”å¦‚é€šè¿‡dockerå¯åŠ¨ä¸€ä¸ª/bin/shï¼Œå†åœ¨å®¹å™¨é‡Œé€šè¿‡pså‘½ä»¤æŸ¥çœ‹è¯¥/bin/shè¿›ç¨‹çš„pidï¼Œä¼šå‘ç°å®ƒçš„pidæ˜¯1ï¼Œä½†æ˜¯å®é™…ä¸Šå®ƒåœ¨å¤–éƒ¨çš„å®¿ä¸»æœºé‡Œçš„pidæ˜¯10ï¼Œä½¿å¾—è®©åœ¨å®¹å™¨é‡Œè¿è¡Œçš„è¿›ç¨‹ä»¥ä¸ºè‡ªå·±å°±åœ¨ä¸€ä¸ªç‹¬ç«‹çš„ç©ºé—´é‡Œï¼Œå®é™…ä¸Šåªæ˜¯è¿›è¡Œäº†é€»è¾‘çš„åˆ’åˆ†ï¼Œæœ¬è´¨è¿˜æ˜¯ä¾èµ–å®¿ä¸»æœºã€‚&lt;/p&gt;
&lt;p&gt;ä½œç”¨ï¼šåœ¨åŒä¸€å°å®¿ä¸»æœºä¸Šè¿è¡Œå¤šä¸ªç”¨æˆ·çš„å®¹å™¨ï¼Œå……åˆ†åˆ©ç”¨ç³»ç»Ÿèµ„æºï¼›ä¸åŒç”¨æˆ·ä¹‹é—´ä¸èƒ½è®¿é—®å¯¹æ–¹çš„èµ„æºï¼Œä¿è¯å®‰å…¨ã€‚&lt;/p&gt;
&lt;p&gt;å¸¸è§çš„Namespaceç±»å‹æœ‰ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;PID Namespaceï¼šéš”ç¦»ä¸åŒå®¹å™¨çš„è¿›ç¨‹&lt;/li&gt;
&lt;li&gt;Network Namespaceï¼šéš”ç¦»ä¸åŒå®¹å™¨é—´çš„ç½‘ç»œ&lt;/li&gt;
&lt;li&gt;Mount Namespaceï¼šéš”ç¦»ä¸åŒå®¹å™¨é—´çš„æ–‡ä»¶ç³»ç»Ÿ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;ä¸è™šæ‹ŸåŒ–çš„åŒºåˆ«&lt;/strong&gt;ï¼šè™šæ‹ŸåŒ–æ˜¯åœ¨æ“ä½œç³»ç»Ÿå’Œç¡¬ä»¶ä¸Šè¿›è¡Œéš”ç¦»ï¼Œè™šæ‹Ÿæœºä¸Šçš„åº”ç”¨éœ€è¦ç»è¿‡è™šæ‹Ÿæœºå†ç»è¿‡å®¿ä¸»æœºï¼Œæœ‰ä¸¤ä¸ªå†…æ ¸ï¼Œæœ¬èº«å°±æœ‰æ¶ˆè€—ï¼Œè€Œå®¹å™¨åŒ–åçš„åº”ç”¨ä»…ä»…åªæ˜¯å®¿ä¸»æœºä¸Šçš„è¿›ç¨‹è€Œå·²ï¼Œåªç”¨åˆ°å®¿ä¸»æœºä¸€ä¸ªå†…æ ¸ï¼›&lt;/p&gt;
&lt;p&gt;å› ä¸ºnamespaceéš”ç¦»çš„å¹¶ä¸å½»åº•ï¼Œç”±äºå†…æ ¸å…±äº«ï¼Œå®¹å™¨åŒ–åº”ç”¨ä»ç„¶å¯ä»¥æŠŠå®¿ä¸»æœºçš„æ‰€æœ‰èµ„æºéƒ½åƒæ‰ï¼Œæœ‰äº›èµ„æºä¸èƒ½é€šè¿‡namespaceéš”ç¦»ï¼Œæ¯”å¦‚ä¿®æ”¹äº†å®¹å™¨ä¸Šçš„æ—¶é—´ï¼Œå®¿ä¸»æœºä¸Šçš„æ—¶é—´ä¹Ÿä¼šè¢«æ”¹å˜ï¼Œå› æ­¤éœ€è¦Cgroupsï¼›&lt;/p&gt;
&lt;h2 id=&#34;cgroups---èµ„æºé™åˆ¶&#34;&gt;Cgroups - èµ„æºé™åˆ¶&lt;/h2&gt;
&lt;p&gt;æ˜¯ç”¨æ¥åˆ¶é€ çº¦æŸçš„ä¸»è¦æ‰‹æ®µï¼Œå³æ§åˆ¶è¿›ç¨‹ç»„çš„ä¼˜å…ˆçº§ï¼Œè®¾ç½®è¿›ç¨‹èƒ½å¤Ÿä½¿ç”¨çš„èµ„æºä¸Šé™ï¼Œå¦‚CPUã€å†…å­˜ã€IOè®¾å¤‡çš„æµé‡ç­‰&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚ï¼Œé™å®šå®¹å™¨åªèƒ½ä½¿ç”¨å®¿ä¸»æœº20%çš„CPU&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;docker run -it --cpu-period&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;100000&lt;/span&gt; --cpu-quota&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;20000&lt;/span&gt; ubuntu /bin/bash
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;Cgroups é€šè¿‡ä¸åŒçš„å­ç³»ç»Ÿé™åˆ¶äº†ä¸åŒçš„èµ„æºï¼Œæ¯ä¸ªå­ç³»ç»Ÿé™åˆ¶ä¸€ç§èµ„æºã€‚æ¯ä¸ªå­ç³»ç»Ÿé™åˆ¶èµ„æºçš„æ–¹å¼éƒ½æ˜¯ç±»ä¼¼çš„ï¼Œå°±æ˜¯æŠŠç›¸å…³çš„ä¸€ç»„è¿›ç¨‹åˆ†é…åˆ°ä¸€ä¸ªæ§åˆ¶ç»„é‡Œï¼Œç„¶åé€šè¿‡æ ‘ç»“æ„è¿›è¡Œç®¡ç†ï¼Œæ¯ä¸ªæ§åˆ¶ç»„éƒ½è®¾æœ‰è‡ªå·±çš„èµ„æºæ§åˆ¶å‚æ•°ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;ç›¸äº’å…³ç³»&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;æ¯ä¸ªå­ç³»ç»Ÿæ˜¯ä¸€ä¸ªæ§åˆ¶ç»„ï¼Œæ¯ä¸ªæ§åˆ¶ç»„å¯ä»¥è¢«çœ‹ä½œæ˜¯ä¸€ä¸ªæ ‘çš„èŠ‚ç‚¹ï¼Œæ¯ä¸ªæ§åˆ¶ç»„ä¸‹å¯ä»¥æœ‰å¤šä¸ªå­èŠ‚ç‚¹ï¼Œæ¯”å¦‚æˆ‘ä»¬åœ¨åœ¨CPUå­ç³»ç»Ÿä¸­ï¼Œåˆ›å»ºä¸€ä¸ªDBæ§åˆ¶ç»„ï¼Œç„¶åæŠŠæ‰€æœ‰è¿è¡Œçš„æ•°æ®åº“æœåŠ¡æ”¾åœ¨å…¶ä¸­ï¼Œç„¶åå†åœ¨è¯¥ç»„ä¸‹å†åˆ›å»º MySQLå’ŒMongoDBä¸¤ä¸ªå­ç»„æ¥ï¼Œåˆ†åˆ«åˆ’åˆ†ä¸åŒçš„ä½¿ç”¨èµ„æºï¼Œæ‰€ä»¥å½¢æˆäº†ä¸€é¢—æ ‘ï¼Œå¤§è‡´å°±å¦‚ä¸‹å›¾&lt;/p&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/Cgroup%e7%9b%b8%e4%ba%92%e5%85%b3%e7%b3%bb.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/Cgroup%e7%9b%b8%e4%ba%92%e5%85%b3%e7%b3%bb.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;/sys/fs/cgroup/cpu/{task}/&lt;/code&gt;ç›®å½•è¡¨ç¤ºtaskè¿™ä¸ªä»»åŠ¡æŒ‚åœ¨äº†CPU Cgroupä¸‹ï¼Œåœ¨è¿™ä¸ªç›®å½•ä¸‹æœ‰å¾ˆå¤šçš„é…ç½®æ–‡ä»¶ï¼Œæ¯”å¦‚&lt;code&gt;cpu.cfd_quota_usã€cgroup.procs&lt;/code&gt;ç­‰ï¼Œæ–‡ä»¶å†…å®¹æ˜¯è¯¥taskæ‰€å±è¿›ç¨‹çš„PIDï¼›&lt;/p&gt;
&lt;p&gt;&lt;code&gt;/proc/{PIDå·}/cgroup&lt;/code&gt;æ–‡ä»¶è¡¨ç¤ºè¿™ä¸ªè¿›ç¨‹æ¶‰åŠåˆ°çš„æ‰€æœ‰cgroupå­ç³»ç»Ÿçš„ä¿¡æ¯&lt;/p&gt;
&lt;p&gt;å¸¸è§çš„Cgroupså­ç³»ç»Ÿ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;CPU å­ç³»ç»Ÿï¼Œç”¨æ¥é™åˆ¶ä¸€ä¸ªæ§åˆ¶ç»„ï¼ˆä¸€ç»„è¿›ç¨‹ï¼Œä½ å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªå®¹å™¨é‡Œæ‰€æœ‰çš„è¿›ç¨‹ï¼‰å¯ä½¿ç”¨çš„æœ€å¤§ CPUï¼Œé…åˆcfsï¼ˆå®Œå…¨å…¬å¹³è°ƒåº¦ç®—æ³•ï¼‰å®ç°CPUçš„åˆ†é…å’Œç®¡ç†ã€‚&lt;/p&gt;
&lt;p&gt;cpu shareï¼šç”¨äºcfsä¸­è°ƒåº¦çš„æƒé‡ï¼Œæ¡ä»¶ç›¸åŒçš„æƒ…å†µä¸‹ï¼Œcpushareå€¼è¶Šé«˜ï¼Œåˆ†å¾—çš„æ—¶é—´ç‰‡è¶Šå¤šã€‚&lt;/p&gt;
&lt;p&gt;cpu setï¼šä¸»è¦ç”¨äºè®¾ç½®CPUçš„äº²å’Œæ€§ï¼Œå¯ä»¥é™åˆ¶cgroupä¸­çš„è¿›ç¨‹åªèƒ½åœ¨æŒ‡å®šçš„CPUä¸Šè¿è¡Œï¼Œæˆ–è€…ä¸èƒ½åœ¨æŒ‡å®šçš„CPUä¸Šè¿è¡Œï¼ŒåŒæ—¶cpusetè¿˜èƒ½è®¾ç½®å†…å­˜çš„äº²å’Œæ€§ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;memory å­ç³»ç»Ÿï¼Œç”¨æ¥é™åˆ¶ä¸€ä¸ªæ§åˆ¶ç»„æœ€å¤§çš„å†…å­˜ä½¿ç”¨é‡ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;pids å­ç³»ç»Ÿï¼Œç”¨æ¥é™åˆ¶ä¸€ä¸ªæ§åˆ¶ç»„é‡Œæœ€å¤šå¯ä»¥è¿è¡Œå¤šå°‘ä¸ªè¿›ç¨‹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;cpuset å­ç³»ç»Ÿï¼Œ è¿™ä¸ªå­ç³»ç»Ÿæ¥é™åˆ¶ä¸€ä¸ªæ§åˆ¶ç»„é‡Œçš„è¿›ç¨‹å¯ä»¥åœ¨å“ªå‡ ä¸ªç‰©ç† CPU ä¸Šè¿è¡Œã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Cgroups æœ‰ v1 å’Œ v2 ä¸¤ä¸ªç‰ˆæœ¬ï¼Œv1ä¸­æ¯ä¸ªè¿›ç¨‹åœ¨å„ä¸ªCgroupså­ç³»ç»Ÿä¸­ç‹¬ç«‹é…ç½®ï¼Œå¯ä»¥å±äºä¸åŒçš„groupï¼Œæ¯”è¾ƒçµæ´»ä½†å› ä¸ºæ¯ä¸ªå­ç³»ç»Ÿéƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œä¼šå¯¼è‡´å¯¹åŒä¸€è¿›ç¨‹çš„èµ„æºåè°ƒå›°éš¾ï¼Œæ¯”å¦‚åŒä¸€å®¹å™¨é…ç½®äº†Memory Cgroupå’ŒBlkio Cgroupï¼Œä½†æ˜¯å®ƒä»¬é—´æ— æ³•ç›¸äº’åä½œã€‚&lt;/p&gt;
&lt;p&gt;v2é’ˆå¯¹æ­¤åšäº†æ”¹è¿›ï¼Œä½¿å„ä¸ªå­ç³»ç»Ÿå¯ä»¥åè°ƒç»Ÿä¸€ç®¡ç†èµ„æºã€‚&lt;/p&gt;
&lt;h2 id=&#34;mount-namespaceä¸rootfsæ ¹æ–‡ä»¶ç³»ç»Ÿ&#34;&gt;Mount Namespaceä¸rootfs(æ ¹æ–‡ä»¶ç³»ç»Ÿ)&lt;/h2&gt;
&lt;p&gt;æŒ‚è½½åœ¨å®¹å™¨æ ¹ç›®å½•ä¸Šã€ç”¨æ¥ä¸ºå®¹å™¨è¿›ç¨‹æä¾›éš”ç¦»åæ‰§è¡Œç¯å¢ƒçš„æ–‡ä»¶ç³»ç»Ÿï¼Œå³å®¹å™¨é•œåƒï¼Œä¹Ÿæ˜¯å®¹å™¨çš„æ ¹æ–‡ä»¶ç³»ç»Ÿã€‚Mount Namespaceä¿è¯æ¯ä¸ªå®¹å™¨éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„æ–‡ä»¶ç›®å½•ç»“æ„ã€‚&lt;/p&gt;
&lt;p&gt;é•œåƒå¯ä»¥ç†è§£ä¸ºæ˜¯å®¹å™¨çš„æ–‡ä»¶ç³»ç»Ÿï¼ˆä¸€ä¸ªæ“ä½œç³»ç»Ÿçš„æ‰€æœ‰æ–‡ä»¶å’Œç›®å½•ï¼‰ï¼Œå®ƒæ˜¯åªè¯»çš„ï¼ŒæŒ‚è½½åœ¨å®¿ä¸»æœºçš„ä¸€ä¸ªç›®å½•ä¸Šã€‚åŒä¸€å°æœºå™¨ä¸Šçš„æ‰€æœ‰å®¹å™¨ï¼Œéƒ½å…±äº«å®¿ä¸»æœºæ“ä½œç³»ç»Ÿçš„å†…æ ¸ï¼Œå¦‚æœå®¹å™¨å†…åº”ç”¨ä¿®æ”¹äº†å†…æ ¸å‚æ•°ï¼Œä¼šå½±å“åˆ°æ‰€æœ‰ä¾èµ–çš„åº”ç”¨ã€‚è€Œè™šæ‹Ÿæœºåˆ™éƒ½æ˜¯ç‹¬ç«‹çš„å†…æ ¸å’Œæ–‡ä»¶ç³»ç»Ÿï¼Œå…±äº«å®¿ä¸»æœºçš„ç¡¬ä»¶èµ„æºã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ä¸Šé¢çš„è¯»å†™å±‚é€šå¸¸ä¹Ÿç§°ä¸ºå®¹å™¨å±‚ï¼Œä¸‹é¢çš„åªè¯»å±‚ç§°ä¸ºé•œåƒå±‚ï¼Œæ‰€æœ‰çš„å¢åˆ æŸ¥æ”¹æ“ä½œéƒ½åªä¼šä½œç”¨åœ¨å®¹å™¨å±‚ï¼Œç›¸åŒçš„æ–‡ä»¶ä¸Šå±‚ä¼šè¦†ç›–æ‰ä¸‹å±‚ã€‚æ¯”å¦‚ä¿®æ”¹ä¸€ä¸ªæ–‡ä»¶çš„æ—¶å€™ï¼Œé¦–å…ˆä¼šä»ä¸Šåˆ°ä¸‹æŸ¥æ‰¾æœ‰æ²¡æœ‰è¿™ä¸ªæ–‡ä»¶ï¼Œæ‰¾åˆ°ï¼Œå°±å¤åˆ¶åˆ°å®¹å™¨å±‚ä¸­ï¼Œè¿›è¡Œä¿®æ”¹ï¼Œä¿®æ”¹çš„ç»“æœå°±ä¼šä½œç”¨åˆ°ä¸‹å±‚çš„æ–‡ä»¶ï¼Œè¿™ç§æ–¹å¼ä¹Ÿè¢«ç§°ä¸ºcopy-on-writeã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;æ³¨æ„ç‚¹&#34;&gt;æ³¨æ„ç‚¹&lt;/h2&gt;
&lt;p&gt;å®¹å™¨æ˜¯â€œå•è¿›ç¨‹æ¨¡å‹â€ï¼Œå•è¿›ç¨‹æ¨¡å‹å¹¶ä¸æ˜¯æŒ‡å®¹å™¨åªèƒ½è¿è¡Œä¸€ä¸ªè¿›ç¨‹ï¼Œè€Œæ˜¯æŒ‡å®¹å™¨æ²¡æœ‰ç®¡ç†å¤šä¸ªè¿›ç¨‹çš„èƒ½åŠ›ï¼Œå®ƒåªèƒ½ç®¡ç†ä¸€ä¸ªè¿›ç¨‹ï¼Œå³å¦‚æœåœ¨å®¹å™¨é‡Œå¯åŠ¨äº†ä¸€ä¸ªWeb åº”ç”¨å’Œä¸€ä¸ªnginxï¼Œå¦‚æœnginxæŒ‚äº†ï¼Œä½ æ˜¯ä¸çŸ¥é“çš„ã€‚&lt;/p&gt;
&lt;p&gt;å¦å¤–ï¼Œç›´åˆ°JDK 8u131ä»¥åï¼Œjavaåº”ç”¨æ‰èƒ½å¾ˆå¥½çš„è¿ç”¨åœ¨dockerä¸­ï¼Œåœ¨æ­¤ä¹‹å‰å¯èƒ½å› ä¸ºdockeréš”ç¦»å‡ºçš„é…ç½®å’Œç¯å¢ƒï¼Œå¯¼è‡´JVMåˆå§‹åŒ–é»˜è®¤æ•°å€¼å‡ºé”™ï¼Œå› æ­¤å¦‚æœä½¿ç”¨ä»¥å‰çš„ç‰ˆæœ¬ï¼Œéœ€è¦æ˜¾ç¤ºè®¾ç½®é»˜è®¤é…ç½®ï¼Œæ¯”å¦‚ç›´æ¥è§„å®šå †çš„æœ€å¤§å€¼å’Œæœ€å°å€¼ã€çº¿ç¨‹æ•°ä¹‹ç±»çš„&lt;/p&gt;
&lt;h1 id=&#34;è¿›ç¨‹&#34;&gt;è¿›ç¨‹&lt;/h1&gt;
&lt;p&gt;Linuxä¸­çš„è¿›ç¨‹çŠ¶æ€&lt;/p&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/Linux%e8%bf%9b%e7%a8%8b%e7%8a%b6%e6%80%81.jpeg&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/Linux%e8%bf%9b%e7%a8%8b%e7%8a%b6%e6%80%81.jpeg&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;æ´»ç€çš„è¿›ç¨‹æœ‰ä¸¤ç§çŠ¶æ€ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è¿è¡Œæ€(TASK_RUNNING)ï¼šè¿›ç¨‹æ­£åœ¨è¿è¡Œï¼Œæˆ– å¤„äºrun queueé˜Ÿåˆ—é‡Œç­‰å¾…&lt;/li&gt;
&lt;li&gt;ç¡çœ æ€(TASK_INTERRUPTIBLEã€TASK_UNINTERRUPTIBLE)ï¼šå› ä¸ºéœ€è¦ç­‰å¾…æŸäº›èµ„æºè€Œè¢«æ”¾åœ¨äº†wait queueé˜Ÿåˆ—ï¼Œè¯¥çŠ¶æ€åŒ…æ‹¬ä¸¤ä¸ªå­çŠ¶æ€ï¼š
&lt;ul&gt;
&lt;li&gt;å¯è¢«æ‰“æ–­çŠ¶æ€(TASK_INTERRUPTIBLE)ï¼šæ­¤æ—¶psæŸ¥çœ‹çš„Statçš„å€¼ä¸º S&lt;/li&gt;
&lt;li&gt;ä¸å¯è¢«æ‰“æ–­çŠ¶æ€(TASK_UNINTERRUPTIBLE)ï¼šæ­¤æ—¶psæŸ¥çœ‹çš„Statçš„å€¼ä¸º D&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿›ç¨‹é€€å‡ºæ—¶ä¼šæœ‰ä¸¤ä¸ªçŠ¶æ€ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;EXIT_ZOMBIEçŠ¶æ€ï¼šåƒµå°¸çŠ¶æ€ï¼›ä¹‹æ‰€ä»¥æœ‰è¿™ä¸ªçŠ¶æ€æ˜¯ä¸ºäº†ç»™çˆ¶è¿›ç¨‹å¯ä»¥æŸ¥çœ‹å­è¿›ç¨‹PIDã€ç»ˆæ­¢çŠ¶æ€ã€èµ„æºä½¿ç”¨ä¿¡æ¯çš„æœºä¼šï¼Œå¦‚æœå­è¿›ç¨‹ç›´æ¥æ¶ˆå¤±ï¼Œçˆ¶è¿›ç¨‹åˆ™æ²¡æœ‰æœºä¼šæŒæ¡å­è¿›ç¨‹å…·ä½“çš„ç»ˆæ­¢æƒ…å†µã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;EXIT_DEADçŠ¶æ€ï¼šçœŸæ­£ç»“æŸé€€å‡ºæ—¶ä¸€ç¬é—´çš„çŠ¶æ€&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;initè¿›ç¨‹&#34;&gt;initè¿›ç¨‹&lt;/h2&gt;
&lt;p&gt;initè¿›ç¨‹ä¹Ÿç§°1å·è¿›ç¨‹ï¼Œæ˜¯ç¬¬ä¸€ä¸ªç”¨æˆ·æ€è¿›ç¨‹ï¼Œç”±å®ƒç›´æ¥æˆ–é—´æ¥åˆ›å»ºäº†Namespaceä¸­çš„å…¶ä»–è¿›ç¨‹ã€‚Linuxç³»ç»Ÿæœ¬èº«åœ¨å¯åŠ¨åä¹Ÿæ˜¯è¿™ä¹ˆå¹²çš„ï¼Œä¼šå…ˆæ‰§è¡Œå†…æ ¸æ€ä»£ç ï¼Œç„¶åæ ¹æ®ç¼ºçœè·¯å¾„å°è¯•æ‰§è¡Œ1å·è¿›ç¨‹çš„ä»£ç ï¼Œä»å†…æ ¸æ€åˆ‡æ¢åˆ°ç”¨æˆ·æ€ï¼Œæ¯”å¦‚Systemdã€‚&lt;/p&gt;
&lt;p&gt;åœ¨å®¹å™¨ä¸­ï¼Œæ— æ³•ä½¿ç”¨SIGKILL(-9)å’ŒSIGTOP(19)è¿™ä¸¤ä¸ªä¿¡å·æ€æ­»1å·è¿›ç¨‹ï¼Œä½†å¯¹äºå…¶ä»–killä¿¡å·(æ¯”å¦‚é»˜è®¤çš„killä¿¡å·æ˜¯SIGTERM)ï¼Œå¦‚æœinitè¿›ç¨‹æ³¨å†Œäº†è‡ªå·±å¤„ç†è¯¥ä¿¡å·çš„handlerï¼Œåˆ™1å·è¿›ç¨‹å¯ä»¥åšå‡ºå“åº”ã€‚ä½†æ˜¯ï¼Œå¦‚æœSIGKILLå’ŒSIGTOPä¿¡å·æ˜¯ä»Host Namespaceé‡Œå‘å‡ºçš„ï¼Œåˆ™å¯ä»¥è¢«å“åº”ï¼Œå› ä¸ºæ­¤æ—¶å®¹å™¨é‡Œçš„1å·è¿›ç¨‹åœ¨å®¿ä¸»æœºä¸Šåªæ˜¯ä¸€ä¸ªæ™®é€šè¿›ç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æœ‰æ—¶æ— æ³•è¢«killæ‰çš„åŸå› ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Linuxæ‰§è¡Œkillå‘½ä»¤ï¼Œå®é™…ä¸Šåªæ˜¯å‘é€äº†ä¸€ä¸ªä¿¡å·ç»™åˆ°Linuxè¿›ç¨‹ï¼Œ&lt;strong&gt;å¯è¢«è°ƒåº¦çš„è¿›ç¨‹&lt;/strong&gt;åœ¨æ”¶åˆ°ä¿¡å·åï¼Œä¸€èˆ¬ä¼šä» **é»˜è®¤è¡Œä¸º(æ¯ä¸ªä¿¡å·éƒ½æœ‰)ã€å¿½ç•¥ã€æ•è·åå¤„ç†ï¼ˆéœ€è¦ç”¨æˆ·è¿›ç¨‹è‡ªå·±é’ˆå¯¹è¿™ä¸ªä¿¡å·åšhandlerï¼‰**ä¸­è¿›è¡Œæ“ä½œï¼Œä½†SIGKILLå’ŒSIGTOPè¿™ä¸¤ä¸ªä¿¡å·æ˜¯ç‰¹æƒä¿¡å·ï¼Œä¸å…è®¸è¢«è‡ªè¡Œæ•è·å¤„ç†ä¹Ÿæ— æ³•å¿½ç•¥ï¼Œåªèƒ½æ‰§è¡Œç³»ç»Ÿçš„é»˜è®¤è¡Œä¸ºã€‚&lt;/p&gt;
&lt;p&gt;æ‰§è¡Œkillå‘½ä»¤æ—¶ï¼Œä¼šè°ƒç”¨ä¸€ç³»åˆ—å†…æ ¸å‡½æ•°è¿›è¡Œå¤„ç†ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªå‡½æ•°&lt;code&gt;sig_task_ignored&lt;/code&gt;ä¼šåˆ¤æ–­æ˜¯å¦è¦å¿½ç•¥è¿™ä¸ªä¿¡å·ã€‚Linuxå†…æ ¸é‡Œçš„æ¯ä¸ªNamespaceé‡Œçš„initè¿›ç¨‹ï¼Œä¼šå¿½ç•¥åªæœ‰é»˜è®¤handlerçš„ä¿¡å·ï¼Œå³å¦‚æœæˆ‘ä»¬çš„è¿›ç¨‹æœ‰å¤„ç†ç›¸å…³ä¿¡å·çš„handlerï¼Œå°±å¯ä»¥å“åº”ã€‚å¯ä»¥é€šè¿‡&lt;code&gt;cat /proc/{è¿›ç¨‹pid}/status | grep -i SigCgt&lt;/code&gt;æŸ¥çœ‹è¯¥è¿›ç¨‹æ³¨å†Œäº†å“ªäº›handlerã€‚&lt;/p&gt;
&lt;h2 id=&#34;zombieè¿›ç¨‹&#34;&gt;ZOMBIEè¿›ç¨‹&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;ps aux&lt;/code&gt;æŸ¥çœ‹Linuxè¿›ç¨‹ï¼ŒSTATé‡Œçš„çŠ¶æ€æ˜¯Zï¼Œpsåæœ‰defunctæ ‡è®°ï¼Œè¡¨ç¤ºè¯¥è¿›ç¨‹ä¸º&lt;strong&gt;åƒµå°¸è¿›ç¨‹ï¼Œæ­¤æ—¶è¯¥è¿›ç¨‹ä¸å¯è¢«è°ƒåº¦ã€‚åƒµå°¸è¿›ç¨‹æ˜¯Linuxè¿›ç¨‹é€€å‡ºçŠ¶æ€çš„ä¸€ç§ï¼Œè¿›ç¨‹å¤„äºæ­¤çŠ¶æ€ä¸‹ï¼Œæ— æ³•å“åº”killå‘½ä»¤ï¼Œè™½ç„¶èµ„æºè¢«é‡Šæ”¾ï¼Œä½†æ˜¯ä»ç„¶å ç”¨ç€è¿›ç¨‹å·&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å½¢æˆçš„åŸå› ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;çˆ¶è¿›ç¨‹åœ¨åˆ›å»ºå®Œå­è¿›ç¨‹åï¼Œæ²¡æœ‰å¯¹å­è¿›ç¨‹è¿›è¡Œåç»­çš„ç®¡ç†ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å½±å“ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Linuxå†…æ ¸åœ¨åˆå§‹åŒ–ç³»ç»Ÿæ—¶ï¼Œä¼šæ ¹æ®CPUæ•°ç›®é™åˆ¶è¿›ç¨‹æœ€å¤§æ•°é‡ï¼Œé€šè¿‡&lt;code&gt;/proc/sys/kernel/pid_max&lt;/code&gt;æŸ¥çœ‹ï¼Œå¯¹Linuxç³»ç»Ÿè€Œè¨€ï¼Œå®¹å™¨æ˜¯ä¸€ç»„è¿›ç¨‹çš„é›†åˆï¼Œå¦‚æœå®¹å™¨ä¸­çš„åº”ç”¨åˆ›å»ºè¿‡å¤šï¼Œå°±ä¼šå‡ºç°fork bombè¡Œä¸ºï¼Œä¸æ–­å»ºç«‹æ–°è¿›ç¨‹æ¶ˆè€—ç³»ç»Ÿèµ„æºï¼Œå¦‚æœè¾¾åˆ°äº†Linuxæœ€å¤§è¿›ç¨‹æ•°ï¼Œå¯¼è‡´ç³»ç»Ÿä¸å¯ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;è§£å†³æ–¹æ¡ˆï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å› æ­¤å¯¹äºå®¹å™¨ï¼Œä¹Ÿè¦é™åˆ¶å®¹å™¨å†…çš„è¿›ç¨‹æ•°é‡ï¼Œé€šè¿‡pids Cgroupæ¥å®Œæˆï¼Œé™åˆ¶è¿›ç¨‹æ•°ç›®å¤§å°ã€‚åœ¨ä¸€ä¸ªå®¹å™¨å»ºç«‹åï¼Œåˆ›å»ºå®¹å™¨çš„æœåŠ¡ä¼šåœ¨&lt;code&gt;/sys/fs/cgroup/pids&lt;/code&gt;ä¸‹å»ºç«‹ä¸€ä¸ªå­ç›®å½•ä½œä¸ºæ§åˆ¶ç»„ï¼Œé‡Œé¢çš„pids.maxæ–‡ä»¶è¡¨ç¤ºå®¹å™¨å…è®¸çš„æœ€å¤§è¿›ç¨‹æ•°ç›®ã€‚å½“å®¹å™¨å†…è¿›ç¨‹è¾¾åˆ°æœ€å¤§é™åˆ¶åå†èµ·æ–°è¿›ç¨‹ï¼Œä¼šæŠ¥é”™&lt;code&gt;Resource temporarily unavailable&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;å½“å‡ºç°åƒµå°¸è¿›ç¨‹åï¼Œçˆ¶è¿›ç¨‹å¯ä»¥è°ƒç”¨waitå‡½æ•°ï¼ˆè¯¥å‡½æ•°æ˜¯åŒæ­¥é˜»å¡ï¼‰æˆ–è€…è°ƒç”¨waitpidå‡½æ•°ï¼ˆè¯¥å‡½æ•°ä»…åœ¨è°ƒç”¨æ—¶æ£€æŸ¥åƒµå°¸è¿›ç¨‹ï¼Œå¦‚æœæ²¡æœ‰åˆ™è¿”å›ï¼Œä¸ä¼šé˜»å¡ç­‰å¾…ï¼‰å›æ”¶å­è¿›ç¨‹èµ„æºï¼Œé¿å…åƒµå°¸è¿›ç¨‹ çš„äº§ç”Ÿã€‚æˆ–è€…killæ‰åƒµå°¸è¿›ç¨‹çš„çˆ¶è¿›ç¨‹ï¼Œæ­¤æ—¶åƒµå°¸è¿›ç¨‹ä¼šå½’é™„åˆ°initè¿›ç¨‹ä¸‹ï¼Œåˆ©ç”¨initè¿›ç¨‹çš„èƒ½åŠ›å›æ”¶åƒµå°¸è¿›ç¨‹çš„èµ„æºã€‚&lt;/p&gt;
&lt;p&gt;initè¿›ç¨‹æ˜¯æ‰€æœ‰è¿›ç¨‹çš„çˆ¶è¿›ç¨‹ï¼Œinitè¿›ç¨‹å…·å¤‡å›æ”¶åƒµå°¸è¿›ç¨‹çš„èƒ½åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;æˆ–è€…æŠŠå®¹å™¨å†…çš„initè¿›ç¨‹æ›¿æ¢ä¸ºtiniè¿›ç¨‹ï¼Œè¯¥è¿›ç¨‹å…·å¤‡è‡ªåŠ¨å›æ”¶æ”¶å­è¿›ç¨‹çš„èƒ½åŠ›ã€‚&lt;/p&gt;
&lt;h2 id=&#34;è¿›ç¨‹çš„é€€å‡º&#34;&gt;è¿›ç¨‹çš„é€€å‡º&lt;/h2&gt;
&lt;p&gt;å½“æˆ‘ä»¬åœæ­¢ä¸€ä¸ªå®¹å™¨æ—¶ï¼Œæ¯”å¦‚&lt;code&gt;docker stop&lt;/code&gt;ï¼Œå®¹å™¨å†…çš„initè¿›ç¨‹ä¼šæ”¶åˆ°SIGTERMä¿¡å·ï¼Œè€Œå…¶ä»–è¿›ç¨‹ä¼šæ”¶åˆ°SIGKILLä¿¡å·ï¼Œè¿™æ„å‘³ç€åªæœ‰initè¿›ç¨‹æ‰èƒ½æ³¨å†Œhandlerå¤„ç†ä¿¡å·å®ç°graceful shotdownï¼Œè€Œå…¶ä»–è¿›ç¨‹ä¸è¡Œï¼Œç›´æ¥å°±é€€å‡ºäº†ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœæƒ³è¦å®¹å™¨å†…çš„å…¶ä»–è¿›ç¨‹èƒ½æ”¶åˆ°SIGTERMä¿¡å·ï¼Œåªèƒ½åœ¨initè¿›ç¨‹ä¸­æ³¨å†Œä¸€ä¸ªHandlerï¼Œå°†æ”¶åˆ°çš„ä¿¡å·è½¬å‘åˆ°å­è¿›ç¨‹ä¸­ï¼Œåœ¨initè¿›ç¨‹é€€å‡ºä¹‹å‰æŠŠå­è¿›ç¨‹éƒ½åœæ‰ï¼Œå­è¿›ç¨‹å°±ä¸ä¼šæ”¶åˆ°SIGKILLä¿¡å·äº†ã€‚&lt;/p&gt;
&lt;h1 id=&#34;cpu&#34;&gt;CPU&lt;/h1&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/Linux_CPU%e4%bd%bf%e7%94%a8%e5%88%86%e7%b1%bb.jpeg&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/Linux_CPU%e4%bd%bf%e7%94%a8%e5%88%86%e7%b1%bb.jpeg&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;h2 id=&#34;cpu-cgroup&#34;&gt;CPU Cgroup&lt;/h2&gt;
&lt;p&gt;å®¹å™¨ä¼šä½¿ç”¨CPU Cgroupæ¥æ§åˆ¶CPUçš„èµ„æºä½¿ç”¨ã€‚CPU Cgroupåªä¼šå¯¹ç”¨æˆ·æ€uså’Œniã€å†…æ ¸æ€sysåšé™åˆ¶ï¼Œä¸å¯¹waã€hiã€siè¿™äº›I/Oæˆ–è€…ä¸­æ–­ç›¸å…³åšé™åˆ¶ã€‚&lt;/p&gt;
&lt;p&gt;CPU Cgroupä¸€èˆ¬ä¼šé€šè¿‡ä¸€ä¸ªè™šæ‹Ÿæ–‡ä»¶ç³»ç»ŸæŒ‚è½½ç‚¹çš„æ–¹å¼ï¼ŒæŒ‚è½½åœ¨&lt;code&gt;/sys/fs/cgroup/cpu&lt;/code&gt;ç›®å½•ä¸‹ï¼Œæ¯ä¸ªå­ç›®å½•ä¸ºä¸€ä¸ªæ§åˆ¶ç»„ï¼Œå„ä¸ªç›®å½•é—´æ˜¯ä¸€ä¸ªæ ‘çŠ¶çš„å±‚çº§å…³ç³»ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºæ™®é€šè°ƒåº¦ç±»å‹ï¼Œæ¯ä¸ªç›®å½•ä¸‹æœ‰ä¸‰ä¸ªæ–‡ä»¶å¯¹åº”ä¸‰ä¸ªå‚æ•°ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;cpu.cfs_period_us&lt;/code&gt;ï¼šCFSçš„è°ƒåº¦å‘¨æœŸï¼Œå•ä½å¾®ç§’&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;cpu.cfs_quota_us&lt;/code&gt;ï¼šä¸€ä¸ªè°ƒåº¦å‘¨æœŸå†…è¯¥æ§åˆ¶ç»„è¢«å…è®¸è¿è¡Œçš„æ—¶é—´ï¼Œå•ä½å¾®ç§’ï¼Œ&lt;code&gt;CPUæœ€å¤§é…é¢ = cpu.cfs_quota_us / cpu.cfs_period_us &lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;cpu.shares&lt;/code&gt;ï¼šCPU Cgroupå¯¹æ§åˆ¶ç»„ä¹‹é—´çš„CPUåˆ†é…æ¯”ä¾‹ï¼Œåªæœ‰å½“æ§åˆ¶ç»„é—´çš„CPUé…é¢è¶…è¿‡äº†CPUå¯ä»¥èµ„æºçš„æœ€å¤§å€¼ï¼Œåˆ™ä¼šå¯ç”¨è¯¥å‚æ•°è¿›è¡Œé…é¢åˆ†é…ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Linuxä¸­ &lt;code&gt;cpu.cfs_period_us&lt;/code&gt; æ˜¯ä¸ªå›ºå®šå€¼ï¼ŒKubernetesçš„podä¸­ï¼Œé™åˆ¶å®¹å™¨CPUä½¿ç”¨ç‡çš„requestCPUå’ŒlimitCPUæ˜¯é€šè¿‡è°ƒæ•´å…¶ä½™ä¸¤ä¸ªå‚æ•°æ¥å®ç°ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;åœ¨å®¹å™¨å†…ä½¿ç”¨topå‘½ä»¤æŸ¥çœ‹CPUä½¿ç”¨ç‡ï¼Œæ˜¾ç¤ºçš„æ˜¯å®¿ä¸»æœºçš„CPUä½¿ç”¨ç‡ä»¥åŠå•ä¸ªè¿›ç¨‹çš„CPUä½¿ç”¨ç‡ï¼Œæ— æ³•æŸ¥åˆ°è¯¥å®¹å™¨çš„CPUä½¿ç”¨ç‡&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å› ä¸ºtopå‘½ä»¤å¯¹äºå•ä¸ªè¿›ç¨‹è¯»å–&lt;code&gt;/proc/[pid]/stat&lt;/code&gt;é‡Œé¢åŒ…å«è¿›ç¨‹ç”¨æˆ·æ€å’Œå†…æ ¸æ€çš„ticksæ•°ç›®ï¼Œå¯¹äºæ•´ä¸ªèŠ‚ç‚¹è¯»å–çš„æ˜¯&lt;code&gt;/proc/stat&lt;/code&gt;é‡Œå„ä¸ªä¸åŒCPUç±»å‹çš„ticksæ•°ç›®ï¼Œå› ä¸ºè¿™äº›æ–‡ä»¶ä¸å±äºä»»ä½•ä¸€ä¸ªNamespaceï¼Œå› æ­¤æ— æ³•è¯»å–å•ä¸ªå®¹å™¨CPUçš„ä½¿ç”¨ç‡ï¼Œåªèƒ½é€šè¿‡CPU Cgroupçš„æ§åˆ¶ç»„å†…çš„&lt;code&gt;cpuacct.stat&lt;/code&gt;å‚æ•°æ–‡ä»¶è®¡ç®—å¾—åˆ°ï¼Œè¯¥å‚æ•°æ–‡ä»¶åŒ…å«äº†è¿™ä¸ªæ§åˆ¶ç»„é‡Œæ‰€æœ‰è¿›ç¨‹çš„å†…æ ¸æ€tickså’Œç”¨æˆ·æ€ticksçš„å€¼ï¼Œå¸¦å…¥å…¬å¼å³å¯è®¡ç®—å¾—åˆ°ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ticksæ˜¯Linuxæ“ä½œç³»ç»Ÿä¸­çš„ä¸€ä¸ªæ—¶é—´å•ä½ï¼ŒLinuxé€šè¿‡è‡ªå·±çš„æ—¶é’Ÿå‘¨æœŸæ€§äº§ç”Ÿä¸­æ–­ï¼Œæ¯æ¬¡ä¸­æ–­ä¼šè§¦å‘å†…æ ¸åšä¸€æ¬¡è¿›ç¨‹è°ƒåº¦ï¼Œä¸€æ¬¡ä¸­æ–­å°±æ˜¯ä¸€ä¸ªticks&lt;/p&gt;
&lt;p&gt;utimeï¼šè¡¨ç¤ºè¿›ç¨‹åœ¨ç”¨æˆ·æ€éƒ¨åˆ†åœ¨Linuxè°ƒåº¦ä¸­è·å¾—CPUçš„ticksï¼Œè¿™ä¸ªå€¼ä¼šä¸€ç›´ç´¯åŠ &lt;/p&gt;
&lt;p&gt;stimeï¼šè¡¨ç¤ºè¿›ç¨‹åœ¨å†…æ ¸æ€éƒ¨åˆ†åœ¨Linuxè°ƒåº¦ä¸­è·å¾—CPUçš„ticksï¼Œè¿™ä¸ªå€¼ä¼šä¸€ç›´ç´¯åŠ &lt;/p&gt;
&lt;p&gt;HZï¼šæ—¶é’Ÿé¢‘ç‡&lt;/p&gt;
&lt;p&gt;etï¼šutime_1å’Œutime_2è¿™ä¸¤ä¸ªå€¼çš„æ—¶é—´é—´éš”&lt;/p&gt;
&lt;p&gt;è¿›ç¨‹çš„ CPU ä½¿ç”¨ç‡ =((utime_2 â€“ utime_1) + (stime_2 â€“ stime_1)) * 100.0 / (HZ * et * CPUä¸ªæ•° )&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;load-averageå¹³å‡è´Ÿè½½&#34;&gt;Load Averageå¹³å‡è´Ÿè½½&lt;/h2&gt;
&lt;p&gt;Load Averageæ˜¯æŒ‡&lt;strong&gt;Linuxè¿›ç¨‹è°ƒåº¦å™¨ä¸­ä¸€æ®µæ—¶é—´å†…ï¼Œå¯è¿è¡Œé˜Ÿåˆ—é‡Œçš„è¿›ç¨‹å¹³å‡æ•° + ä¼‘çœ é˜Ÿåˆ—ä¸­ä¸å¯æ‰“æ–­çš„è¿›ç¨‹å¹³å‡æ•°&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥ï¼Œæœ‰å¯èƒ½åœ¨ä½¿ç”¨topå‘½ä»¤æ—¶è§‚å¯Ÿåˆ° æ˜æ˜CPUç©ºé—²ç‡å¾ˆé«˜ï¼Œä½†æ˜¯Load Averageçš„æ•°å€¼ä¹Ÿå¾ˆé«˜ï¼ŒCPUæ€§èƒ½ä¸‹é™ï¼Œå› ä¸ºæ­¤æ—¶ä¼‘çœ é˜Ÿåˆ—ä¸­æœ‰å¾ˆå¤šåœ¨ç­‰å¾…çš„è¿›ç¨‹ï¼Œè¿™äº›è¿›ç¨‹çš„statæ˜¯Dï¼Œè¿™ç§çŠ¶æ€å¯èƒ½æ˜¯IOæˆ–è€…ä¿¡å·é‡é”çš„è®¿é—®å¯¼è‡´ã€‚&lt;/p&gt;
&lt;h1 id=&#34;å†…å­˜&#34;&gt;å†…å­˜&lt;/h1&gt;
&lt;p&gt;&lt;strong&gt;Linuxè¿›ç¨‹çš„å†…å­˜ç”³è¯·ç­–ç•¥&lt;/strong&gt;ï¼šLinuxå…è®¸è¿›ç¨‹åœ¨ç”³è¯·å†…å­˜æ—¶overcommitï¼Œå³å…è®¸è¿›ç¨‹ç”³è¯·è¶…è¿‡å®é™…ç‰©ç†å†…å­˜ä¸Šé™çš„å†…å­˜ã€‚å› ä¸ºç”³è¯·åªæ˜¯ç”³è¯·å†…å­˜çš„è™šæ‹Ÿåœ°å€ï¼Œåªæ˜¯ä¸€ä¸ªåœ°å€èŒƒå›´ï¼Œåªæœ‰çœŸæ­£å†™å…¥æ•°æ®æ—¶ï¼Œæ‰èƒ½å¾—åˆ°çœŸå®çš„ç‰©ç†å†…å­˜ï¼Œå½“ç‰©ç†å†…å­˜ä¸å¤Ÿæ—¶ï¼ŒLinuxå°±ä¼šæ ¹æ®ä¸€å®šçš„ç­–ç•¥æ€æ­»æŸä¸ªæ­£åœ¨è¿è¡Œçš„è¿›ç¨‹ï¼Œå½“å®¹å™¨å†…å­˜ä½¿ç”¨ç‡è¶…è¿‡é™åˆ¶å€¼æ—¶ï¼Œå®¹å™¨å°±ä¼šå‡ºç°OOM Killedã€‚&lt;/p&gt;
&lt;p&gt;OOM Killedçš„æ ‡å‡†æ˜¯é€šè¿‡&lt;code&gt;oom_badnesså‡½æ•°&lt;/code&gt;å†³å®šï¼Œé€šè¿‡ä»¥ä¸‹ä¸¤ä¸ªå€¼çš„ä¹˜ç§¯å†³å®šï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è¿›ç¨‹å·²ç»ä½¿ç”¨çš„ç‰©ç†å†…å­˜é¡µé¢æ•°&lt;/li&gt;
&lt;li&gt;æ¯ä¸ªè¿›ç¨‹çš„OOMæ ¡å‡†å€¼oom_score_adjï¼Œåœ¨&lt;code&gt;/proc/[pid]/oom_score_adj&lt;/code&gt;æ–‡ä»¶ä¸­ï¼Œè¯¥å€¼ç”¨äºè°ƒæ•´è¿›ç¨‹è¢«OOM Killçš„å‡ ç‡&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;Linuxçš„å†…å­˜ç±»å‹&lt;/strong&gt;ï¼šæœ‰ä¸¤ç±»ï¼Œä¸€ç±»æ˜¯å†…æ ¸ä½¿ç”¨çš„å†…å­˜ï¼Œå¦‚é¡µè¡¨ã€å†…æ ¸æ ˆã€slabç­‰å„ç§cache poolï¼ˆåŒ¿åé¡µï¼‰ï¼›å¦ä¸€ç±»æ˜¯ç”¨æˆ·æ€ä½¿ç”¨çš„å†…å­˜ï¼Œå¦‚å †å†…å­˜ã€æ ˆå†…å­˜ã€å…±äº«åº“å†…å­˜ã€æ–‡ä»¶è¯»å†™çš„Page Cacheï¼ˆæ–‡ä»¶é¡µï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;RSSï¼ˆResident Set Sizeï¼‰&lt;/strong&gt;ï¼šè¿›ç¨‹çœŸæ­£ç”³è¯·åˆ°çš„ç‰©ç†é¡µé¢çš„å†…å­˜å¤§å°ï¼ŒRSSå†…å­˜åŒ…æ‹¬äº†è¿›ç¨‹çš„ä»£ç æ®µå†…å­˜ï¼Œå †å†…å­˜ã€æ ˆå†…å­˜ã€å…±äº«åº“å†…å­˜ï¼Œæ¯ä¸€éƒ¨åˆ†RSSå†…å­˜çš„å¤§å°å¯æŸ¥çœ‹&lt;code&gt;/proc/[pid]/smaps&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Page Cache&lt;/strong&gt;ï¼šä¸ºäº†æé«˜ç£ç›˜æ–‡ä»¶çš„è¯»å†™æ€§èƒ½ï¼ŒLinuxåœ¨æœ‰ç©ºé—²çš„å†…å­˜æ—¶ï¼Œé»˜è®¤ä¼šæŠŠè¯»å†™è¿‡çš„é¡µé¢æ”¾åœ¨Page Cacheé‡Œï¼Œä¸€æ—¦è¿›ç¨‹éœ€è¦æ›´å¤šçš„ç‰©ç†å†…å­˜ï¼Œä½†å‰©ä½™çš„å†…å­˜ä¸å¤Ÿï¼Œåˆ™ä¼šä½¿ç”¨(page frame reclaim)è¿™ç§å†…å­˜é¡µé¢å›æ”¶æœºåˆ¶ï¼Œæ ¹æ®ç³»ç»Ÿé‡Œç©ºé—²ç‰©ç†å†…å­˜æ˜¯å¦ä½äºæŸä¸ªé˜ˆå€¼ï¼Œå†³å®šæ˜¯å¦å›æ”¶Page Cacheå ç”¨çš„å†…å­˜ã€‚&lt;/p&gt;
&lt;h2 id=&#34;memory-cgroup&#34;&gt;Memory Cgroup&lt;/h2&gt;
&lt;p&gt;Memory Cgroupä¸€èˆ¬ä¼šé€šè¿‡ä¸€ä¸ªè™šæ‹Ÿæ–‡ä»¶ç³»ç»ŸæŒ‚è½½ç‚¹çš„æ–¹å¼ï¼ŒæŒ‚è½½åœ¨&lt;code&gt;/sys/fs/cgroup/memory&lt;/code&gt;ç›®å½•ä¸‹ï¼Œæ¯ä¸ªå­ç›®å½•ä¸ºä¸€ä¸ªæ§åˆ¶ç»„ï¼Œå„ä¸ªç›®å½•é—´æ˜¯ä¸€ä¸ªæ ‘çŠ¶çš„å±‚çº§å…³ç³»ã€‚æ¯ä¸ªç›®å½•æœ‰å¾ˆå¤šå‚æ•°æ–‡ä»¶ï¼Œè·ŸOOMç›¸å…³çš„æœ‰3ä¸ª&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;memory.limit_in_bytes&lt;/code&gt;ï¼šæ§åˆ¶æ§åˆ¶ç»„é‡Œè¿›ç¨‹å¯ä½¿ç”¨çš„å†…å­˜æœ€å¤§å€¼ï¼Œçˆ¶èŠ‚ç‚¹çš„æ§åˆ¶ç»„å†…è¯¥å€¼å¯ä»¥é™åˆ¶å®ƒçš„å­èŠ‚ç‚¹æ‰€æœ‰è¿›ç¨‹çš„å†…å­˜ä½¿ç”¨ï¼ŒKubernetesçš„limitæ”¹çš„å°±æ˜¯è¯¥å€¼ï¼Œè€Œrequestä»…åœ¨è°ƒåº¦æ—¶è®¡ç®—èŠ‚ç‚¹æ˜¯å¦æ»¡è¶³ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;memory.oom_control&lt;/code&gt;ï¼šå½“æ§åˆ¶ç»„ä¸­çš„è¿›ç¨‹å†…å­˜ä½¿ç”¨è¾¾åˆ°ä¸Šé™æ—¶ï¼Œè¯¥å‚æ•°å†³å®šæ˜¯å¦è§¦å‘OOM Killedï¼Œé»˜è®¤æ˜¯ä¼šè§¦å‘OOM Killedï¼Œåªèƒ½æ€æ­»æ§åˆ¶ç»„å†…çš„è¿›ç¨‹ï¼Œæ— æ³•æ€æ­»èŠ‚ç‚¹ä¸Šçš„å…¶ä»–è¿›ç¨‹ã€‚å½“å€¼è®¾ç½®ä¸º1æ—¶ï¼Œè¡¨ç¤ºæ§åˆ¶ç»„å†…è¿›ç¨‹å³ä½¿è¾¾åˆ°limit_in_bytesè®¾ç½®çš„å€¼ï¼Œä¹Ÿä¸ä¼šè§¦å‘OOM Killedï¼Œä½†æ˜¯è¿™å¯èƒ½ä¼šå½±å“æ§åˆ¶ç»„ä¸­æ­£åœ¨ç”³è¯·ç‰©ç†å†…å­˜é¡µé¢çš„è¿›ç¨‹ï¼Œé€ æˆè¯¥è¿›ç¨‹å¤„äºåœæ­¢çŠ¶æ€ï¼Œæ— æ³•ç»§ç»­è¿è¡Œã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;memory.usage_in_bytes&lt;/code&gt;ï¼šè¡¨ç¤ºå½“å‰æ§åˆ¶ç»„é‡Œæ‰€æœ‰è¿›ç¨‹å®é™…ä½¿ç”¨çš„å†…å­˜æ€»å’Œï¼Œä¸limit_in_bytesçš„å€¼è¶Šæ¥è¿‘ï¼Œè¶Šå®¹æ˜“è§¦å‘OOM Killedã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å½“å‘é€OOM killedæ—¶ï¼Œå¯ä»¥æŸ¥çœ‹å†…æ ¸æ—¥å¿— &lt;code&gt;journalctl -k æˆ–è€… æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶ /var/log/message&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Memory Cgroupåªç»Ÿè®¡äº†RSSå’ŒPage Cacheè¿™ä¸¤éƒ¨åˆ†å†…å­˜ï¼Œä¸¤è€…çš„å’Œç­‰äº &lt;code&gt;memory.usage_in_bytes&lt;/code&gt;ï¼Œå½“æ§åˆ¶ç»„é‡Œçš„è¿›ç¨‹è¦ç”³è¯·æ–°çš„ç‰©ç†å†…å­˜ï¼Œä½†&lt;code&gt;memory.usage_in_bytes&lt;/code&gt;å·²è¶…è¿‡&lt;code&gt;memory.limit_in_bytes&lt;/code&gt;ï¼Œæ­¤æ—¶ä¼šå¯ç”¨&lt;code&gt;page frame reclaimå†…å­˜é¡µé¢&lt;/code&gt;å›æ”¶æœºåˆ¶ï¼Œå›æ”¶Page Cacheçš„å†…å­˜ã€‚&lt;/p&gt;
&lt;p&gt;åˆ¤æ–­å®¹å™¨çœŸå®çš„å†…å­˜ä½¿ç”¨é‡ï¼Œä¸èƒ½ä»…é Memory Cgroupé‡Œçš„&lt;code&gt;memory.usage_in_bytes&lt;/code&gt;ï¼Œè€Œéœ€è¦&lt;code&gt;memory.stat&lt;/code&gt;é‡Œçš„rsså€¼ï¼Œè¯¥å€¼æ‰çœŸæ­£ååº”äº†å®¹å™¨ä½¿ç”¨çš„çœŸå®ç‰©ç†å†…å­˜çš„å¤§å°ã€‚&lt;/p&gt;
&lt;h2 id=&#34;swap&#34;&gt;Swap&lt;/h2&gt;
&lt;p&gt;å®¹å™¨å¯ä»¥ä½¿ç”¨Swapç©ºé—´ï¼Œä½†ä¼šå¯¼è‡´Memory Cgroupå¤±æ•ˆï¼Œæ¯”å¦‚åœ¨Swapç©ºé—´è¶³å¤Ÿçš„æƒ…å†µä¸‹ï¼Œè®¾ç½®å®¹å™¨limitä¸º512MBï¼Œç„¶åå®¹å™¨ç”³è¯·äº†1Gå†…å­˜ï¼Œæ˜¯å¯ä»¥ç”³è¯·æˆåŠŸçš„ï¼Œæ­¤æ—¶å®¹å™¨çš„RSSä¸º512MBï¼ŒSwapåªå‰©ä¸‹512MBç©ºé—²ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨swapinessï¼Œå‚æ•°æ–‡ä»¶åœ¨&lt;code&gt;/proc/sys/vm/swapiness&lt;/code&gt;ï¼Œé€šè¿‡å®ƒæ¥è®¾ç½®Swapä½¿ç”¨çš„æƒé‡ï¼Œç”¨äºå®šä¹‰Page Cacheå†…å­˜å’ŒåŒ¿åå†…å­˜é‡Šæ”¾çš„æ¯”ä¾‹å€¼ï¼Œå–å€¼èŒƒå›´æ˜¯0åˆ°100ï¼Œé»˜è®¤æ˜¯60ã€‚100è¡¨ç¤ºåŒ¿åå†…å­˜å’ŒPage Cacheå†…å­˜çš„é‡Šæ”¾æ¯”ä¾‹æ˜¯100ï¼š100ï¼›60è¡¨ç¤ºåŒ¿åå†…å­˜å’ŒPageCacheå†…å­˜çš„é‡Šæ”¾æ¯”ä¾‹æ˜¯60ï¼š140ï¼Œæ­¤æ—¶PageCacheå†…å­˜çš„é‡Šæ”¾ä¼˜å…ˆäºåŒ¿åå†…å­˜ï¼›0ä¸ä¼šå®Œå…¨ç¦æ­¢Swapçš„ä½¿ç”¨ï¼Œåœ¨å†…å­˜ç‰¹åˆ«ç´§å¼ çš„æ—¶å€™æ‰ä¼šå¯ç”¨Swapæ¥å›æ”¶åŒ¿åå†…å­˜ã€‚&lt;/p&gt;
&lt;p&gt;swapinessä¹Ÿå­˜åœ¨äºMemory Cgroupæ§åˆ¶ç»„ä¸­ï¼Œå‚æ•°æ–‡ä»¶æ˜¯&lt;code&gt;memory.swappiness&lt;/code&gt;ï¼Œè¯¥å€¼çš„ä¼˜å…ˆçº§ä¼šå¤§äºå…¨å±€çš„swappinessï¼Œä½†æœ‰ä¸€ç‚¹è·Ÿå…¨å±€çš„swappinessä¸å¤ªä¸€æ ·ï¼Œå½“&lt;code&gt;memory.swappiness=0&lt;/code&gt;æ—¶ï¼Œæ˜¯å®Œå…¨ä¸ä½¿ç”¨Swapç©ºé—´çš„ã€‚&lt;/p&gt;
&lt;p&gt;é€šè¿‡&lt;code&gt;memory.swappiness&lt;/code&gt;å‚æ•°å¯ä»¥ä½¿å¾—éœ€è¦ä½¿ç”¨Swapå®¹å™¨å’Œä¸éœ€è¦ä½¿ç”¨Swapçš„å®¹å™¨ï¼ŒåŒæ—¶è¿è¡Œåœ¨åŒä¸€ä¸ªèŠ‚ç‚¹ä¸Šã€‚&lt;/p&gt;
&lt;h1 id=&#34;å­˜å‚¨&#34;&gt;å­˜å‚¨&lt;/h1&gt;
&lt;p&gt;Linuxä¸¤ç§æ–‡ä»¶ I / Oæ¨¡å¼ï¼š&lt;/p&gt;
&lt;p&gt;Direct I/Oï¼šç”¨æˆ·è¿›ç¨‹å†™ç£ç›˜æ–‡ä»¶ï¼Œé€šè¿‡Linuxå†…æ ¸æ–‡ä»¶ç³»ç»Ÿ -&amp;gt; å—è®¾å¤‡å±‚ -&amp;gt; ç£ç›˜é©±åŠ¨ -&amp;gt; ç£ç›˜ç¡¬ä»¶ï¼Œç›´åˆ°è½ç›˜ã€‚&lt;/p&gt;
&lt;p&gt;Buffer I/Oï¼šå…ˆæŠŠæ–‡ä»¶æ•°æ®å†™å…¥å†…å­˜å°±è¿”å›ï¼ŒLinuxå†…æ ¸æœ‰ç°æˆä¼šæŠŠå†…å­˜ä¸­çš„æ•°æ®å†å†™å…¥ç£ç›˜ï¼Œæ€§èƒ½æ›´ä½³ã€‚&lt;/p&gt;
&lt;p&gt;å½“æ–‡ä»¶æ•°æ®å…ˆå†™å…¥å†…å­˜æ—¶ï¼Œå­˜åœ¨å†…å­˜çš„æ•°æ®å« dirty pages&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å½“ dirty pages æ•°é‡è¶…è¿‡ dirty_background_ratioï¼ˆç™¾åˆ†æ¯”ï¼Œé»˜è®¤æ˜¯10%ï¼‰ å¯¹åº”çš„å†…å­˜é‡çš„æ—¶å€™ï¼Œå†…æ ¸ flush çº¿ç¨‹å°±ä¼šå¼€å§‹æŠŠ dirty pages å†™å…¥ç£ç›˜ ;&lt;/p&gt;
&lt;p&gt;å½“ dirty pages æ•°é‡è¶…è¿‡ dirty_ratio ï¼ˆç™¾åˆ†æ¯”ï¼Œé»˜è®¤æ˜¯20%ï¼‰å¯¹åº”çš„å†…å­˜é‡ï¼Œè¿™æ—¶å€™ç¨‹åºå†™æ–‡ä»¶çš„å‡½æ•°è°ƒç”¨ write() å°±ä¼šè¢«é˜»å¡ä½ï¼Œç›´åˆ°è¿™æ¬¡è°ƒç”¨çš„ dirty pages å…¨éƒ¨å†™å…¥åˆ°ç£ç›˜ï¼›&lt;/p&gt;
&lt;p&gt;dirty_writeback_centisecsï¼Œæ—¶é—´å€¼ï¼Œå•ä½æ˜¯ç™¾åˆ†ä¹‹ä¸€ç§’ï¼Œé»˜è®¤æ˜¯5ç§’ï¼Œå³æ¯5sä¼šå”¤é†’å†…æ ¸çš„flushçº¿ç¨‹æ¥å¤„ç†dirty pagesï¼›&lt;/p&gt;
&lt;p&gt;dirty_expire_centisecsï¼Œæ—¶é—´å€¼ï¼Œå•ä½æ˜¯ç™¾åˆ†ä¹‹ä¸€ç§’ï¼Œé»˜è®¤æ˜¯30sï¼Œå®šä¹‰dirty pagesåœ¨å†…å­˜çš„å­˜æ”¾çš„æœ€é•¿æ—¶é—´ï¼Œå¦‚æœè¶…è¿‡è¯¥æ—¶é—´ï¼Œå°±ä¼šå”¤é†’å†…æ ¸çš„flushçº¿ç¨‹å¤„ç†dirty pagesï¼›&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;unionfs&#34;&gt;UnionFS&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;å°†å¤šä¸ªç›®å½•(å¤„äºä¸åŒçš„åˆ†åŒº)ä¸€èµ·æŒ‚è½½åœ¨ä¸€ä¸ªç›®å½•ä¸‹ï¼Œå®ç°å¤šç›®å½•æŒ‚è½½&lt;/strong&gt;ã€‚è¿™ç§æ–¹å¼å¯ä»¥ä½¿å¾—åŒä¸€èŠ‚ç‚¹ä¸Šï¼Œå¤šä¸ªå®¹å™¨ä½¿ç”¨åŒä¸€ä»½åŸºç¡€é•œåƒï¼Œå‡å°‘ç£ç›˜å†—ä½™çš„é•œåƒæ•°æ®ã€‚OverlayFSæ˜¯å…¶ä¸­çš„ä¸€ç§å®ç°ã€‚&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚å®¹å™¨Aå’Œå®¹å™¨Béƒ½ä½¿ç”¨äº†ubuntuä½œä¸ºåŸºç¡€é•œåƒï¼Œæ”¾åœ¨ç›®å½•/ubuntuä¸Šï¼Œå®¹å™¨Aä½¿ç”¨çš„é¢å¤–åº”ç”¨ç¨‹åºæ”¾åœ¨appAç›®å½•ï¼Œå®¹å™¨Bçš„æ”¾åœ¨appBç›®å½•ï¼Œå°†/ubuntuç›®å½•å’ŒappAç›®å½•åŒæ—¶æŒ‚è½½åœ¨containAç›®å½•ä¸‹ï¼Œä½œä¸ºå®¹å™¨Açœ‹åˆ°çš„æ–‡ä»¶ç³»ç»Ÿï¼ŒåŒç†å®¹å™¨Bä¹Ÿæ˜¯ï¼Œæ­¤æ—¶èŠ‚ç‚¹å°±åªéœ€è¦ä¿å­˜ä¸€ä»½ubuntué•œåƒæ–‡ä»¶å³å¯ã€‚&lt;/p&gt;
&lt;h2 id=&#34;overlayfs&#34;&gt;OverlayFS&lt;/h2&gt;
&lt;p&gt;OverlayFSæ˜¯ä¸€ç§å †å æ–‡ä»¶ç³»ç»Ÿï¼Œä¾èµ–å¹¶å»ºç«‹åœ¨å…¶ä»–æ–‡ä»¶ç³»ç»Ÿä¹‹ä¸Šï¼Œå¦‚EXT4FSã€XFSç­‰ï¼Œå¹¶ä¸ç›´æ¥å‚ä¸ç£ç›˜ç©ºé—´ç»“æ„çš„åˆ’åˆ†ï¼Œä»…å°†åŸæ¥åº•å±‚æ–‡ä»¶ç³»ç»Ÿä¸­ä¸åŒç›®å½•è¿›è¡Œåˆå¹¶ï¼Œç”¨æˆ·è§åˆ°çš„Overlayæ–‡ä»¶ç³»ç»Ÿæ ¹ç›®å½•ä¸‹çš„å†…å®¹å°±æ¥è‡ªæŒ‚è½½æ—¶æŒ‡å®šçš„ä¸åŒç›®å½•çš„åˆé›†ï¼ŒOverlayFSä¼šå°†æŒ‚è½½çš„æ–‡ä»¶è¿›è¡Œåˆ†å±‚ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;lowerï¼šæ–‡ä»¶çš„æœ€åº•å±‚ï¼Œä¸å…è®¸è¢«ä¿®æ”¹ï¼Œåªè¯»ï¼ŒOverlayFSæ”¯æŒå¤šä¸ªlowerdirï¼Œæœ€å¤š500ä¸ªï¼›&lt;/li&gt;
&lt;li&gt;upperï¼šå¯è¯»å†™å±‚ï¼Œæ–‡ä»¶çš„åˆ›å»ºã€ä¿®æ”¹ã€åˆ é™¤éƒ½ä¼šåœ¨è¿™ä¸€å±‚ååº”ï¼Œåªæœ‰ä¸€ä¸ªï¼›&lt;/li&gt;
&lt;li&gt;mergedï¼šæŒ‚è½½ç‚¹ç›®å½•ï¼Œç”¨æˆ·å®é™…å¯¹æ–‡ä»¶çš„æ“ä½œéƒ½åœ¨è¿™é‡Œè¿›è¡Œï¼›&lt;/li&gt;
&lt;li&gt;workï¼šå­˜æ”¾ä¸´æ—¶æ–‡ä»¶çš„ç›®å½•ï¼Œå¦‚æœOverlayFSä¸­æœ‰æ–‡ä»¶ä¿®æ”¹ï¼Œä¸­é—´è¿‡ç¨‹ä¸­ä¼šä¸´æ—¶å­˜æ”¾æ–‡ä»¶åˆ°è¿™é‡Œï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸Šä¸‹å±‚åŒåç›®å½•åˆå¹¶ï¼Œä¸Šä¸‹å±‚åŒåæ–‡ä»¶è¦†ç›–ï¼Œlowerå±‚æ–‡ä»¶å†™æ—¶ä¼šæ‹·è´(copy_up)åˆ°upperå±‚è¿›è¡Œä¿®æ”¹ï¼Œä¸å½±å“lowerå±‚çš„æ–‡ä»¶ã€‚&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚ï¼Œåœ¨mergedç›®å½•é‡Œæ–°å»ºæ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶ä¼šå‡ºç°åœ¨upperç›®å½•ä¸­ï¼›åˆ é™¤æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶ä¼šåœ¨upperç›®å½•ä¸­æ¶ˆå¤±ï¼Œä½†åœ¨lowerç›®å½•é‡Œä¸ä¼šæœ‰å˜åŒ–ï¼Œåªæ˜¯upperç›®å½•ä¸­ä¼šå¢åŠ ä¸€ä¸ªç‰¹æ®Šæ–‡ä»¶å‘Šè¯‰OverlayFSè¯¥æ–‡ä»¶ä¸èƒ½å‡ºç°åœ¨mergedç›®å½•é‡Œï¼Œè¡¨ç¤ºå®ƒè¢«åˆ é™¤ï¼›ä¿®æ”¹æ–‡ä»¶ï¼Œä¼šåœ¨upperç›®å½•ä¸­æ–°å»ºä¸€ä¸ªä¿®æ”¹åçš„æ–‡ä»¶ï¼Œè€Œlowerç›®å½•ä¸­åŸæ¥çš„æ–‡ä»¶ä¸ä¼šæ”¹å˜ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨Dockerä¸­ï¼Œå®¹å™¨é•œåƒæ–‡ä»¶å¯ä»¥åˆ†æˆå¤šä¸ªå±‚ï¼Œæ¯å±‚å¯¹åº”lower dirçš„ä¸€ä¸ªç›®å½•ï¼Œå®¹å™¨å¯åŠ¨åï¼Œå¯¹é•œåƒæ–‡ä»¶ä¸­çš„ä¿®æ”¹ä¼šä¿å­˜åœ¨upper diré‡Œã€‚Dockerä¼šå°†é•œåƒå±‚ä½œä¸ºlower dirï¼Œå®¹å™¨å±‚ä½œä¸ºupper dirï¼Œæœ€åæŒ‚è½½åˆ°å®¹å™¨çš„mergedæŒ‚è½½ç‚¹ï¼Œå³å®¹å™¨çš„æ ¹ç›®å½•ä¸‹ã€‚&lt;/p&gt;
&lt;p&gt;OverlayFSæœ¬èº«æ²¡æœ‰é™åˆ¶æ–‡ä»¶å†™å…¥é‡çš„åŠŸèƒ½ï¼Œéœ€è¦ä¾èµ–åº•å±‚æ–‡ä»¶ç³»ç»Ÿï¼Œæ¯”å¦‚XFSæ–‡ä»¶ç³»ç»Ÿçš„quotaï¼Œé™åˆ¶upperç›®å½•çš„å†™å…¥å¤§å°ã€‚&lt;/p&gt;
&lt;h2 id=&#34;blkio-cgroup&#34;&gt;Blkio Cgroup&lt;/h2&gt;
&lt;p&gt;IOPSï¼šæ¯ç§’é’Ÿç£ç›˜è¯»å†™çš„æ¬¡æ•°&lt;/p&gt;
&lt;p&gt;ååé‡ï¼šæ¯ç§’é’Ÿç£ç›˜è¯»å–çš„æ•°æ®é‡ï¼Œæœ‰æ—¶ä¹Ÿç§°ä¸ºå¸¦å®½&lt;/p&gt;
&lt;p&gt;ä¸¤è€…çš„å…³ç³»ï¼šååé‡ = æ•°æ®å—å¤§å° * IOPS&lt;/p&gt;
&lt;p&gt;Blkio Cgroupä¸€èˆ¬ä¼šé€šè¿‡ä¸€ä¸ªè™šæ‹Ÿæ–‡ä»¶ç³»ç»ŸæŒ‚è½½ç‚¹çš„æ–¹å¼ï¼ŒæŒ‚è½½åœ¨&lt;code&gt;/sys/fs/cgroup/blkio&lt;/code&gt;ç›®å½•ä¸‹ï¼Œæ¯ä¸ªå­ç›®å½•ä¸ºä¸€ä¸ªæ§åˆ¶ç»„ï¼Œå„ä¸ªç›®å½•é—´æ˜¯ä¸€ä¸ªæ ‘çŠ¶çš„å±‚çº§å…³ç³»ã€‚æ¯ä¸ªç›®å½•æœ‰å¾ˆå¤šå‚æ•°æ–‡ä»¶ï¼Œæœ‰4ä¸ªä¸»è¦å‚æ•°æ¥é™åˆ¶ç£ç›˜ I/Oæ€§èƒ½ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;blkio.throttle.read_iops_device&lt;/code&gt;ï¼šç£ç›˜è¯»å–IOPSé™åˆ¶&lt;/li&gt;
&lt;li&gt;&lt;code&gt;blkio.throttle.read_bps_device&lt;/code&gt;ï¼šç£ç›˜è¯»å–ååé‡é™åˆ¶&lt;/li&gt;
&lt;li&gt;&lt;code&gt;blkio.throttle.write_iops_device&lt;/code&gt;ï¼šç£ç›˜å†™å…¥IOPSé™åˆ¶&lt;/li&gt;
&lt;li&gt;&lt;code&gt;blkio.throttle.write_bps_device&lt;/code&gt;ï¼šç£ç›˜å†™å…¥ååé‡é™åˆ¶&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä½†åœ¨Cgroup V1ï¼Œåªæœ‰Direct I/Oæ‰èƒ½é€šè¿‡Blkio Cgroupé™åˆ¶ï¼ŒBuffered I/Oä¸èƒ½ï¼Œå› ä¸ºBuffered I/Oä¼šç”¨åˆ°Page Cacheï¼Œä½†V1ç‰ˆæœ¬å„ä¸ªCgroupå­ç³»ç»Ÿç›¸äº’ç‹¬ç«‹ï¼Œæ‰€ä»¥æ²¡åŠæ³•åšé™åˆ¶ã€‚&lt;/p&gt;
&lt;p&gt;Cgroup V2æ‰å¯ä»¥ï¼Œé€šè¿‡é…ç½®Blkio Cgroupå’ŒMemory Cgroupå³å¯è§£å†³ã€‚æœ‰ä¸ªé—®é¢˜æ˜¯ï¼Œå¦‚æœMemory Cgroupçš„&lt;code&gt;memory.limit_in_bytes&lt;/code&gt;è®¾ç½®å¾—æ¯”è¾ƒå°ï¼Œè€Œå®¹å™¨ä¸­è¿›ç¨‹æœ‰å¤§é‡çš„IOã€è¿™æ ·ç”³è¯·æ–°çš„Page Cacheå†…å­˜æ—¶ï¼Œåˆä¼šä¸æ–­é‡Šæ”¾è€çš„å†…å­˜é¡µé¢ï¼Œå¸¦æ¥äº†é¢å¤–çš„å¼€é”€ï¼Œå¯èƒ½ä¼šäº§ç”Ÿå†™å…¥æ³¢åŠ¨ã€‚&lt;/p&gt;
&lt;h1 id=&#34;ç½‘ç»œ&#34;&gt;ç½‘ç»œ&lt;/h1&gt;
&lt;p&gt;å®¹å™¨ç½‘ç»œä¸€ä¸ªNetwork Namespaceç½‘ç»œæ ˆåŒ…æ‹¬ï¼šç½‘å¡ã€å›ç¯è®¾å¤‡ã€è·¯ç”±è¡¨ã€iptablesè§„åˆ™ã€‚&lt;/p&gt;
&lt;h2 id=&#34;network-namespace&#34;&gt;Network Namespace&lt;/h2&gt;
&lt;p&gt;Network Namespaceä¸»è¦ç”¨æ¥éš”ç¦»ç½‘ç»œèµ„æºï¼Œå¦‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç½‘ç»œè®¾å¤‡ï¼Œæ¯”å¦‚ lo(å›ç¯è®¾å¤‡)ã€eth0ç­‰ï¼Œå¯ä»¥é€šè¿‡&lt;code&gt;ip link&lt;/code&gt;å‘½ä»¤æŸ¥çœ‹&lt;/li&gt;
&lt;li&gt;IPv4å’ŒIPv6åè®®æ ˆï¼ŒIPå±‚ä»¥åŠä¸Šé¢çš„TCPå’ŒUDPåè®®æ ˆéƒ½æ˜¯æ¯ä¸ªNamespaceç‹¬ç«‹å·¥ä½œï¼Œè¿™äº›å‚æ•°å¤§éƒ½åœ¨&lt;code&gt;/proc/sys/net&lt;/code&gt;ç›®å½•ä¸‹ï¼ŒåŒ…æ‹¬TCPå’ŒUDPçš„portèµ„æºã€‚&lt;/li&gt;
&lt;li&gt;IPè·¯ç”±è¡¨ï¼Œä¹Ÿæ˜¯æ¯ä¸ªNamespaceç‹¬ç«‹å·¥ä½œï¼Œä½¿ç”¨&lt;code&gt;ip route&lt;/code&gt;å‘½ä»¤æŸ¥çœ‹&lt;/li&gt;
&lt;li&gt;é˜²ç«å¢™è§„åˆ™ï¼Œå³iptablesï¼Œæ¯ä¸ªNamespaceå¯ç‹¬ç«‹é…ç½®&lt;/li&gt;
&lt;li&gt;ç½‘ç»œçŠ¶æ€ä¿¡æ¯ï¼Œå¯ä»¥ä»&lt;code&gt;/proc/net&lt;/code&gt;å’Œ&lt;code&gt;/sys/class/net&lt;/code&gt;é‡ŒæŸ¥çœ‹ï¼ŒåŒ…æ‹¬äº†ä¸Šé¢å‡ ç§èµ„æºçš„çŠ¶æ€ä¿¡æ¯&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åœ¨å®¿ä¸»æœºä¸Šï¼Œå¯ä»¥ä½¿ç”¨&lt;code&gt;lsns -t net&lt;/code&gt;å‘½ä»¤æŸ¥çœ‹ç³»ç»Ÿå·²æœ‰çš„Network Namespaceï¼Œä½¿ç”¨&lt;code&gt;nsenteræˆ–ip netns&lt;/code&gt;è¿™ä¸ªå‘½ä»¤è¿›å…¥æŸä¸ªNetwork Namespaceé‡ŒæŸ¥çœ‹å…·ä½“çš„ç½‘ç»œé…ç½®ã€‚&lt;/p&gt;
&lt;p&gt;ç½‘ç»œç›¸å…³å‚æ•°å¾ˆå¤§ä¸€éƒ¨åˆ†æ”¾åœ¨äº†&lt;code&gt;/proc/sys/net&lt;/code&gt;ç›®å½•ä¸‹ï¼Œæ¯”å¦‚tcpç›¸å…³çš„å‚æ•°ï¼Œå¯ä»¥ç›´æ¥ä¿®æ”¹ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨sysctlå‘½ä»¤ä¿®æ”¹ã€‚&lt;/p&gt;
&lt;p&gt;å‡ºäºå®‰å…¨è€ƒè™‘ï¼Œå¯¹äºéprivilegedå®¹å™¨ï¼Œ&lt;code&gt;/proc/sys&lt;/code&gt;æ˜¯read-onlyæŒ‚è½½çš„ï¼Œå®¹å™¨å¯åŠ¨åæ— æ³•å†…éƒ¨ä¿®æ”¹è¯¥ç›®å½•ä¸‹ç›¸å…³çš„ç½‘ç»œå‚æ•°ï¼Œåªèƒ½é€šè¿‡runC sysctlç›¸å…³æ¥å£ï¼Œåœ¨å®¹å™¨å¯åŠ¨æ—¶å¯¹å®¹å™¨å†…çš„ç½‘ç»œå‚æ•°è¿›è¡Œä¿®æ”¹ï¼Œæ¯”å¦‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä½¿ç”¨Dockerï¼Œå¯ä»¥åŠ ä¸Š &lt;code&gt;--sysctl å‚æ•°å=å‚æ•°å€¼&lt;/code&gt;æ¥ä¿®æ”¹ï¼Œå¦‚æœæ˜¯K8sï¼Œåˆ™éœ€è¦ç”¨åˆ° &lt;code&gt;allowed unsaft sysctl&lt;/code&gt;è¿™ä¸ªç‰¹æ€§äº†ã€‚&lt;/p&gt;
&lt;p&gt;å¯ä»¥ä½¿ç”¨ç³»ç»Ÿå‡½æ•°clone()æˆ–unshare()æ¥åˆ›å»ºNamespaceï¼Œæ¯”å¦‚Dockeræˆ–è€…containerdå¯åŠ¨å®¹å™¨æ—¶ï¼Œæ˜¯é€šè¿‡runCé—´æ¥è°ƒç”¨unshareå‡½æ•°å¯åŠ¨å®¹å™¨çš„ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç½‘ç»œé€šä¿¡&#34;&gt;ç½‘ç»œé€šä¿¡&lt;/h2&gt;
&lt;p&gt;å®¹å™¨ä¸å¤–ç•Œé€šä¿¡ï¼Œæ€»å…±åˆ†æˆä¸¤æ­¥ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;æ•°æ®åŒ…ä»å®¹å™¨çš„Network Namespaceå‘é€åˆ°Host Network Namespace&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ•°æ®åŒ…ä»Host Network Namespaceï¼Œä»å®¿ä¸»æœºçš„eth0ä¸Šå‘é€å‡ºå»&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å¯ä»¥ä½¿ç”¨ tcpdumpæŠ“åŒ…å·¥å…· æŸ¥çœ‹æ•°æ®åŒ…åœ¨å„ä¸ªè®¾å¤‡æ¥å£çš„æ—¥å¿—&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚æŸ¥çœ‹å®¹å™¨å†…eth0æ¥æ”¶æ•°æ®åŒ…çš„æƒ…å†µ &lt;code&gt;ip netns exec [pid] tcpdump -i eth0 host [ç›®æ ‡ipåœ°å€] -nn&lt;/code&gt;ï¼ŒæŸ¥çœ‹veth_hostæˆ–å…¶ä»–è®¾å¤‡ä½¿ç”¨ &lt;code&gt;tcpdump -i [è®¾å¤‡åå¦‚veth_hostã€docker0ã€eth0] host [ç›®æ ‡ipåœ°å€] -nn &lt;/code&gt;&lt;/p&gt;
&lt;h3 id=&#34;åŒä¸€èŠ‚ç‚¹ä¸‹å®¹å™¨é—´çš„é€šä¿¡&#34;&gt;åŒä¸€èŠ‚ç‚¹ä¸‹å®¹å™¨é—´çš„é€šä¿¡&lt;/h3&gt;
&lt;p&gt;åœ¨ Linux ä¸­èƒ½å¤Ÿèµ·åˆ°è™šæ‹Ÿäº¤æ¢æœºä½œç”¨çš„ç½‘ç»œè®¾å¤‡ï¼Œæ˜¯ç½‘æ¡¥ã€‚å®ƒæ˜¯ä¸€ä¸ªå·¥ä½œåœ¨æ•°æ®é“¾è·¯å±‚çš„è®¾å¤‡ï¼Œä¸»è¦åŠŸèƒ½æ˜¯æ ¹æ® MAC åœ°å€æ¥å°†æ•°æ®åŒ…è½¬å‘åˆ°ç½‘æ¡¥çš„ä¸åŒç«¯å£ï¼ˆPortï¼‰ä¸Šï¼Œå› æ­¤Docker é¡¹ç›®ä¼šé»˜è®¤åœ¨å®¿ä¸»æœºä¸Šåˆ›å»ºä¸€ä¸ªåå« docker0 çš„ç½‘æ¡¥ï¼Œå‡¡æ˜¯è¿æ¥åœ¨ docker0 ç½‘æ¡¥ä¸Šçš„å®¹å™¨ï¼Œå°±å¯ä»¥é€šè¿‡å®ƒæ¥è¿›è¡Œé€šä¿¡ã€‚&lt;/p&gt;
&lt;p&gt;å®¹å™¨é‡Œä¼šæœ‰ä¸€ä¸ªeth0ç½‘å¡ï¼Œä½œä¸ºé»˜è®¤çš„è·¯ç”±è®¾å¤‡ï¼Œè¿æ¥åˆ°å®¿ä¸»æœºä¸Šä¸€ä¸ªå«vethxxxçš„è™šæ‹Ÿç½‘å¡ï¼Œè€Œvethxxxç½‘å¡åˆæ’åœ¨äº†docker0ç½‘æ¡¥ä¸Šï¼Œè¿™ä¸€å¥—è™šæ‹Ÿè®¾å¤‡å°±å«åšVeth Pairã€‚æ¯ä¸ªå®¹å™¨å¯¹åº”ä¸€å¥—VethPairè®¾å¤‡ï¼Œå¤šä¸ªå®¹å™¨ä¼šå°†å…¶Veth Pairæ³¨å†Œåˆ°å®¿ä¸»æœºçš„docker0ç½‘æ¡¥ä¸Šï¼Œå³&lt;strong&gt;Veth Pairç›¸å½“äºæ˜¯è¿æ¥ä¸åŒNetwork Namespaceçš„ç½‘çº¿ï¼Œä¸€ç«¯åœ¨å®¹å™¨ï¼Œä¸€ç«¯åœ¨å®¿ä¸»æœº&lt;/strong&gt;ã€‚æ­¤æ—¶ï¼Œæ•°æ®åŒ…å°±èƒ½ä»å®¹å™¨çš„Network Namespaceå‘é€åˆ°Host Network Namespaceä¸Šäº†ã€‚&lt;/p&gt;
&lt;p&gt;docker0å’Œå®¹å™¨ä¼šç»„æˆä¸€ä¸ªå­ç½‘ï¼Œdocker0ä¸Šçš„ipå°±æ˜¯è¿™ä¸ªå­ç½‘çš„ç½‘å…³ipã€‚&lt;/p&gt;
&lt;p&gt;ç½‘ç»œè¯·æ±‚å®é™…ä¸Šå°±æ˜¯åœ¨è¿™äº›è™šæ‹Ÿè®¾å¤‡ä¸Šè¿›è¡Œæ˜ å°„ï¼ˆç»è¿‡è·¯ç”±è¡¨ï¼ŒIPè½¬MACï¼ŒMACè½¬IPï¼‰å’Œè½¬å‘ï¼Œåˆ°è¾¾ç›®çš„åœ°ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;åŒä¸€èŠ‚ç‚¹å†…ï¼Œå®¹å™¨é—´é€šä¿¡ä¸€èˆ¬æµç¨‹&lt;/strong&gt;ï¼šå®¹å™¨Aå¾€å®¹å™¨Bçš„IPå‘å‡ºè¯·æ±‚ï¼Œè¯·æ±‚å…ˆç»è¿‡å®¹å™¨Açš„eth0ç½‘å¡ï¼Œå‘é€ä¸€ä¸ªARPå¹¿æ’­ï¼Œæ‰¾åˆ°å®¹å™¨B IPå¯¹åº”çš„MACåœ°å€ï¼Œå®¿ä¸»æœºä¸Šçš„docker0ç½‘æ¡¥ï¼ŒæŠŠå¹¿æ’­è½¬å‘åˆ°æ³¨å†Œåˆ°å…¶èº«ä¸Šçš„å…¶ä»–å®¹å™¨çš„eth0ï¼Œå®¹å™¨Bæ”¶åˆ°è¯¥å¹¿æ’­åæŠŠMACåœ°å€å‘ç»™docker0ï¼Œdocker0å›ä¼ ç»™å®¹å™¨Aï¼Œå®¹å™¨Aå‘é€æ•°æ®åŒ…ç»™docker0ï¼Œdocker0æ¥æ”¶åˆ°æ•°æ®åŒ…åï¼Œæ ¹æ®æ•°æ®åŒ…çš„ç›®çš„MACåœ°å€ï¼Œå°†å…¶è½¬å‘åˆ°å®¹å™¨Bçš„eth0ï¼Œ&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;åŒä¸€èŠ‚ç‚¹å†…ï¼Œå®¿ä¸»æœºä¸å®¹å™¨é€šä¿¡ä¸€èˆ¬æµç¨‹&lt;/strong&gt;ï¼šå®¿ä¸»æœºå¾€å®¹å™¨çš„IPå‘å‡ºè¯·æ±‚ï¼Œè¿™ä¸ªè¯·æ±‚çš„æ•°æ®åŒ…å…ˆæ ¹æ®è·¯ç”±è§„åˆ™åˆ°è¾¾docker0ç½‘æ¡¥ï¼Œè½¬å‘åˆ°å¯¹åº”çš„Veth Pairè®¾å¤‡ä¸Šï¼Œç”±Veth Pairè½¬å‘ç»™å®¹å™¨å†…çš„åº”ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;å…³äºå®¹å™¨ç¼ºçœä½¿ç”¨çš„peer vethæ–¹æ¡ˆï¼Œç”±äºä»å®¹å™¨çš„veth0åˆ°å®¿ä¸»æœºçš„veth0ä¼šæœ‰ä¸€æ¬¡è½¯ä¸­æ–­ï¼Œå¸¦æ¥äº†é¢å¤–çš„å¼€é”€ï¼Œæ—¶å»¶ä¼šé«˜ä¸€äº›ï¼Œå¯ä»¥ä½¿ç”¨ ipvlan/macvlançš„ç½‘ç»œæ¥å£æ›¿ä»£ï¼Œipvlan/macvlan ç›´æ¥åœ¨ç‰©ç†ç½‘ç»œæ¥å£ä¸Šè™šæ‹Ÿå‡ºæ¥å£ï¼Œå®¹å™¨å‘é€ç½‘ç»œæ•°æ®åŒ…æ—¶ç›´æ¥ä»å®¹å™¨çš„eth0å‘é€ç»™å®¿ä¸»æœºçš„eth0ï¼Œå‡å°‘äº†è½¬å‘æ¬¡æ•°ï¼Œå®å»¶å°±é™ä½äº†ã€‚ä½†æ˜¯è¯¥æ–¹æ¡ˆæ— æ³•ä½¿ç”¨iptablesè§„åˆ™ï¼ŒKubernetesçš„serviceå°±æ— æ³•ä½¿ç”¨è¯¥æ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/%e5%90%8c%e4%b8%80%e8%8a%82%e7%82%b9%e4%b8%8b%e7%9a%84%e5%ae%b9%e5%99%a8%e9%80%9a%e4%bf%a1.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/%e5%90%8c%e4%b8%80%e8%8a%82%e7%82%b9%e4%b8%8b%e7%9a%84%e5%ae%b9%e5%99%a8%e9%80%9a%e4%bf%a1.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;h3 id=&#34;å®¹å™¨è®¿é—®å¦ä¸€èŠ‚ç‚¹&#34;&gt;å®¹å™¨è®¿é—®å¦ä¸€èŠ‚ç‚¹&lt;/h3&gt;
&lt;p&gt;ä¸€ä¸ªèŠ‚ç‚¹å†…çš„å®¹å™¨è®¿é—®å¦ä¸€ä¸ªèŠ‚ç‚¹ä¸€èˆ¬æµç¨‹ï¼šå…ˆç»è¿‡docker0ç½‘æ¡¥ï¼Œå‡ºç°åœ¨å®¿ä¸»æœºä¸Šï¼Œæ ¹æ®è·¯ç”±è¡¨æˆ–è€…natçš„æ–¹å¼ï¼ŒçŸ¥é“ç›®æ ‡èŠ‚ç‚¹æ˜¯å…¶ä»–æœºå™¨ï¼Œåˆ™å°†æ•°æ®è½¬å‘åˆ°å®¿ä¸»æœºçš„eth0ç½‘å¡ä¸Šï¼Œå†å‘å¾€ç›®æ ‡èŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;å…¶å®è·ŸåŒä¸€èŠ‚ç‚¹å†…ï¼Œå®¿ä¸»æœºä¸å®¹å™¨é€šä¿¡ç±»ä¼¼ï¼Œæœ€ç»ˆè½¬åŒ–ä¸ºèŠ‚ç‚¹é—´çš„é€šä¿¡ã€‚&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥å½“å®¹å™¨æ— æ³•è®¿é—®å¤–ç½‘æ—¶ï¼Œå°±å¯ä»¥æ£€æŸ¥docker0ç½‘æ¡¥æ˜¯å¦èƒ½pingé€šï¼ŒæŸ¥çœ‹docker0å’ŒVeth Pairè®¾å¤‡çš„iptablesè§„åˆ™æ˜¯å¦æœ‰å¼‚å¸¸ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/%e5%ae%b9%e5%99%a8%e8%ae%bf%e9%97%ae%e5%8f%a6%e4%b8%80%e8%8a%82%e7%82%b9.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/%e5%ae%b9%e5%99%a8%e8%ae%bf%e9%97%ae%e5%8f%a6%e4%b8%80%e8%8a%82%e7%82%b9.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;h3 id=&#34;ä¸åŒèŠ‚ç‚¹ä¸‹å®¹å™¨é—´çš„é€šä¿¡&#34;&gt;ä¸åŒèŠ‚ç‚¹ä¸‹å®¹å™¨é—´çš„é€šä¿¡&lt;/h3&gt;
&lt;p&gt;é»˜è®¤é…ç½®ä¸‹ï¼Œä¸åŒèŠ‚ç‚¹é—´çš„å®¹å™¨ã€docker0ç½‘æ¡¥ï¼Œæ˜¯ä¸çŸ¥é“å½¼æ­¤çš„ï¼Œæ²¡æœ‰ä»»ä½•å…³è”ï¼Œæƒ³è¦è·¨ä¸»æœºå®¹å™¨é€šä¿¡ï¼Œå°±éœ€è¦åœ¨å¤šä¸»æœºé—´åœ¨å»ºç«‹ä¸€ä¸ªå…¬å…±ç½‘æ¡¥ï¼Œæ‰€æœ‰èŠ‚ç‚¹çš„å®¹å™¨éƒ½å¾€è¿™ä¸ªç½‘æ¡¥æ³¨å†Œï¼Œæ‰èƒ½è¿›è¡Œé€šä¿¡ã€‚é€šè¿‡æ¯å°å®¿ä¸»æœºä¸Šæœ‰ä¸€ä¸ªç‰¹æ®Šç½‘æ¡¥æ¥æ„æˆè¿™ä¸ªå…¬ç”¨ç½‘æ¡¥ï¼Œè¿™ä¸ªæŠ€æœ¯è¢«ç§°ä¸ºoverlay networkï¼ˆè¦†ç›–ç½‘ç»œï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;å¸¸è§çš„è§£å†³æ–¹æ¡ˆæ˜¯Flannelã€Calicoç­‰ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/%e5%ae%b9%e5%99%a8%e7%bd%91%e7%bb%9c.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/%e5%ae%b9%e5%99%a8%e7%bd%91%e7%bb%9c.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;h3 id=&#34;dockerçš„ç½‘ç»œæ¨¡å‹&#34;&gt;Dockerçš„ç½‘ç»œæ¨¡å‹&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;bridgeæ¨¡å¼ï¼ˆé»˜è®¤ï¼‰&lt;/p&gt;
&lt;p&gt;Dockerè¿›ç¨‹å¯åŠ¨æ—¶ï¼Œä¼šåœ¨ä¸»æœºä¸Šåˆ›å»ºä¸€ä¸ªåä¸ºdocker0çš„è™šæ‹Ÿç½‘æ¡¥ï¼Œæ­¤ä¸»æœºä¸Šå¯åŠ¨çš„Dockerå®¹å™¨ä¼šåˆ†é…ä¸€ä¸ªNetwork Namespaceï¼Œé€šè¿‡eth0-vethè™šæ‹Ÿè®¾å¤‡è¿æ¥åˆ°å®¿ä¸»æœºçš„docker0ç½‘æ¡¥ä¸Šã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;hostæ¨¡å¼&lt;/p&gt;
&lt;p&gt;æ­¤æ¨¡å¼ä¸‹å®¹å™¨ä¸ä¼šè·å¾—ç‹¬ç«‹çš„Network Namespaceï¼Œå’Œå®¿ä¸»æœºå…±ç”¨ä¸€ä¸ªNetwork Namespaceï¼Œå®¹å™¨ä¹Ÿä¸ä¼šè™šæ‹Ÿè‡ªå·±çš„ç½‘å¡å’Œipï¼Œè€Œæ˜¯ç”¨å®¿ä¸»æœºçš„ipå’Œç«¯å£ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;containeræ¨¡å¼&lt;/p&gt;
&lt;p&gt;æŒ‡å®šæ–°åˆ›å»ºçš„å®¹å™¨å’Œä¸€ä¸ªå·²å­˜åœ¨çš„å®¹å™¨å…±äº«ä¸€ä¸ªNetwork Namespaceï¼Œæ–°åˆ›å»ºçš„å®¹å™¨ä¸ä¼šåˆ›å»ºè‡ªå·±çš„ç½‘å¡å’ŒIPï¼Œè€Œæ˜¯å’ŒæŒ‡å®šçš„å®¹å™¨å…±äº«IPã€ç«¯å£èŒƒå›´&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;noneæ¨¡å¼&lt;/p&gt;
&lt;p&gt;Dockerå®¹å™¨æ‹¥æœ‰è‡ªå·±çš„Network Namespaceï¼Œä½†å¹¶ä¸ä¸ºDockerå®¹å™¨è¿›è¡Œä»»ä½•ç½‘ç»œé…ç½®ï¼Œéœ€è¦æ‰‹åŠ¨æ·»åŠ ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;å®‰å…¨&#34;&gt;å®‰å…¨&lt;/h1&gt;
&lt;p&gt;è¿›ç¨‹çš„æƒé™åˆ†ä¸ºä¸¤ç±»ï¼Œç‰¹æƒç”¨æˆ·è¿›ç¨‹(è¿›ç¨‹æœ‰æ•ˆç”¨æˆ·IDæ˜¯0ï¼Œrootç”¨æˆ·çš„è¿›ç¨‹)ã€éç‰¹æƒç”¨æˆ·è¿›ç¨‹(è¿›ç¨‹æœ‰æ•ˆç”¨æˆ·IDé0ï¼Œérootç”¨æˆ·çš„è¿›ç¨‹)ï¼Œç‰¹æƒç”¨æˆ·å¯ä»¥æ‰§è¡ŒLinuxç³»ç»Ÿä¸Šæ‰€æœ‰æ“ä½œï¼Œè€Œéç‰¹æƒç”¨æˆ·æ‰§è¡Œè¿™äº›æ“ä½œä¼šè¢«å†…æ ¸é™åˆ¶ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨kernel2.2å¼€å§‹ï¼ŒLinuxæŠŠç‰¹æƒç”¨æˆ·çš„ç‰¹æƒåšäº†åˆ’åˆ†ï¼Œæ¯ä¸ªè¢«åˆ’åˆ†å‡ºæ¥çš„å•å…ƒç§°ä¸ºcapabilityï¼Œæ¯”å¦‚è¿è¡Œiptableså‘½ä»¤ï¼Œå¯¹åº”çš„è¿›ç¨‹éœ€è¦æœ‰CAP_NET_ADMINè¿™ä¸ªcapabilityã€‚érootç”¨æˆ·å¯åŠ¨çš„è¿›ç¨‹é»˜è®¤æ²¡æœ‰ä»»ä½•capabilitiesï¼Œrootç”¨æˆ·åˆ™åŒ…å«äº†æ‰€æœ‰ã€‚å­çˆ¶è¿›ç¨‹çš„capabilitiesæœ‰ç»§æ‰¿å±æ€§ã€‚æŸ¥çœ‹è¿›ç¨‹æ‹¥æœ‰çš„capabilityå‘½ä»¤ï¼š&lt;code&gt;cat /proc/[pid]/status | grep Cap&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºprivilegedå®¹å™¨ï¼Œå®é™…ä¸Šå°±æ˜¯æ‹¥æœ‰äº†æ‰€æœ‰capabilityï¼Œå…è®¸æ‰§è¡Œæ‰€æœ‰ç‰¹æƒæ“ä½œï¼Œæ¯”å¦‚dockerå®¹å™¨å¯åŠ¨æ—¶å¢åŠ å‚æ•° &lt;code&gt;--privileged&lt;/code&gt;ã€‚å®¹å™¨ç¼ºçœå¯åŠ¨æ—¶ï¼Œæ˜¯rootç”¨æˆ·ï¼Œä½†åªå…è®¸äº†15ä¸ªcapabilitiesã€‚&lt;/p&gt;
&lt;p&gt;ä¸€èˆ¬åªç»™å®¹å™¨æ‰€éœ€æ“ä½œçš„æœ€å°capabilitiesï¼Œè€Œä¸æ˜¯ç›´æ¥ç»™privilegedï¼Œå› ä¸ºprivilegedçš„æƒé™å¤ªå¤§ï¼Œå®¹å™¨å¯ä»¥è½»æ˜“è·å–å®¿ä¸»æœºä¸Šçš„æ‰€æœ‰èµ„æºï¼Œæ¯”å¦‚ç›´æ¥è®¿é—®ç£ç›˜è®¾å¤‡ï¼Œä¿®æ”¹å®¿ä¸»æœºä¸Šçš„æ–‡ä»¶ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†ä¿è¯å®¹å™¨è¿è¡Œä¸å¯¹å®¿ä¸»æœºé€ æˆå®‰å…¨å½±å“ï¼Œå¯ä»¥åœ¨å®¹å™¨ä¸­æŒ‡å®šç”¨æˆ·ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨dockerä¸­ï¼Œå¯åŠ¨å®¹å™¨å‘½ä»¤åé¢åŠ &lt;code&gt;-u [uid]/[gid]&lt;/code&gt;ï¼Œæˆ–è€…åœ¨å†™Dockerfileæ—¶æŒ‡å®š(è¿™æ ·å¯åŠ¨å®¹å™¨å°±ä¸ç”¨åŠ -u)ï¼Œ&lt;strong&gt;å®¹å™¨é‡Œçš„ç”¨æˆ·ä¸å®¿ä¸»æœºä¸Šçš„ç”¨æˆ·å…±äº«ï¼Œå³å®¹å™¨ä¸Šçš„uidå®é™…ä¸Šæ˜¯å®¿ä¸»æœºä¸Šçš„uid(rootç”¨æˆ·ä¹Ÿæ˜¯ï¼Œåªæ˜¯å®¹å™¨é‡Œcapabilitiesåªæœ‰15ä¸ªï¼Œè€Œå®¿ä¸»æœºä¸Šçš„rootæœ‰å…¨éƒ¨)&lt;/strong&gt;ï¼Œè¿™æ ·ä¼šäº§ç”Ÿé™åˆ¶ï¼Œå› ä¸ºåœ¨Linuxä¸Šæ¯ä¸ªç”¨æˆ·çš„èµ„æºæ˜¯æœ‰é™çš„ï¼Œæ¯”å¦‚æ‰“å¼€æ–‡ä»¶æ•°ç›®ã€æœ€å¤§è¿›ç¨‹æ•°ç­‰ï¼Œå¦‚æœæœ‰å¤šä¸ªå®¹å™¨å…±äº«åŒä¸€ä¸ªuidï¼Œå°±ä¼šäº’ç›¸å½±å“ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†è§£å†³å®¹å™¨uidå…±äº«é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨User Namespaceã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;User Namespaceæœ¬è´¨ä¸Šæ˜¯å°†å®¹å™¨ä¸­çš„uid/gidä¸å®¿ä¸»æœºä¸Šçš„uid/gidå»ºç«‹æ˜ å°„&lt;/strong&gt;ï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒåµŒå¥—æ˜ å°„ã€‚æ¯”å¦‚åˆ’åˆ†å®¿ä¸»æœºä¸Šçš„uidçš„èŒƒå›´1000-1999ï¼Œå¯¹åº”å®¹å™¨uidçš„0åˆ°999ï¼Œå®¹å™¨é‡Œuidä¹Ÿå¯ä»¥ç»§ç»­åµŒå¥—æ˜ å°„ã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨User Namespaceï¼Œå¯ä»¥æŠŠå®¹å™¨ä¸­rootç”¨æˆ·æ˜ å°„ç§°å®¿ä¸»æœºä¸Šçš„æ™®é€šç”¨æˆ·ï¼Œè§£å†³uidå†²çªå…±äº«é—®é¢˜ï¼Œ&lt;strong&gt;ç›®å‰Kebernetesè¿˜ä¸æ”¯æŒUser Namespace(å½“å‰æ—¶é—´20210920ï¼Œä¸è¿‡githubä¸Šæœ‰präº†)&lt;/strong&gt;&lt;/p&gt;
&lt;h1 id=&#34;runc-ä¸-oci&#34;&gt;runC ä¸ OCI&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;OCIï¼šOpen Container Initiativesï¼Œå›´ç»•å®¹å™¨æ ¼å¼å’Œè¿è¡Œæ—¶åˆ¶å®šä¸€ä¸ªå¼€æ”¾çš„å·¥ä¸šåŒ–æ ‡å‡†ï¼ŒåŒ…å«å®¹å™¨è¿è¡Œæ—¶æ ‡å‡† ï¼ˆruntime specï¼‰å’Œ å®¹å™¨é•œåƒæ ‡å‡†ï¼ˆimage specï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;å®¹å™¨é•œåƒæ ‡å‡† image specï¼šåŒ…å«äº†æ–‡ä»¶ç³»ç»Ÿã€configæ–‡ä»¶ã€manifestæ–‡ä»¶ã€indexæ–‡ä»¶ï¼›&lt;/p&gt;
&lt;p&gt;å®¹å™¨è¿è¡Œæ—¶æ ‡å‡† runtime specï¼šåŒ…å«å®¹å™¨è¿è¡ŒçŠ¶æ€ä»¥åŠéœ€è¦æä¾›çš„å‘½ä»¤ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;runCï¼šä¸€ä¸ªè½»é‡å·¥å…·ï¼ŒåŸºäºlibcontaineråº“ï¼Œç”±golangè¯­è¨€å®ç°ï¼Œä¸éœ€è¦dockerå¼•æ“ï¼Œå®ƒæ ¹æ® OCI æ ‡å‡†æ¥åˆ›å»ºå’Œè¿è¡Œå®¹å™¨çš„ï¼Œå³runCæ˜¯OCIè¿è¡Œæ—¶æ ‡å‡†çš„ä¸€ä¸ªå®ç°ï¼Œä¸åŒ…å«é•œåƒç®¡ç†åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;p&gt;runCæˆä¸ºå®¹å™¨è¿è¡Œæ—¶å®ç°çš„æ ‡å‡†ï¼Œè€Œcontainerdæ˜¯Dockerå‡ºçš„ä¸€ä¸ªä¸­é—´å±‚ï¼Œä¸ºrunCæä¾›æ¥å£ï¼Œä¾›ä¸Šå±‚Docker Daemonè°ƒç”¨ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;OCI bundle ï¼šåŒ…æ‹¬å®¹å™¨çš„æ–‡ä»¶ç³»ç»Ÿå’Œä¸€ä¸ª config.json æ–‡ä»¶ã€‚æœ‰äº†å®¹å™¨çš„æ ¹æ–‡ä»¶ç³»ç»Ÿåå°±å¯ä»¥é€šè¿‡ runc spec å‘½ä»¤æ¥ç”Ÿæˆ config.json æ–‡ä»¶ï¼Œconfig.json æ–‡ä»¶ç”¨äºè¯´æ˜å¦‚ä½•è¿è¡Œå®¹å™¨ï¼ŒåŒ…æ‹¬è¦è¿è¡Œçš„å‘½ä»¤ã€æƒé™ã€ç¯å¢ƒå˜é‡ç­‰ç­‰å†…å®¹&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;OCI å®šä¹‰çš„å®¹å™¨çŠ¶æ€ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;creatingï¼šä½¿ç”¨ create å‘½ä»¤åˆ›å»ºå®¹å™¨ï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºåˆ›å»ºä¸­ã€‚&lt;/li&gt;
&lt;li&gt;createdï¼šå®¹å™¨å·²ç»åˆ›å»ºå‡ºæ¥ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰è¿è¡Œï¼Œè¡¨ç¤ºé•œåƒæ–‡ä»¶å’Œé…ç½®æ²¡æœ‰é”™è¯¯ï¼Œå®¹å™¨èƒ½å¤Ÿåœ¨å½“å‰å¹³å°ä¸Šè¿è¡Œã€‚&lt;/li&gt;
&lt;li&gt;runningï¼šå®¹å™¨é‡Œé¢çš„è¿›ç¨‹å¤„äºè¿è¡ŒçŠ¶æ€ï¼Œæ­£åœ¨æ‰§è¡Œç”¨æˆ·è®¾å®šçš„ä»»åŠ¡ã€‚&lt;/li&gt;
&lt;li&gt;stoppedï¼šå®¹å™¨è¿è¡Œå®Œæˆï¼Œæˆ–è€…è¿è¡Œå‡ºé”™ï¼Œæˆ–è€… stop å‘½ä»¤ä¹‹åï¼Œå®¹å™¨å¤„äºæš‚åœçŠ¶æ€ã€‚è¿™ä¸ªçŠ¶æ€ï¼Œå®¹å™¨è¿˜æœ‰å¾ˆå¤šä¿¡æ¯ä¿å­˜åœ¨å¹³å°ä¸­ï¼Œå¹¶æ²¡æœ‰å®Œå…¨è¢«åˆ é™¤ã€‚&lt;/li&gt;
&lt;li&gt;pausedï¼šæš‚åœå®¹å™¨ä¸­çš„æ‰€æœ‰è¿›ç¨‹ï¼Œå¯ä»¥ä½¿ç”¨ resume å‘½ä»¤æ¢å¤è¿™äº›è¿›ç¨‹çš„æ‰§è¡Œã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;h1 id=&#34;docker&#34;&gt;Docker&lt;/h1&gt;
&lt;h2 id=&#34;è¿›ç¨‹-1&#34;&gt;è¿›ç¨‹&lt;/h2&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;dockerd ï¼šDocker Engineå®ˆæŠ¤è¿›ç¨‹ï¼Œç›´æ¥é¢å‘æ“ä½œç”¨æˆ·ã€‚dockerd å¯åŠ¨æ—¶ä¼šå¯åŠ¨ containerd å­è¿›ç¨‹ï¼Œä»–ä»¬ä¹‹å‰é€šè¿‡RPCè¿›è¡Œé€šä¿¡ã€‚&lt;/li&gt;
&lt;li&gt;containerd ï¼šdockerdå’Œruncä¹‹é—´çš„ä¸€ä¸ªä¸­é—´äº¤æµç»„ä»¶ã€‚ä»–ä¸ dockerd çš„è§£è€¦æ˜¯ä¸ºäº†è®©Dockerå˜å¾—æ›´ä¸ºçš„ä¸­ç«‹ï¼Œè€Œæ”¯æŒOCI çš„æ ‡å‡† ã€‚&lt;/li&gt;
&lt;li&gt;containerd-shim ï¼šç”¨æ¥çœŸæ­£è¿è¡Œçš„å®¹å™¨çš„ï¼Œæ¯å¯åŠ¨ä¸€ä¸ªå®¹å™¨éƒ½ä¼šèµ·ä¸€ä¸ªæ–°çš„shimè¿›ç¨‹ï¼Œ å®ƒä¸»è¦é€šè¿‡æŒ‡å®šçš„ä¸‰ä¸ªå‚æ•°ï¼šå®¹å™¨idï¼Œboundleç›®å½•ï¼ˆcontainerdçš„å¯¹åº”æŸä¸ªå®¹å™¨ç”Ÿæˆçš„ç›®å½•ï¼Œä¸€èˆ¬ä½äºï¼š/var/run/docker/libcontainerd/containerIDï¼‰ï¼Œ å’Œè¿è¡Œå‘½ä»¤ï¼ˆé»˜è®¤ä¸º runcï¼‰æ¥åˆ›å»ºä¸€ä¸ªå®¹å™¨ã€‚&lt;/li&gt;
&lt;li&gt;docker-proxy ï¼šç”¨æˆ·çº§çš„ä»£ç†è·¯ç”±ã€‚åªè¦ä½ ç”¨ ps -elf è¿™æ ·çš„å‘½ä»¤æŠŠå…¶å‘½ä»¤è¡Œæ‰“å‡ºæ¥ï¼Œä½ å°±å¯ä»¥çœ‹åˆ°å…¶å°±æ˜¯åšç«¯å£æ˜ å°„çš„ã€‚å¦‚æœä¸æƒ³è¦è¿™ä¸ªä»£ç†çš„è¯ï¼Œå¯ä»¥åœ¨ dockerd å¯åŠ¨å‘½ä»¤è¡Œå‚æ•°ä¸ŠåŠ ä¸Šï¼š  &amp;ndash;userland-proxy=false è¿™ä¸ªå‚æ•°ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;dockerfile&#34;&gt;Dockerfile&lt;/h2&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.cnblogs.com/panwenbin-logs/p/8007348.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;æŒ‡ä»¤è¯¦è§£&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;RUN&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åé¢ä¸€èˆ¬æ¥shellå‘½ä»¤ï¼Œä½†æ˜¯ä¼šæ„å»ºä¸€å±‚é•œåƒ&lt;/p&gt;
&lt;p&gt;è¦æ³¨æ„RUNæ¯æ‰§è¡Œä¸€æ¬¡æŒ‡ä»¤éƒ½ä¼šåœ¨dockerä¸Šæ–°é”®ä¸€å±‚ï¼Œå¦‚æœå±‚æ•°å¤ªå¤šï¼Œé•œåƒå°±ä¼šå¤ªè¿‡è†¨èƒ€å½±å“æ€§èƒ½ï¼Œè™½ç„¶dockerå…è®¸çš„æœ€å¤§å±‚æ•°æ˜¯127å±‚ã€‚&lt;/p&gt;
&lt;p&gt;æœ‰å¤šæ¡å‘½ä»¤å¯ä»¥ä½¿ç”¨&amp;amp;&amp;amp;è¿æ¥&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;CMD&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¦æ³¨æ„CMDåªå…è®¸æœ‰ä¸€æ¡ï¼Œå¦‚æœæœ‰å¤šæ¡åªæœ‰æœ€åä¸€æ¡ä¼šç”Ÿæ•ˆ&lt;/p&gt;
&lt;h1 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h1&gt;
&lt;p&gt;æå®¢æ—¶é—´-æ·±å…¥å‰–æk8s-å¼ ç£Š&lt;/p&gt;
&lt;p&gt;æå®¢æ—¶é—´-å®¹å™¨å®æˆ˜é«˜æ‰‹è¯¾&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://tech.meituan.com/2015/03/31/cgroups.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Linuxèµ„æºç®¡ç†ä¹‹cgroupsç®€ä»‹&lt;/a&gt;&lt;/p&gt;
</description>
        </item>
        <item>
        <title>Go SyncåŒ…ç›¸å…³</title>
        <link>http://nixum.cc/p/go-sync%E5%8C%85%E7%9B%B8%E5%85%B3/</link>
        <pubDate>Mon, 22 Mar 2021 00:00:00 +0000</pubDate>
        
        <guid>http://nixum.cc/p/go-sync%E5%8C%85%E7%9B%B8%E5%85%B3/</guid>
        <description>&lt;p&gt;[TOC]&lt;/p&gt;
&lt;h1 id=&#34;å˜é‡å¯è§æ€§&#34;&gt;å˜é‡å¯è§æ€§&lt;/h1&gt;
&lt;p&gt;ç”±äºä¸åŒçš„æ¶æ„å’Œä¸åŒçš„ç¼–è¯‘å™¨ä¼˜åŒ–ï¼Œä¼šå‘ç”ŸæŒ‡ä»¤é‡æ’ï¼Œå¯¼è‡´ç¨‹åºè¿è¡Œæ—¶ä¸ä¸€å®šä¼šæŒ‰ç…§ä»£ç çš„é¡ºåºæ‰§è¡Œï¼Œå› æ­¤ä¸¤ä¸ªgoroutineåœ¨å¤„ç†å…±äº«å˜é‡æ—¶ï¼Œèƒ½å¤Ÿçœ‹åˆ°å…¶ä»–goroutineå¯¹è¿™ä¸ªå˜é‡è¿›è¡Œçš„å†™ç»“æœã€‚&lt;/p&gt;
&lt;p&gt;happens-beforeï¼šç¨‹åºçš„æ‰§è¡Œé¡ºåºå’Œä»£ç çš„é¡ºåºä¸€æ ·ï¼Œå°±ç®—çœŸçš„å‘ç”Ÿäº†é‡æ’ï¼Œä»è¡Œä¸ºä¸Šä¹Ÿèƒ½ä¿è¯å’Œä»£ç çš„æŒ‡å®šé¡ºåºä¸€æ ·ã€‚&lt;/p&gt;
&lt;p&gt;Goä¸åƒJavaæœ‰volatileå…³é”®å­—å®ç°CPUå±éšœæ¥ä¿è¯æŒ‡ä»¤ä¸é‡æ’ï¼Œè€Œæ˜¯ä½¿ç”¨ä¸åŒæ¶æ„çš„å†…å­˜å±éšœæŒ‡ä»¤æ¥å®ç°åŒä¸€çš„å¹¶å‘åŸè¯­ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Goåªä¿è¯goroutineå†…éƒ¨é‡æ’å¯¹è¯»å†™é¡ºåºæ²¡æœ‰å½±å“&lt;/strong&gt;ï¼Œå¦‚æœå­˜åœ¨å…±äº«å˜é‡çš„è®¿é—®ï¼Œåˆ™å½±å“å¦ä¸€ä¸ªgoroutineã€‚å› æ­¤å½“æœ‰å¤šä¸ªgoroutineå¯¹å…±äº«å˜é‡çš„æ“ä½œæ—¶ï¼Œéœ€è¦ä¿è¯å¯¹è¯¥å…±äº«å˜é‡æ“ä½œçš„happens-beforeé¡ºåºã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// ä¾‹å­ï¼š
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;b&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;go&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;a&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;5&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;b&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;go&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;b&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;// å½“ä¸¤ä¸ªgoroutineåŒæ—¶æ‰§è¡Œæ—¶ï¼Œå› ä¸ºæŒ‡ä»¤é‡æ’çš„ç¼˜æ•…ï¼Œç¬¬äºŒä¸ªgoroutineæ‰“å°aå¯èƒ½æ˜¯5ï¼Œä¹Ÿå¯èƒ½æ˜¯0
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id=&#34;è¯heppens-beforeçš„æ‰‹æ®µ&#34;&gt;è¯heppens beforeçš„æ‰‹æ®µ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;initå‡½æ•°ï¼šåŒä¸€ä¸ªåŒ…ä¸‹å¯ä»¥æœ‰å¤šä¸ªinitå‡½æ•°ï¼Œå¤šä¸ªç­¾åç›¸åŒçš„initå‡½æ•°ï¼›mainå‡½æ•°ä¸€å®šåœ¨å¯¼å…¥çš„åŒ…çš„initå‡½æ•°æ‰§è¡Œä¹‹åæ‰§è¡Œï¼›å½“æœ‰å¤šä¸ªinitå‡½æ•°æ—¶ï¼Œä»mainæ–‡ä»¶å‡ºå‘ï¼Œé€’å½’æ‰¾åˆ°å¯¹åº”çš„åŒ… - åŒ…å†…æ–‡ä»¶åé¡ºåº - ä¸€ä¸ªæ–‡ä»¶å†…initå‡½æ•°é¡ºåºæ‰§è¡Œinitå‡½æ•°ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å…¨å±€å˜é‡ï¼šåŒ…çº§åˆ«çš„å˜é‡åœ¨&lt;strong&gt;åŒä¸€ä¸ªæ–‡ä»¶ä¸­æ˜¯æŒ‰ç…§å£°æ˜é¡ºåºé€ä¸ªåˆå§‹åŒ–&lt;/strong&gt;çš„ï¼›å½“è¯¥å˜é‡åœ¨åˆå§‹åŒ–æ—¶&lt;strong&gt;ä¾èµ–å…¶å®ƒçš„å˜é‡æ—¶ï¼Œåˆ™ä¼šå…ˆåˆå§‹åŒ–è¯¥ä¾èµ–çš„å˜é‡&lt;/strong&gt;ã€‚&lt;strong&gt;åŒä¸€ä¸ªåŒ…ä¸‹çš„å¤šä¸ªæ–‡ä»¶ï¼Œä¼šæŒ‰ç…§æ–‡ä»¶åçš„æ’åˆ—é¡ºåºè¿›è¡Œåˆå§‹åŒ–&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;initå‡½æ•°ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œå½“initå‡½æ•°å¼•ç”¨äº†å…¨å±€å˜é‡aï¼Œè¿è¡Œmainå‡½æ•°æ—¶ï¼Œè‚¯å®šæ˜¯å…ˆåˆå§‹åŒ–aï¼Œå†æ‰§è¡Œinitå‡½æ•°ã€‚&lt;/p&gt;
&lt;p&gt;å½“initå‡½æ•°å’Œå…¨å±€å˜é‡&lt;strong&gt;æ— å¼•ç”¨å…³ç³»æ—¶ï¼Œå…ˆåˆå§‹åŒ–å…¨å±€å˜é‡ï¼Œå†æ‰§è¡Œinitå‡½æ•°&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
  &lt;span class=&#34;nx&#34;&gt;a&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;b&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;// == 9
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;nx&#34;&gt;b&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// == 4
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// == 5
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;nx&#34;&gt;d&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;      &lt;span class=&#34;c1&#34;&gt;// å…¨éƒ¨åˆå§‹åŒ–å®Œæˆå == 5 
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
  &lt;span class=&#34;nx&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;
  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;d&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;---&lt;/span&gt;
&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;init&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;a&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;a&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getA&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getA&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;// è¿è¡Œåï¼Œè¾“å‡º2ï¼Œ3ï¼Œ4
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;---&lt;/span&gt;
&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;init&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;a&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getA&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getA&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;// è¿è¡Œåï¼Œè¾“å‡º2ï¼Œ4
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;goroutineï¼šå¯åŠ¨goroutineçš„goè¯­å¥æ‰§è¡Œï¼Œä¸€å®šhappens beforeæ­¤goroutineå†…çš„ä»£ç &lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;9
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;a&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;
&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;hello&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;a&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;hello&amp;#34;&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;go&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;nx&#34;&gt;æ‰§è¡Œhelloæ–¹æ³•&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ï¼Œ&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;å¿…å®šæ‰“å°å‡ºhello&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;channelï¼š
&lt;ul&gt;
&lt;li&gt;sendæ“ä½œå¿…å®šheppen beforeäºreceiveæ“ä½œï¼›&lt;/li&gt;
&lt;li&gt;closeä¸€ä¸ªchannelçš„æ“ä½œï¼Œå¿…å®šhappen beforeä»å…³é—­çš„channelä¸­è¯»å–ä¸€ä¸ªé›¶å€¼ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æ­¤å¤–è¿˜æœ‰Mutex / RWMutexã€WaitGroupã€Onceã€atomic&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;mutex---äº’æ–¥é”&#34;&gt;Mutex - äº’æ–¥é”&lt;/h1&gt;
&lt;h2 id=&#34;æ•°æ®ç»“æ„&#34;&gt;æ•°æ®ç»“æ„&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Mutex&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;state&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int32&lt;/span&gt;   &lt;span class=&#34;c1&#34;&gt;// åˆ†æˆå››éƒ¨åˆ†ï¼Œæœ€å°ä¸€ä½è¡¨ç¤ºé”æ˜¯å¦è¢«æŒæœ‰ï¼Œç¬¬äºŒä½è¡¨ç¤ºæ˜¯å¦æœ‰å”¤é†’çš„goroutineï¼Œç¬¬ä¸‰ä½è¡¨ç¤ºæ˜¯å¦å¤„äºé¥¥é¥¿çŠ¶æ€ï¼Œå‰©ä½™çš„ä½æ•°è¡¨ç¤ºç­‰å¾…é”çš„goroutineçš„æ•°é‡ï¼Œæœ€å¤§æ•°é‡ä¸º2^(32-3)-1ä¸ªï¼Œä»¥goroutineåˆå§‹ç©ºé—´ä¸º2kï¼Œåˆ™è¾¾åˆ°æœ€å¤§æ•°é‡æ—¶éœ€è¦æ¶ˆè€—1TBå†…å­˜
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;sema&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;// ä¿¡å·é‡å˜é‡ï¼Œç”¨æ¥æ§åˆ¶ç­‰å¾…goroutineçš„é˜»å¡ä¼‘çœ å’Œå”¤é†’
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;kd&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;mutexLocked&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;iota&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// æŒæœ‰é”çš„æ ‡è®°ï¼Œæ­¤æ—¶è¢«é”å®š
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;mutexWoken&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;// å”¤é†’æ ‡è®°ï¼Œä»æ­£å¸¸æ¨¡å¼è¢«å”¤é†’
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;mutexStarving&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// é¥¥é¥¿æ ‡è®°ï¼Œè¿›å…¥é¥¥é¥¿æ¨¡å¼
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;mutexWaiterShift&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;iota&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;// é˜»å¡ç­‰å¾…çš„waiteræ•°é‡
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;starvationThresholdNs&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;1e6&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/go_mutex_state.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/go_mutex_state.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;mutexLocked å¯¹åº”å³è¾¹ä½ä½ç¬¬ä¸€ä¸ªbitï¼Œ1 ä»£è¡¨é”è¢«å ç”¨ï¼Œ0ä»£è¡¨é”ç©ºé—²&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;mutexWoken å¯¹åº”å³è¾¹ä½ä½ç¬¬äºŒä¸ªbitï¼Œ1 è¡¨ç¤ºå·²å”¤é†’ï¼Œ0è¡¨ç¤ºæœªå”¤é†’&lt;/p&gt;
&lt;p&gt;ä»æ­£å¸¸æ¨¡å¼è¢«å”¤é†’ï¼Œç”¨äºåŠ é”å’Œè§£é”è¿‡ç¨‹ä¸­çš„é€šä¿¡ï¼Œæ¯”å¦‚åŒä¸€æ—¶åˆ»ï¼Œä¸€ä¸ªåç¨‹åœ¨è§£é”ï¼Œä¸€ä¸ªåç¨‹åœ¨åŠ é”ï¼Œæ­£åœ¨åŠ é”çš„åç¨‹å¯èƒ½åœ¨è‡ªæ—‹ï¼Œæ­¤æ—¶æ ‡è®°ä¸ºå”¤é†’ï¼Œå¦ä¸€ä¸ªåç¨‹è§£é”åï¼Œé”ç«‹é©¬è¢«è¿™ä¸ªåç¨‹æ‹¿åˆ°ï¼Œé¿å…å”¤é†’å­˜åœ¨é˜»å¡é˜Ÿåˆ—ä¸­çš„åç¨‹ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;mutexStarving å¯¹åº”å³è¾¹ä½ä½ç¬¬ä¸‰ä¸ªbitï¼Œ1 ä»£è¡¨é”å¤„äºé¥¥é¥¿æ¨¡å¼ï¼Œ0ä»£è¡¨é”å¤„äºæ­£å¸¸æ¨¡å¼&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;mutexWaiterShift å€¼ä¸º3ï¼Œæ ¹æ® &lt;code&gt;mutex.state &amp;gt;&amp;gt; mutexWaiterShift&lt;/code&gt; å¾—åˆ°å½“å‰é˜»å¡çš„&lt;code&gt;goroutine&lt;/code&gt;æ•°ç›®ï¼Œæœ€å¤šå¯ä»¥é˜»å¡&lt;code&gt;2^29&lt;/code&gt;ä¸ª&lt;code&gt;goroutine&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;starvationThresholdNs å€¼ä¸º1e6çº³ç§’ï¼Œä¹Ÿå°±æ˜¯1æ¯«ç§’ï¼Œå½“ç­‰å¾…é˜Ÿåˆ—ä¸­é˜Ÿé¦–goroutineç­‰å¾…æ—¶é—´è¶…è¿‡&lt;code&gt;starvationThresholdNs&lt;/code&gt;ä¹Ÿå°±æ˜¯1æ¯«ç§’ï¼Œmutexè¿›å…¥é¥¥é¥¿æ¨¡å¼ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;åŸºæœ¬&#34;&gt;åŸºæœ¬&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;åªæœ‰Lockå’ŒUnlockä¸¤ä¸ªæ–¹æ³•ï¼Œç”¨äºé”å®šä¸´ç•ŒåŒº&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Mutexçš„é›¶å€¼æ˜¯æ²¡æœ‰goroutineç­‰å¾…çš„æœªåŠ é”çŠ¶æ€ï¼Œä¸ä¼šå› ä¸ºæ²¡æœ‰åˆå§‹åŒ–è€Œå‡ºç°ç©ºæŒ‡é’ˆæˆ–è€…æ— æ³•è·å–åˆ°é”çš„æƒ…å†µï¼Œsoæ— éœ€é¢å¤–çš„åˆå§‹åŒ–ï¼Œç›´æ¥å£°æ˜å˜é‡å³å¯ä½¿ç”¨&lt;code&gt;var lock sync.Mutex&lt;/code&gt;ï¼Œæˆ–è€…æ˜¯åœ¨ç»“æ„ä½“é‡Œçš„å±æ€§ï¼Œå‡æ— éœ€åˆå§‹åŒ–&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;é”æœ‰ä¸¤ç§æ¨¡å¼ï¼šæ­£å¸¸æ¨¡å¼å’Œé¥¥é¥¿æ¨¡å¼&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ­£å¸¸æ¨¡å¼ä¸‹&lt;/strong&gt;ï¼Œå¦‚æœMutexå·²è¢«ä¸€ä¸ªgoroutineè·å–äº†é”ï¼Œå…¶ä»–ç­‰å¾…çš„goroutineä»¬ä¼šä¸€ç›´ç­‰å¾…ï¼Œç»„æˆç­‰å¾…é˜Ÿåˆ—ï¼Œå½“è¯¥goroutineé‡Šæ”¾é”åï¼Œç­‰å¾…çš„goroutineæ˜¯ä»¥å…ˆè¿›å…ˆå‡ºçš„é˜Ÿåˆ—æ’é˜Ÿè·å–é”ï¼›&lt;/p&gt;
&lt;p&gt;å¦‚æœæ­¤æ—¶æœ‰æ–°çš„goroutineä¹Ÿåœ¨è·å–é”ï¼Œä¼šå‚ä¸åˆ°è·å–é”çš„ç«äº‰ä¸­ï¼Œè¿™æ˜¯éå…¬å¹³çš„ï¼Œå› ä¸ºæ–°è¯·æ±‚é”çš„goroutineæ˜¯åœ¨CPUä¸Šè¢«è¿è¡Œï¼Œå¹¶ä¸”æ•°é‡ä¹Ÿå¯èƒ½å¾ˆå¤šï¼Œæ‰€ä»¥è¢«å”¤é†’çš„goroutineè·å–é”çš„æ¦‚ç‡å¹¶ä¸å¤§ï¼Œæ‰€ä»¥ï¼Œå¦‚æœç­‰å¾…é˜Ÿåˆ—ä¸­çš„goroutineç­‰å¾…è¶…è¿‡1msï¼Œåˆ™ä¼šä¼˜å…ˆåŠ å…¥åˆ°é˜Ÿåˆ—çš„å¤´éƒ¨ï¼Œå¦‚æœè¶…è¿‡1mséƒ½æ²¡æœ‰è·å–åˆ°é”ï¼Œåˆ™è¿›å…¥é¥¥é¥¿æ¨¡å¼ï¼›&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;é¥¥é¥¿æ¨¡å¼ä¸‹&lt;/strong&gt;ï¼Œé”çš„æ‰€æœ‰æƒä¼šç›´æ¥ä»é‡Šæ”¾é”çš„goroutineè½¬äº¤ç»™é˜Ÿé¦–çš„goroutineï¼Œæ–°è¯·æ±‚é”çš„goroutineå°±ç®—é”çš„ç©ºé—²çŠ¶æ€ä¹Ÿä¸ä¼šå»è·å–é”ï¼Œä¹Ÿä¸ä¼šè‡ªæ—‹ï¼Œç›´æ¥åŠ å…¥ç­‰å¾…é˜Ÿåˆ—çš„é˜Ÿå°¾ï¼Œä»¥æ­¤è§£å†³ç­‰å¾…çš„goroutineçš„é¥¥é¥¿é—®é¢˜ï¼›&lt;/p&gt;
&lt;p&gt;æ¢å¤ä¸ºæ­£å¸¸æ¨¡å¼çš„æ¡ä»¶ï¼šä¸€ä¸ªgoroutineè·å–é”åï¼Œå½“å‰goroutineæ˜¯é˜Ÿåˆ—çš„æœ€åä¸€ä¸ªï¼Œé€€å‡ºé¥¥é¥¿æ¨¡å¼ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Unlockæ–¹æ³•å¯ä»¥è¢«ä»»æ„goroutineè°ƒç”¨ï¼Œé‡Šæ”¾é”ï¼Œå³ä½¿å®ƒæœ¬èº«æ²¡æœ‰æŒæœ‰è¿™ä¸ªé”ï¼Œsoå†™çš„æ—¶å€™è¦ç‰¢è®°ï¼Œè°ç”³è¯·é”ï¼Œå°±è¯¥è°é‡Šæ”¾é”ï¼Œä¿è¯åœ¨ä¸€ä¸ªæ–¹æ³•å†…è¢«è°ƒç”¨&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¿…é¡»å…ˆä½¿ç”¨Lockæ–¹æ³•æ‰èƒ½ä½¿ç”¨Unlockæ–¹æ³•ï¼Œå¦åˆ™ä¼španicï¼Œé‡å¤é‡Šæ”¾é”ä¹Ÿä¼španic&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ˜¯å¦è¿›å…¥è‡ªæ—‹ï¼Œè¿˜è·Ÿè‡ªæ—‹çš„æ¬¡æ•°ä¸cpuæ ¸æ•°ï¼Œpçš„æ•°é‡æœ‰å…³&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ³¨æ„Mutexåœ¨ä½¿ç”¨æ—¶ä¸èƒ½è¢«å¤åˆ¶ï¼Œæ¯”å¦‚æ–¹æ³•ä¼ å‚çš„æ²¡æœ‰ä½¿ç”¨æŒ‡é’ˆï¼Œå¯¼è‡´æ‰§è¡Œæ–¹æ³•çš„å‚æ•°æ—¶è¢«å¤åˆ¶&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Mutexæ˜¯ä¸å¯é‡å…¥é”ï¼Œè·å–é”çš„goroutineæ— æ³•é‡å¤è·å–é”ï¼Œå› ä¸ºMutexæœ¬èº«ä¸è®°å½•å“ªä¸ªgoroutineæ‹¥æœ‰è¿™æŠŠé”ï¼Œå› æ­¤å¦‚æœè¦å®ç°å¯é‡å…¥é”ï¼Œåˆ™éœ€è¦å¯¹Mutexè¿›è¡ŒåŒ…è£…ï¼Œå®ç°Lockeræ¥å£ï¼ŒåŒæ—¶è®°å½•è·å–é”çš„goroutineçš„idå’Œé‡å…¥æ¬¡æ•°&lt;/p&gt;
&lt;p&gt;è·å–goroutine idçš„æ–¹æ³•ï¼š&lt;/p&gt;
&lt;p&gt;â€‹	1.ä½¿ç”¨runtime.Stack()æ–¹æ³•è·å–æ ˆå¸§é‡Œçš„goroutine id&lt;/p&gt;
&lt;p&gt;â€‹	2.è·å–è¿è¡Œæ—¶çš„GæŒ‡é’ˆï¼Œåè§£å‡ºGçš„TLSç»“æ„ï¼Œè·å–å­˜åœ¨TLSç»“æ„ä¸­çš„goroutine id&lt;/p&gt;
&lt;p&gt;â€‹	3.ç»™è·å–é”çš„goroutineè®¾ç½®tokenï¼Œè¿›è¡Œæ ‡è®°&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;lockæ–¹æ³•&#34;&gt;Lockæ–¹æ³•&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;è°ƒç”¨Lockçš„goroutineé€šè¿‡&lt;strong&gt;CASçš„æ–¹å¼è®¾ç½®é”æ ‡å¿—&lt;/strong&gt;ï¼Œå¦‚æœè·å–åˆ°äº†ç›´æ¥è¿”å›ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¦åˆ™è¿›å…¥&lt;code&gt;lockSlowæ–¹æ³•&lt;/code&gt;ï¼Œ&lt;code&gt;lockSlowæ–¹æ³•&lt;/code&gt;ä¸»è¦æ˜¯é€šè¿‡è‡ªæ—‹ç­‰å¾…é”çš„é‡Šæ”¾ï¼›è‡ªæ—‹æ˜¯ä¸ºäº†ä¸è®©goroutineè¿›å…¥ä¼‘çœ ï¼Œè®©å…¶åœ¨ä¸€æ®µæ—¶é—´å†…ä¿æŒè¿è¡Œï¼Œå¿™ç­‰å¾…å¿«é€Ÿè·å–é”ï¼›&lt;/p&gt;
&lt;p&gt;goroutineæœ¬èº«è¿›å…¥è‡ªæ—‹çš„æ¡ä»¶æ¯”è¾ƒè‹›åˆ»ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;äº’æ–¥é”åªæœ‰åœ¨æ­£å¸¸æ¨¡å¼æ‰èƒ½è¿›å…¥è‡ªæ—‹ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;runtime.sync_runtime_canSpin&lt;/code&gt;éœ€è¦è¿”å›trueï¼š&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;ol&gt;
&lt;li&gt;è¿è¡Œåœ¨å¤š CPU çš„æœºå™¨ä¸Šï¼›&lt;/li&gt;
&lt;li&gt;å½“å‰ Goroutine ä¸ºäº†è·å–è¯¥é”è¿›å…¥è‡ªæ—‹çš„æ¬¡æ•°å°äºå››æ¬¡ï¼›&lt;/li&gt;
&lt;li&gt;å½“å‰æœºå™¨ä¸Šè‡³å°‘å­˜åœ¨ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„å¤„ç†å™¨ P å¹¶ä¸”å¤„ç†çš„è¿è¡Œé˜Ÿåˆ—ä¸ºç©ºï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åœ¨lockSlowæ–¹æ³•å†…ï¼Œæ„å‘³ç€é”å·²ç»è¢«æŒæœ‰ï¼Œå½“å‰è°ƒç”¨Lockæ–¹æ³•çš„goroutineæ­£åœ¨ç­‰å¾…ï¼Œä¸”éé¥¥é¥¿çŠ¶æ€ï¼Œå…¶é¦–å…ˆä¼šè‡ªæ—‹ï¼Œå°è¯•è·å–é”ï¼Œæ— éœ€ä¼‘çœ ï¼Œå¦åˆ™è¿›å…¥ 4&lt;/p&gt;
&lt;p&gt;ä¸æ»¡è¶³è‡ªæ—‹æ—¶ï¼Œå½“å‰é”å¯èƒ½æœ‰å¦‚ä¸‹å‡ ç§çŠ¶æ€ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é”è¿˜æ²¡æœ‰è¢«é‡Šæ”¾ï¼Œé”å¤„äºæ­£å¸¸çŠ¶æ€&lt;/li&gt;
&lt;li&gt;é”è¿˜æ²¡æœ‰è¢«é‡Šæ”¾ï¼Œ é”å¤„äºé¥¥é¥¿çŠ¶æ€&lt;/li&gt;
&lt;li&gt;é”å·²ç»è¢«é‡Šæ”¾ï¼Œ é”å¤„äºæ­£å¸¸çŠ¶æ€&lt;/li&gt;
&lt;li&gt;é”å·²ç»è¢«é‡Šæ”¾ï¼Œ é”å¤„äºé¥¥é¥¿çŠ¶æ€&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç”±äºlockæ–¹æ³•ä¼šè¢«å¤šä¸ªgoroutineæ‰§è¡Œï¼Œæ‰€ä»¥é”çš„çŠ¶æ€ä¼šä¸æ–­å˜åŒ–ï¼Œæ­¤æ—¶ä¼šç”Ÿæˆå½“å‰goroutineçš„ new state ä½œä¸ºæœŸæœ›çŠ¶æ€&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚æœæ˜¯éé¥¥é¥¿çŠ¶æ€ï¼Œé”çš„new stateè®¾ç½®ä¸ºå·²æŒæœ‰é”&lt;/li&gt;
&lt;li&gt;å¦‚æœå·²ç»æŒæœ‰é”ï¼Œæˆ–è€…æ˜¯é¥¥é¥¿çŠ¶æ€ï¼Œwaiteræ•°é‡ + 1&lt;/li&gt;
&lt;li&gt;å¦‚æœå·²ç»æŒæœ‰é”ï¼Œä¸”æ˜¯é¥¥é¥¿çŠ¶æ€ï¼Œé”çš„new stateè®¾ç½®ä¸ºé¥¥é¥¿çŠ¶æ€&lt;/li&gt;
&lt;li&gt;å¦‚æœå½“å‰goroutineè¢«å”¤é†’ï¼Œé”çš„new stateè®¾ç½®ä¸ºå”¤é†’çŠ¶æ€&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;CASæ›´æ–°å½“å‰é”çš„çŠ¶æ€&lt;/strong&gt;ä¸ºnew stateï¼Œå¦‚æœæ›´æ–°æˆåŠŸ&lt;/p&gt;
&lt;p&gt;5.1. å¦‚æœé”çš„åŸçŠ¶æ€old stateæ˜¯æœªè¢«é”ï¼Œä¸”éé¥¥é¥¿çŠ¶æ€ï¼Œè¡¨æ˜å½“å‰goroutineè·å–åˆ°äº†é”ï¼Œ&lt;strong&gt;é€€å‡ºç»“æŸ&lt;/strong&gt;
5.2. åˆ¤æ–­å½“å‰goroutineæ˜¯æ–°åŠ å…¥çš„è¿˜æ˜¯è¢«å”¤é†’çš„ï¼Œæ–°åŠ å…¥çš„æ”¾åˆ°ç­‰å¾…é˜Ÿåˆ—çš„å°¾éƒ¨ï¼Œåˆšè¢«å”¤é†’çš„åŠ å…¥ç­‰å¾…é˜Ÿåˆ—çš„å¤´éƒ¨ï¼Œ&lt;strong&gt;é€šè¿‡ä¿¡å·é‡é˜»å¡&lt;/strong&gt;ï¼Œç›´åˆ°å½“å‰goroutineè¢«å”¤é†’
5.3. ä»è¿™é‡Œå¼€å§‹è¢«å”¤é†’çš„goroutineï¼Œéƒ½æ˜¯è¡¨ç¤ºæ˜¯ä»é˜»å¡é˜Ÿåˆ—é‡Œå‡ºæ¥çš„ã€‚goroutineè¢«å”¤é†’åï¼Œåˆ¤æ–­å½“å‰stateæ˜¯å¦æ˜¯é¥¥é¥¿çŠ¶æ€ï¼Œå¦‚æœä¸æ˜¯åˆ™æ›´æ–°é”çš„çŠ¶æ€ä¸ºè¢«å”¤é†’ï¼Œè¡¨ç¤ºæœ‰Gè¢«å”¤é†’ï¼Œç»§ç»­å¾ªç¯ï¼Œè·³åˆ° 2
5.4. å¦‚æœå½“å‰stateæ˜¯é¥¥é¥¿çŠ¶æ€ï¼Œå½“å‰goroutineè·å–é”ï¼Œwaiteræ•°é‡ - 1ï¼Œè®¾ç½®å½“å‰é”çš„çŠ¶æ€æ˜¯é¥¥é¥¿çŠ¶æ€ï¼Œå¦‚æœå½“å‰goroutineæ˜¯é˜Ÿåˆ—ä¸­æœ€åä¸€ä¸ªgoroutineï¼Œæ¸…é™¤å½“å‰é”çš„é¥¥é¥¿çŠ¶æ€ï¼Œ&lt;strong&gt;æ›´æ–°å½“å‰é”çš„çŠ¶æ€å’Œwaiteræ•°é‡ï¼Œé€€å‡ºç»“æŸ&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¦‚æœæ›´æ–°å¤±è´¥ï¼Œè®¾ç½®old state ç­‰äº å½“å‰é”çš„çŠ¶æ€&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å½“å‰goroutineèƒ½è·å–é”ï¼Œæ˜¯é€šè¿‡æ˜¯å¦èƒ½æˆåŠŸä¿®æ”¹é”çš„çŠ¶æ€ä¿®æ”¹ä¸ºæŒæœ‰é”å®ç°çš„ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;48
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;49
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;50
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;51
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;52
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;53
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;54
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;55
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;56
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;57
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;58
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;59
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;60
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;61
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;62
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;63
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;64
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;65
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;66
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;67
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;68
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;69
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;70
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;71
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;72
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;73
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;74
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;75
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;76
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;77
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;78
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;79
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;80
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;81
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;82
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;83
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;84
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;85
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;86
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;87
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;88
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;89
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;90
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;91
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;92
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;93
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;94
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;95
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;96
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;97
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;98
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Mutex&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;c1&#34;&gt;// casçš„æ–¹å¼è·å–é”ï¼Œè·å–åˆ°ä¹‹åç«‹å³è¿”å›
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;atomic&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;CompareAndSwapInt32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;state&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;mutexLocked&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;c1&#34;&gt;// è·å–ä¸åˆ°é”ï¼Œè¯´æ˜å·²è¢«å…¶ä»–goroutineè·å–åˆ°äº†é”ï¼Œæ­¤æ—¶ä¼šå°è¯•é€šè¿‡è‡ªæ—‹çš„æ–¹å¼ç­‰å¾…é”çš„é‡Šæ”¾
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;lockSlow&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;// è¿™ä¸ªæ–¹æ³•çš„ä»£ç ï¼Œæ˜¯ä¼šè¢«å¤šä¸ªGåŒæ—¶æ‰§è¡Œçš„
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Mutex&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;lockSlow&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;waitStartTime&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int64&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;starving&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// å½“å‰goroutineæ˜¯å¦è¢«å”¤é†’
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;awoke&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;iter&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;old&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;state&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;c1&#34;&gt;// åˆ¤æ–­å½“å‰stateå·²è¢«é”ï¼Œä¸”éé¥¥é¥¿çŠ¶æ€ï¼Œä¸”èƒ½è‡ªæ—‹ï¼ˆèƒ½å¦è‡ªæ—‹çš„æ¡ä»¶è§ä¸Šï¼‰
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;old&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;mutexLocked&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;mutexStarving&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;mutexLocked&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;runtime_canSpin&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;iter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;c1&#34;&gt;// è‡ªæ—‹è¿‡ç¨‹ä¸­å¦‚æœå‘ç°stateè¿˜æ²¡æœ‰è®¾ç½®wokenæ ‡è¯†ï¼Œåˆ™è¿›è¡Œè®¾ç½®ï¼Œæ ‡è®°è‡ªå·±è¢«å”¤é†’
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;            &lt;span class=&#34;c1&#34;&gt;// è‡ªæ—‹æ˜¯ä¸ºäº†è®©å…¶ä»–goroutineåœ¨é‡Šæ”¾é”åèƒ½ç¬¬ä¸€æ—¶é—´å”¤é†’æ­¤goroutine
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;			&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;awoke&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;old&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;mutexWoken&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;old&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;mutexWaiterShift&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt;
				&lt;span class=&#34;nx&#34;&gt;atomic&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;CompareAndSwapInt32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;state&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;old&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;old&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;mutexWoken&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
				&lt;span class=&#34;nx&#34;&gt;awoke&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;
			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
            &lt;span class=&#34;c1&#34;&gt;// è¿›å…¥è‡ªæ—‹
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;			&lt;span class=&#34;nf&#34;&gt;runtime_doSpin&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;iter&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;old&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;state&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;continue&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
        &lt;span class=&#34;c1&#34;&gt;// oldæ˜¯å½“å‰é”çŠ¶æ€ï¼Œnewæ˜¯æœŸæœ›é”çŠ¶æ€
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;nx&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;old&lt;/span&gt;
		&lt;span class=&#34;c1&#34;&gt;// å¦‚æœæ­¤æ—¶æ˜¯éé¥¥é¥¿çŠ¶æ€ï¼ŒæœŸæœ›é”çŠ¶æ€è®¾ç½®ä¸ºæŒæœ‰é”
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;old&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;mutexStarving&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;mutexLocked&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
        &lt;span class=&#34;c1&#34;&gt;// å¦‚æœå·²ç»æŒæœ‰é” æˆ–è€… æ˜¯é¥¥é¥¿çŠ¶æ€ï¼Œstateçš„waiteræ•°é‡+1ï¼Œè¡¨ç¤ºå½“å‰goroutineåœ¨ç­‰å¾…
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;old&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;mutexLocked&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;mutexStarving&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;mutexWaiterShift&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
		&lt;span class=&#34;c1&#34;&gt;// å¦‚æœæ­¤æ—¶æ˜¯é¥¥é¥¿çŠ¶æ€ï¼Œè¿˜æŒæœ‰é”ï¼ŒæœŸæœ›é”çŠ¶æ€è®¾ç½®ä¸ºé¥¥é¥¿
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;starving&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;old&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;mutexLocked&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;mutexStarving&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
        &lt;span class=&#34;c1&#34;&gt;// goroutineè¢«å”¤é†’ï¼ŒæœŸæœ›é”çŠ¶æ€è®¾ç½®ä¸ºå”¤é†’
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;awoke&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
            &lt;span class=&#34;c1&#34;&gt;// å¦‚æœæ­¤æ—¶éå”¤é†’ï¼Œè¯´æ˜é”çš„çŠ¶æ€ä¸ä¸€è‡´ï¼ŒæŠ›é”™è¯¯
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;			&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;new&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;mutexWoken&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
				&lt;span class=&#34;nf&#34;&gt;throw&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;sync: inconsistent mutex state&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;^=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;mutexWoken&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
        &lt;span class=&#34;c1&#34;&gt;// casæ›´æ–°é”çš„çŠ¶æ€ï¼Œè¿™é‡Œé”çš„çŠ¶æ€å¯èƒ½æ˜¯4ç§ä¸­å…¶ä¸­ä¸€ç§
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;atomic&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;CompareAndSwapInt32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;state&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;old&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;new&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
            &lt;span class=&#34;c1&#34;&gt;// å¦‚æœoldä¸æ˜¯é¥¥é¥¿çŠ¶æ€ä¹Ÿä¸æ˜¯è¢«é”çŠ¶æ€ï¼Œè¡¨æ˜å½“å‰goroutineå·²é€šè¿‡casè·å–åˆ°äº†é”ï¼Œbreak
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;			&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;old&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;mutexLocked&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;mutexStarving&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
				&lt;span class=&#34;k&#34;&gt;break&lt;/span&gt;
			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
			&lt;span class=&#34;c1&#34;&gt;// å¦‚æœä¹‹å‰å·²ç»åœ¨ç­‰äº†ï¼Œå°±æ’åœ¨é˜Ÿé¦–
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;			&lt;span class=&#34;nx&#34;&gt;queueLifo&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;waitStartTime&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;
            &lt;span class=&#34;c1&#34;&gt;// å¦‚æœä¹‹å‰æ²¡åœ¨ç­‰ï¼Œåˆ™åˆå§‹åŒ–ç­‰å¾…æ—¶é—´
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;			&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;waitStartTime&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
				&lt;span class=&#34;nx&#34;&gt;waitStartTime&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;runtime_nanotime&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
            &lt;span class=&#34;c1&#34;&gt;// è¯¥æ–¹æ³•ä¼šä¸æ–­å°è¯•è·å–é”å¹¶é™·å…¥ä¼‘çœ ç­‰å¾…ä¿¡å·é‡çš„é‡Šæ”¾ï¼Œä¸€æ—¦å½“å‰ goroutine å¯ä»¥è·å–ä¿¡å·é‡ï¼Œå®ƒå°±ä¼šç«‹åˆ»è¿”å›
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;			&lt;span class=&#34;nf&#34;&gt;runtime_SemacquireMutex&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;sema&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;queueLifo&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
            &lt;span class=&#34;c1&#34;&gt;// èµ°åˆ°è¿™ä¸€æ­¥ï¼Œè¯´æ˜å½“å‰goroutineæ˜¯è¿›è¿‡é˜»å¡é˜Ÿåˆ—çš„ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥åœ¨é¥¥é¥¿çŠ¶æ€ä¸‹ä¼šä¼˜å…ˆè·å–é”
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;            &lt;span class=&#34;c1&#34;&gt;// å¦‚æœå½“å‰goroutineæ˜¯é¥¥é¥¿çŠ¶æ€ï¼Œæˆ–è€…å·²ç»ç­‰å¾…è¶…è¿‡1msï¼Œå°±è®¾ç½®ä¸ºé¥¥é¥¿çŠ¶æ€
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;			&lt;span class=&#34;nx&#34;&gt;starving&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;starving&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;||&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;runtime_nanotime&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;waitStartTime&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;starvationThresholdNs&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;old&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;state&lt;/span&gt;
            &lt;span class=&#34;c1&#34;&gt;// å¦‚æœæ˜¯é¥¥é¥¿æ¨¡å¼
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;			&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;old&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;mutexStarving&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
				&lt;span class=&#34;c1&#34;&gt;// å¦‚æœgoroutineè¢«å”¤é†’ï¼Œä¸”å¤„äºé¥¥é¥¿çŠ¶æ€ï¼Œé”çš„æ‰€æœ‰æƒè½¬ç§»ç»™å½“å‰goroutine
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;				&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;old&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;mutexLocked&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;mutexWoken&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;||&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;old&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;mutexWaiterShift&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
					&lt;span class=&#34;nf&#34;&gt;throw&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;sync: inconsistent mutex state&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
				&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
                &lt;span class=&#34;c1&#34;&gt;// å½“å‰goroutineè·å–é”ï¼Œwaiteræ•°é‡-1
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;				&lt;span class=&#34;nx&#34;&gt;delta&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;int32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;mutexLocked&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;mutexWaiterShift&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
                &lt;span class=&#34;c1&#34;&gt;// å¦‚æœå½“å‰goroutineéé¥¥é¥¿çŠ¶æ€ï¼Œæˆ–è€… å½“å‰goroutineæ˜¯é˜Ÿåˆ—ä¸­æœ€åä¸€ä¸ªgoroutine
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;				&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;starving&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;||&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;old&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;mutexWaiterShift&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
					&lt;span class=&#34;c1&#34;&gt;// é€€å‡ºé¥¥é¥¿æ¨¡å¼
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;					&lt;span class=&#34;nx&#34;&gt;delta&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;mutexStarving&lt;/span&gt;
				&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
                &lt;span class=&#34;c1&#34;&gt;// å½“å‰goroutineæˆåŠŸä¿®æ”¹é”çŠ¶æ€ä¸ºæŒæœ‰é”
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;				&lt;span class=&#34;nx&#34;&gt;atomic&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;AddInt32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;state&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;delta&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
				&lt;span class=&#34;k&#34;&gt;break&lt;/span&gt;
			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
            &lt;span class=&#34;c1&#34;&gt;// ä¸æ˜¯é¥¥é¥¿æ¨¡å¼ï¼Œå°±æŠŠå½“å‰goroutineè®¾ç½®ä¸ºè¢«å”¤é†’ï¼Œè‡ªæ—‹æ¬¡æ•°é‡ç½®ä¸º0
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;			&lt;span class=&#34;nx&#34;&gt;awoke&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;iter&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
            &lt;span class=&#34;c1&#34;&gt;// casä¸æˆåŠŸï¼Œæ²¡æœ‰æ‹¿åˆ°é”ï¼Œé”è¢«å…¶ä»–goroutineè·å–æˆ–è€…é”æ²¡æœ‰è¢«é‡Šæ”¾ï¼Œæ›´æ–°çŠ¶æ€ï¼Œé‡æ–°å¾ªç¯
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;			&lt;span class=&#34;nx&#34;&gt;old&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;state&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id=&#34;unlockæ–¹æ³•&#34;&gt;Unlockæ–¹æ³•&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;å°†stateçš„é”ä½-1ï¼Œå¦‚æœstate=0ï¼Œå³æ­¤æ—¶æ²¡æœ‰åŠ é”ï¼Œä¸”æ²¡æœ‰æ­£åœ¨ç­‰å¾…è·å–é”çš„goroutineï¼Œåˆ™ç›´æ¥ç»“æŸæ–¹æ³•ï¼Œå¦‚æœstate != 0ï¼Œæ‰§è¡ŒunlockSlowæ–¹æ³•ï¼Œå”¤é†’ç­‰å¾…çš„goroutineï¼›&lt;/li&gt;
&lt;li&gt;å¦‚æœMutexå¤„äºé¥¥é¥¿çŠ¶æ€ï¼Œå½“å‰goroutineä¸æ›´æ–°é”çŠ¶æ€ï¼Œç›´æ¥å”¤é†’ç­‰å¾…é˜Ÿåˆ—ä¸­çš„waiterï¼Œç»§ç»­æ‰§è¡Œï¼Œç›¸å½“äºè§£é”äº†ï¼Œç„¶åç”±ç­‰å¾…é˜Ÿåˆ—ä¸­çš„é˜Ÿé¦–goroutineè·å¾—é”ï¼›&lt;/li&gt;
&lt;li&gt;å¦‚æœMutexå¤„äºæ­£å¸¸çŠ¶æ€ï¼Œå¦‚æœæ²¡æœ‰waiterï¼Œæˆ–è€…å·²ç»æœ‰åœ¨å¤„ç†çš„waiterçš„æƒ…å†µï¼Œåˆ™ç›´æ¥é‡Šæ”¾é”ï¼Œstateé”ä½-1ï¼Œè¿”å›ï¼›å¦åˆ™ï¼Œwaiteræ•°-1ï¼Œè®¾ç½®å”¤é†’æ ‡è®°ï¼Œé€šè¿‡CASè§£é”ï¼Œå”¤é†’åœ¨ç­‰å¾…é”çš„goroutineï¼Œæ­¤æ—¶æ–°è€goroutineä¸€èµ·ç«äº‰é”ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Mutex&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Unlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// ä¿®æ”¹stateçš„çŠ¶æ€ä¸ºé‡Šæ”¾é”
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;atomic&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;AddInt32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;state&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;mutexLocked&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;c1&#34;&gt;// è¯´æ˜æ­¤æ—¶æ²¡æœ‰æˆåŠŸè§£é”ï¼Œæˆ–è€…æœ‰å…¶ä»–goroutineåœ¨ç­‰å¾…è§£é”
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;unlockSlow&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;new&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Mutex&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;unlockSlow&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;new&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;mutexLocked&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;mutexLocked&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nf&#34;&gt;throw&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;sync: unlock of unlocked mutex&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// éé¥¥é¥¿æ¨¡å¼ä¸‹
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;new&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;mutexStarving&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;old&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;new&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;c1&#34;&gt;// å¦‚æœæ²¡æœ‰ç­‰å¾…çš„goroutineï¼Œæˆ–è€… é”æœ‰ä»¥ä¸‹å‡ ç§æƒ…å†µæ—¶ï¼Œç›´æ¥è¿”å›
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;            &lt;span class=&#34;c1&#34;&gt;// 1. é”è¢«å…¶ä»–goroutineè·å–äº†
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;            &lt;span class=&#34;c1&#34;&gt;// 2. æˆ–è€…æœ‰ç­‰å¾…çš„goroutineè¢«å”¤é†’ï¼Œä¸ç”¨å†å”¤é†’é˜»å¡é˜Ÿåˆ—é‡Œçš„goroutineï¼Œå¯ä»¥ç›´æ¥è¿”å›
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;            &lt;span class=&#34;c1&#34;&gt;// 3. æˆ–è€…é”æ˜¯é¥¥é¥¿æ¨¡å¼ï¼Œé”ä¹‹åè¦ç›´æ¥äº¤ç»™ç­‰å¾…é˜Ÿåˆ—é˜Ÿé¦–çš„goroutine
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;			&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;old&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;mutexWaiterShift&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;||&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;old&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;mutexLocked&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;mutexWoken&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;mutexStarving&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
				&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt;
			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
			&lt;span class=&#34;c1&#34;&gt;// èƒ½èµ°åˆ°è¿™è¿™é‡Œè¯´æ˜æ­¤æ—¶é”çš„çŠ¶æ€è¿˜æ˜¯ç©ºé—²ï¼Œ
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;            &lt;span class=&#34;c1&#34;&gt;// ä¸”æ²¡æœ‰goroutineè¢«å”¤é†’ï¼Œä¸”é˜Ÿåˆ—ä¸­æœ‰goroutineåœ¨ç­‰å¾…è·å–é”
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;            &lt;span class=&#34;c1&#34;&gt;// ç­‰å¾…è·å–é”çš„goroutineæ•°é‡-1ï¼Œè®¾ç½®wokenæ ‡è¯†
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;			&lt;span class=&#34;nx&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;old&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;mutexWaiterShift&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;mutexWoken&lt;/span&gt;
            &lt;span class=&#34;c1&#34;&gt;// è®¾ç½®æ–°çš„stateï¼Œé€šè¿‡ä¿¡å·é‡å”¤é†’ä¸€ä¸ªé˜»å¡çš„goroutineè·å–é”
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;            &lt;span class=&#34;c1&#34;&gt;// æ­¤æ—¶å¯èƒ½ä¼šæ–°è€çš„waiterä¸€èµ·ç«äº‰
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;			&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;atomic&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;CompareAndSwapInt32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;state&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;old&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;new&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
				&lt;span class=&#34;nf&#34;&gt;runtime_Semrelease&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;sema&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
				&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt;
			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;old&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;state&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;c1&#34;&gt;// é¥¥é¥¿æ¨¡å¼ä¸‹ï¼Œç›´æ¥å°†é”çš„æ‰€æœ‰æƒç»™é˜Ÿé¦–çš„goroutineï¼Œå³ç¬¬äºŒä¸ªå‚æ•°ä¸ºtrue
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;c1&#34;&gt;// æ­¤æ—¶çš„stateè¿˜æ²¡åŠ é”ï¼Œè¢«å”¤é†’çš„goroutineä¼šè®¾ç½®å®ƒï¼Œå¦‚æœæ­¤æ—¶æœ‰æ–°çš„goroutineæ¥è¯·æ±‚é”ï¼Œå› ä¸ºè¿˜å¤„äºé¥¥é¥¿çŠ¶æ€ï¼Œå°±ä»ç„¶è®¤ä¸ºè¿˜è¢«é”ï¼Œæ–°æ¥çš„goroutineä¸ä¼šæŠ¢åˆ°é”
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;nf&#34;&gt;runtime_Semrelease&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;sema&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id=&#34;åŸºäºmutexçš„æ‹“å±•&#34;&gt;åŸºäºMutexçš„æ‹“å±•&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;å¯é‡å…¥é”&lt;/li&gt;
&lt;li&gt;å¢åŠ tryLockæ–¹æ³•ï¼Œé€šè¿‡è¿”å›trueæˆ–falseæ¥è¡¨ç¤ºè·å–é”æˆåŠŸæˆ–å¤±è´¥ï¼Œä¸»è¦ç”¨äºæ§åˆ¶è·å–é”å¤±è´¥åçš„è¡Œä¸ºï¼Œè€Œä¸ç”¨é˜»å¡åœ¨æ–¹æ³•è°ƒç”¨ä¸Š&lt;/li&gt;
&lt;li&gt;å¢åŠ ç­‰å¾…è®¡æ•°å™¨ï¼Œæ¯”å¦‚ç­‰å¾…å¤šå°‘æ—¶é—´åè¿˜æ²¡è·å–åˆ°é”åˆ™æ”¾å¼ƒ&lt;/li&gt;
&lt;li&gt;å¢åŠ å¯è§‚æµ‹æ€§æŒ‡æ ‡ï¼Œæ¯”å¦‚ç­‰å¾…é”çš„goroutineçš„æ•°é‡ï¼Œéœ€è¦ä½¿ç”¨&lt;code&gt;unsafe.Pointeræ–¹æ³•&lt;/code&gt;è·å–Mutexä¸­çš„stateçš„å€¼ï¼Œè§£æå‡ºæ­£åœ¨ç­‰å¾…çš„goroutineçš„æ•°é‡&lt;/li&gt;
&lt;li&gt;å®ç°çº¿ç¨‹å®‰å…¨çš„é˜Ÿåˆ—ï¼Œé€šè¿‡åœ¨å‡ºé˜Ÿå’Œå…¥é˜Ÿæ–¹æ³•ä¸­ä½¿ç”¨Mutexä¿è¯çº¿ç¨‹å®‰å…¨&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;å…³äºmutexä¸­çš„sema&#34;&gt;å…³äºMutexä¸­çš„sema&lt;/h2&gt;
&lt;p&gt;golangåº•å±‚é€šè¿‡&lt;code&gt;runtime_SemacquireMutex&lt;/code&gt;å’Œ&lt;code&gt;runtime_Semrelease&lt;/code&gt;æ¥å®ç°åˆ‡æ¢é˜»å¡åç¨‹å’Œé‡Šæ”¾è¢«é˜»å¡åç¨‹é‡æ–°è¿è¡Œç­‰æ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;åœ¨runtimeä¸­ï¼Œæœ‰ä¸€ä¸ªé•¿åº¦æ˜¯251çš„å…¨å±€semtableæ•°ç»„ï¼Œæ¯ä¸ªå…ƒç´ æ˜¯ä¸€æ£µå¹³è¡¡æ ‘çš„æ ¹ï¼Œæ ‘çš„æ¯ä¸ªèŠ‚ç‚¹æ˜¯sudogç»“æ„ç»„æˆçš„ä¸€ä¸ªåŒå‘é“¾è¡¨ã€‚&lt;/p&gt;
&lt;p&gt;semtableä¼šè¢«å¤šä¸ªåç¨‹æ“ä½œï¼Œæœ‰å¹¶å‘é—®é¢˜ï¼Œåº•å±‚ä½¿ç”¨çœŸæ­£çš„é”ï¼Œä¾èµ–æ“ä½œç³»ç»Ÿå®ç°ï¼Œä¸èƒ½è¢«ç”¨æˆ·ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;Mutexä¸­çš„semaæ˜¯ä¸€ä¸ªä¿¡å·é‡ï¼ŒMutexé€šè¿‡semaå­—æ®µï¼Œå–å…¶åœ°å€å³ç§»ä¸‰ä½å†å¯¹æ•°ç»„é•¿åº¦å–æ¨¡ï¼Œå¾—åˆ°semtableçš„ç´¢å¼•ï¼Œæ˜ å°„åˆ°semtableæ•°ç»„ï¼Œä»è€ŒçŸ¥é“goroutineè¢«åŒ…è£…æˆsudogä¹‹åè¦å­˜åœ¨semtableæ•°ç»„ä¸­çš„å“ªä¸€æ£µå¹³è¡¡æ ‘ä¸Šï¼Œä»¥æ­¤å°±å¯ä»¥é€šè¿‡åŒä¸€ä¸ªä¿¡å·é‡æ‰¾åˆ°å¯¹åº”çš„åœ¨ç­‰å¾…çš„åç¨‹åŒå‘é“¾è¡¨ã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯ä¸åŒçš„ä¿¡å·é‡åœ°å€å¯èƒ½ä¼šæ˜ å°„åˆ°åŒä¸€ä¸ªsemtableç´¢å¼•ï¼Œä¸ºäº†é¿å…å”¤é†’é”™è¯¯çš„åç¨‹ï¼Œä¼šå¯¹æ‹¿å‡ºæ¥çš„å¹³è¡¡æ ‘è¿›è¡Œéå†ï¼ŒåŒ¹é…semaçš„åœ°å€ï¼Œå–å‡ºå¯¹åº”çš„åç¨‹ã€‚&lt;/p&gt;
&lt;h1 id=&#34;rwmutex---è¯»å†™é”&#34;&gt;RWMutex - è¯»å†™é”&lt;/h1&gt;
&lt;h2 id=&#34;æ•°æ®ç»“æ„-1&#34;&gt;æ•°æ®ç»“æ„&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;8
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;RWMutex&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;w&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Mutex&lt;/span&gt;           &lt;span class=&#34;c1&#34;&gt;// äº’æ–¥é”è§£å†³å¤šä¸ªwriterçš„ç«äº‰
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;writerSem&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;// writerä¿¡å·é‡ 
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;readerSem&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;// readerä¿¡å·é‡ 
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;readerCount&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int32&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// readerçš„æ•°é‡ï¼Œå¯ä»¥æ˜¯è´Ÿæ•°ï¼Œè´Ÿæ•°è¡¨ç¤ºæ­¤æ—¶æœ‰writerç­‰å¾…è¯·æ±‚é”ï¼Œæ­¤æ—¶ä¼šé˜»å¡reader
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;readerWait&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int32&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;// ç­‰å¾…è¯»å®Œæˆçš„readerçš„æ•°é‡ï¼Œä¿è¯å†™æ“ä½œä¸ä¼šè¢«è¯»æ“ä½œé˜»å¡è€Œé¥¿æ­»
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;kd&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rwmutexMaxReaders&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;30&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// æœ€å¤§çš„readeræ•°é‡
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id=&#34;åŸºæœ¬-1&#34;&gt;åŸºæœ¬&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ä¸»è¦æå‡Mutexåœ¨è¯»å¤šå†™å°‘çš„åœºæ™¯ä¸‹çš„ååé‡ï¼Œè¯»æ—¶å…±äº«é”ï¼Œå†™æ—¶æ’ä»–é”ï¼ŒåŸºäºMutexå®ç°&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç”±5ä¸ªæ–¹æ³•æ„æˆï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Lock/Unlockï¼šå†™æ“ä½œæ—¶è°ƒç”¨çš„æ–¹æ³•ã€‚å¦‚æœé”å·²ç»è¢« reader æˆ–è€… writer æŒæœ‰ï¼Œé‚£ä¹ˆï¼ŒLock æ–¹æ³•ä¼šä¸€ç›´é˜»å¡ï¼Œç›´åˆ°èƒ½è·å–åˆ°é”ï¼›Unlock åˆ™æ˜¯é…å¯¹çš„é‡Šæ”¾é”çš„æ–¹æ³•ã€‚&lt;/li&gt;
&lt;li&gt;RLock/RUnlockï¼šè¯»æ“ä½œæ—¶è°ƒç”¨çš„æ–¹æ³•ã€‚å¦‚æœé”å·²ç»è¢« writer æŒæœ‰çš„è¯ï¼ŒRLock æ–¹æ³•ä¼šä¸€ç›´é˜»å¡ï¼Œç›´åˆ°èƒ½è·å–åˆ°é”ï¼Œå¦åˆ™å°±ç›´æ¥è¿”å›ï¼›è€Œ RUnlock æ˜¯ reader é‡Šæ”¾é”çš„æ–¹æ³•ã€‚&lt;/li&gt;
&lt;li&gt;RLockerï¼šè¿™ä¸ªæ–¹æ³•çš„ä½œç”¨æ˜¯ä¸ºè¯»æ“ä½œè¿”å›ä¸€ä¸ª Locker æ¥å£çš„å¯¹è±¡ã€‚å®ƒçš„ Lock æ–¹æ³•ä¼šè°ƒç”¨ RWMutex çš„ RLock æ–¹æ³•ï¼Œå®ƒçš„ Unlock æ–¹æ³•ä¼šè°ƒç”¨ RWMutex çš„ RUnlock æ–¹æ³•&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åŒMutexï¼ŒRWMutexçš„é›¶å€¼æ˜¯æœªåŠ é”çŠ¶æ€ï¼Œæ— éœ€æ˜¾ç¤ºåœ°åˆå§‹åŒ–&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç”±äºè¯»å†™é”çš„å­˜åœ¨ï¼Œå¯èƒ½ä¼šæœ‰é¥¥é¥¿é—®é¢˜ï¼šæ¯”å¦‚å› ä¸ºè¯»å¤šå†™å°‘ï¼Œå¯¼è‡´å†™é”ä¸€ç›´åŠ ä¸ä¸Šï¼Œå› æ­¤goçš„RWMutexä½¿ç”¨çš„æ˜¯å†™é”ä¼˜å…ˆç­–ç•¥ï¼š&lt;/p&gt;
&lt;p&gt;å¦‚æœå·²ç»æœ‰ä¸€ä¸ªwriteråœ¨ç­‰å¾…è¯·æ±‚é”çš„è¯ï¼Œä¼šé˜»æ­¢æ–°çš„readerè¯·æ±‚è¯»é”ï¼Œä¼˜å…ˆä¿è¯writerã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœå·²ç»æœ‰ä¸€äº›readerè¯·æ±‚äº†è¯»é”ï¼Œåˆ™æ–°è¯·æ±‚çš„writerä¼šç­‰å¾…åœ¨å…¶ä¹‹å‰çš„readeréƒ½é‡Šæ”¾æ‰è¯»é”åæ‰è¯·æ±‚è·å–å†™é”ï¼Œç­‰å¾…writerè§£é”åï¼Œåç»­çš„readeræ‰èƒ½ç»§ç»­è¯·æ±‚é”ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åŒMutexï¼Œå‡ä¸ºä¸å¯é‡å…¥ï¼Œä½¿ç”¨æ—¶åº”é¿å…å¤åˆ¶ï¼›&lt;/p&gt;
&lt;p&gt;è¦æ³¨æ„readeråœ¨åŠ è¯»é”åï¼Œæƒ³è¦åŠ å†™é”ï¼Œåˆ™å¿…é¡»è¦å…ˆè§£é™¤è¯»é”åæ‰èƒ½è§£é™¤å†™é”ï¼Œå¦åˆ™ä¼šå½¢æˆç›¸äº’ä¾èµ–å¯¼è‡´æ­»é”ï¼›æ¯”å¦‚å…ˆåŠ è¯»é”ï¼Œå†åŠ å†™é”ï¼Œè§£é™¤å†™é”ï¼Œè§£é™¤è¯»é”ï¼Œè¿™æ ·å°±ä¼šå¯¼è‡´æ­»é”ï¼Œå› ä¸ºåŠ å†™é”æ—¶ï¼Œéœ€è¦è¯»é”å…ˆé‡Šæ”¾ï¼Œè€Œè¯»é”é‡Šæ”¾åˆä¾èµ–å†™é”é‡Šæ”¾ï¼Œä»è€Œå¯¼è‡´æ­»é”&lt;/p&gt;
&lt;p&gt;æ³¨æ„readeræ˜¯å¯ä»¥é‡å¤åŠ è¯»é”çš„ï¼Œé‡å¤åŠ è¯»é”æ—¶ï¼Œå¤–å±‚readerå¿…é¡»ç­‰é‡Œå±‚çš„readeré‡Šæ”¾é”åè‡ªå·±æ‰èƒ½é‡Šæ”¾é”ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¿…é¡»å…ˆä½¿ç”¨RLock / Lockæ–¹æ³•æ‰èƒ½ä½¿ç”¨RUnlock / Unlockæ–¹æ³•ï¼Œå¦åˆ™ä¼španicï¼Œé‡å¤é‡Šæ”¾é”ä¹Ÿä¼španicã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¯ä»¥åˆ©ç”¨RWMutexå®ç°çº¿ç¨‹å®‰å…¨çš„map&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;rlock--runlock-æ–¹æ³•&#34;&gt;RLock / RUnlock æ–¹æ³•&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;ä»…å¯¹readerCountå€¼è¿›è¡ŒåŸå­æ“ä½œ&lt;/strong&gt;ï¼Œè¿˜æœ‰å°±æ˜¯æ“ä½œå½“å‰goroutineå’Œreaderä¿¡å·é‡&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;RLockæ—¶ï¼Œå¯¹readerCountçš„å€¼+1ï¼Œåˆ¤æ–­æ˜¯å¦&amp;lt; 0ï¼Œå¦‚æœæ˜¯ï¼Œè¯´æ˜æ­¤æ—¶æœ‰writeråœ¨ç«äº‰é”æˆ–å·²æŒæœ‰é”ï¼Œåˆ™å°†å½“å‰goroutineåŠ å…¥readerSemæŒ‡å‘çš„é˜Ÿåˆ—ä¸­ï¼Œè¿›è¡Œç­‰å¾…ï¼Œé˜²æ­¢å†™é”é¥¥é¥¿ã€‚&lt;/li&gt;
&lt;li&gt;RUnlockæ—¶ï¼Œå¯¹readerCountçš„å€¼-1ï¼Œåˆ¤æ–­æ˜¯å¦&amp;lt;0ï¼Œå¦‚æœæ˜¯ï¼Œè¯´æ˜å½“å‰æœ‰writeråœ¨ç«äº‰é”ï¼Œè°ƒç”¨&lt;code&gt;rUnlockSlowæ–¹æ³•&lt;/code&gt;ï¼Œå¯¹readerWaitçš„å€¼-1ï¼Œåˆ¤æ–­æ˜¯å¦=0ï¼Œå¦‚æœæ˜¯ï¼Œè¯´æ˜å½“å‰goroutineæ˜¯æœ€åä¸€ä¸ªè¦è§£é™¤è¯»é”çš„ï¼Œæ­¤æ—¶ä¼šå”¤é†’è¦è¯·æ±‚å†™é”çš„writerã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rw&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;RWMutex&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;RLock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;atomic&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;AddInt32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rw&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;readerCount&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;c1&#34;&gt;// readerCountå°äº0ï¼Œè¯´æ˜æœ‰Writerï¼Œæ­¤æ—¶é˜»å¡è¯»æ“ä½œ
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;nf&#34;&gt;runtime_SemacquireMutex&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rw&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;readerSem&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rw&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;RWMutex&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;RUnlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;atomic&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;AddInt32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rw&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;readerCount&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;c1&#34;&gt;// readerCountå°äº0ï¼Œè¯´æ˜æœ‰Writerï¼Œåˆ¤æ–­è¦ä¸è¦å”¤é†’è¢«é˜»å¡çš„Writer
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;nx&#34;&gt;rw&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;rUnlockSlow&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;// è¿›å…¥æ­¤æ–¹æ³•è¯´æ˜æœ‰æ­£åœ¨ç­‰å¾…çš„writer
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rw&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;RWMutex&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;rUnlockSlow&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;||&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rwmutexMaxReaders&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;race&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Enable&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
		&lt;span class=&#34;nf&#34;&gt;throw&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;sync: RUnlock of unlocked RWMutex&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;atomic&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;AddInt32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rw&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;readerWait&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;c1&#34;&gt;// readerWaiterç­‰äº0ï¼Œè¯´æ˜æ­¤æ—¶æ˜¯æœ€åä¸€ä¸ªreaderï¼Œæ­¤æ—¶å¯ä»¥å”¤é†’è¢«é˜»å¡çš„writer
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;nf&#34;&gt;runtime_Semrelease&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rw&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;writerSem&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id=&#34;lockæ–¹æ³•-1&#34;&gt;Lockæ–¹æ³•&lt;/h2&gt;
&lt;p&gt;RWMutex&lt;strong&gt;å†…éƒ¨ä½¿ç”¨Mutexå®ç°å†™é”äº’æ–¥&lt;/strong&gt;ï¼Œè§£å†³å¤šä¸ªwriteré—´çš„ç«äº‰ï¼ŒreaderWaitå­—æ®µå®ç°å†™æ“ä½œä¸ä¼šè¢«è¯»æ“ä½œé˜»å¡è€Œé¥¿æ­»ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;è°ƒç”¨wçš„Lockæ–¹æ³•åŠ é”ï¼Œé˜²æ­¢å…¶ä»–writerä¸Šé”ï¼Œcasåè½¬ readerCountçš„å€¼å¹¶æ›´æ–°åˆ°RWMutexä¸­ï¼Œä½¿å…¶å˜æˆè´Ÿæ•°&lt;code&gt;readerCount - rwmutexMaxReaders&lt;/code&gt; å‘Šè¯‰readeræœ‰writerè¦è¯·æ±‚é”ï¼›&lt;/li&gt;
&lt;li&gt;å¦‚æœæ­¤æ—¶&lt;code&gt;readerCount != 0&lt;/code&gt;ï¼Œè¯´æ˜å½“å‰æœ‰readeræŒæœ‰è¯»é”ï¼Œéœ€è¦è®°å½•éœ€è¦ç­‰å¾…å®Œæˆçš„readerçš„æ•°é‡ï¼Œå³readerWaitçš„å€¼ï¼ˆreaderWaiter + readerCountï¼‰ï¼Œå¹¶ä¸”å¦‚æœæ­¤æ—¶readerWait != 0ï¼Œå°†å½“å‰goroutineåŠ å…¥writerSemaæŒ‡å‘çš„é˜Ÿåˆ—ä¸­ï¼Œè¿›è¡Œç­‰å¾…ã€‚ç›´åˆ°æœ‰goroutineè°ƒç”¨RUnlockæ–¹æ³•ä¸”æ˜¯æœ€åä¸€ä¸ªé‡Šæ”¾é”æ—¶ï¼Œæ‰ä¼šè¢«å”¤é†’ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rw&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;RWMutex&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;c1&#34;&gt;// åŠ é”ï¼Œä¿è¯åªæœ‰ä¸€ä¸ªwriterèƒ½å¤„ç†
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;rw&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;w&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
	&lt;span class=&#34;c1&#34;&gt;// readerCountå–åè¿›è¡Œæ›´æ–°ï¼Œè¡¨ç¤ºæœ‰writeråœ¨æ‰§è¡Œï¼Œé˜»å¡åé¢çš„è¯»æ“ä½œï¼Œ
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// å› ä¸ºreaderCountï¼ŒreaderWaitéƒ½æ˜¯å…¨å±€å˜é‡ï¼Œåœ¨è¯»é”æ–¹æ³•é‚£è¾¹æ˜¯æ²¡æœ‰é”ä¿æŠ¤çš„ï¼Œæ‰€ä»¥æ˜¯casä¿è¯å¹¶å‘å®‰å…¨
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// readerCountå†å–åå›æ¥ï¼Œç”¨æ¥æ›´æ–°readerWaitçš„å€¼ï¼Œåˆ¤æ–­æ˜¯å¦æœ‰è¯»æ“ä½œåœ¨ç­‰å¾…
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;atomic&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;AddInt32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rw&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;readerCount&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rwmutexMaxReaders&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rwmutexMaxReaders&lt;/span&gt;
	&lt;span class=&#34;c1&#34;&gt;// readerWait ä¸ç­‰äº0ï¼Œè¯´æ˜æœ‰readeråœ¨æ‰§è¡Œï¼Œéœ€è¦æŒ‚èµ·å½“å‰çš„å†™æ“ä½œï¼Œç›´åˆ°RUnlockè¢«è°ƒç”¨æ¥å”¤é†’
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;atomic&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;AddInt32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rw&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;readerWait&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nf&#34;&gt;runtime_SemacquireMutex&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rw&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;writerSem&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id=&#34;unlockæ–¹æ³•-1&#34;&gt;Unlockæ–¹æ³•&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;casåè½¬readerCountçš„å€¼ï¼ˆreaderCount + rwmutexMaxReadersï¼‰ï¼Œä½¿å…¶å˜æˆreaderçš„æ•°é‡ï¼Œå”¤é†’è¿™äº›reader&lt;/li&gt;
&lt;li&gt;è°ƒç”¨wçš„Unlockæ–¹æ³•é‡Šæ”¾å½“å‰goroutineçš„é”ï¼Œè®©å…¶ä»–writerå¯ä»¥ç»§ç»­ç«äº‰ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rw&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;RWMutex&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Unlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;c1&#34;&gt;// åè½¬readerCountå€¼ä½¿å…¶å˜æ­£æ•°ï¼Œè¡¨ç¤ºå¯ä»¥è¿›è¡Œè¯»æ“ä½œ
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;atomic&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;AddInt32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rw&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;readerCount&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rwmutexMaxReaders&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rwmutexMaxReaders&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;race&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Enable&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
		&lt;span class=&#34;nf&#34;&gt;throw&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;sync: Unlock of unlocked RWMutex&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;c1&#34;&gt;// æ ¹æ®readerWaitå”¤é†’æ­£åœ¨é˜»å¡çš„è¯»æ“ä½œ
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nf&#34;&gt;runtime_Semrelease&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rw&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;readerSem&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;c1&#34;&gt;// è§£é”ï¼Œå…è®¸å…¶ä»–å†™æ“ä½œæ‰§è¡Œ
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;rw&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;w&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Unlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h1 id=&#34;syncmap&#34;&gt;sync.Map&lt;/h1&gt;
&lt;h2 id=&#34;æ•°æ®ç»“æ„-2&#34;&gt;æ•°æ®ç»“æ„&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Map&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// é”ï¼Œç”¨äºä¿æŠ¤dirty
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;mu&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Mutex&lt;/span&gt;
	&lt;span class=&#34;c1&#34;&gt;// å­˜è¯»çš„æ•°æ®ï¼Œåªè¯»ï¼Œç”±dirtyæå‡å¾—åˆ°
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;read&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;atomic&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Value&lt;/span&gt;
	&lt;span class=&#34;c1&#34;&gt;// åŒ…å«æœ€æ–°å†™å…¥çš„æ•°æ®ï¼Œå¹¶ä¸”åœ¨å†™çš„æ—¶å€™ï¼Œå¦‚æœdirtyæ˜¯nilï¼Œä¼šæŠŠreadä¸­æœªè¢«åˆ é™¤çš„æ•°æ®æ‹·è´åˆ°è¯¥dirtyä¸­
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;dirty&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;map&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{}]&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;entry&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// å½“ä»readä¸­è¯»ä¸åˆ°æ•°æ®ï¼Œä½†åœ¨dirtyä¸­è¯»åˆ°æ•°æ®æ—¶è¯¥å€¼+1, å½“len(dirty) == missesæ—¶ï¼Œå°†dirtyæ‹·è´åˆ°readä¸­ï¼Œæ­¤åŠ¨ä½œä¼šå‘ç”Ÿåœ¨getå’Œdeleteçš„æ“ä½œä¸­
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;misses&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;readOnly&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;       &lt;span class=&#34;kd&#34;&gt;map&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{}]&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;entry&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// trueè¡¨æ˜dirtyä¸­å­˜åœ¨readä¸­æ²¡æœ‰çš„é”®å€¼å¯¹ï¼Œæœ‰ä¸¤ç§æƒ…å†µï¼š1.è¢«åˆ é™¤çš„keyï¼Œåªèƒ½åœ¨readä¸­æ‰¾åˆ°ï¼›2.æ–°å¢åŠ çš„keyï¼Œåªèƒ½åœ¨dirtyä¸­æ‰¾åˆ°
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;amended&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;// readå’Œdirtyéƒ½åŒ…å«äº†*entryï¼Œé‡Œé¢çš„pæ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œreadå’Œdirtyå„è‡ªç»´æŠ¤äº†ä¸€å¥—keyï¼Œä½†ä»–ä»¬éƒ½æŒ‡å‘åŒä¸€ä¸ªvalue
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;entry&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// pçš„çŠ¶æ€æœ‰ä¸‰ç§ï¼š1.=nilï¼Œè¡¨ç¤ºé”®å€¼å¯¹å·²è¢«åˆ é™¤ï¼›2.=expungedï¼Œè¡¨ç¤ºè¯¥keyè¢«æ ‡è®°åˆ é™¤ï¼›3.=æ­£å¸¸å€¼
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;p&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;unsafe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Pointer&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id=&#34;åŸºæœ¬-2&#34;&gt;åŸºæœ¬&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;åŸºæœ¬çš„å¹¶å‘å®‰å…¨mapçš„å®ç°ï¼šå°†mapä¸RWMutexå°è£…æˆä¸€ä¸ªç»“æ„ä½“ï¼Œä½¿ç”¨è¯»å†™é”å°è£…mapçš„å„ç§æ“ä½œå³å¯ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä½¿ç”¨RWMutexå°è£…çš„å¹¶å‘å®‰å…¨çš„mapï¼Œå› ä¸ºé”çš„ç²’åº¦å¤ªå¤§ï¼Œæ€§èƒ½ä¸ä¼šå¤ªå¥½ï¼›é€šè¿‡å‡å°‘é”çš„ç²’åº¦å’ŒæŒæœ‰é”çš„æ—¶é—´ï¼Œå¯ä»¥æå‡æ€§èƒ½ï¼Œå¸¸è§çš„å‡å°‘é”çš„ç²’åº¦æ˜¯å°†é”åˆ†ç‰‡ï¼Œå°†é”è¿›è¡Œåˆ†ç‰‡ï¼Œåˆ†åˆ«æ§åˆ¶mapä¸­ä¸åŒçš„èŒƒå›´çš„keyï¼Œç±»ä¼¼JDK7ä¸­çš„ConcurrentHashMapçš„segmenté”å®ç°ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å®˜æ–¹å‡ºå“çš„sync.Mapï¼Œæœ‰å…­ä¸ªæ–¹æ³•ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;LoadOrStoreï¼šæ ¹æ®keyè·å–valueï¼Œå¦‚æœè¯¥keyå­˜åœ¨ä¸”æ²¡æœ‰è¢«æ ‡è®°ä¸ºåˆ é™¤ï¼Œåˆ™è¿”å›åŸæ¥çš„valueå’Œtrueï¼Œä¸å­˜åœ¨åˆ™è¿›è¡Œstoreï¼Œè¿”å›è¯¥valueå’Œfalse&lt;/li&gt;
&lt;li&gt;Loadï¼šæ ¹æ®keyè·å–value&lt;/li&gt;
&lt;li&gt;Deleteï¼šåˆ é™¤&lt;/li&gt;
&lt;li&gt;LoadAndDeleteï¼šæ ¹æ®keyåˆ é™¤å¯¹åº”çš„é”®å€¼å¯¹ï¼Œå¦‚æœå¯ä»¥å­˜åœ¨ï¼Œè¿”å›å¯¹åº”çš„valueå’Œtrue&lt;/li&gt;
&lt;li&gt;Rangeï¼šéå†&lt;/li&gt;
&lt;li&gt;Storeï¼šæ·»åŠ keyå’Œvalue&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å®˜æ–¹å‡ºå“çš„sync.Mapï¼Œä½†å®ƒåªæœ‰åœ¨éƒ¨åˆ†ç‰¹æ®Šçš„åœºæ™¯é‡Œæ‰æœ‰ä¼˜åŠ¿ï¼Œæ¯”å¦‚ä¸€ä¸ªåªä¼šå¢é•¿çš„mapï¼Œä¸€ä¸ªkeyåªä¼šè¢«å†™ä¸€æ¬¡ï¼Œè¯»å¾ˆå¤šæ¬¡ï¼›æˆ–è€… å¤šä¸ªgoroutineä¸ºä¸ç›¸äº¤çš„é”®é›†è¯»ã€å†™å’Œé‡å†™é”®å€¼å¯¹ï¼›&lt;/p&gt;
&lt;p&gt;sync.Mapå†…éƒ¨æœ‰ä¸¤ä¸ªmapï¼Œä¸€ä¸ªåªè¯»readï¼Œä¸€ä¸ªå¯å†™dirtyï¼Œå¯¹åªè¯»readçš„æ“ä½œ(è¯»ã€æ›´æ–°ã€åˆ é™¤)ä¸éœ€è¦åŠ é”ï¼Œä»¥æ­¤å‡å°‘é”å¯¹æ€§èƒ½çš„å½±å“ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;sync.Mapæ²¡æœ‰lenæ–¹æ³•ï¼Œè¦è·å–é‡Œé¢æœ‰å¤šå°‘ä¸ªkeyåªèƒ½éå†è·å–ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;storeæ–¹æ³•&#34;&gt;Storeæ–¹æ³•&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;åˆ›å»ºæ–°dirtyæ—¶ï¼Œå°†readä¸­éåˆ é™¤çš„é”®å€¼å¯¹èµ‹å€¼ç»™dirtyæ˜¯åœ¨storeæ–¹æ³•ä¸­æ‰§è¡Œã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;æ›´æ–°æˆ–å†™å…¥é”®å€¼å¯¹æ—¶ï¼Œå…ˆåˆ¤æ–­readä¸­æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨ï¼Œä¼šè‡ªæ—‹æ›´æ–°è¯¥é”®å€¼å¯¹ç›´åˆ°æˆåŠŸï¼›&lt;/p&gt;
&lt;p&gt;åŸå› æ˜¯&lt;strong&gt;readä¸­çš„é”®å€¼å¯¹ï¼Œä¸€å®šåŒ…å«äº†dirtyä¸­çš„é”®å€¼å¯¹&lt;/strong&gt;ï¼Œå¦å¤–ï¼Œreadå’ŒdirtyæŒ‡å‘åŒä¸€ä¸ªvalueï¼Œæ‰€ä»¥ç›´æ¥ä¿®æ”¹ä¸€æ¬¡å³å¯ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¦‚æœreadä¸­è¯»ä¸åˆ°ï¼Œæ‰ä¼šè¿›è¡ŒåŠ é”ï¼›&lt;/p&gt;
&lt;p&gt;åŠ é”åå†æ¬¡åˆ¤æ–­readä¸­æ˜¯å¦å­˜åœ¨ï¼Œç¡®å®šreadä¸­çœŸçš„ä¸å­˜åœ¨æ‰ä¼šæ“ä½œdirtyï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¦‚æœreadä¸­å­˜åœ¨ï¼Œåˆ¤æ–­è¯¥keyæ˜¯å¦è¢«åˆ é™¤ï¼Œå¦‚æœæ˜¯ï¼Œæ›´æ–°dirtyçš„é”®å€¼å¯¹ï¼Œå¦‚æœä¸æ˜¯ï¼Œæ›´æ–°readä¸­çš„é”®å€¼å¯¹ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¦‚æœreadä¸­ä¸å­˜åœ¨ï¼Œåˆ™è¯»å–dirtyï¼Œåˆ¤æ–­dirtyæ˜¯å¦å­˜åœ¨ï¼Œå­˜åœ¨åˆ™æ›´æ–°dirtyçš„é”®å€¼å¯¹ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¦‚æœdirtyä¸å­˜åœ¨ï¼Œä¸”dirtyä¸­ä¸å­˜åœ¨æœ‰çš„é”®å€¼å¯¹åœ¨readä¸­æ²¡æœ‰ï¼Œå¦‚æœdirtyä¸ºç©ºï¼Œåˆ›å»ºæ–°dirtyï¼ŒåŒæ—¶éœ€è¦éå†æŠŠreadä¸­éåˆ é™¤çš„é”®å€¼å¯¹èµ‹ç»™dirtyï¼›æ›´æ–°&lt;code&gt;read.amended&lt;/code&gt;çš„å€¼ï¼Œè¡¨æ˜dirtyä¸­å­˜åœ¨readä¸­æ²¡æœ‰çš„é”®å€¼å¯¹ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æœ€åå†å°†æ–°çš„é”®å€¼å¯¹æ·»åŠ åˆ°dirtyä¸­ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è§£é”ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æ€»ç»“ï¼šå¦‚æœæ˜¯æ–°keyï¼Œåˆ™åŠ é”ï¼Œä¼˜å…ˆputåˆ°dirtyä¸­ï¼Œå¦‚æœæ˜¯dirtyä¸ºç©ºï¼Œåˆ™åˆ›å»ºæ–°dirtyï¼Œå°†readä¸­éåˆ é™¤é”®å€¼å¯¹èµ‹å€¼ç»™æ–°dirtyï¼Œå°†readæ ‡è®°ä¸ºæœ‰keyåœ¨dirtyä¸­ä½†ä¸å­˜åœ¨åœ¨readä¸­ï¼Œè§£é”ï¼›å¦‚æœæ˜¯å·²å­˜åœ¨çš„keyï¼Œç”±äºreadå’Œdirtyçš„valueæ˜¯åŒä¸€ä¸ªå¼•ç”¨ï¼Œç›´æ¥casæ›´æ–°readå³å¯ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;nx&#34;&gt;read&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;read&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Load&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;readOnly&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;e&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;read&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;];&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;e&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;tryStore&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;mu&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;read&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;read&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Load&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;readOnly&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;e&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;read&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;];&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;e&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;unexpungeLocked&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;dirty&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;e&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;e&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;storeLocked&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;e&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;dirty&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;];&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;e&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;storeLocked&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;read&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;amended&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
            &lt;span class=&#34;c1&#34;&gt;// å°†readMapä¸­éåˆ é™¤çš„é”®å€¼å¯¹èµ‹å€¼ç»™dirtyMap
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;			&lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;dirtyLocked&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
            &lt;span class=&#34;c1&#34;&gt;// æ ‡è®°dirtyMapä¸­åŒ…å«readMapä¸­ä¸å­˜åœ¨çš„é”®å€¼å¯¹
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;			&lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;read&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Store&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;readOnly&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;read&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;amended&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;})&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;dirty&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;newEntry&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;mu&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Unlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id=&#34;loadæ–¹æ³•&#34;&gt;Loadæ–¹æ³•&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;å°†dirtyæå‡ä¸ºreadè¿™ä¸ªæ“ä½œåœ¨loadæ–¹æ³•ä¸­æ‰§è¡Œã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä¸åŠ é”ï¼Œä¼˜å…ˆè¯»å–readä¸­çš„é”®å€¼å¯¹ï¼Œåˆ¤æ–­keyæ˜¯å¦å­˜åœ¨ï¼Œå­˜åœ¨åˆ™è¿”å›ï¼›&lt;/li&gt;
&lt;li&gt;å¦‚æœreadä¸­ä¸å­˜åœ¨ï¼Œä¸”dirtyä¸­åŒ…å«äº†readä¸­ä¸å­˜åœ¨çš„é”®å€¼å¯¹ï¼ŒåŠ é”ï¼Œå†æ¬¡è¯»å–readä¸­çš„é”®å€¼å¯¹ï¼›&lt;/li&gt;
&lt;li&gt;åˆ¤æ–­readä¸­çš„é”®å€¼å¯¹æ˜¯å¦å­˜åœ¨ï¼Œå­˜åœ¨åˆ™è¿”å›ï¼›&lt;/li&gt;
&lt;li&gt;å¦‚æœreadä¸­ä¸å­˜åœ¨ï¼Œä¸”dirtyä¸­åŒ…å«äº†readä¸­ä¸å­˜åœ¨çš„é”®å€¼å¯¹ï¼ŒæŸ¥è¯¢dirtyä¸­æ˜¯å¦å­˜åœ¨ï¼›&lt;/li&gt;
&lt;li&gt;åŒæ—¶å¢åŠ missçš„å€¼(missè¡¨ç¤ºè¯»å–ç©¿é€çš„æ¬¡æ•°)ï¼Œå½“missçš„å€¼ç­‰äºdirtyçš„é•¿åº¦æ—¶ï¼Œå°±ä¼šå°†dirtyæå‡ä¸ºreadï¼Œåªéœ€ç®€å•çš„èµ‹å€¼å³å¯ï¼Œç„¶åå°†dirtyç½®ä¸ºnullï¼Œé‡ç½®missæ•°ï¼Œé¿å…æ€»æ˜¯ä»dirtyä¸­åŠ é”è¯»å–ï¼›&lt;/li&gt;
&lt;li&gt;è§£é”ï¼Œå°†dirtyä¸­çš„æŸ¥è¯¢ç»“æœè¿”å›ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æ€»ç»“ï¼šä¼˜å…ˆè¯»readä¸­çš„keyï¼Œè¯»ä¸åˆ°ï¼Œåˆ¤æ–­readçš„æ ‡è®°ï¼ˆdirtyæ˜¯å¦åŒ…å«readä¸­ä¸å­˜åœ¨çš„keyï¼‰ï¼ŒåŠ é”ï¼Œå†è¯»readï¼Œè¿˜è¯»ä¸åˆ°ï¼Œå†åˆ¤æ–­dirtyæ˜¯å¦åŒ…å«readä¸­ä¸å­˜åœ¨çš„keyï¼Œå¦‚æœæ˜¯ï¼Œæ‰ä¼šå»è¯»dirtyï¼ŒåŒæ—¶misså€¼+1ï¼Œå½“misså€¼=dirtyé•¿åº¦æ—¶ï¼Œå°†dirtyä¸­çš„é”®å€¼å¯¹èµ‹å€¼ç»™readï¼Œè§£é”ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Map&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Load&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{})&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;value&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{},&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;read&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;read&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Load&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;readOnly&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;e&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;read&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;read&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;amended&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;mu&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;read&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;read&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Load&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;readOnly&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;e&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;read&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;read&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;amended&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;e&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;dirty&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
            &lt;span class=&#34;c1&#34;&gt;// å¢åŠ missçš„å€¼ï¼Œåˆ¤æ–­é‡Šæ”¾è¦å°†dityæå‡ä¸ºread
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;			&lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;missLocked&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;mu&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Unlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;e&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;load&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Map&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;missLocked&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;misses&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;misses&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;dirty&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// å°†dirtyMapæå‡ç»™readMap
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;read&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Store&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;readOnly&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;dirty&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;})&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;dirty&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;misses&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id=&#34;deleteæ–¹æ³•&#34;&gt;Deleteæ–¹æ³•&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;å°†dirtyæå‡ä¸ºreadè¿™ä¸ªæ“ä½œä¹Ÿä¼šåœ¨deleteæ–¹æ³•ä¸­æ‰§è¡Œã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;åˆ¤æ–­readä¸­æ˜¯å¦å­˜åœ¨è¯¥keyï¼›&lt;/li&gt;
&lt;li&gt;å¦‚æœreadä¸­ä¸å­˜åœ¨ï¼Œä¸”dirtyä¸­åŒ…å«äº†readä¸­ä¸å­˜åœ¨çš„keyï¼ŒåŠ é”ï¼›&lt;/li&gt;
&lt;li&gt;å¦‚æœreadä¸­çœŸçš„ä¸å­˜åœ¨ï¼Œä¸”dirtyä¸­åŒ…å«äº†readä¸­ä¸å­˜åœ¨çš„keyï¼Œåˆ é™¤dirtyä¸­è¯¥keyå’Œvalueï¼Œæ­¤æ—¶missä¹Ÿä¼š + 1ï¼Œå½“misså€¼=dirtyé•¿åº¦æ—¶ï¼Œå°†dirtyä¸­éåˆ é™¤çš„é”®å€¼å¯¹èµ‹å€¼ç»™readï¼Œè§£é”ï¼›&lt;/li&gt;
&lt;li&gt;å¦‚æœå­˜åœ¨è¯¥keyï¼ˆæ­¤æ—¶è¯¥é”®å€¼å¯¹åªä¼šåœ¨readä¸­å­˜åœ¨ï¼‰ï¼Œè‡ªæ—‹ï¼Œç›´æ¥åœ¨è¯¥keyå¯¹åº”çš„entryæ‰“ä¸Šexpungedæ ‡è®°ï¼Œè¡¨ç¤ºåˆ é™¤ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æ€»ç»“ï¼šä¼˜å…ˆè¯»readï¼Œè¯»ä¸åˆ°ï¼ŒåŠ é”ï¼Œå¦‚æœdirtyä¸­å­˜åœ¨è¯¥keyï¼Œdirtyä¸­è¯¥é”®å€¼å¯¹ä¼šè¢«çœŸæ­£çš„åˆ é™¤ï¼Œä½†æ­¤æ—¶readä¸­çš„é”®å€¼å¯¹è¿˜æ²¡è¢«åˆ é™¤ï¼Œåªæ˜¯å…¶keyå¯¹åº”çš„valueè¢«æ‰“ä¸Šä¸€ä¸ªexpungedæ ‡è®°ï¼Œè¡¨ç¤ºåˆ é™¤ï¼Œä½¿å…¶åœ¨è¢«getçš„æ—¶å€™èƒ½åˆ†è¾¨å‡ºæ¥ï¼Œreadä¸­è¯¥keyçœŸæ­£çš„åˆ é™¤åªæœ‰åœ¨å°†dirtyæå‡ä¸ºreadçš„æ—¶å€™ï¼›&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Map&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Delete&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{})&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;LoadAndDelete&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Map&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;LoadAndDelete&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{})&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;value&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{},&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;loaded&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;read&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;read&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Load&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;readOnly&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;e&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;read&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;read&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;amended&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;mu&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;read&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;read&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Load&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;readOnly&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;e&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;read&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;read&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;amended&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;e&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;dirty&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
			&lt;span class=&#34;nb&#34;&gt;delete&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;dirty&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
			&lt;span class=&#34;c1&#34;&gt;// å¢åŠ missçš„å€¼ï¼Œåˆ¤æ–­é‡Šæ”¾è¦å°†dityæå‡ä¸ºread
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;			&lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;missLocked&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;mu&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Unlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;c1&#34;&gt;// è‡ªæ—‹ï¼Œcasç»™keyæ‰“ä¸Šåˆ é™¤æ ‡è®°
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;e&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;delete&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id=&#34;loadorstoreæ–¹æ³•&#34;&gt;LoadOrStoreæ–¹æ³•&lt;/h2&gt;
&lt;p&gt;åŸºæœ¬ä¸Šå’ŒStoreæ–¹æ³•ä¸€æ ·ï¼Œåªæ˜¯å¢å¤šä¸€ç‚¹é€»è¾‘ï¼šå¦‚æœè¯¥keyå­˜åœ¨ä¸”æ²¡æœ‰è¢«æ ‡è®°ä¸ºåˆ é™¤ï¼Œåˆ™è¿”å›åŸæ¥çš„valueå’Œtrueï¼Œä¸å­˜åœ¨åˆ™è¿›è¡Œstoreï¼Œè¿”å›è¯¥valueå’Œfalseã€‚&lt;/p&gt;
&lt;h1 id=&#34;waitgroup&#34;&gt;WaitGroup&lt;/h1&gt;
&lt;h2 id=&#34;æ•°æ®ç»“æ„-3&#34;&gt;æ•°æ®ç»“æ„&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;8
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;WaitGroup&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; 
    &lt;span class=&#34;c1&#34;&gt;// é¿å…å¤åˆ¶ï¼Œä½¿ç”¨vetå·¥å…·åœ¨ç¼–è¯‘æ—¶æ£€æµ‹æ˜¯å¦è¢«å¤åˆ¶
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;noCopy&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;noCopy&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// å› ä¸º64bitå€¼çš„åŸå­æ“ä½œéœ€è¦64bitå¯¹é½ï¼Œä½†æ˜¯32bitç¼–è¯‘å™¨ä¸æ”¯æŒï¼Œæ‰€ä»¥æ•°ç»„ä¸­çš„å…ƒç´ åœ¨ä¸åŒçš„æ¶æ„ä¸­ä¸ä¸€æ ·
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// å¦‚æœåœ°å€æ˜¯64bitå¯¹é½ï¼Œæ•°ç»„å‰ä¸¤ä¸ªå…ƒç´ åšstateï¼Œåä¸€ä¸ªå…ƒç´ åšä¿¡å·é‡ï¼›å¦‚æœåœ°å€æ˜¯32bitå¯¹é½ï¼Œæ•°ç»„åä¸¤ä¸ªå…ƒç´ åšstateï¼Œç¬¬ä¸€ä¸ªå…ƒç´ åšä¿¡å·é‡
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// é«˜32bitæ˜¯WaitGroupçš„è®¡æ•°å€¼ï¼Œä½32bitæ˜¯waiterçš„è®¡æ•°,å¦å¤–32bitæ˜¯ç”¨ä½œä¿¡å·é‡
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;state1&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ä¿¡å·é‡çš„ä½œç”¨ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å½“ä¿¡å·é‡&amp;gt;0æ—¶ï¼Œè¡¨ç¤ºèµ„æºå¯ç”¨ï¼Œè·å–ä¿¡å·é‡æ—¶ç³»ç»Ÿè‡ªåŠ¨å°†ä¿¡å·é‡å‡1ï¼›&lt;/li&gt;
&lt;li&gt;å½“ä¿¡å·é‡==0æ—¶ï¼Œè¡¨ç¤ºèµ„æºæš‚ä¸å¯ç”¨ï¼Œè·å–ä¿¡å·é‡æ—¶ï¼Œå½“å‰çº¿ç¨‹ä¼šè¿›å…¥ç¡çœ ï¼Œå½“ä¿¡å·é‡ä¸ºæ­£æ—¶è¢«å”¤é†’ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;åŸºæœ¬-3&#34;&gt;åŸºæœ¬&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;stateçš„å€¼ç”±32bitçš„å€¼è¡¨ç¤ºä¿¡å·é‡ï¼Œ64bitçš„å€¼è¡¨ç¤ºè®¡æ•°å’Œwaiterçš„æ•°é‡ç»„æˆã€‚å› ä¸ºåŸå­æ“ä½œåªèƒ½64bitå¯¹é½ï¼Œè€Œè®¡æ•°å€¼å’Œwaiterçš„æ•°é‡æ˜¯ä¸€ä¸ª64bitçš„å€¼ï¼Œåœ¨64bitçš„ç¼–è¯‘å™¨ä¸Šï¼Œä¸€æ¬¡è¯»å–æ˜¯64bitï¼Œåˆšå¥½å¯ä»¥ç›´æ¥æ“ä½œï¼Œä½†æ˜¯å¦‚æœæ˜¯32bitçš„æœºå™¨ï¼Œä¸€æ¬¡åªèƒ½è¯»32bitï¼Œä¸ºäº†ä¿è¯è¿›è¡Œ64bitå¯¹é½æ—¶ä¸€å®šèƒ½è·å–åˆ°è®¡æ•°å€¼å’Œwaiterçš„å€¼ï¼Œåœ¨è¿›è¡Œ64bitçš„åŸå­æ“ä½œå¯¹é½æ—¶ï¼Œç¬¬ä¸€æ¬¡æ˜¯å¯¹é½åˆ°äº†ä¸€ä¸ªç©º32bitå’Œç¬¬ä¸€ä¸ª32bitçš„å€¼ï¼Œç¬¬äºŒæ¬¡å¯¹é½å°±èƒ½ä¿è¯è·å–äº†ã€‚&lt;/li&gt;
&lt;li&gt;åŒRWMutexï¼ŒWaitGroupçš„ä¸‰ä¸ªæ–¹æ³•å†…è¿˜å¾ˆå¤šdata raceæ£€æŸ¥ï¼Œä¿è¯å¹¶å‘æ—¶å€™å…±äº«æ•°æ®çš„æ­£ç¡®æ€§ï¼Œä¸€æ—¦æ£€æŸ¥å‡ºæœ‰é—®é¢˜ï¼Œä¼šç›´æ¥panic&lt;/li&gt;
&lt;li&gt;ä¸€å¼€å§‹è®¾ç½®WaitGroupçš„è®¡æ•°å€¼å¿…é¡»å¤§äºç­‰äº0ï¼Œå¦åˆ™ä¼šè¿‡ä¸äº†data raceæ£€æŸ¥ï¼Œç›´æ¥panic&lt;/li&gt;
&lt;li&gt;Addçš„å€¼å¿…é¡» ç­‰äº è°ƒç”¨Doneçš„æ¬¡æ•°ï¼Œå½“Doneçš„æ¬¡æ•°è¶…è¿‡è®¡æ•°å€¼ï¼Œä¹Ÿä¼španic&lt;/li&gt;
&lt;li&gt;Waitæ–¹æ³•çš„è°ƒç”¨ä¸€å®šè¦æ™šäºAddï¼Œå¦åˆ™ä¼šå¯¼è‡´æ­»é”&lt;/li&gt;
&lt;li&gt;WaitGroupå¯ä»¥åœ¨è®¡æ•°å€¼ä¸º0æ—¶å¯é‡å¤ä½¿ç”¨&lt;/li&gt;
&lt;li&gt;noCopyæ˜¯ä¸€ä¸ªå®ç°äº†Lockæ¥å£çš„ç»“æ„ä½“ï¼Œä¸”ä¸å¯¹å¤–æš´éœ²ï¼Œå…¶Lockæ–¹æ³•å’ŒUnlockæ–¹æ³•éƒ½æ˜¯ç©ºå®ç°ï¼Œç”¨äºvetå·¥å…·æ£€æŸ¥WaitGroupåœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­æœ‰æ²¡æœ‰è¢«å¤åˆ¶ï¼›å½“æˆ‘ä»¬è‡ªå®šä¹‰çš„ç»“æ„ä¸æƒ³è¢«å¤åˆ¶ä½¿ç”¨æ—¶ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å®ƒã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨æ—¶è¦é¿å…å¤åˆ¶&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;addæ–¹æ³•&#34;&gt;Addæ–¹æ³•&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;åŸå­çš„å°†WaitGroupçš„è®¡æ•°å€¼åŠ åˆ°stateä¸Šï¼Œå¦‚æœå½“å‰çš„è®¡æ•°å€¼ &amp;gt; 0ï¼Œæˆ–è€… waiterçš„æ•°é‡ç­‰äº0ï¼Œç›´æ¥è¿”å›&lt;/li&gt;
&lt;li&gt;å¦åˆ™ï¼Œå³ä»£è¡¨å½“å‰çš„è®¡æ•°å€¼ä¸º0ï¼Œä½†waiterçš„æ•°é‡ä¸ä¸€å®šä¸º0ï¼Œæ­¤æ—¶stateçš„å€¼å°±æ˜¯waiterçš„æ•°é‡&lt;/li&gt;
&lt;li&gt;å°†stateçš„å€¼è®¾ç½®ä¸º0ï¼Œå³waiterçš„æ•°é‡è®¾ç½®ä¸º0ï¼Œç„¶åå”¤é†’æ‰€æœ‰waiter&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;wg&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;WaitGroup&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;state&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;statep&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint64&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;semap&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;uintptr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;unsafe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Pointer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;wg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;state1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;%&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;8&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint64&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;unsafe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Pointer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;wg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;state1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)),&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;wg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;state1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint64&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;unsafe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Pointer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;wg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;state1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])),&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;wg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;state1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;wg&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;WaitGroup&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Add&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;delta&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;statep&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;semap&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;wg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;state&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;state&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;atomic&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;AddUint64&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;statep&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;uint64&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;delta&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;v&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;int32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;state&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// è®¡æ•°å™¨
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;w&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;state&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// ç­‰å¾…è®¡æ•°å™¨
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;v&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nb&#34;&gt;panic&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;sync: negative WaitGroup counter&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// ç­‰å¾…è®¡æ•°å™¨ä¸ä¸º0ï¼Œè¯´æ˜å·²ç»æ‰§è¡Œäº†waitæ–¹æ³•ï¼Œæ­¤æ—¶ä¸å…è®¸è°ƒç”¨addæ–¹æ³•
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;w&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;delta&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;v&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;int32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;delta&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nb&#34;&gt;panic&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;sync: WaitGroup misuse: Add called concurrently with Wait&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;v&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;||&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;w&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// å¦‚æœæ‰§è¡Œåˆ°è¿™é‡Œï¼Œè¯´æ˜è®¡æ•°å™¨ä¸º0ï¼Œä½†ç­‰å¾…è®¡æ•°å™¨ä¸ä¸º0
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// è¯´æ˜æ­¤æ—¶å‘ç”Ÿäº†å¹¶å‘è°ƒç”¨Addæ–¹æ³•å’Œwaitæ–¹æ³•ï¼Œå¹¶å‘è°ƒç”¨å¯¼è‡´çŠ¶æ€ä¸ä¸€è‡´
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;statep&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;state&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nb&#34;&gt;panic&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;sync: WaitGroup misuse: Add called concurrently with Wait&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// çŠ¶æ€ä½æ¸…é›¶ï¼Œå”¤é†’ç­‰å¾…çš„goroutine
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;statep&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;w&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;w&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;--&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nf&#34;&gt;runtime_Semrelease&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;semap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id=&#34;doneæ–¹æ³•&#34;&gt;Doneæ–¹æ³•&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;è°ƒç”¨Addæ–¹æ³•ï¼Œåªæ˜¯å‚æ•°ä¸º-1ï¼Œè¡¨ç¤ºè®¡æ•°å€¼ - 1ï¼Œæœ‰ä¸€ä¸ªwaiterå®Œæˆå…¶ä»»åŠ¡ï¼›waiteræŒ‡çš„æ˜¯è°ƒç”¨Waitæ–¹æ³•çš„goroutine&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;wg&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;WaitGroup&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Done&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;wg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Add&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id=&#34;waitæ–¹æ³•&#34;&gt;Waitæ–¹æ³•&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;å¾ªç¯å†…ä¸æ–­æ£€æµ‹stateçš„å€¼ï¼Œå½“å…¶è®¡æ•°å€¼ä¸º0æ—¶ï¼Œè¯´æ˜æ‰€æœ‰ä»»åŠ¡å·²ç»å®Œæˆï¼Œè°ƒç”¨è¿™ä¸ªæ–¹æ³•çš„goroutineä¸å¿…ç»§ç»­ç­‰å¾…ï¼Œç›´æ¥è¿”å›ï¼Œç»“æŸè¯¥æ–¹æ³•&lt;/li&gt;
&lt;li&gt;å¦åˆ™ï¼Œè¯´æ˜æ­¤æ—¶è¿˜æœ‰ä»»åŠ¡æ²¡å®Œæˆï¼Œè°ƒç”¨è¯¥æ–¹æ³•çš„goroutineæˆä¸ºwaiterï¼ŒæŠŠwaiterçš„æ•°é‡ + 1ï¼ŒåŠ å…¥ç­‰å¾…é˜Ÿåˆ—ï¼Œé˜»å¡è‡ªå·±&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;wg&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;WaitGroup&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Wait&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;statep&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;semap&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;wg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;state&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;state&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;atomic&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;LoadUint64&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;statep&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;v&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;int32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;state&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;w&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;state&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
        &lt;span class=&#34;c1&#34;&gt;// è®¡æ•°å™¨ä¸º0ï¼Œè¯´æ˜goroutineæ‰§è¡Œç»“æŸ
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;v&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
		&lt;span class=&#34;c1&#34;&gt;// è°ƒç”¨waitæ–¹æ³•çš„goroutineçš„æ•°ç›®+1ï¼Œæ­¤æ—¶è°ƒç”¨Addæ–¹æ³•æ—¶å°±èƒ½çŸ¥é“æœ‰å¤šå°‘goroutineåœ¨ç­‰å¾…
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;atomic&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;CompareAndSwapUint64&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;statep&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;state&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;state&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;c1&#34;&gt;// é˜»å¡ç­‰å¾…ï¼Œç›´è‡³è¢«å”¤é†’
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;			&lt;span class=&#34;nf&#34;&gt;runtime_Semacquire&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;semap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;statep&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
				&lt;span class=&#34;nb&#34;&gt;panic&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;sync: WaitGroup is reused before previous Wait has returned&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h1 id=&#34;cond--condition--waitnotify&#34;&gt;Cond = condition + Wait/Notify&lt;/h1&gt;
&lt;h2 id=&#34;æ•°æ®ç»“æ„-4&#34;&gt;æ•°æ®ç»“æ„&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Cond&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; 
    &lt;span class=&#34;nx&#34;&gt;noCopy&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;noCopy&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// ä½¿ç”¨vetå·¥å…·åœ¨ç¼–è¯‘æ—¶æ£€æµ‹æ˜¯å¦è¢«å¤åˆ¶
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;checker&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;copyChecker&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// ç”¨äºè¿è¡Œæ—¶è¢«æ£€æµ‹æ˜¯å¦è¢«å¤åˆ¶
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;L&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Locker&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// å½“è§‚å¯Ÿæˆ–è€…ä¿®æ”¹ç­‰å¾…æ¡ä»¶çš„æ—¶å€™éœ€è¦åŠ é”
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;notify&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;notifyList&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// ç­‰å¾…é˜Ÿåˆ— 
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id=&#34;åŸºæœ¬-4&#34;&gt;åŸºæœ¬&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;åˆå§‹åŒ–æ—¶ï¼Œè¦æŒ‡å®šä½¿ç”¨çš„é”ï¼Œæ¯”å¦‚Mutex&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Cond æ˜¯ç­‰å¾…æŸä¸ªæ¡ä»¶æ»¡è¶³ï¼Œè¿™ä¸ªæ¡ä»¶çš„ä¿®æ”¹å¯ä»¥è¢«ä»»æ„å¤šçš„ goroutine æ›´æ–°ï¼Œè€Œä¸” Cond çš„ Wait ä¸å…³å¿ƒä¹Ÿä¸çŸ¥é“å…¶ä»– goroutine çš„æ•°é‡ï¼Œåªå…³å¿ƒç­‰å¾…æ¡ä»¶ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Signalæ–¹æ³•ï¼Œç±»ä¼¼Javaçš„notifyæ–¹æ³•ï¼Œå…è®¸è°ƒç”¨è€…å”¤é†’ä¸€ä¸ªç­‰å¾…æ­¤Condçš„goroutineï¼Œå¦‚æœæ­¤æ—¶æ²¡æœ‰waiterï¼Œåˆ™æ— äº‹å‘ç”Ÿï¼›å¦‚æœæ­¤æ—¶Condçš„ç­‰å¾…é˜Ÿåˆ—ä¸­æœ‰å¤šä¸ªgoroutineï¼Œåˆ™ç§»é™¤é˜Ÿé¦–çš„goroutineå¹¶å”¤é†’ï¼›&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨Signalæ–¹æ³•æ—¶ä¸å¼ºæ±‚å·²è°ƒç”¨äº†åŠ é”æ–¹æ³•&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Broadcastæ–¹æ³•ï¼Œç±»ä¼¼Javaçš„notifyAllæ–¹æ³•ï¼Œå…è®¸è°ƒç”¨è€…å”¤é†’ç­‰å¾…æ­¤Condçš„æ‰€æœ‰goroutineï¼Œå¦‚æœæ­¤æ—¶æ²¡æœ‰waiterï¼Œåˆ™æ— äº‹å‘ç”Ÿï¼›å¦‚æœæ­¤æ—¶Condçš„ç­‰å¾…é˜Ÿåˆ—ä¸­æœ‰å¤šä¸ªgoroutineï¼Œåˆ™æ¸…ç©ºæ•´ä¸ªç­‰å¾…é˜Ÿåˆ—ï¼Œå…¨éƒ¨å”¤é†’ï¼›&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨Broadcastæ–¹æ³•æ—¶ä¸å¼ºæ±‚å·²è°ƒç”¨äº†åŠ é”æ–¹æ³•&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Waitæ–¹æ³•ï¼Œç±»ä¼¼Javaçš„waitæ–¹æ³•ï¼ŒæŠŠè°ƒç”¨è€…çš„goroutineæ”¾å…¥Condçš„ç­‰å¾…é˜Ÿåˆ—ä¸­å¹¶é˜»å¡ï¼Œç›´åˆ°è¢«Signalæˆ–Broadcastæ–¹æ³•å”¤é†’&lt;/p&gt;
&lt;p&gt;è°ƒç”¨Waitæ–¹æ³•æ—¶å¿…é¡»å·²è°ƒç”¨äº†åŠ é”æ–¹æ³•ï¼Œå¦åˆ™ä¼španicï¼Œå› ä¸ºWaitæ–¹æ³•å†…æ˜¯&lt;strong&gt;å…ˆè§£é”&lt;/strong&gt;ï¼Œå°†å½“å‰goroutineåŠ å…¥åˆ°&lt;strong&gt;ç­‰å¾…&lt;/strong&gt;é˜Ÿåˆ—ï¼Œç„¶å&lt;strong&gt;è§£é”&lt;/strong&gt;ï¼Œé˜»å¡ä¼‘çœ å½“å‰goroutineï¼Œç›´åˆ°è¢«&lt;strong&gt;å”¤é†’&lt;/strong&gt;ï¼Œç„¶å&lt;strong&gt;åŠ é”&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;è°ƒç”¨Waitåä¸€å®šè¦æ£€æµ‹ç­‰å¾…æ¡ä»¶æ˜¯å¦æ»¡è¶³ï¼Œè¿˜éœ€ä¸éœ€è¦ç»§ç»­ç­‰å¾…ï¼Œåœ¨ç­‰å¾…çš„goroutineè¢«å”¤é†’ä¸ç­‰äºç­‰å¾…æ¡ä»¶å·²æ»¡è¶³ï¼Œå¯èƒ½åªæ˜¯è¢«æŸä¸ªgoroutineå”¤é†’è€Œå·²ï¼Œè¢«å”¤é†’æ—¶ï¼Œåªæ˜¯å¾—åˆ°äº†ä¸€æ¬¡æ£€æµ‹æœºä¼šã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;once&#34;&gt;Once&lt;/h1&gt;
&lt;h2 id=&#34;æ•°æ®ç»“æ„-5&#34;&gt;æ•°æ®ç»“æ„&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Once&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;done&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Mutex&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id=&#34;åŸºæœ¬-5&#34;&gt;åŸºæœ¬&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;sync.Onceåªæœ‰ä¸€ä¸ªDoæ–¹æ³•ï¼Œå…¥å‚æ˜¯ä¸€ä¸ªæ— å‚æ•°æ— è¿”å›å€¼çš„å‡½æ•°ï¼Œå½“ä¸”ä»…å½“ç¬¬ä¸€æ¬¡è°ƒç”¨Doæ–¹æ³•çš„æ—¶å€™è¯¥å‡½æ•°æ‰ä¼šæ‰§è¡Œï¼Œå³ä½¿ä¹‹åè°ƒç”¨äº†næ¬¡ã€å…¥å‚çš„å€¼ä¸ä¸€æ ·éƒ½ä¸ä¼šè¢«æ‰§è¡Œ&lt;/li&gt;
&lt;li&gt;å¯ä»¥å°†sync.Onceä¸æƒ³è¦åªåˆå§‹åŒ–ä¸€æ¬¡çš„å¯¹è±¡å°è£…æˆä¸€ä¸ªç»“æ„ä½“ï¼Œæä¾›åªåˆå§‹åŒ–ä¸€æ¬¡è¯¥å€¼çš„æ–¹æ³•ï¼Œå¸¸ç”¨äºåˆå§‹åŒ–å•ä¾‹èµ„æºã€å¹¶å‘è®¿é—®åªåˆå§‹åŒ–ä¸€æ¬¡çš„å…±äº«èµ„æºã€éœ€è¦å»¶è¿Ÿåˆå§‹åŒ–çš„åœºæ™¯ç­‰&lt;/li&gt;
&lt;li&gt;Onceä¼ å…¥çš„å‡½æ•°å‚æ•°ï¼Œå°±ç®—åœ¨æ‰§è¡Œæ—¶å‘ç”Ÿpanicï¼ŒOnceä¹Ÿä¼šè®¤ä¸ºå·²ç»æ‰§è¡Œè¿‡äº†ï¼Œsoå¦‚æœè¦çŸ¥é“Onceé‡Œä¼ å…¥çš„æ–¹æ³•æ˜¯å¦æ‰§è¡ŒæˆåŠŸï¼Œæ¨¡ä»¿Doå‡½æ•°è‡ªå·±å†™ä¸€ä¸ªè¿”å›å‚æ•°çš„å…¥å‚æ–¹æ³•&lt;/li&gt;
&lt;li&gt;å†…éƒ¨çš„å®ç°éå¸¸ç®€å•ï¼Œå°±æ˜¯ä¸€ä¸ªflag + ä¸€ä¸ªåŒé‡æ ¡éªŒé”&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;o&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Once&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Do&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// åˆ¤æ–­flagæ˜¯å¦è¢«ç½®ä¸º0ï¼Œå³å‡½æ•°æ˜¯å¦è¿˜æ²¡è¢«æ‰§è¡Œè¿‡
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;atomic&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;LoadUint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;o&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;done&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; 
        &lt;span class=&#34;nx&#34;&gt;o&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;doSlow&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; 
    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;o&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Once&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;doSlow&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; 
    &lt;span class=&#34;nx&#34;&gt;o&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; 
    &lt;span class=&#34;k&#34;&gt;defer&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;o&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Unlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;o&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;done&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;c1&#34;&gt;// å› ä¸ºå…¶ä»–æœ€å¤–å±‚çš„åˆ¤æ–­+LoadUnit32æ²¡æœ‰è¢«é”ä¿æŠ¤ï¼Œsoè¿™é‡Œå¾—åŸå­æ“ä½œ
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;k&#34;&gt;defer&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;atomic&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;StoreUint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;o&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;done&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; 
        &lt;span class=&#34;nf&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; 
    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h1 id=&#34;pool&#34;&gt;Pool&lt;/h1&gt;
&lt;p&gt;è¿™é‡Œæ˜¯é’ˆå¯¹go 1.13ä¹‹åçš„ç‰ˆæœ¬&lt;/p&gt;
&lt;h2 id=&#34;æ•°æ®ç»“æ„-6&#34;&gt;æ•°æ®ç»“æ„&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Pool&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// ä½¿ç”¨go vetå·¥å…·å¯ä»¥æ£€æµ‹ç”¨æˆ·ä»£ç æ˜¯å¦å¤åˆ¶äº†pool
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;noCopy&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;noCopy&lt;/span&gt;

    &lt;span class=&#34;c1&#34;&gt;// æ¯ä¸ª P çš„æœ¬åœ°é˜Ÿåˆ—ï¼Œå®é™…ç±»å‹ä¸º [P]poolLocalæ•°ç»„ï¼Œé•¿åº¦æ˜¯å›ºå®šçš„ï¼ŒPçš„idå¯¹åº”[P]poolLocalä¸‹æ ‡ç´¢å¼•ï¼Œé€šè¿‡è¿™æ ·çš„è®¾è®¡ï¼Œå¤šä¸ª G ä½¿ç”¨åŒä¸€ä¸ªPoolæ—¶ï¼Œå‡å°‘ç«äº‰ï¼Œæå‡æ€§èƒ½
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;local&lt;/span&gt;     &lt;span class=&#34;nx&#34;&gt;unsafe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Pointer&lt;/span&gt;
	&lt;span class=&#34;c1&#34;&gt;// [P]poolLocal æœ¬åœ°é˜Ÿåˆ—çš„é•¿åº¦
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;localSize&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uintptr&lt;/span&gt;

    &lt;span class=&#34;c1&#34;&gt;// GC æ—¶ä½¿ç”¨ï¼Œåˆ†åˆ«æ¥ç®¡ local å’Œ localSizeï¼Œvictimæœºåˆ¶ç”¨äºå‡å°‘GCåå†·å¯åŠ¨å¯¼è‡´çš„æ€§èƒ½æŠ–åŠ¨ï¼Œè®©å¯¹è±¡åˆ†é…æ›´å¹³æ»‘ï¼Œé™ä½GCå‹åŠ›çš„åŒæ—¶æé«˜å‘½ä¸­ç‡ï¼Œç”±poolCleanup()æ–¹æ³•æ“ä½œ
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;victim&lt;/span&gt;     &lt;span class=&#34;nx&#34;&gt;unsafe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Pointer&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;victimSize&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uintptr&lt;/span&gt;

	&lt;span class=&#34;c1&#34;&gt;// è‡ªå®šä¹‰çš„å¯¹è±¡åˆ›å»ºå›è°ƒå‡½æ•°ï¼Œå½“ pool ä¸­æ— å¯ç”¨å¯¹è±¡æ—¶ä¼šè°ƒç”¨æ­¤å‡½æ•°
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;New&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;å½“Poolæ²¡æœ‰ç¼“å­˜å¯¹è±¡æ—¶ï¼Œè°ƒç”¨ New å‡½æ•°ç”Ÿæˆä»¥ä¸‹å¯¹è±¡&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;poolLocal&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;poolLocalInternal&lt;/span&gt;

	&lt;span class=&#34;c1&#34;&gt;// å°† poolLocal è¡¥é½è‡³ä¸¤ä¸ªç¼“å­˜è¡Œçš„å€æ•°ï¼Œé˜²æ­¢ false sharing,
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// æ¯ä¸ªç¼“å­˜è¡Œå…·æœ‰ 64 bytesï¼Œå³ 512 bit
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// ç›®å‰æˆ‘ä»¬çš„å¤„ç†å™¨ä¸€èˆ¬æ‹¥æœ‰ 32 * 1024 / 64 = 512 æ¡ç¼“å­˜è¡Œ
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// ä¼ªå…±äº«ï¼Œä»…å ä½ç”¨ï¼Œé˜²æ­¢åœ¨ cache line ä¸Šåˆ†é…å¤šä¸ª poolLocalInternal
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;pad&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;128&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;unsafe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Sizeof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;poolLocalInternal&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{})&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;%&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;128&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;// Local æ¯ä¸ªPéƒ½æœ‰ä¸€ä¸ª
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;poolLocalInternal&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// P çš„ç§æœ‰å¯¹è±¡ï¼Œä½¿ç”¨æ—¶æ— éœ€è¦åŠ é”ï¼Œç”¨äºä¸åŒGæ‰§è¡Œgetå’Œput
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// åŒå‘é“¾è¡¨
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// åŒä¸€ä¸ªPä¸Šä¸åŒGå¯ä»¥å¤šæ¬¡æ‰§è¡Œputæ–¹æ³•ï¼Œéœ€è¦æœ‰åœ°æ–¹èƒ½å­˜å‚¨, å¹¶ä¸”åˆ«çš„Pä¸Šçš„Gå¯èƒ½è¿‡æ¥å·ï¼Œé€šè¿‡caså®ç°
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;shared&lt;/span&gt;  &lt;span class=&#34;nx&#34;&gt;poolChain&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;poolChain æ˜¯ä¸€ä¸ªåŒå‘é“¾è¡¨çš„å®ç°ï¼›&lt;/p&gt;
&lt;p&gt;poolDequeue è¢«å®ç°ä¸ºå•ç”Ÿäº§è€…ï¼Œå¤šæ¶ˆè´¹è€…çš„å›ºå®šå¤§å°æ— é”çš„ç¯å½¢é˜Ÿåˆ—ï¼Œç”Ÿäº§è€…å¯ä»¥ä» head æ’å…¥å’Œåˆ é™¤ï¼Œè€Œæ¶ˆè´¹è€…ä»…èƒ½ä» tail åˆ é™¤&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;poolChain&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;c1&#34;&gt;// åªæœ‰ç”Ÿäº§è€…ä¼š push toï¼Œä¸ç”¨åŠ é”
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;head&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;poolChainElt&lt;/span&gt;

	&lt;span class=&#34;c1&#34;&gt;// è¯»å†™éœ€è¦åŸå­æ§åˆ¶ï¼Œpop from
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;tail&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;poolChainElt&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;poolChainElt&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;poolDequeue&lt;/span&gt;

	&lt;span class=&#34;c1&#34;&gt;// next è¢« producer å†™ï¼Œconsumer è¯»ã€‚æ‰€ä»¥åªä¼šä» nil å˜æˆ non-nil
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// prev è¢« consumer å†™ï¼Œproducer è¯»ã€‚æ‰€ä»¥åªä¼šä» non-nil å˜æˆ nil
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;next&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;prev&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;poolChainElt&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;poolDequeue&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// headTail åŒ…å«ä¸€ä¸ª 32 ä½çš„ head (é«˜32ä½)å’Œä¸€ä¸ª 32 ä½çš„ tail(ä½32ä½) æŒ‡é’ˆã€‚è¿™ä¸¤ä¸ªå€¼éƒ½å’Œ len(vals)-1 å–æ¨¡è¿‡ã€‚
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// tail æ˜¯é˜Ÿåˆ—ä¸­æœ€è€çš„æ•°æ®ï¼Œhead æŒ‡å‘ä¸‹ä¸€ä¸ªå°†è¦å¡«å……çš„ slot
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// slots çš„æœ‰æ•ˆèŒƒå›´æ˜¯ [tail, head)ï¼Œç”± consumers æŒæœ‰ã€‚
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// é€šè¿‡å¯¹å…¶casæ“ä½œä¿è¯å¹¶å‘å®‰å…¨
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;headTail&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint64&lt;/span&gt;

	&lt;span class=&#34;c1&#34;&gt;// vals æ˜¯ä¸€ä¸ªå­˜å‚¨ interface{} çš„ç¯å½¢é˜Ÿåˆ—ï¼Œå®ƒçš„ size å¿…é¡»æ˜¯ 2 çš„å¹‚ï¼Œåˆå§‹åŒ–é•¿åº¦ä¸º8
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// å¦‚æœ slot ä¸ºç©ºï¼Œåˆ™ vals[i].typ ä¸ºç©ºï¼›å¦åˆ™ï¼Œéç©ºã€‚
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// ä¸€ä¸ª slot åœ¨è¿™æ—¶å®£å‘Šæ— æ•ˆï¼štail ä¸æŒ‡å‘å®ƒäº†ï¼Œvals[i].typ ä¸º nil
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// ç”± consumer è®¾ç½®æˆ nilï¼Œç”± producer è¯»
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;vals&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;eface&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/go_syncPool%e6%95%b0%e6%8d%ae%e7%bb%93%e6%9e%84.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/go_syncPool%e6%95%b0%e6%8d%ae%e7%bb%93%e6%9e%84.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ¯æ¬¡åƒåœ¾å›æ”¶æ—¶ï¼ŒPoolä¼šæŠŠvictimä¸­çš„å¯¹è±¡ç§»é™¤ï¼Œç„¶åæŠŠlocalçš„æ•°æ®ç»™victimï¼Œlocalç½®ä¸ºnilï¼Œå¦‚æœæ­¤æ—¶æœ‰Getæ–¹æ³•è¢«è°ƒç”¨ï¼Œåˆ™ä¼šä»victimä¸­è·å–å¯¹è±¡ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œé¿å…ç¼“å­˜å…ƒç´ è¢«å¤§é‡å›æ”¶åå†å†æ¬¡ä½¿ç”¨æ—¶æ–°å»ºå¾ˆå¤šå¯¹è±¡ï¼›&lt;/li&gt;
&lt;li&gt;è·å–é‡ç”¨å¯¹è±¡æ—¶ï¼Œå…ˆä»localä¸­è·å–ï¼Œè·å–ä¸åˆ°å†ä»victimä¸­è·å–ï¼›&lt;/li&gt;
&lt;li&gt;poolLocalInternalç”¨äºCPUç¼“å­˜å¯¹é½ï¼Œé¿å…false sharingï¼›&lt;/li&gt;
&lt;li&gt;privateå­—æ®µä»£è¡¨ä¸€ä¸ªå¯å¤ç”¨å¯¹è±¡ï¼Œä¸”åªèƒ½ç”±ç›¸åº”çš„ä¸€ä¸ªPå­˜å–ï¼Œå› ä¸ºä¸€ä¸ªPåŒæ—¶åªèƒ½æ‰§è¡Œä¸€ä¸ªgoroutineï¼Œæ‰€ä»¥ä¸ä¼šæœ‰å¹¶å‘é—®é¢˜ï¼›&lt;/li&gt;
&lt;li&gt;sharedå­—æ®µå¯ä»¥è¢«ä»»æ„çš„Pè®¿é—®ï¼Œä½†æ˜¯åªæœ‰æœ¬åœ°çš„Pèƒ½pushHead/popHeadï¼Œå…¶ä»–På¯ä»¥popTailï¼Œç›¸å½“äºåªæœ‰ä¸€ä¸ªæœ¬åœ°Pä½œä¸ºç”Ÿäº§è€…ï¼Œå¤šä¸ªPä½œä¸ºæ¶ˆè´¹è€…ï¼Œå®ƒç”±ä¸€ä¸ªlock-freeçš„é˜Ÿåˆ—å®ç°ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;åŸºæœ¬-6&#34;&gt;åŸºæœ¬&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;sync.Poolç”¨äºä¿å­˜ä¸€ç»„å¯ç‹¬ç«‹è®¿é—®çš„ä¸´æ—¶å¯¹è±¡ï¼Œå®ƒæ± åŒ–çš„å¯¹è±¡å¦‚æœæ²¡æœ‰è¢«å…¶ä»–å¯¹è±¡æŒæœ‰å¼•ç”¨ï¼Œå¯èƒ½ä¼šåœ¨æœªæ¥æŸä¸ªæ—¶é—´ç‚¹ï¼ˆGCå‘ç”Ÿæ—¶ï¼‰è¢«å›æ”¶æ‰ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;sync.Poolæ˜¯å¹¶å‘å®‰å…¨çš„ï¼Œå¤šä¸ªgotoutineå¯ä»¥å¹¶å‘è°ƒç”¨å®ƒå­˜å–å¯¹è±¡ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¸èƒ½å¤åˆ¶ä½¿ç”¨ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åœ¨1.13ä»¥å‰ï¼Œä¿è¯å¹¶å‘å®‰å…¨ä½¿ç”¨äº†å¸¦é”çš„é˜Ÿåˆ—ï¼Œä¸”åœ¨GCæ—¶ï¼Œç›´æ¥æ¸…ç©ºæ‰€æœ‰Poolçš„&lt;code&gt;local&lt;/code&gt;å’Œ&lt;code&gt;poollocal.shared&lt;/code&gt;ï¼ŒGCçš„æ—¶é—´å¯èƒ½ä¼šå¾ˆé•¿;&lt;/p&gt;
&lt;p&gt;1.13åï¼Œæ”¹æˆäº†lock-freeçš„é˜Ÿåˆ—å®ç°ï¼Œé¿å…é”å¯¹æ€§èƒ½çš„å½±å“ï¼Œä¸”åœ¨GCæ—¶ï¼Œä½¿ç”¨victimä½œä¸ºæ¬¡çº§ç¼“å­˜ï¼ŒGCæ—¶å°†å¯¹è±¡æ”¾å…¥å…¶ä¸­ï¼Œä¸‹æ¬¡GCæ¥ä¸´ä¹‹å‰ï¼Œå¦‚æœæœ‰ Get è°ƒç”¨åˆ™ä¼šä»victimä¸­å–ï¼Œç›´åˆ°ä¸‹ä¸€æ¬¡GCæ¥ä¸´æ—¶å›æ”¶ï¼Œæ‹‰é•¿å®é™…å›æ”¶æ—¶é—´ï¼Œä½¿å¾—å•ä½æ—¶é—´å†…GCçš„å¼€é”€å‡å°‘ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åŒ…å«äº†ä¸‰ä¸ªæ–¹æ³•ï¼šNewã€Getã€Putï¼›&lt;strong&gt;Getæ–¹æ³•è°ƒç”¨æ—¶ï¼Œä¼šä»æ± ä¸­ç§»èµ°è¯¥å…ƒç´ &lt;/strong&gt;ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å½“Poolé‡Œæ²¡æœ‰å…ƒç´ å¯ç”¨æ—¶ï¼ŒGetæ–¹æ³•ä¼šè¿”å›nilï¼›å¯ä»¥å‘Poolä¸­Putä¸€ä¸ªnilçš„å€¼ï¼ŒPoolä¼šå°†å…¶å¿½ç•¥ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åœ¨ä½¿ç”¨Putå½’è¿˜å¯¹è±¡æ—¶ï¼Œéœ€è¦å°†å¯¹è±¡çš„å±æ€§resetï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å½“ä½¿ç”¨Poolä½œä¸ºbufferæ± æ—¶ï¼Œè¦æ³¨æ„bufferå¦‚æœå¤ªå¤§ï¼Œresetåå®ƒå°±ä¼šå å¾ˆå¤§ç©ºé—´ï¼Œå¼•èµ·å†…å­˜æ³„æ¼ï¼Œå› æ­¤åœ¨å›æ”¶å…ƒç´ æ—¶ï¼Œéœ€è¦æ£€æŸ¥å¤§å°ï¼Œå¦‚æœå¤ªå¤§äº†å°±ç›´æ¥ç½®ä¸ºnullï¼Œä¸¢å¼ƒå³å¯ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Pool é‡Œå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸå— GC å½±å“ï¼Œä¸é€‚åˆäºåšè¿æ¥æ± ï¼Œå› ä¸ºè¿æ¥æ± éœ€è¦è‡ªå·±ç®¡ç†å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Pool ä¸å¯ä»¥æŒ‡å®šå¤§å°ï¼Œå¤§å°åªå—åˆ¶äº GC ä¸´ç•Œå€¼ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;procPin&lt;/code&gt; å°† G å’Œ P ç»‘å®šï¼Œé˜²æ­¢ G è¢«æŠ¢å ã€‚åœ¨ç»‘å®šæœŸé—´ï¼ŒGC æ— æ³•æ¸…ç†ç¼“å­˜çš„å¯¹è±¡ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;sync.Pool&lt;/code&gt; çš„æœ€åº•å±‚ä½¿ç”¨é“¾è¡¨ï¼Œé“¾è¡¨å…ƒç´ æ˜¯åˆ‡ç‰‡(å½“ä½œç¯å½¢é˜Ÿåˆ—)ï¼Œå¹¶å°†ç¼“å­˜çš„å¯¹è±¡å­˜å‚¨åœ¨åˆ‡ç‰‡ä¸­ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åº•å±‚åˆ‡ç‰‡åˆå§‹åŒ–é•¿åº¦ä¸º8ï¼Œå§‹ç»ˆä¿æŒ2çš„næ¬¡å¹‚çš„å¢é•¿ï¼Œæœ€å¤§çš„å®¹é‡æ˜¯2^30ï¼Œè¾¾åˆ°ä¸Šé™æ—¶ï¼Œå†ç”Ÿæˆçš„é˜Ÿåˆ—å®¹é‡éƒ½æ˜¯2^30ï¼›é“¾è¡¨çš„èŠ‚ç‚¹çš„ç¯å½¢é˜Ÿåˆ—é•¿åº¦æ˜¯ &lt;code&gt;head -&amp;gt; 32 -&amp;gt; 16 -&amp;gt; 8 -&amp;gt; tail&lt;/code&gt;ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Getæ–¹æ³•è°ƒç”¨æ—¶ï¼Œ&lt;strong&gt;å¦‚æœæ˜¯ä»å…¶ä»–Pçš„local.sharedçš„å°¾éƒ¨çªƒå–å¤ç”¨å¯¹è±¡&lt;/strong&gt;ï¼ŒåŒæ—¶ä¼šç§»é™¤ç¯å½¢é˜Ÿåˆ—é‡Œçš„å…ƒç´ ï¼Œå½“ç¯å½¢é˜Ÿåˆ—è¢«çªƒå–åˆ°ä¸ºç©ºæ—¶ï¼Œä¼šç§»é™¤å½“å‰èŠ‚ç‚¹ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;getæ–¹æ³•&#34;&gt;Getæ–¹æ³•&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;å¦‚æœéç¬¬ä¸€æ¬¡è®¿é—®ï¼Œè°ƒç”¨&lt;code&gt;p.pin()&lt;/code&gt;å‡½æ•°ï¼Œ&lt;strong&gt;å°†å½“å‰ G å›ºå®šåœ¨Pä¸Šï¼Œé˜²æ­¢è¢«æŠ¢å &lt;/strong&gt;ï¼Œå¹¶è·å–pidï¼Œå†æ ¹æ®pidå·æ‰¾åˆ°å½“å‰På¯¹åº”çš„poolLocalï¼›å¦‚æœPçš„æ•°é‡å¤§äºpoolLocalçš„æ•°é‡ï¼Œå°±ä¼šè¿›å…¥&lt;code&gt;p.pinSlow()&lt;/code&gt;æ–¹æ³•ï¼ŒåŠ é”ï¼Œåˆ›å»ºPä¸ªpoolLocalã€‚&lt;/li&gt;
&lt;li&gt;æ‹¿åˆ°poolLocalåï¼Œä¼˜å…ˆä»localçš„privateå­—æ®µå–å‡ºä¸€ä¸ªå…ƒç´ ï¼Œå°†privateç½®ä¸ºnullï¼›&lt;/li&gt;
&lt;li&gt;å¦‚æœä»privateå–å‡ºçš„å…ƒç´ ä¸ºnullï¼Œåˆ™ä»å½“å‰çš„&lt;code&gt;local.shared&lt;/code&gt;çš„headä¸­å–å‡ºä¸€ä¸ªåŒç«¯ç¯å½¢é˜Ÿåˆ—ï¼Œéå†é˜Ÿåˆ—è·å–å…ƒç´ ï¼Œå¦‚æœæœ‰popå‡ºæ¥å¹¶è¿”å›ï¼›å¦‚æœè¿˜å–ä¸åˆ°ï¼Œæ²¿ç€preæŒ‡é’ˆåˆ°ä¸‹ä¸€ä¸ªåŒç«¯ç¯å½¢é˜Ÿåˆ—ç»§ç»­è·å–ï¼Œç›´åˆ°è·å–åˆ°æˆ–è€…éå†å®ŒåŒå‘é“¾è¡¨ï¼›&lt;/li&gt;
&lt;li&gt;å¦‚æœè¿˜æ²¡æœ‰çš„è¯ï¼Œè°ƒç”¨&lt;code&gt;getSlow&lt;/code&gt;å‡½æ•°ï¼Œéå†å…¶ä»–Pçš„poolLocalï¼ˆä»pid+1å¯¹åº”çš„poolLocalå¼€å§‹ï¼‰ï¼Œä»å®ƒä»¬shared çš„ tail ä¸­å¼¹å‡ºä¸€ä¸ªåŒç«¯ç¯å½¢é˜Ÿåˆ—ï¼Œéå†é˜Ÿåˆ—è·å–å…ƒç´ ï¼Œå¦‚æœæœ‰ï¼Œpopå‡ºæ¥å¹¶è¿”å›ï¼›å¦‚æœè¿˜å–ä¸åˆ°ï¼ˆå¦‚æœå½“å‰èŠ‚ç‚¹ä¸ºnullï¼Œåˆ™åˆ é™¤ï¼‰ï¼Œæ²¿ç€nextæŒ‡é’ˆåˆ°ä¸‹ä¸€ä¸ªåŒç«¯ç¯å½¢é˜Ÿåˆ—ç»§ç»­è·å–ï¼Œå¦‚æœè¿˜æ²¡æœ‰ï¼Œç›´åˆ°è·å–åˆ°æˆ–è€…éå†å®ŒåŒå‘é“¾è¡¨ï¼›å¦‚æœè¿˜æ²¡æœ‰ï¼Œå°±åˆ°åˆ«çš„Pä¸Šç»§ç»­è·å–ï¼›&lt;/li&gt;
&lt;li&gt;å¦‚æœæ‰€æœ‰Pçš„poolLocal.sharedéƒ½æ²¡æœ‰ï¼Œåˆ™å¯¹victimä¸­ä»¥åœ¨åŒæ ·çš„æ–¹å¼ï¼Œå…ˆä»å½“å‰Pçš„poolLocalçš„privateé‡Œæ‰¾ï¼Œæ‰¾ä¸åˆ°å†åœ¨sharedé‡Œæ‰¾ï¼Œè·å–ä¸€éï¼›&lt;/li&gt;
&lt;li&gt;Poolç›¸å…³æ“ä½œ&lt;strong&gt;æ‰§è¡Œå®Œï¼Œè°ƒç”¨&lt;code&gt;runtime_procUnpin()&lt;/code&gt;è§£é™¤éæŠ¢å &lt;/strong&gt;ï¼›&lt;/li&gt;
&lt;li&gt;å¦‚æœè¿˜å–ä¸åˆ°ï¼Œåˆ™è°ƒç”¨Newå‡½æ•°ç”Ÿæˆä¸€ä¸ªï¼Œç„¶åè¿”å›ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å› ä¸ºå½“å‰çš„Gè¢«å›ºå®šåœ¨äº†Pä¸Šï¼Œåœ¨æŸ¥æ‰¾å…ƒç´ æ—¶ä¸ä¼šè¢«å…¶ä»–Pæ‰§è¡Œã€‚&lt;/p&gt;
&lt;h2 id=&#34;pinæ–¹æ³•&#34;&gt;pinæ–¹æ³•&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;code&gt;pin&lt;/code&gt; çš„ä½œç”¨å°±æ˜¯å°†å½“å‰ G å’Œ P ç»‘å®šåœ¨ä¸€èµ·ï¼Œç¦æ­¢æŠ¢å ï¼Œå¹¶è¿”å›å¯¹åº”çš„ poolLocal ä»¥åŠ P çš„ idã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœ G è¢«æŠ¢å ï¼Œåˆ™ G çš„çŠ¶æ€ä» running å˜æˆ runnableï¼Œä¼šè¢«æ”¾å› P çš„ LRQ æˆ– GRQï¼Œç­‰å¾…ä¸‹ä¸€æ¬¡è°ƒåº¦ã€‚ä¸‹æ¬¡å†æ‰§è¡Œæ—¶ï¼Œå°±ä¸ä¸€å®šæ˜¯å’Œç°åœ¨çš„ P ç›¸ç»“åˆäº†ã€‚å› ä¸ºä¹‹åä¼šç”¨åˆ° pidï¼Œå¦‚æœè¢«æŠ¢å äº†ï¼Œæœ‰å¯èƒ½æ¥ä¸‹æ¥ä½¿ç”¨çš„ pid ä¸æ‰€ç»‘å®šçš„ P å¹¶éåŒä¸€ä¸ªã€‚&lt;/p&gt;
&lt;p&gt;æ‰€è°“çš„æŠ¢å ï¼Œå°±æ˜¯æŠŠ M ç»‘å®šçš„ P ç»™å‰¥å¤ºäº†ï¼Œå› ä¸ºæˆ‘ä»¬åé¢è·å–æœ¬åœ°çš„ poolLocal æ˜¯æ ¹æ®pidè·å–çš„ï¼Œå¦‚æœè¿™ä¸ªè¿‡ç¨‹ä¸­ P è¢«æŠ¢èµ°ï¼Œå°±ä¹±å¥—äº†ï¼Œæ‰€ä»¥éœ€è¦è®¾ç½®ç¦æ­¢æŠ¢å ï¼Œå®ç°çš„åŸç†å°±æ˜¯è®© M çš„lockså­—æ®µä¸ç­‰äº0ï¼Œæ¯”å¦‚+1ï¼Œå®é™…ä¸Šä¹Ÿç›¸å½“äºå¯¹Mä¸Šé”ï¼Œè®©è°ƒåº¦å™¨çŸ¥é“ M ä¸é€‚åˆæŠ¢å ï¼Œè¿™é‡Œå°±å¾ˆå¥½ä½“ç°äº†æ•°æ®çš„å±€éƒ¨æ€§ï¼šè®©Gå’ŒMåœ¨è¢«æŠ¢å åï¼Œä»ç„¶æ‰¾å›åŸæ¥çš„Pï¼Œè¿™é‡Œé€šè¿‡ç¦æ­¢æŠ¢å ï¼Œæ¥ä¿è¯æ•°æ®å±€éƒ¨æ€§ã€‚&lt;/p&gt;
&lt;p&gt;æ‰§è¡Œå®Œä¹‹åï¼ŒP ä¸å¯æŠ¢å ï¼Œä¸” GC ä¸ä¼šæ¸…æ‰« Pool é‡Œçš„å¯¹è±¡ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;åœ¨Poolé‡Œï¼Œè¿˜æœ‰ä¸€ä¸ªå…¨å±€Poolæ•°ç»„ï¼ŒallPoolså’ŒoldPoolsï¼Œç”¨äºä¿å­˜æ‰€æœ‰å£°æ˜çš„Poolå¯¹è±¡ï¼Œä¾¿äºGCæ—¶éå†æ‰€æœ‰å£°æ˜çš„Poolï¼Œä½¿ç”¨äº†victim cacheæœºåˆ¶è®©GCæ›´å¹³æ»‘ï¼ˆè°ƒç”¨poolCleanupæ–¹æ³•ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;å½“Pçš„æ•°é‡å¤§äº poolLocal æ•°ç»„çš„é•¿åº¦æ—¶ï¼Œå°±ä¼šè¿›å…¥ pinSlow æ–¹æ³•ï¼Œæ„å»ºæ–°çš„ poolLocal èŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;è¿›å…¥pinSlowæ–¹æ³•åï¼Œé¦–å…ˆä¼šè§£é™¤Gå’ŒPçš„ç»‘å®šï¼Œå†ä¸Šé”ï¼Œé”å®šallPoolsï¼ˆå› ä¸ºæ˜¯å…¨å±€å˜é‡ï¼‰ï¼Œä¹‹æ‰€ä»¥å…ˆè§£é™¤ç»‘å®šå†ä¸Šé”ï¼Œä¸»è¦æ˜¯é”çš„ç²’åº¦æ¯”è¾ƒå¤§ï¼Œè¢«é˜»å¡çš„æ¦‚ç‡ä¹Ÿå¤§ï¼Œå¦‚æœè¿˜å ç”¨ç€Pï¼Œæµªè´¹èµ„æºï¼›é”å®šæˆåŠŸåï¼Œæ‰å†æ¬¡è¿›è¡Œç»‘å®šï¼Œç”±äºæ­¤æ—¶På¯èƒ½è¢«å…¶ä»–çº¿ç¨‹å ç”¨äº†ï¼Œp.localå¯èƒ½ä¼šå‘ç”Ÿå˜åŒ–ï¼Œæ­¤æ—¶è¿˜éœ€è¦å¯¹pidè¿›è¡Œæ£€æŸ¥ï¼Œå¦‚æœPçš„æ•°é‡å¤§äº poolLocal çš„é•¿åº¦ï¼Œæ‰åˆ›å»ºæ–°çš„poolLocalæ•°ç»„ï¼Œé•¿åº¦ä¸ºPçš„ä¸ªæ•°ï¼Œè¿™ä¸€æ­¥å…¶å®æ˜¯æ‡’åŠ è½½ï¼Œæ‡’æ±‰å¼åˆå§‹åŒ– poolLocalæ•°ç»„ ä½œä¸º Pçš„æœ¬åœ°æ•°ç»„ï¼Œå¦‚æœæ˜¯é¦–æ¬¡åˆ›å»ºï¼Œpè¿˜ä¼šåŠ å…¥allPoolsã€‚&lt;/p&gt;
&lt;h2 id=&#34;putæ–¹æ³•&#34;&gt;Putæ–¹æ³•&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;å¦‚æœPutè¿›æ¥çš„å…ƒç´ æ˜¯nullï¼Œç›´æ¥è¿”å›ï¼›&lt;/li&gt;
&lt;li&gt;è°ƒç”¨&lt;code&gt;p.pin()&lt;/code&gt;å‡½æ•°ï¼Œå°†å½“å‰ G å›ºå®šåœ¨Pä¸Šï¼Œé˜²æ­¢è¢«æŠ¢å ï¼Œå¹¶è·å–pidï¼Œå†æ ¹æ®pidå·æ‰¾åˆ°å½“å‰På¯¹åº”çš„poolLocalï¼›&lt;/li&gt;
&lt;li&gt;å°è¯•å°†putè¿›æ¥çš„å…ƒç´ èµ‹å€¼ç»™privateï¼Œå¦‚æœæœ¬åœ°privateæ²¡æœ‰å€¼ï¼Œç›´æ¥èµ‹å€¼ï¼›&lt;/li&gt;
&lt;li&gt;å¦åˆ™ï¼ŒåŸå­æ“ä½œå°†å…¶åŠ å…¥åˆ°sharedå¯¹åº”çš„åŒç«¯é˜Ÿåˆ—çš„é˜Ÿé¦–ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;gcå‰&#34;&gt;GCå‰&lt;/h2&gt;
&lt;p&gt;Poolä¼šåœ¨initæ–¹æ³•ä¸­ä½¿ç”¨&lt;code&gt;runtime_registerPoolCleanup&lt;/code&gt;æ³¨å†ŒGCçš„é’©å­&lt;code&gt;poolCleanup&lt;/code&gt;æ¥è¿›è¡Œpoolå›æ”¶å¤„ç†ã€‚&lt;/p&gt;
&lt;p&gt;å…¶ä¸­ä¸€ä¸ªä¸»è¦åŠ¨ä½œæ˜¯ &lt;code&gt;poolCleanup()&lt;/code&gt; æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¸»è¦å°±æ˜¯åœ¨GCå¼€å§‹å‰ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;éå†oldPoolsæ•°ç»„ï¼Œå°†å…¶ä¸­çš„poolå¯¹è±¡çš„victimç½®ä¸ºnilï¼›&lt;/li&gt;
&lt;li&gt;éå†allPoolsæ•°ç»„ï¼Œå°†localå¯¹è±¡èµ‹å€¼ç»™victimï¼Œlocalå¯¹è±¡èµ‹å€¼ä¸ºnilï¼›&lt;/li&gt;
&lt;li&gt;ç„¶åå°†allPoolsèµ‹å€¼ç»™oldPoolsï¼ŒallPoolsç½®ä¸ºnilï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å½“GCå¼€å§‹æ—¶å€™ï¼Œå°±ä¼šå°† oldPoolsæ•°ç»„ä¸­ poolå¯¹è±¡ å·²é‡Šæ”¾çš„ victim cache ä¸­æ‰€æœ‰å¯¹è±¡çš„å›æ”¶ï¼ˆå› ä¸ºå·²ç»è¢«ç½®ä¸ºnulläº†ï¼‰ã€‚å› ä¸ºvictim cacheçš„è®¾è®¡ï¼Œpoolä¸­çš„å¤ç”¨å¯¹è±¡ä¼šåœ¨æ¯ä¸¤ä¸ªGCå¾ªç¯ä¸­æ¸…é™¤ï¼›&lt;/p&gt;
&lt;h1 id=&#34;åŸå­æ“ä½œ&#34;&gt;åŸå­æ“ä½œ&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ä¾èµ–atomicåŒ…ï¼Œå› ä¸ºæ²¡æœ‰æ³›å‹ï¼Œç›®å‰è¯¥åŒ…æ”¯æŒint32ã€int64ã€uint32ã€unit64ã€uintptrã€Pointerçš„åŸå­æ“ä½œï¼Œæ¯”å¦‚Addã€CompareAndSwapã€Swapã€Loadã€Storeç­‰ï¼ˆPointerä¸æ”¯æŒAddï¼‰ï¼Œå¯¹äºæœ‰ç¬¦å·çš„æ•°å€¼æ¥è¯´ï¼ŒAddä¸€ä¸ªè´Ÿæ•°ç›¸å½“äºå‡ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¯¹äºç°ä»£å¤šæ ¸æ“ä½œç³»ç»Ÿæ¥è¯´ï¼Œç”±äºcacheã€æŒ‡ä»¤é‡æ’ã€å¯è§æ€§é—®é¢˜ï¼Œä¸€ä¸ªæ ¸å¯¹åœ°å€çš„å€¼çš„æ›´æ”¹ï¼Œåœ¨æ›´æ–°åˆ°ä¸»å†…å­˜ä¸­å‰ï¼Œä¼šå…ˆå­˜åœ¨å¤šçº§ç¼“å­˜ä¸­ï¼Œæ­¤æ—¶ï¼Œå¤šä¸ªæ ¸çœ‹åˆ°è¯¥æ•°æ®å¯èƒ½è¿˜æ²¡çœ‹åˆ°æ›´æ–°çš„æ•°æ®ï¼Œè¿˜åœ¨ä½¿ç”¨æ—§æ•°æ®ï¼Œè€ŒatomicåŒ…æä¾›çš„æ–¹æ³•ä¼šæä¾›å†…å­˜å±éšœçš„åŠŸèƒ½ï¼Œä¿è¯èµ‹å€¼æ•°æ®çš„å®Œæ•´æ€§å’Œå¯è§æ€§ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;atomicæ“ä½œçš„å¯¹è±¡æ˜¯ä¸€ä¸ªåœ°å€ï¼Œä¸æ˜¯å˜é‡å€¼ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç”¨atomicå®ç°çš„lock-freeçš„é˜Ÿåˆ—&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;48
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;49
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;50
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;51
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;52
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;53
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;54
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;55
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;56
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;57
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;58
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;59
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;60
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;61
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;62
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;63
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;64
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;65
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;66
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;67
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;68
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;69
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;70
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;71
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;72
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;kn&#34;&gt;package&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;queue&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
  &lt;span class=&#34;s&#34;&gt;&amp;#34;sync/atomic&amp;#34;&lt;/span&gt;
  &lt;span class=&#34;s&#34;&gt;&amp;#34;unsafe&amp;#34;&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;// lock-freeçš„queue
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;LKQueue&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
  &lt;span class=&#34;nx&#34;&gt;head&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;unsafe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Pointer&lt;/span&gt;
  &lt;span class=&#34;nx&#34;&gt;tail&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;unsafe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Pointer&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;// é€šè¿‡é“¾è¡¨å®ç°ï¼Œè¿™ä¸ªæ•°æ®ç»“æ„ä»£è¡¨é“¾è¡¨ä¸­çš„èŠ‚ç‚¹
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
  &lt;span class=&#34;nx&#34;&gt;value&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
  &lt;span class=&#34;nx&#34;&gt;next&lt;/span&gt;  &lt;span class=&#34;nx&#34;&gt;unsafe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Pointer&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;NewLKQueue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;LKQueue&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
  &lt;span class=&#34;nx&#34;&gt;n&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;unsafe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Pointer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{})&lt;/span&gt;
  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;LKQueue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;head&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;n&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;tail&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;n&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;// å…¥é˜Ÿ
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;q&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;LKQueue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Enqueue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;v&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{})&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
  &lt;span class=&#34;nx&#34;&gt;n&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
  &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;tail&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;load&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;q&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;tail&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;next&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;load&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;tail&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;next&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;tail&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;load&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;q&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;tail&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// å°¾è¿˜æ˜¯å°¾
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;next&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// è¿˜æ²¡æœ‰æ–°æ•°æ®å…¥é˜Ÿ
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;cas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;tail&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;next&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;next&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;n&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;//å¢åŠ åˆ°é˜Ÿå°¾
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;          &lt;span class=&#34;nf&#34;&gt;cas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;q&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;tail&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;tail&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;n&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;//å…¥é˜ŸæˆåŠŸï¼Œç§»åŠ¨å°¾å·´æŒ‡é’ˆ
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;          &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt;
        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
      &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// å·²æœ‰æ–°æ•°æ®åŠ åˆ°é˜Ÿåˆ—åé¢ï¼Œéœ€è¦ç§»åŠ¨å°¾æŒ‡é’ˆ
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;nf&#34;&gt;cas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;q&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;tail&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;tail&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;next&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
      &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;// å‡ºé˜Ÿï¼Œæ²¡æœ‰å…ƒç´ åˆ™è¿”å›nil
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;q&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;LKQueue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Dequeue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
  &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;head&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;load&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;q&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;head&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;tail&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;load&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;q&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;tail&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;next&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;load&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;head&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;next&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;head&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;load&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;q&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;head&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// headè¿˜æ˜¯é‚£ä¸ªhead
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;head&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;tail&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// headå’Œtailä¸€æ ·
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;next&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// è¯´æ˜æ˜¯ç©ºé˜Ÿåˆ—
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;          &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
        &lt;span class=&#34;c1&#34;&gt;// åªæ˜¯å°¾æŒ‡é’ˆè¿˜æ²¡æœ‰è°ƒæ•´ï¼Œå°è¯•è°ƒæ•´å®ƒæŒ‡å‘ä¸‹ä¸€ä¸ª
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;nf&#34;&gt;cas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;q&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;tail&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;tail&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;next&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
      &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;c1&#34;&gt;// è¯»å–å‡ºé˜Ÿçš„æ•°æ®
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;nx&#34;&gt;v&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;next&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;value&lt;/span&gt;
        &lt;span class=&#34;c1&#34;&gt;// æ—¢ç„¶è¦å‡ºé˜Ÿäº†ï¼Œå¤´æŒ‡é’ˆç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ª
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;cas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;q&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;head&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;head&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;next&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
          &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;v&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// Dequeue is done.  return
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
      &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;// å°†unsafe.PointeråŸå­åŠ è½½è½¬æ¢æˆnode
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;load&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;p&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;unsafe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Pointer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;n&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;atomic&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;LoadPointer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;// å°è£…CAS,é¿å…ç›´æ¥å°†*nodeè½¬æ¢æˆunsafe.Pointer
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;cas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;p&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;unsafe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Pointer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;old&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;atomic&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;CompareAndSwapPointer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;unsafe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Pointer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;old&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;unsafe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Pointer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;new&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h1 id=&#34;weighted--semaphoreä¿¡å·é‡&#34;&gt;Weighted = Semaphoreä¿¡å·é‡&lt;/h1&gt;
&lt;h2 id=&#34;æ•°æ®ç»“æ„-7&#34;&gt;æ•°æ®ç»“æ„&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Weighted&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;size&lt;/span&gt;    &lt;span class=&#34;kt&#34;&gt;int64&lt;/span&gt;         &lt;span class=&#34;c1&#34;&gt;// æœ€å¤§èµ„æºæ•°
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;cur&lt;/span&gt;     &lt;span class=&#34;kt&#34;&gt;int64&lt;/span&gt;         &lt;span class=&#34;c1&#34;&gt;// å½“å‰å·²è¢«ä½¿ç”¨çš„èµ„æº
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;mu&lt;/span&gt;      &lt;span class=&#34;nx&#34;&gt;sync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Mutex&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// äº’æ–¥é”ï¼Œå¯¹å­—æ®µçš„ä¿æŠ¤
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;waiters&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;list&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;List&lt;/span&gt;     &lt;span class=&#34;c1&#34;&gt;// ç­‰å¾…é˜Ÿåˆ—ï¼Œé€šè¿‡channelå®ç°é€šçŸ¥æœºåˆ¶
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id=&#34;åŸºæœ¬-7&#34;&gt;åŸºæœ¬&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ä¿¡å·é‡ä¸­çš„PVæ“ä½œï¼ŒPï¼šè·å–èµ„æºï¼Œå¦‚æœè·å–ä¸åˆ°ï¼Œåˆ™é˜»å¡ï¼ŒåŠ å…¥åˆ°ç­‰å¾…é˜Ÿåˆ—ä¸­ï¼›Vï¼šé‡Šæ”¾èµ„æºï¼Œä»ç­‰å¾…é˜Ÿåˆ—ä¸­å”¤é†’ä¸€ä¸ªå…ƒç´ æ‰§è¡ŒPæ“ä½œ&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;äºŒè¿›ä½ä¿¡å·é‡ï¼Œæˆ–è€…è¯´åªæœ‰ä¸€ä¸ªè®¡æ•°å€¼çš„ä¿¡å·é‡ï¼Œå…¶å®ç›¸å½“äºgoä¸­çš„Mutexäº’æ–¥é”&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åˆå§‹åŒ–æ—¶ï¼Œå¿…é¡»æŒ‡å®šåˆå§‹çš„ä¿¡å·é‡&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åªè°ƒç”¨Releaseæ–¹æ³•ä¼šç›´æ¥panicï¼›Releaseæ–¹æ³•ä¼ å…¥è´Ÿæ•°ï¼Œä¼šå¯¼è‡´èµ„æºè¢«æ°¸ä¹…æŒæœ‰ï¼›å› æ­¤è¦ä¿è¯è¯·æ±‚å¤šå°‘èµ„æºï¼Œå°±é‡Šæ”¾å¤šå°‘èµ„æº&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Mutexä¸­ä½¿ç”¨çš„semaæ˜¯ä¸€ä¸ªä¿¡å·é‡ï¼Œåªæ˜¯å…¶å®ç°æ˜¯åœ¨runtimeä¸­ï¼Œå¹¶æ²¡æœ‰å¯¹å¤–æš´éœ²ï¼Œåœ¨æ‰©å±•åŒ…ä¸­ï¼Œæš´éœ²äº†ä¸€ä¸ªä¿¡å·é‡å·¥å…·Weighted&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Weightedåˆ†ä¸º3ä¸ªæ–¹æ³•ï¼šAcquireæ–¹æ³•ï¼Œç›¸å½“äºPæ“ä½œï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯contextï¼Œå¯ä»¥ä½¿ç”¨contextå®ç°timeoutæˆ–cancelæœºåˆ¶ï¼Œç»ˆæ­¢goroutineï¼›æ­£å¸¸è·å–åˆ°èµ„æºæ—¶ï¼Œè¿”å›nullï¼Œå¦åˆ™è¿”å›ctx.Errï¼Œä¿¡å·é‡è®¡æ•°å€¼ä¸å˜ã€‚&lt;/p&gt;
&lt;p&gt;Releaseæ–¹æ³•ï¼Œç›¸å½“äºVæ“ä½œï¼Œå¯ä»¥é‡Šæ”¾nä¸ªèµ„æºï¼Œè¿”å›ç»™ä¿¡å·é‡ï¼›&lt;/p&gt;
&lt;p&gt;TryAcquireæ–¹æ³•ï¼Œå°è¯•è·å–nä¸ªèµ„æºï¼Œä½†ä¸ä¼šé˜»å¡ï¼ŒæˆåŠŸæ—¶è¿”å›trueï¼Œå¦åˆ™ä¸€ä¸ªä¹Ÿä¸è·å–ï¼Œè¿”å›false&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¿¡å·é‡çš„å®ç°ä¹Ÿå¯é€šè¿‡bufferä¸ºnçš„channelå®ç°ï¼Œåªæ˜¯ä¸€æ¬¡åªèƒ½è¯·æ±‚ä¸€ä¸ªèµ„æºï¼Œè€ŒWeightedä¸€æ¬¡å¯ä»¥è¯·æ±‚å¤šä¸ª&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;acquireæ–¹æ³•&#34;&gt;Acquireæ–¹æ³•&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;åŠ é”ï¼Œåˆ¤æ–­å¯ç”¨èµ„æº &amp;gt;= å…¥å‚æ‰€éœ€çš„èµ„æºæ•°ï¼Œä¸”æ²¡æœ‰waiterï¼Œè¯´æ˜èµ„æºè¶³å¤Ÿï¼Œç›´æ¥cur+ä¸Šæ‰€éœ€èµ„æºæ•°ï¼Œè§£é”è¿”å›&lt;/li&gt;
&lt;li&gt;å¦‚æœæ‰€éœ€èµ„æºæ•°&amp;gt;æœ€å¤§èµ„æºæ•°ï¼Œè¯´æ˜æ˜¯ä¸å¯èƒ½ä»»åŠ¡ï¼Œè§£é”ï¼Œä¾èµ–ctxçš„Doneæ–¹æ³•è¿”å›ï¼Œå¦åˆ™ä¸€ç›´ç­‰å¾…&lt;/li&gt;
&lt;li&gt;å¦‚æœèµ„æºæ•°ä¸å¤Ÿï¼Œå°†è°ƒç”¨è€…åŠ å…¥ç­‰å¾…é˜Ÿåˆ—ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªread chanï¼Œç”¨äºé€šçŸ¥å”¤é†’ï¼Œè§£é”&lt;/li&gt;
&lt;li&gt;ç­‰å¾…å”¤é†’æœ‰ä¸¤ç§æ¡ä»¶ï¼Œä¸€ç§æ˜¯é€šè¿‡read chanå”¤é†’ï¼Œå¦ä¸€ç§æ˜¯é€šè¿‡ctx.Doneå”¤é†’&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;releaseæ–¹æ³•&#34;&gt;Releaseæ–¹æ³•&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;åŠ é”ï¼Œå½“å‰å·²ä½¿ç”¨èµ„æºæ•°cur - å…¥å‚è¦é‡Šæ”¾çš„èµ„æºæ•°ï¼Œå”¤é†’ç­‰å¾…é˜Ÿåˆ—ä¸­çš„å…ƒç´ ï¼Œè§£é”&lt;/li&gt;
&lt;li&gt;å”¤é†’ç­‰å¾…é˜Ÿåˆ—çš„å…ƒç´ æ—¶ï¼Œä¼šéå†waitersé˜Ÿåˆ—ï¼ŒæŒ‰ç…§å…ˆå…¥å…ˆå‡ºçš„æ–¹å¼å”¤é†’è°ƒç”¨è€…ï¼Œå‰ææ˜¯é‡Šæ”¾çš„èµ„æºæ•°è¦å¤Ÿé˜Ÿé¦–çš„å…ƒç´ èµ„æºçš„è¦æ±‚ï¼Œæ¯”å¦‚åªé‡Šæ”¾äº†100ä¸ªèµ„æºï¼Œä½†æ˜¯é˜Ÿé¦–å…ƒç´ è¦æ±‚101ä¸ªèµ„æºï¼Œé‚£é˜Ÿåˆ—ä¸­çš„æ‰€æœ‰ç­‰å¾…è€…éƒ½å°†ç»§ç»­ç­‰å¾…ï¼Œç›´åˆ°é˜Ÿé¦–å…ƒç´ å‡ºé˜Ÿï¼Œè¿™æ ·åšæ˜¯ä¸ºäº†é¿å…é¥¥é¥¿&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;singleflight&#34;&gt;SingleFlight&lt;/h1&gt;
&lt;h2 id=&#34;ç»“æ„ä½“&#34;&gt;ç»“æ„ä½“&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// ä»£è¡¨ä¸€ä¸ªæ­£åœ¨å¤„ç†çš„è¯·æ±‚ï¼Œæˆ–è€…å·²ç»å¤„ç†å®Œçš„è¯·æ±‚
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;call&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;wg&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;sync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;WaitGroup&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// è¿™ä¸ªå­—æ®µä»£è¡¨å¤„ç†å®Œçš„å€¼ï¼Œåœ¨waitgroupå®Œæˆä¹‹å‰åªä¼šå†™ä¸€æ¬¡, waitgroupå®Œæˆä¹‹åå°±è¯»å–è¿™ä¸ªå€¼
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;val&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;
  
    &lt;span class=&#34;nx&#34;&gt;forgotten&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;// æŒ‡ç¤ºå½“callåœ¨å¤„ç†æ—¶æ˜¯å¦è¦å¿˜æ‰è¿™ä¸ªkey
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;dups&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;// ç›¸åŒçš„keyçš„è¯·æ±‚æ•°
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;chans&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;chan&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Result&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
  
&lt;span class=&#34;c1&#34;&gt;// groupä»£è¡¨ä¸€ä¸ªsingleflightå¯¹è±¡
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Group&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;mu&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;sync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Mutex&lt;/span&gt;       &lt;span class=&#34;c1&#34;&gt;// protects m
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;  &lt;span class=&#34;kd&#34;&gt;map&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;call&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// lazily initialized
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id=&#34;åŸºæœ¬-8&#34;&gt;åŸºæœ¬&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;SingleFlightå¯ä»¥åˆå¹¶å¤šä¸ªè¯·æ±‚ä¸ºä¸€ä¸ªè¯·æ±‚ï¼Œå†å°†è¯¥è¯·æ±‚çš„ç»“æœè¿”å›ç»™å¤šä¸ªè¯·æ±‚ï¼Œä»è€Œè¾¾åˆ°åˆå¹¶å¹¶å‘è¯·æ±‚çš„ç›®çš„ï¼Œå‡å°‘å¹¶å‘è°ƒç”¨çš„æ•°é‡ã€‚æ¯”å¦‚æœ‰å¤šä¸ªç›¸åŒçš„è¯»è¯·æ±‚æŸ¥åº“ï¼Œé‚£å°±å¯ä»¥åˆå¹¶æˆä¸€ä¸ªè¯·æ±‚æŸ¥åº“ï¼Œå†æŠŠç»“æœå“åº”å›è¿™å¤šä¸ªè¯·æ±‚ä¸­ï¼›æˆ–è€…æ˜¯è§£å†³ç¼“å­˜å‡»ç©¿é—®é¢˜ï¼Œé™ä½å¯¹ä¸‹æ¸¸æœåŠ¡çš„å¹¶å‘å‹åŠ›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åº•å±‚ç”±Mutexå’ŒMapå®ç°ï¼ŒMutexä¿è¯å¹¶å‘è¯»å†™ä¿æŠ¤ï¼ŒMapä¿å­˜åŒä¸€ä¸ªkeyæ­£åœ¨å¤„ç†çš„è¯·æ±‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åŒ…å«3ä¸ªæ–¹æ³•ï¼ŒDoæ–¹æ³•ï¼šæä¾›ä¸€ä¸ªkeyå’Œä¸€ä¸ªå‡½æ•°ï¼Œå¯¹äºåŒä¸€ä¸ªkeyï¼Œåœ¨åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªå‡½æ•°åœ¨æ‰§è¡Œï¼Œä¹‹ååŒä¸€ä¸ªkeyå¹¶å‘çš„è¯·æ±‚ä¼šç­‰å¾…ï¼Œç­‰åˆ°ç¬¬ä¸€ä¸ªæ‰§è¡Œçš„ç»“æœå°±æ˜¯è¯¥keyçš„æ‰€æœ‰ç»“æœï¼Œè°ƒç”¨å®Œæˆåï¼Œä¼šç§»é™¤è¿™ä¸ªkeyã€‚è¿”å›å€¼sharedè¡¨ç¤ºç»“æœæ˜¯å¦æ¥è‡ªå¤šä¸ªç›¸åŒè¯·æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;DoChanæ–¹æ³•ï¼šç±»ä¼¼Doæ–¹æ³•ï¼Œåªæ˜¯è¿”å›æ˜¯ä¸€ä¸ªchanï¼Œå¾…å…¥å‚å‡½æ•°æ‰§è¡Œå®Œï¼Œäº§ç”Ÿç»“æœåå°±èƒ½åœ¨chanä¸­æ¥æ”¶è¿™ä¸ªç»“æœ&lt;/p&gt;
&lt;p&gt;Forgetæ–¹æ³•ï¼šå‘Šè¯‰Groupå¿½ç•¥è¿™ä¸ªkeyï¼Œä¹‹åè¿™ä¸ªkeyçš„è¯·æ±‚ä¼šæ‰§è¡Œå…¥å‚å‡½æ•°ï¼Œè€Œä¸æ˜¯ç­‰å¾…å‰ä¸€ä¸ªæœªå®Œæˆçš„å…¥å‚å‡½æ•°çš„ç»“æœ&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;cyclicbarrier---å¾ªç¯æ …æ &#34;&gt;CyclicBarrier - å¾ªç¯æ …æ &lt;/h1&gt;
&lt;h2 id=&#34;æ•°æ®ç»“æ„-8&#34;&gt;æ•°æ®ç»“æ„&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;CyclicBarrier&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// ç­‰å¾…æ‰€æœ‰çš„å‚ä¸è€…åˆ°è¾¾ï¼Œå¦‚æœè¢«ctx.Done()ä¸­æ–­ï¼Œä¼šè¿”å›ErrBrokenBarrier
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nf&#34;&gt;Await&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// é‡ç½®å¾ªç¯æ …æ åˆ°åˆå§‹åŒ–çŠ¶æ€ã€‚å¦‚æœå½“å‰æœ‰ç­‰å¾…è€…ï¼Œé‚£ä¹ˆå®ƒä»¬ä¼šè¿”å›ErrBrokenBarrier
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nf&#34;&gt;Reset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// è¿”å›å½“å‰ç­‰å¾…è€…çš„æ•°é‡
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nf&#34;&gt;GetNumberWaiting&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// å‚ä¸è€…çš„æ•°é‡
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nf&#34;&gt;GetParties&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// å¾ªç¯æ …æ æ˜¯å¦å¤„äºä¸­æ–­çŠ¶æ€
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nf&#34;&gt;IsBroken&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id=&#34;åŸºæœ¬-9&#34;&gt;åŸºæœ¬&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;ç±»ä¼¼Javaçš„CyclicBarrierï¼Œå…è®¸ä¸€ç»„goroutineç›¸äº’ç­‰å¾…ï¼Œåˆ°è¾¾ä¸€ä¸ªå…±åŒçš„æ‰§è¡Œç‚¹å†ç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼›åŒæ—¶ä¹Ÿå¯è¢«é‡å¤ä½¿ç”¨ã€‚&lt;/li&gt;
&lt;li&gt;CyclicBarrieræ˜¯ä¸€ä¸ªæ¥å£ï¼Œç„¶åæœ‰ä¸¤ä¸ªåˆå§‹åŒ–çš„æ–¹æ³•ï¼ŒNewæ–¹æ³•ï¼ŒæŒ‡å®šå¾ªç¯æ …æ çš„å‚ä¸è€…æ•°é‡å³å¯åˆå§‹åŒ–ï¼›NewWithActionæ–¹æ³•ï¼Œé™¤äº†æŒ‡å®šå‚ä¸è€…æ•°é‡ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè¡¨ç¤ºåœ¨æœ€åä¸€ä¸ªå‚ä¸è€…åˆ°è¾¾ä¹‹åï¼Œä½†å…¶ä»–å‚ä¸è€…è¿˜æ²¡æ”¾è¡Œä¹‹å‰ï¼Œä¼šè°ƒç”¨è¯¥å‡½æ•°&lt;/li&gt;
&lt;li&gt;æ¯ä¸ªå‚ä¸çš„goroutineéƒ½ä¼šè°ƒç”¨Awaitæ–¹æ³•è¿›è¡Œé˜»å¡ï¼Œå½“è°ƒç”¨Awaitæ–¹æ³•çš„goroutineçš„ä¸ªæ•°=å‚ä¸è€…çš„æ•°é‡æ—¶ï¼ŒAwaitæ–¹æ³•é€ æˆçš„é˜»å¡æ‰ä¼šè§£é™¤&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;errgroup&#34;&gt;ErrGroup&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ç±»ä¼¼WaitGroupï¼Œåªæ˜¯åŠŸèƒ½æ›´ä¸°å¯Œï¼Œå¤šäº†ä¸Contexté›†æˆï¼Œå¯ä»¥é€šè¿‡Contextç›‘æ§æ˜¯å¦å‘ç”Ÿcancelï¼›errorå¯ä»¥å‘ä¸Šä¼ æ’­ï¼ŒæŠŠå­ä»»åŠ¡çš„é”™è¯¯ä¼ é€’ç»™Waitçš„è°ƒç”¨è€…&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ErrGroupç”¨äºå¹¶å‘å¤„ç†å­ä»»åŠ¡ï¼Œå°†ä¸€ä¸ªå¤§ä»»åŠ¡æ‹†æˆå‡ ä¸ªå°ä»»åŠ¡ï¼Œé€šè¿‡Goæ–¹æ³•å¹¶å‘æ‰§è¡Œã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ErrGroupæœ‰ä¸‰ä¸ªæ–¹æ³•ï¼šwithContextã€Goã€Waitï¼Œç”¨æ³•ä¸WaitGroupç›¸ä¼¼ï¼Œåªæ˜¯ä¸éœ€è¦è®¾ç½®è®¡æ•°å€¼ï¼Œä¸”å¯ä»¥é€šè¿‡Waitæ–¹æ³•è·å–å­ä»»åŠ¡è¿”å›çš„é”™è¯¯ï¼Œä½†å®ƒåªä¼šè¿”å›ç¬¬ä¸€ä¸ªå‡ºç°çš„é”™è¯¯ï¼Œå¦‚æœæ‰€æœ‰å­ä»»åŠ¡éƒ½æ‰§è¡ŒæˆåŠŸï¼Œè¿”å›nullï¼›å½“å‘ç”Ÿé”™è¯¯æ—¶ä¸ä¼šç«‹å³è¿”å›ï¼Œè€Œæ˜¯ç­‰åˆ°å…¶ä»–ä»»åŠ¡å®Œæˆäº†æ‰ä¼šè¿”å›ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Goæ–¹æ³•ä¼šåˆ›å»ºä¸€ä¸ªgoroutineæ¥æ‰§è¡Œå­ä»»åŠ¡ï¼Œå¦‚æœå¹¶å‘çš„é‡å¤ªå¤§ï¼Œä¼šå¯¼è‡´åˆ›å»ºå¤§é‡çš„goroutineï¼Œå¸¦æ¥goroutineçš„è°ƒåº¦å’ŒGCå‹åŠ›ï¼Œå ç”¨æ›´å¤šèµ„æºï¼Œè§£å†³æ–¹æ¡ˆå¯ä»¥æ˜¯ä½¿ç”¨worker poolæˆ–è€…ä¿¡å·é‡æ¥æ§åˆ¶goroutineçš„æ•°é‡æˆ–ä¿æŒé‡ç”¨&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å­ä»»åŠ¡å¦‚æœå‘ç”Ÿpanicä¼šå¯¼è‡´ç¨‹åºå´©æºƒ&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;æ£€æµ‹å·¥å…·&#34;&gt;æ£€æµ‹å·¥å…·&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;go race detectorï¼šä¸»è¦ç”¨äºæ£€æµ‹å¤šä¸ªgoroutineå¯¹å…±äº«å˜é‡çš„è®¿é—®æ˜¯å¦å­˜åœ¨åç¨‹å®‰å…¨é—®é¢˜ã€‚ç¼–è¯‘å™¨é€šè¿‡æ¢æµ‹æ‰€æœ‰å†…å­˜çš„è®¿é—®ï¼ŒåŠ å…¥ä»£ç ç›‘è§†å¯¹å†…å­˜åœ°å€çš„è®¿é—®ï¼Œåœ¨ç¨‹åºè¿è¡Œæ—¶ï¼Œç›‘æ§å…±äº«å˜é‡çš„éåŒæ­¥è®¿é—®ï¼Œå‡ºç°raceæ—¶ï¼Œæ‰“å°å‘Šè­¦ä¿¡æ¯ã€‚æ¯”å¦‚åœ¨è¿è¡Œæ—¶åŠ å…¥raceå‚æ•°&lt;code&gt;go run -race main.go&lt;/code&gt;ï¼Œå½“æ‰§è¡Œåˆ°ä¸€äº›å¹¶å‘æ“ä½œæ—¶ï¼Œæ‰ä¼šæ£€æµ‹è¿è¡Œæ—¶æ˜¯å¦æœ‰å¹¶å‘é—®é¢˜&lt;/li&gt;
&lt;li&gt;å‘½ä»¤&lt;code&gt;go vet xxx.go&lt;/code&gt;å¯ä»¥è¿›è¡Œæ­»é”æ£€æµ‹&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h1&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.cnblogs.com/ricklz/p/14535653.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;goä¸­sync.Mutexæºç è§£è¯»&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.cnblogs.com/ricklz/p/14496612.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;goä¸­waitGroupæºç è§£è¯»&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://zhuanlan.zhihu.com/p/344834329&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;æ·±åº¦è§£å¯†Goè¯­è¨€ä¹‹sync.map&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://zhuanlan.zhihu.com/p/99710992&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;golangçš„å¯¹è±¡æ± sync.poolæºç è§£è¯»&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.cnblogs.com/qcrao-2018/p/12736031.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;æ·±åº¦è§£å¯† Go è¯­è¨€ä¹‹ sync.Pool&lt;/a&gt;&lt;/p&gt;
</description>
        </item>
        <item>
        <title>Go Goroutineå’ŒGC</title>
        <link>http://nixum.cc/p/go-goroutine%E5%92%8Cgc/</link>
        <pubDate>Mon, 22 Mar 2021 00:00:00 +0000</pubDate>
        
        <guid>http://nixum.cc/p/go-goroutine%E5%92%8Cgc/</guid>
        <description>&lt;p&gt;[TOC]&lt;/p&gt;
&lt;h1 id=&#34;runtime&#34;&gt;runtime&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;ä¸åŒäºJavaï¼ŒGoæ²¡æœ‰è™šæ‹Ÿæœºï¼Œå¾ˆå¤šä¸œè¥¿æ¯”å¦‚è‡ªåŠ¨GCã€å¯¹æ“ä½œç³»ç»Ÿå’ŒCPUç›¸å…³æ“ä½œéƒ½å˜æˆäº†å‡½æ•°ï¼Œå†™åœ¨runtimeåŒ…é‡Œã€‚&lt;/li&gt;
&lt;li&gt;runtimeæä¾›äº†goä»£ç è¿è¡Œæ—¶æ‰€éœ€è¦çš„åŸºç¡€è®¾æ–½ï¼Œå¦‚åç¨‹è°ƒåº¦ã€å†…å­˜ç®¡ç†ã€GCã€mapã€channelã€stringç­‰å†…ç½®ç±»å‹çš„å®ç°ã€å¯¹æ“ä½œç³»ç»Ÿå’ŒCPUç›¸å…³æ“ä½œè¿›è¡Œå°è£…ã€‚&lt;/li&gt;
&lt;li&gt;è¯¸å¦‚goã€newã€makeã€-&amp;gt;ã€&amp;lt;-ç­‰å…³é”®å­—éƒ½è¢«ç¼–è¯‘å™¨ç¼–è¯‘æˆruntimeåŒ…é‡Œçš„å‡½æ•°&lt;/li&gt;
&lt;li&gt;buildæˆå¯æ‰§è¡Œæ–‡ä»¶æ—¶ï¼Œruntimeä¼šå’Œç”¨æˆ·ä»£ç ä¸€èµ·è¿›è¡Œæ‰“åŒ…ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;pprof&#34;&gt;pprof&lt;/h1&gt;
&lt;p&gt;ä½¿ç”¨&lt;code&gt;net/http/pprof&lt;/code&gt;åº“ï¼Œè¿›è¡ŒHTTPæœåŠ¡è¿›è¡Œåˆ†æï¼Œéœ€è¦ä¸»åŠ¨å¼€å¯ï¼Œæ¯”å¦‚&lt;code&gt;import _ &amp;quot;net/http/pprof&amp;quot;&lt;/code&gt;ï¼Œä½¿ç”¨é»˜è®¤çš„&lt;code&gt;http.DefaultServeMux&lt;/code&gt;ï¼Œé»˜è®¤ç«¯å£æ˜¯6060ï¼›ä¹Ÿå¯è‡ªå®šä¹‰Muxï¼Œæ‰‹åŠ¨æ³¨å†Œè·¯ç”±ã€‚&lt;/p&gt;
&lt;p&gt;pprofæä¾›åº”ç”¨è¿è¡Œçš„è¿‡ç¨‹ä¸­åˆ†æå½“å‰åº”ç”¨çš„å„é¡¹æŒ‡æ ‡æ¥è¾…åŠ©è¿›è¡Œæ€§èƒ½ä¼˜åŒ–ä»¥åŠé—®é¢˜æ’æŸ¥åŠŸèƒ½ï¼Œæä¾›ä»¥ä¸‹åŠŸèƒ½ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç±»å‹&lt;/th&gt;
&lt;th&gt;æè¿°&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;allocs&lt;/td&gt;
&lt;td&gt;æŸ¥è¯¢å†…å­˜åˆ†é…æƒ…å†µï¼Œæ‰€æœ‰å¯¹è±¡çš„å†…å­˜åˆ†é…ï¼Œåœ¨å †ï¼ˆHeapï¼‰åˆ†é…çš„æ—¶å€™ï¼Œè®°å½•ä¸€ä¸‹è°ƒç”¨å †æ ˆã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ˜¯æ¯ 1000 æ¬¡åˆ†é…ï¼Œå–æ ·ä¸€æ¬¡ï¼Œè¿™ä¸ªæ•°å€¼å¯ä»¥æ”¹å˜ã€‚æ ˆ(Stack)åˆ†é… ç”±äºä¼šéšæ—¶é‡Šæ”¾ï¼Œå› æ­¤ä¸ä¼šè¢«å†…å­˜åˆ†ææ‰€è®°å½•ã€‚ç”±äºå†…å­˜åˆ†ææ˜¯å–æ ·æ–¹å¼ï¼Œå¹¶ä¸”ä¹Ÿå› ä¸ºå…¶è®°å½•çš„æ˜¯åˆ†é…å†…å­˜ï¼Œè€Œä¸æ˜¯ä½¿ç”¨å†…å­˜ã€‚å¼€å¯åä¼šå¯¹runtimeäº§ç”Ÿå‹åŠ›ï¼Œé€šè¿‡&lt;code&gt;runtime.MemProfileRate&lt;/code&gt;è®¾ç½®é‡‡æ ·çš„å†…å­˜æ¯”ä¾‹ï¼Œé»˜è®¤å¤§å°æ˜¯512kbã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;blocks&lt;/td&gt;
&lt;td&gt;æŸ¥è¯¢é˜»å¡æ“ä½œæƒ…å†µï¼Œç±»ä¼¼äº CPU æ€§èƒ½åˆ†æï¼Œä½†æ˜¯å®ƒæ‰€è®°å½•çš„æ˜¯ goroutine ç­‰å¾…èµ„æºæ‰€èŠ±çš„æ—¶é—´ã€‚é˜»å¡åˆ†æå¯¹åˆ†æç¨‹åºå¹¶å‘ç“¶é¢ˆéå¸¸æœ‰å¸®åŠ©ï¼Œé˜»å¡æ€§èƒ½åˆ†æå¯ä»¥æ˜¾ç¤ºå‡ºä»€ä¹ˆæ—¶å€™å‡ºç°äº†å¤§æ‰¹çš„ goroutine è¢«é˜»å¡äº†ã€‚é˜»å¡æ€§èƒ½åˆ†ææ˜¯ç‰¹æ®Šçš„åˆ†æå·¥å…·ï¼Œåœ¨æ’é™¤ CPU å’Œå†…å­˜ç“¶é¢ˆå‰ï¼Œä¸åº”è¯¥ç”¨å®ƒæ¥åˆ†æã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;cmdline&lt;/td&gt;
&lt;td&gt;åº”ç”¨å¯åŠ¨å‘½ä»¤åŠå‚æ•°&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;goroutine&lt;/td&gt;
&lt;td&gt;å½“å‰æ‰€æœ‰åç¨‹çš„å †æ ˆä¿¡æ¯ï¼Œå¼€å¯æ—¶ä¼šSTW&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;heap&lt;/td&gt;
&lt;td&gt;å †ä¸Šå†…å­˜ä½¿ç”¨æƒ…å†µé‡‡æ ·ä¿¡æ¯ï¼Œæ´»è·ƒå¯¹è±¡çš„å†…å­˜åˆ†é…&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;mutex&lt;/td&gt;
&lt;td&gt;é”æŒæœ‰çš„å †æ ˆï¼Œæ¬¡æ•°(é‡‡æ ·)çš„ä¿¡æ¯&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;profile&lt;/td&gt;
&lt;td&gt;CPUå ç”¨æƒ…å†µé‡‡æ ·ï¼Œå¯åŠ¨åä¼šå¯¹runtimeäº§ç”Ÿå‹åŠ›ï¼Œruntimeæ¯10msä¼šSTWï¼Œè®°å½•å½“å‰è¿è¡Œçš„ goroutine çš„è°ƒç”¨å †æ ˆåŠç›¸å…³æ•°æ®&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;threadcreate&lt;/td&gt;
&lt;td&gt;ç³»ç»Ÿçº¿ç¨‹åˆ›å»ºæƒ…å†µçš„é‡‡æ ·ä¿¡æ¯ï¼Œä¸ä¼šSTW&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;trace&lt;/td&gt;
&lt;td&gt;ç¨‹åºè¿è¡Œè·Ÿè¸ªä¿¡æ¯ï¼Œè·Ÿè¸ªGCå’ŒGè°ƒåº¦&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;curl  http://ip:port/debug/pprof/{ä¸Šé¢åˆ—è¡¨çš„åŠŸèƒ½} &amp;gt; profileæ–‡ä»¶å&lt;/code&gt; æŠŠæ­¤æ—¶çš„ç»Ÿè®¡ä¸‹è½½ä¸‹æ¥ï¼›åƒtraceã€profile é»˜è®¤é‡‡é›†æ—¶é—´æ˜¯30sï¼Œå¯ä»¥ä½¿ç”¨å‚æ•° seconds=xx æ¥è°ƒæ•´é‡‡æ ·æ—¶é—´ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;é™¤äº†traceä½¿ç”¨&lt;code&gt;go tool trace æ–‡ä»¶å&lt;/code&gt;æ‰“å¼€å¤–ï¼Œå…¶ä»–éƒ½æ˜¯ä½¿ç”¨&lt;code&gt;go tool pprof -http=:8080 profileæ–‡ä»¶å&lt;/code&gt;ï¼Œæ‰“å¼€webç»ˆç«¯ï¼Œå·¦ä¸Šè§’viewé‡Œå°±æœ‰å„ç§è§†å›¾ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å…³äºç«ç„°å›¾&lt;/p&gt;
&lt;p&gt;Yè½´è¡¨ç¤ºè°ƒç”¨æ ˆï¼Œä»ä¸Šåˆ°ä¸‹æ¯ä¸€å±‚éƒ½æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè°ƒç”¨æ ˆè¶Šæ·±ç«ç„°å°±è¶Šé«˜ï¼Œæœ€åº•éƒ¨æ˜¯æ­£åœ¨æ‰§è¡Œçš„å‡½æ•°ï¼Œä¸Šé¢æ˜¯å®ƒçš„çˆ¶å‡½æ•°ï¼›&lt;/p&gt;
&lt;p&gt;Xè½´è¡¨ç¤ºè¿™ä¸ªå‡½æ•°çš„æŠ½æ ·æ•°ï¼Œå¦‚æœä¸€ä¸ªå‡½æ•°åœ¨Xè½´å çš„è¶Šå®½ï¼Œä»£è¡¨æŠ½æ ·æ•°è¶Šé«˜ï¼ŒCPUå ç”¨çš„æ—¶é—´è¶Šé•¿ï¼›æ³¨æ„ï¼ŒXè½´ä¸ä»£è¡¨æ—¶é—´ï¼Œè€Œæ˜¯æ‰€æœ‰çš„è°ƒç”¨æ ˆåˆå¹¶åï¼ŒæŒ‰å­—æ¯é¡ºåºæ’åˆ—çš„ï¼›&lt;/p&gt;
&lt;p&gt;ç«ç„°å›¾å°±æ˜¯çœ‹é¡¶å±‚çš„å“ªä¸ªå‡½æ•°å æ®çš„å®½åº¦æœ€å¤§ã€‚åªè¦æœ‰&amp;quot;å¹³é¡¶&amp;quot;ï¼ˆplateausï¼‰ï¼Œå°±è¡¨ç¤ºè¯¥å‡½æ•°å¯èƒ½å­˜åœ¨æ€§èƒ½é—®é¢˜ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;debugåŒ…ä¸‹æœ‰å‡ ä¸ªå¯ä»¥è¯»å–è¿è¡Œæ—¶æŒ‡æ ‡çš„æ–¹æ³•ï¼Œä½†éœ€è¦æ‰‹åŠ¨ç¼–å†™è¾“å‡º&lt;/p&gt;
&lt;p&gt;&lt;code&gt;debug.ReadGCStatus()&lt;/code&gt;ï¼Œå…·ä½“çš„æŒ‡æ ‡å¯ä»¥çœ‹&lt;code&gt;debug.GCStats{}&lt;/code&gt;é‡Œçš„å­—æ®µ&lt;/p&gt;
&lt;p&gt;&lt;code&gt;runtime.ReadMemStats()&lt;/code&gt;ï¼Œå…·ä½“çš„æŒ‡æ ‡å¯ä»¥çœ‹&lt;code&gt;runtime.MemStats&lt;/code&gt;é‡Œçš„å­—æ®µ&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;printGCStats&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// æ¯éš”ä¸€ç§’é’Ÿç›‘æ§ä¸€æ¬¡ GC çš„çŠ¶æ€
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;t&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;NewTicker&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Second&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;debug&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;GCStats&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;k&#34;&gt;select&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;C&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
            &lt;span class=&#34;nx&#34;&gt;debug&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;ReadGCStats&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
            &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;gc %d last@%v, PauseTotal %v\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;NumGC&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;LastGC&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;PauseTotal&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;go&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;printGCStats&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;netpoller&#34;&gt;netpoller&lt;/h1&gt;
&lt;p&gt;å‚è€ƒï¼šhttps://strikefreedom.top/go-netpoll-io-multiplexing-reactorï¼Œè®²å¾—è¶³å¤Ÿè¯¦ç»†äº†&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.luozhiyun.com/archives/439&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://www.luozhiyun.com/archives/439&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://zhuanlan.zhihu.com/p/272891398&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://zhuanlan.zhihu.com/p/272891398&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;netpolleræœ¬è´¨ä¸Šæ˜¯åˆ©ç”¨æ“ä½œç³»ç»Ÿæœ¬èº«çš„éé˜»å¡IOæ¨¡å‹ + IOå¤šè·¯å¤ç”¨çš„å°è£…ï¼Œä»è€Œå®ç°&lt;code&gt;goroutine-per-connection&lt;/code&gt;æ¨¡å¼ï¼Œä½¿ç”¨åŒæ­¥ç¼–ç¨‹æ¨¡å¼è¾¾åˆ°å¼‚æ­¥æ‰§è¡Œçš„æ•ˆæœã€‚&lt;/p&gt;
&lt;p&gt;netpollerç®—æ˜¯è¿è¡Œåœ¨go schedulerä¸­çš„ä¸€ä¸ªå­ç³»ç»Ÿï¼Œä½†å®ƒä¸»è¦æ˜¯å¤„ç†ç½‘ç»œè¯·æ±‚çš„ï¼Œä½¿å…¶ä¸é˜»å¡æ•´ä¸ªè°ƒåº¦ã€‚&lt;/p&gt;
&lt;p&gt;netpollerä¸­çš„å‡ ä¸ªæ–¹æ³•ï¼š&lt;code&gt;å¯¹epollçš„å°è£… netpollinitã€netpollopenã€netpoll&lt;/code&gt;ã€&lt;code&gt;net.listen&lt;/code&gt;ã€&lt;code&gt;Listener.Accept&lt;/code&gt;ã€&lt;code&gt;Conn.Read / Conn.Write&lt;/code&gt;ï¼Œå¯¹ç½‘ç»œçš„fdä¼šè®¾ç½®æˆNonBlockingæ¨¡å¼ï¼Œæ ¹æ®ä¸åŒçš„è¿”å›å€¼è®¾ç½®Gçš„çŠ¶æ€ï¼Œåœ¨Mçš„è°ƒåº¦ã€sysmonã€gc STWç»“æŸç­‰é˜¶æ®µä¼špollå‡ºreadyçš„Gè¿›è¡Œè¿è¡Œæˆ–è€…æ·»åŠ åˆ°GRQä¸­ã€‚&lt;/p&gt;
&lt;p&gt;è¿™é‡Œè®°ä¸€ä¸‹Goç½‘ç»œç›¸å…³çš„goroutineæ˜¯å¦‚ä½•è¢«è§„åˆ’è°ƒåº¦çš„ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;é¦–å…ˆï¼Œclient è¿æ¥ server çš„æ—¶å€™ï¼Œlistener é€šè¿‡ accept è°ƒç”¨æ¥æ”¶æ–° connectionï¼Œæ¯ä¸€ä¸ªæ–° connection éƒ½å¯åŠ¨ä¸€ä¸ª goroutine å¤„ç†ï¼Œaccept è°ƒç”¨ä¼šæŠŠè¯¥ connection çš„ fd è¿å¸¦æ‰€åœ¨çš„ goroutine ä¸Šä¸‹æ–‡ä¿¡æ¯å°è£…æ³¨å†Œåˆ° epoll çš„ç›‘å¬åˆ—è¡¨é‡Œå»ï¼Œå½“ goroutine è°ƒç”¨ &lt;code&gt;conn.Read&lt;/code&gt; æˆ–è€… &lt;code&gt;conn.Write&lt;/code&gt; ç­‰éœ€è¦é˜»å¡ç­‰å¾…çš„å‡½æ•°æ—¶ï¼Œä¼šè¢« &lt;code&gt;gopark&lt;/code&gt; ç»™å°å­˜èµ·æ¥å¹¶ä½¿ä¹‹ä¼‘çœ ï¼Œè®© P å»æ‰§è¡Œæœ¬åœ°è°ƒåº¦é˜Ÿåˆ—é‡Œçš„ä¸‹ä¸€ä¸ªå¯æ‰§è¡Œçš„ goroutineï¼Œå¾€å Go scheduler ä¼šåœ¨å¾ªç¯è°ƒåº¦çš„ &lt;code&gt;runtime.schedule()&lt;/code&gt; å‡½æ•°ä»¥åŠ sysmon ç›‘æ§çº¿ç¨‹ä¸­è°ƒç”¨ &lt;code&gt;runtime.netpoll&lt;/code&gt; ä»¥è·å–å¯è¿è¡Œçš„ goroutine åˆ—è¡¨å¹¶é€šè¿‡è°ƒç”¨ injectglist æŠŠå‰©ä¸‹çš„ g æ”¾å…¥å…¨å±€è°ƒåº¦é˜Ÿåˆ—æˆ–è€…å½“å‰ P æœ¬åœ°è°ƒåº¦é˜Ÿåˆ—å»é‡æ–°æ‰§è¡Œã€‚&lt;/p&gt;
&lt;p&gt;å½“IOäº‹ä»¶å‘ç”Ÿä¹‹åï¼Œnetpolleré€šè¿‡ &lt;code&gt;runtime.netpoll&lt;/code&gt; å³å¯åœ¨epollç›‘å¬åˆ—è¡¨è·å–åˆ°å·²å°±ç»ªçš„fdåˆ—è¡¨å¯¹åº”çš„goroutineï¼Œå…·ä½“ï¼š&lt;code&gt;runtime.netpoll&lt;/code&gt;ä¼šè°ƒç”¨ &lt;code&gt;epollwait&lt;/code&gt; ç­‰å¾…å‘ç”Ÿäº†å¯è¯»/å¯å†™äº‹ä»¶çš„fdï¼Œå¾ªç¯ &lt;code&gt;epollwait&lt;/code&gt; è¿”å›çš„äº‹ä»¶åˆ—è¡¨ï¼Œå¤„ç†å¯¹åº”çš„äº‹ä»¶ç±»å‹ï¼Œç»„è£…å¯è¿è¡Œçš„goroutineé“¾è¡¨å¹¶è¿”å›ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;sysmonç›‘æ§çº¿ç¨‹&lt;/code&gt;ä¼šåœ¨å¾ªç¯è¿‡ç¨‹ä¸­æ£€æŸ¥è·ç¦»ä¸Šä¸€æ¬¡ &lt;code&gt;runtime.netpoll&lt;/code&gt; è¢«è°ƒç”¨æ˜¯å¦è¶…è¿‡10msï¼Œè‹¥æ˜¯åˆ™å›å»è°ƒç”¨å®ƒæ‹¿åˆ°å¯è¿è¡Œçš„goroutineåˆ—è¡¨å¹¶è°ƒç”¨ injectglist æŠŠ g åˆ—è¡¨æ”¾å…¥å…¨å±€è°ƒåº¦é˜Ÿåˆ—æˆ–è€…å½“å‰ P æœ¬åœ°è°ƒåº¦é˜Ÿåˆ—ç­‰å¾…è¢«æ‰§è¡Œã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æ€»ç»“ï¼šå½“å¤„ç†ç½‘ç»œIOçš„goroutineè¢«é˜»å¡ä½æ—¶ï¼Œé€šè¿‡netpoll + éé˜»å¡IOï¼Œè®©Gä¸ä¼šå› ä¸ºç³»ç»Ÿè°ƒç”¨è€Œé™·å…¥å†…æ ¸æ€ï¼Œåªæ˜¯è¢«runtimeè°ƒç”¨goparkä½ï¼Œæ­¤æ—¶Gä¼šè¢«æ”¾ç½®åˆ°æŸä¸ªwait queueä¸­ï¼›å½“IOå¯ç”¨æ—¶ï¼Œåœ¨ epoll çš„ &lt;code&gt;eventpoll.rdr&lt;/code&gt; ä¸­ç­‰å¾…çš„ G ä¼šè¢«æ”¾åˆ° &lt;code&gt;eventpoll.rdllist&lt;/code&gt; é“¾è¡¨é‡Œå¹¶é€šè¿‡ &lt;code&gt;netpoll&lt;/code&gt; ä¸­çš„ &lt;code&gt;epoll_wait&lt;/code&gt; ç³»ç»Ÿè°ƒç”¨&lt;strong&gt;è¿”å›æ”¾ç½®åˆ°GRQæˆ–è€… P çš„LRQ&lt;/strong&gt;ï¼Œæ ‡è®°ä¸º &lt;code&gt;_Grunnable&lt;/code&gt; ï¼Œç­‰å¾… P ç»‘å®š M æ¢å¤æ‰§è¡Œã€‚&lt;/p&gt;
&lt;h1 id=&#34;goroutine&#34;&gt;Goroutine&lt;/h1&gt;
&lt;h2 id=&#34;ç»“æ„&#34;&gt;ç»“æ„&lt;/h2&gt;
&lt;h3 id=&#34;g&#34;&gt;G&lt;/h3&gt;
&lt;p&gt;goroutineæœ¬è´¨æ˜¯ä¸€ä¸ªæ‰§è¡Œæµï¼Œé€šè¿‡&lt;code&gt;go func(){}()&lt;/code&gt;ä¼šå¼€å¯ä¸€ä¸ªåç¨‹ï¼Œç­‰å¾…è¢«è°ƒåº¦ï¼Œç¼–è¯‘çš„æ—¶å€™ï¼Œä¼šå˜æˆ &lt;code&gt;runtime.g&lt;/code&gt; ç»“æ„ä½“ï¼Œç”¨äºè°ƒåº¦ï¼Œfuncå‡½æ•°ä¼šæŒ‚åœ¨ &lt;code&gt;runtime.g&lt;/code&gt; çš„startpcå­—æ®µï¼Œfuncå‡½æ•°çš„å…¥å‚ä¼šæ‹·è´åˆ°æ ˆä¸­ï¼Œschedç”¨äºä¿å­˜åç¨‹åˆ‡æ¢æ—¶çš„pcä½ç½®å’Œæ ˆä½ç½®ï¼›&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// å®é™…ä¸æ­¢è¿™äº›å­—æ®µ
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;g&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;goid&lt;/span&gt;   &lt;span class=&#34;kt&#34;&gt;int64&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;// åç¨‹id
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;status&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// åç¨‹çŠ¶æ€
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;stack&lt;/span&gt;  &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// åç¨‹ä½¿ç”¨çš„æ ˆ
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;nx&#34;&gt;lo&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uintptr&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// è¯¥åç¨‹æ‹¥æœ‰çš„æ ˆä½ä½
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;nx&#34;&gt;hi&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uintptr&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// è¯¥åç¨‹æ‹¥æœ‰çš„æ ˆé«˜ä½
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;sched&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;gobuf&lt;/span&gt;          &lt;span class=&#34;c1&#34;&gt;// gçš„è¿è¡Œç°åœºï¼Œç”¨äºåˆ‡æ¢æ—¶ä¿å­˜ä¸Šä¸‹æ–‡
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;stackgroud0&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uintptr&lt;/span&gt;        &lt;span class=&#34;c1&#34;&gt;// ç”¨äºæ ˆæ‰©å¼ 
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;stackgroud1&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uintptr&lt;/span&gt;        &lt;span class=&#34;c1&#34;&gt;// ç”¨äºæ ˆæ”¶ç¼©
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;             &lt;span class=&#34;c1&#34;&gt;// å½“å‰gç»‘å®šçš„m
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;param&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;unsafe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Pointer&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// wakeupæ—¶ä½¿ç”¨ï¼Œå‚æ•°ä¼ å…¥
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;waitsince&lt;/span&gt;   &lt;span class=&#34;kt&#34;&gt;int64&lt;/span&gt;          &lt;span class=&#34;c1&#34;&gt;// gè¢«é˜»å¡åçš„è¿‘ä¼¼æ—¶é—´
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;waitreason&lt;/span&gt;  &lt;span class=&#34;nx&#34;&gt;waitReason&lt;/span&gt;     &lt;span class=&#34;c1&#34;&gt;// gè¢«é˜»å¡çš„åŸå› 
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;preempt&lt;/span&gt;     &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt;           &lt;span class=&#34;c1&#34;&gt;// æŠ¢å è°ƒåº¦æ ‡å¿—
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;lockedm&lt;/span&gt;     &lt;span class=&#34;nx&#34;&gt;muintptr&lt;/span&gt;       &lt;span class=&#34;c1&#34;&gt;// å¦‚æœè°ƒç”¨äº†LockOsThreadï¼Œgå°±ä¼šè¢«ç»‘å®šåœ¨mä¸Š
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;gopc&lt;/span&gt;        &lt;span class=&#34;kt&#34;&gt;uintptr&lt;/span&gt;        &lt;span class=&#34;c1&#34;&gt;// åˆ›å»ºgoroutineè¯­å¥çš„æŒ‡ä»¤åœ°å€
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;startpc&lt;/span&gt;     &lt;span class=&#34;kt&#34;&gt;uintptr&lt;/span&gt;        &lt;span class=&#34;c1&#34;&gt;// goroutineå‡½æ•°çš„æŒ‡ä»¤åœ°å€
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;timeer&lt;/span&gt;      &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;timer&lt;/span&gt;         &lt;span class=&#34;c1&#34;&gt;// time.Sleepç¼“å­˜çš„å®šæ—¶å™¨
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;gobuf&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;sp&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uintptr&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// æ ˆæŒ‡é’ˆçš„ä½ç½®
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;pc&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uintptr&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// è¿è¡Œåˆ°çš„ç¨‹åºä½ç½®ï¼Œç¨‹åºè®¡æ•°å™¨çš„å€¼
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h3 id=&#34;m&#34;&gt;M&lt;/h3&gt;
&lt;p&gt;Gè¦è°ƒåº¦åˆ°Mä¸Šæ‰èƒ½è¿è¡Œï¼ŒMæ˜¯çœŸæ­£å·¥ä½œçš„å®ä½“ï¼Œä¿å­˜äº†è‡ªèº«ä½¿ç”¨çš„æ ˆä¿¡æ¯ï¼Œå½“å‰æ­£åœ¨Mä¸Šæ‰§è¡Œçš„Gä¿¡æ¯ï¼Œä¸ä¹‹ç»‘å®šçš„Pä¿¡æ¯ç­‰ã€‚mç»“æ„ä½“è®°å½•äº†ä¸ä¹‹å¯¹åº”çš„å†…æ ¸çº¿ç¨‹çš„æ ˆä¿¡æ¯ï¼Œåœ¨æ‰§è¡Œè°ƒåº¦æ—¶ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// å®é™…ä¸æ­¢è¿™äº›å­—æ®µ
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;g0&lt;/span&gt;         &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;g&lt;/span&gt;         &lt;span class=&#34;c1&#34;&gt;// æ‰§è¡Œç”¨æˆ·goroutineæ—¶ï¼Œä½¿ç”¨ç”¨æˆ·goroutineè‡ªå·±çš„æ ˆï¼Œå› æ­¤è°ƒåº¦æ—¶ä¼šå‘ç”Ÿæ ˆçš„åˆ‡æ¢
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;tls&lt;/span&gt;        &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;6&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uintptr&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// LocalThreadStorageï¼Œé€šè¿‡tlsç»“æ„ä½“å®ç°mä¸å·¥ä½œçº¿ç¨‹çš„ç»‘å®š
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;curg&lt;/span&gt;       &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;g&lt;/span&gt;         &lt;span class=&#34;c1&#34;&gt;// æŒ‡å‘æ­£åœ¨è¿è¡Œçš„goroutineå¯¹è±¡
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;p&lt;/span&gt;          &lt;span class=&#34;nx&#34;&gt;puintptr&lt;/span&gt;   &lt;span class=&#34;c1&#34;&gt;// å½“å‰å·¥ä½œçº¿ç¨‹ç»‘å®šçš„P
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;preemptoff&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;     &lt;span class=&#34;c1&#34;&gt;// è¯¥å­—æ®µä¸ç­‰äºç©ºå­—ç¬¦ä¸²æ—¶ï¼Œä¿å­˜curgå§‹ç»ˆåœ¨è¿™ä¸ªmä¸Šè¿è¡Œ
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;spinning&lt;/span&gt;   &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt;       &lt;span class=&#34;c1&#34;&gt;// ä¸ºtrueè¡¨ç¤ºå½“å‰må¤„äºè‡ªæ—‹çŠ¶æ€ï¼Œæ­£åœ¨ä»å…¶ä»–çº¿ç¨‹å·ä»»åŠ¡
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;blocked&lt;/span&gt;    &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt;       &lt;span class=&#34;c1&#34;&gt;// mæ­£é˜»å¡åœ¨noteä¸Š
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;park&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;note&lt;/span&gt;       &lt;span class=&#34;c1&#34;&gt;// æ²¡æœ‰goroutineéœ€è¦è¿è¡Œæ—¶ï¼Œå·¥ä½œçº¿ç¨‹sleepåœ¨è¿™ä¸ªparkæˆå‘˜ä¸Šï¼Œå…¶ä»–çº¿ç¨‹é€šè¿‡è¿™ä¸ªparkå”¤é†’è¯¥å·¥ä½œçº¿ç¨‹
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;alllink&lt;/span&gt;    &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;         &lt;span class=&#34;c1&#34;&gt;// è®°å½•æ‰€æœ‰å·¥ä½œçº¿ç¨‹çš„é“¾è¡¨
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;locks&lt;/span&gt;      &lt;span class=&#34;kt&#34;&gt;int32&lt;/span&gt;      &lt;span class=&#34;c1&#34;&gt;// é”çš„è®¡æ•°å™¨ï¼Œé0è¡¨ç¤ºå¯¹mä¸Šé”ï¼Œç¦æ­¢è¢«æŠ¢å 
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h3 id=&#34;p&#34;&gt;P&lt;/h3&gt;
&lt;p&gt;ä¸ºMçš„æ‰§è¡Œæä¾›ä¸Šä¸‹æ–‡ï¼Œä¿å­˜Mæ‰§è¡ŒGçš„ä¸€äº›èµ„æºï¼Œä¸€ä¸ªMåªæœ‰ç»‘å®šäº†Pæ‰èƒ½æ‰§è¡Œgoroutine&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;p&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt;          &lt;span class=&#34;kt&#34;&gt;int32&lt;/span&gt;         &lt;span class=&#34;c1&#34;&gt;// åœ¨allpä¸­çš„ç´¢å¼•
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;schedtick&lt;/span&gt;   &lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;        &lt;span class=&#34;c1&#34;&gt;// æ¯æ¬¡è°ƒç”¨scheduleæ—¶ä¼šåŠ ä¸€
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;syscalltick&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;        &lt;span class=&#34;c1&#34;&gt;// æ¯æ¬¡ç³»ç»Ÿè°ƒç”¨æ—¶ä¼šåŠ ä¸€
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;sysmontick&lt;/span&gt;  &lt;span class=&#34;nx&#34;&gt;sysmontick&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// ç”¨äºsysmonçº¿ç¨‹è®°å½•è¢«ç›‘æ§pçš„ç³»ç»Ÿè°ƒç”¨æ—¶é—´å’Œè¿è¡Œæ—¶é—´
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;           &lt;span class=&#34;nx&#34;&gt;muintptr&lt;/span&gt;      &lt;span class=&#34;c1&#34;&gt;// æ‰§è¡Œç»‘å®šçš„mï¼Œå¦‚æœpæ˜¯idleçš„è¯ï¼Œè¿™ä¸ªæŒ‡é’ˆæ˜¯nil
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;runqhead&lt;/span&gt;    &lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;        &lt;span class=&#34;c1&#34;&gt;// æœ¬åœ°è¿è¡Œé˜Ÿåˆ—çš„é˜Ÿå¤´
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;runqtail&lt;/span&gt;    &lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;        &lt;span class=&#34;c1&#34;&gt;// æœ¬åœ°è¿è¡Œé˜Ÿåˆ—çš„é˜Ÿå°¾
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;runq&lt;/span&gt;        &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;256&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;guintptr&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// æœ¬åœ°è¿è¡Œé˜Ÿåˆ—ï¼Œä¸€ä¸ª256é•¿åº¦çš„æ•°ç»„
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// runnextéç©ºï¼Œè¡¨ç¤ºæœ‰ä¸€ä¸ªGåœ¨æ‰§è¡Œï¼ŒçŠ¶æ€æ˜¯runnable
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// è¿™ä¸ªGè¢«å½“å‰Gä¿®æ”¹ä¸ºreadyçŠ¶æ€æ—¶ï¼Œç›¸æ¯”runqä¸­çš„Gæœ‰æ›´é«˜çš„ä¼˜å…ˆçº§
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// å¦‚æœå½“å‰Gè¿˜æœ‰å‰©ä½™çš„å¯ç”¨æ—¶é—´ï¼Œé‚£å°±è¿è¡Œè¿™ä¸ªG
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// è¿è¡Œä¹‹åï¼Œè¯¥Gä¼šè®°ä¸²å½“å‰Gçš„å‰©ä½™æ—¶é—´
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;runnext&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;guintptr&lt;/span&gt;
	&lt;span class=&#34;c1&#34;&gt;// ç©ºé—²gé“¾è¡¨
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;gFree&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;gList&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;n&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int32&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id=&#34;åŸºæœ¬&#34;&gt;åŸºæœ¬&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;GPMæ¨¡å‹ - Mï¼šNè°ƒåº¦æ¨¡å‹&lt;/p&gt;
&lt;p&gt;æ¨¡å‹åˆ†ç±»ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Nï¼š1 å³ Nä¸ªåç¨‹ç»‘å®š1ä¸ªçº¿ç¨‹&lt;/p&gt;
&lt;p&gt;ä¼˜ç‚¹ï¼šåç¨‹åœ¨ç”¨æˆ·æ€çº¿ç¨‹å³å¯å®Œæˆåˆ‡æ¢ï¼Œç”±åç¨‹è°ƒåº¦å™¨è°ƒåº¦ï¼Œä¸æ¶‰åŠå†…æ ¸æ€ï¼Œæ— éœ€CPUè°ƒåº¦ï¼Œè½»é‡å¿«é€Ÿï¼›&lt;/p&gt;
&lt;p&gt;ç¼ºç‚¹ï¼šæ— æ³•ä½¿ç”¨å¤šæ ¸åŠ é€Ÿï¼Œä¸€æ—¦æŸåç¨‹é˜»å¡ï¼Œä¼šå¯¼è‡´çº¿ç¨‹é˜»å¡ï¼Œæ­¤æ—¶å¹¶è¡Œå˜æˆä¸²è¡Œï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;1ï¼š1 å³ 1ä¸ªåç¨‹ç»‘å®š1ä¸ªçº¿ç¨‹&lt;/p&gt;
&lt;p&gt;ä¼˜ç‚¹ï¼šè§£å†³Nï¼š1æ¨¡å‹çš„ç¼ºç‚¹ï¼›&lt;/p&gt;
&lt;p&gt;ç¼ºç‚¹ï¼šè°ƒåº¦å‡æœ‰åç¨‹è°ƒåº¦å™¨å’ŒCPUè°ƒåº¦ï¼Œä»£ä»·è¾ƒå¤§ï¼Œæ— æ³•å¹¶è¡Œï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Mï¼šN å³ Mä¸ªåç¨‹ç»‘å®šNä¸ªçº¿ç¨‹ï¼Œç”±åç¨‹è°ƒåº¦å™¨è°ƒåº¦ï¼Œçº¿ç¨‹åœ¨å†…æ ¸æ€é€šè¿‡CPUæŠ¢å å¼è°ƒç”¨ï¼Œåç¨‹åœ¨ç”¨æˆ·æ€é€šè¿‡åä½œå¼è°ƒåº¦&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¸€èˆ¬çº¿ç¨‹ä¼šå æœ‰1Mbä»¥ä¸Šçš„å†…å­˜ç©ºé—´ï¼Œæ¯æ¬¡å¯¹çº¿ç¨‹è¿›è¡Œåˆ‡æ¢æ—¶ä¼šæ¶ˆè€—è¾ƒå¤šå†…å­˜ï¼Œæ¢å¤å¯„å­˜å™¨ä¸­çš„å†…å®¹è¿˜éœ€è¦å‘æ“ä½œç³»ç»Ÿç”³è¯·æˆ–é”€æ¯å¯¹åº”çš„èµ„æºï¼Œæ¯ä¸€æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢éƒ½éœ€è¦æ¶ˆè€—~1uså·¦å³çš„æ—¶é—´ï¼Œè€ŒGoè°ƒåº¦å™¨å¯¹ G çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ä¸º~0.2usï¼Œå‡å°‘äº†80%çš„é¢å¤–å¼€é”€ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åç¨‹æœ¬è´¨æ˜¯ä¸€ä¸ªæ•°æ®ç»“æ„ï¼Œå°è£…äº†è¦è¿è¡Œçš„å‡½æ•°å’Œè¿è¡Œçš„è¿›åº¦ï¼Œäº¤ç”±goè°ƒåº¦å™¨è¿›è¡Œè°ƒåº¦ï¼Œä¸æ–­åˆ‡æ¢çš„è¿‡ç¨‹ã€‚ç”±goè°ƒåº¦å™¨å†³å®šåç¨‹æ˜¯è¿è¡Œï¼Œè¿˜æ˜¯åˆ‡æ¢å‡ºè°ƒåº¦é˜Ÿåˆ—(é˜»å¡)ï¼Œå»æ‰§è¡Œå…¶ä»–æ»¡è¶³æ¡ä»¶çš„åç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;goçš„è°ƒåº¦å™¨åœ¨ç”¨æˆ·æ€å®ç°è°ƒåº¦ï¼Œè°ƒåº¦çš„æ˜¯ä¸€ç§åå«åç¨‹çš„æ‰§è¡Œæµç»“æ„ä½“ï¼Œä¹Ÿæœ‰éœ€è¦ä¿å­˜å’Œæ¢å¤ä¸Šä¸‹æ–‡çš„å‡½æ•°ï¼Œè¿è¡Œé˜Ÿåˆ—ã€‚&lt;/p&gt;
&lt;p&gt;åç¨‹åŒæ­¥é€ æˆçš„é˜»å¡ï¼Œåªæ˜¯è°ƒåº¦å™¨åˆ‡æ¢åˆ°åˆ«çš„åç¨‹å»æ‰§è¡Œäº†ï¼Œçº¿ç¨‹æœ¬èº«å¹¶ä¸é˜»å¡ã€‚&lt;/p&gt;
&lt;p&gt;æŠ¢å ï¼šåœ¨åç¨‹ä¸­ï¼Œè¦ç­‰åˆ°ä¸€ä¸ªåç¨‹ä¸»åŠ¨è®©å‡ºCPUæ‰èƒ½æ‰§è¡Œä¸‹ä¸€ä¸ªåç¨‹&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Goçš„è°ƒåº¦å™¨é€šè¿‡&lt;strong&gt;ä½¿ç”¨ä¸CPUæ•°é‡ç›¸ç­‰çš„çº¿ç¨‹&lt;/strong&gt;å‡å°‘çº¿ç¨‹é¢‘ç¹åˆ‡æ¢çš„å†…å­˜å¼€é”€ï¼ŒåŒæ—¶&lt;strong&gt;åœ¨æ¯ä¸€ä¸ªçº¿ç¨‹ä¸Šæ‰§è¡Œé¢å¤–å¼€é”€æ›´ä½çš„Goroutine&lt;/strong&gt;æ¥é™ä½æ“ä½œç³»ç»Ÿå’Œè½¯ä»¶çš„è´Ÿè½½ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;1.2~1.3ç‰ˆæœ¬ä½¿ç”¨&lt;strong&gt;åŸºäºåä½œçš„æŠ¢å å¼è°ƒåº¦å™¨&lt;/strong&gt;ï¼ˆé€šè¿‡ç¼–è¯‘å™¨åœ¨å‡½æ•°è°ƒç”¨æ—¶(å‡½æ•°å¤´æˆ–å°¾)æ’å…¥æŠ¢å å¼æ£€æŸ¥æŒ‡ä»¤ï¼Œæ¯”å¦‚æ ˆæ‰©å®¹æ£€æŸ¥ï¼Œåœ¨å‡½æ•°è°ƒç”¨æ—¶æ£€æŸ¥å½“å‰Gæ˜¯å¦å‘èµ·æŠ¢å å¼è¯·æ±‚ï¼‰ï¼Œä½† G å¯èƒ½ä¼šå› ä¸ºåƒåœ¾å›æ”¶å’Œå¾ªç¯æ—¶é—´å¤ªé•¿ï¼Œå ç”¨èµ„æºå¯¼è‡´æ²¡æœ‰è®©å‡ºCPUï¼Œé€ æˆå…¶ä»–goroutineé¥¿æ­»ï¼Œç”šè‡³è®©ç¨‹åºæš‚åœï¼›&lt;/p&gt;
&lt;p&gt;ä»1.14ç‰ˆæœ¬å¼€å§‹ä½¿ç”¨&lt;strong&gt;åŸºäºä¿¡å·çš„æŠ¢å å¼è°ƒåº¦&lt;/strong&gt;ï¼Œä¼šç»™éœ€è¦å¤„ç†çš„å‡½æ•°ç»‘ä¸Šsignhandlerï¼Œå¤„ç†SIGURGä¿¡å·ï¼Œå½“çº¿ç¨‹Mæ¥æ”¶åˆ°ä¿¡å·åï¼Œä¼šä»ç”¨æˆ·æ ˆ G åˆ‡æ¢åˆ°gsingalæ‰§è¡Œä¿¡å·å¤„ç†é€»è¾‘ï¼Œå®ç°è°ƒåº¦ï¼Œæ¯”å¦‚åƒåœ¾å›æ”¶åœ¨æ‰«ææ ˆæ—¶ä¼šè§¦å‘æŠ¢å å¼è°ƒåº¦ï¼Œsysmonæ˜¯å…¶ä¸­ä¸€ç§å®ç°ï¼Œsysmonä¼šå®šæ—¶è¿›è¡Œç›‘æ§ï¼Œè§¦å‘è°ƒåº¦ï¼›&lt;/p&gt;
&lt;p&gt;ä¹‹æ‰€ä»¥è¦ä½¿ç”¨ä¿¡å·æŠ¢å å¼çš„ï¼Œæ˜¯å› ä¸ºå¦‚æœæ˜¯ G ä¸»åŠ¨è®©å‡ºCPUèµ„æºæ‰èƒ½è§¦å‘è°ƒåº¦ï¼Œå¯èƒ½ä¼šå¯¼è‡´æŸä¸ª G é•¿æ—¶é—´å ç”¨çº¿ç¨‹ï¼Œé€ æˆå…¶ä»– G é¥¿æ­»ï¼›å¦å¤–ï¼Œåƒåœ¾å›æ”¶éœ€è¦æš‚åœæ•´ä¸ªç¨‹åºï¼Œåœ¨STWæ—¶ï¼Œæ•´ä¸ªç¨‹åºæ— æ³•å·¥ä½œã€‚&lt;/p&gt;
&lt;p&gt;å…³äºæŠ¢å å’Œåä½œï¼Œgoæœ¬èº«çš„è°ƒåº¦æ¨¡å‹æ—¢åŒ…å«äº†æŠ¢å ï¼Œä¹ŸåŒ…å«äº†åä½œï¼›&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åä½œå¼ï¼šå„ä¸ªä»»åŠ¡ç›¸äº’åˆä½œï¼Œç¨‹åºä¸»åŠ¨åœ¨éœ€è¦ç­‰å¾…çš„æ—¶å€™è®©å‡ºæ§åˆ¶æƒï¼Œæ¯”å¦‚golangæ˜¯ç”±ç¼–è¯‘å™¨éšå¼æ’å…¥yieldèŠ‚ç‚¹ï¼Œæ‰€ä»¥ç¨‹åºå¯ä»¥çŸ¥é“å„ä¸ªä»»åŠ¡æŒ‚èµ·å’Œæ¢å¤æ—¶éœ€è¦å“ªäº›ä¿¡æ¯ï¼Œè€ŒOSçš„çº¿ç¨‹è°ƒåº¦å™¨ä¸çŸ¥é“ï¼Œä¹Ÿä¸éœ€è¦çŸ¥é“ï¼Œäº¤ç”±ä»»åŠ¡è‡ªå·±å†³å®šï¼›&lt;/li&gt;
&lt;li&gt;æŠ¢å å¼ï¼šå„ä¸ªç¨‹åºä¸åä½œï¼Œç›¸äº’æŠ¢å ï¼Œç”±å¤–éƒ¨çš„è°ƒåº¦å™¨å†³å®šè¿è¡Œå“ªä¸€ä¸ªä»»åŠ¡ï¼Œæ‰€ä»¥ç¨‹åºä¸éœ€è¦å…³å¿ƒç”¨æˆ·ä»£ç å’Œå¤„ç†åä½œçš„ç»†èŠ‚ï¼Œä¹Ÿä¸çŸ¥é“å„ä¸ªä»»åŠ¡æŒ‚èµ·å’Œæ¢å¤æ—¶çš„ä¿¡æ¯ï¼Œè€Œæ˜¯ç”±OSç›´æ¥æŠŠæ•´ä¸ªè°ƒç”¨æ ˆçš„çŠ¶æ€è¿›è¡Œä¿å­˜å’Œæ¢å¤ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;æ—©æœŸè°ƒåº¦æ¨¡å‹-mgæ¨¡å‹&#34;&gt;æ—©æœŸè°ƒåº¦æ¨¡å‹-MGæ¨¡å‹&lt;/h2&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/go%e6%97%a9%e6%9c%9f%e8%b0%83%e5%ba%a6%e6%a8%a1%e5%9e%8b.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/go%e6%97%a9%e6%9c%9f%e8%b0%83%e5%ba%a6%e6%a8%a1%e5%9e%8b.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			alt=&#34;goroutine early schedule&#34;&gt;
	&lt;/a&gt;
	
	&lt;figcaption&gt;goroutine early schedule&lt;/figcaption&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;çº¿ç¨‹Mæƒ³è¦å¤„ç†åç¨‹Gï¼Œéƒ½å¿…é¡»è®¿é—®å…¨å±€é˜Ÿåˆ—GRQï¼Œå½“å¤šä¸ªMè®¿é—®åŒä¸€èµ„æºæ—¶éœ€è¦åŠ é”ä¿è¯å¹¶å‘å®‰å…¨ï¼Œå› æ­¤Må¯¹Gçš„åˆ›å»ºï¼Œé”€æ¯ï¼Œè°ƒåº¦éƒ½éœ€è¦ä¸Šé”ï¼Œé€ æˆæ¿€çƒˆçš„é”ç«äº‰ï¼Œå¯¼è‡´æ€§èƒ½è¾ƒå·®ã€‚&lt;/p&gt;
&lt;p&gt;å¦å¤–ï¼Œå½“M0æ‰§è¡ŒG0ï¼Œä½†G0åˆäº§ç”Ÿäº†G1ï¼Œæ­¤æ—¶ä¸ºäº†ç»§ç»­æ‰§è¡ŒG0ï¼Œéœ€è¦å°†G1ç§»ç»™M1ï¼Œé€ æˆè¾ƒå·®çš„å±€éƒ¨æ€§ï¼Œå› ä¸ºä¸€èˆ¬æƒ…å†µä¸‹è¿™ä¸¤ä¸ªGæ˜¯æœ‰ä¸€å®šçš„å…³è”æ€§çš„ï¼Œå¦‚æœæ”¾åœ¨ä¸åŒçš„Mä¼šå¢åŠ ç³»ç»Ÿå¼€é”€ï¼›CPUåœ¨å¤šä¸ªMä¹‹é—´åˆ‡æ¢ä¹Ÿå¢åŠ äº†ç³»ç»Ÿå¼€é”€ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†è§£å†³æ—©æœŸè°ƒåº¦å™¨æ¨¡å‹çš„ç¼ºç‚¹ï¼Œé‡‡ç”¨äº†GMPæ¨¡å‹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;è°ƒåº¦å™¨çš„gpmæ¨¡å‹&#34;&gt;è°ƒåº¦å™¨çš„GPMæ¨¡å‹&lt;/h2&gt;
&lt;p&gt;goroutineå®Œå…¨è¿è¡Œåœ¨ç”¨æˆ·æ€ï¼Œå€Ÿé‰´Mï¼šNçº¿ç¨‹æ˜ å°„å…³ç³»ï¼Œé‡‡ç”¨GPMæ¨¡å‹ç®¡ç†goroutineã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Gï¼šå³goroutineï¼Œä»£ç ä¸­çš„&lt;code&gt;go func{}&lt;/code&gt;ï¼Œä»£è¡¨ä¸€ä¸ªå¾…æ‰§è¡Œçš„ä»»åŠ¡&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¸€ä¸ªGæœ€å¤šå æœ‰CPU 10ms&lt;/strong&gt;ï¼Œé˜²æ­¢å…¶ä»–Gé¥¿æ­»ã€‚&lt;/li&gt;
&lt;li&gt;æ¯ä¸ªGoroutineéƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„æ ˆå­˜æ”¾å½“å‰çš„è¿è¡Œå†…å­˜åŠçŠ¶æ€ï¼Œå½“Gè¢«è°ƒç¦»CPUæ—¶ï¼Œè°ƒåº¦å™¨ä¼šè´Ÿè´£æŠŠCPUå¯„å­˜å™¨çš„å€¼ä¿å­˜åœ¨Gå¯¹è±¡çš„æˆå‘˜å˜é‡ä¸­ï¼Œå½“Gè¢«è°ƒåº¦è¿è¡Œèµ·æ¥æ—¶ï¼Œè°ƒåº¦å™¨åˆä¼šè´Ÿè´£æŠŠGå¯¹è±¡çš„æˆå‘˜å˜é‡æ‰€ä¿å­˜çš„å¯„å­˜å™¨çš„å€¼æ¢å¤åˆ°CPUçš„å¯„å­˜å™¨ä¸­ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ ˆæ‰©å¼ ï¼šæ¯ä¸€ä¸ªGéƒ½æœ‰è‡ªå·±çš„æ ˆç©ºé—´ï¼Œä¸ºäº†é¿å…Gè¿‡å¤šå¯¼è‡´ä½¿ç”¨è¿‡å¤šçš„å†…å­˜ï¼Œä¸€å¼€å§‹åªä¼šåˆ†é…ç»™Gä¸€å—å¾ˆå°çš„æ ˆç©ºé—´ï¼Œæ¯”å¦‚2kï¼Œå½“å‡½æ•°å‘ç°æ ˆç©ºé—´ä¸è¶³æ—¶ï¼Œå°±ä¼šç”³è¯·ä¸€å—æ–°çš„æ ˆç©ºé—´å¹¶æŠŠåŸæ¥çš„æ ˆå†…å®¹å¤åˆ¶è¿‡å»ï¼Œè¿™å°±æ˜¯Gä¸­_GcopystackçŠ¶æ€ï¼Œ64ä½æœºå™¨æœ€å¤§æ˜¯1GBï¼Œ32ä½ä¸º256MBã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Mï¼šå³machineï¼Œæ“ä½œç³»ç»Ÿçš„çº¿ç¨‹ï¼Œä¸ä¸€ä¸ªå†…æ ¸çº¿ç¨‹ç»‘å®šï¼Œç”±æ“ä½œç³»ç»Ÿçš„è°ƒåº¦å™¨è°ƒåº¦å’Œç®¡ç†ã€‚æ¯ä¸ªçº¿ç¨‹æœ‰ä¸€ä¸ªTLSï¼ˆThread-Local Storageï¼‰ï¼Œç”¨äºä¿å­˜çº¿ç¨‹ä¸­çš„æœ¬åœ°æ•°æ®ï¼Œæ¯”å¦‚æ ˆçš„èµ·æ­¢ä½ç½®ã€å½“å‰æ­£åœ¨æ‰§è¡Œçš„Gã€Mæœ¬èº«æ˜¯å¦ç©ºé—²ç­‰ä¿¡æ¯ã€é€šè¿‡æŒ‡é’ˆç»´æŒä¸Pç»“æ„ä½“å®ä¾‹å¯¹è±¡çš„ç»‘å®šå…³ç³»ã€è·å–ç³»ç»Ÿçº¿ç¨‹ä¸­å½“å‰çš„Gå’ŒGæ‰€å±çš„Må®ä¾‹ç­‰ï¼›&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Mçš„æ•°é‡ä¸ä¸€å®šå’ŒPåŒ¹é…ï¼Œå¯ä»¥è®¾ç½®å¤šä¸ªMï¼ŒMå’ŒPç»‘å®šåæ‰å¯è¿è¡Œï¼Œå¤šä½™çš„Mä¼šå¤„äºä¼‘çœ çŠ¶æ€ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è°ƒåº¦å™¨æœ€å¤šå¯åˆ›å»º10kä¸ªMï¼Œä½†æœ€å¤šåªæœ‰GOMAXPROCSä¸ªæ´»è·ƒçº¿ç¨‹èƒ½å¤Ÿæ­£å¸¸è¿è¡Œï¼Œæˆ–è€…è‡ªæ—‹ï¼›&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¼šè®¾ç½®ä¸Pä¸€æ ·æ•°é‡çš„Mï¼Œè®©æ‰€æœ‰çš„è°ƒåº¦éƒ½å‘ç”Ÿåœ¨ç”¨æˆ·æ€ï¼Œå‡å°‘é¢å¤–çš„è°ƒåº¦å’Œä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Mè¢«åˆ›å»ºçš„æ—¶æœºï¼šå½“æ²¡æœ‰è¶³å¤Ÿçš„Mæ¥å…³è”Pï¼Œå¹¶è¿è¡ŒPä¸­LRQçš„Gï¼Œæˆ–è€…æ‰€æœ‰çš„Méƒ½è¢«é˜»å¡ä½æ—¶ï¼Œå°±ä¼šå»ç©ºé—²Mé“¾è¡¨ä¸­æŸ¥æ‰¾Mï¼Œå¦‚æœè¿˜æ²¡æœ‰ï¼Œå°±ä¼šåˆ›å»ºæ–°çš„Mï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Pï¼šå³processorï¼Œå¤„ç†å™¨çš„æŠ½è±¡ï¼Œè¿è¡Œåœ¨çº¿ç¨‹ä¸Šçš„æœ¬åœ°è°ƒåº¦å™¨ï¼Œç”¨æ¥ç®¡ç†å’Œæ‰§è¡Œgoroutineï¼Œä½¿å¾—goroutineåœ¨ä¸€ä¸ªçº¿ç¨‹ä¸Šè·‘ï¼Œæä¾›äº†çº¿ç¨‹Méœ€è¦çš„ä¸Šä¸‹æ–‡ï¼ˆå±€éƒ¨è®¡ç®—èµ„æºï¼Œç”¨äºåœ¨åŒä¸€çº¿ç¨‹å†™å¤šä¸ªgoroutineçš„åˆ‡æ¢ï¼‰ï¼›&lt;/p&gt;
&lt;p&gt;ä¹‹æ‰€ä»¥LRQæ˜¯æ”¾åœ¨Pä¸æ˜¯æ”¾åœ¨Mï¼Œæ˜¯å› ä¸ºå½“Må‘ç”Ÿé˜»å¡æ—¶ï¼Œæ‰èƒ½å°†å’Œå®ƒç»‘å®šçš„Pä¸Šçš„Gè½¬ç§»ç»™å…¶ä»–çº¿ç¨‹ï¼›&lt;/p&gt;
&lt;p&gt;Pçš„æ„ä¹‰åœ¨äºå·¥ä½œçªƒå–ç®—æ³•ï¼Œé«˜æ•ˆåˆ©ç”¨Mï¼ŒåŒæ—¶ä¹Ÿæ˜¯ä¸ºäº†ä¿è¯åœ¨å‘ç”Ÿç³»ç»Ÿè°ƒç”¨æ—¶ï¼ŒMé˜»å¡ï¼Œé‡Šæ”¾Pï¼ŒMPåˆ†ç¦»ï¼Œæ­¤æ—¶På°±å¯ä»¥äº¤ç»™å…¶ä»–Mç»§ç»­æ‰§è¡Œï¼Œå³hand offç­–ç•¥ï¼Œæ˜¯å®ç°ä»Nï¼š1åˆ°Nï¼šMæ˜ å°„çš„å…³é”®ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Pçš„ä¸ªæ•°å–å†³äº&lt;strong&gt;GOMAXPROCS&lt;/strong&gt;ï¼Œé»˜è®¤ä½¿ç”¨CPUçš„ä¸ªæ•°ï¼Œè¿™äº›Pä¼šç»‘å®šåˆ°ä¸åŒå†…æ ¸çº¿ç¨‹ï¼Œå°½é‡æå‡æ€§èƒ½ï¼Œè®©æ¯ä¸ªæ ¸éƒ½æœ‰ä»£ç åœ¨è·‘ã€‚åœ¨ç¡®å®šäº†Pçš„æœ€å¤§æ•°é‡nåï¼Œå½“ç¨‹åºè¿è¡Œæ—¶ï¼Œåˆ›å»ºnä¸ªPï¼ŒPä»£è¡¨ä»£è¡¨å¹¶å‘åº¦ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;PåŒ…å«ä¸€ä¸ªLRQï¼ˆLocal Run Queueæœ¬åœ°è¿è¡Œé˜Ÿåˆ—ï¼‰ï¼Œä¿å­˜Péœ€è¦æ‰§è¡Œçš„goroutineçš„é˜Ÿåˆ—ã€‚&lt;strong&gt;LRQæ˜¯ä¸€ä¸ªé•¿åº¦ä¸º256çš„ç¯å½¢æ•°ç»„&lt;/strong&gt;ï¼Œæœ‰headå’Œtailä¸¤ä¸ªåºå·ï¼Œå½“æ•°é‡è¾¾åˆ°256æ—¶ï¼Œæ–°åˆ›å»ºçš„goroutineä¼šä¿å­˜åœ¨GRQä¸­ï¼ŒLRQä¸­å‰ä¸€åŠGæ‰“ä¹±é¡ºåºåä¹Ÿæ”¾åˆ°GRQä¸­ï¼›&lt;/p&gt;
&lt;p&gt;å½“åœ¨G0ä¸­äº§ç”ŸG1ï¼Œæ­¤æ—¶ä¼šG1ä¼šä¼˜å…ˆåŠ å…¥å½“å‰çš„LRQé˜Ÿåˆ—ï¼Œä¿è¯å…¶åœ¨åŒä¸€ä¸ªMä¸Šæ‰§è¡Œï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Pæœ¬èº«è¿˜ä¼šç»´æŠ¤ä¸€ä¸ª&lt;code&gt;local freelist G&lt;/code&gt;ç”¨äºå¤ç”¨Gï¼Œç±»ä¼¼å¤ç”¨æ± ï¼Œåœ¨çŸ­æ—¶é—´å†…å¤§é‡åˆ›å»ºGä¸”æ‰§è¡Œå®Œæˆçš„æ—¶é—´å¾ˆçŸ­æ—¶ç”¨å¤„æ¯”è¾ƒå¤§ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å…¨å±€è¿è¡Œé˜Ÿåˆ—GRQï¼ˆGlobal Run Queueï¼‰ï¼šç”±è°ƒåº¦å™¨æœ¬èº«æŒæœ‰ï¼Œä¿å­˜æ‰€æœ‰æœªåˆ†é…çš„goroutineï¼Œä¿å­˜åœ¨å…¨å±€éå†schedä¸­ã€‚GRQæ˜¯ä¸€ä¸ªé“¾è¡¨ï¼Œæœ‰headï¼Œtailä¸¤ä¸ªæŒ‡é’ˆã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æ²¡æœ‰Pçš„æƒ…å†µä¸‹ï¼Œæ‰€æœ‰Gåªèƒ½æ”¾åœ¨ä¸€ä¸ªGRQ(å…¨å±€é˜Ÿåˆ—)ä¸­ï¼Œå½“Mæ‰§è¡Œå®ŒGï¼Œä¸”æ²¡æœ‰Gå¯æ‰§è¡Œæ—¶ï¼Œå¿…é¡»é”ä½è¯¥å…¨å±€é˜Ÿåˆ—æ‰èƒ½å–Gã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç©ºé—²çš„Mé“¾è¡¨ï¼šä¸»è¦ç”¨äºä¿å­˜æ— Gå¯è¿è¡Œæ—¶è€Œè¿›å…¥ä¼‘çœ çš„Mï¼Œä¹Ÿä¿å­˜åœ¨å…¨å±€å˜é‡schedä¸­ï¼Œè¿›å…¥ä¼‘çœ çš„Mä¼šç­‰å¾…ä¿¡å·é‡m.parkçš„å”¤é†’ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç©ºé—²çš„Pé“¾è¡¨ï¼šå½“æ— Gå¯è¿è¡Œæ—¶ï¼Œæ‹¥æœ‰Pçš„Mä¼šé‡Šæ”¾På¹¶è¿›å…¥ä¼‘çœ çŠ¶æ€ï¼Œé‡Šæ”¾çš„Pä¼šå˜æˆç©ºé—²çŠ¶æ€ï¼ŒåŠ å…¥åˆ°ç©ºé—²çš„Pé“¾è¡¨ä¸­ï¼Œä¹Ÿä¿å­˜åœ¨å…¨å±€å˜é‡schedä¸­ï¼Œå½“Mè¢«å”¤é†’æ—¶ï¼Œå…¶æŒæœ‰çš„Pä¹Ÿä¼šé‡æ–°è¿›å…¥è¿è¡ŒçŠ¶æ€ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;GRQã€ç©ºé—²Mé“¾è¡¨ã€ç©ºé—²Pé“¾è¡¨ã€å¤ç”¨Gåˆ—è¡¨ç­‰éƒ½å­˜æ”¾åœ¨schedtç»“æ„ä½“ä¸­ï¼Œè¯¥ç»“æ„ä½“åœ¨æ•´ä¸ªgoç¨‹åºä¸­åªæœ‰ä¸€ä¸ªå®ä¾‹å¯¹è±¡ï¼Œæ˜¯ä¸€ä¸ªå…¨å±€å˜é‡ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;goä¸­è¿˜æœ‰ç‰¹æ®Šçš„Må’ŒG, å®ƒä»¬æ˜¯M0å’ŒG0.&lt;/p&gt;
&lt;p&gt;M0æ˜¯å¯åŠ¨ç¨‹åºåçš„ä¸»çº¿ç¨‹, è¿™ä¸ªMå¯¹åº”çš„å®ä¾‹ä¼šåœ¨å…¨å±€å˜é‡M0ä¸­, ä¸éœ€è¦åœ¨heapä¸Šåˆ†é…ï¼›&lt;/p&gt;
&lt;p&gt;M0è´Ÿè´£æ‰§è¡Œåˆå§‹åŒ–æ“ä½œå’Œå¯åŠ¨ç¬¬ä¸€ä¸ªGï¼Œ åœ¨ä¹‹åM0å°±å’Œå…¶ä»–çš„Mä¸€æ ·äº†ï¼›&lt;/p&gt;
&lt;p&gt;G0æ˜¯ä»…ç”¨äºè´Ÿè´£è°ƒåº¦çš„Gï¼ŒG0ä¸æŒ‡å‘ä»»ä½•å¯æ‰§è¡Œçš„å‡½æ•°ï¼Œ&lt;strong&gt;æ¯ä¸ªMéƒ½ä¼šæœ‰ä¸€ä¸ªè‡ªå·±çš„G0&lt;/strong&gt;ï¼›&lt;/p&gt;
&lt;p&gt;G0çš„æ ˆå¤§å°æ˜¯å›ºå®šçš„ï¼Œä¸º8MBï¼Œä¸èƒ½åŠ¨æ€ä¼¸ç¼©ï¼Œè€Œæ™®é€šGæ˜¯2KBï¼Œå¯åŠ¨æ€ä¼¸ç¼©ï¼›&lt;/p&gt;
&lt;p&gt;åœ¨è°ƒåº¦æˆ–ç³»ç»Ÿè°ƒç”¨æ—¶ä¼šä½¿ç”¨G0çš„æ ˆç©ºé—´, å…¨å±€å˜é‡çš„G0æ˜¯M0çš„G0ï¼Œå…¶ä»–Gçš„æ ˆæ‰©å®¹ä¹Ÿæ˜¯ç”±G0æ¥æ‰§è¡Œï¼›&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;gpmä¸‰è€…çš„å…³ç³»&#34;&gt;GPMä¸‰è€…çš„å…³ç³»&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;æŒæœ‰Pçš„Mä¼šæ‰§è¡ŒGï¼Œæ‰§è¡Œå®ŒGåä¼š&lt;strong&gt;å…ˆåˆ¤æ–­æ˜¯å¦æ»¡è¶³61æ¬¡è°ƒç”¨&lt;/strong&gt;ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™å…ˆä»GRQä¸­è·å–ï¼Œå¦åˆ™ç»§ç»­ä»Pçš„LRQä¸­ç»§ç»­è·å–Gè¿›è¡Œæ¶ˆè´¹ï¼›ä¹‹æ‰€ä»¥å…ˆæœ‰æ¬¡æ•°åˆ¤æ–­ï¼Œæ˜¯ä¸ºäº†&lt;strong&gt;é˜²æ­¢GRQé‡Œçš„Gè¢«é¥¿æ­»&lt;/strong&gt;ï¼›&lt;/p&gt;
&lt;p&gt;å½“å‘ç°Pçš„LRQä¸­æ²¡æœ‰å…¶ä»–Gå¯æ‰§è¡Œæ—¶ï¼Œåˆ™ä¼šä»&lt;strong&gt;GRQçš„é˜Ÿé¦–é‡Œè·å–G&lt;/strong&gt;æ”¾å…¥è‡ªå·±çš„LRQï¼Œè·å–æ•°é‡&lt;code&gt;n = min(len(GQ)/GOMAXPROCS + 1, len(GQ/2))&lt;/code&gt;ï¼Œä¸€æ¬¡ä¸ä¼šè·å–å¤ªå¤šï¼ˆä¸€æ¬¡ä¸è¶…è¿‡128ä¸ªï¼‰ï¼Œä¿è¯å…¶ä»–Måœ¨GRQä¸­æœ‰Gå¯æ‹¿ï¼Œ&lt;strong&gt;è·å–æ—¶ä¼šåŠ é”&lt;/strong&gt;ï¼›&lt;/p&gt;
&lt;p&gt;å½“På‘ç°è‡ªå·±çš„LRQã€GRQéƒ½æ²¡æœ‰Gäº†ï¼Œä¼šä»netpoller(ç½‘ç»œè½®è¯¢å™¨)ä¸Šè·å–Gæ¥æ‰§è¡Œï¼›&lt;/p&gt;
&lt;p&gt;å¦‚æœå½“å‰Pçš„LRQã€GRQã€netpollerä¸Šéƒ½æ²¡æœ‰Gæ—¶ï¼Œåˆ™ä¼šéšæœºä»&lt;strong&gt;å…¶ä»–Pçš„LRQé˜Ÿå°¾çªƒå–ä¸€åŠ+1ä¸ªçš„G&lt;/strong&gt;æ”¾åˆ°è‡ªå·±çš„LRQï¼Œé€šè¿‡CASè·å–Gï¼›ï¼ˆ&lt;strong&gt;work stealing å·¥ä½œçªƒå–&lt;/strong&gt;ï¼‰&lt;/p&gt;
&lt;p&gt;è·å–åˆ°çš„Géƒ½ä¼šå…ˆæ”¾åˆ°Pçš„runnexté˜Ÿåˆ—(è¯¥é˜Ÿåˆ—çš„é•¿åº¦æ˜¯1)ï¼Œç„¶åå†äº¤ç”±Mæ‰§è¡Œï¼›&lt;/p&gt;
&lt;p&gt;ä»¥ä¸Šè¿‡ç¨‹ç”±Mæ‰§è¡Œ runtime.schedule å‡½æ•°æ¥æ‰§è¡Œè°ƒåº¦ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å½“Pçš„LRQæ»¡æ—¶ï¼Œä¼šæŠŠå½“å‰Pçš„LRQå‰ä¸€åŠçš„Gæ‰“ä¹±é¡ºåºåè½¬ç§»åˆ°GRQ&lt;/strong&gt;ï¼›&lt;/p&gt;
&lt;p&gt;å¦‚æœæ­¤æ—¶runnextä¹Ÿæœ‰Gï¼Œåˆ™æ–°åˆ›å»ºçš„Gä¼šæ›¿æ¢runnextä¸­çš„Gï¼ŒåŸæ¥runnextä¸­çš„Gè·Ÿç€LRQä¸­æŒ‘å‡ºæ¥çš„é‚£äº›Gä¸€èµ·åŠ å…¥GRQï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å½“Pçš„LRQå’Œè°ƒåº¦å™¨çš„GRQéƒ½æ²¡æœ‰å¯æ‰§è¡Œçš„Gæ—¶ï¼ŒMè¿›å…¥è‡ªæ—‹çŠ¶æ€ï¼›&lt;/p&gt;
&lt;p&gt;Mè¿›å…¥è‡ªæ—‹ï¼Œæ˜¯ä¸ºäº†é¿å…é¢‘ç¹çš„ä¼‘çœ å’Œå”¤é†’äº§ç”Ÿå¤§é‡çš„å¼€é”€ï¼Œå½“å…¶ä»–Gå‡†å¤‡å°±ç»ªæ—¶ï¼Œé¦–å…ˆè¢«è°ƒåº¦åˆ°è‡ªæ—‹çš„Mä¸Šï¼Œå…¶æ¬¡æ‰æ˜¯å»åˆ›å»ºæ–°çš„Mï¼›&lt;/p&gt;
&lt;p&gt;è‡ªæ—‹åªä¼šæŒç»­ä¸€æ®µæ—¶é—´ï¼Œå¦‚æœè‡ªæ—‹æœŸé—´æ²¡æœ‰Géœ€è¦è°ƒåº¦ï¼Œåˆ™ä¹‹åä¼šè¿›å…¥ä¼‘çœ çŠ¶æ€ï¼ŒåŠ å…¥ç©ºé—²Mé“¾è¡¨ï¼Œç­‰å¾…è¢«å”¤é†’ï¼›&lt;/p&gt;
&lt;p&gt;Mè‡ªæ—‹æ—¶ä¼šè°ƒç”¨G0åç¨‹ï¼ŒG0åç¨‹ ä¸»è¦è´Ÿè´£è°ƒåº¦æ—¶åç¨‹çš„åˆ‡æ¢ï¼›&lt;/p&gt;
&lt;p&gt;Mæ˜¯å¦æ–°å»ºå–å†³äºæ­£åœ¨è‡ªæ—‹çš„Mæˆ–è€…ä¼‘çœ çš„Mçš„æ•°é‡ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å½“Mæ‰§è¡Œçš„Gå‘ç”Ÿé˜»å¡æ—¶ï¼Œå°†æŒ‚èµ·å½“å‰Må’ŒGï¼Œä»å½“å‰Pä¸­æ‘˜é™¤ï¼Œä»ç©ºé—²Mé“¾ä¸­å”¤é†’ä¸€ä¸ªMæœåŠ¡è¿™ä¸ªPï¼Œæ‰§è¡Œè¿™ä¸ªPçš„LRQä¸Šçš„å…¶ä»–Gï¼›ï¼ˆæŒ‚èµ·æ—¶ï¼ŒMçš„ç°åœºä¿¡æ¯ä¿å­˜åœ¨Gä¸Šï¼Œå¦‚æœGè¿˜æ²¡æ‰§è¡Œå®Œï¼ŒMä¹Ÿå¯ä»¥è¢«å¤ç”¨ï¼Œå†æ¬¡æ‰§è¡Œæ—¶ï¼Œå°±å¯ä»¥ä»Gä¸Šæ¢å¤Mçš„ç°åœºï¼Œç»§ç»­æ‰§è¡Œï¼‰&lt;/p&gt;
&lt;p&gt;å¦‚æœå½“å‰Pçš„LRQã€è°ƒåº¦å™¨çš„GRQä¸Šæ²¡æœ‰Gï¼Œåˆ™PåŠ å…¥ç©ºé—²Pé“¾è¡¨ï¼Œç­‰å¾…Mæ¥è·å–å¯ç”¨çš„Pï¼›&lt;/p&gt;
&lt;p&gt;é˜»å¡ç»“æŸåï¼Œè¯¥Må’ŒGä¼šå°è¯•æ‰¾å›åŸæ¥çš„Pï¼ˆæœ‰åˆ©äºæ•°æ®å±€éƒ¨æ€§ï¼‰ï¼Œå¦‚æœåŸæ¥çš„Pæ²¡ç©ºï¼Œåˆ™è·å–å…¶ä»–ç©ºé—²çš„Pï¼Œæ”¾å…¥å…¶LRQï¼Œç­‰å¾…æ‰§è¡Œï¼›å¦‚æœæ²¡æœ‰ç©ºé—²çš„Pï¼Œåˆ™Gæ”¾å…¥GRQï¼ŒMç»§ç»­ä¼‘çœ ï¼›ï¼ˆ&lt;strong&gt;hand offç­–ç•¥&lt;/strong&gt;ï¼‰&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Gè¢«è°ƒç”¨è¿è¡Œæ—¶ï¼Œä¼šå°è¯•å”¤é†’å…¶ä»–ç©ºé—²çš„Må’ŒPè¿›è¡Œç»„åˆï¼Œç”±äºMå’ŒPç”±äºåˆšè¢«å”¤é†’ï¼Œè¿›å…¥è‡ªæ—‹çŠ¶æ€ï¼ŒG0å‘ç°Pçš„LRQé˜Ÿåˆ—æ²¡æœ‰Gï¼Œåˆ™å…ˆå»GRQé‡Œè·å–ï¼Œå¦‚æœGRQé‡Œæ²¡æœ‰ï¼Œåˆ™å»å…¶ä»–Pçš„LRQé‡Œworking stealingï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;å¦‚æœæ˜¯ç½‘ç»œIO&lt;/strong&gt;ï¼Œæ¯”å¦‚é€šè¿‡netpollerè¿›è¡Œç½‘ç»œç³»ç»Ÿè°ƒç”¨ï¼Œè°ƒåº¦å™¨å¯ä»¥é˜²æ­¢Gåœ¨è¿›è¡Œè¿™äº›ç³»ç»Ÿè°ƒç”¨æ—¶é˜»å¡Mï¼Œä½¿å¾—Må¯ä»¥æ‰§è¡ŒPçš„LRQä¸­çš„å…¶ä»–Gï¼Œè€Œä¸éœ€è¦ä½¿ç”¨æ–°çš„Mï¼Œè¯¥Gåœ¨netpolleræ‰§è¡Œå®Œåï¼Œä¼šé‡æ–°å›åˆ°ä¹‹å‰Pçš„LRQä¸­ï¼ˆæˆ–è€…è¢«æ”¾åˆ°GRQï¼‰ï¼Œç­‰å¾…è°ƒç”¨ã€‚æ‰§è¡Œç½‘ç»œç³»ç»Ÿè°ƒç”¨ä¸éœ€è¦é¢å¤–çš„Mï¼Œnetpollerä½¿ç”¨ç³»ç»Ÿçº¿ç¨‹æ—¶åˆ»å¤„ç†ä¸€ä¸ªæœ‰æ•ˆçš„äº‹ä»¶å¾ªç¯ï¼ˆé€šè¿‡linuxä¸Šçš„epollå®ç°ï¼Œç½‘ç»œç›¸å…³fdä¸Gç»‘å®šï¼‰ï¼Œå³åœ¨è¿™ç§åœºæ™¯ä¸‹ï¼ŒGä¼šå’ŒMã€Påˆ†ç¦»ï¼ŒGæŒ‚åœ¨äº†netpollerä¸‹ã€‚ï¼ˆ&lt;strong&gt;ç½‘ç»œè°ƒç”¨å¯¼è‡´Gé˜»å¡ï¼Œä¼šç”±netpolleræ¥ç®¡ï¼ŒMä¸é˜»å¡ï¼Œæ­¤æ—¶Må¯ä»¥ç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ªG&lt;/strong&gt;ï¼‰&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å¦‚æœæ˜¯ç³»ç»Ÿè°ƒç”¨&lt;/strong&gt;ï¼Œå¦‚è¯»å–æ–‡ä»¶å¯¼è‡´Gè¢«é˜»å¡ï¼Œæ­¤æ—¶ä¸å…³netpollerä»€ä¹ˆäº‹ï¼Œè¿™ç§é˜»å¡ä½¿å¾—Gé˜»å¡Mï¼Œè°ƒåº¦å™¨ä¼šä½¿å¾—GMä¸Påˆ†ç¦»ï¼Œè€ŒPä½¿ç”¨æ–°çš„Mç»§ç»­æ‰§è¡Œã€‚ï¼ˆ&lt;strong&gt;Gé˜»å¡å¯¼è‡´Mé˜»å¡ï¼ŒPå¯»æ‰¾æ–°Mæ¥æ‰§è¡ŒG&lt;/strong&gt;ï¼‰&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å¦‚æœæ˜¯channelã€syncåŒ…ä¸­çš„æ–¹æ³•ã€time.Sleep&lt;/strong&gt;ï¼Œæ¯”å¦‚è®©Gæ‰§è¡Œä¸€ä¸ªsleepã€åŸå­æ“ä½œã€é”æˆ–è€…chanæ“ä½œï¼Œå¯¼è‡´Mè¢«é˜»å¡ï¼Œåˆ™ç”±sysmonç›‘æ§çº¿ç¨‹æ¥ç›‘æ§é‚£äº›é•¿æ—¶é—´è¿è¡Œçš„Gï¼Œç„¶åè®¾ç½®å¯ä»¥æŠ¢å çš„æ ‡è¯†ç¬¦ï¼Œåˆ«çš„Gå°±å¯ä»¥æŠ¢å æ¥æ‰§è¡Œã€‚ï¼ˆ&lt;strong&gt;é˜»å¡çš„Gè¢«åˆ‡æ¢å‡ºå»ï¼ŒMä¸é˜»å¡ï¼Œè½¬è€Œæ‰§è¡Œå…¶ä»–ç©ºé—²çš„G&lt;/strong&gt;ï¼‰&lt;/p&gt;
&lt;p&gt;è¿™äº›ä¸åŒç±»å‹é˜»å¡çš„Géƒ½æ˜¯ç”±sysmonæ¥è°ƒåº¦çš„ã€‚&lt;/p&gt;
&lt;p&gt;è¿™é‡Œæœ‰ä¸€ä¸ªæœ‰è¶£çš„ä¾‹å­&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;runtime&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;GOMAXPROCS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;10&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;
        &lt;span class=&#34;k&#34;&gt;go&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
            &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
        &lt;span class=&#34;p&#34;&gt;}()&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

    &lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ch&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;make&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;chan&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ch&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;// è¾“å‡ºçš„æ•°æ˜¯ 9ã€0ã€1ã€2ã€3ã€4ã€5ã€6ã€7ã€8
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;åŸå› æ˜¯æ­¤æ—¶P&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ï¼Œ&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ä¸”åªæœ‰10ä¸ªG&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ï¼Œ&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ä¸æ¶‰åŠGRQ&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ï¼Œ&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;forå¾ªç¯ä¸­äº§ç”Ÿçš„åç¨‹éƒ½ä¼šè¿›åˆ°è¿™ä¸ªpé‡Œ&lt;/span&gt;
&lt;span class=&#34;nx&#34;&gt;ç”±äºæ­¤æ—¶è¿˜æ²¡å‘ç”Ÿè°ƒåº¦&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ï¼Œ&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;æ¯æ¬¡æ–°äº§ç”Ÿçš„åç¨‹éƒ½ä¼šè¢«MæŒæœ‰&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ï¼Œ&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;è¿™æ—¶å°±ä¼šæŠŠè€çš„åç¨‹æ”¾åˆ°pçš„LRQä¸­&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ï¼Œ&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;å½“i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;9&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;æ—¶&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ï¼Œ&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;MæŒæœ‰i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;9&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;çš„åç¨‹&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ï¼Œ&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;æ­¤æ—¶pçš„LRQé˜Ÿåˆ—å› ä¸ºå…ˆè¿›å…ˆå‡ºçš„ç¼˜æ•…&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ï¼Œ&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;æŒæœ‰çš„åç¨‹é¡ºåºæ˜¯0&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ï¼Œ&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ï¼Œ&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ï¼Œ&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ï¼Œ&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ï¼Œ&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ï¼Œ&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;6&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ï¼Œ&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;7&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ï¼Œ&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;8&lt;/span&gt;
&lt;span class=&#34;nx&#34;&gt;æ­¤æ—¶æ‰§è¡Œåˆ°è¯»chançš„è¯­å¥&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ï¼Œ&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;è°ƒåº¦å‘ç”Ÿ&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ï¼Œ&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;main&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;goroutineæŒ‚èµ·&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ï¼Œ&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;mè¿è¡ŒæŒæœ‰çš„åç¨‹i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;9&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ï¼Œ&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ä¹‹åç»§ç»­æ¶ˆè´¹LRQé‡Œçš„åç¨‹&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ï¼Œ&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;å› æ­¤è¾“å‡ºé¡ºåºæ˜¯&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;9&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ã€&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ã€&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ã€&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ã€&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ã€&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ã€&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ã€&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;6&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ã€&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;7&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ã€&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;8&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id=&#34;è°ƒåº¦è¿‡ç¨‹ä¸­å­˜åœ¨çš„é˜»å¡&#34;&gt;è°ƒåº¦è¿‡ç¨‹ä¸­å­˜åœ¨çš„é˜»å¡&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;ç½‘ç»œIOï¼ˆMå¯ä»¥æ‰§è¡Œå…¶ä»–Gï¼‰&lt;/li&gt;
&lt;li&gt;ç³»ç»Ÿè°ƒç”¨syscallï¼ˆMä¸Gç»‘å®šé˜»å¡ï¼Œé‡Šæ”¾Pï¼Œæ­¤æ—¶Mæ— æ³•æ‰§è¡Œå…¶ä»–Gï¼‰&lt;/li&gt;
&lt;li&gt;channelï¼Œselectï¼Œé”ç­‰å¾…ï¼ˆMå¯ä»¥æ‰§è¡Œå…¶ä»–Gï¼‰&lt;/li&gt;
&lt;li&gt;runtime.Gosched()è¿è¡Œæ—¶è°ƒåº¦&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;è°ƒåº¦å™¨çš„ç­–ç•¥&#34;&gt;è°ƒåº¦å™¨çš„ç­–ç•¥&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;å¤ç”¨çº¿ç¨‹ï¼Œé¿å…çº¿ç¨‹é¢‘ç¹çš„åˆ›å»ºå’Œé”€æ¯ï¼Œä½¿ç”¨work stealingæœºåˆ¶å’Œhand offæœºåˆ¶&lt;/li&gt;
&lt;li&gt;å¹¶è¡Œï¼š&lt;code&gt;GOMAXPROCS&lt;/code&gt;è®¾ç½®Pçš„æ•°é‡ï¼Œæœ€å¤šæœ‰&lt;code&gt;GOMAXPROCS&lt;/code&gt;ä¸ªçº¿ç¨‹åœ¨CPUä¸ŠåŒæ—¶è¿è¡Œæˆ–è‡ªæ—‹&lt;/li&gt;
&lt;li&gt;æŠ¢å ï¼šä¸€ä¸ªGæœ€å¤šè¿è¡Œ10msï¼Œè¿˜æœ‰sysmonåç¨‹ååŠ©å¼æŠ¢å ï¼Œé˜²æ­¢å…¶ä»–Gè¢«é¥¿æ­»&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;è°ƒåº¦æŠ¢å çš„æ—¶æœº&#34;&gt;è°ƒåº¦(æŠ¢å )çš„æ—¶æœº&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;goè°ƒåº¦å™¨ï¼Œæœ¬è´¨æ˜¯ä¸ºéœ€è¦æ‰§è¡Œçš„Gå¯»æ‰¾Mä»¥åŠPï¼Œä¸æ˜¯ä¸€ä¸ªå®ä½“ï¼Œè°ƒåº¦æ˜¯éœ€è¦å‘ç”Ÿè°ƒåº¦æ—¶ç”±Mæ‰§è¡Œ&lt;code&gt;runtime.scheduleå‡½æ•°&lt;/code&gt;è¿›è¡Œï¼›&lt;/li&gt;
&lt;li&gt;å‡½æ•°è°ƒç”¨æœŸé—´ï¼Œå¦‚Géœ€è¦æ ˆæ‰©å®¹ï¼Œå°±ä¼šè°ƒåº¦å¦ä¸€ä¸ªG&lt;/li&gt;
&lt;li&gt;è°ƒåº¦å™¨åˆå§‹åŒ–æ—¶ï¼Œä¼šä¾æ¬¡è°ƒç”¨mcommoninitï¼šåˆå§‹åŒ–Mèµ„æºæ± ã€procresizeï¼šåˆå§‹åŒ–Pèµ„æºæ± ã€newprocï¼šGçš„è¿è¡Œç°åœºå’Œè°ƒåº¦é˜Ÿåˆ—ï¼›&lt;/li&gt;
&lt;li&gt;channelã€mutexç­‰syncæ“ä½œå‘ç”Ÿåç¨‹é˜»å¡ï¼›&lt;/li&gt;
&lt;li&gt;time.sleepï¼Œgo1.13ä»¥å‰çš„ç‰ˆæœ¬ï¼Œä¼šåˆ›å»ºä¸€ä¸ªgoroutineï¼Œä¸“é—¨ç”¨æ¥å”¤é†’æŒ‚è½½timerä¸Šçš„æ—¶é—´æœªåˆ°æœŸçš„goroutineï¼Œä½†åœ¨1.14ä¹‹åä¸ä¼šåˆ›å»ºgoroutineæ¥åšè¿™ä»¶äº‹ï¼Œè€Œæ˜¯åœ¨è°ƒåº¦å¾ªç¯çš„å„ä¸ªåœ°æ–¹ã€sysmonä¸­éƒ½æœ‰å”¤é†’timerçš„ä»£ç ï¼Œä½¿å¾—timerçš„å”¤é†’æ›´åŠ åŠæ—¶ï¼›&lt;/li&gt;
&lt;li&gt;IO&lt;/li&gt;
&lt;li&gt;GCï¼Œå¦‚STWæœŸé—´ã€Pä¸Šæ‰§è¡Œsafe pointã€GCæ ˆæ‰«æï¼›&lt;/li&gt;
&lt;li&gt;sysmonåå°ç›‘æ§ï¼Œå½“Gè¿è¡Œè¿‡ä¹…æ—¶ä¼šè§¦å‘ï¼Œæ¯”å¦‚Gæ¯æ¬¡åªæ‰§è¡Œ10msï¼Œæˆ–ç³»ç»Ÿè°ƒåº¦è¿‡ä¹…ï¼Œæ­¤æ—¶ä¼šæŠŠGæ”¾åˆ°GRQï¼›&lt;/li&gt;
&lt;li&gt;panicå´©æºƒæœŸé—´ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;è°ƒåº¦å™¨çš„ç”Ÿå‘½å‘¨æœŸ&#34;&gt;è°ƒåº¦å™¨çš„ç”Ÿå‘½å‘¨æœŸ&lt;/h2&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/go_%e8%b0%83%e5%ba%a6%e5%99%a8%e7%9a%84%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/go_%e8%b0%83%e5%ba%a6%e5%99%a8%e7%9a%84%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			alt=&#34;goè°ƒåº¦å™¨çš„ç”Ÿå‘½å‘¨æœŸ&#34;&gt;
	&lt;/a&gt;
	
	&lt;figcaption&gt;goè°ƒåº¦å™¨çš„ç”Ÿå‘½å‘¨æœŸ&lt;/figcaption&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;h2 id=&#34;æ€»çš„è°ƒåº¦æµç¨‹&#34;&gt;æ€»çš„è°ƒåº¦æµç¨‹&lt;/h2&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/GMP%e6%a8%a1%e5%9e%8b%e6%95%b4%e4%bd%93%e8%b0%83%e5%ba%a6.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/GMP%e6%a8%a1%e5%9e%8b%e6%95%b4%e4%bd%93%e8%b0%83%e5%ba%a6.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			alt=&#34;goroutine schedule&#34;&gt;
	&lt;/a&gt;
	
	&lt;figcaption&gt;goroutine schedule&lt;/figcaption&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;5.1 å½“Mæ‰§è¡ŒæŸä¸ªGæ—¶å‘ç”Ÿsyscallæˆ–å…¶ä»–é˜»å¡æ“ä½œï¼ŒMä¼šé˜»å¡ï¼Œå¦‚æœå½“å‰æœ‰ä¸€äº›Gåœ¨æ‰§è¡Œï¼Œruntimeä¼šæŠŠè¿™ä¸ªçº¿ç¨‹Mä»Pä¸­æ‘˜é™¤ï¼Œç„¶åå†åˆ›å»ºä¸€ä¸ªæ–°çš„Mï¼ˆæ“ä½œç³»ç»Ÿçº¿ç¨‹æˆ–è€…å¤ç”¨å…¶ä»–ç©ºé—²çº¿ç¨‹ï¼‰æ¥æœåŠ¡è¿™ä¸ªPï¼Œå³æ­¤æ—¶çš„Mä¼šç›´æ¥ç®¡ç†é˜»å¡çš„Gï¼Œä¹‹å‰è·Ÿå®ƒç»‘å®šçš„Pè½¬ç§»åˆ°å…¶ä»–Mï¼Œæ‰§è¡Œå…¶ä»–Gã€‚&lt;/p&gt;
&lt;p&gt;å½“åŸé˜»å¡çš„Mç³»ç»Ÿè°ƒç”¨æˆ–é˜»å¡ç»“æŸæ—¶ï¼Œå…¶ç»‘å®šçš„è¿™ä¸ªGè¦ç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œä¼šä¼˜å…ˆå°è¯•è·å–ä¹‹å‰çš„Pï¼Œè‹¥ä¹‹å‰çš„På·²ç»è·Ÿå…¶ä»–Mç»‘å®šï¼Œåˆ™å°è¯•ä»ç©ºé—²çš„Pé“¾è¡¨è·å–Pï¼Œå°†Gæ”¾å…¥è¿™ä¸ªPçš„æœ¬åœ°é˜Ÿåˆ—ï¼Œç»§ç»­æ‰§è¡Œã€‚å¦‚æœè·å–ä¸åˆ°Pï¼Œåˆ™è¯¥Mè¿›å…¥ä¼‘çœ ï¼ŒåŠ å…¥ä¼‘çœ é˜Ÿåˆ—ï¼ŒGåˆ™æ”¾å…¥å…¨å±€é˜Ÿåˆ—ï¼Œç­‰å…¶ä»–Pæ¶ˆè´¹å®ƒã€‚&lt;/p&gt;
&lt;h2 id=&#34;sysmonåç¨‹&#34;&gt;sysmonåç¨‹&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;åˆ‡æ¢Må’ŒGçš„æ“ä½œç”±sysmonåç¨‹è¿›è¡Œå¤„ç†ï¼Œå³sysmonåç¨‹è¿›è¡Œåä½œå¼æŠ¢å &lt;/strong&gt;ï¼Œå¯¹goroutineè¿›è¡Œæ ‡è®°ï¼Œæ‰§è¡Œgoroutineæ—¶å¦‚æœæœ‰æ ‡è®°å°±ä¼šè®©å‡ºCPUï¼Œå¯¹äºsyscallè¿‡ä¹…çš„Pï¼Œä¼šè¿›è¡ŒMå’ŒPçš„åˆ†é…ï¼Œé˜²æ­¢Pè¢«å ç”¨è¿‡ä¹…å½±å“è°ƒåº¦ã€‚&lt;/p&gt;
&lt;p&gt;sysmonåç¨‹è¿è¡Œåœ¨Mä¸Šï¼Œä¸”ä¸éœ€è¦Pï¼Œå®ƒä¼šæ¯éš”ä¸€æ®µæ—¶é—´æ£€æŸ¥runtimeï¼Œç¡®ä¿æ²¡æœ‰å‡ºç°å¼‚å¸¸çŠ¶æ€ï¼Œä¹Ÿä¼šè§¦å‘è°ƒåº¦ã€GCã€æ£€æŸ¥æ­»é”ã€è·å–ä¸‹ä¸€ä¸ªéœ€è¦è¢«è§¦å‘çš„è®¡æ—¶å™¨ã€å®šæ—¶ä»netpollä¸­è·å–readyçš„Gã€æ‰“å°è°ƒåº¦å’Œå†…å­˜ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/go_sysmon_goroutine.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/go_sysmon_goroutine.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			alt=&#34;go sysmon goroutine&#34;&gt;
	&lt;/a&gt;
	
	&lt;figcaption&gt;go sysmon goroutine&lt;/figcaption&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;h2 id=&#34;mmachine&#34;&gt;Mï¼šMachine&lt;/h2&gt;
&lt;p&gt;Mæœ¬è´¨æ˜¯ä¸€ä¸ªå¾ªç¯è°ƒåº¦ï¼Œä¸æ–­çš„æ‰§è¡Œscheduleå‡½æ•°ï¼ŒæŸ¥æ‰¾å¯è¿è¡Œçš„Gã€‚ä¼šåœ¨è‡ªæ—‹ä¸ä¼‘çœ çš„çŠ¶æ€é—´è½¬æ¢ã€‚&lt;/p&gt;
&lt;p&gt;æ²¡æœ‰çŠ¶æ€æ ‡è®°ï¼Œåªæ˜¯ä¼šå¤„äºä»¥ä¸‹å‡ ä¸ªåœºæ™¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è‡ªæ—‹ï¼šMæ­£åœ¨ä»LRQä¸­è·å–Gï¼Œæ­¤æ—¶Mä¼šæ‹¥æœ‰ä¸€ä¸ªP&lt;/li&gt;
&lt;li&gt;æ‹¥æœ‰ä¸€ä¸ªPï¼Œæ‰§è¡ŒGä¸­çš„ä»£ç &lt;/li&gt;
&lt;li&gt;è¿›è¡Œç³»ç»Ÿè°ƒç”¨æˆ–è€…Gçš„é˜»å¡æ“ä½œï¼Œæ­¤æ—¶Mä¼šé‡Šæ”¾P&lt;/li&gt;
&lt;li&gt;ä¼‘çœ ï¼Œæ— Gå¯æ‰§è¡Œï¼Œä¸æ‹¥æœ‰Pï¼Œæ­¤æ—¶å­˜åœ¨ç©ºé—²çº¿ç¨‹é˜Ÿåˆ—&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;ggoroutineçš„çŠ¶æ€&#34;&gt;Gï¼šGoroutineçš„çŠ¶æ€&lt;/h2&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/go_goroutine_state.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/go_goroutine_state.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			alt=&#34;go goroutine state&#34;&gt;
	&lt;/a&gt;
	
	&lt;figcaption&gt;go goroutine state&lt;/figcaption&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;goroutineçš„çŠ¶æ€ä¸æ­¢ä»¥ä¸‹å‡ ç§ï¼Œåªæ˜¯è¿™å‡ ç§æ¯”è¾ƒå¸¸ç”¨&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;GçŠ¶æ€&lt;/th&gt;
&lt;th&gt;å€¼&lt;/th&gt;
&lt;th&gt;è¯´æ˜&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;_Gidle&lt;/td&gt;
&lt;td&gt;0&lt;/td&gt;
&lt;td&gt;åˆšåˆšè¢«åˆ†é…ï¼Œè¿˜æ²¡è¢«åˆå§‹åŒ–&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;_Grunnable&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;è¡¨ç¤ºåœ¨runqueueä¸Šï¼Œå³LRQï¼Œè¿˜æ²¡æœ‰è¢«æ‰§è¡Œï¼Œæ­¤æ—¶çš„Gæ‰èƒ½è¢«Mæ‰§è¡Œï¼Œè¿›å…¥GrunningçŠ¶æ€&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;_Grunning&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;æ‰§è¡Œä¸­ï¼Œä¸åœ¨runqueueä¸Šï¼Œä¸Mã€Pç»‘å®š&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;_Gsyscall&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;3&lt;/td&gt;
&lt;td&gt;åœ¨æ‰§è¡Œç³»ç»Ÿè°ƒç”¨ï¼Œæ²¡æœ‰æ‰§è¡Œgoä»£ç ï¼Œæ²¡åœ¨runqueueä¸Šï¼Œåªä¸Mç»‘å®šï¼Œæ­¤æ—¶Pè½¬ç§»åˆ°å…¶ä»–Mä¸­&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;_Gwaiting&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;è¢«é˜»å¡ï¼ˆå¦‚IOã€GCã€chané˜»å¡ã€é”ï¼‰ä¸åœ¨runqueueï¼Œä½†ä¸€å®šåœ¨æŸä¸ªåœ°æ–¹ï¼Œæ¯”å¦‚channelä¸­ï¼Œé”æ’é˜Ÿä¸­ç­‰&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;_Gdead&lt;/td&gt;
&lt;td&gt;6&lt;/td&gt;
&lt;td&gt;ç°åœ¨æ²¡æœ‰åœ¨ä½¿ç”¨ï¼Œä¹Ÿè®¸æ‰§è¡Œå®Œï¼Œæˆ–è€…åœ¨free listä¸­ï¼Œæˆ–è€…æ­£åœ¨è¢«åˆå§‹åŒ–ï¼Œå¯èƒ½æœ‰stack&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;_Gcopystack&lt;/td&gt;
&lt;td&gt;8&lt;/td&gt;
&lt;td&gt;æ ˆæ­£åœ¨å¤åˆ¶ï¼Œæ­¤æ—¶æ²¡æœ‰goä»£ç ï¼Œä¹Ÿä¸åœ¨runqueueä¸Šï¼ŒGæ­£åœ¨è·å–ä¸€ä¸ªæ–°çš„æ ˆçš„ç©ºé—´ï¼Œå¹¶æŠŠåŸæ¥çš„å†…å®¹å¤åˆ¶è¿‡å»ï¼Œé˜²æ­¢GCæ‰«æ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;_Gscan&lt;/td&gt;
&lt;td&gt;0x1000&lt;/td&gt;
&lt;td&gt;ä¸runnableã€runningã€syscallã€waitingç­‰çŠ¶æ€ç»“åˆï¼Œè¡¨ç¤ºGCæ­£åœ¨æ‰«æè¿™ä¸ªGçš„æ ˆ&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id=&#34;pprocessorçš„çŠ¶æ€&#34;&gt;Pï¼šProcessorçš„çŠ¶æ€&lt;/h2&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/go_processor_state.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/go_processor_state.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			alt=&#34;go processor state&#34;&gt;
	&lt;/a&gt;
	
	&lt;figcaption&gt;go processor state&lt;/figcaption&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;çŠ¶æ€&lt;/th&gt;
&lt;th&gt;æè¿°&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;_Pidle&lt;/td&gt;
&lt;td&gt;ç©ºé—²ï¼Œæ— å¯è¿è¡Œçš„Gï¼Œè¿™æ—¶Mæ‹¥æœ‰çš„Pä¼šåŠ å…¥ç©ºé—²Pé˜Ÿåˆ—ä¸­ï¼ŒLRQä¸ºç©º&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;_Prunning&lt;/td&gt;
&lt;td&gt;è¢«çº¿ç¨‹ M æŒæœ‰ï¼Œå¹¶ä¸”æ­£åœ¨æ‰§è¡ŒGæˆ–è€…G0ï¼ˆå³ç”¨æˆ·ä»£ç æˆ–è€…è°ƒåº¦å™¨é€»è¾‘ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;_Psyscall&lt;/td&gt;
&lt;td&gt;ç”¨æˆ·ä»£ç è§¦å‘äº†ç³»ç»Ÿè°ƒç”¨ï¼Œæ­¤æ—¶Pæ²¡æœ‰æ‰§è¡Œç”¨æˆ·ä»£ç &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;_Pgcstop&lt;/td&gt;
&lt;td&gt;è¢«çº¿ç¨‹ M æŒæœ‰ï¼Œä¸”å› gcè§¦å‘äº†STWè€Œåœæ­¢&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;_Pdead&lt;/td&gt;
&lt;td&gt;å½“è¿è¡Œæ—¶æ”¹å˜äº†Pçš„æ•°é‡æ—¶ï¼Œå¤šä½™çš„Pä¼šå˜æˆæ­¤çŠ¶æ€&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id=&#34;æ³„éœ²ä¸æ’æŸ¥&#34;&gt;æ³„éœ²ä¸æ’æŸ¥&lt;/h2&gt;
&lt;p&gt;goroutineçš„æ³„éœ²ä¸€èˆ¬ä¼šå¯¼è‡´å†…å­˜çš„æ³„éœ²ï¼Œæœ€ç»ˆå¯¼è‡´OOMï¼ŒåŸå› ä¸€èˆ¬æ˜¯è¯¥è¿è¡Œå®Œæˆçš„goroutineä¸€ç›´åœ¨è¿è¡Œï¼Œæ²¡æœ‰ç»“æŸï¼Œå¯èƒ½çš„åŸå› æ˜¯goroutineå†…é˜»å¡ï¼Œæ­»å¾ªç¯ã€‚&lt;/p&gt;
&lt;p&gt;æ£€æŸ¥å·¥å…·ï¼špprofï¼Œè¯·æ±‚&lt;code&gt;/debug/pprof/goroutineæ¥å£æˆ–è€…heapæ¥å£&lt;/code&gt;ï¼Œåˆ¤æ–­å†…å­˜å ç”¨èµ°åŠ¿ï¼Œåˆ†æå†…å­˜ä½¿ç”¨æƒ…å†µã€‚ä¸€èˆ¬çš„èµ°åŠ¿æ˜¯æ•´ä½“å‘ä¸Šé€’å¢ï¼Œä¼´éšä¸€ä¸ªä¸€ä¸ªçš„å³°è°·ã€‚&lt;/p&gt;
&lt;h1 id=&#34;å†…å­˜æ¨¡å‹&#34;&gt;å†…å­˜æ¨¡å‹&lt;/h1&gt;
&lt;p&gt;å½“ç¨‹åºå¼€å§‹å¯åŠ¨ï¼Œruntimeçš„é¡µåˆ†é…å™¨å‘æ“ä½œç³»ç»Ÿç”³è¯·å†…å­˜ï¼Œå¹¶é¢„ç•™å†…å­˜é©»ç•™åœ¨runtimeä¸­ï¼Œä¸€æ—¦ç”¨æˆ·ç¨‹åºéœ€è¦è¿›è¡Œå†…å­˜åˆ†é…ï¼Œå°±å¯ä»¥ä»runtimeçš„å¯¹è±¡åˆ†é…å™¨åˆ†é…æ–°çš„å†…å­˜è¿›è¡Œä½¿ç”¨ï¼›å½“ç”¨æˆ·ç¨‹åºä¸åœ¨ä½¿ç”¨è¿™äº›æ‰€ç”³è¯·çš„å†…å­˜åï¼Œruntimeçš„åƒåœ¾å›æ”¶å™¨å°†è¿™äº›å†…å­˜è¿›è¡Œæ ‡è®°ï¼Œå¹¶é‡æ–°åœ¨runtimeè¿›è¡Œç®¡ç†å’Œå†åˆ†é…ï¼›å¯¹äºæŸäº›é•¿æœŸä¸å†ä½¿ç”¨çš„å†…å­˜ï¼Œæ‹¾è’å™¨ä¼šè´Ÿè´£å°†è¿™éƒ¨åˆ†å†…å­˜å½’è¿˜ç»™æ“ä½œç³»ç»Ÿï¼Œå‡è½»æ•´ä¸ªåº”ç”¨ç¨‹åºçš„æ€»å†…å­˜æ¶ˆè€—ã€‚&lt;/p&gt;
&lt;p&gt;Goçš„runtimeå°±æ˜¯ä¼ ç»Ÿæ„ä¹‰ä¸Šçš„æ ˆï¼Œä¸å¼€æ”¾ç»™ç”¨æˆ·æ€ä»£ç ï¼›è€Œä¼ ç»Ÿæ„ä¹‰ä¸Šçš„å †ï¼Œè¢«Goçš„runtimeåˆ’åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼šä¸€ä¸ªæ˜¯Go runtimeè‡ªèº«æ‰€éœ€çš„å †å†…å­˜ï¼ˆä¹Ÿæ˜¯å †å¤–å†…å­˜ï¼Œä¾‹å¦‚mheapã€mcentralã€mcacheï¼‰ï¼Œå¦ä¸€éƒ¨åˆ†ç”¨äºGoç”¨æˆ·æ€æ‰€ä½¿ç”¨çš„å †å†…å­˜ï¼Œä¹Ÿå«Goå †ï¼ŒGoå †è´Ÿè´£ç”¨æˆ·æ€å¯¹è±¡çš„å­˜æ”¾ï¼Œä»¥åŠgoroutineçš„æ‰§è¡Œæ ˆã€‚&lt;/p&gt;
&lt;p&gt;Go çš„å†…å­˜åˆ†é…å™¨åŸºäºtcmallocçš„å†…å­˜åˆ†é…ç®—æ³•ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¸¦å†…å­˜æ± çš„åˆ†é…å™¨ï¼Œåº•å±‚ç›´æ¥è°ƒç”¨æ“ä½œç³»ç»Ÿçš„mmapå‡½æ•°å®ç°å†…å­˜åˆ†é…ï¼Œå‡å°‘å†…å­˜ç¢ç‰‡ï¼Œæå‡å†…å­˜åˆ©ç”¨ç‡ã€‚tcmallocçš„æ ¸å¿ƒæ€æƒ³æ˜¯ä¸ºæ¯ä¸ªçº¿ç¨‹å®ç°ä¸€ä¸ªçº¿ç¨‹å±€éƒ¨ç¼“å­˜ï¼Œå¹¶åŒæ—¶åŒºåˆ†äº†å°å¯¹è±¡ï¼ˆå°äº32KBï¼‰å’Œå¤§å¯¹è±¡åˆ†é…ä¸¤ç§ç±»å‹ï¼Œç®¡ç†çš„å†…å­˜å•å…ƒæ˜¯è·¨åº¦ï¼Œå¯¹åº”goé‡Œçš„mspanã€‚&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥Goçš„åˆ†é…æ€è·¯æ˜¯ï¼Œruntimeä¸ºæ¯ä¸ªç³»ç»Ÿçº¿ç¨‹åˆ†é…ä¸€ä¸ªæœ¬åœ°çš„mcacheï¼Œå°‘é‡çš„å†…å­˜åˆ†é…å°±ç›´æ¥ä»mcacheä¸­åˆ†é…ï¼Œå¹¶ä¸”å®šæœŸåšåƒåœ¾å›æ”¶ï¼Œå°†çº¿ç¨‹çš„mcacheä¸­çš„ç©ºé—²å†…å­˜è¿”å›ç»™å…¨å±€æ§åˆ¶å †ï¼›å½“çº¿ç¨‹çš„æœ¬åœ°mcacheä¸å¤Ÿç”¨æ—¶ï¼Œå°±å‘å †ä¸­ç”³è¯·ã€‚&lt;/p&gt;
&lt;p&gt;å†…å­˜æµªè´¹æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯å†…å­˜å¯¹é½äº§ç”Ÿçš„æµªè´¹ï¼Œä¸€ç§æ˜¯æ¯æ¬¡éœ€è¦åˆ†é…å†…å­˜æ—¶ï¼Œæ¯ä¸ªå¤§å°ç­‰çº§éƒ½è®¾è®¡äº†è‡ªå·±çš„é¡µæ•°ï¼Œå½“éœ€è¦è¯¥å¤§å°ç­‰çº§çš„æ–°å¯¹è±¡æ—¶ï¼Œä¼šé€‰æ‹©ç»™å®šå¤§å°æœ€å¤š12.5%çš„æµªè´¹ã€‚&lt;/p&gt;
&lt;p&gt;åŸºäºè¿™ä¸¤ç§æµªè´¹çš„æ§åˆ¶ï¼Œè®¾è®¡äº†å¤§çº¦67ç§å†…å­˜å—ç±»åˆ«ï¼Œæ¯ä¸€ç±»åˆ«éƒ½æœ‰è‡ªå·±å¯¹è±¡çš„ç©ºé—²é“¾è¡¨ã€‚å°äº32Kçš„å†…å­˜åˆ†é…è¢«å‘ä¸Šå–æ•´åˆ°å¯¹åº”çš„å°ºå¯¸ç±»åˆ«ï¼Œä»ç›¸åº”çš„ç©ºé—²é“¾è¡¨ä¸­åˆ†é…ã€‚ä¸€é¡µå†…å­˜åªå¯ä»¥è¢«åˆ†è£‚æˆåŒä¸€ç§å°ºå¯¸ç±»åˆ«çš„å¯¹è±¡ï¼Œç„¶åç”±ç©ºé—²é“¾è¡¨åˆ†é…å™¨ç®¡ç†ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/go_%e5%88%86%e9%85%8d%e5%99%a8%e7%bb%93%e6%9e%84.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/go_%e5%88%86%e9%85%8d%e5%99%a8%e7%bb%93%e6%9e%84.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;Goå†…å­˜ç®¡ç†å¯ä»¥çœ‹æˆä¸€ä¸ªä¸¤çº§çš„å†…å­˜ç®¡ç†ç»“æ„ï¼Œmheapå’Œmcacheã€‚ä¸Šé¢ä¸€çº§ç®¡ç†çš„åŸºæœ¬å•ä½æ˜¯é¡µï¼Œç”¨äºåˆ†é…å¤§å¯¹è±¡ï¼Œæ¯æ¬¡åˆ†é…éƒ½æ˜¯è‹¥å¹²è¿ç»­çš„é¡µï¼Œä¹Ÿå°±æ˜¯è‹¥å¹²ä¸ª4KBçš„å¤§å°ï¼Œä½¿ç”¨çš„æ•°æ®ç»“æ„æ˜¯mheapå’Œmspanï¼Œç”¨BestFitç®—æ³•åšåˆ†é…ï¼Œç”¨ä½ç¤ºå›¾åšå›æ”¶ã€‚ä¸‹é¢ä¸€çº§ç®¡ç†çš„åŸºæœ¬å•ä½æ˜¯ä¸åŒç±»å‹çš„å›ºå®šå¤§å°çš„å¯¹è±¡ï¼Œæ›´åƒä¸€ä¸ªå¯¹è±¡æ± è€Œä¸æ˜¯å†…å­˜æ± ï¼Œç”¨å¼•ç”¨è®¡æ•°åšå›æ”¶ï¼Œä½¿ç”¨çš„æ•°æ®ç»“æ„æ˜¯mcacheã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;mspanï¼šæ˜¯mheapç®¡ç†å†…å­˜æœ€åŸºæœ¬çš„ç»“æ„ï¼Œç”±ä¸€è¿ä¸²çš„é¡µ(è¿ç»­8KB)ç»„æˆçš„åŒå‘é“¾è¡¨ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä¿å­˜èµ·å§‹é¡µåœ°å€ï¼Œspanå¤§å°ï¼Œspanä¸­é¡µçš„æ•°é‡ï¼Œæ˜¯Goå †å†…å­˜å•å…ƒçš„åŸºæœ¬å¤§å°ï¼›&lt;/li&gt;
&lt;li&gt;mcacheï¼šå±€éƒ¨ç¼“å­˜ï¼Œ&lt;strong&gt;æ˜¯Mä¸­çš„å†…å­˜ç¼“å­˜&lt;/strong&gt;ï¼Œæ˜¯å †çš„ä¸€éƒ¨åˆ†ï¼Œæ¯ä¸ªå°ºå¯¸å¯¹åº”ä¸€ä¸ªç©ºé—²çš„å•é“¾è¡¨ã€‚ä¸€æ¬¡å¯¹è±¡åˆ†é…æ—¶ï¼Œæ€»æ˜¯ä¼šå…ˆä»è¿™æ ·çš„çº¿ç¨‹å±€éƒ¨ç¼“å­˜ä¸­è·å–å†…å­˜ï¼ˆæ¯”å¦‚ ç”¨äºå°å¯¹è±¡ï¼ˆ&amp;lt;=32KBï¼‰çš„å†…å­˜åˆ†é…ï¼‰ï¼Œå½“mcacheä¸­çš„mspanä¸å¤Ÿç”¨æ—¶ï¼Œæ‰ä¼šå»å‘å †å¤–å†…å­˜mcentralä¸­è·å–æ–°çš„mspanï¼›&lt;/li&gt;
&lt;li&gt;mcentralï¼šä»mheapä¸­ç”³è¯·mspanï¼Œå°†mspanåˆ’åˆ†æˆå„ç§å°å°ºå¯¸å¯¹è±¡ï¼Œå°†ç›¸åŒå¤§å°çš„spanèšåˆèµ·æ¥ï¼Œæ¯ä¸ªmcentralä¿å­˜ä¸€ç§ç‰¹å®šå¤§å°çš„å…¨å±€mspanåˆ—è¡¨ï¼Œæä¾›ç»™mcacheä½¿ç”¨ï¼›&lt;/li&gt;
&lt;li&gt;mheapï¼šç”¨äºå¤§å¯¹è±¡ï¼ˆ&amp;gt;32KBï¼‰çš„å†…å­˜åˆ†é…ï¼ŒGCçš„ä¸»è¦åœ°æ–¹ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦‚æœmcacheæœ‰ç©ºé—²çš„ç©ºé—´ï¼Œé‚£ç›´æ¥åœ¨mcacheåˆ†é…ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™å°è¯•å»mcentralä¸­è·å–ä¸€ä¸ªç©ºé—²çš„mspanï¼Œå¦‚æœmcentralä¸­ä¹Ÿæ²¡æœ‰å¯ç”¨çš„mspanï¼Œåˆ™å»mheapå‘æ“ä½œç³»ç»Ÿç”³è¯·å¯ç”¨çš„mspanã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/go_mem_alloc_summary.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/go_mem_alloc_summary.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æ ¹æ®å¯¹è±¡ä¸­æ˜¯å¦å«æœ‰æŒ‡é’ˆä»¥åŠå¯¹è±¡å¤§å°ï¼Œå†…å­˜åˆ†é…è¿‡ç¨‹åˆ†ä¸º 3 ç±»ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;tinyï¼šå°äº16 byte å¹¶ä¸” æ²¡æœ‰æŒ‡é’ˆçš„å¯¹è±¡ï¼Œåˆ†é…æœ€å¤æ‚ï¼Œå®¹æ˜“äº§ç”Ÿå†…å­˜ç¢ç‰‡ï¼ŒGoä¼šæŠŠè¿™äº›tinyéƒ½åµŒå…¥åˆ°ä¸€ä¸ª16Kçš„å¯¹è±¡ä¸­ï¼›&lt;/li&gt;
&lt;li&gt;smallï¼šæœ‰æŒ‡é’ˆ æˆ–è€… å¤§å°å¤§äºç­‰äº16 byte å¹¶ä¸”å°äºç­‰äº 32 KB çš„å¯¹è±¡ï¼›å°äº32Kçš„ä¸ºå°å¯¹è±¡ï¼Œå°å¯¹è±¡ä»æœ¬åœ°å†…å­˜é“¾è¡¨mcacheä¸­åˆ†é…ï¼›å¦‚æœä¸å¤Ÿï¼Œå°±ä¼šå‘å…¶ä¸Šçº§mcentralè·å–æ–°mspané“¾è¡¨ï¼Œä¸å¤Ÿå†ç»§ç»­å‘ä¸Šçº§è·å–ï¼›&lt;/li&gt;
&lt;li&gt;largeï¼šå¤§äº 32KB çš„å¯¹è±¡ï¼Œå±äºå¤§å¯¹è±¡ï¼Œç›´æ¥ä»å…¨å±€æ§åˆ¶å †ï¼ˆä¸­å¿ƒå†…å­˜å †ï¼‰ä¸Šä»¥é¡µï¼ˆ4Kï¼‰ä¸ºå•ä½è¿›è¡Œåˆ†é…ï¼Œå¤§å¯¹è±¡æ€»æ˜¯ä»¥é¡µå¯¹é½çš„ï¼Œä¸€ä¸ªé¡µå¯ä»¥å­˜å…¥ä¸€äº›ç›¸åŒå¤§å°çš„å°å¯¹è±¡ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;æˆ‘ä»¬å¯ä»¥å°†å†…å­˜åˆ†é…çš„è·¯å¾„ä¸ CPU çš„å¤šçº§ç¼“å­˜ä½œç±»æ¯”ï¼Œè¿™é‡Œ mcache å†…éƒ¨çš„ tiny å¯ä»¥ç±»æ¯”ä¸º L1 cacheï¼Œè€Œ alloc æ•°ç»„ä¸­çš„å…ƒç´ å¯ä»¥ç±»æ¯”ä¸º L2 cacheï¼Œå…¨å±€çš„ mheap.mcentral ç»“æ„ä¸º L3 cacheï¼Œmheap.arena æ˜¯ L4ï¼ŒL4 æ˜¯ä»¥é¡µä¸ºå•ä½å°†å†…å­˜å‘ä¸‹æ´¾å‘çš„ï¼Œç”± pageAlloc æ¥ç®¡ç† arena ä¸­çš„ç©ºé—²å†…å­˜ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;L1&lt;/th&gt;
&lt;th&gt;L2&lt;/th&gt;
&lt;th&gt;L3&lt;/th&gt;
&lt;th&gt;L4&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;mcache.tiny&lt;/td&gt;
&lt;td&gt;mcache.alloc[]&lt;/td&gt;
&lt;td&gt;mheap.central&lt;/td&gt;
&lt;td&gt;mheap.arenas&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;è‹¥ L4 ä¹Ÿæ²¡æ³•æ»¡è¶³æˆ‘ä»¬çš„å†…å­˜åˆ†é…éœ€æ±‚ï¼Œä¾¿éœ€è¦å‘æ“ä½œç³»ç»Ÿå»è¦å†…å­˜äº†ã€‚&lt;/p&gt;
&lt;p&gt;å’Œ tiny çš„å››çº§åˆ†é…è·¯å¾„ç›¸æ¯”ï¼Œsmall ç±»å‹çš„å†…å­˜æ²¡æœ‰æœ¬åœ°çš„ mcache.tiny ç¼“å­˜ï¼Œå…¶ä½™ä¸ tiny åˆ†é…è·¯å¾„å®Œå…¨ä¸€è‡´ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;L1&lt;/th&gt;
&lt;th&gt;L2&lt;/th&gt;
&lt;th&gt;L3&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;mcache.alloc[]&lt;/td&gt;
&lt;td&gt;mheap.central&lt;/td&gt;
&lt;td&gt;mheap.arenas&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;large å†…å­˜åˆ†é…ç¨å¾®ç‰¹æ®Šä¸€äº›ï¼Œæ²¡æœ‰ä¸Šé¢å¤æ‚çš„ç¼“å­˜æµç¨‹ï¼Œè€Œæ˜¯ç›´æ¥ä» mheap.arenas ä¸­è¦å†…å­˜ï¼Œç›´æ¥èµ° pageAlloc é¡µåˆ†é…å™¨ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&#34;é€ƒé€¸åˆ†æ&#34;&gt;é€ƒé€¸åˆ†æ&lt;/h1&gt;
&lt;p&gt;ä¹‹æ‰€ä»¥éœ€è¦é€ƒé€¸åˆ†æï¼Œæ˜¯å› ä¸ºGCåªæ¸…ç†å †å†…å­˜ï¼Œå‡½æ•°æ‰§è¡Œæ—¶å†…å­˜åˆ†é…åœ¨æ ˆä¸Šï¼Œå‡½æ•°ç»“æŸæ—¶æ ˆå†…å­˜ä¼šè¢«å›æ”¶ï¼Œæ— éœ€GCã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;goé€šè¿‡é€ƒé€¸åˆ†æå†³å®šå˜é‡åœ¨å †ä¸Šåˆ†é…è¿˜æ˜¯åœ¨æ ˆä¸Šåˆ†é…&lt;/p&gt;
&lt;p&gt;å¦‚æœå˜é‡åªåœ¨å‡½æ•°å†…è¢«å¼•ç”¨ï¼Œåˆ™ä¼˜å…ˆåˆ†é…åœ¨æ ˆä¸Š&lt;/p&gt;
&lt;p&gt;å¦‚æœå˜é‡è¿˜åœ¨å‡½æ•°å¤–è¢«å¼•ç”¨ï¼Œåˆ™ä¼˜å…ˆåˆ†é…åœ¨å †ä¸Š&lt;/p&gt;
&lt;p&gt;ç”³è¯·äº†å¤§å¯¹è±¡ï¼Œæ ˆä¸å¤Ÿæ”¾ï¼Œä¹Ÿä¼šåˆ†é…åˆ°å †ä¸Š&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥ï¼Œç”¨newåˆ›å»ºçš„å˜é‡ä¸ä¸€å®šåœ¨å †ä¸Šï¼Œè¦çœ‹é€ƒé€¸åˆ†æçš„ç»“æœï¼Œå¦‚æœè¯¥å˜é‡ä¸€ç›´åªæ˜¯åœ¨å‡½æ•°å†…è¢«å¼•ç”¨ï¼Œä¼šè¢«ä¼˜å…ˆåˆ†é…åœ¨æ ˆä¸Šï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;goä¸­é€ƒé€¸åˆ†ææ˜¯åœ¨ç¼–è¯‘æœŸå®Œæˆ&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;goä¸­é€ƒé€¸åˆ†æåªé’ˆå¯¹æŒ‡é’ˆï¼Œä¸€ä¸ªå€¼å¼•ç”¨å˜é‡å¦‚æœæ²¡æœ‰è¢«å–å€ï¼Œé‚£å®ƒæ°¸è¿œä¸å¯èƒ½é€ƒé€¸&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä½¿ç”¨&lt;code&gt;go run -gcflags &amp;quot;-m -l&amp;quot;&lt;/code&gt;å‘½ä»¤runtimeåŠ å…¥å‚æ•°ï¼Œ-mè¡¨ç¤ºæ‰“å°é€ƒé€¸åˆ†æä¿¡æ¯ï¼Œ-l è¡¨ç¤ºç¦æ­¢å†…è”ç¼–è¯‘&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;é€ƒé€¸åœºæ™¯&#34;&gt;é€ƒé€¸åœºæ™¯&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨å‡½æ•°å†…newå‡ºæ¥æˆ–ä½¿ç”¨å­—é¢é‡åˆ›å»ºçš„å˜é‡ï¼Œå…¶å€¼ä½œä¸ºå‡½æ•°çš„è¿”å›å€¼ï¼Œè¯¥å˜é‡ä¸€å®šå‘ç”Ÿé€ƒé€¸ï¼›&lt;/li&gt;
&lt;li&gt;è¢«å·²ç»é€ƒé€¸çš„å˜é‡å¼•ç”¨çš„æŒ‡é’ˆï¼Œä¹Ÿå‘ç”Ÿäº†é€ƒé€¸ï¼›&lt;/li&gt;
&lt;li&gt;è¢«æŒ‡é’ˆç±»å‹çš„sliceã€mapå’Œchanå¼•ç”¨çš„æŒ‡é’ˆä¸€å®šå‘ç”Ÿäº†é€ƒé€¸ï¼›&lt;/li&gt;
&lt;li&gt;è¿”å›å€¼ä¸ºinterface{}ç±»å‹ï¼Œç”±äºç¼–è¯‘æœŸé—´æ— æ³•åˆ¤æ–­æ˜¯å…·ä½“ç±»å‹ï¼Œä¹Ÿä¼šå‘ç”Ÿé€ƒé€¸ï¼›&lt;/li&gt;
&lt;li&gt;æ ˆç©ºé—´ä¸è¶³æ—¶ä¹Ÿä¼šå‘ç”Ÿé€ƒé€¸ï¼Œå¯¹äº64ä½æœºå™¨ï¼Œæ ˆç©ºé—´æ˜¯8MBï¼Œä½¿ç”¨&lt;code&gt;ulimit -a&lt;/code&gt;å‘½ä»¤æŸ¥çœ‹æœºå™¨ä¸Šæ ˆå…è®¸å ç”¨çš„å†…å­˜å¤§å°ï¼›&lt;/li&gt;
&lt;li&gt;é—­åŒ…å‡½æ•°ç›´æ¥è®¿é—®å¤–éƒ¨çš„å˜é‡ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;gc&#34;&gt;GC&lt;/h1&gt;
&lt;h2 id=&#34;åŸºæœ¬-1&#34;&gt;åŸºæœ¬&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨&lt;strong&gt;å¯è¾¾æ€§åˆ†æ&lt;/strong&gt;åˆ¤æ–­å¯¹è±¡æ˜¯å¦è¢«å›æ”¶&lt;/li&gt;
&lt;li&gt;ä¸‰è‰²æ ‡è®°æ³•è¿›è¡ŒGCï¼Œæœ¬è´¨æ˜¯æ ‡è®°-æ¸…é™¤ç®—æ³•ï¼Œä¸‰è‰²æ ‡è®°æ³•æ˜¯å…¶æ”¹è¿›ç‰ˆï¼Œä¸»è¦æ˜¯ä¸ºäº†å‡å°‘STWçš„æ—¶é—´&lt;/li&gt;
&lt;li&gt;Go è¯­è¨€ä¸ºäº†å®ç°é«˜æ€§èƒ½çš„å¹¶å‘åƒåœ¾æ”¶é›†å™¨ï¼Œä½¿ç”¨ä¸‰è‰²æŠ½è±¡ã€å¹¶å‘å¢é‡å›æ”¶ã€æ··åˆå†™å±éšœã€è°ƒæ­¥ç®—æ³•ä»¥åŠç”¨æˆ·ç¨‹åºååŠ©ç­‰æœºåˆ¶å°†åƒåœ¾æ”¶é›†çš„æš‚åœæ—¶é—´ä¼˜åŒ–è‡³æ¯«ç§’çº§ä»¥ä¸‹&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;å¹¶è¡Œåƒåœ¾å›æ”¶&lt;/strong&gt;ï¼šå¤šæ ¸åœºæ™¯ä¸‹ï¼Œå¤šä¸ªæ ¸åŒæ—¶è¿›å…¥STWï¼Œè¿›è¡ŒGCï¼Œå°†åŸæœ¬ä¸€ä¸ªçº¿ç¨‹è¦æ‰§è¡Œçš„è®¤ä¸ºï¼Œåˆ†ç»™å¤šä¸ªæ ¸çš„ä¸åŒçº¿ç¨‹å»æ‰§è¡Œï¼Œéœ€è¦è€ƒè™‘æ‰§è¡Œçš„è´Ÿè½½å‡è¡¡ï¼Œä½†ä¼šå¢åŠ çº¿ç¨‹é—´çš„åŒæ­¥å¼€é”€ï¼Œå¤åˆ¶åƒåœ¾å›æ”¶æ—¶ï¼Œè¿˜å¾—é¿å…æ•°æ®å¯¹è±¡è¢«ä¸åŒçº¿ç¨‹é‡å¤å¤åˆ¶ï¼›&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å¹¶å‘åƒåœ¾å›æ”¶&lt;/strong&gt;ï¼šå¤šæ ¸åœºæ™¯ä¸‹ï¼Œç”¨æˆ·ç¨‹åºå’Œåƒåœ¾å›æ”¶ç¨‹åºå¹¶è¡Œæ‰§è¡Œï¼Œä¸€äº›æ ¸STWæ‰§è¡ŒGCï¼Œå¦ä¸€äº›æ ¸ç»§ç»­è¿è¡Œç”¨æˆ·ç¨‹åºï¼Œæ‰€ä»¥åœ¨æ­¤åœºæ™¯ä¸‹ï¼Œç”¨æˆ·ç¨‹åºå’Œåƒåœ¾å›æ”¶ç¨‹åºä¼šåŒæ—¶ä½¿ç”¨å†™å±éšœè®°å½•é›†ï¼›&lt;/p&gt;
&lt;p&gt;goçš„GCï¼Œé‡‡ç”¨çš„å°±æ˜¯&lt;strong&gt;ä¸»ä½“å¹¶å‘å¢é‡å¼åƒåœ¾å›æ”¶&lt;/strong&gt;ï¼Œé‡‡ç”¨æ’å…¥å†™å±éšœå’Œåˆ é™¤å†™å±éšœç»„åˆè€Œæˆçš„&lt;strong&gt;æ··åˆå†™å±éšœ&lt;/strong&gt;ï¼›ï¼ˆä¸»ä½“ å¢é‡ æŒ‡çš„æ˜¯å°†STWæ‹†åˆ†æˆå¤šä»½ï¼Œä¸ç”¨æˆ·ç¨‹åºäº¤æ›¿åœ¨ä¸åŒçš„æ ¸ä¸­è¿è¡Œï¼Œä½¿å¾—å¯ä»¥åœ¨åƒåœ¾å›æ”¶å¼€å§‹æ—¶ï¼Œæ¶ˆæ¯èƒ½åŠæ—¶å‡†ç¡®çš„é€šçŸ¥åˆ°æ‰€æœ‰çº¿ç¨‹ï¼Œé¿å…æŸäº›çº¿ç¨‹å¼€å¯å†™å±éšœçš„åŠ¨ä½œæœ‰æ‰€å»¶è¿Ÿè€Œå‘ç”Ÿé”™è¯¯ï¼‰&lt;/p&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/%e5%b9%b6%e5%8f%91GC%e6%a8%a1%e5%bc%8f.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/%e5%b9%b6%e5%8f%91GC%e6%a8%a1%e5%bc%8f.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;h2 id=&#34;ä½¿ç”¨ä¸‰è‰²æ ‡è®°æ³•çš„åŸå› &#34;&gt;ä½¿ç”¨ä¸‰è‰²æ ‡è®°æ³•çš„åŸå› &lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Goè¿è¡Œæ—¶çš„å†…å­˜åˆ†é…ç®—æ³•åŸºäº tcmallocï¼ŒåŸºæœ¬æ²¡æœ‰ç¢ç‰‡é—®é¢˜ï¼Œå¯¹å¯¹è±¡è¿›è¡Œæ•´ç†ä¸ä¼šå¸¦æ¥å®è´¨æ€§çš„æ€§èƒ½æå‡ï¼Œæ‰€ä»¥å¹¶ä¸éœ€è¦åƒJavaä¸€æ ·å¯¹å†…å­˜è¿›è¡Œåˆ†ä»£ï¼Œå¦å¤–Javaä½œä¸ºé¢å‘å¯¹è±¡è¯­è¨€ï¼Œå­˜åœ¨å¤§é‡çš„å¯¹è±¡åˆ†é…ï¼Œå¯¹å†…å­˜è¿›è¡Œåˆ†ä»£æœ‰åˆ©äºå¯¹ä¸åŒçš„åˆ†ä»£é‡‡å–ä¸åŒçš„GCç®—æ³•ï¼Œä¹Ÿèƒ½åŠæ—¶å›æ”¶ç”Ÿå‘½å‘¨æœŸè¾ƒçŸ­çš„å¯¹è±¡ï¼Œå‡å°‘STWå½±å“ï¼Œæå‡GCæ•ˆç‡ï¼›&lt;/p&gt;
&lt;p&gt;å…³äºtcmallocå†…å­˜åˆ†é…ç®—æ³•ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;çº¿ç¨‹çº§åˆ«çš„å†…å­˜ç®¡ç†æ¨¡å¼ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;é€Ÿåº¦å¿«ï¼Œå‡å°‘é”ç«äº‰ï¼Œå¯¹äºå°å¯¹è±¡ï¼Œåªæœ‰åœ¨å¯¹åº”çº¿ç¨‹åˆ†é…çš„ç©ºé—²å—ä¸è¶³æ—¶ï¼Œæ‰ä¼šç”¨åˆ°é”ï¼›å¯¹äºå¤§å¯¹è±¡ï¼Œä¼šå°è¯•ä½¿ç”¨è‡ªæ—‹é”ï¼Œæœ€å¤§åŒ–å†…å­˜ä½¿ç”¨æ•ˆç‡ï¼Œæœ€å°åŒ–åˆ†é…æ—¶é—´ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¯¹å†…å­˜ç¢ç‰‡çš„å¤„ç†ï¼š&lt;/p&gt;
&lt;p&gt;tcmallocä¼šæå‰åˆ†é…å¤šç§sizeçš„å†…å­˜ï¼š8ã€16ã€32ã€48ã€64&amp;hellip;äº§ç”Ÿæœ€å¤š12.5%çš„å†…å­˜ç¢ç‰‡ï¼Œåˆ†é…å¹¶ä¸æ˜¯æŒ‰ç…§2çš„å¹‚çº§æ•°åˆ†é…ï¼Œæ¯”å¦‚å¦‚æœç”³è¯·65å­—èŠ‚ï¼Œ2æ¬¡å¹‚å°±ä¼šåˆ†é…128ï¼Œä½†å®é™…ä¸Štcmallocåªä¼šåˆ†é…80ï¼Œä»¥å‡å°‘å†…å­˜ç¢ç‰‡çš„äº§ç”Ÿï¼›&lt;/p&gt;
&lt;p&gt;å¦‚æœå°å†…å­˜å—ä¸å¤Ÿç”¨ï¼Œæ‰ä¼šåˆ†é…å¤§å†…å­˜å—ï¼Œç”³è¯·å†…å­˜æ—¶ä»¥Pageä¸ºå•ä½è¿›è¡Œç”³è¯·ï¼Œä¸ºäº†ä½¿å¾—å†…å­˜ç¢ç‰‡ç‡æœ€å¤š12.5%ï¼Œå°±ä¼šç”³è¯·å¤šä¸ªpageæ¥è§£å†³ï¼Œåˆå¹¶ç›¸é‚»çš„pageï¼Œå‡å°‘å¤–éƒ¨ç¢ç‰‡ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Goçš„ç¼–è¯‘å™¨ä¼šé€šè¿‡&lt;strong&gt;é€ƒé€¸åˆ†æ&lt;/strong&gt;å°†å¤§éƒ¨åˆ†æ–°ç”Ÿå¯¹è±¡å­˜å‚¨åœ¨æ ˆä¸Šï¼Œè€Œæ ˆåœ¨æ–¹æ³•ç»“æŸåå³å¯è¢«å›æ”¶ï¼Œåªæœ‰é‚£äº›éœ€è¦é•¿æœŸå­˜åœ¨çš„å¯¹è±¡æ‰ä¼šè¢«åˆ†é…åˆ°å †ä¸­ï¼Œgoroutineæ­»äº¡åï¼Œæ ˆä¹Ÿå¯è¢«ç›´æ¥å›æ”¶ï¼Œä¸éœ€è¦GCå‚ä¸ï¼Œå› æ­¤æ— éœ€åˆ†ä»£ã€é¢‘ç¹æ£€æŸ¥å¯¹è±¡ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Goçš„åƒåœ¾æ”¶é›†å™¨ä¸ç”¨æˆ·ä»£ç å¹¶å‘æ‰§è¡Œï¼Œä½¿å¾—STWçš„æ—¶é—´å˜çŸ­ï¼ŒSTWçš„æ—¶é—´ä¸å¯¹è±¡çš„ä»£é™…ã€å¯¹è±¡çš„å¤§å°æ²¡æœ‰å…³ç³»ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;åƒåœ¾æ”¶é›†å™¨æ ‡è®°è¿‡ç¨‹ä¸­æœ€å…ˆæ£€æŸ¥çš„å¯¹è±¡å³gcroot&#34;&gt;åƒåœ¾æ”¶é›†å™¨æ ‡è®°è¿‡ç¨‹ä¸­æœ€å…ˆæ£€æŸ¥çš„å¯¹è±¡ï¼Œå³GCRoot&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;å…¨å±€å˜é‡ï¼Œé™æ€æ•°æ®ï¼šç¨‹åºåœ¨ç¼–è¯‘æœŸå°±èƒ½ç¡®å®šçš„å­˜åœ¨äºæ•´ä¸ªç”Ÿå‘½å‘¨æœŸçš„å˜é‡ï¼Œè¿™äº›å˜é‡ä¼šè¢«åˆ†é…åœ¨æ•°æ®æ®µï¼›&lt;/li&gt;
&lt;li&gt;æ‰§è¡Œæ ˆï¼šæ¯ä¸ªgoroutineåŒ…å«è‡ªå·±çš„æ‰§è¡Œæ ˆï¼Œè¿™äº›æ‰§è¡Œæ ˆä¸ŠåŒ…å«æ ˆä¸Šçš„å˜é‡ä»¥åŠæŒ‡å‘åˆ†é…çš„å †å†…å­˜çš„æŒ‡é’ˆï¼›&lt;/li&gt;
&lt;li&gt;å¯„å­˜å™¨ï¼šå¯„å­˜å™¨çš„å€¼å¯èƒ½è¡¨ç¤ºä¸€ä¸ªæŒ‡é’ˆï¼Œè¿™äº›æŒ‡é’ˆå¯èƒ½æŒ‡å‘æŸäº›èµ‹å€¼å™¨åˆ†é…çš„&lt;strong&gt;å †å†…å­˜åŒºå—&lt;/strong&gt;ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;ä¸‰è‰²æ ‡è®°---æ ‡è®°æ¸…é™¤&#34;&gt;ä¸‰è‰²æ ‡è®° - æ ‡è®°æ¸…é™¤&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;ç™½è‰²ï¼šæ½œåœ¨åƒåœ¾ï¼Œå…¶å†…å­˜å¯èƒ½ä¼šè¢«åƒåœ¾æ”¶é›†å™¨å›æ”¶ï¼›&lt;/li&gt;
&lt;li&gt;ç°è‰²ï¼šæ´»è·ƒå¯¹è±¡ï¼Œå› ä¸ºå­˜åœ¨æŒ‡å‘ç™½è‰²å¯¹è±¡çš„å¤–éƒ¨æŒ‡é’ˆï¼Œåƒåœ¾æ”¶é›†å™¨åªä¼šå¯¹å¯¹è±¡è¿›è¡Œæ‰«æï¼Œ&lt;strong&gt;é€šè¿‡å¼•å…¥ç°è‰²æ ‡è®°è¿™ä¸€ä¸­é—´çŠ¶æ€ï¼Œä½¿å¾—ç”¨æˆ·ä»£ç å’Œæ ‡è®°ä»£ç å¯ä»¥å¹¶å‘æ‰§è¡Œï¼Œæ— éœ€STWï¼Œå‡å°‘åœé¡¿æ—¶é—´&lt;/strong&gt;ï¼›&lt;/li&gt;
&lt;li&gt;é»‘è‰²ï¼šæ´»è·ƒå¯¹è±¡ï¼ŒåŒ…æ‹¬ä¸å­˜åœ¨ä»»ä½•å¼•ç”¨å¤–éƒ¨æŒ‡é’ˆå¯¹è±¡ä»¥åŠä»æ ¹å¯¹è±¡å¯è¾¾çš„å¯¹è±¡ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/go_gc.gif&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/go_gc.gif&#34;
			
			
			
			loading=&#34;lazy&#34;
			alt=&#34;go gcç®€åŒ–è¿‡ç¨‹&#34;&gt;
	&lt;/a&gt;
	
	&lt;figcaption&gt;go gcç®€åŒ–è¿‡ç¨‹&lt;/figcaption&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;åˆå§‹å¯¹è±¡éƒ½æ˜¯ç™½è‰²ï¼Œé¦–å…ˆæŠŠæ‰€æœ‰å¯¹è±¡éƒ½æ”¾åˆ°ç™½è‰²é›†åˆä¸­&lt;/li&gt;
&lt;li&gt;ä»æ ¹èŠ‚ç‚¹å¼€å§‹éå†å¯¹è±¡ï¼Œéå†åˆ°çš„å¯¹è±¡æ ‡è®°ä¸ºç°è‰²ï¼Œå¹¶ä»ç™½è‰²é›†åˆæ”¾å…¥åˆ°ç°è‰²é›†åˆ&lt;/li&gt;
&lt;li&gt;éå†ç°è‰²å¯¹è±¡ï¼ŒæŠŠè‡ªå·±æ ‡è®°ä¸ºé»‘è‰²ï¼Œæ”¾å…¥é»‘è‰²é›†åˆï¼Œå°†å…¶å¼•ç”¨çš„å¯¹è±¡æ ‡è®°ä¸ºç°è‰²ï¼Œæ”¾å…¥ç°è‰²é›†åˆ&lt;/li&gt;
&lt;li&gt;é‡å¤ç¬¬3æ­¥ï¼Œç›´åˆ°ç°è‰²é›†åˆä¸ºç©ºï¼Œæ­¤æ—¶æ‰€æœ‰å¯è¾¾å¯¹è±¡éƒ½è¢«æ ‡è®°ï¼Œæ ‡è®°é˜¶æ®µå®Œæˆ&lt;/li&gt;
&lt;li&gt;æ¸…é™¤é˜¶æ®µå¼€å§‹ï¼Œç™½è‰²é›†åˆé‡Œçš„å¯¹è±¡ä¸ºä¸å¯è¾¾å¯¹è±¡ï¼Œå³åƒåœ¾ï¼Œå¯¹å†…å­˜è¿›è¡Œè¿­ä»£æ¸…æ‰«ï¼Œå›æ”¶ç™½è‰²å¯¹è±¡&lt;/li&gt;
&lt;li&gt;é‡ç½®GCçŠ¶æ€ï¼Œå°†æ‰€æœ‰çš„å¯¹è±¡æ”¾å…¥ç™½è‰²é›†åˆä¸­&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;å®é™…ä¸Šå¹¶æ²¡æœ‰å¯¹åº”é¢œè‰²çš„é›†åˆï¼Œå¯¹è±¡è¢«å†…å­˜åˆ†é…å™¨åˆ†é…åœ¨spanä¸­ï¼Œspané‡Œæœ‰ä¸ªgcmarkBitså­—æ®µï¼Œæ¯ä¸ªbitä»£è¡¨ä¸€ä¸ªslotè¢«æ ‡è®°ï¼Œç™½è‰²å¯¹è±¡è¯¥bitä¸º0ï¼Œç°è‰²æˆ–é»‘è‰²ä¸º1ã€‚&lt;/p&gt;
&lt;p&gt;æ¯ä¸ªpä¸­éƒ½æœ‰wbBufå’Œgcw gcWork, ä»¥åŠå…¨å±€çš„workbufæ ‡è®°é˜Ÿåˆ—, å®ç°ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹, åœ¨è¿™äº›é˜Ÿåˆ—ä¸­çš„æŒ‡é’ˆä¸ºç°è‰²å¯¹è±¡, è¡¨ç¤ºå·²æ ‡è®°, å¾…æ‰«æ.&lt;/p&gt;
&lt;p&gt;ä»é˜Ÿåˆ—ä¸­å–å‡ºæ¥å¹¶æŠŠå…¶å¼•ç”¨å¯¹è±¡å…¥é˜Ÿçš„ä¸ºé»‘è‰²å¯¹è±¡, è¡¨ç¤ºå·²æ ‡è®°, å·²æ‰«æ. (runtime.scanobject).&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;å†™å±éšœ&#34;&gt;å†™å±éšœ&lt;/h2&gt;
&lt;p&gt;ä¼ ç»Ÿæ ‡è®°æ¸…é™¤ç®—æ³•ï¼Œæ˜¯ç”¨æˆ·ç¨‹åºè¿è¡Œä¸€æ®µæ—¶é—´ï¼Œå°±STWä¸€æ®µæ—¶é—´ï¼Œä½†æ˜¯é•¿æ—¶é—´çš„STWæ€§èƒ½å¤ªå·®ï¼Œå› æ­¤æ”¹æˆäº†ç”¨æˆ·ç¨‹åºå’ŒSTWçŸ­æ—¶é—´å†…äº¤æ›¿è¿è¡Œï¼ˆä¹Ÿç§°ä¸ºå¢é‡å¼GCï¼‰ï¼Œä»¥æ­¤å‡å°‘STWå¸¦æ¥çš„å½±å“ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨goçš„æ—©æœŸç‰ˆæœ¬ä¸­ï¼Œåœ¨æ ‡è®°é˜¶æ®µæ—¶ï¼Œå› ä¸ºç”¨æˆ·ç¨‹åºå¯èƒ½ä¼šä¿®æ”¹å¯¹è±¡çš„æŒ‡é’ˆï¼Œå¯¼è‡´æ ‡è®°é”™è¯¯ï¼Œå¯¹è±¡è¢«é”™è¯¯å›æ”¶ï¼Œå› æ­¤åœ¨æ ‡è®°é˜¶æ®µéœ€è¦STWï¼Œ&lt;strong&gt;ä¸ºäº†å‡å°‘STWæ—¶é—´å’Œæå‡æ ‡è®°çš„å‡†ç¡®æ€§ï¼Œéœ€è¦è¿›è¡Œå¹¶å‘æ ‡è®°ï¼Œä¾¿é€šè¿‡å†™å±éšœé…åˆä¸‰è‰²æ ‡è®°æ¥ä¿è¯æ ‡è®°çš„æ­£ç¡®æ€§&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å†…å­˜å±éšœæ˜¯ä¸€ç§å±éšœæŒ‡ä»¤ï¼Œä½¿å¾—CPUæˆ–ç¼–è¯‘å™¨å¯¹è¯¥å±éšœæŒ‡ä»¤çš„å‰åå‘å‡ºçš„å†…å­˜æ“ä½œå¼ºåˆ¶æ‰§è¡Œæ’åºçº¦æŸï¼Œåœ¨å†…å­˜å±éšœå‰æ‰§è¡Œçš„æ“ä½œä¸€å®šå…ˆäºå†…å­˜å±éšœåæ‰§è¡Œçš„æ“ä½œï¼Œé˜²æ­¢æŒ‡ä»¤é‡æ’å¼•å‘çš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;æƒ³è¦åœ¨å¹¶å‘æˆ–å¢é‡çš„æ ‡è®°ç®—æ³•ä¸­ä¿è¯æ­£ç¡®æ€§ï¼Œéœ€è¦è¾¾æˆ&lt;strong&gt;ä»»æ„&lt;/strong&gt;ä¸€ç§ä¸‰è‰²ä¸å˜æ€§&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¼ºä¸‰è‰²ä¸å˜æ€§ï¼šé»‘è‰²å¯¹è±¡ä¸ä¼šæŒ‡å‘ç™½è‰²å¯¹è±¡ï¼Œåªä¼šæŒ‡å‘ç°è‰²å¯¹è±¡æˆ–é»‘è‰²å¯¹è±¡&lt;/li&gt;
&lt;li&gt;å¼±ä¸‰è‰²ä¸å˜æ€§ï¼šé»‘è‰²å¯¹è±¡å¯ä»¥æŒ‡å‘ç™½è‰²å¯¹è±¡ï¼Œä½†æ˜¯è¢«æŒ‡å‘çš„ç™½è‰²å¯¹è±¡ï¼Œå¿…é¡»æœ‰è¢«å…¶ä»–ç°è‰²å¯¹è±¡ç›´æ¥æˆ–é—´æ¥å¼•ç”¨&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;goä¸­ä½¿ç”¨äº†å†™å±éšœæ˜¯åœ¨å†™å…¥æŒ‡é’ˆå‰æ‰§è¡Œçš„ä¸€å°æ®µä»£ç ï¼Œåœ¨æ•°æ®å¯¹è±¡ä¿®æ”¹æ—¶ï¼Œé€šçŸ¥åƒåœ¾å›æ”¶å™¨ï¼Œç”¨ä»¥é˜²æ­¢å¹¶å‘æ ‡è®°æ—¶æŒ‡é’ˆä¸¢å¤±ï¼Œè¿™ä¸€å°æ®µä»£ç Goæ˜¯åœ¨ç¼–è¯‘æ—¶åŠ å…¥çš„ã€‚&lt;/p&gt;
&lt;p&gt;å†™å±éšœé€šå¸¸æ˜¯ä¸€ä¸ªè®°å½•é›†ï¼Œéœ€è¦è€ƒè™‘æ˜¯é‡‡ç”¨ é¡ºåºå­˜å‚¨è¿˜æ˜¯å“ˆå¸Œè¡¨å­˜å‚¨ã€è®°å½•ç²¾ç¡®åˆ°è¢«ä¿®æ”¹çš„å¯¹è±¡è¿˜æ˜¯åªè®°å½•è¢«ä¿®æ”¹å¯¹è±¡æ‰€åœ¨çš„é¡µç­‰é—®é¢˜ã€ç”¨æˆ·ç¨‹åºå’Œåƒåœ¾å›æ”¶ç¨‹åºä¹‹é—´çš„ç«äº‰é—®é¢˜ï¼›&lt;/p&gt;
&lt;p&gt;é¢˜å¤–è¯ï¼š&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å…³äºè¯»å±éšœ&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å¯¹äºå¤åˆ¶ç®—æ³•ï¼Œå¯¹è±¡æ‰€å¼•ç”¨çš„å¯¹è±¡ä»fromåŒºå¤åˆ¶åˆ°toåŒºï¼Œä¸”è‡ªèº«ä¹Ÿä»fromåŒºå¤åˆ¶åˆ°toåŒºåï¼Œä»ç„¶å¼•ç”¨çš„æ˜¯fromåŒºçš„å¯¹è±¡ï¼Œè¿™æ ·ï¼Œå½“fromåŒºç©ºé—´è¢«å›æ”¶åï¼Œä¼šå‘ç”Ÿå¼•ç”¨é”™è¯¯ï¼›&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;è¯»å±éšœä¸€èˆ¬æ˜¯ç”¨åœ¨å¤åˆ¶ç®—æ³•é‡Œ&lt;/strong&gt;ï¼Œç¡®ä¿ç”¨æˆ·ç¨‹åºä¸ä¼šè®¿é—®åˆ°å·²ç»å¤åˆ¶åˆ°toåŒºï¼ˆæ–°ï¼‰çš„fromåŒºå¯¹è±¡ï¼ˆæ—§ï¼‰ï¼Œå½“è®¿é—®å‡ºç°è¿™ç§æƒ…å†µæ—¶ï¼Œå°±ä¼šå°†å½“å‰å¯¹è±¡å¤åˆ¶åˆ°toåŒºï¼Œå¹¶æ›´æ–°å¼•ç”¨çš„å¯¹è±¡æŒ‡å‘toåŒºçš„æ–°å¯¹è±¡ï¼›&lt;/p&gt;
&lt;h3 id=&#34;dijkstraçš„æ’å…¥å†™å±éšœ---ç°è‰²èµ‹å€¼å™¨&#34;&gt;Dijkstraçš„æ’å…¥å†™å±éšœ - ç°è‰²èµ‹å€¼å™¨&lt;/h3&gt;
&lt;p&gt;æ’å…¥å†™å±éšœï¼Œä¿è¯è¾¾æˆå¼ºä¸‰è‰²ä¸å˜æ€§ï¼Œå³ä¸å…è®¸å‡ºç°é»‘è‰²å¯¹è±¡åˆ°ç™½è‰²å¯¹è±¡çš„å¼•ç”¨ï¼Œå¯ä»¥æŠŠç™½è‰²æŒ‡é’ˆæ”¹æˆç°è‰²ï¼Œä¹Ÿå¯ä»¥æŠŠé»‘è‰²å¯¹è±¡é€€å›åˆ°ç°è‰²å¯¹è±¡ï¼›&lt;/p&gt;
&lt;p&gt;åœ¨æ ‡è®°é˜¶æ®µï¼Œåœ¨å¯¹å¯¹è±¡æ‰€å¼•ç”¨çš„æŒ‡é’ˆè¿›è¡Œä¿®æ”¹æ—¶è§¦å‘ï¼Œæ¯”å¦‚Aå¼•ç”¨äº†Bï¼Œåœ¨æ ‡è®°é˜¶æ®µï¼ŒAå°†å¯¹Bçš„å¼•ç”¨æ”¹æˆäº†Cï¼ŒCä¼šè¢«æ ‡è®°ä¸ºç°è‰²ï¼Œå³ &lt;strong&gt;æŒ‡é’ˆä¿®æ”¹æ—¶ï¼ŒæŒ‡å‘çš„æ–°å¯¹è±¡è¦æ ‡è®°æˆç°è‰²ï¼Œgoä¼šåœ¨å †åŒºä½¿ç”¨æ’å…¥å†™å±éšœ&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ç°è‰²èµ‹å€¼å™¨ï¼šå°šæœªè¢«å›æ”¶å™¨æ‰«æè¿‡ï¼Œæˆ–è€…å·²ç»æ‰«æè¿‡ä½†ä»ç„¶éœ€è¦é‡æ–°æ‰«æã€‚å¦‚æœé‡æ–°æ‰«æè¿‡ç¨‹ä¸­å‘ç°äº†æ–°çš„ç°è‰²å¯¹è±¡æˆ–ç™½è‰²å¯¹è±¡ï¼Œå›æ”¶å™¨éœ€è¦å¯¹è¿™äº›å¯¹è±¡éå†æ‰«æè¿½è¸ªï¼Œç”±äºæ­¤æ—¶èµ‹å€¼å™¨è¿˜æ²¡åœæ­¢ï¼Œä»ç„¶å¯ä»¥æ’å…¥æ–°çš„éé»‘è‰²å¼•ç”¨ï¼Œå› æ­¤å›æ”¶å™¨ä»ç„¶éœ€è¦å¾€å¤æ‰«æï¼Œç›´åˆ°é‡æ–°æ‰«æè¿‡ç¨‹ä¸­æ²¡æœ‰å‘ç°æ–°çš„ç™½è‰²æˆ–ç°è‰²å¯¹è±¡ï¼Œsoæœ€åæƒ…å†µä¸‹ï¼Œå›æ”¶å™¨åªèƒ½å°†æ‰€æœ‰èµ‹å€¼å™¨çº¿ç¨‹éƒ½åœæ­¢æ‰èƒ½å¯¹æ ¹å¯¹è±¡è¿›è¡Œå®Œæ•´æ‰«æï¼Œæ­¤æ—¶å°±ä¼šSTWã€‚&lt;/p&gt;
&lt;p&gt;ä¼˜ç‚¹ï¼šå¯ä»¥ç«‹å³å¼€å§‹å¹¶å‘æ ‡è®°&lt;/p&gt;
&lt;p&gt;ç¼ºç‚¹ï¼šç›¸å¯¹ä¿å®ˆï¼Œå°†æœ‰å­˜æ´»å¯èƒ½çš„å¯¹è±¡éƒ½æ ‡è®°ä¸ºç°è‰²ï¼Œä¿è¯å¼ºä¸‰è‰²ä¸å˜æ€§ï¼Œéƒ¨åˆ†æ®‹ç•™å¯¹è±¡åªèƒ½ç•™åœ¨ä¸‹ä¸€æ¬¡è¿›è¡Œå›æ”¶ï¼›å¦å¤–ï¼Œæ’å…¥å†™å±éšœæœ‰ä¸¤ç§å®ç°æ–¹å¼ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;åœ¨æ ‡è®°é˜¶æ®µï¼Œå¦‚æœæ¯æ¬¡æœ‰æŒ‡é’ˆèµ‹å€¼æ“ä½œéƒ½éœ€è¦å¼•å…¥å†™å±éšœï¼Œæ€§èƒ½å¼€é”€æ¯”è¾ƒå¤§ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å› æ­¤åœ¨&lt;strong&gt;æ ‡è®°é˜¶æ®µï¼Œgoåªä¼šå¯¹å †åŒºä¸­ä¿®æ”¹æŒ‡é’ˆçš„æ“ä½œå¯ç”¨å†™å±éšœï¼Œæ ˆåŒºä¸­åˆ™ä¸è§¦å‘&lt;/strong&gt;ï¼Œåœ¨æ ‡è®°é˜¶æ®µç»“æŸæ—¶ï¼Œéœ€è¦&lt;strong&gt;STWé‡æ–°æ‰«æä¸€éæ ˆåŒº&lt;/strong&gt;ï¼Œç›´è‡³æ²¡æœ‰ç°è‰²èŠ‚ç‚¹ï¼ˆé¿å…é»‘æŒ‡å‘ç™½ï¼Œå› æ­¤æ–°å¯¹è±¡è¢«é»‘æŒ‡å‘ä¹‹å‰ï¼Œä¼šå˜æˆç°è‰²ï¼‰ï¼Œåœæ­¢STWï¼Œè¿›è¡ŒGCï¼Œæ‰€ä»¥å¯èƒ½å¯¼è‡´æ•´ä¸ªè¿›ç¨‹çš„èµ‹å€¼å™¨å¡é¡¿ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/go_dijkstra_%e6%8f%92%e5%85%a5%e5%86%99%e5%b1%8f%e9%9a%9c.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/go_dijkstra_%e6%8f%92%e5%85%a5%e5%86%99%e5%b1%8f%e9%9a%9c.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			alt=&#34;go dijkstraæ’å…¥å†™å±éšœ&#34;&gt;
	&lt;/a&gt;
	
	&lt;figcaption&gt;go dijkstraæ’å…¥å†™å±éšœ&lt;/figcaption&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;Dijkstraå†™å±éšœæ˜¯å¯¹è¢«å†™å…¥çš„æŒ‡é’ˆè¿›è¡Œgreyæ“ä½œ, ä¸èƒ½é˜²æ­¢æŒ‡é’ˆä»heapè¢«éšè—åˆ°é»‘è‰²çš„æ ˆä¸­, éœ€è¦STWé‡æ‰«ææ ˆ.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;yuasaçš„åˆ é™¤å†™å±éšœ---é»‘è‰²èµ‹å€¼å™¨&#34;&gt;Yuasaçš„åˆ é™¤å†™å±éšœ - é»‘è‰²èµ‹å€¼å™¨&lt;/h3&gt;
&lt;p&gt;åˆ é™¤å†™å±éšœï¼Œä¿è¯è¾¾æˆå¼±ä¸‰è‰²ä¸å˜æ€§ï¼Œå³å…³æ³¨å¯¹ç™½è‰²å¯¹è±¡çš„è·¯å¾„ç ´åè¡Œä¸ºï¼Œæ¯”å¦‚åˆ é™¤ç°è‰²å¯¹è±¡åˆ°ç™½è‰²å¯¹è±¡çš„å¼•ç”¨æ—¶ï¼Œä¼šæŠŠç™½è‰²å¯¹è±¡æ”¹æˆç°è‰²ï¼›&lt;/p&gt;
&lt;p&gt;åœ¨æ ‡è®°é˜¶æ®µï¼Œå¯¹å¯¹è±¡æ‰€å¼•ç”¨çš„æŒ‡é’ˆè¿›è¡Œåˆ é™¤æ—¶è§¦å‘ï¼Œä¿è¯ç°è‰²-ç™½è‰²é“¾è·¯ä¸ä¼šæ–­å¼€ï¼Œæ¯”å¦‚Aå¼•ç”¨äº†Bï¼Œæ ‡è®°é˜¶æ®µï¼ŒAå–æ¶ˆäº†å¯¹Bçš„å¼•ç”¨ï¼ŒBä¼šè¢«æ ‡è®°ä¸ºç°è‰²ï¼Œå³ä¸€ä¸ªå¯¹è±¡å³ä½¿è¢«åˆ é™¤äº†æœ€åä¸€ä¸ªæŒ‡å‘å®ƒçš„æŒ‡é’ˆï¼Œä¹Ÿä¾æ—§å¯ä»¥æ´»è¿‡è¿™ä¸€è½®ï¼Œåœ¨ä¸‹ä¸€è½®çš„GCä¸­æ‰ä¼šè¢«æ¸…ç†æ‰ã€‚&lt;strong&gt;å³ æŒ‡é’ˆä¿®æ”¹æ—¶ï¼Œä¿®æ”¹å‰æŒ‡å‘çš„å¯¹è±¡è¦æ ‡è®°æˆç°è‰²ï¼Œgoä¼šåœ¨æ ˆåŒºå’Œå †åŒºéƒ½ä½¿ç”¨åˆ é™¤å†™å±éšœ&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;é»‘è‰²èµ‹å€¼å™¨ï¼šå·²ç»è¢«å›æ”¶å™¨æ‰«æè¿‡ï¼Œä¸ä¼šå†æ¬¡å¯¹å…¶è¿›è¡Œæ‰«æã€‚&lt;/p&gt;
&lt;p&gt;ä¼˜ç‚¹ï¼šæ ‡è®°ç»“æŸæ—¶ä¸éœ€è¦STWï¼›&lt;/p&gt;
&lt;p&gt;ç¼ºç‚¹ï¼šå·²ç»è¢«åƒåœ¾å›æ”¶å™¨æ‰«æè¿‡ï¼Œä¸ä¼šå†æ¬¡å¯¹å…¶è¿›è¡Œæ‰«æï¼Œå›æ”¶ç²¾åº¦ä½ï¼›æ ‡è®°å¼€å§‹å‰å¼€å¯STWæ‰«ææ ˆæ¥è®°å½•åˆå§‹å¿«ç…§ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¼šä¿æŠ¤å¼€å§‹æ—¶åˆ»çš„æ‰€æœ‰å­˜æ´»å¯¹è±¡ï¼Œç”¨äºæŠŠåŸæ¥æŒ‡å‘çš„å¯¹è±¡æ ‡è®°ä¸ºç°è‰²ï¼Œå®Œäº†ä¹‹ååç»­ä¸éœ€è¦STWï¼›&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Yuasaå†™å±éšœæ˜¯å¯¹å°†è¢«è¦†ç›–çš„æŒ‡é’ˆè¿›è¡Œgreyæ“ä½œ, ä¸èƒ½é˜²æ­¢æŒ‡é’ˆä»æ ˆè¢«éšè—åˆ°é»‘è‰²çš„heapå¯¹è±¡ä¸­, éœ€è¦åœ¨GCå¼€å§‹æ—¶ä¿å­˜æ ˆçš„å¿«ç…§.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/go_yuasa_%e5%88%a0%e9%99%a4%e5%86%99%e5%b1%8f%e9%9a%9c.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/go_yuasa_%e5%88%a0%e9%99%a4%e5%86%99%e5%b1%8f%e9%9a%9c.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			alt=&#34;go yuasaåˆ é™¤å†™å±éšœ&#34;&gt;
	&lt;/a&gt;
	
	&lt;figcaption&gt;go yuasaåˆ é™¤å†™å±éšœ&lt;/figcaption&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;h2 id=&#34;æ··åˆå±éšœ&#34;&gt;æ··åˆå±éšœ&lt;/h2&gt;
&lt;p&gt;å¦‚æœæ‰€æœ‰å¯¹è±¡éƒ½åœ¨å †ä¸Šåˆ†é…ï¼Œç†è®ºä¸Šåªéœ€è¦é€‰æ‹©æ’å…¥å†™å±éšœ æˆ–è€… åˆ é™¤å†™å±éšœå³å¯æ»¡è¶³å¼º/å¼±ä¸‰è‰²ä¸å˜æ€§ï¼Œä½†åœ¨Goä¸­ï¼Œæ ˆä¸Šå¯¹è±¡æ“ä½œæ¯”è¾ƒé¢‘ç¹ï¼Œå¯¹æ ˆä¸Šå¯¹è±¡å¼€å¯å†™å±éšœçš„æˆæœ¬æ¯”è¾ƒé«˜ï¼Œé¢œè‰²åˆ¤æ–­æ¯”è¾ƒå¤æ‚ï¼Œå¦‚æœåªä½¿ç”¨å…¶ä¸­ä¸€ç§å†™å±éšœï¼Œéƒ½ä¼šæœ‰å¯¹è±¡ä¸¢å¤±çš„é—®é¢˜ï¼Œéœ€è¦å¯¹æ ˆè¿›è¡Œé‡æ–°æ‰«ææ ‡è®°ï¼Œå¯¼è‡´STWçš„æ—¶é—´è¿‡é•¿ï¼Œå®˜æ–¹ä¸ºäº†ç®€å•å®ç°ï¼Œä½¿ç”¨æ··åˆå†™å±éšœï¼Œé¿å…äºŒæ¬¡æ‰«ææ ˆã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;GC å¼€å§‹å°†æ ˆä¸Šçš„å¯¹è±¡å…¨éƒ¨å¹¶å‘æ‰«æå¹¶æ ‡è®°ä¸ºé»‘è‰²ï¼ˆä¹‹åä¸å†å¯¹æ ˆè¿›è¡Œç¬¬äºŒæ¬¡é‡å¤æ‰«æï¼Œæ— éœ€STWï¼‰ï¼›&lt;/li&gt;
&lt;li&gt;GC æœŸé—´ï¼Œä»»ä½•åœ¨æ ˆä¸Šåˆ›å»ºçš„æ–°å¯¹è±¡ï¼Œå‡ä¸ºé»‘è‰²ï¼Œæ‰«æè¿‡ä¸€æ¬¡å°±ä¸éœ€è¦å†æ‰«æäº†ï¼Œè¿™æ ·å°±æ¶ˆé™¤äº†æ’å…¥å†™å±éšœæ—¶æœŸæœ€åSTWçš„é‡æ–°æ‰«ææ ˆï¼›&lt;/li&gt;
&lt;li&gt;è¢«åˆ é™¤çš„å †å¯¹è±¡æ ‡è®°ä¸ºç°è‰²ï¼›&lt;/li&gt;
&lt;li&gt;è¢«æ·»åŠ çš„å †å¯¹è±¡æ ‡è®°ä¸ºç°è‰²ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ··åˆå±éšœç»“åˆäº†åˆ é™¤å†™å±éšœå’Œæ’å…¥å†™å±éšœçš„ä¼˜ç‚¹ï¼Œ&lt;strong&gt;æ»¡è¶³å¼±ä¸‰è‰²ä¸å˜å¼&lt;/strong&gt;ï¼Œåªéœ€è¦åœ¨å¼€å§‹æ—¶å¹¶å‘æ‰«æå„ä¸ªgoroutineçš„æ ˆï¼Œä½¿å…¶å˜é»‘å¹¶ä¸€ç›´ä¿æŒï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸éœ€è¦STWï¼Œè€Œæ ‡è®°ç»“æŸåï¼Œå› ä¸ºæ ˆåœ¨æ‰«æåå§‹ç»ˆæ˜¯é»‘è‰²çš„ï¼Œä¹Ÿæ— éœ€å†è¿›è¡Œé‡æ–°æ‰«æï¼Œå‡å°‘äº†STWçš„æ—¶é—´ã€‚è™½ç„¶æ‰«ææ ˆæ—¶æ²¡æœ‰STWï¼Œä½†æ˜¯æ‰«æå…·ä½“æŸä¸€ä¸ªå…·ä½“çš„æ ˆæ—¶ï¼Œè¿˜æ˜¯è¦åœæ­¢è¿™ä¸ªGçš„èµ‹å€¼å™¨çš„å·¥ä½œï¼Œè¦ä¹ˆå¯¹è±¡å…¨ç°ï¼Œè¦ä¹ˆå…¨é»‘ã€‚&lt;/p&gt;
&lt;h2 id=&#34;gcè§¦å‘æ¡ä»¶&#34;&gt;GCè§¦å‘æ¡ä»¶&lt;/h2&gt;
&lt;blockquote&gt;
&lt;ol&gt;
&lt;li&gt;å†…å­˜å¤§å°é˜ˆå€¼ï¼Œ å†…å­˜è¾¾åˆ°ä¸Šæ¬¡GCåçš„2å€&lt;/li&gt;
&lt;li&gt;è¾¾åˆ°å®šæ—¶æ—¶é—´è§¦å‘ ï¼Œé»˜è®¤2minï¼Œç”±sysmonå¼ºåˆ¶è§¦å‘GC&lt;/li&gt;
&lt;li&gt;ç”¨æˆ·ä»£ç ä¸­è°ƒç”¨ &lt;code&gt;runtime.GC&lt;/code&gt; ä¸»åŠ¨è§¦å‘&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;é˜ˆå€¼æ˜¯ç”±ä¸€ä¸ªgc percentçš„å˜é‡æ§åˆ¶çš„ï¼Œå½“æ–°åˆ†é…çš„å†…å­˜å å·²åœ¨ä½¿ç”¨ä¸­çš„å†…å­˜çš„æ¯”ä¾‹è¶…è¿‡gcprecentæ—¶å°±ä¼šè§¦å‘ã€‚æ¯”å¦‚ä¸€æ¬¡å›æ”¶å®Œæ¯•åï¼Œå†…å­˜çš„ä½¿ç”¨é‡ä¸º5Mï¼Œé‚£ä¹ˆä¸‹æ¬¡å›æ”¶çš„æ—¶æœºåˆ™æ˜¯å†…å­˜åˆ†é…è¾¾åˆ°10Mçš„æ—¶å€™ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¹¶ä¸æ˜¯å†…å­˜åˆ†é…è¶Šå¤šï¼Œåƒåœ¾å›æ”¶é¢‘ç‡è¶Šé«˜ã€‚ å¦‚æœä¸€ç›´è¾¾ä¸åˆ°å†…å­˜å¤§å°çš„é˜ˆå€¼å‘¢ï¼Ÿè¿™ä¸ªæ—¶å€™GCå°±ä¼šè¢«å®šæ—¶æ—¶é—´è§¦å‘ï¼Œæ¯”å¦‚ä¸€ç›´è¾¾ä¸åˆ°10Mï¼Œé‚£å°±å®šæ—¶ï¼ˆé»˜è®¤2minè§¦å‘ä¸€æ¬¡ï¼‰è§¦å‘ä¸€æ¬¡GCä¿è¯èµ„æºçš„å›æ”¶ã€‚&lt;/p&gt;
&lt;p&gt;å½“å†…å­˜åˆ†é…é€Ÿåº¦è¶…è¿‡æ ‡è®°æ¸…é™¤çš„é€Ÿåº¦æ—¶ï¼š&lt;/p&gt;
&lt;p&gt;è§¦å‘GCåï¼Œè¿›å…¥å¹¶å‘æ ‡è®°é˜¶æ®µï¼Œå¹¶å‘æ ‡è®°ä¼šè®¾ç½®ä¸€ä¸ªæ ‡å¿—ï¼Œå¹¶åœ¨å†…å­˜åˆ†é…mallocgcè°ƒç”¨æ—¶è¿›è¡Œæ£€æŸ¥ï¼Œå½“å­˜åœ¨æ–°çš„å†…å­˜åˆ†é…æ—¶ï¼Œä¼šæš‚åœåˆ†é…å†…å­˜è¿‡å¿«çš„goroutineï¼Œå¹¶å°†å…¶è½¬å»æ‰§è¡Œä¸€äº›è¾…åŠ©æ ‡è®°å·¥ä½œï¼Œä»è€Œè¾¾åˆ°æ”¾ç¼“ç»§ç»­åˆ†é…ï¼Œè¾…åŠ©GCçš„æ ‡è®°å·¥ä½œçš„ç›®çš„ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;åƒåœ¾æ”¶é›†è¿‡ç¨‹&#34;&gt;åƒåœ¾æ”¶é›†è¿‡ç¨‹&lt;/h2&gt;
&lt;blockquote&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;æ¸…ç†ç»ˆæ­¢é˜¶æ®µï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æš‚åœç¨‹åº&lt;/strong&gt;STWï¼Œæ‰€æœ‰çš„goroutineåœ¨è¿™æ—¶ä¼šè¿›å…¥å®‰å…¨ç‚¹ï¼ˆSafe pointï¼‰ï¼›&lt;/li&gt;
&lt;li&gt;å¦‚æœå½“å‰åƒåœ¾æ”¶é›†å¾ªç¯æ˜¯å¼ºåˆ¶è§¦å‘çš„ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å¤„ç†è¿˜æœªè¢«æ¸…ç†çš„å†…å­˜ç®¡ç†å•å…ƒï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ ‡è®°é˜¶æ®µï¼š&lt;/p&gt;
&lt;p&gt;æ ‡è®°è¿‡ç¨‹æ˜¯ä¸€ä¸ªå¹¿åº¦ä¼˜å…ˆéå†çš„è¿‡ç¨‹ï¼Œæ‰«æèŠ‚ç‚¹ï¼Œå°†èŠ‚ç‚¹çš„å­èŠ‚ç‚¹æ¨åˆ°ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼Œç„¶åé€’å½’æ‰«æå­èŠ‚ç‚¹çš„èŠ‚ç‚¹ï¼Œç›´åˆ°æ‰€æœ‰å·¥ä½œé˜Ÿåˆ—éƒ½è¢«æ’ç©ºä¸ºæ­¢ï¼Œè¿™ä¸ªé˜¶æ®µè¿›è¡Œä¸‰è‰²æ ‡è®°ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;å°†å†™å±éšœçŠ¶æ€åˆ‡æ¢è‡³ &lt;code&gt;_GCmark&lt;/code&gt;ã€å¼€å¯å†™å±éšœã€è¾…åŠ©GCç¨‹åºï¼ˆMutator Assisteï¼‰å¹¶å°†æ ¹å¯¹è±¡å…¥é˜Ÿï¼›å ç”¨25%CPUã€‚&lt;/p&gt;
&lt;p&gt;è¾…åŠ©GCç¨‹åºæ˜¯ä¸ºäº†é˜²æ­¢å †heapçš„å¢é€Ÿå¤ªå¿«ï¼Œåœ¨GCæ‰§è¡Œè¿‡ç¨‹ä¸­å¦‚æœåŒæ—¶è¿è¡Œçš„Gåˆ†é…äº†å†…å­˜ï¼Œé‚£ä¹ˆè¿™ä¸ªGä¼šè¢«è¦æ±‚ä½œä¸ºè¾…åŠ©GCåšä¸€éƒ¨åˆ†çš„å·¥ä½œï¼Œè¾…åŠ©GCçš„Gæœ‰ä¸¤ç§ç±»å‹ï¼Œä¸€ç§æ˜¯æ ‡è®°ï¼Œä¸€ç§æ˜¯æ¸…æ‰«ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ¢å¤ç¨‹åº&lt;/strong&gt;ï¼Œå¼€å§‹è¿›è¡Œä¸‰è‰²æ ‡è®°ï¼Œæ ‡è®°è¿›ç¨‹å’Œç”¨äºè¾…åŠ©GCç¨‹åºä¼šå¼€å§‹å¹¶å‘æ ‡è®°å†…å­˜ä¸­çš„å¯¹è±¡ï¼Œå†™å±éšœä¼šå°†è¢«è¦†ç›–çš„æŒ‡é’ˆå’Œæ–°æŒ‡é’ˆéƒ½æ ‡è®°æˆç°è‰²ï¼Œè€Œæ‰€æœ‰æ–°åˆ›å»ºçš„å¯¹è±¡éƒ½ä¼šè¢«ç›´æ¥æ ‡è®°æˆé»‘è‰²ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¼€å§‹æ‰«ææ ¹å¯¹è±¡ï¼ŒåŒ…æ‹¬æ‰€æœ‰ Goroutine çš„æ ˆã€å…¨å±€å¯¹è±¡ä»¥åŠä¸åœ¨å †ä¸­çš„è¿è¡Œæ—¶æ•°æ®ç»“æ„ï¼Œæ‰«æ Goroutine æ ˆæœŸé—´ä¼šæš‚åœå½“å‰å¤„ç†å™¨ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¾æ¬¡å¤„ç†ç°è‰²é˜Ÿåˆ—ä¸­çš„å¯¹è±¡ï¼Œå°†å¯¹è±¡æ ‡è®°æˆé»‘è‰²å¹¶å°†å®ƒä»¬æŒ‡å‘çš„å¯¹è±¡æ ‡è®°æˆç°è‰²ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä½¿ç”¨åˆ†å¸ƒå¼çš„ç»ˆæ­¢ç®—æ³•æ£€æŸ¥å‰©ä½™çš„å·¥ä½œï¼Œå‘ç°æ ‡è®°é˜¶æ®µå®Œæˆåè¿›å…¥æ ‡è®°ç»ˆæ­¢é˜¶æ®µï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ ‡è®°ç»ˆæ­¢é˜¶æ®µï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æš‚åœç¨‹åºSTW&lt;/strong&gt;ã€å°†å†™å±éšœçŠ¶æ€åˆ‡æ¢è‡³ &lt;code&gt;_GCmarktermination&lt;/code&gt; å¹¶åœæ­¢å†™å±éšœï¼Œå…³é—­è¾…åŠ©æ ‡è®°çš„ç”¨æˆ·ç¨‹åºï¼›&lt;/li&gt;
&lt;li&gt;æ¸…ç†å¤„ç†å™¨ä¸Šçš„çº¿ç¨‹ç¼“å­˜ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ¸…ç†é˜¶æ®µï¼›&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å°†å†™å±éšœçŠ¶æ€åˆ‡æ¢è‡³ &lt;code&gt;_GCoff&lt;/code&gt; å¼€å§‹æ¸…ç†é˜¶æ®µï¼Œåˆå§‹åŒ–æ¸…ç†çŠ¶æ€å¹¶å…³é—­å†™å±éšœï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ¢å¤ç¨‹åº&lt;/strong&gt;ï¼Œæ‰€æœ‰æ–°åˆ›å»ºçš„å¯¹è±¡ä¼šæ ‡è®°æˆç™½è‰²ï¼›&lt;/li&gt;
&lt;li&gt;åå°å¹¶å‘æ¸…ç†æ‰€æœ‰çš„å†…å­˜ç®¡ç†å•å…ƒï¼Œå½“ Goroutine ç”³è¯·æ–°çš„å†…å­˜ç®¡ç†å•å…ƒæ—¶å°±ä¼šè§¦å‘æ¸…ç†ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å¹¶å‘åƒåœ¾å›æ”¶æ˜¯å…ˆSTWæ‰¾åˆ°æ‰€æœ‰çš„Rootå¯¹è±¡ï¼Œå¼€å¯å†™å±éšœï¼Œç„¶åç»“æŸSTWï¼Œè®©åƒåœ¾æ ‡è®°çº¿ç¨‹å’Œç”¨æˆ·çº¿ç¨‹å¹¶å‘æ‰§è¡Œï¼Œåƒåœ¾æ ‡è®°å®Œæˆåï¼Œå†æ¬¡å¼€å¯STWï¼Œåœæ­¢å†™å±éšœï¼Œç»Ÿè®¡GCä¿¡æ¯ï¼Œç»“æŸSTWï¼Œæ¸…ç†å†…å­˜ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/GC%e6%89%a7%e8%a1%8c%e6%b5%81%e7%a8%8b.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/GC%e6%89%a7%e8%a1%8c%e6%b5%81%e7%a8%8b.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			alt=&#34;go GCæ‰§è¡Œæµç¨‹&#34;&gt;
	&lt;/a&gt;
	
	&lt;figcaption&gt;go GCæ‰§è¡Œæµç¨‹&lt;/figcaption&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;å…³æ³¨çš„æŒ‡æ ‡&#34;&gt;å…³æ³¨çš„æŒ‡æ ‡&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;CPUåˆ©ç”¨ç‡&lt;/li&gt;
&lt;li&gt;GCåœé¡¿æ—¶é—´&lt;/li&gt;
&lt;li&gt;GCåœé¡¿é¢‘ç‡&lt;/li&gt;
&lt;li&gt;GCå¯æ‰©å±•æ€§&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;gcæ€§èƒ½ä¼˜åŒ–æŠ€å·§&#34;&gt;GCæ€§èƒ½ä¼˜åŒ–æŠ€å·§&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;sliceæˆ–mapæå‰é¢„åˆ†é…&lt;/p&gt;
&lt;p&gt;sliceé¢„å…ˆåˆ†é…å†…å­˜ï¼Œå› ä¸ºsliceæ‰©å®¹æ—¶ä¼šè¿”å›æ–°çš„sliceï¼Œå¦‚æœé¢‘ç¹æ‰©å®¹ä¼šå¢åŠ GCå‹åŠ›ï¼›&lt;/p&gt;
&lt;p&gt;mapåŒç†ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;sliceçš„ç¼©å®¹ï¼Œæ¯”å¦‚ä¸€ä¸ª &lt;code&gt;arr = make([]*obj, 6)&lt;/code&gt; ç¼©å®¹æ—¶ï¼Œå½“&lt;code&gt;arr = arr[:3]&lt;/code&gt;æ—¶ï¼Œåº•å±‚æ•°ç»„åé¢ 3 ä¸ªå…ƒç´ å·²ç»æ— æ³•è®¿é—®äº†ï¼Œä½†æ˜¯å…¶å…³è”çš„å †ä¸Šå†…å­˜ä¾ç„¶æ— æ³•é‡Šæ”¾ï¼Œè§¦å‘æŠŠå¯¹åº”ä¸‹æ ‡çš„å…ƒç´ ç½®ä¸ºnilï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;mapçš„keyå’Œvalueä½¿ç”¨å€¼ç±»å‹ï¼Œè€Œä¸æ˜¯æŒ‡é’ˆç±»å‹ï¼Œåˆ©ç”¨mapä¸­extraä¸­çš„ç‰¹æ€§ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;goä¸­ï¼Œstringåº•å±‚ä¹Ÿæ˜¯æŒ‡é’ˆï¼Œå¦‚æœstringä¸å¯å˜ï¼Œå¯ä»¥åœ¨è½¬æˆ byteæ•°ç»„ï¼Œè¿™æ ·å°±ä¸ä¼šç”ŸæˆåŸæœ‰å˜é‡çš„å‰¯æœ¬ï¼Œæ–°çš„å˜é‡å…±äº«åº•å±‚çš„æ•°æ®æŒ‡é’ˆã€‚æ­¤ç‰¹æ€§ä¹Ÿå¯ç”¨åœ¨æŠŠå­—ç¬¦ä¸²è½¬æˆ[]byteï¼Œå†ä½œä¸ºmapçš„keyæˆ–valueï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¯¹äºå ç”¨ç©ºé—´å°‘ï¼Œé¢‘ç¹åˆ†é…çš„å‡½æ•°ï¼Œå‡½æ•°è¿”å›å€¼ä½¿ç”¨å€¼ç±»å‹ï¼Œä¸ä½¿ç”¨æŒ‡é’ˆç±»å‹ï¼Œå› ä¸ºè¿”å›æŒ‡é’ˆç±»å‹ä¼šå¸¦æ¥æŒ‡é’ˆé€ƒé€¸ï¼Œä½¿å¾—åŸæ¥å¯ä»¥åˆ†é…åœ¨æ ˆä¸Šçš„å†…å­˜åˆ†é…åœ¨å †ä¸Šã€‚åœ¨æ ˆä¸Šè¿›è¡Œå°å¯¹è±¡æ‹·è´çš„æ€§èƒ½ä¼šæ¯”å¯¹è±¡åœ¨å †ä¸Šåˆ†é…å¥½å¾—å¤šï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å°†å¤šä¸ªå°å¯¹è±¡åˆå¹¶æˆä¸€ä¸ªå¤§å¯¹è±¡ï¼Œå‡å°‘å¯¹è±¡åˆ†é…ï¼Œæ¯”å¦‚åœ¨å±€éƒ¨å˜é‡é€ƒé€¸æ—¶ï¼Œèšé›†èµ·æ¥&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;k&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;v&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;range&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;nx&#34;&gt;k&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;v&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;k&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;v&lt;/span&gt;   &lt;span class=&#34;c1&#34;&gt;// copy for capturing by the goroutine
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;   &lt;span class=&#34;k&#34;&gt;go&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
       &lt;span class=&#34;c1&#34;&gt;// use k and v
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;   &lt;span class=&#34;p&#34;&gt;}()&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;å¯ä»¥ä¿®æ”¹ä¸ºä¸‹é¢è¿™ç§ï¼Œä¿®æ”¹åï¼Œé€ƒé€¸çš„å¯¹è±¡å˜ä¸ºäº† xï¼Œå°† kï¼Œv2 ä¸ªå¯¹è±¡å‡å°‘ä¸º 1 ä¸ªå¯¹è±¡ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;k&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;v&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;range&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;nx&#34;&gt;x&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;k&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;v&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;k&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;   &lt;span class=&#34;c1&#34;&gt;// copy for capturing by the goroutine
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;   &lt;span class=&#34;k&#34;&gt;go&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
       &lt;span class=&#34;c1&#34;&gt;// use x.k and x.v
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;   &lt;span class=&#34;p&#34;&gt;}()&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å¯¹è±¡å¦‚æœåŒ…å«äº†æŒ‡é’ˆï¼Œåˆ™éœ€è¦é€’å½’è¿›è¡Œæ‰«æï¼Œå¤§é‡ä½¿ç”¨å¯¹è±¡æŒ‡é’ˆä¼šä½¿åƒåœ¾å›æ”¶è€—æ—¶å˜é•¿ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å‡å°‘é¢‘ç¹åˆ›å»ºgoroutineï¼Œå¯ä»¥çš„è¯æ˜¯ä¸€æ‰¹ä¸€æ‰¹çš„åˆ›å»ºï¼Œæˆ–è¿›è¡Œgoroutineå¤ç”¨ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä½¿ç”¨&lt;code&gt;sync.Pool&lt;/code&gt;æ¥ç¼“å­˜å¸¸ç”¨å¯¹è±¡ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å°½å¯èƒ½ä½¿ç”¨å­—èŠ‚æ•°å°‘çš„ç±»å‹ï¼Œæ¯”å¦‚å½“æˆ‘ä»¬çŸ¥é“æŸäº›æ•°å­—çš„ä½¿ç”¨åªä¼šåœ¨ä¸€å®šèŒƒå›´å†…ï¼Œç›´æ¥ä½¿ç”¨int8ç±»å‹&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;blockquote&gt;
&lt;p&gt;åœ¨ Go ä¸­å­˜åœ¨æ•°é‡æå°‘çš„ä¸ GC ç›¸å…³çš„ APIï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;runtime.GCï¼šæ‰‹åŠ¨è§¦å‘ GC&lt;/li&gt;
&lt;li&gt;runtime.ReadMemStatsï¼šè¯»å–å†…å­˜ç›¸å…³çš„ç»Ÿè®¡ä¿¡æ¯ï¼Œå…¶ä¸­åŒ…å«éƒ¨åˆ† GC ç›¸å…³çš„ç»Ÿè®¡ä¿¡æ¯&lt;/li&gt;
&lt;li&gt;debug.FreeOSMemoryï¼šæ‰‹åŠ¨å°†å†…å­˜å½’è¿˜ç»™æ“ä½œç³»ç»Ÿ&lt;/li&gt;
&lt;li&gt;debug.ReadGCStatsï¼šè¯»å–å…³äº GC çš„ç›¸å…³ç»Ÿè®¡ä¿¡æ¯&lt;/li&gt;
&lt;li&gt;debug.SetGCPercentï¼šè®¾ç½® GOGC è°ƒæ­¥å˜é‡&lt;/li&gt;
&lt;li&gt;debug.SetMaxHeapï¼ˆå°šæœªå‘å¸ƒ[10]ï¼‰ï¼šè®¾ç½® Go ç¨‹åºå †çš„ä¸Šé™å€¼&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h1&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.cnblogs.com/secondtonone1/p/11803961.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;å›¾è§£Goåç¨‹è°ƒåº¦åŸç†ï¼Œå°ç™½éƒ½èƒ½ç†è§£ &lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://zboya.github.io/post/go_scheduler&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;æ·±å…¥golang runtimeçš„è°ƒåº¦&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.lanzous.com/i7lj0he&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;gopher meetup-æ·±å…¥æµ…å‡ºGolang Runtime-yifhao&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://studygolang.com/articles/27069?fr=sidebar&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Golangè°ƒåº¦å™¨GMPåŸç†&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://segmentfault.com/a/1190000023869478&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;ã€golangã€‘GMPè°ƒåº¦è¯¦è§£&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://qcrao91.gitbook.io/go/gc/gc&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;GC&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://liangyaopei.github.io/2021/01/02/golang-gc-intro/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Golangåƒåœ¾å›æ”¶(GC)ä»‹ç»&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.kancloud.cn/aceld/golang/1958308&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Golangä¸‰è‰²æ ‡è®°+æ··åˆå†™å±éšœæ¨¡å¼å…¨åˆ†æ&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://go.xargin.com/docs/runtime/memory_management/garbage_collection/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;åƒåœ¾å›æ”¶&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://yousec995.github.io/2021/07/25/Goroutine%E5%8E%9F%E7%90%86/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;goroutineåŸç†|YouSec&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.luozhiyun.com/archives/448&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;è¯¦è§£Goè¯­è¨€è°ƒåº¦å¾ªç¯æºç å®ç°&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://mp.weixin.qq.com/s?__biz=MzAxMTA4Njc0OQ==&amp;amp;mid=2651439356&amp;amp;idx=2&amp;amp;sn=264a3141ea9a4b29fe67ec06a17aeb99&amp;amp;chksm=80bb1e0eb7cc97181b81ae731d0d425dda1e9a8d503ff75f217a0d77bd9d0eb451555cb584a0&amp;amp;scene=21#wechat_redirect&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;GCæ¨¡å¼å›¾æ–‡å…¨åˆ†æ&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://jishuin.proginn.com/p/763bfbd5f194&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Golang ç³»ç»Ÿè°ƒç”¨ä¸é˜»å¡å¤„ç†&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://zhuanlan.zhihu.com/p/373874739&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;go pprof å®æˆ˜&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.bilibili.com/video/BV1hv411x7we/?p=19&amp;amp;vd_source=a870d050aec1403366ebea0f42b4cdaf&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;[å¹¼éºŸå®ç°å®¤]golangåˆè¾‘&lt;/a&gt;&lt;/p&gt;
</description>
        </item>
        <item>
        <title>Go Contextå’ŒChannel</title>
        <link>http://nixum.cc/p/go-context%E5%92%8Cchannel/</link>
        <pubDate>Mon, 22 Mar 2021 00:00:00 +0000</pubDate>
        
        <guid>http://nixum.cc/p/go-context%E5%92%8Cchannel/</guid>
        <description>&lt;p&gt;[TOC]&lt;/p&gt;
&lt;h1 id=&#34;context&#34;&gt;Context&lt;/h1&gt;
&lt;p&gt;ä¸€ä¸ªæ¥å£ï¼ŒåŒ…å«å¦‚ä¸‹æ–¹æ³•ï¼Œä¸»è¦ç”¨äºå®ç°ä¸»åç¨‹å¯¹å­åç¨‹çš„æ§åˆ¶ï¼Œä½œç”¨åŒ…æ‹¬å–æ¶ˆæ‰§è¡Œã€è®¾ç½®è¶…æ—¶æ—¶é—´ã€æºå¸¦é”®å€¼å¯¹ç­‰&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Context&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// è·å–åˆ°æœŸæ—¶é—´ï¼Œå¦‚æœæ²¡æœ‰ï¼Œokåˆ™è¿”å›false
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nf&#34;&gt;Deadline&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;deadline&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;c1&#34;&gt;// è¿”å›ä¸€ä¸ªchanï¼Œè¡¨ç¤ºå–æ¶ˆä¿¡å·ï¼Œå¦‚æœé€šé“å…³é—­åˆ™ä»£è¡¨è¯¥ Context å·²ç»è¢«å–æ¶ˆï¼›å¦‚æœè¿”å›çš„ä¸º nilï¼Œåˆ™ä»£è¡¨è¯¥ Context æ˜¯ä¸€ä¸ªæ°¸è¿œä¸ä¼šè¢«å–æ¶ˆçš„ Contextã€‚
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nf&#34;&gt;Done&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;chan&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
	&lt;span class=&#34;c1&#34;&gt;// è¿”å›è¯¥ Context è¢«å–æ¶ˆçš„åŸå› ã€‚å¦‚æœåªä½¿ç”¨ Context åŒ…çš„ Context ç±»å‹çš„è¯ï¼Œé‚£ä¹ˆåªå¯èƒ½è¿”å› Canceled ï¼ˆä»£è¡¨è¢«æ˜ç¡®å–æ¶ˆï¼‰æˆ–è€… DeadlineExceeded ï¼ˆå› è¶…æ—¶è€Œå–æ¶ˆï¼‰
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nf&#34;&gt;Err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// è·å–Contextä¸­çš„é”®å€¼å¯¹
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nf&#34;&gt;Value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{})&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ä¸€ä¸ªdemoï¼Œå¼•ç”¨ï¼š&lt;a class=&#34;link&#34; href=&#34;https://strikefreedom.top/goroutine-concurrency-control-and-communication&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;é€šçŸ¥å¤šä¸ªå­goroutineé€€å‡ºè¿è¡Œ&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;48
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;49
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;50
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;51
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;52
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;53
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;54
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;55
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;56
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;57
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;58
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;59
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;60
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;61
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;62
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;63
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;64
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;65
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;66
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;67
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;68
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;69
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;70
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;71
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;72
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;73
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt; &lt;span class=&#34;kn&#34;&gt;package&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;main&lt;/span&gt;
 
 &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
 	&lt;span class=&#34;s&#34;&gt;&amp;#34;context&amp;#34;&lt;/span&gt;
 	&lt;span class=&#34;s&#34;&gt;&amp;#34;crypto/md5&amp;#34;&lt;/span&gt;
 	&lt;span class=&#34;s&#34;&gt;&amp;#34;fmt&amp;#34;&lt;/span&gt;
 	&lt;span class=&#34;s&#34;&gt;&amp;#34;io/ioutil&amp;#34;&lt;/span&gt;
 	&lt;span class=&#34;s&#34;&gt;&amp;#34;net/http&amp;#34;&lt;/span&gt;
 	&lt;span class=&#34;s&#34;&gt;&amp;#34;sync&amp;#34;&lt;/span&gt;
	&lt;span class=&#34;s&#34;&gt;&amp;#34;time&amp;#34;&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;favContextKey&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;wg&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;sync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;WaitGroup&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;values&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;https://www.baidu.com/&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;https://www.zhihu.com/&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cancel&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;WithCancel&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Background&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;

	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;url&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;range&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;values&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;wg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Add&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;subCtx&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;WithValue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;favContextKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;url&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;url&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;go&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;reqURL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;subCtx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;wg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;k&#34;&gt;go&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Sleep&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Second&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nf&#34;&gt;cancel&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}()&lt;/span&gt;

	&lt;span class=&#34;nx&#34;&gt;wg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Wait&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;exit main goroutine&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;reqURL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;wg&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;sync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;WaitGroup&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;defer&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;wg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Done&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;url&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;favContextKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;url&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)).(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;select&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;c1&#34;&gt;// è°ƒç”¨Doneæ–¹æ³•æ£€æµ‹æ˜¯å¦æœ‰çˆ¶èŠ‚ç‚¹è°ƒç”¨cancelæ–¹æ³•é€šçŸ¥å­èŠ‚ç‚¹é€€å‡ºè¿è¡Œ, chanè¢«closeæ—¶è§¦å‘
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Done&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;():&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;stop getting url:%s\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;url&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;url&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;StatusCode&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;StatusOK&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
				&lt;span class=&#34;nx&#34;&gt;body&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ioutil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;ReadAll&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Body&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
				&lt;span class=&#34;nx&#34;&gt;subCtx&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;WithValue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;favContextKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;resp&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Sprintf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;%s%x&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;url&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;md5&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Sum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;body&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)))&lt;/span&gt;
				&lt;span class=&#34;nx&#34;&gt;wg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Add&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
				&lt;span class=&#34;k&#34;&gt;go&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;showResp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;subCtx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;wg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Body&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Close&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
			&lt;span class=&#34;c1&#34;&gt;//å¯åŠ¨å­goroutineæ˜¯ä¸ºäº†ä¸é˜»å¡å½“å‰goroutineï¼Œè¿™é‡Œåœ¨å®é™…åœºæ™¯ä¸­å¯ä»¥å»æ‰§è¡Œå…¶ä»–é€»è¾‘ï¼Œè¿™é‡Œä¸ºäº†æ–¹ä¾¿ç›´æ¥sleepä¸€ç§’
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;			&lt;span class=&#34;c1&#34;&gt;// doSometing()
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;			&lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Sleep&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Second&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;showResp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;wg&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;sync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;WaitGroup&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;defer&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;wg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Done&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;select&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Done&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;():&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;stop showing resp&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
			&lt;span class=&#34;c1&#34;&gt;//å­goroutineé‡Œä¸€èˆ¬ä¼šå¤„ç†ä¸€äº›IOä»»åŠ¡ï¼Œå¦‚è¯»å†™æ•°æ®åº“æˆ–è€…rpcè°ƒç”¨ï¼Œè¿™é‡Œä¸ºäº†æ–¹ä¾¿ç›´æ¥æŠŠæ•°æ®æ‰“å°
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;			&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;printing: &amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;favContextKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;resp&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)))&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Sleep&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Second&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id=&#34;emptyctx&#34;&gt;emptyCtx&lt;/h2&gt;
&lt;p&gt;goæä¾›äº†ä¸¤ä¸ªåŸºæœ¬çš„contextåˆ›å»ºï¼ŒemptyCtxæ˜¯&lt;code&gt;int&lt;/code&gt;ç±»å‹çš„é‡æ–°å®šä¹‰ï¼ŒemptyCtxæ²¡æœ‰è¿‡æœŸæ—¶é—´ï¼Œä¸èƒ½è¢«å–æ¶ˆï¼Œä¸èƒ½è®¾ç½®valueï¼Œä½œç”¨ä»…ä½œä¸ºcontextæ ‘çš„æ ¹èŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
  &lt;span class=&#34;nx&#34;&gt;background&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;new&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;emptyCtx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
  &lt;span class=&#34;nx&#34;&gt;todo&lt;/span&gt;       &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;new&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;emptyCtx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Background&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Context&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;background&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;TODO&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Context&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;todo&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id=&#34;cancelctx&#34;&gt;cancelCtx&lt;/h2&gt;
&lt;p&gt;é€šè¿‡æ ¹contextï¼Œæ¯”å¦‚emptyCtxä¹‹åï¼Œè°ƒç”¨&lt;code&gt;withCancel()&lt;/code&gt;æ–¹æ³•å¯ä»¥åˆ›å»ºcancelCtxç”¨äºå–æ¶ˆæ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;æœ‰ä¸¤ç§æ–¹å¼å¯è§¦å‘å–æ¶ˆï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;è¿”å›çš„CancelFuncè¢«è°ƒç”¨ï¼Œæ­¤æ—¶ä¼šå–æ¶ˆå½“å‰contextå’Œå…¶æ‰€æœ‰çš„å­context&lt;/li&gt;
&lt;li&gt;Doneè¿™ä¸ªchanè¢«closeäº†ï¼Œæ­¤æ—¶ä¼šå–æ¶ˆå½“å‰contextå’Œå…¶æ‰€æœ‰çš„å­context&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;48
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;49
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;50
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;51
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;52
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;53
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;54
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;55
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;56
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;57
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;58
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;CancelFunc&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;// åˆ›å»ºä¸€ä¸ªå¯è¢«å–æ¶ˆçš„context
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;WithCancel&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;parent&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cancel&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;CancelFunc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;parent&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nb&#34;&gt;panic&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;cannot create context from nil parent&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;newCancelCtx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;parent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// æ„å»ºæ ‘å½¢çš„cancel
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nf&#34;&gt;propagateCancel&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;parent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;cancel&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Canceled&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// canceledæ˜¯ä¸€ä¸ªerrorå®ç°
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;newCancelCtx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;parent&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cancelCtx&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cancelCtx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;parent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;// ä¸»è¦æ˜¯å°†child ctxä¸parent ctxç»‘å®šï¼Œæ”¾åˆ°parentçš„childrenå±æ€§ä¸­
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;propagateCancel&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;parent&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;child&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;canceler&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;done&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;parent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Done&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;done&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// parent is never canceled
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;k&#34;&gt;select&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;done&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
		&lt;span class=&#34;c1&#34;&gt;// parent is already canceled
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;nx&#34;&gt;child&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;cancel&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;parent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

    &lt;span class=&#34;c1&#34;&gt;// è·å–parentçš„cancelCtxï¼Œokæ˜¯ç”¨æ¥åˆ¤æ–­çˆ¶contextæ˜¯ä¸æ˜¯CancelCtxç±»å‹çš„
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;parentCancelCtx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;parent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;mu&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;c1&#34;&gt;// parentå·²ç»è¢«å–æ¶ˆï¼Œè§¦å‘childçš„å–æ¶ˆ
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;			&lt;span class=&#34;nx&#34;&gt;child&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;cancel&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
            &lt;span class=&#34;c1&#34;&gt;// parentæ²¡æœ‰è¢«å–æ¶ˆï¼ŒæŠŠå½“å‰contextä½œä¸ºparentçš„child
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;			&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;children&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
				&lt;span class=&#34;nx&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;children&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;make&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;map&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;canceler&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{})&lt;/span&gt;
			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;children&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;child&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{}{}&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;mu&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Unlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;c1&#34;&gt;// è¡¨ç¤ºparentçš„ctxä¸æ˜¯ä¸€ä¸ªcancelCtxï¼Œæ²¡æœ‰childrenå±æ€§ï¼Œæ— æ³•æ„å»ºæˆæ ‘ï¼Œåªèƒ½é€šè¿‡parentçš„doneæ¥å‘ä¸‹ä¼ æ’­
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;nx&#34;&gt;atomic&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;AddInt32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;goroutines&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;go&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;select&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;parent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Done&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;():&lt;/span&gt;
				&lt;span class=&#34;nx&#34;&gt;child&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;cancel&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;parent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;child&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Done&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;():&lt;/span&gt;
			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}()&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;å¯è¢«å–æ¶ˆçš„contextå®ç°äº†canceleræ¥å£ï¼Œå…·ä½“å®ç°ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;48
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;49
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;50
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;51
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;52
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;canceler&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nf&#34;&gt;cancel&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;removeFromParent&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;nf&#34;&gt;Done&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;chan&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cancelCtx&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;Context&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// å­˜å‚¨çˆ¶contextçš„æŒ‡é’ˆ
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;mu&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;sync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Mutex&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;done&lt;/span&gt;     &lt;span class=&#34;kd&#34;&gt;chan&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// ä½œä¸ºå–æ¶ˆä¿¡å·çš„channelï¼Œå­åç¨‹ç›‘å¬è¯¥channelåˆ¤æ–­æ˜¯å¦è¦cancel
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;children&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;map&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;canceler&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// è¢«å…³è”çš„å¯è¢«å–æ¶ˆçš„context
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;      &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;                &lt;span class=&#34;c1&#34;&gt;// ç¬¬ä¸€æ¬¡å–æ¶ˆæ—¶è¢«è®¾ç½®
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cancelCtx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Done&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;chan&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;mu&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
   &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;done&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;done&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;make&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;chan&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{})&lt;/span&gt;
   &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
   &lt;span class=&#34;nx&#34;&gt;d&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;done&lt;/span&gt;
   &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;mu&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Unlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
   &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;d&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cancelCtx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;cancel&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;removeFromParent&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;c1&#34;&gt;// åœ¨å‘ä¸‹ä¼ æ’­cancelæ—¶, å¿…é¡»å¸¦ä¸ŠåŸå§‹çš„error
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nb&#34;&gt;panic&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;context: internal error: missing cancel error&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;mu&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;mu&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Unlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// already canceled
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;done&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;done&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;closedchan&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nb&#34;&gt;close&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;done&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;child&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;range&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;children&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;c1&#34;&gt;// å–æ¶ˆæ‰€æœ‰å­context
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;nx&#34;&gt;child&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;cancel&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;children&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;mu&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Unlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;

    &lt;span class=&#34;c1&#34;&gt;// ä»çˆ¶contextçš„childrenä¸­ç§»é™¤å½“å‰context
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;removeFromParent&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nf&#34;&gt;removeChild&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id=&#34;timerctx&#34;&gt;timerCtx&lt;/h2&gt;
&lt;p&gt;å¯è¶…æ—¶è‡ªåŠ¨å–æ¶ˆçš„contextï¼Œå†…éƒ¨ä½¿ç”¨cancelCtx + timerå®ç°ï¼Œè°ƒç”¨&lt;code&gt;WithDeadline()&lt;/code&gt;æ–¹æ³•å¯ä»¥åˆ›å»ºtimerCtxç”¨äºè¶…æ—¶å–æ¶ˆæ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;WithTimeout()æ–¹æ³•&lt;/code&gt;å’Œ&lt;code&gt;WithDeadline()æ–¹æ³•&lt;/code&gt;ï¼Œæ•ˆæœæ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯æ—¶é—´çš„å«ä¹‰ä¸ä¸€æ ·ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;WithTimeout&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;parent&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;timeout&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Duration&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;CancelFunc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;WithDeadline&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;parent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Now&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Add&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;timeout&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;å…³äºwithTimeout()æ–¹æ³•ï¼Œè¿”å›çš„cancelå‡½æ•°ï¼Œå³ä½¿ä¸ä¸»åŠ¨è°ƒç”¨ï¼Œä¹Ÿä¸å½±å“èµ„æºçš„æœ€ç»ˆé‡Šæ”¾ï¼Œå®ƒåˆ°æ—¶é—´äº†ä¹Ÿä¼šè‡ªåŠ¨è°ƒç”¨ï¼Œå»ºè®®æ˜¯æå‰ä¸»åŠ¨è°ƒç”¨ï¼Œå°½å¿«é‡Šæ”¾ï¼Œé¿å…ç­‰å¾…æ—¶é—´è¿‡é•¿å¯¼è‡´æµªè´¹ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;WithDeadline&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;parent&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;deadline&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;CancelFunc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cur&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;parent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Deadline&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cur&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Before&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;deadline&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// å¦‚æœparentå¯ä»¥æ›´æ—©ç»“æŸ, é‚£ä¹ˆè¿”å›ä¸€ä¸ªåŒ…è£…parentçš„cancelCtx
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;WithCancel&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;parent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
  &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;timerCtx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// ç»„åˆä¸€ä¸ªæ–°çš„cancelCtx
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;cancelCtx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;newCancelCtx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;parent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;deadline&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;  &lt;span class=&#34;nx&#34;&gt;deadline&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
  &lt;span class=&#34;nf&#34;&gt;propagateCancel&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;parent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// ç»„ç»‡æ ‘å½¢ç»“æ„
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;nx&#34;&gt;d&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Until&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;deadline&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;d&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// å¦‚æœæ—¶é—´å·²ç»åˆ°äº†, ç›´æ¥è§¦å‘å–æ¶ˆ
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;cancel&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;DeadlineExceeded&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;cancel&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Canceled&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
  &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;mu&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
  &lt;span class=&#34;k&#34;&gt;defer&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;mu&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Unlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// æ–°å»ºå®šæ—¶å™¨, åˆ°æœŸè§¦å‘å–æ¶ˆ
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;timer&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;AfterFunc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;cancel&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;DeadlineExceeded&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;})&lt;/span&gt;
  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
  &lt;span class=&#34;c1&#34;&gt;// è¿”å›å€¼è¿˜æœ‰ç”¨äºç›´æ¥å–æ¶ˆçš„CancelFunc
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;cancel&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Canceled&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; 
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
    
&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;timerCtx&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
  &lt;span class=&#34;nx&#34;&gt;cancelCtx&lt;/span&gt;
  &lt;span class=&#34;nx&#34;&gt;timer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Timer&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// Under cancelCtx.mu.
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
  &lt;span class=&#34;nx&#34;&gt;deadline&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Time&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id=&#34;valuectx&#34;&gt;valueCtx&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;valueCtx&lt;/code&gt;å†…éƒ¨ä»ç„¶ä½¿ç”¨&lt;code&gt;Context&lt;/code&gt;å­˜å‚¨çˆ¶&lt;code&gt;Context&lt;/code&gt;çš„æŒ‡é’ˆï¼Œå¹¶ç”¨&lt;code&gt;interface{}&lt;/code&gt;å­˜å‚¨é”®å€¼ï¼›&lt;/p&gt;
&lt;p&gt;å¦‚æœå½“å‰&lt;code&gt;valueCtx&lt;/code&gt;æ‰¾ä¸åˆ°éœ€è¦çš„&lt;code&gt;key&lt;/code&gt;ï¼Œä¼šæ²¿ç€æ ‘å‘ä¸Šä¸€ç›´æŸ¥æ‰¾ç›´åˆ°æ ¹èŠ‚ç‚¹ï¼Œç±»ä¼¼é“¾è¡¨çš„æœç´¢ï¼›&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨&lt;code&gt;WithValue&lt;/code&gt;åˆ›å»ºæ—¶ï¼Œä¼šåˆ¤æ–­&lt;code&gt;key&lt;/code&gt;æ˜¯å¦å®ç°&lt;code&gt;Comparable&lt;/code&gt;æ¥å£ã€‚å¦‚æœæ²¡æœ‰å®ç°ï¼Œä¼šè§¦å‘&lt;code&gt;panic&lt;/code&gt;ï¼›&lt;/p&gt;
&lt;p&gt;keyçš„ç±»ç±»å‹ä¸åº”è¯¥æ˜¯å†…ç½®ç±»å‹ï¼Œä»¥é¿å…å†²çªã€‚ä½¿ç”¨çš„æ—¶å€™åº”è¯¥è‡ªå®šä¹‰ç±»å‹ï¼›&lt;/p&gt;
&lt;h1 id=&#34;channel&#34;&gt;Channel&lt;/h1&gt;
&lt;p&gt;Channelçš„è®¾è®¡åŸºäºCSPæ¨¡å‹ã€‚&lt;/p&gt;
&lt;p&gt;CSPæ¨¡å‹ï¼ˆCommunicating Sequential Processï¼Œé€šä¿¡é¡ºåºè¿›ç¨‹ï¼‰ï¼Œå…è®¸ä½¿ç”¨è¿›ç¨‹ç»„æ¥æè¿°ç³»ç»Ÿï¼Œç‹¬ç«‹è¿è¡Œï¼Œå¹¶ä¸”åªé€šè¿‡æ¶ˆæ¯ä¼ é€’çš„æ–¹å¼é€šä¿¡ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬è´¨ä¸Šå°±æ˜¯ï¼Œåœ¨ä½¿ç”¨åç¨‹æ‰§è¡Œå‡½æ•°æ—¶ï¼Œä¸é€šè¿‡å†…å­˜å…±äº«(ä¼šç”¨åˆ°é”)çš„æ–¹å¼é€šä¿¡ï¼Œè€Œæ˜¯é€šè¿‡Channelé€šä¿¡ä¼ é€’æ•°æ®ã€‚&lt;/p&gt;
&lt;p&gt;åŠ¨ç”»å‚è€ƒï¼šhttps://go.xargin.com/docs/data_structure/channel/&lt;/p&gt;
&lt;h2 id=&#34;åŸºæœ¬&#34;&gt;åŸºæœ¬&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;chanæ˜¯å¼•ç”¨ç±»å‹ï¼Œä½¿ç”¨makeå…³é”®å­—åˆ›å»ºï¼Œæœªåˆå§‹åŒ–æ—¶çš„é›¶å€¼æ˜¯nilï¼Œå¦‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;ch := make(chan string, 10)&lt;/code&gt;ï¼Œåˆ›å»ºä¸€ä¸ªèƒ½å¤„ç†stringçš„ç¼“å†²åŒºå¤§å°ä¸º10çš„channelï¼Œæ•ˆæœç›¸å½“äºå¼‚æ­¥é˜Ÿåˆ—ï¼Œé™¤éç¼“å†²åŒºç”¨å®Œï¼Œå¦åˆ™ä¸ä¼šé˜»å¡ï¼›&lt;/p&gt;
&lt;p&gt;&lt;code&gt;ch := make(chan string)&lt;/code&gt;ï¼Œåˆ™åˆ›å»ºäº†ä¸€ä¸ªä¸å­˜åœ¨ç¼“å†²åŒºçš„channelï¼Œæ•ˆæœç›¸å½“äºåŒæ­¥é˜»å¡é˜Ÿåˆ—ï¼Œlenæ°¸è¿œè¿”å›0ã€‚&lt;/p&gt;
&lt;p&gt;å³ å‡å¦‚æ²¡æœ‰æ¥æ”¶è€…ï¼ŒåŒä¸€ä¸ªæ–¹æ³•å†…ï¼Œè¿ç»­å‘é€ä¸¤æ¬¡æ•°æ®ï¼Œç¬¬ä¸€æ¬¡å¦‚æœæ²¡æœ‰è¢«æ¥æ”¶çš„è¯ï¼Œæ­¤æ—¶å°±é˜»å¡äº†ï¼Œè½®ä¸åˆ°ç¬¬äºŒæ¬¡å‘é€ï¼Œä½†å¦‚æœsize = 1ï¼Œç¬¬ä¸€æ¬¡å‘é€çš„æ•°æ®å°±ä¼šè¿›å…¥bufæ•°ç»„ï¼Œä¸é˜»å¡ï¼Œåˆ°äº†ç¬¬äºŒæ¬¡å‘é€æ‰é˜»å¡ï¼›&lt;/p&gt;
&lt;p&gt;&lt;code&gt;var ch chan int&lt;/code&gt;è¡¨ç¤ºåˆ›å»ºäº†ä¸€ä¸ªnil channelï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;channelä½œä¸ºé€šé“ï¼Œè´Ÿè´£åœ¨å¤šä¸ªgoroutineé—´ä¼ é€’æ•°æ®ï¼Œè§£å†³å¤šçº¿ç¨‹ä¸‹å…±äº«æ•°æ®ç«äº‰é—®é¢˜ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;len()&lt;/code&gt;æ–¹æ³•è·å–buffä¸­æœªè¢«è¯»å–çš„æ•°é‡ï¼Œå³qcountçš„å€¼ï¼›&lt;/p&gt;
&lt;p&gt;&lt;code&gt;cap()&lt;/code&gt;æ–¹æ³•è·å–buffæ•°ç»„çš„é•¿åº¦&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¸¦æœ‰ &amp;lt;- çš„chanæ˜¯æœ‰æ–¹å‘çš„ï¼Œä¸å¸¦ &amp;lt;- çš„chanæ˜¯åŒå‘çš„ï¼Œæ¯”å¦‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;  &lt;span class=&#34;kd&#34;&gt;chan&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;        &lt;span class=&#34;c1&#34;&gt;// åŒå‘chanï¼Œå¯ä»¥å‘é€å’Œæ¥æ”¶string  chan&amp;lt;- struct{}    // åªèƒ½å‘é€structåˆ°chanä¸­  &amp;lt;-chan int         // åªèƒ½ä»chanä¸­æ¥æ”¶int
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;chanå¯ä»¥æ˜¯ä»»ä½•ç±»å‹çš„ï¼Œæ¯”å¦‚å¯ä»¥æ˜¯ chan&amp;lt;- ç±»å‹ï¼Œ&amp;lt;-æ€»æ˜¯å°½é‡å’Œå·¦è¾¹çš„chanç»“åˆï¼Œæ¯”å¦‚&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;kd&#34;&gt;chan&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;chan&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// ç­‰ä»·äº chan&amp;lt;- (chan int)chan&amp;lt;- &amp;lt;-chan int  // ç­‰ä»·äº chan&amp;lt;- (&amp;lt;-chan int)&amp;lt;-chan &amp;lt;-chan int  // ç­‰ä»·äº &amp;lt;-chan (&amp;lt;-chan int)chan (&amp;lt;-chan int)  // ç­‰ä»·äº chan (&amp;lt;-chan int)
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;æ¥æ”¶æ•°æ®æ—¶å¯ä»¥æœ‰ä¸¤ä¸ªè¿”å›å€¼ï¼Œç¬¬ä¸€ä¸ªæ˜¯è¿”å›çš„å…ƒç´ ï¼Œç¬¬äºŒä¸ªæ˜¯boolç±»å‹ï¼Œè¡¨ç¤ºæ˜¯å¦æˆåŠŸåœ°ä»chanä¸­è¯»å–åˆ°ä¸€ä¸ªå€¼ã€‚å¦‚æœæ˜¯falseï¼Œè¯´æ˜chanå·²ç»è¢«closeå¹¶ä¸”chanä¸­æ²¡æœ‰ç¼“å­˜çš„æ•°æ®ï¼Œæ­¤æ—¶ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯é›¶å€¼ã€‚æ‰€ä»¥ï¼Œå¦‚æœæ¥æ”¶æ—¶ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯é›¶å€¼ï¼Œå¯èƒ½æ˜¯senderçœŸçš„å‘é€äº†é›¶å€¼ï¼Œä¹Ÿå¯èƒ½æ˜¯closedå¹¶ä¸”æ²¡æœ‰å…ƒç´ å¯¼è‡´çš„ï¼Œæ‰€ä»¥æœ€å¥½é€šè¿‡ç¬¬äºŒä¸ªè¿”å›å€¼æ¥ç¡®å®šã€‚&lt;/li&gt;
&lt;li&gt;åŒå‘chanå¯ä»¥èµ‹å€¼ç»™å•å‘chanï¼Œä½†åè¿‡æ¥ä¸å¯ä»¥ï¼›&lt;/li&gt;
&lt;li&gt;ç»™ä¸€ä¸ªnil channelå‘é€æ•°æ®ï¼Œä¼šé€ æˆæ°¸ä¹…é˜»å¡ï¼Œä»ä¸€ä¸ªnil channelæ¥æ”¶æ•°æ®ï¼Œä¼šé€ æˆæ°¸ä¹…é˜»å¡ï¼›&lt;/li&gt;
&lt;li&gt;ç»™ä¸€ä¸ªå·²ç»å…³é—­çš„channelå‘é€æ•°æ®ï¼Œä¼šå¼•èµ·panicï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;8
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// å› ä¸ºæ˜¯æ— ç¼“å†²åŒºçš„ï¼Œåªæœ‰å½“å­˜åœ¨receiverçš„æ—¶å€™æ‰èƒ½sendæˆåŠŸï¼Œå¦åˆ™å°±ä¸€ç›´é˜»å¡ï¼Œæ‰€ä»¥å½“closeçš„æ—¶å€™ï¼Œå°±ä¼španic
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ch&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;make&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;chan&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;go&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ch&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}()&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// panic: send on closed channel
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Sleep&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Second&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;go&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;close&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}()&lt;/span&gt;
&lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Sleep&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Second&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;nx&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ch&lt;/span&gt;
&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ä»ä¸€ä¸ªå·²ç»å…³é—­çš„channelæ¥æ”¶æ•°æ®ï¼Œå¦‚æœç¼“å†²åŒºä¸ºç©ºï¼Œåˆ™è¿”å›ä¸€ä¸ªé›¶å€¼ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å·²å…³é—­çš„channelå†æ¬¡å…³é—­ï¼Œä¼španicï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¯¹äºä¸€ä¸ªä¸å…³é—­çš„channelï¼Œåœ¨æ–¹æ³•ç»“æŸåï¼Œåªè¦channelæ²¡æœ‰è¢«å¼•ç”¨ï¼Œä¼šè¢«GCè‡ªåŠ¨å›æ”¶ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å…³é—­channelçš„åŸåˆ™ï¼šä¸è¦å‘å·²å…³é—­çš„channelå‘é€æ•°æ®æˆ–è€…å†æ¬¡å…³é—­ï¼Œå…³é—­çš„åŠ¨ä½œå°½é‡åœ¨senderåšï¼Œä¸»è¦è¿˜æ˜¯åˆ†åœºæ™¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ä¸€ä¸ªsenderä¸€ä¸ªreceiverçš„åœºæ™¯ï¼šåœ¨senderå¤„å…³é—­ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¸€ä¸ªsenderå¤šä¸ªrecevierçš„åœºæ™¯ï¼šåœ¨senderå¤„å…³é—­ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¤šä¸ªsenderä¸€ä¸ªreceiverçš„åœºæ™¯ï¼šå¢åŠ ä¸€ä¸ªä¼ é€’å…³é—­ä¿¡å·çš„ channelï¼Œreceiver é€šè¿‡ä¿¡å· channel ä¸‹è¾¾å…³é—­æ•°æ® channel æŒ‡ä»¤ã€‚senders ç›‘å¬åˆ°å…³é—­ä¿¡å·åï¼Œåœæ­¢å‘é€æ•°æ®ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;dataCh&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;make&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;chan&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;100&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;stopCh&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;make&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;chan&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{})&lt;/span&gt;
	&lt;span class=&#34;c1&#34;&gt;// senders
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;NumSenders&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;k&#34;&gt;go&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
            &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
                &lt;span class=&#34;k&#34;&gt;select&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
                &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;stopCh&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
                    &lt;span class=&#34;c1&#34;&gt;// æ¥æ”¶å…³é—­ä¿¡å·é€€å‡º
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;                    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt;
                &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;dataCh&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rand&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Intn&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Max&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
                &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
            &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
        &lt;span class=&#34;p&#34;&gt;}()&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// the receiver
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;go&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;value&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;range&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;dataCh&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
            &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;value&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Max&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
                &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;send stop signal to senders.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
                &lt;span class=&#34;c1&#34;&gt;// ç›´æ¥å…³é—­
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;                &lt;span class=&#34;nb&#34;&gt;close&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;stopCh&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
                &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt;
            &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

            &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;}()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¤šä¸ªsenderå¤šä¸ªreceiverçš„åœºæ™¯ï¼šå†å¢åŠ ä¸€ä¸ªä¸­é—´çš„channelï¼Œç”¨æ¥æ¥æ”¶æ ‡è¯†å…³é—­çš„æ•°æ®ï¼Œæ”¶åˆ°åç›´æ¥closeä¼ é€’å…³é—­çš„ä¿¡å·channelå³å¯ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;48
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;49
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;50
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;51
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;52
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;dataCh&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;make&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;chan&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;100&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;stopCh&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;make&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;chan&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{})&lt;/span&gt;

    &lt;span class=&#34;c1&#34;&gt;// å½“ä½¿ç”¨selectå‘é€æ•°æ®åˆ°toStopæ—¶ï¼Œä¸€å®šè¦æœ‰bufferï¼Œé˜²æ­¢ä¸­é—´channelæ²¡å‡†å¤‡å¥½è€Œé”™å¤±å…³é—­æ—¶æœºçš„é—®é¢˜
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;toStop&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;make&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;chan&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;stoppedBy&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;

    &lt;span class=&#34;c1&#34;&gt;// ä¸­é—´channelï¼Œç”¨äºæ¥æ”¶æ ‡è¯†å…³é—­çš„æ•°æ®
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;go&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;nx&#34;&gt;stoppedBy&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;toStop&lt;/span&gt;
        &lt;span class=&#34;nb&#34;&gt;close&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;stopCh&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;}()&lt;/span&gt;

    &lt;span class=&#34;c1&#34;&gt;// senders
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;NumSenders&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;k&#34;&gt;go&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
            &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
                &lt;span class=&#34;nx&#34;&gt;value&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rand&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Intn&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Max&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
                &lt;span class=&#34;c1&#34;&gt;// å‘é€è€…ä¹Ÿå¯ä»¥å…³é—­
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;                &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;value&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
                    &lt;span class=&#34;nx&#34;&gt;toStop&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;sender#&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt;
                    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt;
                &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

                &lt;span class=&#34;k&#34;&gt;select&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
                &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;stopCh&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// çœŸæ­£çš„åœæ­¢
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;                    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt;
                &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;dataCh&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
                &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
            &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
        &lt;span class=&#34;p&#34;&gt;}(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;strconv&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Itoa&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

    &lt;span class=&#34;c1&#34;&gt;// receivers
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;NumReceivers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;k&#34;&gt;go&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
            &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
                &lt;span class=&#34;k&#34;&gt;select&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
                &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;stopCh&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;// çœŸæ­£çš„åœæ­¢
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;                    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt;
                &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;value&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;dataCh&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
                    &lt;span class=&#34;c1&#34;&gt;// æ¥æ”¶è€…ä¹Ÿèƒ½è¿›è¡Œå…³é—­
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;                    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;value&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Max&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
                        &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;toStop&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;receiver#&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
                        &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt;
                    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

                    &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
                &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
            &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
        &lt;span class=&#34;p&#34;&gt;}(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;strconv&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Itoa&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;channelåœ¨å…³é—­æ—¶ä¼šè‡ªåŠ¨é€€å‡ºå¾ªç¯ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;nx&#34;&gt;ch&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;make&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;chan&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;100&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;elem&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;range&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ch&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;elem&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;æ³¨æ„channelä¸æä¾›è·¨goroutineçš„æ•°æ®ä¿æŠ¤ï¼Œå¦‚æœå¤šä¸ªchannelä¼ é€’ä¸€ä»½æ•°æ®çš„æŒ‡é’ˆï¼Œä½¿å¾—æ¯ä¸ªgoroutineå¯ä»¥æ“ä½œåŒä¸€ä»½æ•°æ®ï¼Œä¹Ÿä¼šå‡ºç°å¹¶å‘å®‰å…¨é—®é¢˜ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;/th&gt;
&lt;th&gt;nil&lt;/th&gt;
&lt;th&gt;empty&lt;/th&gt;
&lt;th&gt;full&lt;/th&gt;
&lt;th&gt;not full &amp;amp; empty&lt;/th&gt;
&lt;th&gt;closed&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;receive&lt;/td&gt;
&lt;td&gt;block&lt;/td&gt;
&lt;td&gt;block&lt;/td&gt;
&lt;td&gt;read value&lt;/td&gt;
&lt;td&gt;read value&lt;/td&gt;
&lt;td&gt;è¿”å›æœªè¯»çš„å…ƒç´ ï¼Œè¯»å®Œåè¿”å›é›¶å€¼&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;send&lt;/td&gt;
&lt;td&gt;block&lt;/td&gt;
&lt;td&gt;write value&lt;/td&gt;
&lt;td&gt;block&lt;/td&gt;
&lt;td&gt;writed value&lt;/td&gt;
&lt;td&gt;panic&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;close&lt;/td&gt;
&lt;td&gt;panic&lt;/td&gt;
&lt;td&gt;closedï¼Œæ²¡æœ‰æœªè¯»å…ƒç´ &lt;/td&gt;
&lt;td&gt;closedï¼Œä¿ç•™æœªè¯»å…ƒç´ &lt;/td&gt;
&lt;td&gt;closedï¼Œä¿ç•™æœªè¯»å…ƒç´ &lt;/td&gt;
&lt;td&gt;panic&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id=&#34;æ•°æ®ç»“æ„&#34;&gt;æ•°æ®ç»“æ„&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;hchan&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;qcount&lt;/span&gt;   &lt;span class=&#34;kt&#34;&gt;uint&lt;/span&gt;   &lt;span class=&#34;c1&#34;&gt;// å·²ç»æ¥æ”¶ä½†è¿˜æ²¡è¢«å–èµ°çš„å…ƒç´ ä¸ªæ•°ï¼Œå³channelä¸­çš„å¾ªç¯æ•°ç»„çš„å…ƒç´ ä¸ªæ•°
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;dataqsiz&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint&lt;/span&gt;   &lt;span class=&#34;c1&#34;&gt;// channelä¸­çš„å¾ªç¯æ•°ç»„çš„é•¿åº¦, ch:=make(chan int, 10), å°±æ˜¯è¿™ä¸ª10
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;buf&lt;/span&gt;      &lt;span class=&#34;nx&#34;&gt;unsafe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Pointer&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// channelä¸­ç¼“å†²åŒºæ•°æ®æŒ‡é’ˆï¼Œbufæ˜¯ä¸€ä¸ªå¾ªç¯æ•°ç»„ï¼Œbufçš„æ€»å¤§å°æ˜¯elemsizeçš„æ•´æ•°å€
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;elemsize&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint16&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// å½“å‰channelèƒ½å¤Ÿæ”¶å‘çš„å…ƒç´ å¤§å°
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;closed&lt;/span&gt;   &lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;elemtype&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;_type&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// å½“å‰channelèƒ½å¤Ÿæ”¶å‘çš„å…ƒç´ ç±»å‹
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;sendx&lt;/span&gt;    &lt;span class=&#34;kt&#34;&gt;uint&lt;/span&gt;   &lt;span class=&#34;c1&#34;&gt;// æŒ‡å‘åº•å±‚å¾ªç¯æ•°ç»„bufï¼Œè¡¨ç¤ºå½“å‰å¯å‘é€çš„å…ƒç´ ä½ç½®çš„ç´¢å¼•å€¼ï¼Œå½“sendx=dataqsizæ—¶ï¼Œä¼šå›åˆ°bufæ•°ç»„çš„èµ·ç‚¹ï¼Œä¸€æ—¦æ¥æ”¶æ–°æ•°æ®ï¼ŒæŒ‡é’ˆå°±ä¼šåŠ ä¸Šelemsizeï¼Œç§»å‘ä¸‹ä¸ªä½ç½®
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;recvx&lt;/span&gt;    &lt;span class=&#34;kt&#34;&gt;uint&lt;/span&gt;   &lt;span class=&#34;c1&#34;&gt;// æŒ‡å‘åº•å±‚å¾ªç¯æ•°ç»„bufï¼Œè¡¨ç¤ºå½“å‰å¯æ¥æ”¶çš„å…ƒç´ ä½ç½®çš„ç´¢å¼•å€¼
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;recvq&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;waitq&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;// ç­‰å¾…æ¥æ”¶é˜Ÿåˆ—ï¼Œå­˜å‚¨å½“å‰channelå› ç¼“å†²åŒºç©ºé—´ä¸è¶³è€Œé˜»å¡çš„goroutineåˆ—è¡¨ï¼ŒåŒå‘é“¾è¡¨
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;sendq&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;waitq&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;// ç­‰å¾…å‘é€é˜Ÿåˆ—ï¼Œå­˜å‚¨å½“å‰channelå› ç¼“å†²åŒºç©ºé—´ä¸è¶³è€Œé˜»å¡çš„goroutineåˆ—è¡¨ï¼ŒåŒå‘é“¾è¡¨
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;lock&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;mutex&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;// äº’æ–¥é”ï¼Œä¿è¯æ¯ä¸ªè¯»channelæˆ–å†™channelçš„æ“ä½œéƒ½æ˜¯åŸå­çš„ï¼Œä¿æŠ¤hchanå’Œsudogä¸Šçš„å­—æ®µã€‚
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// æŒæœ‰lockæ—¶ï¼Œç¦æ­¢æ›´æ”¹å¦ä¸€ä¸ªGçš„çŠ¶æ€(æ¯”å¦‚ä¸è¦æŠŠçŠ¶æ€æ”¹æˆready)ï¼Œé˜²æ­¢æ­»é”
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;// åŒå‘é“¾è¡¨
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// sudogè¡¨ç¤ºgoroutineï¼Œæ˜¯å¯¹goroutineçš„ä¸€å±‚å°è£…ï¼Œä»£è¡¨ä¸€ä¸ªåœ¨ç­‰å¾…é˜Ÿåˆ—ä¸­çš„G
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// ä¸€ä¸ªGå¯ä»¥å‡ºç°åœ¨å¤šä¸ªç­‰å¾…é˜Ÿåˆ—ä¸Šï¼Œå› æ­¤ä¸€ä¸ªGå¯ä»¥æœ‰å¤šä¸ªsudog
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;waitq&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;first&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;sudog&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;last&lt;/span&gt;  &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;sudog&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;sudog&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;g&lt;/span&gt;    &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;g&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;next&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;sudog&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;prev&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;sudog&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;elem&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;unsafe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Pointer&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id=&#34;åˆå§‹åŒ–&#34;&gt;åˆå§‹åŒ–&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;makechan&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;t&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;chantype&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;size&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;hchan&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;elem&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;elem&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// ç•¥å»æ£€æŸ¥ä»£ç ï¼Œæ£€æŸ¥æ•°æ®é¡¹å¤§å°æ˜¯å¦è¶…è¿‡64KBï¼Œæ˜¯å¦æœ‰é”™è¯¯çš„å†…å­˜å¯¹é½ï¼Œç¼“å†²åŒºå¤§å°æ˜¯å¦æº¢å‡º
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;

    &lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;hchan&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;switch&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;mem&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
      &lt;span class=&#34;c1&#34;&gt;// chançš„sizeæˆ–è€…å…ƒç´ çš„sizeæ˜¯0ï¼Œä¸å¿…åˆ›å»ºbuf
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;hchan&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)(&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;mallocgc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;hchanSize&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
      &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buf&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;raceaddr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;elem&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ptrdata&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
      &lt;span class=&#34;c1&#34;&gt;// å…ƒç´ ä¸æ˜¯æŒ‡é’ˆï¼Œåˆ†é…ä¸€å—è¿ç»­çš„å†…å­˜ç»™hchanæ•°æ®ç»“æ„å’Œbuf
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;hchan&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)(&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;mallocgc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;hchanSize&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;mem&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
            &lt;span class=&#34;c1&#34;&gt;// hchanæ•°æ®ç»“æ„åé¢ç´§æ¥ç€å°±æ˜¯buf
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buf&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;add&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;unsafe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Pointer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;hchanSize&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
      &lt;span class=&#34;c1&#34;&gt;// å…ƒç´ åŒ…å«æŒ‡é’ˆï¼Œé‚£ä¹ˆå•ç‹¬åˆ†é…buf
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;new&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;hchan&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
      &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buf&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;mallocgc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;mem&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;elem&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
  
    &lt;span class=&#34;c1&#34;&gt;// å…ƒç´ å¤§å°ã€ç±»å‹ã€å®¹é‡éƒ½è®°å½•ä¸‹æ¥
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;elemsize&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;uint16&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;elem&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;size&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;elemtype&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;elem&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;dataqsiz&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;uint&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;size&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;nf&#34;&gt;lockInit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;lockRankHchan&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;
  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id=&#34;å‘é€æ•°æ®&#34;&gt;å‘é€æ•°æ®&lt;/h2&gt;
&lt;p&gt;ä½¿ç”¨&lt;code&gt;ch &amp;lt;- &amp;quot;test&amp;quot;&lt;/code&gt;å‘é€æ•°æ®ï¼Œæœ€ç»ˆä¼šè°ƒç”¨&lt;code&gt;chansend()&lt;/code&gt;å‡½æ•°å‘é€æ•°æ®ï¼Œè¯¥å‡½æ•°è®¾ç½®äº†é˜»å¡å‚æ•°ä¸ºtrueï¼›&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;å¦‚æœchanæ˜¯nilï¼Œåˆ™æŠŠå‘é€è€…çš„goroutine parkï¼ˆé˜»å¡ä¼‘çœ ï¼‰ï¼Œæ­¤æ—¶å‘é€è€…å°†è¢«æ°¸ä¹…é˜»å¡ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¦‚æœchanæ²¡æœ‰è¢«closeï¼Œä½†æ˜¯chanæ»¡äº†ï¼Œåˆ™ç›´æ¥è¿”å›falseï¼Œä½†æ˜¯ç”±äºé˜»å¡å‚æ•°ä¸ºtrueï¼Œè¿™éƒ¨åˆ†ä¸ä¼šè¢«æ‰§è¡Œï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¸Šé”&lt;/strong&gt;ï¼Œä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œå†æ¬¡æ£€æŸ¥chanæ˜¯å¦è¢«closeï¼Œ&lt;strong&gt;å¦‚æœè¢«closeï¼Œå†å¾€é‡Œå‘æ•°æ®ä¼šè§¦å‘ è§£é”ï¼Œpanic&lt;/strong&gt;ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åŒæ­¥å‘é€ - &lt;strong&gt;ä¼˜å…ˆå‘é€ç»™ç­‰å¾…æ¥æ”¶çš„G&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å¦‚æœ&lt;strong&gt;æ²¡è¢«closeï¼Œå½“recvqå­˜åœ¨ç­‰å¾…çš„æ¥æ”¶è€…æ—¶&lt;/strong&gt;ï¼Œé€šè¿‡&lt;code&gt;send()&lt;/code&gt;å‡½æ•°ï¼Œå–å‡ºç¬¬ä¸€ä¸ªç­‰å¾…çš„goroutineï¼Œç›´æ¥å‘é€æ•°æ®ï¼Œä¸éœ€è¦å…ˆæ”¾åˆ°bufä¸­ï¼›&lt;/p&gt;
&lt;p&gt;&lt;code&gt;send()&lt;/code&gt;å‡½æ•°å°†å› ä¸ºç­‰å¾…æ•°æ®çš„æ¥æ”¶è€Œé˜»å¡çš„goroutineçš„çŠ¶æ€ä»Gwaitingæˆ–è€…Gscanwaitingæ”¹ä¸ºGrunnableï¼ŒæŠŠgoroutineç»‘å®šåˆ°Pçš„LRQä¸­ï¼Œ&lt;strong&gt;ç­‰å¾…ä¸‹ä¸€è½®è°ƒåº¦&lt;/strong&gt;æ—¶ä¼šç«‹å³æ‰§è¡Œè¿™ä¸ªç­‰å¾…å‘é€æ•°æ®çš„goroutineï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¼‚æ­¥å‘é€ - &lt;strong&gt;å…¶æ¬¡æ˜¯å‘é€åˆ°bufåŒº&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å½“recvqä¸­æ²¡æœ‰ç­‰å¾…çš„æ¥æ”¶è€…ï¼Œä¸”bufåŒºå­˜åœ¨ç©ºä½™ç©ºé—´æ—¶&lt;/strong&gt;ï¼Œä¼šä½¿ç”¨&lt;code&gt;chanbuf()&lt;/code&gt;å‡½æ•°è·å–&lt;strong&gt;sendxç´¢å¼•å€¼&lt;/strong&gt;ï¼Œè®¡ç®—å‡ºä¸‹ä¸€ä¸ªå¯ä»¥å­˜å‚¨æ•°æ®çš„ä½ç½®ï¼Œç„¶åè°ƒç”¨&lt;code&gt;typedmemmove()&lt;/code&gt;å‡½æ•°å°†è¦å‘é€çš„æ•°æ®æ‹·è´åˆ°buffåŒºï¼Œå¢åŠ sendxç´¢å¼•å’Œqcountè®¡æ•°å™¨ï¼Œå®Œæˆä¹‹åè§£é”ï¼Œè¿”å›æˆåŠŸï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;é˜»å¡å‘é€ - &lt;strong&gt;æœ€åæ‰ä¿å­˜åœ¨å¾…å‘é€é˜Ÿåˆ—ï¼Œé˜»å¡ï¼ˆé˜»å¡åªå‘ç”Ÿåœ¨è¿™é‡Œï¼Œæ­¤æ—¶Gå’ŒMåˆ†ç¦»ï¼‰&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å½“recvqä¸­æ²¡æœ‰ç­‰å¾…çš„æ¥æ”¶è€…ï¼Œä¸”bufåŒºå·²æ»¡æˆ–ä¸å­˜åœ¨bufåŒºæ—¶&lt;/strong&gt;ï¼Œä¼šå…ˆè°ƒç”¨&lt;code&gt;getg()&lt;/code&gt;å‡½æ•°è·å–æ­£åœ¨å‘é€è€…çš„goroutineï¼Œæ‰§è¡Œ&lt;code&gt;acquireSudog()&lt;/code&gt;å‡½æ•°è·å–sudoGå¯¹è±¡ï¼Œè®¾ç½®æ­¤æ¬¡é˜»å¡å‘é€çš„ç›¸å…³ä¿¡æ¯ï¼ˆå¦‚å‘é€çš„channelã€æ˜¯å¦åœ¨selectæ§åˆ¶ç»“æ„ä¸­å’Œå¾…å‘é€æ•°æ®çš„å†…å­˜åœ°å€ã€å‘é€æ•°æ®çš„goroutineï¼‰&lt;/p&gt;
&lt;p&gt;ç„¶åå°†è¯¥sudoGå¯¹è±¡åŠ å…¥sendqé˜Ÿåˆ—ï¼Œè°ƒç”¨&lt;code&gt;goparkunlock()&lt;/code&gt;å‡½æ•°è®©å½“å‰å‘é€è€…çš„goroutineè¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œè¡¨ç¤ºå½“å‰goroutineæ­£åœ¨ç­‰å¾…å…¶ä»–goroutineä»channelä¸­æ¥æ”¶æ•°æ®ï¼Œç­‰å¾…è°ƒåº¦å™¨å”¤é†’ï¼›&lt;/p&gt;
&lt;p&gt;æ­¤æ—¶len()è¿”å›å€¼ä¸º0ï¼Œæ•°æ®çš„å‘é€æ˜¯é˜»å¡åœ¨æ–¹æ³•ä¸­çš„ã€‚&lt;/p&gt;
&lt;p&gt;è°ƒåº¦å™¨å”¤é†’åï¼Œå°†ä¸€äº›å±æ€§å€¼è®¾ç½®ä¸ºé›¶ï¼Œå¹¶é‡Šæ”¾sudogå¯¹è±¡ï¼Œè¡¨ç¤ºå‘channelå‘é€æ•°æ®ç»“æŸï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;channelå‘é€æ•°æ®æ—¶æ¶‰åŠä¸¤æ¬¡goroutineçš„è°ƒåº¦&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å½“æ¥æ”¶é˜Ÿåˆ—é‡Œå­˜åœ¨sudoGå¯ä»¥ç›´æ¥å‘é€æ•°æ®æ—¶ï¼Œæ‰§è¡Œ&lt;code&gt;goready()&lt;/code&gt;å‡½æ•°ï¼Œå°†Gä»Gwaitingæˆ–GScanwaitingè½¬ä¸ºGrunnableï¼Œç­‰å¾…ä¸‹æ¬¡è°ƒåº¦è§¦å‘ï¼Œäº¤ç”±Mæ‰§è¡Œï¼›&lt;/li&gt;
&lt;li&gt;å½“æ²¡æœ‰ç­‰å¾…æ¥æ”¶æ•°æ®çš„Gï¼Œå¹¶ä¸”æ²¡æœ‰ç¼“å†²åŒºï¼Œæˆ–è€…ç¼“å†²åŒºå·²æ»¡æ—¶ï¼Œæ‰§è¡Œ&lt;code&gt;gopark()&lt;/code&gt;å‡½æ•°æŒ‚èµ·å½“å‰Gï¼Œå°†Gé˜»å¡ï¼Œæ­¤æ—¶çŠ¶æ€ä¸ºGwaitingï¼Œè®©å‡ºCPUç­‰å¾…è°ƒåº¦å™¨è°ƒåº¦ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;  1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 48
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 49
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 50
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 51
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 52
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 53
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 54
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 55
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 56
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 57
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 58
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 59
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 60
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 61
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 62
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 63
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 64
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 65
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 66
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 67
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 68
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 69
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 70
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 71
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 72
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 73
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 74
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 75
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 76
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 77
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 78
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 79
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 80
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 81
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 82
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 83
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 84
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 85
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 86
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 87
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 88
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 89
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 90
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 91
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 92
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 93
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 94
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 95
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 96
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 97
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 98
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 99
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;100
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;101
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;102
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;103
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;104
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;105
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;106
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;107
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;108
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;109
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;110
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;111
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;112
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;113
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// epæŒ‡çš„æ˜¯ç”¨æ¥å‘é€æ•°æ®çš„å†…å­˜æŒ‡é’ˆï¼Œæ•°æ®ç±»å‹ä¸hchanä¸­çš„ç±»å‹ä¸€è‡´
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// è¿”å›å€¼è¡¨ç¤ºå¸¦å‘é€çš„æ•°æ®æ˜¯å¦ send æˆåŠŸï¼Œå³æ˜¯å¦è¢«æ¥å—ï¼Œæ¯”å¦‚è¿›buffæˆ–è€…è¢«æ¥æ”¶è€…æ¥æ”¶ï¼›
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// ch &amp;lt;- [val] æ—¶ï¼Œblock=true; selectæ—¶ï¼Œblock=false
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;chansend&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;hchan&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ep&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;unsafe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Pointer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;block&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;callerpc&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uintptr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;c1&#34;&gt;// å¦‚æœchanæ˜¯nilï¼Œåˆ™æŠŠå‘é€è€…çš„goroutine parkï¼ˆé˜»å¡ä¼‘çœ ï¼‰ï¼Œæ­¤æ—¶å‘é€è€…å°†è¢«æ°¸ä¹…é˜»å¡
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;block&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
		&lt;span class=&#34;nf&#34;&gt;gopark&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;waitReasonChanSendNilChan&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;traceEvGoStop&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nf&#34;&gt;throw&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;unreachable&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;raceenabled&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nf&#34;&gt;racereadpc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;raceaddr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;callerpc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;funcPC&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;chansend&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

    &lt;span class=&#34;c1&#34;&gt;// ä¸‹é¢ä»£ç è¿›é’ˆå¯¹selectåœºæ™¯
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// å½“chanä¸ä¸ºnullï¼Œä¸”æ²¡è¢«closeï¼Œfullæ–¹æ³•åˆ¤æ–­chanå‘é€æ˜¯å¦é˜»å¡ï¼Œæ˜¯åˆ™ç›´æ¥è¿”å›true
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// fullæ–¹æ³•æœ‰ä¸¤ç§æƒ…å†µåˆ¤æ–­æ˜¯å¦å¯å‘é€
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// 1. å¦‚æœhchan.dataqsiz=0ï¼Œè¯´æ˜æ˜¯é˜»å¡é˜Ÿåˆ—ï¼Œå¦‚æœæ­¤æ—¶hchan.recvq.first==nilï¼Œè¯´æ˜æ²¡æœ‰æ¥æ”¶è€…ï¼Œå‘é€é˜»å¡
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// 2. æ¯”è¾ƒhchan.qcountæ˜¯å¦ç­‰äºhchan.dataqsizï¼Œå¦‚æœæ˜¯è¯´æ˜chanå·²æ»¡ï¼Œå‘é€é˜»å¡
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;block&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;closed&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;full&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
    
    &lt;span class=&#34;c1&#34;&gt;// ä¸Šé”
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nf&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;c1&#34;&gt;// å¦‚æœchanè¢«å…³é—­ï¼Œå†å¾€é‡Œå‘é€æ•°æ®å°±ä¼šè§£é”ï¼Œç„¶åpanic
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;closed&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nf&#34;&gt;unlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nb&#34;&gt;panic&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;plainError&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;send on closed channel&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;c1&#34;&gt;// å¦‚æœchanæ²¡å…³é—­ï¼Œè·å–æ¥æ”¶è€…ç­‰å¾…é˜Ÿåˆ—ä¸­çš„ç¬¬ä¸€ä¸ªGå¼€å§‹å‘é€æ•°æ®
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;sg&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;recvq&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;dequeue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;sg&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;c1&#34;&gt;// Gå­˜åœ¨ï¼Œè°ƒç”¨sendå‡½æ•°ï¼Œsendå‡½æ•°ä¸»è¦å®Œæˆä¸¤ä»¶äº‹
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;c1&#34;&gt;// 1. è°ƒç”¨sendDirect()å‡½æ•°å°†æ•°æ®æ‹·è´åˆ°æ¥æ”¶å˜é‡çš„å†…å­˜åœ°å€ä¸Š
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;c1&#34;&gt;// 2. è°ƒç”¨goready()å‡½æ•°å°†ç­‰å¾…æ¥æ”¶çš„é˜»å¡Gçš„çŠ¶æ€ä»Gwaitingæˆ–è€…Gscanwaitingæ”¹ä¸ºGrunnableï¼ŒæŠŠGç»‘å®šåˆ°Pçš„LRQä¸­ï¼Œä¸‹ä¸€è½®è°ƒåº¦æ—¶ä¼šå”¤é†’è¿™ä¸ªç­‰å¾…æ¥æ”¶æ•°æ®çš„Gç«‹å³æ‰§è¡Œã€‚
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;nf&#34;&gt;send&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;sg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ep&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;unlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;c1&#34;&gt;// å½“recvqä¸­æ²¡æœ‰ç­‰å¾…æ¥æ”¶æ•°æ®çš„Gï¼Œä¸”chançš„ç¼“å†²åŒºè¿˜æœ‰ç©ºé—´æ—¶
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;qcount&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;dataqsiz&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;c1&#34;&gt;// è°ƒç”¨chanbufè·å–sendxç´¢å¼•çš„å…ƒç´ çš„æŒ‡é’ˆï¼Œï¼›
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;nx&#34;&gt;qp&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;chanbuf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;sendx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;raceenabled&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;nf&#34;&gt;raceacquire&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;qp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
			&lt;span class=&#34;nf&#34;&gt;racerelease&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;qp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
        &lt;span class=&#34;c1&#34;&gt;// è°ƒç”¨typedmemmove()å°†è¦å‘é€çš„æ•°æ®æ‹·è´åˆ°ç¼“å†²åŒºbuf
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;nf&#34;&gt;typedmemmove&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;elemtype&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;qp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ep&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
        &lt;span class=&#34;c1&#34;&gt;// ç„¶åå¢åŠ sendxç´¢å¼•å’Œqcountè®¡æ•°å™¨çš„å€¼
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;sendx&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;sendx&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;dataqsiz&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
            &lt;span class=&#34;c1&#34;&gt;// å› ä¸ºbufç¼“å†²åŒºæ˜¯ç¯å½¢ï¼Œå¦‚æœç´¢å¼•åˆ°äº†é˜Ÿå°¾ï¼Œåˆ™ç½®0é‡æ–°å›åˆ°é˜Ÿå¤´
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;			&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;sendx&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;qcount&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;
        &lt;span class=&#34;c1&#34;&gt;// å®Œæˆåå°±è§£é”ï¼Œè¿”å›æˆåŠŸ
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;nf&#34;&gt;unlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

    &lt;span class=&#34;c1&#34;&gt;// èƒ½è¿‡åˆ°è¿™è¾¹ï¼Œè¯´æ˜æ²¡æœ‰ç­‰å¾…æ¥æ”¶æ•°æ®çš„Gï¼Œå¹¶ä¸”æ²¡æœ‰ç¼“å†²åŒºï¼Œæˆ–è€…ç¼“å†²åŒºå·²æ»¡ï¼Œæ­¤æ—¶è¿›å…¥é˜»å¡å‘é€
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;block&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nf&#34;&gt;unlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;c1&#34;&gt;// è·å–å½“å‰goroutine
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;gp&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// è·å–ä¸€ä¸ªsudo Gï¼›acquireSudog()æ–¹æ³•ä¸»è¦æ˜¯è·å–å¯å¤ç”¨çš„sudoGå¯¹è±¡ï¼Œä¼šä¼˜å…ˆä»æœ¬åœ°ç¼“å­˜è·å–ï¼Œè·å–ä¸åˆ°å°±ä¼šä»å…¨å±€ç¼“å­˜ä¸­è·å–ï¼Œè¿½åŠ åˆ°æœ¬åœ°ç¼“å­˜ï¼Œå¦‚æœå…¨å±€ç¼“å­˜ä¹Ÿæ²¡æœ‰ï¼Œåˆ™æ–°åˆ›å»ºä¸€ä¸ªsudoG
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;mysg&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;acquireSudog&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;mysg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;releasetime&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;t0&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;mysg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;releasetime&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;c1&#34;&gt;// ä¸ºsudo Gè®¾ç½®å¥½è¦å‘é€çš„æ•°æ®å’ŒçŠ¶æ€ï¼Œæ¯”å¦‚å‘é€çš„Channelã€æ˜¯å¦åœ¨selectä¸­å’Œå¾…å‘é€çš„æ•°æ®çš„å†…å­˜åœ°å€ç­‰
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;mysg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;elem&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ep&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;mysg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;waitlink&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;mysg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;g&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;gp&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;mysg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;isSelect&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;mysg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;gp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;waiting&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;mysg&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;gp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;param&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// å°†sudo GåŠ å…¥å¾…å‘é€é˜Ÿåˆ—
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;sendq&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;enqueue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;mysg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// è°ƒç”¨goparkæ–¹æ³•æŒ‚èµ·å½“å‰goroutineï¼ŒçŠ¶æ€ä¸ºwaitReasonChanSendï¼Œé˜»å¡ç­‰å¾…channel
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nf&#34;&gt;gopark&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;chanparkcommit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;unsafe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Pointer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;waitReasonChanSend&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;traceEvGoBlockSend&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;c1&#34;&gt;// ç¡®ä¿å‘é€çš„å€¼ä¿å­˜æ´»åŠ¨çŠ¶æ€ï¼Œç›´åˆ°æ¥æ”¶è€…å°†å…¶å¤åˆ¶å‡ºæ¥ã€‚å› ä¸ºsudoGå…·æœ‰æŒ‡å‘å †æ ˆå¯¹è±¡çš„æŒ‡é’ˆï¼Œä½†å…¶ä¸èƒ½ä½œä¸ºGCæ—¶çš„rootå¯¹è±¡ã€‚å‘é€çš„æ•°æ®æ˜¯åˆ†é…åœ¨å †ä¸Šçš„ï¼Œé¿å…è¢«GCã€‚
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nf&#34;&gt;KeepAlive&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ep&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

	&lt;span class=&#34;c1&#34;&gt;// å½“goroutineè¢«å”¤é†’åï¼Œè§£é™¤é˜»å¡çŠ¶æ€ï¼Œå®Œæˆchannelé˜»å¡æ•°æ®çš„å‘é€
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;mysg&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;gp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;waiting&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nf&#34;&gt;throw&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;G waiting list is corrupted&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;gp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;waiting&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;gp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;activeStackChans&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;gp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;param&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;closed&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;nf&#34;&gt;throw&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;chansend: spurious wakeup&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
		&lt;span class=&#34;nb&#34;&gt;panic&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;plainError&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;send on closed channel&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;gp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;param&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;mysg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;releasetime&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nf&#34;&gt;blockevent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;mysg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;releasetime&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;t0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;mysg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// å‘é€å®Œæˆä¹‹åï¼Œè§£é™¤channelçš„ç»‘å®šï¼Œé‡ç½®sudoGçŠ¶æ€ï¼Œé‡Šæ”¾sudoGï¼Œé‡Šæ”¾æ—¶ï¼Œå¦‚æœæœ¬åœ°ç¼“å­˜å·²æ»¡ï¼Œä¼šè½¬ç§»ä¸€éƒ¨åˆ†åˆ°å…¨å±€ç¼“å­˜ï¼Œå¦åˆ™æ”¾åˆ°æœ¬åœ°ç¼“å­˜ç­‰å¾…è¢«å¤ç”¨
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nf&#34;&gt;releaseSudog&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;mysg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id=&#34;æ¥æ”¶æ•°æ®&#34;&gt;æ¥æ”¶æ•°æ®&lt;/h2&gt;
&lt;p&gt;ä½¿ç”¨&lt;code&gt; str &amp;lt;- ch æˆ– str, ok &amp;lt;- ch (okç”¨äºåˆ¤æ–­chæ˜¯å¦å…³é—­ï¼Œå¦‚æœæ²¡æœ‰okï¼Œå¯èƒ½ä¼šæ— æ³•åˆ†è¾¨stræ¥æ”¶åˆ°çš„é›¶å€¼æ˜¯å‘é€è€…å‘çš„è¿˜æ˜¯chå…³é—­)&lt;/code&gt;æ¥æ”¶æ•°æ®ï¼Œä¼šè½¬åŒ–ä¸ºè°ƒç”¨&lt;code&gt;chanrecv1å’Œchanrecv2å‡½æ•°&lt;/code&gt;ï¼Œä½†æœ€ç»ˆä¼šè°ƒç”¨&lt;code&gt;chanrecvå‡½æ•°&lt;/code&gt;æ¥æ”¶æ•°æ®ã€‚chanrecv1å’Œchanrecv2å‡½æ•°éƒ½æ˜¯è®¾ç½®é˜»å¡å‚æ•°ä¸ºtrueã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;å¦‚æœchanæ˜¯nilï¼Œåˆ™æŠŠæ¥æ”¶è€…çš„goroutine parkï¼ˆé˜»å¡ä¼‘çœ ï¼‰ï¼Œæ¥æ”¶è€…è¢«æ°¸ä¹…é˜»å¡ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¸ä¸Šé”æ£€æŸ¥ buf åŒºå¤§å°ï¼šå¦‚æœchançš„bufåŒºå¤§å°ä¸º0 æˆ–è€… æ²¡æœ‰æ•°æ®å¯æ¥æ”¶ï¼Œæ£€æŸ¥æ˜¯å¦è¢«å…³é—­ï¼Œè¢«å…³é—­åˆ™è¿”å›ï¼›å¦‚æœæ²¡è¢«å…³é—­ï¼Œåˆ™å†æ¬¡æ£€æŸ¥bufåŒºå¤§å°æ˜¯å¦ä¸º0 æˆ–è€… æ²¡æœ‰æ•°æ®å¯æ¥æ”¶ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™æ¸…é™¤epæŒ‡é’ˆä¸­çš„æ•°æ®å¹¶è¿”å›selectedä¸ºtrueï¼Œreceivedä¸ºfalseï¼›&lt;/p&gt;
&lt;p&gt;è¿™é‡Œä¸¤æ¬¡emptyæ£€æŸ¥ï¼Œå› ä¸ºç¬¬ä¸€æ¬¡æ£€æŸ¥ï¼Œchanå¯èƒ½è¿˜æ²¡å…³é—­ï¼Œä½†æ˜¯ç¬¬äºŒæ¬¡æ£€æŸ¥æ—¶å…³é—­äº†ï¼Œç”±äºå¯èƒ½åœ¨ä¸¤æ¬¡æ£€æŸ¥ä¹‹é—´æœ‰å¾…æ¥æ”¶çš„æ•°æ®è¾¾åˆ°äº†ï¼Œæ‰€ä»¥éœ€è¦ä¸¤æ¬¡emptyæ£€æŸ¥ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¸Šé”&lt;/strong&gt;æ£€æŸ¥bufåŒºå¤§å°ï¼šä¸Šé”ï¼Œå¦‚æœchanå·²ç»è¢«closeï¼Œä¸”bufåŒºæ²¡æœ‰æ•°æ®ï¼Œæ¸…é™¤epæŒ‡é’ˆä¸­çš„æ•°æ®ï¼Œè§£é”ï¼Œè¿”å›selectedä¸ºtrueï¼Œreceivedä¸ºfalseï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åŒæ­¥æ¥æ”¶ - &lt;strong&gt;å¦‚æœæ— bufï¼Œæ¶ˆè´¹å‘é€ç­‰å¾…é˜Ÿåˆ—ä¸­Gçš„æ•°æ®ï¼Œå¦‚æœbufæ»¡ï¼Œå…ˆæ‹¿bufåŒºçš„ï¼Œå‘é€çš„å†åŠ å…¥&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å½“chançš„sendqé˜Ÿåˆ—å­˜åœ¨ç­‰å¾…çŠ¶æ€çš„goroutineæ—¶&lt;/strong&gt;ï¼ˆèƒ½æ‹¿åˆ°å°±è¯´æ˜è¦ä¸å°±æ˜¯bufåŒºä¸º0ï¼Œè¦ä¸å°±æ˜¯bufåŒºå·²æ»¡ï¼‰&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å¦‚æœæ˜¯æ— bufåŒºçš„chan&lt;/strong&gt;ï¼Œç›´æ¥ä½¿ç”¨&lt;code&gt;recv()&lt;/code&gt;å‡½æ•°ä»é˜»å¡çš„å‘é€è€…ä¸­è·å–æ•°æ®ï¼›&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å¦‚æœæ˜¯æœ‰bufåŒºçš„chan&lt;/strong&gt;ï¼Œè¯´æ˜æ­¤æ—¶bufåŒºå·²æ»¡ï¼Œåˆ™å…ˆä»bufåŒºä¸­è·å–å¯æ¥æ”¶çš„æ•°æ®ï¼ˆä»bufåŒºä¸­copyåˆ°æ¥æ”¶è€…çš„å†…å­˜ï¼‰ï¼Œç„¶åä»sendqé˜Ÿåˆ—çš„é˜Ÿé¦–ä¸­è¯»å–å¾…å‘é€çš„æ•°æ®ï¼ŒåŠ å…¥åˆ°bufåŒºä¸­ï¼ˆå°†å‘é€è€…çš„æ•°æ®copyåˆ°bufåŒºï¼Œæ›¿æ¢åˆšåˆšbufåŒºcopyå‡ºå»çš„ä½ç½®ï¼‰ï¼Œæ›´æ–°å¯æ¥æ”¶å’Œå¯å‘é€çš„ä¸‹æ ‡chan.recvxå’Œsendxçš„å€¼ï¼›&lt;/p&gt;
&lt;p&gt;æœ€åè°ƒç”¨&lt;code&gt;goready()&lt;/code&gt;å‡½æ•°å°†ç­‰å¾…å‘é€æ•°æ®è€Œé˜»å¡gorouotineçš„çŠ¶æ€ä»Gwaiting æˆ–è€… Gscanwaiting æ”¹å˜æˆ Grunnableï¼ŒæŠŠgoroutineç»‘å®šåˆ°Pçš„LRQä¸­ï¼Œ&lt;strong&gt;ç­‰å¾…ä¸‹ä¸€è½®è°ƒåº¦æ—¶&lt;/strong&gt;ç«‹å³é‡Šæ”¾è¿™ä¸ªç­‰å¾…å‘é€æ•°æ®çš„goroutineï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¼‚æ­¥æ¥æ”¶ - &lt;strong&gt;å…¶æ¬¡æ˜¯æ¶ˆè´¹bufåŒºä¸­çš„æ•°æ®&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å½“channelçš„sendqé˜Ÿåˆ—æ²¡æœ‰ç­‰å¾…çŠ¶æ€çš„goroutineï¼Œä¸”bufåŒºå­˜åœ¨æ•°æ®æ—¶&lt;/strong&gt;ï¼Œä»channelçš„bufåŒºä¸­çš„recvxçš„ç´¢å¼•ä½ç½®æ¥æ”¶æ•°æ®ï¼Œå¦‚æœæ¥æ”¶æ•°æ®çš„å†…å­˜åœ°å€ä¸ä¸ºç©ºï¼Œä¼šç›´æ¥å°†ç¼“å†²åŒºé‡Œçš„æ•°æ®æ‹·è´åˆ°å†…å­˜ä¸­ï¼Œæ¸…é™¤bufåŒºä¸­çš„æ•°æ®ï¼Œé€’å¢recvxï¼Œé€’å‡qcountï¼Œå®Œæˆæ•°æ®æ¥æ”¶ï¼›&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªå’Œchansendå…±ç”¨ä¸€æŠŠé”ï¼Œæ‰€ä»¥ä¸ä¼šæœ‰å¹¶å‘é—®é¢˜ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;é˜»å¡æ¥æ”¶ - &lt;strong&gt;æœ€åæ‰æ˜¯ä¿å­˜åœ¨æ¥æ”¶ç­‰å¾…é˜Ÿåˆ—ï¼Œé˜»å¡ï¼ˆé˜»å¡åªå‘ç”Ÿåœ¨è¿™é‡Œï¼Œæ­¤æ—¶Gå’ŒMåˆ†ç¦»ï¼‰&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å½“channelçš„sendqé˜Ÿåˆ—æ²¡æœ‰ç­‰å¾…çŠ¶æ€çš„goroutineï¼Œä¸”bufåŒºä¸å­˜åœ¨æ•°æ®æ—¶&lt;/strong&gt;ï¼Œæ‰§è¡Œ&lt;code&gt;acquireSudog()&lt;/code&gt;å‡½æ•°è·å–sudoGå¯¹è±¡ï¼Œè®¾ç½®æ­¤æ¬¡é˜»å¡å‘é€çš„ç›¸å…³ä¿¡æ¯ï¼ˆå¦‚å‘é€çš„channelã€æ˜¯å¦åœ¨selectæ§åˆ¶ç»“æ„ä¸­å’Œå¾…å‘é€æ•°æ®çš„å†…å­˜åœ°å€ã€å‘é€æ•°æ®çš„goroutineï¼‰&lt;/p&gt;
&lt;p&gt;ç„¶åå°†è¯¥sudoGå¯¹è±¡åŠ å…¥å¾…å‘é€recvqé˜Ÿåˆ—ï¼Œè°ƒç”¨&lt;code&gt;goparkunlock()&lt;/code&gt;å‡½æ•°è®©å½“å‰æ¥æ”¶è€…çš„goroutineè¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œè¡¨ç¤ºå½“å‰goroutineæ­£åœ¨ç­‰å¾…å…¶ä»–goroutineä»channelä¸­å‘é€æ•°æ®ï¼Œç­‰å¾…è°ƒåº¦å™¨å”¤é†’ï¼›&lt;/p&gt;
&lt;p&gt;æ­¤æ—¶æ–¹æ³•ä¼šé˜»å¡åœ¨chçš„æ¥æ”¶ä¸­ï¼Œlen()è¿”å›å€¼ä¸º0ï¼›&lt;/p&gt;
&lt;p&gt;goroutineè¢«å”¤é†’åï¼Œchanå®Œæˆé˜»å¡æ•°æ®çš„æ¥æ”¶ï¼Œæ¥æ”¶å®Œæˆåè¿›è¡ŒåŸºæœ¬çš„å‚æ•°æ£€æŸ¥ï¼Œè§£é™¤chançš„ç»‘å®šï¼Œé‡Šæ”¾sudoGï¼Œè¡¨ç¤ºæ¥æ”¶æ•°æ®å®Œæˆï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;channel æ¥æ”¶è¿‡ç¨‹ä¸­åŒ…å« 2 æ¬¡æœ‰å…³ goroutine è°ƒåº¦è¿‡ç¨‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å½“å‘é€é˜Ÿåˆ—ä¸­å­˜åœ¨ sudoG æ—¶ï¼Œè°ƒç”¨&lt;code&gt;goready()&lt;/code&gt;ï¼ŒG çš„çŠ¶æ€ä» Gwaiting æˆ–è€… Gscanwaiting æ”¹å˜æˆ Grunnableï¼Œç­‰å¾…ä¸‹æ¬¡è°ƒåº¦ä¾¿ç«‹å³è¿è¡Œï¼›&lt;/li&gt;
&lt;li&gt;å½“ buf åŒºä¸ºç©ºï¼Œä¸”æ²¡æœ‰å‘é€è€…æ—¶ï¼Œè°ƒç”¨ &lt;code&gt;gopark()&lt;/code&gt;æŒ‚èµ·å½“å‰Gï¼Œæ­¤æ—¶çŠ¶æ€ä¸ºGwaitingï¼Œè®©å‡º cpu çš„ä½¿ç”¨æƒå¹¶ç­‰å¾…è°ƒåº¦å™¨çš„è°ƒåº¦ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;  1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 48
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 49
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 50
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 51
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 52
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 53
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 54
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 55
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 56
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 57
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 58
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 59
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 60
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 61
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 62
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 63
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 64
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 65
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 66
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 67
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 68
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 69
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 70
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 71
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 72
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 73
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 74
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 75
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 76
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 77
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 78
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 79
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 80
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 81
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 82
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 83
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 84
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 85
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 86
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 87
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 88
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 89
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 90
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 91
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 92
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 93
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 94
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 95
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 96
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 97
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 98
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 99
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;100
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;101
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;102
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;103
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;104
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;105
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;106
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;107
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;108
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;109
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;110
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;111
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;112
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;113
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;114
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;115
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;116
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;117
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;118
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;119
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;120
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;121
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;122
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;123
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;124
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;125
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;126
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;127
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;128
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;129
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;130
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;131
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;132
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;133
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;134
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;135
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;136
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;137
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;138
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;139
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;140
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;141
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;142
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;143
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;144
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;145
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;146
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;147
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;148
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;149
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;150
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;151
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;152
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;153
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// epæŒ‡çš„æ˜¯ç”¨æ¥æ¥æ”¶æ•°æ®çš„å†…å­˜æŒ‡é’ˆï¼Œæ•°æ®ç±»å‹ä¸hchanä¸­çš„ç±»å‹ä¸€è‡´
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// [val] &amp;lt;- ch æ—¶ï¼Œblock=true; selectæ—¶ï¼Œblock=false
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;chanrecv&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;hchan&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ep&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;unsafe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Pointer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;block&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;selected&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;received&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;debugChan&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;chanrecv: chan=&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;c1&#34;&gt;// å¦‚æœchanæ˜¯nilï¼Œæ¥æ”¶è€…ä¼šè¢«é˜»å¡ï¼Œgoparkä¼šå¼•èµ·waitReasonChanReceiveNilChanåŸå› çš„ä¼‘çœ ï¼Œå¹¶æŠ›å‡ºunreachableçš„é”™è¯¯
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;block&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
		&lt;span class=&#34;nf&#34;&gt;gopark&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;waitReasonChanReceiveNilChan&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;traceEvGoStop&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nf&#34;&gt;throw&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;unreachable&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// è¿™æ®µä»£ç ä»…é’ˆå¯¹selectçš„åœºæ™¯
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// å½“chanä¸ä¸ºnilï¼Œåœ¨æ²¡æœ‰è·å–é”çš„æƒ…å†µä¸‹ï¼Œæ£€æŸ¥chançš„bufåŒºå¤§å°å’Œæ˜¯å¦å­˜åœ¨å¯æ¥æ”¶æ•°æ®
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// emptyæ–¹æ³•æ˜¯åŸå­æ£€æŸ¥ï¼Œæ£€æŸ¥chan.dataqsizã€chan.qcountæ˜¯å¦ä¸º0ï¼Œå‘é€é˜Ÿåˆ—æ˜¯å¦ä¸ºç©º
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;block&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;empty&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;atomic&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Load&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;closed&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
        &lt;span class=&#34;c1&#34;&gt;// è¿™é‡Œä¸¤æ¬¡emptyæ£€æŸ¥ï¼Œå› ä¸ºç¬¬ä¸€æ¬¡æ£€æŸ¥ï¼Œchanå¯èƒ½è¿˜æ²¡å…³é—­ï¼Œä½†æ˜¯ç¬¬äºŒæ¬¡æ£€æŸ¥æ—¶å…³é—­äº†ï¼Œç”±äºå¯èƒ½åœ¨ä¸¤æ¬¡æ£€æŸ¥æ—¶æœ‰å¾…æ¥æ”¶çš„æ•°æ®è¾¾åˆ°äº†ï¼Œæ‰€ä»¥éœ€è¦ä¸¤æ¬¡emptyæ£€æŸ¥
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;empty&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;raceenabled&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
				&lt;span class=&#34;nf&#34;&gt;raceacquire&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;raceaddr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;
			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
            &lt;span class=&#34;c1&#34;&gt;// å¦‚æœchançš„bufåŒºå¤§å°å’Œæ˜¯å¦å­˜åœ¨å¯æ¥æ”¶æ•°æ®ï¼Œæ­¤æ—¶ä¼šæ¸…é™¤epæŒ‡é’ˆä¸­çš„æ•°æ®
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;			&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ep&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
				&lt;span class=&#34;nf&#34;&gt;typedmemclr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;elemtype&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ep&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	
	&lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;t0&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int64&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;blockprofilerate&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;t0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;cputicks&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// è·å–é”åï¼Œå†æ£€æŸ¥ä¸€é
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nf&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// å¦‚æœchanå·²ç»å…³é—­ä¸”bufåŒºä¸å­˜åœ¨æ•°æ®äº†ï¼Œåˆ™æ¸…ç†epæŒ‡é’ˆä¸­çš„æ•°æ®å¹¶è¿”å›
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// è¿™é‡Œä¹Ÿæ˜¯ä»å·²ç»å…³é—­çš„chanä¸­è¯»æ•°æ®ï¼Œè¯»å‡ºæ¥çš„æ˜¯è¯¥ç±»å‹é›¶å€¼çš„åŸå› 
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;closed&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;qcount&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;raceenabled&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;nf&#34;&gt;raceacquire&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;raceaddr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
		&lt;span class=&#34;nf&#34;&gt;unlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ep&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;nf&#34;&gt;typedmemclr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;elemtype&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ep&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

    &lt;span class=&#34;c1&#34;&gt;// ä»å‘é€é˜Ÿåˆ—é˜Ÿé¦–ä¸­æ‰¾åˆ°ç­‰å¾…å‘é€çš„goroutineï¼ˆèƒ½æ‹¿åˆ°å°±è¯´æ˜è¦ä¸å°±æ˜¯bufåŒºä¸º0ï¼Œè¦ä¸å°±æ˜¯bufåŒºå·²æ»¡ï¼‰
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// å¦‚æœbufåŒºå¤§å°ä¸º0ï¼Œåˆ™ç›´æ¥æ¥æ”¶æ•°æ®ï¼›
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// å¦åˆ™ï¼Œè¯´æ˜bufåŒºå·²æ»¡ï¼Œå…ˆä»bufåŒºä¸­è·å–è¦å‘é€çš„æ•°æ®ï¼Œå†å°†senderçš„æ•°æ®åŠ å…¥åˆ°bufåŒºä¸­ï¼Œæ›´æ–°å¯æ¥æ”¶å’Œå¯å‘é€çš„ä¸‹æ ‡chan.recvxå’Œsendxçš„å€¼
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;sg&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;sendq&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;dequeue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;sg&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nf&#34;&gt;recv&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;sg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ep&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;unlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

    &lt;span class=&#34;c1&#34;&gt;// å½“chançš„bufåŒºå­˜åœ¨æ•°æ®æ—¶ï¼Œç›´æ¥ä»bufåŒºä¸­è·å–æ•°æ®ï¼Œè¿›è¡Œæ¥æ”¶ï¼Œæ›´æ–°æ¥æ”¶æ•°æ®çš„ä¸‹æ ‡å€¼ï¼Œè§£é”
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;qcount&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;qp&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;chanbuf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;recvx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;raceenabled&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;nf&#34;&gt;raceacquire&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;qp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
			&lt;span class=&#34;nf&#34;&gt;racerelease&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;qp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ep&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;nf&#34;&gt;typedmemmove&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;elemtype&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ep&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;qp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
		&lt;span class=&#34;nf&#34;&gt;typedmemclr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;elemtype&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;qp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;recvx&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;recvx&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;dataqsiz&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;recvx&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;qcount&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;--&lt;/span&gt;
		&lt;span class=&#34;nf&#34;&gt;unlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;block&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nf&#34;&gt;unlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;c1&#34;&gt;// åˆ°äº†è¿™é‡Œï¼Œè¯´æ˜sendqé‡Œæ²¡æœ‰å¾…å‘é€çš„goroutineï¼Œä¸”bufåŒºä¹Ÿæ²¡æœ‰æ•°æ®
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;gp&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;mysg&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;acquireSudog&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;mysg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;releasetime&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;t0&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;mysg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;releasetime&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;mysg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;elem&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ep&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;mysg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;waitlink&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;gp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;waiting&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;mysg&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;mysg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;g&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;gp&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;mysg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;isSelect&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;mysg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;gp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;param&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// è®¾ç½®å¥½å¾…æ¥æ”¶çš„sudoGåï¼ŒåŠ å…¥å¾…å‘é€çš„ç­‰å¾…é˜Ÿåˆ—
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;recvq&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;enqueue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;mysg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// æŒ‚èµ·å½“å‰goroutineï¼ŒçŠ¶æ€è®¾ç½®ä¸ºwaitReasonChanReceiveï¼Œé˜»å¡ç­‰å¾…chan
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nf&#34;&gt;gopark&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;chanparkcommit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;unsafe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Pointer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;waitReasonChanReceive&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;traceEvGoBlockRecv&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;c1&#34;&gt;// goroutineè¢«å”¤é†’åï¼Œå®Œæˆchané˜»å¡æ•°æ®çš„æ¥æ”¶ï¼Œè§£é™¤chançš„ç»‘å®šé‡Šæ”¾sudoG
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;mysg&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;gp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;waiting&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nf&#34;&gt;throw&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;G waiting list is corrupted&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;gp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;waiting&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;gp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;activeStackChans&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;mysg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;releasetime&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nf&#34;&gt;blockevent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;mysg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;releasetime&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;t0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;closed&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;gp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;param&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;gp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;param&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;mysg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
	&lt;span class=&#34;nf&#34;&gt;releaseSudog&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;mysg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;closed&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;


&lt;span class=&#34;c1&#34;&gt;// è¿™é‡ŒsgæŒ‡çš„æ˜¯ç­‰å¾…å‘é€é˜Ÿåˆ—ä¸­çš„Gï¼ŒepæŒ‡å…¶æºå¸¦çš„æ•°æ®
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;recv&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;hchan&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;sg&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;sudog&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ep&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;unsafe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Pointer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;unlockf&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;skip&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;dataqsiz&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ep&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;c1&#34;&gt;// ä» sender é‡Œé¢æ‹·è´æ•°æ®
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;			&lt;span class=&#34;nf&#34;&gt;recvDirect&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;elemtype&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;sg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ep&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	    &lt;span class=&#34;c1&#34;&gt;// è¿™é‡Œå¯¹åº” buf æ»¡çš„æƒ…å†µ
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;nx&#34;&gt;qp&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;chanbuf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;recvx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;c1&#34;&gt;// å°†æ•°æ®ä» buf ä¸­æ‹·è´åˆ°æ¥æ”¶è€…å†…å­˜åœ°å€ä¸­
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ep&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;nf&#34;&gt;typedmemmove&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;elemtype&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ep&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;qp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
		&lt;span class=&#34;c1&#34;&gt;// å°†æ•°æ®ä» sender ä¸­æ‹·è´åˆ° buf ä¸­
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;nf&#34;&gt;typedmemmove&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;elemtype&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;qp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;sg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;elem&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;recvx&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;recvx&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;dataqsiz&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;recvx&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;sendx&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;recvx&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// c.sendx = (c.sendx+1) % c.dataqsiz
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;sg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;elem&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;gp&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;sg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;g&lt;/span&gt;
	&lt;span class=&#34;nf&#34;&gt;unlockf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;gp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;param&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;unsafe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Pointer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;sg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;sg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;success&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;sg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;releasetime&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;sg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;releasetime&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;cputicks&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;nf&#34;&gt;goready&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;gp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;skip&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id=&#34;å…³é—­&#34;&gt;å…³é—­&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;å¦‚æœ chan ä¸º nilï¼Œclose ä¼š panicï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¸Šé”ï¼š&lt;/p&gt;
&lt;p&gt;å¦‚æœ chan å·²ç» closedï¼Œå†æ¬¡ close ä¹Ÿä¼š panicï¼›&lt;/p&gt;
&lt;p&gt;å¦åˆ™çš„è¯ï¼Œå¦‚æœ chan ä¸ä¸º nilï¼Œchan ä¹Ÿæ²¡æœ‰ closedï¼Œè®¾ç½®chançš„æ ‡è®°ä¸ºclosedï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¼˜å…ˆé‡Šæ”¾æ‰€æœ‰çš„æ¥æ”¶è€…&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;å°†æ¥æ”¶è€…ç­‰å¾…é˜Ÿåˆ—ä¸­çš„sudoGå¯¹è±¡åŠ å…¥åˆ°å¾…æ¸…é™¤é˜Ÿåˆ—glistä¸­ï¼Œè¿™é‡Œä¼šä¼˜å…ˆå›æ”¶æ¥æ”¶è€…ï¼Œè¿™æ ·å³ä½¿ä»closeä¸­çš„chanè¯»å–æ•°æ®ï¼Œä¹Ÿä¸ä¼španicï¼Œæœ€å¤šè¯»åˆ°é»˜è®¤å€¼ï¼›&lt;/p&gt;
&lt;p&gt;è¿™æ ·ç¬¬6æ­¥æ‰§è¡Œçš„æ—¶å€™ï¼Œæ‰ä¼šå…ˆæ‰§è¡Œæ¥æ”¶è€…ï¼Œæ¥æ”¶åé¢å‘é€è€…çš„æ•°æ®ï¼ˆæ¥æ”¶buffæ•°ç»„é‡Œçš„æ•°æ®ï¼Œå› ä¸ºsenderé‡Œçš„ä¼šè¢«panicæ‰ï¼‰ï¼Œå¦åˆ™å‘é€è€…å‘é€çš„æ•°æ®æ— æ³•è¢«å…ˆæ¥æ”¶ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å…¶æ¬¡æ˜¯é‡Šæ”¾æ‰€æœ‰å‘é€è€…&lt;/strong&gt;ï¼š
å°†å‘é€è€…ç­‰å¾…é˜Ÿåˆ—ä¸­çš„sudoGå¯¹è±¡åŠ å…¥åˆ°å¾…æ¸…é™¤é˜Ÿåˆ—glistä¸­ï¼Œè¿™é‡Œå¯èƒ½ä¼šå‘ç”Ÿpanicï¼Œå› ä¸ºå¾€ä¸€ä¸ªcloseçš„chanä¸­å‘é€æ•°æ®ä¼španicï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è§£é”&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è¿›è¡Œæœ€åçš„è°ƒåº¦ï¼Œéå†glistä¸­çš„sudoGï¼Œè°ƒç”¨&lt;code&gt;goready()&lt;/code&gt;è§¦å‘è°ƒåº¦ï¼Œå°†æ¯ä¸ªgoroutineçŠ¶æ€ä» Gwaiting è½¬ä¸º GrunnableçŠ¶æ€ï¼Œç­‰å¾…è°ƒåº¦å™¨è°ƒåº¦ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;48
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;49
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;50
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;51
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;52
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;53
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;54
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;55
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;56
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;57
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;58
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;59
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;60
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;61
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;closechan&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;hchan&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nb&#34;&gt;panic&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;plainError&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;close of nil channel&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;nf&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;closed&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nf&#34;&gt;unlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nb&#34;&gt;panic&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;plainError&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;close of closed channel&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;closed&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;
	&lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;glist&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;gList&lt;/span&gt;
	&lt;span class=&#34;c1&#34;&gt;// é‡Šæ”¾æ‰€æœ‰æ¥æ”¶è€…ï¼šå°†æ‰€æœ‰æ¥æ”¶è€…çš„sudoGç­‰å¾…é˜Ÿåˆ—åŠ å…¥åˆ°å¾…æ¸…é™¤çš„é˜Ÿåˆ—glistä¸­
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;sg&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;recvq&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;dequeue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;sg&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;break&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
        &lt;span class=&#34;c1&#34;&gt;// é”€æ¯èµ„æº
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;sg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;elem&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;nf&#34;&gt;typedmemclr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;elemtype&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;sg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;elem&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;sg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;elem&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;sg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;releasetime&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;sg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;releasetime&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;cputicks&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;gp&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;sg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;g&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;gp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;param&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;raceenabled&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;nf&#34;&gt;raceacquireg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;gp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;raceaddr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;glist&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;push&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;gp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;c1&#34;&gt;// é‡Šæ”¾æ‰€æœ‰å‘é€è€…ï¼šå°†æ‰€æœ‰å‘é€è€…çš„sudoGç­‰å¾…é˜Ÿåˆ—åŠ å…¥åˆ°å¾…æ¸…é™¤çš„é˜Ÿåˆ—glistä¸­
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// å¦‚æœå‘é€è€…é˜Ÿåˆ—å­˜åœ¨å‘é€è€…ï¼Œé‚£è¿™äº›å‘é€è€…æ‰€åœ¨çš„goroutineä¼šäº§ç”Ÿpanic
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;sg&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;sendq&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;dequeue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;sg&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;break&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
        &lt;span class=&#34;c1&#34;&gt;// é”€æ¯èµ„æº
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;nx&#34;&gt;sg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;elem&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;sg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;releasetime&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;sg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;releasetime&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;cputicks&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;gp&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;sg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;g&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;gp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;param&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;raceenabled&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;nf&#34;&gt;raceacquireg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;gp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;raceaddr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;glist&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;push&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;gp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;nf&#34;&gt;unlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

	&lt;span class=&#34;c1&#34;&gt;// ä¸ºæ‰€æœ‰è¢«é˜»å¡çš„ goroutine è°ƒç”¨ goready è§¦å‘è°ƒåº¦ã€‚å°†æ‰€æœ‰ glist ä¸­çš„ goroutine çŠ¶æ€ä» _Gwaiting è®¾ç½®ä¸º _Grunnable çŠ¶æ€ï¼Œç­‰å¾…è°ƒåº¦å™¨çš„è°ƒåº¦
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;glist&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;empty&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;gp&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;glist&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;pop&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;gp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;schedlink&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;
		&lt;span class=&#34;nf&#34;&gt;goready&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;gp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id=&#34;åº”ç”¨åœºæ™¯&#34;&gt;åº”ç”¨åœºæ™¯&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å®ç°ç”Ÿäº§è€… - æ¶ˆè´¹ç»„æ¨¡å‹ï¼Œæ•°æ®ä¼ é€’ï¼Œæ¯”å¦‚&lt;a class=&#34;link&#34; href=&#34;http://marcio.io/2015/07/handling-1-million-requests-per-minute-with-golang/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;workeræ± çš„å®ç°&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;consumer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;taskChan&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;chan&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;k&#34;&gt;go&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
            &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
                &lt;span class=&#34;nx&#34;&gt;task&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;taskChan&lt;/span&gt;
                &lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Sleep&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Second&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// æ¨¡æ‹Ÿè€—æ—¶
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;            &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
        &lt;span class=&#34;p&#34;&gt;}(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;taskCh&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;make&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;chan&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;100&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;go&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;consumer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;taskCh&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// ç”Ÿäº§è€…
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;10&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;nx&#34;&gt;taskCh&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// wait...
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¿¡å·é€šçŸ¥ï¼šåˆ©ç”¨ å¦‚æœchanä¸ºç©ºï¼Œé‚£receiveræ¥æ”¶æ•°æ®çš„æ—¶å€™å°±ä¼šé˜»å¡ç­‰å¾…ï¼Œç›´åˆ°chanè¢«å…³é—­æˆ–æœ‰æ–°æ•°æ®è¿›æ¥ çš„ç‰¹ç‚¹ï¼Œå°†ä¸€ä¸ªåç¨‹å°†ä¿¡å·(closingã€closedã€data readyç­‰)ä¼ é€’ç»™å¦ä¸€ä¸ªæˆ–è€…å¦ä¸€ç»„åç¨‹ï¼Œæ¯”å¦‚ wait/notifyçš„æ¨¡å¼ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åç¨‹æ± ï¼ŒæŠŠè¦æ“ä½œçš„é€»è¾‘å°è£…æˆtaskï¼Œé€šè¿‡chanä¼ è¾“å®ç°åç¨‹å¤ç”¨&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä»»åŠ¡ç¼–æ’ï¼šè®©ä¸€ç»„åç¨‹æŒ‰ç…§ä¸€å®šçš„é¡ºåºå¹¶å‘æˆ–ä¸²è¡Œæ‰§è¡Œï¼Œæ¯”å¦‚å®ç°waitGroupçš„åŠŸèƒ½&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ§åˆ¶å¹¶å‘é‡ï¼Œå¯ä»¥é…åˆWaitGroupè¿›è¡Œæ§åˆ¶goroutineçš„æ•°é‡&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;ch&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;make&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;chan&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;10&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;// è¿™ä¸ªæ”¾åœ¨å¤–å±‚å’Œæ”¾åœ¨é‡Œå±‚çš„æ•ˆæœä¸åŒï¼Œéƒ½å¯ä»¥æ§åˆ¶å¹¶å‘é‡ï¼Œä½†æ˜¯å‰è€…ä¼šé˜»å¡forå¾ªç¯ï¼Œåè€…ä¸ä¼š
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;nx&#34;&gt;ch&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;   &lt;span class=&#34;c1&#34;&gt;// æ”¾æ»¡ä¸‰ä¸ªåå°±ä¼šé˜»å¡å¾ªç¯ï¼Œæ­¤æ—¶æœ€å¤šå­˜åœ¨3ä¸ªgoroutine
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;k&#34;&gt;go&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;k&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
          &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;k&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// do something...
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;          &lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Sleep&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Second&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
          &lt;span class=&#34;c1&#34;&gt;// é˜²æ­¢æ³„éœ²
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;          &lt;span class=&#34;k&#34;&gt;defer&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
              &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ch&lt;/span&gt;
          &lt;span class=&#34;p&#34;&gt;}()&lt;/span&gt;
      &lt;span class=&#34;p&#34;&gt;}(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;// é…åˆWaitGroupæ§åˆ¶goroutineçš„æ•°é‡
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;ch&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;make&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;chan&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;wg&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;sync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;WaitGroup&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;10&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;nx&#34;&gt;ch&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// chå¦‚æœæ”¾åœ¨é‡Œå±‚å°±è¾¾ä¸åˆ°æ§åˆ¶goroutineçš„æ•ˆæœäº†
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;nx&#34;&gt;wg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Add&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
      &lt;span class=&#34;k&#34;&gt;go&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;k&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
            &lt;span class=&#34;k&#34;&gt;defer&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;wg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Done&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
            &lt;span class=&#34;c1&#34;&gt;// ch&amp;lt;- 1, chå¦‚æœæ”¾åœ¨è¿™ï¼Œé‚£å°±åªé˜»å¡goroutineé‡Œçš„é€»è¾‘ï¼Œgoroutineè¿˜æ˜¯ä¼šåˆ›å»ºå¤šä¸ª
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;          &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;k&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// do something...
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;          &lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Sleep&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Second&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
            &lt;span class=&#34;c1&#34;&gt;// é˜²æ­¢æ³„éœ²
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;          &lt;span class=&#34;k&#34;&gt;defer&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
              &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ch&lt;/span&gt;
          &lt;span class=&#34;p&#34;&gt;}()&lt;/span&gt;
      &lt;span class=&#34;p&#34;&gt;}(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;wg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Wait&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä»»åŠ¡å®šæ—¶&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;worker&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;ticker&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Tick&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Second&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;k&#34;&gt;select&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ticker&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
            &lt;span class=&#34;c1&#34;&gt;// æ‰§è¡Œå®šæ—¶ä»»åŠ¡
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;            &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;æ‰§è¡Œ 1s å®šæ—¶ä»»åŠ¡&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;// æˆ–è€…
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;worker&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;k&#34;&gt;select&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
          &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;After&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;100&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Millisecond&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
          &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;stopc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
              &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;
      &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å®ç°äº’æ–¥é”çš„æœºåˆ¶ï¼Œæ¯”å¦‚ï¼Œå®¹é‡ä¸º 1 çš„chanï¼Œæ”¾å…¥chançš„å…ƒç´ ä»£è¡¨é”ï¼Œè°å…ˆå–å¾—è¿™ä¸ªå…ƒç´ ï¼Œå°±ä»£è¡¨è°å…ˆè·å–äº†é”&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Locker&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;ch&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;chan&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;NewLocker&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Locker&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;locker&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Locker&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;make&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;chan&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)}&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;locker&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ch&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;locker&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;locker&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Locker&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;locker&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ch&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;locker&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Locker&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;UnLock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;select&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;locker&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ch&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{}{}:&lt;/span&gt; 
      &lt;span class=&#34;k&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; 
          &lt;span class=&#34;nb&#34;&gt;panic&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34; unlock of unlocked mutex&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; 
    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;å…±äº«èµ„æºçš„å¹¶å‘è®¿é—®ä½¿ç”¨ä¼ ç»Ÿå¹¶å‘åŸè¯­ï¼›&lt;/p&gt;
&lt;p&gt;å¤æ‚çš„ä»»åŠ¡ç¼–æ’å’Œæ¶ˆæ¯ä¼ é€’ä½¿ç”¨ Channelï¼›&lt;/p&gt;
&lt;p&gt;æ¶ˆæ¯é€šçŸ¥æœºåˆ¶ä½¿ç”¨ Channelï¼Œé™¤éåªæƒ³ signal ä¸€ä¸ª goroutineï¼Œæ‰ä½¿ç”¨ Condï¼›&lt;/p&gt;
&lt;p&gt;ç®€å•ç­‰å¾…æ‰€æœ‰ä»»åŠ¡çš„å®Œæˆç”¨ WaitGroupï¼Œä¹Ÿæœ‰ Channel çš„æ¨å´‡è€…ç”¨ Channelï¼Œéƒ½å¯ä»¥ï¼›&lt;/p&gt;
&lt;p&gt;éœ€è¦å’Œ Select è¯­å¥ç»“åˆï¼Œä½¿ç”¨ Channelï¼›éœ€è¦å’Œè¶…æ—¶é…åˆæ—¶ï¼Œä½¿ç”¨ Channel å’Œ Contextã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æ³¨æ„ç‚¹ï¼šä½¿ç”¨chanè¦æ³¨æ„panicå’Œgoroutineæ³„éœ²ï¼Œå¦å¤–ï¼Œåªè¦ä¸€ä¸ª chan è¿˜æœ‰æœªè¯»çš„æ•°æ®ï¼Œå³ä½¿æŠŠå®ƒ close æ‰ï¼Œä½ è¿˜æ˜¯å¯ä»¥ç»§ç»­æŠŠè¿™äº›æœªè¯»çš„æ•°æ®æ¶ˆè´¹å®Œï¼Œä¹‹åæ‰æ˜¯è¯»å–é›¶å€¼æ•°æ®ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ä½¿ç”¨chanå’Œselecté…åˆæ—¶è¦æ³¨æ„ä¼šå‡ºç°goroutineæ³„æ¼çš„æƒ…å†µï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;process&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;timeout&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Duration&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;ch&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;make&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;chan&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

    &lt;span class=&#34;k&#34;&gt;go&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;c1&#34;&gt;// æ¨¡æ‹Ÿå¤„ç†è€—æ—¶çš„ä¸šåŠ¡
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Sleep&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;timeout&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Second&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
        &lt;span class=&#34;nx&#34;&gt;ch&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// block
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;exit goroutine&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;}()&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// å¦‚æœä¸Šé¢çš„åç¨‹ä»»åŠ¡å¤„ç†çš„æ—¶é—´è¿‡é•¿ï¼Œè§¦å‘ä¸‹é¢selectçš„è¶…æ—¶æœºåˆ¶ï¼Œæ­¤æ—¶processå‡½æ•°è¿”å›ï¼Œä¹‹åå½“ä¸Šé¢çš„åç¨‹ä»»åŠ¡æ‰§è¡Œå®Œä¹‹åï¼Œç”±äºprocesså·²ç»æ‰§è¡Œå®Œï¼Œä¸‹é¢resultæ¥æ”¶chançš„å€¼è¢«å›æ”¶ï¼Œæ‰€ä»¥æ²¡æœ‰æ¥æ”¶è€…ï¼Œå¯¼è‡´ä¸Šé¢çš„åç¨‹ä»»åŠ¡ä¸€ç›´å¡åœ¨ ch &amp;lt;- trueï¼Œè¿›è€Œå¯¼è‡´goroutineæ³„æ¼ã€‚è§£å†³æ–¹æ¡ˆå°±æ˜¯ä½¿ç”¨å®¹é‡ä¸º1çš„chå³å¯ã€‚
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;select&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;result&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
        &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;result&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;After&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;timeout&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
        &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h1 id=&#34;select&#34;&gt;select&lt;/h1&gt;
&lt;h2 id=&#34;ç»“æ„&#34;&gt;ç»“æ„&lt;/h2&gt;
&lt;p&gt;selectåœ¨runtimeä¸­ä¸å­˜åœ¨ç»“æ„ä½“è¡¨ç¤ºï¼Œä½†æ˜¯caseå€’æ˜¯æœ‰&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;kd&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// scase.kindï¼Œåˆ°æ—¶selectå°±æ˜¯è½®è¯¢åˆ¤æ–­è¿™äº›ç±»å‹çš„
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// send æˆ–è€… recv å‘ç”Ÿåœ¨ä¸€ä¸ª nil channel ä¸Šï¼Œå°±æœ‰å¯èƒ½å‡ºç°è¿™ç§æƒ…å†µ
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;caseNil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;iota&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;caseRecv&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;caseSend&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;caseDefault&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;// select ä¸­æ¯ä¸€ä¸ª case çš„æ•°æ®ç»“æ„å®šä¹‰
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;scase&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;elem&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;unsafe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Pointer&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// æ¥æ”¶ æˆ– å‘é€æ•°æ®çš„å˜é‡åœ°å€
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;    &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;hchan&lt;/span&gt;         &lt;span class=&#34;c1&#34;&gt;// å­˜å‚¨æ­£åœ¨ä½¿ç”¨çš„chan
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;kind&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint16&lt;/span&gt;         &lt;span class=&#34;c1&#34;&gt;// caseçš„ç§ç±»
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;releasetime&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int64&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;pc&lt;/span&gt;          &lt;span class=&#34;kt&#34;&gt;uintptr&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// return pc (for race detector / msan)
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id=&#34;åŸºæœ¬-1&#34;&gt;åŸºæœ¬&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;éé˜»å¡æ”¶å‘ï¼šå½“chanä¸­å­˜åœ¨å¯æ¥æ”¶æ•°æ®ï¼Œç›´æ¥å¤„ç†é‚£ä¸ªchanï¼Œå¦åˆ™æ‰§è¡Œdefaultè¯­å¥&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;7
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;nx&#34;&gt;ch&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;make&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;chan&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;select&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
        &lt;span class=&#34;nb&#34;&gt;println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
        &lt;span class=&#34;nb&#34;&gt;println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;default&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;éšæœºæ‰§è¡Œï¼šselecté‡åˆ°å¤šä¸ªcaseå°±ç»ªï¼Œä¼šè¿›è¡Œéšæœºé€‰æ‹©&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;8
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;nx&#34;&gt;ch1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;make&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;chan&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;nx&#34;&gt;ch2&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;make&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;chan&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;select&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;j&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ch1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
        &lt;span class=&#34;nb&#34;&gt;println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;j&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ch2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
        &lt;span class=&#34;nb&#34;&gt;println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ç¼–è¯‘å™¨ä¼šå¯¹selectä¸­çš„caseè¿›è¡Œä¼˜åŒ–ï¼Œæ€»å…±æœ‰å››ç§æƒ…å†µï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;ä¸åŒ…å«ä»»ä½•caseï¼Œå³ç©ºselectï¼Œæ­¤æ—¶ä¼šé˜»å¡å½“å‰çš„goroutine&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åªåŒ…å«ä¸€ä¸ªcaseï¼Œæ­¤æ—¶selectä¼šè¢«ä¼˜åŒ–æˆ if ï¼Œå½“chanæ²¡æœ‰æ•°æ®å¯æ¥æ”¶æ—¶ï¼Œå°±ä¼šæŠŠé˜»å¡å½“å‰goroutineï¼Œç›´åˆ°æœ‰æ•°æ®åˆ°æ¥ï¼›å¦‚æœchanæ˜¯nilï¼Œå°±ä¼šæ°¸è¿œé˜»å¡å½“å‰goroutine&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;k&#34;&gt;select&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// ...    
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;// ä¼šè¢«ä¼˜åŒ–æˆ
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ch&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;nf&#34;&gt;block&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;nx&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ch&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;// ...
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;
&lt;p&gt;å­˜åœ¨ä¸¤ä¸ªcaseï¼Œå…¶ä¸­ä¸€ä¸ªæ˜¯defaultï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å‘é€ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œå‘é€æ˜¯ä¸é˜»å¡çš„ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;nx&#34;&gt;ch&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;make&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;chan&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// ä¸€å®šè¦1åŠä»¥ä¸Šï¼Œæ‰å…ˆä¼šèµ°caseï¼Œå¦‚æœæ˜¯0ä¼šæ­»é”ï¼Œç›´æ¥èµ°defaultï¼Œ
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;select&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ch&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// ...
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// ...
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;// åº•å±‚è°ƒç”¨çš„æ˜¯chansend(c, elem, false, getcallerpc())ï¼Œè¿™é‡Œçš„é˜»å¡å‚æ•°æ˜¯falseï¼Œ è¡¨ç¤ºè¿™æ¬¡å‘é€ä¸ä¼šé˜»å¡
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;selectnbsend&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// ...
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// ...
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;æ¥æ”¶ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œchanæœ‰å€¼å°±èµ°caseï¼Œå¦åˆ™èµ°default&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;  &lt;span class=&#34;k&#34;&gt;select&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
  &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;v&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// case v, received &amp;lt;- ch:
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;c1&#34;&gt;// ...
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
      &lt;span class=&#34;c1&#34;&gt;// ...
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;selectnbrecv&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// if selectnbrecv2(&amp;amp;v, &amp;amp;received, ch) {
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;c1&#34;&gt;// ...
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;c1&#34;&gt;// ...
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;é€šç”¨çš„selectæ¡ä»¶ï¼šæ¯”å¦‚selecté‡ŒåŒ…å«å¤šä¸ªcaseï¼Œä¼šç¼–è¯‘æˆé€šè¿‡&lt;code&gt;runtimeçš„selectgoæ–¹æ³•&lt;/code&gt;å¤„ç†caseï¼Œ&lt;code&gt;selectgo&lt;/code&gt;ä¼šè¿”å› caseçš„åºå· è¿˜æœ‰ æ˜¯å¦è¢«æ¥æ”¶çš„æ ‡è¯†ï¼Œç„¶åè¢«ç¼–è¯‘æˆå¤šä¸ªifï¼Œç”¨äºåˆ¤æ–­é€‰ä¸­å“ªä¸ªcaseã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;  &lt;span class=&#34;nx&#34;&gt;selv&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;scase&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
  &lt;span class=&#34;nx&#34;&gt;order&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;6&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint16&lt;/span&gt;
  &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cas&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;range&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cases&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;scase&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
      &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;kind&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
      &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;elem&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
      &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
  &lt;span class=&#34;nx&#34;&gt;chosen&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;revcOK&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;selectgo&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;selv&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;order&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;chosen&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;c1&#34;&gt;// ...
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;k&#34;&gt;break&lt;/span&gt;
  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;chosen&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;c1&#34;&gt;// ...
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;k&#34;&gt;break&lt;/span&gt;
  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;chosen&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;c1&#34;&gt;// ...
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;k&#34;&gt;break&lt;/span&gt;
  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;selectgoçš„æµç¨‹&#34;&gt;selectgoçš„æµç¨‹&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;è·å–caseæ•°ç»„ï¼Œéšæœºæ‰“ä¹±ï¼Œç¡®å®šæ‰“ä¹±åçš„è½®è¯¢é¡ºåºæ•°ç»„pollorderå’ŒåŠ é”é¡ºåºæ•°ç»„lockorderï¼Œæ•°ç»„é‡Œå­˜æ”¾çš„å…ƒç´ æ˜¯chan&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æŒ‰åŠ é”é¡ºåºæ•°ç»„ï¼Œè°ƒç”¨chançš„é”ï¼Œä¾æ¬¡è¿›è¡Œé”å®š&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è¿›å…¥ä¸»å¾ªç¯ï¼Œéå† è½®è¯¢é¡ºåºæ•°ç»„pollorder&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;ç¬¬ä¸€é˜¶æ®µ&lt;/strong&gt;ï¼ŒæŸ¥æ‰¾æ˜¯å¦å·²ç»å­˜åœ¨å‡†å¤‡å°±ç»ªçš„chanï¼ˆæ­¤æ—¶çš„chanå¯ä»¥æ‰§è¡Œæ”¶å‘æ“ä½œï¼‰æ­¤æ—¶éœ€è¦å¤„ç†å››ç§ç±»å‹çš„caseï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;å½“caseä¸åŒ…å«chanæ—¶ï¼Œç›´æ¥è·³è¿‡ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å½“caseä¼šä»chanä¸­æ¥æ”¶æ•°æ®æ—¶ï¼š&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚æœå½“å‰chançš„&lt;code&gt;sendqé˜Ÿåˆ—&lt;/code&gt;ä¸Šæœ‰ç­‰å¾…çš„goroutineï¼Œå°±ä¼šè·³åˆ° &lt;code&gt;recvæ ‡ç­¾&lt;/code&gt;ï¼Œå¦‚æœæ²¡æœ‰bufåŒºï¼Œåˆ™ä»&lt;code&gt;sendqé˜Ÿåˆ—&lt;/code&gt;ä¸Šè·å–æ•°æ®ï¼Œå¦åˆ™ï¼Œä»chançš„bufåŒºè¯»å–æ•°æ®åï¼Œå°†&lt;code&gt;sendqé˜Ÿåˆ—&lt;/code&gt;ä¸­ç­‰å¾…çš„goroutineä¸­çš„æ•°æ®æ”¾å…¥åˆ°bufåŒºä¸­ç›¸åŒçš„ä½ç½®ï¼›&lt;/li&gt;
&lt;li&gt;å¦‚æœå½“å‰chançš„bufåŒºä¸ä¸ºç©ºï¼Œå°±è·³åˆ°&lt;code&gt;bufrecvæ ‡ç­¾&lt;/code&gt;ï¼Œä»chançš„bufåŒºä¸­è·å–æ•°æ®&lt;/li&gt;
&lt;li&gt;å¦‚æœå½“å‰chanå·²ç»è¢«å…³é—­ï¼Œå°±ä¼šè·³åˆ° &lt;code&gt;rcloseæ ‡ç­¾&lt;/code&gt; åšä¸€äº›æ¸…é™¤çš„æ”¶å°¾å·¥ä½œï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;å½“caseä¼šä»chanä¸­å‘é€æ•°æ®æ—¶ï¼š&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚æœå½“å‰chanå·²ç»è¢«å…³é—­ï¼Œä¼šç›´æ¥è·³åˆ° &lt;code&gt;scloseæ ‡ç­¾&lt;/code&gt;ï¼Œè§¦å‘panicï¼›&lt;/li&gt;
&lt;li&gt;å¦‚æœå½“å‰chançš„&lt;code&gt;recvqé˜Ÿåˆ—&lt;/code&gt;ä¸Šæœ‰ç­‰å¾…çš„goroutineï¼Œå°±è·³åˆ° &lt;code&gt;sendæ ‡ç­¾&lt;/code&gt; å‘chanå‘é€æ•°æ®ï¼›&lt;/li&gt;
&lt;li&gt;å¦‚æœå½“å‰chançš„ç¼“å†²åŒºå­˜åœ¨ç©ºé—²ä½ç½®ï¼Œå°±ä¼šå°†ç­‰å¾…å‘é€çš„æ•°æ®å­˜å…¥ç¼“å†²åŒºä¸­ï¼Œå› ä¸ºselectç›¸å½“äºæœ‰æ¥æ”¶è€…äº†ï¼Œä¸ä¼šå‡ºç°å‘é€é˜»å¡çš„æƒ…å†µï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start=&#34;4&#34;&gt;
&lt;li&gt;å½“caseæ˜¯defaultæ—¶ï¼Œè¡¨ç¤ºå‰é¢çš„æ‰€æœ‰caseéƒ½æ²¡æœ‰è¢«æ‰§è¡Œï¼Œæ­¤æ—¶ä¼šè§£é”æ‰€æœ‰çš„chanå¹¶è¿”å›ï¼ˆæ„å‘³ç€å½“å‰selectç»“æ„çš„æ”¶å‘éƒ½æ˜¯éé˜»å¡çš„ï¼‰ï¼Œç›´æ¥æ‰§è¡Œdefaultå†…å®¹ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ç¬¬ä¸€é˜¶æ®µåªæ˜¯æŸ¥æ‰¾æ‰€æœ‰caseä¸­æ˜¯å¦æœ‰å¯ä»¥ç«‹å³è¢«å¤„ç†çš„chanï¼Œæ— è®ºæ˜¯æ•°æ®æ˜¯åœ¨ç­‰å¾…çš„goroutineä¸Šï¼Œè¿˜æ˜¯bufåŒºä¸­ï¼Œåªè¦å­˜åœ¨æ•°æ®æ»¡è¶³æ¡ä»¶å°±ä¼šç«‹å³å¤„ç†ï¼Œç„¶åè¿”å›ï¼›å¦‚æœä¸èƒ½ç«‹åˆ»æ‰¾åˆ°æ´»è·ƒçš„chanï¼Œå°±ä¼šè¿›å…¥ä¸‹ä¸€å¾ªç¯ï¼›&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç¬¬äºŒé˜¶æ®µ&lt;/strong&gt;ï¼Œå°†å½“å‰goroutineåŠ å…¥åˆ°chanå¯¹åº”çš„æ”¶å‘é˜Ÿåˆ—ä¸Šå¹¶ç­‰å¾…å…¶ä»–goroutineçš„å”¤é†’:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å°†å½“å‰goroutineï¼ŒåŒ…è£…æˆsudogoï¼Œéå†caseï¼ŒåŠ å…¥åˆ°caseçš„chançš„&lt;code&gt;sendqé˜Ÿåˆ—&lt;/code&gt;æˆ–è€…&lt;code&gt;recvqé˜Ÿåˆ—&lt;/code&gt;ä¸­ï¼ˆåŒæ—¶ï¼Œè¿™ä¸ªsudogä¼šå…³è”å½“å‰caseçš„chanï¼Œç„¶åå°†è¿™äº›sudogç»„æˆé“¾è¡¨ï¼ŒæŒ‚åœ¨å½“å‰goroutineä¸‹ï¼Œç”¨äºå”¤é†’ä¹‹åçš„æŸ¥æ‰¾ï¼‰&lt;/p&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/go_selectgo.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/go_selectgo.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è°ƒç”¨&lt;code&gt;goparkå‡½æ•°&lt;/code&gt;æŒ‚èµ·å½“å‰goroutineï¼Œç­‰å¾…è¢«è°ƒåº¦å™¨å”¤é†’ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;ç¬¬ä¸‰é˜¶æ®µ&lt;/strong&gt;ï¼Œå½“å‰goroutineè¢«å”¤é†’åï¼Œæ‰¾åˆ°æ»¡è¶³æ¡ä»¶çš„chanå¹¶è¿›è¡Œå¤„ç†ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç­‰åˆ°selectå¯¹åº”çš„chanå‡†å¤‡å¥½åï¼Œå½“å‰goroutineä¼šè¢«è°ƒåº¦å™¨å”¤é†’ï¼Œè¢«å”¤é†’åï¼Œè·å–å½“å‰goroutineçš„sudogï¼Œä¾æ¬¡å¯¹æ¯”æ‰€æœ‰caseé‡Œchanå¯¹åº”çš„sudogç»“æ„ï¼Œæ‰¾åˆ°è¢«å”¤é†’çš„caseï¼Œå¹¶é‡Šæ”¾å…¶ä»–æœªè¢«ä½¿ç”¨çš„sudogç»“æ„ï¼›&lt;/li&gt;
&lt;li&gt;ç”±äºå½“å‰çš„selectç»“æ„å·²ç»è¢«æŒ‘é€‰äº†å…¶ä¸­ä¸€ä¸ªcaseæ‰§è¡Œï¼Œå‰©ä¸‹çš„caseä¸­æ²¡æœ‰è¢«ç”¨åˆ°çš„sudogä¼šè¢«ç›´æ¥å¿½ç•¥å¹¶é‡Šæ”¾æ‰ï¼Œä¸ºäº†ä¸å½±å“chançš„æ­£å¸¸ä½¿ç”¨ï¼Œè¿˜éœ€è¦å°†è¿™äº›åºŸå¼ƒçš„sudogä»chanä¸­å‡ºé˜Ÿï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;selectgo&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cas0&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;scase&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;order0&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint16&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ncases&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;cas1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;16&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;scase&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;unsafe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Pointer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cas0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;order1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;17&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint16&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;unsafe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Pointer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;order0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;

    &lt;span class=&#34;nx&#34;&gt;scases&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cas1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[:&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ncases&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ncases&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// è½®è¯¢é¡ºåºæ•°ç»„
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;pollorder&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;order1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[:&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ncases&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ncases&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// åŠ é”é¡ºåºæ•°ç»„
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;lockorder&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;order1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ncases&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:][:&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ncases&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ncases&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;

    &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;range&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;scases&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;nx&#34;&gt;cas&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;scases&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;kind&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;caseDefault&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
            &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cas&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;scase&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

    &lt;span class=&#34;c1&#34;&gt;// æ ¹æ®chançš„åœ°å€æ’åº
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ncases&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;c1&#34;&gt;// éšæœºè½®è¯¢ï¼Œé¿å…chané¥¿æ­»
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;nx&#34;&gt;j&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;fastrandn&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
        &lt;span class=&#34;nx&#34;&gt;pollorder&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pollorder&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;j&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
        &lt;span class=&#34;nx&#34;&gt;pollorder&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;j&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;uint16&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// æŒ‰ç…§ä¹‹å‰ç”Ÿæˆçš„åŠ é”é¡ºåºé”å®š select è¯­å¥ä¸­åŒ…å«æ‰€æœ‰çš„ Channel
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nf&#34;&gt;sellock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;scases&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;lockorder&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

    &lt;span class=&#34;c1&#34;&gt;// ...åé¢å¤ªé•¿å°±ä¸è´´äº†
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h1 id=&#34;timer&#34;&gt;Timer&lt;/h1&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.cyhone.com/articles/analysis-of-golang-timer/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://www.cyhone.com/articles/analysis-of-golang-timer/&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;æ—¶é—´è½®&#34;&gt;æ—¶é—´è½®&lt;/h1&gt;
&lt;p&gt;æ¦‚å¿µç†è§£ï¼š&lt;a class=&#34;link&#34; href=&#34;https://zhuanlan.zhihu.com/p/121483218&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;ä¸€å¼ å›¾ç†è§£Kafkaæ—¶é—´è½®&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://lk668.github.io/2021/04/05/2021-04-05-%E6%89%8B%E6%8A%8A%E6%89%8B%E6%95%99%E4%BD%A0%E5%A6%82%E4%BD%95%E7%94%A8golang%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AAtimewheel/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;æ‰‹æŠŠæ‰‹æ•™ä½ å¦‚ä½•ç”¨golangå®ç°ä¸€ä¸ªtimewheelæ—¶é—´è½®&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.luozhiyun.com/archives/444&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Goè¯­è¨€ä¸­æ—¶é—´è½®çš„å®ç°&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/Kafka%e6%97%b6%e9%97%b4%e8%bd%ae%e7%ae%80%e5%8d%95%e5%ae%9e%e7%8e%b0.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/Kafka%e6%97%b6%e9%97%b4%e8%bd%ae%e7%ae%80%e5%8d%95%e5%ae%9e%e7%8e%b0.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;æ€»ç»“ï¼š&lt;/p&gt;
&lt;p&gt;é€šè¿‡DelayQueueï¼ˆä¼˜å…ˆçº§é˜Ÿåˆ—å®ç°ï¼Œé˜Ÿåˆ—é‡Œçš„æ¯ä¸ªå…ƒç´ ï¼Œéƒ½æ˜¯æŸä¸€ä¸ªå…·ä½“æ—¶é—´çš„listï¼‰ + ç¯å½¢æ•°ç»„ï¼ˆæ•°ç»„çš„æ¯ä¸ªå…ƒç´ æ˜¯ä¸ªlistï¼Œç´¢å¼•ä»£è¡¨æ—¶é—´æ ¼ï¼‰&lt;/p&gt;
&lt;p&gt;DelayQueueä¼šæ ¹æ®ç¯å½¢æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ è¿›è¡Œæ’åºï¼›&lt;/p&gt;
&lt;p&gt;æ·»åŠ ä»»åŠ¡æ—¶ï¼Œåˆ¤æ–­ä»»åŠ¡æ‰§è¡Œæ—¶é—´ï¼ŒåŠ å…¥ç¯å½¢æ•°ç»„ä¸­ï¼Œå¯¹åº”çš„ç¯å½¢æ•°ç»„çš„å…ƒç´ ï¼ˆlistï¼‰ï¼ŒåŠ å…¥DelayQueueä¸­ã€‚ï¼Œ&lt;/p&gt;
</description>
        </item>
        <item>
        <title>Go</title>
        <link>http://nixum.cc/p/go/</link>
        <pubDate>Sat, 07 Nov 2020 00:00:00 +0000</pubDate>
        
        <guid>http://nixum.cc/p/go/</guid>
        <description>&lt;p&gt;[TOC]&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ä»¥ä¸‹åŸºäºgo.1.14&lt;/strong&gt;&lt;/p&gt;
&lt;h1 id=&#34;å‡½æ•°å†…è”ä¼˜åŒ–&#34;&gt;å‡½æ•°å†…è”ä¼˜åŒ–&lt;/h1&gt;
&lt;p&gt;å‡½æ•°å†…è”ä¼˜åŒ–ï¼šåœ¨Aå‡½æ•°ä¸­è°ƒç”¨äº†Bå‡½æ•°ï¼Œå†…è”åï¼ŒBå‡½æ•°çš„ä»£ç ç›´æ¥åœ¨Aå‡½æ•°å†…åŸåœ°å±•å¼€ï¼Œä»£æ›¿è¿™ä¸ªå‡½æ•°å®ç°ï¼Œå½“æœ‰å¤šæ¬¡è°ƒç”¨æ—¶ï¼Œå°±ä¼šå¤šæ¬¡å±•å¼€&lt;/p&gt;
&lt;p&gt;goåœ¨ç¼–è¯‘æ—¶ä¼šè‡ªåŠ¨åˆ¤æ–­å‡½æ•°æ˜¯å¦å¯ä»¥å†…è”ï¼Œå½“å‡½æ•°å†…åŒ…å«ä»¥ä¸‹å†…å®¹æ—¶ä¸ä¼šè¢«å†…è”ï¼šé—­åŒ…è°ƒç”¨ï¼Œselectï¼Œforï¼Œdeferï¼Œgoå…³é”®å­—åˆ›å»ºçš„åç¨‹ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;å†…è”çš„å¥½å¤„ï¼šå› ä¸ºå‡½æ•°è°ƒç”¨è¢«å†…è”äº†ï¼Œå¯ä»¥å‡å°‘æ ˆå¸§çš„åˆ›å»ºï¼Œå‡å°‘è¯»å†™å¯„å­˜å™¨çš„è¯»å–ï¼Œå‡å°‘å‚æ•°å’Œå‡½æ•°çš„æ‹·è´ï¼Œæå‡æ€§èƒ½&lt;/p&gt;
&lt;p&gt;ç¼ºç‚¹ï¼šå †æ ˆpanicæ˜¾ç¤ºçš„è¡Œæ•°å¯èƒ½ä¸å‡†ç¡®ã€å¢åŠ ç¼–è¯‘å‡ºæ¥çš„åŒ…çš„å¤§å°&lt;/p&gt;
&lt;p&gt;ç¼–è¯‘æ—¶ä½¿ç”¨&lt;code&gt;go build -gcflags=&amp;quot;-m -m&amp;quot; main.go&lt;/code&gt;å¯ä»¥çŸ¥é“ç¼–è¯‘å™¨çš„å†…è”ä¼˜åŒ–ç­–ç•¥ï¼Œ&lt;/p&gt;
&lt;p&gt;goç¼–è¯‘æ—¶é»˜è®¤ä¼šä½¿ç”¨å†…è”ä¼˜åŒ–ï¼Œä½¿ç”¨&lt;code&gt;go build --gcflags=&amp;quot;-l&amp;quot; main.go&lt;/code&gt;å¯ç¦æ‰å…¨å±€å†…è”ï¼Œå¦‚æœä¼ é€’ä¸¤ä¸ªæˆ–ä»¥ä¸Š-lï¼Œåˆ™ä¼šæ‰“å¼€å†…è”ï¼›&lt;/p&gt;
&lt;h1 id=&#34;defer&#34;&gt;defer&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¤šä¸ªdeferæ˜¯æ ˆçš„å…³ç³»ï¼Œä»¥é“¾è¡¨çš„å½¢å¼æŒ‚åœ¨Gä¸Šï¼Œå…ˆè¿›åå‡º&lt;/strong&gt;ï¼Œå³åœ¨ä¸€ä¸ªå‡½æ•°ä¸­ï¼Œå†™åœ¨å‰é¢çš„deferä¼šæ¯”å†™åœ¨åé¢çš„deferè°ƒç”¨å¾—æ™šï¼Œå…ˆè¿›åå‡ºçš„åŸå› æ˜¯åé¢å®šä¹‰çš„å‡½æ•°å¯èƒ½ä¼šä¾èµ–å‰é¢çš„èµ„æºï¼Œå¦‚æœå‰é¢çš„å…ˆæ‰§è¡Œå¯¼è‡´ä¾èµ–æ²¡äº†ï¼Œä¼šå½±å“åé¢çš„æ‰§è¡Œï¼Œå¯¼è‡´å‡ºé”™ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;deferå’ŒreturnåŒæ—¶å‡ºç°æ—¶ï¼Œå…ˆreturnådeferï¼Œdeferå¯ä»¥ä¿®æ”¹åˆ°returné‡Œçš„å˜é‡ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;return æ˜¯éåŸå­æ€§çš„ï¼Œéœ€è¦ä¸¤æ­¥ï¼Œæ‰§è¡Œå‰é¦–å…ˆè¦ä¸ºè¿”å›å€¼èµ‹å€¼ï¼Œç„¶å return å°†è¿”å›å€¼è¿”å›è°ƒç”¨å¤„ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;defer å’Œ return çš„æ‰§è¡Œé¡ºåºæ˜¯ï¼š1. å…ˆä¸ºè¿”å›å€¼èµ‹å€¼ï¼›2. ç„¶åæ‰§è¡Œ deferï¼›3. ç„¶å return åˆ°å‡½æ•°è°ƒç”¨å¤„&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;è¦æ³¨æ„defer + å‡½æ•° çš„åœºæ™¯ï¼Œå¦‚æœæ˜¯å‡½æ•°è°ƒç”¨ï¼Œå¹¶ä¸”ä½¿ç”¨çš„å˜é‡æ˜¯ä¼ å‚è¿›å»çš„ï¼Œé‚£å¾—çœ‹å…¥å‚ç±»å‹ï¼›å¦‚æœæ˜¯é—­åŒ…è°ƒç”¨ï¼Œå¼•ç”¨äº†å¤–è¾¹çš„å˜é‡ï¼ˆä¸ç®¡æ˜¯ä¸æ˜¯æŒ‡é’ˆï¼‰ï¼Œé‚£å°±æ˜¯å¼•ç”¨&lt;/p&gt;
&lt;p&gt;å½“è¿”å›å€¼æ²¡æœ‰å£°æ˜å˜é‡æ—¶ï¼Œä¼šå†…ç½®ä¸€ä¸ªéšå¼çš„å˜é‡æ¥æ¥æ”¶returnçš„èµ‹å€¼&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;panicè¢«è§¦å‘æ—¶ï¼Œæ§åˆ¶æƒå°±äº¤ç»™äº†defer&lt;/p&gt;
&lt;p&gt;é‡åˆ°panicæ—¶ï¼Œä¼šå…ˆéå†æ­¤åç¨‹å†…çš„deferé“¾è¡¨ï¼Œå¹¶æ‰§è¡Œdeferï¼Œå¦‚æœåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­é‡åˆ°recoverï¼Œåˆ™åœæ­¢panicï¼Œè¿”å›recoverå¤„ç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œå¦‚æœæ²¡é‡åˆ°recoverï¼Œåˆ™éå†å®Œæœ¬åç¨‹çš„deferé“¾è¡¨åï¼Œå‘stderræŠ›å‡ºpanicä¿¡æ¯ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ‰§è¡Œdeferè¿‡ç¨‹ä¸­å‡ºç°panicï¼Œæ­¤æ—¶çš„panicä¼šè¦†ç›–å®ƒä¹‹å‰çš„panicï¼Œç›´è‡³è¢«æ•è·æˆ–æŠ›å‡ºï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;48
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;49
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;50
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;51
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;52
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;53
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;54
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;55
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;56
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;57
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;58
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;59
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;60
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;61
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;test1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// 0 0
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;test2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// 3 3
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;test21&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// 0 3
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;test3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// 0 4
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;test4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// 0 5
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// æ³¨æ„è¿”å›å€¼æ˜¯å¦å·²ç»å£°æ˜äº†å˜é‡
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;test5&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// 1 0
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;test51&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// 1 1
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;test1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;v&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;defer&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34; &amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// 0
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;v&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;test2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;v&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;defer&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34; &amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// 3
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;p&#34;&gt;}()&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;// test2 å’Œ test21 çš„å·®å¼‚åœ¨äºé—­åŒ…
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;test21&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;v&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// ç›¸å½“äºè°ƒç”¨fmt.Printæ–¹æ³•ï¼Œç„¶åæŠŠvä¼ å€¼è¿›å»ï¼Œæ­¤æ—¶ v=0ï¼Œvå·²ç»èµ‹å€¼ç»™äº†fmt.Printæ–¹æ³•çš„å…¥å‚äº†
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// ç±»ä¼¼ test4()
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;defer&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34; &amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// 0
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;test3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;v&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;defer&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34; &amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// 0
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;v&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;test4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;v&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;defer&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;n&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;n&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34; &amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// 0
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;p&#34;&gt;}(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;5&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;// åŒºåˆ† test51, åŒºåˆ«åœ¨äºè¿”å›å€¼æ˜¯å¦å£°æ˜äº†å˜é‡åï¼Œå½“è¿”å›å€¼æ²¡æœ‰å£°æ˜å˜é‡æ—¶ï¼Œreturnä¼šæŠŠå€¼èµ‹å€¼ç»™ä¸€ä¸ªéšå¼çš„å˜é‡ï¼Œä¹‹åéšä¾¿iæ€ä¹ˆæ”¹ï¼Œéƒ½ä¸å½±å“å…¶è¿”å›å€¼
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;test5&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;defer&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34; &amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// 1
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;p&#34;&gt;}()&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;test51&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;defer&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34; &amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// 1
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;p&#34;&gt;}()&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h1 id=&#34;å†…å­˜å¯¹é½&#34;&gt;å†…å­˜å¯¹é½&lt;/h1&gt;
&lt;p&gt;CPUè¯»å–æ•°æ®æ—¶ä¸ä¼šä¸€ä¸ªå­—èŠ‚ä¸€ä¸ªå­—èŠ‚å»è¯»å–ï¼Œè€Œæ˜¯ä¸€å—ä¸€å—ï¼Œå—çš„å¤§å°å¯ä»¥æ˜¯2ã€4ã€6ã€8ã€16å­—èŠ‚ï¼Œå—å¤§å°ç§°ä¸ºå†…å­˜è®¿é—®ç²’åº¦ã€‚32ä½CPUä¸€æ¬¡è¯»å–4ä¸ªå­—èŠ‚ï¼Œ64ä½CPUä¸€æ¬¡è¯»å–8ä¸ªå­—èŠ‚ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœæœªè¿›è¡Œå†…å­˜å¯¹é½ï¼Œä¼šå¯¼è‡´CPUè¿›è¡Œä¸¤æ¬¡å†…å­˜è®¿é—®ï¼Œå¹¶ä¸”éœ€è¦èŠ±è´¹é¢å¤–çš„æ—¶é’Ÿå‘¨æœŸæ¥å¤„ç†å¯¹é½åŠè¿ç®—ï¼Œå¦‚æœå¯¹é½äº†å†…å­˜ï¼Œä¸€æ¬¡è¯»å–å°±èƒ½è®¿é—®å®Œæˆï¼Œå†…å­˜å¯¹é½å¯èƒ½ä¼šè€—è´¹é¢å¤–çš„ç©ºé—´ï¼Œä½†æ˜¯å¯ä»¥åŠ å¿«è¯»å–æ•ˆç‡ï¼Œæ ‡å‡†çš„ç©ºé—´æ¢æ—¶é—´åšæ³•ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥32ä½CPUå¯¹é½ä¸ºä¾‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;8
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Part1&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;a&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;b&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int32&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int8&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;d&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int64&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;e&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;// ä¹ä¸€çœ‹æŒ‰æ¯ä¸ªç±»å‹æ‰€å å­—èŠ‚æ•°å»ç®—ï¼Œç®—å‡ºæ¥çš„å†…å­˜å ç”¨æ˜¯15ä¸ªå­—èŠ‚ï¼Œä½†å®é™…ä¸Šæ˜¯32å­—èŠ‚
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;å¯¹é½è§„åˆ™ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;ç»“æ„ä½“çš„æˆå‘˜å˜é‡ï¼Œç¬¬ä¸€ä¸ªæˆå‘˜å˜é‡çš„åç§»é‡ä¸º 0ã€‚å¾€åçš„æ¯ä¸ªæˆå‘˜å˜é‡çš„å¯¹é½å€¼å¿…é¡»ä¸ºç¼–è¯‘å™¨é»˜è®¤å¯¹é½é•¿åº¦ï¼ˆ&lt;code&gt;#pragma pack(n)&lt;/code&gt;ï¼‰æˆ–å½“å‰æˆå‘˜å˜é‡ç±»å‹çš„é•¿åº¦ï¼ˆ&lt;code&gt;unsafe.Sizeof&lt;/code&gt;ï¼‰ï¼Œå–æœ€å°å€¼ä½œä¸ºå½“å‰ç±»å‹çš„å¯¹é½å€¼ã€‚å…¶åç§»é‡å¿…é¡»ä¸ºå¯¹é½å€¼çš„æ•´æ•°å€&lt;/li&gt;
&lt;li&gt;ç»“æ„ä½“æœ¬èº«ï¼Œå¯¹é½å€¼å¿…é¡»ä¸ºç¼–è¯‘å™¨é»˜è®¤å¯¹é½é•¿åº¦ï¼ˆ&lt;code&gt;#pragma pack(n)&lt;/code&gt;ï¼‰æˆ–ç»“æ„ä½“çš„æ‰€æœ‰æˆå‘˜å˜é‡ç±»å‹ä¸­çš„æœ€å¤§é•¿åº¦ï¼Œå–æœ€å¤§æ•°çš„æœ€å°æ•´æ•°å€ä½œä¸ºå¯¹é½å€¼&lt;/li&gt;
&lt;li&gt;ç»“åˆä»¥ä¸Šä¸¤ç‚¹ï¼Œå¯å¾—çŸ¥è‹¥ç¼–è¯‘å™¨é»˜è®¤å¯¹é½é•¿åº¦ï¼ˆ&lt;code&gt;#pragma pack(n)&lt;/code&gt;ï¼‰è¶…è¿‡ç»“æ„ä½“å†…æˆå‘˜å˜é‡çš„ç±»å‹æœ€å¤§é•¿åº¦æ—¶ï¼Œé»˜è®¤å¯¹é½é•¿åº¦æ˜¯æ²¡æœ‰ä»»ä½•æ„ä¹‰çš„&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;å¯¹é½è¿‡ç¨‹ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æˆå‘˜å˜é‡&lt;/th&gt;
&lt;th&gt;ç±»å‹&lt;/th&gt;
&lt;th&gt;åç§»é‡&lt;/th&gt;
&lt;th&gt;è‡ªèº«å ç”¨&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;a&lt;/td&gt;
&lt;td&gt;bool&lt;/td&gt;
&lt;td&gt;0&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å­—èŠ‚å¯¹é½&lt;/td&gt;
&lt;td&gt;æ— &lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;3&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;b&lt;/td&gt;
&lt;td&gt;int32&lt;/td&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;c&lt;/td&gt;
&lt;td&gt;int8&lt;/td&gt;
&lt;td&gt;8&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å­—èŠ‚å¯¹é½&lt;/td&gt;
&lt;td&gt;æ— &lt;/td&gt;
&lt;td&gt;9&lt;/td&gt;
&lt;td&gt;7&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;d&lt;/td&gt;
&lt;td&gt;int64&lt;/td&gt;
&lt;td&gt;16&lt;/td&gt;
&lt;td&gt;8&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;e&lt;/td&gt;
&lt;td&gt;byte&lt;/td&gt;
&lt;td&gt;24&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å­—èŠ‚å¯¹é½&lt;/td&gt;
&lt;td&gt;æ— &lt;/td&gt;
&lt;td&gt;25&lt;/td&gt;
&lt;td&gt;7&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æ€»å ç”¨å¤§å°&lt;/td&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;td&gt;32&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;å†…å­˜å¸ƒå±€ï¼šaxxx|bbbb|cxxx|xxxx|dddd|dddd|eï¼Œä¹‹åè¦ä¿è¯æ•´ä¸ªç»“æ„ä½“è¿›è¡Œå­—èŠ‚å¯¹é½ï¼Œå‘ç°å®ƒä¸æ˜¯2^nï¼Œå¯å¾—å‡ºæœ€è¿‘ä¸€ä¸ªæ•°æ˜¯32ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹ç»“æ„ä½“å†…å­—æ®µé¡ºåºè¿›è¡Œè°ƒæ•´åï¼Œå¯ä»¥å‘ç°ç®—å‡ºæ¥çš„å¤§å°ä¼šä¸ä¸€æ ·&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;8
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Part2&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;e&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int8&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;a&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;b&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int32&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;d&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int64&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;// è°ƒæ•´å­—æ®µé¡ºåºåï¼Œç®—å‡ºæ¥çš„å¤§å°æ˜¯16ï¼ŒåŸå› æ˜¯æ•´ä¸ªç»“æ„ä½“æœ¬èº«ä¸éœ€è¦é¢å¤–å¯¹é½
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æˆå‘˜å˜é‡&lt;/th&gt;
&lt;th&gt;ç±»å‹&lt;/th&gt;
&lt;th&gt;åç§»é‡&lt;/th&gt;
&lt;th&gt;è‡ªèº«å ç”¨&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;e&lt;/td&gt;
&lt;td&gt;byte&lt;/td&gt;
&lt;td&gt;0&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;c&lt;/td&gt;
&lt;td&gt;int8&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;a&lt;/td&gt;
&lt;td&gt;bool&lt;/td&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å­—èŠ‚å¯¹é½&lt;/td&gt;
&lt;td&gt;æ— &lt;/td&gt;
&lt;td&gt;3&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;b&lt;/td&gt;
&lt;td&gt;int32&lt;/td&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;d&lt;/td&gt;
&lt;td&gt;int64&lt;/td&gt;
&lt;td&gt;8&lt;/td&gt;
&lt;td&gt;8&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æ€»å ç”¨å¤§å°&lt;/td&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;td&gt;16&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;å†…å­˜å¸ƒå±€ï¼šecax|bbbb|dddd|dddd&lt;/p&gt;
&lt;h1 id=&#34;æ•°ç»„&#34;&gt;æ•°ç»„&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;å£°æ˜æ—¶å¿…é¡»æŒ‡å®šå›ºå®šé•¿åº¦ï¼Œå› ä¸ºç¼–è¯‘æ—¶éœ€è¦çŸ¥é“æ•°ç»„é•¿åº¦ä»¥ä¾¿åˆ†é…å†…å­˜ï¼Œå¦‚&lt;code&gt;var arr1 [5]int&lt;/code&gt;ï¼Œæˆ–è€…&lt;code&gt;var arr2 = [5]int{1,2,3}, å…¶ä½™æ•°å­—ä¸º0&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;æ•°ç»„&lt;strong&gt;é•¿åº¦æœ€å¤§æ˜¯2Gb&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;å½“æ•°ç»„ç±»å‹æ˜¯æ•´å½¢æ—¶ï¼Œæ‰€æœ‰å…ƒç´ éƒ½ä¼šè¢«è‡ªåŠ¨åˆå§‹åŒ–ä¸º0ï¼Œå³å£°æ˜å®Œæ•°ç»„ï¼Œ&lt;strong&gt;æ•°ç»„ä¼šè¢«è®¾ç½®ç±»å‹çš„é»˜è®¤å€¼&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;å¯ä»¥ä½¿ç”¨new()æ¥åˆ›å»ºï¼Œå¦‚&lt;code&gt;var arr3 = new([3]int)&lt;/code&gt;ï¼Œarr3çš„ç±»å‹æ˜¯&lt;code&gt;*[3]int&lt;/code&gt;ï¼Œarr1ã€arr2çš„ç±»å‹æ˜¯&lt;code&gt;[5]int&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;å‡½æ•°çš„å‚æ•°å¯ä»¥æ˜¯[5]int, è¡¨æ˜å…¥å‚æ˜¯æ•°ç»„ï¼Œå¦‚æœæ˜¯[]intï¼Œè¡¨æ˜å…¥å‚æ˜¯sliceã€‚ç±»å‹[3]intå’Œ[5]intæ˜¯ä¸¤ç§ä¸åŒçš„ç±»å‹ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ•°ç»„æ˜¯å€¼ç±»å‹&lt;/strong&gt;ï¼Œèµ‹å€¼å’Œä¼ å‚ä¼šè¿›è¡Œæ‹·è´ï¼Œå‡½æ•°å†…éƒ¨çš„ä¿®æ”¹ä¸ä¼šå½±å“åŸå§‹æ•°ç»„ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœæ•°ç»„ä¸­çš„å…ƒç´ ä¸ªæ•°å°äºæˆ–ç­‰äº4ä¸ªï¼Œæ‰€æœ‰å˜é‡ä¼šç›´æ¥åœ¨æ ˆä¸Šåˆå§‹åŒ–ï¼›å½“æ•°ç»„å…ƒç´ å¤§äº4ä¸ªï¼Œå˜é‡å°±ä¼šåœ¨é™æ€å­˜å‚¨åŒºåˆå§‹åŒ–ç„¶åæ‹·è´åˆ°æ ˆä¸Šã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;åˆ‡ç‰‡slice&#34;&gt;åˆ‡ç‰‡Slice&lt;/h1&gt;
&lt;h2 id=&#34;æ•°æ®ç»“æ„&#34;&gt;æ•°æ®ç»“æ„&lt;/h2&gt;
&lt;p&gt;sliceæœ¬è´¨æ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼Œæ‰€ä»¥å®ƒæ˜¯å€¼ç±»å‹æ˜¯ä¸éš¾ç†è§£çš„ï¼Œå®ƒä»…ä»…åªæ˜¯å¯¹æ•°ç»„çš„ä¸€ç§åŒ…è£…ï¼Œä¸”è¯¥ç»“æ„ä½“ä¸åŒ…å«ä»»ä½•å‡½æ•°ï¼Œä»»ä½•å¯¹sliceçš„å¤„ç†éƒ½æ˜¯goçš„å†…ç½®å‡½æ•°æ¥å¤„ç†çš„ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Slice&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;ptr&lt;/span&gt;   &lt;span class=&#34;nx&#34;&gt;unsafe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Pointer&lt;/span&gt; 	&lt;span class=&#34;c1&#34;&gt;// æŒ‡å‘æ•°ç»„çš„æŒ‡é’ˆ
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;len&lt;/span&gt;   &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;               &lt;span class=&#34;c1&#34;&gt;// åˆ‡ç‰‡é•¿åº¦
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;cap&lt;/span&gt;   &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;               &lt;span class=&#34;c1&#34;&gt;// åˆ‡ç‰‡å®¹é‡
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id=&#34;åŸºæœ¬&#34;&gt;åŸºæœ¬&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;åˆ›å»ºæ—¶æ— éœ€æŒ‡å®šé•¿åº¦ï¼Œå¦‚ &lt;code&gt;slice1 := []int{1,2,3}, æ­¤æ—¶é•¿åº¦å’Œå®¹é‡å‡ä¸º3&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä»æ•°ç»„ä¸Šæˆªå–&lt;code&gt;arr1 := [5]int; var slice2 []int = arr1[1:3], æ­¤æ—¶é•¿åº¦2ï¼Œå®¹é‡5ï¼Œä¸”å¯¹slice2çš„ä¿®æ”¹ä¼šå½±å“arr1&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¯ä»¥ä½¿ç”¨make([]type, len, cap)æ¥åˆ›å»ºï¼Œlenå¿…å¡«ï¼Œcapéå¿…å¡«ï¼Œå¦‚æœcapä¸å¡«ï¼Œåˆå§‹cap=lenã€‚å¦‚&lt;code&gt;slice4 := make(int[], 5, 10)ï¼Œé•¿åº¦5ï¼Œå®¹é‡10&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¯ä»¥ä½¿ç”¨newæ¥åˆ›å»ºï¼Œæ¯”å¦‚ &lt;code&gt;new([100]int)[0:50]&lt;/code&gt; æ•ˆæœç­‰åŒäº &lt;code&gt;make([]int, 50, 100)&lt;/code&gt;ï¼Œæˆ–è€… &lt;code&gt;slice := *new([]int) ä¸ºç©ºåˆ‡ç‰‡&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç©ºåˆ‡ç‰‡ï¼š&lt;code&gt;slice := make([]int, 0) æˆ– slice := []int{}&lt;/code&gt;ï¼Œnilåˆ‡ç‰‡ï¼š&lt;code&gt;var slice *[]int æˆ– slice := *new([]int)&lt;/code&gt;ï¼›ä¸¤è€…çš„åŒºåˆ«åœ¨äºï¼Œç©ºåˆ‡ç‰‡ä¼šæŒ‡å‘ä¸€ä¸ªå†…å­˜åœ°å€ï¼Œä½†å®ƒæ²¡æœ‰åˆ†é…ä»»ä½•çš„å†…å­˜ç©ºé—´ï¼›nilåˆ‡ç‰‡æ˜¯ç›´æ¥æŒ‡å‘nilã€‚&lt;/p&gt;
&lt;p&gt;æ‰“å°æ—¶ï¼Œä¸¤è€…çš„ç»“æœå‡ä¸º&lt;code&gt;[], len=0ï¼Œ cap=0&lt;/code&gt;ï¼Œä½†nilåˆ‡ç‰‡ä¸nilæ¯”è¾ƒçš„ç»“æœä¸ºtrueï¼Œç©ºåˆ‡ç‰‡ä¸nilçš„æ¯”è¾ƒç»“æœä¸ºfalseã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åˆ‡ç‰‡æ˜¯å¯¹æ•°ç»„çš„ä¸€ä¸ªè¿ç»­ç‰‡æ®µçš„å¼•ç”¨ï¼Œå¯¹äº&lt;strong&gt;åˆ‡ç‰‡åº•å±‚æ•°ç»„æ˜¯å¼•ç”¨ç±»å‹&lt;/strong&gt;ï¼Œä½œä¸ºå‡½æ•°å‚æ•°æ—¶ï¼Œè™½ç„¶æ˜¯ä¼ åˆ‡ç‰‡çš„å€¼ï¼Œä½†æ˜¯åº•å±‚æ•°ç»„ä¼ é€’æŒ‡é’ˆï¼Œå‡½æ•°å†…éƒ¨çš„ä¿®æ”¹ä¼šå½±å“åŸå§‹æ•°ç»„&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¸€ä¸ªæ•°ç»„å¯ä»¥åˆ›å»ºå¤šä¸ªsliceï¼Œä¸€ä¸ªsliceä¹Ÿå¯ä»¥åˆ›å»ºå¤šä¸ªsliceï¼Œä½†æ˜¯æ–°è€sliceä¼šå…±ç”¨åº•å±‚æ•°ç»„ï¼Œæ–°è€sliceçš„ä¿®æ”¹éƒ½ä¼šäº’ç›¸å½±å“ã€‚ä½†æ˜¯å¦‚æœæ–°sliceç»è¿‡appendï¼Œä½¿å¾—sliceåº•å±‚æ•°ç»„æ‰©å®¹äº†ï¼Œæ­¤æ—¶sliceå¼•ç”¨äº†æ–°çš„æ•°ç»„ï¼Œæ­¤æ—¶æ–°è€sliceå°±ä¸ä¼šäº’ç›¸å½±å“äº†ã€‚&lt;/p&gt;
&lt;p&gt;è¯­æ³•ï¼š&lt;code&gt;ns = slice1[èµ·å§‹ä¸‹æ ‡:ç»“æŸä¸‹æ ‡(ä¸åŒ…æ‹¬):capå®¹é‡]&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;nx&#34;&gt;slice&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;slice&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// s = [1]
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;slice&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// s = [1, 2], len=2, cap=2
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;slice&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// s = [1, 2], len=2, cap=5
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;slice&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// s=[], len=0, cap=0
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä½¿ç”¨new()å’Œmake()çš„åŒºåˆ«&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;çœ‹èµ·æ¥äºŒè€…æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œéƒ½åœ¨å †ä¸Šåˆ†é…å†…å­˜ï¼Œä½†æ˜¯å®ƒä»¬çš„è¡Œä¸ºä¸åŒï¼Œé€‚ç”¨äºä¸åŒçš„ç±»å‹ã€‚&lt;/p&gt;
&lt;p&gt;new (T) ä¸ºæ¯ä¸ªæ–°çš„ç±»å‹ T åˆ†é…ä¸€ç‰‡å†…å­˜ï¼Œåˆå§‹åŒ–ä¸º 0 å¹¶ä¸”è¿”å›ç±»å‹ä¸º *T çš„å†…å­˜åœ°å€ï¼šè¿™ç§å‡½æ•° è¿”å›ä¸€ä¸ªæŒ‡å‘ç±»å‹ä¸º Tï¼Œå€¼ä¸º 0 çš„åœ°å€çš„æŒ‡é’ˆï¼Œå®ƒ&lt;strong&gt;é€‚ç”¨äºå€¼ç±»å‹ï¼Œå¦‚æ•°ç»„å’Œç»“æ„ä½“&lt;/strong&gt;ï¼›å®ƒç›¸å½“äº &amp;amp;T{}ã€‚
make(T) è¿”å›ä¸€ä¸ªç±»å‹ä¸º T çš„åˆå§‹å€¼ï¼Œå®ƒåª&lt;strong&gt;é€‚ç”¨äº 3 ç§å†…å»ºçš„å¼•ç”¨ç±»å‹ï¼šåˆ‡ç‰‡ã€map å’Œ channel&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;rangeéå†çš„æ³¨æ„ç‚¹ï¼šå°†sliceçš„æ¯ä¸ªå…ƒç´ èµ‹å€¼ç»™væ—¶ï¼Œå‘ç”Ÿäº†ä¸€æ¬¡æ‹·è´ï¼Œæ— æ³•é€šè¿‡ä¿®æ”¹væ¥ä¿®æ”¹sliceã€‚å¦‚æœæ˜¯sliceæ˜¯æŒ‡é’ˆç»“æ„ä½“ç±»å‹ï¼Œè¿˜æ˜¯èƒ½ä¿®æ”¹çš„ã€‚ä¹Ÿå°±æ˜¯è¯´å¦‚æœsliceæ˜¯æŒ‡é’ˆç±»å‹ï¼Œé€šè¿‡rangeéå†appendæ—¶è¦æ³¨æ„&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;8
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;arr2&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;newArr&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;v&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;range&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;arr2&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;newArr&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;append&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;newArr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;v&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;range&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;newArr&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;%v &amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// æ‰“å°3 3 3ï¼Œå› ä¸ºæ˜¯væŒ‡å‘äº†åŒä¸€ä¸ªæŒ‡é’ˆ
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id=&#34;æ‰©å®¹&#34;&gt;æ‰©å®¹&lt;/h2&gt;
&lt;h3 id=&#34;åŸç†&#34;&gt;åŸç†&lt;/h3&gt;
&lt;p&gt;å½“ä½¿ç”¨append()å‡½æ•°å‘sliceè¿½åŠ å…ƒç´ ï¼Œä¼šæ ¹æ®sliceçš„å®¹é‡åˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹ã€‚å¦å¤–ï¼Œå› ä¸ºsliceæ˜¯å€¼ä¼ é€’ï¼Œappend()å‡½æ•°ä¸ä¼šä¿®æ”¹ä¼ å…¥çš„sliceï¼Œè¿”å›æ˜¯é‡æ–°å¯¹åº•å±‚æ•°ç»„ã€é•¿åº¦ã€å®¹é‡åšåŒ…è£…ï¼Œè¿”å›æ–°sliceã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å¦‚æœsliceå®¹é‡å¤Ÿç”¨ï¼Œåˆ™ç›´æ¥æŠŠæ–°å…ƒç´ è¿½åŠ è¿›å»ï¼Œé•¿åº¦ + 1ï¼Œè¿”å›åŸslice&lt;/li&gt;
&lt;li&gt;åŸsliceå®¹é‡ä¸å¤Ÿï¼Œå°†sliceæ‰©å®¹ï¼Œå¾—åˆ°æ–°çš„slice&lt;/li&gt;
&lt;li&gt;å°†æ–°å…ƒç´ è¿½åŠ åˆ°æ–°sliceï¼Œé•¿åº¦ + 1ï¼Œè¿”å›æ–°slice&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å¦å¤–ï¼Œ&lt;strong&gt;copyå‡½æ•°æ‹·è´&lt;/strong&gt;ä¸¤ä¸ªsliceæ—¶ï¼Œä¼šå°†æºsliceæ‹·è´åˆ°ç›®æ ‡sliceï¼Œ&lt;strong&gt;å¦‚æœç›®æ ‡sliceçš„é•¿åº¦&amp;lt;æºsliceï¼Œä¸ä¼šå‘ç”Ÿæ‰©å®¹&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;Demoï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;nx&#34;&gt;data&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;10&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
&lt;span class=&#34;nx&#34;&gt;slice&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;8&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;span class=&#34;nx&#34;&gt;slice&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;append&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;slice&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;9&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// slice=? data=?
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;slice&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;append&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;slice&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;10&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;11&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;12&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// slice=? data=?
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ç»“æœ&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ï¼š&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;// ç¬¬ä¸€æ¬¡appendåç»“æœ
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;slice&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;9&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;span class=&#34;nx&#34;&gt;data&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;9&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;// ç¬¬äºŒæ¬¡appendåç»“æœ
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;slice&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;9&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;10&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;11&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;12&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;span class=&#34;nx&#34;&gt;data&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;  &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;   &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;9&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h3 id=&#34;æ‰©å®¹ç­–ç•¥&#34;&gt;æ‰©å®¹ç­–ç•¥&lt;/h3&gt;
&lt;p&gt;æ‰©å®¹å®é™…ä¸ŠåŒ…æ‹¬ä¸¤éƒ¨åˆ†ï¼šè®¡ç®—å®¹é‡çš„è§„åˆ™ å’Œ å†…å­˜å¯¹é½&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;å¦‚æœ&lt;strong&gt;æœŸæœ›å®¹é‡å¤§äºå½“å‰å®¹é‡çš„ä¸¤å€&lt;/strong&gt;å°±ä¼šä½¿ç”¨æœŸæœ›å®¹é‡ï¼ŒæœŸæœ›å®¹é‡æŒ‡çš„æ˜¯æŠŠå…ƒç´ åŠ è¿›å»åçš„å®¹é‡ï¼Œä¸€èˆ¬å‘ç”Ÿåœ¨append å¤šä¸ªçš„æ—¶å€™ï¼Œå¦‚ append(arr, 1, 2, 3, 4)ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¦‚æœå½“å‰åˆ‡ç‰‡çš„é•¿åº¦å°äº 1024ï¼Œæ‰©å®¹ä¸¤å€ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¦‚æœå½“å‰åˆ‡ç‰‡çš„é•¿åº¦å¤§äº 1024 å°±ä¼šæ¯æ¬¡å¢åŠ  25% çš„å®¹é‡ï¼Œå³æ‰©å®¹1.25å€ï¼Œç›´åˆ°æ–°å®¹é‡å¤§äºæœŸæœ›å®¹é‡ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ­¤æ—¶åªæ˜¯ç¡®å®šåˆ‡ç‰‡çš„å¤§è‡´å®¹é‡ï¼Œä¹‹åä¼šåˆ¤æ–­åˆ‡ç‰‡ä¸­å…ƒç´ æ‰€å å­—èŠ‚å¤§å°ï¼Œå¦‚æœå­—èŠ‚å¤§å°æ˜¯1ã€2ã€8çš„å€æ•°æ—¶ï¼Œä¼šè¿›è¡Œå†…å­˜å¯¹é½ï¼Œè¿™ä¸ªæ“ä½œä¹‹åï¼Œæ‰©å®¹åçš„å®¹é‡å¯èƒ½ä¼š &amp;gt; åŸå®¹é‡çš„ä¸¤å€ æˆ– 1.25å€ã€‚&lt;/p&gt;
&lt;p&gt;å†…å­˜å¯¹é½ä¸»è¦æ˜¯ä¸ºäº†æé«˜å†…å­˜åˆ†é…æ•ˆç‡ï¼Œå‡å°‘å†…å­˜ç¢ç‰‡ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;PSï¼šgo 18ä»¥å‰è¿˜æ˜¯ç”¨ 1024 æ¥åˆ¤æ–­è¦æ‰©å®¹çš„å¤§å°ï¼Œ18ä¹‹åä½¿ç”¨256ï¼Œé•¿åº¦å°äº256ï¼Œæ‰©å®¹ä¸¤å€ï¼›é•¿åº¦å¤§äº256æ—¶ï¼Œè§„åˆ™ä¸º &lt;code&gt;åŸé•¿åº¦ += (åŸé•¿åº¦ + 3*256) / 4&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// æ­¤æ—¶æœŸæœ›å®¹é‡æ˜¯2 + 3 = 5 &amp;gt; æ—§å®¹é‡çš„ä¸¤å€ 2 * 2 = 4ï¼ŒæœŸæœ›å®¹é‡ä¸º5ï¼Œå 40ä¸ªå­—èŠ‚ï¼Œä¸æ˜¯2^næ¬¡ï¼Œsoè§¦å‘å†…å­˜å¯¹é½ï¼Œå‘ä¸Šå–æ•´ä¸º48å­—èŠ‚ï¼Œæ­¤æ—¶æ–°å®¹é‡ä¸º 48 / 8 = 6ã€‚
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int64&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;nx&#34;&gt;s1&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;append&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;6&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;len=%d, cap=%d\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;cap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;// len=5, cap=6
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;// ç¬¬ä¸€æ¬¡appendï¼Œæ‰©å®¹ï¼Œæ‹·è´æ—§æ•°æ®åˆ°æ–°æ•°ç»„ï¼Œå®¹é‡å¢é•¿ä¸¤å€ï¼›
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// ç¬¬äºŒæ¬¡appendï¼Œæ²¡æœ‰äº§ç”Ÿæ–°æ•°ç»„ï¼Œåªå°†å…ƒç´ è¿›è¡Œè¿½åŠ ï¼›
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// ç¬¬ä¸‰æ¬¡appendï¼Œæ‰©å®¹ï¼Œæ‹·è´æ—§æ•°æ®åˆ°æ–°æ•°ç»„ï¼Œå®¹é‡å¢é•¿ä¸¤å€ï¼›
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;append&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;len=%d, cap=%d\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;cap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;// len=3, cap=4
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;append&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;len=%d, cap=%d\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;cap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;// len=4, cap=4
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;append&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;6&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;len=%d, cap=%d\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;cap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;// len=5, cap=8
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h1 id=&#34;map&#34;&gt;Map&lt;/h1&gt;
&lt;h2 id=&#34;æ•°æ®ç»“æ„-1&#34;&gt;æ•°æ®ç»“æ„&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;48
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;49
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;50
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;51
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;52
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;53
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;54
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;55
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;56
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;57
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;58
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;59
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;60
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;61
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;62
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;63
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;64
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;65
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;66
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;67
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;68
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;69
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;70
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;71
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;72
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;73
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;74
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;75
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;76
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;77
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;78
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;79
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;80
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;81
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;82
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;83
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;84
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;85
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;86
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;87
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;hmap&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;count&lt;/span&gt;     &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// å“ˆå¸Œè¡¨ä¸­å…ƒç´ çš„æ•°é‡
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// flagsæšä¸¾ï¼š1: å¯èƒ½æœ‰è¿­ä»£å™¨ä½¿ç”¨bucketsï¼Œ2: å¯èƒ½æœ‰è¿­ä»£å™¨ä½¿ç”¨oldbucketsï¼Œ4: æœ‰åç¨‹æ­£åœ¨å‘mapä¸­å†™å…¥keyï¼Œ8:ç­‰é‡æ‰©å®¹
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;flags&lt;/span&gt;     &lt;span class=&#34;kt&#34;&gt;uint8&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;// è®°å½•mapçš„çŠ¶æ€
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;B&lt;/span&gt;         &lt;span class=&#34;kt&#34;&gt;uint8&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;// bucketsçš„æ•°é‡ï¼Œlen(buckets) = 2^B
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;noverflow&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint16&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// æº¢å‡ºçš„bucketçš„ä¸ªæ•°
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;hash0&lt;/span&gt;     &lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// å“ˆå¸Œç§å­ï¼Œä¸ºå“ˆå¸Œå‡½æ•°çš„ç»“æœå¼•å…¥éšæœºæ€§ã€‚è¯¥å€¼åœ¨åˆ›å»ºå“ˆå¸Œè¡¨æ—¶ç¡®å®šï¼Œåœ¨æ„é€ æ–¹æ³•ä¸­ä¼ å…¥
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;buckets&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;unsafe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Pointer&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// æ¡¶çš„åœ°å€ï¼ŒæŒ‡å‘ä¸€ä¸ªbmapæ•°ç»„ï¼Œå³æŒ‡å‘å¾ˆå¤šä¸ªæ¡¶
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;oldbuckets&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;unsafe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Pointer&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// æ‰©å®¹æ—¶ç”¨äºä¿å­˜ä¹‹å‰bucketsçš„å­—æ®µï¼Œå¤§å°æ˜¯å½“å‰bucketsçš„ä¸€åŠæˆ–0.75ï¼Œéæ‰©å®¹çŠ¶æ€ä¸‹ä¸ºnull
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;nevacuate&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;uintptr&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// æ‰©å®¹è¿ç§»çš„è¿›åº¦ï¼Œå°äºnevacuateçš„bucketsè¡¨ç¤ºå·²è¿ç§»å®Œæˆï¼ŒåŒæ—¶ä¹Ÿç”¨æ¥è®¡ç®—ä¸‹ä¸€ä¸ªè¦è¿ç§»çš„æ¡¶åœ¨oldbucketsä¸­çš„ä½ç½®
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;extra&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;mapextra&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// å­˜å‚¨å•ä¸ªæ¡¶è£…æ»¡æ—¶æº¢å‡ºçš„æ•°æ®ï¼Œæº¢å‡ºæ¡¶å’Œæ­£å¸¸æ¡¶åœ¨å†…å­˜ä¸Šæ˜¯è¿ç»­çš„, å³ hmap.buckets[i].overflowä¼šå…³è”hmap.extra.overflow
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;mapextra&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// ä¸‹é¢è¿™ä¸¤ä¸ªå­—æ®µæ˜¯ä¸ºäº†ä¼˜åŒ–GCæ‰«æè€Œè®¾è®¡çš„ã€‚åœ¨mapçš„keyå’Œvalueéƒ½ä¸æ˜¯æŒ‡é’ˆï¼Œå¹¶ä¸”sizeéƒ½å°äº128å­—èŠ‚æ—¶ä½¿ç”¨ï¼ˆå³å¯ä»¥è¢«inlineï¼‰ï¼Œæ‰€æœ‰hmap.bucketsçš„æº¢å‡ºæ¡¶éƒ½ç”¨è¿™ä¸¤ä¸ªå­—æ®µè¿›è¡Œç®¡ç†ï¼Œé¿å…gcæ—¶æ‰«ææ•´ä¸ªhmapã€‚
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    
    &lt;span class=&#34;c1&#34;&gt;// å› ä¸º bmap.overflow æ˜¯ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘æº¢å‡ºçš„bucketï¼Œè€ŒGCæ—¶å¿…å®šä¼šæ‰«ææŒ‡é’ˆï¼Œé‚£å°±ä¼šæ‰«ææ‰€æœ‰bmapï¼Œ
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// å½“mapçš„keyå’Œvalueéƒ½æ˜¯éæŒ‡é’ˆç±»å‹æ—¶ï¼Œä¸ºäº†é¿å…æ‰«ææ‰€æœ‰bucketsï¼Œå°±å¯ä»¥ä½¿ç”¨extra.overflowæ¥å­˜å‚¨æº¢å‡ºçš„bucketï¼Œå¹¶æŠŠbmapç»“æ„ä½“é‡Œçš„overflowæŒ‡é’ˆç±»å‹å˜æˆunitptrç±»å‹ï¼ˆç¼–è¯‘æœŸå¹²çš„ï¼‰ï¼Œé‚£æ•´ä¸ªbmapå°±å®Œå…¨æ²¡æŒ‡é’ˆäº†ã€‚
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// è¿™æ ·å°±å¯ä»¥é€šè¿‡extraç›´æ¥æ ‡è®°æ•´ä¸ªmapçš„é¢œè‰²ï¼Œé¿å…æ‰«ææ¯ä¸ªbmapçš„overflowæŒ‡é’ˆï¼›
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// å¦ä¸€æ–¹é¢ï¼Œå½“ GC åœ¨æ‰«æ hmap æ—¶ï¼Œé€šè¿‡ extra.overflow è¿™æ¡è·¯å¾„ï¼ˆæŒ‡é’ˆï¼‰å°±å¯ä»¥å°† overflow çš„ bucket æ­£å¸¸æ ‡è®°æˆé»‘è‰²ï¼Œä»è€Œä¸ä¼šè¢« GC é”™è¯¯åœ°å›æ”¶ã€‚
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;overflow&lt;/span&gt;    &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;bmap&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;// åŒ…å«hmap.bucketsçš„overflowçš„bucketsï¼Œå³ä¿å­˜äº†æ‰€æœ‰æº¢å‡ºæ¡¶ï¼Œä¾¿äºGCæ‰«æ
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;oldoverflow&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;bmap&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;// åŒ…å«æ‰©å®¹æ—¶çš„hmap.oldbucketsçš„overflowçš„bucketï¼Œç”¨äºæ‰©å®¹
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// æŒ‡å‘ç©ºé—²çš„ overflow bucket çš„æŒ‡é’ˆï¼Œç”¨äºé¢„åˆ†é…
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;nextOverflow&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;bmap&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;// å³æ¡¶bucketçš„ç»“æ„
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;bmap&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// è¡¨ç¤ºä¸€ä¸ªæ¡¶ï¼Œå®é™…ä¸Šä¸ºlenä¸º8çš„æ•°ç»„ï¼Œæ¯ä¸ªæ¡¶åªèƒ½å­˜8ä¸ªé”®å€¼å¯¹ï¼ŒåŒ…å«æ­¤æ¡¶ä¸­æ¯ä¸ªkeyçš„å“ˆå¸Œå€¼çš„é«˜8ä½
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// å¦‚æœtophash[0] &amp;lt; minTopHashï¼Œè¯´æ˜å‰minTopHashä¸ªå·²ç»è¢«æ¬è¿è¿‡
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// tophashçš„æœ€ä½ä½ä»£è¡¨æ¡¶çš„æ¬è¿evacuationçŠ¶æ€ï¼Œæœ€ä½ä½0è¡¨ç¤ºåœ¨X partï¼Œ1è¡¨ç¤ºåœ¨Y partã€‚
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;tophash&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;bucketCnt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint8&lt;/span&gt; 
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;// ä½†ç”±äºgoæ²¡æœ‰æ³›å‹ï¼Œå“ˆå¸Œè¡¨ä¸­åˆå¯èƒ½å­˜å‚¨ä¸åŒç±»å‹çš„é”®å€¼å¯¹ï¼Œæ‰€ä»¥é”®å€¼å¯¹æ‰€å çš„å†…å­˜ç©ºé—´å¤§å°åªèƒ½åœ¨ç¼–è¯‘æ—¶æ¨å¯¼ï¼Œ
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// æ— æ³•å…ˆè®¾ç½®åœ¨ç»“æ„ä½“ä¸­ï¼Œè¿™äº›å­—æ®µæ˜¯åœ¨è¿è¡Œæ—¶é€šè¿‡è®¡ç®—å†…å­˜åœ°å€çš„æ–¹å¼ç›´æ¥è®¿é—®ï¼Œè¿™äº›é¢å¤–çš„å­—æ®µéƒ½æ˜¯ç¼–è¯‘æ—¶åŠ¨æ€åˆ›å»º
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;bmap&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;topbits&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;8&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint8&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// é€šè¿‡tophashæ‰¾åˆ°å¯¹åº”é”®å€¼å¯¹åœ¨keyså’Œvaluesæ•°ç»„ä¸­çš„ä¸‹æ ‡ï¼Œå³æœ‰8ä¸ªcell
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;keys&lt;/span&gt;     &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;8&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;keytype&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;values&lt;/span&gt;   &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;8&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;valuetype&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;pad&lt;/span&gt;      &lt;span class=&#34;kt&#34;&gt;uintptr&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;overflow&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uintptr&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// æ¯ä¸ªæ¡¶åªèƒ½å­˜8ä¸ªå…ƒç´ ï¼Œè¶…è¿‡8ä¸ªæ—¶ä¼šå­˜å…¥æº¢å‡ºæ¡¶ï¼Œæº¢å‡ºæ¡¶åªæ˜¯ä¸´æ—¶æ–¹æ¡ˆï¼Œæº¢å‡ºè¿‡å¤šæ—¶ä¼šè¿›è¡Œæ‰©å®¹
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;// é‡è¦çš„å¸¸é‡æ ‡å¿—
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// ä¸€ä¸ªæ¡¶ä¸­æœ€å¤šèƒ½è£…è½½çš„é”®å€¼å¯¹ï¼ˆkey-valueï¼‰çš„ä¸ªæ•°ä¸º8
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;bucketCntBits&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;bucketCnt&lt;/span&gt;     &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;bucketCntBits&lt;/span&gt;

    &lt;span class=&#34;c1&#34;&gt;// è§¦å‘æ‰©å®¹çš„è£…è½½å› å­ä¸º13/2=6.5
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;loadFactorNum&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;13&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;loadFactorDen&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;

    &lt;span class=&#34;c1&#34;&gt;// é”®å’Œå€¼è¶…è¿‡128ä¸ªå­—èŠ‚ï¼Œå°±ä¼šè¢«è½¬æ¢ä¸ºæŒ‡é’ˆ
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;maxKeySize&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;128&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;maxElemSize&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;128&lt;/span&gt;

    &lt;span class=&#34;c1&#34;&gt;// æ•°æ®åç§»é‡åº”è¯¥æ˜¯bmapç»“æ„ä½“çš„å¤§å°ï¼Œå®ƒéœ€è¦æ­£ç¡®åœ°å¯¹é½ã€‚
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// å¯¹äºamd64p32è€Œè¨€ï¼Œè¿™æ„å‘³ç€ï¼šå³ä½¿æŒ‡é’ˆæ˜¯32ä½çš„ï¼Œä¹Ÿæ˜¯64ä½å¯¹é½ã€‚
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;dataOffset&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;unsafe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Offsetof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;nx&#34;&gt;b&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;bmap&lt;/span&gt;
        &lt;span class=&#34;nx&#34;&gt;v&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int64&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;}{}.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;


    &lt;span class=&#34;c1&#34;&gt;// æ¯ä¸ªæ¡¶ï¼ˆå¦‚æœæœ‰æº¢å‡ºï¼Œåˆ™åŒ…å«å®ƒçš„overflowçš„é“¾æ¥æ¡¶ï¼‰åœ¨æ¬è¿å®ŒæˆçŠ¶æ€ä¸‹ï¼Œè¦ä¹ˆä¼šåŒ…å«å®ƒæ‰€æœ‰çš„é”®å€¼å¯¹ï¼Œè¦ä¹ˆä¸€ä¸ªéƒ½ä¸åŒ…å«ï¼ˆä½†ä¸åŒ…æ‹¬è°ƒç”¨evacuate()æ–¹æ³•é˜¶æ®µï¼Œè¯¥æ–¹æ³•è°ƒç”¨åªä¼šåœ¨å¯¹mapå‘èµ·writeæ—¶å‘ç”Ÿï¼Œåœ¨è¯¥é˜¶æ®µå…¶ä»–goroutineæ˜¯æ— æ³•æŸ¥çœ‹è¯¥mapçš„ï¼‰ã€‚ç®€å•çš„è¯´ï¼Œæ¡¶é‡Œçš„æ•°æ®è¦ä¹ˆä¸€èµ·æ¬èµ°ï¼Œè¦ä¹ˆä¸€ä¸ªéƒ½è¿˜æœªæ¬ã€‚
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// å½“tophashå€¼å°äºminTopHashæ—¶ï¼Œè¡¨ç¤ºå­˜çš„æ˜¯è¿ç§»çŠ¶æ€ï¼Œå¤§äºminTopHashæ—¶ï¼Œè¡¨ç¤ºçš„æ˜¯è®¡ç®—çš„å€¼ã€‚
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;emptyRest&lt;/span&gt;      &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// è¡¨ç¤ºcellä¸ºç©ºï¼Œå¹¶ä¸”ä¹‹åçš„ä½ç½®ä¹Ÿä¸ºç©ºï¼ŒåŒ…æ‹¬overflowï¼Œåˆå§‹åŒ–bucketæ—¶ï¼Œå°±æ˜¯è¯¥çŠ¶æ€
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;emptyOne&lt;/span&gt;       &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// è¡¨ç¤ºå½“å‰æ˜¯ç©ºçš„cellï¼Œä½†æ›¾ç»æœ‰å€¼ï¼Œå·²ç»è¢«æ¬è¿åˆ°æ–°çš„bucket
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;evacuatedX&lt;/span&gt;     &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// é”®å€¼å¯¹å·²ç»æ¬è¿å®Œæ¯•ï¼Œkeyåœ¨æ–°bucketsæ•°ç»„çš„å‰åŠéƒ¨åˆ†
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;evacuatedY&lt;/span&gt;     &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// é”®å€¼å¯¹å·²ç»æ¬è¿å®Œæ¯•ï¼Œkeyåœ¨æ–°bucketsæ•°ç»„çš„ååŠéƒ¨åˆ†
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;evacuatedEmpty&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// cellä¸ºç©ºï¼Œæ•´ä¸ªbucketå·²ç»æ¬è¿å®Œæ¯•
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;minTopHash&lt;/span&gt;     &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;5&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// tophashçš„æœ€å°æ­£å¸¸å€¼ï¼Œå¦‚æœè®¡ç®—å‡ºæ¥çš„tophashå°äºè¯¥å€¼ï¼Œåˆ™åŠ ä¸Šå®ƒé¿å…è·Ÿå‰é¢å‡ ä¸ªçŠ¶æ€æšä¸¾å†²çª
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// flags
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;iterator&lt;/span&gt;     &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// å¯èƒ½æœ‰è¿­ä»£å™¨åœ¨ä½¿ç”¨buckets
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;oldIterator&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// å¯èƒ½æœ‰è¿­ä»£å™¨åœ¨ä½¿ç”¨oldbuckets
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;hashWriting&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// æœ‰åç¨‹æ­£åœ¨å‘mapå†™äººkey
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;sameSizeGrow&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;8&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// ç­‰é‡æ‰©å®¹
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// ç”¨äºè¿­ä»£å™¨æ£€æŸ¥çš„bucket ID
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;noCheck&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;8&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;sys&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;PtrSize&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/go_map_struct.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/go_map_struct.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			alt=&#34;go map ç»“æ„å›¾&#34;&gt;
	&lt;/a&gt;
	
	&lt;figcaption&gt;go map ç»“æ„å›¾&lt;/figcaption&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;æ³¨ï¼šä¸€ä¸ªbmapé‡Œkeyå’Œvalueæ˜¯å„è‡ªå­˜çš„ï¼Œè€Œkey/valueä¸€å¯¹å¯¹å­˜å‚¨ï¼Œè¿™æ ·çš„å¥½å¤„æ˜¯çœæ‰paddingå­—æ®µï¼ŒèŠ‚çœå†…å­˜ç©ºé—´ï¼Œæ–¹ä¾¿å†…å­˜å¯¹é½ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ä¾‹å¦‚ï¼Œæœ‰è¿™æ ·ä¸€ä¸ªç±»å‹çš„ mapï¼š&lt;code&gt;map[int64]int8&lt;/code&gt;ï¼Œå¦‚æœæŒ‰ç…§ &lt;code&gt;key/value...&lt;/code&gt; è¿™æ ·çš„æ¨¡å¼å­˜å‚¨ï¼Œé‚£åœ¨æ¯ä¸€ä¸ª key/value å¯¹ä¹‹åéƒ½è¦é¢å¤– padding 7 ä¸ªå­—èŠ‚ï¼›è€Œå°†æ‰€æœ‰çš„ keyï¼Œvalue åˆ†åˆ«ç»‘å®šåˆ°ä¸€èµ·ï¼Œè¿™ç§å½¢å¼ &lt;code&gt;key/key/.../value/value/...&lt;/code&gt;ï¼Œåˆ™åªéœ€è¦åœ¨æœ€åæ·»åŠ  paddingï¼Œæ¯ä¸ª bucket è®¾è®¡æˆæœ€å¤šåªèƒ½æ”¾ 8 ä¸ª key-value å¯¹ï¼Œå¦‚æœæœ‰ç¬¬ 9 ä¸ª key-value è½å…¥å½“å‰çš„ bucketï¼Œé‚£å°±éœ€è¦å†æ„å»ºä¸€ä¸ª bucket ï¼Œé€šè¿‡ &lt;code&gt;overflow&lt;/code&gt; æŒ‡é’ˆè¿æ¥èµ·æ¥ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;åŸºæœ¬-1&#34;&gt;åŸºæœ¬&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;åˆ›å»ºï¼š&lt;code&gt;m := map[string]int{&amp;quot;1&amp;quot;: 11, &amp;quot;2&amp;quot;: 22}&lt;/code&gt;æˆ–è€… &lt;code&gt;m := make(map[string]int, 10)&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å½“ä½¿ç”¨å­—é¢é‡çš„æ–¹å¼åˆ›å»ºå“ˆå¸Œè¡¨æ—¶ï¼Œå¦‚æœ{}ä¸­å…ƒç´ å°‘äºæˆ–ç­‰äº25æ—¶ï¼Œç¼–è¯‘å™¨ä¼šè½¬æˆmakeçš„æ–¹å¼åˆ›å»ºï¼Œå†è¿›è¡Œèµ‹å€¼ï¼›å¦‚æœè¶…è¿‡äº†25ä¸ªï¼Œç¼–è¯‘æ—¶ä¼šè½¬æˆmakeçš„æ–¹å¼åˆ›å»ºï¼ŒåŒæ—¶ä¸ºkeyå’Œvalueåˆ†åˆ«åˆ›å»ºä¸¤ä¸ªæ•°ç»„ï¼Œæœ€åè¿›è¡Œå¾ªç¯èµ‹å€¼&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç›´æ¥å£°æ˜ &lt;code&gt;var m map[string]int&lt;/code&gt;ä¼šåˆ›å»ºäº†ä¸€ä¸ª&lt;strong&gt;nilçš„map&lt;/strong&gt;ï¼Œæ­¤æ—¶ä¸èƒ½è¢«èµ‹å€¼ï¼Œä½†å¯ä»¥å–å€¼ï¼Œè™½ç„¶ä¸ä¼španicï¼Œä½†ä¼šå¾—åˆ°é›¶å€¼&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;keyä¸å…è®¸ä¸ºsliceã€mapã€funcï¼›å…è®¸boolã€numericã€stringã€æŒ‡é’ˆã€channelã€interfaceã€structåŠå…¶ç±»å‹å¯¹åº”çš„æ•°ç»„ï¼›&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å³keyå¿…é¡»æ”¯æŒ == æˆ– != è¿ç®—çš„ç±»å‹ï¼Œå¦‚æœæ˜¯ç»“æ„ä½“ï¼Œåˆ™ä»–ä»¬çš„æ‰€æœ‰å­—æ®µéƒ½ç›¸ç­‰ï¼Œæ‰è¢«è®¤ä¸ºæ˜¯ç›¸åŒçš„key&lt;/strong&gt;ï¼›&lt;/p&gt;
&lt;p&gt;å¦å¤–ï¼Œfloatæ¯”è¾ƒç‰¹æ®Šï¼Œå› ä¸ºfloatä½œä¸ºkeyæ—¶ï¼Œä¼šè¢«è½¬æˆunit64ï¼Œå†æ’å…¥keyä¸­ï¼Œå¯èƒ½ä¼šæœ‰ç²¾åº¦é—®é¢˜ï¼Œå¯¼è‡´æœ‰æ—¶å€™æŸ¥è¯¢ä¸åˆ°ï¼Œæˆ–è€…æŸ¥è¯¢å‡ºæ¥çš„keyä¸ä¸€æ ·ï¼›&lt;/p&gt;
&lt;p&gt;æœ‰ä¸ªç‰¹æ®Šçš„keyå€¼&lt;code&gt;math.NaN&lt;/code&gt;ï¼Œå®ƒæ¯æ¬¡ç”Ÿæˆçš„å“ˆå¸Œå€¼æ˜¯ä¸ä¸€æ ·çš„ï¼Œè¿™ä¼šé€ æˆm[&lt;code&gt;math.NaN&lt;/code&gt;]æ˜¯æ‹¿ä¸åˆ°å€¼çš„ï¼Œè€Œä¸”å¤šæ¬¡å¯¹å®ƒèµ‹å€¼ï¼Œä¼šè®©mapä¸­å­˜åœ¨å¤šä¸ª&lt;code&gt;math.NaN&lt;/code&gt;çš„keyã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;mapå®¹é‡æœ€å¤šä¸º 6.5 * 2^B ä¸ªå…ƒç´ ï¼Œ6.5æ˜¯è£…è½½å› å­é˜ˆå€¼å¸¸é‡ï¼Œè£…è½½å› å­ = å“ˆå¸Œè¡¨ä¸­çš„å…ƒç´  / å“ˆå¸Œè¡¨æ€»é•¿åº¦ï¼Œè£…è½½å› å­è¶Šå¤§ï¼Œå†²çªè¶Šå¤šã€‚Bæœ€å¤§å€¼æ˜¯63ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ‹‰é“¾æ³•è§£å†³å“ˆå¸Œå†²çªï¼ˆæŒ‡8ä¸ªæ­£å¸¸ä½å’Œæº¢å‡ºæ¡¶ï¼‰ï¼Œé™¤ç•™ä½™æ•°æ³•å¾—åˆ°æ¡¶çš„ä½ç½®ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;keyçš„å“ˆå¸Œå€¼çš„ä½Bä½è®¡ç®—è·å¾—æ¡¶çš„ä½ç½®ï¼Œé«˜8ä½è®¡ç®—å¾—åˆ°tophashçš„ä½ç½®ï¼Œè¿›è€Œæ‰¾åˆ°keyçš„ä½ç½®ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æº¢å‡ºæ¡¶ä¹Ÿæ˜¯ä¸€ä¸ªbmapï¼Œbmapçš„overflowä¼šæŒ‡å‘ä¸‹ä¸€ä¸ªæº¢å‡ºæ¡¶ï¼Œæ‰€ä»¥&lt;strong&gt;æº¢å‡ºæ¡¶çš„ç»“æ„æ˜¯é“¾è¡¨ï¼Œä½†æ˜¯å®ƒä»¬è·Ÿæ­£å¸¸æ¡¶æ˜¯åœ¨ä¸€ç‰‡è¿ç»­å†…å­˜ä¸Šï¼Œéƒ½åœ¨bucketsæ•°ç»„é‡Œï¼Œå‰2^Bä¸ªå½“æˆæ­£å¸¸æ¡¶ï¼Œå2^(B-4)ä¸ªå½“ä½œæº¢å‡ºæ¡¶&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ¯ä¸ªæ¡¶å­˜äº†8ä¸ªtophash + 8å¯¹é”®å€¼å¯¹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ‰©å®¹åˆ¤æ–­å‘ç”Ÿåœ¨æ’å…¥ï¼Œæ‰©å®¹è¿ç§»å‘ç”Ÿåœ¨æ’å…¥å’Œåˆ é™¤&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;mapæ˜¯éçº¿ç¨‹å®‰å…¨çš„ï¼Œæ‰©å®¹ä¸æ˜¯ä¸€ä¸ªåŸå­æ“ä½œï¼Œé€šè¿‡hmapé‡Œçš„flagså­—æ®µåœ¨å¹¶å‘è¯»å†™æ—¶è¿›è¡Œfast-failã€‚&lt;/p&gt;
&lt;p&gt;å½“ map å¯¹è±¡åŒæ—¶è¿›è¡ŒåŠ é”çš„ write å’Œä¸åŠ é”çš„readï¼ˆæ¯”å¦‚æ‰“å°ï¼Œåºåˆ—åŒ–ç­‰ï¼‰æ—¶ï¼Œä¼šå‘ç”Ÿpanicï¼Œå› ä¸ºç›¸å½“äºå¹¶å‘è¯»å†™ã€‚&lt;/p&gt;
&lt;p&gt;å½“mapå‡ºç°å¹¶å‘è¯»å†™æ—¶ï¼Œä¸æ˜¯æŠ›å‡ºpanicé”™è¯¯ï¼Œè€Œæ˜¯fatalé”™è¯¯ï¼Œfatalé”™è¯¯ä¸å¯è¢«recoverï¼Œç¨‹åºä¼šç›´æ¥é€€å‡ºï¼›åŸå› æ˜¯å½“å­˜åœ¨å¹¶å‘è¯»å†™æ—¶ï¼Œå¦‚æœè¢«recoveräº†ï¼Œä¼šå¯¼è‡´å…¶ä»–åç¨‹å‡ºç°è¯»å–é”™è¯¯çš„æƒ…å†µã€‚&lt;/p&gt;
&lt;p&gt;ä½†åœ¨åŒä¸€ä¸ªåç¨‹é‡Œï¼Œè¾¹éå†è¾¹å¢åˆ ï¼Œå¹¶ä¸ä¼šè§¦å‘å¹¶å‘æ£€æµ‹ï¼Œä½†æ˜¯å¯èƒ½ä¼šå¯¼è‡´æ¼éå†ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;mapçš„éå†æ˜¯æ— åºçš„ï¼Œæ¯æ¬¡éå†å‡ºæ¥çš„ç»“æœçš„é¡ºåºéƒ½ä¸ä¸€æ ·ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ— æ³•ç›´æ¥å¯¹mapçš„valueç›´æ¥å–åœ°å€ï¼š&lt;code&gt;&amp;amp;m[&amp;quot;key&amp;quot;]&lt;/code&gt;ä¼šæ— æ³•é€šè¿‡ç¼–è¯‘ï¼Œè™½ç„¶å¯ä»¥ä½¿ç”¨&lt;code&gt;unsafe.Pointer&lt;/code&gt;å–åœ°å€ï¼Œä½†æ˜¯å› ä¸ºmapä¼šæ‰©å®¹ï¼Œæ‹¿åˆ°çš„åœ°å€ä¹Ÿä¸ä¸€å®šæ˜¯ä¹‹åçš„åœ°å€ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;åˆ›å»ºåˆå§‹åŒ–&#34;&gt;åˆ›å»ºåˆå§‹åŒ–&lt;/h2&gt;
&lt;p&gt;é€šè¿‡&lt;code&gt;make(map[type]type)&lt;/code&gt;ï¼Œæˆ–è€…&lt;code&gt;make(map[type]type, hint), hint &amp;lt;= 8&lt;/code&gt;åˆ›å»ºçš„mapï¼Œåº•å±‚ä¼šè°ƒç”¨&lt;code&gt;makemap_smallå‡½æ•°&lt;/code&gt;ï¼Œå¹¶ç›´æ¥ä»å †ä¸Šè¿›è¡Œåˆ†é…ï¼Œæ­¤æ—¶åªåˆ†é…å†…å­˜ç©ºé—´ï¼Œä¸åˆå§‹åŒ–æ¡¶ï¼Œæ‡’åŠ è½½ï¼Œåªæœ‰åœ¨ç¬¬ä¸€æ¬¡æ’å…¥æ—¶æ‰ä¼šåˆå§‹åŒ–æ¡¶ï¼Œæ­¤æ—¶B=0ï¼Œæ¡¶çš„æ•°é‡ä¸º1ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;makemap_small&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;hmap&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;h&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;new&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;hmap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;h&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;hash0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;fastrand&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;h&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;å½“hint &amp;gt; 8æ—¶ï¼Œåˆ™ä¼šåœ¨è¿è¡Œæ—¶è°ƒç”¨&lt;code&gt;makemapå‡½æ•°&lt;/code&gt;è¿›è¡Œåˆ›å»ºå’Œåˆå§‹åŒ–ï¼Œ&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;è®¡ç®—å“ˆå¸Œè¡¨å ç”¨çš„å†…å­˜æ˜¯å¦æº¢å‡ºæˆ–è€…è¶…å‡ºèƒ½åˆ†é…çš„æœ€å¤§å€¼&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è°ƒç”¨fastrand()è·å–éšæœºå“ˆå¸Œç§å­&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ ¹æ®hintæ¥è®¡ç®—éœ€è¦çš„æ¡¶çš„æ•°é‡æ¥è®¡ç®—Bçš„å€¼ï¼ˆhintæ˜¯makeçš„ç¬¬äºŒä¸ªå‚æ•°ï¼‰ï¼Œç”¨äºåˆå§‹åŒ–æ¡¶çš„æ•°é‡ = 2^Bï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è°ƒç”¨&lt;code&gt;makeBucketArray()&lt;/code&gt;åˆ†é…è¿ç»­çš„ç©ºé—´ï¼Œåˆ›å»ºç”¨äºä¿å­˜æ¡¶çš„æ•°ç»„&lt;/p&gt;
&lt;p&gt;å½“æ¡¶çš„æ•°é‡å°äº2^4æ—¶ï¼Œç”±äºæ•°æ®è¾ƒå°‘ï¼Œå“ˆå¸Œå†²çªçš„å¯èƒ½æ€§è¾ƒå°ï¼Œæ­¤æ—¶ä¸ä¼šåˆ›å»ºæº¢å‡ºæ¡¶ã€‚&lt;/p&gt;
&lt;p&gt;å½“æ¡¶çš„æ•°é‡å¤§äº2^4æ—¶ï¼Œå°±ä¼šé¢å¤–åˆ›å»º2^(B-4)ä¸ªæº¢å‡ºæ¡¶ï¼Œæº¢å‡ºæ¡¶ä¸æ™®é€šæ¡¶åœ¨å†…å­˜ç©ºé—´ä¸Šæ˜¯è¿ç»­çš„ï¼Œä½¿ç”¨extraçš„nextOveflowæ¥åšæº¢å‡ºæ¡¶ï¼Œé¢„åˆ†é…ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;48
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;49
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;50
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;51
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;52
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;53
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;54
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;55
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;56
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;57
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;58
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;59
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;60
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;61
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;62
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;63
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;64
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;makemap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;t&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;maptype&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;hint&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;h&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;hmap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;hmap&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;h&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;hash0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;fastrand&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
	&lt;span class=&#34;c1&#34;&gt;// å‡½æ•°å†…ï¼Œè®¡ç®—æ¡¶çš„æ•°é‡
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;B&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;uint8&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;c1&#34;&gt;//è®¡ç®—å¾—åˆ°åˆé€‚çš„B
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;overLoadFactor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;hint&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;B&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;B&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;h&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;B&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;B&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// å¦‚æœ B == 0æ—¶ï¼Œå°±ä¼šæ‡’åŠ è½½
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;h&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;B&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;nextOverflow&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;bmap&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;h&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buckets&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;nextOverflow&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;makeBucketArray&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;h&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;B&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;nextOverflow&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;h&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;extra&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;new&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;mapextra&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;h&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;extra&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;nextOverflow&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;nextOverflow&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;overLoadFactor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;count&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;B&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint8&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;c1&#34;&gt;// å¸¸é‡loadFactorNum=13 ï¼ŒloadFactorDen=2ï¼ŒbucketCnt=8ï¼ŒbucketShift()å‡½æ•°è¿”å›2^B
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;count&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;bucketCnt&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;uintptr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;count&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;loadFactorNum&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;bucketShift&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;B&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;loadFactorDen&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;makeBucketArray&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;t&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;maptype&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;b&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint8&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;dirtyalloc&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;unsafe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Pointer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buckets&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;unsafe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Pointer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;nextOverflow&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;bmap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;base&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;bucketShift&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;// base = 2 ^ B
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;nbuckets&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;base&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// B &amp;lt; 4æ—¶ï¼Œå³æ¡¶çš„æ•°é‡å°äº16ï¼Œè®¤ä¸ºå“ˆå¸Œå†²çªå‡ ç‡è¾ƒå°ï¼Œå› æ­¤ä¸ä¼šåˆ›å»ºæº¢å‡ºæ¡¶
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// B &amp;gt;= 4æ—¶ï¼Œåˆ›å»º2^(B-4)ä¸ªæº¢å‡ºæ¡¶
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;b&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;nbuckets&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;bucketShift&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;b&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;sz&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;bucket&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;size&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;nbuckets&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;up&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;roundupsize&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;sz&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;up&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;sz&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;nbuckets&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;up&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;/&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;bucket&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;size&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;dirtyalloc&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;c1&#34;&gt;// ä¸ºnull, ä¼šåˆ†é…ä¸€ä¸ªæ–°çš„åº•å±‚æ•°ç»„
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;nx&#34;&gt;buckets&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;newarray&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;bucket&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;nbuckets&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;c1&#34;&gt;// ä¸ä¸ºnullï¼Œåˆ™å®ƒæŒ‡å‘çš„æ˜¯æ›¾ç»åˆ†é…è¿‡çš„åº•å±‚æ•°ç»„ï¼Œè¯¥åº•å±‚æ•°ç»„æ˜¯ç”±ä¹‹å‰åŒæ ·çš„tå’Œbå‚æ•°é€šè¿‡makeBucketArrayåˆ†é…çš„ï¼Œå¦‚æœæ•°ç»„ä¸ä¸ºç©ºï¼Œéœ€è¦æŠŠè¯¥æ•°ç»„ä¹‹å‰çš„æ•°æ®æ¸…ç©ºå¹¶å¤ç”¨
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;nx&#34;&gt;buckets&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;dirtyalloc&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;size&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;bucket&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;size&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;nbuckets&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;bucket&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ptrdata&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;nf&#34;&gt;memclrHasPointers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buckets&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;size&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;nf&#34;&gt;memclrNoHeapPointers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buckets&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;size&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;c1&#34;&gt;// å¦‚æœå¤šç”³è¯·äº†æ¡¶ï¼Œå°†å¤šç”³è¯·çš„æ¡¶æ”¾åœ¨nextOverflowé‡Œå¤‡ç”¨
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;base&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;nbuckets&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;c1&#34;&gt;// å…ˆè®¡ç®—å‡ºå¤šç”³è¯·å‡ºæ¥çš„å†…å­˜åœ°å€ nextOverflow
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;nx&#34;&gt;nextOverflow&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;bmap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)(&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;add&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buckets&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;base&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;uintptr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;bucketsize&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)))&lt;/span&gt;
        &lt;span class=&#34;c1&#34;&gt;// è®¡ç®—å‡ºç”³è¯·çš„æœ€åä¸€å—bucketçš„åœ°å€
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;nx&#34;&gt;last&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;bmap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)(&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;add&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buckets&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;nbuckets&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;uintptr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;bucketsize&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)))&lt;/span&gt;
        &lt;span class=&#34;c1&#34;&gt;// å°†æœ€åä¸€ä¸ªbucketæ¡¶çš„ä½ç½®æŒ‡å‘non-nilå€¼ï¼Œè¿™æ ·åœ¨è·å–æº¢å‡ºæ¡¶æ—¶ï¼Œå¯ä»¥é€šè¿‡nextOverflowæŒ‡é’ˆåˆ¤æ–­è‡ªå·±æ˜¯å¦æ˜¯æœ€åä¸€ä¸ªæº¢å‡ºæ¡¶ï¼Œnilè¯´æ˜è¿˜æœ‰æ¡¶ï¼Œnon-nilè¯´æ˜æ˜¯æœ€åä¸€ä¸ªæ¡¶
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;nx&#34;&gt;last&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;setoverflow&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;bmap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buckets&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;buckets&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;nextOverflow&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id=&#34;æŸ¥æ‰¾ä¸æ’å…¥&#34;&gt;æŸ¥æ‰¾ä¸æ’å…¥&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;v := m[key]&lt;/code&gt;ä½¿ç”¨å‡½æ•°&lt;code&gt;mapaccess1()&lt;/code&gt;è¿›è¡ŒæŸ¥æ‰¾ï¼Œ &lt;code&gt;v, ok := m[key]&lt;/code&gt;ä½¿ç”¨å‡½æ•°&lt;code&gt;mapaccess2()&lt;/code&gt;è¿›è¡ŒæŸ¥æ‰¾&lt;/p&gt;
&lt;p&gt;&lt;code&gt;mapaccess2()&lt;/code&gt;ä¹Ÿä¼šè°ƒç”¨&lt;code&gt;mapaccess1()&lt;/code&gt;ï¼Œåªæ˜¯è¿”å›çš„æ—¶å€™ä¼šè¿”å›å¤šä¸€ä¸ªç”¨äºè¡¨ç¤ºå½“å‰é”®å€¼å¯¹æ˜¯å¦å­˜åœ¨çš„å¸ƒå°”å€¼ã€‚&lt;/p&gt;
&lt;h3 id=&#34;keyçš„å®šä½&#34;&gt;keyçš„å®šä½&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;æ‰¾bucketsæ•°ç»„ä¸­çš„bucketçš„ä½ç½®ï¼škeyç»è¿‡å“ˆå¸Œè®¡ç®—å¾—åˆ°å“ˆå¸Œå€¼ï¼Œå–å‡ºhmapçš„Bå€¼ï¼Œå–å“ˆå¸Œå€¼çš„åBä½ä¸ªbitä½ï¼Œè®¡ç®—åé¢çš„Bä½çš„å€¼å¾—åˆ°æ¡¶çš„ä½ç½®ï¼ˆå®é™…ä¸Šè¿™ä¸€æ­¥å°±æ˜¯é™¤ç•™ä½™æ•°æ³•çš„å–ä½™æ“ä½œï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚ï¼šä¸€ä¸ªkeyç»è¿‡å“ˆå¸Œè®¡ç®—ä¹‹åï¼Œå¾—åˆ°çš„ç»“æœæ˜¯ï¼š&lt;/p&gt;
&lt;p&gt;&lt;code&gt;10010111 | 000011110110110010001111001010100010010110010101010 â”‚ 00110&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;é•¿åº¦ä¸º64ä½ï¼ŒBç­‰äº5ï¼Œå–å5ä½ï¼Œå³æ‹¿åˆ°00110ï¼Œå€¼ä¸º6ï¼Œä¹Ÿå°±æ˜¯6å·æ¡¶ï¼Œbuckets[6]&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç¡®å®šä½¿ç”¨bucketsæ•°ç»„è¿˜æ˜¯oldbucketsæ•°ç»„ï¼šåˆ¤æ–­oldbucketsæ•°ç»„ä¸­æ˜¯å¦ä¸ºç©ºï¼Œä¸ä¸ºç©ºè¯´æ˜æ­£å¤„äºæ‰©å®¹ä¸­ï¼Œè¿˜æ²¡å®Œæˆè¿ç§»ï¼Œåˆ™é‡æ–°è®¡ç®—æ¡¶çš„ä½ç½®ï¼Œå¹¶åœ¨oldbucketsæ•°ç»„æ‰¾åˆ°å¯¹åº”çš„æ¡¶ï¼›å¦‚æœä¸ºç©ºï¼Œåˆ™åœ¨bucketsæ•°ç»„ä¸­æ‰¾åˆ°å¯¹åº”çš„æ¡¶ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åœ¨æ¡¶ä¸­æ‰¾tophashçš„ä½ç½®ï¼šç”¨keyå“ˆå¸Œè®¡ç®—å¾—åˆ°çš„å“ˆå¸Œå€¼ï¼Œå–é«˜8ä¸ªbitä½ + minTopshash(å°äºminTopshashå€¼æ—¶æ‰éœ€è¦åŠ )ï¼Œè®¡ç®—å¾—åˆ°æ­¤bucketæ¡¶ä¸­çš„tophashï¼Œå³keyåœ¨æ¡¶ä¸­çš„ç¼–å·ï¼Œä¹‹ååœ¨æ¡¶ä¸­çš„æ­£å¸¸ä½éå†æ¯”è¾ƒã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ¯ä¸ªæ¡¶æ˜¯ä¸€æ•´ç‰‡è¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œå…ˆéå†bucketæ¡¶ä¸­çš„æ­£å¸¸ä½ï¼Œä¸æ¡¶ä¸­çš„tophashè¿›è¡Œæ¯”è¾ƒï¼Œå½“æ‰¾åˆ°å¯¹åº”çš„tophashæ—¶ï¼Œæ ¹æ®tophashè¿›è¡Œè®¡ç®—å¾—åˆ°keyï¼Œæ ¹æ®keyçš„å¤§å°è®¡ç®—å¾—åˆ°valueçš„åœ°å€ï¼Œæ‰¾åˆ°valueã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¦‚æœbucketæ¡¶ä¸­çš„æ­£å¸¸ä½æ²¡æ‰¾åˆ°tophashï¼Œä¸”overflowä¸ä¸ºç©ºï¼Œåˆ™ç»§ç»­éå†æº¢å‡ºæ¡¶overflow bucketï¼Œç›´åˆ°æ‰¾åˆ°å¯¹åº”çš„tophashï¼Œå†æ ¹æ®keyçš„å¤§å°è®¡ç®—å¾—åˆ°valueçš„åœ°å€ï¼Œæ‰¾åˆ°valueã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// è®¡ç®—å¾—åˆ°bucketæ¡¶åœ¨bucketsæ•°ç»„ä¸­çš„ä½ç½®
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;bucket&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;hash&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;bucketMask&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;h&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;B&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;nx&#34;&gt;b&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;bmap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;unsafe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Pointer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;uintptr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;h&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buckets&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;bucket&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;uintptr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;bucketsize&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)))&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;// è®¡ç®—å¾—åˆ°tophashï¼ŒminiTopHashç”¨äºè¡¨ç¤ºè¿ç§»è¿›åº¦ï¼Œå½“tophashå€¼å°äºminTopHashæ—¶ï¼Œè¡¨ç¤ºå­˜çš„æ˜¯è¿ç§»çŠ¶æ€ï¼Œå¤§äºminTopHashæ—¶ï¼Œè¡¨ç¤ºçš„æ˜¯è®¡ç®—çš„å“ˆå¸Œå€¼ï¼Œå› æ­¤æ ¹æ®hashè®¡ç®—å‡ºçš„ç»“æœéœ€è¦åŠ ä¸ŠminTopHashæ‰è¡¨ç¤ºçœŸæ­£çš„å€¼ã€‚
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;tophash&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;hash&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uintptr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint8&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;top&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;uint8&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;hash&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;sys&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;PtrSize&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;8&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;8&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;top&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;minTopHash&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;nx&#34;&gt;top&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;minTopHash&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;top&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;// è®¡ç®—keyå’Œvalueï¼Œdataoffsetæ˜¯tophash[8]æ‰€å ç”¨çš„å¤§å°ï¼Œæ‰€ä»¥keyçš„åœ°å€å°±æ˜¯ï¼šbmapçš„åœ°å€ + dataOffsetçš„åç§» + å¯¹åº”çš„ç´¢å¼•i * keyçš„å¤§å°ï¼›
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// è€Œvalueæ˜¯åœ¨æ‰€æœ‰keyä¹‹åçš„ï¼Œç¬¬iä¸ªvalueçš„é€’å¢åœ¨åŠ ä¸Šæ‰€æœ‰keyçš„åç§»å³å¯å¾—å‡ºã€‚
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;k&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;add&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;unsafe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Pointer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;dataOffset&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;uintptr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;keysize&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;span class=&#34;nx&#34;&gt;val&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;add&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;unsafe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Pointer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;dataOffset&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;bucketCnt&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;uintptr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;keysize&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;uintptr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;valuesize&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/go_map_get.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/go_map_get.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			alt=&#34;go map ç»“æ„å›¾&#34;&gt;
	&lt;/a&gt;
	
	&lt;figcaption&gt;go map ç»“æ„å›¾&lt;/figcaption&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;h3 id=&#34;æ’å…¥&#34;&gt;æ’å…¥&lt;/h3&gt;
&lt;p&gt;æ’å…¥ä¹Ÿéœ€è¦å…ˆå®šä½åˆ°keyçš„ä½ç½®åæ‰èƒ½è¿›è¡Œæ’å…¥ï¼Œå®šä½keyçš„æ“ä½œè·Ÿä¸Šé¢æ˜¯ç±»ä¼¼çš„ï¼Œè°ƒç”¨mapassignå‡½æ•°ï¼Œmapassignå…¥å‚ä¸ç”¨ä¼ valueï¼Œè€Œæ˜¯é€šè¿‡æ–¹æ³•è¿”å›keyå¯¹åº”çš„valueçš„æŒ‡é’ˆæ¥è¿›è¡Œèµ‹å€¼ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;å…ˆåˆ¤æ–­hmapæ˜¯å¦ä¸ºç©ºï¼Œæ˜¯å¦æ˜¯å¹¶å‘å†™å…¥ï¼Œå¦‚æœæ˜¯ç›´æ¥æŠ›é”™è¯¯ï¼›ä¿®æ”¹å½“å‰hampçš„çŠ¶æ€ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ ¹æ®keyè®¡ç®—å‡ºå“ˆå¸Œï¼›è¿˜æœ‰å°±æ˜¯åˆ¤æ–­bucketæ¡¶æ˜¯å¦ä¸ºç©ºï¼Œä¸ºç©ºåˆ™åˆ†é…bmapæ•°ç»„ï¼Œã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åˆ¤æ–­ hmapçš„oldbucketsæ˜¯å¦ä¸ºç©ºï¼Œä¸ä¸ºç©ºè¯´æ˜å½“å‰å¤„äºæ‰©å®¹æ¬è¿ï¼Œåˆ™è¿›è¡Œæ¬è¿å·¥ä½œï¼ˆä¸€æ¬¡æœ€å¤šè¿ç§»ä¸¤ä¸ªbucketæ¡¶ï¼‰ï¼Œå®Œäº†å†è¿›è¡Œä¹‹åçš„æµç¨‹ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ ¹æ®keyçš„å“ˆå¸Œå€¼çš„ä½Bä¸ªbitä½ï¼Œè®¡ç®—å¾—åˆ°æ¡¶çš„ä½ç½®ï¼›æ ¹æ®keyçš„å“ˆå¸Œå€¼çš„é«˜8ä¸ªbitä½ï¼Œè®¡ç®—å‡ºtophashã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å…ˆéå†æ­£å¸¸ä½ï¼Œä»ç¬¬ä¸€ä¸ªcellå¼€å§‹ï¼Œæ¯”è¾ƒæ¡¶ä¸Šçš„æ¯ä¸ªtophashæ˜¯å¦ç­‰äºè®¡ç®—å¾—åˆ°çš„tophashï¼Œå¦‚æœä¸ç­‰ï¼Œå†åˆ¤æ–­è¯¥tophashæ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ºç©ºï¼Œè®¡ç®—keyå’Œvalueçš„å†…å­˜åœ°å€ï¼Œè¿›è¡Œæ’å…¥ã€‚å¦‚æœä¸ä¸ºç©ºï¼Œåˆ™éå†ä¸‹ä¸€ä¸ªcellè¿›è¡Œtophashçš„åˆ¤æ–­ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¸‹ä¸€ä¸ªcellä¸Šçš„tophashä¸è®¡ç®—çš„tophashç›¸ç­‰ï¼Œè¯´æ˜å‘ç”Ÿäº†å“ˆå¸Œå†²çªï¼Œå…ˆè®¡ç®—keyçš„åœ°å€ï¼Œæ‰¾åˆ°keyï¼Œåˆ¤æ–­keyæ˜¯å¦ç›¸ç­‰ï¼Œå¦‚æœç›¸ç­‰ï¼Œè®¡ç®—keyå¯¹åº”çš„valueåœ°å€ï¼Œå°†valueçš„å€¼è¿›è¡Œæ›´æ–°ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¦‚æœkeyä¸ç›¸ç­‰ï¼Œéå†ä¸‹ä¸€ä¸ªcellçš„tophashï¼Œç›´åˆ°æ­£å¸¸ä½éå†å®Œæˆï¼Œå¦‚æœæ­¤æ—¶è¿˜ä¸èƒ½æ’å…¥ï¼Œç»§ç»­éå†æº¢å‡ºæ¡¶ï¼Œå¦‚æœæº¢å‡ºæ¡¶ä¸ºç©ºï¼Œé€€å‡ºå¾ªç¯ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åœ¨å·²æœ‰æ¡¶å’Œæº¢å‡ºæ¡¶éƒ½æœªæ‰¾åˆ°åˆé€‚çš„cellæ’å…¥æ—¶ï¼Œä¼šæœ‰ä¸¤ç§æƒ…å†µè¿›è¡Œåˆ¤æ–­ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;åˆ¤æ–­å½“å‰mapçš„è£…è½½å› å­æ˜¯å¦è¾¾åˆ°é»˜è®¤çš„6.5ï¼Œæˆ–è€…å½“å‰mapçš„æº¢å‡ºæ¡¶æ•°é‡æ˜¯å¦è¿‡å¤šï¼Œå¦‚æœæ˜¯è¿™ä¸¤ç§æƒ…å†µä¹‹ä¸€ï¼Œåˆ™è¿›è¡Œæ‰©å®¹ï¼Œæ‰©å®¹ + è¿ç§»åï¼Œç»§ç»­æ­¥éª¤5ä¸Šçš„é€»è¾‘ï¼ˆä½¿ç”¨äº†gotoå…³é”®å­—ï¼‰ã€‚å¦‚æœä¸æ»¡è¶³æ‰©å®¹æ¡ä»¶ï¼Œåˆ™è¿›è¡Œä¸‹ä¸€ç§æƒ…å†µçš„åˆ¤æ–­&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ­¤æ—¶keyè¿˜æ²¡æ’å…¥ï¼Œä¸”æ­£å¸¸ä½å·²æ»¡ï¼Œè¿˜ä¸éœ€è¦æ‰©å®¹ï¼Œæ­¤æ—¶ä¼šè°ƒç”¨&lt;code&gt;newoverflow()å‡½æ•°&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;newoverflow()å‡½æ•°&lt;/code&gt;ä½¿ç”¨hmapåœ¨&lt;code&gt;extra.nextOverflow&lt;/code&gt;ä¸­åˆ›å»ºå¥½çš„æ¡¶ï¼Œå¦‚æœæœ‰ï¼Œéå†è¿™ä¸ªåˆ›å»ºå¥½çš„æ¡¶é“¾è¡¨ï¼Œç›´åˆ°å¯ä»¥æ”¾å…¥æ–°çš„é”®å€¼å¯¹ï¼›å¦‚æœæ²¡æœ‰ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ¡¶ï¼Œå¢åŠ noverflowè®¡æ•°ï¼Œå°†æ–°é”®å€¼å¯¹æ”¾å…¥è¿™ä¸ªæ¡¶ä¸­ï¼Œç„¶åå°†æ–°æ¡¶æŒ‚è½½åˆ°å½“å‰æ¡¶overflowå­—æ®µï¼Œæˆä¸ºæº¢å‡ºæ¡¶ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;newoverflow()å‡½æ•°&lt;/code&gt;ä¼šåœ¨ä¸€å¼€å§‹åˆ¤æ–­hmapçš„&lt;code&gt;extra.nextOverflow&lt;/code&gt;æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ºç©ºä¼šå…ˆé¢„åˆ†é…ï¼Œä¸ä¸ºç©ºåˆ™ç›´æ¥å°†å…¶è®¾ç½®ä¸ºå½“å‰è¦ä½¿ç”¨çš„æº¢å‡ºæ¡¶ï¼Œå¹¶æŠŠåŸæ¥çš„nextOverflowè®¾ç½®ä¸ºç©ºï¼Œç›®çš„æ˜¯å……åˆ†åˆ©ç”¨å·²åˆ†é…çš„å†…å­˜ï¼Œå‡å°‘åˆ†é…æ¬¡æ•°ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://github.com/Nixum/Java-Note/raw/master/source_with_note/go_map_mapassign.go&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;mapassignå‡½æ•°&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;mapassign&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;t&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;maptype&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;h&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;hmap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;unsafe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Pointer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;unsafe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Pointer&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// ... ä¸€äº›ä¾‹è¡Œæ£€æŸ¥ï¼Œå¦‚åˆ¤ç©ºã€ç«æ€æ£€æŸ¥ã€å†…å­˜æ¢æµ‹ã€å¹¶å‘è¯»å†™æ£€æŸ¥ï¼Œè®¾ç½®å½“å‰hmapçš„çŠ¶æ€flags
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;asign&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
    	&lt;span class=&#34;c1&#34;&gt;// å…ˆåˆ¤æ–­å½“å‰æ˜¯å¦å¤„äºæ‰©å®¹æ—¶çš„æ¬è¿ï¼Œå³h.oldbucketsä¸ä¸ºç©ºï¼Œå…ˆè¿›è¡Œæ¬è¿å·¥ä½œ
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;c1&#34;&gt;// å®Œäº†ä¹‹åï¼Œè®¡ç®—å‡ºæ¡¶çš„ä½ç½®ï¼Œæ‹¿åˆ°å¯¹åº”çš„æ¡¶ï¼›è®¡ç®—tophash
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;bucketloop&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
    	&lt;span class=&#34;c1&#34;&gt;// éå†æ¡¶ï¼Œæ‰¾åˆ°é€‚åˆæ’å…¥çš„ä½ç½®
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;done&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
    	&lt;span class=&#34;c1&#34;&gt;// ... ç«æ€æ£€æŸ¥ï¼Œå¹¶å‘è¯»å†™æ£€æŸ¥
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://github.com/Nixum/Java-Note/raw/master/source_with_note/go_map_newoverflow.go&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;newoverflowå‡½æ•°&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// bmapçš„overflow(t)æ–¹æ³•æ˜¯è¿”å›å½“å‰æ¡¶çš„overflowæ¡¶çš„åœ°å€
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// bmapçš„setoverflowæ–¹æ³•æ˜¯ä¸ºbmapçš„overflowæ¡¶èµ‹å€¼ä¸‹ä¸€ä¸ªæ¡¶çš„åœ°å€
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// hmapçš„incrnoverflow()æ–¹æ³•æ˜¯å¢åŠ hmapçš„noverflowå€¼ï¼Œè¡¨ç¤ºæº¢å‡ºæ¡¶çš„æ•°é‡
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// hmapçš„createOverflow()æ–¹æ³•æ˜¯ä¸ºhmapçš„extra.overflowåˆ›å»ºæ–°æ¡¶
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;h&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;hmap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;newoverflow&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;t&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;maptype&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;b&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;bmap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;bmap&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ovf&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;bmap&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;h&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;extra&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;h&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;extra&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;nextOverflow&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;ovf&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;h&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;extra&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;nextOverflow&lt;/span&gt;
        &lt;span class=&#34;c1&#34;&gt;// å¦‚æœhmapçš„extra.nextOverflowæ¡¶çš„æ²¡æœ‰æº¢å‡ºæ¡¶ï¼Œåˆ™è¿›è¡Œåˆå§‹åŒ–
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ovf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;overflow&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;h&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;extra&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;nextOverflow&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;bmap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)(&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;add&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;unsafe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Pointer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ovf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;uintptr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;bucketsize&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)))&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;c1&#34;&gt;// é¢„åˆ†é…å½“å‰æ¡¶çš„æº¢å‡ºæ¡¶
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;			&lt;span class=&#34;nx&#34;&gt;ovf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;setoverflow&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;h&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;extra&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;nextOverflow&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;ovf&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;bmap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)(&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;newobject&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;bucket&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;h&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;incrnoverflow&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;bucket&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ptrdata&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;h&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;createOverflow&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
		&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;h&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;extra&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;overflow&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;append&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;h&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;extra&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;overflow&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ovf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;setoverflow&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ovf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ovf&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id=&#34;æ‰©å®¹-1&#34;&gt;æ‰©å®¹&lt;/h2&gt;
&lt;h3 id=&#34;æ‰©å®¹æ¡ä»¶&#34;&gt;æ‰©å®¹æ¡ä»¶&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;!h.growing() &amp;amp;&amp;amp; (overLoadFactor(h.count+1, h.B) || tooManyOverflowBuckets(h.noverflow, h.B))&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;å³ åœ¨æ²¡æœ‰æ­£åœ¨è¿›è¡Œæ‰©å®¹ çš„æƒ…å†µä¸‹ï¼Œè´Ÿè½½å› å­ &amp;gt; 6.5 æˆ– æº¢å‡ºæ¡¶çš„æ•°é‡ &amp;gt;= bucketsæ•°ç»„çš„æ•°é‡&lt;/p&gt;
&lt;p&gt;æ‰©å®¹æ¡ä»¶çš„åˆ¤æ–­å‘ç”Ÿåœ¨&lt;code&gt;mapassignå‡½æ•°&lt;/code&gt;ï¼Œå³å¯¹mapä½¿ç”¨putçš„æ—¶å€™ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ‰©å®¹ç­–ç•¥-1&#34;&gt;æ‰©å®¹ç­–ç•¥&lt;/h3&gt;
&lt;h4 id=&#34;å¢é‡æ‰©å®¹---é™ä½å“ˆå¸Œå†²çª&#34;&gt;å¢é‡æ‰©å®¹ - é™ä½å“ˆå¸Œå†²çª&lt;/h4&gt;
&lt;p&gt;&lt;code&gt;overLoadFactorå‡½æ•°&lt;/code&gt;ï¼Œè¯¥å‡½æ•°è¿”å›trueï¼Œè¡¨ç¤ºå“ˆå¸Œè¡¨å†…çš„å…ƒç´ è¿‡å¤šï¼Œå“ˆå¸Œå†²çªçš„æ¦‚ç‡å˜å¤§ï¼Œå¯èƒ½åœ¨æ‰¾åˆ°æ¡¶ï¼Œéå†å®Œæ¡¶å†…çš„å…ƒç´ ï¼Œè¿˜è¦ç»§ç»­éå†æº¢å‡ºæ¡¶é“¾è¡¨ï¼Œæ­¤æ—¶éœ€è¦**å¢é‡æ‰©å®¹ï¼Œæ‰©å®¹ä¸ºåŸæ¥çš„ä¸¤å€ **ï¼Œé™ä½å“ˆå¸Œå†²çªçš„æ¦‚ç‡ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// countæ˜¯keyçš„æ•°é‡
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;overLoadFactor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;count&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;B&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint8&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// loadFactorNum = 13, loadFactorDen = 2, å³count &amp;gt; 8 &amp;amp;&amp;amp; count / (2^B) &amp;gt; 6.5
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;count&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;bucketCnt&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;uintptr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;count&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;loadFactorNum&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;bucketShift&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;B&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;loadFactorDen&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h4 id=&#34;ç­‰é‡æ‰©å®¹---æé«˜æ¡¶çš„åˆ©ç”¨ç‡é˜²æ­¢å†…å­˜æ³„æ¼åŠ å¿«æŸ¥è¯¢æ•ˆç‡&#34;&gt;ç­‰é‡æ‰©å®¹ - æé«˜æ¡¶çš„åˆ©ç”¨ç‡ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼ï¼ŒåŠ å¿«æŸ¥è¯¢æ•ˆç‡&lt;/h4&gt;
&lt;p&gt;&lt;code&gt;tooManyOverflowBucketså‡½æ•°&lt;/code&gt;ï¼Œè¯¥å‡½æ•°è¿”å›trueï¼Œè¡¨ç¤ºç”±äºæŸä¸€ä¸ªæ¡¶æ»¡åï¼Œå¼€å§‹ä½¿ç”¨æº¢å‡ºæ¡¶ï¼Œä¸æ–­çš„æ’å…¥æ•°æ®åˆ°æº¢å‡ºæ¡¶ï¼Œåˆä¸æ–­çš„åˆ é™¤æ­£å¸¸æ¡¶ä¸Šçš„æ­£å¸¸ä½ï¼Œä½†æ­¤æ—¶å“ˆå¸Œè¡¨çš„æ•°é‡åˆæ²¡è¶…é˜ˆå€¼ï¼Œä½†æ˜¯ç©ºæ¡¶å¤ªå¤šï¼Œæº¢å‡ºæ¡¶çš„æ•°é‡å¤ªå¤šï¼Œè€Œæ¯æ¬¡æŸ¥æ‰¾åˆå¾—å…ˆéå†æ­£å¸¸ä½ï¼ŒæŸ¥æ‰¾æ•ˆç‡å˜ä½ï¼Œæ­¤æ—¶éœ€è¦&lt;strong&gt;ç­‰é‡æ‰©å®¹ï¼Œå®¹é‡ä¸å˜ï¼Œé‡æ–°è¿ç§»é”®å€¼å¯¹&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;tooManyOverflowBuckets&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;noverflow&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint16&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;B&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint8&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// å¦‚æœè´Ÿè½½å› å­å¤ªä½, ä¸æ“ä½œã€‚
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// å¦‚æœè´Ÿè½½å› å­å¤ªé«˜ï¼Œmapsçš„æ‰©å®¹å’Œç¼©å®¹ä¼šä½¿ç”¨å¤§é‡æœªä½¿ç”¨çš„å†…å­˜
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// å¤ªå¤šæŒ‡çš„æ˜¯æº¢å‡ºæ¡¶çš„æ•°é‡ å¤§äºç­‰äº bucketsæ•°ç»„çš„æ•°é‡
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;B&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;15&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;nx&#34;&gt;B&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;15&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// The compiler doesn&amp;#39;t see here that B &amp;lt; 16; mask B to generate shorter shift code.
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;noverflow&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;uint16&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;B&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;15&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h3 id=&#34;è§¦å‘æ‰©å®¹&#34;&gt;è§¦å‘æ‰©å®¹&lt;/h3&gt;
&lt;p&gt;è§¦å‘æ‰©å®¹æ¡ä»¶æ—¶ï¼Œä¼šæ‰§è¡Œ&lt;code&gt;hashGrowå‡½æ•°&lt;/code&gt;ï¼Œ&lt;strong&gt;è¿›è¡Œæ–°æ¡¶çš„åˆ†é…ï¼Œä½†è¿˜æœªè¿ç§»æ•°æ®&lt;/strong&gt;ï¼ŒçœŸæ­£è¿ç§»æ•°æ®åœ¨&lt;code&gt;growWorkå‡½æ•°&lt;/code&gt;ä¸­ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;é¦–å…ˆä¼šåˆ¤æ–­æ˜¯å¢é‡æ‰©å®¹è¿˜æ˜¯ç­‰é‡æ‰©å®¹ï¼Œå¦‚æœæ˜¯å¢é‡æ‰©å®¹ï¼ŒB + 1ï¼Œå³æ‰©å®¹åˆ°åŸæ¥çš„ä¸¤å€ï¼Œå¦‚æœæ˜¯ç­‰é‡æ‰©å®¹ï¼ŒB + 0ï¼Œå®¹é‡ä¸å˜&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å°†å½“å‰bucketsæ•°ç»„æŒ‚åœ¨hmapçš„oldbucketså­—æ®µï¼Œå½“å‰extraé‡Œçš„æº¢å‡ºæ¡¶æŒ‚åœ¨&lt;code&gt;hmap.extra.oldoverflow&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åˆ›å»ºæ–°çš„bucketsæ•°ç»„ï¼Œå®¹é‡ä¸ºæ–°çš„Bå€¼ï¼Œé¢„åˆ›å»ºæº¢å‡ºæ¡¶ï¼ˆæº¢å‡ºæ¡¶çš„æ•°é‡çœ‹ä¸Šé¢åˆ›å»ºåˆå§‹åŒ–é€»è¾‘ï¼‰ï¼Œç„¶åå°†æ–°çš„bucketsæ•°ç»„æŒ‚åœ¨bucketså­—æ®µï¼Œæ–°çš„æº¢å‡ºæ¡¶æŒ‚åœ¨&lt;code&gt;hmap.mapextra.nextOverflow&lt;/code&gt;å­—æ®µä¸Š&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;è§¦å‘æ‰©å®¹æ¡ä»¶ï¼Œå¯¹æ–°æ¡¶è¿›è¡Œå†…å­˜åˆ†é…ï¼Œåªæ˜¯åˆ›å»ºäº†æ–°çš„æ¡¶ï¼Œæ—§æ•°æ®è¿˜åœ¨æ—§æ¡¶ä¸Šï¼Œä¹‹åè¿˜éœ€è¦å®Œæˆæ•°æ®è¿ç§»ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://github.com/Nixum/Java-Note/raw/master/source_with_note/go_map_hashGrow.go&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;hashGrowå‡½æ•°&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&#34;æ‰©å®¹è¿ç§»&#34;&gt;æ‰©å®¹è¿ç§»&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;æ‰©å®¹è¿ç§»å‘ç”Ÿåœ¨ mapassign å’Œ mapdelete å‡½æ•°ä¸­ï¼Œå³è¿›è¡Œæ’å…¥ã€ä¿®æ”¹ã€åˆ é™¤æ—¶&lt;/strong&gt;ï¼Œæ‰ä¼šè°ƒç”¨&lt;code&gt;growWorkå‡½æ•°&lt;/code&gt;å’Œ&lt;code&gt;evacuateå‡½æ•°&lt;/code&gt;ï¼Œå®ŒæˆçœŸæ­£çš„è¿ç§»å·¥ä½œåï¼Œæ‰ä¼šè¿›è¡Œæ’å…¥ã€ä¿®æ”¹æˆ–åˆ é™¤ã€‚&lt;/p&gt;
&lt;p&gt;è¿ç§»æ—¶æ˜¯æ¸è¿›å¼è¿ç§»ï¼Œä¸€æ¬¡æœ€å¤šè¿ç§»ä¸¤ä¸ªbucketæ¡¶ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;åœ¨æ’å…¥ã€ä¿®æ”¹æˆ–åˆ é™¤ä¸­ï¼Œå¦‚æœå‘ç°oldbucketsæ•°ç»„ä¸ä¸ºç©ºï¼Œè¡¨ç¤ºæ­¤æ—¶æ­£åœ¨æ‰©å®¹ä¸­ï¼Œéœ€è¦è¿›è¡Œæ‰©å®¹è¿ç§»ï¼Œè°ƒç”¨&lt;code&gt;growWorkå‡½æ•°&lt;/code&gt;ï¼Œ&lt;code&gt;growWorkå‡½æ•°&lt;/code&gt;è°ƒç”¨ä¸€æ¬¡&lt;code&gt;evacuateå‡½æ•°&lt;/code&gt;ï¼Œå¦‚æœè°ƒç”¨å®Œæˆåï¼Œhmapçš„oldbucketsè¿˜æ˜¯éç©ºï¼Œåˆ™å†è°ƒç”¨ä¸€æ¬¡&lt;code&gt;evacuateå‡½æ•°&lt;/code&gt;ï¼ŒåŠ å¿«è¿ç§»è¿›ç¨‹ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;8
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;growWork&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;t&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;maptype&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;h&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;hmap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;bucket&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uintptr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// ç¡®è®¤æ¬è¿è€çš„ bucket å¯¹åº”æ­£åœ¨ä½¿ç”¨çš„ å¦‚æœå½“å‰keyæ˜ å°„åˆ°è€çš„bucket1ï¼Œé‚£å°±æ¬è¿è¯¥bucket1
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nf&#34;&gt;evacuate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;h&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;bucket&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;h&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;oldbucketmask&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// å†æ¬è¿ä¸€ä¸ª bucketï¼Œä»¥åŠ å¿«æ¬è¿è¿›ç¨‹
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;h&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;growing&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;nf&#34;&gt;evacuate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;h&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;h&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;nevacuate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;è¿›å…¥&lt;code&gt;evacuateå‡½æ•°&lt;/code&gt;ï¼š&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å¦‚æœæ˜¯&lt;strong&gt;ç­‰é‡æ‰©å®¹&lt;/strong&gt;ï¼ŒBå€¼ä¸å˜ï¼Œè€bucketæ¡¶ä¸Šçš„é”®å€¼è®¡ç®—å‡ºæ¥çš„æ¡¶çš„åºå·ä¸å˜ï¼Œtophashä¸å˜ï¼Œæ­¤æ—¶ä¼šå°†è€æ¡¶ä¸Šçš„é”®å€¼å¯¹ä¾æ¬¡åœ°ä¸€ä¸ªä¸ªè½¬ç§»åˆ°æ–°æ¡¶ä¸Šï¼Œä½¿è¿™äº›é”®å€¼å¯¹åœ¨æ–°æ¡¶ä¸Šæ’åˆ—æ›´åŠ ç´§å‡‘ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¦‚æœæ˜¯&lt;strong&gt;å¢é‡æ‰©å®¹&lt;/strong&gt;ï¼Œå®¹é‡å˜ä¸ºåŸæ¥çš„ä¸¤å€ï¼ŒBå€¼+1ï¼Œè€bucketæ¡¶ä¸Šçš„é”®å€¼è®¡ç®—å‡ºæ¥çš„æ¡¶çš„åºå·æ”¹å˜ï¼Œè¿™äº›é”®å€¼å¯¹è®¡ç®—åçš„bucketæ¡¶çš„åºå·å¯èƒ½è·Ÿä¹‹å‰ä¸€æ ·ï¼Œä¹Ÿå¯èƒ½æ˜¯ç›¸æ¯”åŸæ¥åŠ ä¸Š2^Bï¼Œå–å†³äºkeyå“ˆå¸Œå€¼å è€B+1 ä½çš„å€¼æ˜¯0è¿˜æ˜¯1ã€‚æ¯”å¦‚ï¼š&lt;/p&gt;
&lt;p&gt;&lt;code&gt;10010111 | 000011110110110010001111001010100010010110010101010 â”‚ 01010&lt;/code&gt;ï¼ŒB=5ï¼Œbucketçš„åºå·æ˜¯10ï¼Œå¢é‡æ‰©å®¹åä¸º&lt;/p&gt;
&lt;p&gt;&lt;code&gt;10010111 | 00001111011011001000111100101010001001011001010101 | 001010&lt;/code&gt;ï¼ŒB=6ï¼Œbucketçš„åºå·è¿˜æ˜¯10ï¼Œ&lt;/p&gt;
&lt;p&gt;å¦ä¸€ç§æƒ…å†µæ˜¯&lt;/p&gt;
&lt;p&gt;&lt;code&gt;10010111 | 000011110110110010001111001010100010010110010101011 â”‚ 01010&lt;/code&gt;ï¼ŒB=5ï¼Œbucketçš„åºå·æ˜¯10ï¼Œå¢é‡æ‰©å®¹åä¸º&lt;/p&gt;
&lt;p&gt;&lt;code&gt;10010111 | 00001111011011001000111100101010001001011001010101 â”‚ 101010&lt;/code&gt;ï¼ŒB=6ï¼Œbucketçš„åºå·æ˜¯42ï¼ˆ10 + 32ï¼Œå³10 + 2 ^5ï¼‰&lt;/p&gt;
&lt;p&gt;tophashä¸å˜ï¼ŒåŸæ¥è€bucketæ¡¶ä¸Šçš„é”®å€¼å¯¹ä¼šé‡æ–°åˆ†æµåˆ°ä¸¤ä¸ªæ–°bucketæ¡¶ä¸Šã€‚å°†è€bucketæ¡¶ä¸Šçš„é”®å€¼å¯¹å’Œå…¶æŒ‡å‘çš„æº¢å‡ºæ¡¶ä¸Šçš„é”®å€¼å¯¹è¿›è¡Œè¿ç§»ï¼Œä¾æ¬¡è½¬ç§»åˆ°æ–°æ¡¶ä¸Šï¼Œæ¯è¿ç§»å®Œä¸€ä¸ªï¼Œkeyåœ¨è€buckectçš„tophashè®¾ç½®ä¸ºevacuatedXæˆ–è€…evacuatedYï¼ˆtophashçš„æœ€ä½ä½è¡¨ç¤ºè¿ç§»åˆ°æ–°æ¡¶çš„å“ªä¸€partï¼Œ0ä¸ºxï¼Œ1ä¸ºyï¼‰ï¼Œhmapçš„nevacuateè®¡æ•°+1ï¼Œç›´åˆ°è€bucketæ¡¶ä¸Šçš„é”®å€¼å¯¹è¿ç§»å®Œæˆï¼Œæœ€åæ¸…ç©ºoldbucketså’Œoldoverflowå­—æ®µã€‚&lt;/p&gt;
&lt;p&gt;è¿™é‡Œä¸¤ä¸ªæ–°çš„æ¡¶å¯¹åº”æºç é‡Œçš„X part, Y partï¼Œå› ä¸ºæ‰©å®¹åˆ°åŸæ¥çš„ 2 å€ï¼Œæ¡¶çš„æ•°é‡æ˜¯åŸæ¥çš„ 2 å€ï¼Œå‰ä¸€åŠæ¡¶è¢«ç§°ä¸º X partï¼Œåä¸€åŠæ¡¶è¢«ç§°ä¸º Y partã€‚ä¸€ä¸ª bucket ä¸­çš„æ‰€æœ‰key å¯èƒ½ä¼šåˆ†æµåˆ° 2 ä¸ªæ¡¶ä¸­ï¼Œä¸€ä¸ªä½äº X partï¼Œä¸€ä¸ªä½äº Y partã€‚æ‰€ä»¥åœ¨æ¬è¿ä¸€ä¸ª cell ä¹‹å‰ï¼Œéœ€è¦è®¡ç®—è¿™ä¸ªcellè¦è½å…¥åˆ°å“ªä¸€partã€‚&lt;/p&gt;
&lt;p&gt;X part ä¸ Y partçš„å…³ç³»ï¼šX part + 2 ^ è€B = Y partï¼Œä¹‹æ‰€ä»¥è¦ç¡®å®škeyè½åœ¨å“ªä¸ªåŒºé—´ï¼Œæ˜¯ä¸ºäº†æ–¹ä¾¿è®¡ç®—keyè¦æ’å…¥çš„å†…å­˜åœ°å€ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;æ‰©å®¹å‰ï¼ŒB = 2ï¼Œå…±æœ‰ 4 ä¸ª bucketsï¼Œlowbits è¡¨ç¤º hash å€¼çš„ä½ä½ã€‚å‡è®¾æˆ‘ä»¬ä¸å…³æ³¨å…¶ä»– buckets æƒ…å†µï¼Œä¸“æ³¨åœ¨ 2 å· bucketã€‚å¹¶ä¸”å‡è®¾ overflow å¤ªå¤šï¼Œè§¦å‘äº†ç­‰é‡æ‰©å®¹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/go_map_%e6%89%a9%e5%ae%b9.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/go_map_%e6%89%a9%e5%ae%b9.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			alt=&#34;go map è§¦å‘æ‰©å®¹&#34;&gt;
	&lt;/a&gt;
	
	&lt;figcaption&gt;go map è§¦å‘æ‰©å®¹&lt;/figcaption&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;æ‰©å®¹å®Œæˆåï¼Œoverflow bucket æ¶ˆå¤±äº†ï¼Œkey éƒ½é›†ä¸­åˆ°äº†ä¸€ä¸ª bucketï¼Œæ›´ä¸ºç´§å‡‘äº†ï¼Œæé«˜äº†æŸ¥æ‰¾çš„æ•ˆç‡ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/go_map_%e7%ad%89%e9%87%8f%e6%89%a9%e5%ae%b9.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/go_map_%e7%ad%89%e9%87%8f%e6%89%a9%e5%ae%b9.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			alt=&#34;go map ç­‰é‡æ‰©å®¹&#34;&gt;
	&lt;/a&gt;
	
	&lt;figcaption&gt;go map ç­‰é‡æ‰©å®¹&lt;/figcaption&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;å‡è®¾è§¦å‘äº† 2 å€çš„æ‰©å®¹ï¼Œé‚£ä¹ˆæ‰©å®¹å®Œæˆåï¼Œè€ buckets ä¸­çš„ key åˆ†è£‚åˆ°äº† 2 ä¸ª æ–°çš„ bucketã€‚ä¸€ä¸ªåœ¨ x partï¼Œä¸€ä¸ªåœ¨ y çš„ partã€‚ä¾æ®æ˜¯ hash çš„ lowbitsã€‚æ–° map ä¸­ &lt;code&gt;0-3&lt;/code&gt; ç§°ä¸º x partï¼Œ&lt;code&gt;4-7&lt;/code&gt; ç§°ä¸º y partã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/go_map_%e5%a2%9e%e9%87%8f%e6%89%a9%e5%ae%b9.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/go_map_%e5%a2%9e%e9%87%8f%e6%89%a9%e5%ae%b9.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			alt=&#34;go map å¢é‡æ‰©å®¹&#34;&gt;
	&lt;/a&gt;
	
	&lt;figcaption&gt;go map å¢é‡æ‰©å®¹&lt;/figcaption&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://github.com/Nixum/Java-Note/raw/master/source_with_note/go_map_evacuate.go&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;evacuateå‡½æ•°&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;åˆ é™¤&#34;&gt;åˆ é™¤&lt;/h2&gt;
&lt;p&gt;è°ƒç”¨deleteå‡½æ•°ï¼Œæ— è®ºè¦åˆ é™¤çš„keyæ˜¯å¦å­˜åœ¨ï¼Œdeleteéƒ½ä¸ä¼šè¿”å›ä»»ä½•ç»“æœã€‚åˆ é™¤å®é™…ä¸Šä¹Ÿæ˜¯ä¸€ä¸ªkeyçš„å®šä½ + åˆ é™¤çš„æ“ä½œï¼Œå®šä½åˆ°keyåï¼Œå°†å…¶é”®å€¼å¯¹ç½®ç©ºï¼Œhmapçš„count - 1ï¼Œtophashç½®ä¸ºemptyã€‚&lt;strong&gt;åˆ é™¤è¿‡ç¨‹ä¹Ÿä¼šæ£€æŸ¥æ˜¯å¦å¤„äºæ‰©å®¹çŠ¶æ€ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™ä¼šè§¦å‘æ¬è¿&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;éå†&#34;&gt;éå†&lt;/h2&gt;
&lt;p&gt;å¯¹goä¸­çš„mapæ˜¯æ— åºçš„ï¼Œæ¯æ¬¡éå†å‡ºæ¥çš„é¡ºåºéƒ½æ˜¯ä¸ä¸€æ ·çš„ï¼Œgoåœ¨æ¯æ¬¡éå†mapæ—¶ï¼Œå¹¶ä¸æ˜¯å›ºå®šåœ°ä»0å·bucketæ¡¶å¼€å§‹éå†ï¼Œæ¯æ¬¡éƒ½æ˜¯ä»ä¸€ä¸ªéšæœºå€¼åºå·çš„bucketæ¡¶å¼€å§‹éå†ï¼Œå¹¶ä¸”æ˜¯ä»è¿™ä¸ªbucketæ¡¶çš„ä¸€ä¸ªéšæœºåºå·çš„ æ­£å¸¸ä½å¼€å§‹éå†ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;ol&gt;
&lt;li&gt;é¦–å…ˆä»bucketsæ•°ç»„ä¸­ï¼Œéšæœºç¡®å®šä¸€ä¸ªç´¢å¼•ï¼Œä½œä¸ºstartBucketï¼Œç„¶åç¡®å®šoffsetåç§»é‡ï¼Œå¾—åˆ°æ¡¶ä¸­çš„æ­£å¸¸ä½çš„ä½ç½®ï¼Œä½œä¸ºèµ·å§‹keyçš„åœ°å€ã€‚&lt;/li&gt;
&lt;li&gt;éå†å½“å‰bucketåŠbucket.overflowï¼Œåˆ¤æ–­å½“å‰bucketæ˜¯å¦æ­£åœ¨æ‰©å®¹ä¸­ï¼Œå¦‚æœæ˜¯åˆ™è·³è½¬åˆ°3ï¼Œå¦åˆ™è·³è½¬åˆ°4ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœæ˜¯åœ¨æ‰©å®¹ä¸­ï¼Œéå†æ—¶ä¼šå…ˆåˆ°å½“å‰bucketæ‰©å®¹å‰çš„è€çš„bucketæ¡¶ä¸­éå†é‚£äº›èƒ½è¿ç§»åˆ°å½“å‰æ¡¶çš„keyã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å‡å¦‚åŸå…ˆçš„bucketsä¸º0ï¼Œ1ï¼Œé‚£ä¹ˆæ‰©å®¹åçš„æ–°çš„bucketsä¸º0ï¼Œ1ï¼Œ2ï¼Œ3ï¼Œæ­¤æ—¶æˆ‘ä»¬éå†åˆ°äº†buckets[0]ï¼Œ å‘ç°è¿™ä¸ªbucketæ­£åœ¨æ‰©å®¹ï¼Œé‚£ä¹ˆæ‰¾åˆ°bucket[0]æ‰€å¯¹åº”çš„oldbuckets[0]ï¼Œéå†é‡Œé¢çš„keyï¼Œè¿™æ—¶å€™ä»…ä»…éå†é‚£äº›keyç»è¿‡hashåï¼Œå¯ä»¥æ•£åˆ—åˆ°bucket[0]é‡Œé¢çš„éƒ¨åˆ†keyï¼›åŒç†ï¼Œå½“éå†åˆ°bucket[2]çš„æ—¶å€™ï¼Œå‘ç°bucketæ­£åœ¨æ‰©å®¹ï¼Œæ‰¾åˆ°oldbuckets[0]ï¼Œç„¶åéå†é‡Œé¢å¯ä»¥æ•£åˆ—åˆ°bucket[2]çš„é‚£äº›keyã€‚&lt;/p&gt;
&lt;ol start=&#34;4&#34;&gt;
&lt;li&gt;éå†å½“å‰è¿™ä¸ªbucketå³å¯ã€‚&lt;/li&gt;
&lt;li&gt;ç»§ç»­éå†bucketä¸‹é¢çš„overflowé“¾è¡¨ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœéå†åˆ°äº†startBucketï¼Œè¯´æ˜éå†å®Œäº†ï¼Œç»“æŸéå†ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å‡è®¾æˆ‘ä»¬æœ‰ä¸‹å›¾æ‰€ç¤ºçš„ä¸€ä¸ª mapï¼Œèµ·å§‹æ—¶ B = 1ï¼Œæœ‰ä¸¤ä¸ª bucketï¼Œåæ¥è§¦å‘äº†æ‰©å®¹ï¼ˆè¿™é‡Œä¸è¦æ·±ç©¶æ‰©å®¹æ¡ä»¶ï¼Œåªæ˜¯ä¸€ä¸ªè®¾å®šï¼‰ï¼ŒB å˜æˆ 2ã€‚å¹¶ä¸”ï¼Œ 1 å· bucket ä¸­çš„å†…å®¹æ¬è¿åˆ°äº†æ–°çš„ bucketï¼Œ&lt;code&gt;1 å·&lt;/code&gt;è£‚å˜æˆ &lt;code&gt;1 å·&lt;/code&gt;å’Œ &lt;code&gt;3 å·&lt;/code&gt;ï¼›&lt;code&gt;0 å·&lt;/code&gt; bucket æš‚æœªæ¬è¿ã€‚è€çš„ bucket æŒ‚åœ¨åœ¨ &lt;code&gt;*oldbuckets&lt;/code&gt; æŒ‡é’ˆä¸Šé¢ï¼Œæ–°çš„ bucket åˆ™æŒ‚åœ¨ &lt;code&gt;*buckets&lt;/code&gt; æŒ‡é’ˆä¸Šé¢ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/go_map_%e9%81%8d%e5%8e%861.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/go_map_%e9%81%8d%e5%8e%861.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;è¿™æ—¶ï¼Œæˆ‘ä»¬å¯¹æ­¤ map è¿›è¡Œéå†ã€‚å‡è®¾ç»è¿‡åˆå§‹åŒ–åï¼ŒstartBucket = 3ï¼Œoffset = 2ã€‚äºæ˜¯ï¼Œéå†çš„èµ·ç‚¹å°†æ˜¯ 3 å· bucket çš„ 2 å· cellï¼Œä¸‹é¢è¿™å¼ å›¾å°±æ˜¯å¼€å§‹éå†æ—¶çš„çŠ¶æ€ï¼š&lt;/p&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/go_map_%e9%81%8d%e5%8e%862.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/go_map_%e9%81%8d%e5%8e%862.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;æ ‡çº¢çš„è¡¨ç¤ºèµ·å§‹ä½ç½®ï¼Œbucket éå†é¡ºåºä¸ºï¼š3 -&amp;gt; 0 -&amp;gt; 1 -&amp;gt; 2ï¼Œéå†åˆ°0å·æ¡¶æ—¶ï¼Œè™½ç„¶0å·æ¡¶æ­¤æ—¶è¿˜æ²¡æ¬è¿ï¼Œä½†åªä¼šéå†0å·æ¡¶æ¬è¿è¿‡åä»ç„¶åœ¨0å·æ¡¶çš„keyï¼Œå³éå†æ—¶å¦‚æœé‡åˆ°æ­£åœ¨æ‰©å®¹ï¼Œä¼šæŒ‰ç…§å°†æ¥æ‰©å®¹å®Œæˆåæ–°bucketçš„é¡ºåºè¿›è¡Œéå†&lt;/p&gt;
&lt;p&gt;æœ€ç»ˆéå†çš„é¡ºåºä¸º:&lt;/p&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/go_map_%e9%81%8d%e5%8e%863.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/go_map_%e9%81%8d%e5%8e%863.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h1&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://cloud.tencent.com/developer/article/1859042&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;ä» map çš„ extra å­—æ®µè°ˆèµ·&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://learnku.com/docs/the-way-to-go/chapter-description/3611&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Goå…¥é—¨æŒ‡å—&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://zhuanlan.zhihu.com/p/61121325&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;æ·±å…¥ç†è§£Sliceåº•å±‚å®ç°&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://draveness.me/golang/docs/part2-foundation/ch03-datastructure/golang-array-and-slice&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Go è¯­è¨€è®¾è®¡ä¸å®ç°&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://studygolang.com/articles/27421&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Golangæºç -Mapå®ç°åŸç†åˆ†æ&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://segmentfault.com/a/1190000020616487&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Go mapåŸç†å‰–æ&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://segmentfault.com/a/1190000023879178&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;å¹´åº¦æœ€ä½³ã€golangmapã€‘è¯¦è§£&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://juejin.cn/post/7079964047893856293&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;é€è¡Œæ‹†è§£ Go map æºç &lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://zhuanlan.zhihu.com/p/74613114&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;æ·±åº¦è§£å¯†Goè¯­è¨€ä¹‹channel&lt;/a&gt;&lt;/p&gt;
</description>
        </item>
        <item>
        <title>Ginæ¡†æ¶åŸç†</title>
        <link>http://nixum.cc/p/gin%E6%A1%86%E6%9E%B6%E5%8E%9F%E7%90%86/</link>
        <pubDate>Mon, 22 Mar 2021 00:00:00 +0000</pubDate>
        
        <guid>http://nixum.cc/p/gin%E6%A1%86%E6%9E%B6%E5%8E%9F%E7%90%86/</guid>
        <description>&lt;p&gt;[TOC]&lt;/p&gt;
&lt;h1 id=&#34;æ ‡å‡†åº“nethttp&#34;&gt;æ ‡å‡†åº“net/http&lt;/h1&gt;
&lt;p&gt;demo:&lt;/p&gt;
&lt;p&gt;å®šä¹‰äº†ä¸€ä¸ªè·¯ç”± &lt;code&gt;/hello&lt;/code&gt;ï¼Œç»‘å®šäº†ä¸€ä¸ªhandlerï¼Œè¾“å‡ºå½“å‰pathï¼ŒListenAndServeæ–¹æ³•å¯åŠ¨webæœåŠ¡ï¼Œç¬¬ä¸€ä¸ªå‚æ•°è¡¨ç¤ºç›‘å¬çš„ç«¯å£ï¼Œç¬¬äºŒä¸ªå‚æ•°ä»£è¡¨ å¤„ç†æ‰€æœ‰çš„HTTPè¯·æ±‚ çš„å®ä¾‹ï¼Œç­‰äºnilæ—¶ä¼šä½¿ç”¨é»˜è®¤çš„&lt;code&gt;DefaultServeMux&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;è¯¥demoæ˜¯åŸºäºæ ‡å‡†åº“å®ç°çš„Webæ¡†æ¶å…¥å£ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;HandleFunc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;/hello&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;w&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ResponseWriter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;req&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Request&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Fprintf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;w&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;URL.Path = %q\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;req&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;URL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;})&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;log&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Fatal&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;ListenAndServe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;:8080&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;// http.ListenAndServe()æ–¹æ³•ç¬¬äºŒä¸ªå‚æ•°çš„å®ç°ï¼š
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Handler&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nf&#34;&gt;ServeHTTP&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ResponseWriter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Request&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;// æ³¨å†Œhandleré»˜è®¤ä½¿ç”¨DefaultServeMuxï¼Œä¸ListenAndServeç¬¬äºŒä¸ªå‚æ•°ä½¿ç”¨çš„å¤„ç†å™¨ä¸€è‡´ã€‚
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// å°†pathå’Œå¯¹åº”çš„handleræ–¹æ³•ä¿å­˜åœ¨DefaultServeMuxçš„mapä¸­ï¼Œç­‰è¯·æ±‚è¿›æ¥è¿›è¡ŒåŒ¹é…å¤„ç†ã€‚
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;HandleFunc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pattern&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;handler&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ResponseWriter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Request&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;DefaultServeMux&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;HandleFunc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pattern&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;handler&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;&lt;code&gt;http.ListenAndServe&lt;/code&gt;æ˜¯æ•´ä¸ªwebçš„æ€»æµç¨‹ï¼Œæœ¬è´¨ä¸Šè¿˜æ˜¯èµ°socketé‚£ä¸€å¥—ï¼Œbind -ã€‹ listen -ã€‹ accept -ã€‹ readã€write -ã€‹ closeã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;  1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 48
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 49
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 50
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 51
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 52
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 53
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 54
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 55
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 56
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 57
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 58
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 59
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 60
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 61
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 62
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 63
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 64
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 65
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 66
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 67
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 68
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 69
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 70
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 71
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 72
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 73
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 74
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 75
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 76
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 77
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 78
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 79
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 80
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 81
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 82
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 83
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 84
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 85
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 86
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 87
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 88
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 89
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 90
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 91
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 92
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 93
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 94
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 95
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 96
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 97
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 98
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 99
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;100
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;101
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;102
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;103
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;104
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;105
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;106
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;107
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;108
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;109
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;110
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;111
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;112
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;113
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;114
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;115
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;116
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;117
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;118
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;119
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;120
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;121
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;122
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;123
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;124
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;125
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;126
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;127
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;128
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;129
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;130
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;131
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;132
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;133
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;134
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;135
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;136
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;137
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;138
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;139
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;140
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;ListenAndServe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;addr&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;handler&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Handler&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;server&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Server&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Addr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;addr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Handler&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;handler&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;server&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;ListenAndServe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;srv&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Server&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;ListenAndServe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;ln&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;net&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Listen&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;tcp&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;addr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;srv&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Serve&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ln&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;srv&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Server&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Serve&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;l&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;net&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Listener&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// å°†listenerå°è£…è¿›server
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;WithValue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;baseCtx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ServerContextKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;srv&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;c1&#34;&gt;// æ— é™å¾ªç¯ï¼Œacceptæ¥æ”¶å®¢æˆ·ç«¯çš„è¯·æ±‚
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;nx&#34;&gt;rw&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;l&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Accept&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;select&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;srv&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;getDoneChan&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;():&lt;/span&gt;
				&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ErrServerClosed&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ne&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;net&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ne&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Temporary&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
				&lt;span class=&#34;o&#34;&gt;...&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// è®¾ç½®é»˜è®¤è¶…æ—¶æ—¶é—´
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;				&lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Sleep&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;tempDelay&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
				&lt;span class=&#34;k&#34;&gt;continue&lt;/span&gt;
			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
        &lt;span class=&#34;c1&#34;&gt;// å°è£…acceptåˆ°çš„è¿æ¥ï¼Œèµ·ä¸€ä¸ªgoroutineæ¥å¤„ç†è¿™ä¸ªè¿æ¥ï¼Œä¹‹åç»§ç»­ç­‰å¾…acceptçš„è¿”å›
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;nx&#34;&gt;connCtx&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cc&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;srv&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ConnContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cc&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;connCtx&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;cc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;connCtx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rw&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
			&lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;tempDelay&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;srv&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;newConn&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rw&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;setState&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rwc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;StateNew&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// before Serve can return
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;c1&#34;&gt;// æ¯æ¬¡æœ‰è¿æ¥è¿›æ¥éƒ½ä¼šèµ·ä¸€ä¸ªåç¨‹æ¥å¤„ç†
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;k&#34;&gt;go&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;serve&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;connCtx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;conn&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;serve&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
 	&lt;span class=&#34;c1&#34;&gt;// å¤„ç†è¿æ¥ã€tlså¤„ç†ä¹‹ç±»çš„ï¼Œä»è¿æ¥ä¸­è¯»å–æ•°æ®ï¼Œå°è£…æˆrequestã€responseï¼Œäº¤ç»™serverHandlerå¤„ç†
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;requestBodyRemains&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;req&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Body&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nf&#34;&gt;registerOnHitEOF&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;req&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Body&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;w&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;conn&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;startBackgroundRead&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;c1&#34;&gt;// è¯¥æ–¹æ³•ä¼šèµ·ä¸€ä¸ªæ–°åç¨‹åœ¨åå°è¯»å–è¿æ¥ï¼Œå°±é å®ƒæ¥å®ç°è¯·æ±‚è¿˜æ²¡å¤„ç†å®Œå°±èƒ½è¿›è¡Œå–æ¶ˆçš„åŠŸèƒ½
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;c1&#34;&gt;// å®é™…ä¸Šï¼Œå–æ¶ˆåï¼Œåªæ˜¯è¿æ¥è¢«ä¸­æ–­äº†ï¼Œä¸šåŠ¡ä»£ç è¯¥æ‰§è¡Œè¿˜æ˜¯åœ¨æ‰§è¡Œï¼Œæ‰§è¡Œå®Œæ‰èƒ½æ”¶åˆ°cancelä¿¡å·
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;nx&#34;&gt;w&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;conn&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;startBackgroundRead&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// é»˜è®¤çš„serverHandler.ServeHTTPæ–¹æ³•ä¼šè¿›è¡Œåˆ¤æ–­:
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// å¦‚æœhandlerä¸ºç©ºå°±ä¼šä½¿ç”¨é»˜è®¤çš„DefaultServeMuxï¼Œå¦åˆ™å°±ç”¨ç”¨æˆ·å®šä¹‰çš„ServeHTTPæ¥å¤„ç†è¯·æ±‚
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;serverHandler&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;server&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;ServeHTTP&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;w&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;w&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;req&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// è¯·æ±‚ç»“æŸä¹‹åcancelæ‰context
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;w&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;cancelCtx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;// å¤„ç†è¿æ¥æ—¶ï¼Œå¤„ç†ä¼šæŠŠè¿æ¥äº¤ç»™serverHandlerï¼Œè¿˜ä¼šèµ·ä¸€ä¸ªåç¨‹ç›‘æ§è¿æ¥çš„çŠ¶æ€
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cr&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;connReader&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;startBackgroundRead&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;cr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;defer&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;unlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
	&lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;cr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;inRead&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;cr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;conn&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rwc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;SetReadDeadline&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{})&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;go&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;backgroundRead&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;// å¦‚æœè¿æ¥æœ‰é—®é¢˜ï¼Œå°±ä¼šcancelæ‰
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cr&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;connReader&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;backgroundRead&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;n&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;conn&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rwc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Read&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;byteBuf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[:])&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;cr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;n&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;cr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;hasByte&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// å¦‚æœè¿æ¥è¶…æ—¶äº†ï¼Œå°±ä¼šæ”¶åˆ°EOFçš„é”™è¯¯
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ne&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;net&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;aborted&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ne&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Timeout&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;c1&#34;&gt;// å‡ºé”™æ—¶å°±ä¼šè§¦å‘cancelï¼Œä»è€Œç»“æŸæ‰è¯·æ±‚
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;nx&#34;&gt;cr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;handleReadError&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
        &lt;span class=&#34;c1&#34;&gt;// handleReadErroræ–¹æ³•å†…å°±æ˜¯ä¸‹é¢è¿™ä¸¤å¥
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;c1&#34;&gt;// cr.conn.cancelCtx()
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	    &lt;span class=&#34;c1&#34;&gt;// cr.closeNotify()
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;cr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;aborted&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;cr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;inRead&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;cr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;unlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;cr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cond&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Broadcast&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;// DefaultServeMuxçš„ServeHTTPæ–¹æ³•ï¼Œå¯¹è¯·æ±‚è¿›è¡Œè·¯ç”±åŒ¹é…ï¼Œç”¨çš„å°±æ˜¯http.HandleFuncé‡Œçš„map
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// æ ¹æ®pathæ‰¾åˆ°å¯¹åº”çš„handlerï¼Œæ‰§è¡Œ
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;mux&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ServeMux&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;ServeHTTP&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;w&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ResponseWriter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Request&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;RequestURI&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;*&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;ProtoAtLeast&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;w&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Header&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Set&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Connection&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;close&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;w&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;WriteHeader&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;StatusBadRequest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// è·å–æ³¨å†Œçš„è·¯ç”±handler
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;h&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;mux&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Handler&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;h&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;ServeHTTP&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;w&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;// è·¯ç”±handlerçš„é€»è¾‘éå¸¸ç®€å•ï¼Œå°±æ˜¯ç›´æ¥æ ¹æ®pathåœ¨mapé‡ŒåŒ¹é…æ‰¾åˆ°å¤„ç†çš„handler
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;mux&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ServeMux&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;handler&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;path&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;h&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Handler&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pattern&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;mux&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;mu&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;RLock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;defer&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;mux&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;mu&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;RUnlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;mux&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;hosts&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;h&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pattern&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;mux&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;match&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;host&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;h&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;h&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pattern&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;mux&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;match&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;h&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;h&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pattern&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;NotFoundHandler&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;// åªæ˜¯åšç®€å•çš„è·¯ç”±åŒ¹é…
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;mux&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ServeMux&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;match&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;path&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;h&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Handler&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pattern&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;mux&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;h&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pattern&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;e&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;range&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;mux&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;es&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;strings&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;HasPrefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;e&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pattern&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;e&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;h&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;e&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pattern&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h1 id=&#34;ginå¯¹nethttpçš„å°è£…&#34;&gt;Ginå¯¹net/httpçš„å°è£…&lt;/h1&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// http.ListenAndServe()æ–¹æ³•ç¬¬äºŒä¸ªå‚æ•°çš„å®ç°ï¼š
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Handler&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nf&#34;&gt;ServeHTTP&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ResponseWriter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Request&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;Ginåšçš„ï¼Œå°±æ˜¯å®ç°è¿™ä¸ªHandleræ¥å£ï¼ŒæŒç®¡æ‰€æœ‰HTTPè¯·æ±‚ï¼Œæä¾›ä¸°å¯Œçš„èƒ½åŠ›ï¼šå¦‚è·¯ç”±åˆ†å‘ã€è¯·æ±‚ä¸Šä¸‹æ–‡çš„å¤ç”¨ã€ä¸­é—´ä»¶è°ƒç”¨é“¾ç­‰åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;github.com/gin-gonic/gin&amp;#34;&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;handlePing&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;gin&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;JSON&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;200&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;gin&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;H&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
            &lt;span class=&#34;s&#34;&gt;&amp;#34;message&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;pong&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
   &lt;span class=&#34;p&#34;&gt;})&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;// gin.Defaultè¿˜ä¼šé»˜è®¤åŒ…å«ä¸¤ä¸ªä¸­é—´ä»¶Loggerå’ŒRecoveryï¼Œè¿˜æœ‰å¯¹404ã€405å¤„ç†çš„handler
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;routerEngine&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;gin&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Default&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// ä¸‰ç§æ³¨å†Œè·¯ç”±çš„æ–¹å¼
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;routerEngine&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;GET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;/ping&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;handlePing&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;routerEngine&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Handle&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;MethodGet&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;/ping2&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;handlePing&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// åˆ†ç»„
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;v1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;routerEngine&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Group&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;/v1&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;GET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;/ping3&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;handlePing&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// runçš„åº•å±‚ä»ç„¶æ˜¯http.ListenAndServe
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;routerEngine&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Run&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// é»˜è®¤ç›‘å¬ 0.0.0.0:8080
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// -----
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// ä¹Ÿå¯ä»¥ç”¨ä¸‹é¢è¿™ç§æ–¹æ³•å¯åŠ¨ï¼Œæœ¬è´¨è¿˜æ˜¯è°ƒç”¨gin.Default()çš„ServeHTTPæ–¹æ³•
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;server&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Server&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    	&lt;span class=&#34;nx&#34;&gt;Addr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;    &lt;span class=&#34;s&#34;&gt;&amp;#34;:8080&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;Handler&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;routerEngine&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;log&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Fatal&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;server&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;ListenAndServe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;soï¼Œæœ¬è´¨ä¸Šä¹Ÿå¯ä»¥è¯´ginæ˜¯ä¸€ä¸ªhttp routerï¼Œä¸»è¦çœ‹gin.Default()æ–¹æ³•è¿”å›çš„enginï¼Œç”±ginçš„enginæ¥è¿›è¡Œè¯·æ±‚å°è£…ã€è·¯ç”±åŒ¹é…ã€è½¬å‘åˆ°å¯¹åº”çš„handlerå¤„ç†ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;engine&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Engine&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;ServeHTTP&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;w&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ResponseWriter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;req&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Request&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;c1&#34;&gt;// gin.Contextå¯¹è±¡å¤ç”¨æ± 
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;engine&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pool&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// é‡ç½®gin.contextå¯¹è±¡
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;writermem&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;reset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;w&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Request&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;req&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;reset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
	&lt;span class=&#34;c1&#34;&gt;// äº¤ç»™engineå¤„ç†è¯·æ±‚ï¼Œè¿›å…¥è·¯ç”±æ ‘åŒ¹é…
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;engine&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;handleHTTPRequest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;c1&#34;&gt;// å¤„ç†å®ŒæˆæŠŠcontextæ”¾å›å¤ç”¨æ± 
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;engine&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pool&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Put&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h1 id=&#34;è·¯ç”±&#34;&gt;è·¯ç”±&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;åœ¨ Gin æ¡†æ¶ä¸­ï¼Œè·¯ç”±è§„åˆ™è¢«åˆ†æˆäº†æœ€å¤š 9 æ£µå‰ç¼€æ ‘ï¼Œæ¯ä¸€ä¸ª HTTP Methodå¯¹åº”ä¸€æ£µã€Œå‰ç¼€æ ‘ã€ï¼Œæ ‘çš„èŠ‚ç‚¹æŒ‰ç…§ URL ä¸­çš„ / ç¬¦å·è¿›è¡Œå±‚çº§åˆ’åˆ†ï¼ŒURL æ”¯æŒ :name å½¢å¼çš„åç§°åŒ¹é…ï¼Œè¿˜æ”¯æŒ&lt;code&gt; *subpath&lt;/code&gt; å½¢å¼çš„è·¯å¾„é€šé…ç¬¦ã€‚&lt;/p&gt;
&lt;p&gt;æ¯ä¸ªèŠ‚ç‚¹éƒ½ä¼šæŒ‚ä¸€ç³»åˆ—çš„handlerç»„æˆçš„å¤„ç†é“¾æ¥å¤„ç†åŒ¹é…åˆ°çš„è¯·æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;ä¹‹æ‰€ä»¥è¦ä½¿ç”¨å‰ç¼€æ ‘ï¼Œæ˜¯ä¸ºäº†æ”¯æŒå¦‚&lt;code&gt;/hello/:name&lt;/code&gt;è¿™ç§åŠ¨æ€è·¯ç”±ï¼Œè·¯å¾„ä¸Šçš„æ¯ä¸€æ®µ&lt;code&gt;/{åå­—}&lt;/code&gt;ä½œä¸ºå‰ç¼€æ ‘çš„ä¸€ä¸ªèŠ‚ç‚¹ï¼Œé€šè¿‡æ ‘ç»“æ„æŸ¥è¯¢ï¼Œå¦‚æœä¸­é—´æŸä¸€å±‚èŠ‚ç‚¹ä¸åŒ¹é…ï¼Œåˆ™ç›´æ¥ç»“æŸæŸ¥è¯¢ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;48
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;49
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;50
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;51
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;52
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;53
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;54
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;55
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;56
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;57
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;58
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;59
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;60
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;61
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;62
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;63
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;64
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;65
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;66
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;67
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;68
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;69
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;70
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;71
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;72
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;73
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;74
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;75
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;76
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;77
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;78
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;79
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;80
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;81
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// engineä¸RouteäººGroupç›¸äº’æŒæœ‰çš„ç›®çš„æ˜¯ä¸ºäº†å®ç°åˆ†ç»„è·¯ç”±æ—¶ï¼Œæ³¨å†Œåˆ°åŒä¸€æ£µè·¯ç”±å‰ç¼€æ ‘
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// å¹¶ä¸”å¯ä»¥ä½¿å¾—ä¸­é—´ä»¶æ—¢å¯ä»¥æ³¨å†Œåœ¨å…¨è·¯å¾„ä¸Šï¼Œä¹Ÿå¯ä»¥æ³¨å†Œåœ¨åˆ†ç»„ä¸Š
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Engine&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
  &lt;span class=&#34;nx&#34;&gt;RouterGroup&lt;/span&gt;
  &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;RouterGroup&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
  &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
  &lt;span class=&#34;nx&#34;&gt;engine&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Engine&lt;/span&gt;
  &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;// ä¸Šé¢é‚£ä¸‰ç§è·¯ç”±æ³¨å†Œæ–¹å¼ï¼Œæœ€ç»ˆè°ƒç”¨çš„è¿˜æ˜¯RouterGroupçš„handleæ–¹æ³•
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// ç”±è¿™ä¸ªæ–¹æ³•ç”Ÿæˆå‰ç¼€æ ‘
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;group&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;RouterGroup&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;handle&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;httpMethod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;relativePath&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;handlers&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;HandlersChain&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;IRoutes&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// è§£æè·¯å¾„
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;absolutePath&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;group&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;calculateAbsolutePath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;relativePath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// ç»„è£…æˆhandlers chain
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;handlers&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;group&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;combineHandlers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;handlers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// æ„å»ºè·¯ç”±å‰ç¼€æ ‘
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;group&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;engine&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;addRoute&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;httpMethod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;absolutePath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;handlers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;group&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;returnObj&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;// å½“æ”¶åˆ°å®¢æˆ·ç«¯è¯·æ±‚æ—¶ï¼Œåœ¨å‰ç¼€æ ‘ç§æ‰¾åˆ°å¯¹åº”çš„è·¯ç”±handlerï¼Œå¤„ç†è¯·æ±‚
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;engine&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Engine&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;handleHTTPRequest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;httpMethod&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Request&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Method&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;rPath&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Request&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;URL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Path&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;unescape&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;engine&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;UseRawPath&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Request&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;URL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;RawPath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;rPath&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Request&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;URL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;RawPath&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;unescape&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;engine&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;UnescapePathValues&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;rPath&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;cleanPath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rPath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

	&lt;span class=&#34;c1&#34;&gt;// éå†æ‰€æœ‰http methodæ ‘ï¼Œæ‰¾åˆ°å¯¹åº”http methodçš„å‰ç¼€æ ‘ï¼Œè¿›è¡Œè·¯ç”±å‰ç¼€åŒ¹é…ï¼Œæ‰¾åˆ°å¯¹åº”çš„handler
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;t&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;engine&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;trees&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;tl&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;tl&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;].&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;method&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;httpMethod&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;continue&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;root&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;].&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;root&lt;/span&gt;
		&lt;span class=&#34;c1&#34;&gt;// è·å–å¯¹åº”çš„handler
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;nx&#34;&gt;value&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;root&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;getValue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rPath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Params&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;unescape&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;handlers&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;handlers&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;handlers&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Params&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;params&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;fullPath&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;fullPath&lt;/span&gt;
            &lt;span class=&#34;c1&#34;&gt;// æ‰§è¡Œhandleræ–¹æ³•
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;			&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Next&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;writermem&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;WriteHeaderNow&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;httpMethod&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;CONNECT&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rPath&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;/&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;tsr&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;engine&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;RedirectTrailingSlash&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
				&lt;span class=&#34;nf&#34;&gt;redirectTrailingSlash&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
				&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt;
			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;engine&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;RedirectFixedPath&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;redirectFixedPath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;root&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;engine&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;RedirectFixedPath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
				&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt;
			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;break&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;c1&#34;&gt;// æ‰¾ä¸åˆ°http methodå¯¹åº”çš„å‰ç¼€æ ‘ï¼Œä½¿ç”¨é»˜è®¤çš„405Handler
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;engine&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;HandleMethodNotAllowed&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;tree&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;range&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;engine&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;trees&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;tree&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;method&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;httpMethod&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
				&lt;span class=&#34;k&#34;&gt;continue&lt;/span&gt;
			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;value&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;tree&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;root&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;getValue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rPath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;unescape&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;handlers&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
				&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;handlers&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;engine&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;allNoMethod&lt;/span&gt;
				&lt;span class=&#34;nf&#34;&gt;serveError&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;StatusMethodNotAllowed&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;default405Body&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
				&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt;
			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// å³æ‰¾ä¸åˆ°http methodå¯¹åº”çš„å‰ç¼€æ ‘æˆ–pathï¼Œä½¿ç”¨é»˜è®¤çš„404handler
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;handlers&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;engine&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;allNoRoute&lt;/span&gt;
	&lt;span class=&#34;nf&#34;&gt;serveError&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;StatusNotFound&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;default404Body&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h1 id=&#34;ä¸­é—´ä»¶&#34;&gt;ä¸­é—´ä»¶&lt;/h1&gt;
&lt;p&gt;ginçš„ä¸­é—´ä»¶æŒ‡çš„æ˜¯handleræ–¹æ³•ï¼Œæ‰€æœ‰çš„ä¸­é—´ä»¶åŒ…æ‹¬è¯·æ±‚å¤„ç†çš„handleréƒ½è¦æ»¡è¶³è¿™ç§æ–¹æ³•ç­¾å:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;HandlerFunc&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;è·Ÿç€è·¯ç”±ä¸€èµ·æ³¨å†Œåï¼Œè°ƒç”¨&lt;code&gt;RouterGroup&lt;/code&gt;çš„&lt;code&gt;combineHandlers&lt;/code&gt;æ–¹æ³•ï¼Œå°†è¿™äº›handlerç»„æˆä¸€ä¸ª&lt;code&gt;HandlersChain&lt;/code&gt;ï¼Œæœ¬è´¨ä¸Šæ˜¯&lt;code&gt;[]HandlerFunc&lt;/code&gt;ï¼Œå½“è¯·æ±‚è¿›æ¥æ—¶ï¼Œé€šè¿‡è·¯å¾„æ‰¾åˆ°å¯¹åº”çš„&lt;code&gt;HandlersChain&lt;/code&gt;ï¼Œæ³¨å…¥åˆ°contextä¸­ï¼Œè°ƒç”¨Nextæ–¹æ³•å¤„ç†è¯·æ±‚ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;8
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// æ‰§è¡ŒHandlersChain
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Next&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;index&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;index&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;int8&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;handlers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;handlers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;index&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;](&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;index&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;åœ¨ginä¸­ï¼Œcontextçš„&lt;code&gt;Nextæ–¹æ³•&lt;/code&gt;æ˜¯ä¼šå¢åŠ &lt;code&gt;HandlersChain&lt;/code&gt;ç´¢å¼•å€¼ï¼Œæ‰§è¡Œä¸‹ä¸€ä¸ªæ–¹æ³•ï¼Œè€Œ&lt;code&gt;Abortæ–¹æ³•&lt;/code&gt;æ˜¯ç›´æ¥æ›´æ–°&lt;code&gt;HandlersChain&lt;/code&gt;ç´¢å¼•å€¼åˆ°ä¸€ä¸ªæ¯”è¾ƒå¤§çš„æ•°å­—ï¼Œä½¿å¾—å¾ªç¯è°ƒç”¨ç»“æŸï¼Œ Abort() æ–¹æ³•å¹¶ä¸æ˜¯é€šè¿‡ panic çš„æ–¹å¼ä¸­æ–­æ‰§è¡Œæµï¼Œæ‰§è¡Œ Abort() æ–¹æ³•ä¹‹åï¼Œå½“å‰å‡½æ•°å†…åé¢çš„ä»£ç é€»è¾‘è¿˜ä¼šç»§ç»­æ‰§è¡Œã€‚&lt;/p&gt;
&lt;p&gt;ginå°±æ˜¯é€šè¿‡contextçš„Nextæ–¹æ³•å’ŒAbortæ–¹æ³•ï¼Œä½¿å¾—æ‰§è¡Œ&lt;code&gt;HandlersChain&lt;/code&gt;æ–¹æ³•æ—¶å¯ä»¥åµŒå¥—æ‰§è¡Œï¼šå…ˆä»å‰å¾€åé¡ºåºæ‰§è¡Œ&lt;code&gt;HandlersChain&lt;/code&gt;ä¸­åœ¨Nextæ–¹æ³•å‰çš„é€»è¾‘ï¼Œç›´åˆ°æœ€åä¸€ä¸ªï¼Œç„¶åå†ä»åå¾€å‰æ‰§è¡ŒNextæ–¹æ³•åçš„é€»è¾‘ã€‚&lt;/p&gt;
&lt;h1 id=&#34;gincontext&#34;&gt;gin.Context&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;ä¸»è¦æ˜¯åŒ…è£…è¯·æ±‚&lt;code&gt;*http.Request&lt;/code&gt;ã€å“åº”&lt;code&gt;http.ResponseWriter&lt;/code&gt;ï¼Œè®©ç”¨æˆ·æ— éœ€çŸ¥é“å¤ªå¤šç»†èŠ‚ï¼Œæ¯”å¦‚æ¶ˆæ¯å¤´ã€æ¶ˆæ¯ä½“ã€çŠ¶æ€ç ï¼Œæ¶ˆæ¯ç±»å‹ç­‰ï¼Œç›´æ¥æä¾›ç°æˆåŒ…è£…å¥½çš„æ–¹æ³•æ¯”å¦‚&lt;code&gt;context.Json()&lt;/code&gt;ï¼›&lt;/li&gt;
&lt;li&gt;Context ä¼šéšç€æ¯ä¸€ä¸ªè¯·æ±‚çš„å‡ºç°è€Œäº§ç”Ÿï¼Œè¯·æ±‚çš„ç»“æŸè€Œé”€æ¯ï¼Œå’Œå½“å‰è¯·æ±‚å¼ºç›¸å…³çš„ä¿¡æ¯éƒ½åº”ç”± Context æ‰¿è½½ï¼Œæ¯”å¦‚åŠ¨æ€è·¯ç”±&lt;code&gt;/hello/:name&lt;/code&gt;ä¸­çš„nameå‚æ•°ï¼›&lt;/li&gt;
&lt;li&gt;ä¸ºå¤„ç†è¯·æ±‚çš„handleræ–¹æ³•æä¾›ç»Ÿä¸€çš„å…¥å‚ï¼Œä½¿å¾—contextå¯ä»¥æŒæœ‰å¤„ç†è¯·æ±‚çš„ä¸€ç³»åˆ—handleræ–¹æ³•ï¼Œå®ç°ä¸­é—´ä»¶å¤„ç†é€»è¾‘ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h1&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://geektutu.com/post/gee.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;æå®¢å…”å…” - Webæ¡†æ¶ - Gee&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://cloud.tencent.com/developer/article/1404356&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;è½»é‡çº§ Web æ¡†æ¶ Gin ç»“æ„åˆ†æ&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://cloud.tencent.com/developer/article/1877653?from=article.detail.1885821&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;gunæºç é˜…è¯»&lt;/a&gt;&lt;/p&gt;
</description>
        </item>
        <item>
        <title>MySQL</title>
        <link>http://nixum.cc/p/mysql/</link>
        <pubDate>Thu, 09 Jul 2020 00:00:00 +0000</pubDate>
        
        <guid>http://nixum.cc/p/mysql/</guid>
        <description>&lt;p&gt;[TOC]&lt;/p&gt;
&lt;h1 id=&#34;åŸºç¡€æ¶æ„&#34;&gt;åŸºç¡€æ¶æ„&lt;/h1&gt;
&lt;h2 id=&#34;mysqlé€»è¾‘æ¶æ„å›¾&#34;&gt;MySQLé€»è¾‘æ¶æ„å›¾&lt;/h2&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/MySQL%e9%80%bb%e8%be%91%e7%bb%93%e6%9e%84%e5%9b%be.jpg&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/MySQL%e9%80%bb%e8%be%91%e7%bb%93%e6%9e%84%e5%9b%be.jpg&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è¿æ¥å™¨ï¼šè´Ÿè´£è·Ÿå®¢æˆ·ç«¯å»ºç«‹è¿æ¥ã€è·å–æƒé™ã€ç»´æŒå’Œç®¡ç†è¿æ¥ã€‚ç™»å½•è¿›å»åä¿®æ”¹æƒé™ï¼Œé»˜è®¤æ˜¯å°†åœ¨ä¸‹ä¸€æ¬¡ç™»å½•åç”Ÿæ•ˆ&lt;/li&gt;
&lt;li&gt;æŸ¥è¯¢ç¼“å­˜ï¼šMySQLæ¥æ”¶åˆ°æŸ¥è¯¢è¯·æ±‚åä¼šå…ˆæŸ¥è¯¢ç¼“å­˜ï¼Œkeyæ˜¯æŸ¥è¯¢è¯­å¥ï¼Œvalueæ˜¯æŸ¥è¯¢ç»“æœï¼Œä¹‹åç»è¿‡æ‰§è¡Œå™¨çš„æƒé™åˆ¤æ–­å†è¿”å›ï¼Œå¦‚æœæŸ¥ä¸åˆ°åˆ™å¾€åèµ°ã€‚ä¸å»ºè®®ä½¿ç”¨ï¼Œå› ä¸ºè‹¥æœ‰æ›´æ–°æ“ä½œï¼Œä¼šåˆ é™¤å¯¹åº”è¡¨çš„ç¼“å­˜ï¼Œå¯èƒ½å¯¼è‡´ç¼“å­˜å‘½ä¸­ä½ï¼Œå¯ä»¥è®¾ç½®&lt;code&gt;query_cache_type=demand&lt;/code&gt;ï¼Œé»˜è®¤ä¸ä½¿ç”¨ç¼“å­˜ï¼Œéœ€è¦åœ¨æŸ¥è¯¢æ—¶æ˜¾ç¤ºæŒ‡å®šã€‚MySQL8.0åˆ é™¤æ­¤åŠŸèƒ½&lt;/li&gt;
&lt;li&gt;åˆ†æå™¨ï¼šå¯¹SQLè¯­å¥è¿›è¡Œåˆ†æï¼Œè¯æ³•åˆ†æåˆ¤æ–­å„ä¸ªå­—ç¬¦ä¸²ä»£è¡¨çš„å«ä¹‰ï¼ˆåŒ…æ‹¬åˆ—æ˜¯å¦å­˜åœ¨ï¼‰ï¼Œè¯­æ³•åˆ†æåˆ¤æ–­SQLçš„è¯­æ³•æ˜¯å¦æ­£ç¡®ï¼Œè¿™ä¸€å±‚æ“ä½œä¹‹åï¼ŒMySQLå°±çŸ¥é“ä½ è¦åšä»€ä¹ˆäº†&lt;/li&gt;
&lt;li&gt;ä¼˜åŒ–å™¨ï¼šå†³å®šæ˜¯å¦è¦ä½¿ç”¨ç´¢å¼•ï¼Œä½¿ç”¨å“ªä¸ªç´¢å¼•ï¼Œå†³å®šè¡¨çš„è¿æ¥é¡ºåº&lt;/li&gt;
&lt;li&gt;æ‰§è¡Œå™¨ï¼šå…ˆåˆ¤æ–­æ˜¯å¦æœ‰å¯¹è¯¥è¡¨çš„æ“ä½œæƒé™ï¼Œä¹‹ååˆ¤æ–­è¦ä½¿ç”¨å“ªä¸ªå¼•æ“æä¾›çš„æ¥å£&lt;/li&gt;
&lt;li&gt;å¼•æ“ï¼šå¯¹æ•°æ®è¿›è¡Œå…·ä½“æ“ä½œçš„æ‰§è¡Œè€…ï¼Œäº‹åŠ¡å’Œç´¢å¼•éƒ½æ˜¯åœ¨è¿™å±‚åšçš„ï¼Œä½†å…·ä½“éœ€è¦å¼•æ“æ”¯æŒï¼Œä¾‹å¦‚MyISAMä¸æ”¯æŒäº‹åŠ¡ï¼ŒInnoDBæ”¯æŒ&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;æ—¥å¿—ç³»ç»Ÿ&#34;&gt;æ—¥å¿—ç³»ç»Ÿ&lt;/h2&gt;
&lt;p&gt;å…³äºç‰©ç†æ—¥å¿—å’Œé€»è¾‘æ—¥å¿—ï¼šç‰©ç†æ—¥å¿—è®°å½•æ¯ä¸€ä¸ªpageå…·ä½“å­˜å‚¨çš„å€¼ï¼Œåœ¨è¿™ä¸ªæ•°æ®é¡µä¸Šåšäº†ä»€ä¹ˆä¿®æ”¹ï¼Œæ¯”å¦‚redo logï¼›è€Œé€»è¾‘æ—¥å¿—è®°å½•æ¯ä¸€ä¸ªpageä¸­æ•°æ®çš„å˜åŠ¨è¿‡ç¨‹ï¼Œæ¯”å¦‚undo logã€bin logã€relay logï¼›&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚ä¸€ä¸ªpageé¡µä¸­ä¸€ä¸ªæ•°æ®ä» 1 æ”¹åˆ° 2 ï¼Œå†æ”¹åˆ° 3ï¼Œç‰©ç†æ—¥å¿—è®°å½•æœ€åä¸€ä¸ªå€¼æ˜¯ 3 ï¼Œé€»è¾‘æ—¥å¿—è®°å½• 1 -&amp;gt; 2, 2-&amp;gt;3 çš„è¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;undo logå›æ»šæ—¥å¿—&lt;/strong&gt;ï¼šInnoDBç‹¬æœ‰ï¼Œé€»è¾‘æ—¥å¿—ï¼Œ&lt;strong&gt;ä¸»è¦ç”¨äºäº‹åŠ¡å¤±è´¥æ—¶çš„å›æ»šï¼Œä»¥åŠMVCCä¸­çš„ç‰ˆæœ¬æ•°æ®æŸ¥çœ‹&lt;/strong&gt;ã€‚å½“äº‹åŠ¡è¢«æäº¤åï¼Œå¹¶ä¸ä¼šé©¬ä¸Šè¢«åˆ é™¤ï¼Œè€Œæ˜¯æ”¾åˆ°å¾…æ¸…ç†é“¾ä¸­ï¼Œç­‰åˆ°æ²¡æœ‰äº‹åŠ¡ç”¨åˆ°è¯¥ç‰ˆæœ¬ä¿¡æ¯æ—¶æ‰å¯ä»¥æ¸…ç†ã€‚&lt;/p&gt;
&lt;p&gt;undo logå’Œæ•°æ®é¡µçš„åˆ·ç›˜ç­–ç•¥æ˜¯ä¸€æ ·çš„ï¼Œéƒ½éœ€è¦é€šè¿‡redo logä¿è¯æŒä¹…åŒ–ï¼ŒBuffer Poolä¸­ä¹Ÿæœ‰undo é¡µï¼Œå¯¹undoé¡µçš„ä¿®æ”¹ä¼šè®°å½•åˆ°redo logä¸­ï¼Œè·Ÿç€redo logåˆ·ç›˜ä¸€èµ·åˆ·ç›˜ï¼›&lt;/p&gt;
&lt;p&gt;åŒæ—¶ï¼Œå¦‚æœåœ¨å†…å­˜ä¸­ä¿®æ”¹undoé¡µï¼Œéœ€è¦æ›´æ–°è®°å½•å¯¹åº”çš„redo logã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;redo logé‡åšæ—¥å¿—&lt;/strong&gt;ï¼šInnoDBç‹¬æœ‰ï¼Œç‰©ç†æ—¥å¿—ï¼Œ&lt;strong&gt;è®°å½•è¿™ä¸ªé¡µåšäº†ä»€ä¹ˆæ”¹åŠ¨&lt;/strong&gt;ï¼Œæœ¬è´¨ä¸Šè®°å½•äº†å¯¹æŸä¸ªè¡¨ç©ºé—´çš„æŸä¸ªæ•°æ®é¡µçš„æŸä¸ªåç§»é‡ä¿®æ”¹äº†å“ªå‡ ä¸ªå­—èŠ‚çš„å€¼ï¼Œå…·ä½“ä¿®æ”¹çš„å€¼æ˜¯ä»€ä¹ˆï¼Œä¸€æ¡redo logä¹Ÿå°±å‡ ä¸ªå­—èŠ‚åˆ°åå‡ ä¸ªå­—èŠ‚ï¼Œæ ¼å¼æ˜¯ &lt;code&gt;æ—¥å¿—ç±»å‹ï¼Œè¡¨ç©ºé—´IDï¼Œæ•°æ®é¡µå·ï¼Œæ•°æ®é¡µåç§»é‡ï¼Œå…·ä½“ä¿®æ”¹çš„æ•°æ®&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨&lt;strong&gt;äºŒé˜¶æ®µæäº¤&lt;/strong&gt;ä¿è¯ä¸¤ä»½æ—¥å¿—é€»è¾‘ä¸€è‡´ã€‚å½“æœ‰æ—¥å¿—è¦å†™å…¥æ—¶ï¼Œå…ˆå†™åˆ°redo log bufferåçŠ¶æ€æ˜¯prepareï¼Œå¼€å§‹å†™bin log cacheï¼Œbin log å†™å®Œåï¼Œäº‹åŠ¡æäº¤ï¼Œredo log æ”¹ä¸ºcommitçŠ¶æ€ï¼Œredo logå†™å®Œï¼Œæ­¤æ—¶äº‹åŠ¡å°±ç®—å®Œæˆï¼›è¿™é‡Œæè¿°çš„å†™redo logå’Œbin logéƒ½åªå†™åœ¨äº†ç¼“å†²åŒºï¼Œä½•æ—¶å†™è¿›ç£ç›˜ï¼Œæ˜¯æ ¹æ®&lt;code&gt;innodb_flush_log_at_trx_commit&lt;/code&gt;å’Œ&lt;code&gt;sync_binlog&lt;/code&gt;é…ç½®å†³å®šï¼Œ&lt;strong&gt;ç”¨äºå®ç°æ•°æ®æŒä¹…åŒ–ï¼Œä»¥åŠå®•æœºæ¢å¤æ•°æ®ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ä¹‹æ‰€ä»¥è¦ä½¿ç”¨äºŒé˜¶æ®µæäº¤ï¼Œæ˜¯ä¸ºäº†ä¿è¯redo logå’Œbin logçš„æ•°æ®ä¸€è‡´æ€§ï¼Œ&lt;strong&gt;å¯¹äºå¤„äº prepare é˜¶æ®µçš„ redo logï¼Œå³å¯ä»¥æäº¤äº‹åŠ¡ï¼Œä¹Ÿå¯ä»¥å›æ»šäº‹åŠ¡ï¼Œè¿™å–å†³äºæ˜¯å¦èƒ½åœ¨ binlog ä¸­æŸ¥æ‰¾åˆ°ä¸ redo log ç›¸åŒçš„ XID&lt;/strong&gt;ï¼Œå¦‚æœæœ‰å°±æäº¤äº‹åŠ¡ï¼Œå¦‚æœæ²¡æœ‰å°±å›æ»šäº‹åŠ¡ï¼Œè¿™æ ·å°±å¯ä»¥ä¿è¯ redo log å’Œ binlog è¿™ä¸¤ä»½æ—¥å¿—çš„ä¸€è‡´æ€§ã€‚&lt;/p&gt;
&lt;p&gt;äºŒé˜¶æ®µæäº¤è™½ç„¶ä¿è¯äº†redo logå’Œbin logçš„æ•°æ®ä¸€è‡´æ€§ï¼Œä½†æ˜¯ä¼šæå‡ç£ç›˜IOçš„æ¬¡æ•°ï¼Œæ¯æ¬¡äº‹åŠ¡æäº¤éƒ½è¦åˆ·ä¸¤æ¬¡ç›˜ï¼Œä¸€æ¬¡redo logï¼Œä¸€æ¬¡bin logï¼›æ­¤å¤–ï¼Œä¸ºäº†ä¿è¯åœ¨å¤šäº‹åŠ¡åœºæ™¯ä¸‹ï¼Œä¸¤ä¸ªæ—¥å¿—æäº¤é¡ºåºä¸€è‡´ï¼Œè¿˜éœ€è¦é”æ¥ä¿è¯äº‹åŠ¡çš„é¡ºåºï¼Œå¯èƒ½å¯¼è‡´é”ç«äº‰æ¿€çƒˆã€‚&lt;/p&gt;
&lt;p&gt;åé¢å¼•å…¥äº†ç»„æäº¤æœºåˆ¶è§£å†³è¿™ä¸¤ä¸ªé—®é¢˜ï¼Œç»„æäº¤å°†commité˜¶æ®µæ‹†åˆ†æˆä¸‰ä¸ªé˜¶æ®µï¼Œå¹¶ä½¿ç”¨ä¸‰ä¸ªé˜Ÿåˆ—ï¼Œå½“æœ‰å¤šä¸ªäº‹åŠ¡æäº¤æ—¶ï¼Œä¼šå°†å¤šä¸ªbin log åˆ·ç›˜æ“ä½œåˆå¹¶æˆä¸€ä¸ªï¼Œä»è€Œå‡å°‘ç£ç›˜IOï¼Œè¯¥æœºåˆ¶åªé’ˆå¯¹commité˜¶æ®µã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;WALæœºåˆ¶&lt;/strong&gt;ï¼šæ‰§è¡Œäº‹åŠ¡æ—¶ï¼Œå°†è¡¨æ•°æ®å†™å…¥å†…å­˜å’Œæ—¥å¿—(redo log)ï¼Œäº‹åŠ¡å°±å®Œæˆäº†ï¼Œæ­¤æ—¶è¡¨æ•°æ®å¯èƒ½è¿˜æ²¡å†™å…¥ç£ç›˜ï¼ŒInnoDBä¼šåœ¨åˆé€‚çš„æ—¶æœºå°†å†…å­˜é‡Œçš„æ•°æ®ï¼ˆBuffer Poolé‡Œçš„è„é¡µï¼‰åˆ·å…¥ç£ç›˜ã€‚&lt;strong&gt;WALæœºåˆ¶ä¸»è¦æ˜¯è§£å†³è¡¨æ•°æ®å†™å…¥æ—¶ï¼ŒCPUå’Œç£ç›˜é€Ÿåº¦çš„å·®å¼‚é—®é¢˜&lt;/strong&gt;ï¼Œä¹Ÿå› ä¸ºæ˜¯å…ˆæŠŠæ•°æ®å†™è¿›å†…å­˜ï¼Œå†å†™å…¥ç£ç›˜ï¼Œæ‰éœ€è¦redo log + äºŒé˜¶æ®µæäº¤æ¥è§£å†³å´©æºƒæ•°æ®ä¸¢å¤±çš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨äº‹åŠ¡æäº¤æ—¶ï¼Œåªè¦å…ˆå°† redo log æŒä¹…åŒ–åˆ°ç£ç›˜å³å¯ï¼Œå¯ä»¥ä¸éœ€è¦ç­‰åˆ°å°†ç¼“å­˜åœ¨ Buffer Pool é‡Œçš„è„é¡µæ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;bin logå½’æ¡£æ—¥å¿—&lt;/strong&gt;ï¼šå±äºserverå±‚çš„æ—¥å¿—ï¼Œé€»è¾‘æ—¥å¿—ï¼Œ&lt;strong&gt;è®°å½•æ‰€æœ‰é€»è¾‘æ“ä½œ&lt;/strong&gt;ï¼Œè¿½åŠ å†™å…¥ï¼Œä¸ä¼šè¦†ç›–ä»¥å‰çš„æ—¥å¿—ã€‚bin logæœ‰ä¸¤ç§æ¨¡å¼ï¼šstatement æ ¼å¼çš„è¯æ˜¯è®°sqlè¯­å¥ï¼› rowæ ¼å¼ä¼šè®°å½•è¡Œçš„å†…å®¹ï¼Œä¸€èˆ¬ä½¿ç”¨rowï¼Œè®°å½•è¡Œå˜åŒ–å‰å’Œå˜åŒ–åçš„æ•°æ®ï¼Œç¼ºç‚¹æ˜¯æ—¥å¿—å˜å¤§ã€‚&lt;strong&gt;ç”¨äºä¸»ä»å¤åˆ¶å’Œæ•°æ®å¤‡ä»½æ¢å¤&lt;/strong&gt;ï¼›&lt;/p&gt;
&lt;p&gt;redo log prepareã€commit çš„XIDä¸bin logçš„XIDå®ç°å…³è”ï¼Œé€šè¿‡XIDçš„å…³è”ï¼Œå°±èƒ½çŸ¥é“ä¸¤ä»½æ—¥å¿—æ˜¯å¦å®Œæ•´ï¼Œä»è€Œå®ç°crash-safeã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;æ‰§è¡Œä¸€æ¡æ›´æ–°è¯­å¥çš„æ‰§è¡Œæµç¨‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;æ‰§è¡Œå™¨è´Ÿè´£å…·ä½“æ‰§è¡Œï¼Œ è°ƒç”¨å­˜å‚¨å¼•æ“çš„æ¥å£ï¼Œé€šè¿‡ä¸»é”®ç´¢å¼•æ‰¾åˆ°é‚£ä¸€è¡Œçš„è®°å½•ï¼Œå¦‚æœè¿™æ¡è®°å½•åœ¨Buffer Poolä¸­ï¼Œè¿”å›ç»™æ‰§è¡Œå™¨ï¼Œå¦‚æœä¸åœ¨Buffer Poolä¸­ï¼Œå°±ä»ç£ç›˜è¯»å…¥åˆ°Buffer Poolä¸­ï¼Œè¿”å›ç»™æ‰§è¡Œå™¨ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ‰§è¡Œå™¨æ‹¿åˆ°è®°å½•åï¼Œåˆ¤æ–­æ›´æ–°å‰åæ˜¯å¦ä¸€è‡´ï¼Œå¦‚æœä¸€è‡´ï¼Œå°±ä¸è¿›è¡Œåç»­æµç¨‹ç›´æ¥è¿”å›äº†ï¼›å¦‚æœä¸ä¸€è‡´ï¼Œå°±æŠŠæ›´æ–°å‰å’Œæ›´æ–°åçš„æ•°æ®ä¼ ç»™InnoDBï¼Œç”±å­˜å‚¨å¼•æ“æ‰§è¡ŒçœŸæ­£çš„æ›´æ–°æ“ä½œï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¼€å¯äº‹åŠ¡ï¼Œæ•°æ®ä¿®æ”¹å‰ï¼Œå…ˆæŠŠè€ç‰ˆæœ¬çš„æ•°æ®å†™å…¥undo logï¼Œundo logä¹Ÿä¼šå†™å…¥ Buffer Pool çš„undoé¡µä¸­ï¼Œå½“åœ¨å†…å­˜ä¸­ä¿®æ”¹è¯¥ undo é¡µï¼Œéœ€è¦æ›´æ–°è®°å½•å¯¹åº”çš„redo logï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;InnoDBå¼€å§‹æ›´æ–°è®°å½•ï¼Œæ›´æ–°Buffer Poolé‡Œè¯¥è¡Œçš„æ•°æ®ï¼ŒåŒæ—¶æ ‡è®°æˆè„é¡µï¼Œç„¶åæŠŠæ–°æ•°æ®å…ˆå†™è¿›redo log bufferï¼ŒçŠ¶æ€æ˜¯prepareï¼Œç„¶åæ˜¯å†™å…¥ bin log cacheï¼Œäº‹åŠ¡æäº¤ï¼Œredo logæ›´æ–°ä¸ºcommitçŠ¶æ€ï¼Œæ•´ä¸ªæ›´æ–°æ“ä½œå°±ç®—å®Œæˆã€‚æ•°æ®å†™å…¥Buffer Poolæ—¶ï¼Œä¸€æ¡è®°å½•å°±ç®—æ›´æ–°å®Œæˆäº†ï¼Œäº‹åŠ¡æäº¤ï¼Œä¸€æ¡æ›´æ–°è¯­å¥æ‰ç®—æ‰§è¡Œå®Œæˆï¼›ï¼ˆäºŒé˜¶æ®µæäº¤ï¼‰&lt;/p&gt;
&lt;p&gt;redo log å’Œ bin log éƒ½æ˜¯å…ˆå†™è¿›å¯¹åº”çš„cacheï¼Œå†åˆ·ç›˜ï¼Œæ‰€ä»¥ï¼Œå†™å…¥åˆ°å¯¹åº”çš„logæ–‡ä»¶ï¼Œå¹¶ä¸æ„å‘³ç€å†™å…¥äº†ç£ç›˜ï¼Œæ­¤æ—¶å¯èƒ½åªå†™å…¥åˆ°äº†æ“ä½œç³»ç»Ÿå†…æ ¸çš„Page Cacheï¼Œæ“ä½œç³»ç»Ÿå†åœ¨åˆé€‚çš„æ—¶æœºå†™å…¥ç£ç›˜ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å½“&lt;code&gt;innodb_flush_log_at_trx_commit=1&lt;/code&gt;å’Œ&lt;code&gt;sync_binlog=1&lt;/code&gt;æ—¶ï¼Œäº‹åŠ¡å®Œæ•´æäº¤å‰ï¼Œéœ€è¦åˆ·ä¸¤æ¬¡ç›˜ï¼Œä¸€æ¬¡ redo logï¼Œä¸€æ¬¡ bin logã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;innodb_flush_log_at_trx_commit&lt;/code&gt;åœ¨ä¸åŒå€¼çš„ä½œç”¨ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;=1&lt;/code&gt;ï¼šè¡¨ç¤ºæ¯æ¬¡äº‹åŠ¡å®Œæˆåï¼Œç«‹å³è°ƒä¸€æ¬¡ fsync æ–¹æ³•å°† redo log buffer ä¸­çš„æ•°æ®æŒä¹…åŒ–åˆ°Page Cacheï¼Œå†è°ƒç”¨ä¸€æ¬¡flush æ–¹æ³•æŒä¹…åŒ–åˆ°ç¡¬ç›˜ã€‚ï¼ˆå»ºè®®ï¼‰&lt;/li&gt;
&lt;li&gt;&lt;code&gt;=0&lt;/code&gt;ï¼šè¡¨ç¤ºæ¯ç§’è°ƒç”¨ fsync æ–¹æ³•å°† redo log buffer ä¸­çš„æ•°æ®æŒä¹…åŒ–åˆ°Page Cacheï¼Œå†è°ƒç”¨ flush åˆ·ç›˜ï¼Œæœºå™¨åœç”µæˆ–å´©æºƒå¯èƒ½ä¼šä¸¢å¤±ä¸€ç§’çš„æ•°æ®ï¼›&lt;/li&gt;
&lt;li&gt;&lt;code&gt;=2&lt;/code&gt;ï¼šè¡¨ç¤ºæ¯æ¬¡äº‹åŠ¡å®Œæˆåï¼Œç«‹å³è°ƒä¸€æ¬¡ fsync æ–¹æ³•å°† redo log buffer ä¸­çš„æ•°æ®å†™åˆ°Page Cacheï¼Œç„¶åæ¯ç§’è°ƒä¸€æ¬¡ flush æ–¹æ³•æŒä¹…åŒ–åˆ°ç¡¬ç›˜ï¼Œæœºå™¨åœç”µæˆ–æ“ä½œç³»ç»Ÿå´©æºƒå¯èƒ½ä¼šä¸¢å¤±ä¸€ç§’çš„æ•°æ®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;redo log bufferé»˜è®¤æ˜¯16MB&lt;/strong&gt;ï¼Œredo log æ•°æ®å†…å®¹æ˜¯è®°åœ¨ redo log block é‡Œçš„ï¼Œå†™æ»¡ä¸€ä¸ªå°±å­˜åˆ°redo log bufferé‡Œï¼Œç„¶åå†™ä¸‹ä¸€ä¸ªï¼Œç›´åˆ° buffer æ»¡äº†ï¼Œæ­¤æ—¶ä¼šå¼ºåˆ¶åˆ·ç›˜ã€‚&lt;/p&gt;
&lt;p&gt;redo log  æ˜¯å›ºå®šå¤§å°çš„ï¼Œæ¯”å¦‚æœ‰ä¸€ç»„4ä¸ªæ–‡ä»¶ç»„æˆçš„â€œç¯å½¢é˜Ÿåˆ—â€ï¼Œç¯å½¢å†™å…¥ï¼Œä¸€ä¸ªæ–‡ä»¶å†™å®Œå°±å†™ä¸‹ä¸€ä¸ªï¼Œ4ä¸ªè½®è½¬ï¼Œä½œç”¨æ˜¯redo logåˆ·ç›˜å®Œæˆä¹‹åè¿™éƒ¨åˆ†å†…å­˜å°±èƒ½é‡æ–°åˆ©ç”¨ï¼›é¦–ä½æŒ‡é’ˆè¡¨ç¤ºå½“å‰è®°å½•çš„ä½ç½®å’Œå½“å‰æ“¦é™¤ä½ç½®ã€‚å½“å‰æ“¦é™¤ä½ç½®æ˜¯ä¸€ä¸ªå« LSNï¼ˆlog sequence numberï¼‰çš„æ£€æŸ¥ç‚¹ï¼Œè¡¨ç¤ºåœ¨LSNä¹‹å‰çš„æ•°æ®ï¼ˆç¼“å†²æ± é‡Œçš„æ•°æ®é¡µã€ç´¢å¼•é¡µï¼‰éƒ½å·²ç»æŒä¹…åŒ–åˆ°ç£ç›˜äº†ï¼Œredo logæ–‡ä»¶é‡Œåœ¨LSNæ£€æŸ¥ç‚¹ä¹‹å‰çš„å†…å®¹æ‰å…è®¸è¢«è¦†ç›–ï¼Œæ“¦é™¤æˆ–è¦†ç›–ä¹‹å‰ä¸€å®šä¼šåˆ·åˆ°ç£ç›˜ã€‚&lt;/p&gt;
&lt;p&gt;redo log buffer é™¤æ­¤ä¹‹å¤–è¿˜æœ‰å‡ ç§åœºæ™¯ä¼šå¼ºåˆ¶å†™ç£ç›˜ï¼šredo log bufferæ»¡äº†ã€æ­£å¸¸å…³é—­æœåŠ¡å™¨ã€redo logç¯å½¢å†™å…¥åˆ°è¾¾check pointæ—¶ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;sync_binlog&lt;/code&gt; åœ¨ä¸åŒå€¼çš„ä½œç”¨ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;=1&lt;/code&gt;ï¼šè¡¨ç¤ºæ¯æ¬¡äº‹åŠ¡æäº¤åbin logéƒ½ä¼šæŒä¹…åŒ–åˆ°ç£ç›˜ï¼›(å»ºè®®)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;=0&lt;/code&gt;ï¼šè¡¨ç¤ºç”±ç³»ç»Ÿåˆ¤æ–­ä½•æ—¶åˆ·ç›˜ï¼›&lt;/li&gt;
&lt;li&gt;&lt;code&gt;=N&lt;/code&gt;ï¼Œè¡¨ç¤ºæ¯æ¬¡äº‹åŠ¡æäº¤éƒ½ä¼šå†™å…¥åˆ°Page Cahceï¼Œä½†æ˜¯ä¼šç´¯è®¡æäº¤ N ä¸ªäº‹åŠ¡åæ‰æŠŠbin logçš„æ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œä¸€èˆ¬è®¾ç½®èŒƒå›´æ˜¯100~1000ï¼Œå¯¹åº”çš„é£é™©æ˜¯ï¼Œå¦‚æœæœºå™¨å®•æœºï¼Œä¼šä¸¢å¤±æœ€è¿‘ N ä¸ªäº‹åŠ¡çš„bin logæ—¥å¿—ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;InnoDBåœ¨ç©ºé—²çš„æ—¶å€™æ‰çœŸæ­£çš„å°†Buffer Poolä¸­å·²æ›´æ–°çš„&lt;strong&gt;è¡¨æ•°æ®&lt;/strong&gt;åˆ·æ–°åˆ°å¯¹åº”çš„pageé¡µï¼Œå†™å…¥ç£ç›˜ä¸­ï¼Œæ­¤æ—¶æ•°æ®æ‰çœŸæ­£è½ç›˜ã€‚ï¼ˆWALæœºåˆ¶ï¼‰&lt;/p&gt;
&lt;p&gt;å› ä¸ºredo logæ ¼å¼å›ºå®šï¼Œå¯ä»¥é€šè¿‡redo log bufferå®ç°é¡ºåºå†™å…¥ç£ç›˜ï¼Œé¡ºåºIOå†™å…¥é€Ÿåº¦å¿«ï¼Œè€Œå°†è¡¨æ•°æ®å†™å…¥ç£ç›˜ï¼Œéœ€è¦æ›´æ–°redo logæ—¥å¿—ä¸­çš„å†…å®¹åˆ°è¡¨æ•°æ®å¯¹åº”çš„pageé¡µï¼Œæ¶‰åŠåˆ°åˆ†é¡µæˆ–åˆå¹¶ç­‰æ“ä½œï¼Œå±äºéšæœºIOå†™å…¥ï¼Œæ¯”è¾ƒè´¹æ—¶ï¼Œæ‰€ä»¥æ‰å…ˆå†™redo logæ—¥å¿—ï¼Œå†æŠŠè¡¨æ•°æ®å†™å…¥ç£ç›˜ã€‚è™½ç„¶WALæœºåˆ¶ä¹Ÿå®ç°äº†é¡ºåºå†™ï¼Œä½†æ˜¯å› ä¸ºå®ƒæ˜¯å…ˆå†™åœ¨å†…å­˜ï¼Œå­˜åœ¨ä¸¢å¤±é£é™©ï¼Œæ‰éœ€è¦redo logä¸€èµ·é…åˆï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;å…³äºå¥”æºƒæ¢å¤&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;å¯ä»¥&lt;strong&gt;åªä½¿ç”¨redo logæ¥å®ç°å´©æºƒæ¢å¤&lt;/strong&gt;ï¼Œä¿è¯æ¢å¤åä¸ä¼šå‡ºç°ä¸»ä»ä¸ä¸€è‡´çš„æƒ…å†µï¼Œç”±MySQLå†…éƒ¨å®ç°ï¼Œä½†æ— æ³•åªä½¿ç”¨bin logï¼ŒåŸå› æ˜¯ InnoDBä½¿ç”¨WALæœºåˆ¶ï¼Œå¦‚æœæ­¤æ—¶æ•°æ®åº“å´©æºƒï¼Œè¦ä¾èµ–æ—¥å¿—æ¥æ¢å¤æ•°æ®é¡µï¼Œä½†æ˜¯bin logå¹¶æ²¡æœ‰è®°å½•æ•°æ®é¡µçš„æ›´æ–°ç»†èŠ‚ï¼Œè€Œredo logå› ä¸ºç¯å½¢å†™å…¥çš„é—®é¢˜ï¼Œæ— æ³•å¯¹æ‰€æœ‰è®°å½•è¿›è¡Œå½’æ¡£ï¼Œä»…ä»…åªèƒ½å®ç°å´©æºƒæ¢å¤ï¼›&lt;/p&gt;
&lt;p&gt;å´©æºƒé‡å¯åï¼Œæ‰«æredo logæ–‡ä»¶ï¼Œå¦‚æœç¢°åˆ°prepareçŠ¶æ€çš„redo logï¼Œå°±ä¼šæ‹¿ç€å®ƒçš„ XIDï¼Œå»bin logé‡ŒæŸ¥è¯¢ï¼Œå¦‚æœbin logé‡Œèƒ½æ‰¾åˆ°ï¼Œå°±æäº¤äº‹åŠ¡ï¼Œå¦‚æœæ‰¾ä¸åˆ°ï¼Œå°±å›æ»šäº‹åŠ¡ï¼Œä»è€Œä¿è¯ redo log å’Œ binlog è¿™ä¸¤ä»½æ—¥å¿—çš„ä¸€è‡´æ€§ï¼›&lt;/p&gt;
&lt;p&gt;åªæœ‰å½“&lt;code&gt;innodb_flush_log_at_trx_commit=1&lt;/code&gt;å’Œ&lt;code&gt;sync_binlog=1&lt;/code&gt;ï¼Œæ•°æ®åº“æ‰å…·å¤‡crash-safeçš„èƒ½åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;å¤‡ä»½æ—¶é—´çš„é•¿çŸ­ä¼šå½±å“æ—¥å¿—æ–‡ä»¶çš„å¤§å°ï¼Œæ–‡ä»¶çš„å®Œæ•´æ€§ï¼Œä»è€Œå½±å“åˆ°æ¢å¤é€Ÿåº¦å’Œæ¢å¤æ•ˆæœï¼›&lt;/p&gt;
&lt;p&gt;å‚è€ƒï¼š&lt;a class=&#34;link&#34; href=&#34;https://zhuanlan.zhihu.com/p/133994414&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;MySQLä¸­çš„æ—¥å¿—æœºåˆ¶&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;å¸¸ç”¨sql&#34;&gt;å¸¸ç”¨SQL&lt;/h1&gt;
&lt;h2 id=&#34;æ›´æ–°&#34;&gt;æ›´æ–°&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;update è¡¨å set åˆ—å1=å€¼1, åˆ—å2=å€¼2... where åˆ—å3=å€¼3 &lt;/code&gt;&lt;/p&gt;
&lt;h2 id=&#34;æ’å…¥&#34;&gt;æ’å…¥&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;insert into è¡¨å (åˆ—å1, åˆ—å2, ...) values (å€¼1, å€¼2, ...)&lt;/code&gt;&lt;/p&gt;
&lt;h2 id=&#34;countcount1countåˆ—åŒºåˆ«&#34;&gt;Count(*)ã€Count(1)ã€Count([åˆ—])åŒºåˆ«&lt;/h2&gt;
&lt;p&gt;åœ¨count(*)ä¸å¸¦æ¡ä»¶åœ¨MyISAMé‡ŒæŸ¥è¯¢æ¯”è¾ƒå¿«ï¼Œå› ä¸ºMyISAMä¼šå­˜å‚¨æ€»æ¡æ•°ï¼Œä¸å¸¦æ¡ä»¶æŸ¥è¯¢çš„æ—¶å€™ç›´æ¥ç”¨å°±è¡Œï¼Œè€ŒInnoDBå¸¦äº†äº‹åŠ¡ï¼Œæ”¯æŒMVCCï¼Œå› æ­¤æ¯æ¬¡count(*)æ—¶éƒ½ä¼šæ‰«è¡¨&lt;/p&gt;
&lt;p&gt;ä»¥ä¸‹å½’çº³åŸºäºInnoDBï¼Œcountä¼šè¿”å›æ»¡è¶³æ¡ä»¶çš„ç»“æœé›†çš„æ€»è¡Œæ•°ï¼Œå®ƒä¼šä½¿ç”¨å­˜å‚¨å¼•æ“è¿›è¡Œå…¨è¡¨æ‰«æè·å–ç»“æœï¼Œæ¯”å¦‚count(1)ä¼šç›´æ¥è¿”å›1ï¼Œcount(ä¸»é”®)ä¼šè·å–ä¸»é”®ï¼Œè¿”å›ç»™serverå±‚ï¼Œç”±serverå±‚è¿›è¡Œè®¡æ•°ï¼Œå› æ­¤æŒ‰æ•ˆç‡æ’åºæ˜¯ï¼š&lt;code&gt;count(å­—æ®µ) &amp;lt; count(ä¸»é”®id) &amp;lt; count(1) â‰ˆ count(*)&lt;/code&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;countï¼ˆåˆ—ï¼‰ä¼šè®¡ç®—åˆ—æˆ–è¿™åˆ—çš„ç»„åˆä¸ä¸ºç©ºçš„è®¡æ•°ï¼›&lt;/li&gt;
&lt;li&gt;count(*) è·Ÿ count(1) çš„ç»“æœä¸€æ ·ï¼Œéƒ½åŒ…æ‹¬å¯¹NULLçš„ç»Ÿè®¡ï¼Œè€Œcount([åˆ—å]) æ˜¯ä¸åŒ…æ‹¬NULLçš„ç»Ÿè®¡ï¼›&lt;/li&gt;
&lt;li&gt;å¯¹äºè®¡æ•°ï¼Œä¹Ÿå¯ä»¥é€šè¿‡åˆ›å»ºåˆ—ä¸ºè¡¨åã€totalçš„è¡¨è¿›è¡Œè®¡æ•°ï¼Œåˆ©ç”¨äº‹åŠ¡èƒ½åŠ›ï¼Œä¸€èˆ¬æ˜¯å…ˆinsertå†updateï¼Œç†ç”±æ˜¯å¹¶å‘è¿›è¡Œtotalå€¼çš„æ›´æ–°æ—¶ï¼Œæ˜¯ä¼šä¸Šè¡Œé”çš„ï¼Œå¦‚æœå…ˆupdate totalå€¼å¯èƒ½ä¼šå¯¼è‡´äº‹åŠ¡å¤„ç†æ—¶é—´è¿‡é•¿ï¼›&lt;/li&gt;
&lt;li&gt;å¯¹äºå¤§è¡¨countï¼Œå¯ä»¥ä½¿ç”¨è¿‘ä¼¼å€¼ï¼Œæ¯”å¦‚ä½¿ç”¨ &lt;code&gt;show table status&lt;/code&gt; æˆ– &lt;code&gt;explain selectè¯­å¥&lt;/code&gt;æ¥æŸ¥è¯¢è¿‘ä¼¼å€¼ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;havingçš„ä½¿ç”¨&#34;&gt;havingçš„ä½¿ç”¨&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;havingä¸€èˆ¬éœ€è¦æ­é… group by ä½¿ç”¨ï¼Œåœ¨group byä¹‹åï¼Œorder byä¹‹å‰&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;havingä¸€èˆ¬é…åˆèšåˆå‡½æ•°ä½¿ç”¨ï¼Œè€Œwhereåé¢ä¸èƒ½åŠ èšåˆå‡½æ•°&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;whereæ˜¯å¯¹&lt;strong&gt;è¡¨çš„å­—æ®µ&lt;/strong&gt;è¿›è¡Œæ¡ä»¶è¿‡æ»¤ï¼Œhavingæ˜¯å¯¹&lt;strong&gt;selectå‡ºæ¥çš„å­—æ®µ&lt;/strong&gt;è¿›è¡Œæ¡ä»¶è¿‡æ»¤&lt;/p&gt;
&lt;p&gt;å¯ä»¥æƒ³æˆ æŸ¥è¯¢ä¸€äº›å­—æ®µï¼Œå…ˆé€šè¿‡whereè¿›è¡Œä¸€æ¬¡è¿‡æ»¤ï¼Œgroup byè¿›è¡Œä¸€æ¬¡åˆ†ç»„ï¼Œhavingå¯¹åˆ†ç»„åçš„ç»“æœå†è¿‡æ»¤ä¸€æ¬¡ï¼Œhavingåçš„å­—æ®µå¿…é¡»å‡ºç°åœ¨selectä¸­&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¸¸è§ä¸€ç‚¹çš„sqlï¼Œæ¯”å¦‚æœ‰å¦‚ä¸‹è¡¨ï¼Œè¿™é‡Œä¸ºäº†æ–¹ä¾¿ç†è§£ä»¥ä¸­æ–‡çš„å½¢å¼è¡¨ç¤ºå­—æ®µ&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;-----+--------Log------+------------+
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ç½‘ç«™åç§°&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ç‚¹å‡»æ•°&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;date&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;-----+---------+-------+------------+
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;       &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;A&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;10&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2016&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;05&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;10&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;       &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;C&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;60&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2016&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;05&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;13&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;       &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;A&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;230&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2016&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;05&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;14&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;       &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;B&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;45&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2016&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;05&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;14&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;       &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;E&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;545&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2016&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;05&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;14&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;6&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;       &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;D&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;13&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2016&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;05&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;15&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;7&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;       &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;C&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;105&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2016&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;05&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;15&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;8&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;       &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;E&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;660&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2016&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;05&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;16&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;9&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;       &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;C&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;301&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2016&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;05&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;17&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;-----+---------+-------+------------+
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;æŸ¥è¯¢ é™¤äº†Dç½‘ç«™å¤– å„ä¸ªç½‘ç«™çš„ç‚¹å‡»æ•° å¤§äº100 çš„ ç½‘ç«™åç§° å’Œ ç‚¹å‡»æ•° å¹¶ é™åº è¡¨ç¤º&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;k&#34;&gt;select&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ç½‘ç«™åç§°&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SUM&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ç‚¹å‡»æ•°&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;	&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;from&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Log&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;where&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ç½‘ç«™åç§°&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;D&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;   
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;group&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;by&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ç½‘ç«™åç§°&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;having&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SUM&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ç‚¹å‡»æ•°&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;100&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;order&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;by&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SUM&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ç‚¹å‡»æ•°&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id=&#34;order-by&#34;&gt;order by&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å…¨å­—æ®µæ’åº&lt;/strong&gt;ï¼šæŸ¥è¯¢æ¡ä»¶æ˜¯ç´¢å¼•ï¼Œä½†æ˜¯order by æ¡ä»¶ä¸æ˜¯ï¼Œä¼šå…ˆéå†ç´¢å¼•ï¼Œå†å›è¡¨å–å€¼ï¼Œæ¯æ¬¡å–åˆ°æ•°æ®å°±ä¸¢sort_bufferï¼Œå®Œäº†ä¹‹ååœ¨sort_bufferé‡Œæ ¹æ®order byæ¡ä»¶æ’åº ï¼ˆåˆ©ç”¨sort_buffer + ä¸´æ—¶è¡¨ï¼‰ï¼Œä¼šæ ¹æ®æ•°æ®é‡é‡‡ç”¨å†…å­˜æ’åºæˆ–è€…å¤–éƒ¨å½’å¹¶æ’åºï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;rowIdæ’åº&lt;/strong&gt;ï¼šå¦‚æœselectçš„å­—æ®µå¤ªå¤šï¼Œè¶…è¿‡è®¾ç½®çš„æœ€å¤§é•¿åº¦&lt;code&gt;max_length_for_sort_data&lt;/code&gt;ï¼Œå°±ä¼šåªå–ä¸»é”®å’Œorder byçš„æ¡ä»¶ä¸¢è¿›å»sort_bufferé‡Œè¿›è¡Œæ’åºï¼Œæœ€åå†å›è¡¨æ ¹æ®ä¸»é”®å–å‡ºå…¶ä»–selectçš„å­—æ®µï¼›&lt;/li&gt;
&lt;li&gt;å¦‚æœorder byçš„æ¡ä»¶æ­£å¥½æ˜¯ç´¢å¼•é¡ºåºï¼Œå°±ä¸éœ€è¦ä½¿ç”¨sort_bufferè¿›è¡Œæ’åºäº†ï¼Œç›´æ¥ä½¿ç”¨ç´¢å¼•é¡ºåºå³å¯ï¼›&lt;/li&gt;
&lt;li&gt;order by rand()ï¼Œéšæœºæ’åºï¼Œä½¿ç”¨å†…å­˜ä¸´æ—¶è¡¨ï¼Œä½¿ç”¨rowId + éšæœºæ•°è¿›è¡Œæ’åºï¼›&lt;/li&gt;
&lt;li&gt;ä¸å¸¦æŸ¥è¯¢æ¡ä»¶è¿›è¡Œorder byï¼Œå°±ç®—order byæ¡ä»¶æ˜¯ç´¢å¼•ï¼Œæ˜¯ä¸ä¸€å®šä¼šèµ°ç´¢å¼•è¿›è¡Œæ’åºï¼ŒåŸå› æ˜¯å¦‚æœMySQLä¼˜åŒ–å™¨åˆ¤æ–­èµ°ç´¢å¼•åè¦å»å›è¡¨æ•°é‡å¤ªå¤§ï¼Œå°±ä¸ä¼šèµ°ï¼›&lt;/li&gt;
&lt;li&gt;å¸¦limitçš„order byï¼Œmysqlä¼šé‡‡ç”¨å †æ’ï¼›&lt;/li&gt;
&lt;li&gt;é»˜è®¤çš„ä¸´æ—¶å†…å­˜è¡¨æ˜¯16Mï¼Œç”±&lt;code&gt;tmp_table_size&lt;/code&gt;è®¾ç½®ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;group-by&#34;&gt;group by&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;group byä¸€èˆ¬æ˜¯ä½¿ç”¨åœ¨select + èšåˆå‡½æ•°çš„æƒ…å†µï¼Œå¦‚æœselect æ²¡æœ‰èšåˆå‡½æ•°ï¼Œè¯­ä¹‰ï¼ˆå³æŒ‰ç…§group byåçš„å­—æ®µè¿›è¡Œåˆ†ç»„ï¼Œç›¸åŒçš„åˆ†ç»„åªè¿”å›ä¸€è¡Œï¼‰ä¸distinctæ˜¯ç±»ä¼¼çš„ï¼Œæ€§èƒ½ä¹Ÿä¸€æ ·&lt;/li&gt;
&lt;li&gt;SQLè¯­å¥çš„æ‰§è¡Œé¡ºåºæ˜¯ from &amp;gt; where &amp;gt; group by ï¼ having &amp;gt; order by &amp;gt; limitï¼Œjoin å’Œonå’Œandçš„ç»„åˆå±äºfromèŒƒå›´&lt;/li&gt;
&lt;li&gt;group byå®é™…ä¸Šä¼šè¿›è¡Œæ’åºæ“ä½œçš„ï¼Œå…ˆæ ¹æ®group byåçš„å­—æ®µè¿›è¡Œæ’åºï¼Œå†èšåˆï¼Œæœ€åselectå‡ºéœ€è¦çš„å­—æ®µè¿”å›ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¼šç”¨åˆ°å†…å­˜ä¸´æ—¶è¡¨(å¯èƒ½ä¼šé€€åŒ–ä¸ºç£ç›˜ä¸´æ—¶è¡¨)&lt;/li&gt;
&lt;li&gt;æ— æ³•è¿™æ ·ä½¿ç”¨select * from table group by column&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;distinct&#34;&gt;distinct&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;select distinct åˆ—1, åˆ—2 from ã€è¡¨åã€‘&lt;/code&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;distinct æ¥å¤šä¸ªåˆ—ï¼Œä¼šå¯¹å¤šä¸ªåˆ—çš„ä¸åŒç»„åˆéƒ½åˆ—å‡ºæ¥&lt;/li&gt;
&lt;li&gt;æ— æ³•è¿™æ ·ä½¿ç”¨&lt;code&gt;select åˆ—1, distinct åˆ—2 from ã€è¡¨åã€‘&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;join&#34;&gt;join&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ç”±äºæœ‰æ—¶ä¼˜åŒ–å™¨ä¼šé€‰æ‹©é”™è¯¯çš„é©±åŠ¨è¡¨ï¼Œä½¿ç”¨ &lt;strong&gt;straight_join&lt;/strong&gt; åˆ™å¯ä»¥è®©MySQL&lt;strong&gt;é»˜è®¤ä½¿ç”¨å·¦è¾¹çš„è¡¨ä½œä¸ºé©±åŠ¨è¡¨&lt;/strong&gt;ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;NLJç®—æ³•è¿›è¡Œjoinæ“ä½œ&lt;/strong&gt;ï¼šå½“æœ‰Aã€Bä¸¤è¡¨ï¼Œæ˜¯ä¸€ä¸ª1å¯¹1çš„å…³ç³»ï¼Œé€»è¾‘å¤–é”®åœ¨Bè¡¨å¸¦æœ‰ç´¢å¼•ï¼Œä½¿ç”¨joinè¿›è¡Œå…³è”æŸ¥è¯¢ï¼Œå°è¡¨é©±åŠ¨å¤§è¡¨(è¿™æ ·æ‰«æçš„è¡Œæ•°è¾ƒå°‘)ï¼Œæ¯æ‰«ä¸€è¡ŒBï¼Œé€šè¿‡å¤–é”®ç´¢å¼•ï¼Œåœ¨å¦ä¸€ä¸ªè¡¨Aæ‰¾å¯¹åº”çš„è¡Œæ•°æ®ï¼Œåˆå¹¶ï¼Œè¿”å›ï¼Œæ€»å…±æ‰§è¡Œ1æ¡è¯­å¥ï¼Œæ‰«ælen(A) + len(B) è¡Œã€‚ä½†æ˜¯å¦‚æœä¸ä½¿ç”¨joinæŸ¥ï¼Œè€Œæ˜¯å…ˆæŸ¥å‡ºBè¡¨æ‰€æœ‰æ•°æ®ï¼Œå†æ ¹æ®Bçš„idæŸ¥å›Açš„æ•°æ®ï¼Œè™½ç„¶æ‰«æçš„è¡Œæ•°ä¸€æ ·ï¼Œä½†æ˜¯å´æ‰§è¡Œäº†len(B) + 1æ¡SQLè¯­å¥ï¼Œæ˜¾ç„¶æ˜¯ä½¿ç”¨äº†joinçš„æ–¹å¼æ€§èƒ½å¼ºï¼Œå‰ææ˜¯Bä¸Šå¸¦äº†ç´¢å¼•ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;BNLç®—æ³•è¿›è¡Œjoinæ“ä½œ&lt;/strong&gt;ï¼šå¦‚æœBä¸Šå…³è”é”®æ²¡æœ‰ä½¿ç”¨ç´¢å¼•ï¼Œåˆ™ç®—æ³•æ˜¯è¿™æ ·çš„ï¼Œå…ˆå¯¹Bè¡¨è¿›è¡Œå…¨è¡¨æ‰«æå­˜è¿›å†…å­˜ï¼Œå†å¯¹Aè¡¨è¿›è¡Œå…¨è¡¨æ‰«æï¼Œæ¯æ‰«ä¸€è¡ŒAï¼Œå°±åœ¨å†…å­˜ï¼ˆjoin bufferï¼‰é‡Œçš„Bè¿›è¡ŒåŒ¹é…ï¼Œè¿”å›ï¼›å¦‚æœå†…å­˜å¤ªå°ï¼Œåˆ™åˆ†å—å¯¹è¡¨Bè¿›è¡ŒåŠ è½½ï¼Œå…¨è¡¨æ‰«æAï¼ŒåŒ¹é…åå°†ç»“æœé›†è¿”å›ï¼Œæ¸…ç©ºå†…å­˜ï¼Œå†åˆ†å—åŠ è½½å‰©ä¸‹çš„Bï¼Œå†æ¬¡å…¨è¡¨æ‰«æAï¼ŒåŒ¹é…è¿”å›ï¼Œå¾ªç¯å¤„ç†ï¼Œç›´è‡³è¡¨BåŠ è½½å®Œæˆã€‚åˆ†å—åŠ è½½ä¼šå¯¼è‡´é‡å¤æ‰«æè¡¨Aã€‚&lt;/p&gt;
&lt;p&gt;å¯¹BNLçš„ä¼˜åŒ–ï¼Œä¸€ç§æ˜¯åœ¨ä¸šåŠ¡ç«¯æŸ¥å›ä¸¤å¼ è¡¨çš„æ•°æ®ï¼Œåœ¨é€šè¿‡hashåŒ¹é…ç»„åˆï¼Œå¦ä¸€ç§æ˜¯æŸ¥joinæŸ¥è¯¢å‰ï¼Œå…ˆåˆ›å»ºä¸´æ—¶è¡¨ï¼Œåˆ›å»ºç´¢å¼•ï¼ŒæŸ¥è¯¢è¢«é©±åŠ¨è¡¨çš„æ•°æ®ï¼Œæ’å…¥ä¸´æ—¶è¡¨ä¸­ï¼Œä¸ä¸´æ—¶è¡¨è¿›è¡Œjoinæ“ä½œï¼Œå°†BNLè½¬ä¸ºNLJï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;é©±åŠ¨è¡¨èµ°å…¨è¡¨æ‰«æï¼Œè¢«é©±åŠ¨è¡¨æœ€å¥½èµ°ç´¢å¼•æ‰«æï¼Œä½¿ç”¨NLJç®—æ³•ï¼Œå¦‚æœè¢«é©±åŠ¨è¡¨æ˜¯å…¨è¡¨æ‰«æï¼Œåˆ™ä½¿ç”¨(S)BNLç®—æ³•ï¼›å³&lt;strong&gt;è¢«é©±åŠ¨è¡¨æœ‰ç´¢å¼•ï¼Œä½¿ç”¨NLJï¼Œè¢«é©±åŠ¨è¡¨æ²¡ç´¢å¼•ï¼Œä½¿ç”¨BNLï¼Œéƒ½æ˜¯ä¸ºäº†æ‰«ææ›´å°‘çš„è¡Œæ•°&lt;/strong&gt;ï¼›&lt;/p&gt;
&lt;p&gt;&lt;code&gt;select * from a join b on a.id=b.id&lt;/code&gt;ï¼ŒAæ˜¯é©±åŠ¨è¡¨ï¼ŒBæ˜¯è¢«é©±åŠ¨è¡¨ï¼›å¦‚æœæ˜¯ &lt;code&gt;select * from a, b on a.id=b.id&lt;/code&gt;ï¼Œåˆ™é©±åŠ¨è¡¨å’Œè¢«é©±åŠ¨è¡¨ç”±MySQLè‡ªå·±å†³å®šã€‚&lt;/p&gt;
&lt;p&gt;å°è¡¨é©±åŠ¨ï¼Œå°è¡¨æŒ‡çš„æ˜¯è¡Œæ•°ç›¸å¯¹å°‘ï¼Œæˆ–è€…selectæ—¶è¡¨çš„æ•°æ®é‡ç›¸å¯¹å°‘çš„è¡¨ï¼›&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ‰€ä»¥ï¼ŒNLJç®—æ³•æ˜¯ä»è¡¨Bæ¯æŸ¥ä¸€è¡Œå°±æ ¹æ®ç´¢å¼•å»è¡¨AåŒ¹é…ä¸€è¡Œï¼ŒMRRä¼˜åŒ–å°±æ˜¯åœ¨NLJåŸºç¡€ä¸Šï¼Œå›è¡¨çš„æ—¶å€™æ ¹æ®æœ‰åºçš„ç´¢å¼•ä¸€æ‰¹ä¸€æ‰¹æŸ¥ï¼Œè¿™æ ·å°±å¿«ä¸€ç‚¹ï¼›è€ŒBNLç®—æ³•æ˜¯åŒæ—¶å»æŸ¥è¡¨Aå’Œè¡¨Bçš„æ‰€æœ‰è¡Œï¼Œå†è¿›è¡ŒåŒ¹é…å…³è”&lt;/strong&gt;ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;left joinï¼Œä½¿ç”¨left joinæ—¶ï¼Œå·¦è¾¹çš„è¡¨ä¸ä¸€å®šæ˜¯é©±åŠ¨è¡¨ï¼Œå¦‚æœè¦ä½¿ç”¨left joinè¯­ä¹‰ï¼Œä¸èƒ½æŠŠè¢«é©±åŠ¨è¡¨çš„å­—æ®µæ”¾åœ¨whereæ¡ä»¶é‡Œåšç­‰å€¼å’Œä¸ç­‰å€¼åˆ¤æ–­ï¼Œå¿…é¡»æ”¾åœ¨oné‡Œï¼ŒåŸå› æ˜¯MySQLä¼šå…ˆç”¨onä½œä¸ºæ¡ä»¶è¿›è¡Œè¿‡æ»¤ï¼Œå®Œäº†æ‰ä½¿ç”¨whereè¿›è¡Œè¿‡æ»¤ï¼Œæ”¾åœ¨oné‡Œèƒ½è®©è¿‡æ»¤å‡ºæ¥çš„æ¡æ•°å°‘ï¼Œè¦æ³¨æ„ä¸¤è€…è¡¨è¾¾çš„è¯­ä¹‰è¿˜æ˜¯æœ‰äº›ä¸åŒçš„ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;dropdeleteä¸truncate&#34;&gt;dropã€deleteä¸truncate&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;deleteå’Œtruncateåªåˆ é™¤è¡¨æ•°æ®ä¸åˆ é™¤è¡¨ç»“æ„&lt;/li&gt;
&lt;li&gt;é€Ÿåº¦ä¸Š drop &amp;gt; truncate &amp;gt; delete&lt;/li&gt;
&lt;li&gt;dropå’Œtruncateæ˜¯ddlè¯­å¥ï¼Œæ“ä½œæ˜¯ç«‹å³ç”Ÿæ•ˆï¼ŒåŸæ•°æ®ä¸æ”¾åˆ°rollback segmentä¸­ï¼Œä¸èƒ½å›æ»šï¼Œè€Œdeleteæ˜¯dmlè¯­å¥ï¼Œè¯¥æ“ä½œä¼šæ”¾åœ¨rollback segmentä¸­ï¼Œäº‹åŠ¡æäº¤åæ‰ç”Ÿæ•ˆ&lt;/li&gt;
&lt;li&gt;ä¸éœ€è¦è¡¨æ—¶ä½¿ç”¨dropï¼Œåˆ é™¤æŸäº›è¡Œæ—¶ä½¿ç”¨deleteï¼Œä¿ç•™è¡¨ä½†æ¸…ç©ºè¡¨çš„æ•°æ®æ—¶ä½¿ç”¨truncate&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;limit&#34;&gt;Limit&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;limt M [offset N]&lt;/code&gt;ï¼Œä»ç¬¬Næ¡è®°å½•å¼€å§‹ï¼Œè¿”å›Mæ¡è®°å½•ï¼Œæ¯”å¦‚&lt;code&gt;limit 5, 10&lt;/code&gt;ï¼Œè¡¨ç¤ºè¿”å›6-15è¡Œ&lt;/li&gt;
&lt;li&gt;å½“limitåé¢åªè·Ÿä¸€ä¸ªå‚æ•°æ—¶ï¼Œè¡¨ç¤ºè¿”å›æœ€å¤§çš„è®°å½•è¡Œæ•°ç›®ï¼Œæ¯”å¦‚&lt;code&gt;limit 5&lt;/code&gt;ï¼Œè¡¨ç¤ºåªè¿”å›å‰5è¡Œ&lt;/li&gt;
&lt;li&gt;åˆå§‹åç§»é‡æ˜¯0&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;æ—¥æœŸç±»æŸ¥è¯¢&#34;&gt;æ—¥æœŸç±»æŸ¥è¯¢&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;curdate()å‡½æ•°ï¼šå¾—åˆ°ä»Šå¤©çš„æ—¥æœŸï¼Œæ ¼å¼ï¼š å¹´-æœˆ-æ—¥&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;now()å‡½æ•°ï¼šå¾—åˆ°ä»Šå¤©çš„æ—¥æœŸå’Œæ—¶é—´ï¼Œæ ¼å¼ï¼šå¹´-æœˆ-æ—¥ æ—¶:åˆ†:ç§’&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¸¤ä¸ªdatetimeç±»å‹çš„å­—æ®µç›¸å‡ï¼Œå¾—åˆ°çš„å•ä½è·Ÿæ—¥æœŸçš„æ ¼å¼æœ‰å…³ï¼Œå¦‚æœæ ¼å¼æœ‰åˆ°ç§’ï¼Œé‚£å‡å‡ºæ¥å°±æ˜¯å¤šå°‘ç§’ï¼Œå¦‚æœæ ¼å¼åªåˆ°æ—¥ï¼Œé‚£å‡å‡ºæ¥å°±æ˜¯å¤šå°‘æ—¥&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;UNIX_TIMESTAMP(datetimeç±»å‹çš„å­—æ®µ) å°†datetimeç±»å‹çš„å­—æ®µè½¬æ¢ä¸ºæ—¶é—´æˆ³ï¼Œè¦æ³¨æ„æ—¶é—´æˆ³æ˜¯ä»¥1970 å¹´ 1 æœˆ 1 æ—¥å¼€å§‹ç®—çš„&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;DATE_SUB(date, INTERVAL expr type) å‡½æ•°ï¼šä»æ—¥æœŸå‡å»æŒ‡å®šçš„æ—¶é—´é—´éš”&lt;/p&gt;
&lt;p&gt;date_format(dateå­—æ®µ, â€˜%Y%m%d %H:%i:%s&#39;) å‡½æ•°ï¼šæ—¥æœŸæ ¼å¼åŒ–å‡½æ•°ï¼Œ&lt;/p&gt;
&lt;p&gt;å¯ä»¥åˆ©ç”¨è¿™äº›æ¥æŸ¥è¯¢æœ€è¿‘å¤šå°‘å¤©çš„æ•°æ®å¦‚&lt;/p&gt;
&lt;p&gt;æŸ¥è¯¢ è¿‘ä¸€å°æ—¶çš„æ•°æ® where dateå­—æ®µ &amp;gt;= DATE_SUB(now(), INTERVAL 1 Hour) and dateå­—æ®µ &amp;lt; now()&lt;/p&gt;
&lt;p&gt;æŸ¥è¯¢ æ˜¨å¤©çš„æ•°æ® where dateå­—æ®µ &amp;gt;= DATE_SUB(CURDATE(), INTERVAL 1 Day) and dateå­—æ®µ &amp;lt; CURDATE()&lt;/p&gt;
&lt;p&gt;æŸ¥è¯¢ è¿‘7å¤©çš„æ•°æ® where dateå­—æ®µ &amp;gt;= DATE_SUB(CURDATE(), INTERVAL 7 Day)&lt;/p&gt;
&lt;p&gt;æŸ¥è¯¢ æœ¬æœˆçš„æ•°æ® where date_format(dateå­—æ®µ, â€˜%Y%m&#39;) = date_format(curdate() , â€˜%Y%m&#39;)&lt;/p&gt;
&lt;p&gt;æŸ¥è¯¢ ä¸Šä¸ªæœˆçš„æ•°æ® where period_diff(date_format(now() , â€˜%Y%m&#39;) , date_format(dateå­—æ®µ, â€˜%Y%m&#39;)) =1&lt;/p&gt;
&lt;p&gt;æŸ¥è¯¢ ä»Šå¹´çš„æ•°æ® where YEAR(dateå­—æ®µ)=YEAR(NOW())&lt;/p&gt;
&lt;p&gt;æŸ¥è¯¢ å»å¹´çš„æ•°æ®  where YEAR(dateå­—æ®µ)=year(date_sub(now(),interval 1 year))&lt;/p&gt;
&lt;p&gt;æŸ¥è¯¢æœ¬å­£å’Œä¸Šä¸€å­£çš„è·Ÿ æŸ¥å¹´çš„å·®ä¸å¤š ï¼ŒæŠŠ YEARå‡½æ•° æ¢æˆ QUARTERå‡½æ•° å³å¯&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;æ•°æ®ç±»å‹&#34;&gt;æ•°æ®ç±»å‹&lt;/h1&gt;
&lt;h2 id=&#34;varcharå’Œchar&#34;&gt;varcharå’Œchar&lt;/h2&gt;
&lt;p&gt;charæ˜¯å›ºå®šé•¿åº¦ï¼Œvarcharæ˜¯å¯å˜é•¿åº¦ï¼Œvarchar(50)å’Œvarchar(200)å­˜å‚¨å­—ç¬¦ä¸² â€œhelloâ€ æ‰€å ç©ºé—´ä¸€æ ·ï¼Œä½†åè€…åœ¨æ’åºæ—¶ä¼šæ¶ˆè€—æ›´å¤šå†…å­˜ï¼Œå› ä¸ºorder byé‡‡ç”¨fixed_lengthè®¡ç®—å­—æ®µé•¿åº¦ã€‚&lt;/p&gt;
&lt;p&gt;MySQLä¸­é™¤äº†TEXTã€BLOBså¤–ï¼Œå…¶ä»–æ‰€æœ‰åˆ—å ç”¨çš„å­—èŠ‚é•¿åº¦åŠ èµ·æ¥ä¸èƒ½è¶…è¿‡65535ä¸ªå­—èŠ‚ï¼Œå³ä¸€è¡Œçš„é•¿åº¦ä¸ä¼šè¶…è¿‡65535å­—èŠ‚ï¼Œ64kbï¼›å…¬å¼ï¼š&lt;code&gt;å¦‚æœæœ‰å¤šä¸ªå­—æ®µçš„è¯ï¼Œè¦ä¿è¯æ‰€æœ‰å­—æ®µçš„é•¿åº¦ + å˜é•¿å­—æ®µå­—èŠ‚æ•°åˆ—è¡¨æ‰€å ç”¨çš„å­—èŠ‚æ•° + NULLå€¼åˆ—è¡¨æ‰€å ç”¨çš„å­—èŠ‚æ•° &amp;lt;= 65535å­—èŠ‚&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;varchar(n)ä¸­çš„nä»£è¡¨æœ€å¤šèƒ½å­˜å‚¨çš„å­—ç¬¦æ•°é‡ï¼Œå¹¶ä¸æ˜¯å­—èŠ‚å¤§å°ï¼Œæ‰€ä»¥è¿˜è¦çœ‹æ•°æ®åº“çš„å­—ç¬¦é›†ç”¨çš„æ˜¯ä¸Šé¢ç¼–ç &lt;/p&gt;
&lt;h2 id=&#34;intå’Œint20&#34;&gt;intå’Œint(20)&lt;/h2&gt;
&lt;p&gt;æœ‰ç¬¦å·çš„æ•´å‹èŒƒå›´æ˜¯-2147483648~2147483647ï¼›æ— ç¬¦å·çš„æ•´å‹èŒƒå›´æ˜¯0~4294967295ï¼›&lt;/p&gt;
&lt;p&gt;int(20)è¡¨ç¤ºèƒ½æ˜¾ç¤ºçš„å®½åº¦æ˜¯20ï¼Œæ¯”å¦‚idçš„å€¼æ˜¯10ï¼Œé‚£MySQLå°±ä¼šåœ¨å‰é¢åŠ 0ï¼Œè‡ªåŠ¨è¡¥å…¨åˆ°20ä½ï¼Œä»ç„¶å 4ä¸ªå­—èŠ‚å­˜å‚¨ï¼Œå­˜å‚¨èŒƒå›´ä¹Ÿä¸å˜ã€‚&lt;/p&gt;
&lt;h2 id=&#34;datetime&#34;&gt;Datetime&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;ä¿å­˜ä» 1001 å¹´åˆ° 9999 å¹´çš„æ—¥æœŸå’Œæ—¶é—´ï¼Œç²¾åº¦ä¸ºç§’ï¼Œä½¿ç”¨ 8 å­—èŠ‚çš„å­˜å‚¨ç©ºé—´&lt;/li&gt;
&lt;li&gt;ä¸æ—¶åŒºæ— å…³&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;timestamp&#34;&gt;TimeStamp&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å’Œ UNIX æ—¶é—´æˆ³ç›¸åŒï¼Œä¿å­˜ä» 1970 å¹´ 1 æœˆ 1 æ—¥åˆå¤œï¼ˆæ ¼æ—å¨æ²»æ—¶é—´ï¼‰ä»¥æ¥çš„ç§’æ•°ï¼Œä½¿ç”¨ 4 ä¸ªå­—èŠ‚ï¼Œåªèƒ½è¡¨ç¤ºä» 1970 å¹´åˆ° 2038 å¹´&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å®ƒå’Œæ—¶åŒºæœ‰å…³ï¼Œæ¯ä¸ªæ—¶é—´æˆ³åœ¨ä¸åŒæ—¶åŒºæ‰€ä»£è¡¨çš„å…·ä½“æ—¶é—´ä¸åŒ&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœæ’å…¥æ—¶æ²¡æœ‰æŒ‡å®š TIMESTAMP åˆ—çš„å€¼ï¼Œä¼šå°†è¿™ä¸ªå€¼è®¾ç½®ä¸ºå½“å‰æ—¶é—´&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;MySQL æä¾›äº† FROM_UNIXTIME() å‡½æ•°æŠŠ UNIX æ—¶é—´æˆ³è½¬æ¢ä¸ºæ—¥æœŸï¼Œ&lt;/p&gt;
&lt;p&gt;æä¾›äº† UNIX_TIMESTAMP() å‡½æ•°æŠŠæ—¥æœŸè½¬æ¢ä¸º UNIX æ—¶é—´æˆ³&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;null&#34;&gt;NULL&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;NULLè·Ÿä»»ä½•å€¼æ‰§è¡Œç­‰å€¼åˆ¤æ–­å’Œä¸ç­‰å€¼åˆ¤æ–­çš„ç»“æœéƒ½æ˜¯NULL&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;å­˜å‚¨ç»“æ„&#34;&gt;å­˜å‚¨ç»“æ„&lt;/h1&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/MySQL%e8%a1%a8%e7%a9%ba%e9%97%b4%e7%bb%93%e6%9e%84.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/MySQL%e8%a1%a8%e7%a9%ba%e9%97%b4%e7%bb%93%e6%9e%84.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;è®°å½•æ˜¯æŒ‰ç…§è¡Œæ¥å­˜å‚¨çš„ï¼Œä½†æ˜¯æ•°æ®åº“çš„è¯»å–å¹¶ä¸ä»¥è¡Œä¸ºå•ä½ï¼Œå¦åˆ™ä¸€æ¬¡è¯»å–ï¼ˆä¹Ÿå°±æ˜¯ä¸€æ¬¡I/Oæ“ä½œï¼‰åªèƒ½å¤„ç†ä¸€è¡Œæ•°æ®ï¼Œæ•ˆç‡ä¼šéå¸¸ä½ã€‚å› æ­¤InnoDBå°†æ•°æ®åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªé¡µé¢ï¼Œä¸è®ºè¯»ä¸€è¡Œï¼Œè¿˜æ˜¯è¯»å¤šè¡Œï¼Œéƒ½æ˜¯å°†è¿™äº›è¡Œæ‰€åœ¨çš„é¡µè¿›è¡ŒåŠ è½½ã€‚å³ æ•°æ®åº“ç®¡ç†å­˜å‚¨ç©ºé—´çš„åŸºæœ¬å•ä½æ˜¯é¡µï¼ˆPageï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;B+æ ‘å¶å­èŠ‚ç‚¹ï¼ŒåŒå‘é“¾è¡¨ï¼Œå¶å­èŠ‚ç‚¹ï¼Œä»¥åŠæ•°æ®é¡µçš„æ ¼å¼ï¼ŒUser Recordsä»Free Spaceé‡Œè½¬æ¢è€Œæ¥ï¼Œå½“Free Spaceç”¨å®Œï¼Œå°±ä¼šåˆ›å»ºä¸‹ä¸€é¡µï¼›&lt;/p&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/%e6%95%b0%e6%8d%ae%e9%a1%b5%e5%ad%98%e5%82%a8%e7%bb%93%e6%9e%84.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/%e6%95%b0%e6%8d%ae%e9%a1%b5%e5%ad%98%e5%82%a8%e7%bb%93%e6%9e%84.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;ç´¢å¼•é¡µï¼Œå³éå¶å­èŠ‚ç‚¹ä¹Ÿæ˜¯ç±»ä¼¼ä¸Šé¢çš„ç»“æ„ï¼Œåªæ˜¯è¡Œè®°å½•é‚£é‡Œå­˜çš„æ˜¯æŒ‡å‘ä¸‹ä¸€å±‚é¡µçš„æŒ‡é’ˆï¼Œè€Œä¸æ˜¯å…·ä½“çš„è¡Œæ•°æ®ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€ä¸ªé¡µä¸­å¯ä»¥å­˜å‚¨å¤šä¸ªè¡Œè®°å½•ï¼ˆRowï¼‰ï¼ŒåŒæ—¶åœ¨æ•°æ®åº“ä¸­ï¼Œè¿˜å­˜åœ¨ç€åŒºï¼ˆExtentï¼‰ã€æ®µï¼ˆSegmentï¼‰å’Œè¡¨ç©ºé—´ï¼ˆTablespaceï¼‰ã€‚å¤§å°æ’åºä¸åŒ…å«å…³ç³»ï¼šè¡Œ -&amp;gt; é¡µ -&amp;gt; åŒº -&amp;gt; æ®µ -&amp;gt; è¡¨ç©ºé—´ã€‚&lt;/p&gt;
&lt;p&gt;é¡µï¼ˆPageï¼‰æ˜¯åŸºæœ¬çš„å­˜å‚¨å•ä½ï¼ŒæŒ‰ç±»å‹åˆ†å¯åˆ†ä¸º æ•°æ®é¡µï¼ˆB+æ ‘èŠ‚ç‚¹ï¼Œé“¾è¡¨ç»“æ„ï¼Œé€»è¾‘ä¸Šè¿ç»­ï¼‰ã€ç³»ç»Ÿé¡µã€Undoé¡µå’Œäº‹åŠ¡æ•°æ®é¡µç­‰ï¼Œæ¯ä¸ªé¡µé»˜è®¤å¤§å°æ˜¯16KBã€‚æ„å‘³ç€æ•°æ®å—æ¯æ¬¡è¯»å†™éƒ½æ˜¯ä»¥16KBä¸ºå•ä½ã€‚&lt;/p&gt;
&lt;p&gt;åŒºï¼ˆExtentï¼‰æ˜¯æ¯”é¡µå¤§ä¸€çº§çš„å­˜å‚¨ç»“æ„ï¼Œåœ¨InnoDBå­˜å‚¨å¼•æ“ä¸­ï¼Œä¸€ä¸ªåŒºä¼šåˆ†é…64ä¸ªè¿ç»­çš„é¡µã€‚å› ä¸ºInnoDBä¸­çš„é¡µå¤§å°é»˜è®¤æ˜¯16KBï¼Œæ‰€ä»¥ä¸€ä¸ªåŒºçš„å¤§å°æ˜¯64*16KB=1MBã€‚ä¼ ç»Ÿé“¾è¡¨æ¯ä¸ªç›¸é‚»èŠ‚ç‚¹çš„ç‰©ç†ä½ç½®å¹¶ä¸ä¸€å®šæ˜¯è¿ç»­çš„ï¼ŒMySQLä¸ºäº†èƒ½å¤Ÿé¡ºåºIOï¼Œå°±é€šè¿‡åŒºæ¥å®ç°ï¼Œå½“è¡¨ä¸­æ•°æ®é‡å¤§çš„æ—¶å€™ï¼Œä¸ºæŸä¸ªç´¢å¼•åˆ†é…ç©ºé—´ä¸å†ä»¥é¡µä¸ºå•ä½åˆ†é…ï¼Œè€Œæ˜¯æŒ‰ç…§åŒºï¼Œæ¯ä¸ªåŒºå¤§å°ä¸º1MBï¼Œå¯¹äº16KBçš„é¡µæ¥è¯´ï¼Œè¿ç»­çš„64ä¸ªé¡µä¼šè¢«åˆ’åˆ†ä¸ºä¸€ä¸ªåŒºï¼Œä½¿å¾—é“¾è¡¨ä¸­ç›¸é‚»çš„é¡µçš„ç‰©ç†ä½ç½®é¡µç›¸é‚»ï¼Œå³B+æ ‘å¶å­èŠ‚ç‚¹é“¾è¡¨ç›¸é‚»çš„é¡µçš„ç‰©ç†ä½ç½®ç›¸é‚»ï¼Œèƒ½å¤Ÿé¡ºåºIOï¼›&lt;/p&gt;
&lt;p&gt;æ®µï¼ˆSegmentï¼‰ç”±ä¸€ä¸ªæˆ–å¤šä¸ªåŒºç»„æˆï¼ŒåŒºåœ¨æ–‡ä»¶ç³»ç»Ÿæ˜¯ä¸€ä¸ªè¿ç»­åˆ†é…çš„ç©ºé—´ï¼ˆåœ¨InnoDBä¸­æ˜¯è¿ç»­çš„64ä¸ªé¡µï¼‰ï¼Œä¸è¿‡åœ¨æ®µä¸­ä¸è¦æ±‚åŒºä¸åŒºä¹‹é—´æ˜¯ç›¸é‚»çš„ã€‚æ®µæ˜¯æ•°æ®åº“ä¸­çš„åˆ†é…å•ä½ï¼Œä¸åŒç±»å‹çš„æ•°æ®åº“å¯¹è±¡ä»¥ä¸åŒçš„æ®µå½¢å¼å­˜åœ¨ã€‚ç´¢å¼•æ®µï¼Œå­˜æ”¾B+æ ‘çš„éå¶å­èŠ‚ç‚¹çš„åŒºé›†åˆï¼›æ•°æ®æ®µï¼Œå­˜æ”¾B+æ ‘å¶å­èŠ‚ç‚¹çš„åŒºé›†åˆï¼›å›æ»šæ®µï¼Œå­˜æ”¾å›æ»šæ•°æ®çš„åŒºé›†åˆï¼›&lt;/p&gt;
&lt;p&gt;è¡¨ç©ºé—´ï¼ˆTablespaceï¼‰æ˜¯ä¸€ä¸ªé€»è¾‘å®¹å™¨ï¼Œè¡¨ç©ºé—´å­˜å‚¨çš„å¯¹è±¡æ˜¯æ®µï¼Œåœ¨ä¸€ä¸ªè¡¨ç©ºé—´ä¸­å¯ä»¥æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªæ®µï¼Œä½†æ˜¯ä¸€ä¸ªæ®µåªèƒ½å±äºä¸€ä¸ªè¡¨ç©ºé—´ã€‚æ•°æ®åº“ç”±ä¸€ä¸ªæˆ–å¤šä¸ªè¡¨ç©ºé—´ç»„æˆï¼Œè¡¨ç©ºé—´ä»ç®¡ç†ä¸Šå¯ä»¥åˆ’åˆ†ä¸ºç³»ç»Ÿè¡¨ç©ºé—´ã€ç”¨æˆ·è¡¨ç©ºé—´ã€æ’¤é”€è¡¨ç©ºé—´ã€ä¸´æ—¶è¡¨ç©ºé—´ç­‰ã€‚å¯¹åº”çš„æ–‡ä»¶æ˜¯ [è¡¨å].ibd çš„æ–‡ä»¶ï¼Œåœ¨è¿™ä¸ªæ–‡ä»¶é‡Œï¼Œä¼šè¢«åˆ†æˆå¾ˆå¤šæ•°æ®é¡µï¼Œæ¯ä¸€ä»½æ˜¯16Kã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;è¡Œæ ¼å¼&#34;&gt;è¡Œæ ¼å¼&lt;/h2&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/MySQL%e8%a1%8c%e6%a0%bc%e5%bc%8fCompact%e6%a0%bc%e5%bc%8f.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/MySQL%e8%a1%8c%e6%a0%bc%e5%bc%8fCompact%e6%a0%bc%e5%bc%8f.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;è®°å½•çš„é¢å¤–ä¿¡æ¯&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨ï¼šå­˜å‚¨æ•°æ®çš„æ—¶å€™ï¼Œä¹Ÿè¦æŠŠæ•°æ®å ç”¨çš„å¤§å°å­˜èµ·æ¥ï¼Œå­˜åˆ°ã€Œå˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨ã€é‡Œé¢ï¼Œè¯»å–æ•°æ®çš„æ—¶å€™æ‰èƒ½æ ¹æ®è¿™ä¸ªã€Œå˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨ã€å»è¯»å–å¯¹åº”é•¿åº¦çš„æ•°æ®ï¼ŒæŒ‰ç…§åˆ—çš„é¡ºåºé€†åºå°†åˆ—çš„é•¿åº¦å­˜å‚¨åˆ°è¿™ä¸ªå­—æ®µé‡Œï¼›å­—æ®µå¦‚æœæ˜¯NULLå€¼ä¸ä¼šå­˜åœ¨è¿™ï¼›&lt;/p&gt;
&lt;p&gt;ä¹‹æ‰€ä»¥è¦é€†åºå­˜æ”¾ï¼Œå¯ä»¥ä½¿å¾—ä½ç½®é å‰çš„è®°å½•çš„çœŸå®æ•°æ®å’Œæ•°æ®å¯¹åº”çš„å­—æ®µé•¿åº¦ä¿¡æ¯å¯ä»¥åŒæ—¶æ”¾åˆ°CPU Cache Lineé‡Œï¼Œæé«˜CPU Cache çš„å‘½ä¸­ç‡ï¼›&lt;/p&gt;
&lt;p&gt;å½“æ•°æ®è¡¨çš„å­—æ®µæ²¡æœ‰å˜é•¿å­—æ®µæ—¶ï¼Œè¡Œæ ¼å¼é‡Œå°±ä¸ä¼šè®°å½• å˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨ äº†&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;NULLå€¼åˆ—è¡¨ï¼šè‡³å°‘ä¸€ä¸ªå­—èŠ‚ï¼Œè·Ÿåˆ—çš„æ•°é‡æœ‰å…³ï¼Œæ¯”å¦‚å¦‚æœæ˜¯9ä¸ªåˆ—ï¼Œé‚£å°±æ˜¯ä¸¤ä¸ªå­—èŠ‚ï¼›è¯¥å­—æ®µä¼šè®°å½•è¯¥è¡Œæ‰€æœ‰åˆ—æ˜¯å¦æ˜¯NULLå€¼ï¼Œä»¥äºŒè¿›åˆ¶ä½æŒ‰åˆ—çš„é¡ºåºé€†åºæ’åˆ—ï¼ŒäºŒè¿›åˆ¶ä½=1ï¼Œè¡¨ç¤ºNULLï¼Œ=0è¡¨ç¤ºä¸ä¸ºNULLï¼Œåˆ—çš„æ•°é‡ä¸è¶³çš„ï¼Œé«˜ä½è¡¥é›¶ã€‚&lt;/p&gt;
&lt;p&gt;å½“æ•°æ®è¡¨çš„å­—æ®µéƒ½å®šä¹‰æˆNOT NULLæ—¶ï¼Œè¡Œæ ¼å¼é‡Œå°±ä¸ä¼šè®°å½• NULLå€¼åˆ—è¡¨ äº†ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è®°å½•å¤´ä¿¡æ¯ï¼šåªåˆ—ä¸¾é‡è¦çš„ï¼Œæ¯”å¦‚ delete_maskï¼Œæ ‡è¯†æ­¤æ¡è®°å½•æ˜¯å¦è¢«åˆ é™¤ï¼›next_recordï¼ŒæŒ‡å‘ä¸‹ä¸€æ¡è®°å½•çš„æŒ‡é’ˆï¼ˆè®°å½•ä¸è®°å½•ä¹‹é—´æ˜¯é“¾è¡¨ï¼Œä¸‹ä¸€æ¡è®°å½•çš„ã€Œè®°å½•å¤´ä¿¡æ¯ã€å’Œã€ŒçœŸå®æ•°æ®ã€ä¹‹é—´çš„ä½ç½®ï¼‰ï¼›record_typeï¼Œå½“å‰è®°å½•çš„ç±»å‹ï¼Œ0è¡¨ç¤ºæ™®é€šè®°å½•ï¼Œ1è¡¨ç¤ºB+æ ‘éå¶å­èŠ‚ç‚¹è®°å½•ï¼Œ2è¡¨ç¤ºæœ€å°è®°å½•ï¼Œ3è¡¨ç¤ºæœ€å¤§è®°å½•ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è®°å½•çš„çœŸå®æ•°æ®&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;row_idï¼šå½“è¡¨æ²¡æŒ‡å®šä¸»é”®æ—¶ï¼Œä¸”ä¹Ÿæ²¡æœ‰ä¸åŒ…å«NULLå€¼å¾—å”¯ä¸€åˆ—ï¼Œå°±ä¼šç”¨åˆ°è¿™ä¸ªä½œä¸ºéšè—ä¸»é”®&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;trx_idï¼šäº‹åŠ¡idï¼Œè¡¨ç¤ºè¿™ä¸ªæ•°æ®ç”±å“ªä¸ªäº‹åŠ¡äº§ç”Ÿï¼Œç”¨äºMVCC&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;roll_ptrï¼šè®°å½•ä¸Šä¸ªç‰ˆæœ¬çš„æŒ‡é’ˆï¼Œç”¨äºå›æ»šï¼ŒMVCC&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;MySQL ä¸­ç£ç›˜å’Œå†…å­˜äº¤äº’çš„åŸºæœ¬å•ä½æ˜¯é¡µï¼Œä¸€ä¸ªé¡µçš„å¤§å°ä¸€èˆ¬æ˜¯ &lt;code&gt;16KB&lt;/code&gt;ï¼Œä¹Ÿå°±æ˜¯ &lt;code&gt;16384å­—èŠ‚&lt;/code&gt;ï¼Œè€Œä¸€ä¸ª varchar(n) ç±»å‹çš„åˆ—æœ€å¤šå¯ä»¥å­˜å‚¨ &lt;code&gt;65532å­—èŠ‚&lt;/code&gt;ï¼Œä¸€äº›å¤§å¯¹è±¡å¦‚ TEXTã€BLOB å¯èƒ½å­˜å‚¨æ›´å¤šçš„æ•°æ®ï¼Œè¿™æ—¶ä¸€ä¸ªé¡µå¯èƒ½å°±å­˜ä¸äº†ä¸€æ¡è®°å½•ã€‚è¿™ä¸ªæ—¶å€™å°±ä¼š&lt;strong&gt;å‘ç”Ÿè¡Œæº¢å‡ºï¼Œå¤šçš„æ•°æ®å°±ä¼šå­˜åˆ°å¦å¤–çš„ã€Œæº¢å‡ºé¡µã€ä¸­&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;buffer-pool&#34;&gt;Buffer Pool&lt;/h2&gt;
&lt;p&gt;InnoDBä½¿ç”¨äº†Buffer Poolæ¥æé«˜æ•°æ®åº“è¯»å†™æ€§èƒ½ï¼›MySQLå¯åŠ¨æ—¶ï¼Œ&lt;strong&gt;InnoDB ä¼šä¸º Buffer Pool ç”³è¯·ä¸€ç‰‡è¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œç„¶åæŒ‰ç…§é»˜è®¤çš„&lt;code&gt;16KB&lt;/code&gt;çš„å¤§å°åˆ’åˆ†å‡ºä¸€ä¸ªä¸ªçš„é¡µï¼Œ Buffer Pool ä¸­çš„é¡µå°±å«åšç¼“å­˜é¡µ&lt;/strong&gt;ï¼Œé»˜è®¤é…ç½®ä¸‹ Buffer Pool åªæœ‰ &lt;code&gt;128MB&lt;/code&gt; ã€‚&lt;/p&gt;
&lt;p&gt;Buffer Poolä¼šç¼“å­˜ç´¢å¼•é¡µã€æ•°æ®é¡µã€undoé¡µã€æ’å…¥ç¼“å­˜ã€è‡ªé€‚åº”å“ˆå¸Œç´¢å¼•ã€é”ä¿¡æ¯ç­‰ï¼›&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ä¸‰ç§é“¾è¡¨æ¥ç®¡ç†ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Free listé“¾è¡¨ï¼šå…³è”ç©ºé—²çš„é¡µï¼Œä»¥ä¾¿å¿«é€Ÿæ‰¾åˆ°ç©ºé—²é¡µï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Flush listé“¾è¡¨ï¼šå…³è”è„é¡µï¼Œä»¥ä¾¿å°†è„é¡µåˆ·ç›˜ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;LRU Listé“¾è¡¨ï¼šç®¡ç†è„é¡µå’Œå¹²å‡€é¡µï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä½œç”¨ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å½“è¯»å–æ•°æ®æ—¶ï¼Œå¦‚æœæ•°æ®å­˜åœ¨äº Buffer Pool ä¸­ï¼Œå®¢æˆ·ç«¯å°±ä¼šç›´æ¥è¯»å– Buffer Pool ä¸­çš„æ•°æ®ï¼Œå¦åˆ™å†å»ç£ç›˜ä¸­è¯»å–ã€‚&lt;/p&gt;
&lt;p&gt;æŸ¥è¯¢ä¸€æ¡æ•°æ®æ—¶ï¼Œä¼šæŠŠè¿™ä¸ªé¡µçš„æ•°æ®éƒ½åŠ è½½åˆ°Buffer Poolä¸­ï¼Œå› ä¸ºé€šè¿‡ç´¢å¼•åªèƒ½å®šä½åˆ°ç£ç›˜ä¸­çš„é¡µï¼Œè€Œä¸èƒ½å®šä½åˆ°é¡µä¸­çš„ä¸€æ¡æ•°æ®ï¼Œå°†é¡µåŠ è½½åˆ°Buffer Poolåï¼Œå†é€šè¿‡é¡µé‡Œçš„é¡µç›®å½•å»å®šä½åˆ°å…·ä½“çš„è¡Œè®°å½•ï¼›&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;MySQLåŠ è½½æ•°æ®æ—¶ï¼Œä¼šè¿›è¡Œé¢„è¯»ï¼Œä½†æ˜¯è¿™äº›æå‰è¢«åŠ è½½è¿›æ¥çš„æ•°æ®é¡µï¼Œå¯èƒ½å¹¶ä¸ä¼šè¢«è®¿é—®åˆ°ï¼Œé€ æˆé¢„è¯»å¤±æ•ˆï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä½¿ç”¨LRUç®—æ³•æå‡ç¼“å­˜å‘½ä¸­ç‡ï¼Œå°†LRUé“¾è¡¨åˆ’åˆ†ä¸ºä¸¤ä¸ªåŒºåŸŸï¼Œå‰åŠæ®µæ˜¯youngåŒºï¼ŒååŠæ®µæ˜¯oldåŒºï¼Œæ¯”ä¾‹å¤§æ¦‚æ˜¯64ï¼š37ï¼Œé¢„è¯»çš„é¡µä¼šå…ˆåŠ å…¥åˆ°oldåŒºçš„å¤´éƒ¨ï¼Œå½“é¡µè¢«çœŸæ­£è®¿é—®æ—¶ï¼Œæ‰ä¼šæ’å…¥youngåŒºçš„å¤´éƒ¨ï¼Œå¦‚æœé¢„è¯»çš„é¡µä¸€ç›´æ²¡æœ‰è¢«è®¿é—®åˆ°ï¼Œå°±ä¼šä»oldåŒºç§»é™¤ï¼Œè¿™æ ·å°±ä¸ä¼šå½±å“youngåŒºçš„çƒ­ç‚¹æ•°æ®ï¼Œè§£å†³é¢„è¯»å¤±æ•ˆå¯¼è‡´ç¼“å­˜å‘½ä¸­ç‡ä½çš„é—®é¢˜ï¼›&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å½“ä¸€ä¸ªSQLè¯­å¥éœ€è¦æ‰«æå¤§é‡çš„æ•°æ®ï¼Œåœ¨Buffer Poolç©ºé—´æ¯”è¾ƒæœ‰é™çš„æƒ…å†µä¸‹ï¼ŒæŠŠæ‰€æœ‰é¡µéƒ½æ›¿æ¢å‡ºå»äº†ï¼Œå¯¼è‡´å¤§é‡çƒ­ç‚¹æ•°æ®è¢«æ·˜æ±°ï¼Œé€ æˆç¼“å­˜æ±¡æŸ“ï¼Œç­‰åˆ°è¿™äº›çƒ­ç‚¹æ•°æ®è¢«è®¿é—®æ—¶ï¼Œç”±äºç¼“å­˜æœªå‘½ä¸­ï¼Œå°±ä¼šäº§ç”Ÿå¤§é‡ç£ç›˜IOã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ•°æ®åŠ å…¥youngåŒºæ¡ä»¶å¢åŠ é—¨æ§›ï¼Œåªæœ‰åŒæ—¶æ»¡è¶³ã€Œè¢«è®¿é—®ã€ä¸ã€Œåœ¨ old åŒºåŸŸåœç•™æ—¶é—´è¶…è¿‡ 1 ç§’ã€ä¸¤ä¸ªæ¡ä»¶ï¼Œæ‰ä¼šè¢«æ’å…¥åˆ° young åŒºåŸŸå¤´éƒ¨ï¼Œè§£å†³ ç¼“å­˜æ±¡æŸ“çš„é—®é¢˜ï¼›&lt;/p&gt;
&lt;p&gt;å¦å¤–ï¼Œä¸ºäº†é˜²æ­¢youngåŒºèŠ‚ç‚¹å¹¶é¢‘ç¹ç§»åŠ¨åˆ°å¤´éƒ¨ï¼Œå‰1/4è¢«è®¿é—®ä¸ä¼šç§»åŠ¨ï¼Œå3/4è¢«è®¿é—®æ‰ä¼šç§»åŠ¨ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å½“ä¿®æ”¹æ•°æ®æ—¶ï¼Œé¦–å…ˆæ˜¯ä¿®æ”¹ Buffer Pool ä¸­æ•°æ®æ‰€åœ¨çš„é¡µï¼Œç„¶åå°†å…¶é¡µè®¾ç½®ä¸ºè„é¡µï¼Œæœ€åç”±åå°çº¿ç¨‹å°†è„é¡µå†™å…¥åˆ°ç£ç›˜ï¼Œè§¦å‘è„é¡µåˆ·ç›˜çš„æ—¶æœºï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;redo logæ—¥å¿—æ»¡æ—¶ï¼Œä¸»åŠ¨è§¦å‘è„é¡µåˆ·ç›˜ï¼›&lt;/li&gt;
&lt;li&gt;Buffer Poolç©ºé—´ä¸è¶³ï¼Œæ­¤æ—¶éœ€è¦æ·˜æ±°ä¸€éƒ¨åˆ†æ•°æ®é¡µ ï¼Œå¦‚æœæ·˜æ±°çš„æ˜¯è„é¡µï¼Œå°±è¦åˆ·ç›˜ï¼›&lt;/li&gt;
&lt;li&gt;MySQL ç©ºé—²æ—¶ï¼Œå®šæœŸé€‚é‡å°†è„é¡µåˆ·ç›˜ï¼›&lt;/li&gt;
&lt;li&gt;MySQLæ­£å¸¸å…³é—­ï¼Œä¼šæŠŠæ‰€æœ‰è„é¡µåˆ·ç›˜ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;ç´¢å¼•&#34;&gt;ç´¢å¼•&lt;/h1&gt;
&lt;h2 id=&#34;1å¸¸è§ç´¢å¼•åŠæ¦‚å¿µ&#34;&gt;1.å¸¸è§ç´¢å¼•åŠæ¦‚å¿µ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;èšç°‡ç´¢å¼•ï¼šInnoDBä¸­çš„ä¸»é”®ç´¢å¼•ï¼Œæ¯å¼ è¡¨çš„ä¸»é”®æ„é€ ä¸€æ£µB+æ ‘ï¼ŒåŒæ—¶å¶å­èŠ‚ç‚¹ä¸­å­˜æ”¾çš„å³ä¸ºæ•´å¼ è¡¨çš„è¡Œè®°å½•æ•°æ®ã€‚ä¸€ä¸ªè¡¨åªèƒ½åŒ…å«ä¸€ä¸ªèšç°‡ç´¢å¼•ï¼Œèšç°‡ç´¢å¼•é€šå¸¸æä¾›æ›´å¿«çš„æ•°æ®è®¿é—®é€Ÿåº¦ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å› ä¸ºè¡¨çš„æ•°æ®éƒ½æ˜¯å­˜æ”¾åœ¨èšé›†ç´¢å¼•çš„å¶å­èŠ‚ç‚¹é‡Œï¼Œæ‰€ä»¥ InnoDB å­˜å‚¨å¼•æ“ä¸€å®šä¼šä¸ºè¡¨åˆ›å»ºä¸€ä¸ªèšç°‡ç´¢å¼•ï¼Œä¸”ç”±äºæ•°æ®åœ¨ç‰©ç†ä¸Šåªä¼šä¿å­˜ä¸€ä»½ï¼Œæ‰€ä»¥èšç°‡ç´¢å¼•åªèƒ½æœ‰ä¸€ä¸ªï¼Œè€ŒäºŒçº§ç´¢å¼•å¯ä»¥åˆ›å»ºå¤šä¸ªã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;éèšç°‡ç´¢å¼•ï¼šè¡¨ä¸­è¡Œçš„ç‰©ç†é¡ºåºä¸é”®å€¼çš„é€»è¾‘é¡ºåºä¸åŒ¹é…ï¼ŒæŸ¥åˆ°è®°å½•å¯¹åº”çš„ä¸»é”®å€¼ ï¼Œå†ä½¿ç”¨ä¸»é”®çš„å€¼é€šè¿‡èšç°‡ç´¢å¼•æŸ¥æ‰¾åˆ°éœ€è¦çš„æ•°æ®ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¹Ÿç§°ä¸ºå›è¡¨ï¼›å³å…ˆé€šè¿‡æ™®é€šç´¢å¼•æ‰¾åˆ°ä¸»é”®ï¼Œåœ¨é€šè¿‡ä¸»é”®æ‰¾åˆ°æ•°æ®ã€‚&lt;/p&gt;
&lt;p&gt;è¦ç»†åˆ†çš„è¯å¯ä»¥åˆ†ä¸ºæ™®é€šç´¢å¼•ï¼Œå”¯ä¸€ç´¢å¼•ï¼Œç»„åˆç´¢å¼•ï¼Œå…¨æ–‡ç´¢å¼•è¿™äº›ã€‚&lt;/p&gt;
&lt;p&gt;æ³¨ï¼šMyISAMæ— è®ºä¸»é”®ç´¢å¼•è¿˜æ˜¯äºŒçº§ç´¢å¼•éƒ½æ˜¯éèšç°‡ç´¢å¼•ï¼Œè€ŒInnoDBçš„ä¸»é”®ç´¢å¼•æ˜¯èšç°‡ç´¢å¼•ï¼ŒäºŒçº§ç´¢å¼•æ˜¯éèšç°‡ç´¢å¼•ã€‚æˆ‘ä»¬è‡ªå·±å»ºçš„ç´¢å¼•åŸºæœ¬éƒ½æ˜¯éèšç°‡ç´¢å¼•ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç¨ å¯†ç´¢å¼•ï¼šæ¯ä¸ªç´¢å¼•å¯¹åº”ä¸€ä¸ªå€¼&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç¨€ç–ç´¢å¼•ï¼šæ¯ä¸ªç´¢å¼•å¯¹åº”ä¸€ä¸ªå­˜å‚¨å—&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è¦†ç›–ç´¢å¼•ï¼šè¦æŸ¥è¯¢çš„å­—æ®µåªéœ€è¦å»æŸ¥è¯¢ç´¢å¼•è¡¨å°±å¯ä»¥&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç»„åˆç´¢å¼•ï¼ˆè”åˆç´¢å¼•ï¼‰ï¼šæœ€å·¦åŒ¹é…ï¼Œå»ºç«‹ä¸€ä¸ªç»„åˆç´¢å¼•ç­‰äºå»ºç«‹å¤šä¸ªç´¢å¼•ï¼Œèƒ½è¾¾åˆ°è¦†ç›–ç´¢å¼•çš„ç›®çš„ï¼Œæ•ˆç‡é«˜ï¼›ä¾‹å¦‚æœ‰ç»„åˆç´¢å¼•(aï¼Œbï¼Œc)ï¼Œåˆ™åŒæ—¶å¾—åˆ°äº†ç´¢å¼•ï¼ˆaï¼‰ï¼Œ(aï¼Œb)ï¼Œï¼ˆaï¼Œbï¼Œcï¼‰&lt;/p&gt;
&lt;p&gt;MySQL5.6 åæœ‰ä¸ª&lt;strong&gt;ç´¢å¼•ä¸‹æ¨&lt;/strong&gt;ï¼Œå½“æŸ¥è¯¢æ¡ä»¶å¸¦aï¼Œbçš„æ—¶å€™ï¼Œä¼šå…ˆæŸ¥æ‰¾ç´¢å¼•æ ‘åŒ¹é…aï¼Œå†åˆ¤æ–­bï¼Œç„¶åæ‰å›è¡¨æ‰¾æ•°æ®ï¼Œä»è€Œå‡å°‘å›è¡¨æ¬¡æ•°ï¼Œå¦‚æœæ²¡æœ‰ç´¢å¼•ä¸‹æ¨ï¼ŒMySQLæ˜¯å…ˆæŸ¥æ‰¾ç´¢å¼•æ ‘åŒ¹é…aï¼Œæ‹¿åˆ°idå›è¡¨æŸ¥æ•°æ®ï¼Œåˆ¤æ–­æ˜¯å¦åŒ¹é…bï¼Œè¿™æ ·å›è¡¨æ¬¡æ•°å°±å¤ªå¤šäº†ã€‚&lt;/p&gt;
&lt;p&gt;ç»„åˆç´¢å¼•ä¹‹æ‰€ä»¥æ˜¯æœ€å·¦åŒ¹é…è·ŸB+æ ‘æœ‰å…³ï¼Œä¹Ÿæ˜¯ç±»ä¼¼Order byçš„è¿‡æ»¤ï¼Œæ ¹æ®ç´¢å¼•ä¾æ¬¡æ’åˆ—æ•°æ®çš„ï¼Œå¦‚Order by a,b,c åˆ™å…ˆæ’aï¼Œaç›¸åŒå†æ’bï¼Œbç›¸åŒå†æ’c&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;è”åˆç´¢å¼•çš„æœ€å·¦åŒ¹é…åŸåˆ™ï¼Œåœ¨é‡åˆ°èŒƒå›´æŸ¥è¯¢ï¼ˆå¦‚ &amp;gt;ã€&amp;lt;ï¼‰çš„æ—¶å€™ï¼Œå°±ä¼šåœæ­¢åŒ¹é…ï¼Œä¹Ÿå°±æ˜¯èŒƒå›´æŸ¥è¯¢çš„å­—æ®µå¯ä»¥ç”¨åˆ°è”åˆç´¢å¼•ï¼Œä½†æ˜¯åœ¨èŒƒå›´æŸ¥è¯¢å­—æ®µçš„åé¢çš„å­—æ®µæ— æ³•ç”¨åˆ°è”åˆç´¢å¼•ï¼Œæ¯”å¦‚ a &amp;gt; 1 AND b = 2ï¼Œè¿™ç§åªä¼šç”¨åˆ°è”åˆç´¢å¼•çš„ï¼ˆaï¼‰ã€‚æ³¨æ„ï¼Œå¯¹äº &amp;gt;=ã€&amp;lt;=ã€BETWEENã€like å‰ç¼€åŒ¹é… çš„èŒƒå›´æŸ¥è¯¢ï¼Œå¹¶ä¸ä¼šåœæ­¢åŒ¹é…ï¼Œæ¯”å¦‚ a &amp;gt;= 1 AND b = 2ï¼Œä¼šç”¨åˆ°ç´¢å¼•ï¼ˆaï¼Œbï¼‰ï¼Œå› ä¸ºæ­¤æ—¶åœ¨è¿›è¡Œæ‰«ææ—¶ï¼Œå¯ä»¥æ˜¯ä»¥ a=1 AND b=2 ä¸ºæ¡ä»¶æ‰¾åˆ°ç¬¬ä¸€æ¡æ•°æ®ï¼Œå†ç»§ç»­å¾€ä¸‹åŒ¹é…çš„ï¼›&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è‡ªé€‚åº”å“ˆå¸Œç´¢å¼•ï¼Œç”±InnoDBè‡ªè¡Œå†³å®šæ˜¯å¦å»ºç«‹ï¼Œè‡ªé€‚åº”å“ˆå¸Œç´¢å¼•åªä¿å­˜çƒ­ç‚¹æ•°æ®ï¼Œä¸ä¼šä¿å­˜å…¨è¡¨æ•°æ®ï¼Œæ‰€ä»¥æ•°æ®é‡ä¸ä¼šå¾ˆå¤§ï¼Œä½¿ç”¨çš„ InnoDB Buffer Poolè¿›è¡Œç¼“å­˜ï¼›ç›¸å½“äº ç´¢å¼•çš„ç´¢å¼•ï¼Œé™ä½å¯¹äºŒçº§ç´¢å¼•æ ‘çš„é¢‘ç¹è®¿é—®ï¼Œå¿«é€Ÿå®šä½åˆ°å¶å­èŠ‚ç‚¹ï¼›æ— æ³•è¿›è¡ŒèŒƒå›´æŸ¥è¯¢ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç´¢å¼•å¯èƒ½å› ä¸ºåˆ é™¤ï¼Œæˆ–è€…é¡µåˆ†è£‚ç­‰åŸå› ï¼Œå¯¼è‡´æ•°æ®é¡µæœ‰ç©ºæ´ï¼Œé‡å»ºç´¢å¼•çš„è¿‡ç¨‹ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ç´¢å¼•ï¼ŒæŠŠæ•°æ®æŒ‰é¡ºåºæ’å…¥ï¼Œè¿™æ ·é¡µé¢çš„åˆ©ç”¨ç‡æœ€é«˜ï¼Œä¹Ÿå°±æ˜¯ç´¢å¼•æ›´ç´§å‡‘ã€æ›´çœç©ºé—´ï¼Œ&lt;strong&gt;ä½†ä¸»é”®ç´¢å¼•çš„é‡å»ºä¼šå¯¼è‡´æ•´ä¸ªè¡¨é‡å»ºï¼Œä¸€èˆ¬å¯ä»¥ä½¿ç”¨alter table T engine=InnoDBæ¥è¾¾åˆ°é‡å»ºä¸»é”®ç´¢å¼•çš„æ•ˆæœ&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id=&#34;2ç‰¹ç‚¹&#34;&gt;2.ç‰¹ç‚¹&lt;/h2&gt;
&lt;p&gt;éœ€è¦å»ºç«‹çš„åˆ—ï¼šç»å¸¸éœ€è¦æœç´¢çš„åˆ—ã€ä¸»é”®åˆ—ã€å¤–é”®åˆ—ã€æ’åºçš„åˆ—ã€ç»å¸¸åœ¨whereåé¢å‡ºç°çš„åˆ—&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;é¿å…è¿›è¡Œæ•°æ®åº“å…¨è¡¨çš„æ‰«æï¼Œå¤§å¤šæ•°æƒ…å†µï¼Œåªéœ€è¦æ‰«æè¾ƒå°‘çš„ç´¢å¼•é¡µå’Œæ•°æ®é¡µï¼Œè€Œä¸æ˜¯æŸ¥è¯¢æ‰€æœ‰æ•°æ®é¡µã€‚è€Œä¸”å¯¹äºéèšç°‡ç´¢å¼•ï¼Œæœ‰æ—¶ä¸éœ€è¦è®¿é—®æ•°æ®é¡µå³å¯å¾—åˆ°æ•°æ®ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;èšç°‡ç´¢å¼•å¯ä»¥é¿å…æ•°æ®æ’å…¥æ“ä½œï¼Œé›†ä¸­äºè¡¨çš„æœ€åä¸€ä¸ªæ•°æ®é¡µé¢ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œç´¢å¼•å¯ä»¥é¿å…æ’åºæ“ä½œ&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åŠ é€Ÿè¡¨ä¸è¡¨ä¹‹é—´çš„è¿æ¥&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åœ¨ä½¿ç”¨åˆ†ç»„å’Œæ’åºå­å¥è¿›è¡Œæ•°æ®æ£€ç´¢æ—¶ï¼Œå¯ä»¥æ˜¾è‘—å‡å°‘æŸ¥è¯¢ä¸­åˆ†ç»„å’Œæ’åºçš„æ—¶é—´&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¢ï¼Œåˆ ï¼Œæ”¹ä¼šå¸¦æ¥ä¸å°æ€§èƒ½å¼€é”€&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å…³äºæ™®é€šç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•&lt;/p&gt;
&lt;p&gt;åœ¨æŸ¥è¯¢ä¸Šï¼Œå”¯ä¸€ç´¢å¼•å’Œæ™®é€šç´¢å¼•çš„åŒºåˆ«æ˜¯ï¼Œå”¯ä¸€ç´¢å¼•åœ¨æŸ¥æ‰¾åˆ°ç»“æœåå°±ä¸ä¼šç»§ç»­å¾€ä¸‹æŸ¥äº†ï¼Œä½†å…¶å®æ€§èƒ½è·Ÿæ™®é€šç´¢å¼•å·®åˆ«ä¸ä¼šå¾ˆå¤§ï¼Œä½†æ˜¯æ›´æ–°çš„æ—¶å€™å”¯ä¸€ç´¢å¼•ç”±äºç”¨ä¸ä¸Šchange bufferæœºåˆ¶ï¼Œæ›´æ–°çš„æ€§èƒ½æ¯”è¾ƒå·®ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æ›´æ–°ä¸Šï¼ŒInnoDBä¼šå…ˆåˆ¤æ–­æ›´æ–°çš„æ•°æ®æ˜¯å¦åœ¨Buffer Poolï¼Œå¦‚æœåœ¨å°±ç›´æ¥æ›´æ–°ï¼Œå¦‚æœä¸åœ¨ï¼Œå°±å…ˆæŠŠæ›´æ–°æ“ä½œå†™åˆ°change bufferï¼Œç­‰ä¹‹åæ•°æ®åŠ è½½åˆ°Buffer Poolåï¼Œåˆå¹¶è¿™ä¸¤éƒ¨åˆ†Bufferï¼Œæ›´æ–°Buffer Poolé‡Œçš„æ•°æ®ã€‚&lt;/p&gt;
&lt;p&gt;change bufferåªé€‚ç”¨æ™®é€šç´¢å¼•ä¸Šçš„æ›´æ–°æ“ä½œï¼Œå› ä¸ºå”¯ä¸€ç´¢å¼•éœ€è¦å…ˆè¯»å–æ‰€æœ‰æ•°æ®ï¼Œåˆ¤æ–­ç´¢å¼•æ˜¯å¦é‡å¤åå†æ’å…¥ï¼Œå¦‚æœæ­¤æ—¶æ•°æ®æ²¡æœ‰è¢«è¯»è¿›Buffer Poolï¼Œéœ€è¦ç£ç›˜éšæœºIOè¯»å–ï¼Œæœ€ç»ˆå¯¼è‡´æ›´æ–°å˜æ…¢ã€‚&lt;/p&gt;
&lt;p&gt;å¦å¤–ï¼Œä¸ºäº†ä¿è¯æ›´æ–°æ“ä½œçš„ç¨³å®šæ€§ï¼Œå®é™…ä¸Šåœ¨å†™change bufferçš„è¿‡ç¨‹ä¸­è¿˜ä¼šæŠŠç›¸å…³æ“ä½œè®°å½•æŒ‰é¡ºåºå†™è¿›redo logï¼ˆredo logä¹Ÿä¼šåˆ·ç›˜ï¼‰ï¼Œæ‰ç®—çœŸæ­£å®Œæˆæ›´æ–°æ“ä½œã€‚æŸ¥è¯¢çš„æ—¶å€™å…¶å®å¯ä»¥ç›´æ¥æŸ¥Buffer Poolé‡Œçš„æ•°æ®ï¼Œæˆ–è€…å…ˆæŠŠç£ç›˜é‡Œçš„æ•°æ®è¯»åˆ°å†…å­˜ï¼Œå†é…åˆchange bufferå°±èƒ½å¾—åˆ°æ›´æ–°åçš„æ•°æ®äº†ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;3åŸç†&#34;&gt;3.åŸç†&lt;/h2&gt;
&lt;p&gt;Bç±»æ ‘éƒ½æ˜¯ä¸ºäº†ç£ç›˜æˆ–å…¶ä»–è¾…åŠ©å­˜å‚¨è®¾å¤‡è€Œè®¾è®¡çš„ä¸€ç§æ•°æ®ç»“æ„ï¼Œç›®çš„æ˜¯ä¸ºäº†åœ¨æŸ¥æ‰¾æ•°æ®çš„è¿‡ç¨‹ä¸­å‡å°‘ç£ç›˜I/Oæ¬¡æ•°ï¼Œ&lt;strong&gt;æ ‘å­˜å‚¨åœ¨ç£ç›˜ä¸­ï¼Œæ ‘çš„é«˜åº¦ç­‰äºæ¯æ¬¡æŸ¥è¯¢æ•°æ®æ—¶ç£ç›˜çš„IOæ“ä½œæ¬¡æ•°&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;B+æ ‘&lt;/strong&gt;ï¼šè¡¨çš„æ•°æ®ä¸ºå¶å­èŠ‚ç‚¹ï¼Œéå¶å­èŠ‚ç‚¹ä¸ºç´¢å¼•ï¼Œæœ‰ä¸¤æ¡è·¯å¾„ï¼Œä¸€æ¡æ˜¯æ ‘ï¼Œä¸€æ¡æ˜¯å„å¶å­ç›¸è¿&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Nå‰æ ‘çš„Nåœ¨MySQL5.6åå¯ä»¥é€šè¿‡pageå¤§å°æ¥é—´æ¥æ§åˆ¶ï¼Œå¶å­èŠ‚ç‚¹æ˜¯æ•°æ®é¡µ(page)ï¼Œé¡µä¸é¡µä¹‹é—´ç»„æˆ&lt;strong&gt;åŒå‘é“¾è¡¨&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;ä¸€ä¸ªæ•°æ®é¡µ(page)å¯ä»¥åŒ…å«å¤šä¸ªè¡Œ(è®°å½•)ï¼Œè¡ŒæŒ‰(è®°å½•)ç…§ä¸»é”®é¡ºåºï¼Œè¡Œä¸è¡Œä¹‹é—´ç»„æˆå•å‘é“¾è¡¨ï¼›æ¯ä¸€ä¸ªæ•°æ®é¡µä¸­æœ‰ä¸€ä¸ªé¡µç›®å½•ï¼Œæ–¹ä¾¿æŒ‰ç…§ä¸»é”®æŸ¥è¯¢è¡Œï¼›&lt;/li&gt;
&lt;li&gt;é¡µç›®å½•ä¸­é€šè¿‡æ§½æŠŠè¡Œ(è®°å½•)åˆ†æˆä¸åŒå°ç»„ï¼Œæ¯ä¸ªå°ç»„å†…åŒ…å«å¤šæ¡è¡Œ(è®°å½•)ï¼ŒæŒ‰ç…§ä¸»é”®æœç´¢é¡µä¸­è¡Œ(è®°å½•)æ—¶ï¼Œä½¿ç”¨äºŒåˆ†æ³•æŸ¥æ‰¾ï¼Œä»æ§½å¼€å§‹ä¾æ¬¡å¾€ä¸‹æ‰¾ï¼›&lt;/li&gt;
&lt;li&gt;B+æ ‘çš„æ’å…¥å¯èƒ½ä¼šå¼•èµ·æ•°æ®é¡µçš„åˆ†è£‚ï¼Œåˆ é™¤å¯èƒ½ä¼šå¼•èµ·æ•°æ®é¡µçš„åˆå¹¶ï¼ŒäºŒè€…éƒ½æ˜¯æ¯”è¾ƒé‡çš„IOæ¶ˆè€—ï¼Œæ‰€ä»¥æ¯”è¾ƒå¥½çš„æ–¹å¼æ˜¯é¡ºåºæ’å…¥æ•°æ®ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨è‡ªå¢ä¸»é”®çš„åŸå› ä¹‹ä¸€ï¼›&lt;/li&gt;
&lt;li&gt;æ¯ä¸ªç»“ç‚¹å°±ç®—ä¸€ä¸ªpageï¼Œæ•°æ®ä»¥Pageä¸ºå•ä½åœ¨å†…å­˜å’Œç£ç›˜é—´è¿›è¡Œè°ƒåº¦ï¼Œæ¯ä¸ªPageçš„å¤§å°å†³å®šäº†ç›¸åº”ç»“ç‚¹çš„åˆ†æ”¯æ•°é‡ï¼Œæ¯æ¡ç´¢å¼•è®°å½•ä¼šåŒ…å«ä¸€ä¸ªæ•°æ®æŒ‡é’ˆï¼ŒæŒ‡å‘ä¸€æ¡æ•°æ®è®°å½•æ‰€åœ¨æ–‡ä»¶çš„åç§»é‡ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/B&amp;#43;%e6%a0%91.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/B&amp;#43;%e6%a0%91.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			alt=&#34;B&amp;#43;æ ‘&#34;&gt;
	&lt;/a&gt;
	
	&lt;figcaption&gt;B+æ ‘&lt;/figcaption&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;B-æ ‘&lt;/strong&gt;ï¼šä¹Ÿç§°Bæ ‘ï¼Œä¸é™åˆ¶å‡ºåº¦çš„ä¸ªæ•°ï¼Œæ‰€æœ‰èŠ‚ç‚¹ä¸ºè¡¨çš„æ•°æ®ï¼Œåªæœ‰ä¸€æ¡è·¯ï¼Œä»æ ¹èŠ‚ç‚¹å¼€å§‹&lt;/p&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/B%e6%a0%91.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/B%e6%a0%91.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			alt=&#34;Bæ ‘&#34;&gt;
	&lt;/a&gt;
	
	&lt;figcaption&gt;Bæ ‘&lt;/figcaption&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;h3 id=&#34;ä¸ºä»€ä¹ˆè¯´bæ ‘æ¯”bæ ‘æ›´é€‚åˆmysqlæ•°æ®åº“ç´¢å¼•&#34;&gt;ä¸ºä»€ä¹ˆè¯´B+æ ‘æ¯”Bæ ‘æ›´é€‚åˆMySQLæ•°æ®åº“ç´¢å¼•&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;B+æ ‘çš„ç£ç›˜è¯»å†™ä»£ä»·æ›´ä½ï¼šB+æ ‘çš„å†…éƒ¨èŠ‚ç‚¹å¹¶æ²¡æœ‰æŒ‡å‘å…³é”®å­—å…·ä½“ä¿¡æ¯çš„æŒ‡é’ˆï¼Œå› æ­¤å…¶å†…éƒ¨èŠ‚ç‚¹ç›¸å¯¹Bæ ‘æ›´å°ï¼Œå¦‚æœæŠŠæ‰€æœ‰åŒä¸€å†…éƒ¨èŠ‚ç‚¹çš„å…³é”®å­—å­˜æ”¾åœ¨åŒä¸€ç›˜å—ä¸­ï¼Œé‚£ä¹ˆç›˜å—æ‰€èƒ½å®¹çº³çš„å…³é”®å­—æ•°é‡ä¹Ÿè¶Šå¤šï¼Œä¸€æ¬¡æ€§è¯»å…¥å†…å­˜çš„éœ€è¦æŸ¥æ‰¾çš„å…³é”®å­—ä¹Ÿå°±è¶Šå¤šï¼Œæ¯”Bæ ‘æ›´çŸ®èƒ–ï¼Œç›¸å¯¹IOè¯»å†™æ¬¡æ•°å°±é™ä½äº†ï¼Œè€Œä¸”ï¼Œåœ¨æ²¡å®šä½åˆ°è¦æ‰¾çš„è®°å½•æ—¶ï¼ŒåŠ è½½åˆ«çš„æ•°æ®è¡Œè¿›å†…å­˜å¹¶æ²¡æœ‰ä»€ä¹ˆç”¨ï¼Œå› ä¸ºåªéœ€è¦ç´¢å¼•æ¥åˆ¤æ–­æŸ¥æ‰¾å¾—å¯¹ä¸å¯¹ã€‚&lt;/p&gt;
&lt;p&gt;B+æ ‘çš„æŸ¥è¯¢æ•ˆç‡æ›´åŠ ç¨³å®šï¼šB+æ ‘æ·±åº¦æ¯”è¾ƒå¹³å‡ï¼Œç”±äºéå¶å­ç‚¹å¹¶ä¸æ˜¯æœ€ç»ˆæŒ‡å‘æ–‡ä»¶å†…å®¹çš„ç»“ç‚¹ï¼Œè€Œåªæ˜¯å¶å­ç»“ç‚¹ä¸­å…³é”®å­—çš„ç´¢å¼•ï¼Œä»»ä½•å…³é”®å­—çš„æŸ¥æ‰¾å¿…é¡»èµ°ä¸€æ¡ä»æ ¹ç»“ç‚¹åˆ°å¶å­ç»“ç‚¹çš„è·¯ï¼Œå³æ‰€æœ‰å…³é”®å­—æŸ¥è¯¢çš„è·¯å¾„é•¿åº¦ç›¸åŒï¼Œå› æ­¤æ¯ä¸€ä¸ªæ•°æ®çš„æŸ¥è¯¢æ•ˆç‡ç›¸å½“ã€‚è€ŒBæ ‘æŸ¥è¯¢çš„æ·±åº¦æ¯”è¾ƒéšæœºï¼Œæ¯”è¾ƒé€‚åˆå®šç‚¹æŸ¥è¯¢ï¼Œå•æ¬¡æŸ¥è¯¢æ•ˆç‡é«˜ã€‚&lt;/p&gt;
&lt;p&gt;ç”±äºB+æ ‘çš„æ•°æ®éƒ½å­˜å‚¨åœ¨å¶å­ç»“ç‚¹ä¸­ï¼Œåˆ†æ”¯ç»“ç‚¹å‡ä¸ºç´¢å¼•ï¼Œæ–¹ä¾¿æ‰«åº“ï¼Œé¡ºåºIOï¼Œåªéœ€è¦æ‰«ä¸€éå¶å­ç»“ç‚¹å³å¯ï¼›ä½†æ˜¯Bæ ‘å› ä¸ºå…¶åˆ†æ”¯ç»“ç‚¹åŒæ ·å­˜å‚¨ç€æ•°æ®ï¼Œæˆ‘ä»¬è¦æ‰¾åˆ°å…·ä½“çš„æ•°æ®ï¼Œéœ€è¦è¿›è¡Œä¸€æ¬¡ä¸­åºéå†æŒ‰åºæ¥æ‰«ï¼Œå¸¦æ¥æ›´å¤šçš„éšæœºIOã€‚æ‰€ä»¥B+æ ‘æ›´åŠ é€‚åˆåœ¨åŒºé—´æŸ¥è¯¢çš„æƒ…å†µã€‚&lt;/p&gt;
&lt;p&gt;Bæ ‘ä¸é€‚åˆéå†æ•°æ®ï¼ŒBæ ‘æ¯”è¾ƒåˆé€‚æŸ¥è¯¢å•ä¸€è®°å½•ï¼Œå¸¸ç”¨ä¸NoSQLçš„ç´¢å¼•ç»“æ„ï¼ŒNoSQLä¸€èˆ¬æ˜¯Key-valueå½¢å¼çš„å­˜å‚¨ï¼Œæ–‡æ¡£æ€§ä¸€èˆ¬æ˜¯Jsonå­˜å‚¨ã€‚&lt;/p&gt;
&lt;p&gt;æ’å…¥å’Œåˆ é™¤æ—¶ï¼ŒBæ ‘ä¼šå¯¼è‡´å¹³è¡¡å‘ç”Ÿæ”¹å˜ï¼ŒèŠ‚ç‚¹ä¼šä¸Šç§»æˆ–ä¸‹æ²‰ï¼ŒB+æ ‘å› ä¸ºå­˜åœ¨å†—ä½™èŠ‚ç‚¹ï¼Œåˆ é™¤æ—¶ä¸ä¼šå‘ç”Ÿå¤æ‚çš„æ ‘å˜å½¢ï¼Œæ’å…¥æ—¶è™½ç„¶ä¹Ÿå¯èƒ½å­˜åœ¨é¡µåˆ†è£‚ï¼Œä½†ä¹Ÿåªæ¶‰åŠåˆ°æ ‘çš„ä¸€æ¡è·¯å¾„ï¼Œå› æ­¤åœ¨æ’å…¥å’Œåˆ é™¤æ—¶ï¼ŒB+æ ‘æ•ˆç‡æ›´é«˜ï¼›&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;ä¸äºŒå‰æŸ¥æ‰¾æ ‘avlæ ‘çš„æ¯”è¾ƒ&#34;&gt;ä¸äºŒå‰æŸ¥æ‰¾æ ‘ã€AVLæ ‘çš„æ¯”è¾ƒ&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;AVLæ ‘çš„å‡ºåº¦ä¸º2ï¼Œè€Œä¸”AVLæ ‘è¦ä¸¥æ ¼ä¿æŒå¹³è¡¡ï¼Œä½†æ—‹è½¬ä¿æŒå¹³è¡¡æ¯”è¾ƒè€—æ—¶ï¼Œé€‚åˆç”¨äºæ’å…¥åˆ é™¤æ¬¡æ•°æ¯”è¾ƒå°‘ï¼Œä½†æŸ¥æ‰¾å¤šçš„æƒ…å†µ&lt;/li&gt;
&lt;li&gt;äºŒå‰æŸ¥æ‰¾æ ‘åœ¨æŸ¥æ‰¾æœ€å¤§å€¼æˆ–æœ€å°å€¼çš„æ—¶å€™ï¼ŒäºŒå‰æŸ¥æ‰¾æ ‘å°±å®Œå…¨é€€åŒ–æˆäº†çº¿æ€§ç»“æ„äº†&lt;/li&gt;
&lt;li&gt;å…¶ä»–ç¼ºç‚¹åŒä¸‹é¢&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;ä¸çº¢é»‘æ ‘çš„æ¯”è¾ƒ&#34;&gt;ä¸çº¢é»‘æ ‘çš„æ¯”è¾ƒ&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;çº¢é»‘æ ‘å‡ºåº¦ä¸º2ï¼ŒB+æ ‘å‡ºåº¦ä¸æ­¢2ï¼Œå› æ­¤çº¢é»‘æ ‘çš„é«˜åº¦ä¼šæ¯”B+æ ‘é«˜ï¼ŒæŸ¥æ‰¾çš„æ¬¡æ•°ä¹Ÿå¤šäº†ã€‚ï¼ˆçº¢é»‘æ ‘ä¸æ˜¯ä¸¥æ ¼çš„å¹³è¡¡äºŒå‰æ ‘ï¼Œæ—‹è½¬æ¬¡æ•°ç›¸å¯¹å°‘ï¼Œé«˜åº¦æ¯”å¹³è¡¡äºŒå‰æ ‘çš„ä½äº›ï¼‰&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;B+æ ‘åœ¨é™ä½ç£ç›˜I/Oæ“ä½œæ•°æ–¹é¢å ä¼˜åŠ¿&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ä¸ºäº†å‡å°‘ç£ç›˜ I/Oï¼Œç£ç›˜å¾€å¾€ä¸æ˜¯ä¸¥æ ¼æŒ‰éœ€è¯»å–ï¼Œè€Œæ˜¯æ¯æ¬¡éƒ½ä¼šé¢„è¯»ã€‚é¢„è¯»è¿‡ç¨‹ä¸­ï¼Œç£ç›˜è¿›è¡Œé¡ºåºè¯»å–ï¼Œé¡ºåºè¯»å–ä¸éœ€è¦è¿›è¡Œç£ç›˜å¯»é“ï¼Œå¹¶ä¸”åªéœ€è¦å¾ˆçŸ­çš„æ—‹è½¬æ—¶é—´ï¼Œé€Ÿåº¦ä¼šéå¸¸å¿«ã€‚&lt;/p&gt;
&lt;p&gt;æ“ä½œç³»ç»Ÿä¸€èˆ¬å°†å†…å­˜å’Œç£ç›˜åˆ†å‰²æˆå›ºå®šå¤§å°çš„å—ï¼Œæ¯ä¸€å—ç§°ä¸ºä¸€é¡µï¼Œå†…å­˜ä¸ç£ç›˜ä»¥é¡µä¸ºå•ä½äº¤æ¢æ•°æ®ã€‚æ•°æ®åº“ç³»ç»Ÿå°†ç´¢å¼•çš„ä¸€ä¸ªèŠ‚ç‚¹çš„å¤§å°è®¾ç½®ä¸ºé¡µçš„å¤§å°ï¼Œä½¿å¾—ä¸€æ¬¡ I/O å°±èƒ½å®Œå…¨è½½å…¥ä¸€ä¸ªèŠ‚ç‚¹ã€‚å¹¶ä¸”å¯ä»¥åˆ©ç”¨é¢„è¯»ç‰¹æ€§ï¼Œç›¸é‚»çš„èŠ‚ç‚¹ä¹Ÿèƒ½å¤Ÿè¢«é¢„å…ˆè½½å…¥ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;çº¢é»‘æ ‘çš„ç‰¹æ€§&lt;/strong&gt;:
ï¼ˆ1ï¼‰æ¯ä¸ªèŠ‚ç‚¹è¦ä¹ˆæ˜¯é»‘è‰²ï¼Œè¦ä¹ˆæ˜¯çº¢è‰²ã€‚
ï¼ˆ2ï¼‰æ ¹èŠ‚ç‚¹æ˜¯é»‘è‰²ã€‚
ï¼ˆ3ï¼‰æ¯ä¸ªå¶å­èŠ‚ç‚¹ï¼ˆNILï¼‰æ˜¯é»‘è‰²ã€‚ï¼ˆæ³¨æ„ï¼šè¿™é‡Œå¶å­èŠ‚ç‚¹ï¼Œæ˜¯æŒ‡ä¸ºç©º(NILæˆ–NULL)çš„å¶å­èŠ‚ç‚¹ï¼‰
ï¼ˆ4ï¼‰å¦‚æœä¸€ä¸ªèŠ‚ç‚¹æ˜¯çº¢è‰²çš„ï¼Œåˆ™å®ƒçš„å­èŠ‚ç‚¹å¿…é¡»æ˜¯é»‘è‰²çš„ã€‚
ï¼ˆ5ï¼‰ä»ä¸€ä¸ªèŠ‚ç‚¹åˆ°è¯¥èŠ‚ç‚¹çš„å­å­™èŠ‚ç‚¹çš„æ‰€æœ‰è·¯å¾„ä¸ŠåŒ…å«ç›¸åŒæ•°ç›®çš„é»‘èŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;å‚è€ƒ&lt;a class=&#34;link&#34; href=&#34;https://www.cnblogs.com/aspirant/p/9214485.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;ä¸€æ­¥æ­¥åˆ†æä¸ºä»€ä¹ˆB+æ ‘é€‚åˆä½œä¸ºç´¢å¼•çš„ç»“æ„&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;4å¤±æ•ˆæƒ…å†µ&#34;&gt;4.å¤±æ•ˆæƒ…å†µ&lt;/h2&gt;
&lt;p&gt;å¤±æ•ˆçš„æœ¬è´¨æ˜¯MySQLåˆ¤æ–­æŸ¥è¯¢æ—¶èµ°ä»€ä¹ˆè·¯å¾„æ‰€èŠ±è´¹çš„éšæœºI/Oå’Œé¡ºåºI/Oæ›´å¤šï¼Œæ¯”å¦‚éœ€è¦æ‰«æè¶…è¿‡è¡¨çš„30%æ•°æ®ï¼Œå°±æœ‰å¯èƒ½å¤±æ•ˆã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ä½¿ç”¨åˆ°ç´¢å¼•åˆ—çš„æƒ…å†µä¸‹&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¯¹ç´¢å¼•åˆ—ä½œè¿ç®—å¦‚ + - * / !&lt;/li&gt;
&lt;li&gt;ç´¢å¼•ç±»å‹å‡ºé”™ï¼Œæ¯”å¦‚è¯¥ç´¢å¼•åˆ—æ˜¯å­—ç¬¦ä¸²ï¼Œä½†æ˜¯å†™æ—¶å€™æ²¡æœ‰åŠ ``å·ï¼Œ&lt;strong&gt;å­—ç¬¦ä¸²å’Œæ•°å­—æ¯”è¾ƒï¼ŒMySQLä¼šæŠŠå­—ç¬¦ä¸²è½¬ä¸ºæ•°å­—ï¼Œæ— æ³•è½¬æˆæ•°å­—çš„å­—ç¬¦ä¸²éƒ½ä¼šè¢«è½¬æ¢æˆ0&lt;/strong&gt;ï¼›æˆ–è€…æ˜¯å­—æ®µçš„å­—ç¬¦ç¼–ç æ ¼å¼ä¸åŒï¼Œæ¯”å¦‚æœ‰ä¸¤å¼ è¡¨ï¼Œå®ƒä»¬æœ‰å¤–é”®å…³ç³»ï¼Œä½†æ˜¯ç”±äºä¸€å¼ è¡¨æ˜¯UTF-8å¦ä¸€å¼ è¡¨æ˜¯UTF-8mb4ï¼Œä¹Ÿä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆï¼›å®ƒä»¬çš„åŸå› éƒ½æ˜¯MySQLåœ¨è¿›è¡Œæ¯”è¾ƒçš„æ—¶å€™ï¼Œä¼šä½¿ç”¨å‡½æ•°å¯¹å­—æ®µè¿›è¡Œè½¬æ¢&lt;/li&gt;
&lt;li&gt;æ¨¡ç³ŠæŸ¥è¯¢ like â€˜%keyword%` æŸ¥è¯¢ä¸èƒ½æœ‰å‰ç½®çš„%ï¼Œå¦‚æœæ˜¯ like â€˜keyword%â€™ è¿™æ ·è¿˜æ˜¯å¯ä»¥ç”¨åˆ°ç´¢å¼•çš„&lt;/li&gt;
&lt;li&gt;ç´¢å¼•åˆ—é‡Œæœ‰å­—æ®µä¸ºnullï¼Œnullå€¼ä¸ä¼šåŠ å…¥åˆ°ç´¢å¼•ä¸­&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨orè¿æ¥æ¡ä»¶ï¼Œå¦‚æœorè¿æ¥çš„æ¡ä»¶ä¸­æœ‰ä¸€ä¸ªä¸æ˜¯ç´¢å¼•ï¼Œä¼šå¤±æ•ˆï¼Œå¯ä»¥æ”¹æˆä½¿ç”¨union allæ¥è¿æ¥ä¸¤æ¡sqlè¯­å¥&lt;/li&gt;
&lt;li&gt;ç»„åˆç´¢å¼•æ²¡æœ‰ä½“ç°æœ€å·¦åŒ¹é…&lt;/li&gt;
&lt;li&gt;is null / is not null å¯¹ç´¢å¼•ä½œåˆ¤æ–­&lt;/li&gt;
&lt;li&gt;ç´¢å¼•ä¸Šä½¿ç”¨  != æˆ–è€… &amp;lt;&amp;gt; è¿˜æœ‰not in&lt;/li&gt;
&lt;li&gt;ç´¢å¼•çš„å€¼åªæœ‰å‡ ç§æƒ…å†µï¼Œå¦‚æ€§åˆ«åªæœ‰ç”·å’Œå¥³ï¼Œè¿™ç§æƒ…å†µè™½ç„¶ä¹Ÿä¼šç”¨ç´¢å¼•ï¼Œåªæ˜¯æ„ä¹‰ä¸å¤§&lt;/li&gt;
&lt;li&gt;è¡¨çš„é‡çº§è¾ƒå°ï¼Œå­˜å‚¨å¼•æ“åˆ¤å®šä½¿ç”¨å…¨è¡¨æ‰«ææ›´å¿«&lt;/li&gt;
&lt;li&gt;æœ‰ä¸€caseï¼š1.select * from T where k in(1,2,3,4,5)ï¼›2.select * from T where k between 1 and 5ï¼Œkä¸ºç´¢å¼•ï¼Œä½†æ˜¯æ¨èä½¿ç”¨æ–¹æ³•2ï¼Œå› ä¸ºæ–¹æ³•1ä¼šå¯¼è‡´æ ‘æŸ¥5æ¬¡ï¼Œè€Œ2æ˜¯1æ¬¡&lt;/li&gt;
&lt;li&gt;å¯¹ç´¢å¼•å­—æ®µä½¿ç”¨äº†å‡½æ•°è¿›è¡Œè®¡ç®—ï¼Œå¯èƒ½ä¼šå¯¼è‡´MySQLä¸ä½¿ç”¨è¯¥ç´¢å¼•ï¼Œæˆ–è€…è¿›è¡Œäº†å…¨ç´¢å¼•æ‰«æï¼Œæ— æ³•ç”¨åˆ°ç´¢å¼•è¿›è¡Œå¿«é€Ÿå®šä½&lt;/li&gt;
&lt;li&gt;å¦‚æœæŸ¥è¯¢çš„å€¼çš„é•¿åº¦æ˜¯å¦å¤§äºç´¢å¼•å®šä¹‰çš„é•¿åº¦ï¼Œå¦‚æœå¤§äºï¼Œ&lt;strong&gt;è™½ç„¶ä¹Ÿä¼šèµ°ç´¢å¼•&lt;/strong&gt;ï¼Œå› ä¸ºMySQLæ˜¯å…ˆæŠŠæŸ¥è¯¢å€¼çš„é•¿åº¦æˆªæ–­æˆè·Ÿç´¢å¼•å®šä¹‰çš„é•¿åº¦ä¸€è‡´å»éå†ç´¢å¼•ï¼Œä½†æ˜¯å®ƒè¿˜è¦å†å›è¡¨å¾—åˆ°æ•°æ®è¿›è¡Œæ¯”è¾ƒï¼Œæ‰€ä»¥æŸ¥è¯¢ä¼šå¾ˆæ…¢&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;5ä¼˜åŒ–&#34;&gt;5.ä¼˜åŒ–&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;æ³¨æ„åŒºåˆ†åº¦ï¼Œè®¡ç®—ç´¢å¼•æœ€ä¼˜é•¿åº¦ï¼Œä½¿ç”¨è¿™ä¸ªè®¡ç®— &lt;code&gt;select count(distinct left(åˆ—å, ç´¢å¼•é•¿åº¦)) / count(*) from {tableå}&lt;/code&gt;ï¼Œ&lt;strong&gt;åŒºåˆ†åº¦è¶Šé«˜è¶Šå¥½&lt;/strong&gt;ï¼Œå¦å¤–ä½¿ç”¨å‰ç¼€ç´¢å¼•è™½ç„¶ä¼šå‡å°‘ç´¢å¼•å­˜å‚¨ç©ºé—´ï¼Œä½†æ˜¯å¯èƒ½ä¼šå¢åŠ æ‰«ææ¬¡æ•°æˆ–è€…è¦†ç›–ç´¢å¼•ä¸ç”Ÿæ•ˆ&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å½“è¡¨çš„å­—ç¬¦é›†ç¼–ç æˆ–è€…å±æ€§ä¸åŒæ—¶ï¼Œéœ€è¦æƒ³åŠæ³•æŠŠå‡½æ•°åŠ å†ç´¢å¼•å¯¹åº”çš„å€¼ä¸Šï¼Œè€Œä¸æ˜¯ç´¢å¼•å­—æ®µä¸Šï¼Œæˆ–è€…å»æ‰å‡½æ•°ï¼Œä½¿ç”¨å…¶ä»–æ–¹æ³•æ›¿ä»£&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å½“è¦å……å½“ç´¢å¼•çš„å­—æ®µåœ¨æŸäº›é•¿åº¦çš„åŒºåˆ†åº¦å¤ªå°æ—¶ï¼Œå¯ä»¥å¢åŠ ä¸€ä¸ªå­—æ®µï¼Œé‡‡ç”¨ç´¢å¼•å­—æ®µçš„å€’åºå­˜å‚¨æˆ–è€…hashçš„æ–¹æ³•æ¥å……å½“ç´¢å¼•ï¼Œç¼ºç‚¹æ˜¯æ— æ³•ä½¿ç”¨ç´¢å¼•è¿›è¡ŒèŒƒå›´æŸ¥è¯¢ï¼Œè€Œhashæ›´æ˜¯åªèƒ½æ”¯æŒç­‰å€¼æŸ¥è¯¢ï¼ŒæŸ¥è¯¢æ—¶éœ€è¦è¿›è¡Œé¢å¤–çš„è®¡ç®—ï¼Œä¹Ÿæ˜¯ä¸€ç§æ€§èƒ½æ¶ˆè€—&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç”±äºMySQLåœ¨é€‰æ‹©ç´¢å¼•çš„æ—¶å€™ä¼šæ ¹æ® ç´¢å¼•åŒºåˆ†åº¦ å’Œ ç´¢å¼•å¯¹åº”çš„é¢„ä¼°æ‰«æè¡Œæ•°ï¼ˆåŒ…æ‹¬å›è¡¨ï¼‰ï¼Œä½†æ˜¯æœ‰å¯èƒ½é¢„ä¼°çš„ç»“æœæ˜¯ä¸å‡†çš„ï¼Œå¦‚æœé€šè¿‡explainå‘½ä»¤å‘ç°rowsçš„å€¼ä¸æƒ³è±¡ä¸­çš„åå·®è¾ƒå¤§ï¼Œå¯ä»¥æ‰§è¡Œ&lt;code&gt;analyze table [tableName]&lt;/code&gt;æ¥é‡æ–°ç»Ÿè®¡ç´¢å¼•ä¿¡æ¯ï¼Œæˆ–è€…ä½¿ç”¨&lt;code&gt;force index([ç´¢å¼•åç§°])&lt;/code&gt;æ¥å¼ºåˆ¶ä½¿ç”¨ç´¢å¼•ï¼Œæˆ–è€…é‡å†™SQLï¼Œå¼•å¯¼MySQLä½¿ç”¨æ­£ç¡®çš„ç´¢å¼•&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ³¨æ„ç´¢å¼•çš„æœ€å·¦å‰ç¼€åŸåˆ™ï¼Œå¦‚æœåœ¨è®¾ç½®è”åˆç´¢å¼•æ—¶ï¼Œå¯ä»¥é€šè¿‡è°ƒæ•´é¡ºåºæ¥è¾¾åˆ°å°‘ç»´æŠ¤ä¸€ä¸ªç´¢å¼•ï¼Œæ‹¿è¿™ä¸ªé¡ºåºå°±å¯ä»¥ä¼˜å…ˆè€ƒè™‘ï¼Œå¦å¤–ä¸€ä¸ªè¦è€ƒè™‘çš„å°±æ˜¯ç´¢å¼•çš„å¤§å°&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å°½é‡çš„æ‰©å±•ç´¢å¼•ï¼Œä¸è¦æ–°å»ºç´¢å¼•ã€‚æ¯”å¦‚è¡¨ä¸­å·²ç»æœ‰açš„ç´¢å¼•ï¼Œç°åœ¨è¦åŠ (a,b)çš„ç´¢å¼•ï¼Œé‚£ä¹ˆåªéœ€è¦ä¿®æ”¹åŸæ¥çš„ç´¢å¼•å³å¯ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¯ç”¨MRRä¼˜åŒ–&lt;/strong&gt;ï¼šåœ¨MySQL 5.6ä¹‹åï¼Œä½¿ç”¨MRRè¿›è¡Œä¼˜åŒ–ï¼Œéœ€è¦è®¾ç½®&lt;code&gt;set optimizer_switch =&#39; mrr = on, mrr_cost_based = off, batched_key_access = on&#39;;&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;åœ¨æ²¡ä½¿ç”¨MRRä¼˜åŒ–å‰ï¼Œé€šè¿‡ç´¢å¼•å›è¡¨æ˜¯ä¸€è¡Œä¸€è¡Œå»æŸ¥çš„ï¼Œæ¯æ¬¡é€šè¿‡æ™®é€šç´¢å¼•æŸ¥åˆ°åçš„ä¸»é”®idæ˜¯æ— åºçš„ï¼Œå¤šæ¬¡å›è¡¨æŸ¥æ€§èƒ½ä¸å¤ªå¥½ï¼Œè€ŒMRRä¼˜åŒ–æŒ‡çš„æ˜¯ï¼Œå¦‚æœä¸»é”®ç´¢å¼•æœ‰åºï¼Œè®°å½•é€’å¢æ’å…¥ï¼Œåˆ™ä¼šå…ˆæ ¹æ®ç´¢å¼•æ‰¾åˆ°æ‰€æœ‰çš„idï¼Œå†å¯¹idè¿›è¡Œæ’åºï¼Œå†å›è¡¨æŸ¥ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä½¿ç”¨ä¸´æ—¶è¡¨ï¼Œå¦‚æœæ˜¯InnoDBå¼•æ“ï¼Œé‚£åˆ›å»ºçš„ä¸´æ—¶è¡¨æ˜¯å†™ç£ç›˜çš„ï¼Œå¦‚æœæ˜¯Memoryå¼•æ“ï¼Œåˆ™æ˜¯å†™å†…å­˜çš„ã€‚åˆ›å»ºè¯­å¥æ˜¯ &lt;code&gt;create temporary table Â·Â·Â·engine=xxx&lt;/code&gt;ï¼Œç”¨æ³•è·Ÿæ™®é€šè¡¨ç±»ä¼¼ï¼Œä½†ä»…åœ¨å½“å‰çº¿ç¨‹å¯è§ï¼Œshow tablesä¸æ˜¾ç¤ºä¸´æ—¶è¡¨ï¼Œå½“å½“å‰çº¿ç¨‹å¤„ç†å®Œæˆåï¼Œä¸´æ—¶è¡¨ä¼šè¢«æ¸…ç©ºï¼Œä½†ä¼šä¿ç•™è¡¨ç»“æ„ï¼Œå…è®¸åœ¨ä¸åŒçº¿ç¨‹é—´é‡åï¼Œå¦‚æœbin logæ ¼å¼æ˜¯statementæˆ–mixï¼Œæ“ä½œä¸´æ—¶è¡¨çš„è®°å½•ä¹Ÿä¼šè®°å½•åœ¨bin logï¼Œå¤‡åº“ä¹Ÿä¼šè·Ÿç€æ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å†…éƒ¨ä¸´æ—¶è¡¨å¸¸ç”¨äºä¸å¸¦ç´¢å¼•çš„ joinã€åˆ†åº“åˆ†è¡¨æ—¶çš„è”åˆæŸ¥è¯¢ã€unionæŸ¥è¯¢(å¯¹ä¸¤ä¸ªæŸ¥è¯¢ç»“æœæ±‚å¹¶é›†å¹¶å»é‡ï¼Œunion allåˆ™ä¸å»é‡)ã€group byæŸ¥è¯¢(order byå’Œgroup byå­å¥ä¸ä¸€æ ·æ—¶ä¹Ÿä¼š)ã€distinctæŸ¥è¯¢æ—¶åŠ ä¸Šorder byã€from ä¸­çš„å­å¥æŸ¥è¯¢ï¼ŒexplainæŸ¥è¯¢æŒ‡å‘è®¡åˆ’ç»“æœçš„extraåˆ—&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å½“æŸ¥è¯¢çš„æ•°æ®é‡æ¯”è¾ƒå¤§æ—¶ï¼Œé»˜è®¤ä¼šå…ˆä½¿ç”¨å†…å­˜ä¸´æ—¶è¡¨ï¼Œå‘ç°å¤ªå¤§åæ‰è½¬æˆç£ç›˜è¡¨ï¼Œå› æ­¤å¦‚æœæ•°æ®é‡å¤ªå¤§ï¼Œå¯ä»¥ä½¿ç”¨&lt;strong&gt;SQL_BIG_RESULT&lt;/strong&gt;ï¼ˆ &lt;code&gt;select SQL_BIG_RESULT å­—æ®µ from è¡¨ group by xxx&lt;/code&gt;ï¼‰å‘Šè¯‰MySQLå¼ºåˆ¶ä½¿ç”¨ç£ç›˜ä¸´æ—¶è¡¨&lt;/p&gt;
&lt;p&gt;ä¸€èˆ¬æƒ…å†µä¸‹è¿˜æ˜¯ä½¿ç”¨å†…å­˜è¡¨å¿«äº›ï¼Œé€šè¿‡è°ƒå¤§&lt;code&gt;tmp_table_size&lt;/code&gt;æ¥åŠ å¤§å†…å­˜ä¸´æ—¶è¡¨çš„å¤§å°ï¼Œé»˜è®¤æ˜¯16Mï¼Œè¿™ç§ä¸´æ—¶è¡¨æ˜¯ç”±MySQLæŸ¥è¯¢ç®—æ³•å†³å®šä½¿ç”¨çš„&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;group by æˆ–order byå¤šä¸ªå­—æ®µæ—¶ï¼Œéœ€è¦ä¸ºè¿™å¤šä¸ªå­—æ®µå»ºç»„åˆç´¢å¼•ï¼Œä¸ç„¶ä¹Ÿæ˜¯å…¨è¡¨æ‰«ï¼Œæ³¨æ„ order by æ— æ³•ä½¿ç”¨å‰ç¼€åŒ¹é…ç´¢å¼•ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç´¢å¼•æœ€å¥½è®¾ç½®ä¸º NOT NULLï¼ŒNULLå€¼çš„å­˜åœ¨ä¼šå¯¼è‡´ä¼˜åŒ–å™¨åšç´¢å¼•é€‰æ‹©æ›´å¤æ‚ï¼Œç´¢å¼•ç»Ÿè®¡æ—¶ï¼Œcountä¼šçœç•¥å€¼ä¸ºNULLçš„è¡Œï¼Œå¦å¤–ï¼ŒNULLå€¼æ— æ„ä¹‰ï¼Œä½†ä¼šå ç‰©ç†ç©ºé—´ï¼Œè‡³å°‘1å­—èŠ‚å­˜å‚¨ NULLå€¼åˆ—è¡¨ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å…³äºå¤§æ•°æ®é‡æ—¶çš„åˆ†é¡µï¼Œä¼˜åŒ–çš„æ€è·¯ä¹Ÿæ˜¯å°½å¯èƒ½çš„ä½¿ç”¨ç´¢å¼•ï¼Œæ¯”å¦‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;select * from table where id &amp;gt; (é¡µæ•°*é¡µé¢å¤§å°) order by id limit M&lt;/code&gt;ï¼Œ &lt;code&gt;order by&lt;/code&gt; ä½¿å¾—ç»“æœç¨³å®šï¼›&lt;/li&gt;
&lt;li&gt;&lt;code&gt;select * from table where id &amp;gt; (select ID from table order by id limit M, 1) order by id limit n&lt;/code&gt;ï¼Œå…ˆåˆ©ç”¨å­æŸ¥è¯¢æŠŠidæŸ¥å‡ºæ¥ï¼Œä¾é idä¸Šçš„é¡ºåºï¼Œå¤–å±‚æ•ˆæœè·Ÿä¸Šé¢çš„ç±»ä¼¼&lt;/li&gt;
&lt;li&gt;&lt;code&gt;select * from table where id in (select id from table limit M, N)&lt;/code&gt;ï¼ŒåŒæ ·ä¹Ÿæ˜¯åˆ©ç”¨idä¸Šçš„ç´¢å¼•ï¼Œè¦†ç›–ç´¢å¼•ï¼ŒåªæŸ¥ä¸»é”®æ—¶ï¼Œæ•ˆç‡å¾ˆé«˜ã€‚&lt;/li&gt;
&lt;li&gt;æ™®é€šæŸ¥è¯¢è¿”å›æ˜¯ä¼šç­‰æ•´ä¸ªç»“æœé›†éƒ½æŸ¥è¯¢å®Œæ¯•æ‰ä¼šè¿”å›ï¼Œå¯èƒ½ä¼šå¯¼è‡´å®¢æˆ·ç«¯ç›´æ¥OOMï¼Œso å¯ä»¥é‡‡ç”¨æµå¼è¿”å›ï¼Œè¾¹æŸ¥è¾¹è¿”å›ï¼Œå®¢æˆ·ç«¯å¯ä»¥æ ¹æ®æŸ¥åˆ°çš„ç»“æœå…ˆè¿›è¡Œä¸šåŠ¡å¤„ç†ï¼ŒåŠæ—¶å›æ”¶å†…å­˜ï¼Œé¿å…OOMï¼›ä½†æ˜¯æµå¼æŸ¥è¯¢è¿”å›æœ‰ä¸ªé—®é¢˜å°±æ˜¯MySQLå¹¶ä¸æ¸…æ¥šå®¢æˆ·ç«¯ä»€ä¹ˆæ—¶å€™ä¼šå…³é—­ï¼Œæ‰€ä»¥MySQLä¼šæŒç»­å ç”¨è¿™æ¡è¿æ¥å’Œä½¿ç”¨é¢å¤–çš„å†…å­˜æˆ–ç£ç›˜æ¥å­˜å‚¨æµå¼æŸ¥è¯¢çš„ç»“æœï¼ŒæŒç»­çš„æŸ¥è¯¢ä¹Ÿå¯èƒ½å¯¼è‡´CPUæ¶ˆè€—ï¼Œæ¶ˆè€—è¾ƒå¤§ï¼›ä¸¤è€…åœ¨æŸ¥è¯¢ä¸Šçš„è€—æ—¶æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯å¯¹å®¢æˆ·ç«¯å‹ä¸å‹å¥½è€Œå·²ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;6åˆ†æ&#34;&gt;6.åˆ†æ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;explain + SQLè¯­å¥&lt;/code&gt;ï¼Œç»™å‡ºè¯¥SQLè¯­å¥çš„åˆ†æç»“æœï¼Œçœ‹çœ‹æŸ¥è¯¢çš„ç±»å‹ï¼Œæœ‰æ²¡æœ‰ç”¨åˆ°ç´¢å¼•ï¼Œæ˜¯ä¸æ˜¯å…¨è¡¨æ‰«æ&lt;/p&gt;
&lt;p&gt;æ¯”è¾ƒé‡è¦çš„å­—æ®µï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;select_type&lt;/strong&gt;ï¼šæŸ¥è¯¢ç±»å‹ï¼Œå¦‚ SIMPLEï¼ˆç®€å•æŸ¥è¯¢ï¼‰ã€PRIMARYï¼ˆå½“å­˜åœ¨å­æŸ¥è¯¢æ—¶ï¼Œæœ€å¤–é¢çš„æŸ¥è¯¢è¢«æ ‡è®°ä¸ºä¸»æŸ¥è¯¢ï¼‰ã€UNIONï¼ˆè”åˆæŸ¥è¯¢ï¼Œå½“ä¸€ä¸ªæŸ¥è¯¢åœ¨UNIONå…³é”®å­—åå°±ä¼šå‡ºç°ï¼‰ã€SUBQUERYï¼ˆå­æŸ¥è¯¢ï¼‰ã€DERVIEDï¼ˆæ„é€ è¡¨ï¼Œä¸€ä¸ªæŸ¥è¯¢è¯­å¥å½¢æˆçš„ç»“æœé›†ï¼‰ç­‰ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;type&lt;/strong&gt;ï¼šè®¿é—®ç±»å‹ï¼Œ ä»å·¦åˆ°å³ï¼ŒæŸ¥è¯¢æ€§èƒ½ä¾æ¬¡å‡å¼±ï¼Œä¸€ä¸ªå¥½çš„SQLèµ·ç å¾—è¾¾åˆ°rangeçº§ï¼›&lt;/p&gt;
&lt;p&gt;&lt;code&gt;NULL &amp;gt; system &amp;gt; const &amp;gt; eq_ref &amp;gt; ref &amp;gt; ref_or_null &amp;gt; index_merge &amp;gt; range &amp;gt; index &amp;gt; ALL&lt;/code&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;NULL&lt;/strong&gt;ï¼šMySQLåœ¨ä¼˜åŒ–é˜¶æ®µåˆ†è§£æŸ¥è¯¢è¯­å¥ï¼Œåœ¨æ‰§è¡Œé˜¶æ®µç”¨ä¸ç€å†è®¿é—®è¡¨å’Œç´¢å¼•ï¼Œæ¯”å¦‚&lt;code&gt;explain SELECT 5*7&lt;/code&gt;è¿™ç§&lt;strong&gt;å•çº¯åšè®¡ç®—&lt;/strong&gt;çš„ï¼Œä¸€èˆ¬ç”¨åœ¨å·²å»ºç«‹ç´¢å¼•çš„æƒ…å†µä¸‹ï¼ŒæŸ¥æ‰¾ç´¢å¼•çš„æœ€å¤§å€¼å’Œæœ€å°å€¼ï¼Œå› ä¸ºMySQLç›´æ¥æŸ¥æ‰¾B+æ ‘æœ€è¾¹ä¸Šçš„å¶å­èŠ‚ç‚¹å°±èƒ½çŸ¥é“äº†ï¼Œæ¯”å¦‚&lt;code&gt;EXPLAIN SELECT MAX(id) FROM student&lt;/code&gt;ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;const&lt;/strong&gt;ï¼šè¡¨ç¤ºé€šè¿‡ç´¢å¼•ä¸€æ¬¡å°±æ‰¾åˆ°äº†ï¼Œä¸€èˆ¬æ˜¯æŸ¥è¯¢æ¡ä»¶æ˜¯&lt;strong&gt;ä¸»é”®æˆ–è€…å”¯ä¸€ç´¢å¼•&lt;/strong&gt;çš„åœºæ™¯ä¸‹ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;eq_ref&lt;/strong&gt;ï¼šè”è¡¨æŸ¥è¯¢ï¼ŒæŒ‰&lt;strong&gt;è¿è¡¨çš„ä¸»é”®æˆ–å”¯ä¸€é”®è”åˆæŸ¥è¯¢&lt;/strong&gt;ï¼Œå½“ä¸»é”®æˆ–å”¯ä¸€é&lt;code&gt;NULL&lt;/code&gt;ç´¢å¼•çš„æ‰€æœ‰å­—æ®µéƒ½è¢«ç”¨ä½œ&lt;code&gt;join&lt;/code&gt;è”æ¥æ—¶ä¼šä½¿ç”¨æ­¤ç±»å‹ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ref&lt;/strong&gt;ï¼šè¡¨ç¤ºå•è¡¨æ‰«ææˆ–è€…è¡¨é—´çš„è¿æ¥åŒ¹é…æ¡ä»¶æ—¶ç”¨åˆ°&lt;strong&gt;æ™®é€šç´¢å¼•æˆ–è€…å”¯ä¸€ç´¢å¼•çš„å‰ç¼€åŒ¹é…&lt;/strong&gt;ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;index_merge&lt;/strong&gt;ï¼š&lt;strong&gt;ç´¢å¼•åˆå¹¶ï¼Œ è¡¨ç¤ºæŸ¥è¯¢ä½¿ç”¨äº†ä¸¤ä¸ªä»¥ä¸Šçš„ç´¢å¼•&lt;/strong&gt;ï¼Œæœ€åå–äº¤é›†æˆ–è€…å¹¶é›†ï¼Œå¸¸è§&lt;code&gt;and &lt;/code&gt;ï¼Œ&lt;code&gt;or&lt;/code&gt;çš„æ¡ä»¶ä½¿ç”¨äº†ä¸åŒçš„ç´¢å¼•ï¼›&lt;/p&gt;
&lt;p&gt;5.0åæ‰æœ‰çš„åŠŸèƒ½ï¼Œä½¿å¾—MySQLå¯ä»¥åœ¨ä¸€æ¬¡æŸ¥è¯¢ç§ä½¿ç”¨å¤šä¸ªç´¢å¼•ï¼Œä½†æ˜¯ä½¿ç”¨åœºæ™¯æ¯”è¾ƒå±€é™ï¼Œå¤šå‘ç”Ÿåœ¨æŸ¥è¯¢æ¡ä»¶æ¶‰åŠå¤šä¸ªandå’Œorçš„åœºæ™¯&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;range&lt;/strong&gt;ï¼š&lt;strong&gt;ç´¢å¼•èŒƒå›´æŸ¥è¯¢&lt;/strong&gt;ï¼Œå¸¸è§äºä½¿ç”¨ =, &amp;lt;&amp;gt;, &amp;gt;, &amp;gt;=, &amp;lt;, &amp;lt;=, IS NULL, &amp;lt;=&amp;gt;, BETWEEN, IN()æˆ–è€…likeç­‰è¿ç®—ç¬¦çš„æŸ¥è¯¢ä¸­ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;index&lt;/strong&gt;ï¼š &lt;strong&gt;ç´¢å¼•è¡¨å…¨è¡¨æ‰«æ&lt;/strong&gt;ï¼Œé€šå¸¸æ¯” All å¿«ã€‚å› ä¸ºç´¢å¼•æ–‡ä»¶é€šå¸¸æ¯”æ•°æ®æ–‡ä»¶å°ï¼Œå³ all å’Œ index éƒ½æ˜¯è¯»å…¨è¡¨ï¼Œä½† index æ˜¯ä»ç´¢å¼•ä¸­è¯»å–çš„ï¼Œè€Œ all æ˜¯ä»ç¡¬ç›˜è¯»çš„ï¼Œæ¯”å¦‚ count æŸ¥è¯¢ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;all&lt;/strong&gt;ï¼š&lt;strong&gt;å…¨è¡¨æ‰«æ&lt;/strong&gt;ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;possible_keys&lt;/strong&gt;ï¼šèƒ½ä½¿ç”¨å“ªä¸ªç´¢å¼•æ‰¾åˆ°è¡Œï¼ŒæŸ¥è¯¢æ¶‰åŠåˆ°å­—æ®µä¸Šè‹¥å­˜åœ¨ç´¢å¼•ï¼Œåˆ™è¯¥ç´¢å¼•å°†è¢«åˆ—å‡ºï¼Œä½†ä¸ä¸€å®šè¢«æŸ¥è¯¢ä½¿ç”¨ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;key&lt;/strong&gt;ï¼šç´¢å¼•åˆ—çš„åç§°ï¼Œå¦‚æœæ²¡æœ‰ä½¿ç”¨ç´¢å¼•ï¼Œæ˜¾ç¤ºä¸ºNULLï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;key_len&lt;/strong&gt;ï¼šä½¿ç”¨åˆ°ç´¢å¼•çš„é•¿åº¦ï¼Œå¯ä»¥çœ‹å‡ºç´¢å¼•æ˜¯å¦ä½¿ç”¨å¾—å……åˆ†ï¼Œæ¯”å¦‚è™½ç„¶ç”¨åˆ°äº†è”åˆç´¢å¼•ï¼Œä½†æ˜¯åªç”¨åˆ°äº†ç¬¬ä¸€ä¸ªå­—æ®µä½œä¸ºç´¢å¼•ï¼Œè¯´æ˜æ²¡æœ‰ä½¿ç”¨åˆ°æ‰€ä»¥ç´¢å¼•ï¼Œç´¢å¼•ä½¿ç”¨ä¸å……åˆ†ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ref&lt;/strong&gt;ï¼šè¡¨ç¤ºä¸Šè¿°è¡¨çš„è¿æ¥åŒ¹é…æ¡ä»¶ï¼Œå³å“ªäº›åˆ—æˆ–å¸¸é‡è¢«ç”¨äºæŸ¥æ‰¾ç´¢å¼•åˆ—ä¸Šçš„å€¼&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;rows&lt;/strong&gt;ï¼šæ‰«æçš„è¡Œæ•°&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;filtered&lt;/strong&gt;ï¼šæŸ¥è¯¢å‡ºçš„è¡Œæ•°å è¡¨çš„ç™¾åˆ†æ¯”&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;extra&lt;/strong&gt;ï¼šé¢å¤–ä¿¡æ¯è¯´æ˜&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;using indexï¼šä½¿ç”¨åˆ°äº†è¦†ç›–ç´¢å¼•ï¼›&lt;/li&gt;
&lt;li&gt;using temporaryï¼šå¯¹æŸ¥è¯¢ç»“æœæ’åºæ—¶ä½¿ç”¨äº†ä¸´æ—¶è¡¨ï¼ŒæŸ¥è¯¢æ•ˆç‡æ¯”filesortè¿˜ä½ï¼Œå¸¸è§äºorder byå’Œgroup byï¼ŒæŸ¥è¯¢æ•ˆç‡ä¸é«˜ï¼›&lt;/li&gt;
&lt;li&gt;using filesortï¼šå½“æŸ¥è¯¢è¯­å¥åŒ…å« group byï¼Œä¸”æ— æ³•åˆ©ç”¨ç´¢å¼•å®Œæˆæ’åºæ“ä½œæ—¶ï¼Œä¼šä½¿ç”¨å¤–éƒ¨æ’åºï¼Œé€šè¿‡ç£ç›˜å’Œå†…å­˜äº¤æ¢æ•°æ®æ¥æ’åºï¼ŒæŸ¥è¯¢æ•ˆç‡ä¸é«˜ï¼›&lt;/li&gt;
&lt;li&gt;using index conditionï¼šä½¿ç”¨äº†ç´¢å¼•ä¸‹æ¨ï¼›&lt;/li&gt;
&lt;li&gt;using join bufferï¼ˆblock nested loopï¼‰ï¼šä½¿ç”¨joinè¿è¡¨ï¼Œå¹¶ä½¿ç”¨äº†ç¼“å†²åŒºï¼›&lt;/li&gt;
&lt;li&gt;using unionï¼šä½¿ç”¨ç´¢å¼•å¹¶å–å¹¶é›†ï¼›&lt;/li&gt;
&lt;li&gt;using sort_union ï¼šå…ˆå¯¹å–å‡ºçš„æ•°æ®æŒ‰rowidæ’åºï¼Œç„¶åå†å–å¹¶é›†ï¼›&lt;/li&gt;
&lt;li&gt;using intersect ï¼šç´¢å¼•å–äº¤é›†ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;show processlist&lt;/code&gt;ï¼Œæ­¤å‘½ä»¤ç”¨äºæŸ¥çœ‹ç›®å‰æ‰§è¡Œçš„sqlè¯­å¥æ‰§è¡Œçš„çŠ¶æ€ï¼Œæ¯”å¦‚å½“CPUä½¿ç”¨ç‡é£™å‡æ—¶ï¼Œå¯é€šè¿‡è¯¥å‘½ä»¤æŸ¥çœ‹å“ªäº›SQLè¯­å¥åœ¨æ‰§è¡Œ&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;show status&lt;/code&gt;ï¼ŒæŸ¥çœ‹æ•°æ®åº“è¿è¡Œçš„å®æ—¶çŠ¶æ€ï¼Œæ¯”å¦‚æŸ¥è¯¢è¿è¡ŒæœŸé—´SQLçš„æ‰§è¡Œæ¬¡æ•°ã€è¿æ¥æ•°ã€ç¼“å­˜å†…çš„çº¿ç¨‹æ•°é‡ã€è¿æ¥æ•°ç­‰ï¼Œå…·ä½“çœ‹ &lt;a class=&#34;link&#34; href=&#34;https://www.jianshu.com/p/836f07dd89ec&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;mysql SHOW STATUS å˜é‡&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;show variables&lt;/code&gt;ï¼ŒæŸ¥çœ‹ç³»ç»Ÿå‚æ•°ï¼Œä¸€äº›é™æ€å‚æ•°ï¼Œæ¯”å¦‚å¼€å¯æ…¢æŸ¥è¯¢ï¼Œè®¾ç½®ç´¢å¼•ç¼“å†²åŒºå¤§å°ï¼Œå…·ä½“å‚è€ƒï¼š&lt;a class=&#34;link&#34; href=&#34;https://baike.xsoftlab.net/view/218.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Mysql show variableså‘½ä»¤è¯¦è§£&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;performance_schemaå’Œsysç³»ç»Ÿåº“&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;MySQLå¯åŠ¨å‰éœ€è¦è®¾ç½®&lt;code&gt;performance_schema=on&lt;/code&gt;ï¼Œä½†æ˜¯æ€§èƒ½ä¼šæ¯”offå°‘10%ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æŸ¥è¯¢&lt;code&gt;sys.schema_table_lock_waits&lt;/code&gt;ã€&lt;code&gt;sys.innodb_lock_waitsè¡¨&lt;/code&gt;å¯ä»¥çŸ¥é“é‚£æ¡è¯­å¥åœ¨å ç”¨é”ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æŸ¥çœ‹ &lt;code&gt;information_schema.innodb_trxè¡¨&lt;/code&gt;å¯ä»¥çœ‹åˆ°äº‹åŠ¡å…·ä½“çš„çŠ¶æ€ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä½¿ç”¨&lt;code&gt;show engine innodb status&lt;/code&gt;æŸ¥çœ‹æ•°æ®åº“è¯·æ±‚æƒ…å†µ&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä½¿ç”¨&lt;code&gt;show status like &#39;innodb_row_lock%&#39;;&lt;/code&gt;æŸ¥è¯¢è¡Œé”ç«äº‰æƒ…å†µ&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä½¿ç”¨&lt;code&gt;show status like &#39;table%&#39;;&lt;/code&gt;æŸ¥è¯¢è¡¨é”ç«äº‰æƒ…å†µ&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;select trx_id,trx_state,trx_started,trx_wait_started,trx_operation_state,trx_tables_in_use,trx_rows_locked,trx_rows_modified,trx_query from information_schema.innodb_trx;&lt;/code&gt;æŸ¥è¯¢å½“å‰äº‹åŠ¡æƒ…å†µ&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;select * from information_schema.innodb_lock_waits;&lt;/code&gt;æŸ¥çœ‹é”ç­‰å¾…å¯¹åº”å…³ç³»&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;select * from information_schema.innodb_locks;&lt;/code&gt;æŸ¥çœ‹å½“å‰å‡ºç°çš„é”&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å½“æœ‰è¯­å¥æ‰§è¡Œè¿‡ä¹…æˆ–æœ‰è¯­å¥ä¸€ç›´è¢«é˜»å¡æ—¶ï¼Œå¯ä»¥killæ‰å®ƒ&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨kill query/connection + çº¿ç¨‹idç»ˆæ­¢è¯­å¥æˆ–è¿æ¥ï¼Œä½†killä¸æ˜¯ç›´æ¥ç»ˆæ­¢çº¿ç¨‹ï¼Œåªæ˜¯å‘Šè¯‰è¯¥çº¿ç¨‹è¿™æ¡è¯­å¥ä¸ç”¨ç»§ç»­æ‰§è¡Œäº†ï¼ŒMySQLä¼šåœ¨æ‰§è¡Œé€»è¾‘ä¸Šæ‰“ä¸Šæ–­ç‚¹æ ‡è®°ï¼Œçº¿ç¨‹æ‰§è¡Œåˆ°è¯¥ä½ç½®ï¼Œæ‰ä¼šåˆ¤æ–­çŠ¶æ€æ˜¯å¦æ˜¯å¤„äºè¢«killçŠ¶æ€ï¼Œç„¶åè¿›è¡Œæ”¶å°¾å·¥ä½œï¼Œæ¯”å¦‚é‡Šæ”¾æ‰ä¹‹å‰æŒæœ‰çš„é”&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ…¢æŸ¥è¯¢åˆ†æ&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ‰“å¼€ï¼š&lt;code&gt;set global slow_query_log=&#39;ON&#39;&lt;/code&gt;ï¼Œä¸´æ—¶å¼€å¯ï¼Œæ— éœ€é‡å¯ï¼Œæ°¸ä¹…å¼€å¯åˆ™åœ¨my.cnfæ–‡ä»¶é‡Œè®¾ç½®&lt;/p&gt;
&lt;p&gt;è®¾ç½®æ—¥å¿—å­˜æ”¾ä½ç½®ï¼š&lt;code&gt;set global slow_query_log_file=&#39;/usr/local/mysql/data/slow.log&#39;;&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;è®¾ç½®è¶…è¿‡xç§’å°±ä¼šè®°å½•åˆ°æ…¢æŸ¥è¯¢æ—¥å¿—ä¸­ï¼š&lt;code&gt;set global long_query_time=x;&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;æŸ¥çœ‹æ…¢æŸ¥è¯¢ç›¸å…³è®¾ç½®ï¼š&lt;code&gt;show variables like &#39;slow_query%&#39;;&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;æ…¢æŸ¥è¯¢æ—¥å¿—åˆ†æå·¥å…·ï¼šmysqlslaã€mysqldumpslow&lt;/p&gt;
&lt;p&gt;æ…¢æŸ¥è¯¢æ—¥å¿—ä¸­ï¼Œ&lt;strong&gt;rows_examined&lt;/strong&gt;å­—æ®µï¼Œè¡¨ç¤ºæŸä¸ªè¯­å¥æ‰§è¡Œè¿‡ç¨‹ä¸­æ‰«æäº†å¤šå°‘è¡Œ&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://tech.meituan.com/2014/06/30/mysql-index.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;MySQLç´¢å¼•åŸç†åŠæ…¢æŸ¥è¯¢ä¼˜åŒ–&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;å­˜å‚¨å¼•æ“&#34;&gt;å­˜å‚¨å¼•æ“&lt;/h1&gt;
&lt;h2 id=&#34;1myisam&#34;&gt;1.MyISAM&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;è®¾è®¡ç®€å•ï¼Œæ•°æ®ä»¥ç´§å¯†æ ¼å¼å­˜å‚¨ã€‚å¯¹äºåªè¯»æ•°æ®ï¼Œæˆ–è€…è¡¨æ¯”è¾ƒå°ã€å¯ä»¥å®¹å¿ä¿®å¤æ“ä½œï¼Œåˆ™ä¾ç„¶å¯ä»¥ä½¿ç”¨å®ƒã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æä¾›äº†å¤§é‡çš„ç‰¹æ€§ï¼ŒåŒ…æ‹¬å‹ç¼©è¡¨ã€ç©ºé—´æ•°æ®ç´¢å¼•ç­‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¸æ”¯æŒäº‹åŠ¡ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¸æ”¯æŒè¡Œçº§é”ï¼Œåªèƒ½å¯¹æ•´å¼ è¡¨åŠ é”ï¼Œè¯»å–æ—¶ä¼šå¯¹éœ€è¦è¯»åˆ°çš„æ‰€æœ‰è¡¨åŠ å…±äº«é”ï¼Œå†™å…¥æ—¶åˆ™å¯¹è¡¨åŠ æ’å®ƒé”ã€‚ä½†åœ¨è¡¨æœ‰è¯»å–æ“ä½œçš„åŒæ—¶ï¼Œä¹Ÿå¯ä»¥å¾€è¡¨ä¸­æ’å…¥æ–°çš„è®°å½•ï¼Œè¿™è¢«ç§°ä¸ºå¹¶å‘æ’å…¥ï¼ˆCONCURRENT INSERTï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¯ä»¥æ‰‹å·¥æˆ–è€…è‡ªåŠ¨æ‰§è¡Œæ£€æŸ¥å’Œä¿®å¤æ“ä½œï¼Œä½†æ˜¯å’Œäº‹åŠ¡æ¢å¤ä»¥åŠå´©æºƒæ¢å¤ä¸åŒï¼Œå¯èƒ½å¯¼è‡´ä¸€äº›æ•°æ®ä¸¢å¤±ï¼Œè€Œä¸”ä¿®å¤æ“ä½œæ˜¯éå¸¸æ…¢çš„ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦‚æœæŒ‡å®šäº† &lt;code&gt;DELAY_KEY_WRITE&lt;/code&gt;é€‰é¡¹ï¼Œåœ¨æ¯æ¬¡ä¿®æ”¹æ‰§è¡Œå®Œæˆæ—¶ï¼Œä¸ä¼šç«‹å³å°†ä¿®æ”¹çš„ç´¢å¼•æ•°æ®å†™å…¥ç£ç›˜ï¼Œè€Œæ˜¯ä¼šå†™åˆ°å†…å­˜ä¸­çš„é”®ç¼“å†²åŒºï¼Œåªæœ‰åœ¨æ¸…ç†é”®ç¼“å†²åŒºæˆ–è€…å…³é—­è¡¨çš„æ—¶å€™æ‰ä¼šå°†å¯¹åº”çš„ç´¢å¼•å—å†™å…¥ç£ç›˜ã€‚è¿™ç§æ–¹å¼å¯ä»¥æå¤§çš„æå‡å†™å…¥æ€§èƒ½ï¼Œä½†æ˜¯åœ¨æ•°æ®åº“æˆ–è€…ä¸»æœºå´©æºƒæ—¶ä¼šé€ æˆç´¢å¼•æŸåï¼Œéœ€è¦æ‰§è¡Œä¿®å¤æ“ä½œã€‚&lt;/p&gt;
&lt;h2 id=&#34;2innodb&#34;&gt;2.InnoDB&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;æ˜¯ MySQL é»˜è®¤çš„äº‹åŠ¡å‹å­˜å‚¨å¼•æ“ï¼Œåªæœ‰åœ¨éœ€è¦å®ƒä¸æ”¯æŒçš„ç‰¹æ€§æ—¶ï¼Œæ‰è€ƒè™‘ä½¿ç”¨å…¶å®ƒå­˜å‚¨å¼•æ“ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å®ç°äº†å››ä¸ªæ ‡å‡†çš„éš”ç¦»çº§åˆ«ï¼Œé»˜è®¤çº§åˆ«æ˜¯å¯é‡å¤è¯»ï¼ˆREPEATABLE READï¼‰ã€‚åœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹ï¼Œé€šè¿‡å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼ˆMVCCï¼‰+ é—´éš™é”ï¼ˆNext-Key Lockingï¼‰é˜²æ­¢å¹»è¯»ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¸»ç´¢å¼•æ˜¯èšç°‡ç´¢å¼•ï¼Œåœ¨ç´¢å¼•ä¸­ä¿å­˜äº†æ•°æ®ï¼Œä»è€Œé¿å…ç›´æ¥è¯»å–ç£ç›˜ï¼Œå› æ­¤å¯¹æŸ¥è¯¢æ€§èƒ½æœ‰å¾ˆå¤§çš„æå‡ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å†…éƒ¨åšäº†å¾ˆå¤šä¼˜åŒ–ï¼ŒåŒ…æ‹¬ä»ç£ç›˜è¯»å–æ•°æ®æ—¶é‡‡ç”¨çš„å¯é¢„æµ‹æ€§è¯»ã€èƒ½å¤ŸåŠ å¿«è¯»æ“ä½œå¹¶ä¸”è‡ªåŠ¨åˆ›å»ºçš„è‡ªé€‚åº”å“ˆå¸Œç´¢å¼•ã€èƒ½å¤ŸåŠ é€Ÿæ’å…¥æ“ä½œçš„æ’å…¥ç¼“å†²åŒºç­‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ”¯æŒçœŸæ­£çš„åœ¨çº¿çƒ­å¤‡ä»½ã€‚å…¶å®ƒå­˜å‚¨å¼•æ“ä¸æ”¯æŒåœ¨çº¿çƒ­å¤‡ä»½ï¼Œè¦è·å–ä¸€è‡´æ€§è§†å›¾éœ€è¦åœæ­¢å¯¹æ‰€æœ‰è¡¨çš„å†™å…¥ï¼Œè€Œåœ¨è¯»å†™æ··åˆåœºæ™¯ä¸­ï¼Œåœæ­¢å†™å…¥å¯èƒ½ä¹Ÿæ„å‘³ç€åœæ­¢è¯»å–ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;å…³äºæœ‰æ—¶æ›´æ–°æˆ–è€…æŸ¥è¯¢æ—¶çªç„¶å˜æ…¢çš„åŸå› &lt;/strong&gt;ï¼šé¦–å…ˆï¼ŒInnoDBæ›´æ–°é‡‡ç”¨WALæœºåˆ¶ï¼Œæ›´æ–°redo logå’Œè¡¨æ•°æ®æ—¶éƒ½æ˜¯å…ˆå†™åˆ°bufferï¼Œå†flushåˆ°ç£ç›˜ï¼ŒåŸå› å°±æ˜¯å‡ºåœ¨flushç£ç›˜ä¸Šï¼Œå½“redo logæ»¡äº†ï¼Œæˆ–è€…å†…å­˜æ»¡äº†ï¼Œè„é¡µå¤ªå¤šï¼Œéƒ½ä¼šå°†å†…å­˜é‡Œçš„æ•°æ®flushåˆ°ç£ç›˜ï¼Œä»¥è…¾å‡ºç©ºé—´ï¼Œå¦‚æœè¦åˆ·çš„æ•°æ®ç‰¹åˆ«å¤šï¼Œé‚£æ¶ˆè€—çš„æ—¶é—´å°±é•¿ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;è§£å†³æ–¹æ³•&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;è®¾ç½®åˆ° &lt;code&gt;innodb_io_capacity&lt;/code&gt; å‚æ•°ï¼Œè¯¥å‚æ•°ä¼šå‘Šè¯‰InnoDBæœºå™¨çš„ç£ç›˜èƒ½åŠ›ï¼Œå¯ä»¥ä½¿ç”¨fioå·¥å…·æµ‹å‡º ï¼›&lt;/li&gt;
&lt;li&gt;æ§åˆ¶è„é¡µçš„æ¯”ä¾‹ï¼Œè®¾ç½® &lt;code&gt;innodb_max_dirty_pages_pct&lt;/code&gt; çš„å€¼ï¼Œé»˜è®¤æ˜¯75%ï¼Œè¾¾åˆ°äº†å°±ä¼šåˆ·ï¼›&lt;/li&gt;
&lt;li&gt;. åˆ·æ–°è„é¡µæ—¶æ˜¯å¦ä¼šé€’å½’æ£€æµ‹éš”å£æ•°æ®é¡µæ˜¯å¦ä¹Ÿæ˜¯è„é¡µï¼Œå¦‚æœæ˜¯ä¼šè¿ç€ä¸€èµ·åˆ·ï¼Œé€šè¿‡ &lt;code&gt;innodb_flush_neighbors=1&lt;/code&gt;è¡¨ç¤ºé‡‡ç”¨è¿™ç§æœºåˆ¶ï¼Œ=0è¡¨ç¤ºåªä¼šåˆ·è‡ªå·±ï¼Œè¿™ä¸ªæœºåˆ¶å¯¹æœºæ¢°ç¡¬ç›˜å…³ç³»æ¯”è¾ƒå¤§ï¼ŒSSDåˆ™ä¸ä¼šï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;å…³äºInnoDBçš„åˆ é™¤&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;&lt;code&gt;innodb_file_per_table=OFF&lt;/code&gt;ï¼šè¡¨ç¤ºè¡¨æ•°æ®æ”¾åœ¨ç³»ç»Ÿå…±äº«è¡¨ç©ºé—´ï¼Œ=onè¡¨ç¤ºå„ä¸ªè¡¨ç©ºé—´æ”¾åœ¨ç‹¬ç«‹æ–‡ä»¶ä¸‹ï¼Œåç¼€åæ˜¯ .ibd ï¼Œä¸€èˆ¬è®¾ç½®=onï¼Œä¾¿äºç®¡ç†ã€‚&lt;/p&gt;
&lt;p&gt;å½“æˆ‘ä»¬ä½¿ç”¨deleteåˆ é™¤æ•°æ®æ—¶ï¼ŒInnoDBå®é™…ä¸Šæ˜¯æŠŠæ•°æ®é¡µä¸Šçš„è¯¥æ•°æ®æ ‡è®°ä¸ºåˆ é™¤ï¼Œè¡¨ç¤ºè¯¥ä½ç½®å¯ä»¥è¿›è¡Œå¤ç”¨ï¼Œæ­¤æ—¶ç£ç›˜ä¸Šçš„æ–‡ä»¶å¹¶ä¸ä¼šå˜å°ï¼Œå½“æ•°æ®éšæœºæ’å…¥æ—¶ä¼šå› ä¸ºé¡µåˆ†è£‚ï¼Œåˆ†è£‚åçš„é¡µå¯èƒ½å­˜ä¸æ»¡æ•°æ®ï¼Œå°±ä¼šæ ‡è®°æŸäº›ä½å¯å¤ç”¨ï¼Œå¯¼è‡´é¡µçš„åˆ©ç”¨ç‡ä¸é«˜ï¼Œå½“æœ‰å¤§é‡çš„å¢åˆ æ—¶ï¼Œä¼šå¯¼è‡´æ•°æ®é¡µå­˜åœ¨å¤§é‡ç©ºæ´ï¼Œä¸ºäº†å‹ç¼©ç©ºé—´ï¼Œæ­¤æ—¶çš„è§£å†³åŠæ³•æ˜¯é‡å»ºè¡¨ï¼Œä¸€èˆ¬ä½¿ç”¨&lt;code&gt;alter table [tableName] enging=InnoDB&lt;/code&gt;è¾¾åˆ°é‡å»ºçš„ç›®çš„ï¼ŒMySQLä¼šè‡ªåŠ¨åˆ›å»ºä¸´æ—¶è¡¨ï¼Œè¿›è¡Œæ•°æ®è½¬å­˜ï¼Œäº¤æ¢è¡¨åï¼Œåˆ é™¤æ—§è¡¨ï¼Œæ­¤æ—¶ä¼šé˜»å¡ï¼Œé˜»æ­¢å¢åˆ æ”¹ï¼Œ&lt;strong&gt;5.56ç‰ˆæœ¬åä½¿ç”¨onlineDDLæœºåˆ¶&lt;/strong&gt;ï¼Œè§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œè§£å†³æ–¹æ³•æ˜¯ä½¿ç”¨redo logè®°å½•æ–°æ’å…¥çš„æ•°æ® + MDLè¯»é”(å†™é”ä¼šé€€åŒ–) + IO + CPU&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å››å¤§ç‰¹æ€§&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;æ’å…¥ç¼“å†²ï¼šä½¿ç”¨change bufferï¼Œå¯¹insertã€deleteã€updateã€purgeéƒ½æœ‰æå‡ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åŒå†™æœºåˆ¶ï¼šInnoDBåœ¨å°†Buffer Poolä¸­çš„dirty Pageè„é¡µåˆ·åˆ°ç£ç›˜æ—¶ï¼Œä¼šå…ˆå°†dirty pageåˆ·åˆ°InnoDB tablespaceä¸­çš„ä¸€ä¸ªåŒºåŸŸï¼Œè¿™ä¸ªåŒºåŸŸç§°ä¸º Double Write Bufferï¼Œè¯¥åŒºåŸŸå¤§å° 2MB ï¼Œæ¯æ¬¡å†™å…¥ 1MBï¼Œ128ä¸ªé¡µï¼Œæ¯ä¸ªé¡µ16kï¼Œå…¶ä¸­120ä¸ªé¡µä¸ºåå°çº¿ç¨‹æ‰¹é‡åˆ·Dirty Pageï¼Œè¿˜æœ‰8ä¸ªä¹Ÿæ˜¯ä¸ºäº†å‰å°èµ·çš„single page flashçº¿ç¨‹ï¼Œç”¨æˆ·å¯ä»¥ä¸»åŠ¨è¯·æ±‚ä½¿ç”¨ï¼Œè¿…é€Ÿæå‡ç©ºä½™çš„ç©ºé—´ï¼Œåœ¨å‘Double Write Bufferå†™å…¥æˆåŠŸåï¼Œç¬¬äºŒæ­¥æ˜¯å°†æ•°æ®åˆ†åˆ«åˆ·åˆ°ä¸€ä¸ªå…±äº«ç©ºé—´å’ŒçœŸæ­£åº”è¯¥å­˜åœ¨çš„ä½ç½®ï¼›&lt;/p&gt;
&lt;p&gt;Buffer Poolï¼šè§£å†³æŸ¥è¯¢æ€§èƒ½é—®é¢˜ï¼Œä½œä¸ºç£ç›˜çš„ç¼“å­˜ï¼Œé¿å…æ¯æ¬¡æŸ¥è¯¢éƒ½ä»ç£ç›˜é‡Œè¯»å–ï¼Œæå‡è¯»å†™æ€§èƒ½ï¼›MySQLå¯åŠ¨æ—¶ï¼ŒInnoDBä¼šä¸ºBuffer Poolç”³è¯·ä¸€ç‰‡è¿ç»­çš„å†…å­˜ç©ºé—´ï¼ŒæŒ‰ç…§é»˜è®¤çš„16KBå¤§å°åˆ’åˆ†å‡ºä¸€ä¸ªä¸ªé¡µä½œä¸ºç¼“å­˜é¡µï¼›&lt;/p&gt;
&lt;p&gt;è¯»å–æ•°æ®æ—¶ï¼Œå…ˆè¯»Buffer Poolï¼Œæ²¡æœ‰æ‰å»è¯»ç£ç›˜ï¼›å†™æ•°æ®æ—¶ï¼Œå…ˆä¿®æ”¹Buffer Poolä¸­æ•°æ®æ‰€åœ¨çš„é¡µï¼Œè®¾ç½®ä¸ºè„é¡µï¼Œç”±åå°çº¿ç¨‹å°†è„é¡µå†™å…¥ç£ç›˜ï¼ˆæˆ–é…åˆä½¿ç”¨change bufferæœºåˆ¶ï¼‰ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è‡ªé€‚åº”å“ˆå¸Œç´¢å¼•ï¼šInnoDBä¼šç›‘æ§å¯¹è¡¨ä¸Šè¾…åŠ©ç´¢å¼•é¡µçš„æŸ¥è¯¢ï¼Œå¦‚æœå‘ç°å»ºç«‹hashç´¢å¼•å¯ä»¥æå‡æ€§èƒ½ï¼Œå°±ä¼šåœ¨ç¼“å†²æ± å»ºç«‹hashç´¢å¼•ï¼Œæå‡æŸ¥è¯¢æ€§èƒ½ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;é¢„è¯»ï¼šç”¨å¼‚æ­¥å°†ç£ç›˜ä¸­çš„é¡µè¯»å–åˆ°Buffer Poolä¸­ï¼Œé¢„è¯»è¯·æ±‚çš„æ‰€æœ‰é¡µé›†ä¸­åœ¨ä¸€ä¸ªèŒƒå›´å†…ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;3memory&#34;&gt;3.Memory&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;menoryå¼•æ“çš„å†…å­˜è¡¨ä¸åŒäºInnoDBçš„å†…éƒ¨ä¸´æ—¶è¡¨ï¼Œå†…å­˜è¡¨æ˜¯åº“å†…å…¨å±€å¯è§ï¼Œå†™å†…å­˜çš„ï¼Œè€Œinnodbçš„å†…éƒ¨ä¸´æ—¶è¡¨æ˜¯å†™ç£ç›˜çš„ï¼ŒåŒä¸€çº¿ç¨‹å†…å¯è§ï¼Œçº¿ç¨‹ç»“æŸå°±ä¼šæ¸…ç©º&lt;/li&gt;
&lt;li&gt;é»˜è®¤æ˜¯hashç´¢å¼•ï¼Œæ•°æ®å•ç‹¬å­˜æ”¾ï¼Œç´¢å¼•ä¸Šä¿å­˜æ•°æ®çš„ä½ç½®ï¼Œè¿™ç§å½¢å¼ç§°ä¸ºæ¨ç»„ç»‡è¡¨ï¼Œè€ŒInnoDBé‚£ç§ B+æ ‘ æ•°ç»“æ„çš„åˆ™æ˜¯ç´¢å¼•ç»„ç»‡è¡¨&lt;/li&gt;
&lt;li&gt;InnoDBæ•°æ®å­˜æ”¾æ˜¯æœ‰é¡ºåºçš„ï¼Œå› æ­¤æœ‰å¯èƒ½ä¼šäº§ç”Ÿç©ºæ´ï¼Œè€Œmemoryåˆ™æ˜¯æœ‰ç©ºä½å°±å¯ä»¥å­˜æ”¾ï¼Œå› æ­¤å½“æ•°æ®ä½ç½®å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒinnoDBåªéœ€è¦ä¿®æ”¹ä¸»é”®ç´¢å¼•ï¼Œè€Œå†…å­˜è¡¨éœ€è¦ä¿®æ”¹æ‰€æœ‰ç´¢å¼•ï¼ˆå“ˆå¸Œè¡¨æ‰©å®¹å¯¼è‡´ï¼‰&lt;/li&gt;
&lt;li&gt;å†…å­˜è¡¨ä¸æ”¯æŒå˜é•¿æ•°æ®ç±»å‹ï¼Œåªèƒ½å›ºå®šå­—ç¬¦ä¸²é•¿åº¦ï¼Œå³varchar(N)ä¼šé€€åŒ–ä¸ºchar(N)&lt;/li&gt;
&lt;li&gt;å†…å­˜è¡¨çš„ç´¢å¼•åœ°ä½æ˜¯ç›¸ç­‰çš„ï¼Œè€ŒInnodbè¡¨åˆ†æˆäº†ä¸»é”®ç´¢å¼•å’Œæ™®é€šç´¢å¼•&lt;/li&gt;
&lt;li&gt;ç”±äºhashç´¢å¼•å¹¶ä¸é€‚åˆç´¢å¼•èŒƒå›´æŸ¥è¯¢ï¼ŒèŒƒå›´æŸ¥è¯¢å®é™…ä¸Šæ˜¯å…¨è¡¨æ‰«æï¼Œå¦‚æœè¦æ”¯æŒç´¢å¼•èŒƒå›´æŸ¥è¯¢ï¼Œéœ€è¦å»ºç«‹B+æ ‘ç´¢å¼•&lt;/li&gt;
&lt;li&gt;å†…å­˜è¡¨ä»…æ”¯æŒè¡¨çº§é”ï¼Œç²’åº¦è¾ƒå¤§ï¼Œå¹¶å‘åº¦ä½&lt;/li&gt;
&lt;li&gt;é‡å¯ä¼šæ¸…ç©ºå†…å­˜è¡¨çš„ç‰¹æ€§ä¼šå½±å“ä¸»å¤‡å¤åˆ¶&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;4myisamä¸innodbå¼•æ“åŒºåˆ«&#34;&gt;4.MyISAMä¸InnoDBå¼•æ“åŒºåˆ«&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;MyISAMæ˜¯éäº‹åŠ¡å®‰å…¨ï¼›InnoDBæ˜¯äº‹åŠ¡å®‰å…¨å‹&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;MyISAMçš„é”æ˜¯è¡¨é”ï¼›InnoDBæ”¯æŒè¡Œé”&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;MyISAMæ”¯æŒå…¨æ–‡ç´¢å¼•ï¼›InnoDB 5.6ç‰ˆæœ¬åæ‰æ”¯æŒ&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;MyISAMé€‚åˆ &lt;code&gt;SELECT&lt;/code&gt; å¯†é›†å‹çš„è¡¨ï¼›InnoDBé€‚åˆ &lt;code&gt;INSERT&lt;/code&gt; å’Œ &lt;code&gt;UPDATE&lt;/code&gt; å¯†é›†å‹çš„è¡¨ï¼›MyISMå¯ä»¥ç›´æ¥å®šä½åˆ°æ•°æ®æ‰€åœ¨çš„å†…å­˜åœ°å€ï¼Œç›´æ¥æ‰¾åˆ°æ•°æ®ï¼Œè€ŒInnoDBéœ€è¦ç»´æŠ¤æ•°æ®ç¼“å­˜ï¼ŒæŸ¥è¯¢è¿‡ç¨‹ä¸­å…ˆå®šä½åˆ°è¡Œæ‰€åœ¨çš„æ•°æ®å—ï¼Œåœ¨ä»æ•°æ®å—ä¸­å®šä½åˆ°è¦æŸ¥æ‰¾çš„è¡Œï¼Œæ‰€ä»¥æŸ¥è¯¢æ€§èƒ½ä¸Šå·®äºMyISM&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;MyISAMè¡¨æ˜¯ä¿å­˜æˆæ–‡ä»¶å½¢å¼ï¼Œè·¨å¹³å°è½¬ç§»æ–¹ä¾¿&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;InnoDBè¡¨æ¯”MyISAMè¡¨å®‰å…¨&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;MyISAMå¯¹äºä¸ä¼šè¿›è¡Œä¿®æ”¹çš„è¡¨ï¼Œæ”¯æŒå‹ç¼©è¡¨ï¼Œæå¤§å‡å°‘ç£ç›˜ç©ºé—´å ç”¨&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;MyISAM å´©æºƒåå‘ç”ŸæŸåçš„æ¦‚ç‡æ¯” InnoDB é«˜å¾ˆå¤šï¼Œè€Œä¸”æ¢å¤çš„é€Ÿåº¦ä¹Ÿæ›´æ…¢ï¼›InnoDBå› ä¸ºæœ‰redo logï¼Œæ”¯æŒå®‰å…¨æ¢å¤&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;MyISAMä¸æ”¯æŒå¤–é”®ï¼›InnoDB æ”¯æŒå¤–é”®ï¼ŒInnoDB æ”¯æŒåœ¨çº¿çƒ­å¤‡ä»½&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;MyISAMæ˜¯éèšé›†ç´¢å¼•ï¼Œä½¿ç”¨ B+æ ‘ ä½œä¸ºç´¢å¼•ç»“æ„ï¼Œç´¢å¼•å’Œæ•°æ®æ–‡ä»¶æ˜¯åˆ†ç¦»çš„ï¼Œç´¢å¼•ä¿å­˜çš„æ˜¯æ•°æ®æ–‡ä»¶çš„æŒ‡é’ˆï¼ˆæ•°æ®çš„ç‰©ç†åœ°å€ï¼‰ï¼Œæ‰€ä»¥è¿˜è¦å†æŸ¥ä¸€æ¬¡æ‰èƒ½å¾—åˆ°æ•°æ®ï¼›&lt;/p&gt;
&lt;p&gt;InnoDBæ˜¯èšé›†ç´¢å¼•ï¼Œæ•°æ®æ–‡ä»¶æ˜¯å’Œï¼ˆä¸»é”®ï¼‰ç´¢å¼•ç»‘åœ¨ä¸€èµ·çš„ï¼Œå³ç´¢å¼• + æ•°æ®ï¼ˆæ•°æ®æœ¬èº«ï¼Œä¸æ˜¯æŒ‡é’ˆï¼‰ = æ•´ä¸ªè¡¨æ•°æ®æ–‡ä»¶ï¼Œé€šè¿‡ä¸»é”®ç´¢å¼•åˆ°æ•´ä¸ªè®°å½•ï¼Œå¿…é¡»è¦æœ‰ä¸»é”®ï¼›è¾…åŠ©ç´¢å¼•æ˜¯ä»¥å»ºç´¢å¼•çš„å­—æ®µä¸ºå…³é”®å­—ç´¢å¼•åˆ°ä¸»é”®ï¼ŒæŸ¥è¯¢æ—¶å…ˆæŸ¥åˆ°ä¸»é”®ï¼Œå†é€šè¿‡ä¸»é”®æŸ¥è¯¢åˆ°æ•°æ®ï¼›&lt;/p&gt;
&lt;p&gt;å³MyISAMçš„B+æ ‘ä¸»é”®ç´¢å¼•å’Œè¾…åŠ©ç´¢å¼•çš„å¶å­èŠ‚ç‚¹éƒ½æ˜¯æ•°æ®æ–‡ä»¶çš„åœ°å€æŒ‡é’ˆï¼›InnoDBçš„B+æ ‘ä¸»é”®ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å°±æ˜¯æ•°æ®æ–‡ä»¶ï¼Œè¾…åŠ©ç´¢å¼•çš„å¶å­èŠ‚ç‚¹æ˜¯ä¸»é”®çš„å€¼ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;äº‹åŠ¡&#34;&gt;äº‹åŠ¡&lt;/h1&gt;
&lt;h2 id=&#34;1acidåŸåˆ™&#34;&gt;1.ACIDåŸåˆ™&lt;/h2&gt;
&lt;p&gt;åŸå­æ€§ï¼ˆatomicityï¼‰ã€ä¸€è‡´æ€§ï¼ˆconsistencyï¼‰ã€éš”ç¦»æ€§ï¼ˆisolationï¼‰å’ŒæŒä¹…æ€§ï¼ˆdurabilityï¼‰&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;åŸå­æ€§ï¼šäº‹åŠ¡ä¸­çš„æ‰€æœ‰æ“ä½œè¦ä¹ˆå…¨éƒ¨æäº¤æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥å›æ»šï¼ˆundo logä¿è¯ï¼‰&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¸€è‡´æ€§ï¼šæ•°æ®åº“æ€»æ˜¯ä»ä¸€ä¸ªä¸€è‡´æ€§çš„çŠ¶æ€è½¬æ¢åˆ°å¦ä¸€ä¸ªä¸€è‡´æ€§çš„çŠ¶æ€ï¼ˆç”±AIDåŸåˆ™ä¿è¯ï¼‰&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;éš”ç¦»æ€§ï¼šä¸€ä¸ªäº‹åŠ¡æ‰€åšçš„ä¿®æ”¹åœ¨æœ€ç»ˆæäº¤ä»¥å‰ï¼Œå¯¹å…¶ä»–äº‹åŠ¡æ˜¯ä¸å¯è§çš„ï¼ˆMVCC + é”æœºåˆ¶ä¿è¯ï¼‰&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æŒä¹…æ€§ï¼šä¸€æ—¦äº‹åŠ¡æäº¤ï¼Œåˆ™å…¶æ‰€åšçš„ä¿®æ”¹å°†æ°¸ä¹…ä¿å­˜åˆ°æ•°æ®åº“ï¼ˆredo logä¿è¯ï¼‰&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;2å¹¶å‘æƒ…å†µä¸‹å¸¦æ¥çš„é—®é¢˜&#34;&gt;2.å¹¶å‘æƒ…å†µä¸‹å¸¦æ¥çš„é—®é¢˜&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;è„è¯»ï¼šå¦‚æœ‰äº‹åŠ¡Aå’ŒBï¼ŒAè¯»å–äº†Bæœªæäº¤çš„æ•°æ®&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¸¢å¤±æ›´æ–°ï¼šå¦‚æœ‰äº‹åŠ¡Aå’ŒBï¼ŒABå‡å†™å…¥æ•°æ®ï¼ŒAå†™å…¥çš„æ•°æ®è¢«Bè¦†ç›–&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¸å¯é‡å¤è¯»ï¼šå¦‚æœ‰äº‹åŠ¡Aå’ŒBï¼ŒAè´Ÿè´£è¯»å–ï¼ŒBè´Ÿè´£å†™å…¥ï¼ŒAè¿ç»­è¯»çš„è¿‡ç¨‹ä¸­Bå†™å…¥äº†ä¸€æ¬¡ï¼ŒAå‰åä¸¤æ¬¡è¯»å‡ºæ¥çš„æ•°æ®ä¸ä¸€æ ·&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¹»è¯»ï¼šå¦‚æœ‰äº‹åŠ¡Aå’ŒBï¼ŒAä¿®æ”¹è¡¨å†…æ•°æ®çš„è¿‡ç¨‹ä¸­ï¼ŒBå‘è¡¨å†…æ’å…¥äº†ä¸€æ¡æ•°æ®ï¼ŒAä¿®æ”¹å®Œåå‘ç°æ•°æ®å¹¶æ²¡æœ‰è¢«å…¨éƒ¨ä¿®æ”¹å®Œï¼Œæˆ–è€…æ˜¯åœ¨RRéš”ç¦»çº§åˆ«ä¸‹ï¼Œäº‹åŠ¡Aå†…å‰åä¸¤æ¡ç›¸åŒçš„SQLå¸¦â€œå½“å‰è¯»â€æŸ¥è¯¢æŸ¥å›æ¥çš„æ•°æ®æ•°ä¸ä¸€è‡´ï¼›&lt;/p&gt;
&lt;p&gt;å¦å¤–ä¸€ç§ç†è§£æ˜¯ï¼Œåœ¨RRéš”ç¦»çº§åˆ«ä¸‹ï¼Œäº‹åŠ¡Aï¼Œå¿«ç…§è¯»æŸ¥åˆ°æ•°æ®1ä¸å­˜åœ¨ï¼Œæ­¤æ—¶äº‹åŠ¡Bæ’å…¥æ•°æ®1ï¼Œäº‹åŠ¡Aç»§ç»­æ’å…¥æ•°æ®1å¤±è´¥ï¼Œä½†æ˜¯æŸ¥è¯¢æ•°æ®1åˆä¸å­˜åœ¨ï¼Œæ­¤æ—¶ä¹Ÿå¯ä»¥è¯´äº‹åŠ¡Aå‡ºç°å¹»è¯»ï¼›&lt;/p&gt;
&lt;p&gt;è¿˜æœ‰ä¸€ç§ç†è§£æ˜¯ï¼Œåœ¨RRéš”ç¦»çº§åˆ«ä¸‹ï¼Œäº‹åŠ¡Aï¼Œå…ˆå¿«ç…§è¯»æŸ¥è¯¢å¾—åˆ°ä¸¤æ¡æ•°æ®ï¼Œæ­¤æ—¶äº‹åŠ¡Bæ’å…¥æ•°æ®åï¼Œäº‹åŠ¡Aä½¿ç”¨å½“å‰è¯»ï¼Œå°±ä¼šè¯»åˆ°3æ¡æ•°æ®äº†ï¼Œæ­¤æ—¶ä¹Ÿå¯ä»¥è¯´äº‹åŠ¡Aå‡ºç°å¹»è¯»ï¼›&lt;/p&gt;
&lt;p&gt;åŸå› æ˜¯äº‹åŠ¡Aä¸€å¼€å§‹æŸ¥è¯¢æ—¶æ²¡æœ‰å¸¦ å½“å‰è¯» å¯¼è‡´ï¼Œå› ä¸ºå¦‚æœäº‹åŠ¡Aä¸€å¼€å§‹å°±ä½¿ç”¨èŒƒå›´å½“å‰è¯»ï¼Œäº‹åŠ¡Bæ˜¯æ’ä¸è¿›å»çš„æ•°æ®1çš„ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;ä¸å¯é‡å¤è¯»å’Œå¹»è¯»çš„åŒºåˆ«&lt;/strong&gt;ï¼šä¸å¯é‡å¤è¯»ä¾§é‡äºupdateï¼Œè€Œå¹»è¯»ä¾§é‡äºinsertå’Œdeleteã€‚ä¸å¯é‡å¤è¯»æ˜¯åœ¨ä¸€ä¸ªäº‹åŠ¡å†…å‰åä¸¤æ¬¡è¯»å–çš„æ•°æ®ä¸ä¸€è‡´ï¼Œæ­¤æ—¶æ•°æ®æ•°é‡æ²¡æœ‰å˜åŒ–ï¼Œé‡å¤è¯»å–å¾—åˆ°çš„æ•°æ®ä¸ä¸€è‡´ï¼Œæ‰€ä»¥å«ä¸å¯é‡å¤è¯»ï¼›è€Œå¹»è¯»æ˜¯åœ¨ä¸€ä¸ªäº‹åŠ¡å†…å‰åä¸¤æ¬¡è¯»å–çš„æ•°æ®ä¸ä¸€è‡´ï¼Œè¯»çš„æ•°æ®é‡å˜å¤šæˆ–è€…å˜å°‘äº†ï¼Œè¿™äº›å¤šäº†çš„æ•°æ®æˆ–å°‘äº†çš„æ•°æ®å°±åƒå¹»è§‰ï¼Œæ‰€ä»¥å«å¹»è¯»&lt;/p&gt;
&lt;h2 id=&#34;3äº‹åŠ¡éš”ç¦»çº§åˆ«&#34;&gt;3.äº‹åŠ¡éš”ç¦»çº§åˆ«&lt;/h2&gt;
&lt;p&gt;éš”ç¦»çº§åˆ«å°±æ˜¯ä¸ºäº†è§£å†³ä¸Šè¿°å¹¶å‘æ—¶å€™å¸¦æ¥çš„é—®é¢˜&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;DEFAULT&lt;/strong&gt;ï¼šé»˜è®¤éš”ç¦»çº§åˆ«ï¼Œå³ä½¿ç”¨åº•å±‚æ•°æ®åº“é»˜è®¤çš„éš”ç¦»çº§åˆ«ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;READ_UNCOMMITTED&lt;/strong&gt;ï¼šæœªæäº¤è¯»ï¼Œä¸€ä¸ªäº‹åŠ¡æœªæäº¤æ—¶ï¼Œå®ƒçš„å˜æ›´å¯ä»¥è¢«å…¶ä»–äº‹åŠ¡çœ‹åˆ°ï¼›&lt;/p&gt;
&lt;p&gt;å¯èƒ½å‡ºç° è„è¯»ã€ä¸å¯é‡å¤è¯»ã€ä¸¢å¤±æ›´æ–°ã€å¹»è¯»ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;READ_COMMITTED&lt;/strong&gt;ï¼šæäº¤è¯»ï¼Œä¸€ä¸ªäº‹åŠ¡æäº¤ä¹‹åï¼Œå®ƒåšçš„å˜æ›´æ‰ä¼šè¢«å…¶ä»–äº‹åŠ¡çœ‹åˆ°ï¼Œä¿è¯äº†ä¸€ä¸ªäº‹åŠ¡ä¸ä¼š è¯» åˆ°å¦ä¸€ä¸ªå¹¶è¡Œäº‹åŠ¡å·²ä¿®æ”¹ä½†æœªæäº¤çš„æ•°æ®ï¼›æ¯æ¬¡selectè¯­å¥éƒ½ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„Read Viewï¼›&lt;/p&gt;
&lt;p&gt;é¿å…äº†â€œè„è¯»â€ï¼Œå¯èƒ½å‡ºç°ä¸å¯é‡å¤è¯»ã€ä¸¢å¤±æ›´æ–°ï¼›&lt;/p&gt;
&lt;p&gt;Oracleé»˜è®¤éš”ç¦»çº§åˆ«ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;REPEATABLE_READ&lt;/strong&gt;ï¼šå¯é‡å¤è¯»ï¼Œä¸€ä¸ªäº‹åŠ¡åœ¨æ‰§è¡Œä¸­çœ‹åˆ°çš„æ•°æ®ï¼Œæ€»æ˜¯è·Ÿè¿™ä¸ªäº‹åŠ¡åœ¨å¯åŠ¨æ—¶çœ‹åˆ°çš„æ•°æ®ä¸€è‡´ï¼Œä¿è¯äº†ä¸€ä¸ªäº‹åŠ¡ä¸ä¼š ä¿®æ”¹ å·²ç»ç”±å¦ä¸€ä¸ªäº‹åŠ¡è¯»å–ä½†æœªæäº¤ï¼ˆå›æ»šï¼‰çš„æ•°æ®ï¼›äº‹åŠ¡å¼€å§‹æ—¶ç”Ÿæˆä¸€ä¸ªRead Viewï¼Œæ•´ä¸ªäº‹åŠ¡æœŸé—´éƒ½æ˜¯ç”¨æ•´ä¸ªRead Viewï¼›&lt;/p&gt;
&lt;p&gt;é¿å…äº†è„è¯»ã€ä¸å¯é‡å¤è¯»å–ã€ä¸¢å¤±æ›´æ–°ï¼Œå¯èƒ½å­˜åœ¨å¹»è¯»ï¼›&lt;/p&gt;
&lt;p&gt;MySQLé»˜è®¤æ˜¯æ­¤éš”ç¦»çº§åˆ«ï¼›&lt;/p&gt;
&lt;p&gt;é’ˆå¯¹å¿«ç…§è¯»ï¼Œå³æ™®é€šçš„selectè¯­å¥ï¼ŒMySQLé€šè¿‡MVCCè§£å†³å¹»è¯»é—®é¢˜ï¼›&lt;/p&gt;
&lt;p&gt;é’ˆå¯¹å½“å‰è¯»ï¼Œå³å¸¦for updateçš„selectè¯­å¥ï¼ŒMySQLé€šè¿‡next-key lockè§£å†³å¹»è¯»é—®é¢˜ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;SERIALIZABLE&lt;/strong&gt;ï¼šåºåˆ—åŒ–,æœ€ä¸¥æ ¼çš„çº§åˆ«ï¼Œäº‹åŠ¡ä¸²è¡Œæ‰§è¡Œ,å³ä¸€ä¸ªäº‹åŠ¡è¦ç­‰å¾…å¦ä¸€ä¸ªäº‹åŠ¡å®Œæˆæ‰å¯è¿›è¡Œ&lt;/p&gt;
&lt;p&gt;æ•ˆç‡æœ€å·®ï¼Œä½†ä¹Ÿè§£å†³äº†å¹¶å‘å¸¦æ¥çš„é‚£4ç§é—®é¢˜ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¾‹å­ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;äº‹åŠ¡A&lt;/th&gt;
&lt;th&gt;äº‹åŠ¡B&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;å¯åŠ¨äº‹åŠ¡ï¼ŒæŸ¥è¯¢å¾—åˆ°å€¼1&lt;/td&gt;
&lt;td&gt;å¯åŠ¨äº‹åŠ¡&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;æŸ¥è¯¢å¾—åˆ°å€¼1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;å°†1æ”¹ä¸º2&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æŸ¥è¯¢å¾—åˆ°çš„å€¼v1&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;æäº¤äº‹åŠ¡B&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æŸ¥è¯¢å¾—åˆ°çš„å€¼v2&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æäº¤äº‹åŠ¡A&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æŸ¥è¯¢å¾—åˆ°å€¼v3&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;åœ¨ä¸åŒéš”ç¦»çº§åˆ«ä¸‹çš„ç­”æ¡ˆ&lt;/p&gt;
&lt;p&gt;æœªæäº¤è¯»ï¼šv1=2ï¼Œv2=2ï¼Œv3=2&lt;/p&gt;
&lt;p&gt;æäº¤è¯»ï¼šv1=1ï¼Œv2=2ï¼Œv3=2&lt;/p&gt;
&lt;p&gt;å¯é‡å¤è¯»ï¼šv1=1ï¼Œv2=1ï¼Œv3=2&lt;/p&gt;
&lt;p&gt;ä¸²è¡Œï¼šv1=1ï¼Œv2=1ï¼Œv3=2ï¼Œä¸”ç›´åˆ°äº‹åŠ¡Aæäº¤åï¼Œäº‹åŠ¡Bæ‰å¯ä»¥ç»§ç»­æ‰§è¡Œ&lt;/p&gt;
&lt;p&gt;ä¸€èˆ¬é¿å…ä½¿ç”¨é•¿äº‹åŠ¡ï¼Œå³åœ¨ä¸€ä¸ªäº‹åŠ¡é‡Œåšè¿‡å¤šæ“ä½œï¼Œé•¿äº‹åŠ¡ä¼šå¯¼è‡´å›æ»šæ—¥å¿—å˜å¤§ï¼Œä¹Ÿä¼šå ç”¨é”èµ„æº&lt;/p&gt;
&lt;h2 id=&#34;4äº‹åŠ¡ç›¸å…³å‘½ä»¤&#34;&gt;4.äº‹åŠ¡ç›¸å…³å‘½ä»¤&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;æ˜¾å¼å¯åŠ¨äº‹åŠ¡ï¼Œä½¿ç”¨beginæˆ–strart transactionå¯åŠ¨äº‹åŠ¡ï¼Œcommitæäº¤äº‹åŠ¡ï¼Œrollbackå›æ»šï¼›&lt;/li&gt;
&lt;li&gt;set autocommit=0ï¼Œå…³æ‰è‡ªåŠ¨æäº¤ï¼Œä»»ä½•è¯­å¥æ‰§è¡Œéƒ½éœ€è¦æ˜¾å¼çš„æäº¤(ä¸»åŠ¨commitæˆ–rollback)æ‰ç®—æ‰§è¡Œå®Œæˆï¼›&lt;/li&gt;
&lt;li&gt;set autocommit=1ï¼Œæ‰§è¡Œä»»æ„ä¸€æ¡è¯­å¥éƒ½ä¼šé»˜è®¤å¼€å¯å•æ¬¡äº‹åŠ¡æ‰§è¡Œå®Œæˆåéšå¼æäº¤ï¼Œäº‹åŠ¡ä¹Ÿå¯ä»¥æ˜¾å¼å¼€å¯ï¼Œç›´åˆ°æ˜¾ç¤ºä½¿ç”¨commitã€rollbackæˆ–æ–­å¼€è¿æ¥ã€‚ä¸€èˆ¬æ˜¯ä½¿ç”¨set autocommit=1ï¼Œå¼€å¯äº‹åŠ¡ï¼Œå†commitæäº¤äº‹åŠ¡ï¼Œæ‰§è¡Œcommit work and chainåˆ™æäº¤äº‹åŠ¡å¹¶å¼€å¯ä¸‹ä¸€æ¬¡äº‹åŠ¡ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;é”&#34;&gt;é”&lt;/h1&gt;
&lt;h2 id=&#34;é”çš„åˆ†ç±»&#34;&gt;é”çš„åˆ†ç±»&lt;/h2&gt;
&lt;p&gt;æ ¹æ®èŒƒå›´ï¼Œå¯ä»¥åˆ†ä¸ºå…¨å±€é”ã€è¡¨çº§é”ã€è¡Œé”ï¼Œå½“å¤šç§é”åŒæ—¶å‡ºç°æ—¶ï¼Œå¿…é¡»å¾—æ‰€æœ‰é”ä¸äº’æ–¥ï¼Œæ‰èƒ½å¹¶è¡Œï¼Œå¦åˆ™å°±å¾—ç­‰ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å…¨å±€é”&lt;/strong&gt;ï¼šå¯¹æ•´ä¸ªæ•°æ®åº“å®ä¾‹åŠ é”ï¼Œå‘½ä»¤ï¼š&lt;code&gt; Flush tables with read lock&lt;/code&gt;ï¼Œè®©æ•´ä¸ªæ•°æ®åº“å˜æˆåªè¯»ï¼Œç¦æ­¢ä»»ä½•ddlã€dmlè¯­å¥&lt;/p&gt;
&lt;p&gt;ä¸€èˆ¬ç”¨äºå…¨åº“é€»è¾‘å¤‡ä»½ï¼Œä½†æœ‰å¯èƒ½é€ æˆä¸»ä»åº“æ•°æ®å»¶è¿Ÿæˆ–è€…ä¸šåŠ¡åœæ‘†ï¼Œä¸ç”¨çš„è¯åˆä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´é—®é¢˜ï¼Œä¸€èˆ¬è¿™ç§æ–¹å¼æ˜¯ç»™ä¸æ”¯æŒ å¯é‡å¤è¯» äº‹åŠ¡çš„å¼•æ“ä½¿ç”¨çš„ï¼ŒåƒInnoDBå¯ä»¥åœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹å¼€å¯äº‹åŠ¡è¯»æ•°æ®ï¼Œåˆ©ç”¨MVCCæ¥ä¿è¯åœ¨æ­¤æœŸé—´æ•°æ®ä¸€è‡´ï¼Œå¯ä»¥ä¸ç”¨è¿™ç§é”ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è¡¨çº§é”&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ä¸€ç§éœ€è¦æ˜¾ç¤ºå¯åŠ¨ï¼Œæ¯”å¦‚&lt;code&gt;lock tables t1 read, t2 write;&lt;/code&gt; è¡¨ç¤ºçº¿ç¨‹åœ¨æ‰§è¡Œ&lt;code&gt;unlock tables&lt;/code&gt;ä¹‹å‰ï¼Œåªèƒ½è¯»t1ï¼Œè¯»å†™t2ï¼Œå…¶ä»–æ“ä½œåšä¸äº†ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¦ä¸€ç§æ˜¯ MDL(metadata lock)ï¼Œä¸éœ€è¦æ˜¾ç¤ºä½¿ç”¨ï¼Œåœ¨è®¿é—®ä¸€ä¸ªè¡¨æ—¶è‡ªåŠ¨åŠ ä¸Šï¼Œä½œç”¨æ˜¯ä¿è¯è¯»å†™æ­£ç¡®æ€§ï¼Œå½“å¯¹ä¸€ä¸ªè¡¨å†…æ•°æ®åšCRUDæ—¶ï¼ŒåŠ MDLè¯»é”ï¼Œå½“å¯¹ä¸€ä¸ªè¡¨åšç»“æ„å˜æ›´æ—¶ï¼ŒåŠ MDLå†™é”ï¼›&lt;/p&gt;
&lt;p&gt;ä¸»è¦ç”¨äºä¿æŠ¤è¡¨çš„å…ƒæ•°æ®ï¼Œæ¯”å¦‚å­—æ®µåç­‰ï¼Œæ¯”å¦‚æŸ¥è¯¢å’Œä¿®æ”¹è¡¨å­—æ®µçš„è¯­å¥åŒæ—¶å‡ºç°ï¼Œå¦‚æœæ²¡æœ‰MDLé”ï¼Œå°±ä¼šå¯¼è‡´æŸ¥å‡ºæ¥çš„æ•°æ®åˆ—åæœ‰é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;MDLé”å’Œè¡¨é”æ—¶å¯ä»¥åŒæ—¶å‡ºç°çš„ï¼Œæ¯”å¦‚MyISAMè¡¨ä¸Šæ›´æ–°ä¸€è¡Œï¼Œä¼šåŠ ä¸ŠMDLè¯»é”å’Œè¡¨é”ï¼›&lt;/p&gt;
&lt;p&gt;è¯»é”é—´ä¸äº’æ–¥ï¼Œè¯»å†™ã€å†™å†™é—´äº’æ–¥ï¼ŒMDLä¼šåœ¨äº‹åŠ¡æäº¤åé‡Šæ”¾ã€‚å½“éœ€è¦å¯¹çƒ­ç‚¹è¡¨åšç»“æ„å˜æ›´æ—¶ï¼Œæœ€å¥½åœ¨å˜æ›´è¯­å¥ä¸ŠåŠ ç­‰å¾…æ—¶é—´ï¼Œé¿å…å‡ºç°æ­»é”å¯¼è‡´æ•´ä¸ªè¡¨æ— æ³•è¯»å†™ï¼Œæˆ–è€…ç¡®å®šæ²¡æœ‰é•¿äº‹åŠ¡æ‰§è¡Œåï¼Œå†ä¸ŠMDLå†™é”ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ„å‘å…±äº«é”&lt;/strong&gt; - ISé”ï¼šè¡¨çº§é”ï¼Œè¡¨ç¤ºäº‹åŠ¡æŒæœ‰è¡¨ä¸­è¡Œçš„å…±äº«é”æˆ–è€…æ‰“ç®—è·å–è¡Œçš„å…±äº«é”ï¼Œä»…è¡¨ç¤ºæ„å›¾ï¼Œä¸é˜»å¡å…¶ä»–æ“ä½œï¼Œå½“äº‹åŠ¡åœ¨è·å–è¡¨ä¸­çš„å…±äº«è¡Œé”æ—¶ï¼Œéœ€è¦å…ˆè·å–è¡¨ä¸­çš„æ„å‘å…±äº«é”ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ„å‘æ’ä»–é”&lt;/strong&gt; - IXé”ï¼šè¡¨çº§é”ï¼Œè¡¨ç¤ºäº‹åŠ¡æŒæœ‰è¡¨ä¸­è¡Œçš„æ’ä»–é”æˆ–è€…æ‰“ç®—è·å–è¡Œçš„æ’ä»–é”ï¼Œä»…è¡¨ç¤ºæ„å›¾ï¼Œä¸é˜»å¡å…¶ä»–æ“ä½œï¼Œå½“äº‹åŠ¡åœ¨è·å–è¡¨ä¸­çš„æ’ä»–è¡Œé”æ—¶ï¼Œéœ€è¦å…ˆè·å–è¡¨ä¸­çš„æ„å‘æ’ä»–é”ï¼›&lt;/p&gt;
&lt;p&gt;æ„å‘é”çš„ä½œç”¨ä¸»è¦ä¸ºäº†è§£å†³éå†æ•´ä¸ªè¡¨æ¥å¯»æ‰¾è¡Œé”çš„æƒ…å†µï¼Œå¿«é€Ÿåˆ¤æ–­è¡¨é‡Œé‡Šæ”¾æœ‰è®°å½•è¢«åŠ é”ï¼Œæ¯”å¦‚åœ¨alertè¯­å¥ä¿®æ”¹è¡¨ç»“æ„çš„æ—¶å€™ä½¿ç”¨ï¼š&lt;/p&gt;
&lt;p&gt;äº‹åŠ¡Aæƒ³ä¿®æ”¹è¡¨Tçš„è¡ŒRï¼ŒAè·å¾—è¡ŒRçš„æ’ä»–é”ï¼Œé”ä½äº†è¡ŒRï¼Œäº‹åŠ¡Bä½¿ç”¨Alter Tableè¯­å¥ä¿®æ”¹è¡¨Tçš„ç»“æ„ï¼Œæ­¤æ—¶éœ€è¦è·å–è¡¨Tçš„å…±äº«é”ï¼Œç”±äºå®ƒä¸çŸ¥é“è¡¨Tæ˜¯å¦å­˜åœ¨è¡Œé”ï¼Œåªèƒ½å»éå†ï¼Œå½“è¡¨æœ‰è¡Œé”æ—¶ï¼Œåªèƒ½ç­‰è¡Œé”é‡Šæ”¾æ‰èƒ½ä¿®æ”¹è¡¨ç»“æ„ï¼Œå› ä¸ºéå†å¾ˆè€—æ€§èƒ½ï¼Œæ‰€ä»¥éœ€è¦æ„å‘é”æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œäº‹åŠ¡Aåœ¨è·å¾—è¡ŒRçš„æ’ä»–é”æ—¶ï¼Œéœ€è¦å…ˆä¸Šè¡¨Tçš„å…±äº«æ’ä»–é”ï¼Œäº‹åŠ¡Båœ¨Alter è¡¨Tæ—¶å°±å¯ä»¥ç›´æ¥åˆ¤æ–­è¯¥è¡¨æ˜¯å¦è¢«ä¸Šè¡Œé”äº†ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è¡Œé”&lt;/strong&gt;ï¼šåœ¨InnoDBäº‹åŠ¡ä¸­ï¼Œé‡‡ç”¨äºŒé˜¶æ®µé”åè®®ï¼Œè¡Œé”æ˜¯åœ¨äº‹åŠ¡ç»“æŸåæ‰é‡Šæ”¾ï¼Œåœ¨äº‹åŠ¡è¿‡ç¨‹ä¸­ï¼Œå³ä½¿ä¸€å¼€å§‹ç”¨äº†åé¢æ²¡ç”¨åˆ°ä¹Ÿä¸ä¼šè¢«é‡Šæ”¾ï¼Œå› æ­¤ï¼Œè¦æŠŠæœ€å¯èƒ½é€ æˆé”å†²çªã€æœ€å¯èƒ½å½±å“å¹¶å‘åº¦çš„é”å°½é‡å¾€åæ”¾ï¼Œå‡å°‘é”çš„å½±å“æ—¶é—´ï¼›&lt;strong&gt;è¡Œé”æ˜¯ç»Ÿç§°ï¼Œä¸»è¦å¯ä»¥ç»†åˆ†ä¸ºå…±äº«é”å’Œæ’ä»–é”è¿™äº›&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è®°å½•é”&lt;/strong&gt;ï¼šè¡Œé”ï¼Œå¯¹ç´¢å¼•è¿›è¡Œé”å®šï¼Œå¦‚æœæ˜¯ä¸»é”®ç´¢å¼•å°±ä¼šé”ä¸€æ¡ï¼Œä½†å¦‚æœæ˜¯äºŒçº§ç´¢å¼•ï¼Œå°±ä¼šé”æ‰€æœ‰åŒ¹é…çš„è®°å½•ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å…±äº«é”&lt;/strong&gt; - Sé”ï¼ˆSQL + lock in share modeï¼‰ï¼šè¡Œé”ï¼Œäº‹åŠ¡Tå¯¹æ•°æ®AåŠ ä¸Šå…±äº«é”ï¼Œå…¶ä»–äº‹åŠ¡åªèƒ½å¯¹Aæ·»åŠ å…±äº«é”ï¼Œä¸èƒ½åŠ æ’ä»–é”ï¼Œè·å–å…±äº«é”çš„äº‹åŠ¡åªèƒ½è¯»ä¸èƒ½å†™ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ’ä»–é”&lt;/strong&gt; - Xé”ï¼ˆSQL + for updateï¼‰ï¼šè¡Œé”ï¼Œäº‹åŠ¡Tå¯¹æ•°æ®AåŠ ä¸Šæ’ä»–é”ï¼Œåˆ™å…¶ä»–äº‹åŠ¡ä¸èƒ½å†å¯¹AåŠ ä»»ä½•ç±»å‹çš„é”ã€‚è·å¾—æ’å®ƒé”çš„äº‹åŠ¡å³èƒ½è¯»æ•°æ®åˆèƒ½ä¿®æ”¹æ•°æ®ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ä¹è§‚é”å’Œæ‚²è§‚é”çš„å·®åˆ«ï¼š&lt;strong&gt;ä¹è§‚é”å’Œæ‚²è§‚é”æ˜¯é’ˆå¯¹æ•°æ®æ“ä½œçš„ä¸€ç§æ€æƒ³&lt;/strong&gt;ï¼Œå¹¶ä¸æ˜¯æ•°æ®åº“å®é™…å­˜åœ¨çš„é”ï¼Œåªæ˜¯å¯ä»¥ç”¨ä¸Šé¢çš„é”è¿›è¡Œå®ç°ï¼Œä¹è§‚é”é€‚åˆè¯»å¤šå†™å°‘çš„åœºæ™¯ï¼Œæ‚²è§‚é”é€‚åˆå†™å¤šè¯»å°‘çš„åœºæ™¯ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é—´éš™é”&lt;/strong&gt;ï¼šå½“æˆ‘ä»¬ç”¨èŒƒå›´æ¡ä»¶è€Œä¸æ˜¯ç›¸ç­‰æ¡ä»¶æ£€ç´¢æ•°æ®ï¼Œå¹¶è¯·æ±‚å…±äº«æˆ–æ’ä»–é”æ—¶ï¼ŒInnoDBä¼šç»™ç¬¦åˆæ¡ä»¶çš„å·²æœ‰æ•°æ®è®°å½•çš„ç´¢å¼•é¡¹åŠ é”ï¼Œå¯¹äºé”®å€¼åœ¨æ¡ä»¶èŒƒå›´å†…ä½†å¹¶ä¸å­˜åœ¨çš„è®°å½•ï¼Œå«åšé—´éš™é”ã€‚&lt;/p&gt;
&lt;p&gt;ä¸»è¦æ˜¯ä¸ºäº†è§£å†³å¹»è¯»é—®é¢˜ï¼Œåªåœ¨&lt;strong&gt;å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹æœ‰æ•ˆ&lt;/strong&gt;ï¼Œä¸€èˆ¬ä¸è¡Œé”ä¸€åŒå‡ºç°ã€‚&lt;/p&gt;
&lt;p&gt;é—´éš™é”ä¹Ÿä¼šå¯¼è‡´æ­»é”ï¼Œæ¯”å¦‚ä¸¤ä¸ªäº‹åŠ¡åŒæ—¶åœ¨ä¸€æ®µèŒƒå›´å†…çš„æ•°æ®åŠ å…¥é—´éš™é”ï¼ˆ&lt;strong&gt;äº‹åŠ¡é—´çš„é—´éš™é”ä¸ä¼šå†²çª&lt;/strong&gt;ï¼Œå¯ä»¥åŠ æˆåŠŸï¼‰ï¼Œåˆinsertæˆ–updateåœ¨è¿™ä¸ªèŒƒå›´å†…çš„æ•°æ®ï¼Œå°±ä¼šå¯¼è‡´æ­»é”ã€‚&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚æœ‰æ•°æ® (1, a)(3, c)(4, d)(5,e)ï¼Œäº‹åŠ¡Aæ›´æ–°cï¼Œé—´éš™é”èŒƒå›´ä¸º(a, d)ï¼Œäº‹åŠ¡Bæ›´æ–°eï¼Œé—´éš™é”èŒƒå›´ä¸º(d, æ­£æ— ç©·)ï¼Œå¦‚æœæ­¤æ—¶äº‹åŠ¡Aæ’å…¥fï¼Œäº‹åŠ¡Bæ’å…¥bï¼Œå°±ä¼šå¯¼è‡´æ­»é”ã€‚&lt;/p&gt;
&lt;p&gt;å¦å¤–ï¼Œ&amp;ldquo;é—´éš™&amp;rdquo; æ˜¯ ç”±è¿™ä¸ªé—´éš™å³è¾¹çš„è®°å½•å®šä¹‰çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœ æœ‰ç´¢å¼• c çš„å€¼ä¸º0ï¼Œ5ï¼Œ10ï¼Œ15ï¼Œå…ˆæœ‰äº‹åŠ¡AæŸ¥è¯¢&lt;code&gt;select c from t where c &amp;gt; 5 lock in share mode&lt;/code&gt;ï¼ŒåŠ é”èŒƒå›´æ˜¯(5, 10], (10, 15], (15, max]ï¼Œç„¶åæœ‰äº‹åŠ¡Bæ›´æ–°&lt;code&gt;update t set c = 1 where c = 5&lt;/code&gt;ï¼Œæ‰§è¡ŒæˆåŠŸï¼Œæ­¤æ—¶cçš„å€¼æœ‰ 0ï¼Œ1ï¼Œ10ï¼Œ15ï¼Œå†æ‰§è¡Œ&lt;code&gt;update t set c=5 where c=1;&lt;/code&gt;ä¼šæ‰§è¡Œä¸æˆåŠŸï¼Œè¢«blockedä½ï¼ŒåŸå› æ˜¯é—´éš™é”çš„é—´éš™å˜æˆäº† [1, 10]ï¼Œæ›´æ–°å¤±è´¥ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Next-Key é”&lt;/strong&gt; = é—´éš™é”(gap lock) + è¡Œé”(record lock)ï¼Œåœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹ï¼ŒInnoDBåœ¨æŸ¥æ‰¾å’Œæ‰«æç´¢å¼•æ—¶ï¼Œéƒ½ä¼šä½¿ç”¨Next-Keyé”æ¥é˜²æ­¢å¹»è¯»çš„å‘ç”Ÿã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Auto-Inc é”&lt;/strong&gt;ï¼šè‡ªå¢é”ï¼Œè¡¨çº§é”ï¼Œæ¯”è¾ƒç‰¹æ®Šï¼Œå½“è®¾ç½®é”®ä¸ºè‡ªå¢æ—¶ä½¿ç”¨ï¼Œæ¯”å¦‚è‡ªå¢ä¸»é”®ï¼Œåœ¨ç”Ÿæˆè‡ªå¢idæ—¶ï¼Œä¼šå…ˆè·å–ç›¸å…³è¡¨çš„ Auto-Inc é”ï¼Œé˜»å¡å…¶ä»–äº‹åŠ¡çš„æ’å…¥æ“ä½œï¼Œä¿è¯è‡ªå¢çš„å”¯ä¸€æ€§ã€‚ä¸éµå¾ªäºŒé˜¶æ®µé”åè®®ï¼Œå› ä¸ºå®ƒå¹¶ä¸æ˜¯åœ¨äº‹åŠ¡æäº¤æ—¶é‡Šæ”¾ï¼Œè€Œæ˜¯åœ¨insetè¯­å¥æ‰§è¡Œåé‡Šæ”¾ï¼Œå³ä½¿æ˜¯åœ¨å›æ»šæ—¶ï¼Œè‡ªå¢å€¼ä¹Ÿä¸ä¼šå‡ä¸€ã€‚&lt;/p&gt;
&lt;p&gt;æ¶‰åŠçš„å‚æ•°æ˜¯ &lt;code&gt;innodb_autoinc_lock_mode&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;=1&lt;/code&gt;æ—¶ï¼Œæ™®é€šinsertè¯­å¥ä¼šæ‰§è¡Œå®Œä¹‹åé‡Šæ”¾ï¼Œæ‰¹é‡insertæ—¶ä¼šç­‰åˆ°æ‰€æœ‰æ‰¹é‡insertçš„SQLéƒ½ç»“æŸçš„æ—¶å€™æ‰é‡Šæ”¾é”ï¼ŒåŸå› æ˜¯å¦‚æœbin logä¸æ˜¯rowï¼Œå¤‡åº“åœ¨å¤åˆ¶æ—¶äº§ç”Ÿçš„è¡Œçš„idå¯èƒ½è·Ÿä¸»åº“çš„ä¸ä¸€è‡´é—®é¢˜ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;=2&lt;/code&gt;æ—¶ï¼Œè‡ªå¢idé”æ¯æ¬¡è·å–å®Œå°±ä¼šé‡Šæ”¾ï¼Œä¸å¿…ç­‰å¾…æ’å…¥è¯­å¥æ‰§è¡Œå®Œï¼Œæ‰€ä»¥å¦‚æœæ­¤æ—¶bin logçš„æ ¼å¼ä¸æ˜¯rowï¼Œå°±ä¼šå‡ºç°ä¸»ä»ä¸ä¸€è‡´ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœé€‰æ‹©=1ï¼Œåœ¨æ‰¹é‡insertæ—¶æ€§èƒ½å°±ä¼šå¾ˆå·®ï¼ŒMySQLçš„ä¼˜åŒ–æ˜¯è®©insertçš„è¯­å¥ä¸ä½¿ç”¨è¿ç»­çš„è‡ªå¢idï¼Œä¸è¿‡è¿™æ ·å°±ä¼šè®©è‡ªå¢idä¸è¿ç»­äº†ï¼Œæ‰€ä»¥ä¸€èˆ¬çš„æ“ä½œæ˜¯é€‰æ‹©=2ï¼Œæ¯æ¡insertå°±é‡Šæ”¾ï¼Œä¸”bin logæ ¼å¼è¦=rowï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼ˆMVCCï¼‰&lt;/strong&gt;ï¼šç”¨æ¥è§£å†³è¯»-å†™å†²çªçš„æ— é”å¹¶å‘æ§åˆ¶ï¼Œä¸ºäº‹åŠ¡åˆ†é…ä¸€ä¸ªå•å‘å¢é•¿çš„æ—¶é—´æˆ³ï¼Œä¸ºæ¯ä¸ªä¿®æ”¹ä¿å­˜ä¸€ä¸ªç‰ˆæœ¬ï¼Œç‰ˆæœ¬ä¸äº‹åŠ¡æ—¶é—´æˆ³å…³è”ï¼Œè¯»æ“ä½œåªè¯»è¯¥äº‹åŠ¡å¼€å§‹å‰çš„æ•°æ®åº“çš„å¿«ç…§ã€‚MVCC åœ¨è¯­å¢ƒä¸­å€¾å‘äº â€œå¯¹å¤šè¡Œæ•°æ®æ‰“å¿«ç…§é€ å¹³è¡Œå®‡å®™â€ï¼Œè€Œ CAS ä¸€èˆ¬åªæ˜¯ä¿æŠ¤å•è¡Œæ•°æ®è€Œå·²&lt;/p&gt;
&lt;p&gt;MVCCåªåœ¨ &lt;strong&gt;æäº¤è¯» å’Œ å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹æœ‰æ•ˆ&lt;/strong&gt;ï¼Œä¿è¯åœ¨è¯»æ“ä½œä¸ç”¨é˜»å¡å†™æ“ä½œï¼Œå†™æ“ä½œä¸ç”¨é˜»å¡è¯»æ“ä½œçš„åŒæ—¶ï¼Œé¿å…äº†è„è¯»å’Œä¸å¯é‡å¤è¯»ã€‚ å¯¹äºå¯é‡å¤è¯»ï¼ŒæŸ¥è¯¢åªæ‰¿è®¤åœ¨äº‹åŠ¡å¯åŠ¨å‰å°±å·²ç»æäº¤å®Œæˆçš„æ•°æ®ï¼› å¯¹äºæäº¤è¯»ï¼ŒæŸ¥è¯¢åªæ‰¿è®¤åœ¨è¯­å¥å¯åŠ¨å‰å°±å·²ç»æäº¤å®Œæˆçš„æ•°æ®;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;MVCCçš„ç‰ˆæœ¬å¿«ç…§ï¼ŒæŒ‡çš„æ˜¯ä»€ä¹ˆå‘¢ï¼Œè€Œä¸”å®ƒæ˜¯åŸºäºæ•´ä¸ªåº“çš„ï¼Œæ€»ä¸èƒ½ä¿å­˜å¤šä¸ªç‰ˆæœ¬çš„åº“çš„æ‰€æœ‰æ•°æ®å§ï¼Ÿ&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å®é™…ä¸ŠMVCCå¾—åˆ°çš„å¿«ç…§æ˜¯é€»è¾‘ä¸Šçš„æ•°æ®ï¼Œæ˜¯æ¨æµ‹å‡ºæ¥çš„ï¼Œé€šè¿‡å½“å‰å€¼ï¼Œåˆ©ç”¨äº‹åŠ¡idå’Œundo logæ—¥å¿—ï¼Œæ ¹æ®æ—¥å¿—&amp;quot;å›æ»š&amp;quot;å¾—åˆ°å„ä¸ªç‰ˆæœ¬çš„æ•°æ®ï¼Œäº‹åŠ¡idå¯ä»¥ç®€å•ç†è§£ä¸ºå¯¹è¯¥è¡Œæ•°æ®è¿›è¡Œæ›´æ”¹æ—¶äº§ç”Ÿçš„idï¼Œå½“ç„¶ä¸€ä¸ªäº‹åŠ¡å†…å¯ä»¥å¯¹å¤šæ¡æ•°æ®è¿›è¡Œæ“ä½œï¼Œè¿™å¤šæ¡æ•°æ®çš„äº‹åŠ¡idéƒ½æ˜¯ç›¸åŒçš„&lt;/p&gt;
&lt;p&gt;ä¾‹å­ï¼š&lt;/p&gt;
&lt;p&gt;å‡å¦‚ä¸€ä¸ªå€¼1è¢«æŒ‰é¡ºåºæ”¹ä¸º2ã€3ã€4ï¼Œæ¯ä¸€æ¬¡æ›´æ”¹éƒ½ä¼šè®°å½•åœ¨å›æ»šæ—¥å¿—(undo log)é‡Œï¼Œå¦‚ï¼šå°†2æ”¹ä¸º1 -&amp;gt; å°†3æ”¹ä¸º2 -&amp;gt; å°†4æ”¹ä¸º3ï¼Œå½“å‰çš„å€¼æ˜¯4ï¼Œåœ¨æŸ¥è¯¢è¿™æ¡è®°å½•çš„æ—¶å€™ï¼Œä¸åŒæ—¶åˆ»å¯åŠ¨çš„äº‹åŠ¡ä¼šæœ‰ä¸åŒçš„è§†å›¾ï¼Œæ¯”å¦‚æœ‰è§†å›¾Aï¼ˆå°†2æ”¹æˆ1ï¼‰é‡Œçœ‹åˆ°çš„å€¼æ˜¯1ï¼Œå³åŒä¸€æ¡è®°å½•åœ¨æ•°æ®åº“ä¸­å­˜åœ¨å¤šä¸ªç‰ˆæœ¬&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ’å…¥æ„å‘é”&lt;/strong&gt;ï¼ˆII Gapï¼‰ï¼šç‰¹æ®Šé—´éš™é”ï¼Œåªæœ‰åœ¨æ’å…¥æ—¶ä½¿ç”¨ï¼Œè¡¨ç¤ºæ’å…¥çš„æ„å‘ï¼Œå±äºè¡Œçº§é”ï¼Œä½†ä¸ä¸è¡Œçº§é”å†²çªï¼Œè€Œæ˜¯&lt;strong&gt;ä¸ é—´éš™é” å’Œ Next-Keyé” å†²çª&lt;/strong&gt;ï¼Œå½“æ’å…¥å‰éœ€è¦è·å–æ’å…¥æ„å‘é”ï¼Œæ­¤æ—¶ä¼šä¸ Next-Key é”å†²çªè€Œé˜»å¡ï¼Œä»è€Œé˜²æ­¢å¹»è¯»ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;å¯é‡å¤è¯»-éš”ç¦»çº§åˆ«æ—¶çš„åŠ é”è§„åˆ™&#34;&gt;å¯é‡å¤è¯» éš”ç¦»çº§åˆ«æ—¶çš„åŠ é”è§„åˆ™&lt;/h2&gt;
&lt;p&gt;å”¯ä¸€ç´¢å¼•ï¼ˆä¸»é”®ï¼‰çš„ç´¢å¼•æ ‘:&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;id&lt;/th&gt;
&lt;th&gt;1&lt;/th&gt;
&lt;th&gt;5&lt;/th&gt;
&lt;th&gt;10&lt;/th&gt;
&lt;th&gt;15&lt;/th&gt;
&lt;th&gt;20&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;index&lt;/td&gt;
&lt;td&gt;19&lt;/td&gt;
&lt;td&gt;21&lt;/td&gt;
&lt;td&gt;22&lt;/td&gt;
&lt;td&gt;20&lt;/td&gt;
&lt;td&gt;39&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;éå”¯ä¸€ç´¢å¼•çš„ç´¢å¼•æ ‘ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;index&lt;/th&gt;
&lt;th&gt;19&lt;/th&gt;
&lt;th&gt;20&lt;/th&gt;
&lt;th&gt;21&lt;/th&gt;
&lt;th&gt;22&lt;/th&gt;
&lt;th&gt;39&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;id&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;15&lt;/td&gt;
&lt;td&gt;5&lt;/td&gt;
&lt;td&gt;10&lt;/td&gt;
&lt;td&gt;20&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;æŸ¥è¯¢è¿‡ç¨‹ä¸­æ‰«æåˆ°çš„è¡Œæ‰ä¼šåŠ é”ï¼Œ&lt;strong&gt;é”çš„åŸºæœ¬å•ä½æ˜¯next-key lockï¼ˆå·¦å¼€å³é—­ï¼‰ï¼Œé—´éš™é”æ˜¯å·¦å¼€å³å¼€&lt;/strong&gt;ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å”¯ä¸€ç´¢å¼•ï¼ˆä¸»é”®ï¼‰ç­‰å€¼æŸ¥è¯¢&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;è®°å½•å­˜åœ¨ï¼Œé€€åŒ–æˆè¡Œé”&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è®°å½•ä¸å­˜åœ¨ï¼Œä¼šåœ¨æ‰¾åˆ°è¯¥ç­‰å€¼çš„ å‰å é‡åˆ°çš„ç¬¬ä¸€ä¸ªå­˜åœ¨çš„æ•°æ®çš„è¿™æ®µèŒƒå›´åŠ ä¸Šé—´éš™é”ï¼ˆå·¦å¼€å³å¼€ï¼‰ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å”¯ä¸€ç´¢å¼•ï¼ˆä¸»é”®ï¼‰èŒƒå›´æŸ¥è¯¢ï¼šä¼šå¯¹æ¯ä¸ªæ‰«æåˆ°çš„ç´¢å¼•åŠ next-keyé”ï¼Œé‡åˆ°ä¸‹é¢æƒ…å†µä¼šé€€åŒ–æˆé—´éš™é”æˆ–è€…è¡Œé”ï¼›&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¤§äºï¼Œå¯¹æ‰«æåˆ°çš„ç´¢å¼•åŠ next-keyé”ï¼ˆå·¦å¼€å³é—­ï¼‰&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚æœ‰è®°å½•idï¼š1ï¼Œ5ï¼Œ10ï¼Œ15ï¼Œ20ï¼ŒæŸ¥è¯¢id&amp;gt;15ï¼Œè®°å½•å­˜åœ¨ï¼ŒåŠ é”åŒºé—´æ˜¯ (15, 20], (20, +âˆ]&lt;/p&gt;
&lt;p&gt;è®°å½•ä¸å­˜åœ¨ï¼ŒæŸ¥è¯¢ id &amp;gt; 14ï¼ŒåŠ é”åŒºé—´æ˜¯ (10, 15], (15, 20], (20, +âˆ]&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¤§äºç­‰äºï¼ˆæ­¤æ—¶ä¸ç®¡æ¡ä»¶é‡Œæœ‰æ²¡æœ‰å°äºï¼‰ï¼Œç­‰å€¼çš„è®°å½•åŠ è¡Œé”ï¼Œå¤§äºè¯¥å€¼çš„è®°å½•ä¼šè¿›è¡Œæ‰«æï¼Œæ‰«æåˆ°ç¬¬ä¸€ä¸ªä¸æ»¡è¶³æ¡ä»¶çš„å€¼ï¼ˆä¹Ÿæ˜¯å¯¹åº”å­˜åœ¨çš„è¡Œï¼Œä¸ç®¡å°äºï¼‰ï¼ŒåŠ next-key lockï¼ˆå·¦å¼€å³é—­ï¼‰&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚æœ‰è®°å½• idï¼š1ï¼Œ5ï¼Œ10ï¼Œ15ï¼Œ20ï¼ŒæŸ¥è¯¢ id&amp;gt;=10 and id &amp;lt;11ï¼ŒåŠ é”åŒºé—´æ˜¯ [10], (10, 15]&lt;/p&gt;
&lt;p&gt;è®°å½•å­˜åœ¨ï¼ŒæŸ¥è¯¢ id &amp;gt;= 15ï¼ŒåŠ é”åŒºé—´æ˜¯ [15], (15, 20], (20,  +âˆ)&lt;/p&gt;
&lt;p&gt;è®°å½•ä¸å­˜åœ¨ï¼ŒæŸ¥è¯¢ id &amp;gt;= 14ï¼ŒåŠ é”åŒºé—´æ˜¯ (10, 15], (15, 20], (20, +âˆ]&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å°äºæˆ–å°äºç­‰äºï¼Œä¸”è®°å½•ä¸å­˜åœ¨ï¼Œå…ˆæ‰«æåˆ°çš„è®°å½•ï¼Œè¿˜æ˜¯åŠ next-keyé”ï¼Œæ‰«æåˆ°ç»ˆæ­¢èŒƒå›´æŸ¥è¯¢çš„è®°å½•æ—¶ï¼Œè¯¥è®°å½•çš„ç´¢å¼•çš„next-keyé”ä¼šé€€åŒ–æˆé—´éš™é”ï¼ˆå·¦å¼€å³å¼€ï¼‰&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚æœ‰è®°å½• idï¼š1ï¼Œ5ï¼Œ10ï¼Œ15ï¼Œ20ï¼ŒæŸ¥è¯¢ id&amp;lt;6ï¼Œé”çš„åŒºé—´æ˜¯ (-âˆ, 1], (1, 5], (5, 10)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å°äºï¼Œä¸”å½“è®°å½•å­˜åœ¨æ—¶ï¼Œnext-key lockä¼šé€€åŒ–æˆé—´éš™é”ï¼ˆå·¦å¼€å³å¼€ï¼‰&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚æœ‰è®°å½• idï¼š1ï¼Œ5ï¼Œ10ï¼Œ15ï¼Œ20ï¼ŒæŸ¥è¯¢ id&amp;lt;5ï¼Œé”çš„åŒºé—´æ˜¯ (-âˆ, 1], (1, 5)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å°äºç­‰äºï¼Œä¸”è®°å½•å­˜åœ¨æ—¶ï¼Œæ‰«æåˆ°ç»ˆæ­¢èŒƒå›´æŸ¥è¯¢çš„è®°å½•æ—¶ï¼ŒåŠ next-keyé”&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚æœ‰è®°å½• idï¼š1ï¼Œ5ï¼Œ10ï¼Œ15ï¼Œ20ï¼ŒæŸ¥è¯¢ id&amp;lt;=5ï¼Œé”çš„åŒºé—´æ˜¯ (-âˆ, 1], (1, 5]&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;éå”¯ä¸€ç´¢å¼•ç­‰å€¼æŸ¥è¯¢&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è®°å½•å­˜åœ¨ï¼Œéœ€è¦è®¿é—®è¯¥ç­‰å€¼çš„å·¦è¾¹åˆ°å³è¾¹ç¬¬ä¸€ä¸ªä¸æ»¡è¶³æ¡ä»¶çš„å€¼ï¼Œè¿™ä¸ªèŒƒå›´åŠ ä¸Šé—´éš™é”ï¼ˆå·¦å¼€å³å¼€ï¼Œä¸­é—´åŒ…å«è¯¥ç­‰å€¼ï¼‰ï¼›ç„¶åè¿˜è¦å¯¹è¿™äº›æ‰«æåˆ°çš„éå”¯ä¸€ç´¢å¼•è®°å½•å¯¹åº”çš„ä¸»é”®ç´¢å¼•åŠ é”ï¼›&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚æœ‰éå”¯ä¸€ç´¢å¼•ï¼š19ï¼Œ20ï¼Œ21ï¼Œ22ï¼Œ39ï¼ŒæŸ¥è¯¢ index=22çš„ï¼Œé”çš„åŒºé—´æ˜¯ (21, 22], (22, 39)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è®°å½•ä¸å­˜åœ¨ï¼Œéœ€è¦è®¿é—®è¯¥ç­‰å€¼çš„å·¦è¾¹åˆ°å³è¾¹ç¬¬ä¸€ä¸ªä¸æ»¡è¶³æ¡ä»¶çš„å€¼ï¼Œè¿™ä¸ªèŒƒå›´åŠ ä¸Šé—´éš™é”ï¼ˆå·¦å¼€å³å¼€ï¼‰ï¼Œå› ä¸ºä¸å­˜åœ¨æ»¡è¶³æŸ¥è¯¢æ¡ä»¶çš„è®°å½•ï¼Œæ‰€ä»¥ä¸ç”¨å¯¹ä¸»é”®ç´¢å¼•åŠ é”ï¼›&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;è™½ç„¶ä¸»é”®ç´¢å¼•æ²¡åŠ é”ï¼Œä½†æ˜¯ï¼Œå·¦å³ä¸¤è¾¹çš„å€¼ï¼Œè¿˜æ˜¯ä¼šå­˜åœ¨æ’å…¥å¤±è´¥çš„æƒ…å†µï¼Œå› ä¸ºæ’å…¥è¯­å¥åœ¨æ’å…¥ä¸€æ¡è®°å½•ä¹‹å‰ï¼Œéœ€è¦å®šä½åˆ°è¯¥è®°å½•åœ¨B+æ ‘çš„ä½ç½®ï¼Œå¦‚æœæ’å…¥çš„ä½ç½®çš„ä¸‹ä¸€æ¡è®°å½•çš„ç´¢å¼•ä¸Šæœ‰é—´éš™é”ï¼Œä¼šå‘ç”Ÿé˜»å¡ï¼›&lt;/p&gt;
&lt;p&gt;æ­¤æ—¶å¯¹åº”åŒºé—´å·¦å³ä¸¤è¾¹çš„å€¼ï¼Œè™½ç„¶æ˜¯å¼€åŒºé—´ï¼Œä½†æ˜¯åœ¨æ’å…¥æ—¶ï¼Œè¦åˆ¤æ–­æ’å…¥çš„ä¸»é”®ç´¢å¼•ï¼Œæ˜¯å¦åœ¨éå”¯ä¸€ç´¢å¼•é—´éš™é”å¯¹åº”çš„ä¸»é”®çš„èŒƒå›´å†…ï¼›&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚æœ‰éå”¯ä¸€ç´¢å¼•ï¼š19ï¼Œ20ï¼Œ21ï¼Œ22ï¼Œ39ï¼ŒæŸ¥è¯¢ index=25ï¼Œé”çš„åŒºé—´æ˜¯ (22, 39)ï¼Œå‡å¦‚index=22å¯¹åº”çš„ä¸»é”®ç´¢å¼•ä¸º10ï¼Œindex=39å¯¹åº”çš„ä¸»é”®ç´¢å¼•ä¸º20ï¼Œæ­¤æ—¶å¦‚æœè¦æ’å…¥index=22ï¼Œid=3çš„è®°å½•ï¼Œä¼šæ’å…¥å¤±è´¥ï¼Œå› ä¸ºid=3çš„ä¸‹ä¸€æ¡æ˜¯id=10ï¼ŒåŒç†ï¼Œæ’å…¥index=22ï¼Œid=12çš„ä¹Ÿä¼šå¤±è´¥ï¼Œå› ä¸ºä¸‹ä¸€æ¡id=20&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;éå”¯ä¸€ç´¢å¼•èŒƒå›´æŸ¥è¯¢&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;èŒƒå›´æŸ¥è¯¢éƒ½éœ€è¦è®¿é—®åˆ°ç¬¬ä¸€ä¸ªä¸æ»¡è¶³æ¡ä»¶çš„å€¼ä¸ºæ­¢ï¼Œåœ¨è¿™ä¸ªèŒƒå›´åŠ next-keyé”ï¼ˆå·¦å¼€å³é—­ï¼‰ï¼Œç„¶åè¿˜è¦å¯¹è¿™äº›æ‰«æåˆ°çš„éå”¯ä¸€ç´¢å¼•è®°å½•å¯¹åº”çš„ä¸»é”®ç´¢å¼•åŠ é”ï¼›&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚æœ‰éå”¯ä¸€ç´¢å¼•ï¼š19ï¼Œ20ï¼Œ21ï¼Œ22ï¼Œ39ï¼ŒæŸ¥è¯¢ index&amp;gt;=22ï¼Œé”çš„åŒºé—´æ˜¯ (21, 22], (22, 39], (39, +âˆ]ï¼ŒåŒæ—¶ï¼Œä¼šå¯¹index=22ï¼Œ39çš„è®°å½•åŠ è¡Œé”ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é”æ˜¯åŠ åœ¨ç´¢å¼•ä¸Šçš„ï¼Œå…ˆå¯¹whereæ¡ä»¶ä¸Šçš„ç”¨åˆ°çš„ç´¢å¼•åŠ é”ï¼Œå†å¯¹è¯¥è¡Œä¸Šå­˜åœ¨çš„ç´¢å¼•ä¾æ¬¡åŠ é”&lt;/strong&gt;ã€‚æ¯”å¦‚æœ‰è¡¨Aï¼Œç´¢å¼•ä¸ºidã€aã€bï¼Œå½“updateæ—¶çš„æ¡ä»¶æ˜¯where a=xxæ—¶ï¼Œä¼šå¯¹ç´¢å¼•aã€idã€bçš„é¡ºåºåŠ é”ï¼›&lt;strong&gt;é—´éš™é”åªä¼šåŠ åœ¨whereæ¡ä»¶ä¸­çš„ç´¢å¼•ä¸Š&lt;/strong&gt;ï¼Œå¯¹äºè¯¥ç´¢å¼•å®šä½åˆ°çš„è¡ŒåŠ çš„æ˜¯è¡Œé”ï¼Œä½†å¯¹äºä¸»é”®ç´¢å¼•åŠ é”çš„æ—¶å€™ï¼Œåªæœ‰æ»¡è¶³æŸ¥è¯¢æ¡ä»¶çš„è®°å½•æ‰ä¼šå¯¹å®ƒçš„ä¸»é”®ç´¢å¼•åŠ é”ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;selectåŠ çš„é”ï¼Œå¦‚æœæŸ¥è¯¢çš„åˆ—åˆšå¥½æ˜¯æ»¡è¶³è¦†ç›–ç´¢å¼•ï¼Œä¸”è¦†ç›–ç´¢å¼•ä¸åŒ…æ‹¬å…¶ä»–ç´¢å¼•ï¼Œåˆ™åªä¼šé”whereæ¡ä»¶ä¸Šçš„ç´¢å¼•ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä»¥ä¸Šè§„åˆ™éœ€è¦ç»„åˆèµ·æ¥ä½¿ç”¨ï¼Œ&lt;strong&gt;InnoDBä¼šå¯¹æ‰«æè¿‡çš„è¡Œéƒ½åŠ ä¸Šè¡Œé”å’Œé—´éš™é”ï¼Œæ‰€ä»¥å¦‚æœæŸ¥è¯¢æ¡ä»¶ä¸æ˜¯ç´¢å¼•ï¼Œå°±ä¼šå…¨è¡¨æ‰«æï¼Œå¹¶å¯¹æ‰«åˆ°çš„è¡Œä¸»é”®ä¸Šé”ï¼Œè¡¨ç°å‡ºæ¥å°±æ˜¯é”è¡¨äº†&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨InnoDBä¸­ï¼Œä¸€èˆ¬è®¾ç½®&lt;code&gt;innodb_thread_concurrency&lt;/code&gt;çš„å€¼åœ¨64~128ä¹‹é—´ï¼Œ=0è¡¨ç¤ºä¸é™åˆ¶å¹¶å‘çº¿ç¨‹æ•°é‡ï¼Œè¿™é‡Œçš„å¹¶å‘çº¿ç¨‹æ•°é‡æŒ‡çš„æ˜¯å¹¶å‘æŸ¥è¯¢æ•°é‡ï¼Œå¹¶å‘è¿æ¥æ•°é‡å¯ä»¥æœ‰ä¸Šåƒä¸ªï¼Œä½†æ˜¯å¹¶å‘æŸ¥è¯¢æ•°é‡ä¸èƒ½å¤ªå¤šï¼Œå¦åˆ™å¤ªè€—CPUèµ„æºï¼Œå¦å¤–ï¼Œåœ¨æŸ¥è¯¢è¿›å…¥é”ç­‰å¾…æ—¶ï¼Œå¹¶å‘æŸ¥è¯¢æ•°é‡ä¼šå‡ä¸€ï¼Œä¸è®¡å…¥å¹¶å‘æŸ¥è¯¢æ•°é‡é‡Œï¼Œselect sleep(ç§’)åˆ™ä¼šè®¡å…¥ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºupdateæˆ–deleteè¯­å¥ï¼Œå¯ä»¥è®¾ç½®å‚æ•° &lt;code&gt;sql_safe_updates=1&lt;/code&gt; æ­¤æ—¶ï¼Œè¯­å¥åªæœ‰ä½¿ç”¨äº†whereï¼Œä¸”whereæ¡ä»¶ä¸­å¿…é¡»åŒ…å«ç´¢å¼•åˆ—ï¼Œæˆ–è€…ä½¿ç”¨äº†limitï¼Œæˆ–è€…åŒæ—¶ä½¿ç”¨whereå’Œlimitï¼ˆæ­¤æ—¶whereä¸è¦æ±‚æœ‰ç´¢å¼•æ¡ä»¶ï¼‰ï¼Œæ‰å…è®¸æ‰§è¡Œï¼Œå¦‚æœä¼˜åŒ–å™¨æœ€ç»ˆè¿˜æ˜¯é€‰æ‹©æ‰«æå…¨è¡¨ï¼Œå°±éœ€è¦ä½¿ç”¨&lt;code&gt;fore index([indexåç§°])&lt;/code&gt;å¼ºåˆ¶ä½¿ç”¨ç´¢å¼•äº†ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å…³äºæ­»é”&#34;&gt;å…³äºæ­»é”&lt;/h2&gt;
&lt;p&gt;å½“çº¿ç¨‹å‡ºç°å¾ªç¯èµ„æºä¾èµ–ï¼Œå¯¼è‡´å¤šä¸ªçº¿ç¨‹äº’ç›¸ç­‰å¾…çš„çŠ¶æ€ç§°ä¸ºæ­»é”ï¼Œè§£å†³æ–¹æ¡ˆï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è®¾ç½®è¶…æ—¶æ—¶é—´ &lt;code&gt;innodb_lock_wait_timeout&lt;/code&gt;ï¼Œåœ¨InnoDBä¸­é»˜è®¤æ˜¯50s&lt;/li&gt;
&lt;li&gt;æ­»é”æ£€æµ‹ï¼Œå½“å‘ç°æ­»é”åï¼Œä¸»åŠ¨å›æ»šæ­»é”é“¾æ¡ä¸­çš„æŸä¸€ä¸ªäº‹åŠ¡ï¼Œè®¾ç½®&lt;code&gt;innodb_deadlock_detect=on&lt;/code&gt;ï¼Œé»˜è®¤å€¼æ˜¯on&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸€èˆ¬ä½¿ç”¨ç¬¬äºŒç§ï¼Œä½†æ­»é”æ£€æµ‹ä¼šæ¶ˆè€—å¤§é‡CPUèµ„æºï¼Œä¸»è¦å‘ç”Ÿåœ¨å¯¹åŒä¸€è¡Œè¿›è¡Œæ›´æ–°çš„æ£€æµ‹ä¸Šï¼Œå…¶ç®—æ³•æ˜¯O(n)ï¼Œè™½ç„¶åœ¨åŒä¸€è¡Œæ›´æ–°ä¸ä¼šé€ æˆæ­»é”ï¼Œä½†æ˜¯å½“å¹¶å‘å¾ˆé«˜æ—¶è¿›è¡Œæ£€æµ‹æ—¶å°±ä¼šæ¶ˆè€—å¤§é‡CPUèµ„æºï¼Œè§£å†³æ–¹æ¡ˆæœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯åœ¨ä¸­é—´ä»¶æˆ–è€…MySQL serverå±‚ä¸Šï¼Œå¢åŠ å¯¹åŒä¸€è¡Œæ›´æ–°çš„åˆ¤æ–­ï¼Œè¿›è¡Œæ’é˜Ÿï¼Œæˆ–è€…å°†é‚£ä¸€è¡Œæ”¹ä¸ºé€»è¾‘ä¸Šçš„å¤šè¡Œï¼Œæ¥åˆ†æ•£å‹åŠ›ï¼Œå› æ­¤å¯¹åŒä¸€ç»„èµ„æºï¼Œå°½é‡ä»¥ç›¸åŒçš„é¡ºåºè®¿é—®ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å…³äºå¯¹è¡¨è¿›è¡Œddlè¯­å¥åŠ å­—æ®µç´¢å¼•æ—¶æ˜¯å¦é”è¡¨&#34;&gt;å…³äºå¯¹è¡¨è¿›è¡ŒDDLè¯­å¥ï¼ˆåŠ å­—æ®µã€ç´¢å¼•ï¼‰æ—¶æ˜¯å¦é”è¡¨&lt;/h2&gt;
&lt;p&gt;åŠ å­—æ®µï¼š&lt;code&gt;alter table {è¡¨å} add column {åˆ—å} {ç±»å‹} default {é»˜è®¤å€¼} comment {æ³¨é‡Š} after {æ’åœ¨å“ªä¸ªå­—æ®µå}&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;åŠ ç´¢å¼•ï¼š&lt;code&gt;alter table {è¡¨å} add index {ç´¢å¼•ç±»å‹ï¼Œæ¯”å¦‚uniqueã€primary} {ç´¢å¼•å} (å­—æ®µ1, å­—æ®µ2)&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;ä»¥åŠ å­—æ®µä¸ºä¾‹å­ï¼š&lt;/p&gt;
&lt;p&gt;MySQL5.6ä»¥å‰çš„ç»™è¡¨åŠ å­—æ®µæ—¶ä¼šé”è¡¨ï¼Œåœ¨æ­¤æœŸé—´åªèƒ½è¯»ï¼ŒåŠ å­—æ®µçš„æ­¥éª¤ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å¯¹åŸå§‹è¡¨åŠ MDLå†™é”ï¼Œ&lt;strong&gt;ç¦æ­¢è¯»å†™&lt;/strong&gt;ï¼›&lt;/li&gt;
&lt;li&gt;æŒ‰ç…§åŸå§‹è¡¨å’Œæ‰§è¡Œè¯­å¥çš„å®šä¹‰ï¼Œé‡æ–°åˆ›å»ºä¸€ä¸ªç©ºçš„ä¸´æ—¶è¡¨ï¼›&lt;/li&gt;
&lt;li&gt;ä¸ºä¸´æ—¶è¡¨æ·»åŠ ç´¢å¼•ï¼›&lt;/li&gt;
&lt;li&gt;å°†åŸå§‹è¡¨ç§çš„æ•°æ®é€æ¡copyåˆ°ä¸´æ—¶è¡¨ä¸­ï¼›&lt;/li&gt;
&lt;li&gt;å½“åŸå§‹è¡¨çš„æ‰€æœ‰æ•°æ®éƒ½è¢«copyåˆ°ä¸´æ—¶è¡¨åï¼Œå°†åŸå§‹è¡¨åˆ é™¤ï¼Œä¸´æ—¶è¡¨æ›´åä¸ºåŸå§‹è¡¨è¡¨åï¼Œ&lt;strong&gt;å…è®¸è¯»å†™&lt;/strong&gt;ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å¦‚æœ5.6ä¹‹å‰çš„ç‰ˆæœ¬è¦åŠ å­—æ®µï¼Œå¯ä»¥ä½¿ç”¨pt-oscæ¥å®ç°ï¼Œæœ¬è´¨ä¸Šä¹Ÿæ˜¯åˆ›å»ºä¸´æ—¶è¡¨ï¼Œç„¶åcopyæ•°æ®çš„è¿‡ç¨‹ä¸­é€šè¿‡è§¦å‘å™¨è§¦å‘ä¸´æ—¶è¡¨ä¸Šæ•°æ®çš„ä¿®æ”¹ï¼Œæœ€ååˆ é™¤åŸå§‹è¡¨å¹¶æ›´åè€Œå·²ã€‚&lt;/p&gt;
&lt;p&gt;MySQL5.6ä¹‹åæ–°å¢Online DDLåŠŸèƒ½ï¼Œä½¿å¾—è¡¨ä¸å¯ç”¨çš„æ—¶é—´å‡å°‘ï¼Œæˆ–è€…è¯´è®©è¡¨åœ¨è¢«ä¿®æ”¹æ—¶ä»ç„¶èƒ½æ­£å¸¸æ“ä½œï¼ŒåŠ å­—æ®µæ—¶çš„æ­¥éª¤ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å¯¹åŸå§‹è¡¨åŠ MDLå†™é”ï¼Œ&lt;strong&gt;ç¦æ­¢è¯»å†™&lt;/strong&gt;ï¼›&lt;/li&gt;
&lt;li&gt;æŒ‰ç…§åŸå§‹è¡¨å’Œæ‰§è¡Œè¯­å¥çš„å®šä¹‰ï¼Œé‡æ–°åˆ›å»ºä¸€ä¸ªç©ºçš„ä¸´æ—¶è¡¨ï¼Œå¹¶ç”³è¯·rowlogç©ºé—´ï¼Œç„¶åä¾¿&lt;strong&gt;å…è®¸è¯»å†™&lt;/strong&gt;ï¼›&lt;/li&gt;
&lt;li&gt;æ‹·è´åŸå§‹è¡¨çš„æ•°æ®åˆ°ä¸´æ—¶è¡¨ï¼Œæ­¤æ—¶è¡¨æ•°æ®çš„CUDæ“ä½œéƒ½ä¼šæ”¾åœ¨rowlogä¸­ï¼Œæ­¤æ—¶å®¢æˆ·ç«¯ä»ç„¶å¯ä»¥è¿›è¡Œæ“ä½œï¼›&lt;/li&gt;
&lt;li&gt;åŸå§‹è¡¨æ•°æ®å…¨éƒ¨æ‹·è´å®Œæˆåï¼Œä¼šå°†rowlogä¸­çš„æ”¹åŠ¨åŒæ­¥åˆ°ä¸´æ—¶è¡¨ä¸­ï¼Œæ­¤æ—¶å®¢æˆ·ç«¯ä¸å¯æ“ä½œï¼›&lt;/li&gt;
&lt;li&gt;å½“åŸå§‹è¡¨ä¸­çš„æ•°æ®éƒ½è¢«copyåˆ°ä¸´æ—¶è¡¨åï¼Œå¹¶ä¸”copyæœŸé—´å®¢æˆ·ç«¯çš„æ‰€æœ‰CUDæ“ä½œéƒ½åŒæ­¥åˆ°ä¸´æ—¶è¡¨åï¼ˆ&lt;strong&gt;åŒæ­¥copyæœŸé—´çš„æ“ä½œç¦æ­¢è¯»å†™&lt;/strong&gt;ï¼‰ï¼ŒåŸå§‹è¡¨åˆ é™¤ï¼Œä¸´æ—¶è¡¨æ›´åä¸ºåŸå§‹è¡¨è¡¨åï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æ‰€ä»¥å…¶å®Online DDLä¹Ÿä¼šé”è¡¨çš„ï¼Œåªæ˜¯é”è¡¨çš„æ—¶é—´ç‰¹åˆ«çŸ­ï¼Œå‡ ä¹å¯ä»¥å…¨ç¨‹å…è®¸è¯»å†™ã€‚&lt;/p&gt;
&lt;p&gt;è¦æ³¨æ„å½“è¡¨çš„æ•°æ®é‡æ¯”è¾ƒå¤§æ—¶ï¼Œä¸è¦è®¾ç½®defaultå€¼ï¼Œå¦‚æœå­—æ®µå¸¦æœ‰defaultå€¼ï¼ŒMySQLä¼šåœ¨æ‰§è¡Œå®ŒOnline DDLåï¼Œå¯¹æ•´ä¸ªè¡¨è¯¥æ–°å¢å­—æ®µæ›´æ–°é»˜è®¤å€¼ï¼Œå¯¼è‡´é”è¡¨ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨å¯¹ç´¢å¼•è¿›è¡Œæ·»åŠ å’Œåˆ é™¤æ—¶ä¹Ÿæ˜¯ç±»ä¼¼çš„æ­¥éª¤ï¼Œåªæ˜¯ä¸æ˜¯ä½¿ç”¨copyçš„æ–¹å¼ï¼Œè€Œæ˜¯æ”¹æˆäº†in-placeæ–¹å¼ï¼Œä¸éœ€è¦å¤åˆ¶æ•°æ®ï¼Œè€Œæ˜¯å°†copyçš„æ“ä½œæ”¹æˆæŒ‰ç…§èšç°‡ç´¢å¼•çš„é¡ºåºæŸ¥è¯¢æ•°æ®ï¼Œæ‰¾åˆ°éœ€è¦çš„ç´¢å¼•åˆ—æ•°æ®ï¼Œæ’åºåæ’å…¥æ–°çš„ç´¢å¼•é¡µä¸­ã€‚&lt;/p&gt;
&lt;p&gt;5.6ç‰ˆæœ¬ä¹‹åcopyå’Œin-placeå°±éƒ½å¯¹å¢åˆ å­—æ®µã€ç´¢å¼•æ—¶éƒ½å¯ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;å‚è€ƒï¼šhttps://segmentfault.com/a/1190000041149544&lt;/p&gt;
&lt;h2 id=&#34;å…³äºäº‹åŠ¡å¯è§æ€§çš„ç–‘é—®&#34;&gt;å…³äºäº‹åŠ¡å¯è§æ€§çš„ç–‘é—®&lt;/h2&gt;
&lt;p&gt;åœ¨å¯é‡å¤è¯»çš„éš”ç¦»çº§åˆ«ä¸‹ï¼Œäº‹åŠ¡Aå¼€å¯ï¼Œæ“ä½œæ•°æ®Dï¼Œæ­¤æ—¶ä¼šåˆ›å»ºä¸€ä¸ªå½“å‰æ•°æ®Dçš„è§†å›¾(MVCC)ï¼Œä½†æ­¤æ—¶åˆåˆšå¥½æœ‰äº‹åŠ¡Bï¼Œå·²ç»æ“ä½œåˆ°è¿™æ¡æ•°æ®ï¼Œå¹¶ç»™è¿™æ¡æ•°æ®åŠ äº†è¡Œé”ï¼Œå¯¹è¿™æ¡æ•°æ®è¿›è¡Œæ“ä½œï¼Œäº‹åŠ¡Bæ“ä½œå®Œæˆåï¼Œé‡Šæ”¾æ•°æ®Dçš„è¡Œé”ï¼Œé‚£ä¹‹å‰çš„äº‹åŠ¡Aåœ¨æœ€ç»ˆä¿®æ”¹æ“ä½œæ•°æ®Dæ—¶ï¼Œæ•°æ®Dçš„å€¼æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;å‡å¦‚ä¸€å¼€å§‹kçš„å€¼æ˜¯1ï¼Œautocommit=1ï¼Œå³å•ç‹¬ä¸€æ¡SQLæ‰§è¡Œæœ¬èº«å°±æ˜¯ä¸€ä¸ªäº‹åŠ¡ï¼Œä¼šè‡ªåŠ¨æäº¤&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å¦å¤–ï¼Œäº‹åŠ¡ä¸­çš„begin / start transactionå‘½ä»¤ï¼Œæ˜¯ä»¥æ‰§è¡Œå®ƒä»¬ä¹‹åçš„ç¬¬ä¸€ä¸ªsqlè¯­å¥ä¸ºå¯åŠ¨å¼€å§‹äº‹åŠ¡ï¼Œè€Œstart with consisten snapshotæ˜¯ä»¥è¿™æ¡å‘½ä»¤ä¸ºèµ·ç‚¹å¼€å¯äº‹åŠ¡&lt;/strong&gt;&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;äº‹åŠ¡A&lt;/th&gt;
&lt;th&gt;äº‹åŠ¡B&lt;/th&gt;
&lt;th&gt;äº‹åŠ¡C&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;start transaction with consisten snapshot;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;start transaction with consisten snapshot;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;update t set k = k + 1 where id = D&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;update t set k = k + 1 where id = D;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;select K from t where id = D;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;select k from t where id = D;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;commit;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;commit;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;ä¸Šé¢è¿™é“é¢˜çš„ç­”æ¡ˆæ˜¯ äº‹åŠ¡AæŸ¥åˆ°kçš„å€¼åˆ†åˆ«æ˜¯1ï¼Œäº‹åŠ¡BæŸ¥åˆ°kçš„å€¼æ˜¯3&lt;/p&gt;
&lt;p&gt;åŸå› ï¼šäº‹åŠ¡Aä¹‹æ‰€ä»¥æŸ¥åˆ°çš„å€¼æ˜¯1ï¼Œæ˜¯å› ä¸ºäº‹åŠ¡Aå¼€å¯æ—¶ï¼Œäº‹åŠ¡Bå’ŒCè¿˜æ²¡å¼€å¯ï¼Œæ­¤æ—¶çš„å¿«ç…§k=1ï¼Œå› æ­¤å¾—åˆ°çš„å€¼æ˜¯1ã€‚äº‹åŠ¡BæŸ¥åˆ°kçš„å€¼æ˜¯3ï¼Œè™½ç„¶äº‹åŠ¡Cæ˜¯åœ¨äº‹åŠ¡Bä¹‹åå¼€å¯çš„ï¼Œæ„Ÿè§‰çœ‹ä¸åˆ°äº‹åŠ¡Cä¿®æ”¹åçš„å€¼ï¼Œä½†æ˜¯ç”±äºæ›´æ–°æ“ä½œæ˜¯å…ˆè¯»åå†™çš„ï¼Œæ­¤æ—¶çš„è¯»æ˜¯&lt;strong&gt;å½“å‰è¯»&lt;/strong&gt;ï¼ˆå½“å‰è¯»æ€»æ˜¯è¯»è¯¥å·²æäº¤çš„æ•°æ®çš„æœ€æ–°ç‰ˆæœ¬ï¼‰ï¼Œè€Œå½“å‰è¯»çš„å€¼æ˜¯2ï¼Œå› æ­¤æ›´æ–°åkçš„å€¼æ˜¯3ï¼Œå¦‚æœä¸è¿™ä¹ˆåšï¼Œå°±ä¼šå¯¼è‡´äº‹åŠ¡Cæ›´æ–°ä¸¢å¤±ï¼Œè€Œåœ¨åŒä¸€ä¸ªäº‹åŠ¡å†…è¯»å€¼ï¼Œæ˜¯å¯ä»¥è¯»åˆ°ç”±å½“å‰äº‹åŠ¡ä¿®æ”¹çš„å€¼çš„ï¼Œæ‰€ä»¥äº‹åŠ¡Bè¯»åˆ°çš„å€¼æ˜¯3ã€‚æ™®é€šselectè¯­å¥ï¼Œåœ¨å¯é‡å¤è¯»æƒ…å†µä¸‹ï¼Œä¸ºäº†å®ç°ä¸€è‡´æ€§è¯»ï¼Œæ˜¯é€šè¿‡è¯»undo logå®ç°çš„ï¼Œå¦‚æœundo logå¤ªé•¿ï¼ˆå¯èƒ½å› ä¸ºæ›´æ–°æ¬¡æ•°å¤ªå¤šï¼‰ï¼Œä¼šå¯¼è‡´æŸ¥çš„å¾ˆæ…¢&lt;/p&gt;
&lt;p&gt;é¢˜å¤–è¯ï¼Œå¦‚æœäº‹åŠ¡Aè¯»çš„æ—¶å€™åŠ é”ï¼Œå°±ä¼šå˜æˆå½“å‰è¯»ï¼Œä¾‹å¦‚å°†äº‹åŠ¡Açš„selectè¯­å¥åé¢åŠ ä¸Šlock in share modeï¼ˆå…±äº«é”ï¼‰æˆ–è€…for updateï¼ˆæ’ä»–é”ï¼‰ï¼Œé‚£ä¹ˆæŸ¥åˆ°çš„å€¼å°±æ˜¯3äº†ã€‚å¦‚æœäº‹åŠ¡Båœ¨æ‰§è¡Œæ›´æ–°å‰å…ˆselectäº†ï¼ŒæŸ¥åˆ°çš„å€¼ä¹Ÿæ˜¯1ã€‚å¦‚æœäº‹åŠ¡Cæ˜¯æ˜¾å¼å¯åŠ¨äº‹åŠ¡ï¼Œåœ¨äº‹åŠ¡B selectåcommitå‰æ‰æ‰§è¡Œcommitæ“ä½œï¼Œå°±ä¼šè§¦å‘äºŒé˜¶æ®µé”åè®®ï¼Œä¸¤æ¡æ›´æ–°è¯­å¥åŒæ—¶æ›´æ–°ä¸€è¡Œæ•°æ®ï¼Œå…ˆæ‰§è¡Œçš„è¯­å¥ä¼šå¯¹è¿™æ¡æ•°æ®åŠ è¡Œé”ï¼Œæ‰€ä»¥äº‹åŠ¡Béœ€è¦ç­‰åˆ°äº‹åŠ¡Cæäº¤åï¼Œæ‰èƒ½æ‰§è¡Œæ›´æ–°æ“ä½œ&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªé—®é¢˜çš„å…³é”®åœ¨äºè¦ç†è§£ MVCCåŸç†ï¼Œæ›´æ–°æ“ä½œå‰çš„å½“å‰è¯»ï¼Œäº‹åŠ¡çš„éš”ç¦»çº§åˆ«ï¼Œä¸€è‡´æ€§è¯»ã€è¡Œé”&lt;/p&gt;
&lt;p&gt;å‚è€ƒï¼š&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.cnblogs.com/crazylqy/p/7611069.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;MysqlåŠ é”è¿‡ç¨‹è¯¦è§£ï¼ˆ1ï¼‰-åŸºæœ¬çŸ¥è¯†&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.cnblogs.com/leedaily/p/8378779.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Mysqlä¸­çš„é”æœºåˆ¶&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://tech.meituan.com/2014/08/20/innodb-lock.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Innodbä¸­çš„äº‹åŠ¡éš”ç¦»çº§åˆ«å’Œé”çš„å…³ç³»&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;å¤§è¡¨ä¼˜åŒ–&#34;&gt;å¤§è¡¨ä¼˜åŒ–&lt;/h1&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://segmentfault.com/a/1190000006158186&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;MySQLå¤§è¡¨ä¼˜åŒ–æ–¹æ¡ˆ&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;å¤§è¡¨å»ºç«‹ç´¢å¼•&#34;&gt;å¤§è¡¨å»ºç«‹ç´¢å¼•&lt;/h2&gt;
&lt;p&gt;å½“è¡¨çš„æ•°æ®é‡å¾ˆå¤§ï¼Œå¹¶ä¸”TPSä¹Ÿå¾ˆé«˜æ—¶ï¼Œå»ºç«‹ç´¢å¼•æˆ–è€…ä¿®æ”¹è¡¨ç»“æ„ä¼šå¾ˆæ…¢ï¼Œç”šè‡³å‡ºç°æ­»é”ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;æ–¹æ¡ˆ1ï¼šåˆ›å»ºä¸€å¼ ä¸åŸè¡¨ç»“æ„ç›¸åŒçš„æ–°è¡¨ï¼Œåœ¨æ–°è¡¨ä¸Šåˆ›å»ºç´¢å¼•ï¼Œå°†åŸè¡¨æ”¹åï¼Œæ–°è¡¨æ”¹æˆåŸè¡¨çš„åå­—ï¼Œè®©æ–°è¡¨æ‰¿æ‹…ä¸šåŠ¡ï¼Œç„¶åä¸ºè€è¡¨æ–°å¢ç´¢å¼•ï¼Œå®Œäº†ä¹‹åå†äº¤æ¢è¡¨åï¼Œå†å°†æ–°è¡¨äº§ç”Ÿçš„æ•°æ®å¯¼å…¥åˆ°åŸè¡¨ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯è¿™ç§æ–¹å¼æœ‰ä¸ªé—®é¢˜æ˜¯å¦‚æœè¦å¯¹è€è¡¨çš„æ•°æ®è¿›è¡Œåˆ æ”¹ï¼Œä¼šäº§ç”Ÿæ•°æ®ä¸¢å¤±ï¼Œæ­¤è¿‡ç¨‹å¯ä»¥é€šè¿‡å»ºç«‹è§¦å‘å™¨è§£å†³ï¼Œæœ‰Percona Toolkitå·¥å…·å°±å¯ä»¥è‡ªåŠ¨å®Œæˆä¸Šè¿°è¿‡ç¨‹ï¼Œå¹¶ä¸”ä¿è¯æ•°æ®åˆ æ”¹ä¸ä¸¢å¤±ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ–¹æ¡ˆ2ï¼šåœ¨ä¸šåŠ¡ç©ºé—²çš„æ—¶å€™ï¼Œåœ¨ä»åº“ä¸Šçš„è¡¨å»ºç´¢å¼•ï¼Œç­‰å¾…ä¸»åº“å’Œä»åº“åŒæ­¥ä½ç‚¹ä¸€è‡´ï¼Œåˆ‡æ¢ä¸»ä»å³å¯ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;å¤§é‡æ•°æ®åˆ é™¤&#34;&gt;å¤§é‡æ•°æ®åˆ é™¤&lt;/h2&gt;
&lt;p&gt;å¤§é‡åˆ é™¤æ—¶ï¼Œä¼šé”è¡¨ï¼Œä¸šåŠ¡é«˜å³°æ—¶è¿˜ä¼šCPUæš´æ¶¨ï¼Œå¯¼è‡´æ•°æ®åº“æ€§èƒ½ä¸‹é™&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ–¹æ¡ˆ1ï¼šåˆ é™¤å¤§è¡¨çš„å¤šè¡Œæ•°æ®æ—¶ï¼Œä¼šè¶…å‡ºInnoDB block table sizeçš„é™åˆ¶ï¼Œè¦åšçš„å°±ç®—å‡å°‘é”è¡¨çš„æ—¶é—´ï¼Œå¯ä»¥é€‰æ‹©ä¸éœ€è¦åˆ é™¤çš„æ•°æ®ï¼Œå­˜åˆ°ä¸€å¼ åŒåçš„ç©ºè¡¨é‡Œï¼Œé‡æ–°å‘½ååŸå§‹è¡¨ï¼Œæ–°è¡¨ä½¿ç”¨åŸè¡¨åï¼Œåˆ é™¤åŸå§‹è¡¨&lt;/li&gt;
&lt;li&gt;æ–¹æ¡ˆ2ï¼šå°†æ‰¹é‡åˆ é™¤çš„ä»»åŠ¡æ‹†åˆ†æˆNä¸ªå°åˆ é™¤ä»»åŠ¡ï¼Œå¼‚æ­¥æ‰§è¡Œ&lt;/li&gt;
&lt;li&gt;æ–¹æ¡ˆ3ï¼šåˆ é™¤è¡¨ä¸Šçš„ç´¢å¼•ï¼Œå†åˆ é™¤æ•°æ®ï¼Œæå‡åˆ é™¤æ•ˆç‡&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;cpuæˆ–ioè¿‡é«˜å¯èƒ½çš„åŸå› &#34;&gt;CPUæˆ–IOè¿‡é«˜å¯èƒ½çš„åŸå› &lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;æ…¢æŸ¥è¯¢å¯¼è‡´CPUé£™å‡ï¼ŒQPSä¸é«˜ï¼ŒæŸ¥è¯¢æ•ˆç‡ä½ï¼Œéœ€è¦æ‰«æå¤§é‡æ•°æ®æ‰èƒ½å‡ºç»“æœå¯¼è‡´ï¼Œè¿™ç§æ—¶å€™ä¸€èˆ¬æ˜¯&lt;code&gt;show processlist&lt;/code&gt;æŸ¥çœ‹å½“å‰æ‰§è¡Œçš„æŸ¥è¯¢ï¼Œkillæ‰æ…¢æŸ¥è¯¢å¯¹åº”çš„id&lt;/li&gt;
&lt;li&gt;æ…¢æŸ¥è¯¢ï¼Œç£ç›˜æ•…éšœï¼Œä¸åˆç†çš„é…ç½®+å¤§é‡å¢åˆ æ”¹å¯¼è‡´IOå‡é«˜ï¼Œä¸€èˆ¬ç»“åˆ&lt;code&gt;performance_schema&lt;/code&gt;æŸ¥çœ‹MySQLå„é¡¹æŒ‡æ ‡ï¼ŒæŸ¥çœ‹åˆ·ç›˜ç›¸å…³çš„å‚æ•°é…ç½®æ˜¯å¦åˆç†ï¼Œæ¯”å¦‚&lt;code&gt;sync_binlog&lt;/code&gt;ä¹‹ç±»çš„&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;åˆ†åº“åˆ†è¡¨&#34;&gt;åˆ†åº“åˆ†è¡¨&lt;/h2&gt;
&lt;p&gt;ä¸»è¦æ˜¯ä¸ºäº†è§£å†³æ•°æ®é‡å¤ªå¤§å¯¼è‡´æŸ¥è¯¢æ…¢ï¼ˆä¸€èˆ¬å¯ä»¥åˆ†è¡¨ï¼Œä¸»ä»åˆ†ç¦»ï¼‰ï¼Œè¿˜æœ‰é«˜å¹¶å‘é—®é¢˜ï¼ˆä¸€èˆ¬æ˜¯åˆ†åº“ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;åˆ†è¡¨æ—¶ä¸€èˆ¬åˆ†ä¸ºæ°´å¹³æ‹†åˆ†ï¼ˆå¯¹è¡Œï¼Œå³æ•°é‡ï¼Œæ¯”å¦‚æ ¹æ®idå“ˆå¸Œåˆ†æ•£åˆ°ä¸åŒçš„è¡¨ï¼‰å’Œå‚ç›´æ‹†åˆ†ï¼ˆå¯¹åˆ—ï¼Œå³æ‹†å­—æ®µï¼Œæˆ–è€…ç›´æ¥å°†æŸäº›è¡¨ç‹¬ç«‹æˆåº“ï¼‰&lt;/p&gt;
&lt;h2 id=&#34;åˆ†ç‰‡ç®—æ³•&#34;&gt;åˆ†ç‰‡ç®—æ³•&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;æ—¶é—´åˆ†ç‰‡ã€èŒƒå›´åˆ†ç‰‡ï¼Œä½†å®¹æ˜“äº§ç”Ÿçƒ­ç‚¹é—®é¢˜&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å“ˆå¸Œåˆ†ç‰‡ï¼Œé’ˆå¯¹æŸä¸€åˆ—åšå“ˆå¸Œå–æ¨¡ï¼Œå¹³å‡åˆ†é…åˆ°å„ä¸ªåˆ†è¡¨ä¸­ï¼Œå¦‚æœè¦æ‰©å®¹ï¼Œç”±äºæ¨¡ä¼šå˜ï¼Œå¯¼è‡´æ•°æ®è¦é‡æ–°å“ˆå¸Œï¼Œåœæœºè¿ç§»æ•°æ®ï¼Œè¿™æ ·æ˜¯ä¸è¡Œçš„ï¼Œå› æ­¤ä¸€å¼€å§‹è¦è®¾è®¡å¥½ï¼Œä¾‹å¦‚ä½¿ç”¨ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•ï¼Œå‡å°‘è¿ç§»çš„æ•°æ®é‡ï¼›&lt;/p&gt;
&lt;p&gt;æˆ–è€…åˆ†è¡¨çš„æ—¶å€™å–2çš„næ¬¡æ–¹ï¼Œè¿™æ ·æ‰©å®¹çš„æ—¶å€™ä¹Ÿä»¥2çš„næ¬¡è¿›è¡Œæ‰©å®¹ï¼Œè¿™æ ·åŸæ¥çš„keyé‡æ–°å–æ¨¡æ˜¯åœ¨åŸæ¥çš„ä½ç½®æˆ–è€…åŸæ¥çš„2å€ï¼›æˆ–è€…æ¢ä¸ªæ•°æ®åº“äº†ï¼Œåƒä¸Šé¢å¤§è¡¨ä¼˜åŒ–é‡Œé¢æåˆ°çš„é‚£æ ·ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æŸ¥è¡¨æ³•ï¼Œå…ˆé€šè¿‡åˆ†ç‰‡æ˜ å°„è¡¨æŸ¥åˆ°è¦æŸ¥è¯¢çš„åˆ†ç‰‡ï¼Œå†åˆ°å¯¹åº”çš„åˆ†ç‰‡è¿›è¡ŒæŸ¥è¯¢ï¼Œä½†æ˜¯è¦äºŒæ¬¡æŸ¥è¯¢ï¼Œå³ä½¿ä¸Šç¼“å­˜ï¼ŒæŸ¥è¯¢æ€§èƒ½ä¹Ÿæ˜¯ä¸€èˆ¬ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;sharding-keyé€‰æ‹©é—®é¢˜&#34;&gt;Sharding Keyé€‰æ‹©é—®é¢˜&lt;/h2&gt;
&lt;p&gt;ä¸€èˆ¬æ˜¯ä½¿ç”¨æœ€å¸¸ç”¨çš„æŸ¥è¯¢æ¡ä»¶åšåˆ†ç‰‡keyï¼›&lt;/p&gt;
&lt;p&gt;å½“åˆ†åº“åˆ†è¡¨é‡åˆ°Sharding Keyå†²çªæ—¶ï¼Œåªèƒ½é€‰æ‹©å†—ä½™æ•°æ®äº†ï¼Œæˆ–è€…é€šè¿‡å°†å¤šä¸ªåˆ—ç»„åˆæˆä¸€ä¸ªæ–°çš„åˆ—æ¥æ ‡è¯†ï¼Œæˆ–è€…å»ºç«‹æ˜ å°„è¡¨ï¼›&lt;/p&gt;
&lt;p&gt;åˆ†ç‰‡ä¹‹åï¼Œcountä¹‹ç±»çš„è®¡æ•°å°±åªèƒ½ç”¨ä¸€å¼ è¡¨å•ç‹¬å­˜æˆ–è€…è®°å½•åœ¨Redisä¸­äº†ï¼Œä¸ç„¶å°±åªèƒ½æ‰€æœ‰åˆ†ç‰‡æ‰«ä¸€æ¬¡ï¼›&lt;/p&gt;
&lt;h1 id=&#34;æ•°æ®éƒ¨åˆ†&#34;&gt;æ•°æ®éƒ¨åˆ†&lt;/h1&gt;
&lt;p&gt;MySQLä¸€èˆ¬çš„é›†ç¾¤æ¶æ„æ˜¯ æœ‰ä¸¤å°MySQLå®è¡ŒåŒMasteréƒ¨ç½²ï¼Œè¿›è¡Œä¸»å¤‡å¤åˆ¶ï¼Œæ³¨æ„è¦æŠŠå¤‡ç”¨çš„masterçš„ä¸»å¤‡å¤åˆ¶å…³é—­ï¼Œé¿å…å¾ªç¯å¤åˆ¶ï¼Œå¦å¤–ä¼šéƒ¨ç½²ä¸€äº›æœºå­ä½œä¸ºä»åº“ï¼Œä»¥å…¶ä¸­ä¸€å°masterä¸ºä¸»åº“è¿›è¡Œéƒ¨ç½²&lt;/p&gt;
&lt;h2 id=&#34;æ•°æ®å­˜å‚¨å’Œæ¢å¤&#34;&gt;æ•°æ®å­˜å‚¨å’Œæ¢å¤&lt;/h2&gt;
&lt;p&gt;åªè¦redo log å’Œ bin logèƒ½å¤ŸæŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œå°±èƒ½ç¡®ä¿MySQLå¼‚å¸¸é‡å¯åï¼Œæ•°æ®å°±å¯ä»¥æ¢å¤&lt;/p&gt;
&lt;h3 id=&#34;åŸç†&#34;&gt;åŸç†&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;bin logçš„å†™å…¥æœºåˆ¶ï¼šäº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå…ˆæŠŠæ—¥å¿—å†™è¿›bin log cacheï¼Œäº‹åŠ¡æäº¤æ—¶ï¼Œå†æŠŠbin log cacheå†™è¿›bin logæ–‡ä»¶ï¼ˆå…ˆå†™åˆ°æ–‡ä»¶ç³»ç»Ÿçš„page cacheï¼Œå†è¿›è¡ŒæŒä¹…åŒ–ï¼‰ä¸­ï¼Œç„¶åæŠŠbin log cacheæ¸…ç©ºã€‚&lt;/p&gt;
&lt;p&gt;bin log cacheæ¯ä¸ªçº¿ç¨‹è‡ªå·±ç»´æŠ¤ï¼Œbin logçš„å†™å…¥æ˜¯ä¸€ä¸ªé¡ºåºæ“ä½œï¼›&lt;/p&gt;
&lt;p&gt;bin log cacheçš„å¤§å°é€šè¿‡&lt;code&gt;binlog_cache_size&lt;/code&gt;æ§åˆ¶ï¼Œå¦‚æœè¶…è¿‡å°±æš‚å­˜åˆ°ç£ç›˜ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;redo logå†™å…¥æœºåˆ¶ï¼šåŸç†ä¸bin logç±»ä¼¼ï¼Œä½†æ˜¯å®ƒæ˜¯äºŒé˜¶æ®µæäº¤ï¼Œæœ‰çŠ¶æ€ï¼Œäº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œredo logå…ˆæ˜¯prepareçŠ¶æ€ï¼Œå†™å…¥redo log bufferï¼Œå†å†™bin logï¼Œæäº¤äº‹åŠ¡ï¼Œå˜ä¸ºredo log commitçŠ¶æ€ï¼›&lt;/p&gt;
&lt;p&gt;redo log bufferå…¨å±€å…±ç”¨ï¼Œä¸bin log cacheä¸åŒï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸€èˆ¬ä¼šæŠŠ&lt;code&gt;sync_binlog&lt;/code&gt;å’Œ&lt;code&gt;innodb_flush_log_at_trx_commit&lt;/code&gt;éƒ½è®¾ç½®ä¸º1ï¼Œå³ä¸€ä¸ªäº‹åŠ¡å®Œæ•´æäº¤å‰ï¼Œä¼šåˆ·ä¸¤æ¬¡ç›˜ã€‚å¦ä¸€ç§è®¾ç½®æ˜¯è®©&lt;code&gt;sync_binlog=1000&lt;/code&gt;å’Œ&lt;code&gt;innodb_flush_log_at_trx_commit=2&lt;/code&gt;ï¼Œä¸€èˆ¬æ˜¯åœ¨ä¸»å¤‡å¤åˆ¶å­˜åœ¨å¾ˆå¤§å»¶è¿Ÿæ—¶ï¼Œä¸ºäº†è®©ä»åº“çš„å¤‡ä»½é€Ÿåº¦è·Ÿä¸Šä¸»åº“ï¼›&lt;/p&gt;
&lt;p&gt;ä¸ºäº†æé«˜åˆ·ç›˜æ•ˆç‡ï¼ŒMySQLä¸€èˆ¬ä¼šè®©å¤šä¸ªäº‹åŠ¡åœ¨ä¸€æ®µæ—¶é—´å†…å®Œæˆï¼Œæˆ–å°½é‡è®©page cacheé‡Œçš„redo logå’Œbin logç»„åˆåœ¨ä¸€èµ·æäº¤ï¼Œå‡å°‘åˆ·ç›˜æ¬¡æ•°ï¼›&lt;/p&gt;
&lt;h2 id=&#34;ä¸»ä»å¤åˆ¶&#34;&gt;ä¸»ä»å¤åˆ¶&lt;/h2&gt;
&lt;p&gt;ä¸€èˆ¬ä»åº“è®¾ç½®ä¸ºread onlyï¼Œå¯ä»¥é¿å…ä¸»ä»åˆ‡æ¢è¿‡ç¨‹çš„åŒå†™ï¼Œå®ç°çš„æ˜¯æœ€ç»ˆä¸€è‡´æ€§ã€‚&lt;/p&gt;
&lt;h3 id=&#34;åŸç†-1&#34;&gt;åŸç†&lt;/h3&gt;
&lt;p&gt;åˆ©ç”¨MySQLä¸­çš„bin-logäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶è®°å½•äº†æ‰€æœ‰sqlä¿¡æ¯ï¼Œä¸»æ•°æ®åº“ä¼šä¸»åŠ¨æŠŠbin-logæ–‡ä»¶å‘é€ç»™ä»æ•°æ®åº“ï¼Œåœ¨ä»æ•°æ®åº“çš„relay-logé‡æ”¾æ—¥å¿—æ–‡ä»¶ä¸­åˆ©ç”¨è¿™äº›ä¿¡æ¯è¿›è¡Œæ¢å¤ã€‚&lt;/p&gt;
&lt;p&gt;bin logåˆ†ä¸ºä¸‰ç§æ ¼å¼&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;statementï¼šè®°å½•æ¯æ¬¡æ‰§è¡Œçš„SQLï¼Œä½†ç”±äºç´¢å¼•é€‰æ‹©é—®é¢˜æˆ–è€…SQLè¯­å¥ä½¿ç”¨èšåˆå‡½æ•°ï¼Œæœ‰å¯èƒ½ä¼šå¯¼è‡´ä¸»ä»ä¸ä¸€è‡´çš„é—®é¢˜&lt;/li&gt;
&lt;li&gt;rowï¼šè®°å½•çš„æ˜¯äº‹ä»¶ï¼Œè¡¨ç¤ºæ¯æ¡SQLè¯­å¥æ‰§è¡Œåçš„æ•°æ®ä¿¡æ¯ï¼Œæ¯”å¦‚deleteæ“ä½œåï¼Œä¼šè®°å½•deleteäº‹ä»¶å’Œdeleteåˆ é™¤çš„è¡Œçš„æ‰€æœ‰å­—æ®µ(å¯è®¾ç½®ä¸ºè®°å½•æ‰€æœ‰å­—æ®µæˆ–è€…åªè®°å½•ä¸»é”®)ï¼›updateæ“ä½œä¼šè®°å½•è¡Œæ•°æ®å‰åçš„è®°å½•ï¼›insertæ“ä½œä¼šè®°å½•insertçš„æ‰€æœ‰å­—æ®µä¿¡æ¯ï¼Œç¼ºç‚¹æ˜¯å ç©ºé—´ï¼Œä½†å¯¹æ•°æ®çš„æ¢å¤æœ‰åˆ©&lt;/li&gt;
&lt;li&gt;mixï¼ˆæ··åˆä¸Šé¢ä¸¤ç§ï¼‰ï¼šç”±MySQLè‡ªå·±åˆ¤æ–­ï¼Œå¦‚æœä¼šå‡ºç°ä¸»ä»ä¸ä¸€è‡´ï¼Œå°±ä½¿ç”¨rowï¼Œå¦åˆ™ä½¿ç”¨statement&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;bin logä¸Šä¼šè®°å½•æ¯å°æœºå­çš„server idï¼Œç”¨äºé¿å…å¾ªç¯å¤åˆ¶&lt;/p&gt;
&lt;h3 id=&#34;å…·ä½“æ­¥éª¤&#34;&gt;å…·ä½“æ­¥éª¤&lt;/h3&gt;
&lt;p&gt;æ¯ä¸ªMySQLæ•°æ®åº“ä¸Šéƒ½æœ‰è¿™ä¸‰ä¸ªçº¿ç¨‹ï¼Œ&lt;strong&gt;é»˜è®¤æ˜¯ä¸»æœåŠ¡å™¨å†™å®Œbin logåå°±ç®—äº‹åŠ¡æˆåŠŸï¼Œbin logå¤åˆ¶æ˜¯å¼‚æ­¥æ‰§è¡Œã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;binlog çº¿ç¨‹&lt;/strong&gt; ï¼šè´Ÿè´£å°†ä¸»åº“ä¸Šçš„æ•°æ®æ›´æ”¹å†™å…¥bin logï¼Œä¹‹åäº‹åŠ¡çº¿ç¨‹æäº¤äº‹åŠ¡ï¼Œå“åº”æˆåŠŸç»™å®¢æˆ·ç«¯ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;I/O çº¿ç¨‹&lt;/strong&gt; ï¼šè´Ÿè´£ä»ä¸»åº“ä¸Šè¯»å–bin logï¼Œå¹¶å†™å…¥ä»åº“çš„é‡æ”¾æ—¥å¿—ï¼ˆrelay logï¼‰ä¸­ï¼Œä¸»åº“ä¹Ÿä¼šåˆ›å»ºä¸€ä¸ªlog dumpçº¿ç¨‹æ¥å¼‚æ­¥å‘é€bin logç»™ä»åº“ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;SQL çº¿ç¨‹&lt;/strong&gt; ï¼šåœ¨ä»åº“é‡Œï¼Œè´Ÿè´£å°†è¯»å–åˆ°çš„relay logæ—¥å¿—å¹¶é‡æ”¾å…¶ä¸­çš„ SQL è¯­å¥ã€‚MySQL 5.6å‰åªæ”¯æŒå•çº¿ç¨‹ï¼Œ5.6åæ”¹ä¸ºå¤šçº¿ç¨‹ï¼ŒSQLçº¿ç¨‹åˆ†ä¸ºcontainerå¯¹äº‹åŠ¡è¿›è¡Œåˆ†å‘ï¼Œè°ƒåº¦ä¸åŒçš„workerçº¿ç¨‹è¿›è¡Œæ‰§è¡Œï¼Œåˆ†å‘ç­–ç•¥ï¼š1ã€æ›´æ–°åŒä¸€è¡Œçš„ä¸¤ä¸ªäº‹åŠ¡ï¼Œå¿…é¡»è¢«åˆ†å‘åˆ°åŒä¸€ä¸ªworkerï¼›2ã€åŒä¸€ä¸ªäº‹åŠ¡ä¸èƒ½è¢«æ‹†å¼€ï¼Œå¿…é¡»åœ¨åŒä¸€workerä¸­æ‰§è¡Œ&lt;/p&gt;
&lt;p&gt;ä»åº“åœ¨åŒæ­¥bin logæ—¶ï¼Œå¿…é¡»ä¿è¯bin logçš„é¡ºåºï¼Œæ‰èƒ½ç¡®ä¿æ•°æ®ä¸€è‡´æ€§ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/MySQL%e4%b8%bb%e4%bb%8e%e5%a4%8d%e5%88%b6.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/MySQL%e4%b8%bb%e4%bb%8e%e5%a4%8d%e5%88%b6.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			alt=&#34;MySQLä¸»ä»å¤åˆ¶&#34;&gt;
	&lt;/a&gt;
	
	&lt;figcaption&gt;MySQLä¸»ä»å¤åˆ¶&lt;/figcaption&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;é»˜è®¤æƒ…å†µä¸‹ï¼Œç”±äºæ˜¯å¼‚æ­¥å¤åˆ¶ï¼Œæ— æ³•ä¿è¯æ•°æ®ç¬¬ä¸€æ—¶é—´å¤åˆ¶åˆ°ä»åº“ä¸Šï¼Œä½†å¦‚æœé‡‡ç”¨åŒæ­¥å¤åˆ¶ï¼Œå³ç­‰ä»åº“å¤åˆ¶å®Œä¸»åº“çš„bin logåæ‰å“åº”ç»™å®¢æˆ·ç«¯ï¼Œæ€§èƒ½å°±å¤ªå·®äº†ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨MySQL 5.7åçš„ç‰ˆæœ¬ï¼Œå¢åŠ &lt;strong&gt;åŠåŒæ­¥å¤åˆ¶&lt;/strong&gt;(Semisynchronous Replication)ï¼Œäº‹åŠ¡çº¿ç¨‹ä¸ç”¨ç­‰åˆ°æ‰€æœ‰éƒ½å¤åˆ¶æˆåŠŸæ‰å“åº”ï¼Œåªè¦ä¸€éƒ¨åˆ†å¤åˆ¶å“åº”å›æ¥åå³å¯å“åº”ç»™å®¢æˆ·ç«¯ï¼Œæ¯”å¦‚ä¸€ä¸»äºŒä»ï¼Œç­‰ä¸€ä»æˆåŠŸå³å¯æˆåŠŸã€‚é…ç½®&lt;code&gt;rpl_semi_sync_master_wait_no_slave&lt;/code&gt;è¡¨ç¤ºè‡³å°‘ç­‰å¾…å¤šå°‘ä¸ªä»åº“å¤åˆ¶æˆåŠŸæ‰ç®—æˆåŠŸã€‚&lt;code&gt;rpl_semi_sync_master_wait_point&lt;/code&gt;è¡¨ç¤ºä¸»åº“æ‰§è¡Œäº‹åŠ¡çš„çº¿ç¨‹æ˜¯æäº¤äº‹åŠ¡å‰ç­‰å¾…å¤åˆ¶(é»˜è®¤)ï¼Œè¿˜æ˜¯æäº¤äº‹åŠ¡ä¹‹åç­‰å¾…å¤åˆ¶&lt;/p&gt;
&lt;h3 id=&#34;ä¸»å¤‡å»¶è¿Ÿ&#34;&gt;ä¸»å¤‡å»¶è¿Ÿ&lt;/h3&gt;
&lt;p&gt;å½“å¤‡åº“é‡æ”¾æ—¥å¿—çš„é€Ÿåº¦å°äºä¸»åº“äº§ç”Ÿbin logçš„é€Ÿåº¦ï¼Œä¼šå‡ºç°ä¸»å¤‡å»¶è¿Ÿï¼Œå¯èƒ½çš„åŸå› ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸»å¤‡æœºå™¨é…ç½®ä¸ä¸€è‡´ï¼Œå¤‡åº“æœºå™¨æ€§èƒ½è¾ƒå·®&lt;/li&gt;
&lt;li&gt;å¤‡åº“å‹åŠ›å¤§ï¼Œæ¯”å¦‚åœ¨å¤‡åº“ä¸Šè¿›è¡ŒSQLåˆ†æã€å¤§é‡æŸ¥è¯¢ã€å¤§è¡¨çš„DDLï¼Œä¸»åº“ä¸Šçš„é•¿äº‹åŠ¡æ“ä½œç­‰ï¼Œæ¶ˆè€—å¤§é‡CPUèµ„æºå¯¼è‡´&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é»˜è®¤æƒ…å†µä¸‹ï¼Œå¼‚æ­¥å¤åˆ¶ä¹Ÿä¼šå¸¦æ¥çš„è¯»å»¶æ—¶é—®é¢˜ï¼Œå¯ä»¥é‡‡å– ä¸€ä¸»å¤šä»ï¼Œä¸»å†™ä»è¯»ï¼Œåˆ†æ•£å‹åŠ›ï¼›åˆ©ç”¨å¥½ç¼“å­˜ä¸­é—´ä»¶ï¼›æŒä¹…åŒ–å±‚çš„å¤„ç†ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨MySQL 5.6åçš„ç‰ˆæœ¬ï¼Œå¯ä»¥è®¾ç½®&lt;code&gt;slave_parallel_workers&lt;/code&gt;æ¥å†³å®šä»åº“åœ¨è¿›è¡Œé‡æ”¾æ—¶å·¥ä½œçš„çº¿ç¨‹æ•°ï¼Œä¸€èˆ¬è®¾ç½®åœ¨8~16ï¼Œä»¥é€šè¿‡å¹¶è¡Œé‡æ”¾çš„ç›®çš„åŠ å¿«ä¸»ä»å¤åˆ¶é€Ÿåº¦ã€‚&lt;/p&gt;
&lt;p&gt;å½“MySQLé›†ç¾¤æ­å»ºé‡‡ç”¨ä¸€ä¸»å¤šä»æ—¶ï¼Œæœ€å¥½é‡‡ç”¨GTIDæ¨¡å¼æ¥å®ç°ä¸€ä¸»å¤šä»çš„åˆ‡æ¢ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ä¸»å¤‡åˆ‡æ¢ç­–ç•¥&#34;&gt;ä¸»å¤‡åˆ‡æ¢ç­–ç•¥&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;å¯é æ€§ä¼˜å…ˆï¼šå‰æï¼Œå¤‡åº“æ˜¯åªè¯»çš„ï¼Œé¦–å…ˆï¼Œå¤‡åº“æŒç»­åˆ¤æ–­ä¸ä¸»åº“åŒæ­¥é—´çš„å»¶è¿Ÿæ—¶é—´ï¼Œå¦‚æœå°äºå¯æ¥å—çš„å€¼ï¼Œä¸»åº“æ”¹ä¸ºåªè¯»ï¼Œä¸»åº“ç­‰å¾…å¤‡åº“åŒæ­¥å»¶è¿Ÿæ—¶é—´é™ä¸º0ï¼Œå¤‡åº“æ”¹ä¸ºå¯è¯»å†™ï¼Œä¸šåŠ¡åˆ‡æ¢åˆ°å¤‡åº“ï¼Œä¸šåŠ¡ä¸å¯å†™çš„æ—¶é—´å–å†³äºä¸»åº“ç­‰å¾…å¤‡åº“åŒæ­¥æ•°æ®çš„å»¶è¿Ÿæ—¶é—´&lt;/li&gt;
&lt;li&gt;å¯ç”¨æ€§ä¼˜å…ˆï¼šæ­¥éª¤ä¸ä¸Šé¢çš„ç±»ä¼¼ï¼Œåªæ˜¯ä¸»åº“æ”¹ä¸ºåªè¯»åï¼Œä¸ç­‰å¾…å¤‡åº“åŒæ­¥å®Œæ•°æ®ï¼Œå°±åˆ‡åˆ°å¤‡åº“ï¼Œæ­¤æ—¶æ•°æ®ä¼šä¸ä¸€è‡´ï¼Œåé¢å†è‡ªå·±æ ¹æ®bin logæ‰‹åŠ¨è°ƒæ•´æ›´æ­£&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;MySQLçš„é«˜å¯ç”¨ï¼ˆé€šè¿‡ä¸»åº“å‘ç”Ÿæ•…éšœæ—¶åˆ‡åˆ°ä»åº“ï¼‰ï¼Œæ˜¯ä¾èµ–ä¸»å¤‡å¤åˆ¶çš„ï¼Œä¸»å¤‡å»¶è¿Ÿæ—¶é—´è¶Šå°ï¼Œå¯ç”¨æ€§è¶Šé«˜&lt;/p&gt;
&lt;h3 id=&#34;åº“å†…è¡¨çš„å¤åˆ¶&#34;&gt;åº“å†…è¡¨çš„å¤åˆ¶&lt;/h3&gt;
&lt;p&gt;å°†ä¸€å¼ è¡¨é‡Œçš„æ•°æ®å¯¼å‡ºåˆ°æ–‡ä»¶ï¼Œå†å†™å›åŸè¡¨ï¼Œä»¥ä¸‹ä¸¤ç§æ–¹å¼éƒ½å¯ä»¥è·¨å¼•æ“&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ä½¿ç”¨mysqldumpï¼Œå°†è¡¨é‡Œçš„æ•°æ®è½¬æˆinsertè¯­å¥&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;mysqldump -h$host -P$port -u$user --add-locks = 0 --no-create-info --single-transaction --set-gtid-purged = OFF db1 t --where =&amp;quot;a&amp;gt;900&amp;quot; --result-file =/client_tmp/t.sql

â€“ single-transactionï¼šï¼Œåœ¨å¯¼å‡ºæ•°æ®çš„æ—¶å€™ä¸éœ€è¦å¯¹è¡¨db1.tåŠ è¡¨é”ï¼Œè€Œæ˜¯ä½¿ç”¨STARTTRANSACTIONWITHCONSISTENTSNAPSHOTçš„æ–¹æ³•ï¼›
â€“ add-locksï¼šè®¾ç½®ä¸º0ï¼Œè¡¨ç¤ºåœ¨è¾“å‡ºçš„æ–‡ä»¶ç»“æœé‡Œï¼Œä¸å¢åŠ &amp;quot;LOCKTABLEStWRITE;&amp;quot;ï¼›
â€“ no-create-infoï¼šä¸éœ€è¦å¯¼å‡ºè¡¨ç»“æ„ï¼›
â€“ set-gtid-purged=offï¼šä¸è¾“å‡ºè·ŸGTIDç›¸å…³çš„ä¿¡æ¯ï¼›
â€“ result-fileï¼šæŒ‡å®šäº†è¾“å‡ºæ–‡ä»¶çš„è·¯å¾„ï¼Œå…¶ä¸­clientè¡¨ç¤ºç”Ÿæˆçš„æ–‡ä»¶æ˜¯åœ¨å®¢æˆ·ç«¯æœºå™¨ä¸Šçš„ã€‚
- skip-extended-insertï¼šå°†æ¯è¡Œæ•°æ®è¾“å‡ºæˆä¸€æ¡SQLè¯­å¥

ä½¿ç”¨mysql -h$host -P$port -u$user $db -e &amp;quot;source /client_tmp/ t.sql&amp;quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¯¼æˆCSVæ–‡ä»¶ï¼Œåœ¨selectè¯­å¥åé¢åŠ ä¸Š&lt;code&gt;into outfile `filepath` &lt;/code&gt;ï¼Œä½¿ç”¨&lt;code&gt;load data infile `filepath/filename` into table $db.$table&lt;/code&gt;ï¼Œè¯¥è¯­å¥ä¹Ÿä¼šè¢«ä¼ åˆ°å¤‡åº“ï¼Œå¦‚æœå¤‡åº“æ²¡æœ‰è¯¥æ–‡ä»¶å°±ä¼šæŠ¥é”™ï¼Œå› æ­¤åœ¨æ‰§è¡Œå®Œè¯¥è¯­å¥åï¼Œè¿˜è¦å†æ‰§è¡Œ&lt;code&gt;load data local infile `filepath/filename` into table $db.$table&lt;/code&gt;ï¼Œå¦å¤–ï¼Œè¯¥è¯­å¥ä¸ä¼šå¯¼å‡ºè¡¨ç»“æ„ï¼Œè¡¨ç»“æ„éœ€è¦å¦å¤–å¯¼å‡º&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;è¯»å†™åˆ†ç¦»&#34;&gt;è¯»å†™åˆ†ç¦»&lt;/h3&gt;
&lt;p&gt;ä¸»æ•°æ®åº“è´Ÿè´£å†™ï¼Œä»æ•°æ®åº“è´Ÿè´£è¯»ï¼Œä»è€Œç¼“è§£é”çš„äº‰ç”¨ã€èŠ‚çº¦ç³»ç»Ÿå¼€é”€ï¼Œæé«˜å¹¶å‘é‡&lt;/p&gt;
&lt;p&gt;è¯»å†™åˆ†ç¦»å¸¸ç”¨ä»£ç†æ–¹å¼æ¥å®ç°ï¼Œåº”ç”¨å±‚ä¸éœ€è¦æ„ŸçŸ¥åç«¯çš„MySQLé›†ç¾¤éƒ¨ç½²ç»“æ„ï¼Œç›´æ¥è®¿é—®ä»£ç†å±‚ï¼Œä»£ç†å±‚æ¥æ”¶åº”ç”¨å±‚ä¼ æ¥çš„è¯»å†™è¯·æ±‚ï¼Œç„¶åå†³å®šè½¬å‘åˆ°å“ªä¸ªMySQL&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç”±äºä¸»ä»åº“ä¹‹é—´å¯èƒ½å‘ç”Ÿä¸»å¤‡å»¶è¿Ÿï¼Œå¯¼è‡´åœ¨æŸ¥ä»åº“çš„ç»“æœä¼šæ…¢äºä¸»åº“ï¼Œè§£å†³æ–¹æ³•&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å°†æŸ¥è¯¢è¯·æ±‚åˆ†ç±»ï¼Œå¯¹æŸ¥è¯¢ç»“æœä¸¥æ ¼çš„è¯·æ±‚ç›´æ¥å‘åˆ°ä¸»åº“ä¸Š&lt;/li&gt;
&lt;li&gt;æŸ¥è¯¢å‰å…ˆè¿›è¡Œsleepæ“ä½œï¼ˆæ€§èƒ½ä¸å¥½ï¼‰&lt;/li&gt;
&lt;li&gt;ç­‰ä¸»åº“ä½ç‚¹æ–¹æ¡ˆï¼šåœ¨ä»åº“ä½¿ç”¨å‘½ä»¤ &lt;code&gt;select master_post_wait(file, pos[ , timeout])&lt;/code&gt;ï¼Œå‚æ•°fileå’ŒposæŒ‡ä¸»åº“ä¸Šçš„æ–‡ä»¶åå’Œä½ç½®ï¼Œtimeoutè¡¨ç¤ºç­‰å¾…æ—¶é—´ï¼Œæ­£å¸¸çš„è¿”å›ç»“æœæ˜¯ä¸€ä¸ªæ­£æ•´æ•°Mï¼Œè¡¨ç¤ºä»å‘½ä»¤å¼€å§‹æ‰§è¡Œåˆ°åº”ç”¨å®Œfileå’Œposè¡¨ç¤ºçš„bin logä½ç½®ï¼Œæ‰§è¡Œäº†å¤šå°‘äº‹åŠ¡ï¼Œå³å¦‚æœM &amp;gt;=0 ï¼Œè¡¨ç¤ºä»åº“å·²ä¸ä¸»åº“åŒæ­¥ï¼Œå¯ä»¥æ¥å—æŸ¥è¯¢ï¼Œå¦‚æœç­‰å¾…è¶…è¿‡äº†timeoutæ—¶é—´ï¼Œå°±å»æŸ¥ä¸»åº“&lt;/li&gt;
&lt;li&gt;GTIDæ–¹æ¡ˆï¼šä¸ç­‰ä¸»åº“ä½ç‚¹æ–¹æ¡ˆç±»ä¼¼ï¼Œéƒ½æ˜¯è¦çŸ¥é“å‘½ä»¤æ‰§è¡Œè¿‡ç¨‹ä¸­äº‹åŠ¡æ‰§è¡Œçš„æ•°é‡ï¼Œä½¿ç”¨å‘½ä»¤ &lt;code&gt;select wait_for_executed_gtid_set(gtid_set, 1)&lt;/code&gt;ï¼Œå‚æ•°gtid_setè¡¨ç¤ºä»åº“æ‰§è¡Œçš„äº‹åŠ¡æ˜¯å¦åŒ…å«è¯¥gtid_setï¼ŒåŒ…å«è¿”å›0ï¼Œè¯´æ˜ä¸»ä»å·²åŒæ­¥è¿‡ï¼Œå¯ä»¥æ‰§è¡ŒæŸ¥è¯¢ï¼Œè¶…æ—¶è¿”å›1ï¼Œè¶…æ—¶åˆ™æŸ¥ä¸»åº“ã€‚è¯¥æ–¹æ¡ˆçš„éš¾ç‚¹åœ¨äºgtid_setçš„è·å–ï¼Œéœ€è¦ä¿®æ”¹MySQLä»£ç ï¼Œè®©å…¶åœ¨äº‹åŠ¡æäº¤åè¿”å›gtidå€¼&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;åˆ†åŒºè¡¨&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å»ºç«‹åˆ†åŒºè¡¨è¯­å¥ï¼Œdemoæ˜¯ä»¥èŒƒå›´åšåˆ†åŒºçš„ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨hashåˆ†åŒºã€liståˆ†åŒº&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;8
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;k&#34;&gt;CREATE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;TABLE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;`&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;`&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;	&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;`&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ftime&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;`&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;datetime&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;NOT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;	&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;`&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;`&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;11&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;DEFAULT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;	&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;KEY&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;`&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ftime&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;`&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ENGINE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;InnoDB&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;DEFAULT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;CHARSET&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;latin1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PARTITION&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;BY&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;RANGE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;YEAR&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ftime&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;	&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PARTITION&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_2017&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;VALUES&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;LESS&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;THAN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2017&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ENGINE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;InnoDB&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PARTITION&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_2018&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;VALUES&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;LESS&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;THAN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2018&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ENGINE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;InnoDB&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PARTITION&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_2019&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;VALUES&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;LESS&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;THAN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2019&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ENGINE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;InnoDB&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PARTITION&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p_others&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;VALUES&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;LESS&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;THAN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;MAXVALUE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ENGINE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;InnoDB&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åˆ†åŒºè¡¨ä¼šæŒ‰åˆ†åŒºå­˜å‚¨åœ¨å¯¹åº”çš„æ–‡ä»¶é‡Œï¼Œç¬¬ä¸€æ¬¡è®¿é—®è¿™å¼ è¡¨æ—¶ï¼ŒMySQLä¼šå¯¹æ‰€æœ‰åˆ†åŒºè¡¨çš„æ–‡ä»¶è¿›è¡Œæ‰“å¼€æ“ä½œï¼Œä½†æ˜¯æ‰“å¼€æ–‡ä»¶çš„ä¸ªæ•°æ˜¯æœ‰é™åˆ¶çš„ï¼Œå¦‚æœåˆ†åŒºè¡¨å¤ªå¤šï¼Œä¼šå¯¼è‡´SQLè¯­å¥æ— æ³•æ‰§è¡Œ&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åˆ†åŒºè¡¨å¯¹äºserverå±‚æ¥è¯´æ˜¯ä¸€å¼ è¡¨ï¼ŒDDLæ“ä½œæ—¶ä¼šå¯¹æ‰€æœ‰åˆ†åŒºè¡¨ä¸Šé”ï¼Œå¯¼è‡´åé¢è½åˆ°å…·ä½“åˆ†åŒºè¡¨çš„è¯­å¥é˜»å¡&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åˆ†åŒºè¡¨å¯¹äºå¼•æ“å±‚æ¥è®²æ˜¯å¤šå¼ è¡¨ï¼Œå› æ­¤åœ¨è¿›è¡Œä¸€äº›DMLè¯­å¥æ—¶ï¼Œåªä¼šåœ¨å¯¹åº”åˆ†åŒºè¡¨åŠ é—´éš™é”ï¼Œä¸ä¼šå½±å“å…¶ä»–åˆ†åŒºè¡¨&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;alter table $tableName drop partition xxx&lt;/code&gt;ç”¨äºåˆ é™¤åˆ†åŒºè¡¨ï¼Œä¸drop æ•´å¼ æ™®é€šè¡¨ç±»ä¼¼ï¼Œä½†æ˜¯é€Ÿåº¦å¿«ï¼Œå› ä¸ºåªåˆ é™¤äº†éƒ¨åˆ†æ•°æ®&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åœ¨è·¨åˆ†åŒºæŸ¥è¯¢æ•°æ®æ—¶ï¼Œä¼šæ¯”æ™®é€šè¡¨æ…¢&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.cnblogs.com/a8457013/p/7819018.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;MySQLä¸»ä»å¤åˆ¶&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;mysqlå¥åº·çŠ¶æ€æ£€æµ‹&#34;&gt;MySQLå¥åº·çŠ¶æ€æ£€æµ‹&lt;/h2&gt;
&lt;p&gt;å½“MySQLçš„æŸ¥è¯¢å¹¶å‘æ•°æ»¡äº†ä¹‹åï¼Œä¼šå¯¼è‡´ä¸å¯ç”¨ï¼Œåé¢çš„æ“ä½œéƒ½ä¼šè¢«é˜»å¡&lt;/p&gt;
&lt;h3 id=&#34;æ£€æµ‹æ–¹æ³•&#34;&gt;æ£€æµ‹æ–¹æ³•&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;æŸ¥è¯¢æ£€æµ‹ï¼šåœ¨ç³»ç»Ÿåº“é‡Œå»ºä¸€å¼ è¡¨ï¼Œæ¯”å¦‚å«health_checkï¼Œé‡Œé¢åªæ”¾ä¸€ä¸ªæ•°æ®ï¼Œç„¶åå®šæœŸæ‰§è¡Œ&lt;code&gt; select * from mysql.health_check;&lt;/code&gt; åˆ¤æ–­æ‰§è¡Œçš„SQLè¯­å¥æ˜¯å¦ä¸å¯ç”¨ï¼Œå½“è¯­å¥è¶…æ—¶åˆ™è¡¨ç¤ºä¸å¯ç”¨&lt;/li&gt;
&lt;li&gt;æ›´æ–°åˆ¤æ–­ï¼šç”±äºå½“ç£ç›˜æ»¡äº†ä¹‹åï¼ŒMySQLä»ç„¶å¯è¯»ï¼Œä½†æ˜¯bin logå´å†™ä¸è¿›å»ï¼Œå¯¼è‡´æ›´æ–°è¯­å¥å’Œäº‹åŠ¡ commitä¼šè¢«é˜»å¡ï¼Œåœ¨ä¸Šé¢è¡¨çš„åŸºç¡€ä¸Šï¼Œå¢åŠ ä¸€ä¸ªtimestampå­—æ®µï¼Œæ¯å°MySQLçš„serverIdä½œä¸ºä¸»é”®æ’å…¥è¡¨ä¸­ï¼ŒMySQLæ¯æ¬¡æ‰§è¡ŒæŠŠå½“å‰æ—¶é—´æ›´æ–°åˆ°å¯¹åº”çš„è¡Œä¸Šï¼Œ&lt;code&gt;update mysql.health_check where server_id=xx set t_modified = now(); &lt;/code&gt;ä¸»å¤‡éƒ½éœ€è¦å¼€å¯æ£€æµ‹ã€‚å½“è¯­å¥æ‰§è¡Œè¶…æ—¶æ—¶è¡¨ç¤ºä¸å¯ç”¨&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç”±äºæ¯ä¸ªæ‰§è¡Œè¯·æ±‚éƒ½æœ‰å¯èƒ½è·å¾—IOèµ„æºï¼Œæ‰€ä»¥æœ‰æ—¶æ£€æµ‹è¯·æ±‚æ‰§è¡ŒæˆåŠŸäº†ï¼Œä½†æ˜¯æ­¤æ—¶ç³»ç»Ÿèµ„æºå³å°†è¢«è€—å°½äº†ï¼Œå·²ç»å¯ä»¥è¿›è¡Œä¸»å¤‡åˆ‡æ¢äº†ï¼Œä½†æ˜¯ä»ç„¶è¦åœ¨ä¸‹æ¬¡æ£€æµ‹æ‰èƒ½çŸ¥é“ï¼Œå› æ­¤éœ€è¦åˆ¤æ–­å¤šæ¯æ¬¡IOè¯·æ±‚çš„æ—¶é—´ï¼Œé€šå¸¸æ˜¯æ£€æµ‹(select)performance_schemaè¡¨çš„ä¿¡æ¯&lt;/p&gt;
&lt;h2 id=&#34;é«˜å¯ç”¨æ–¹æ¡ˆmha&#34;&gt;é«˜å¯ç”¨æ–¹æ¡ˆMHA&lt;/h2&gt;
&lt;p&gt;MHAæ˜¯ä¸€å¥—ä¿è¯MySQLå®ç°æ•…éšœåˆ‡æ¢å’Œä¸»ä»æå‡çš„é«˜å¯ç”¨è§£å†³æ–¹æ¡ˆï¼Œæ•…éšœåˆ‡æ¢æ—¶èƒ½åœ¨30så†…è‡ªåŠ¨å®Œæˆï¼Œæœ€å¤§ç¨‹åº¦çš„ä¿è¯æ•°æ®ä¸€è‡´ï¼Œæ”¯æŒè·¨å­˜å‚¨å¼•æ“ï¼Œå¯¹åŸæœ‰MySQLåº“æ— æ€§èƒ½å½±å“ï¼Œæ•´ä¸ªæ•…éšœè½¬ç§»è¿‡ç¨‹å¯¹åº”ç”¨ç¨‹åºå®Œå…¨é€æ˜ã€‚&lt;/p&gt;
&lt;p&gt;MHAé‡Œæœ‰ä¸¤ä¸ªè§’è‰²ä¸€ä¸ªæ˜¯MHA Nodeï¼ˆæ•°æ®èŠ‚ç‚¹ï¼‰å¦ä¸€ä¸ªæ˜¯MHA Managerï¼ˆç®¡ç†èŠ‚ç‚¹ï¼‰ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;MHA Managerå¯ä»¥å•ç‹¬éƒ¨ç½²åœ¨ä¸€å°ç‹¬ç«‹çš„æœºå™¨ä¸Šç®¡ç†å¤šä¸ªmaster-slaveé›†ç¾¤ï¼Œä¹Ÿå¯ä»¥éƒ¨ç½²åœ¨ä¸€å°slaveèŠ‚ç‚¹ä¸Šã€‚&lt;/li&gt;
&lt;li&gt;MHA Nodeè¿è¡Œåœ¨æ¯å°MySQLæœåŠ¡å™¨ä¸Šï¼ŒMHA Managerä¼šå®šæ—¶æ¢æµ‹é›†ç¾¤ä¸­çš„masterèŠ‚ç‚¹ï¼Œå½“masterå‡ºç°æ•…éšœæ—¶ï¼Œå®ƒå¯ä»¥è‡ªåŠ¨å°†æœ€æ–°æ•°æ®çš„slaveæå‡ä¸ºæ–°çš„masterï¼Œç„¶åå°†æ‰€æœ‰å…¶ä»–çš„slaveé‡æ–°æŒ‡å‘æ–°çš„masterã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/MySQL_MHA_%e6%9e%b6%e6%9e%84.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/MySQL_MHA_%e6%9e%b6%e6%9e%84.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			alt=&#34;MHAæ¶æ„&#34;&gt;
	&lt;/a&gt;
	
	&lt;figcaption&gt;MHAæ¶æ„&lt;/figcaption&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;MHAæ–¹æ¡ˆé‡‡ç”¨åŠåŒæ­¥å¤åˆ¶çš„æ–¹å¼ï¼Œæ‰€ä»¥MySQLçš„ç‰ˆæœ¬è¦æ±‚è‡³å°‘æ˜¯5.5ï¼ŒåŠåŒæ­¥å¤åˆ¶æœºåˆ¶ä¿è¯masterå‡ºé—®é¢˜çš„æ—¶å€™ï¼Œè‡³å°‘æœ‰ä¸€å°slaveçš„æ•°æ®æ˜¯å®Œæ•´çš„ï¼Œä½†åœ¨è¶…æ—¶çš„æƒ…å†µä¸‹ä¹Ÿä¼šä¸´æ—¶åˆ‡æ¢å¼‚æ­¥å¤åˆ¶ï¼Œä¿éšœä¸šåŠ¡çš„æ­£å¸¸ä½¿ç”¨ï¼Œç›´åˆ°ä¸€å°slaveè¿½ä¸ŠåŒæ­¥è¿›åº¦ï¼Œå†ç»§ç»­åˆ‡æ¢æˆåŠåŒæ­¥å¤åˆ¶æ¨¡å¼ã€‚&lt;/p&gt;
&lt;p&gt;MHAè¿˜å¯ä»¥ä¿®å¤å¤šä¸ªslaveä¹‹é—´çš„æ—¥å¿—å·®å¼‚ï¼Œä½¿å¾—æ‰€æœ‰salveçš„æ•°æ®ä¿è¯æ•°æ®æœ€ç»ˆä¸€è‡´æ€§ï¼Œä¿è¯è‡³å°‘å¯ä»¥ä»ä¸­é€‰å‡ºä¸€ä¸ªmasterã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ•…éšœè½¬ç§»æµç¨‹&#34;&gt;æ•…éšœè½¬ç§»æµç¨‹&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;MHAéªŒè¯å¤åˆ¶è®¾ç½®ä»¥åŠç¡®è®¤å½“å‰masterçŠ¶æ€&lt;/li&gt;
&lt;li&gt;ç›‘æ§masterï¼Œæ£€æµ‹åˆ°masterå®•æœº&lt;/li&gt;
&lt;li&gt;å†æ¬¡éªŒè¯slaveçš„é…ç½®&lt;/li&gt;
&lt;li&gt;å¼€å§‹æ¢å¤ä¸€å°æ–°master&lt;/li&gt;
&lt;li&gt;ä»å®•æœºçš„masterèŠ‚ç‚¹ä¸Šé€šè¿‡SSHä¿å­˜å…¶bin logåˆ°Manager&lt;/li&gt;
&lt;li&gt;æ ¹æ®é…ç½®æ–‡ä»¶æ¥é€‰ä¸¾å‡ºæ–°çš„masterï¼Œæˆ–è€…å°†å«æœ‰æ•°æ®åŒæ­¥æœ€æ–°ä½ç‚¹çš„slaveæå‡ä¸ºmaster&lt;/li&gt;
&lt;li&gt;æ ¹æ®è€master bin logç”Ÿæˆå·®å¼‚æ—¥å¿—ï¼Œåº”ç”¨åˆ°æ–°masterä¸Š&lt;/li&gt;
&lt;li&gt;å°†å…¶ä»–çš„slaveè¿æ¥åˆ°æ–°çš„masterè¿›è¡Œå¤åˆ¶&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;å¿«é€Ÿåˆ‡æ¢masteræµç¨‹&#34;&gt;å¿«é€Ÿåˆ‡æ¢masteræµç¨‹&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;MHAéªŒè¯å¤åˆ¶è®¾ç½®ä»¥åŠç¡®è®¤å½“å‰masterçŠ¶æ€&lt;/li&gt;
&lt;li&gt;ç¡®è®¤æ–°çš„master&lt;/li&gt;
&lt;li&gt;åœæ­¢å½“å‰masterçš„å†™æ“ä½œ&lt;/li&gt;
&lt;li&gt;ç­‰å¾…å…¶ä»–slaveè¿½ä¸Šå½“å‰masterï¼Œç›´åˆ°æ•°æ®å¤åˆ¶è¿›åº¦æ— å»¶è¿Ÿ&lt;/li&gt;
&lt;li&gt;ç¡®ä¿æ–°masterå¯å†™&lt;/li&gt;
&lt;li&gt;è®©å…¶ä»–slaveæŒ‡å‘æ–°master&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;å…¶ä»–&#34;&gt;å…¶ä»–&lt;/h1&gt;
&lt;h2 id=&#34;è‡ªå¢ä¸»é”®&#34;&gt;è‡ªå¢ä¸»é”®&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;è‡ªå¢idä¸ä¸€å®šæ˜¯è¿ç»­çš„ï¼Œå¯èƒ½ä¼šäº§ç”Ÿç©ºæ´ï¼›æ¯”å¦‚ æ’å…¥æ“ä½œå‡ºç°å”¯ä¸€é”®å†²çªï¼Œè‡ªå¢å€¼ä¹Ÿä¼š+1ï¼›äº‹åŠ¡å›æ»šæ—¶ï¼Œè‡ªå¢å€¼ä¸ä¼šå›æ»šï¼›&lt;/li&gt;
&lt;li&gt;MyISAMè‡ªå¢idçš„ä¸‹ä¸€ä¸ªå€¼æ˜¯å­˜åœ¨è¡¨ç»“æ„é‡Œçš„ï¼ŒInnoDBæ˜¯æ”¾å†…å­˜çš„ï¼Œåœ¨MySQL 8.0ä»¥å‰ï¼Œè‡ªå¢å€¼å¹¶ä¸ä¼šæŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œæ¯æ¬¡é‡å¯åï¼Œè‡ªå¢å€¼ä¼šè¢«æ¸…ç©ºï¼Œåœ¨ç¬¬ä¸€æ¬¡è¯»è¡¨çš„æ—¶å€™ä¼šæŠŠæœ€å¤§idç»™è¯»å‡ºæ¥+1ï¼Œè¾¾åˆ°æ¢å¤åŸæ¥çš„è‡ªå¢å€¼ï¼›8.0åæ˜¯è®°å½•åœ¨redo logé‡Œï¼Œé‡å¯åé€šè¿‡æŒä¹…åŒ–çš„å€¼æ¥æ¢å¤ï¼›&lt;/li&gt;
&lt;li&gt;è‡ªå¢çš„ä¸¤ä¸ªé‡è¦å‚æ•°&lt;code&gt;auto_increment_offset&lt;/code&gt;å’Œ&lt;code&gt;auto_increment_increment&lt;/code&gt;éƒ½æ˜¯ç³»ç»Ÿå‚æ•°ï¼Œé»˜è®¤å€¼ä¸º1ï¼›&lt;/li&gt;
&lt;li&gt;ç†è®ºä¸Šè‡ªå¢idæ˜¯æ— é™çš„ï¼Œä½†æ˜¯å› ä¸ºå­—æ®µçš„ç±»å‹å·²ç»é™å®šäº†æœ€å¤§çš„ä½æ•°ï¼Œæ¯”å¦‚å¦‚æœidä½¿ç”¨unsigned intæ˜¯4ä¸ªå­—èŠ‚ï¼Œä¸Šé™å°±æ˜¯2^32 -1ï¼Œå½“è¾¾åˆ°ä¸Šé™åï¼Œè‡ªå¢å€¼ä¸å˜ï¼Œå°±ä¼šå¯¼è‡´æŠ¥é‡å¤ä¸»é”®çš„é”™ï¼Œæ‰€ä»¥å¦‚æœè¡¨çš„ä¸Šé™éœ€è¦æ¯”è¾ƒå¤§ï¼Œéœ€è¦è®¾ç½®æˆunsigned bigintï¼›&lt;/li&gt;
&lt;li&gt;å¦‚æœæ²¡æœ‰æ˜ç¡®è®¾ç½®ä¸»é”®ï¼ŒinnoDBä¼šé»˜è®¤ç»™ä¸€ä¸ªrow_idï¼Œè™½ç„¶å®é™…ä¸Šæ˜¯ä¸€ä¸ªunsigned bigintï¼Œä½†æ˜¯åªç”¨åˆ°äº†6ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥é•¿åº¦æ˜¯0 ~ 2^48-1ï¼Œå­å¢å€¼è¾¾åˆ°ä¸Šé™åçš„ä¸‹ä¸€ä¸ªå€¼æ˜¯0ï¼Œæ­¤æ—¶å†insertä¼šè¦†ç›–åŸæœ‰çš„è¡Œï¼›&lt;/li&gt;
&lt;li&gt;å½“äº§ç”Ÿå”¯ä¸€é”®å†²çªæ—¶ï¼Œé™¤äº†ä¼šæŠ¥é”™ï¼Œè¿˜ä¼šåŠ é”ï¼ˆä¸»é”®+è¡Œé”ï¼Œæ™®é€šç´¢å¼•+é—´éš™é”ï¼‰ï¼Œç„¶ååœ¨å›æ»šæ—¶æ‰é‡Šæ”¾ï¼Œå½“å‡ºç°å”¯ä¸€é”®å†²çªæ—¶ï¼Œå¦‚æœæœ‰å¤šä¸ªäº‹åŠ¡åŒæ—¶æ’å…¥ï¼Œå®¹æ˜“é€ æˆæ­»é”ï¼ˆåŒæ–¹éƒ½åœ¨ç­‰å¾…å¯¹æ–¹çš„é—´éš™é”é‡Šæ”¾å¯¼è‡´ï¼‰ï¼›&lt;/li&gt;
&lt;li&gt;&lt;code&gt;insert into ... on duplicate key update ... &lt;/code&gt;ï¼Œè¡¨ç¤ºæ’å…¥ä¸€è¡Œæ•°æ®ï¼Œå¦‚æœå‡ºç°å”¯ä¸€é”®å†²çªï¼Œå°±æ‰§è¡Œåé¢çš„updateè¯­å¥ï¼Œè¯¥æ›´æ–°è¯­å¥åªä¼šä¿®æ”¹è·Ÿç¬¬ä¸€ä¸ªç´¢å¼•å†²çªçš„è¡Œï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;xid&#34;&gt;Xid&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Xidæ˜¯ serverå±‚ç»´æŠ¤ï¼Œè¡¨ç¤ºä¸€ä¸ªäº‹åŠ¡idï¼Œå­˜åœ¨bin logä¸­ï¼Œå¯ä»¥ä½œä¸ºbin logå’Œredo logä¸­åŒä¸€äº‹åŠ¡çš„å…³è”idï¼Œè®©innoDBäº‹åŠ¡å’Œserverå±‚åšå…³è”ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç”±å…¨å±€å˜é‡global_query_idèµ‹ç»™Query_idï¼ŒQuery_id+1åèµ‹å€¼ç»™Xidï¼Œä½œä¸ºäº‹åŠ¡å¼€å§‹çš„ç¬¬ä¸€æ¡è¯­å¥çš„idã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç”±äºglobal_query_idæ˜¯å†…å­˜å˜é‡ï¼ŒMySQLé‡å¯åä¼šè¢«æ¸…é›¶ï¼Œä½†æ˜¯é‡å¯åä¼šç”Ÿæˆæ–°çš„bin logï¼Œæ‰€ä»¥åŒä¸€bin logä¸ä¼šå‡ºç°ä¸¤ä¸ªç›¸åŒçš„Xid&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;global_query_idè¾¾åˆ°ä¸Šé™2^64 - 1åï¼Œä¼šä»0å¼€å§‹è®¡æ•°ï¼Œæ‰€ä»¥åŒä¸€æ•°æ®åº“é‡Œå¯èƒ½åŒæ—¶å­˜åœ¨ç›¸åŒçš„Xid&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;trx_id&#34;&gt;trx_id&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;trx_idä¸åŒäºXidï¼Œtrx_idæ˜¯ç”±InnoDBç»´æŠ¤ï¼Œç”¨åœ¨äº‹åŠ¡å¯è§æ€§æ–¹é¢çš„ï¼Œæ¯”å¦‚MVCCï¼Œè§†å›¾ä¸€è‡´æ€§&lt;/li&gt;
&lt;li&gt;æ™®é€šåªè¯»è¯­å¥ä¸åˆ†é…trx_idï¼ˆè€Œæ˜¯ä¸´æ—¶ç®—çš„ï¼Œä¼šæ¯”è¾ƒå¤§ï¼Œä¸»è¦æ˜¯ä¸ºäº†åŒºåˆ†è¯»å†™è¯­å¥ï¼‰ï¼Œè¯»å†™è¯­å¥æ‰ä¼šåˆ†é… trx_idï¼Œç”±max_trx_id + 2(è‡³å°‘ï¼Œæ¯”å¦‚updateï¼Œå®é™…ä¸Šè¦å…ˆå½“å‰è¯»åœ¨updateçš„ï¼Œæ‰€ä»¥æ˜¯+2)&lt;/li&gt;
&lt;li&gt;max_trx_idä¼šæŒä¹…åŒ–ï¼Œé‡å¯ä¸ä¼šå˜0ï¼Œä¸Šé™æ˜¯2^48-1ï¼Œç„¶åä»0å¼€å§‹è®¡æ•°&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;thread_id&#34;&gt;thread_id&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;ç³»ç»Ÿä¿å­˜å…¨å±€å˜é‡thread_id_counterï¼Œæ¯æ–°é”®ä¸€ä¸ªè¿æ¥ï¼Œthread_id_counter + 1åèµ‹ç»™thread_idï¼Œä½œä¸ºçº¿ç¨‹id&lt;/li&gt;
&lt;li&gt;ä¸Šé™æ˜¯2^32-1ï¼Œè¾¾åˆ°ä¸Šé™åé‡ç½®ä¸º0&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;jdbc&#34;&gt;JDBC&lt;/h1&gt;
&lt;p&gt;SUNçš„ JDBC æ˜¯ä¸€å¥—æ¥å£ï¼Œè€Œå®ç°æ˜¯å„ä¸ªæ•°æ®åº“å‚å•†çš„é©±åŠ¨åŒ…ï¼Œå› æ­¤ä½¿ç”¨äº†æ¡¥æ¥æ¨¡å¼&lt;/p&gt;
&lt;p&gt;DriverManageræ³¨å†Œé©±åŠ¨åŒ…ï¼Œcom.mysql.jdbc.Driverç±»ä¸­çš„staticå—ä¼šåˆ›å»ºé©±åŠ¨å®ä¾‹ï¼Œå› æ­¤åªéœ€è¦æŠŠé©±åŠ¨å­—èŠ‚ç åŠ è½½åˆ°JVMé‡Œå³å¯ï¼ŒClass.forName(â€œcom.mysql.jdbc.Driverâ€);&lt;/p&gt;
&lt;p&gt;Connection conn = DriverManager.getConnection(url, username, password)è·å–è¿æ¥&lt;/p&gt;
&lt;p&gt;Statement stmt = con.createStatement(); ä¹‹åä½¿ç”¨stmtçš„æ–¹æ³•æ‰§è¡ŒSQLè¯­å¥å³å¯ï¼Œè¿”å›ResultSet&lt;/p&gt;
&lt;p&gt;ResultSetä¸‹æ ‡ä»1å¼€å§‹&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨Connectionç±»çš„setAutoCommit(false) æ–¹æ³•æ¥å®ç°äº‹åŠ¡ï¼Œä»¥è¿™ä¸ªå¼€å§‹ï¼ŒConnectionç±»çš„commit()æ–¹æ³•æäº¤ï¼ŒConnectionç±»çš„rollback()æ–¹æ³•å›æ»š&lt;/p&gt;
&lt;p&gt;æœ€åå…³é—­ResultSetã€Statementå’ŒConnection&lt;/p&gt;
&lt;h1 id=&#34;æ•°æ®åº“è¿æ¥æ± &#34;&gt;æ•°æ®åº“è¿æ¥æ± &lt;/h1&gt;
&lt;p&gt;é“¾è¡¨å®ç°ï¼Œåœ¨ä½¿ç”¨è¿æ¥å¯¹è±¡ä¹‹å‰ï¼Œå…ˆåˆ›å»ºå¥½ä¸€å®šæ•°é‡çš„è¿æ¥å¯¹è±¡ï¼Œä»¥é“¾è¡¨çš„å½¢å¼è¿æ¥ï¼Œä»ç«¯é¦–å–ï¼Œç”¨å®Œå›åˆ°æ®µå°¾ã€‚&lt;/p&gt;
&lt;p&gt;å½“æ± å­ä¸­æ²¡æœ‰è¿æ¥å¯¹è±¡å¯å–æ—¶ï¼Œå°±è®©å…¶å…ˆç­‰å¾…ï¼Œå¦‚æœç­‰å¾…è¶…æ—¶è¿˜æ²¡æœ‰å›è·å–åˆ°è¿æ¥å¯¹è±¡ï¼Œå°±æ–°å»ºä¸€ä¸ªè¿æ¥å¯¹è±¡è®©å…¶ä½¿ç”¨ï¼Œç”¨å®Œåé”€æ¯è¯¥åˆ›å»ºçš„å¯¹è±¡&lt;/p&gt;
&lt;p&gt;è¿æ¥æ± è´Ÿè´£ç®¡ç†ã€ç›‘æ§å’Œç»´æŠ¤è¿™äº›è¿æ¥å¯¹è±¡&lt;/p&gt;
&lt;p&gt;è¿æ¥æ± å•ä¾‹&lt;/p&gt;
&lt;p&gt;è¿æ¥æ± éœ€è¦ä¿è¯çº¿ç¨‹å®‰å…¨&lt;/p&gt;
&lt;h1 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h1&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.cnblogs.com/xuanzhi201111/p/4103696.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;MySQL ACIDåŠå››ç§éš”ç¦»çº§åˆ«çš„è§£é‡Š&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://github.com/CyC2018/CS-Notes/blob/master/docs/notes/MySQL.md&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;CyC2018/CS-Notes/MySQL&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://tech.meituan.com/2014/08/20/innodb-lock.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Innodbä¸­çš„äº‹åŠ¡éš”ç¦»çº§åˆ«å’Œé”çš„å…³ç³»&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;&#34; &gt;æå®¢æ—¶é—´ - MySQLå®æˆ˜45è®²&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.cnblogs.com/hapjin/p/11521506.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;MySQLä¸­çš„ redo æ—¥å¿—æ–‡ä»¶ &lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://blog.csdn.net/javaanddonet/article/details/112596210&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;MySQLçš„æ—¥å¿— - redo log&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.cnblogs.com/lemon-flm/p/15307313.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;MySQLæ—¥å¿—15é—®&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.cnblogs.com/mengxinJ/p/14211427.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;MySQL ä¸­çš„WALæœºåˆ¶&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;åè®°&lt;/p&gt;
&lt;p&gt;æå®¢æ—¶é—´ - MySQLå®æˆ˜45è®²çœŸçš„æ˜¯è´¨é‡å¾ˆé«˜çš„è®²MySQLçš„è¯¾ç¨‹ï¼Œéå¸¸æ¨è&lt;/p&gt;
</description>
        </item>
        <item>
        <title>MongoDB</title>
        <link>http://nixum.cc/p/mongodb/</link>
        <pubDate>Sun, 28 Nov 2021 00:00:00 +0000</pubDate>
        
        <guid>http://nixum.cc/p/mongodb/</guid>
        <description>&lt;p&gt;[TOC]&lt;/p&gt;
&lt;h1 id=&#34;ç‰¹ç‚¹&#34;&gt;ç‰¹ç‚¹&lt;/h1&gt;
&lt;ol&gt;
&lt;li&gt;åˆ†å¸ƒå¼æ•°æ®åº“ï¼ŒJsonæ•°æ®æ¨¡å‹ï¼Œé¢å‘å¯¹è±¡æ•°æ®æ¨¡å‹ï¼Œä¸å¼ºåˆ¶è¡¨çš„scheme&lt;/li&gt;
&lt;li&gt;å½“åº”ç”¨åœºæ™¯ä¸æ¸…æ™°æ—¶ï¼Œå¯ä»¥ç›´æ¥ä»¥å¯¹è±¡æ¨¡å‹ç›´æ¥å­˜å‚¨ï¼Œæ— éœ€å…³å¿ƒå­—æ®µï¼Œè¡¨ç»“æ„çµæ´»ï¼ŒåŠ¨æ€å¢åŠ æ–°å­—æ®µ&lt;/li&gt;
&lt;li&gt;ä¸ç”¨å¤ªè¿‡å…³æ³¨è¡¨é—´çš„å…³ç³»ï¼Œå¯ç›´æ¥åµŒå¥—å­˜å‚¨ï¼Œå°†å¤šç§å…³ç³»å­˜å‚¨åœ¨åŒä¸€å¼ è¡¨ä¸Šï¼ŒåŒæ—¶ä¹ŸåŠ å¿«æŸ¥è¡¨ï¼Œå› ä¸ºå®ƒå¯ä»¥å‡å°‘ç£ç›˜å®šä½æ¬¡æ•°ï¼Œå¦‚æœæ˜¯å…³ç³»å‹æ•°æ®åº“ï¼ŒåŒæ—¶æŸ¥å¤šå¼ è¡¨å°±éœ€è¦å®šä½å¤šæ¬¡&lt;/li&gt;
&lt;li&gt;åŸç”Ÿæ”¯æŒé«˜å¯ç”¨ï¼Œä¸€èˆ¬çš„éƒ¨ç½²æ–¹å¼æ˜¯éƒ¨ç½²ä¸‰ä¸ªèŠ‚ç‚¹replica setï¼Œæœ€å¤š50ä¸ªï¼›å¤šreplica setå¯ä»¥å®ç°è‡ªæ¢å¤ï¼ˆå½“ä¸»èŠ‚ç‚¹æŒ‚ç‚¹åä¼šé€‰å‡ºä»èŠ‚ç‚¹ï¼‰ï¼Œå¼‚åœ°å®¹ç¾ï¼Œæ•°æ®åº“æ»šåŠ¨æ›´æ–°&lt;/li&gt;
&lt;li&gt;åŸç”Ÿæ”¯æŒæ¨ªå‘æ‰©å±•ï¼Œé€šè¿‡æ°´å¹³æ‰©å±•åˆ†ç‰‡å®ç°ï¼Œå¤–éƒ¨å¹¶ä¸æ„ŸçŸ¥æœ‰å¤šå°‘ä¸ªåˆ†ç‰‡ï¼Œåªä¼šå½“æˆä¸€ä¸ªåˆ†ç‰‡ä½¿ç”¨&lt;/li&gt;
&lt;li&gt;æ”¯æŒå­—æ®µçº§åŠ å¯†ï¼Œé’ˆå¯¹éšç§æ•°æ®ï¼Œæ¯”å¦‚èº«ä»½è¯ã€ç”µè¯ç­‰ï¼Œåœ¨å…¥åº“æ—¶å¯ä»¥è¿›è¡ŒåŠ å¯†ï¼ŒæŸ¥è¯¢æ—¶è§£å¯†&lt;/li&gt;
&lt;li&gt;æ”¯æŒåœ°ç†ä½ç½®ç»çº¬åº¦æŸ¥è¯¢&lt;/li&gt;
&lt;li&gt;å¼ºå¤§çš„èšåˆæŸ¥è¯¢ï¼Œé€‚åˆæŠ¥è¡¨ã€æ—¶åºæ•°æ®&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;nosqlè¯­å¥&#34;&gt;NoSQLè¯­å¥&lt;/h1&gt;
&lt;p&gt;å®¢æˆ·ç«¯ä½¿ç”¨é©±åŠ¨æ—¶è¿æ¥çš„æ‰§è¡Œæµç¨‹&lt;/p&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/MongoDB%e5%ae%a2%e6%88%b7%e7%ab%af%e6%89%a7%e8%a1%8c%e6%b5%81%e7%a8%8b.jpg&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/MongoDB%e5%ae%a2%e6%88%b7%e7%ab%af%e6%89%a7%e8%a1%8c%e6%b5%81%e7%a8%8b.jpg&#34;
			
			
			
			loading=&#34;lazy&#34;
			alt=&#34;å®¢æˆ·ç«¯æ‰§è¡Œæµç¨‹&#34;&gt;
	&lt;/a&gt;
	
	&lt;figcaption&gt;å®¢æˆ·ç«¯æ‰§è¡Œæµç¨‹&lt;/figcaption&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;æ•°æ®åº“ç«¯æ‰§è¡Œæµç¨‹&lt;/p&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/MongoDB%e6%95%b0%e6%8d%ae%e5%ba%93%e7%ab%af%e6%89%a7%e8%a1%8c%e6%b5%81%e7%a8%8b.jpg&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/MongoDB%e6%95%b0%e6%8d%ae%e5%ba%93%e7%ab%af%e6%89%a7%e8%a1%8c%e6%b5%81%e7%a8%8b.jpg&#34;
			
			
			
			loading=&#34;lazy&#34;
			alt=&#34;æ•°æ®åº“ç«¯æ‰§è¡Œæµç¨‹&#34;&gt;
	&lt;/a&gt;
	
	&lt;figcaption&gt;æ•°æ®åº“ç«¯æ‰§è¡Œæµç¨‹&lt;/figcaption&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;è¦è·å–ticketæ˜¯å› ä¸ºMongoDBé»˜è®¤å­˜å‚¨å¼•æ“wiredtigerçš„æœºåˆ¶ï¼Œticketä»£è¡¨ç€ç³»ç»Ÿèµ„æºçš„æ•°é‡ï¼Œticketæ•°é‡æœ‰é™ï¼Œè¯»å†™æ“ä½œéƒ½éœ€è¦å…ˆè·å¾—ticketæ‰å¯ä»¥è¿›è¡Œä¸‹ä¸€æ­¥æ“ä½œï¼Œæœºåˆ¶ç±»ä¼¼ä¿¡å·é‡ã€‚&lt;/p&gt;
&lt;h2 id=&#34;è¿æ¥&#34;&gt;è¿æ¥&lt;/h2&gt;
&lt;p&gt;è¿æ¥mongoDBè¯­å¥ï¼Œå½“æœ‰å¤šèŠ‚ç‚¹æˆ–å¤šåˆ†ç‰‡æ—¶ï¼Œè¿æ¥ä¹Ÿè¦å†™ä¸Šï¼Œ&lt;code&gt;mongodb://èŠ‚ç‚¹1çš„host:port, èŠ‚ç‚¹2çš„host:port,.../databaseName?[options: maxPoolSize(javaé»˜è®¤æ˜¯100), maxWaitTime(æŸ¥è¯¢çš„æœ€å¤§ç­‰å¾…äº‹ä»¶), writeConcern, readConcern]&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;mongoDBé©±åŠ¨é‡Œå·²æä¾›è´Ÿè½½å‡è¡¡ï¼Œå¤šèŠ‚ç‚¹æ¢æµ‹&lt;/p&gt;
&lt;h2 id=&#34;èšåˆ&#34;&gt;èšåˆ&lt;/h2&gt;
&lt;p&gt;ä½œç”¨ç›¸å½“ä¸group byï¼Œå¯ä½œç”¨ä¸å¤šä¸ªcollectionï¼Œå¯è¿›è¡ŒæŸ¥è¯¢å’Œè®¡ç®—ã€‚Mongoçš„èšåˆæ“ä½œå‘ç”Ÿåœ¨pipelineä¸­ï¼Œç”±å¤šä¸ªstageç»„æˆï¼Œæœ‰ç‚¹åƒè´£ä»»é“¾ï¼Œé€šè¿‡å¤šä¸ªstateæ¥è¿‡æ»¤ï¼Œèšåˆæ•°æ®ï¼Œæ¯ä¸€ä¸ª{}ä»£è¡¨ä¸€ä¸ªstate&lt;/p&gt;
&lt;p&gt;demo&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;n&#34;&gt;MySQLä¸­çš„&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;department&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;count&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;as&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;emp_QTY&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;User&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;gender&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;female&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;GROUP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;BY&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;department&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;HAVING&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;count&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;10&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ç­‰ä»·äº&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;mongoä¸­çš„&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;db&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;user&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;aggregate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;([&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;match&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;gender&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;female&amp;#39;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;}}&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    	&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;group&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    	     &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;_id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;$DEPARTMENT&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;emp_qty&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;{$&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;sum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    	&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;match&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;emp_qty&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;{$&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;lt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;10&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;}}}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;å‡ ä¸ªæ¯”è¾ƒç‰¹åˆ«çš„è¿ç®—ç¬¦&lt;/p&gt;
&lt;p&gt;&lt;code&gt;$unwind&lt;/code&gt;ï¼šå°†æŸ¥è¯¢åˆ°çš„æ•°ç»„å±•å¼€&lt;/p&gt;
&lt;p&gt;&lt;code&gt;$grouphLookup&lt;/code&gt;ï¼šå›¾æœç´¢&lt;/p&gt;
&lt;p&gt;&lt;code&gt;$facet/$bucket&lt;/code&gt;ï¼šåˆ†é¢æœç´¢ï¼Œæ ¹æ®ä¸åŒèŒƒå›´æ¡ä»¶ï¼Œå¤šä¸ªç»´åº¦ä¸€æ¬¡æ€§è¿›è¡Œåˆ†ç»„è¾“å‡º&lt;/p&gt;
&lt;h1 id=&#34;æ–‡æ¡£æ¨¡å‹è®¾è®¡åŸåˆ™&#34;&gt;æ–‡æ¡£æ¨¡å‹è®¾è®¡åŸåˆ™&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ä¼ ç»Ÿå…³ç³»å‹æ•°æ®åº“è®¾è®¡ï¼Œä»æ¦‚å¿µæ¨¡å‹ -ã€‹é€»è¾‘æ¨¡å‹ -ã€‹ç‰©ç†æ¨¡å‹ï¼Œå…³ç³»æ˜ç¡®ï¼Œéµå¾ªä¸‰èŒƒå¼ï¼ˆ1.è¦æœ‰ä¸»é”®ï¼Œåˆ—ä¸å¯åˆ†ï¼Œ2.æ¯åˆ—ä¸ä¸»é”®ç›¸å…³ï¼Œ3.ä¸èƒ½å­˜åœ¨ä¼ é€’ä¾èµ–(ä¸å…è®¸å­—æ®µå†—ä½™)ï¼‰ï¼Œè¡¨ç°å½¢å¼ä¸Šï¼Œä¸€å¯¹å¤šå…³ç³»ï¼Œå¤–é”®åœ¨å¤šé‚£å¼ è¡¨ä¸Šï¼Œå¤šå¯¹å¤šå…³ç³»ï¼Œä¼šæœ‰ç¬¬ä¸‰å¼ è¡¨æ¥åšå…³è”&lt;/p&gt;
&lt;p&gt;å¯¹äºæ–‡æ¡£æ¨¡å‹ï¼Œä¸€èˆ¬å¯¹åº”å…³ç³»å‹æ•°æ®åº“è®¾è®¡çš„é€»è¾‘æ¨¡å‹é˜¶æ®µï¼Œé€šè¿‡åµŒå¥—å®ä½“æ•°ç»„ï¼Œmapæˆ–è€…å¼•ç”¨å­—æ®µæ¥å¤„ç†å®ä½“é—´çš„å…³ç³»ï¼Œå­—æ®µå†—ä½™é™åˆ¶å®½æ¾&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å®ä½“é—´çš„å…³ç³»ï¼Œä¸€å¯¹ä¸€ä½¿ç”¨åµŒå¥—mapæ¥è¡¨ç¤ºï¼›ä¸€å¯¹å¤šä½¿ç”¨åµŒå¥—æ•°ç»„è¡¨ç¤ºï¼›å¤šå¯¹å¤šä½¿ç”¨åµŒå¥—æ•°ç»„+å†—ä½™å­—æ®µæ¥è¡¨ç¤ºï¼›æ­¤å¤–ï¼Œä¹Ÿå¯ä»¥é€šè¿‡åµŒå¥—æ•°ç»„å­˜id + å¦ä¸€å¼ è¡¨æ¥è¡¨ç¤ºå®ä½“é—´çš„å…³ç³»ï¼Œé€šè¿‡idæ¥è¿›è¡Œè”è¡¨ï¼ˆä½¿ç”¨&lt;code&gt;aggregate + $lookup&lt;/code&gt;ï¼‰&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ³¨æ„&lt;/strong&gt;ï¼šåµŒå¥—æ—¶è¦æ³¨æ„æ•´ä¸ªæ–‡æ¡£å¤§å°ï¼Œé™åˆ¶æ˜¯16Mï¼Œè¯»å†™æ¯”ä¾‹ï¼Œä¹Ÿè¦æ³¨æ„æ•°ç»„é•¿åº¦å¤§å°ï¼Œä¸€èˆ¬ä¼šä½¿ç”¨idå¼•ç”¨æ¨¡å¼æ¥è§£å†³ï¼›&lt;strong&gt;$lookupåªæ”¯æŒleft outer join&lt;/strong&gt;ï¼Œä¸æ”¯æŒåˆ†ç‰‡è¡¨&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ¨¡å¼å¥—ç”¨ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœºæ™¯ï¼šæ—¶åºæ•°æ®ï¼Œè§£å†³ï¼šå¯¹äºåŒä¸€ä¸ªå®ä½“ï¼Œå°†å…¶å˜åŒ–å­—æ®µçš„å­˜å‚¨å’Œæ›´æ–°ï¼Œèšåˆåœ¨å†…åµŒæ•°ç»„ä¸­&lt;/li&gt;
&lt;li&gt;åœºæ™¯ï¼šå¤§æ–‡æ¡£ã€å¤šç›¸ä¼¼å­—æ®µã€å¤šç›¸ä¼¼ç´¢å¼•ï¼Œæ¯”å¦‚skuçš„å¤šå±æ€§ï¼Œè§£å†³ï¼šå°†å¤šä¸ªç›¸ä¼¼å­—æ®µè½¬æˆå†…åµŒæ•°ç»„ï¼Œç´¢å¼•å»ºç«‹åœ¨å†…åµŒæ•°ç»„çš„å®ä½“å­—æ®µä¸­ï¼Œ&lt;/li&gt;
&lt;li&gt;åœºæ™¯ï¼šç”±äºschemelessçš„ç‰¹æ€§ï¼Œä¸åŒç‰ˆæœ¬å­˜åœ¨ä¸ä¸€æ ·çš„å­—æ®µï¼Œéœ€è¦å¯¹å­—æ®µåšæ ¡éªŒï¼Œè§£å†³ï¼šå¢åŠ ä¸€ä¸ªç‰ˆæœ¬å­—æ®µï¼Œé€šè¿‡è¯¥å­—æ®µè¿›è¡Œåˆ¤æ–­&lt;/li&gt;
&lt;li&gt;åœºæ™¯ï¼šè®¡æ•°ç»Ÿè®¡ï¼Œæ¯ç§’è¦è¿›è¡Œè®¡æ•°æ›´æ–°ï¼Œä¸éœ€è¦å‡†ç¡®çš„è®¡æ•°ï¼Œè§£å†³åˆ©ç”¨mongoçš„éšæœºè®¡æ•°å™¨$incï¼Œ&lt;/li&gt;
&lt;li&gt;åœºæ™¯ï¼šç²¾ç¡®ç»Ÿè®¡ï¼Œæ’è¡Œç‰ˆï¼Œè§£å†³ï¼šä½¿ç”¨é¢„èšåˆå­—æ®µï¼Œæ¯”å¦‚å¢åŠ æ’åå­—æ®µï¼Œæ¯æ¬¡æ›´æ–°ä¾èµ–å­—æ®µçš„åŒæ—¶ï¼Œæ›´æ–°æ’åå­—æ®µï¼Œè¿›è¡Œæ’è¡ŒæŸ¥è¯¢æ—¶ï¼Œç›´æ¥æ ¹æ®æ’è¡Œå­—æ®µè¿›è¡Œæ’åºå³å¯ï¼Œä¸ç”¨é‡æ–°èšåˆ&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å‚è€ƒï¼š&lt;a class=&#34;link&#34; href=&#34;https://www.pdai.tech/md/db/nosql-mongo/mongo-y-doc.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Mongoè¿›é˜¶ - ç³»ç»Ÿè®¾è®¡ï¼šæ¨¡å¼æ„å»º&lt;/a&gt;ï¼Œè¿™ä¸ªæ›´å…¨ï¼Œä¹ŸæŒºå®ç”¨çš„&lt;/p&gt;
&lt;h1 id=&#34;è°ƒä¼˜&#34;&gt;è°ƒä¼˜&lt;/h1&gt;
&lt;h2 id=&#34;ä¼˜åŒ–&#34;&gt;ä¼˜åŒ–&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;æŸ¥è¯¢æ—¶ï¼Œå°½é‡ä½¿ç”¨ç´¢å¼•ï¼Œä¸ºç»å¸¸åšæŸ¥è¯¢çš„æ¡ä»¶æ·»åŠ ç´¢å¼•&lt;/li&gt;
&lt;li&gt;æŸ¥è¯¢æ—¶ï¼ŒåªæŸ¥è¯¢éœ€è¦çš„å­—æ®µï¼Œè€Œä¸æ˜¯æŸ¥è¯¢å…¨éƒ¨ï¼Œå‡å°‘ç½‘ç»œèµ„æºçš„æµªè´¹&lt;/li&gt;
&lt;li&gt;æ›´æ–°æ—¶ï¼Œåªæ›´æ–°å¿…è¦çš„å­—æ®µï¼Œè€Œä¸æ˜¯æ¯æ¬¡æ›´æ–°éƒ½æŠŠæ•´ä¸ªjsonæ–‡æ¡£å‘é€è¿‡å»ï¼Œå‡å°‘ç½‘ç»œèµ„æºçš„æµªè´¹&lt;/li&gt;
&lt;li&gt;æ’å…¥æ—¶ï¼Œå°½å¯èƒ½ç›´æ¥æ‰¹é‡æ’å…¥ï¼Œè€Œä¸æ˜¯ä¸€æ¡ä¸€æ¡æ’&lt;/li&gt;
&lt;li&gt;é€šè¿‡mongodbæä¾›çš„TTLç´¢å¼•ï¼Œå¯ä»¥å®ç°è¿‡æœŸè‡ªåˆ æ•°æ®&lt;/li&gt;
&lt;li&gt;å»ºè¡¨æ—¶ï¼Œæ–‡æ¡£åµŒå¥—ä¸è¶…è¿‡3å±‚&lt;/li&gt;
&lt;li&gt;å°½é‡å°‘ç”¨count()æ¥è®¡ç®—æ€»é¡µæ•°ï¼Œè€Œæ˜¯ä½¿ç”¨limit&lt;/li&gt;
&lt;li&gt;å°½é‡å°‘ç”¨skip/limitå½¢å¼åˆ†é¡µï¼Œè€Œæ˜¯é€šè¿‡idæ¥å®šä½èµ·å§‹çš„ä½ç½®ï¼Œè¿™ç‚¹è·Ÿaws dynamoDBå¾ˆåƒï¼Œä¸è¿‡è‡³å°‘æœ‰æä¾›è¿™ç§åŠŸèƒ½&lt;/li&gt;
&lt;li&gt;å°½é‡å°‘ç”¨äº‹åŠ¡ï¼Œè·¨åˆ†ç‰‡äº‹åŠ¡ï¼Œé¿å…è¿‡å¤§äº‹åŠ¡ï¼Œæ§åˆ¶æ›´æ–°çš„æ–‡æ¡£(è¡Œ)æ•°é‡&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨aggregateæ—¶ï¼Œå‰ä¸€ä¸ªstageè®¡ç®—å¾—åˆ°çš„æ•°æ®ä¼šä¼ é€’åˆ°ä¸‹ä¸ªstageï¼Œå¦‚æœå‰ä¸€ä¸ªstageæ²¡æœ‰è¯¥æ•°æ®ï¼Œåˆ™ä¸‹ä¸€ä¸ªstageæ— æ³•è·å–åˆ°ï¼ˆå°½ç®¡è¡¨ä¸­æœ‰è¯¥å­—æ®µï¼‰&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨aggregateæ—¶ï¼Œpipelineæœ€å¼€å§‹æ—¶çš„match sortå¯ä»¥ä½¿ç”¨åˆ°ç´¢å¼•ï¼Œä¸€æ—¦å‘ç”Ÿè¿‡projectæŠ•å°„ï¼Œgroupåˆ†ç»„ï¼Œlookupè¡¨å…³è”ï¼Œunwindæ‰“æ•£ç­‰æ“ä½œåï¼Œåˆ™æ— æ³•ä½¿ç”¨ç´¢å¼•ã€‚&lt;/li&gt;
&lt;li&gt;åˆ›å»ºç»„åˆç´¢å¼•æ—¶ï¼Œä¸€èˆ¬ä»¥èƒ½å¤Ÿ  ç²¾ç¡®åŒ¹é… -ã€‹æ’åº -ã€‹èŒƒå›´åŒ¹é…  çš„å­—æ®µé¡ºåºè¿›è¡Œåˆ›å»º&lt;/li&gt;
&lt;li&gt;å¯ä»¥åˆ›å»ºéƒ¨åˆ†ç´¢å¼•ï¼Œæ¯”å¦‚å¯¹id&amp;gt;50çš„æ–‡æ¡£æ‰ä¼šå¯¹idåˆ›å»ºç´¢å¼•ï¼›å¯¹æœ‰å€¼çš„å­—æ®µæ‰å»ºç´¢å¼•ï¼Œéœ€è¦åœ¨åˆ›å»ºç´¢å¼•æ—¶ä½¿ç”¨partialFilterExpressionè¡¨è¾¾å¼&lt;/li&gt;
&lt;li&gt;åˆ›å»ºç´¢å¼•æ—¶ä½¿ç”¨åå°åˆ›å»ºç´¢å¼•ï¼Œ&lt;code&gt;{background: true}&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;åˆ†æ&#34;&gt;åˆ†æ&lt;/h2&gt;
&lt;h3 id=&#34;æŸ¥çœ‹å½“å‰æ‰§è¡Œè¯­å¥&#34;&gt;æŸ¥çœ‹å½“å‰æ‰§è¡Œè¯­å¥&lt;/h3&gt;
&lt;p&gt;mongoçš„ &lt;code&gt;db.currentOp()&lt;/code&gt; ç­‰ä»·äº MySQLçš„ &lt;code&gt;show full processlist&lt;/code&gt; å¯æŸ¥è¯¢å½“å‰æ­£åœ¨æ‰§è¡Œçš„SQLè¯­å¥ï¼Œå¯ä»¥é€šè¿‡&lt;code&gt;db.killOp([çº¿ç¨‹id])&lt;/code&gt;æ€æ‰å¼‚å¸¸çº¿ç¨‹ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
Â Â Â Â Â Â Â Â &lt;span class=&#34;nt&#34;&gt;&amp;#34;opid&amp;#34;&lt;/span&gt;Â &lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;Â &lt;span class=&#34;mi&#34;&gt;789193&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;Â Â    &lt;span class=&#34;err&#34;&gt;#&lt;/span&gt;Â Â &lt;span class=&#34;err&#34;&gt;æ­¤æ“ä½œid&lt;/span&gt;
Â Â Â Â Â Â Â Â &lt;span class=&#34;nt&#34;&gt;&amp;#34;active&amp;#34;&lt;/span&gt;Â &lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;Â &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;Â Â Â   &lt;span class=&#34;err&#34;&gt;#&lt;/span&gt;Â &lt;span class=&#34;err&#34;&gt;çŠ¶æ€(running/sleep)&lt;/span&gt;
Â Â Â Â Â Â Â Â &lt;span class=&#34;nt&#34;&gt;&amp;#34;secs_running&amp;#34;&lt;/span&gt;Â &lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;Â &lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;Â Â &lt;span class=&#34;err&#34;&gt;#æ“ä½œè¿è¡Œçš„æ—¶é—´,åœ¨active=falseæ—¶ä¸æ˜¾ç¤º&lt;/span&gt;
Â Â Â Â Â Â Â Â &lt;span class=&#34;nt&#34;&gt;&amp;#34;op&amp;#34;&lt;/span&gt;Â &lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;Â &lt;span class=&#34;s2&#34;&gt;&amp;#34;getmore&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;Â    &lt;span class=&#34;err&#34;&gt;#æ“ä½œè¡Œä¸º(insert/update/remove)&lt;/span&gt;
Â Â Â Â Â Â Â Â &lt;span class=&#34;nt&#34;&gt;&amp;#34;ns&amp;#34;&lt;/span&gt;Â &lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;Â &lt;span class=&#34;s2&#34;&gt;&amp;#34;local.oplog.rs&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;Â Â &lt;span class=&#34;err&#34;&gt;#&lt;/span&gt;Â &lt;span class=&#34;err&#34;&gt;é›†åˆåç§°&lt;/span&gt;
Â Â Â Â Â Â Â Â &lt;span class=&#34;nt&#34;&gt;&amp;#34;query&amp;#34;&lt;/span&gt;Â &lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;Â &lt;span class=&#34;p&#34;&gt;{},&lt;/span&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span class=&#34;err&#34;&gt;#&lt;/span&gt;Â &lt;span class=&#34;err&#34;&gt;å…·ä½“çš„æ“ä½œè¯­å¥&lt;/span&gt;
Â Â Â Â Â Â Â Â &lt;span class=&#34;nt&#34;&gt;&amp;#34;client&amp;#34;&lt;/span&gt;Â &lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;Â &lt;span class=&#34;s2&#34;&gt;&amp;#34;10.0.26.90:55312&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;Â Â &lt;span class=&#34;err&#34;&gt;#è¿æ¥dbçš„å®¢æˆ·ç«¯ip&lt;/span&gt;
Â Â Â Â Â Â Â Â &lt;span class=&#34;nt&#34;&gt;&amp;#34;desc&amp;#34;&lt;/span&gt;Â &lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;Â &lt;span class=&#34;s2&#34;&gt;&amp;#34;conn34681&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;Â Â Â   &lt;span class=&#34;err&#34;&gt;#æ•°æ®åº“è¿æ¥æè¿°&lt;/span&gt;
Â Â Â Â Â Â Â Â &lt;span class=&#34;nt&#34;&gt;&amp;#34;threadId&amp;#34;&lt;/span&gt;Â &lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;Â &lt;span class=&#34;s2&#34;&gt;&amp;#34;0x7f24b8793700&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;Â &lt;span class=&#34;err&#34;&gt;#&lt;/span&gt;Â &lt;span class=&#34;err&#34;&gt;çº¿ç¨‹id&lt;/span&gt;
Â Â Â Â Â Â Â Â &lt;span class=&#34;nt&#34;&gt;&amp;#34;connectionId&amp;#34;&lt;/span&gt;Â &lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;Â &lt;span class=&#34;mi&#34;&gt;34681&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;Â  Â &lt;span class=&#34;err&#34;&gt;#&lt;/span&gt;Â &lt;span class=&#34;err&#34;&gt;æ•°æ®åº“è¿æ¥id&lt;/span&gt;
Â Â Â Â Â Â Â Â &lt;span class=&#34;nt&#34;&gt;&amp;#34;waitingForLock&amp;#34;&lt;/span&gt;Â &lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;Â &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;Â &lt;span class=&#34;err&#34;&gt;#&lt;/span&gt;Â &lt;span class=&#34;err&#34;&gt;æ˜¯å¦æ­£åœ¨ç­‰å¾…é”&lt;/span&gt;
Â Â Â Â Â Â Â Â &lt;span class=&#34;nt&#34;&gt;&amp;#34;numYields&amp;#34;&lt;/span&gt;Â &lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;Â &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;Â Â         &lt;span class=&#34;err&#34;&gt;#&lt;/span&gt;Â &lt;span class=&#34;err&#34;&gt;æŸ¥è¯¢æš‚åœçš„æ¬¡æ•°&lt;/span&gt;
Â Â Â Â Â Â Â Â &lt;span class=&#34;nt&#34;&gt;&amp;#34;lockStats&amp;#34;&lt;/span&gt;Â &lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;Â &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;Â Â          &lt;span class=&#34;err&#34;&gt;#&lt;/span&gt;Â &lt;span class=&#34;err&#34;&gt;é”çš„çŠ¶æ€&lt;/span&gt;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span class=&#34;nt&#34;&gt;&amp;#34;timeLockedMicros&amp;#34;&lt;/span&gt;Â &lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;Â &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;Â Â    &lt;span class=&#34;err&#34;&gt;#&lt;/span&gt;Â &lt;span class=&#34;err&#34;&gt;æŒæœ‰é”çš„æ—¶é—´(ms)&lt;/span&gt;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span class=&#34;nt&#34;&gt;&amp;#34;r&amp;#34;&lt;/span&gt;Â &lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;Â &lt;span class=&#34;err&#34;&gt;NumberLong(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;81&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span class=&#34;nt&#34;&gt;&amp;#34;w&amp;#34;&lt;/span&gt;Â &lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;Â &lt;span class=&#34;err&#34;&gt;NumberLong(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;)&lt;/span&gt;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span class=&#34;nt&#34;&gt;&amp;#34;timeAcquiringMicros&amp;#34;&lt;/span&gt;Â &lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;Â &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;Â Â &lt;span class=&#34;err&#34;&gt;#ç­‰å¾…é”çš„æ—¶é—´(ms)&lt;/span&gt;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span class=&#34;nt&#34;&gt;&amp;#34;r&amp;#34;&lt;/span&gt;Â &lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;Â &lt;span class=&#34;err&#34;&gt;NumberLong(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;8&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span class=&#34;nt&#34;&gt;&amp;#34;w&amp;#34;&lt;/span&gt;Â &lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;Â &lt;span class=&#34;err&#34;&gt;NumberLong(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;)&lt;/span&gt;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
Â Â Â Â Â Â Â Â &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h3 id=&#34;æ…¢æŸ¥è¯¢&#34;&gt;æ…¢æŸ¥è¯¢&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;å¼€å¯è¯­å¥ï¼š&lt;code&gt;db.getProfilingLevel(1, 1000)ï¼Œè®°å½•æ‰€æœ‰è¶…è¿‡1000msçš„è¯­å¥&lt;/code&gt;ï¼Œprofileçš„çº§åˆ«æœ‰0(å…³é—­)ã€1(æ…¢æŸ¥è¯¢)ã€2(å…¨éƒ¨)&lt;/li&gt;
&lt;li&gt;æŸ¥è¯¢è®°å½•ï¼š&lt;code&gt;db.system.profile.find()&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;æŸ¥è¯¢è¯­å¥ä¸Šçš„åˆ†æ&#34;&gt;æŸ¥è¯¢è¯­å¥ä¸Šçš„åˆ†æ&lt;/h3&gt;
&lt;p&gt;åœ¨æŸ¥è¯¢è¯­å¥ä¸­ä½¿ç”¨explain()æ–¹æ³•åˆ†ææŸ¥è¯¢è¯­å¥ï¼Œæœ‰ä¸‰ç§åˆ†ææ¨¡å¼ï¼Œé€šè¿‡ä¼ å‚çš„æ–¹å¼ä½¿ç”¨ï¼Œæ¯”å¦‚ï¼š&lt;code&gt;db.getCollection(&amp;quot;è¡¨å&amp;quot;).explain(&#39;executionStats&#39;).find({æ¡ä»¶})&lt;/code&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;queryPlannerï¼šé»˜è®¤ï¼Œåªä¼šè¾“å‡ºè¢«æŸ¥è¯¢ä¼˜åŒ–å™¨é€‰æ‹©å‡ºæ¥çš„æŸ¥è¯¢è®¡åˆ’winningPlane&lt;/li&gt;
&lt;li&gt;executionStatsï¼šé™¤äº†è¾“å‡ºè¢«æŸ¥è¯¢ä¼˜åŒ–å™¨é€‰æ‹©å‡ºæ¥çš„æŸ¥è¯¢è®¡åˆ’winningPlaneï¼Œå¹¶æ‰§è¡Œè¯­å¥ï¼ˆå¦‚æœæ˜¯å†™æ“ä½œï¼Œä¸ä¼šçœŸæ­£æ“ä½œæ•°æ®åº“ï¼‰ï¼Œç»™å‡ºåˆ†æç»“æœï¼Œæ¯”å¦‚æ‰«æçš„è¡Œæ•°ï¼Œä½¿ç”¨ä»€ä¹ˆç´¢å¼•ï¼Œè€—æ—¶ï¼Œè¿”å›çš„æ¡æ•°ç­‰&lt;/li&gt;
&lt;li&gt;allPlansExecutionï¼šåˆ—å‡ºæ‰€æœ‰å¯èƒ½çš„æŸ¥è¯¢è®¡åˆ’å¹¶æ‰§è¡Œï¼Œç»™å‡ºæ‰€æœ‰æ–¹æ¡ˆçš„ç»“æœï¼Œmongoæ”¯æŒè¿™ç§åˆ†ææ¨¡å¼ï¼Œä½†awsçš„documentDBä¸æ”¯æŒ&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;# å¸¸è§çš„stageæšä¸¾ï¼š
COLLSCANï¼šå…¨è¡¨æ‰«æ
IXSCANï¼šç´¢å¼•æ‰«æ
FETCHï¼šæ ¹æ®å‰é¢æ‰«æåˆ°çš„ä½ç½®æŠ“å–å®Œæ•´æ–‡æ¡£ï¼Œç›¸å½“äºå›è¡¨
IDHACKï¼šé’ˆå¯¹_idè¿›è¡ŒæŸ¥è¯¢
SHARD_MERGE åˆå¹¶åˆ†ç‰‡ä¸­ç»“æœ
SHARDING_FILTER åˆ†ç‰‡ä¸­è¿‡æ»¤æ‰å­¤ç«‹æ–‡æ¡£
SORTï¼šè¿›è¡Œå†…å­˜æ’åºï¼Œæœ€ç»ˆè¿”å›ç»“æœ
SORT_KEY_GENERATORï¼šè·å–æ¯ä¸€ä¸ªæ–‡æ¡£æ’åºæ‰€ç”¨çš„é”®å€¼
LIMITï¼šä½¿ç”¨limité™åˆ¶è¿”å›æ•°
SKIPï¼šä½¿ç”¨skipè¿›è¡Œè·³è¿‡
COUNTSCANï¼šcountä¸ä½¿ç”¨ç”¨Indexè¿›è¡Œcountæ—¶çš„stageè¿”å›
COUNT_SCANï¼šcountä½¿ç”¨äº†Indexè¿›è¡Œcountæ—¶çš„stageè¿”å›
TEXTï¼šä½¿ç”¨å…¨æ–‡ç´¢å¼•è¿›è¡ŒæŸ¥è¯¢æ—¶å€™çš„stageè¿”å›
SUBPLAï¼šæœªä½¿ç”¨åˆ°ç´¢å¼•çš„$oræŸ¥è¯¢çš„stageè¿”å›
PROJECTIONï¼šé™å®šè¿”å›å­—æ®µæ—¶å€™stageçš„è¿”å›

# ä¸€ä¸ªexecutionStatsä¾‹å­
{ 
    &amp;quot;queryPlanner&amp;quot; : {
        &amp;quot;plannerVersion&amp;quot; : 1.0, 
        &amp;quot;namespace&amp;quot; : &amp;quot;åº“å.è¡¨å&amp;quot;, 
        &amp;quot;winningPlan&amp;quot; : {
            &amp;quot;stage&amp;quot; : &amp;quot;SORT_AGGREGATE&amp;quot;, 
            &amp;quot;inputStage&amp;quot; : {
                &amp;quot;stage&amp;quot; : &amp;quot;IXONLYSCAN&amp;quot;, 
                &amp;quot;indexName&amp;quot; : &amp;quot;ç´¢å¼•å&amp;quot;, 
                &amp;quot;direction&amp;quot; : &amp;quot;forward&amp;quot;
            }
        }
    }, 
    &amp;quot;executionStats&amp;quot; : {
        &amp;quot;executionSuccess&amp;quot; : true, 
        &amp;quot;planningTimeMillis&amp;quot; : &amp;quot;0.276&amp;quot;, 
        &amp;quot;nReturned&amp;quot; : &amp;quot;1&amp;quot;, 
        &amp;quot;executionTimeMillis&amp;quot; : &amp;quot;10517.898&amp;quot;,  # æ‰§è¡Œæ—¶é—´
        &amp;quot;totalKeysExamined&amp;quot; : &amp;quot;10519.0&amp;quot;,  # æ€»æ‰«ææ•°
        &amp;quot;totalDocsExamined&amp;quot; : &amp;quot;567542&amp;quot;,   # æ€»æ‰«ææ–‡æ¡£æ•°
        &amp;quot;executionStages&amp;quot; : {
            &amp;quot;stage&amp;quot; : &amp;quot;SORT_AGGREGATE&amp;quot;, 
            &amp;quot;nReturned&amp;quot; : &amp;quot;1&amp;quot;, 
            &amp;quot;executionTimeMillisEstimate&amp;quot; : &amp;quot;10517.497&amp;quot;, 
            &amp;quot;inputStage&amp;quot; : {
                &amp;quot;stage&amp;quot; : &amp;quot;IXONLYSCAN&amp;quot;, # 
                &amp;quot;nReturned&amp;quot; : &amp;quot;567542&amp;quot;, # è¿”å›çš„æ–‡æ¡£æ•°
                &amp;quot;executionTimeMillisEstimate&amp;quot; : &amp;quot;9786.122&amp;quot;,  # æ‰§è¡Œæ­¤é˜¶æ®µçš„è€—æ—¶
                &amp;quot;indexName&amp;quot; : &amp;quot;ç´¢å¼•å&amp;quot;, 
                &amp;quot;direction&amp;quot; : &amp;quot;forward&amp;quot;
            }
        }
    }, 
    &amp;quot;serverInfo&amp;quot; : {
        &amp;quot;host&amp;quot; : &amp;quot;oms&amp;quot;, 
        &amp;quot;port&amp;quot; : 27017.0, 
        &amp;quot;version&amp;quot; : &amp;quot;4.0.0&amp;quot;
    }, 
    &amp;quot;ok&amp;quot; : 1.0, 
    &amp;quot;operationTime&amp;quot; : Timestamp(1640604817, 1)
}
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;åº“æˆ–é›†åˆä¸Šçš„åˆ†æ&#34;&gt;åº“æˆ–é›†åˆä¸Šçš„åˆ†æ&lt;/h3&gt;
&lt;p&gt;å¯¹è¡¨çš„æˆ–å¯¹åº“çš„ï¼Œä½¿ç”¨stats()æ–¹æ³•ï¼Œæ¯”å¦‚&lt;code&gt;db.getCollection(&amp;quot;order&amp;quot;).stats()ï¼Œæˆ–è€…db.stats()&lt;/code&gt;ï¼Œå¯ä»¥æŸ¥è¯¢æ•´å¼ è¡¨çš„ä¿¡æ¯æˆ–æ•´ä¸ªåº“çš„ç»Ÿè®¡ä¿¡æ¯&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;# é’ˆå¯¹åº“çš„
{ 
    &amp;quot;db&amp;quot; : &amp;quot;order&amp;quot;,  # åº“å
    &amp;quot;collections&amp;quot; : 11.0,  # é›†åˆæ•°
    &amp;quot;objects&amp;quot; : 4938161.0,  # å¯¹è±¡æ•°
    &amp;quot;storageSize&amp;quot; : 4236443648.0,  # å ç”¨ç£ç›˜å¤§å°
    &amp;quot;indexes&amp;quot; : 32.0,  # ç´¢å¼•æ•°
    &amp;quot;indexSize&amp;quot; : 1424130048.0,  # ç´¢å¼•å¤§å°
    &amp;quot;fileSize&amp;quot; : 5660573696.0,   # æ–‡ä»¶å¤§å°
    &amp;quot;ok&amp;quot; : 1.0, 
    &amp;quot;operationTime&amp;quot; : Timestamp(1640604514, 1)
}
# é’ˆå¯¹è¡¨çš„
{ 
    &amp;quot;ns&amp;quot; : &amp;quot;oms.order&amp;quot;, 
    &amp;quot;count&amp;quot; : 749031.0,  # æ•°é‡
    &amp;quot;size&amp;quot; : 1479336225.0, # å¤§å°
    &amp;quot;avgObjSize&amp;quot; : 1975.90745, # æ¯ä¸ªå¯¹è±¡çš„å¹³å‡å¤§å°
    &amp;quot;storageSize&amp;quot; : 2164432896.0, # å­˜å‚¨å¤§å° 
    &amp;quot;capped&amp;quot; : false, 
    &amp;quot;nindexes&amp;quot; : 1.0, # ç´¢å¼•ä¸ªæ•°
    &amp;quot;totalIndexSize&amp;quot; : 31129600.0, # æ€»ç´¢å¼•å¤§å°
    &amp;quot;indexSizes&amp;quot; : {
        &amp;quot;_id_&amp;quot; : 94568448.0, 
        &amp;quot;id&amp;quot; : 77438976.0, 
        &amp;quot;idx_createAt_desc&amp;quot; : 31129600.0,   # å„ä¸ªç´¢å¼•çš„å¤§å°
    }, 
    &amp;quot;ok&amp;quot; : 1.0, 
    &amp;quot;operationTime&amp;quot; : Timestamp(1640327496, 1)
}
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;å­˜å‚¨å¼•æ“&#34;&gt;å­˜å‚¨å¼•æ“&lt;/h1&gt;
&lt;h2 id=&#34;mmapv1&#34;&gt;MMapv1&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;4.0ç‰ˆæœ¬å¼€å§‹è¢«å¼ƒç”¨&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å†…å­˜æ˜ å°„æ–‡ä»¶ï¼Œä¸æ”¯æŒå‹ç¼©ï¼Œæ“…é•¿äºå¤§å®¹é‡æ’å…¥ã€è¯»å–å’Œå°±åœ°æ›´æ–°çš„æ“ä½œï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ¯ä¸€ä¸ªæ•°æ®åº“ç”±ä¸€ä¸ª.nsæ–‡ä»¶å’Œä¸€ä¸ªæˆ–å¤šä¸ªæ•°æ®æ–‡ä»¶ç»„æˆ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;.nsæ–‡ä»¶å®é™…ä¸Šæ˜¯ä¸€ä¸ªhashè¡¨ï¼Œç”¨äºå¿«é€Ÿå®šä½æŸä¸ªé›†åˆåœ¨æ•°æ®æ–‡ä»¶ä¸­çš„èµ·å§‹ä½ç½®ï¼›&lt;/li&gt;
&lt;li&gt;æ¯ä¸ªæ•°æ®æ–‡ä»¶ä¼šè¢«åˆ’åˆ†æˆå¤šä¸ªextentï¼Œæ¯ä¸ªextentåªåŒ…å«ä¸€ä¸ªé›†åˆçš„æ•°æ®ï¼Œä¸€ä¸ªextentåŒ…å«å¤šä¸ªæ–‡æ¡£ï¼ŒåŒä¸€ä¸ªextentä¸­çš„æ‰€æœ‰æ–‡æ¡£ä½¿ç”¨åŒå‘é“¾è¡¨è¿æ¥ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¸ºäº†ä¿è¯è¿ç»­çš„å­˜å‚¨ç©ºé—´ï¼Œé¿å…äº§ç”Ÿç£ç›˜ç¢ç‰‡ï¼ŒMMAPv1å¯¹æ•°æ®æ–‡ä»¶çš„ä½¿ç”¨é‡‡ç”¨é¢„åˆ†é…ç­–ç•¥ï¼šæ•°æ®åº“åˆ›å»ºä¹‹åï¼Œå…ˆåˆ›å»ºä¸€ä¸ªç¼–å·ä¸º0çš„æ–‡ä»¶ï¼Œå¤§å°ä¸º64Mï¼Œå½“è¿™ä¸ªæ–‡ä»¶æœ‰ä¸€åŠä»¥ä¸Šè¢«ä½¿ç”¨æ—¶ï¼Œå†åˆ›å»ºä¸€ä¸ªç¼–å·ä¸º1çš„æ–‡ä»¶ï¼Œå¤§å°æ˜¯ä¸Šä¸€ä¸ªæ–‡ä»¶çš„ä¸¤å€ï¼Œå³128Mï¼Œä¾æ­¤ç±»æ¨ï¼Œç›´åˆ°åˆ›å»ºæ–‡ä»¶å¤§å°è¾¾åˆ°2Gï¼Œä»¥åå†åˆ›å»ºçš„æ–‡ä»¶å¤§å°å°±éƒ½æ˜¯2Gäº†ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;MMapv1å¼•æ“é»˜è®¤ä¼šå°†æ‰€æœ‰çš„redo logè®°å½•åˆ°ç¡¬ç›˜ä¸Šï¼Œæ¯éš”60ç§’å†™ä¸€æ¬¡æ•°æ®æ–‡ä»¶ï¼Œæ¯éš”100æ¯«ç§’å†™ä¸€æ¬¡åˆ°æ—¥å¿—æ–‡ä»¶ï¼Œç¡®ä¿æ‰€æœ‰ä¿®æ”¹éƒ½èƒ½æŒä¹…åŒ–åˆ°ç£ç›˜ä¸Šï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;é”æ˜¯é›†åˆçº§åˆ«çš„ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;MMapv1å¼•æ“ä¼šæœ€å¤§é™åº¦çš„ä½¿ç”¨å†…å­˜ï¼Œåˆ†é…ç»™å®ƒçš„å†…å­˜è¶Šå¤§ï¼Œæ€§èƒ½è¶Šå¥½ï¼›åŒæ—¶ï¼Œå†…å­˜ç”±æ“ä½œç³»ç»Ÿç®¡ç†ï¼Œå¦‚æœå…¶ä»–è¿›ç¨‹éœ€è¦å†…å­˜ï¼ŒMMapv1ä¼šè®©å‡ºè‡ªå·±çš„ç©ºé—²å†…å­˜ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ–‡æ¡£æŒ‰ç…§å†™å…¥é¡ºåºå­˜å‚¨åœ¨ç£ç›˜ä¸Šï¼Œç”±äºæ–‡æ¡£å¯èƒ½ä¼šæ›´æ–°å¯¼è‡´é•¿åº¦å˜é•¿ï¼Œå¦‚æœåŸæœ‰å­˜å‚¨ç©ºé—´ä¸å¤Ÿï¼Œæ–‡æ¡£å°±éœ€è¦è¿›è¡Œè¿ç§»ï¼Œå¯¼è‡´é›†åˆä¸­æ‰€æœ‰ç´¢å¼•éƒ½è¦åŒæ­¥ä¿®æ”¹æ–‡æ¡£æ–°çš„å­˜å‚¨ä½ç½®ï¼Œå½±å“æ€§èƒ½ï¼ŒåŒæ—¶ä¹Ÿåæ˜ å‡ºï¼Œå¦‚æœæ–‡æ¡£æ²¡æœ‰ç´¢å¼•æ—¶ï¼Œæ— æ³•ä¿è¯æ–‡æ¡£åœ¨readä¸­çš„è‡ªç„¶é¡ºåºã€‚&lt;/p&gt;
&lt;p&gt;æœ‰ä¸¤ç§ç­–ç•¥æ¥é¿å…æ–‡æ¡£è¿ç§»çš„æƒ…å†µå‘ç”Ÿï¼š&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;åŸºäºpaddingFactorï¼ˆå¡«å……å› å­ï¼‰çš„è‡ªé€‚åº”åˆ†é…æ–¹å¼&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ã€€ã€€è¿™ç§æ–¹å¼ä¼šåŸºäºæ¯ä¸ªé›†åˆä¸­çš„æ–‡æ¡£æ›´æ–°å†å²è®¡ç®—æ–‡æ¡£æ›´æ–°çš„å¹³å‡å¢é•¿é•¿åº¦ï¼Œç„¶åæ ¹æ®å¹³å‡å¢é•¿é•¿åº¦è®¾ç½®ä¸€ä¸ªpaddingFactorï¼ˆå¡«å……å› å­ï¼Œå¤§å°å¤§äº1ï¼‰ï¼Œ ä»¥ååœ¨æ–°æ–‡æ¡£æ’å…¥æˆ–æ—§æ–‡æ¡£ç§»åŠ¨æ—¶åˆ†é…çš„ç©ºé—´=æ–‡æ¡£å®é™…é•¿åº¦Ã—paddingFactorã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;åŸºäºusePowerOf2Sizesçš„é¢„åˆ†é…æ–¹å¼&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ã€€ã€€è¿™ç§æ–¹å¼åˆ™ä¸è€ƒè™‘æ›´æ–°å†å²ï¼Œç›´æ¥ä¸ºæ–‡æ¡£åˆ†é…æ¯”æ–‡æ¡£å¤§å°å¤§è€Œåˆæœ€æ¥è¿‘æ–‡æ¡£å¤§å°çš„2çš„Næ¬¡æ–¹å¤§å°çš„å­˜å‚¨ç©ºé—´ï¼ˆå½“å¤§å°è¶…è¿‡2MBæ—¶åˆ™å˜ä¸º2MBçš„å€æ•°å¢é•¿ï¼‰ï¼Œä¾‹å¦‚è‹¥æ–‡æ¡£å¤§å°ä¸º200Bytesåˆ™ç›´æ¥åˆ†é…256Bytesçš„ç©ºé—´ï¼Œè¿™ç§æ–¹å¼ä¹Ÿä¼šäº§ç”Ÿä¸€å®šçš„ç£ç›˜ç¢ç‰‡ã€‚&lt;/p&gt;
&lt;p&gt;ã€€ã€€å¯¹äºç¬¬ä¸€ç§ç­–ç•¥ï¼Œç”±äºæ¯ä¸ªæ–‡æ¡£å¤§å°ä¸ä¸€ï¼Œç»è¿‡å¡«å……åçš„ç©ºé—´å¤§å°ä¹Ÿä¸ä¸€æ ·ï¼Œå¦‚æœé›†åˆä¸Šçš„æ›´æ–°æ“ä½œå¾ˆå¤šï¼Œé‚£ä¹ˆå› ä¸ºè®°å½•ç§»åŠ¨è€Œå¯¼è‡´çš„ç©ºé—²ç©ºé—´ä¼šå› ä¸ºå¤§å°ä¸ä¸€è€Œéš¾ä»¥é‡ç”¨ã€‚è€Œç¬¬äºŒç§ç­–ç•¥å°±ä¸ä¸€æ ·äº†ï¼Œå®ƒåˆ†é…çš„ç©ºé—´å¤§å°éƒ½æ˜¯2çš„Næ¬¡æ–¹ï¼Œä¼šæ›´å®¹æ˜“ç»´æŠ¤å’Œåˆ©ç”¨ï¼Œå½“é‚£äº›åˆ é™¤æˆ–æ›´æ–°å˜å¤§è€Œäº§ç”Ÿçš„ç£ç›˜ç¢ç‰‡ï¼Œæ¯”å¦‚æ–‡æ¡£å˜å¤§ï¼Œéœ€è¦è¿ç§»åˆ°æ–°ç©ºé—´ï¼Œæ­¤æ—¶å°±ç©ºé—´å°±ä¼šè¢«æ ‡è®°ä¸ºdeleteï¼Œè¿™äº›è¢«æ ‡è®°ä¸ºåˆ é™¤çš„ç©ºé—´å¯ä»¥è¢«inserté‡ç”¨ï¼Œå¦å¤–ï¼Œç”±äºé¢„åˆ†é…å…è®¸æ–‡æ¡£å°ºå¯¸æœ‰é™åº¦çš„å¢é•¿ï¼Œè€Œæ— éœ€æ¯æ¬¡æ›´æ–°å˜å¤§éƒ½é‡æ–°åˆ†é…ç©ºé—´ã€‚&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥ï¼Œæ”¹è¿›åçš„MMAPv1ä¾¿æŠ›å¼ƒäº†ç¬¬ä¸€ç§ç­–ç•¥ï¼Œåªä½¿ç”¨è¾ƒä¼˜çš„ç¬¬äºŒç§ç­–ç•¥ã€‚&lt;/p&gt;
&lt;p&gt;å¦å¤–ï¼ŒMongoDBè¿˜æä¾›äº†ä¸€ä¸ªâ€œNo Padding Allocationâ€ç­–ç•¥ï¼ŒæŒ‰ç…§æ•°æ®çš„å®é™…å°ºå¯¸åˆ†é…ç©ºé—´ï¼Œå¦‚æœæŸä¸ªé›†åˆä¸Šç»å¤§å¤šæ•°æƒ…å†µä¸‹æ‰§è¡Œçš„éƒ½æ˜¯insertæˆ–è€…in-place updateï¼ˆæ›´æ–°åæ–‡æ¡£sizeä¸ä¼šå˜å¤§ï¼‰ï¼Œè¿˜æœ‰æå°‘æ•°çš„deleteï¼Œé‚£ä¹ˆå¯ä»¥åœ¨è¿™ä¸ªé›†åˆä½¿ç”¨è¿™ä¸ªç­–ç•¥ï¼Œæé«˜ç£ç›˜ç©ºé—´åˆ©ç”¨ç‡ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;inmemory&#34;&gt;InMemory&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;å°†æ‰€æœ‰æ•°æ®éƒ½å­˜åœ¨å†…å­˜ä¸­ï¼Œåªæœ‰å°‘é‡çš„å…ƒæ•°æ®å’Œè¯Šæ–­æ—¥å¿—ã€ä¸´æ—¶æ•°æ®å­˜å‚¨åˆ°ç£ç›˜æ–‡ä»¶ï¼›&lt;/li&gt;
&lt;li&gt;æ–‡æ¡£çº§åˆ«çš„é”ï¼ŒåŒä¸€æ—¶åˆ»å¤šä¸ªå†™æ“ä½œå¯ä»¥ä¿®æ”¹åŒä¸€ä¸ªé›†åˆä¸­çš„ä¸åŒæ–‡æ¡£ï¼Œä¿®æ”¹åŒä¸€æ–‡æ¡£æ—¶ä¼šä¸Šé”ï¼›&lt;/li&gt;
&lt;li&gt;å°†æ•°æ®åº“çš„æ•°æ®ã€ç´¢å¼•å’Œæ“ä½œæ—¥å¿—ç­‰å†…å®¹å­˜å‚¨åˆ°å†…å­˜ä¸­ã€‚å¯ä»¥é€šè¿‡å‚æ•°&lt;code&gt;--inMemorySizeGB&lt;/code&gt;è®¾ç½®å®ƒå ç”¨çš„å†…å­˜å¤§å°ï¼Œé»˜è®¤ä¸ºï¼š50% of RAM - 1GBï¼›&lt;/li&gt;
&lt;li&gt;ä¸éœ€è¦å•ç‹¬çš„æ—¥å¿—æ–‡ä»¶ï¼Œä¸å­˜åœ¨è®°å½•æ—¥å¿—å’Œç­‰å¾…æ•°æ®æŒä¹…åŒ–çš„é—®é¢˜ã€‚soå®•æœºæ—¶ï¼Œæ‰€æœ‰å­˜å‚¨åœ¨å†…å­˜ä¸­çš„æ•°æ®éƒ½å°†ä¼šä¸¢å¤±ï¼›&lt;/li&gt;
&lt;li&gt;æ•°æ®è™½ç„¶ä¸ä¼šå†™å…¥ç£ç›˜ï¼Œä½†æ˜¯ä¼šè®°å½•oplogï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;wiredtiger&#34;&gt;WiredTiger&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;3.0ç‰ˆæœ¬å¼•å…¥ï¼Œ3.2ç‰ˆæœ¬æˆä¸ºé»˜è®¤çš„å­˜å‚¨å¼•æ“&lt;/li&gt;
&lt;li&gt;é‡‡ç”¨æ’ä»¶å¼çš„å­˜å‚¨å¼•æ“æ¶æ„ï¼Œæ—¢æ”¯æŒB+æ ‘ï¼Œä¹Ÿæ”¯æŒ&lt;a class=&#34;link&#34; href=&#34;https://juejin.im/post/6844903688075477000&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;LSMæ ‘&lt;/a&gt;ï¼Œé»˜è®¤é…ç½®ä½¿ç”¨B+æ ‘ï¼›&lt;/li&gt;
&lt;li&gt;è®¾è®¡äº†ä¸€ä¸ªèƒ½å……åˆ†åˆ©ç”¨CPUå¹¶è¡Œè®¡ç®—çš„å†…å­˜æ¨¡å‹çš„æ— é”å¹¶è¡Œæ¡†æ¶ï¼Œä½¿å…¶åœ¨å¤šæ ¸CPUä¸Šè¡¨ç°ä¼˜å¼‚ï¼›&lt;/li&gt;
&lt;li&gt;å®ç°äº†ä¸€å¥—åŸºäºBLOCK/Extentçš„ç£ç›˜è®¿é—®ç®—æ³•ï¼Œä½¿å…¶åœ¨æ•°æ®å‹ç¼©å’Œç£ç›˜IOä¸Šè¡¨ç°ä¼˜å¼‚ï¼›&lt;/li&gt;
&lt;li&gt;å®ç°åŸºäºsnapshotçš„ACIDäº‹åŠ¡ï¼Œç®€åŒ–äº‹åŠ¡æ¨¡å‹ï¼Œæ‘ˆå¼ƒä¼ ç»Ÿäº‹åŠ¡é”éš”ç¦»åˆèƒ½åŒæ—¶ä¿è¯ACIDï¼›&lt;/li&gt;
&lt;li&gt;å®ç°äº†ä¸€ç§åŸºäºHazard Pointerçš„LRU cacheæ¨¡å‹ï¼Œå……åˆ†åˆ©ç”¨å†…å­˜å®¹é‡çš„åŒæ—¶åˆèƒ½æ‹¥æœ‰å¾ˆé«˜çš„äº‹åŠ¡è¯»å†™å¹¶å‘ï¼›&lt;/li&gt;
&lt;li&gt;æ”¯æŒå‹ç¼©ï¼Œå ç”¨ç£ç›˜ç©ºé—´æ›´å°ï¼Œæœ‰ä¸¤ç§å‹ç¼©æ¨¡å¼ï¼šSnappyå’ŒZlib&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é¢˜å¤–è¯å…³äºLSMæ ‘ï¼š&lt;/p&gt;
&lt;p&gt;LSMæ ‘ï¼Œå…¨ç§°ï¼šLog-Structured Merge-Treeï¼Œæ˜¯ä¸€ç§æ•°æ®ç»“æ„çš„è®¾è®¡æ€æƒ³ï¼Œä¸æ˜¯ä¸€ç§æ•°æ®ç»“æ„ï¼Œä¸€èˆ¬åŸºäºBæ ‘åŠå…¶å˜ä½“å®ç°ï¼Œä¸»è¦æ˜¯å°†éšæœºæ“ä½œå˜ä¸ºé¡ºåºæ“ä½œï¼Œæå‡ç£ç›˜å†™é€Ÿåº¦ï¼Œä½†ä¼šç‰ºç‰²ä¸€äº›è¯»æ€§èƒ½ï¼›&lt;/p&gt;
&lt;p&gt;LSMæ ‘ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;MemTableï¼Œå¸¸é©»äºå†…å­˜ï¼Œç”¨äºä¿å­˜æœ€è¿‘æ›´æ–°çš„æ•°æ®ï¼ŒæŒ‰ç…§Keyæœ‰åºç»„ç»‡è¿™äº›æ•°æ®ï¼Œä¿è¯æœ‰åºæ€§é€šå¸¸ä¼šä½¿ç”¨ä¸€äº›æ•°æ®ç»“æ„ï¼Œæ¯”å¦‚çº¢é»‘æ ‘ï¼Œè·³è¡¨ç­‰&lt;/li&gt;
&lt;li&gt;Immutable MemTableï¼Œå½“MemTableè¾¾åˆ°ä¸€å®šå¤§å°åï¼Œä¼šè½¬æ¢ä¸ºImmutable MemTableï¼Œå¤„äºMemTableå’ŒSSTableçš„ä¸­é—´çŠ¶æ€ï¼Œå†™æ“ä½œç”±æ–°çš„MemTableå¤„ç†ï¼Œåœ¨è½¬å­˜è¿‡ç¨‹ä¸­ä¸é˜»å¡æ•°æ®æ›´æ–°æ“ä½œã€‚&lt;/li&gt;
&lt;li&gt;SSTableï¼Œæœ‰åºé”®å€¼å¯¹é›†åˆï¼Œæ˜¯LSMæ ‘åœ¨ç£ç›˜ä¸­çš„ç»“æ„ï¼Œä¸ºäº†åŠ é€Ÿè¯»å–ï¼Œé€šå¸¸æ˜¯é€šè¿‡å»ºç«‹keyçš„ç´¢å¼• + å¸ƒéš†è¿‡æ»¤å™¨æ¥åŠ å¿«keyçš„æŸ¥æ‰¾ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;LSMæ ‘åœ¨æ•°æ®æ’å…¥ã€ä¿®æ”¹ã€åˆ é™¤ç­‰æ“ä½œæ—¶ï¼Œä¸ºäº†ä¿è¯é¡ºåºå†™ï¼Œæ˜¯ç›´æ¥å°†æ“ä½œè®°å½•è¿½åŠ åˆ°å†…å­˜ä¸­ï¼ˆè€ŒB+æ ‘æ˜¯ç›´æ¥ä¿®æ”¹åŸæ•°æ®ï¼‰ï¼Œå½“è¾¾åˆ°ä¸€å®šçš„æ•°æ®é‡åï¼Œå†æ‰¹é‡å†™å…¥ç£ç›˜ï¼Œä¸æ–­å°†Immutable MemTableåˆ·ç›˜æŒä¹…åŒ–ï¼Œå˜æˆSSTableï¼Œè€Œä¸ç”¨å»ä¿®æ”¹ä¹‹å‰çš„SSTableä¸­çš„keyï¼Œä¿è¯é¡ºåºè¯»å†™ã€‚ç”±äºæ˜¯æ“ä½œè®°å½•çš„è¿½åŠ å†™å…¥ï¼Œåœ¨ä¸åŒçš„SSTableä¸­ï¼Œå¯èƒ½å­˜åœ¨å¯¹ç›¸åŒçš„Keyçš„è®°å½•ï¼Œè€Œåªæœ‰æœ€æ–°çš„è®°å½•æ‰æ˜¯æœ€å‡†ç¡®çš„ï¼Œå› æ­¤éœ€è¦å¯¹SSTableè¿›è¡Œå‹ç¼©ï¼Œé€šè¿‡åˆå¹¶å¤šä¸ªSSTableæ¥æ¸…é™¤å†—ä½™è®°å½•ï¼Œè¯»å–æ—¶ï¼Œä¹Ÿæ˜¯å€’åºæŸ¥è¯¢ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;LSMæ ‘æœ‰ä¸¤ç§å‹ç¼©ç­–ç•¥ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;size-tieredï¼šä¿è¯æ¯å±‚SSTableçš„å¤§å°ç›¸è¿‘ï¼ŒåŒæ—¶é™åˆ¶æ¯ä¸€å±‚SSTableçš„æ•°é‡ã€‚æ¯”å¦‚ï¼Œæ¯å±‚é™åˆ¶SSTableä¸ºNï¼Œå½“æ¯å±‚SSTableè¾¾åˆ°Nåï¼Œåˆ™è§¦å‘Compactæ“ä½œåˆå¹¶è¿™äº›SSTableï¼Œå¹¶å°†åˆå¹¶åçš„ç»“æœå†™å…¥åˆ°ä¸‹ä¸€å±‚æˆä¸ºä¸€ä¸ªæ›´å¤§çš„sstableã€‚&lt;/p&gt;
&lt;p&gt;ç”±æ­¤å¯ä»¥çœ‹å‡ºï¼Œå½“å±‚æ•°è¾¾åˆ°ä¸€å®šæ•°é‡æ—¶ï¼Œæœ€åº•å±‚çš„å•ä¸ªSSTableçš„å¤§å°ä¼šå˜å¾—éå¸¸å¤§ã€‚å¹¶ä¸”size-tieredç­–ç•¥ä¼šå¯¼è‡´ç©ºé—´æ”¾å¤§æ¯”è¾ƒä¸¥é‡ã€‚å³ä½¿å¯¹äºåŒä¸€å±‚çš„SSTableï¼Œæ¯ä¸ªkeyçš„è®°å½•æ˜¯å¯èƒ½å­˜åœ¨å¤šä»½çš„ï¼Œåªæœ‰å½“è¯¥å±‚çš„SSTableæ‰§è¡Œcompactæ“ä½œæ‰ä¼šæ¶ˆé™¤è¿™äº›keyçš„å†—ä½™è®°å½•ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;leveledï¼šä¹Ÿæ˜¯é‡‡ç”¨åˆ†å±‚çš„æ€æƒ³ï¼Œæ¯ä¸€å±‚é™åˆ¶æ€»æ–‡ä»¶çš„å¤§å°ã€‚ä½†æ˜¯è·Ÿsize-tieredç­–ç•¥ä¸åŒçš„æ˜¯ï¼Œleveledä¼šå°†æ¯ä¸€å±‚åˆ‡åˆ†æˆå¤šä¸ªå¤§å°ç›¸è¿‘çš„SSTableã€‚è¿™äº›SSTableæ˜¯è¿™ä¸€å±‚æ˜¯å…¨å±€æœ‰åºçš„ï¼Œæ„å‘³ç€ä¸€ä¸ªkeyåœ¨æ¯ä¸€å±‚è‡³å¤šåªæœ‰1æ¡è®°å½•ï¼Œä¸å­˜åœ¨å†—ä½™è®°å½•ã€‚ä¹‹æ‰€ä»¥å¯ä»¥ä¿è¯å…¨å±€æœ‰åºï¼Œæ˜¯å› ä¸ºåˆå¹¶ç­–ç•¥å’Œsize-tieredä¸åŒã€‚&lt;/p&gt;
&lt;p&gt;leveledç­–ç•¥ç›¸è¾ƒäºsize-tieredç­–ç•¥æ¥è¯´ï¼Œæ¯å±‚å†…keyæ˜¯ä¸ä¼šé‡å¤çš„ï¼Œå³ä½¿æ˜¯æœ€åçš„æƒ…å†µï¼Œé™¤å¼€æœ€åº•å±‚å¤–ï¼Œå…¶ä½™å±‚éƒ½æ˜¯é‡å¤keyï¼ŒæŒ‰ç…§ç›¸é‚»å±‚å¤§å°æ¯”ä¾‹ä¸º10æ¥ç®—ï¼Œå†—ä½™å æ¯”ä¹Ÿå¾ˆå°ã€‚å› æ­¤ç©ºé—´æ”¾å¤§é—®é¢˜å¾—åˆ°ç¼“è§£ã€‚ä½†æ˜¯å†™æ”¾å¤§é—®é¢˜ä¼šæ›´åŠ çªå‡ºã€‚ä¸¾ä¸€ä¸ªæœ€ååœºæ™¯ï¼Œå¦‚æœLevelNå±‚æŸä¸ªSSTableçš„keyçš„èŒƒå›´è·¨åº¦éå¸¸å¤§ï¼Œè¦†ç›–äº†LevelN+1å±‚æ‰€æœ‰keyçš„èŒƒå›´ï¼Œé‚£ä¹ˆè¿›è¡ŒCompactæ—¶å°†æ¶‰åŠLevel N+1å±‚çš„å…¨éƒ¨æ•°æ®ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;p&gt;å°†LSMæ ‘å­˜å‚¨ç»“æ„æŠ½è±¡æˆä¸¤ç§æ ‘ï¼Œæ¯”å¦‚æœ‰C0 treeï¼Œå¸¸é©»åœ¨å†…å­˜ï¼Œå¦ä¸€ä¸ªä¸ºC1 treeï¼Œç»“æ„å¸¸é©»åœ¨ç¡¬ç›˜ï¼Œæ¯”å¦‚B+æ ‘ï¼ŒC1æ‰€æœ‰èŠ‚ç‚¹éƒ½æ˜¯100%æ»¡çš„ï¼ŒèŠ‚ç‚¹çš„å¤§å°ä¸ºç£ç›˜å—çš„å¤§å°ï¼›&lt;/p&gt;
&lt;p&gt;æ’å…¥æ–°è®°å½•æ—¶ï¼Œå…ˆåœ¨æ—¥å¿—æ–‡ä»¶ä¸­ä»¥appendçš„æ–¹å¼é¡ºåºæ’å…¥æ“ä½œæ—¥å¿—ï¼›æ–°è®°å½•çš„ç´¢å¼•æ’å…¥åˆ°C0ä¸­ï¼Œåœ¨å†…å­˜å®Œæˆï¼Œä¸æ¶‰åŠç£ç›˜IOï¼Œå½“C0å¤§å°è¾¾åˆ°æŸä¸€é˜ˆå€¼æˆ–æ¯éš”ä¸€æ®µæ—¶é—´åï¼Œå°†C0ä¸­çš„è®°å½•æ»šåŠ¨åˆå¹¶åˆ°ç£ç›˜C1ä¸­ï¼Œå¦‚æœC1ä½“é‡å¤ªå¤§å°±å‘C2åˆå¹¶ï¼Œä»¥æ­¤ç±»æ¨ï¼›åˆå¹¶æ—¶ä»C1ä¸­è¯»å–æœªåˆå¹¶å¶å­èŠ‚ç‚¹ï¼Œä»å°åˆ°å¤§æ‰¾C0ä¸­çš„èŠ‚ç‚¹ï¼Œåˆå¹¶æ’åºï¼Œåˆ é™¤C0ï¼Œå¾ªç¯æ‰§è¡Œï¼Œç›´è‡³æ»¡äº†ï¼Œå°±å†™å…¥ç£ç›˜ï¼Œä»è€Œè¾¾åˆ°å°†éšæœºæ“ä½œå˜æˆé¡ºåºæ“ä½œï¼›&lt;/p&gt;
&lt;p&gt;æŸ¥æ‰¾æ—¶ï¼Œå…ˆæŸ¥C0ï¼ŒæŸ¥ä¸åˆ°å°±æŸ¥C1ï¼Œä»¥æ­¤ç±»æ¨ï¼›&lt;/p&gt;
&lt;p&gt;åˆ é™¤æ—¶ï¼ŒæŸ¥è¯¢åŒæŸ¥æ‰¾é€»è¾‘ï¼Œåªæ˜¯æ‰¾åˆ°ååªè¿›è¡Œæ ‡è®°ï¼Œç­‰å¾…å¼‚æ­¥åˆ é™¤ï¼›&lt;/p&gt;
&lt;p&gt;å‚è€ƒï¼šhttps://zhuanlan.zhihu.com/p/103968892ã€https://zhuanlan.zhihu.com/p/181498475ã€https://www.51cto.com/article/680775.html&lt;/p&gt;
&lt;h3 id=&#34;æ•°æ®æ–‡ä»¶åœ¨ç£ç›˜ä¸Šçš„æ•°æ®ç»“æ„&#34;&gt;æ•°æ®æ–‡ä»¶åœ¨ç£ç›˜ä¸Šçš„æ•°æ®ç»“æ„&lt;/h3&gt;
&lt;p&gt;B+æ ‘çš„leaf pageåŒ…å«ä¸€ä¸ªï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;é¡µå¤´(page header)ï¼šé¡µçš„ç±»å‹ã€é¡µä¸­å®é™…è½½è·æ•°æ®çš„å¤§å°ã€é¡µä¸­è®°å½•æ¡æ•°&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å—å¤´(block header)ï¼šæ­¤é¡µçš„checksum&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;çœŸæ­£çš„æ•°æ®(key/value)ï¼šå—åœ¨ç£ç›˜ä¸Šçš„å¯»å€ä½ç½®ç­‰ä¿¡æ¯&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;WiredTigeræœ‰ä¸€ä¸ªå—è®¾å¤‡ç®¡ç†çš„æ¨¡å—ï¼Œç”¨æ¥ä¸ºpageåˆ†é…blockã€‚å¦‚æœè¦å®šä½æŸä¸€è¡Œæ•°æ®ï¼ˆkey/valueï¼‰çš„ä½ç½®ï¼Œå¯ä»¥å…ˆé€šè¿‡blockçš„ä½ç½®æ‰¾åˆ°æ­¤pageï¼ˆç›¸å¯¹äºæ–‡ä»¶èµ·å§‹ä½ç½®çš„åç§»é‡ï¼‰ï¼Œå†é€šè¿‡pageæ‰¾åˆ°è¡Œæ•°æ®çš„ç›¸å¯¹ä½ç½®ï¼Œæœ€åå¯ä»¥å¾—åˆ°è¡Œæ•°æ®ç›¸å¯¹äºæ–‡ä»¶èµ·å§‹ä½ç½®çš„åç§»é‡offsetsã€‚ç”±äºoffsetsæ˜¯ä¸€ä¸ª8å­—èŠ‚å¤§å°çš„å˜é‡ï¼Œæ‰€ä»¥WiredTigerç£ç›˜æ–‡ä»¶çš„å¤§å°ï¼Œå…¶æœ€å¤§å€¼å¯ä»¥éå¸¸å¤§(264bit)ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ•°æ®åœ¨å†…å­˜ä¸Šçš„æ•°æ®ç»“æ„&#34;&gt;æ•°æ®åœ¨å†…å­˜ä¸Šçš„æ•°æ®ç»“æ„&lt;/h3&gt;
&lt;p&gt;æŒ‰éœ€å°†ç£ç›˜ä¸Šçš„æ•°æ®ä»¥Pageä¸ºå•ä½åŠ è½½åˆ°å†…å­˜ï¼Œä¸€ä¸ªpageæ ‘å°±æ˜¯ä¸€ä¸ªcheckpoint&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å†…å­˜é‡Œé¢B+TreeåŒ…å«ä¸‰ç§ç±»å‹çš„pageï¼Œå³rootpageï¼ˆæ ¹ç»“ç‚¹ï¼‰ã€internal pageï¼ˆéå¶å­ç»“ç‚¹ï¼‰å’Œleaf pageï¼ˆå¶å­ç»“ç‚¹ï¼‰ï¼Œå‰ä¸¤è€…åŒ…å«æŒ‡å‘å…¶å­é¡µçš„page indexæŒ‡é’ˆï¼Œä¸åŒ…å«é›†åˆä¸­çš„çœŸæ­£æ•°æ®ï¼Œleaf pageåŒ…å«é›†åˆä¸­çš„çœŸæ­£æ•°æ®å³keys/valueså’ŒæŒ‡å‘çˆ¶é¡µçš„homeæŒ‡é’ˆï¼›&lt;/p&gt;
&lt;p&gt;leaf pageè¿˜ç»´æŠ¤äº†ä¸‰ä¸ªæ•°ç»„ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;WT_ROWæ•°ç»„ï¼Œè¡¨ç¤ºä»ç£ç›˜åŠ è½½è¿›æ¥çš„æ•°æ®æ•°ç»„ï¼Œæ¯æ¡è®°å½•è¿˜æœ‰ä¸€ä¸ªcell_offsetå˜é‡ï¼Œè¡¨ç¤ºè¿™æ¡è®°å½•åœ¨pageä¸Šçš„åç§»é‡&lt;/li&gt;
&lt;li&gt;WT_UPDATEæ•°ç»„ï¼Œè®°å½•æ•°æ®åŠ è½½ä¹‹ååˆ°ä¸‹ä¸€ä¸ªcheckpointé—´è¢«ä¿®æ”¹çš„æ•°æ®ï¼Œæ¯æ¡è¢«ä¿®æ”¹çš„è®°å½•éƒ½æœ‰ä¸€ä¸ªæ•°ç»„å…ƒç´ å¯¹åº”ï¼Œå¤šæ¬¡ä¿®æ”¹æ—¶ï¼Œæ‰€æœ‰ä¿®æ”¹å€¼ä»¥é“¾è¡¨çš„å½¢å¼ä¿å­˜ï¼ˆMVCCï¼Œç›¸å½“äºå†…å­˜çº§åˆ«çš„oplogï¼‰&lt;/li&gt;
&lt;li&gt;WT_INSERT_HEADæ•°ç»„ï¼Œè¡¨ç¤ºæ•°æ®åŠ è½½ä¹‹ååˆ°ä¸‹ä¸€ä¸ªcheckpointé—´æ–°å¢çš„æ•°æ®ï¼Œæ¯ä¸ªæ’å…¥çš„æ•°æ®ä»¥è·³è¡¨çš„å½¢å¼ç»„æˆï¼Œæé«˜æ’å…¥æ•ˆç‡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;checkpointæœºåˆ¶&#34;&gt;checkpointæœºåˆ¶&lt;/h3&gt;
&lt;p&gt;checkpoint ç›¸å½“äºä¸€ä¸ªæ—¥å¿—ï¼Œè®°å½•ä¸Šæ¬¡checkpointåç›¸å…³æ•°æ®æ–‡ä»¶çš„å˜åŒ–ã€‚&lt;/p&gt;
&lt;h4 id=&#34;ä½œç”¨&#34;&gt;ä½œç”¨&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å‘ç”Ÿå†™æ“ä½œæ—¶ï¼Œåªæ˜¯å°†æ•°æ®å†™å…¥å†…å­˜å’Œjournalæ—¥å¿—ï¼Œç„¶åå†é€šè¿‡check pointæœºåˆ¶å°†å†…å­˜é‡Œé¢å‘ç”Ÿä¿®æ”¹çš„æ•°æ®å†™åˆ°æ•°æ®æ–‡ä»¶è¿›è¡ŒæŒä¹…åŒ–ä¿å­˜ï¼Œç¡®ä¿æ•°æ®ä¸€è‡´æ€§ï¼ŒåŒæ—¶ä¹Ÿé€šè¿‡å»¶è¿ŸæŒä¹…åŒ–çš„æ–¹å¼ï¼Œæå‡ç£ç›˜æ•ˆç‡ï¼›&lt;/p&gt;
&lt;p&gt;ä¹Ÿå°±æ˜¯è¯´ï¼Œcheckpointå¼€å§‹æ—¶ï¼Œåœ¨å½“å‰æ—¶é—´ç‚¹åˆ›å»ºå¿«ç…§ï¼ˆåŒæ—¶ä¹Ÿæœ‰å¯¹åº”çš„checkpointæ–‡ä»¶ï¼Œä½†æ˜¯å…¶è¯»å–é€Ÿåº¦æ˜¯æ¯”æ•°æ®æ–‡ä»¶å¿«çš„ï¼‰ï¼Œå†™æ“ä½œæ—¶ï¼Œå…ˆå†™journal bufferï¼ˆ100msæˆ–bufferåˆ°è¾¾100Måå†™å…¥journalæ—¥å¿—åˆ°ç£ç›˜ï¼‰åŒæ—¶æ›´æ–°å†…å­˜é‡Œçš„checkpointæ•°æ®ï¼Œç­‰åˆ°ä¸‹ä¸€æ¬¡æ‰§è¡Œcheckpointå‰ï¼Œå°†checkpointæ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œå˜æˆæ•°æ®æ–‡ä»¶ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å®ç°æ•°æ®åº“åœ¨æŸä¸ªæ—¶åˆ»æ„å¤–å‘ç”Ÿæ•…éšœï¼Œå†æ¬¡å¯åŠ¨æ—¶ï¼Œç›´æ¥è¯»å–checkpointæ–‡ä»¶ï¼ˆä¼šæ¯”è¯»æ•°æ®æ–‡ä»¶å¿«ï¼‰ï¼Œé…åˆjournalæ—¥å¿—æ¢å¤æ•°æ®ï¼Œç¼©çŸ­æ•°æ®åº“çš„æ¢å¤æ—¶é—´ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æœ‰ç‚¹åƒMySQLä¸­çš„change buffer + æŒä¹…åŒ–ï¼Œä¼˜åŒ–å†™æ“ä½œçš„é€Ÿåº¦å’Œæ•°æ®æŒä¹…åŒ–çš„ä¿è¯ã€‚&lt;/p&gt;
&lt;h4 id=&#34;è§¦å‘æ—¶æœº&#34;&gt;è§¦å‘æ—¶æœº&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;æŒ‰ä¸€å®šæ—¶é—´å‘¨æœŸï¼šé»˜è®¤60sï¼Œæ‰§è¡Œä¸€æ¬¡checkpointï¼Œæ‰€ä»¥DBå®•æœºé‡å¯åå¯ä»¥å¿«é€Ÿæ¢å¤60sä¹‹å‰çš„æ•°æ®ï¼Œé…åˆjournalæ—¥å¿—æ¢å¤60sä¹‹åçš„æ•°æ®ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æŒ‰ä¸€å®šæ—¥å¿—æ–‡ä»¶å¤§å°ï¼šå½“ journalæ—¥å¿—æ–‡ä»¶å¤§å°è¾¾åˆ°2GBï¼ˆå¦‚æœå·²å¼€å¯ï¼‰ï¼Œæ‰§è¡Œä¸€æ¬¡checkpointï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä»»ä½•æ‰“å¼€çš„æ•°æ®æ–‡ä»¶è¢«ä¿®æ”¹ï¼Œå…³é—­æ—¶å°†è‡ªåŠ¨æ‰§è¡Œä¸€æ¬¡checkpoint;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;æ‰§è¡Œæµç¨‹&#34;&gt;æ‰§è¡Œæµç¨‹&lt;/h4&gt;
&lt;p&gt;æ¯ä¸ªcheckpointåŒ…å«ä¸€ä¸ªroot pageã€ä¸‰ä¸ªæŒ‡å‘ç£ç›˜å…·ä½“ä½ç½®ä¸Špagesçš„åˆ—è¡¨ä»¥åŠç£ç›˜ä¸Šæ–‡ä»¶çš„å¤§å°ï¼Œé‡‡ç”¨copy on writeçš„æ–¹å¼ç®¡ç†å¢åˆ æ”¹ï¼Œå¢åˆ æ”¹æ“ä½œä¼šå…ˆç¼“å†²åœ¨cacheé‡Œï¼ŒæŒä¹…åŒ–æ—¶ï¼Œä¸ä¼šåœ¨åŸæ¥çš„å¶å­ç»“ç‚¹ä¸Šè¿›è¡Œï¼Œè€Œæ˜¯å†™å…¥æ–°åˆ†é…çš„pageï¼Œæ¯æ¬¡checkpointéƒ½ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„root pageã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/MongoDB_checkpoint.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/MongoDB_checkpoint.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/MongoDB_checkpoint_process.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/MongoDB_checkpoint_process.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;checkpointåˆ†æˆä¸¤ç±»ï¼Œä¸€ç±»æ˜¯å·²ç»æŒä¹…åŒ–åˆ°ç£ç›˜çš„ï¼Œå¦ä¸€ç±»æ˜¯å¤„äºå†…å­˜ä¸­çš„ï¼Œå¯èƒ½å‘ç”Ÿæ”¹å˜çš„live checkpointã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;ä¸Šæ’ä»–é”ï¼Œæ‰“å¼€é›†åˆæ–‡ä»¶ï¼Œè¯»å–æœ€æ–°çš„checkpointæ•°æ®ï¼›&lt;/p&gt;
&lt;p&gt;é›†åˆæ–‡ä»¶ä¼šæŒ‰checkponitæŒ‡å®šçš„å¤§å°è¢«æˆªå–ï¼Œsoå¦‚æœæ­¤æ—¶å‘ç”Ÿç³»ç»Ÿæ•…éšœï¼Œæ¢å¤æ—¶å¯èƒ½ä¼šä¸¢å¤±checkpointä¹‹åçš„æ•°æ®ï¼ˆå¦‚æœæ²¡æœ‰å¼€å¯journalï¼Œå¦‚æœæœ‰ï¼Œå°±å¯ä»¥é€šè¿‡journalæ—¥å¿—æ¥é‡æ”¾ï¼‰ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åœ¨å†…å­˜æ„é€ ä¸€æ£µåŒ…å«root pageçš„live treeï¼Œè¡¨ç¤ºå½“å‰å¯ä¿®æ”¹çš„checkpointç»“æ„ï¼Œç”¨æ¥è·Ÿè¸ªåé¢å†™æ“ä½œå¼•èµ·çš„æ–‡ä»¶å˜åŒ–ï¼Œå…¶ä»–å†å²çš„checkpointä¿¡æ¯åªèƒ½è¿›è¡Œè¯»æˆ–åˆ é™¤ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å†…å­˜é‡Œçš„pageéšç€è¢«å¢åˆ æ”¹åï¼Œå†™å…¥ç£ç›˜é‡ŒæŒ‰éœ€åˆ†é…çš„pageæ—¶ï¼Œä¼šä»live treeä¸­çš„availableåˆ—è¡¨ä¸­é€‰å–å¯ç”¨çš„pageä¾›å…¶ä½¿ç”¨ï¼Œéšåï¼Œè¿™ä¸ªæ–°çš„pageè¢«åŠ å…¥åˆ°checkpointçš„allocatedåˆ—è¡¨ä¸­ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¦‚æœä¸€ä¸ªcheckpointè¢«åˆ é™¤æ—¶ï¼Œå®ƒæ‰€åŒ…å«çš„allocatedå’Œdiscardedä¸¤ä¸ªåˆ—è¡¨ä¿¡æ¯å°†è¢«åˆå¹¶åˆ°æœ€æ–°checkpointå¯¹åº”çš„åˆ—è¡¨ä¸Šï¼Œä»»ä½•ä¸å†éœ€è¦çš„ç£ç›˜pagesï¼Œä¹Ÿä¼šå°†å…¶å¼•ç”¨æ·»åŠ åˆ°live treeçš„availabeåˆ—è¡¨ä¸­ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åˆ é™¤æ—§checkpointï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ ¹æ®æ­¤æ—¶çš„live treeç”Ÿæˆæ–°çš„checkpointï¼Œå½“æ–°çš„checkpointç”Ÿæˆæ—¶ï¼Œä¼šé‡æ–°åˆ·æ–°å…¶allocatedã€availableã€discardä¸‰ä¸ªåˆ—è¡¨ä¸­çš„ä¿¡æ¯ï¼Œå¹¶è®¡ç®—æ­¤æ—¶é›†åˆæ–‡ä»¶çš„å¤§å°ä»¥åŠroot pageçš„ä½ç½®ã€å¤§å°ã€check sumç­‰ä¿¡æ¯ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å°†æ–°ç”Ÿæˆçš„ä¿¡æ¯ä½œä¸ºcheckpointå…ƒä¿¡æ¯å†™å…¥ç£ç›˜ä¸­çš„æ–‡ä»¶ï¼›&lt;/p&gt;
&lt;p&gt;ç”Ÿæˆçš„checkponité»˜è®¤åä¸ºWiredTigerCheckpointï¼Œå¦‚æœä¸æ˜ç¡®æŒ‡å®šå…¶å®ƒåç§°ï¼Œåˆ™æ–°check pointå°†è‡ªåŠ¨å–ä»£ä¸Šä¸€æ¬¡ç”Ÿæˆçš„checkpointã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;äº‹åŠ¡å®ç°&#34;&gt;äº‹åŠ¡å®ç°&lt;/h3&gt;
&lt;p&gt;3.2ç‰ˆæœ¬æœ‰æ”¯æŒå•æ–‡æ¡£åŸå­æ“ä½œäº†ï¼Œä¸»è¦æ˜¯ç”¨åœ¨å•æ–‡æ¡£åµŒå¥—æ›´æ–°ä¸Šï¼Œé»˜è®¤è‡ªåŠ¨çš„ï¼›4.0ç‰ˆæœ¬æ”¯æŒå¤åˆ¶é›†å¤šæ–‡æ¡£äº‹åŠ¡ï¼Œ4.2ç‰ˆæœ¬æ”¯æŒåˆ†ç‰‡äº‹åŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;å¦å¤–ï¼ŒSpring 5.1.1 / SpringBoot 2.x ä»¥ä¸Š @Transactionalå¯ä»¥æ”¯æŒMongoï¼Œéœ€è¦ä¸ºTransactionManageræ³¨å…¥MongoDBFactory&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;MVCCï¼šä»¥æœ¬æ¬¡trancsaction_id + æœ¬æ¬¡ä¿®æ”¹åçš„valueç»„æˆä¸€ä¸ªç»“ç‚¹ï¼Œæ¯æ¬¡ä¿®æ”¹éƒ½ä¼šè¿½åŠ åˆ°é“¾è¡¨çš„å¤´éƒ¨ï¼Œæ¯æ¬¡è¯»å–æ—¶æ ¹æ®trancsaction_idå’Œæœ¬æ¬¡äº‹åŠ¡çš„snapshotæ¥æ‰¾åˆ°å¯¹åº”çš„å†å²ç‰ˆæœ¬ï¼Œè¯¥é“¾è¡¨æŒ‚åœ¨å¶å­ç»“ç‚¹çš„WT_UPDATEå­—æ®µä¸­ï¼›&lt;/li&gt;
&lt;li&gt;snapshotï¼šæ‹‰å–å½“å‰äº‹åŠ¡ä¹‹å‰çš„æ•°æ®å¿«ç…§ï¼Œç¡®å®šå½“å‰äº‹åŠ¡å“ªäº›æ•°æ®å¯è§ï¼Œå“ªäº›ä¸å¯è§ï¼Œç¡®å®šäº‹åŠ¡çŠ¶æ€ï¼›&lt;/li&gt;
&lt;li&gt;operation_arrayï¼šæœ¬æ¬¡äº‹åŠ¡ä¸­å·²æ‰§è¡Œçš„æ“ä½œåˆ—è¡¨ï¼Œç”¨äºäº‹åŠ¡å›æ»šï¼Œç±»ä¼¼MySQLçš„undo logï¼›&lt;/li&gt;
&lt;li&gt;journalæ—¥å¿—ï¼Œç›¸å½“äºredo logï¼Œå³ï¼šè®°å½•å½“å‰æ“ä½œï¼Œä¸€ä¸ªmongoDBå®ä¾‹ä¸­çš„æ‰€æœ‰DBå…±äº«journalæ–‡ä»¶ï¼›&lt;/li&gt;
&lt;li&gt;trancsaction_idï¼šå…¨å±€å”¯ä¸€äº‹åŠ¡idï¼Œé€šè¿‡casè‡ªå¢ç”Ÿæˆï¼›&lt;/li&gt;
&lt;li&gt;å…¨å±€äº‹åŠ¡ç®¡ç†å™¨ï¼šç®¡ç†ç³»ç»Ÿæ‰€æœ‰äº‹åŠ¡ï¼Œç”¨æ•°ç»„ä¿å­˜æ‰€æœ‰å†å²äº‹åŠ¡å¯¹è±¡transaction_arrayï¼Œç”¨äºsnapshotçš„åˆ›å»ºï¼Œæ‰«ætransaction_arrayæ—¶ä½¿ç”¨casä¿è¯å¹¶å‘å®‰å…¨ï¼›&lt;/li&gt;
&lt;li&gt;namespaceæ–‡ä»¶ï¼šé»˜è®¤å¤§å°ä¸º16Mï¼Œä¸»è¦ç”¨äºä¿å­˜é›†åˆã€ç´¢å¼•çš„å±æ€§ã€å‘½ä»¤ä¿¡æ¯ç­‰å­—æ®µï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;äº‹åŠ¡æ‰§è¡Œæµç¨‹&#34;&gt;äº‹åŠ¡æ‰§è¡Œæµç¨‹&lt;/h4&gt;
&lt;ol&gt;
&lt;li&gt;äº‹åŠ¡å¼€å¯ï¼šåˆ›å»ºäº‹åŠ¡å¯¹è±¡ï¼ŒåŠ å…¥å…¨å±€äº‹åŠ¡ç®¡ç†å™¨ï¼Œç¡®å®šäº‹åŠ¡çš„éš”ç¦»çº§åˆ«å’Œredo logçš„åˆ·ç›˜æ–¹å¼ï¼Œå¹¶å°†äº‹åŠ¡çŠ¶æ€è®¾ç½®ä¸º æ‰§è¡Œ ï¼Œå¦‚æœäº‹åŠ¡éš”ç¦»çº§åˆ«æ˜¯snapshot-Isolationï¼Œåˆ™åœ¨æœ¬æ¬¡äº‹åŠ¡æ‰§è¡Œå‰åˆ›å»ºä¸€ä¸ªsnapshotã€‚&lt;/li&gt;
&lt;li&gt;äº‹åŠ¡æ‰§è¡Œï¼šå¦‚æœæ˜¯è¯»æ“ä½œï¼Œåˆ™ä¸åšä»»ä½•è®°å½•ï¼›å¦‚æœæ˜¯å†™æ“ä½œï¼Œç”Ÿæˆtrancsaction_idï¼Œè®¾ç½®å½“å‰äº‹åŠ¡çŠ¶æ€ä¸ºHAS_TXN_IDï¼Œè®°å½•å½“å‰æ“ä½œï¼Œä¿å­˜åˆ°operation_arrayä¸­ï¼›è®°å½•ä¿®æ”¹è®°å½•å’Œtrancsaction_idï¼Œä¿å­˜mvccçš„é“¾è¡¨ä¸­ï¼›å†™å…¥ä¸€æ¡redo logåˆ°æœ¬åœ°äº‹åŠ¡å¯¹è±¡çš„redo_log_bufä¸­ã€‚&lt;/li&gt;
&lt;li&gt;äº‹åŠ¡æäº¤ï¼šå°†redo_log_bufä¸­çš„æ•°æ®å†™å…¥redo log fileæ—¥å¿—æ–‡ä»¶ä¸­ï¼Œå¹¶å°†redo log fileæŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œæ¸…é™¤æäº¤äº‹åŠ¡å¯¹è±¡çš„snapshotå¯¹è±¡ï¼Œä¿®æ”¹å½“å‰æäº¤çš„äº‹åŠ¡çš„transaction_idçŠ¶æ€ä¸ºWT_TNX_NONEï¼Œä¿è¯å…¶ä»–äº‹åŠ¡åœ¨åˆ›å»ºsnapshotæ—¶çœ‹åˆ°æœ¬æ¬¡äº‹åŠ¡çš„çŠ¶æ€æ˜¯å·²æäº¤&lt;/li&gt;
&lt;li&gt;äº‹åŠ¡å›æ»šï¼šéå†operation_arrayï¼Œå¯¹æ¯ä¸ªæ•°ç»„å•å…ƒå¯¹åº”updateçš„transaction_idçŠ¶æ€è®¾ç½®ä»¥ä¸ºWT_TXN_ABORTEDï¼Œæ ‡ç¤ºmvcc å¯¹åº”çš„ä¿®æ”¹å•å…ƒå€¼è¢«å›æ»šï¼Œåœ¨å…¶ä»–è¯»äº‹åŠ¡è¿›è¡Œmvccè¯»æ“ä½œçš„æ—¶å€™ï¼Œè·³è¿‡è¿™ä¸ªæ”¾å¼ƒçš„å€¼å³å¯&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å¤šæ–‡æ¡£äº‹åŠ¡é”™è¯¯å¤„ç†æœºåˆ¶ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å†™å†²çªï¼šå½“ä¸€ä¸ªäº‹åŠ¡å¼€å§‹åï¼Œå¦‚æœäº‹åŠ¡è¦ä¿®æ”¹çš„æ–‡æ¡£åœ¨äº‹åŠ¡å¤–éƒ¨è¢«ä¿®æ”¹è¿‡ï¼Œåˆ™äº‹åŠ¡ä¿®æ”¹è¿™ä¸ªæ–‡æ¡£æ—¶ä¼šè§¦å‘Aborté”™è¯¯ï¼Œå› ä¸ºæ­¤æ—¶çš„ä¿®æ”¹å­˜åœ¨å†²çªï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œäº‹åŠ¡ç»ˆæ­¢ï¼Œåº”ç”¨ç«¯éœ€è¦é‡åšäº‹åŠ¡ã€‚&lt;/li&gt;
&lt;li&gt;å†™ç­‰å¾…ï¼šå¦‚æœä¸€ä¸ªäº‹åŠ¡å·²ç»å¼€å§‹ä¿®æ”¹ä¸€ä¸ªæ–‡æ¡£ï¼Œåœ¨äº‹åŠ¡ä»¥å¤–å°è¯•ä¿®æ”¹åŒä¸€ä¸ªæ–‡æ¡£ï¼Œåˆ™äº‹åŠ¡ä»¥å¤–çš„ä¿®æ”¹ä¼šç­‰å¾…äº‹åŠ¡å®Œæˆæ‰èƒ½ç»§ç»­è¿›è¡Œã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;äº‹åŠ¡éš”ç¦»çº§åˆ«&#34;&gt;äº‹åŠ¡éš”ç¦»çº§åˆ«&lt;/h4&gt;
&lt;p&gt;ä¸åŒäºMySQLï¼ŒMongoDBçš„Wired Tigerçš„äº‹åŠ¡å‡åŸºäºsnapshotå®ç°äº†ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Read-Uncommitedï¼šæœªæäº¤è¯»ï¼Œäº‹åŠ¡å¼€å¯æ—¶ï¼Œå¯ä»¥è¯»åˆ°åˆ«çš„äº‹åŠ¡æœ€æ–°ä¿®æ”¹ä½†è¿˜æœªæäº¤çš„å€¼ï¼Œä¼šå‡ºç°è„è¯»ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Read-Commitedï¼šæäº¤è¯»ï¼Œé»˜è®¤ï¼Œäº‹åŠ¡å¼€å¯æ—¶ï¼Œåªèƒ½è¯»åˆ°åˆ«çš„äº‹åŠ¡æœ€æ–°ä¿®æ”¹ä¸”å·²æäº¤çš„å€¼ï¼Œè¿™ç§éš”ç¦»çº§åˆ«ä¸‹å¯èƒ½åœ¨ä¸€ä¸ªé•¿äº‹åŠ¡å¤šæ¬¡è¯»å–ä¸€ä¸ªå€¼æ—¶å‰åè¯»å–ä¸ä¸€è‡´ï¼Œå‡ºç°ä¸å¯é‡å¤è¯»ç°è±¡ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Snapshot-Isolationï¼šå¿«ç…§éš”ç¦»ï¼Œäº‹åŠ¡å¼€å¯æ—¶ï¼Œåªèƒ½è¯»åˆ°å½“å‰äº‹åŠ¡å‰æœ€åæäº¤çš„å€¼ï¼Œæ•´ä¸ªäº‹åŠ¡æœŸé—´åªèƒ½çœ‹åˆ°è¿™ä¸ªç‰ˆæœ¬çš„snapshotï¼Œä¸ç®¡è¿™ä¸ªå€¼åœ¨æ­¤æœŸé—´è¢«å…¶ä»–äº‹åŠ¡ä¿®æ”¹äº†å¤šå°‘æ¬¡ï¼Œé˜²æ­¢ä¸å¯é‡å¤è¯»ï¼›&lt;/p&gt;
&lt;p&gt;WTå¼•æ“ä¼šåœ¨å½“å‰äº‹åŠ¡ä¸‹ï¼Œæ‰§è¡Œæ¯ä¸€ä¸ªæ“ä½œå‰éƒ½å¯¹ç³»ç»Ÿä¸­çš„äº‹åŠ¡åšä¸€æ¬¡snapshotï¼Œç„¶ååœ¨è¿™ä¸ªsnapshotä¸Šè¯»å†™ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;é”&#34;&gt;é”&lt;/h4&gt;
&lt;p&gt;MongoDBæœ¬èº«æä¾›äº†ä¸‰ç§ç²’åº¦çš„é”ï¼šGlobalï¼ˆé”æ‰€æœ‰åº“ï¼‰ã€Databaseï¼ˆé”åº“ï¼‰ã€Collectionï¼ˆé”é›†åˆï¼‰ï¼ŒDocumentçº§åˆ«çš„é”ç”±å­˜å‚¨å¼•æ“æä¾›ï¼Œæ¯”å¦‚WiredTigeræœ‰æä¾›ï¼ŒMMapv1åˆ™æ²¡æœ‰ï¼›&lt;/p&gt;
&lt;p&gt;å½“æœ‰äº‹åŠ¡åŒæ—¶å¯¹åŒä¸€æ–‡æ¡£åšä¿®æ”¹æ—¶è¿˜æ˜¯ä¼šåŠ é”ï¼Œè¡Œé”çš„è§„åˆ™è·ŸMySQLç±»ä¼¼ï¼Œä¹Ÿæ˜¯åˆ†è¯»å†™é”å’Œæ„å‘è¯»å†™é”ï¼Œå¯¹documentå†™å…¥æ—¶ï¼Œå…ˆåŠ æ’ä»–é”ï¼Œå†åŠ æ„å‘é”ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å¯¹äºå¤§å¤šæ•°è¯»å†™æ“ä½œï¼ŒWiredTiger å­˜å‚¨å¼•æ“ä½¿ç”¨ä¹è§‚å¹¶å‘æ§åˆ¶ã€‚WiredTiger ä»…åœ¨å…¨å±€ï¼Œæ•°æ®åº“å’Œé›†åˆçº§åˆ«ä½¿ç”¨æ„å‘é”ã€‚å½“å­˜å‚¨å¼•æ“æ£€æµ‹åˆ°ä¸¤ä¸ªæ“ä½œä¹‹é—´çš„å†²çªæ—¶ï¼Œä¼šå‘ç”Ÿå†™å…¥å†²çªï¼Œå¯¼è‡´ MongoDB é€æ˜åœ°é‡è¯•è¯¥æ“ä½œã€‚ä¸€äº›å…¨å±€æ“ä½œ (é€šå¸¸æ˜¯æ¶‰åŠå¤šä¸ªæ•°æ®åº“çš„çŸ­æœŸæ“ä½œ) ä»ç„¶éœ€è¦å…¨å±€ â€œå®ä¾‹èŒƒå›´â€ é”å®šã€‚å…¶ä»–ä¸€äº›æ“ä½œï¼ˆä¾‹å¦‚åˆ é™¤é›†åˆï¼‰ä»éœ€è¦ç‹¬å æ•°æ®åº“é”ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;ä¸ºäº†è§£å†³å†™å†™å†²çªï¼Œå†™æ“ä½œå†™å…¥æ—¶ï¼Œä¼šåšæ ¡éªŒï¼Œç¡®ä¿ä»è¯»å¼€å§‹æ²¡æœ‰å…¶ä»–å†™æ“ä½œä¿®æ”¹ç›¸åº”æ•°æ®ã€‚å¦‚æœæœ‰äº†ä¿®æ”¹ï¼Œå°±é‡æ–°æ‰§è¡Œæ•´ä¸ªå†™æ“ä½œã€‚è¿™æ ·å°±å‡å°‘äº†èµ„æºè¢«é”ä½çš„æ—¶é—´ï¼Œæˆæœ¬æ˜¯å¤šä¸ªå†™æ“ä½œä¿®æ”¹ç›¸åŒæ•°æ®æ—¶ï¼Œæœ‰å¯èƒ½ä¼šå‘ç”Ÿå¤šæ¬¡é‡è¯•ã€‚å¯¹äºè¯»å¤šå†™å°‘ï¼Œå†™å†²çªå°‘çš„æƒ…å†µï¼Œè¿™ç§äº¤æ¢æ˜¯åˆé€‚çš„ã€‚è¿™ç§å¹¶å‘å¤„ç†æœºåˆ¶ç§°ä¸ºä¹è§‚å¹¶å‘æ§åˆ¶ï¼Œå³ä¹è§‚é”ã€‚å’Œæ‚²è§‚é”ç›¸æ¯”ï¼Œé€šè¿‡å¢åŠ æ ¡éªŒå’Œé‡è¯•æœºåˆ¶ï¼Œæ”¾å¼ƒäº†åœ¨æ•´ä¸ªè¿‡ç¨‹ä¸ŠåŠ é”ã€‚&lt;/p&gt;
&lt;p&gt;insertï¼šåº“çº§åˆ«çš„æ„å‘è¯»é”(r)ï¼Œè¡¨çº§åˆ«çš„æ„å‘è¯»é”(r)ï¼Œæ–‡æ¡£çº§åˆ«çš„è¯»é”(R)&lt;/p&gt;
&lt;p&gt;updateï¼šåº“çº§åˆ«çš„æ„å‘å†™é”(w)ï¼Œè¡¨çº§åˆ«çš„æ„å‘å†™é”(w)ï¼Œæ–‡æ¡£çº§åˆ«çš„å†™é”(W)&lt;/p&gt;
&lt;p&gt;foregroundæ–¹å¼åˆ›å»ºç´¢å¼•ï¼šåº“çº§åˆ«çš„å†™é”(W)&lt;/p&gt;
&lt;p&gt;backgroundæ–¹å¼åˆ›å»ºç´¢å¼•ï¼šåº“çº§åˆ«çš„æ„å‘å†™é”(w)ï¼Œè¡¨çº§åˆ«çš„æ„å‘å†™é”(w)&lt;/p&gt;
&lt;p&gt;é”æ˜¯å…¬å¹³é”ï¼Œæ‰€æœ‰çš„è¯·æ±‚ä¼šæ’é˜Ÿè·å–ç›¸åº”çš„é”ã€‚ä½†æ˜¯mongodbä¸ºäº†ä¼˜åŒ–ååé‡ï¼Œåœ¨æ‰§è¡ŒæŸä¸ªè¯·æ±‚æ—¶ï¼Œä¼šåŒæ—¶æ‰§è¡Œå’Œå®ƒç›¸å®¹çš„å…¶ä»–è¯·æ±‚ã€‚æ¯”å¦‚ä¸€ä¸ªè¯·æ±‚é˜Ÿåˆ—éœ€è¦çš„é”å¦‚ä¸‹ï¼Œæ‰§è¡ŒISè¯·æ±‚çš„åŒæ—¶ï¼Œä¼šåŒæ—¶æ‰§è¡Œå’Œå®ƒç›¸å®¹çš„å…¶ä»–Så’ŒISè¯·æ±‚ã€‚ç­‰è¿™ä¸€æ‰¹è¯·æ±‚çš„Sé”é‡Šæ”¾åï¼Œå†æ‰§è¡ŒXé”çš„è¯·æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ç§å¤„ç†æœºåˆ¶ä¿è¯äº†åœ¨ç›¸å¯¹å…¬å¹³çš„å‰æä¸‹ï¼Œæé«˜äº†ååé‡ï¼Œä¸ä¼šè®©æŸä¸€ç±»è¯·æ±‚é•¿æ—¶é—´çš„ç­‰å¾…ã€‚å¯¹äºé•¿æ—¶é—´çš„è¯»æˆ–è€…å†™æ“ä½œï¼ŒæŸäº›æ¡ä»¶ä¸‹ï¼Œmongodbä¼šä¸´æ—¶çš„è®©æ¸¡é”ï¼Œä»¥é˜²æ­¢é•¿æ—¶é—´çš„é˜»å¡ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4 id=&#34;äº‹åŠ¡æ—¥å¿—&#34;&gt;äº‹åŠ¡æ—¥å¿—&lt;/h4&gt;
&lt;p&gt;Wired Tigerå¼•æ“åœ¨ä¿è¯äº‹åŠ¡çš„æŒä¹…åŒ–å¯é æ€§ä¸Šé€šè¿‡redo logå®ç°ï¼Œåªè®°å½•äº‹åŠ¡è¿‡ç¨‹ä¸­å¯¹æ–‡æ¡£çš„ä¿®æ”¹ï¼Œä»¥è¿½åŠ çš„æ–¹å¼å†™å…¥wt_transactionå¯¹è±¡çš„redo_log_bufä¸­ï¼Œç­‰åˆ°äº‹åŠ¡æäº¤æ—¶å°†è¿™ä¸ªredo_log_bufä»¥åŒæ­¥çš„æ–¹å¼å†™å…¥WTçš„é‡åšæ—¥å¿—çš„ç£ç›˜æ–‡ä»¶ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœæ•°æ®åº“ç¨‹åºå‘ç”Ÿå¼‚å¸¸æˆ–è€…å´©æºƒï¼Œå¯ä»¥é€šè¿‡ä¸Šä¸€ä¸ªcheckpointçš„ä½ç½®é‡æ¼”ç£ç›˜ä¸Šè¿™ä¸ªç£ç›˜æ–‡ä»¶æ¥æ¢å¤å·²ç»æäº¤çš„äº‹åŠ¡æ¥ä¿è¯äº‹åŠ¡çš„æŒä¹…æ€§ã€‚&lt;/p&gt;
&lt;p&gt;WTå¼•æ“é€šè¿‡LSN(LogSequence Numberæ—¥å¿—åºåˆ—å·)æ¥ç®¡ç†redo logï¼Œredo logçš„æ“ä½œå¯¹è±¡å«logrecï¼Œå¯¹åº”æäº¤çš„äº‹åŠ¡ï¼Œæ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶bufferï¼Œäº‹åŠ¡çš„æ¯ä¸ªæ“ä½œè¢«è®°å½•æˆlogopå¯¹è±¡ï¼Œä¸€ä¸ªlogrecåŒ…å«å¤šä¸ªlogopï¼Œlogrecåœ¨åˆ·å…¥ç£ç›˜ä¹‹å‰ä¼šè¿›è¡Œç©ºé—´å‹ç¼©ã€‚&lt;/p&gt;
&lt;p&gt;redo logä»¥WALçš„æ–¹å¼å†™å…¥æ—¥å¿—ï¼Œå³äº‹åŠ¡è¿‡ç¨‹ä¸­æ‰€æœ‰çš„ä¿®æ”¹åœ¨æäº¤å‰éœ€è¦å°†å…¶å¯¹åº”çš„redo logå†™å…¥ç£ç›˜æ–‡ä»¶ï¼Œä¹‹åå†è¿›è¡Œäº‹åŠ¡æäº¤ï¼Œäº‹åŠ¡æ‰§è¡Œå®Œæˆã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†å‡å°‘æ—¥å¿—åˆ·ç›˜é¢‘ç¹æ“ä½œIOï¼Œå…¶åˆ·ç›˜é€»è¾‘ç±»ä¼¼MySQLï¼Œä¼šå°†åŒæ—¶å‘ç”Ÿçš„äº‹åŠ¡æ—¥å¿—åˆå¹¶åˆ°ä¸€ä¸ªslotbufferä¸­ï¼Œå…ˆå®Œæˆåˆå¹¶çš„äº‹åŠ¡çº¿ç¨‹ä¼šåŒæ­¥ç­‰å¾…ä¸€ä¸ªå®Œæˆåˆ·ç›˜ä¿¡å·ï¼Œæœ€åå®Œæˆæ—¥å¿—æ•°æ®åˆå¹¶çš„äº‹åŠ¡çº¿ç¨‹å°†slotbufferä¸­çš„æ‰€æœ‰æ—¥å¿—æ•°æ®syncåˆ°ç£ç›˜å¹¶é€šçŸ¥è¿™ä¸ªslotbufferä¸­ç­‰å¾…å…¶ä»–äº‹åŠ¡çº¿ç¨‹åˆ·ç›˜å®Œæˆã€‚å¹¶å‘äº‹åŠ¡çš„logrecåˆå¹¶åˆ°slotbufferé€šè¿‡casä¿è¯å¹¶å‘å®‰å…¨ã€‚&lt;/p&gt;
&lt;h4 id=&#34;äº‹åŠ¡æ¢å¤&#34;&gt;äº‹åŠ¡æ¢å¤&lt;/h4&gt;
&lt;blockquote&gt;
&lt;p&gt;äº‹åŠ¡çš„redo logä¸»è¦æ˜¯é˜²æ­¢å†…å­˜ä¸­å·²ç»æäº¤çš„äº‹åŠ¡ä¿®æ”¹ä¸¢å¤±ï¼Œä½†å¦‚æœæ‰€æœ‰çš„ä¿®æ”¹éƒ½å­˜åœ¨å†…å­˜ä¸­ï¼Œéšç€æ—¶é—´å’Œå†™å…¥çš„æ•°æ®è¶Šæ¥è¶Šå¤šï¼Œå†…å­˜å°±ä¼šä¸å¤Ÿç”¨ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦å°†å†…å­˜ä¸­çš„ä¿®æ”¹æ•°æ®å†™å…¥åˆ°ç£ç›˜ä¸Šï¼Œä¸€èˆ¬åœ¨WTä¸­æ˜¯å°†æ•´ä¸ªBTREEä¸Šçš„pageåšä¸€æ¬¡checkpointå¹¶å†™å…¥ç£ç›˜ã€‚&lt;/p&gt;
&lt;p&gt;WTä¸­çš„checkpointæ˜¯ä¸€ä¸ªappendæ–¹å¼ç®¡ç†çš„ï¼Œä¹Ÿå°±æ˜¯è¯´WTä¼šä¿å­˜å¤šä¸ªcheckpointç‰ˆæœ¬ã€‚ä¸ç®¡ä»å“ªä¸ªç‰ˆæœ¬çš„checkpointå¼€å§‹éƒ½å¯ä»¥é€šè¿‡é‡æ¼”redo logæ¥æ¢å¤å†…å­˜ä¸­å·²æäº¤çš„äº‹åŠ¡ä¿®æ”¹ã€‚æ•´ä¸ªé‡æ¼”è¿‡ç¨‹å°±æ˜¯å°±æ˜¯ç®€å•çš„å¯¹logrecä¸­å„ä¸ªæ“ä½œçš„æ‰§è¡Œã€‚è¿™é‡Œå€¼å¾—æä¸€ä¸‹çš„æ˜¯å› ä¸ºWTä¿å­˜å¤šä¸ªç‰ˆæœ¬çš„checkpointï¼Œé‚£å®ƒä¼šå°†checkpointåšä¸ºä¸€ç§å…ƒæ•°æ®å†™å…¥åˆ°å…ƒæ•°æ®è¡¨ä¸­ï¼Œå…ƒæ•°æ®è¡¨ä¹Ÿä¼šæœ‰è‡ªå·±çš„checkpointå’Œredo logï¼Œä½†æ˜¯ä¿å­˜å…ƒæ•°æ®è¡¨çš„checkpointæ˜¯ä¿å­˜åœ¨WiredTiger.wtæ–‡ä»¶ä¸­ï¼Œç³»ç»Ÿé‡æ¼”æ™®é€šè¡¨çš„æäº¤äº‹åŠ¡ä¹‹å‰ï¼Œå…ˆä¼šé‡æ¼”å…ƒæ•°æ®äº‹åŠ¡æäº¤ä¿®æ”¹ã€‚&lt;/p&gt;
&lt;p&gt;WTçš„redo logæ˜¯é€šè¿‡é…ç½®å¼€å¯æˆ–è€…å…³é—­çš„ï¼ŒMongoDBå¹¶æ²¡æœ‰ä½¿ç”¨WTçš„redologæ¥ä¿è¯äº‹åŠ¡ä¿®æ”¹ä¸ä¸¢ï¼Œè€Œæ˜¯é‡‡ç”¨äº†WTçš„checkpointå’ŒMongoDBå¤åˆ¶é›†çš„åŠŸèƒ½ç»“åˆæ¥ä¿è¯æ•°æ®çš„å®Œæ•´æ€§çš„ã€‚å¤§è‡´çš„ç»†èŠ‚æ˜¯å¦‚æœæŸä¸ªmongoDBå®ä¾‹å®•æœºäº†ï¼Œé‡å¯åé€šè¿‡MongoDBçš„å¤åˆ¶åè®®å°†è‡ªå·±æœ€æ–°checkpointåé¢çš„ä¿®æ”¹ä»å…¶ä»–çš„MongoDBå®ä¾‹å¤åˆ¶è¿‡æ¥ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;ç¼“å­˜å®ç°&#34;&gt;ç¼“å­˜å®ç°&lt;/h3&gt;
&lt;p&gt;WTå¼•æ“å†…éƒ¨ä½¿ç”¨&lt;strong&gt;LRU cacheä½œä¸ºç¼“å­˜æ¨¡å‹&lt;/strong&gt;ï¼Œé‡‡ç”¨åˆ†æ®µæ‰«æå’Œhazardpointerçš„æ·˜æ±°æœºåˆ¶ï¼Œå……åˆ†åˆ©ç”¨ç°ä»£è®¡ç®—æœºè¶…å¤§å†…å­˜å®¹é‡çš„ç‰¹æ€§æ¥æé«˜äº‹åŠ¡è¯»å†™å¹¶å‘ã€‚åœ¨é«˜é€Ÿä¸é—´æ–­å†™å…¥å†…å­˜æ“ä½œéå¸¸å¿«ï¼Œä½†æ˜¯ç”±äºå†…å­˜ä¸­çš„æ•°æ®æœ€ç»ˆéœ€è¦å†™å…¥ç£ç›˜ï¼Œå› ä¸ºå†™å†…å­˜çš„é€Ÿåº¦è¿œé«˜äºå†™ç£ç›˜ï¼Œæœ€ç»ˆå¯èƒ½å¯¼è‡´é—´æ­‡æ€§å†™æŒ‚èµ·çš„ç°è±¡å‡ºç°ã€‚&lt;/p&gt;
&lt;p&gt;WTå†…éƒ¨å°†å†…å­˜åˆ’åˆ†ä¸º3å—ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å­˜å‚¨å¼•æ“å†…éƒ¨çš„cacheï¼Œé»˜è®¤å¤§å°æ˜¯&lt;code&gt;MAX((RAM - 1G)/2, 256M)&lt;/code&gt;ï¼Œå³å¦‚æœ16Gï¼Œå°±ä¼šæœ‰7.5Gç»™WTå†…éƒ¨å½“cacheï¼›&lt;/li&gt;
&lt;li&gt;ç´¢å¼•cacheï¼Œé»˜è®¤500Mï¼›&lt;/li&gt;
&lt;li&gt;æ–‡ä»¶ç³»ç»Ÿcacheï¼Œåˆ©ç”¨çš„æ˜¯æ“ä½œç³»ç»Ÿçš„æ–‡ä»¶ç³»ç»Ÿç¼“å­˜ï¼Œç›®çš„æ˜¯å‡å°‘å†…å­˜ä¸ç£ç›˜çš„äº¤äº’ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å½“cacheç©ºé—´ä¸è¶³æ—¶ï¼Œä¼šè¿›è¡Œæ·˜æ±°ï¼Œæ·˜æ±°çš„æ—¶æœºç”±&lt;code&gt;eviction_targetï¼šå†…å­˜ä½¿ç”¨é‡&lt;/code&gt;å’Œ&lt;code&gt;eviction_dirty_targetï¼šå†…å­˜è„æ•°æ®é‡&lt;/code&gt;æ¥æ§åˆ¶ï¼Œè¶…è¿‡ä¸€å®šçš„é˜ˆå€¼åè§¦å‘ã€‚&lt;/p&gt;
&lt;p&gt;ç¼“è§£è¯»å†™æŒ‚èµ·çš„æ–¹æ³•ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;WT 2.8ç‰ˆæœ¬ä¸å†åˆ†ä¸ºé¢„å‰åˆ·ç›˜å’Œcheckpointåˆ·ç›˜ï¼Œè€Œæ˜¯é‡‡ç”¨é€ä¸ªå¯¹B+æ ‘ç›´æ¥åšcheckpointåˆ·ç›˜ï¼Œé¿å…evict pageçš„æ‹¥å µï¼Œç¼“è§£OS cacheç¼“å†²å¤ªå¤šçš„æ–‡ä»¶è„æ•°æ®é—®é¢˜&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨direct IO&lt;/li&gt;
&lt;li&gt;å¤šä¸ªç£ç›˜å­˜å‚¨ï¼Œredo logæ–‡ä»¶å•ç‹¬æ”¾åœ¨ä¸€ä¸ªç£ç›˜ä¸Šï¼Œæ•°æ®æ”¾åœ¨å¦å¤–çš„ç£ç›˜ä¸Šï¼Œé¿å…redo logå’Œcheckpointå‘ç”Ÿåˆ·ç›˜ç«äº‰&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨SSD&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;å¤åˆ¶é›†è¯»å†™å…³æ³¨&#34;&gt;å¤åˆ¶é›†è¯»å†™å…³æ³¨&lt;/h1&gt;
&lt;p&gt;mongoæ˜¯åˆ†å¸ƒå¼æ•°æ®åº“ï¼Œé€šè¿‡éƒ¨ç½²å¤šå¤åˆ¶é›†æ¥å®ç°ï¼Œå•ä¸ªMongoDB serverä¸æ”¯æŒå¤åˆ¶é›†è¯»å†™å…³æ³¨ï¼Œè‡³å°‘éœ€è¦ä¸€ä¸»ä¸€ä»ä¸¤ä¸ªã€‚&lt;/p&gt;
&lt;h2 id=&#34;åˆ†å¸ƒå¼ä¸‹çš„å†™æ“ä½œ&#34;&gt;åˆ†å¸ƒå¼ä¸‹çš„å†™æ“ä½œ&lt;/h2&gt;
&lt;p&gt;å¯¹äºäº‹åŠ¡å†…å¤šæ–‡æ¡£æ‰§è¡Œå†™æ“ä½œï¼Œä¿è¯åŸå­æ€§ï¼Œå¤±è´¥èƒ½å›æ»š&lt;/p&gt;
&lt;h3 id=&#34;writeconcernå‚æ•°&#34;&gt;writeConcernå‚æ•°&lt;/h3&gt;
&lt;p&gt;é€šè¿‡å‚æ•°writeConcernæ¥ä¿è¯å†™æ“ä½œåˆ°è¾¾å¤šå°‘ä¸ªèŠ‚ç‚¹æ‰ç®—æˆåŠŸï¼Œå†™æ“ä½œä¼šç­‰åˆ°å†™åˆ°å¤åˆ¶é›†åæ‰ä¼šè¿”å›&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ï¼šnosqlè¯­å¥é‡ŒåŒ…å«&lt;code&gt;{writeConcern: {w: 1, timeout: 3000}}&lt;/code&gt;ï¼Œå•ä½æ¯«ç§’ï¼Œè¶…æ—¶ä¸æ„å‘³ç€éƒ½å†™å¤±è´¥ï¼Œæœ‰å¯èƒ½å·²ç»å†™å…¥äº†ä¸€äº›èŠ‚ç‚¹äº†ï¼Œå†™æ“ä½œæ€§èƒ½ä¼šå–å†³äºèŠ‚ç‚¹çš„æ•°é‡ï¼Œä¼šå½±å“å†™å…¥çš„æ—¶é—´ï¼Œä½†å¯¹é›†ç¾¤ä¸ä¼šæœ‰å‹åŠ›&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é»˜è®¤å€¼ä¸º1ï¼Œè¡¨ç¤ºæ•°æ®è¢«å†™å…¥åˆ°ä¸€ä¸ªèŠ‚ç‚¹å°±ç®—æˆåŠŸ&lt;/li&gt;
&lt;li&gt;=[æ•°å­—x]ï¼Œè¡¨ç¤ºæ•°æ®è¢«å†™å…¥åˆ°xä¸ªèŠ‚ç‚¹å°±ç®—æˆåŠŸ&lt;/li&gt;
&lt;li&gt;=0ï¼Œè¡¨ç¤ºå‘å‡ºçš„å†™æ“ä½œï¼Œä¸å…³å¿ƒæ˜¯å¦æˆåŠŸ&lt;/li&gt;
&lt;li&gt;=majorityï¼ˆæ¨èï¼‰è¡¨ç¤ºå‘å‡ºçš„å†™æ“ä½œéœ€è¦å†™å…¥åˆ°å¤šæ•°å¤åˆ¶é›†ä¸Šæ‰ç®—æˆåŠŸï¼Œä¸€èˆ¬å†™æ“ä½œå†™å…¥ä¸»èŠ‚ç‚¹ï¼Œç”±ä¸»èŠ‚ç‚¹åŒæ­¥ç»™ä»èŠ‚ç‚¹&lt;/li&gt;
&lt;li&gt;=allï¼Œéœ€è¦å…¨éƒ¨èŠ‚ç‚¹ç¡®è®¤ï¼Œä½†å¦‚æœåŒæ­¥æ—¶æœ‰èŠ‚ç‚¹æŒ‚äº†ï¼Œæ­¤æ—¶å†™æ“ä½œä¼šè¢«é˜»å¡&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;journalå‚æ•°&#34;&gt;journalå‚æ•°&lt;/h3&gt;
&lt;p&gt;å†™æ“ä½œæ—¶ï¼Œä¼šæŒ‰æ“ä½œé¡ºåºå…ˆå†™åˆ°å†…å­˜ï¼Œå†å†™å…¥ç£ç›˜ï¼ˆjournalæ—¥å¿—æ–‡ä»¶å’Œæ•°æ®æ–‡ä»¶ï¼‰ï¼Œå‚æ•°journalå­—æ®µæ¥ä¿è¯è¾¾åˆ°å“ªæ­¥æ“ä½œæ‰ç®—æˆåŠŸï¼Œç”±é…ç½®æ–‡ä»¶é‡Œ&lt;code&gt;storage.journal.enabled&lt;/code&gt;æ§åˆ¶æ˜¯å¦å¼€å¯ï¼Œ&lt;code&gt;storage.journal.commitInternalMs&lt;/code&gt;å†³å®šåˆ·ç›˜æ—¶é—´é—´éš”&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ï¼šnosqlè¯­å¥é‡ŒåŒ…å« &lt;code&gt;{journal: {j: true}}&lt;/code&gt; ä¼šä¿è¯æ¯æ¬¡å†™å…¥éƒ½ä¼šè¿›è¡Œåˆ·ç›˜&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;=trueï¼Œè¡¨ç¤ºå†™æ“ä½œè¦è½åˆ°journalæ—¥å¿—æ–‡ä»¶æ‰ç®—æˆåŠŸ&lt;/li&gt;
&lt;li&gt;=falseï¼Œè¡¨ç¤ºå†™æ“ä½œåˆ°è¾¾å†…å­˜å°±ç®—æˆåŠŸ&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;journalæ—¥å¿—ä¸oplogæ—¥å¿—çš„åŒºåˆ«&#34;&gt;journalæ—¥å¿—ä¸oplogæ—¥å¿—çš„åŒºåˆ«&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;journalæ—¥å¿—ï¼šå³redo log &lt;strong&gt;ï¼Œç”±MongoDBå¼•æ“å±‚ä½¿ç”¨ï¼Œ&lt;strong&gt;ä¸»è¦ç”¨äºæ§åˆ¶å†™æ“ä½œæ˜¯å¦ç«‹å³æŒä¹…åŒ–&lt;/strong&gt;ï¼Œå› ä¸ºå¦‚æœå‘ç”Ÿå†™æ“ä½œï¼Œmongoä¸€èˆ¬æ˜¯å…ˆå°†å†™æ“ä½œå†™å…¥å†…å­˜ï¼Œåœ¨&lt;/strong&gt;å®šæ—¶ï¼ˆé»˜è®¤æ˜¯1åˆ†é’Ÿï¼‰é€šè¿‡check pointæœºåˆ¶å°†å†…å­˜é‡Œçš„æ•°æ®åˆ·ç›˜æŒä¹…åŒ–&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœå†™æ“ä½œçš„æˆåŠŸåˆ¤å®šå‡ºç°åœ¨å†™å®Œå†…å­˜åï¼Œå¦‚æœæ­¤æ—¶å®•æœºï¼Œå°†ä¼šä¸¢å¤±å†™æ“ä½œçš„è®°å½•ï¼Œå¦‚æœåˆ¤å®šå‘ç”Ÿåœ¨å†™å®Œjournalæ—¥å¿—ä¹‹åï¼Œå¦‚æœå®•æœºå¯ä»¥åˆ©ç”¨journalæ—¥å¿—è¿›è¡Œæ¢å¤ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å†™å…¥journalæ—¥å¿—æ—¶ï¼Œä¹Ÿæ˜¯å…ˆå†™å…¥å†…å­˜ï¼Œå†æ ¹æ®å†™å…¥bufferçš„å¤§å°ï¼ˆé»˜è®¤æ˜¯100Mï¼‰æˆ–è€… å®šæ—¶ï¼ˆé»˜è®¤æ˜¯100msï¼‰å†™å…¥ç£ç›˜ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;oplogæ—¥å¿—&lt;/strong&gt;ï¼šåªç”¨åœ¨ä¸»ä»å¤åˆ¶é›†çš„ä½¿ç”¨ï¼Œé€šè¿‡&lt;strong&gt;oplogæ¥å®ç°èŠ‚ç‚¹é—´çš„æ•°æ®åŒæ­¥&lt;/strong&gt;ï¼Œä»èŠ‚ç‚¹è·å–ä¸»èŠ‚ç‚¹çš„oplogæ—¥å¿—åè¿›è¡Œé‡æ”¾ï¼ŒåŒæ­¥æ•°æ®ã€‚oplogæœ¬èº«åœ¨MongoDBé‡Œæ˜¯ä¸€ä¸ªé›†åˆã€‚&lt;/p&gt;
&lt;p&gt;mongoçš„ä¸€æ¬¡å†™æ“ä½œï¼ŒåŒ…æ‹¬ 1.å°†æ–‡æ¡£æ•°æ®å†™è¿›é›†åˆï¼› 2.æ›´æ–°é›†åˆçš„ç´¢å¼•ä¿¡æ¯ï¼› 3.å†™å…¥oplogæ—¥å¿—ï¼Œï¼ˆæ­¤æ—¶åªæ˜¯å†™å…¥å†…å­˜ï¼‰ï¼Œè¿™ä¸‰ä¸ªæ­¥éª¤æ˜¯åŸå­æ€§çš„ï¼Œè¦ä¹ˆæˆåŠŸè¦ä¹ˆå¤±è´¥ã€‚ä¸€æ¬¡å†™æ“ä½œå¯ä»¥æ˜¯æ‰¹é‡çš„ä¹Ÿå¯ä»¥æ˜¯å•æ¡ï¼Œä¸€æ¬¡å†™æ“ä½œå¯¹åº”ä¸€æ¡journalæ—¥å¿—ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¼€å¯journalå’ŒwriteConcernåçš„æ•°æ®å†™å…¥é¡ºåº&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å†™æ“ä½œè¿›æ¥ï¼Œå…ˆå°†å†™æ“ä½œå†™å…¥journalç¼“å­˜ï¼Œå°†å†™æ“ä½œäº§ç”Ÿçš„æ•°æ®å†™å…¥æ•°æ®ç¼“å­˜ï¼Œå°†journalå†…å­˜é‡Œçš„å†™æ“ä½œæ—¥å¿—åŒæ­¥åˆ°oplogé‡Œï¼Œå¼‚æ­¥å“åº”ç»™å®¢æˆ·ç«¯ï¼›&lt;/li&gt;
&lt;li&gt;åå°çº¿ç¨‹æ£€æµ‹åˆ°æ—¥å¿—å˜åŒ–ï¼Œå°†oplogåŒæ­¥ç»™ä»èŠ‚ç‚¹ï¼›å¦å¤–ï¼Œåå°æ¯100msä¼šå°†journalç¼“å­˜é‡Œçš„æ—¥å¿—åˆ·ç›˜ï¼Œæ¯60så°†æ•°æ®ç¼“å­˜é‡Œçš„æ•°æ®åˆ·ç›˜&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;åˆ†å¸ƒå¼ä¸‹è¯»æ“ä½œ&#34;&gt;åˆ†å¸ƒå¼ä¸‹è¯»æ“ä½œ&lt;/h2&gt;
&lt;h3 id=&#34;readpreferenceå‚æ•°&#34;&gt;readPreferenceå‚æ•°&lt;/h3&gt;
&lt;p&gt;è¯»æ“ä½œæ—¶ï¼Œå†³å®šä½¿ç”¨é‚£ä¸€ä¸ªèŠ‚ç‚¹æ¥å¤„ç†è¯»è¯·æ±‚ï¼Œä¹Ÿå¯ä»¥é…åˆtagä½¿ç”¨ï¼Œæ¥æŒ‡å®šèŠ‚ç‚¹è®¿é—®&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ï¼šå¯ä»¥è®¾ç½®åœ¨è¿æ¥è¯­å¥é‡Œï¼Œé©±åŠ¨ç¨‹åºAPIï¼Œnosqlè¯­å¥+.readPref(&amp;ldquo;primary&amp;rdquo;)&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;=primaryï¼ˆé»˜è®¤ï¼Œæ¨èï¼‰ï¼Œåªé€‰æ‹©ä¸»èŠ‚ç‚¹&lt;/li&gt;
&lt;li&gt;=primaryPreferredï¼šä¼˜å…ˆé€‰æ‹©ä¸»èŠ‚ç‚¹ï¼Œä¸å¯ç”¨æ—¶ä½¿ç”¨ä»èŠ‚ç‚¹&lt;/li&gt;
&lt;li&gt;=secondaryï¼šåªé€‰æ‹©ä»èŠ‚ç‚¹ï¼Œä¸€èˆ¬ç”¨äºå†å²æ•°æ®æŸ¥è¯¢ï¼Œé’ˆå¯¹æ—¶æ•ˆæ€§ä½çš„æ•°æ®ï¼Œæˆ–è€…æŠ¥è¡¨æœåŠ¡çš„æ“ä½œ&lt;/li&gt;
&lt;li&gt;=secondaryPreferredï¼šä¼˜å…ˆé€‰æ‹©ä»èŠ‚ç‚¹ï¼Œä¸å¯ç”¨æ—¶é€‰æ‹©ä¸»èŠ‚ç‚¹&lt;/li&gt;
&lt;li&gt;=nearestï¼šé€‰æ‹©æœ€è¿‘èŠ‚ç‚¹ï¼Œæ ¹æ®ping timeå†³å®šï¼Œä¸€èˆ¬ç”¨äºå¼‚åœ°éƒ¨ç½²&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;readconcernå‚æ•°&#34;&gt;readConcernå‚æ•°&lt;/h3&gt;
&lt;p&gt;è¯»æ“ä½œæ—¶ï¼Œå†³å®šè¿™ä¸ªèŠ‚ç‚¹çš„æ•°æ®å“ªäº›æ˜¯å¯è¯»çš„ï¼Œ&lt;strong&gt;ç±»ä¼¼MySQLä¸­çš„éš”ç¦»&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ï¼šéœ€è¦åœ¨mongoçš„é…ç½®æ–‡ä»¶çš„serverå‚æ•°ä¸­ï¼Œå¢åŠ &lt;code&gt;enableMajorityReadConcern: true&lt;/code&gt;ï¼Œ&lt;/p&gt;
&lt;p&gt;å¯¹äºå€¼æšä¸¾ä¸ºavailableã€localã€majorityã€linearizableï¼Œéœ€è¦åœ¨æŸ¥è¯¢è¯­å¥å + .readConcern(&amp;ldquo;localæˆ–è€…å…¶ä»–æšä¸¾&amp;rdquo;)å¼€å¯ä½¿ç”¨ï¼›&lt;/p&gt;
&lt;p&gt;å¯¹äºsnapshotï¼Œåˆ™æ˜¯åœ¨å¼€å¯äº‹åŠ¡æ—¶æŒ‡å®šï¼Œ&lt;code&gt;var session = db.getMongo().startSession(); session.startTransaction({readConcern: {level: &amp;quot;snapshot&amp;quot;}, writeConcern: {w: &amp;quot;majority&amp;quot;}});&lt;/code&gt;  sessionä½œä¸ºäº‹åŠ¡å¯¹è±¡ï¼Œé…åˆsnapshotå¿«ç…§ã€MVCCã€redo logæ¥å®ç°äº‹åŠ¡ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;=availableï¼šè¯»å–æ‰€æœ‰å¯ç”¨æ•°æ®&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;=localï¼ˆé»˜è®¤ï¼‰ï¼šè¯»å–æ‰€æœ‰å¯ç”¨ä¸”å±äºå½“å‰åˆ†ç‰‡çš„æ•°æ®ï¼Œç±»ä¼¼availableï¼Œåªæ˜¯é™åˆ¶åœ¨åˆ†ç‰‡ä¸Šï¼Œ&lt;/p&gt;
&lt;p&gt;mongoä¸ºäº†å®ç°æ•°æ®å‡è¡¡ï¼Œæœ‰åˆ†ç‰‡chunkè¿ç§»æœºåˆ¶ï¼Œå½“åˆ†ç‰‡1å°†æ•°æ®è¿ç§»è‡³åˆ†ç‰‡2ï¼Œä½†è¿˜æ²¡è¿ç§»å®Œæˆæ—¶ï¼Œæ­¤æ—¶ä¸¤ä¸ªåˆ†ç‰‡éƒ½å­˜åœ¨è¯¥chunkæ•°æ®ï¼Œä½†æ˜¯æ­¤æ—¶è¯¥æ•°æ®ä»å±äºåˆ†ç‰‡1ï¼Œ=localæ—¶ä¸èƒ½è¯»åˆ°åˆ†ç‰‡2çš„è¯¥æ•°æ®ï¼Œ=availableæ—¶åˆ™å¯ä»¥&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;=majorityï¼šè¯»å–åœ¨å¤šæ•°èŠ‚ç‚¹ä¸Šæäº¤å®Œæˆçš„æ•°æ®ï¼Œé€šè¿‡MVCCæœºåˆ¶å®ç°ï¼Œ&lt;strong&gt;ä½œç”¨ç±»ä¼¼MySQLä¸­çš„æäº¤è¯»éš”ç¦»çº§åˆ«&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚ï¼Œå½“è¯»æ“ä½œæŒ‡å‘ä¸»èŠ‚ç‚¹ï¼Œä¸”å†™æ“ä½œå·²ç»åŒæ­¥åˆ°å¤šæ•°ä»èŠ‚ç‚¹æ—¶ï¼Œæ‰å¯ä»¥è¯»åˆ°è¯¥æ•°æ®ï¼›å½“è¯»æ“ä½œæŒ‡å‘ä¸€ä¸ªä»èŠ‚ç‚¹ï¼Œä¸”ä»èŠ‚ç‚¹å®Œæˆå†™æ“ä½œï¼Œä¸”é€šçŸ¥äº†ä¸»èŠ‚ç‚¹å¹¶å¾—åˆ°ä¸»èŠ‚ç‚¹çš„å“åº”æ—¶ï¼Œæ‰èƒ½è¯»åˆ°è¯¥æ•°æ®ã€‚&lt;/p&gt;
&lt;p&gt;ä½œç”¨ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä¸»è¦æ˜¯é˜²æ­¢åˆ†å¸ƒå¼æ•°æ®åº“è„è¯»ï¼Œè¿™é‡Œè„è¯»æŒ‡çš„æ˜¯ï¼Œåœ¨ä¸€æ¬¡å†™æ“ä½œåˆ°è¾¾å¤šæ•°èŠ‚ç‚¹å‰è¯»å–äº†è¿™ä¸ªå†™æ“ä½œï¼Œåˆç”±äºæ•…éšœä¹‹ç±»çš„å¯¼è‡´å†™æ“ä½œå›æ»šäº†ï¼Œæ­¤æ—¶è¯»åˆ°çš„æ•°æ®å°±ç®—è„è¯»ã€‚&lt;/li&gt;
&lt;li&gt;é…åˆ&lt;code&gt;writeConcern=majority&lt;/code&gt;æ¥å®ç°è¯»å†™åˆ†ç¦»ï¼Œå‘ä¸»èŠ‚ç‚¹å†™å…¥æ•°æ®ï¼Œä»èŠ‚ç‚¹ä¹Ÿèƒ½è¯»åˆ°æ•°æ®&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;=linearizableï¼šçº¿æ€§è¯»å–æ–‡æ¡£ï¼Œæ€§èƒ½è¾ƒå·®ï¼Œ&lt;strong&gt;ä½œç”¨ç±»ä¼¼MySQLä¸­çš„serializable(ä¸²è¡ŒåŒ–)éš”ç¦»çº§åˆ«&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;åªå¯¹è¯»å–å•ä¸ªæ–‡æ¡£æ—¶æœ‰æ•ˆï¼Œä¿è¯åœ¨å†™æ“ä½œå®Œæˆåä¸€å®šå¯ä»¥è¯»åˆ°ï¼Œä¸€æ¬¡è¯»æ“ä½œéœ€è¦æ‰€æœ‰èŠ‚ç‚¹å“åº”&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;=snapshotï¼šè¯»å–æœ€è¿‘å¿«ç…§ä¸­çš„æ•°æ®ï¼Œ&lt;strong&gt;ä½œç”¨ç±»ä¼¼MySQLä¸­çš„å¯é‡å¤è¯»éš”ç¦»çº§åˆ«&lt;/strong&gt;ï¼Œäº‹åŠ¡é»˜è®¤60sï¼Œéœ€è¦4.2çš„é©±åŠ¨ï¼Œä¼šå½±å“chunkè¿ç§»ï¼Œå¤šæ–‡æ¡£è¯»æ“ä½œå¿…é¡»ä½¿ç”¨ä¸»èŠ‚ç‚¹è¯»&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å…¨å±€äº‹åŠ¡ç®¡ç†å™¨é€šè¿‡è‡ªæ—‹åˆ›å»ºå¿«ç…§&lt;/li&gt;
&lt;li&gt;å®ç°åœ¨åŒä¸€äº‹åŠ¡ä¸‹è¯»å–åŒä¸€æ•°æ®çš„ä¸€è‡´æ€§ï¼Œä¹Ÿå¯ä»¥è¯»å–åŒä¸€äº‹åŠ¡å†…çš„å†™æ“ä½œï¼›&lt;/li&gt;
&lt;li&gt;å½“å¤šäº‹åŠ¡å†…å‡ºç°å†™æ“ä½œå†²çªæ—¶ï¼Œæ’åœ¨åé¢äº‹åŠ¡çš„å†™æ“ä½œä¼šå¤±è´¥ï¼Œè§¦å‘aborté”™è¯¯ï¼Œæ­¤æ—¶åªèƒ½æŠŠè¯¥äº‹åŠ¡æŠ›å¼ƒï¼Œå†é‡æ–°å¼€å§‹äº‹åŠ¡&lt;/li&gt;
&lt;li&gt;å½“äº‹åŠ¡å¤–å’Œäº‹åŠ¡å†…çš„å†™æ“ä½œå†²çªï¼Œäº‹åŠ¡å†…çš„å†™æ“ä½œæ—©äºäº‹åŠ¡å¤–çš„å†™æ“ä½œï¼Œäº‹åŠ¡å¤–çš„å†™æ“ä½œä¼šè¿›å…¥ç­‰å¾…ï¼Œç›´åˆ°äº‹åŠ¡å†…æäº¤ï¼Œæ‰ä¼šæ‰§è¡Œ&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;å¤åˆ¶é›†replica-setæœºåˆ¶&#34;&gt;å¤åˆ¶é›†Replica Setæœºåˆ¶&lt;/h1&gt;
&lt;p&gt;ä¸€èˆ¬æ˜¯ä¸€ä¸»å¤šä»ï¼Œæ‰€æœ‰å®ä¾‹å­˜å‚¨ç›¸åŒæ•°æ®&lt;/p&gt;
&lt;h2 id=&#34;ç‰¹ç‚¹-1&#34;&gt;ç‰¹ç‚¹&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;æ•°æ®åˆ†å‘ï¼Œå°†æ•°æ®ä»ä¸€ä¸ªåŒºåŸŸå¤åˆ¶åˆ°å¦ä¸€åŒºåŸŸï¼Œå‡å°‘å¦ä¸€åŒºåŸŸçš„è¯»å»¶æ—¶&lt;/li&gt;
&lt;li&gt;è¯»å†™åˆ†ç¦»&lt;/li&gt;
&lt;li&gt;å¼‚åœ°å®¹ç¾ï¼Œå¿«é€Ÿåˆ‡æ¢å¯ç”¨èŠ‚ç‚¹&lt;/li&gt;
&lt;li&gt;å¤åˆ¶é›†ä¸»è¦ç”¨äºå®ç°é«˜å¯ç”¨ï¼Œå¢åŠ å¤åˆ¶é›†çš„èŠ‚ç‚¹æ•°ç›®å¹¶ä¸ä¼šæå‡å†™æ€§èƒ½ï¼Œå› ä¸ºå†™æ“ä½œéƒ½å‘ç”Ÿåœ¨ä¸»èŠ‚ç‚¹ä¸Šï¼Œä½†å¯ä»¥æå‡è¯»æ€§èƒ½ã€‚æå‡æ€§èƒ½ä¸€èˆ¬æ˜¯ä½¿ç”¨åˆ†ç‰‡çš„æœºåˆ¶&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;èŠ‚ç‚¹åˆ†ç±»&#34;&gt;èŠ‚ç‚¹åˆ†ç±»&lt;/h2&gt;
&lt;p&gt;é™¤äº†å¸¸è§çš„ä¸»ä»èŠ‚ç‚¹ï¼ŒMongoDBè¿˜æ”¯æŒ ä»²è£èŠ‚ç‚¹ï¼Œåªç”¨äºé€‰ä¸¾æŠ•ç¥¨ï¼Œå…¶ä½œç”¨æ˜¯åœ¨å½“éƒ¨ç½²äº†å¶æ•°ä¸ªèŠ‚ç‚¹çš„å¤åˆ¶é›†æ—¶ï¼Œå°±ç®—æœ‰ä¸€å°èŠ‚ç‚¹å®•æœºï¼Œä¹Ÿèƒ½é€‰å‡ºä¸»èŠ‚ç‚¹ã€‚ä»²è£èŠ‚ç‚¹æœ¬èº«ä¸å­˜å‚¨æ•°æ®ï¼Œéå¸¸è½»é‡åŒ–ã€‚&lt;/p&gt;
&lt;p&gt;å¦å¤–ï¼Œä»èŠ‚ç‚¹ä¹Ÿå¯åˆ†åŒ–å‡ºå¦å¤–ä¸¤ç§èŠ‚ç‚¹&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Priority0ä»èŠ‚ç‚¹ï¼šä¸€èˆ¬ä½œä¸ºå¤‡ç”¨èŠ‚ç‚¹ï¼Œå½“æ— æ³•åœ¨åˆç†æ—¶é—´å†…æ·»åŠ æ–°æˆå‘˜èŠ‚ç‚¹æ—¶ï¼Œå®ç°æ›¿æ¢ä½œä¸ºè¿‡æ¸¡ï¼›priority0èŠ‚ç‚¹çš„é€‰ä¸¾ä¼˜å…ˆçº§ä¸º0ï¼Œè¡¨ç¤ºä¸ä¼šè¢«é€‰ä¸¾æˆä¸»èŠ‚ç‚¹ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;hiddenä»èŠ‚ç‚¹ï¼šéšè—èŠ‚ç‚¹ä¸ä¼šæ”¶åˆ°ä»»ä½•å†™è¯·æ±‚ï¼Œå³ä½¿è®¾ç½®ä¸ºå¤åˆ¶é›†è¯»é€‰é¡¹ï¼Œä¸€èˆ¬ç”¨äºæŠ¥è¡¨èŠ‚ç‚¹ã€å¤‡ä»½èŠ‚ç‚¹è¿›è¡Œæ•°æ®å¤‡ä»½ã€ç¦»çº¿è®¡ç®—ç­‰ä»»åŠ¡ï¼Œä¸å½±å“å¤åˆ¶é›†çš„å…¶ä»–æœåŠ¡ï¼›&lt;/p&gt;
&lt;p&gt;hiddenèŠ‚ç‚¹çš„priorityä¹Ÿæ˜¯0ï¼Œæ— æ³•è¢«é€‰ä¸ºä¸»èŠ‚ç‚¹ï¼Œå¯¹driverä¸å¯è§ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;delayä»èŠ‚ç‚¹ï¼šå»¶æ—¶èŠ‚ç‚¹ï¼ŒåŒæ—¶ä¹Ÿæ˜¯hiddenèŠ‚ç‚¹ï¼Œå…¶æ•°æ®ä¼šè½åäºä¸»èŠ‚ç‚¹ä¸€æ®µæ—¶é—´ï¼Œç”¨äºå¸®åŠ©æˆ‘ä»¬åœ¨äººä¸ºè¯¯æ“ä½œæˆ–å…¶ä»–æ„å¤–æƒ…å†µä¸‹è¿›è¡Œæ•°æ®æ¢å¤ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;é€‰ä¸¾æ—¶æœº&#34;&gt;é€‰ä¸¾æ—¶æœº&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;å¾€å¤åˆ¶é›†ä¸­åŠ å…¥æ–°èŠ‚ç‚¹&lt;/li&gt;
&lt;li&gt;åˆå§‹åŒ–å¤åˆ¶é›†&lt;/li&gt;
&lt;li&gt;å¯¹å¤åˆ¶é›†è¿›è¡Œç»´æŠ¤ï¼Œå¦‚&lt;code&gt;rs.stepDown(æ—¶é—´)ï¼Œåœ¨å¤šå°‘æ—¶é—´åå°†å½“å‰ä¸»åº“é™çº§&lt;/code&gt;æˆ–&lt;code&gt;rs.reconfig()é‡æ–°é…ç½®ç°æœ‰å¤åˆ¶é›†&lt;/code&gt;æ“ä½œæ—¶&lt;/li&gt;
&lt;li&gt;ä»èŠ‚ç‚¹å¤±è”ï¼Œé»˜è®¤è¶…æ—¶æ—¶é—´æ˜¯10s&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;æœºåˆ¶&#34;&gt;æœºåˆ¶&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å¤åˆ¶é›†ä¸­çš„æ•°æ®åŒæ­¥ï¼Œæœ‰ä¸¤ç§å½¢å¼ï¼šåˆå§‹åŒ–åŒæ­¥(Initial Sync)ï¼Œå³å…¨é‡åŒæ­¥ï¼›å¤åˆ¶(Replication)ï¼šå¢é‡åŒæ­¥ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¸€èˆ¬éƒ¨ç½²å¥‡æ•°ä¸ªå¤åˆ¶é›†ï¼Œè‡³å°‘ä¸‰ä¸ªï¼Œä¸”å‡è¦æœ‰æŠ•ç¥¨æƒï¼Œä¸€èˆ¬åˆ†ä¸ºä¸€ä¸ªä¸»èŠ‚ç‚¹ï¼Œç”¨äºæ¥å—å†™å…¥æ“ä½œå’Œé€‰ä¸¾æ—¶çš„æŠ•ç¥¨ï¼Œä¸¤ä¸ªä»èŠ‚ç‚¹ï¼Œå¤åˆ¶ä¸»èŠ‚ç‚¹ä¸Šçš„æ•°æ®å’Œé€‰ä¸¾æ—¶çš„æŠ•ç¥¨&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¸»èŠ‚ç‚¹ä¸Šæ‰€æœ‰çš„å†™æ“ä½œï¼Œä¼šè¢«è®°å½•åˆ°oplogæ—¥å¿—ä¸­ï¼Œä»èŠ‚ç‚¹é€šè¿‡åœ¨ä¸»èŠ‚ç‚¹ä¸Šæ‰“å¼€ä¸€ä¸ªtailableæ¸¸æ ‡ä¸æ–­è·å–æ–°è¿›å…¥ä¸»èŠ‚ç‚¹çš„oplogï¼Œè¿›è¡Œé‡æ”¾ï¼Œå®ç°ä¸ä¸»èŠ‚ç‚¹çš„æ•°æ®ä¸€è‡´ã€‚ï¼ˆå¼‚æ­¥ï¼‰&lt;/p&gt;
&lt;p&gt;oplog(æ“ä½œæ—¥å¿—)æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„æœ‰ä¸Šé™çš„é›†åˆ(è€çš„æ—¥å¿—ä¼šè¢«overwrite)ï¼Œå®ƒä¿å­˜æ‰€æœ‰ä¿®æ”¹æ•°æ®åº“ä¸­å­˜å‚¨çš„æ•°æ®çš„æ“ä½œçš„æ»šåŠ¨è®°å½•ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;é€šè¿‡é€‰ä¸¾å®ç°æ•…éšœæ¢å¤&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ¯ä¸¤ä¸ªèŠ‚ç‚¹é—´ æ¯2säº’å‘å¿ƒè·³ï¼Œ5æ¬¡å¿ƒè·³æœªæ”¶åˆ°æ—¶åˆ¤æ–­ä¸ºèŠ‚ç‚¹å¤±è”&lt;/li&gt;
&lt;li&gt;å½“ä¸»èŠ‚ç‚¹å¤±è”æ—¶ï¼Œä»èŠ‚ç‚¹å‘èµ·é€‰ä¸¾ï¼Œé€‰å‡ºæ–°çš„ä¸»èŠ‚ç‚¹ï¼Œå½“å¤±è”çš„æ˜¯ä»èŠ‚ç‚¹ï¼Œåˆ™ä¸ä¼šäº§ç”Ÿé€‰ä¸¾&lt;/li&gt;
&lt;li&gt;é€‰ä¸¾ç®—æ³•é‡‡ç”¨raftç®—æ³•&lt;/li&gt;
&lt;li&gt;å¤åˆ¶é›†æœ€å¤šå¯ä»¥æœ‰50ä¸ªèŠ‚ç‚¹ï¼Œä½†å…·æœ‰æŠ•ç¥¨æƒçš„èŠ‚ç‚¹æœ€å¤š7ä¸ª&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç”±äºä»èŠ‚ç‚¹æœ‰æœºä¼šæˆä¸ºä¸»èŠ‚ç‚¹ï¼Œæ‰€ä»¥æœ€å¥½ä¿è¯å¤šèŠ‚ç‚¹çš„ç‰ˆæœ¬ï¼Œé…ç½®ä¸Šä¿æŒä¸€è‡´&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;åˆ†ç‰‡æœºåˆ¶&#34;&gt;åˆ†ç‰‡æœºåˆ¶&lt;/h1&gt;
&lt;p&gt;åˆ†ç‰‡ä¸»è¦æ˜¯å¯¹åŒä¸€å®ä¾‹æ°´å¹³çš„æ¨ªå‘æ‰©å±•ï¼Œå°†åŸæœ¬ä¸€ä¸ªå®ä¾‹é‡Œçš„æ•°æ®æ‹†åˆ†å‡ºæ¥å¤šåˆ†ç‰‡å­˜å‚¨ï¼Œæœ€å¤šæ”¯æŒ1024ä¸ªåˆ†ç‰‡ï¼Œæ‰€ä»¥å®é™…ä¸Šæ˜¯æ‰€æœ‰åˆ†ç‰‡çš„æ•°æ®åŠ èµ·æ¥æ‰æ˜¯å®Œæ•´æ•°æ®ï¼Œæ¯ä¸€ä¸ªåˆ†ç‰‡ä¹Ÿæ˜¯ä¸€ä¸ªå¤åˆ¶é›†&lt;/p&gt;
&lt;h2 id=&#34;ç‰¹ç‚¹-2&#34;&gt;ç‰¹ç‚¹&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;æå‡è®¿é—®æ€§èƒ½ï¼Œé™ä½èŠ‚ç‚¹çš„å‹åŠ›ï¼Œå¯¹å¤–æä¾›åŒä¸€å…¥å£ï¼Œå±è”½å†…éƒ¨é›†ç¾¤éƒ¨ç½²ï¼Œé€šè¿‡åˆ†ç‰‡è·¯ç”±èŠ‚ç‚¹mongoså¯¹è¯·æ±‚åˆ†å‘åˆ°ä¸åŒçš„åˆ†ç‰‡ï¼Œä¹Ÿæœ‰è´Ÿè½½å‡è¡¡ã€‚åˆ†å‘çš„è§„åˆ™æ˜¯é€šè¿‡é…ç½®èŠ‚ç‚¹configServerå†³å®šï¼Œé…ç½®èŠ‚ç‚¹å­˜å‚¨äº†æ•°æ®ä¸åˆ†ç‰‡çš„æ˜ å°„ã€‚&lt;/p&gt;
&lt;p&gt;mongosã€configServerã€shardå‡ä»¥å¤åˆ¶é›†ä¸ºå•ä½ï¼Œéƒ¨ç½²å¤šä¸ªå¤åˆ¶é›†ï¼Œå®ç°é«˜å¯ç”¨&lt;/p&gt;
&lt;p&gt;shardï¼šåˆ†ç‰‡ï¼ŒçœŸæ­£çš„æ•°æ®å­˜å‚¨ä½ç½®ï¼Œä»¥chunkä¸ºå•ä½å­˜æ•°æ®ï¼Œæ¯ä¸ªåˆ†ç‰‡å¯éƒ¨ç½²ä¸ºä¸€ä¸ªå¤åˆ¶é›†&lt;/p&gt;
&lt;p&gt;mongosï¼šæŸ¥è¯¢è·¯ç”±ï¼Œæä¾›å®¢æˆ·ç«¯å’Œåˆ†ç‰‡é›†ç¾¤ä¹‹é—´çš„æ¥å£&lt;/p&gt;
&lt;p&gt;configServerï¼šå­˜å‚¨å…ƒæ•°æ®å’Œé…ç½®æ•°æ®&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ•°æ®å­˜å‚¨æ—¶ä¼šè‡ªåŠ¨å‡è¡¡ï¼Œå½“mongoå‘ç°æ•°æ®å­˜å‚¨åˆ†å¸ƒä¸å‡è¡¡æ—¶ï¼Œä¼šåšchunkè¿ç§»ï¼Œchunkçš„æ¦‚å¿µç±»ä¼¼MySQLä¸­çš„é¡µï¼Œä¸€ä¸ªchunkåŒ…å«å¤šä¸ªæ–‡æ¡£ = ä¸€é¡µä¸­åŒ…å«å¤šè¡Œè®°å½•&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;chunkçš„å¤§å°é»˜è®¤æ˜¯64Mï¼Œå¦‚æœè¶…è¿‡ï¼Œchunkä¼šè¿›è¡Œåˆ†è£‚ï¼Œå¦‚æœå•ä½æ—¶é—´å­˜å‚¨éœ€æ±‚å¾ˆå¤§ï¼Œå°±è®¾ç½®æ›´å¤§çš„chunkã€‚chunkçš„å¤§å°ä¼šå½±å“è¿ç§»çš„é€Ÿåº¦ï¼Œå°çš„chunkè¿ç§»é€Ÿåº¦å¿«ï¼Œæ•°æ®åˆ†é…å‡åŒ€ï¼Œä½†æ˜¯æ•°æ®åˆ†è£‚é¢‘ç¹ï¼Œè·¯ç”±èŠ‚ç‚¹æ¶ˆè€—èµ„æºæ›´å¤šï¼›å¤§çš„chunkåˆ†è£‚å°‘ï¼Œä½†æ˜¯è¿ç§»æ—¶æ›´è€—èµ„æºã€‚&lt;/li&gt;
&lt;li&gt;chunkçš„åˆ†è£‚å’Œè¿ç§»éå¸¸æ¶ˆè€—IOèµ„æºï¼›&lt;/li&gt;
&lt;li&gt;chunkåœ¨æ’å…¥å’Œæ›´æ–°æ—¶è¿›è¡Œåˆ†è£‚ï¼Œè¯»æ•°æ®ä¸ä¼šåˆ†è£‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ”¯æŒåŠ¨æ€æ‰©å®¹&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¯åŸºäºé›†åˆ(å³è¡¨)è¿›è¡Œåˆ†ç‰‡&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;è®¾è®¡åŸåˆ™&#34;&gt;è®¾è®¡åŸåˆ™&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;åˆ†ç‰‡æ¨¡å¼
&lt;ul&gt;
&lt;li&gt;åŸºäºèŒƒå›´ï¼šæ ¹æ®idæˆ–è€…å…¶ä»–å­—æ®µæŒ‰èŒƒå›´è¿›è¡Œåˆ†ç‰‡å­˜å‚¨ï¼Œæ¯ä¸€ä¸ªåˆ†ç‰‡çš„æ•°æ®ä¸Šæ˜¯ç›¸é‚»çš„ï¼Œä½†å¯èƒ½ä¼šå¯¼è‡´çƒ­ç‚¹æ•°æ®åˆ†å¸ƒä¸å‡&lt;/li&gt;
&lt;li&gt;åŸºäºå“ˆå¸Œï¼šæ ¹æ®æŒ‡å®šå­—æ®µè¿›è¡Œhashï¼Œæ•°æ®åˆ†å¸ƒå‡åŒ€ï¼Œä½†èŒƒå›´æŸ¥è¯¢æ•ˆç‡ä½&lt;/li&gt;
&lt;li&gt;åŸºäºåœ°åŸŸã€æ—¶æ•ˆã€tagåˆ†åŒº&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;åˆ†ç‰‡é”®çš„é€‰æ‹©æœ€å¥½é€‰æ‹©åŸºæ•°å¤§(æ¯”å¦‚idï¼ŒèŒƒå›´å¤§)ï¼Œåˆ†å¸ƒå‡åŒ€ï¼Œåœ¨æŸ¥è¯¢æ¡ä»¶ä¸­å¯ä»¥æ˜ç¡®å®šä½&lt;/li&gt;
&lt;li&gt;æ•°æ®é‡ä¸è¶…è¿‡3TBï¼Œå°½å¯èƒ½ä¿æŒ2TBä¸€ä¸ªåˆ†ç‰‡&lt;/li&gt;
&lt;li&gt;åˆ†ç‰‡çš„æ•°é‡æ ¹æ®å­˜å‚¨å®¹é‡ã€é›†åˆ(å³è¡¨)å’Œç´¢å¼•çš„å æ¯”ã€å¹¶å‘é‡ã€æ¥å†³å®šï¼Œ&lt;strong&gt;mongodbé»˜è®¤ä¼šä½¿ç”¨ç‰©ç†æœº60%çš„å†…å­˜æ¥&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;change-stream&#34;&gt;Change Stream&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ç±»ä¼¼MySQLä¸­çš„è§¦å‘å™¨ï¼Œä½†å®ƒæ˜¯å¼‚æ­¥çš„ï¼Œéäº‹åŠ¡ï¼Œå®ç°å˜æ›´è¿½è¸ªï¼Œåœ¨åº”ç”¨å›è°ƒä¸­è§¦å‘ï¼Œå¯åŒæ—¶è§¦å‘å¤šä¸ªè§¦å‘å™¨ï¼Œæ•…éšœåä¼šä»æ•…éšœç‚¹æ¢å¤æ‰§è¡Œï¼ˆæ•…éšœå‰ä¼šæ‹¿åˆ°idï¼Œé€šè¿‡idæ¥æ¢å¤ï¼‰&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åŸºäºoplogå®ç°ï¼Œåœ¨oplogä¸Šå¼€å¯tailable cursorè¿½è¸ªå¤åˆ¶é›†ä¸Šçš„å˜æ›´æ“ä½œï¼Œå¯è¿½è¸ªçš„äº‹ä»¶åŒ…æ‹¬ddlã€dmlè¯­å¥ï¼Œåœ¨ddlã€dmlè¯­å¥æ‰§è¡Œåè§¦å‘&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä½¿ç”¨æ—¶éœ€è¦å¼€å¯readConcernï¼Œä¸”è®¾ç½®read/writeConcernï¼šmajorityï¼Œåªæ¨é€å·²ç»åœ¨å¤§å¤šæ•°èŠ‚ç‚¹ä¸Šæäº¤çš„å˜æ›´æ“ä½œ&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä½¿ç”¨ï¼š&lt;code&gt;db.[å…·ä½“çš„collectionName].watch([...]).æ“ä½œå‡½æ•°&lt;/code&gt;ï¼Œå½“æ»¡è¶³watché‡Œçš„æ¡ä»¶æ—¶ä¼šè§¦å‘æ“ä½œæ–¹æ³•&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä½¿ç”¨åœºæ™¯ï¼šè·¨é›†ç¾¤å¤åˆ¶ã€å¾®æœåŠ¡å˜æ›´æ•°æ®åº“æ—¶é€šçŸ¥å…¶ä»–å¾®æœåŠ¡&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;å¤‡ä»½å’Œæ¢å¤&#34;&gt;å¤‡ä»½å’Œæ¢å¤&lt;/h1&gt;
&lt;p&gt;å¤‡ä»½ä¸»è¦æ˜¯ä¸ºäº†é˜²æ­¢è¯¯æ“ä½œï¼Œä¸€ä¸ªèŠ‚ç‚¹çš„è¯¯æ“ä½œä¼šåŒæ­¥åˆ°å…¶ä»–èŠ‚ç‚¹ï¼Œå¤‡ä»½åŒæ—¶ä¹Ÿå¯ä»¥è¿›è¡Œæ•°æ®å›æº¯&lt;/p&gt;
&lt;h2 id=&#34;å¤‡ä»½æ–¹æ¡ˆ&#34;&gt;å¤‡ä»½æ–¹æ¡ˆ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å»¶è¿ŸèŠ‚ç‚¹å¤‡ä»½ï¼Œé€šè¿‡è®¾ç½®ä¸€ä¸ªå»¶è¿ŸèŠ‚ç‚¹ï¼Œæ¯”å¦‚è®©å…¶ä¸ä¸»èŠ‚ç‚¹çš„å­˜å‚¨å·®è·å»¶è¿Ÿä¸€ä¸ªå°æ—¶çš„æ•°æ®é‡ï¼Œé€šè¿‡oplog + oplog windowé‡æ”¾å®ç°&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å…¨é‡å¤‡ä»½ï¼Œæ•°æ®æ–‡ä»¶å¿«ç…§(ä¸€èˆ¬æ˜¯æŸä¸ªæ—¶é—´ç‚¹) + oplog(è¯¥æ—¶é—´ç‚¹ä¹‹åæ“ä½œæ—¥å¿—è®°å½•)å®ç°&lt;/p&gt;
&lt;p&gt;&lt;code&gt;mongodump -h [éœ€è¦å¤‡ä»½çš„mongoå®ä¾‹çš„host:port] -d [æ•°æ®åº“åç§°] -o [å¤‡ä»½å­˜æ”¾è·¯å¾„]&lt;/code&gt;å‘½ä»¤ä¿å­˜æ•°æ®å¿«ç…§&lt;/p&gt;
&lt;p&gt;æ¢å¤ï¼š&lt;code&gt;mongorestore -h [ç›®æ ‡Mongoå®ä¾‹çš„host:port] -d [æ•°æ®åº“å®ä¾‹åç§°] [[å¿«ç…§æ‰€åœ¨çš„è·¯å¾„]| -dir [å¿«ç…§æ‰€åœ¨çš„è·¯å¾„]]&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;ç›‘æ§&#34;&gt;ç›‘æ§&lt;/h1&gt;
&lt;p&gt;ä¸€èˆ¬ä½¿ç”¨mongodbçš„ops managerï¼Œæˆ–è€…grafanaå®ç°&lt;/p&gt;
&lt;h2 id=&#34;ç›‘æ§æŒ‡æ ‡&#34;&gt;ç›‘æ§æŒ‡æ ‡&lt;/h2&gt;
&lt;p&gt;é€šè¿‡&lt;code&gt;db.serverStatus()&lt;/code&gt;æ–¹æ³•æ¥è·å–æŒ‡æ ‡ï¼ŒserverStatusæ–¹æ³•è®°å½•çš„æ˜¯è‡ªmongoå¯åŠ¨ä»¥æ¥çš„æŒ‡æ ‡æ•°æ®ï¼Œå¸¸è§æŒ‡æ ‡æœ‰å¾ˆå¤šï¼Œä¸€èˆ¬ä¼šå…³æ³¨ä¸‹é¢å‡ ä¸ª&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;connectionsï¼šè¿æ¥æ•°ä¿¡æ¯&lt;/li&gt;
&lt;li&gt;locksï¼šmongoDBä½¿ç”¨é”çš„æƒ…å†µ&lt;/li&gt;
&lt;li&gt;networkï¼šç½‘ç»œä½¿ç”¨æƒ…å†µç»Ÿè®¡&lt;/li&gt;
&lt;li&gt;opcontersï¼šCURDæ‰§è¡Œæ¬¡æ•°ç»Ÿè®¡&lt;/li&gt;
&lt;li&gt;replï¼šå¤åˆ¶é›†é…ç½®ä¿¡æ¯&lt;/li&gt;
&lt;li&gt;menï¼šå†…å­˜ä½¿ç”¨æƒ…å†µ&lt;/li&gt;
&lt;li&gt;scan and orderï¼šæ¯ç§’å†…å­˜æ’åºæ“ä½œçš„å¹³å‡æ¯”ä¾‹&lt;/li&gt;
&lt;li&gt;oplog windowï¼šä»£è¡¨oplogå¯å®¹çº³å¤šé•¿æ—¶é—´çš„æ“ä½œï¼Œè¡¨ç¤ºä»èŠ‚ç‚¹å¯ä»¥ç¦»çº¿å¤šä¹…åå¯ä»¥è¿½ä¸Šä¸»èŠ‚ç‚¹çš„æ•°æ®&lt;/li&gt;
&lt;li&gt;wiredTigerï¼šåŒ…å«å¤§é‡WirdTigerå¼•æ“æ‰§è¡Œæƒ…å†µçš„ä¿¡æ¯ï¼Œå¦‚block-managerï¼šWTæ•°æ®å—çš„è¯»å†™æƒ…å†µï¼Œsessionï¼šsessionä½¿ç”¨é‡ï¼ŒconcurrentTransactionsï¼šticketä½¿ç”¨æƒ…å†µ&lt;/li&gt;
&lt;li&gt;metricsï¼šä¸€ç³»åˆ—æŒ‡æ ‡ç»Ÿè®¡ä¿¡æ¯&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h1&gt;
&lt;p&gt;æå®¢æ—¶é—´ - mongodbé«˜æ‰‹è¯¾&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.cnblogs.com/wujuntian/p/8431674.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;MongoDBå­˜å‚¨å¼•æ“ï¼ˆä¸Šï¼‰â€”â€”MMAPv1&lt;/a&gt;&lt;/p&gt;
</description>
        </item>
        <item>
        <title>è‹±è¯­å­¦ä¹ æ€»ç»“</title>
        <link>http://nixum.cc/p/%E8%8B%B1%E8%AF%AD%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/</link>
        <pubDate>Fri, 23 Jun 2023 00:00:00 +0000</pubDate>
        
        <guid>http://nixum.cc/p/%E8%8B%B1%E8%AF%AD%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/</guid>
        <description>&lt;p&gt;[TOC]&lt;/p&gt;
&lt;h1 id=&#34;æ–¹æ³•è®º&#34;&gt;æ–¹æ³•è®º&lt;/h1&gt;
&lt;p&gt;æ•´ä½“å‚è€ƒè§†é¢‘ï¼š&lt;a class=&#34;link&#34; href=&#34;https://www.bilibili.com/video/BV1ZM4y1J748&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;è‡ªå­¦è‹±è¯­é›¶åŸºç¡€åˆ°ä¸­é«˜çº§ï¼è¶…è¯¦ç»†å­¦ä¹ æŒ‡å—ï¼&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;åˆå­¦&#34;&gt;åˆå­¦&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;æ‰¾æ ¸å¿ƒå­¦ä¹ èµ„æ–™ï¼ˆ50%ï¼‰ï¼Œã€Šèµ°è¿›ç¾å›½ã€‹ã€ã€Šæ¯æ—¥è‹±è¯­å¬åŠ›ã€‹ã€Šæ–°æ¦‚å¿µä¸€å†Œï¼ŒLeoè€å¸ˆã€‹ã€Šæ¬§é™†è¯å…¸ã€‹&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è¾¹å¬è¾¹çœ‹æ–‡æœ¬çƒ­èº«&lt;/li&gt;
&lt;li&gt;æŸ¥è¯å­¦è¯­æ³•ç‚¹&lt;/li&gt;
&lt;li&gt;é€å¥åå¤è·Ÿè¯»&lt;/li&gt;
&lt;li&gt;åŸé€Ÿè·Ÿè¯»&lt;/li&gt;
&lt;li&gt;é®ç›–åŸæ–‡åŸé€Ÿå¬&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;èƒŒå•è¯ï¼ˆ25%ï¼‰&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨è¯­å¢ƒä¸‹èƒŒå•è¯&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¬è¯´è®­ç»ƒï¼ˆ25%ï¼‰&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å‘éŸ³ã€éŸ³æ ‡è¯¾ã€ŠBBC learn all 44 engilsh soundsã€‹
éŸ³-è¯-å¥ï¼Œæ³›å¬ï¼ˆè¯­éŸ³è¯­è°ƒã€æŠ“å•è¯ã€é‡å¤ï¼‰&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¯åˆ©ç”¨ åšæ ‘ï¼Œå¤šé‚»å›½ï¼Œ&lt;a class=&#34;link&#34; href=&#34;https://www.usespeak.com/zh-tw&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;speak&lt;/a&gt;ã€&lt;a class=&#34;link&#34; href=&#34;https://callannie.ai/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;call annie&lt;/a&gt;ã€&lt;a class=&#34;link&#34; href=&#34;https://talkface.ai/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;talkface&lt;/a&gt;ã€&lt;a class=&#34;link&#34; href=&#34;https://apps.apple.com/cn/app/ainder-%E5%92%8Cai%E7%BB%83%E9%9B%85%E6%80%9D%E5%8F%A3%E8%AF%AD-%E8%99%9A%E6%8B%9F%E8%B0%88%E6%81%8B%E7%88%B1/id6450455171&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Ainder&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ‘¸é±¼æ—¶è¿›è¡Œæ³›å¬ï¼Œæ³¡è€³æœµï¼Œå¹³æ—¶æ²¡äº‹å¤š&lt;strong&gt;å¬&lt;/strong&gt;æˆ–è€…&lt;strong&gt;è·Ÿè¯»&lt;/strong&gt;æ–°æ¦‚å¿µçš„éŸ³é¢‘ï¼Œä¸»è¦æ˜¯ç”¨æ¥æå‡è¯­éŸ³ã€è¯­è°ƒã€è¯­é€Ÿã€å˜éŸ³ï¼Œåœ¨æ­¤è¿‡ç¨‹ä¸­è¦å¤šæ³¨æ„é‡Œé¢çš„å•è¯ï¼Œè¯­æ³•çš„ä¹ æƒ¯ç”¨æ³•&lt;/p&gt;
&lt;p&gt;è·Ÿè¯»æ—¶ï¼Œå¬ä¸€å¥ï¼Œè¯»ä¸€å¥ï¼Œå°½å¯èƒ½çš„æ¨¡ä»¿ï¼Œç›´åˆ°æ»¡æ„&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;éœ€è¦è®¾å®šç›®æ ‡ï¼šé•¿æœŸç›®æ ‡ -&amp;gt; ä¸­æœŸ -&amp;gt; çŸ­æœŸï¼Œç›®çš„æ˜¯æ§åˆ¶å­¦ä¹ é‡&lt;/p&gt;
&lt;h3 id=&#34;å…·ä½“è®¡åˆ’&#34;&gt;å…·ä½“è®¡åˆ’&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;æ ¸å¿ƒå­¦ä¹ èµ„æ–™-30åˆ†é’Ÿ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ–°æ¦‚å¿µè‹±è¯­ä¸€å†Œï¼Œä¸€èŠ‚æˆ–åŠèŠ‚ï¼Œæ­é…leoè§†é¢‘&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;èƒŒå•è¯ - 15åˆ†é’Ÿ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ã€Šæ¬§è·¯è¯å…¸ã€‹ã€Šæ–°æ¦‚å¿µä¸€å†Œã€äºŒå†Œã€‹è¯åº“&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¬ä¹¦è®­ç»ƒ - 15åˆ†é’Ÿ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;é˜¶æ®µä¸€ï¼šè‹±è¯­å…” éŸ³æ ‡ä¸“æ”»ï¼Œä¸€å¤©2-4ä¸ªå‘éŸ³&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;é˜¶æ®µäºŒï¼šä¸€é›†english podæ’­å®¢ï¼Œæˆ–ä¸€é›†ã€Šè·Ÿç€lucyå­¦è‹±è¯­ã€‹&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è¯­æ³•ä¸“æ”» - 20åˆ†é’Ÿ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ã€Šå‰‘æ¡¥è¯­æ³•ã€‹ç»ƒä¹ åŠè§†é¢‘&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å£è¯­ç»ƒä¹ -30åˆ†é’Ÿ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åˆ©ç”¨ã€Šcamblyã€‹app å¤–æ•™è¯¾ï¼Œã€Šè¯­ä¼´ã€‹app&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;ä¸­çº§&#34;&gt;ä¸­çº§&lt;/h2&gt;
&lt;p&gt;å¤§é‡å¬è¯´è¯»ï¼Œçœ‹è§†é¢‘ã€æœ‰å£°ä¹¦ã€tedç­‰ï¼Œåªçœ‹è‹±æ–‡å­—å¹•&lt;/p&gt;
&lt;h2 id=&#34;å•è¯å­¦ä¹ &#34;&gt;å•è¯å­¦ä¹ &lt;/h2&gt;
&lt;p&gt;å¯¹äºå•è¯çš„å­¦ä¹ ï¼Œå°è¯•å»é€ å¥&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å­¦ä¼šå•è¯çš„å½¢æ€å˜åŒ–ï¼Œæ¯”å¦‚å¯¹äºåŠ¨è¯ + åŠ¨è¯çš„å˜åŒ–ï¼Œæ—¶æ€çš„å˜åŒ–&lt;/li&gt;
&lt;li&gt;å››å¥å‹è½¬æ¢ï¼Œè‚¯å®šå¥ï¼Œå¦å®šå¥ï¼Œä¸€èˆ¬ç–‘é—®å¥ï¼Œç‰¹æ®Šç–‘é—®å¥&lt;/li&gt;
&lt;li&gt;æ–¹å¼ / åœ°ç‚¹ / æ—¶é—´&lt;/li&gt;
&lt;li&gt;ç»“åˆä¹ æƒ¯ç”¨æ³•&lt;/li&gt;
&lt;li&gt;å…¶ä»–å•è¯ + è¯æ€§ï¼Œæ ¹æ®è¯æ€§å»åšç»„åˆ&lt;/li&gt;
&lt;li&gt;åŸæ–‡æ‘˜æŠ„ + å˜æ¢&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä»¥ private ä¸ºä¾‹ï¼Œ&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ç»“åˆå…¶ä»–å•è¯ï¼Œæ¯”å¦‚æœ‰ private schoolã€private lifeã€private hospital&lt;/li&gt;
&lt;li&gt;ç»“åˆçŸ­è¯­ï¼Œæ¯”å¦‚ go to a private school&lt;/li&gt;
&lt;li&gt;é€ å¥ï¼Œè¿›è¡Œå››å¥å‹è½¬æ¢ï¼Œæ¯”å¦‚
&lt;ul&gt;
&lt;li&gt;He goes to a private school.&lt;/li&gt;
&lt;li&gt;Does he go to a private school?&lt;/li&gt;
&lt;li&gt;Why does he go to a private school?&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;ç®€å•é€ å¥&#34;&gt;ç®€å•é€ å¥&lt;/h2&gt;
&lt;p&gt;è¦æœ‰ä¸»è¯­ï¼Œæœ‰åŠ¨è¯ï¼ˆåŠ¨è¯è¦æœ‰å˜åŒ–ï¼‰ï¼ŒåŠ å½¢å®¹è¯/å‰¯è¯ï¼ŒåŠ åœ°ç‚¹ï¼ŒåŠ æ—¶é—´ï¼Œè¯­åºå‚è€ƒä¸‹é¢çš„è¡¨æ ¼&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æ—¶é—´&lt;!-- raw HTML omitted --&gt;When&lt;/th&gt;
&lt;th&gt;ä¸»è¯­&lt;!-- raw HTML omitted --&gt;Whoã€Whichã€What&lt;/th&gt;
&lt;th&gt;è°“è¯­&lt;!-- raw HTML omitted --&gt;è¡Œä¸ºï¼ŒåŠ¨è¯+åŠ¨è¯å˜åŒ–&lt;/th&gt;
&lt;th&gt;å®¾è¯­&lt;!-- raw HTML omitted --&gt;Whoã€Whichã€What&lt;/th&gt;
&lt;th&gt;æ–¹å¼&lt;!-- raw HTML omitted --&gt;Howã€å‰¯è¯&lt;/th&gt;
&lt;th&gt;åœ°ç‚¹&lt;!-- raw HTML omitted --&gt;Where&lt;/th&gt;
&lt;th&gt;æ—¶é—´&lt;!-- raw HTML omitted --&gt;When&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;A cute woman&lt;/td&gt;
&lt;td&gt;is shouting&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;angrily&lt;/td&gt;
&lt;td&gt;in her car&lt;/td&gt;
&lt;td&gt;at midnight&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h1 id=&#34;ä¹ æƒ¯ç”¨æ³•&#34;&gt;ä¹ æƒ¯ç”¨æ³•&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;æ„Ÿå¹å¥ï¼šwhat adj + n + (ä¸»è¯­ + è°“è¯­) æˆ–è€… how adj + (ä¸»è¯­ + è°“è¯­)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;A be different from Bï¼šA ä¸åŒä¸ B&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;A is 5 miles from Bï¼šAè·ç¦»Bæœ‰5è‹±é‡Œ&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;A be full of Bï¼šAå……æ»¡B&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;A give B a liftï¼šAç»™äº†Bæ­ä¾¿è½¦&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;A be strict with Bï¼šAå¯¹Bå¾ˆä¸¥æ ¼&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;A serves as Bï¼šAå½“ä½œB&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;A be equipped with Bï¼šAè£…å¤‡äº†Bï¼Œequip sb with sthï¼šç»™æŸäººè£…å¤‡æŸç‰©&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;A be referred to as Bï¼šæŠŠAç§°ä¸ºBï¼Œç­‰ä»·äº refer to A as B&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;a great number of + åè¯å¤æ•° ç­‰ä»·äº a lot ofï¼šå¤§é‡&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;a glass of beerï¼šä¸€æ¯å•¤é…’&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;a piece of cheeseï¼šä¸€ç‰‡èŠå£«&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;a parcel of diamonds: ä¸€åŒ…é’»çŸ³&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;a colony of beeï¼šä¸€ç¾¤èœœèœ‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;a crowd of beggarsï¼šä¸€ç¾¤äººä¹ä¸&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;a short while ageï¼šä¸ä¹…å‰&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;a trail ofï¼šä¸€ç³»åˆ—ï¼Œä¸€é•¿ä¸²&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;a blessing in disguiseï¼šå› ç¥¸å¾—ç¦&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;as it did å¼•å¯¼æ–¹å¼çŠ¶è¯­ä»å¥ï¼Œegï¼šLooks the same as it did twenty years ago. è¿™é‡Œit didæŒ‡çš„å°±æ˜¯Look the same.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;admit doing sthï¼šæ‰¿è®¤åšæŸäº‹ / sb admin that&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ask (sb) for sthï¼šå‘æŸäººæƒ³è¦æŸäº›ä¸œè¥¿&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ask sb to do sthï¼šè¯·æ±‚æŸäººåšæŸäº‹&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;account for the fact thatï¼šè§£é‡Šäº‹å®ï¼Œthatåé¢åŠ ä¸€ä¸ªå¥å­è§£é‡Šè¿™ä¸ªäº‹å®&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;as if : å¥½åƒï¼Œä¼¼ä¹ï¼Œå°±åƒ&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;as åšæ–¹å¼çŠ¶è¯­çš„è¿æ¥è¯æœ‰çš„å«ä¹‰ï¼š1. åƒï¼Œ2. å½“&amp;hellip;ï¼Œ 3. ä½œä¸º&amp;hellip;ï¼Œ4. æŒ‰ç…§&amp;hellip;.çš„æ–¹å¼ï¼Œ&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;at largeï¼šé€é¥æ³•å¤–ï¼›åœ¨é€ƒï¼›æœªè¢«æ•è·çš„&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;a few hours earlierï¼šå‡ ä¸ªå°æ—¶å‰&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;a pile ofï¼šä¸€å¤§å †&amp;hellip;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;a great deal of + ä¸å¯æ•°åè¯ï¼Œè¡¨ç¤ºå¤§é‡çš„xx&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;at five to twelveï¼šå·®5åˆ†é’Ÿåˆ°12ç‚¹ï¼Œå³11ç‚¹55åˆ†&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;at that momentï¼šåœ¨é‚£ä¸ªç¬é—´ ç­‰ä»· at present&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;all parts of the countryï¼šå…¨å›½å„åœ°&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;admire sb for sth / doing sthï¼šèµç¾æŸäººæŸäº‹&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;apply to sbï¼šé€‚ç”¨äºæŸäºº&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;apply for sthï¼šç”³è¯·æŸä¸ªä¸œè¥¿&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;apart fromï¼šé™¤äº†&amp;hellip;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;affort this ç­‰ä»·äº affort to pay thisï¼Œæ”¯ä»˜å¾—èµ·è¿™ä¸ª&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;allowç”¨æ³•ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;be allowd to do sthï¼šè¢«å…è®¸åšæŸäº‹&lt;/li&gt;
&lt;li&gt;allow sb to do sthï¼šå…è®¸æŸäººåšæŸäº‹&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;as &amp;hellip; as&amp;hellip; ï¼šåƒä»€ä¹ˆä»€ä¹ˆä¸€æ ·ä»€ä¹ˆï¼Œegï¼šas busy as usal åƒå¾€å¸¸ä¸€æ ·å¿™ç¢Œï¼Œå¦å®šæ˜¯ not as(ä¹Ÿå¯ä»¥ç”¨so) &amp;hellip; as &amp;hellip;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;a slip of the tongueï¼šå£è¯¯&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;attempt to do sthï¼šä¼å›¾/å°è¯•åšæŸäº‹&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;avoid doing sthï¼šé¿å…åšæŸäº‹&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;base onï¼šåŸºäºxxx&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;be accustomed to doingï¼šä¹ æƒ¯åšæŸäº‹&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;be armed(è¢«åŠ¨) with sth ç­‰ä»·äº arm sb/sth with sthï¼šè£…å¤‡æŸç‰©&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;be able to doï¼šèƒ½åšæŸäº‹ï¼Œç­‰ä»·äº be due to doï¼Œä¸ can / could çš„åŒºåˆ«ï¼šä¸¤è€…éƒ½è¡¨è¾¾ä¸€ç§æ™®é€šèƒ½åŠ›ï¼Œåªæ˜¯ was able to doï¼Œè¡¨ç¤ºè¿‡å»çš„æˆåŠŸäº‹ä»¶ï¼Œ&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;be always doing sthï¼šbe + doing ä¸ always è¿ç”¨æ—¶ï¼Œè¡¨ç¤ºé¢‘ç‡è¿‡é«˜ï¼Œä»¤è¯´è¯è€…å¿ƒçƒ¦ï¼Œç”ŸåŒï¼ˆä¸ç»å¯¹ï¼‰&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;be base onï¼šåŸºäº&amp;hellip;.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;be busy doing sthï¼šå¿™äºåšæŸäº‹&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;be busy with sthï¼šå¿™äºæŸä»¶äº‹&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;be confident that + å¥å­ï¼šå¯¹xxxæœ‰ä¿¡å¿ƒ&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;be eager to do sthï¼šæ¸´æœ›åšæŸäº‹&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;be going to do sthï¼šå°†æ¥è¦åšå•¥ ç­‰ä»·äº be gonna do sth&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;be nervous about sth / doing sthï¼šåšæŸäº‹å¾ˆä¸å®‰/ç´§å¼ &lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;be proud of ï¼šä¸ºè°æ„Ÿåˆ°è‡ªè±ª&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;be aware of ï¼šå¯¹ä»€ä¹ˆå¾ˆæ¸…æ¥šï¼ŒçŸ¥é“ä»€ä¹ˆï¼Œæ„è¯†åˆ°ä»€ä¹ˆ&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;be astonish at sthï¼šå¯¹ä»€ä¹ˆæ„Ÿåˆ°å¾ˆæƒŠè®¶&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;be confident that &amp;hellip; + å¥å­&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;be called in to do sthï¼šè¢«å«æ¥åšæŸäº‹&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;be dressed in ï¼šç©¿ç€äº†ä»€ä¹ˆï¼ˆè¢«åŠ¨ï¼‰&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;be dressed up asï¼šæ‰“æ‰®æˆäº†ä»€ä¹ˆï¼Œä¹Ÿå¯ä»¥çœç•¥be&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;be disappointed to learn thatï¼šå¾ˆæ²®ä¸§çš„å¾—çŸ¥&amp;hellip;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;be equal to sthï¼šèƒœä»»æŸäº‹&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;be exempted fromï¼šä»&amp;hellip;è¢«å…é™¤&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;be fanatical about/doing sthï¼šå¯¹æŸäº‹ï¼ŒåšæŸäº‹å¾ˆç‹‚çƒ­&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;be likely to do sthï¼šå¯èƒ½å»åšæŸäº‹&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;be interested in doing sthï¼šåšæŸäº‹æ„Ÿå…´è¶£&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;be instructed to do sthï¼šè¢«æŒ‡ç¤º/å‘½ä»¤åšæŸäº‹&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;be instructed in doing sth ç­‰ä»·äº instruct sb in sth/doing sthï¼šæ•™æŸäººåšæŸäº‹&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;be lined upï¼šæ’æˆä¸€æ’&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;be mad at sbï¼šå¯¹æŸäººç”Ÿæ°”&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;be keen on sth/doing sthï¼šçƒ­è¡·æŸäº‹&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;be / get upset about sthï¼šå¯¹ä»€ä¹ˆæ„Ÿåˆ°æ²®ä¸§/ä¸å®‰&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;be up for saleï¼šå¾…å”®&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;be worth doingï¼šå€¼å¾—å»åšæŸäº‹&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;be pleased withï¼šå¯¹ä»€ä¹ˆæ„Ÿåˆ°æ»¡æ„&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;be popular withï¼šåœ¨xxxä¹‹é—´å—æ¬¢è¿&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;be put to shameï¼šç­‰ä»·äº put sb to shameï¼Œä½¿æŸäººæ„Ÿåˆ°æƒ­æ„§&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;be responsible forï¼šå¯¹&amp;hellip;æœ‰è´£ä»»&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;be reluctant to do sthï¼šä¸æƒ…æ„¿åšæŸäº‹&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;be sensitive about sthï¼šå¯¹æŸäº‹æ„Ÿåˆ°æ•æ„Ÿ&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;be tolerant ofï¼šå®¹å¿æŸäº‹&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;get / be tired of sth / doing sthï¼šåŒå€¦åšæŸäº‹&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;begin to do sthï¼šç­‰ä»·äºbegin doing sthï¼Œéƒ½æ˜¯è¡¨ç¤º å¼€å§‹åšæŸäº‹&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;belong to sbï¼šå±äºæŸäºº&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;be confined to xxxï¼šè¢«å›°åœ¨ xxx&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;become / be an expert at doing sthï¼šåœ¨åšæŸäº‹ä¸Šæ¬¡æˆä¸ºä¸“å®¶&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;bear sth in mindï¼šç‰¢è®°è¿™sthä¸€ç‚¹&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;borrow sth from sbï¼šä»æŸäººé‚£å€Ÿæ¥æŸç‰©&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;board the planeï¼šç™»æœº&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;black or whiteï¼šéé»‘å³ç™½ï¼Œæ¯”å¦‚see things in balck or whiteï¼šçœ‹å¾…äº‹ç‰©éé»‘å³ç™½&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;black outï¼šæ™•äº†ï¼Œæ˜è¿·&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;break into cheersï¼šæ¬¢å‘¼èµ·æ¥&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;burst into tearsï¼šçˆ†å“­&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;cover the distance in &amp;hellip;ï¼šè¦†ç›–è·ç¦»&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;cause sb/sth to do sthï¼šå¼•èµ·æŸäººåšæŸäº‹&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;call at ç­‰ä»·äº visit ç­‰ä»·äº call onï¼šè®¿é—®&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;clear conscienceï¼ˆè‰¯å¿ƒï¼‰ï¼šé—®å¿ƒæ— æ„§&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;claim one&amp;rsquo;s lifeï¼šå¤ºèµ°æŸäººçš„æ€§å‘½&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;claim to have done sthï¼šå£°ç§°å·²ç»åšè¿‡æŸäº‹&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;cling to sb/sthï¼šé™„ç€åœ¨&amp;hellip;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;charge at sbï¼šå†²å‘æŸäººï¼Œæœ‰æ”»å‡»æ€§ï¼Œç­‰ä»·äº attack&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;catch up with sbï¼šè¿½ä¸ŠæŸäºº / é‡è§æŸäºº&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;cover sb/sth with aï¼šç”¨aè¦†ç›–sb/sth&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;connect a to bï¼šè¿æ¥aå’Œbï¼Œç­‰ä»·äº a be connected to b&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;complain about sthï¼šæŠ±æ€¨æŸäº‹ / complain of sth&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;continue doing / to do sthï¼šç»§ç»­åšæŸäº‹&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;died fromï¼šæ­»äºç¯å¢ƒã€äº‹æ•…ï¼Œdied ofï¼šæ­»äºç–¾ç—…ã€è¡°è€&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;despite the fact that&amp;hellip;ï¼šé™¤äº†è¿™æ ·ä¸€ä¸ªäº‹å®æ˜¯&amp;hellip;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;devote oneself to sth / doing sthï¼šè‡´åŠ›äºåšæŸäº‹&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;drive on to swï¼šç»§ç»­å¼€å‘æŸå¤„&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;died of åé¢ä¸€èˆ¬åŠ ç–¾ç—…ï¼Œè¡¨ç¤ºæ­»äºä»€ä¹ˆç–¾ç—…&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;drive me madï¼šæŠŠæˆ‘é€¼ç–¯&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;dream of doing sthï¼šæ¢¦æƒ³åšæŸäº‹&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;don&amp;rsquo;t have to do ç­‰ä»·äº don&amp;rsquo;t need to do ï¼Œä¸å¿…åšæŸäº‹&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;do anything to do sthï¼šä½¿å‡ºæµ‘èº«è§£æ•°åšæŸäº‹&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;even ifï¼šå³ä½¿ï¼Œeven thoughï¼šå°½ç®¡&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;enter forï¼šå‚åŠ &lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;expect sth to be doneï¼šæœŸå¾…æŸäº‹è¢«åš&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;entitle sb to sth / to do sthï¼šç»™æŸäººæœ‰æƒåˆ©åšæŸäº‹ï¼Œentitleå¦ä¸€ä¸ªæ„æ€æ˜¯ç»™æŸä¸ªä¸œè¥¿èµ·åå­—&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;enable sb to do sthï¼šç¡®ä¿æŸäººåšæŸäº‹&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;feel obliged to do sthï¼šè§‰å¾—æœ‰ä¹‰åŠ¡åšæŸäº‹ï¼Œobliged to ç­‰ä»·äº bound toï¼Œæ„æ€æ˜¯ä¸å¾—ä¸åšï¼Œä¸€å®šåš&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;fail to do sthï¼šå¤±è´¥åšæŸäº‹&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;far more interestingï¼šæœ‰è¶£å¾—å¤šå¾—å¤šï¼Œfar è¿™é‡Œè¡¨è¾¾è¿œè¶…ï¼Œç¨‹åº¦å‰¯è¯&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;forbid sb to do sthï¼šç¦æ­¢æŸäººåšæŸäº‹&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;feel sorry for sbï¼šè§‰å¾—æŸäººæŒºå¯æ€œã€å€¼å¾—åŒæƒ…ï¼Œå¯æ‚²&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;find sb doing sthï¼šå‘ç°æŸäººåšæŸäº‹&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;for one cause or anotherï¼šç­‰ä»·äº for one reason or anotherï¼Œå› ä¸ºè¯¸å¤šåŸå› &lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;gaze at / glance atï¼šç›¯ç€ï¼Œå‡è§†ç€&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;get sth for sbï¼šç»™æŸäººæ‹¿æŸäº›ä¸œè¥¿&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;give up doing sthï¼šæ”¾å¼ƒåšæŸäº‹&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;give rise toï¼šç­‰ä»·äº lead to ç­‰ä»·äºcauseï¼Œè¡¨ç¤ºå¯¼è‡´&amp;hellip;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;get into (such) a messï¼šé™·å…¥éº»çƒ¦ / å¼„åˆ°ä¸€èº«ç°å°˜&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;get a fright / give me a frightï¼šå—åˆ°æƒŠå“ / å“æˆ‘ä¸€è·³&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;going througthï¼šç¿»é˜…&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;go on a diet ç­‰ä»·äº be on a diet ï¼šè¡¨ç¤ºèŠ‚é£Ÿ&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;go on doing sthï¼šæŒç»­ / åšæŒåšæŸäº‹&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;go on strikeï¼šç½¢å·¥&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;go downhillï¼šèµ°ä¸‹å¡è·¯&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;go to churchï¼šåšç¤¼æ‹œï¼Œgo to the churchï¼šå»æ•™å ‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;go to extreme to do sthï¼šèµ°æç«¯åšæŸäº‹&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;help oneself to sthï¼šæœªç»è®¸å¯æ‹¿æŸäººæŸç‰©ï¼Œå·æŸäººæŸç‰©&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;happend to doï¼šç¢°å·§åšæŸäº‹&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;hesitate to do sthï¼šçŠ¹è±«åšæŸäº‹&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;hesitate for a moment / secondï¼šç­‰ä»·äº wait a momentï¼Œè¡¨ç¤ºç­‰ä¸€ä¼š&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;have sth in common&amp;hellip;ï¼šåœ¨æŸäº‹ä¸Šæ˜¯ç›¸åŒçš„&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;have difficulty in doing sthï¼šèµ°æŸäº‹å¾ˆå›°éš¾&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;have trouble with sthï¼šåšæŸäº‹æƒ…æœ‰éº»çƒ¦æˆ–å›°éš¾&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;have a glimpse of sth/sbï¼šç¥è§æŸäºº / æŸäº‹&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;have / make an impact onï¼šåœ¨&amp;hellip;ä¸Šäº§ç”Ÿå½±å“&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;have a habit of doing sthï¼šæœ‰ä¹ æƒ¯åšæŸäº‹ï¼Œdevelop a habitï¼šå…»æˆä¹ æƒ¯&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;have authority to doï¼šæœ‰æƒåŠ›åšæŸäº‹&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;have/get the nerve to do sthï¼šæœ‰å‹‡æ°”åšæŸäº‹&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;hear / see doing sthï¼šéå…¨ç¨‹å¬/çœ‹åˆ°åšæŸäº‹ï¼Œhear / see do sthï¼šå…¨ç¨‹éƒ½å¬ / çœ‹åˆ°åšæŸäº‹&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;hold up the trafficï¼šé˜»å¡äº¤é€šï¼Œhold up the lineï¼šé˜»ç¢æ’é˜Ÿ&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;i is/was wondering + å¥å­ï¼šæˆ‘æƒ³çŸ¥é“çš„æ˜¯&amp;hellip;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;in this wayï¼šåœ¨è·¯ä¸Š&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;in sb&amp;rsquo;s honorï¼šå‘æŸäººè‡´æ•¬&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;in return for xxxï¼šä½œä¸ºxxxçš„å›æŠ¥&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;in twenty minutes(&#39; time)ï¼š12åˆ†é’Ÿä¹‹å / in six monthsï¼š6ä¸ªæœˆå&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;in the front of (å†…éƒ¨çš„å‰é¢) / in front of (å¤–éƒ¨çš„å‰é¢)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;intend to do sthï¼šè®¡åˆ’åšæŸäº‹&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;insist on doing sthï¼šåšæŒåšæŸäº‹&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;it seems that + å¥å­ï¼šä¼¼ä¹æ˜¯&amp;hellip;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;it is a blessing that &amp;hellip; ï¼šå¾ˆå¹¸è¿çš„æ˜¯&amp;hellip;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;it is said that &amp;hellip; ç­‰ä»·äº be said to do sthï¼šè¡¨ç¤º æ®è¯´&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;it is disturbing to think that + å¥å­ï¼šå¾ˆå›°æ‰°çš„æ˜¯&amp;hellip; + å¥å­&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;it occurred to sb thatï¼ˆto do sthï¼‰&amp;hellip;ï¼šæŸäººçªç„¶é—´æƒ³åˆ°&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;it take sb sometime to do sthï¼šèŠ±è´¹æŸäººå¤šé•¿æ—¶é—´åšæŸäº‹&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;it is no use pretending that + å¥å­ï¼šå‡è£…åš&amp;hellip;æ˜¯æ²¡æœ‰ç”¨çš„&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;it comes as a surprise to learn that + å¥å­ï¼šå¾—çŸ¥æŸäº‹å¾ˆæƒŠè®¶&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;knock at the doorï¼šæ•²é—¨&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;keep guardï¼šç«™å²—ï¼Œå®ˆå«ï¼Œå®ˆåœ¨è¿™é‡Œ&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;keep in touch with sbï¼šä¸æŸäººä¿æŒè”ç³»&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;keep track ofï¼šè¿½è¸ªxxxçš„è¿›å±•&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;lend sb sthï¼šå€Ÿç»™æŸäººæŸç‰©&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;leave sb a messageï¼šç»™æŸäººç•™ä¸‹ä¿¡æ¯&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;laugh at sbï¼šå˜²ç¬‘æŸäºº&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;look forward to sth / doing sthï¼šç›¼æœ›åšæŸäº‹&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;look down on sbï¼šçœ‹ä¸èµ·æŸäººï¼Œç­‰ä»·äº scornfullyï¼Œè½»è”‘åœ°&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;look onï¼šæ—è§‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;mind doing sthï¼šä»‹æ„åšæŸäº‹ï¼Œæ ¼å¼ï¼šdo you mind my smoking?ä¸ºä»€ä¹ˆè¦ç”¨myï¼Œå¯ä»¥ç†è§£ä¸ºsmokeæ˜¯å±äº&amp;quot;æˆ‘çš„&amp;quot;ï¼Œå±äºå›ºå®šæ­é…ï¼Œå¾—æ˜¯ â€œæŸäººçš„â€ï¼Œå¯ä»¥çœç•¥ï¼Œä¹Ÿå¯ä»¥ç”¨me&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;mark the occasionï¼šçºªå¿µè¿™ä¸ªåœºåˆ&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;make a spectacle of oneselfï¼šè®©æŸäººå‡ºæ´‹ç›¸&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;make no effort to do sthï¼šä¸åŠªåŠ›åšæŸäº‹&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;make a decisionï¼šåšå†³å®š&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;make sb do sthï¼šè®©æŸäººåšæŸäº‹ï¼Œè¢«åŠ¨ï¼Œä¸èƒ½çœç•¥toï¼Œä¸º be made to do sthï¼Œè¢«è¿«åšæŸäº‹ï¼Œç­‰ä»·äº be forced to do sth&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;make up my mindï¼šä¸‹å®šå†³å¿ƒ&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;manage to do sthï¼šç­‰ä»·äº was able to do sthï¼Œå«ä¹‰ï¼šè¿‡å»æˆåŠŸåšäº†æŸäº‹ï¼Œè®¾æ³•åšæˆäº†æŸäº‹&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;might / may as wellï¼šï¼ˆæ²¡æœ‰æ›´å¥½çš„é€‰æ‹©ï¼‰åªèƒ½å»åšäº†&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;mixture of a and bï¼šaå’Œbçš„æ··åˆç‰©&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;move to a house in åœ°æ–¹ / move to åœ°æ–¹ï¼šæ¬åˆ°æŸä¸ªåœ°æ–¹&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;not know the way to åœ°æ–¹ï¼šä¸çŸ¥é“é‚£ä¸ªåœ°æ–¹çš„è·¯&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;no sooner &amp;hellip; than &amp;hellip; ï¼šç­‰ä»·äº as soon asï¼Œè¡¨ç¤º ä¸€ &amp;hellip; å°±&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;on doing sth, &amp;hellip; ç­‰ä»·äº as soon asï¼Œç­‰ä»·äº the momentï¼Œéƒ½è¡¨ç¤º ä¸€&amp;hellip;å°±&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;on the last dayï¼šåœ¨æœ€åä¸€å¤©&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;on the courseï¼šåœ¨è·¯ä¸Šï¼Œcourseè¿˜æœ‰å…¶ä»–æ„æ€ï¼Œæ¯”å¦‚è¯¾ç¨‹ï¼Œè¿‡ç¨‹ï¼Œç»è¿‡ï¼Œçƒåœºï¼Œof course å½“ç„¶&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;on this occasionï¼šåœ¨è¿™ç§åœºåˆï¼Œoccasionï¼šn åœºåˆï¼›occasionallyï¼šadv æ˜¯å¶ç„¶çš„&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;one way of anotherï¼šä¸ç®¡æ€ä¹ˆæ ·&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;one good turn deserves anotherï¼šç¤¼å°šå¾€æ¥ï¼Œå¥½äººæœ‰å¥½æŠ¥ï¼Œturnè¿™é‡Œè¡¨è¡Œä¸º&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;once upon a timeï¼šå¾ˆä¹…ä»¥å‰&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;once moreï¼šå†ä¸€æ¬¡ï¼Œé‡æ–°&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;pocket moneyï¼šé›¶é’±ï¼Œé›¶èŠ±é’±&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;play truant from schoolï¼šé€ƒå­¦&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;pay for sthï¼šæ”¯ä»˜æŸå¦‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;pay it backï¼šæŠŠä»–è¿˜å›æ¥&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;pay sb a visitï¼šæ‹œè®¿æŸäºº&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;persuade sb (not) to do sthï¼šè¯´æœæŸäººåšæŸäº‹&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;put forward a plan ï¼šæå‡ºä¸€ä¸ªè®¡åˆ’&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;put it behind meï¼šæŠ›ä¹‹è„‘åï¼Œé—å¿˜æ‰&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;put my finger on itï¼šå¼•ç”³å«ä¹‰ï¼Œæ˜ç¡®çš„æŒ‡å‡º&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;point the finger atï¼šå¼•ç”³å«ä¹‰ï¼ŒæŒ‡è´£æˆ–è´£å¤‡æŸäºº&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;prevent sb from doing sthï¼šé˜»æ­¢æŸäººåšæŸäº‹&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;(would) prefer to do sth ç­‰ä»·äº prefer doing sthï¼Œæ›´å–œæ¬¢åšæŸäº‹&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;prefer A to Bï¼šå’Œbæ¯”æˆ‘æ›´å–œæ¬¢A&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;prefer doing A to doing B ï¼šå’Œåš B ç›¸æ¯”æˆ‘æ›´å–œæ¬¢åšA&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;(would) prefer to do A rather than Bï¼šå’ŒåšBç›¸æ¯”ï¼Œæˆ‘æ›´å–œæ¬¢åšA&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;protect A from Bï¼šä¿æŠ¤Aå…äºBçš„(ä¼¤å®³)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;provide sb with sthï¼šæä¾›ç»™æŸäººæŸç‰©&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;receive sth from sbï¼šä»è°é‚£æ”¶åˆ°ä¸œè¥¿&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;refuse to do sthï¼šæ‹’ç»åšæŸäº‹&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;remind sb of sth/sbï¼šæé†’æŸäººæƒ³èµ·æŸäº‹/äºº&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;remember sb for + sthï¼šæƒ³èµ·æŸäººæŸäº‹&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;regretted doing sthï¼šåæ‚”åšæŸäº‹&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;run into serious troubleï¼šé‡åˆ°ä¸¥é‡çš„å›°éš¾&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;run out ofï¼šç”¨å°½ï¼Œè€—å°½&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;save up for years to buy sthï¼šå­˜äº†å¾ˆå¤šå¹´é’±ä¹°æŸç‰©&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;should (not) do æˆ–è€… ought (not) to doï¼Œéƒ½æ˜¯è¡¨ç¤ºåº”è¯¥åš&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;should have done æˆ–è€… ought to have doneï¼Œéƒ½æ˜¯è¡¨ç¤ºæœ¬åº”è¯¥åšæŸäº‹ï¼Œä½†å´æ²¡æœ‰&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;sort of ç­‰ä»·äº kind ofï¼šå„ç§ç±»å‹ï¼Œå„ç§ç§ç±»ï¼Œwhat sort of / what kind ofï¼Œall sorts of / all kinds of&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;spot sb doing sthï¼šçœ‹åˆ°æŸäººåšæŸäº‹&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;spendå›ºå®šç”¨æ³•ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;spend onï¼šåœ¨&amp;hellip;æ–¹é¢èŠ±è´¹&lt;/li&gt;
&lt;li&gt;spend money onï¼šèŠ±å¤šå°‘é’±ä¹°æŸç‰©&lt;/li&gt;
&lt;li&gt;spend time (in) doingï¼šèŠ±æ—¶é—´åšæŸäº‹&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;speed it / things / this upï¼šåŠ é€ŸåšæŸäº‹&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;stand on sb&amp;rsquo;s headï¼šå€’ç«‹&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;start doing sthï¼šå¼€å§‹åšæŸäº‹ï¼Œ ç­‰ä»·äº set out to do sth ã€intend to do sthã€begin to do sth&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;stick to the planï¼šåšæŒè¿™ä¸ªè®¡åˆ’&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;step sideï¼šç«™åˆ°ä¸€è¾¹ï¼›ä»é‡è¦çš„èŒä½ç¦»å¼€ï¼Œè¾èŒï¼›æ’¤é€€&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;stop byï¼šé¡ºä¾¿æ¥è®¿&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;set up a new world recordï¼šåˆ›å»ºæ–°çš„ä¸–ç•Œè®°å½• / break the recordï¼šæ‰“ç ´ä¸–ç•Œè®°å½•&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;seem to be doingï¼šä¼¼ä¹åœ¨åšæŸäº‹&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;shout at sbï¼šå¸¦æƒ…ç»ªçš„é‚£ç§å–Šï¼Œshout to sbï¼šä½¿æŸäººèƒ½å¬åˆ°çš„é‚£ç§å–Š&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;stick my planï¼šåšæŒæˆ‘çš„è®¡åˆ’&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;stamp outï¼šè¸©ç­ã€è¸©å‡º&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;so farï¼šåˆ°ç›®å‰ä¸ºæ­¢&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;so long asï¼šåªè¦&amp;hellip;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;so + adj/advï¼šè¡¨ç¨‹åº¦ï¼Œå¯ä»¥æ˜¯å½¢å®¹è¯æˆ–å‰¯è¯ï¼Œ&lt;/p&gt;
&lt;p&gt;such + adj + nï¼šè¡¨ç¨‹åº¦ï¼Œä½†ä¸€å®šæ˜¯å½¢å®¹è¯+åè¯ï¼Œå½¢å®¹è¯ä¹Ÿå¯ä»¥å»æ‰&lt;/p&gt;
&lt;p&gt;so adj/adv that &amp;hellip; ã€ such + (adj) + n + thatï¼šå¦‚æ­¤&amp;hellip;ä»¥è‡³äº&amp;hellip;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;succeed in doing sthï¼šæˆåŠŸåšæŸäº‹&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;suggest that &amp;hellip; does / should doï¼Œå»ºè®®æŸäººåšæŸäº‹ï¼Œshouldå¯çœç•¥ï¼Œå¯doå¯does&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;sneer at sb æˆ–è€… with a sneerï¼šå†·ç¬‘æŸäºº&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;sb take a long time to do sthï¼šæŸäººèŠ±è´¹å¾ˆé•¿æ—¶é—´åšæŸäº‹&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;take sth/sb seriouslyï¼šè®¤çœŸå¯¹å¾…æŸäº‹/æŸäºº&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;take it away from meï¼šä»æˆ‘èº«è¾¹æŠ¢èµ°&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;take plates of &amp;hellip;ï¼šç»™&amp;hellip;æ‹ç‰‡&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;take a lift / ask for a lift / give sb a liftï¼šè¯·æ±‚æ­ä¾¿è½¦&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;take charge of ï¼šè´Ÿè´£ï¼ŒæŒç®¡ï¼Œæ‰¿æ‹…è´£ä»»ï¼Œæ§åˆ¶&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;take offï¼šé£æœºèµ·é£ï¼Œtouch downï¼šé£æœºé™è½&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;too adj to do sthï¼šå¤ª adj ä»¥è‡³äºä¸èƒ½åšæŸäº‹&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;to make matters worseï¼šä½¿äº‹æƒ…å˜å¾—æ›´ç³Ÿç³•çš„æ˜¯&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;to sb&amp;rsquo;s horrorï¼šä½¿æŸäººæƒŠæ&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;think about sth/sbï¼šæ€è€ƒæŸäºº/æŸäº‹&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;tech sb sthï¼šæ•™ç»™æŸäººæŸäº‹&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;try to do sthï¼šå°è¯•åšæŸäº‹&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;turn out to beï¼šç»“æœæ˜¯ï¼ŒåŸæ¥æ˜¯ï¼Œè¯æ˜æ˜¯&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;to sb&amp;rsquo;s surpriseï¼šè®©æŸäººæƒŠè®¶çš„æ˜¯&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;that&amp;rsquo;s neat ç­‰ä»·äº that&amp;rsquo;s cool&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;the last day of the yearï¼šä¸€å¹´çš„æœ€åä¸€å¤©&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;threaten sb with sthï¼šå¨èƒæŸäººæŸäº‹&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;two minutes past twelveï¼š12ç‚¹è¿‡2åˆ†&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;the news get aroundï¼šæ¶ˆæ¯ä¼ æ’­å¼€æ¥&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;wake up with startï¼šæƒŠé†’&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;work for xxï¼šç»™xxå·¥ä½œ&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;well-konwï¼šè‘—å&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;will be awayï¼šç¦»å¼€&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;wave to sbï¼šå‘æŸäººæ‹›æ‰‹&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;without doing sthï¼šæ²¡æœ‰åšæŸäº‹&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;urge sb to do sthï¼šæ€‚æ¿æŸäººåšæŸäº‹&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;up to nowï¼šåˆ°ç›®å‰ä¸ºæ­¢&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;use upï¼šç”¨å…‰&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;use to do sthï¼šè¿‡å»å¸¸å¸¸åšæŸäº‹ï¼ˆç°åœ¨ä¸åšäº†ï¼‰ï¼Œå¦å®šå¼ä¸º didn&amp;rsquo;t use to do&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åŒºåˆ« be use to doingï¼šä¹ æƒ¯åšæŸäº‹&lt;/li&gt;
&lt;li&gt;åŒºåˆ« be used to do sthï¼šè¢«ç”¨æ¥åšæŸäº‹&lt;/li&gt;
&lt;li&gt;ä¸would doçš„åŒºåˆ«ï¼Œwould doæŒ‡çš„æ˜¯è¿‡å»é‡å¤å‘ç”Ÿçš„åŠ¨ä½œã€è¿‡å»ç»å¸¸åšæŸäº‹ï¼Œuse to doæŒ‡è¿‡å»çš„çŠ¶æ€ æˆ–è€… æš—å«ç°åœ¨ä¸å‘ç”Ÿäº† æˆ–è€… è®¨è®ºç»å¸¸ä¸”é‡è¦çš„ä¹ æƒ¯è¡Œä¸º(æ¯”è¾ƒä¸»è§‚ï¼Œçœ‹æƒ…å†µ)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;be use asï¼šè¢«å½“ä½œï¼Œuse A as Bï¼šæŠŠAå½“æˆB&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;è¯­æ³•&#34;&gt;è¯­æ³•&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ä»‹è¯ + åœ°æ–¹ï¼šat + å°åœ°æ–¹ï¼Œon + å¤§åœ°æ–¹&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ever + åœ¨ç–‘é—®è¯åé¢ï¼Œæ¯”å¦‚whatã€whyã€who è¡¨ç¤ºå¼ºè°ƒï¼Œæ ¹æ®è¯­æ°”ï¼Œå¯èƒ½å¸¦æœ‰ surprise / astonishment(æƒŠè®¶) / anger / irritation(æ¿€æ€’) / dismay ç­‰æƒ…ç»ª&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;do / does / did è‚¯å®šå¥è¡¨å¼ºè°ƒï¼Œä¸€èˆ¬åŠ åœ¨åŠ¨è¯åé¢ï¼Œåé¢åŠ¨è¯åŸå‹ï¼Œegï¼šShe &lt;strong&gt;did do&lt;/strong&gt; morning exercises this morning; è¿™é‡Œçš„didæ˜¯è¡¨å¼ºè°ƒï¼Œå»æ‰didä¹Ÿå¯ä»¥ï¼ŒShe did morning exercises this morning; è¿™é‡Œçš„didæ˜¯doçš„è¿‡å»å¼ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;was / were doingè¡¨ç¤¼è²Œï¼Œæ­¤æ—¶å¯ä»¥è·Ÿæœªæ¥çš„æ—¶é—´ä¸€èµ·æ­é…&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;yetï¼Œè¡¨ç¤ºå‰åå¥å­çš„è¡¨è¾¾å‰ååå·®å¾ˆå¤§ï¼Œyetå¼•å¯¼çš„å¥å­è¡¨ç¤ºå¾ˆæƒŠå–œå¾ˆæƒŠè®¶ï¼Œå¼ºè½¬æŠ˜ï¼Œè¡¨ç„¶è€Œä½†æ˜¯&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¼ºè°ƒå¥ï¼šit is(was) + å¼ºè°ƒéƒ¨åˆ† + that(who) + å‰©ä½™éƒ¨åˆ†&lt;/p&gt;
&lt;p&gt;egï¼šit was my secretan that sent the bill to Mr.Harding yesterday.&lt;/p&gt;
&lt;p&gt;it was the bill that my secretary sent to Mr.Harding yesterday.  ä¸¤è€…å¼ºè°ƒçš„éƒ¨åˆ†ä¸ä¸€æ ·&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ¯”è¾ƒçº§ï¼Œæœ€é«˜çº§ï¼Œä¸€èˆ¬è§„åˆ™æ˜¯åŠ  er/ estï¼Œå…¶ä»–çš„&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å•éŸ³èŠ‚ï¼Œå…ƒéŸ³ + è¾…éŸ³ç»“å°¾ï¼ŒåŒå†™è¾…éŸ³å­—æ¯ï¼ŒåŠ  er / est&lt;/li&gt;
&lt;li&gt;åŒéŸ³èŠ‚ï¼Œè¾…éŸ³å­—æ¯ + yç»“å°¾ï¼Œå˜yä¸ºiï¼ŒåŠ  er / est&lt;/li&gt;
&lt;li&gt;ä¸€äº›å¦å¤– æˆ–è€… å¤šéŸ³èŠ‚(&amp;gt;=3ä¸ªéŸ³èŠ‚)ï¼Œæ˜¯åŠ  moreï¼Œmost æˆ–è€… lessï¼Œlest&lt;/li&gt;
&lt;li&gt;ç”šè‡³æœ‰ä¸€äº›ä¸Šé¢çš„è§„åˆ™çš†å¯&lt;/li&gt;
&lt;li&gt;ä¸è§„åˆ™çš„ï¼Œæ¯”å¦‚ good / well -&amp;gt; better -&amp;gt; bestï¼›bad -&amp;gt; worse -&amp;gt; worstï¼›little -&amp;gt; less -&amp;gt; least&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ¯”è¾ƒçº§å¸¸è§ç”¨æ³•&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸»è¯­ + be + adj. er + than + æ¯”è¾ƒå¯¹è±¡&lt;/li&gt;
&lt;li&gt;ä¸»è¯­ + be + the + adj. est + n + èŒƒå›´&lt;/li&gt;
&lt;li&gt;ä¸»è¯­ + be + the + adj. est + n + Iâ€˜ve ever met/seen/konwnï¼› xxxæˆ‘æ‰€çŸ¥é“çš„æœ€xxxçš„xxx&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ—¶é—´ç”¨æ³•ï¼Œå¸¸è§„ç”¨æ³•ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;on + å…·ä½“çš„æŸä¸€å¤©&lt;/li&gt;
&lt;li&gt;in + å¹´/å­£/æœˆï¼Œæ—©ä¸Š/ä¸‹åˆ/æ™šä¸Š&lt;/li&gt;
&lt;li&gt;at + æ—¶é—´ç‚¹&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;having been doneï¼šå®Œæˆæ—¶çš„è¢«åŠ¨ï¼Œå¯ç»“åˆ åˆ†è¯ä½œçŠ¶è¯­ ä½¿ç”¨&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;have / get something doneï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å«ä¹‰ä¸€ï¼šè®©åˆ«äººæ¥åšæŸäº‹ï¼Œè‡ªå·±ä¸åš&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å«ä¹‰äºŒï¼šæ„å¤–ï¼Œä¸å¹¸çš„é­é‡ï¼Œç¿»è¯‘æˆ è¢«&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;have gone toï¼šå·²ç»å»äº†ï¼Œäººæ²¡å›æ¥&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;have been toï¼šå·²ç»å»è¿‡ï¼Œäººå›æ¥äº†&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;have/has ï¼ˆnotï¼‰ been doing sthï¼šç°åœ¨å®Œæˆè¿›è¡Œæ—¶&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç”¨æ³•ä¸€ï¼šè¿‡å»è¿›è¡Œçš„åŠ¨ä½œ(ç»“æŸ)å¯¹ç°æœ‰çš„å½±å“&lt;/li&gt;
&lt;li&gt;ç”¨æ³•äºŒï¼šè¿‡å»è¿›è¡Œçš„åŠ¨ä½œæŒç»­ï¼ˆé‡å¤ï¼‰åˆ°ç°åœ¨ï¼Œä¹Ÿè®¸è¿˜ä¼šç»§ç»­&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;have / has done : ç°åœ¨å®Œæˆæ—¶&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç”¨æ³•ä¸€ï¼šè¡¨ç¤ºè¿‡å»çš„äº‹æƒ…å¯¹ç°åœ¨äº§ç”Ÿäº†å½±å“ï¼Œç­‰ä»·äº did + do/doesï¼ˆåšè¿‡äº†ä»€ä¹ˆï¼Œç°åœ¨æ€ä¹ˆæ ·ï¼‰&lt;/li&gt;
&lt;li&gt;ç”¨æ³•äºŒï¼šä»è¿‡å»æŒç»­åˆ°ç°åœ¨çš„äº‹æƒ…ï¼Œä¸€èˆ¬ä¼šåŠ æ—¶é—´&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;had doneï¼šè¿‡å»å®Œæˆæ—¶&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç”¨æ³•ä¸€ï¼šè¿‡å»çš„è¿‡å»ï¼Œå¼ºè°ƒçš„æ˜¯ä¸¤ä¸ªè¿‡å»æ˜¯æœ‰å…³è”çš„ï¼Œä¸ç„¶ç”¨ä¸€èˆ¬è¿‡å»æ—¶å³å¯&lt;/li&gt;
&lt;li&gt;ç”¨æ³•äºŒï¼šè¿‡å»æ—¶é—´ç‚¹Aå‘ç”Ÿï¼Œå¯¹è¿‡å»æ—¶é—´ç‚¹Bäº§ç”Ÿäº†å½±å“&lt;/li&gt;
&lt;li&gt;ç”¨æ³•ä¸‰ï¼šä¸€ä¸ªåŠ¨ä½œä»è¿‡å»AæŒç»­æˆ–é‡å¤åˆ°è¿‡å»B&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;will have doneï¼šå°†æ¥å®Œæˆæ—¶ï¼Œå¦å®šï¼šwon&amp;rsquo;t have done&lt;/p&gt;
&lt;p&gt;åé¢å¸¸è§äºæ¥æœªæ¥æ—¶é—´ &lt;strong&gt;by&lt;/strong&gt; next Mondayã€&lt;strong&gt;by&lt;/strong&gt; tomorrow&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç”¨æ³•ä¸€ï¼šä¸€ä¸ªåŠ¨ä½œæŒç»­æˆ–é‡å¤åˆ°å°†æ¥&lt;/li&gt;
&lt;li&gt;ç”¨æ³•äºŒï¼šä¸€ä¸ªåŠ¨ä½œæˆªæ­¢åˆ°æœªæ¥æŸä¸ªæ—¶é—´å‰å®Œæˆ&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;had been doing sthï¼šè¿‡å»å®Œæˆè¿›è¡Œæ—¶&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç”¨æ³•ä¸€ï¼šè¿‡å»Aè¿›è¡Œçš„vï¼ˆç»“æŸï¼‰å¯¹è¿‡å»Bäº§ç”Ÿçš„å½±å“&lt;/li&gt;
&lt;li&gt;ç”¨æ³•äºŒï¼šè¿‡å»Aè¿›è¡Œçš„ v æŒç»­æˆ–é‡å¤åˆ°è¿‡å»B&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/%e5%ae%8c%e6%88%90%e6%97%b6%e6%97%b6%e6%80%81.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/%e5%ae%8c%e6%88%90%e6%97%b6%e6%97%b6%e6%80%81.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;è¢«åŠ¨è¯­å¥&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;am/is/are + done&lt;/li&gt;
&lt;li&gt;was/were + done&lt;/li&gt;
&lt;li&gt;am/is/are + being + done&lt;/li&gt;
&lt;li&gt;have/has + been + done&lt;/li&gt;
&lt;li&gt;had + been + done&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;how manyå¯¹å¯æ•°åè¯æé—®ï¼Œhow muchå¯¹ä¸å¯æ•°åè¯æé—®&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;have to å’Œ must çš„åŒºåˆ«ï¼Œä¸¤è€…éƒ½æ˜¯è¡¨è¾¾å¿…é¡»ï¼Œ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;mustç”¨åœ¨ä¸€èˆ¬ç°åœ¨æ—¶ï¼Œä½†æ˜¯æ²¡åŠæ³•è¡¨è¾¾è¿‡å»ï¼›have toå¯ä»¥ç”¨æ—¶æ€ï¼Œè¡¨è¾¾è¿‡å»å°±èƒ½ç”¨ had to do äº†ï¼Œå¦å®šï¼šdon&amp;rsquo;t have toï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;mustè¡¨ä¸»è§‚ï¼Œhave toè¡¨å®¢è§‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç¾å¼è‹±è¯­ï¼Œç›´æ¥ç”¨ have toï¼Œä¸åŒºåˆ†&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;have to ç­‰ä»·äº have got toï¼Œhave gotta doï¼Œéƒ½æ˜¯è¡¨ç¤ºå¿…é¡»ï¼ˆæ¯”è¾ƒå°‘ç”¨ï¼Œå£è¯­ç”¨çš„å¤šï¼‰&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;have got ç­‰ä»·äº haveï¼Œéƒ½æ˜¯è¡¨ç¤º æ‹¥æœ‰&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;must / can è¡¨æ¨æµ‹&lt;/th&gt;
&lt;th&gt;ç°åœ¨&lt;/th&gt;
&lt;th&gt;è¿‡å»&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;è‚¯å®š&lt;/td&gt;
&lt;td&gt;must do&lt;!-- raw HTML omitted --&gt;must be adj / n&lt;!-- raw HTML omitted --&gt;must be doing&lt;/td&gt;
&lt;td&gt;must have done&lt;!-- raw HTML omitted --&gt;must have been adj / n&lt;!-- raw HTML omitted --&gt;must have been doing&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å¦å®š&lt;/td&gt;
&lt;td&gt;can&amp;rsquo;t do&lt;!-- raw HTML omitted --&gt;can&amp;rsquo;t be adj / n&lt;!-- raw HTML omitted --&gt;can&amp;rsquo;t be doing&lt;/td&gt;
&lt;td&gt;can&amp;rsquo;t have done&lt;!-- raw HTML omitted --&gt;can&amp;rsquo;t have been adj / n&lt;!-- raw HTML omitted --&gt;can&amp;rsquo;t have been doing&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;may / might è¡¨æ¨æµ‹ï¼Œå¯èƒ½æ˜¯&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;may / might è¡¨æ¨æµ‹&lt;/th&gt;
&lt;th&gt;ç°åœ¨&lt;/th&gt;
&lt;th&gt;è¿‡å»&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;è‚¯å®š / å¦å®š&lt;/td&gt;
&lt;td&gt;may / might (not) do&lt;!-- raw HTML omitted --&gt;may / might (not) be  adj / n&lt;!-- raw HTML omitted --&gt;may / might (not) be doing&lt;/td&gt;
&lt;td&gt;may / might (not) have done &lt;!-- raw HTML omitted --&gt;may / might (not)have been adj / n &lt;!-- raw HTML omitted --&gt;may / might (not) have been doing&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;need&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;åŠ¨è¯ï¼Œå«ä¹‰åŒwantï¼šneed to do sthï¼Œå¦å®š don&amp;rsquo;t need to do sthï¼ˆç­‰ä»·äº don&amp;rsquo;t have to do sthï¼Œä¸å¿…åšæŸäº‹ï¼‰&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æƒ…æ€åŠ¨è¯ï¼Œå«ä¹‰åŒcanï¼Œè¡¨ä¸å¿…ï¼ˆå¸¸å‡ºç°åœ¨å¦å®šå¥/ç–‘é—®å¥ï¼‰ï¼šneedn&amp;rsquo;t do ç­‰ä»·äº canâ€™t do&lt;/p&gt;
&lt;p&gt;needn&amp;rsquo;t have doneï¼šæœ¬ä¸å¿…å¦‚æ­¤ï¼Œä½†äº‹æƒ…å·²ç»å‘ç”Ÿäº†ï¼Œæœ‰åæ‚”çš„è¯­è¨€æ•ˆæœï¼›è¦åŒºåˆ†needn&amp;rsquo;t doï¼Œä¸¤ç§æ„æ€è¿˜æ˜¯ä¸å¤ªä¸€æ ·&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;need doing sthï¼šè¢«åŠ¨è¯­å¥ï¼Œç­‰ä»·äº need to be done&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;should (not) do æˆ–è€… ought (not) to doï¼Œéƒ½æ˜¯è¡¨ç¤ºåº”è¯¥åš&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;should have done æˆ–è€… ought to have doneï¼Œéƒ½æ˜¯è¡¨ç¤ºæœ¬åº”è¯¥åšæŸäº‹ï¼Œä½†å´æ²¡æœ‰&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¹¶åˆ—è¿è¯&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;both A and B ï¼šA å’Œ B éƒ½&lt;/li&gt;
&lt;li&gt;either A or Bï¼šA æˆ– Bï¼Œå°±è¿‘åŸåˆ™ï¼Œçœ‹Bæ˜¯ä¸æ˜¯å¤æ•°ï¼Œæ¥å†³å®šåé¢çš„åŠ¨è¯æ˜¯ä»€ä¹ˆ&lt;/li&gt;
&lt;li&gt;neither A nor Bï¼šæ—¢ä¸æ˜¯ A ä¹Ÿä¸æ˜¯ B ï¼Œå°±è¿‘åŸåˆ™ï¼Œçœ‹Bæ˜¯ä¸æ˜¯å¤æ•°ï¼Œæ¥å†³å®šåé¢çš„åŠ¨è¯æ˜¯ä»€ä¹ˆ&lt;/li&gt;
&lt;li&gt;not only &amp;hellip; but also &amp;hellip;ï¼šä¸ä»…&amp;hellip;è€Œä¸”&amp;hellip;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;if å¼•å¯¼çš„æ¡ä»¶ä»å¥ï¼Œä¸»å°†ä»ç°&lt;/strong&gt;ï¼Œegï¼šif you don&amp;rsquo;t hurry, you will miss the train.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;if çœŸå®æ¡ä»¶å¥&lt;/strong&gt;ï¼šAåŠ¨ä½œæˆç«‹å…³è”BåŠ¨ä½œæˆç«‹ï¼Œä¸ç¬¦åˆè™šæ‹Ÿè¯­æ°”ç»“æ„ï¼Œä¸ä¸äº‹å®ç›¸åï¼Œæ¯”å¦‚ if å¼•å¯¼çš„ä¸»å°†ä»ç°å¥å­æ˜¯ä¸€ç§ä¾‹å­ï¼Œå…¶ä»–ä¾‹å­ï¼šif you didn&amp;rsquo;t study English at school, you won&amp;rsquo;t understand this book. æˆ–è€… if jack didn&amp;rsquo;t come to work yesterday, he was probably ill.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è™šæ‹Ÿè¯­æ°”ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;if + did/were, ä¸»è¯­ + would / should / could / might do&lt;/strong&gt;ï¼Œè¿™é‡Œçš„didå¹¶éè¡¨ç¤ºè¿‡å»ï¼Œæ¯”å¦‚æœ‰ &lt;code&gt;if i were you, i wouldn&#39;t do that&lt;/code&gt;è¿™å¥è¯æ˜¯å¯¹çš„
&lt;ul&gt;
&lt;li&gt;if ä»å¥ä¸­çš„ åŠ¨è¯ ä¸ &lt;strong&gt;ç°åœ¨çš„äº‹å®&lt;/strong&gt; ç›¸å&lt;/li&gt;
&lt;li&gt;è¯´è¯äººè®¤ä¸ºï¼Œif ä»å¥ä¸­ åŠ¨è¯ å‘ç”Ÿçš„æœºç‡éå¸¸ä½ï¼Œæ‰€ä»¥å¦‚æœ if ä»å¥é‡Œæ˜¯å¦å®šå¥ï¼Œé‚£å°†biao&amp;rsquo;s&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;if + ä¸»è¯­ + had done&amp;hellip;ï¼Œä¸»è¯­ + would / should / could / might + have done.
&lt;ul&gt;
&lt;li&gt;if ä»å¥ä¸­çš„ åŠ¨è¯ ä¸ &lt;strong&gt;è¿‡å»çš„äº‹å®&lt;/strong&gt; ç›¸å&lt;/li&gt;
&lt;li&gt;å˜ä½“ï¼Œif + ä¸»è¯­ + could have done ï¼Œæ¯”å¦‚  if you &lt;strong&gt;could have made&lt;/strong&gt; ç­‰ä»·äº if you &lt;strong&gt;had been able to&lt;/strong&gt; make&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å®šè¯­ä»å¥ ä¸ åŒä½è¯­ä»å¥ çš„åŒºåˆ«ï¼š&lt;/p&gt;
&lt;p&gt;ä¸¤è€…éƒ½ä½œè¡¥å……è¯´æ˜ï¼Œä½†å®šè¯­ä»å¥æ˜¯ä¿®é¥°ï¼Œè€ŒåŒä½è¯­ä»å¥æ˜¯ä¸€ä¸ªå®Œæ•´çš„å¥å­è¡¥å……è¯´æ˜ä¸€ä¸ªåè¯ï¼Œå»æ‰è¿æ¥è¯ä¹Ÿæ˜¯å®Œæ•´çš„ï¼Œè€Œå®šè¯­ä»å¥çš„ that / which / who æ˜¯å……å½“å¥å­æˆåˆ†çš„ï¼Œæ¯”å¦‚ä¸»è¯­æˆ–å®¾è¯­ï¼Œä¸èƒ½å»æ‰&lt;/p&gt;
&lt;p&gt;åè¯æ€§ä»å¥ï¼Œä»å¥ä¸€èˆ¬å……å½“åè¯ï¼Œè§£é‡Šåè¯ï¼Œå¸¸ç”¨çš„è¿è¯ï¼šthat / if or whether / å¸¸ç”¨ç‰¹æ®Šç–‘é—®è¯&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å®¾è¯­ä»å¥ï¼š&lt;/p&gt;
&lt;p&gt;He asked (&lt;strong&gt;if&lt;/strong&gt; Mr. Gilbert&amp;rsquo;s operation had been successful) and the doctor told him (&lt;strong&gt;that&lt;/strong&gt; it had been).&lt;/p&gt;
&lt;p&gt;He then asked (&lt;strong&gt;when&lt;/strong&gt; Mr. Gilbert would be allowed to go home)&amp;hellip;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åŒä½è¯­ä»å¥ï¼š&lt;/p&gt;
&lt;p&gt;No one could account for the fact &lt;strong&gt;that&lt;/strong&gt; one of the boxes was extremely heavy.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è¡¨è¯­ä»å¥ï¼š&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¸»è¯­ä»å¥ï¼š&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;It&lt;/strong&gt; seem certain &lt;strong&gt;that their plane would crash.&lt;/strong&gt; è¿™é‡Œä»å¥æŒ‡ä»£çš„æ˜¯it&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å½¢å®¹è¯ä»å¥ï¼Œä»å¥è§£é‡Šå½¢å®¹è¯ï¼Œå¸¸ç”¨è¿æ¥è¯ that / who /which / where / whose / when&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å®šè¯­ä»å¥ï¼š&lt;/p&gt;
&lt;p&gt;Jasper White is one of those rare people (&lt;strong&gt;who&lt;/strong&gt; believe in acient myths.)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;éé™å®šæ€§å®šè¯­ä»å¥&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å‰¯è¯æ€§ä»å¥ï¼Œä»å¥è§£é‡Šå‰¯è¯ï¼Œå¦‚ çŠ¶è¯­ä»å¥ï¼›&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;æ—¶é—´çŠ¶è¯­ä»å¥ï¼šå¸¸ç”¨è¿è¯ï¼šwhen / while / as / before / after / as soon as / til / untilï¼›ç‰¹æ®Šè¿è¯ï¼šever since / since / the moment / no sooner &amp;hellip; than &amp;hellip; / hardly &amp;hellip; when&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åœ°ç‚¹çŠ¶è¯­ä»å¥&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åŸå› çŠ¶è¯­ä»å¥ï¼šå¸¸ç”¨è¿è¯ï¼šbecause / as / for / since&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç›®çš„çŠ¶è¯­ä»å¥ï¼šå¸¸ç”¨è¿è¯ï¼šso that / in order that / that &amp;hellip;ï¼› ç‰¹æ®Šè¿è¯ï¼šin order to / as &amp;hellip; as to&lt;/p&gt;
&lt;p&gt;egï¼šso thatï¼šä»¥ä¾¿ï¼Œä¸ºäº†ï¼Œä¸€èˆ¬ç”¨äºè¿æ¥ä¸¤ä¸ªå¥å­ï¼Œè¡¨ç›®çš„&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç»“æœçŠ¶è¯­ä»å¥ï¼šå¸¸ç”¨è¿è¯ï¼šso &amp;hellip; that / such &amp;hellip; that &amp;hellip;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ¡ä»¶çŠ¶è¯­ä»å¥ï¼šå¸¸ç”¨è¿è¯ï¼šif / unless&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è®©æ­¥çŠ¶è¯­ä»å¥ï¼šå¸¸ç”¨è¿è¯ï¼šalthough / though / even thougt / even if / no matter how / whatever / whoever&amp;hellip;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ¯”è¾ƒçŠ¶è¯­ä»å¥ï¼šas &amp;hellip; as / than&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ–¹å¼çŠ¶è¯­ä»å¥ï¼šas / like / as if / the way&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åˆ†è¯ä½œå®šè¯­&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;doneä½œå®šè¯­&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;è¢«åŠ¨ä¸€èˆ¬&lt;/p&gt;
&lt;p&gt;The taxi is a small airplane &lt;strong&gt;called&lt;/strong&gt; a &amp;lsquo;Pilatus Porter&amp;rsquo;.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è¢«åŠ¨å®Œæˆ&lt;/p&gt;
&lt;p&gt;on a &lt;strong&gt;ploughed&lt;/strong&gt; field&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¸»åŠ¨å®Œæˆ&lt;/p&gt;
&lt;p&gt;a &lt;strong&gt;retired&lt;/strong&gt; captain = a captain who has retired&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;doingä½œå®šè¯­&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ä¸»åŠ¨è¿›è¡Œ&lt;/p&gt;
&lt;p&gt;the &lt;strong&gt;sleeping&lt;/strong&gt; child = the child who is sleeping.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¸»åŠ¨ä¸€èˆ¬&lt;/p&gt;
&lt;p&gt;I like the girl &lt;strong&gt;dancing with that guy&lt;/strong&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åˆ†è¯ä½œçŠ¶è¯­ï¼Œç®€åŒ–çŠ¶è¯­ä»å¥&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ä¸€èˆ¬éœ€è¦&lt;strong&gt;å‰åä¸»è¯­ä¸€è‡´&lt;/strong&gt;ï¼›å»æ‰çŠ¶è¯­ä»å¥çš„ä¸»è¯­ï¼Œè¿è¯å¯ç•™ï¼›ä»å¥çš„åŠ¨è¯å˜æˆåˆ†è¯ï¼›åˆ†è¯æœ‰ä¸¤ç§ï¼Œå¦‚æœä»å¥æ˜¯ä¸»åŠ¨è¿›è¡Œæˆ–è€…ä¸»åŠ¨ä¸€èˆ¬ï¼Œä½¿ç”¨doingï¼Œå¦‚æœä»å¥æ˜¯è¢«åŠ¨å®Œæˆ æˆ– è¢«åŠ¨ä¸€èˆ¬ï¼Œä½¿ç”¨doneï¼›&lt;/p&gt;
&lt;p&gt;åŸå¥ï¼šWhen the baby opened his eyes, he began to cry.&lt;/p&gt;
&lt;p&gt;æ”¹æˆåˆ†è¯çŠ¶è¯­å¼•å¯¼ï¼šOpening his eyes, the baby began to cry.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¦‚æœåˆ†è¯è¦å¼ºè°ƒä»å¥çš„åŠ¨è¯å‘ç”Ÿåœ¨ä¸»å¥åŠ¨ä½œå‰ï¼Œä½¿ç”¨having done&lt;/p&gt;
&lt;p&gt;åŸå¥ï¼šAfter he had completed the book, he had a holiday.&lt;/p&gt;
&lt;p&gt;æ”¹æˆåˆ†è¯çŠ¶è¯­å¼•å¯¼ï¼š(After) Having completed the book, he had a holiday.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¦‚æœæ˜¯å¦å®šçš„ï¼Œä½¿ç”¨ not + åˆ†è¯&lt;/p&gt;
&lt;p&gt;åŸå¥ï¼šBecause i didn&amp;rsquo;t want to wake her, I left the house silently.&lt;/p&gt;
&lt;p&gt;æ”¹æˆåˆ†è¯çŠ¶è¯­å¼•å¯¼ï¼šNot wanting to wake her, I left the house silently.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç‰¹æ®Šçš„ï¼Œbe + å½¢å®¹è¯ + åè¯&lt;/p&gt;
&lt;p&gt;åŸå¥ï¼šMy girlfriend is a doctor, she knows what medicine you should take;&lt;/p&gt;
&lt;p&gt;æ”¹æˆåˆ†è¯çŠ¶è¯­å¼•å¯¼ï¼šï¼ˆBeingï¼‰a doctor, my grilfriend knows what medicine you should take.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;é™å®šæ€§å®šè¯­ä»å¥å’Œéé™å®šæ€§å®šè¯­ä»å¥ï¼Œéƒ½æ˜¯åšè¡¥å……å’Œè¯´æ˜ï¼ŒåŒºåˆ«æ˜¯éé™å®šæ€§å®šè¯­ä»å¥å‰é¢æœ‰é€—å·ï¼Œä¸”å»æ‰è¿™å¥ä¹Ÿæ— æ‰€è°“ï¼Œè€Œé™å®šæ€§å®šè¯­ä»å¥çš„ä¿®é¥°æ˜¯æŒ‡å®šçš„ï¼Œæ¯”å¦‚ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;He has a daugter who works in a hospital. è¡¨ç¤ºæœ‰ä¸€ä¸ªåœ¨åŒ»é™¢å·¥ä½œçš„å¥³å„¿ï¼Œå¯èƒ½ä¹Ÿæœ‰å…¶ä»–å¥³å„¿ï¼Œä½†æ˜¯è¿™é‡Œç‰¹æŒ‡é‚£ä¸ªåœ¨åŒ»é™¢å·¥ä½œçš„&lt;/li&gt;
&lt;li&gt;He has a daugter, who works in a hospital. ï¼ˆ= and she works in a hospitalï¼‰è¡¨ç¤ºæœ‰ä¸€ä¸ªå¥³å„¿ï¼Œè¿™ä¸ªå¥³å„¿æ˜¯åœ¨åŒ»é™¢å·¥ä½œ&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;onlyéƒ¨åˆ†å€’è£…&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;only åœ¨å¥é¦–æ—¶ï¼Œä¸»è°“å¯èƒ½é¢ å€’ï¼Œå±äºè¯­è¨€ä¹ æƒ¯ï¼Œæœ‰æ—¶å’Œthanä¸€èµ·å‡ºç°ï¼Œonly than&amp;hellip;&lt;/p&gt;
&lt;p&gt;Only on one occasion &lt;strong&gt;have I&lt;/strong&gt; ever felt frightened.&lt;/p&gt;
&lt;p&gt;Onlythen &lt;strong&gt;did I&lt;/strong&gt; understand what she meant.&lt;/p&gt;
&lt;p&gt;Only after her death &lt;strong&gt;was I&lt;/strong&gt; able  to do that.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;only è¯´æ˜ä¸»è¯­ï¼Œä¸»è°“ä¸å€’è£…&lt;/p&gt;
&lt;p&gt;Only policemen can come in.&lt;/p&gt;
&lt;p&gt;Only my mother really understands me.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;not only + éƒ¨åˆ†å€’è£…ï¼ˆç®€å•ç†è§£ä¸ºå°†åŸå¥æ”¹æˆä¸€èˆ¬ç–‘é—®å¥ï¼‰ï¼Œèµ·åˆ°å¼ºè°ƒçš„ä½œç”¨ï¼Œegï¼š&lt;/p&gt;
&lt;p&gt;And &lt;strong&gt;you will not only&lt;/strong&gt; have to pay him to do this, far more important, you will have to agree with him. éƒ¨åˆ†å€’è£…ä¹‹åï¼š&lt;/p&gt;
&lt;p&gt;And &lt;strong&gt;not only will you&lt;/strong&gt; have  to pay him to do this, far more important, you will have to agree with him.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
</description>
        </item>
        <item>
        <title>Redis</title>
        <link>http://nixum.cc/p/redis/</link>
        <pubDate>Sun, 09 Aug 2020 00:00:00 +0000</pubDate>
        
        <guid>http://nixum.cc/p/redis/</guid>
        <description>&lt;p&gt;[TOC]&lt;/p&gt;
&lt;h1 id=&#34;æ•°æ®ç±»å‹åŠç»“æ„&#34;&gt;æ•°æ®ç±»å‹åŠç»“æ„&lt;/h1&gt;
&lt;p&gt;Redisé‡Œå­˜çš„keyå’Œvalueéƒ½æ˜¯äºŒè¿›åˆ¶æ•°æ®ï¼Œå³ byteæ•°ç»„ï¼Œæœ¬èº«æ˜¯äºŒè¿›åˆ¶å®‰å…¨çš„ï¼ˆäºŒè¿›åˆ¶å®‰å…¨çš„æ„æ€æ˜¯ï¼Œå­˜è¿›å»æ€ä¹ˆæ ·ï¼Œå–å‡ºæ¥å°±æ˜¯æ€ä¹ˆæ ·ï¼Œç¨‹åºä¸ä¼šå¯¹åŸå§‹æ•°æ®è¿›è¡Œä»»æ„çš„æ“ä½œï¼‰&lt;/p&gt;
&lt;h2 id=&#34;æ•°æ®ç±»å‹&#34;&gt;æ•°æ®ç±»å‹&lt;/h2&gt;
&lt;p&gt;å…·ä½“çš„åˆ†ä¸º5ç§åŸºæœ¬ç±»å‹å’Œ3ç§ç‰¹æ®Šç±»å‹ï¼š&lt;/p&gt;
&lt;p&gt;Stringã€List(ä¸€èˆ¬å½“æˆé˜Ÿåˆ—ï¼Œå°½é‡å°‘ä½¿ç”¨éšæœºè¯»å†™)ã€Hashã€Setã€ZSet&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;String&lt;/strong&gt;ï¼šç®€å•åŠ¨æ€å­—ç¬¦ä¸²(SDS)&lt;/p&gt;
&lt;p&gt;åœºæ™¯ï¼šç¼“å­˜ï¼ˆå¯ä»¥ä½¿ç”¨jsonã€protobufç­‰è¿›è¡Œåºåˆ—åŒ–ååºåˆ—åŒ–ã€ä¹Ÿå¯ä»¥é€šè¿‡keyæ¥åˆ†ç¦»ç¼“å­˜å¯¹è±¡çš„å±æ€§ï¼Œå®ç°hashçš„æ•ˆæœï¼Œåªæ˜¯æ˜¯å•å­—æ®µç½¢äº†ï¼‰ã€tokenã€é™æµã€åˆ†å¸ƒå¼id&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;List&lt;/strong&gt;ï¼šå‹ç¼©åˆ—è¡¨ï¼ˆå…ƒç´ æ•°é‡å°äº512ï¼Œä¸”æ‰€æœ‰å…ƒç´ çš„é•¿åº¦éƒ½å°äº64å­—èŠ‚ï¼‰ + åŒå‘é“¾è¡¨ï¼Œé«˜ç‰ˆæœ¬æ˜¯å¿«è¡¨ï¼ˆå…¶ä»–æƒ…å†µä½¿ç”¨ï¼‰&lt;/p&gt;
&lt;p&gt;åœºæ™¯ï¼šç”¨æˆ·æ¶ˆæ¯æ—¶é—´çº¿ã€æ¶ˆæ¯é˜Ÿåˆ—&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Hash&lt;/strong&gt;ï¼šå‹ç¼©åˆ—è¡¨ï¼ˆå…ƒç´ æ•°é‡å°äº512ï¼Œä¸”keyå’Œvalueå­—ç¬¦ä¸²é•¿åº¦éƒ½å°äº64å­—èŠ‚ï¼‰ + å“ˆå¸Œè¡¨ï¼ˆå…¶ä»–æƒ…å†µä½¿ç”¨ï¼‰&lt;/p&gt;
&lt;p&gt;åœºæ™¯ï¼šå­˜å‚¨å¯¹è±¡ç¼“å­˜ï¼ˆå¯ä»¥æ›´æ–¹ä¾¿getã€setå¯¹åº”å­—æ®µï¼‰ã€æ ¹æ®keyè¿›è¡Œç»Ÿè®¡&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Set&lt;/strong&gt;ï¼šæ•°ç»„ï¼ˆå¸¦æœ‰ç¼–ç ç±»å‹å­—æ®µï¼Œæ‰€ä»¥å…ƒç´ å¯ä»¥ä½¿ç”¨æ•´å‹è¡¨ç¤ºï¼Œå°‘äº512ä¸ªæ—¶ä½¿ç”¨ï¼‰+ å“ˆå¸Œè¡¨ï¼ˆkeyä¸ºsetä¸­çš„å…ƒç´ ï¼Œvalueä¸ºnullï¼Œå…¶ä»–æƒ…å†µä½¿ç”¨ï¼‰&lt;/p&gt;
&lt;p&gt;åœºæ™¯ï¼šäº¤é›†ã€å¹¶é›†ã€ç‚¹èµã€ç­¾åˆ°ã€éšæœºå¼¹å‡ºè·å–å…ƒç´ &lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ZSet&lt;/strong&gt;ï¼šå‹ç¼©åˆ—è¡¨ï¼ˆå…ƒç´ å°äº128ä¸ªï¼Œä¸”æ‰€æœ‰å…ƒç´ çš„é•¿åº¦å°äº64å­—èŠ‚æ—¶ä½¿ç”¨ï¼‰ + è·³è¡¨ ï¼ˆå…¶ä»–æƒ…å†µä½¿ç”¨ï¼‰&lt;/p&gt;
&lt;p&gt;åœºæ™¯ï¼šæ’è¡Œæ¦œ&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦å¤–ä¸‰ç§æ‰©å±•ç±»å‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Bitmap&lt;/strong&gt;ï¼šä½å­˜å‚¨ï¼ŒåŸºäºStringï¼ŒåŸç†ï¼šStringç±»å‹ä¼šä¿å­˜äºŒè¿›åˆ¶å­—èŠ‚æ•°ç»„ï¼Œåªæœ‰0å’Œ1ä¸¤ä¸ªå€¼ï¼Œå¯¹äºè¿™ä¸ªå­—èŠ‚æ•°ç»„çš„æ¯ä¸ªbitæ¥è¡¨ç¤ºä¸€ä¸ªå…ƒç´ çš„äºŒå€¼çŠ¶æ€ï¼›&lt;/p&gt;
&lt;p&gt;åœºæ™¯ï¼šäºŒå€¼ç»Ÿè®¡ï¼Œå¦‚ç­¾åˆ°ç»Ÿè®¡ã€è®°å½•æ¯ä¸ªæœˆç­¾åˆ°æƒ…å†µã€åˆ¤æ–­ç”¨æˆ·ç™»å½•çŠ¶æ€&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;HyperLogLog&lt;/strong&gt;ï¼šåŸºæ•°ç»Ÿè®¡ï¼Œç±»ä¼¼setï¼Œä¸æ–­å¾€é‡Œaddå€¼ï¼Œç„¶ååˆ¤æ–­æœ‰æ€»æ•°é‡ï¼›ä¸»è¦ä½œç”¨æ˜¯ä½¿ç”¨å°‘é‡å›ºå®šçš„å†…å­˜ï¼ˆ12KBå†…å­˜å³å¯ç»Ÿè®¡2^64ä¸ªä¸åŒå…ƒç´ ï¼‰å»å­˜å‚¨å¹¶è¯†åˆ«æœ‰å¤§é‡å…ƒç´ çš„é›†åˆä¸­çš„å”¯ä¸€å…ƒç´ ï¼Œèƒ½å¿«é€Ÿç®—å‡ºé›†åˆå†…çš„å…ƒç´ ä¸ªæ•°ï¼Œè¯¯å·®ç‡0.81%ï¼›ç‰ˆæœ¬2.8.9ä¹‹åæ‰æœ‰&lt;/p&gt;
&lt;p&gt;åœºæ™¯ï¼šç™¾ä¸‡çº§åˆ«ç½‘ç»œçš„UVè®¡æ•°&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Geo&lt;/strong&gt;ï¼šæ¨ç®—åœ°ç†ä½ç½®ï¼Œæ¯”å¦‚ä¸¤åœ°ä¹‹é—´çš„è·ç¦»ï¼Œæ–¹åœ†å‡ é‡Œçš„äººï¼›ç‰ˆæœ¬3.2ä¹‹åæ‰æœ‰&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Stream&lt;/strong&gt;ï¼š5.0ä¹‹åçš„ç‰ˆæœ¬æ‰æœ‰ï¼ŒStreamä¼šåœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨ &lt;code&gt;xadd&lt;/code&gt; æŒ‡ä»¤è¿½åŠ æ¶ˆæ¯æ—¶è‡ªåŠ¨åˆ›å»ºã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Consumer Group&lt;/code&gt;ï¼šæ¶ˆè´¹ç»„ï¼Œä¸€ä¸ªæ¶ˆè´¹ç»„æœ‰å¤šä¸ªæ¶ˆè´¹è€…ï¼Œè¿™äº›æ¶ˆè´¹è€…æ˜¯ç«äº‰å…³ç³»ï¼›&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Last_delivered_id&lt;/code&gt;ï¼šæ¸¸æ ‡ï¼Œæ¯ä¸ªæ¶ˆè´¹ç»„çš„æ¸¸æ ‡ï¼Œç»„å†…ä»»æ„ä¸€ä¸ªæ¶ˆè´¹è€…è¯»å–äº†æ¶ˆæ¯éƒ½ä¼šä½¿æ¸¸æ ‡å‘å‰ç§»åŠ¨ï¼›&lt;/li&gt;
&lt;li&gt;&lt;code&gt;pending_ids&lt;/code&gt;ï¼šæ¶ˆè´¹è€…çš„çŠ¶æ€å˜é‡ï¼Œç”¨äºç»´æŠ¤æ¶ˆè´¹è€…æœªç¡®è®¤çš„idï¼Œè®°å½•å½“å‰å·²ç»è¢«å®¢æˆ·ç«¯è¯»å–ä½†è¿˜æ²¡æœ‰è¢«ACKçš„æ¶ˆæ¯ã€‚å¦‚æœå®¢æˆ·ç«¯æ²¡æœ‰ACKï¼Œè¿™ä¸ªå˜é‡é‡Œé¢çš„æ¶ˆæ¯IDä¼šè¶Šæ¥è¶Šå¤šï¼Œä¸€æ—¦æŸä¸ªæ¶ˆæ¯è¢«ACKï¼Œå®ƒå°±å¼€å§‹å‡å°‘ï¼Œç”¨æ¥ç¡®ä¿å®¢æˆ·ç«¯è‡³å°‘æ¶ˆè´¹äº†æ¶ˆæ¯ä¸€æ¬¡ï¼Œè€Œä¸ä¼šåœ¨ç½‘ç»œä¼ è¾“çš„ä¸­é€”ä¸¢å¤±äº†æ²¡å¤„ç†ã€‚&lt;/li&gt;
&lt;li&gt;æ¶ˆæ¯IDï¼šç»„æˆæ–¹å¼&lt;code&gt;æ¯«ç§’çº§æ—¶é—´æˆ³ - åºå·&lt;/code&gt;ï¼Œæ¶ˆæ¯IDä¹Ÿå¯ä»¥è‡ªå®šä¹‰ï¼Œä½†å¿…é¡»æ˜¯æ•´æ•°-æ•´æ•°ï¼Œä¸”èƒ½åé¢åŠ å…¥çš„æ¶ˆæ¯IDè¦å¤§äºå‰é¢çš„æ¶ˆæ¯IDã€‚Redisæœ¬èº«ä¼šè®°å½• &lt;code&gt;lastest_generated_id&lt;/code&gt;ï¼Œé˜²æ­¢æ—¶é—´å›æ‹¨å¯¼è‡´IDé—®é¢˜ï¼›&lt;/li&gt;
&lt;li&gt;æ¶ˆæ¯å†…å®¹ï¼šé”®å€¼å¯¹ï¼Œç±»ä¼¼Hashçš„ç»“æ„ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/Redis_Stream.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/Redis_Stream.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;h2 id=&#34;åº•å±‚æ•°æ®ç»“æ„&#34;&gt;åº•å±‚æ•°æ®ç»“æ„&lt;/h2&gt;
&lt;p&gt;Redisæ‰€æœ‰ç±»å‹æœ‰ä¸€ä¸ªé¡¶å±‚çš„æ•°æ®ç»“æ„å«RedisObjectï¼Œè¿™ä¸ªRedisObjectåº•å±‚å¯¹åº”ç€å…·ä½“å¯¹è±¡ç±»å‹å’Œå…¶ç¼–ç æ–¹å¼ã€‚&lt;/p&gt;
&lt;p&gt;ä¹‹æ‰€ä»¥æœ‰RedisObjectå¯¹è±¡ï¼Œæ˜¯å› ä¸ºæ¯ç§ä¸åŒçš„æ•°æ®ç±»å‹æœ‰ä¸åŒçš„ç¼–ç æ–¹å¼å’Œç»“æ„ï¼ŒRediså¿…é¡»è®©æ¯ä¸ªé”®éƒ½å¸¦æœ‰ç±»å‹ä¿¡æ¯ï¼Œä½¿å¾—ç¨‹åºå¯ä»¥æ£€æŸ¥é”®çš„ç±»å‹ï¼Œè¿˜éœ€è¦æ ¹æ®æ•°æ®ç±»å‹çš„ä¸åŒç¼–ç è¿›è¡Œ&lt;strong&gt;å¤šæ€&lt;/strong&gt;å¤„ç†ã€‚&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚ï¼šSADDå‘½ä»¤åªèƒ½ç”¨äºSetï¼ŒLPUSHå‘½ä»¤åªèƒ½ç”¨äºListï¼Œè€ŒDELã€TTLåˆèƒ½ç”¨äºæ‰€æœ‰é”®ï¼Œè¦æ­£ç¡®å®ç°è¿™äº›å‘½ä»¤ï¼Œå°±éœ€è¦ä¸ºä¸åŒç±»å‹çš„é”®è®¾ç½®ä¸åŒçš„å¤„ç†æ–¹å¼ï¼›å¦å¤–ï¼ŒåŒä¸€ç§æ•°æ®ç±»å‹å¯èƒ½ç”±ä¸åŒçš„æ•°æ®ç»“æ„å®ç°ï¼Œæ¯”å¦‚Listï¼Œåº•å±‚å¯èƒ½æ˜¯å‹ç¼©åˆ—è¡¨æˆ–è€…åŒå‘é“¾è¡¨ï¼Œå› æ­¤è¿˜éœ€è¦çŸ¥é“æ•°æ®ç±»å‹çš„ç¼–ç æ–¹å¼ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;k&#34;&gt;typedef&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;redisObject&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// ç±»å‹ï¼Œå¦‚Stringã€List
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;kt&#34;&gt;unsigned&lt;/span&gt; &lt;span class=&#34;nl&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// ç¼–ç æ–¹å¼ï¼šå¦‚SDSã€å‹ç¼©åˆ—è¡¨ã€è·³è¡¨ç­‰
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;kt&#34;&gt;unsigned&lt;/span&gt; &lt;span class=&#34;nl&#34;&gt;encoding&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// LRU - 24ä½, è®°å½•æœ€åä¸€æ¬¡è®¿é—®æ—¶é—´ï¼ˆç›¸å¯¹äºlru_clockï¼‰; æˆ–è€… LFUï¼ˆæœ€å°‘ä½¿ç”¨çš„æ•°æ®ï¼š8ä½é¢‘ç‡ï¼Œ16ä½è®¿é—®æ—¶é—´ï¼‰
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;kt&#34;&gt;unsigned&lt;/span&gt; &lt;span class=&#34;nl&#34;&gt;lru&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;LRU_BITS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// LRU_BITS: 24
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// å¼•ç”¨è®¡æ•°ï¼Œæ–°åˆ›å»ºå¯¹è±¡æ—¶å€¼ä¸º1ï¼Œå½“å¯¹è¯¥å¯¹è±¡è¿›è¡Œå…±äº«æ—¶å€¼+1ï¼Œä½¿ç”¨å®Œä¸€ä¸ªå¯¹è±¡åå€¼-1ï¼Œ=0æ—¶è¢«GCå›æ”¶
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;refcount&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// æŒ‡å‘åº•å±‚æ•°æ®ç»“æ„å®ä¾‹ï¼Œå…·ä½“çš„å®ä¾‹ï¼Œç”±typeå’Œencodingå†³å®š
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ptr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;

&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;robj&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;å½“æ‰§è¡Œä¸€ä¸ªå¤„ç†æ•°æ®ç±»å‹å‘½ä»¤çš„æ—¶å€™ï¼Œredisæ‰§è¡Œä»¥ä¸‹æ­¥éª¤&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ ¹æ®ç»™å®šçš„keyï¼Œåœ¨æ•°æ®åº“å­—å…¸ä¸­æŸ¥æ‰¾å’Œä»–ç›¸å¯¹åº”çš„redisObjectï¼Œå¦‚æœæ²¡æ‰¾åˆ°ï¼Œå°±è¿”å›NULLï¼›&lt;/li&gt;
&lt;li&gt;æ£€æŸ¥redisObjectçš„typeå±æ€§å’Œæ‰§è¡Œå‘½ä»¤æ‰€éœ€çš„ç±»å‹æ˜¯å¦ç›¸ç¬¦ï¼Œå¦‚æœä¸ç›¸ç¬¦ï¼Œè¿”å›ç±»å‹é”™è¯¯ï¼›&lt;/li&gt;
&lt;li&gt;æ ¹æ®redisObjectçš„encodingå±æ€§æ‰€æŒ‡å®šçš„ç¼–ç ï¼Œé€‰æ‹©åˆé€‚çš„æ“ä½œå‡½æ•°æ¥å¤„ç†åº•å±‚çš„æ•°æ®ç»“æ„ï¼›&lt;/li&gt;
&lt;li&gt;è¿”å›æ•°æ®ç»“æ„çš„æ“ä½œç»“æœä½œä¸ºå‘½ä»¤çš„è¿”å›å€¼&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;p&gt;Redisæœ¬èº«è¿˜ä¼šé¢„åˆ†é…ä¸€äº›å€¼å¯¹è±¡ï¼Œæ¯”å¦‚å“åº”ç»“æœOKã€ERRORï¼Œè¿˜æœ‰åŒ…æ‹¬0åœ¨å†…ï¼Œæ‰€æœ‰å°äºREDIS_SHARED_INTEGERSï¼ˆé»˜è®¤å€¼æ˜¯10kï¼Œ&lt;code&gt;[0 - 9999]&lt;/code&gt;ï¼‰çš„æ‰€æœ‰æ•´æ•°ï¼Œå…±äº«å¯¹è±¡åªèƒ½è¢«å­—å…¸æˆ–åŒå‘é“¾è¡¨è¿™ç±»å¸¦æœ‰æŒ‡é’ˆçš„æ•°æ®ç»“æœä½¿ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/RedisObject.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/RedisObject.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;h3 id=&#34;ç®€å•åŠ¨æ€å­—ç¬¦ä¸²---sds&#34;&gt;ç®€å•åŠ¨æ€å­—ç¬¦ä¸² - SDS&lt;/h3&gt;
&lt;p&gt;Redisçš„Stringç±»å‹åº•å±‚æœ‰ä¸¤ç§ä¿å­˜å½¢å¼ï¼Œå½“ä¿å­˜çš„æ˜¯64ä½æœ‰ç¬¦å·æ•´æ•°æ—¶ï¼ŒStringç±»å‹ä¼šä¿å­˜ä¸ºä¸€ä¸ª9å­—èŠ‚çš„Longç±»å‹æ•´æ•°ï¼›å½“ä¿å­˜çš„æ•°æ®åŒ…å«å­—ç¬¦æ—¶ï¼ŒStringç±»å‹å°±ä¼šç”¨ç®€å•åŠ¨æ€å­—ç¬¦ä¸²SDSã€‚&lt;/p&gt;
&lt;p&gt;ç®€å•åŠ¨æ€å­—ç¬¦ä¸²SDSç”±ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;buf&lt;/code&gt;ï¼šæ˜¯å­—èŠ‚æ•°ç»„ï¼Œä¿å­˜å®é™…æ•°æ®ï¼Œç»“æŸæ ‡å¿—ä½æ˜¯&amp;quot;/0&amp;quot;ï¼›&lt;/li&gt;
&lt;li&gt;&lt;code&gt;len&lt;/code&gt;ï¼šè¡¨ç¤ºbufå·²ç”¨é•¿åº¦ï¼Œå 4å­—èŠ‚ï¼›SDSä¸ä½¿ç”¨ &amp;ldquo;/0&amp;rdquo; æ¥åˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦ç»“æŸï¼Œè€Œæ˜¯é€šè¿‡ &lt;code&gt;len&lt;/code&gt; æ¥åˆ¤æ–­ï¼›&lt;code&gt;len&lt;/code&gt; åŒæ—¶ä¹Ÿèƒ½é˜²æ­¢ç¼“å†²åŒºæº¢å‡ºï¼›&lt;/li&gt;
&lt;li&gt;&lt;code&gt;alloc&lt;/code&gt;ï¼šè¡¨ç¤ºbufçš„å®é™…åˆ†é…é•¿åº¦ï¼Œä¸€èˆ¬å¤§äºlenï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;code&gt;len&lt;/code&gt;å’Œ&lt;code&gt;alloc&lt;/code&gt;ä¸¤ä¸ªå±æ€§ï¼Œå¯¹äºä¿®æ”¹å­—ç¬¦ä¸²SDSå®ç°äº†ç©ºé—´é¢„åˆ†é…å’Œæƒ°æ€§ç©ºé—´é‡Šæ”¾ä¸¤ç§ç­–ç•¥ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ç©ºé—´é¢„åˆ†é…ï¼šå½“å­—ç¬¦ä¸²è¿›è¡Œæ‰©å±•æ—¶ï¼Œæ‰©å±•çš„å†…å­˜ä¼šæ¯”å®é™…éœ€è¦çš„å¤šï¼Œå‡å°‘è¿ç»­å­—ç¬¦ä¸²å¢é•¿å¸¦æ¥çš„å†…å­˜é¢‘ç¹åˆ†é…ã€‚&lt;/p&gt;
&lt;p&gt;å½“å­—ç¬¦ä¸²é•¿åº¦å°äº 1M æ—¶ï¼Œæ‰©å®¹æ—¶åŒå€æ‰©å®¹ï¼Œå¦‚æœè¶…è¿‡ 1Mï¼Œæ‰©å®¹ä¸€æ¬¡åªä¼šå¤šæ‰© 1M çš„ç©ºé—´ï¼Œé»˜è®¤çš„æœ€å¤§é•¿åº¦æ˜¯ 512Mï¼Œå¯é€šè¿‡é…ç½®æ–‡ä»¶ä¿®æ”¹ã€‚&lt;/p&gt;
&lt;p&gt;æ‰§è¡ŒAppendå‘½ä»¤çš„å­—ç¬¦ä¸²ä¼šå¸¦æœ‰é¢„åˆ†é…çš„ç©ºé—´ï¼Œè¿™äº›é¢„åˆ†é…çš„ç©ºé—´ä¸ä¼šè¢«é‡Šæ”¾ï¼Œé™¤éå¯¹åº”çš„keyè¢«åˆ é™¤ï¼Œæˆ–è€…é‡å¯åé‡æ–°è½½å…¥ï¼Œæ‰ä¼šåˆ é™¤é¢„åˆ†é…çš„ç©ºé—´ï¼Œå¦‚æœæœ‰å­˜åœ¨å¤§é‡é¢„åˆ†é…çš„å­—ç¬¦ä¸²ï¼Œå¯ä»¥ä¿®æ”¹é…ç½®ä½¿å…¶å®šæ—¶é‡Šæ”¾é¢„åˆ†é…çš„ç©ºé—´ï¼Œæ›´æœ‰æ•ˆçš„ä½¿ç”¨å†…å­˜ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æƒ°æ€§ç©ºé—´é‡Šæ”¾ï¼šå½“å­—ç¬¦ä¸²è¿›è¡Œç¼©çŸ­æ—¶ï¼Œä¸ä¼šä½¿ç”¨å†…å­˜é‡æ–°åˆ†é…çš„æ–¹å¼æ¥å›æ”¶å¤šä½™å­—èŠ‚ï¼Œè€Œåªæ˜¯ç”¨&lt;code&gt;alloc&lt;/code&gt; è®°å½•è¿™äº›å­—èŠ‚çš„æ•°é‡ï¼Œç­‰å¾…åç»­ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;RedisObjectåŒ…å«äº†8ä¸ªå­—èŠ‚çš„å…ƒæ•°æ®å’Œä¸€ä¸ª8å­—èŠ‚æŒ‡é’ˆï¼ŒæŒ‡é’ˆæŒ‡å‘å…·ä½“çš„æ•°æ®ç±»å‹çš„å®é™…æ•°æ®æ‰€åœ¨ï¼Œ&lt;/p&gt;
&lt;p&gt;å¯¹äºStringç±»å‹çš„RedisObjectï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å½“ä¿å­˜çš„æ˜¯Longç±»å‹æ•´æ•°æ—¶ï¼ŒRedisObjectä¸­çš„æŒ‡é’ˆç›´æ¥å°±æ˜¯æ•´æ•°æ•°æ®ï¼Œä¸ç”¨é¢å¤–çš„æŒ‡é’ˆæŒ‡å‘æ•´æ•°ï¼›&lt;/li&gt;
&lt;li&gt;å½“ä¿å­˜çš„æ˜¯å­—ç¬¦ä¸²æ—¶ï¼Œå¦‚æœå­—ç¬¦ä¸²&amp;lt;=44å­—èŠ‚ï¼ŒRedisObjectä¸­å…ƒæ•°æ®ï¼ŒæŒ‡é’ˆå’ŒSDSæ˜¯ä¸€å—è¿ç»­çš„å†…å­˜åŒºåŸŸï¼Œé¿å…å†…å­˜ç¢ç‰‡ï¼›&lt;/li&gt;
&lt;li&gt;å½“ä¿å­˜çš„æ˜¯å­—ç¬¦ä¸²æ—¶ï¼Œå¦‚æœå­—ç¬¦ä¸²&amp;gt;44å­—èŠ‚ï¼ŒRedisObjectä¼šç»™SDSåˆ†é…ç‹¬ç«‹çš„ç©ºé—´ï¼Œå¹¶ç”¨æŒ‡é’ˆæŒ‡å‘SDSï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/Redis_String_RedisObject.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/Redis_String_RedisObject.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			alt=&#34;Redis String RedisObject&#34;&gt;
	&lt;/a&gt;
	
	&lt;figcaption&gt;Redis String RedisObject&lt;/figcaption&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;å½“ä½¿ç”¨Stringç±»å‹æ—¶ï¼Œä¸”valueçš„ç±»å‹æ˜¯Stringæ—¶ï¼Œå¦‚æœvalueçš„é•¿åº¦å¤ªå°ï¼Œå¯èƒ½ä¼šå‡ºç°å…ƒæ•°æ®çš„å¤§å°æ¯”æ•°æ®æœ¬èº«çš„å¤§å°è¿˜å¤§ï¼Œé€ æˆé¢å¤–çš„å†…å­˜å¼€é”€ï¼Œå¦‚æœèƒ½æ›¿æ¢æˆLongç±»å‹ï¼Œå®é™…å­˜å‚¨çš„å¤§å°ä¼šå¤§å¤§é™ä½ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å“ˆå¸Œè¡¨---dict&#34;&gt;å“ˆå¸Œè¡¨ - Dict&lt;/h3&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/Redis_%e5%85%a8%e5%b1%80%e5%93%88%e5%b8%8c%e8%a1%a8.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/Redis_%e5%85%a8%e5%b1%80%e5%93%88%e5%b8%8c%e8%a1%a8.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			alt=&#34;Redis Dict&#34;&gt;
	&lt;/a&gt;
	
	&lt;figcaption&gt;Redis Dict&lt;/figcaption&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;æ— è®ºå€¼æ˜¯ä»€ä¹ˆç±»å‹çš„ï¼Œæ‰€æœ‰çš„é”®å€¼å¯¹ä¼šä¿å­˜åœ¨&lt;strong&gt;å…¨å±€å“ˆå¸Œè¡¨&lt;/strong&gt;ä¸­ï¼Œä¾¿äºå¿«é€Ÿæ‰¾åˆ°å¯¹åº”çš„Keyï¼Œå“ˆå¸Œæ¡¶åªä¼šä¿å­˜é”®å€¼å¯¹çš„æŒ‡é’ˆã€‚å…¨å±€å“ˆå¸Œè¡¨ä¸­çš„æ¡¶æ¯ä¸ªå…ƒç´ entryç”±ä¸‰ä¸ª8å­—èŠ‚æŒ‡é’ˆç»„æˆï¼Œåˆ†åˆ«ä¸ºkeyã€valueã€nextï¼Œä½†å®é™…ä¼šå 32å­—èŠ‚ï¼Œå› ä¸ºå†…å­˜åˆ†é…åº“jemallocä¼šåˆ†é…æœ€æ¥è¿‘24çš„2çš„å¹‚æ¬¡æ•°ï¼Œæ‰€ä»¥æ˜¯32ï¼Œä»¥å‡å°‘é¢‘ç¹çš„åˆ†é…æ¬¡æ•°ã€‚&lt;/p&gt;
&lt;p&gt;å› æ­¤ï¼Œå³ä½¿Redisé‡Œå­˜åœ¨å¤§é‡æ•°æ®ï¼Œä¹Ÿä¸å½±å“æŸ¥æ‰¾çš„é€Ÿåº¦ï¼Œæ¯•ç«Ÿéƒ½æ˜¯æ ¹æ®Keyè¿›è¡Œhashå°±èƒ½æ‰¾åˆ°å¯¹åº”çš„Valueï¼ŒçœŸæ­£æœ‰å½±å“çš„æ˜¯å“ˆå¸Œè¡¨çš„åœ¨è§£å†³å“ˆå¸Œå†²çªå’Œrehashæ—¶å¸¦æ¥çš„é˜»å¡ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Redisçš„å“ˆå¸Œè¡¨ä½¿ç”¨æ‹‰é“¾æ³•è§£å†³å“ˆå¸Œå†²çªï¼Œå¹¶é€šè¿‡ä¸¤ä¸ªå…¨å±€å“ˆå¸Œè¡¨åŠ å¿«rehashçš„æ“ä½œã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/Redis_Dict.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/Redis_Dict.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			alt=&#34;Redis Dict&#34;&gt;
	&lt;/a&gt;
	
	&lt;figcaption&gt;Redis Dict&lt;/figcaption&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;å¤„ç†å…¨å±€å“ˆå¸Œè¡¨æœ‰è¿™ç§æ“ä½œï¼ŒHashçš„æ•°æ®ç»“æ„ä¹Ÿæ˜¯è¿™æ ·çš„æ“ä½œï¼Œæœ¬è´¨æ˜¯ä¸€æ ·çš„ã€‚&lt;/p&gt;
&lt;h4 id=&#34;rehashè§¦å‘æ¡ä»¶&#34;&gt;rehashè§¦å‘æ¡ä»¶&lt;/h4&gt;
&lt;p&gt;å½“Redisç”ŸæˆRDBå’ŒAOFé‡å†™æ—¶ï¼Œå“ˆå¸Œè¡¨ä¸ä¼šè¿›è¡Œrehashã€‚&lt;/p&gt;
&lt;p&gt;è£…è½½å› å­ï¼šå“ˆå¸Œè¡¨ä¸­æ‰€æœ‰entryçš„ä¸ªæ•° é™¤ä»¥ å“ˆå¸Œè¡¨çš„å“ˆå¸Œæ¡¶ä¸ªæ•°ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å½“è£…è½½å› å­&amp;gt;= 1ï¼Œä¸”å“ˆå¸Œè¡¨è¢«å…è®¸rehashï¼Œå³æ­¤æ—¶æ²¡æœ‰è¿›è¡ŒRDBå’ŒAOFé‡å†™ï¼Œå³æ²¡æœ‰æ‰§è¡Œæˆ–æ­£åœ¨æ‰§è¡Œ &lt;code&gt;BGSAVE&lt;/code&gt; å‘½ä»¤æˆ–è€… &lt;code&gt;BGREWRITEAOF&lt;/code&gt; å‘½ä»¤&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å½“è£…è½½å› å­&amp;gt;= 5ï¼Œå› ä¸ºæ­¤æ—¶æ•°æ®é‡å·²è¿œè¿œå¤§äºå“ˆå¸Œæ¡¶çš„ä¸ªæ•°äº†ï¼Œæ­¤æ—¶ä¼šç«‹é©¬è¿›è¡Œrehashï¼Œä¸ç®¡æ˜¯å¦æœ‰æ²¡æœ‰åœ¨æ‰§è¡ŒRDBå¿«ç…§æˆ–AOFé‡å†™ï¼Œéƒ½ä¼šå¼ºåˆ¶è¿›è¡Œrehashæ“ä½œï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;rehashè¿‡ç¨‹&#34;&gt;rehashè¿‡ç¨‹&lt;/h4&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;é»˜è®¤ä½¿ç”¨å“ˆå¸Œè¡¨1ï¼Œæ­¤æ—¶å“ˆå¸Œè¡¨2è¿˜æ²¡æœ‰è¢«åˆ†é…ç©ºé—´&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å½“æ•°æ®å¢å¤šè‡³éœ€è¦rehashæ—¶ï¼Œä¸ºå“ˆå¸Œè¡¨2åˆ†é…ç©ºé—´ï¼Œå¤§å°ä¼šæ¯”å“ˆå¸Œè¡¨1å¤§ï¼Œæ¯”å¦‚&lt;strong&gt;å¤§ä¸¤å€&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æŠŠå“ˆå¸Œè¡¨1ä¸­çš„æ•°æ®é‡æ–°æ˜ å°„å¹¶æ‹·è´åˆ°å“ˆå¸Œè¡¨2ä¸­&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ¸è¿›å¼rehash&lt;/strong&gt;ï¼šè§£å†³å¤§é‡æ•°æ®åœ¨å“ˆå¸Œè¡¨1å’Œ2ä¹‹é—´æ‹·è´ï¼Œä¼šå¯¼è‡´Redisçº¿ç¨‹é˜»å¡çš„é—®é¢˜ï¼ˆå› ä¸ºå•çº¿ç¨‹)ã€‚&lt;/p&gt;
&lt;p&gt;3.1 æ‹·è´æ•°æ®æ—¶ï¼ŒRedisä»ç„¶æ­£å¸¸å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚ï¼Œæ¯å¤„ç†ä¸€ä¸ªè¯·æ±‚æ—¶ï¼Œä»å“ˆå¸Œè¡¨1ä¸­çš„ç¬¬ä¸€ä¸ªç´¢å¼•ä½ç½®å¼€å§‹ï¼Œé¡ºä¾¿å°†è¯¥ç´¢å¼•ä½ç½®ä¸Šçš„æ‰€æœ‰entriesæ‹·è´åˆ°å“ˆå¸Œè¡¨2ä¸­ï¼›&lt;/p&gt;
&lt;p&gt;3.2 ç­‰å¾…å¤„ç†ä¸‹ä¸€ä¸ªè¯·æ±‚æ—¶ï¼Œå†é¡ºå¸¦æ‹·è´å“ˆå¸Œè¡¨1ä¸­è¯¥ç´¢å¼•ä¸‹ä¸€ä¸ªç´¢å¼•ä½ç½®çš„entriesåˆ°å“ˆå¸Œè¡¨2ä¸­ï¼›&lt;/p&gt;
&lt;p&gt;é€šè¿‡è¿™ä¸¤ç§æ–¹å¼ï¼Œå°†ä¸€æ¬¡æ€§çš„å¤§é‡æ‹·è´åˆ†æ•£åˆ°æ¯æ¬¡è¯·æ±‚å’Œç­‰å¾…é—´éš™ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;3.3 æ­¤å¤–Redisæœ¬èº«ä¹Ÿæœ‰ä¸€ä¸ª&lt;strong&gt;å®šæ—¶ä»»åŠ¡&lt;/strong&gt;åœ¨æ‰§è¡Œrehashï¼Œå‘ç”Ÿåœ¨ç©ºé—²æ—¶é—´&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;é‡Šæ”¾å“ˆå¸Œè¡¨1çš„ç©ºé—´ï¼Œæ­¤æ—¶å“ˆå¸Œè¡¨1çš„ç©ºé—´è¢«å›æ”¶ï¼ŒåŸæ¥çš„å“ˆå¸Œè¡¨2å˜æˆå“ˆå¸Œè¡¨1ï¼Œå“ˆå¸Œè¡¨1å˜æˆå“ˆå¸Œè¡¨2&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æ¸è¿›å¼rehashè¿‡ç¨‹ä¸­ï¼Œå¦‚æœæœ‰æ–°çš„é”®å€¼å¯¹å­˜è¿›æ¥ï¼ŒRedisä¼šæŠŠè¯¥é”®å€¼å¯¹æ”¾åˆ°å“ˆå¸Œè¡¨2ä¸­ï¼Œç¡®ä¿å“ˆå¸Œè¡¨1é‡Œçš„é”®å€¼å¯¹åªä¼šå‡å°‘ï¼›å¦‚æœæ˜¯æœ‰æŸ¥è¯¢è¿›æ¥ï¼Œåˆ™ä¼šå…ˆæŸ¥è¯¢å“ˆå¸Œè¡¨1ï¼Œå†æŸ¥è¯¢å“ˆå¸Œè¡¨2ã€‚&lt;/p&gt;
&lt;h4 id=&#34;åº•å±‚çš„ä¸¤ç§å®ç°&#34;&gt;åº•å±‚çš„ä¸¤ç§å®ç°&lt;/h4&gt;
&lt;p&gt;å¯¹äºHashæ•°æ®ç±»å‹ï¼Œåº•å±‚æœ‰å‹ç¼©åˆ—è¡¨å’Œå“ˆå¸Œè¡¨ä¸¤ç§å®ç°ï¼Œå½“åº•å±‚ä½¿ç”¨å‹ç¼©åˆ—è¡¨æ—¶ï¼Œå­˜å‚¨çš„æ—¶å€™æ˜¯ä»¥keyã€valueçš„é¡ºåºå­˜å‚¨çš„ï¼Œæ–°å¢çš„é”®å€¼å¯¹ä¿å­˜åœ¨è¡¨å°¾ï¼›ä½¿ç”¨å‹ç¼©åˆ—è¡¨æ—¶ï¼Œåº•å±‚æ˜¯æ— æ³•åˆ©ç”¨indexæŸ¥æ‰¾ï¼Œåªèƒ½éå†æŸ¥æ‰¾ã€‚&lt;/p&gt;
&lt;p&gt;å½“Hash é›†åˆä¸­å†™å…¥çš„å…ƒç´ ä¸ªæ•°è¶…è¿‡äº† &lt;code&gt;hash-max-ziplist-entries&lt;/code&gt;ï¼Œæˆ–è€…å†™å…¥çš„å•ä¸ªå…ƒç´ å¤§å°è¶…è¿‡äº† &lt;code&gt;hash-max-ziplist-value&lt;/code&gt;ï¼ŒRedis å°±ä¼šè‡ªåŠ¨æŠŠ Hash ç±»å‹çš„å®ç°ç»“æ„ç”±å‹ç¼©åˆ—è¡¨è½¬ä¸ºå“ˆå¸Œè¡¨ï¼Œä¸”ä¹‹åä¸å¯é€†ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å‹ç¼©åˆ—è¡¨---ziplist&#34;&gt;å‹ç¼©åˆ—è¡¨ - ZipList&lt;/h3&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/redis_%e5%8e%8b%e7%bc%a9%e5%88%97%e8%a1%a8.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/redis_%e5%8e%8b%e7%bc%a9%e5%88%97%e8%a1%a8.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			alt=&#34;Redis Ziplist&#34;&gt;
	&lt;/a&gt;
	
	&lt;figcaption&gt;Redis Ziplist&lt;/figcaption&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„ä¸­æ¯ä¸€ä¸ªå…ƒç´ ä¿å­˜ä¸€ä¸ªæ•°æ®ã€‚å‹ç¼©åˆ—è¡¨çš„ç»“æ„ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;è¡¨å¤´æœ‰ä¸‰ä¸ªå­—æ®µï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;zlbytes&lt;/code&gt;è®°å½•æ•´ä¸ªå‹ç¼©åˆ—è¡¨å ç”¨çš„å†…å­˜å­—èŠ‚æ•°ï¼Œå¯ç®—å‡ºåˆ—è¡¨é•¿åº¦ï¼›&lt;/li&gt;
&lt;li&gt;&lt;code&gt;zltail&lt;/code&gt;è®°å½•åˆ—è¡¨æœ€åä¸€ä¸ª&lt;code&gt;entry&lt;/code&gt;çš„åç§»é‡ï¼Œå¯ç®—å‡ºå°¾èŠ‚ç‚¹åˆ°åˆ—è¡¨èµ·å§‹åœ°å€çš„å­—èŠ‚æ•°ï¼Œå¿«é€Ÿå®Œæˆpopæ“ä½œï¼›&lt;/li&gt;
&lt;li&gt;&lt;code&gt;zllen&lt;/code&gt;è®°å½•åˆ—è¡¨ä¸­çš„&lt;code&gt;entry&lt;/code&gt;ä¸ªæ•°ï¼Œåªå ç”¨2bytesï¼Œå¦‚æœå‹ç¼©åˆ—è¡¨ä¸­&lt;code&gt;entry&lt;/code&gt;çš„æ•°ç›®å°äº 65535 ï¼Œ2çš„16æ¬¡æ–¹ï¼Œè¯¥å­—æ®µå­˜å‚¨çš„å°±æ˜¯å®é™…çš„&lt;code&gt;entry&lt;/code&gt;æ•°ï¼Œå¦‚æœè¶…è¿‡æˆ–ç­‰äºè¯¥å€¼ï¼Œåˆ™å®é™…æ•°é‡è¦éå†&lt;code&gt;entry&lt;/code&gt;æ‰èƒ½å¾—åˆ°ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ¯ä¸ªèŠ‚ç‚¹å…ƒç´ &lt;code&gt;entry&lt;/code&gt;æœ‰å››ä¸ªå­—æ®µï¼š&lt;code&gt;previous_entry_length&lt;/code&gt;è®°å½•å‰ä¸€ä¸ªèŠ‚ç‚¹çš„é•¿åº¦ï¼›&lt;code&gt;encoding&lt;/code&gt;è®°å½•&lt;code&gt;content&lt;/code&gt;çš„æ•°æ®ç±»å‹å’Œé•¿åº¦ï¼›&lt;code&gt;content&lt;/code&gt;ä¿å­˜å…ƒç´ çš„å€¼ï¼›&lt;code&gt;len&lt;/code&gt;è¡¨ç¤ºè‡ªèº«é•¿åº¦ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è¡¨å°¾æœ‰ä¸€å­—æ®µï¼š&lt;code&gt;zlend&lt;/code&gt;ç»ˆæ­¢å­—ç¬¦ï¼Œç”¨äºæ ‡è®°åˆ—è¡¨æœ«ç«¯ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ•°æ®ç±»å‹Listã€Hashã€ZSetéƒ½æœ‰ä½¿ç”¨åˆ°å‹ç¼©åˆ—è¡¨ã€‚&lt;/p&gt;
&lt;p&gt;å‹ç¼©åˆ—è¡¨å¯ä»¥å­˜å‚¨å­—ç¬¦ä¸²æˆ–æ•´æ•°ï¼Œå­˜å‚¨æ•´æ•°æ—¶é‡‡ç”¨æ•´æ•°çš„äºŒè¿›åˆ¶è€Œä¸æ˜¯å­—ç¬¦ä¸²å½¢å¼å­˜å‚¨ï¼Œèƒ½åœ¨O(1)æ—¶é—´å¤æ‚åº¦ä¸‹å®Œæˆ list ä¸¤ç«¯çš„ push å’Œ pop æ“ä½œï¼Œç”±äºæ¯æ¬¡æ“ä½œéƒ½éœ€è¦é‡æ–°åˆ†é…å‹ç¼©åˆ—è¡¨çš„å†…å­˜ï¼Œsoå®é™…å¤æ‚åº¦è·Ÿå…¶å†…å­˜ä½¿ç”¨é‡æœ‰å…³ã€‚&lt;/p&gt;
&lt;p&gt;å‹ç¼©åˆ—è¡¨çš„ä¼˜åŠ¿åœ¨äºå­˜å‚¨ç»“æ„ï¼Œæ™®é€šæ•°ç»„è¦æ±‚æ•°ç»„çš„æ¯ä¸ªå…ƒç´ çš„å¤§å°ç›¸åŒï¼Œä½†æ˜¯å½“æˆ‘ä»¬éœ€è¦åœ¨æ¯ä¸ªå…ƒç´ ä¸­å­˜å‚¨å¤§å°ä¸åŒçš„å­—ç¬¦ä¸²æ—¶ï¼Œå°±ä¼šæµªè´¹å­˜å‚¨ç©ºé—´ï¼Œå‹ç¼©åˆ—è¡¨å°±æ˜¯ä¼šæŠŠæ¯ä¸ªå…ƒç´ å¤šä½™çš„ç©ºé—´è¿›è¡Œå‹ç¼©ï¼Œè®©æ¯ä¸ªå…ƒç´ ç´§å¯†ç›¸è¿ï¼Œå†ä¸ºæ¯ä¸ªå…ƒç´ å¢åŠ ä¸€ä¸ªé•¿åº¦ï¼Œç”¨äºè®¡ç®—ä¸‹ä¸€ä¸ªå…ƒç´ åœ¨å†…å­˜ä¸­çš„ä½ç½®ã€‚&lt;/p&gt;
&lt;p&gt;å¦å¤–ï¼Œåœ¨å†…å­˜çš„åœ°å€æŸ¥æ‰¾æ—¶ï¼Œåœ¨æŸ¥æ‰¾ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªçš„æ—¶å€™æœ‰ä¼˜åŠ¿ï¼Œå¯ä»¥åˆ©ç”¨è¡¨å¤´çš„ä¸‰ä¸ªå­—æ®µæŸ¥åˆ°ï¼Œæ˜¯O(1)ï¼Œä½†æ˜¯å› ä¸ºå­˜å‚¨ç´§å‡‘çš„ç¼˜æ•…ï¼ŒæŸ¥æ‰¾å…¶ä»–å…ƒç´ åªèƒ½éå†ï¼Œæ˜¯O(n)ã€‚&lt;/p&gt;
&lt;p&gt;å‹ç¼©åˆ—è¡¨æˆ–è€…æ•°ç»„ä¸»è¦å› ä¸ºå…¶æ•°æ®ç»“æ„ç´§å‡‘ï¼ŒèŠ‚çœç©ºé—´ï¼Œé¿å…å†…å­˜ç¢ç‰‡ï¼Œæå‡å†…å­˜åˆ©ç”¨ç‡ï¼Œçº¿æ€§é¡ºåºå­˜å‚¨ï¼Œå¯¹CPUé«˜é€Ÿç¼“å­˜æ”¯æŒå‹å¥½ã€‚å¯¹äºæŸ¥æ‰¾çš„æ—¶é—´å¤æ‚åº¦çš„ä¼˜åŠ¿æå‡ä¸å¤§ã€‚ä½†æ˜¯ï¼Œç”±äºå‹ç¼©åˆ—è¡¨æ¯”è¾ƒç´§å‡‘ï¼Œåœ¨æ–°å¢æ›´æ–°åˆ é™¤æ“ä½œæ—¶å¯èƒ½ä¼šå¼•å‘è¿é”æ›´æ–°ï¼Œæ­¤æ—¶æœ€åä¸ºO(n^2)ï¼Œä½†è§¦å‘æ¦‚ç‡ç›¸å¯¹è¾ƒä½ï¼Œåˆ©å¤§äºå¼Šã€‚&lt;/p&gt;
&lt;h3 id=&#34;å¿«è¡¨---quick-list&#34;&gt;å¿«è¡¨ - Quick List&lt;/h3&gt;
&lt;p&gt;3.2ç‰ˆæœ¬åæ‰æ·»åŠ ï¼Œä¹‹å‰çš„ç‰ˆæœ¬æ˜¯åŒå‘é“¾è¡¨ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªé“¾è¡¨ï¼Œåªæ˜¯æ¯ä¸ªèŠ‚ç‚¹éƒ½æ˜¯ä¸€ä¸ªå‹ç¼©åˆ—è¡¨ã€‚&lt;/p&gt;
&lt;p&gt;å¿«è¡¨ä¸ºäº†è§£å†³å‹ç¼©åˆ—è¡¨å¢åˆ å…ƒç´ æ—¶çš„è¿é”ååº”å¯¼è‡´çš„æ€§èƒ½ä¸‹é™ï¼Œä¼šæ§åˆ¶æ¯ä¸ªé“¾è¡¨èŠ‚ç‚¹ä¸­çš„å‹ç¼©åˆ—è¡¨çš„å¤§å°æˆ–å…ƒç´ ä¸ªæ•°ï¼Œæ¥é¿å…è¿™ä¸ªé—®é¢˜ï¼Œå› ä¸ºå‹ç¼©åˆ—è¡¨è¶Šå°æˆ–å…ƒç´ ä¸ªæ•°è¶Šå°‘ï¼Œæ–°å¢æˆ–åˆ é™¤æ—¶å¸¦æ¥çš„å½±å“å°±è¶Šå°ã€‚&lt;/p&gt;
&lt;h3 id=&#34;è·³è¡¨---skip-list&#34;&gt;è·³è¡¨ - Skip List&lt;/h3&gt;
&lt;p&gt;Redisåªæœ‰ZSetå¯¹è±¡åº•å±‚ä½¿ç”¨è·³è¡¨ï¼ŒZSetç»“æ„ä½“é‡Œæœ‰ä¸¤ä¸ªæ•°æ®ç»“æ„ï¼Œä¸€ä¸ªæ˜¯è·³è¡¨ï¼Œä¸€ä¸ªæ˜¯å“ˆå¸Œè¡¨ï¼Œå“ˆå¸Œè¡¨åªåœ¨ç”¨åœ¨è·å–æƒé‡ï¼Œå¤§éƒ¨åˆ†æ“ä½œè¿˜æ˜¯é€šè¿‡è·³è¡¨å®ç°ï¼›&lt;/p&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/rredis_%e8%b7%b3%e8%a1%a8.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/rredis_%e8%b7%b3%e8%a1%a8.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			alt=&#34;Redis Ziplist&#34;&gt;
	&lt;/a&gt;
	
	&lt;figcaption&gt;Redis Ziplist&lt;/figcaption&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;å…ˆæ’åºåˆ†æ•°ï¼Œåˆ†æ•°ç›¸åŒæ—¶ï¼Œå†æ’åºå…ƒç´ å€¼ï¼Œé»˜è®¤æ˜¯ä»å°åˆ°å¤§æ’ã€‚&lt;/p&gt;
&lt;p&gt;è·³è¡¨æœ¬è´¨æ˜¯ä¸ºé“¾è¡¨å¢åŠ ç´¢å¼•ï¼Œå»ºç«‹å¤šå±‚ç´¢å¼•ï¼ŒæŸ¥æ‰¾æ—¶ä»é¡¶å±‚çš„ç´¢å¼•å¼€å§‹é€æ­¥å¾€ä¸‹å±‚æ‰¾ï¼Œæœ€ç»ˆå®šä½åˆ°å…ƒç´ ï¼Œé€‚ç”¨äºèŒƒå›´æŸ¥è¯¢çš„åœºæ™¯ã€‚è·³è¡¨çš„ç›¸é‚»ä¸¤å±‚çš„èŠ‚ç‚¹æ•°é‡æœ€ç†æƒ³çš„æ¯”ä¾‹æ˜¯ 2:1ï¼ŒæŸ¥æ‰¾çš„æ—¶é—´å¤æ‚åº¦ä¸ºO(logN)&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯ï¼Œredisåœ¨åˆ›å»ºè·³è¡¨æ—¶ï¼Œéšæœºç”Ÿæˆæ¯ä¸ªèŠ‚ç‚¹çš„å±‚æ•°ï¼Œæ²¡æœ‰ä¸¥æ ¼ç»´æŒç›¸é‚»ä¸¤å±‚èŠ‚ç‚¹2:1çš„æ¯”ä¾‹ï¼Œæ¯”å¦‚åœ¨åˆ›å»ºèŠ‚ç‚¹æ—¶ï¼Œä¼šç”ŸæˆèŒƒå›´ä¸º[0-1]çš„ä¸€ä¸ªéšæœºæ•°ï¼Œå¦‚æœè¿™ä¸ªéšæœºæ•°å°äº0.25ï¼Œé‚£ä¹ˆå±‚æ•°åŠ ä¸€ï¼Œç„¶åç”Ÿæˆä¸‹ä¸€ä¸ªéšæœºæ•°ï¼Œç›´åˆ°æ”¹éšæœºæ•°å¤§äº0.25ï¼Œæœ€ç»ˆç¡®å®šæ”¹èŠ‚ç‚¹çš„å±‚æ•°ï¼›è¿™æ ·åšç›¸å½“äºæ¯å¢åŠ ä¸€å±‚çš„æ¦‚ç‡ä¸è¶…è¿‡25%ï¼Œå±‚æ•°è¶Šé«˜ï¼Œæ¦‚ç‡è¶Šä½ï¼Œå±‚é«˜æœ€å¤§é™åˆ¶æ˜¯64ï¼›Redis 7.0 å®šä¹‰å±‚é«˜ä¸º 32ï¼ŒRedis 5.0 å®šä¹‰ä¸º 64ï¼ŒRedis 3.0 å®šä¹‰ä¸º 32&lt;/p&gt;
&lt;p&gt;å‚è€ƒï¼š&lt;a class=&#34;link&#34; href=&#34;https://www.pdai.tech/md/db/nosql-redis/db-redis-x-redis-ds.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Redisåº•å±‚æ•°æ®ç»“æ„è¯¦è§£&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Skip Listå’Œå„ç§å¹³è¡¡æ ‘ï¼ˆå¦‚AVLã€çº¢é»‘æ ‘ç­‰ï¼‰çš„å…ƒç´ æ˜¯æœ‰åºæ’åˆ—çš„ï¼Œè€Œå“ˆå¸Œè¡¨ä¸æ˜¯æœ‰åºçš„ã€‚å› æ­¤ï¼Œåœ¨å“ˆå¸Œè¡¨ä¸Šåªèƒ½åšå•ä¸ªkeyçš„æŸ¥æ‰¾ï¼Œä¸é€‚å®œåšèŒƒå›´æŸ¥æ‰¾ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨åšèŒƒå›´æŸ¥æ‰¾çš„æ—¶å€™ï¼Œå¹³è¡¡æ ‘æ¯”Skip Listæ“ä½œè¦å¤æ‚ã€‚åœ¨å¹³è¡¡æ ‘ä¸Šï¼Œæˆ‘ä»¬æ‰¾åˆ°æŒ‡å®šèŒƒå›´çš„å°å€¼ä¹‹åï¼Œè¿˜éœ€è¦ä»¥ä¸­åºéå†çš„é¡ºåºç»§ç»­å¯»æ‰¾å…¶å®ƒä¸è¶…è¿‡å¤§å€¼çš„èŠ‚ç‚¹ã€‚å¦‚æœä¸å¯¹å¹³è¡¡æ ‘è¿›è¡Œä¸€å®šçš„æ”¹é€ ï¼Œè¿™é‡Œçš„ä¸­åºéå†å¹¶ä¸å®¹æ˜“å®ç°ã€‚è€Œåœ¨skiplistä¸Šè¿›è¡ŒèŒƒå›´æŸ¥æ‰¾å°±éå¸¸ç®€å•ï¼Œåªéœ€è¦åœ¨æ‰¾åˆ°å°å€¼ä¹‹åï¼Œå¯¹ç¬¬1å±‚é“¾è¡¨è¿›è¡Œè‹¥å¹²æ­¥çš„éå†å°±å¯ä»¥å®ç°ã€‚&lt;/p&gt;
&lt;p&gt;å¹³è¡¡æ ‘çš„æ’å…¥å’Œåˆ é™¤æ“ä½œå¯èƒ½å¼•å‘å­æ ‘çš„è°ƒæ•´ï¼Œé€»è¾‘å¤æ‚ï¼Œè€Œskiplistçš„æ’å…¥å’Œåˆ é™¤åªéœ€è¦ä¿®æ”¹ç›¸é‚»èŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œæ“ä½œç®€å•åˆå¿«é€Ÿã€‚&lt;/p&gt;
&lt;p&gt;ä»å†…å­˜å ç”¨ä¸Šæ¥è¯´ï¼ŒSkip Listæ¯”å¹³è¡¡æ ‘æ›´çµæ´»ä¸€äº›ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå¹³è¡¡æ ‘æ¯ä¸ªèŠ‚ç‚¹åŒ…å«2ä¸ªæŒ‡é’ˆï¼ˆåˆ†åˆ«æŒ‡å‘å·¦å³å­æ ‘ï¼‰ï¼Œè€ŒSkip Listæ¯ä¸ªèŠ‚ç‚¹åŒ…å«çš„æŒ‡é’ˆæ•°ç›®å¹³å‡ä¸º1/(1-p)ï¼Œå…·ä½“å–å†³äºå‚æ•°pçš„å¤§å°ã€‚å¦‚æœåƒRedisé‡Œçš„å®ç°ä¸€æ ·ï¼Œå–p=1/4ï¼Œé‚£ä¹ˆå¹³å‡æ¯ä¸ªèŠ‚ç‚¹åŒ…å«1.33ä¸ªæŒ‡é’ˆï¼Œæ¯”å¹³è¡¡æ ‘æ›´æœ‰ä¼˜åŠ¿ã€‚&lt;/p&gt;
&lt;p&gt;æŸ¥æ‰¾å•ä¸ªkeyï¼ŒSkip Listå’Œå¹³è¡¡æ ‘çš„æ—¶é—´å¤æ‚åº¦éƒ½ä¸ºO(log n)ï¼Œå¤§ä½“ç›¸å½“ï¼›è€Œå“ˆå¸Œè¡¨åœ¨ä¿æŒè¾ƒä½çš„å“ˆå¸Œå€¼å†²çªæ¦‚ç‡çš„å‰æä¸‹ï¼ŒæŸ¥æ‰¾æ—¶é—´å¤æ‚åº¦æ¥è¿‘O(1)ï¼Œæ€§èƒ½æ›´é«˜ä¸€äº›ã€‚æ‰€ä»¥æˆ‘ä»¬å¹³å¸¸ä½¿ç”¨çš„å„ç§Mapæˆ–dictionaryç»“æ„ï¼Œå¤§éƒ½æ˜¯åŸºäºå“ˆå¸Œè¡¨å®ç°çš„ã€‚&lt;/p&gt;
&lt;p&gt;å‚è€ƒï¼šhttps://www.jianshu.com/p/8ac45fd01548&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;æ—¶é—´å¤æ‚åº¦&#34;&gt;æ—¶é—´å¤æ‚åº¦&lt;/h3&gt;
&lt;p&gt;å¯¹å„ç§æ•°æ®ç±»å‹æ“ä½œçš„æ—¶é—´å¤æ‚åº¦å–å†³äºåº•å±‚çš„æ•°æ®ç»“æ„ï¼Œå¯¹äºSetï¼Œè™½ç„¶åå­—çœ‹èµ·æ¥æ˜¯é›†åˆï¼Œä½†ç”±äºåº•å±‚æ˜¯å“ˆå¸Œè¡¨ + æ•°ç»„ï¼Œå› æ­¤åœ¨SREMã€SADDã€SRANDMENBERå‘½ä»¤æ—¶ï¼Œæ—¶é—´å¤æ‚åº¦éƒ½æ˜¯O(1)&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;æ•°æ®ç±»å‹çš„èŒƒå›´æŸ¥è¯¢ï¼Œéƒ½éœ€è¦è¿›è¡Œéå†æ“ä½œï¼Œä¸€èˆ¬éƒ½æ˜¯æ¯”è¾ƒè€—æ—¶çš„ã€‚æ¯”å¦‚Listçš„LRANGEã€ZSetçš„ZRANGEã€Setçš„SMEMBERSç­‰&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ•°æ®ç±»å‹çš„ç»Ÿè®¡æŸ¥è¯¢ï¼Œæ¯”å¦‚æŸ¥çœ‹æŸæ•°æ®ç±»å‹çš„å…ƒç´ ä¸ªæ•°ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯O(1)ï¼Œå› ä¸ºæ•°æ®ç»“æ„æœ¬èº«å°±æœ‰è®°å½•äº†ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;ä¸memcachedçš„åŒºåˆ«&#34;&gt;ä¸Memcachedçš„åŒºåˆ«&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Redisæ”¯æŒå­˜å‚¨å¤šç§æ•°æ®ç±»å‹ï¼šstringã€listã€hashã€setã€zsetï¼›è€ŒMemcachedåªæ”¯æŒstringï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;é»˜è®¤æƒ…å†µä¸‹ï¼ŒRedis keyçš„æœ€å¤§ä¸Šé™æ˜¯512Mï¼Œstringç±»å‹ã€listã€hashã€setã€zsetæ¯ä¸ªå…ƒç´ çš„valueä¸Šé™æ˜¯512Mï¼Œå¯ä»¥é€šè¿‡&lt;code&gt;proto_max_bulk_len&lt;/code&gt;çš„å€¼è¿›è¡Œä¿®æ”¹ï¼›memcached keyçš„ä¸Šé™æ˜¯50ä¸ªå­—ç¬¦ï¼Œvalueæœ€å¤§å€¼æ˜¯1Mï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Redisæ”¯æŒæŒä¹…åŒ–ï¼šRDBå¿«ç…§å’ŒAOFæ—¥å¿—ï¼›Memcachedä¸æ”¯æŒæŒä¹…åŒ–ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Redisæ”¯æŒäº‹åŠ¡ï¼Œä½¿ç”¨MULTI å’Œ EXECå‘½ä»¤ï¼Œæ”¯æŒæµæ°´çº¿å¼å‘é€å‘½ä»¤ ï¼›Memcahcedä¸æ”¯æŒäº‹åŠ¡ï¼Œå‘½ä»¤åªèƒ½ä¸€æ¡ä¸€æ¡çš„å‘ï¼Œå½“ç„¶è¿™é‡Œçš„äº‹åŠ¡å¹¶ä¸æ»¡è¶³ä¼ ç»Ÿæ„ä¹‰ä¸Šçš„ACIDï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Redis-Cluster æ”¯æŒåˆ†å¸ƒå¼å­˜å‚¨ï¼Œå¯ä»¥å¤šå°RedisæœåŠ¡å™¨å­˜å‚¨åŒæ ·çš„æ•°æ®ï¼›Memcachedæ˜¯ä»¥&lt;strong&gt;ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•&lt;/strong&gt;å®ç°åˆ†å¸ƒå¼å­˜å‚¨ï¼Œå³å¤šå°MemcachedæœåŠ¡å™¨ï¼ŒMemcachedæ ¹æ®æŸ¥æ‰¾çš„keyè®¡ç®—å‡ºè¯¥æ•°æ®åœ¨å“ªå°æœåŠ¡å™¨ä¸Šï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åœ¨ Redis ä¸­ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰æ•°æ®éƒ½ä¸€ç›´å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œå¯ä»¥å°†ä¸€äº›å¾ˆä¹…æ²¡ç”¨çš„ value äº¤æ¢åˆ°ç£ç›˜ï¼›&lt;/p&gt;
&lt;p&gt;Memcached çš„æ•°æ®åˆ™ä¼šä¸€ç›´åœ¨å†…å­˜ä¸­ï¼ŒMemcachedä½¿ç”¨å›ºå®šç©ºé—´åˆ†é…ï¼Œå°†å†…å­˜åˆ†ä¸ºä¸€ç»„å¤§å°ä¸åŒçš„slab_classï¼Œæ¯ä¸ªslab_classåˆåˆ†ä¸ºä¸€ç»„å¤§å°ç›¸åŒçš„slabï¼Œæ¯ä¸ªslabåˆåŒ…å«ä¸€ç»„å¤§å°ç›¸åŒçš„chunkï¼Œæ ¹æ®æ•°æ®å¤§å°ï¼Œæ”¾åˆ°ä¸åŒçš„chunké‡Œï¼Œè¿™ç§ç®¡ç†æ–¹å¼é¿å…å†…å­˜ç¢ç‰‡ç®¡ç†é—®é¢˜ï¼Œä½†æ˜¯ä¼šå¸¦æ¥å†…å­˜æµªè´¹ï¼Œå³æ¯ä¸ªchunkå†…ä¼šæ”¾å°äºè¿™ä¸ªchunkå¤§å°çš„æ•°æ®ï¼Œchunké‡Œæœ‰äº›ç©ºé—´æ²¡åˆ©ç”¨åˆ°ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•&lt;/strong&gt;ï¼Œä¸»è¦è§£å†³ä¼ ç»Ÿå“ˆå¸Œä¸‹èŠ‚ç‚¹æ‰©å®¹æˆ–ç¼©å®¹å¯¼è‡´æ‰€æœ‰keyè¦é‡æ–°è®¡ç®—è¿ç§»çš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ„é€ ä¸€ä¸ªé•¿åº¦ä¸º2çš„32æ¬¡æ–¹çš„æ•´æ•°ç¯ï¼Œå³0 ~ (2^32)-1çš„æ•°å­—ç©ºé—´ï¼›&lt;/li&gt;
&lt;li&gt;æ ¹æ®èŠ‚ç‚¹çš„å”¯ä¸€åç§°æˆ–è€…ipä½œä¸ºå…³é”®å­—è¿›è¡Œå“ˆå¸Œï¼Œç¡®å®šèŠ‚ç‚¹åœ¨è¿™ä¸ªHashç¯ä¸Šçš„ä½ç½®ï¼›&lt;/li&gt;
&lt;li&gt;æ ¹æ®æ•°æ®çš„keyå€¼è®¡ç®—Hashå€¼ï¼Œåœ¨Hashç¯ä¸Šé¡ºæ—¶é’ˆæŸ¥æ‰¾è·ç¦»è¿™ä¸ªKeyçš„Hashå€¼æœ€è¿‘çš„èŠ‚ç‚¹ï¼Œå®Œæˆkeyåˆ°èŠ‚ç‚¹çš„Hashæ˜ å°„æŸ¥æ‰¾ï¼›&lt;/li&gt;
&lt;li&gt;å½“ä¸€ä¸ªèŠ‚ç‚¹æ‰©å®¹æˆ–ç¼©å®¹æ—¶ï¼Œåªä¼šå½±å“åˆ°å…¶ä¸­ä¸€ä¸ªèŠ‚ç‚¹ä¸Šçš„keyï¼Œæ­¤æ—¶éœ€è¦å°†è¯¥èŠ‚ç‚¹ä¸Šçš„keyé‡æ–°è®¡ç®—ï¼Œè¿ç§»åˆ°ç¦»å®ƒæœ€è¿‘çš„ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå…¶ä»–èŠ‚ç‚¹ä¸Šçš„keyåˆ™ä¸ä¼šå—å½±å“ï¼Œé¿å…å¤§é‡æ•°æ®è¿ç§»ï¼Œå‡å°‘æœåŠ¡å™¨å‹åŠ›ã€‚&lt;/li&gt;
&lt;li&gt;ä¸ºäº†è§£å†³è´Ÿè½½ä¸å‡è¡¡é—®é¢˜ï¼ˆæ¯”å¦‚èŠ‚ç‚¹çš„æ•°é‡å¾ˆå°‘ï¼Œå¤§é‡çš„æ•°æ®å°±æœ‰å¯èƒ½éƒ½é›†ä¸­åœ¨ä¸Šé¢ï¼‰ï¼Œå¯ä»¥åœ¨æ­¤åŸºç¡€ä¸Šå¢åŠ ä¸€ä¸ªè™šæ‹Ÿå±‚ï¼Œå¯¹æ¯ä¸ªèŠ‚ç‚¹çš„å…³é”®å­—å¤šè®¡ç®—å‡ æ¬¡å“ˆå¸Œï¼Œæ¯æ¬¡è®¡ç®—çš„ç»“æœä½œä¸ºåœ¨ç¯ä¸­çš„ä½ç½®ï¼›keyç®—å®Œå“ˆå¸Œå€¼åï¼Œå…ˆåœ¨ç¯ä¸Šæ‰¾åˆ°è™šæ‹ŸèŠ‚ç‚¹ï¼Œå†æ‰¾åˆ°ç‰©ç†èŠ‚ç‚¹ï¼Œå°†æ•°æ®åˆ†æ•£åˆ°å„ä¸ªèŠ‚ç‚¹ï¼Œä¸€èˆ¬ä¸€ä¸ªç‰©ç†èŠ‚ç‚¹å¯¹åº”150ä¸ªè™šæ‹ŸèŠ‚ç‚¹ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://zhuanlan.zhihu.com/p/98030096&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;ä¸€è‡´æ€§å“ˆå¸Œå‚è€ƒ&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;redisçš„çº¿ç¨‹æ¨¡å‹&#34;&gt;Redisçš„çº¿ç¨‹æ¨¡å‹&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;å¯¹äºä¸€ä¸ª DB æ¥è¯´ï¼ŒCPU é€šå¸¸ä¸ä¼šæ˜¯ç“¶é¢ˆï¼Œå› ä¸ºå¤§å¤šæ•°è¯·æ±‚ä¸ä¼šæ˜¯ CPU å¯†é›†å‹çš„ï¼Œè€Œæ˜¯ I/O å¯†é›†å‹ã€‚å…·ä½“åˆ° Redis çš„è¯ï¼Œå¦‚æœä¸è€ƒè™‘ RDB/AOF ç­‰æŒä¹…åŒ–æ–¹æ¡ˆï¼ŒRedis æ˜¯å®Œå…¨çš„çº¯å†…å­˜æ“ä½œï¼Œæ‰§è¡Œé€Ÿåº¦æ˜¯éå¸¸å¿«çš„ï¼Œå› æ­¤è¿™éƒ¨åˆ†æ“ä½œé€šå¸¸ä¸ä¼šæ˜¯æ€§èƒ½ç“¶é¢ˆï¼ŒRedis çœŸæ­£çš„æ€§èƒ½ç“¶é¢ˆåœ¨äºç½‘ç»œ I/Oï¼Œä¹Ÿå°±æ˜¯å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¹‹é—´çš„ç½‘ç»œä¼ è¾“å»¶è¿Ÿï¼Œå› æ­¤ Redis é€‰æ‹©äº†å•çº¿ç¨‹çš„ I/O å¤šè·¯å¤ç”¨æ¥å®ç°å®ƒçš„æ ¸å¿ƒç½‘ç»œæ¨¡å‹ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;å•çº¿ç¨‹æ¨¡å‹&#34;&gt;å•çº¿ç¨‹æ¨¡å‹&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;Redisçš„å•çº¿ç¨‹ï¼ŒæŒ‡çš„æ˜¯ ç½‘ç»œIO å’Œ é”®å€¼å¯¹è¯»å†™ ç”±ä¸€ä¸ªçº¿ç¨‹æ¥å®Œæˆ&lt;/strong&gt;ï¼Œå…¶ä»–çš„å¦‚æŒä¹…åŒ–ã€å¼‚æ­¥åˆ é™¤ã€é›†ç¾¤æ•°æ®åŒæ­¥éƒ½æœ‰é¢å¤–çš„çº¿ç¨‹å®Œæˆã€‚Redisåœ¨6.0ç‰ˆæœ¬åæ‰æ”¯æŒIOå¤šçº¿ç¨‹çš„ç½‘ç»œæ¨¡å‹ã€‚&lt;/p&gt;
&lt;p&gt;Rediså•çº¿ç¨‹ä¹‹æ‰€ä»¥èƒ½å¤„ç†å¾—å¾ˆå¿«ï¼Œå¾—ç›Šäºé«˜æ•ˆçš„æ•°æ®ç»“æ„ï¼Œä¸”é‡‡ç”¨äº†&lt;strong&gt;å¤šè·¯å¤ç”¨æœºåˆ¶&lt;/strong&gt;ï¼Œåœ¨ç½‘ç»œIOæ“ä½œä¸­èƒ½å¹¶å‘å¤„ç†å¤§é‡å®¢æˆ·ç«¯è¯·æ±‚ï¼ŒåŒæ—¶ä¸ºäº†æ”¯æŒå¤šç§æ•°æ®ç»“æ„ï¼Œä¿è¯å¹¶å‘å®‰å…¨ï¼Œå•çº¿ç¨‹æ¨¡å‹ä¸‹é¿å…åŠ é”è§£é”å¸¦æ¥é¢å¤–çš„å¼€é”€ã€‚&lt;/p&gt;
&lt;p&gt;ç›‘å¬ + äº‹ä»¶é©±åŠ¨ + å›è°ƒ çš„æ–¹å¼ï¼Œå¤„ç†æ˜“é˜»å¡çš„acceptå’Œrecväº‹ä»¶ï¼Œæ˜¯ä¸€ä¸ªå•Reactoræ¨¡å‹ï¼Œåˆ©ç”¨ epoll / select / kqueue ç­‰å¤šè·¯å¤ç”¨æŠ€æœ¯ï¼Œåœ¨å•çº¿ç¨‹çš„äº‹ä»¶å¾ªç¯ä¸­ä¸æ–­å»å¤„ç†äº‹ä»¶ï¼ˆå®¢æˆ·ç«¯è¯·æ±‚ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://zhuanlan.zhihu.com/p/57089960?utm_source=wechat_session&amp;amp;utm_medium=social&amp;amp;utm_oi=632939468966072320&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;ä¸€æ–‡æ­ç§˜å•çº¿ç¨‹çš„Redisä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«?&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://strikefreedom.top/multiple-threaded-network-model-in-redis&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Redis å¤šçº¿ç¨‹ç½‘ç»œæ¨¡å‹å…¨é¢æ­ç§˜&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æ€»ç»“ä¸€ä¸‹å°±æ˜¯ï¼šé«˜æ•ˆçš„æ•°æ®ç»“æ„å’Œæ•°æ®å‹ç¼©ã€çº¯å†…å­˜æ“ä½œã€éé˜»å¡IOå¤šè·¯å¤ç”¨ï¼Œé¿å…é¢‘ç¹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ã€é¿å…åŒæ­¥æœºåˆ¶çš„å¼€é”€ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å¤šçº¿ç¨‹æ¨¡å‹&#34;&gt;å¤šçº¿ç¨‹æ¨¡å‹&lt;/h2&gt;
&lt;p&gt;Redis 4.0ä¹‹åå¼•å…¥å¤šçº¿ç¨‹æ¥åšä¸€äº›å¼‚æ­¥æ“ä½œï¼Œæ¯”å¦‚ä»¥å‰&lt;code&gt;DEL&lt;/code&gt;å‘½ä»¤åœ¨åˆ é™¤big keyå’Œå¤§é‡keyæ—¶æ˜¯é˜»å¡æ“ä½œï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜å¼•å…¥å¤šçº¿ç¨‹ä½¿å¾—éƒ¨åˆ†å‘½ä»¤æ”¯æŒå¤šçº¿ç¨‹çš„å¼‚æ­¥æ“ä½œï¼Œæ¯”å¦‚&lt;code&gt;UNLINK&lt;/code&gt;ã€&lt;code&gt;FLUSHALL ASYNC&lt;/code&gt;ã€&lt;code&gt;FLUSHDB ASYNC&lt;/code&gt;ï¼Œæ­¤æ—¶çš„ç½‘ç»œIOæ¨¡å‹ä»ç„¶æ˜¯å•çº¿ç¨‹çš„ï¼ˆå•Reactoræ¨¡å‹ï¼‰&lt;/p&gt;
&lt;p&gt;Redis 6.0ä¹‹åæ‰å¼•å…¥å¤šçº¿ç¨‹çš„ç½‘ç»œIOæ¨¡å‹ï¼ˆå¤šReactoræ¨¡å‹ï¼Œä½†ä¸æ˜¯æ ‡å‡†çš„å¤šReactoræ¨¡å‹ï¼‰ï¼Œæ€»çš„æµç¨‹è¿˜æ˜¯è·Ÿå•çº¿ç¨‹æ¨¡å‹ä¸€æ ·ï¼Œåªæ˜¯æŠŠè¯»å–å®¢æˆ·ç«¯å‘½ä»¤å’Œå›å†™å“åº”æ•°æ®çš„æ“ä½œäº¤ç”±I/Oçº¿ç¨‹å»æ‰§è¡Œå¼‚æ­¥åŒ–ï¼Œ&lt;strong&gt;I/O çº¿ç¨‹ä»…ä»…æ˜¯è¯»å–å’Œè§£æå®¢æˆ·ç«¯å‘½ä»¤è€Œä¸ä¼šçœŸæ­£å»æ‰§è¡Œå‘½ä»¤ï¼Œå®¢æˆ·ç«¯å‘½ä»¤çš„æ‰§è¡Œæœ€ç»ˆè¿˜æ˜¯è¦åœ¨ä¸»çº¿ç¨‹ä¸Šå®Œæˆ&lt;/strong&gt;ï¼›&lt;/p&gt;
&lt;h2 id=&#34;å½±å“æ€§èƒ½çš„åœºæ™¯&#34;&gt;å½±å“æ€§èƒ½çš„åœºæ™¯&lt;/h2&gt;
&lt;p&gt;å…³äºbig keyï¼šå¯¹äºå­—ç¬¦ä¸²ç±»å‹ï¼Œå…¶valueçš„å¤§å°è¶…è¿‡10KBï¼›é›†åˆç±»ç±»å‹ï¼Œå…¶å…ƒç´ çš„ä¸ªæ•°è¶…è¿‡10kï¼›&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å¯¹big keyçš„æ“ä½œï¼Œæ¯”å¦‚åˆ›å»ºå’Œåˆ é™¤ï¼Œbig keyåœ¨åˆ†é…å†…å­˜å’Œé‡Šæ”¾å†…å­˜ä¼šæ¯”è¾ƒè€—æ—¶ã€‚big keyæ„å‘³ç€valueå¾ˆå¤§ï¼Œå½“è¿›è¡Œå…¨é‡æŸ¥è¯¢è¿”å›ã€èšåˆæ“ä½œã€å…¨é‡åˆ é™¤(å› ä¸ºè¦é‡Šæ”¾å†…å­˜)æ—¶å¯èƒ½ä¼šé˜»å¡ä¸»çº¿ç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€èˆ¬å¯ä»¥é…åˆscanå‘½ä»¤ä»¥åŠå¯¹åº”æ•°æ®ç±»å‹çš„scanå‘½ä»¤æ¥å¢é‡è·å–æˆ–åˆ é™¤ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¸€äº›å‘½ä»¤å¯¹åº”çš„æ“ä½œæ—¶é—´å¤æ‚åº¦é«˜ï¼Œæ¯”å¦‚èŒƒå›´æŸ¥è¯¢ã€keyså‘½ä»¤ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€èˆ¬ä½¿ç”¨scanä»£æ›¿keyså‘½ä»¤ï¼Œscanå‘½ä»¤æ—¶å› ä¸ºä½¿ç”¨é«˜ä½è¿›ä½æ³•éå†ï¼Œæ‰€ä»¥å³ä½¿åœ¨æ‰©å®¹æƒ…å†µä¸‹ä¹Ÿä¸ä¼šæ¼keyï¼Œä½†åœ¨ç¼©å®¹æ—¶å¯èƒ½å¾—åˆ°é‡å¤çš„keyã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¤§é‡Keyé›†ä¸­è¿‡æœŸï¼ŒRedisè¿‡æœŸæœºåˆ¶ä¹Ÿåœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œå¤§é‡Keyé›†ä¸­è¿‡æœŸä¼šå¯¼è‡´è€—æ—¶è¿‡é•¿ï¼Œæ‰€ä»¥åœ¨è®¾ç½®è¿‡æœŸæ—¶é—´æ—¶è¦åŠ å…¥éšæœºæ•°ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ·˜æ±°ç­–ç•¥ä¹Ÿæ˜¯åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œçš„ï¼Œå‘ç”Ÿåœ¨æ‰§è¡Œå‘½ä»¤ä¹‹å‰ï¼Œä¼šå½±å“ç”¨æˆ·å‘½ä»¤çš„æ‰§è¡Œé€Ÿåº¦ã€‚å½“å†…å­˜è¶…è¿‡Rediså†…å­˜ä¸Šé™åï¼Œæ¯æ¬¡å†™å…¥éƒ½éœ€è¦æ·˜æ±°Keyï¼Œä¹Ÿä¼šäº§ç”Ÿè€—æ—¶ï¼Œå¦‚æœæ·˜æ±°è¿‡ç¨‹ä¸­ï¼Œå†…å­˜ä¸è¶³ï¼Œä½¿ç”¨ swap æœºåˆ¶ï¼Œä¹Ÿä¼šé˜»å¡æ•´ä¸ªä¸»çº¿ç¨‹ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¸»ä»å…¨é‡åŒæ­¥ç”ŸæˆRDBå¿«ç…§ï¼Œè™½ç„¶é‡‡ç”¨forkå­è¿›ç¨‹ç”Ÿæˆæ•°æ®å¿«ç…§çš„æ–¹å¼ï¼Œä½†forkç¬é—´ä¹Ÿä¼šé˜»å¡ä¸»çº¿ç¨‹ï¼ˆå› ä¸ºæ¶‰åŠé¡µè¡¨çš„å¤åˆ¶å’Œåˆ†é…ï¼Œè™½ç„¶copy on writeèƒ½å‡å°‘éƒ¨åˆ†å½±å“ï¼Œå¦‚æœæœ‰å¤§é‡å†™å…¥å°±ä¼šå‡ºç°å¤§é‡å¤åˆ¶äº†ï¼‰&lt;/p&gt;
&lt;p&gt;å¦å¤–ï¼Œä»åº“åœ¨æ¥æ”¶RDBå¿«ç…§åï¼Œä¼šæ¸…ç©ºæ‰€æœ‰é”®å€¼å¯¹ï¼Œå¦‚æœé‡å¤§çš„è¯ä¹Ÿå¾ˆè€—æ—¶ï¼Œå¦‚æœRDBæ–‡ä»¶å¤ªå¤§ï¼ŒåŠ è½½ä¹Ÿè€—æ—¶ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;AOFæ—¥å¿—åŒæ­¥å†™ï¼Œå› ä¸ºæ˜¯éœ€è¦å†™ç£ç›˜çš„ï¼Œæ¯”å¦‚è®¾ç½®ä¸ºeverysecå¯èƒ½ä¼šé˜»å¡ä¸»çº¿ç¨‹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åˆ‡ç‰‡é›†ç¾¤ï¼Œå‘å…¶ä»–å®ä¾‹ä¼ è¾“å“ˆå¸Œæ§½ä¿¡æ¯ï¼Œbig keyæ•°æ®çš„è¿ç§»ï¼Œæˆ–è€…åˆ†ç‰‡å†…å­˜å€¾æ–œã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ‰€ä»¥big keyåŸºæœ¬ä¸Šæ˜¯å› ä¸ºå ç”¨å†…å­˜è¿‡å¤§ï¼Œå¼•å‘äº†ç§ç§é—®é¢˜ï¼Œé˜»å¡å·¥ä½œçº¿ç¨‹ï¼Œå¯¼è‡´å®¢æˆ·ç«¯è¶…æ—¶ï¼Œé€ æˆç½‘ç»œé˜»å¡ï¼Œå†…å­˜åˆ†å¸ƒä¸å‡ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;æ”¹è¿›çš„è¯ï¼Œå°±åªæœ‰åˆ é™¤æ“ä½œå’ŒAOFæ—¥å¿—åŒæ­¥å†™å¯ä»¥æ”¾åœ¨å¼‚æ­¥çº¿ç¨‹å»åšï¼ŒRedis4.0ä»¥åæ‰æä¾›åˆ é™¤å’ŒAOFåŒæ­¥å†™çš„å¼‚æ­¥å‘½ä»¤ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä½¿ç”¨è§„èŒƒå’Œä¼˜åŒ–&#34;&gt;ä½¿ç”¨è§„èŒƒå’Œä¼˜åŒ–&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Stringç±»å‹çš„æ•°æ®ä¸è¦è¶…è¿‡10KBï¼Œé¿å…BigKeyï¼Œvalueå¯ä»¥ä½¿ç”¨å‹ç¼©ç®—æ³•è¿›è¡Œå‹ç¼©æ¥å‡å°‘å¤§å°ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Keyçš„é•¿åº¦å°½é‡çŸ­ï¼Œå°½é‡æ§åˆ¶åœ¨39å­—èŠ‚ä»¥å†…ï¼Œå‡å°‘åˆ›å»ºRedisObjectå†…å­˜åˆ†é…æ¬¡æ•°ï¼Œæå‡æ€§èƒ½ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å½“big keyçœŸçš„æ— æ³•é¿å…æ—¶ï¼Œéœ€è¦å¯¹big keyæ‹†åˆ†æˆå¤šä¸ªï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å®šæ—¶æ¸…ç† hash ä¸­æ— æ•ˆçš„æ•°æ®ï¼ŒRedis &amp;gt;= 4.0 ï¼Œå¯ä»¥ä½¿ç”¨ unlink å‘½ä»¤ä»£æ›¿ del å‘½ä»¤åˆ é™¤keyï¼Œè¯¥å‘½ä»¤ä¼šè¿›è¡Œå¼‚æ­¥åˆ é™¤ï¼›Redis &amp;gt;= 6.0 ï¼Œå¯ä»¥å¼€å¯ lazy-freeæœºåˆ¶ï¼Œæ‰§è¡Œdelå‘½ä»¤æ—¶ï¼Œé‡Šæ”¾å†…å­˜çš„æ“ä½œæ”¾åˆ°åå°çº¿ç¨‹æ‰§è¡Œï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¦‚æœéœ€è¦é¢‘ç¹æ“ä½œredisï¼Œå¯ä»¥ä½¿ç”¨pipelineï¼Œåˆå¹¶å¤šä¸ªå‘½ä»¤è¯·æ±‚ï¼Œå‡å°‘IOæ¬¡æ•°ï¼Œä¹Ÿå°±å‡å°‘äº† CPUä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œå½“ç„¶ï¼Œpipelineæœ¬èº«ç»„è£…å‘½ä»¤çš„ä¸ªæ•°ä¹Ÿä¸èƒ½å¤ªå¤š&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;keyçš„è¿‡æœŸæ—¶é—´åŠ ä¸Šéšæœºå€¼ï¼Œé¿å…keyçš„é›†ä¸­è¿‡æœŸï¼›&lt;/p&gt;
&lt;p&gt;åˆ©ç”¨Redisåˆ†åŒºåŠŸèƒ½ï¼Œå°†æ•°æ®åˆ†æ•£åˆ°å„ä¸ªåˆ†åŒºï¼Œå‡è½»å¤šä¸ªRediså†…å­˜æ·˜æ±°çš„è´Ÿè½½å‹åŠ›ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;é›†åˆç±»å‹çš„å…ƒç´ ä¸ªæ•°ä¸è¶…è¿‡ä¸€ä¸‡ä¸ªï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç»‘æ ¸ï¼Œç»‘å®šåœ¨åŒä¸€ä¸ªç‰©ç†æ ¸å¿ƒçš„å¤šä¸ªé€»è¾‘æ ¸å¿ƒä¸Šï¼Œè®©ä»–ä»¬èƒ½å…¬ç”¨L1/L2 Cacheï¼Œé™ä½Redisåœ¨å¤šä¸ªCPUæ ¸å¿ƒä¹‹é—´çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å¸¦æ¥çš„æ€§èƒ½æŸè€—ï¼Œæ¯”å¦‚ å¯ä»¥è®© ä¸»çº¿ç¨‹ã€åå°çº¿ç¨‹ã€åå° RDB è¿›ç¨‹ã€AOF rewrite è¿›ç¨‹ ç»‘å®šåœ¨ä¸åŒçš„æ ¸å¿ƒä¸Šï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Rediså®ä¾‹å®¹é‡æ§åˆ¶åœ¨10GBå†…ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç¦ç”¨Keysã€FlushAllã€FlushDBå‘½ä»¤ï¼Œæ…ç”¨å…¨é‡æ“ä½œå‘½ä»¤ã€Monitorå‘½ä»¤ã€å¤æ‚åº¦è¿‡é«˜çš„å‘½ä»¤ï¼ˆå¦‚Sortã€Sinterã€SinterStoreã€ZUnionStoreã€ZInterStoreï¼‰&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;ç›‘æ§&#34;&gt;ç›‘æ§&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;redis-cli -h 127.0.0.1 -p 6379 --bigkeys -i 0.01&lt;/code&gt;ï¼Œæ¯éš”0.01ç§’æ‰«æä¸€æ¬¡big keyï¼Œæœ¬è´¨æ˜¯ç”¨scanå‘½ä»¤éå†æ‰€æœ‰keyï¼Œç„¶åé’ˆå¯¹keyçš„ç±»å‹ï¼Œæ‰§è¡Œ&lt;code&gt;STRLEN, LLEN, HLEN, SCARDå’ŒZCARD&lt;/code&gt; å‘½ä»¤ï¼Œæ¥è·å– String ç±»å‹çš„é•¿åº¦ï¼Œå®¹å™¨ç±»å‹ï¼ˆList, Hash, Set, ZSetï¼‰çš„å…ƒç´ ä¸ªæ•°ï¼Œä½¿ç”¨æ—¶ï¼Œè¦æ³¨æ„å¯¹çº¿ä¸Šçš„å½±å“ï¼›&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ redis-rdb-tools åˆ†æ redis rdbæ–‡ä»¶ï¼Œå› ä¸ºæ˜¯ç¦»çº¿åˆ†æï¼Œæ‰€ä»¥å¯¹redisæœåŠ¡æ²¡å½±å“&lt;/li&gt;
&lt;li&gt;&lt;code&gt;redis-cli -h 127.0.0.1 -p 6379 --hotkeys&lt;/code&gt;ï¼Œæ‰«æhotkeyï¼Œå‰ææ˜¯éœ€è¦å¼€å¯ &lt;code&gt;allkey-LFU&lt;/code&gt;ï¼Œè¿™æ ·æ‰èƒ½æ ¹æ®keyçš„è®¿é—®æ¬¡æ•°çŸ¥é“å“ªäº›æ˜¯hotkey&lt;/li&gt;
&lt;li&gt;&lt;code&gt;INFO memory&lt;/code&gt; å‘½ä»¤æŸ¥çœ‹Rediså†…å­˜ç¢ç‰‡ç‡&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;è¿‡æœŸæ—¶é—´å’Œæ•°æ®æ·˜æ±°ç­–ç•¥&#34;&gt;è¿‡æœŸæ—¶é—´å’Œæ•°æ®æ·˜æ±°ç­–ç•¥&lt;/h1&gt;
&lt;h2 id=&#34;keyè¿‡æœŸåˆ é™¤åŸç†&#34;&gt;keyè¿‡æœŸåˆ é™¤åŸç†&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å®šæœŸåˆ é™¤ç­–ç•¥ï¼šRedisèµ·å®šæ—¶å™¨æ‰«ækeyï¼ˆé»˜è®¤100msï¼‰ï¼Œåˆ¤æ–­keyæ˜¯å¦è¿‡æœŸï¼Œè¿‡æœŸåˆ™åˆ é™¤ã€‚è™½ç„¶å¯ä»¥ä¿è¯è¿‡æœŸçš„keyä¼šè¢«åˆ é™¤ï¼Œä½†æ˜¯æ¯æ¬¡éƒ½è¦æ‰«æä¼šéå¸¸æ¶ˆè€—CPUèµ„æºï¼Œä¸”å®šæ—¶å™¨æœ‰é—´è·ï¼Œæœ‰å¯èƒ½å‡ºç°keyè¿‡æœŸï¼Œä½†æ˜¯æ­¤æ—¶å®šæ—¶å™¨è¿˜æ²¡èµ·ï¼Œkeyä»ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œå¤„ç†è¿‡ç¨‹ä¸­ä¼šé˜»å¡ä¸»çº¿ç¨‹ï¼›&lt;/p&gt;
&lt;p&gt;æŠ½æ ·æ£€æŸ¥é‚£äº›æœ‰è¿‡æœŸæ—¶é—´çš„keyï¼Œæ¯æ¬¡è·å–20ä¸ªï¼ˆé»˜è®¤ï¼‰ï¼Œåˆ é™¤å…¶ä¸­è¿‡æœŸçš„keyï¼Œå¦‚æœå æ¯”è¶…è¿‡25%ï¼Œé‡å¤æ­¤æ­¥éª¤ç›´åˆ°ä½äº25%ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æƒ°æ€§åˆ é™¤ç­–ç•¥ï¼šæ¯æ¬¡è·å–keyçš„æ—¶å€™æ‰åˆ¤æ–­keyæ˜¯å¦è¿‡æœŸï¼Œè¿‡æœŸåˆ™åˆ é™¤ï¼Œå¯¹CPUæ¶ˆè€—è¾ƒå°‘ï¼Œåªå¤„ç†å½“å‰keyï¼Œä½†å¦‚æœkeyä¸€ç›´æœªè¢«ä½¿ç”¨ï¼Œåˆ™ä¼šä¸€ç›´ç•™åœ¨å†…å­˜é‡Œï¼Œæµªè´¹ç©ºé—´ï¼Œç”šè‡³å¯¼è‡´å†…å­˜æ³„æ¼ï¼›&lt;/p&gt;
&lt;p&gt;æ³¨æ„åœ¨Redis3.2ä»¥å‰ï¼Œä¸»åº“æƒ°æ€§åˆ é™¤åï¼Œä»åº“ä¸ä¼šè§¦å‘æ•°æ®åˆ é™¤ï¼Œæ­¤æ—¶è¿˜èƒ½è¯»åˆ°ï¼Œ3.2ä»¥åçš„ç‰ˆæœ¬æ‰æ”¹æ­£ï¼Œè¿”å›ç©ºå€¼ï¼Œ4.0åä»åº“æ‰ä¼šå®šæ—¶æ ¡éªŒè¿‡æœŸkeyã€‚å¦å¤–ï¼Œexpireå‘½ä»¤åœ¨ä¸»åº“è®¾ç½®keyçš„è¿‡æœŸæ—¶é—´ï¼Œåˆ°äº†ä»åº“å¯èƒ½æœ‰å»¶è¿Ÿå¯¼è‡´è¿‡æœŸæ—¶é—´æ¯”å®é™…çš„é•¿ï¼Œexpireå‘½ä»¤è¡¨ç¤ºæ‰§è¡Œå®Œå¤šä¹…ä¼šè¿‡æœŸï¼Œexpireat/pexpireatå‘½ä»¤è¡¨ç¤ºåœ¨æŸä¸€æ—¶é—´ç‚¹ä¼šè¿‡æœŸã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ‰€ä»¥Redisä¼šå°†è¿™ä¸¤ç§ç­–ç•¥æ•´åˆåœ¨ä¸€èµ·ï¼Œå®šæœŸåˆ é™¤ç­–ç•¥ä¸åœ¨æ˜¯æ¯æ¬¡éƒ½æ‰«æå…¨éƒ¨keyï¼Œè€Œæ˜¯éšæœºæŠ½å–ä¸€éƒ¨åˆ†keyè¿›è¡Œæ£€æŸ¥ï¼Œåœ¨é…åˆæƒ°æ€§åˆ é™¤ç­–ç•¥ï¼Œæ­£å¥½å¯ä»¥å¼¥è¡¥æƒ°æ€§åˆ é™¤ç­–ç•¥çš„ç¼ºç‚¹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;æ·˜æ±°ç­–ç•¥&#34;&gt;æ·˜æ±°ç­–ç•¥&lt;/h2&gt;
&lt;p&gt;å½“å†…å­˜ä½¿ç”¨é‡è¶…å‡ºæ‰€è®¾ç½®çš„maxmemoryå€¼æ—¶ï¼Œæ‰ä¼šæ‰§è¡Œæ·˜æ±°ç­–ç•¥ã€‚é»˜è®¤çš„æ·˜æ±°ç­–ç•¥æ˜¯å½“å†…å­˜æ»¡äº†ä¹‹åï¼Œæ–°å†™å…¥æ“ä½œä¼šæŠ¥é”™ã€‚maxmemoryå€¼ä¸€èˆ¬è®¾ç½®ä¸ºæ€»æ•°æ®é‡çš„15%-30%ã€‚&lt;/p&gt;
&lt;p&gt;å…¶ä»–æ·˜æ±°ç­–ç•¥ï¼Œåˆ†ä¸ºä¸¤ç§ï¼Œä¸€ç§æ˜¯åœ¨æ‰€æœ‰æ•°æ®èŒƒå›´å†…ï¼Œä¸€ç§æ˜¯åœ¨è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„èŒƒå›´å†…ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;allkeys-randomï¼šåœ¨æ‰€æœ‰keyä¸­ï¼Œéšæœºç§»é™¤æŸä¸ªkey&lt;/li&gt;
&lt;li&gt;allkeys-Lruï¼šåœ¨æ‰€æœ‰keyä¸­ï¼Œç§»é™¤æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„keyï¼ˆ&lt;strong&gt;ä¼˜å…ˆä½¿ç”¨&lt;/strong&gt;ï¼‰&lt;/li&gt;
&lt;li&gt;allkeys-Lfuï¼šåœ¨æ‰€æœ‰keyä¸­ï¼Œç§»é™¤è®¿é—®æ¬¡æ•°æœ€å°‘çš„æŸä¸ªkey&lt;/li&gt;
&lt;li&gt;volatile-randomï¼šåœ¨æ‰€æœ‰æœ‰è®¾ç½®è¿‡æœŸæ—¶é—´çš„keyä¸­ï¼Œéšæœºç§»é™¤æŸä¸ªkey&lt;/li&gt;
&lt;li&gt;volatile-Lruï¼šåœ¨æ‰€æœ‰æœ‰è®¾ç½®è¿‡æœŸæ—¶é—´çš„keyä¸­ï¼Œç§»é™¤æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„key&lt;/li&gt;
&lt;li&gt;volatile-ttlï¼šåœ¨æ‰€æœ‰æœ‰è®¾ç½®è¿‡æœŸæ—¶é—´çš„keyä¸­ï¼Œæœ‰æ›´æ—©è¿‡æœŸæ—¶é—´çš„keyä¼˜å…ˆç§»é™¤&lt;/li&gt;
&lt;li&gt;volatile-Lfuï¼šåœ¨æ‰€æœ‰æœ‰è®¾ç½®è¿‡æœŸæ—¶é—´çš„keyä¸­ï¼Œç§»é™¤è®¿é—®æ¬¡æ•°æœ€å°‘çš„æŸä¸ªkey&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;æ·˜æ±°ç­–ç•¥ä¸­çš„lruç®—æ³•&#34;&gt;æ·˜æ±°ç­–ç•¥ä¸­çš„LRUç®—æ³•&lt;/h3&gt;
&lt;p&gt;å¯¹äºLRUç®—æ³•ï¼Œå¦‚æœä¸€äº›å…ƒç´ è¢«é¢‘ç¹ä½¿ç”¨ï¼Œä¼šå¯¼è‡´é¢‘ç¹çš„ç§»åŠ¨ï¼Œå¸¦æ¥äº†é¢å¤–çš„å¼€é”€ã€‚&lt;/p&gt;
&lt;p&gt;Redisçš„LRUç®—æ³•åšäº†ç®€åŒ–ï¼Œå…¶åªä¼šåœ¨RedisObjectä¸­è®°å½•æ¯ä¸ªæ•°æ®æœ€è¿‘ä»¥æ­¤è®¿é—®çš„æ—¶é—´æˆ³ï¼Œå½“å‡ºç°æ•°æ®æ·˜æ±°æ—¶ï¼Œç¬¬ä¸€æ¬¡ä¼š&lt;strong&gt;éšæœº&lt;/strong&gt;é€‰å‡ºNä¸ªæ•°æ®ï¼Œä½œä¸ºä¸€ä¸ªå€™é€‰é›†åˆï¼Œæ¯”è¾ƒNä¸ªæ•°æ®çš„lruå­—æ®µï¼ŒæŠŠlruå­—æ®µæœ€å°çš„å…ƒç´ æ·˜æ±°ã€‚&lt;/p&gt;
&lt;p&gt;å†æ¬¡æ·˜æ±°æ—¶ï¼ŒRedisä¼šæŒ‘é€‰é‚£äº›LRUçš„å€¼å°äºå€™é€‰é›†åˆä¸­æœ€å°LRUå€¼çš„æ•°æ®ï¼Œè¿›å…¥ç¬¬ä¸€æ¬¡æ·˜æ±°æ—¶åˆ›å»ºçš„å€™é€‰é›†åˆï¼Œå¯èƒ½ä¼šæŠŠé‡Œé¢æœ€å¤§çš„æ¢å‡ºå»æˆ–è€…æ·˜æ±°é‡Œé¢æœ€å°çš„ã€‚å‡†å¤‡å€™é€‰é›†å’Œæ·˜æ±°æ•°æ®æ˜¯ä¸¤ä¸ªè§£è€¦æ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;Nçš„å€¼ç”±&lt;code&gt;maxmemory-samples&lt;/code&gt;å†³å®šã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ·˜æ±°ç­–ç•¥ä¸­çš„lfuç®—æ³•&#34;&gt;æ·˜æ±°ç­–ç•¥ä¸­çš„LFUç®—æ³•&lt;/h3&gt;
&lt;p&gt;Redisçš„LRUç®—æ³•æœ‰ä¸ªé—®é¢˜æ˜¯å¯¹äºéçƒ­ç‚¹æ•°æ®ï¼Œå…¶è®¿é—®æ¬¡æ•°å¾ˆå°‘ï¼Œç›´åˆ°è§¦å‘æ·˜æ±°ç­–ç•¥æ‰ä¼šè¢«åˆ é™¤ï¼Œåœ¨è¢«åˆ é™¤ä¹‹å‰éƒ½ä¼šä¸€ç›´ç•™å­˜ï¼Œé€ æˆç¼“å­˜æ±¡æŸ“ã€‚LFUç®—æ³•å°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;LFUç¼“å­˜ç­–ç•¥æ˜¯åœ¨LRUç­–ç•¥åŸºç¡€ä¸Šï¼Œä¸ºæ¯ä¸ªæ•°æ®å¢åŠ ä¸€ä¸ªè®¡æ•°å™¨ï¼Œç»Ÿè®¡æ•°æ®è®¿é—®æ¬¡æ•°ã€‚å½“ä½¿ç”¨LFUæ·˜æ±°ç­–ç•¥ç­›é€‰æ·˜æ±°æ•°æ®æ—¶ï¼Œé¦–å…ˆä¼šæ ¹æ®è®¿é—®æ¬¡æ•°è¿›è¡Œç­›é€‰ï¼ŒæŠŠè®¿é—®æ¬¡æ•°æœ€ä½çš„æ•°æ®æ·˜æ±°å‡ºç¼“å­˜ï¼Œå½“æ·˜æ±°æ¬¡æ•°ç›¸åŒæ—¶ï¼Œæ‰ä¼šæ¯”è¾ƒæ—¶é—´ã€‚&lt;/p&gt;
&lt;p&gt;LFUåœ¨LRUçš„åŸºç¡€ä¸Šï¼Œå°†RedisObjectä¸­çš„è®¿é—®æ—¶é—´æˆ³æ‹†æˆä¸¤åŠï¼Œ16bitå­˜æ—¶é—´ï¼Œ8bitå­˜è®¡æ•°ï¼Œä½†è®¡æ•°ä¸æ˜¯çº¿æ€§é€’å¢ï¼Œè€Œæ˜¯é‡‡ç”¨ä¸€ç§è®¡ç®—è§„åˆ™ï¼Œè®©å…¶å¢é•¿ä¸é‚£ä¹ˆå¿«åˆ°è¾¾2^8=255æ¬¡ï¼ŒåŒæ—¶ä¹Ÿæœ‰è¡°å‡æœºåˆ¶ï¼Œå‡å°‘æ¬¡æ•°å¯¹æ—¶é—´çš„å½±å“ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ·˜æ±°æ‰§è¡Œæ—¶æœº&#34;&gt;æ·˜æ±°æ‰§è¡Œæ—¶æœº&lt;/h3&gt;
&lt;p&gt;æ·˜æ±°æ—¶æœºå’Œè¢«åŠ¨åˆ é™¤è¿‡æœŸkeyçš„æ—¶æœºä¸€æ ·ï¼Œåœ¨ç”¨æˆ·çš„å‘½ä»¤çœŸæ­£æ‰§è¡Œä¹‹å‰æ‰§è¡Œæ·˜æ±°ç­–ç•¥ï¼›&lt;/p&gt;
&lt;h1 id=&#34;å­˜å‚¨ä¸æŒä¹…åŒ–&#34;&gt;å­˜å‚¨ä¸æŒä¹…åŒ–&lt;/h1&gt;
&lt;h2 id=&#34;rdbå¿«ç…§redis-database&#34;&gt;RDBå¿«ç…§ï¼ˆRedis DataBaseï¼‰&lt;/h2&gt;
&lt;p&gt;RDBå¿«ç…§ç”±äºä¿å­˜çš„æ˜¯æ•°æ®ï¼Œæ¢å¤èµ·æ¥ä¼šæ¯”AOFå¿«ï¼ˆAOFä¿å­˜çš„æ˜¯å‘½ä»¤ï¼‰ï¼Œè€Œä¸”AOFæ˜¯æ–‡æœ¬æ–‡ä»¶ï¼ŒRDBæ˜¯äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œæ‰€ä»¥RDBå¿«ç…§åœ¨ç½‘ç»œä¼ è¾“ã€IOæ•ˆç‡éƒ½æ¯”AOFå¥½ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ç›¸å…³å‘½ä»¤å’Œé…ç½®&#34;&gt;ç›¸å…³å‘½ä»¤å’Œé…ç½®&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;bgsave&lt;/code&gt;ï¼šä¼šè°ƒå­è¿›ç¨‹åˆ›å»ºå¿«ç…§å†™å…¥ç£ç›˜ï¼Œä¸»çº¿ç¨‹ç»§ç»­å¤„ç†å…¶ä»–å‘½ä»¤è¯·æ±‚ï¼›&lt;/p&gt;
&lt;p&gt;&lt;code&gt;save&lt;/code&gt;ï¼šä¸»çº¿ç¨‹åˆ›å»ºå¿«ç…§å†™å…¥ç£ç›˜ï¼Œä¼šé˜»å¡å…¶ä»–å‘½ä»¤è¯·æ±‚ï¼Œç”Ÿäº§ç¯å¢ƒä¸­æ¯”è¾ƒå°‘ç”¨ï¼›&lt;/p&gt;
&lt;p&gt;redis.conf æ–‡ä»¶é‡Œçš„é…ç½®ï¼š&lt;/p&gt;
&lt;p&gt;&lt;code&gt;save&lt;/code&gt;ï¼š&lt;code&gt;save [æ—¶é—´] [æ¬¡æ•°]&lt;/code&gt; è¡¨ç¤ºåœ¨[æ—¶é—´]å†…æœ‰[æ¬¡æ•°]å†™å…¥/æ›´æ–°ï¼Œå°±ä¼šè§¦å‘bgsaveå‘½ä»¤&lt;/p&gt;
&lt;p&gt;å¦å¤–ï¼Œåœ¨è¿›è¡Œä¸»ä»å¤åˆ¶ï¼Œä¸»rediså‘é€syncå‘½ä»¤ç»™ä»redisæ—¶ï¼Œå¦‚æœåˆšåˆšæ²¡æœ‰æ‰§è¡Œå®Œbgsaveï¼Œä¹Ÿä¼šè¿›è¡Œä¸€æ¬¡bgsaveæ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;rdbcompression&lt;/code&gt;ï¼šæ˜¯å¦å¯ç”¨LZFç®—æ³•è¿›è¡Œå‹ç¼©ï¼Œå‹ç¼©å¯ä»¥ä½¿å¾—RDBå¿«ç…§è½ç›˜çš„æ–‡ä»¶å˜å°ï¼Œä½†åœ¨å‹ç¼©æ—¶ä¼šæ¶ˆè€—CPUèµ„æºã€‚&lt;/p&gt;
&lt;h3 id=&#34;åŸç†&#34;&gt;åŸç†&lt;/h3&gt;
&lt;p&gt;å°†Redisä¸­çš„æ•°æ®å…¨é‡ä¿å­˜åœ¨æ–‡ä»¶ä¸­ï¼Œä¸€èˆ¬ä¼šå¼‚æ­¥ä½¿ç”¨å­è¿›ç¨‹è¿›è¡Œåˆ·ç›˜æ“ä½œï¼Œä¸é˜»å¡ä¸»çº¿ç¨‹ï¼Œæ­¤æ—¶ä¸»çº¿ç¨‹ä»ç„¶èƒ½å¤„ç†å‘½ä»¤ã€‚ï¼ˆ&lt;strong&gt;å…ˆå…¨é‡&lt;/strong&gt;ï¼‰&lt;/p&gt;
&lt;p&gt;æ­¤å¤–ï¼Œä¼šä½¿ç”¨&lt;strong&gt;Copy on Writeæœºåˆ¶ï¼ˆå†™æ—¶å¤åˆ¶ï¼‰&lt;/strong&gt;ï¼Œè§£å†³åˆ›å»ºå¿«ç…§çš„è¿‡ç¨‹ä¸­ï¼ŒåŸæœ‰æ•°æ®è¢«ä¿®æ”¹å¯¹RDBå¿«ç…§çš„å½±å“ã€‚å½“ä¸»çº¿ç¨‹å¯¹åŸæœ‰æ•°æ®è¿›è¡Œä¿®æ”¹å‰ï¼Œè¿™å—æ•°æ®ä¼šè¢«å¤åˆ¶ä¸€ä»½ï¼ˆå¤åˆ¶å¼•ç”¨ï¼Œç”±bgsaveå­è¿›ç¨‹æ“ä½œï¼‰ï¼Œå½¢æˆå‰¯æœ¬ï¼ˆæ­¤æ—¶ä¼šæ¶ˆè€—ä¸¤å€å†…å­˜ï¼‰ï¼Œç”±å­è¿›ç¨‹å°†è¯¥å‰¯æœ¬å†™å…¥RDBæ–‡ä»¶ä¸­ï¼Œç”±äºå†™çš„æ˜¯å¼•ç”¨ï¼Œä¸»çº¿ç¨‹ä¿®æ”¹åä¼šåŒæ­¥åˆ°RDBä¸­ã€‚ï¼ˆ&lt;strong&gt;åå¢é‡&lt;/strong&gt;ï¼‰&lt;/p&gt;
&lt;p&gt;Copy on Writeï¼šä»£ç æ˜¯å…±äº«çš„ï¼Œæ•°æ®æ˜¯ç§æœ‰çš„ï¼Œå­è¿›ç¨‹è¢«åˆ›å»ºå‡ºæ¥åï¼Œå­è¿›ç¨‹å°±å°†çˆ¶è¿›ç¨‹çš„æ•°æ®æ‹·è´äº†ä¸€ä»½ç»™è‡ªå·±ï¼Œå¦‚æœæ˜¯åªè¯»çš„æ•°æ®ï¼Œçˆ¶å­è¿›ç¨‹é¡µè¡¨æŒ‡å‘åŒä¸€ä¸ªç‰©ç†å†…å­˜ï¼Œå¦‚æœå­è¿›ç¨‹æˆ–è€…çˆ¶è¿›ç¨‹ä¿®æ”¹äº†é¡µè¡¨ï¼Œæ­¤æ—¶ä¼šåˆ†ç¦»æˆä¸¤ä»½ï¼ŒæŒ‡å‘ä¸åŒçš„ç‰©ç†å†…å­˜ï¼Œè®©çˆ¶å­è¿›ç¨‹å¯¹è¿™ä¸€å—æ•°æ®æ“ä½œä¸ä¼šç›¸äº’å¹²æ‰°ï¼›&lt;/p&gt;
&lt;p&gt;ä»è€Œå‡å°‘åˆ†é…å’Œå¤åˆ¶å¤§é‡èµ„æºæ—¶å¸¦æ¥çš„ç¬æ—¶å»¶æ—¶ï¼Œç¼ºç‚¹å°±æ˜¯ï¼Œå¦‚æœå†™æ“ä½œå¾ˆå¤šï¼Œå°±ä¼šäº§ç”Ÿå¤§é‡çš„åˆ†é¡µä¸­æ–­ï¼Œäº§ç”Ÿå¤§é‡å¤åˆ¶ï¼Œå¸¦æ¥å»¶æ—¶ï¼Œå½“ç„¶ï¼Œå› ä¸ºredisæ˜¯è¯»å¤šå†™å°‘çš„åœºæ™¯ï¼Œæ‰€ä»¥è¿˜ç®—åˆé€‚ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ä¼˜ç‚¹&#34;&gt;ä¼˜ç‚¹&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;RDBæ–‡ä»¶æ˜¯æŸä¸ªæ—¶é—´èŠ‚ç‚¹çš„å¿«ç…§ï¼Œé»˜è®¤ä½¿ç”¨LZFç®—æ³•è¿›è¡Œå‹ç¼©ï¼Œå‹ç¼©åçš„æ–‡ä»¶ä½“ç§¯è¿œè¿œå°äºå†…å­˜å¤§å°ï¼Œé€‚ç”¨äºå¤‡ä»½ã€å…¨é‡å¤åˆ¶ç­‰åœºæ™¯ï¼›&lt;/li&gt;
&lt;li&gt;RedisåŠ è½½RDBæ–‡ä»¶æ¢å¤æ•°æ®è¦è¿œè¿œå¿«äºAOFæ–¹å¼ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;æ½œåœ¨é£é™©&#34;&gt;æ½œåœ¨é£é™©&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;é£é™©åœ¨äºå¿«ç…§çš„åˆ›å»ºé¢‘ç‡ï¼Œå¿«ç…§æ˜¯æ¯éš”ä¸€æ®µæ—¶é—´è¿›è¡Œåˆ›å»ºå’Œå†™å…¥çš„ï¼Œå¦‚æœé¢‘ç¹åˆ›å»ºå¿«ç…§ï¼Œå¤šå¿«ç…§å†™ç›˜ä¼šå½±å“ç£ç›˜IOï¼Œå› æ­¤æ¯æ¬¡éƒ½è¿›è¡Œå…¨é‡å¿«ç…§å¹¶ä¸å¯å–ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¦‚æœé¢‘ç‡è¿‡ä½ï¼Œåˆ™ä¼šå¯¼è‡´å®•æœºæ—¶ä¸¢å¤±çš„æ•°æ®è¿‡å¤šã€‚è§£å†³æ–¹å¼æ˜¯RDB + AOFä¸€èµ·ä½¿ç”¨ï¼Œåœ¨ä¸¤æ¬¡å¿«ç…§æœŸé—´ç”¨AOFä»£æ›¿ã€‚&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;å½“ä½¿ç”¨copy on writeæœºåˆ¶æ—¶ï¼Œä¸»çº¿ç¨‹ä¼šä¸ºå…¶ç”³è¯·é¢å¤–çš„ç©ºé—´ï¼Œå½“è¿›è¡Œé¢‘ç¹çš„å†™æ“ä½œæ—¶ï¼Œä¼šå¯¼è‡´å†…å­˜å¾ˆå¿«è¢«è€—å…‰ã€‚å½“å®ä¾‹ç³»ç»Ÿå¼€å¯äº†Swapæœºåˆ¶æ—¶ï¼Œè¶…è¿‡å†…å­˜ä½¿ç”¨é‡éƒ¨åˆ†ä¼šè½¬ç§»åˆ°ç£ç›˜ï¼Œè®¿é—®ç£ç›˜çš„é‚£éƒ¨åˆ†å°±ä¼šå¾ˆæ…¢ï¼Œå¦‚æœæ²¡æœ‰å¼€å¯Swapæœºåˆ¶ï¼Œåˆ™ä¼šè§¦å‘OOMï¼ŒRedisè¿›ç¨‹å¯èƒ½è¢«killæˆ–å®•æœºï¼›&lt;/li&gt;
&lt;li&gt;å¦å¤–ï¼Œå½“å‡ºç°é¢‘ç¹çš„å†™æ“ä½œæ—¶ï¼Œç”±äºç”ŸæˆRDBçš„å­è¿›ç¨‹éœ€è¦CPUæ ¸è¿è¡Œï¼Œä¸»çº¿ç¨‹ã€å¤šä¸ªçº¿ç¨‹æˆ–åå°è¿›ç¨‹ä¼šç«äº‰ä½¿ç”¨CPUï¼Œå¯¼è‡´æ€§èƒ½é™ä½ï¼›&lt;/li&gt;
&lt;li&gt;å®æ—¶æ€§ä¸å¤Ÿï¼Œæ— æ³•åšåˆ°ç§’çº§åˆ«çš„æŒä¹…åŒ–ï¼›&lt;/li&gt;
&lt;li&gt;RDBæ–‡ä»¶æ˜¯äºŒè¿›åˆ¶ï¼Œæ²¡æœ‰å¯è¯»æ€§ï¼Œè€ŒAOFæ–‡ä»¶å¯ä»¥åœ¨äº†è§£å…¶ç»“æ„åæ‰‹åŠ¨ä¿®æ”¹æˆ–è¡¥å…¨ï¼›&lt;/li&gt;
&lt;li&gt;ç‰ˆæœ¬å…¼å®¹RDBæ–‡ä»¶é—®é¢˜&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;aofappend-only-file&#34;&gt;AOFï¼ˆAppend Only Fileï¼‰&lt;/h2&gt;
&lt;h3 id=&#34;ç›¸å…³å‘½ä»¤å’Œé…ç½®-1&#34;&gt;ç›¸å…³å‘½ä»¤å’Œé…ç½®&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;bgrewriteaof&lt;/code&gt;ï¼šæ‰§è¡Œåï¼ŒRedisä¸»è¿›ç¨‹forkå­è¿›ç¨‹æ‰§è¡Œ&lt;strong&gt;AOFé‡å†™&lt;/strong&gt;ï¼Œè¯¥å­è¿›ç¨‹ä¼šåˆ›å»ºæ–°çš„AOFæ–‡ä»¶æ¥å­˜å‚¨é‡å†™ç»“æœï¼Œé˜²æ­¢å½±å“æ—§æ–‡ä»¶ï¼›&lt;/p&gt;
&lt;p&gt;redis.confæ–‡ä»¶é‡Œçš„é…ç½®ï¼š&lt;/p&gt;
&lt;p&gt;&lt;code&gt;appendonly yes&lt;/code&gt;ï¼šaofé»˜è®¤æ˜¯å…³é—­çš„ï¼Œå¦‚æœè¦æ‰“å¼€ï¼Œè®¾ç½®æˆyesï¼›&lt;/p&gt;
&lt;p&gt;&lt;code&gt;appendfsync&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;noï¼šæ¯æ¬¡å‘½ä»¤åªå†™å†…å­˜(æ—¥å¿—ç¼“å†²åŒº)ï¼Œåˆ·ç›˜è®°æ—¥å¿—çš„æ“ä½œç”±æ“ä½œç³»ç»Ÿå†³å®šï¼Œä¸é˜»å¡ä¸»çº¿ç¨‹ï¼Œè°ƒç”¨fsyncï¼Œé€šå¸¸æœ€å¤š30sï¼›&lt;/li&gt;
&lt;li&gt;everysecï¼ˆé»˜è®¤ï¼‰ï¼šå†™å‘½ä»¤è®°å½•åˆ°æ–‡ä»¶ä¸­ï¼Œ&lt;strong&gt;é»˜è®¤æ˜¯æ¯ç§’åŒæ­¥ä¸€æ¬¡&lt;/strong&gt;ï¼ˆè°ƒç”¨ä¸€æ¬¡fsyncï¼‰ï¼Œæ‰€ä»¥å¦‚æœå‘ç”Ÿæ•…éšœï¼Œæœ€å¤šä¼šä¸¢å¤±ä¸€ç§’çš„æ•°æ®ï¼Œä½†ä½¿ç”¨AOFä¿å­˜çš„æ•°æ®æ–‡ä»¶æ¯”RDBå¿«ç…§è¦å¤§ï¼›&lt;strong&gt;Redisä¼šä½¿ç”¨å¦å¤–çš„çº¿ç¨‹è¿›è¡Œåˆ·ç›˜ï¼›&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;alwaysï¼šæ­¤å¤–AOFè¿˜èƒ½é€‰æ‹©æ¯æ¥æ”¶ä¸€ä¸ªå†™å‘½ä»¤å°±è¿½åŠ å†™å…¥åˆ°AOFæ–‡ä»¶ä¸­ï¼Œè™½ç„¶èƒ½é¿å…ä¸ä¸¢æ•°æ®ï¼Œ&lt;strong&gt;ä½†æ¯ä¸ªå†™å‘½ä»¤éƒ½æ˜¯åœ¨ä¸»çº¿ç¨‹ä¸Šå®Œæˆï¼Œä¸”åé¢éƒ½è·Ÿç€ä¸€ä¸ªåˆ·ç›˜æ“ä½œ&lt;/strong&gt;ï¼Œå¯¹æœºå™¨çš„è´Ÿæ‹…è¾ƒå¤§ï¼Œå½±å“æœåŠ¡æ€§èƒ½ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;code&gt;auto-aof-rewrite-percentage 100&lt;/code&gt;ï¼šaofæ–‡ä»¶çš„å®¹é‡è¶…è¿‡åŸæ¥aofæ–‡ä»¶å®¹é‡ä¸€å€çš„æ—¶å€™, è¿›è¡Œaofæ–‡ä»¶çš„é‡å†™ï¼Œé»˜è®¤100ï¼›&lt;/p&gt;
&lt;p&gt;&lt;code&gt;auto-aof-rewrite-min-size 64mb&lt;/code&gt;ï¼šæ‰§è¡Œaofé‡å†™æ—¶, aofæ–‡ä»¶çš„æœ€å°å®¹é‡ï¼Œé»˜è®¤64MBï¼›&lt;/p&gt;
&lt;h3 id=&#34;åŸç†-1&#34;&gt;åŸç†&lt;/h3&gt;
&lt;p&gt;AOFæ—¶ï¼ŒRedisä¼šå…ˆæŠŠå‘½ä»¤è¿½åŠ è¿‘AOFå†…å­˜ç¼“å†²åŒºï¼Œç„¶åæ ¹æ®&lt;code&gt;appendfsync&lt;/code&gt;é…ç½®çš„ç­–ç•¥å°†å†…å­˜ä¸­çš„æ•°æ®å†™å…¥ç£ç›˜ã€‚&lt;/p&gt;
&lt;p&gt;ä¸åŒä¸MySQLçš„WALæœºåˆ¶ï¼ŒAOFæ˜¯å…ˆæ‰§è¡Œå‘½ä»¤å°†æ•°æ®å†™å…¥å†…å­˜ï¼Œå†å†™å…¥æ—¥å¿—ã€‚å› ä¸ºAOFä¼šè®°å½•Redisæ”¶åˆ°çš„æ¯ä¸€æ¡å‘½ä»¤ï¼Œå¹¶ä»¥æ–‡æœ¬çš„å½¢å¼ä¿å­˜ï¼Œå¦‚æœå…ˆå†™æ—¥å¿—ï¼Œå¹¶ä¸çŸ¥é“å‘½ä»¤æ˜¯å¦æ˜¯æ­£ç¡®çš„ï¼Œå› æ­¤å…ˆå†™å†…å­˜ï¼Œè®©ç³»ç»Ÿæ‰§è¡ŒæˆåŠŸåï¼Œæ‰ä¼šè®°å½•åˆ°æ—¥å¿—ä¸­ï¼Œé¿å…é”™è¯¯å‘½ä»¤ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ½œåœ¨é£é™©-1&#34;&gt;æ½œåœ¨é£é™©&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;æ‰§è¡Œå®Œå‘½ä»¤ï¼Œè¿˜æ²¡æ¥å¾—åŠè®°å½•æ—¥å¿—å°±å®•æœºï¼Œæ­¤æ—¶ä¼šä¸¢å¤±è¯¥å‘½ä»¤çš„è®°å½•å’Œç›¸åº”æ•°æ®ã€‚å¦‚æœä½¿ç”¨Rediså½“ç¼“å­˜ï¼Œä¸”è¦ä¿è¯Rediså®•æœºæ—¶ä¸ç›´æ¥è¯»åº“ï¼Œåˆ©ç”¨Redisçš„AOFæœºåˆ¶æ—¶å°±è¦æ³¨æ„äº†ã€‚&lt;/li&gt;
&lt;li&gt;AOFæ˜¯åœ¨å‘½ä»¤æ‰§è¡Œåæ‰è®°å½•æ—¥å¿—ï¼Œæ‰€ä»¥ä¸ä¼šé˜»å¡å½“å‰çš„å†™æ“ä½œï¼Œä½†ç”±äºæ—¥å¿—çš„å†™æ“ä½œä¹Ÿæ˜¯åœ¨ä¸»çº¿ç¨‹ä¸­çš„ï¼Œè™½ç„¶é¿å…é˜»å¡å½“å‰æ“ä½œï¼Œä½†å¯èƒ½ä¼šé˜»å¡ä¸‹ä¸€ä¸ªå‘½ä»¤æ“ä½œï¼Œæ¯”å¦‚åˆ·ç›˜æ—¶ç£ç›˜IOè¿‡æ…¢ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;é‡å†™æœºåˆ¶&#34;&gt;é‡å†™æœºåˆ¶&lt;/h3&gt;
&lt;p&gt;ä¸€èˆ¬ç”¨äº&lt;strong&gt;é¿å…AOFæ—¥å¿—æ–‡ä»¶è¿‡å¤§&lt;/strong&gt;ï¼Œæ¯•ç«Ÿå¦‚æœæ–‡ä»¶å¤ªå¤§ä¼šå½±å“ç£ç›˜IOã€é‡æ”¾ä¼šå¤ªè€—æ—¶ã€‚&lt;/p&gt;
&lt;h4 id=&#34;åŸç†-2&#34;&gt;åŸç†&lt;/h4&gt;
&lt;p&gt;å½“AOFæ–‡ä»¶å¤§å°è¶…è¿‡é…ç½®æ—¶ï¼Œæ‰§è¡ŒAOFé‡å†™æœºåˆ¶ã€‚Redisä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„AOFæ–‡ä»¶ï¼Œ&lt;strong&gt;è¯»å–Redisä¸­æ‰€æœ‰é”®å€¼å¯¹&lt;/strong&gt;åè¿›è¡Œå†™å…¥ï¼Œä½†åœ¨é‡å†™æ—¶ä¸æ˜¯åŸæ ·copyï¼Œè€Œæ˜¯&lt;strong&gt;ä¼šå¯¹å‘½ä»¤è¿›è¡Œåˆå¹¶ï¼Œä»¥æ­¤å‡å°æ–‡ä»¶å¤§å°&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;é‡å†™æ—¶ï¼Œä¸»çº¿ç¨‹ä¼šforkåå°çš„bgrewriteiaofå­è¿›ç¨‹ï¼ŒæŠŠ&lt;strong&gt;ä¸»çº¿ç¨‹çš„å†…å­˜æ‹·è´ä¸€ä»½ç»™bgrewriteiaofå­è¿›ç¨‹&lt;/strong&gt;ï¼Œå…¶ä¸­ä¹ŸåŒ…æ‹¬äº†Redisçš„æœ€æ–°æ•°æ®ï¼Œbgrewriteiaofå­è¿›ç¨‹é€ä¸€å†™å…¥é‡å†™æ—¥å¿—ï¼Œé¿å…é˜»å¡ä¸»çº¿ç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;å› ä¸ºé‡å†™æ˜¯åœ¨å­è¿›ç¨‹ä¸­å¤„ç†çš„ï¼Œæ­¤æ—¶ä¸»çº¿ç¨‹ä»ç„¶èƒ½å¤„ç†å®¢æˆ·ç«¯çš„å‘½ä»¤ï¼Œå½“æ¥æ”¶åˆ°å®¢æˆ·ç«¯çš„å†™å‘½ä»¤æ—¶ï¼Œ&lt;strong&gt;ä¼šè®°å½•åˆ°AOFæ—¥å¿—&lt;/strong&gt;ä¸­ï¼Œ&lt;strong&gt;åŒæ—¶&lt;/strong&gt;ä¹Ÿä¼šå†™è¿›&lt;strong&gt;AOFé‡å†™æ—¥å¿—&lt;/strong&gt;çš„ç¼“å†²åŒºï¼Œç­‰å­è¿›ç¨‹å°†æ‹·è´æ•°æ®å†™å®Œåï¼Œå†æŠŠç¼“å†²åŒºçš„æ•°æ®åˆ·å…¥ï¼Œå®Œæˆåå³å¯åˆ é™¤æ—§çš„AOFæ–‡ä»¶ï¼Œç•™ä¸‹æ–°çš„AOFé‡å†™æ–‡ä»¶ã€‚&lt;/p&gt;
&lt;h4 id=&#34;æ½œåœ¨é£é™©-2&#34;&gt;æ½œåœ¨é£é™©&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;ä¸»çº¿ç¨‹forkåˆ›å»ºbgrewriteaofå­è¿›ç¨‹æ—¶ï¼Œå†…æ ¸ä¼šæŠŠä¸»çº¿ç¨‹çš„PCBå†…å®¹æ‹·è´ç»™å­è¿›ç¨‹ï¼Œæ­¤æ—¶ä¼šé˜»å¡ä¸»çº¿ç¨‹ï¼Œå½“è¦æ‹·è´çš„å†…å®¹ç‰¹åˆ«å¤§æ—¶ï¼Œforkæ‰§è¡Œçš„æ—¶é—´å°±ä¼šå˜é•¿ï¼Œé˜»å¡ä¸»çº¿ç¨‹çš„æ—¶é—´ä¹Ÿä¼šå˜é•¿ã€‚&lt;/li&gt;
&lt;li&gt;bgrewriteaofå­è¿›ç¨‹ä¼šå’Œä¸»çº¿ç¨‹å…±äº«å†…å­˜ï¼Œå½“ä¸»çº¿ç¨‹æ”¶åˆ°æ–°å¢æˆ–ä¿®æ”¹æ“ä½œæ—¶ï¼Œä¸»çº¿ç¨‹ä¼šç”³è¯·æ–°çš„å†…å­˜ç©ºé—´ç”¨æ¥ä¿å­˜ï¼Œä½†æ˜¯å¦‚æœæ˜¯bigkeyï¼Œä¸»çº¿ç¨‹å°±ä¼šé¢ä¸´ç”³è¯·ç©ºé—´è¿‡å¤§å¯¼è‡´è€—æ—¶ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;é«˜å¯ç”¨é›†ç¾¤&#34;&gt;é«˜å¯ç”¨é›†ç¾¤&lt;/h1&gt;
&lt;p&gt;RDBå’ŒAOFä¿è¯äº†æ•°æ®å°‘ä¸¢å¤±ï¼Œé›†ç¾¤éƒ¨ç½²ä¿è¯æœåŠ¡å°‘ä¸­æ–­ï¼Œå®ç°é«˜å¯ç”¨ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä¸»ä»å¤åˆ¶---ä¿è¯æ•°æ®ä¸€è‡´æ€§&#34;&gt;ä¸»ä»å¤åˆ¶ - ä¿è¯æ•°æ®ä¸€è‡´æ€§&lt;/h2&gt;
&lt;p&gt;ä¸€èˆ¬é‡‡ç”¨ä¸»ä»è¯»å†™åˆ†ç¦»ï¼Œä¸»åº“è¿›è¡Œå†™æ“ä½œï¼Œç„¶åå†åŒæ­¥ç»™ä»æœåŠ¡ï¼›è€Œè¯»æ“ä½œå‘ç”Ÿåœ¨ä¸»ä»åº“å‡å¯ã€‚æœ€å¥½è¿˜æ˜¯è¯»å†™éƒ½åœ¨ä¸»åº“ï¼Œä»åº“åªä¿è¯é«˜å¯ç”¨ï¼ŒåŸå› æ˜¯ä¸»ä»æ•°æ®åŒæ­¥æ˜¯å¼‚æ­¥çš„ï¼Œæ€»æœ‰å¯èƒ½å‡ºç°ç½‘ç»œæ³¢åŠ¨ç­‰é—®é¢˜å¯¼è‡´ä¸»ä»åº“æ•°æ®ä¸ä¸€è‡´ï¼Œæˆ–è€…ä¸»åº“è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œä½†æ˜¯åˆ°ä»åº“ä¸Šæœ‰å»¶è¿Ÿå¯¼è‡´è¯»åˆ°è¿‡æœŸæ•°æ®ï¼Œä¸»åº“çš„è¿‡æœŸåˆ é™¤æ— æ³•åŒæ­¥åˆ°ä»åº“ï¼ˆ4.0æ‰è§£å†³ï¼‰ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å½“ Redis è¿è¡Œåœ¨ä¸»ä»æ¨¡å¼ä¸‹æ—¶ï¼Œ&lt;strong&gt;ä»åº“ä¸ä¼šè¿›è¡Œè¿‡æœŸæ‰«æï¼Œä»åº“å¯¹è¿‡æœŸçš„å¤„ç†æ˜¯è¢«åŠ¨çš„&lt;/strong&gt;ã€‚ä¹Ÿå°±æ˜¯å³ä½¿ä»åº“ä¸­çš„ key è¿‡æœŸäº†ï¼Œå¦‚æœæœ‰å®¢æˆ·ç«¯è®¿é—®ä»åº“æ—¶ï¼Œä¾ç„¶å¯ä»¥å¾—åˆ° key å¯¹åº”çš„å€¼ï¼Œåƒæœªè¿‡æœŸçš„é”®å€¼å¯¹ä¸€æ ·è¿”å›ã€‚&lt;/p&gt;
&lt;p&gt;ä»åº“çš„è¿‡æœŸé”®å¤„ç†ä¾é ä¸»æœåŠ¡å™¨æ§åˆ¶ï¼Œ&lt;strong&gt;ä¸»åº“åœ¨ key åˆ°æœŸæ—¶ï¼Œä¼šåœ¨ AOF æ–‡ä»¶é‡Œå¢åŠ ä¸€æ¡ del æŒ‡ä»¤ï¼ŒåŒæ­¥åˆ°æ‰€æœ‰çš„ä»åº“&lt;/strong&gt;ï¼Œä»åº“é€šè¿‡æ‰§è¡Œè¿™æ¡ del æŒ‡ä»¤æ¥åˆ é™¤è¿‡æœŸçš„ keyã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å¦‚æœå†™æ“ä½œå¯ä»¥å‘ç”Ÿåœ¨ä¸»ä»åº“ä¸Šï¼Œä¼šå¯¼è‡´ä¸»ä»åº“ä¸Šçš„æ•°æ®ä¸ä¸€è‡´ï¼Œå–æ•°æ®æ—¶å¯èƒ½ä¼šå–åˆ°æ—§å€¼ï¼Œè€Œå¦‚æœè¦ä¿æŒä¸€è‡´ï¼Œåˆ™éœ€è¦åŠ é”ï¼ŒåŠ é”çš„è¯æ•ˆç‡æ—§å¤ªå·®äº†ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€èˆ¬ç”¨åœ¨&lt;strong&gt;ä»èŠ‚ç‚¹&lt;/strong&gt;åˆå§‹åŒ–åŠ å…¥æ—¶ä½¿ç”¨ï¼Œå…ˆè¿›è¡Œ&lt;strong&gt;å…¨é‡åŒæ­¥(é€šè¿‡å¿«ç…§)&lt;/strong&gt;ï¼Œå†è¿›è¡Œ&lt;strong&gt;å¢é‡åŒæ­¥(é€šè¿‡å‘½ä»¤ç¼“å­˜åŒæ­¥)&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ç›¸å…³å‘½ä»¤&#34;&gt;ç›¸å…³å‘½ä»¤&lt;/h3&gt;
&lt;p&gt;åœ¨ä»åº“ä¸Šä½¿ç”¨å‘½ä»¤ï¼šRedis 5.0ä»¥å‰ä½¿ç”¨&lt;code&gt;slaveof&lt;/code&gt;ã€ä¹‹åä½¿ç”¨&lt;code&gt;replicaof  [ä¸»åº“IP] [ä¸»åº“ç«¯å£]&lt;/code&gt;&lt;/p&gt;
&lt;h3 id=&#34;è¿‡ç¨‹&#34;&gt;è¿‡ç¨‹&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;ä¸»åº“åˆ›å»ºRDBå¿«ç…§æ–‡ä»¶ï¼Œå‘é€ç»™ä»åº“ï¼Œå¹¶åœ¨å‘é€æœŸé—´ä½¿ç”¨ç¼“å†²åŒº(replication buffer)è®°å½•ä¹‹åæ”¶åˆ°çš„å†™å‘½ä»¤ã€‚&lt;/p&gt;
&lt;p&gt;å¿«ç…§æ–‡ä»¶å‘é€å®Œæ¯•ä¹‹åï¼Œå¼€å§‹å‘ä»åº“å‘é€å­˜å‚¨åœ¨ç¼“å†²åŒºä¸­çš„å†™å‘½ä»¤ï¼›æ•´ä¸ªè¿‡ç¨‹ä¸­ä¸»åº“ä¸ä¼šè¢«é˜»å¡ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä»åº“ä¸¢å¼ƒæ‰€æœ‰æ—§æ•°æ®ï¼Œè½½å…¥ä¸»åº“å‘æ¥çš„å¿«ç…§æ–‡ä»¶ï¼Œä¹‹åä»åº“å¼€å§‹æ¥å—ä¸»åº“å‘æ¥çš„å†™å‘½ä»¤ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¸»åº“æ¯æ‰§è¡Œä¸€æ¬¡å†™å‘½ä»¤ï¼Œå°±å‘ä»åº“å‘é€ç›¸åŒçš„å†™å‘½ä»¤ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä¸€èˆ¬åªè®¾ç½®ä¸€ä¸ªä¸»èŠ‚ç‚¹ï¼Œå½“è´Ÿè½½ä¸Šå‡æ—¶ï¼Œä¸»åº“å¯èƒ½æ— æ³•å¾ˆå¿«åœ°æ›´æ–°æ‰€æœ‰ä»åº“ï¼Œæˆ–è€…é‡æ–°è¿æ¥å’Œé‡æ–°åŒæ­¥ä»åº“å°†å¯¼è‡´ç³»ç»Ÿè¶…è½½ã€‚å› ä¸ºåœ¨ä¸€æ¬¡ä¸»ä»æ•°æ®åŒæ­¥è¿‡ç¨‹ä¸­ï¼Œä¸»åº“æœ‰ä¸¤ä¸ªè€—æ—¶çš„æ“ä½œï¼šç”ŸæˆRDBæ–‡ä»¶å’Œä¼ è¾“RDBæ–‡ä»¶ï¼Œå¦‚æœä»åº“æ•°é‡è¿‡å¤šï¼Œä¼šå¯¼è‡´ä¸»åº“å¿™äºforkå­è¿›ç¨‹ç”ŸæˆRDBæ–‡ä»¶è¿›è¡Œå…¨é‡å¤åˆ¶ï¼Œå¯¼è‡´é˜»å¡ä¸»çº¿ç¨‹çš„æ­£å¸¸è¯·æ±‚ï¼ŒåŒæ—¶ä¼ è¾“çš„å¸¦å®½ä¹Ÿå¸¦æ¥äº†å‹åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;è§£å†³åŠæ³•&lt;/strong&gt;ï¼šé€šè¿‡&lt;strong&gt;ä¸»ä»çº§è”æ¨¡å¼&lt;/strong&gt;è§£å†³ï¼Œå¯ä»¥è®¾ç½®ä¸»èŠ‚ç‚¹ä¸ºæ ¹èŠ‚ç‚¹ï¼Œå‘ä¸‹å»¶ç”³ï¼Œä»èŠ‚ç‚¹å†è®¾ç½®ä»èŠ‚ç‚¹çš„æ–¹å¼ï¼Œå½¢æˆæ ‘çŠ¶çš„ä¸»ä»é“¾ï¼Œè®©ä»èŠ‚ç‚¹å¸®å¿™åŒæ­¥ç»™å…¶å­èŠ‚ç‚¹çš„æ–¹å¼ï¼Œé™ä½ä¸»èŠ‚ç‚¹çš„å‹åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;åŒæ ·ä½¿ç”¨å‘½ä»¤slaveofæˆ–replicaofï¼Œåªæ˜¯ipæ¢æˆä»åº“çš„ipï¼Œè¿™æ ·å°±å½¢æˆäº†ä¸»-ä»-ä»çš„æ¨¡å¼äº†ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä¸»ä»åº“å‘½ä»¤ä¼ æ’­æ—¶ç½‘ç»œä¸­æ–­&#34;&gt;ä¸»ä»åº“å‘½ä»¤ä¼ æ’­æ—¶ç½‘ç»œä¸­æ–­&lt;/h2&gt;
&lt;p&gt;Redis2.8ä¹‹å‰ï¼Œå¦‚æœä¸»ä»åº“å‘ç”Ÿç½‘ç»œä¸­æ–­ï¼Œé‡æ–°è¿æ¥æ—¶ä¼šè¿›è¡Œå…¨é‡å¤åˆ¶ï¼Œå¼€é”€å·¨å¤§ã€‚&lt;/p&gt;
&lt;p&gt;2.8ä¹‹åï¼Œä¼šä½¿ç”¨å¢é‡å¤åˆ¶ã€‚æ–­è¿æœŸé—´ï¼Œä¸»åº“ä¼šæŠŠæ”¶åˆ°çš„å†™å‘½ä»¤å†™å…¥ç¼“å†²åŒºï¼ˆ&lt;code&gt;replication buffer&lt;/code&gt;å’Œ&lt;code&gt;repl_backlog_buffer&lt;/code&gt;ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;æ–­è¿æ—¶ï¼Œä¼šè®°å½•ä»åº“çš„åç§»é‡ï¼Œå¾…é‡æ–°è¿æ¥åå³å¯æ ¹æ®åç§»é‡è¿›è¡ŒåŒæ­¥ã€‚ç”±äº&lt;code&gt;repl_backlog_buffer&lt;/code&gt;æ˜¯ç¯å½¢ç¼“å†²åŒºï¼Œå¦‚æœä»åº“åŒæ­¥å¤ªæ…¢ï¼Œå› æ­¤å¯èƒ½ä¼šå‡ºç°æ–°å‘½ä»¤è¦†ç›–åˆ°æœªè¯»å–çš„å‘½ä»¤ï¼Œåªèƒ½é€šè¿‡è°ƒæ•´å…¶å¤§å°è§£å†³ï¼Œé…ç½®&lt;code&gt;repl_backlog_size&lt;/code&gt;ï¼Œå¦åˆ™ï¼Œä»åº“å°†è¿›è¡Œå…¨é‡å¤åˆ¶ã€‚&lt;/p&gt;
&lt;p&gt;ä¸»ä»æ¨¡å¼ä¸‹ï¼Œä»åº“å®•æœºå½±å“ä¸å¤§ï¼Œä½†ä¸»åº“å®•æœºå°±ä¼šå½±å“ä»åº“çš„åŒæ­¥äº†ï¼Œæ­¤æ—¶éœ€è¦å“¨å…µæœºåˆ¶é‡æ–°é€‰ä¸¾ä¸»åº“ï¼Œä¿è¯é«˜å¯ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;replication buffer&lt;/code&gt;ï¼šä¸»ä»åº“åœ¨è¿›è¡Œå…¨é‡å¤åˆ¶æ—¶ï¼Œä¸»åº“ä¸Šç”¨äºå’Œä»åº“è¿æ¥çš„å®¢æˆ·ç«¯çš„ bufferï¼Œéå…±äº«ï¼Œæ¯ä¸ªä»åº“å¯¹åº”ä¸€ä¸ªã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;repl_backlog_buffer&lt;/code&gt;ï¼šä¸»åº“ä¸Šç”¨äºæŒç»­ä¿å­˜å†™æ“ä½œçš„ä¸€å—ä¸“ç”¨ bufferï¼Œæ˜¯ä¸€ä¸ªç¯å½¢ç¼“å†²åŒºï¼Œ ä»åº“å…±äº«ã€‚ä¸ºäº†æ”¯æŒä»åº“å¢é‡å¤åˆ¶ï¼Œä¸»åº“ä¼šè®°å½•è‡ªå·±å†™åˆ°çš„åç§»é‡(&lt;code&gt;master_repl_offset&lt;/code&gt;)ï¼Œè€Œæ¯ä¸ªä»åº“éƒ½ä¼šæœ‰è‡ªå·±çš„å¤åˆ¶è¿›åº¦æ ‡å¿—(&lt;code&gt;slave_repl_offset&lt;/code&gt;)è®°å½•åœ¨ä¸Šé¢ï¼Œè®°å½•è‡ªå·±çš„å†™åç§»é‡ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å“¨å…µæœºåˆ¶&#34;&gt;å“¨å…µæœºåˆ¶&lt;/h2&gt;
&lt;p&gt;å“¨å…µæœºåˆ¶ä¼šè§£å†³ä¸‰ä¸ªé—®é¢˜ï¼š1.åˆ¤æ–­ä¸»åº“æ˜¯å¦å®•æœºï¼›2.é€‰æ‹©å“ªä¸ªä»åº“ä¸ºä¸»åº“ï¼›3.å¦‚ä½•æŠŠæ–°ä¸»åº“çš„ä¿¡æ¯é€šçŸ¥ç»™ä»åº“å’Œå®¢æˆ·ç«¯ã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨&lt;strong&gt;å“¨å…µæ¨¡å¼&lt;/strong&gt;ï¼ˆsentinelï¼‰æ¥ç›‘å¬å’Œç®¡ç†Redisé›†ç¾¤ï¼Œå­˜å‚¨é›†ç¾¤é…ç½®ï¼Œä½œç”¨ç±»ä¼¼ZooKeeperï¼Œå“¨å…µèŠ‚ç‚¹æ˜¯ä¸€å°ç‰¹æ®Šçš„Redisï¼ŒåŠŸèƒ½æœ‰é™ï¼Œä¸»è¦ç”¨æ¥æ”¯æŒå“¨å…µæœºåˆ¶ï¼Œå“¨å…µèŠ‚ç‚¹æœ‰ä¸‰ä¸ªä»»åŠ¡ï¼š&lt;strong&gt;ç›‘æ§ã€é€‰ä¸»ã€é€šçŸ¥&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&#34;åŸç†-3&#34;&gt;åŸç†&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;å“¨å…µèŠ‚ç‚¹ä¸€èˆ¬è®¾ç½®3ä¸ªåŠä»¥ä¸Šçš„å¥‡æ•°ä¸ªï¼Œå“¨å…µèŠ‚ç‚¹é—´æ˜¯å¹³çº§çš„ï¼Œä¼šäº’ç›¸ç›‘æ§&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ‰€æœ‰å“¨å…µèŠ‚ç‚¹éƒ½ä¼šå‘¨æœŸæ€§çš„ç»™æ‰€æœ‰ä¸»ä»åº“å‘é€Pingå‘½ä»¤æ£€æµ‹Redisçš„ä¸»ä»èŠ‚ç‚¹æ˜¯å¦æ­£å¸¸è¿è¡Œï¼Œå½“æœ‰RedisèŠ‚ç‚¹å‡ºç°é—®é¢˜æ—¶ï¼Œè¿›è¡Œé€šçŸ¥ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœå‘ç”Ÿé—®é¢˜çš„èŠ‚ç‚¹æ˜¯ä¸»èŠ‚ç‚¹ï¼Œä¼šä»ä»èŠ‚ç‚¹ä¸­é€‰å‡ºä¸»èŠ‚ç‚¹ï¼Œä»£æ›¿å¤±æ•ˆçš„ä¸»èŠ‚ç‚¹ã€‚&lt;/li&gt;
&lt;li&gt;ä¹‹åä¼šæŠŠæ–°ä¸»åº“çš„è¿æ¥ä¿¡æ¯å‘ç»™å…¶ä»–ä»åº“ï¼Œè®©ä»–ä»¬æ‰§è¡Œ&lt;code&gt;replicaof&lt;/code&gt;å‘½ä»¤ï¼Œå’Œä¸»åº“å»ºç«‹è¿æ¥ï¼Œå¹¶è¿›è¡Œæ•°æ®å¤åˆ¶ã€‚åŒæ—¶æŠŠæ–°ä¸»åº“çš„è¿æ¥ä¿¡æ¯é€šçŸ¥ç»™å®¢æˆ·ç«¯ï¼Œè®©å®¢æˆ·ç«¯æŠŠè¯·æ±‚å‘é€åˆ°æ–°ä¸»åº“ä¸Šã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;å¦‚ä½•ç›‘æ§å¦‚ä½•åˆ¤æ–­ä¸»åº“ä¸å¯ç”¨&#34;&gt;å¦‚ä½•ç›‘æ§ï¼Œå¦‚ä½•åˆ¤æ–­ä¸»åº“ä¸å¯ç”¨&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;ä¸»è§‚ä¸‹çº¿&lt;/strong&gt;ï¼šæ¯ä¸ªå“¨å…µèŠ‚ç‚¹æ¯éš”1så¯¹ä¸»ä»èŠ‚ç‚¹å‘ç”Ÿå¿ƒè·³ï¼Œå½“æœ‰èŠ‚ç‚¹åœ¨è¶…è¿‡xç§’åæ²¡æœ‰è¿›è¡Œå›å¤ï¼Œæ­¤æ—¶è¯¥èŠ‚ç‚¹ä¸ºä¸»è§‚ä¸‹çº¿ï¼Œè¿˜éœ€è¦è¿›ä¸€æ­¥åˆ¤æ–­ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å®¢è§‚ä¸‹çº¿&lt;/strong&gt;ï¼šå½“ä¸»è§‚ä¸‹çº¿çš„èŠ‚ç‚¹æ˜¯ä¸»èŠ‚ç‚¹æ—¶ï¼Œè¯¥å“¨å…µèŠ‚ç‚¹ä¼šé€šè¿‡&lt;code&gt;sentinel is-master-down-by-addr&lt;/code&gt;å‘½ä»¤ï¼Œå‘å…¶å®ƒ&lt;code&gt;n - 1&lt;/code&gt;ä¸ªå“¨å…µèŠ‚ç‚¹è¯¢é—®å¯¹ä¸»èŠ‚ç‚¹çš„åˆ¤æ–­ï¼Œå½“è¶…è¿‡ &lt;code&gt;n / 2 + 1&lt;/code&gt; ä¸ªå“¨å…µèŠ‚ç‚¹è®¤ä¸ºä¸»èŠ‚ç‚¹æœ‰é—®é¢˜æ—¶ï¼Œè¯¥èŠ‚ç‚¹ä¸ºå®¢è§‚ä¸‹çº¿ã€‚&lt;strong&gt;å¤šè¿™ä¸€æ­¥æ˜¯ä¸ºäº†é˜²æ­¢è¯¯åˆ¤ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å®¢è§‚ä¸‹çº¿åï¼Œä¼šä»ä»èŠ‚ç‚¹ä¸­é€‰ä¸¾å‡ºä¸»èŠ‚ç‚¹ï¼Œå‰ä¸»èŠ‚ç‚¹é‡æ–°ä¸Šçº¿åä¼šè¢«è®¾ç½®ä¸ºä»èŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;Redisæ²¡æœ‰ä½¿ç”¨ä»€ä¹ˆä¸€è‡´æ€§ç®—æ³•ï¼Œä»…ä¾æ®&lt;strong&gt;Gossipåè®®&lt;/strong&gt;åœ¨æœ‰æ•ˆæ—¶é—´èŒƒå›´å†…æ”¶åˆ°å…¶å®ƒSentinelèŠ‚ç‚¹çš„ç¡®è®¤ã€‚&lt;/p&gt;
&lt;p&gt;å¦å¤–ï¼Œå¦‚æœä¸ä½¿ç”¨å“¨å…µæ¨¡å¼ï¼Œåªä½¿ç”¨Redisé›†ç¾¤ï¼Œä¹Ÿå¯ä»¥å®ç°é«˜å¯ç”¨ï¼Œåªä¸è¿‡æ˜¯æŠŠç›‘æ§å’Œé€‰æ‹©è½¬ç§»åˆ°å„ä¸ªèŠ‚ç‚¹ä¸­ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å¦‚ä½•é€‰ä¸¾&#34;&gt;å¦‚ä½•é€‰ä¸¾&lt;/h3&gt;
&lt;p&gt;å“¨å…µèŠ‚ç‚¹ä¼šå‘¨æœŸæ€§çš„å‘é€å¿ƒè·³ç»™ä¸»ä»åº“ï¼Œåœ¨æ­¤è¿‡ç¨‹ä¸­ä¼šå¯¹å„ä¸ªèŠ‚ç‚¹è¿›è¡Œæ‰“åˆ†ã€‚ä¹‹åæŒ‰ç…§ä¸€å®šçš„ç­›é€‰æ¡ä»¶å’Œè§„åˆ™ï¼Œé€‰å‡ºå¾—åˆ†æœ€é«˜çš„ä»åº“ä¸ºæ–°ä¸»åº“ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç­›é€‰æ¡ä»¶ï¼šä»åº“çš„åœ¨çº¿çŠ¶æ€ï¼Œä¹‹å‰çš„ç½‘ç»œè¿æ¥çŠ¶æ€ã€‚é€šè¿‡è®¾ç½®ä¸»ä»åº“æ–­è¿çš„æœ€å¤§è¿æ¥è¶…æ—¶æ—¶é—´ï¼ˆdown-after-millisecondsï¼‰ã€æ–­è¿æ¬¡æ•°ï¼ˆnï¼‰ï¼Œå½“è¶…è¿‡é˜ˆå€¼æ—¶åˆ™è¯´æ˜ä»åº“çš„ç½‘ç»œçŠ¶å†µä¸å¥½ã€‚&lt;/li&gt;
&lt;li&gt;æ‰“åˆ†è§„åˆ™ï¼šä»åº“çš„ä¼˜å…ˆçº§ï¼ˆæ¯”å¦‚ä¸åŒä»åº“çš„é…ç½®ä¸ä¸€æ ·ï¼Œä¼˜å…ˆçº§ä¹Ÿå°±ä¸ä¸€æ ·ï¼‰ã€ä»åº“çš„å¤åˆ¶è¿›åº¦ï¼ˆæ ¹æ®ä»åº“åœ¨&lt;code&gt;repl_backlog_buffer&lt;/code&gt;ä¸­çš„åç§»é‡ï¼Œä»åº“é—´æ¯”è¾ƒï¼‰ã€ä»åº“çš„IDå·ï¼ˆIDå·å°çš„åˆ†é«˜ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;å¦‚ä½•é€šçŸ¥&#34;&gt;å¦‚ä½•é€šçŸ¥&lt;/h3&gt;
&lt;p&gt;å®¢æˆ·ç«¯åœ¨è®¿é—®ä¸»ä»åº“æ—¶ï¼Œä¸èƒ½å†™æ­»ä¸»åº“åœ°å€ï¼Œè€Œæ˜¯ä»å“¨å…µèŠ‚ç‚¹ä¸­è·å–ä¸»åº“åœ°å€ï¼›å½“å“¨å…µé€‰å‡ºæ–°çš„ä¸»åº“æ—¶ï¼Œä¼šæ›´æ–°è‡ªå·±å­˜çš„æ–°ä¸»åº“åœ°å€ã€‚å“¨å…µèŠ‚ç‚¹é€šè¿‡ å‘å¸ƒ/è®¢é˜… æœºåˆ¶ï¼Œè®©å®¢æˆ·ç«¯è¿›è¡Œè®¢é˜…å’Œä¿®æ”¹ã€‚ä»è€Œä¹Ÿèƒ½è®©å®¢æˆ·ç«¯äº†è§£æ•´ä¸ªä¸»ä»åˆ‡æ¢è¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ä¸»ä»åˆ‡æ¢æ—¶å¯èƒ½äº§ç”Ÿè„‘è£‚&#34;&gt;ä¸»ä»åˆ‡æ¢æ—¶ï¼Œå¯èƒ½äº§ç”Ÿè„‘è£‚&lt;/h3&gt;
&lt;p&gt;å¦‚æœä¸»åº“å› ä¸ºæŸäº›åŸå› è¿›å…¥å‡æ­»çŠ¶æ€ï¼ˆä½†è¿˜èƒ½å¤„ç†å‘½ä»¤ï¼‰ï¼Œè¢«å“¨å…µåˆ¤å®šä¸ºå®¢è§‚ä¸‹çº¿ï¼Œå“¨å…µæ‰§è¡Œä¸»ä»åˆ‡æ¢ï¼Œä½†æ­¤æ—¶ä¸»åº“æ¢å¤æ­£å¸¸ï¼Œä½†æ­¤æœŸé—´å†™æ“ä½œçš„æ•°æ®è¿˜æœªåŒæ­¥åˆ°ä»åº“ï¼Œå¾…å“¨å…µå®Œæˆä¸»ä»åˆ‡æ¢åï¼ŒRedisé›†ç¾¤ä¼šçŸ­æš‚å‡ºç°ä¸¤ä¸ªä¸»åº“ï¼Œå¯¼è‡´å®¢æˆ·ç«¯çš„å†™æ“ä½œä¼šå‘å¾€ä¸åŒçš„ä¸»åº“ï¼Œæˆ–è€…åŸä¸»åº“é™çº§æˆä»åº“ï¼Œä¼šæ¸…ç©ºæœ¬åœ°æ•°æ®é‡æ–°è½½å…¥æ–°ä¸»åº“çš„RDBå¿«ç…§ï¼Œå¯¼è‡´æ•°æ®ä¸ä¸€è‡´æˆ–ä¸¢å¤±ã€‚&lt;/p&gt;
&lt;p&gt;åˆ¤æ–­ä¸»ä»åº“æ•°æ®æ˜¯å¦ä¸ä¸€è‡´ï¼Œå¯ä»¥é€šè¿‡å¯¹æ¯”ä¸»ä»åº“ä¸Šçš„å¤åˆ¶è¿›åº¦å·®å€¼æ¥è¿›è¡Œåˆ¤æ–­ï¼Œè®¡ç®—&lt;code&gt;matser_repl_offset&lt;/code&gt;å’Œ&lt;code&gt;slave_repl_offset&lt;/code&gt;çš„å·®å€¼ï¼Œå¦‚æœä»åº“ä¸Šçš„&lt;code&gt;slave_repl_offset&lt;/code&gt;å°äºåŸä¸»åº“çš„&lt;code&gt;master_repl_offset&lt;/code&gt;ï¼Œå°±è¯´æ˜æ•°æ®ä¸¢å¤±æ˜¯å› ä¸ºæ•°æ®æœªåŒæ­¥å®Œæˆå¯¼è‡´çš„ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ ¹æœ¬åŸå› &lt;/strong&gt;ï¼šRedisä¸»ä»é›†ç¾¤æ²¡æœ‰ä½¿ç”¨å…±è¯†ç®—æ³•ï¼Œæ¯ä¸ªå†™æ“ä½œæ²¡æœ‰åœ¨å¤§å¤šæ•°èŠ‚ç‚¹å†™æˆåŠŸåæ‰è®¤ä¸ºæˆåŠŸå¯¼è‡´çš„ã€‚ä¸åƒZooKeeperï¼Œå®¢æˆ·ç«¯çš„æ“ä½œéƒ½ä¼šç»è¿‡ZooKeeperçš„ä¸»èŠ‚ç‚¹ï¼Œå½“å‘ç”Ÿè„‘è£‚æ—¶ï¼ŒZooKeeperä¸»èŠ‚ç‚¹æ— æ³•å†™å…¥å¤§å¤šæ•°èŠ‚ç‚¹ï¼Œå†™è¯·æ±‚ç›´æ¥å¤±è´¥ï¼Œä¿è¯æ•°æ®ä¸€è‡´æ€§ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;è§£å†³æ–¹æ³•&lt;/strong&gt;ï¼šåœ¨ä¸»åº“ä¸Šé…ç½®&lt;code&gt;min-slaves-to-write&lt;/code&gt;è¡¨ç¤ºä¸»åº“èƒ½è¿›è¡Œæ•°æ®åŒæ­¥çš„æœ€å°‘ä»åº“æ•°é‡ï¼›&lt;code&gt;min-slaves-max-lag&lt;/code&gt;è¡¨ç¤ºä¸»ä»æ•°æ®å¤åˆ¶æ—¶ï¼Œä»åº“ç»™ä¸»åº“å‘é€ACKæ¶ˆæ¯çš„æœ€å¤§å»¶è¿Ÿ(ç§’)ã€‚è¿™æ ·å½“ä¸»åº“å‡æ­»æ—¶ï¼Œæ— æ³•å“åº”å“¨å…µå¿ƒè·³ï¼Œä¹Ÿä¸èƒ½å’Œä»åº“åŒæ­¥ï¼Œç¡®è®¤ä»åº“çš„ACKå‘½ä»¤ï¼ŒåŸä¸»åº“å°±æ— æ³•å†æ¥æ”¶å®¢æˆ·ç«¯çš„å†™æ“ä½œã€‚&lt;/p&gt;
&lt;h3 id=&#34;å“¨å…µé›†ç¾¤çš„é«˜å¯ç”¨&#34;&gt;å“¨å…µé›†ç¾¤çš„é«˜å¯ç”¨&lt;/h3&gt;
&lt;p&gt;ç”±äºå“¨å…µéœ€è¦è¿›è¡Œå®¢è§‚ä¸‹çº¿çš„åˆ¤æ–­ï¼Œå› æ­¤éœ€è¦å¤šä¸ªå“¨å…µç»„æˆé›†ç¾¤ï¼Œé›†ç¾¤å°±ä¼šæ¶‰åŠåˆ°é«˜å¯ç”¨ã€‚&lt;/p&gt;
&lt;h4 id=&#34;å“¨å…µèŠ‚ç‚¹é—´ä¸ä¸»ä»åº“é—´çš„ç›¸äº’å‘ç°æœºåˆ¶&#34;&gt;å“¨å…µèŠ‚ç‚¹é—´ã€ä¸ä¸»ä»åº“é—´çš„ç›¸äº’å‘ç°æœºåˆ¶&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å“¨å…µèŠ‚ç‚¹é—´çš„ç›¸äº’å‘ç°ï¼šæ­£å¸¸æƒ…å†µä¸‹ï¼Œæ¯ä¸ªå“¨å…µéƒ½æ˜¯å¹³çº§çš„ã€‚æ¯ä¸ªå“¨å…µèŠ‚ç‚¹åœ¨è®¾ç½®æ—¶çš„å‘½ä»¤æ˜¯&lt;code&gt;sentinel monitor &amp;lt;master-name&amp;gt; &amp;lt;ip&amp;gt; &amp;lt;redis-port&amp;gt; &amp;lt;quorum&amp;gt; &lt;/code&gt;ï¼Œå¹¶ä¸æ„ŸçŸ¥å…¶ä»–å“¨å…µçš„å­˜åœ¨ã€‚&lt;strong&gt;å“¨å…µèŠ‚ç‚¹é—´çš„ç›¸äº’å‘ç°ï¼Œä¾èµ–Redisçš„ å‘å¸ƒ/è®¢é˜… æœºåˆ¶&lt;/strong&gt;ã€‚å“¨å…µèŠ‚ç‚¹ä¸€æ—¦å’Œä¸»åº“å»ºç«‹è¿æ¥ï¼Œå°±ä¼šæŠŠè‡ªå·±çš„è¿æ¥ä¿¡æ¯(å¦‚IPã€ç«¯å£)å‘å¸ƒåˆ°ä¸»åº“ä¸Šï¼ŒåŒæ—¶å®ƒä¹Ÿä¼šè®¢é˜…ï¼Œä»è€Œå‘ç°å…¶ä»–å“¨å…µèŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å“¨å…µèŠ‚ç‚¹å‘ç°ä»åº“ï¼šå“¨å…µèŠ‚ç‚¹è¿æ¥ä¸»åº“åï¼Œå‘é€INFOå‘½ä»¤ï¼Œä¸»åº“å°±ä¼šæŠŠä»åº“è¿æ¥ä¿¡æ¯åˆ—è¡¨å‘ç»™å“¨å…µèŠ‚ç‚¹ï¼Œä»è€Œå®ç°å“¨å…µèŠ‚ç‚¹å¯¹ä»åº“çš„ç›‘æ§ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;å“¨å…µèŠ‚ç‚¹leaderé€‰ä¸¾åŸç†&#34;&gt;å“¨å…µèŠ‚ç‚¹Leaderé€‰ä¸¾åŸç†&lt;/h4&gt;
&lt;p&gt;æ­£å¸¸æƒ…å†µä¸‹å“¨å…µé›†ç¾¤å†…çš„æ¯ä¸ªå“¨å…µèŠ‚ç‚¹æ˜¯å¹³çº§çš„ï¼Œä½†æ˜¯å½“è§¦å‘å®¢è§‚ä¸‹çº¿æ—¶ï¼Œéœ€è¦é€‰å‡ºä¸€ä¸ªå“¨å…µèŠ‚ç‚¹Leaderæ¥æ‰§è¡Œä¸»ä»åº“åˆ‡æ¢ã€‚é‡æ–°é€‰ä¸¾ä¸»åº“åªèƒ½ç”±ä¸€ä¸ªå“¨å…µèŠ‚ç‚¹æ¥åšï¼Œå¦‚æœä¸æ˜¯ï¼Œå¯èƒ½ä¼šå‡ºç°ä¸»ä»åº“é›†ç¾¤è„‘è£‚ã€‚å¦å¤–ï¼Œå“¨å…µèŠ‚ç‚¹è¶Šå¤šï¼Œé€‰ä¸¾é€Ÿåº¦è¶Šæ…¢ï¼Œé£é™©ä¹Ÿä¼šå¢åŠ ã€‚&lt;/p&gt;
&lt;p&gt;å“¨å…µèŠ‚ç‚¹Leaderé€‰ä¸¾åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;å„ä¸ªå“¨å…µèŠ‚ç‚¹åˆ¤æ–­ä¸»/å®¢è§‚ä¸‹çº¿é˜¶æ®µï¼šå„ä¸ªå“¨å…µåœ¨åˆ¤æ–­ä¸»åº“æ˜¯ä¸»è§‚ä¸‹çº¿åï¼Œé¦–å…ˆä¼šç»™è‡ªå·±æŠ•Yesç¥¨ï¼Œä¹‹åä¼šå‘é€&lt;code&gt;is-master-down-by-addr&lt;/code&gt;å‘½ä»¤ç»™å…¶ä»–å“¨å…µèŠ‚ç‚¹ï¼Œå…¶ä»–å“¨å…µèŠ‚ç‚¹ä¼šæ ¹æ®è‡ªå·±çš„åˆ¤æ–­æƒ…å†µï¼Œå›å¤Yes / Noå›å»ã€‚è¯¥å“¨å…µèŠ‚ç‚¹æ”¶é›†å¾—åˆ°çš„Yesç¥¨ï¼Œå½“è¶…è¿‡è®¾ç½®çš„quorumå€¼æ—¶ï¼Œæ ‡è®°ä¸»åº“ä¸ºå®¢è§‚ä¸‹çº¿ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ¯ä¸ªå“¨å…µåœ¨ä¸€æ¬¡é€‰ä¸¾èŠ‚ç‚¹åªæœ‰ä¸€æ¬¡æŠ•ç¥¨æœºä¼šï¼Œå½“æœ‰å“¨å…µèŠ‚ç‚¹å¾—å‡ºå®¢è§‚ä¸‹çº¿ç»“è®ºåï¼Œè¯¥å“¨å…µå†å‘èµ·æŠ•ç¥¨ï¼Œè¿›è¡ŒLeaderé€‰ä¸¾ï¼Œå½“æ”¶é›†åˆ°çš„ç¥¨æ•°è¶…è¿‡ä¸€åŠï¼Œåˆ™è¯¥å“¨å…µèŠ‚ç‚¹æˆä¸ºLeaderèŠ‚ç‚¹ï¼Œå¦‚æœæ²¡æœ‰é€‰ä¸¾æˆåŠŸï¼Œåˆ™ç­‰å¾…ä¸€èˆ¬æ˜¯æ•…éšœè½¬ç§»è¶…æ—¶æ—¶é—´failover_timeoutçš„2å€æ—¶é—´åä¼šé‡æ–°ä¸¾è¡Œé€‰ä¸¾ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/Redis%e5%93%a8%e5%85%b5%e4%b8%8b%e7%ba%bf%e4%b8%bb%e5%ba%93%e5%92%8cLeader%e9%80%89%e4%b8%be.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/Redis%e5%93%a8%e5%85%b5%e4%b8%8b%e7%ba%bf%e4%b8%bb%e5%ba%93%e5%92%8cLeader%e9%80%89%e4%b8%be.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			alt=&#34;Rediså“¨å…µä¸‹çº¿ä¸»åº“å’ŒLeaderé€‰ä¸¾&#34;&gt;
	&lt;/a&gt;
	
	&lt;figcaption&gt;Rediså“¨å…µä¸‹çº¿ä¸»åº“å’ŒLeaderé€‰ä¸¾&lt;/figcaption&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;h2 id=&#34;å‡ ä¸ªæ³¨æ„ç‚¹&#34;&gt;å‡ ä¸ªæ³¨æ„ç‚¹&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ä¸»ä»å¤åˆ¶è®¾ç½®æ—¶ï¼Œæœ€å¥½åœ¨ä¸»èŠ‚ç‚¹ä¸Šå¼€å¯æŒä¹…åŒ–ï¼Œå¦åˆ™å¯èƒ½ä¼šå¯¼è‡´ä»èŠ‚ç‚¹çš„æ•°æ®è¢«æ¸…ç©ºï¼›&lt;/p&gt;
&lt;p&gt;å½“ä¸»èŠ‚ç‚¹å…³é—­æŒä¹…åŒ–åï¼Œä»èŠ‚ç‚¹å¼€å§‹ä»ä¸»èŠ‚ç‚¹å¤åˆ¶æ•°æ®ï¼Œå¦‚æœæ­¤æ—¶ä¸»èŠ‚ç‚¹æŒ‚äº†ï¼Œå› ä¸ºå…³é—­äº†æŒä¹…åŒ–ï¼Œä¸”é‡å¯é€Ÿåº¦æ¯”è¾ƒå¿«ï¼Œå“¨å…µèŠ‚ç‚¹æ²¡æœ‰å‘ç°ï¼Œé‡å¯åä¸»èŠ‚ç‚¹æ•°æ®ä¸ºç©ºï¼Œå½“ä»èŠ‚ç‚¹åœ¨è¿›è¡Œæ•°æ®å¤åˆ¶æ—¶å‘ç°ä¸»èŠ‚ç‚¹æ˜¯ç©ºçš„ï¼Œä»èŠ‚ç‚¹ä¸Šçš„æ•°æ®ä¹Ÿä¼šè¢«åˆ é™¤ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Redisæ”¯æŒæ— ç£ç›˜å¤åˆ¶ï¼Œå½“ä½¿ç”¨ä½è½¬é€Ÿçš„ç£ç›˜æ—¶ï¼Œå¯èƒ½ä¼šå½±å“å¤åˆ¶æ€§èƒ½ï¼Œå½“å¯åŠ¨æ— ç£ç›˜å¤åˆ¶æ—¶ï¼Œä¸»èŠ‚ç‚¹å­è¿›ç¨‹ç›´æ¥å°†RDBé€šè¿‡ç½‘ç»œå‘é€ç»™ä»èŠ‚ç‚¹ï¼Œä¸ä½¿ç”¨ç£ç›˜ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;é«˜å¯ç”¨æ‰©å±•é›†ç¾¤&#34;&gt;é«˜å¯ç”¨æ‰©å±•é›†ç¾¤&lt;/h1&gt;
&lt;p&gt;ä¸€èˆ¬ä¸€ä¸ªRedisä¿å­˜å‡ ä¸ªGå†…æ¯”è¾ƒåˆé€‚ï¼Œ&lt;strong&gt;å½“å•ä¸ªRediså®ä¾‹è¦ä¿å­˜çš„é”®å€¼å¯¹å¤ªå¤šæ—¶ï¼Œä¼šå½±å“Redisçš„ä¸»ä»å¤åˆ¶ã€RDBå¿«ç…§å’ŒAOFæ—¥å¿—çš„å¤§å°ã€å½±å“ä»åº“é‡æ”¾é€Ÿåº¦ã€forkå­è¿›ç¨‹çš„é€Ÿåº¦(å¤ªæ…¢ä¼šå¯¼è‡´é˜»å¡ä¸»çº¿ç¨‹)&lt;/strong&gt;ï¼Œå› æ­¤éœ€è¦è¿›è¡Œå¯¹å•Rediså®ä¾‹æ‰©å±•ï¼Œå¸¸è§çš„æ–¹å¼æ˜¯å¯¹å•ä¸ªRediså®ä¾‹è¿›è¡Œæ‰©å±•ï¼Œä¸€èˆ¬åˆ†ä¸ºçºµå‘æ‰©å±•å’Œæ¨ªå‘æ‰©å±•ã€‚&lt;/p&gt;
&lt;p&gt;redisä¸­é»˜è®¤æœ‰ç¼–å·0-15æ€»å…±16ä¸ªdbï¼Œé»˜è®¤ä½¿ç”¨db0ï¼Œæ¯ä¸ªæ•°æ®åº“éƒ½æœ‰å±äºè‡ªå·±çš„ç©ºé—´ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨redisé›†ç¾¤æ—¶ï¼Œä¸å¯ä»¥ä½¿ç”¨selectå‘½ä»¤é€‰æ‹©dbï¼Œå› ä¸ºredisé›†ç¾¤ä»…æ”¯æŒdb0ã€‚&lt;/p&gt;
&lt;p&gt;Redisé›†ç¾¤æœ€å¤§èŠ‚ç‚¹ä¸ªæ•°æ˜¯ &lt;strong&gt;16384&lt;/strong&gt; ä¸ªï¼Œå› ä¸ºRedisé›†ç¾¤æ²¡æœ‰ä½¿ç”¨ä¸€è‡´æ€§hashï¼Œè€Œæ˜¯å“ˆå¸Œæ§½ï¼ŒRedisé›†ç¾¤å°±æœ‰16384ä¸ªå“ˆå¸Œæ§½ï¼ŒåŸå› æ˜¯ RedisèŠ‚ç‚¹å‘é€å¿ƒè·³åŒ…æ—¶éœ€è¦æŠŠæ‰€æœ‰æ§½æ”¾åˆ°è¿™ä¸ªå¿ƒè·³åŒ…ä¸­ï¼Œè®©èŠ‚ç‚¹çŸ¥é“å½“å‰é›†ç¾¤ä¿¡æ¯ï¼Œ&lt;code&gt;16384 = 16k&lt;/code&gt; åœ¨å‘é€å¿ƒè·³åŒ…æ—¶&lt;strong&gt;ä½¿ç”¨charè¿›è¡Œbitmapå‹ç¼©åæ˜¯2kï¼ˆ2 * 8 (8 bit) * 1024(1k) = 16Kï¼‰&lt;/strong&gt;ï¼Œå› æ­¤ä½¿ç”¨ 2k ç©ºé—´å°±èƒ½åˆ›å»º 16k çš„æ§½æ•°äº†ï¼Œå°½ç®¡CRC16 ç®—æ³•æœ€å¤šè¯¾åˆ†é… &lt;code&gt;2 ^ 16 - 1 = 65535&lt;/code&gt; ä¸ªæ§½ä½ï¼Œå‹ç¼©åä¹Ÿæ‰8kï¼Œä½†ä¸€èˆ¬æ¥è¯´ï¼Œä¸€ä¸ªRedisé›†ç¾¤ä¸ä¼šè¶…è¿‡1000ä¸ªmasterèŠ‚ç‚¹ï¼Œæ‰€ä»¥16kçš„æ§½ä½å°±æ¯”è¾ƒåˆé€‚ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ‰©å±•&#34;&gt;æ‰©å±•&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;çºµå‘æ‰©å±•ï¼šå‡çº§å•Rediså®ä¾‹çš„é…ç½®ï¼Œå¦‚å†…å­˜å®¹é‡ã€ç£ç›˜å®¹é‡ã€CPUç­‰ï¼Œä½†ä¼šå½±å“RDBå¿«ç…§å’ŒAOFæ—¥å¿—å¤§å°ï¼Œç½‘ç»œä¼ è¾“ç­‰ï¼Œä¸€èˆ¬ç”¨åœ¨ä¸ä½¿ç”¨RedisæŒä¹…åŒ–åŠŸèƒ½çš„åœºæ™¯ã€‚&lt;/li&gt;
&lt;li&gt;æ¨ªå‘æ‰©å±•ï¼šæ ¹æ®keyï¼Œå¯¹Rediså®ä¾‹è¿›è¡Œåˆ†ç‰‡ï¼Œå¢åŠ Rediså®ä¾‹ä¸ªæ•°ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;åˆ†ç‰‡&#34;&gt;åˆ†ç‰‡&lt;/h2&gt;
&lt;p&gt;Redisåˆ†ç‰‡çš„å®ç°ä½¿ç”¨å“ˆå¸Œæ§½ã€‚&lt;/p&gt;
&lt;h3 id=&#34;åŸç†-4&#34;&gt;åŸç†&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å°†æ•°æ®åˆ†æ•£åˆ°é›†ç¾¤çš„å¤šä¸ªæœºå™¨ä¸Šï¼ŒRedisé‡Œä½¿ç”¨çš„æ¦‚å¿µæ˜¯æ§½Slotï¼Œæ¯ä¸ªé›†ç¾¤çš„æ§½æ•°å›ºå®šä¸º16 * 1024 = 16384ä¸ªï¼Œä½¿ç”¨å“ˆå¸Œåˆ†ç‰‡ç®—æ³•å¯¹Keyè¿›è¡Œå–æ¨¡ï¼Œè®¡ç®—æ–¹æ³•ï¼š&lt;code&gt;HASH_SLOT = CRC16(Key) mod 16384&lt;/code&gt;ï¼Œä½™æ•°ä¸ºKeyæ‰€åœ¨çš„æ§½ã€‚&lt;/p&gt;
&lt;p&gt;ä¹‹æ‰€ä»¥ä¼šä½¿ç”¨æ§½ï¼Œæ˜¯å› ä¸ºè¦æŠŠæ•°æ®å’ŒèŠ‚ç‚¹è§£è€¦ï¼Œå¦‚æœä¸ä½¿ç”¨æ§½ï¼Œè€Œæ˜¯ä½¿ç”¨keyä¸èŠ‚ç‚¹çš„æ˜ å°„è¡¨ï¼Œå½“keyçš„æ•°é‡éå¸¸åºå¤§æ—¶ï¼Œæ˜ å°„è¡¨ä¹Ÿä¼šéå¸¸å¤§ï¼Œæ˜ å°„è¡¨çš„ä¿®æ”¹å’Œè¿ç§»çš„æ€§èƒ½ä¸é«˜ã€‚&lt;/p&gt;
&lt;p&gt;é›†ç¾¤åªéœ€è¦è®°å½•æ§½çš„IDä¸æ§½èŠ‚ç‚¹çš„åœ°å€æ˜ å°„å³å¯ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå½“é›†ç¾¤ 16384 ä¸ªæ§½ä»»ä½•ä¸€ä¸ªæ²¡æœ‰æŒ‡æ´¾åˆ°èŠ‚ç‚¹æ—¶ä¼šå¯¼è‡´æ•´ä¸ªé›†ç¾¤ä¸å¯ç”¨ï¼Œsoï¼Œå½“æœ‰èŠ‚ç‚¹æ•…éšœä¸‹çº¿æ—¶ï¼Œä»æ•…éšœå‘ç°åˆ°è‡ªåŠ¨å®Œæˆè½¬ç§»æœŸé—´æ•´ä¸ªé›†ç¾¤ä¸å¯ç”¨ï¼Œå¦‚æœè¦å…³é—­è¿™ä¸ªé…ç½®ï¼Œéœ€è¦åœ¨redis.confä¸­é…ç½®ï¼š&lt;code&gt;cluster-require-full-coverage no&lt;/code&gt;ï¼Œè¿™æ ·å°±åªä¼šå½±å“æ•…éšœèŠ‚ç‚¹äº†ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;é›†ç¾¤å†…æ¯å°æœºå™¨ä¼šå­˜æ”¾ä¸€äº›æ§½ï¼Œåœ¨é›†ç¾¤åˆå§‹åŒ–çš„æ—¶å€™ä¼š&lt;strong&gt;å¯¹é›†ç¾¤å†…çš„æœºå™¨å¹³å‡åˆ†é…è¿™16384ä¸ªæ§½&lt;/strong&gt;ï¼Œä½¿ç”¨æŸ¥è¡¨æ³•è¿›è¡Œåˆ†é…ã€‚å› æ­¤ï¼Œå½“éœ€è¦æ‰©å®¹æ—¶ï¼Œä¼šé‡æ–°è®¡ç®—æ§½çš„ä½ç½®å’Œè¿ç§»keyï¼Œå¯ä»¥ä½¿ç”¨å®˜æ–¹æä¾›çš„redis-trib.rbè„šæœ¬å®ç°ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å®¢æˆ·ç«¯è¿æ¥åˆ†ç‰‡é›†ç¾¤åï¼Œå³å¯è·å¾—æ§½ä¸å„ä¸ªRedisåˆ†ç‰‡èŠ‚ç‚¹çš„æ˜ å°„ã€‚è®¿é—®æ—¶å¯ä»¥è®¿é—®é›†ç¾¤å†…çš„ä»»æ„èŠ‚ç‚¹ï¼Œå…ˆæ ¹æ®keyç®—å‡ºåœ¨å“ªä¸ªæ§½ï¼Œåœ¨æŸ¥è¯¢æ§½å’ŒèŠ‚ç‚¹é—´çš„å…³ç³»ï¼Œæ‰¾åˆ°å¯¹åº”çš„èŠ‚ç‚¹è¿›è¡ŒæŸ¥è¯¢ã€‚&lt;/p&gt;
&lt;p&gt;å¦å¤–ï¼Œè¦æ³¨æ„åˆ†ç‰‡åï¼Œå¯¹äºKeysã€scanè¿™æ ·çš„æ‰«æå‘½ä»¤çš„æ€§èƒ½å°±ä¼šæ›´åŠ å·®äº†ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å½“åˆ†ç‰‡é›†ç¾¤æœ‰å¢åˆ æ—¶ï¼Œæ§½ä¸èŠ‚ç‚¹çš„æ˜ å°„ä¹Ÿä¼šéšä¹‹ä¿®æ”¹ï¼Œä¸ºäº†è´Ÿè½½å‡è¡¡ï¼ŒRediséœ€è¦æŠŠæ§½é‡æ–°åˆ†å¸ƒåˆ°å„ä¸ªåˆ†ç‰‡ä¸Šã€‚ä½†æ˜¯å®¢æˆ·ç«¯å´ä¸æ„ŸçŸ¥ï¼Œå½“å®¢æˆ·ç«¯å‘é€å‘½ä»¤æ—¶ï¼Œå¦‚æœèŠ‚ç‚¹ä¸Šè¯¥æ§½å·²è¿å¾€åˆ«å¤„ï¼Œå®¢æˆ·ç«¯ä¼šæ”¶åˆ°&lt;code&gt;MOVED æ–°æ§½ç¼–å· æ–°æ§½æ‰€åœ¨çš„host&lt;/code&gt;çš„é”™è¯¯ä¿¡æ¯ï¼Œå®¢æˆ·ç«¯å°†é‡æ–°è¯·æ±‚ï¼ŒåŒæ—¶ä¿®æ”¹æ§½ä¸èŠ‚ç‚¹çš„æ˜ å°„å…³ç³»ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¦‚æœå®¢æˆ·ç«¯è¯·æ±‚å‘ç”Ÿåœ¨Redisè¿ç§»æ§½çš„è¿‡ç¨‹ä¸­ï¼Œåˆ™ä¼šå…ˆæ”¶åˆ°&lt;code&gt;ASK æ–°æ§½ç¼–å· æ–°æ§½æ‰€åœ¨çš„host&lt;/code&gt;çš„é”™è¯¯æ¶ˆæ¯ï¼Œè®©å®¢æˆ·ç«¯è¿›è¡Œé‡è¯•ï¼Œç›´åˆ°Rediså®Œæˆæ§½çš„è¿ç§»ï¼Œé‡è¯•æˆåŠŸã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;HashTagï¼Œå¦‚æœkeyçš„æ ¼å¼æ˜¯ &lt;code&gt;user:order:{3214}&lt;/code&gt;ï¼Œç”±{}æ‹¬èµ·æ¥çš„éƒ¨åˆ†ä¸ºHashTagï¼ŒCRCç®—æ³•åœ¨è®¡ç®—keyåœ¨å“ªä¸ªæ§½æ—¶åªä¼šè®¡ç®—{}é‡Œçš„å€¼ï¼ŒHashTagä¸»è¦æ˜¯è®©å¤šä¸ªç±»å‹çš„keyå¯ä»¥æ˜ å°„åˆ°åŒä¸€ä¸ªæ§½ï¼Œæ–¹ä¾¿èŒƒå›´æŸ¥è¯¢ã€‚&lt;/p&gt;
&lt;p&gt;ä½†ä½¿ç”¨HashTagå¯èƒ½ä¼šå¯¼è‡´æ•°æ®å€¾æ–œï¼Œä½¿å¾—è¯·æ±‚æ— æ³•å¹³å‡åˆ†åˆ°å„ä¸ªåˆ†ç‰‡ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸€èˆ¬çš„åˆ†é…è§„æ¨¡æ˜¯å‡ åä¸ªä»¥å†…ï¼Œä¸é€‚åˆæ„å»ºè¶…å¤§è§„æ¨¡çš„é›†ç¾¤ï¼ŒåŸå› æ˜¯å»ä¸­å¿ƒåŒ–è®¾è®¡ï¼Œé€‰ä¸¾ç®—æ³•ä½¿ç”¨Gossipï¼Œè§„æ¨¡è¶Šå¤§æ—¶ï¼Œä¼ æ’­é€Ÿåº¦è¶Šæ…¢ã€‚å¦‚æœè¦æ„å»ºè¶…å¤§è§„æ¨¡çš„é›†ç¾¤ï¼Œåˆ™éœ€è¦å¢åŠ ä¸€å±‚ä»£ç†ï¼Œè¿›è¡Œé›†ç¾¤é—´çš„è½¬å‘ï¼Œä¾‹å¦‚twemproxyæˆ–è€…Codisè¿™ç±»åŸºäºä»£ç†çš„é›†ç¾¤æ¶æ„ã€‚&lt;/p&gt;
&lt;h1 id=&#34;äº‹åŠ¡&#34;&gt;äº‹åŠ¡&lt;/h1&gt;
&lt;p&gt;ä½¿ç”¨ MULTI å’Œ EXEC å‘½ä»¤å°†å¤šä¸ªå†™æ“ä½œåŒ…å›´èµ·æ¥è¿›è¡Œå‘é€ï¼ŒRedisæ”¶åˆ°åä¼šå…ˆå°†å‘½ä»¤æš‚å­˜åˆ°ä¸€ä¸ªé˜Ÿåˆ—é‡Œï¼Œå½“æ”¶åˆ°EXECå‘½ä»¤æ—¶æ‰ä¼šä¸€èµ·é¡ºåºæ‰§è¡Œã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å¦‚æœå®¢æˆ·ç«¯å‘é€çš„å‘½ä»¤ä¸º EXEC ã€ DISCARD ã€ WATCH ã€ MULTI å››ä¸ªå‘½ä»¤çš„å…¶ä¸­ä¸€ä¸ªï¼Œ é‚£ä¹ˆæœåŠ¡å™¨ç«‹å³æ‰§è¡Œè¿™ä¸ªå‘½ä»¤ã€‚&lt;/p&gt;
&lt;p&gt;ä¸æ­¤ç›¸åï¼Œ å¦‚æœå®¢æˆ·ç«¯å‘é€çš„å‘½ä»¤æ˜¯ EXEC ã€ DISCARD ã€ WATCH ã€ MULTI å››ä¸ªå‘½ä»¤ä»¥å¤–çš„å…¶ä»–å‘½ä»¤ï¼Œ é‚£ä¹ˆæœåŠ¡å™¨å¹¶ä¸ç«‹å³æ‰§è¡Œè¿™ä¸ªå‘½ä»¤ï¼Œ è€Œæ˜¯å°†è¿™ä¸ªå‘½ä»¤æ”¾å…¥ä¸€ä¸ªäº‹åŠ¡é˜Ÿåˆ—é‡Œé¢ï¼Œ ç„¶åå‘å®¢æˆ·ç«¯è¿”å› QUEUED å›å¤ã€‚&lt;/p&gt;
&lt;p&gt;WATCH: ç›‘è§†ä¸€ä¸ªæˆ–å¤šä¸ªkeyï¼Œå¦‚æœäº‹åŠ¡åœ¨æ‰§è¡Œå‰ï¼Œè¿™ä¸ªkey(æˆ–å¤šä¸ªkey)è¢«å…¶ä»–å‘½ä»¤ä¿®æ”¹ï¼Œåˆ™äº‹åŠ¡è¢«ä¸­æ–­ï¼Œä¸ä¼šæ‰§è¡Œäº‹åŠ¡ä¸­çš„ä»»ä½•å‘½ä»¤ï¼Œæ­¤æ—¶EXECæ‰§è¡Œç»“æœä¸ºnullã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;piplineä¸»è¦ç”¨äºæ‰¹é‡å‘é€å‘½ä»¤ï¼Œä¸€æ¬¡æ€§å‘é€å¤šä¸ªè¯·æ±‚ï¼Œä¸€æ¬¡æ€§è¯»å–æ‰€æœ‰è¿”å›ç»“æœï¼Œç›®çš„æ˜¯ä¸ºäº†å‡å°‘ &lt;code&gt;è¿æ¥-ã€‹å‘é€å‘½ä»¤ -ã€‹è¿”å›ç»“æœ&lt;/code&gt; è¿™ä¸ªè¿‡ç¨‹äº§ç”Ÿçš„è€—æ—¶ï¼Œå‡å°‘IOæ¬¡æ•°ï¼Œå‡å°‘ read() å’Œ write() çš„ç³»ç»Ÿè°ƒç”¨æ¬¡æ•°ã€‚&lt;/p&gt;
&lt;p&gt;MULTIå’ŒEXECäº‹åŠ¡æœºåˆ¶ä¸Redis piplineçš„åŒºåˆ«ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;äº‹åŠ¡ä¸­çš„æ¯ä¸ªå‘½ä»¤ä¼šå…ˆå‘é€åˆ°æœåŠ¡ç«¯ï¼Œåªä¼šå†æ‰§è¡Œï¼›è€Œpiplineæ˜¯ä¼šæŠŠå‘½ä»¤è¯·æ±‚ç¼“å­˜åœ¨å®¢æˆ·ç«¯æœ¬åœ°å†…å­˜ä¸­ï¼Œå†å‘é€è¯·æ±‚ä¸€æ¬¡æ€§æ‰§è¡Œ&lt;/li&gt;
&lt;li&gt;äº‹åŠ¡ä¸­çš„æ¯ä¸ªå‘½ä»¤éƒ½ä¼šå…ˆå‘é€åˆ°æœåŠ¡ç«¯ï¼Œè¯·æ±‚æ¬¡æ•°å¤šï¼Œè€Œpiplineåªå‘é€ä¸€æ¬¡è¯·æ±‚&lt;/li&gt;
&lt;li&gt;ä¸€èˆ¬äº‹åŠ¡å’Œpiplineä¼šé…åˆä½¿ç”¨ï¼Œä»¥å‡å°‘è¯·æ±‚æ¬¡æ•°ï¼Œå‡å°‘ç½‘ç»œIOï¼Œæå‡æ€§èƒ½ï¼Œä¿è¯å¤šä¸ªå‘½ä»¤å‘é€ä¸ä¼šè¢«åˆ«çš„è¯·æ±‚æ‰“æ–­ï¼Œä¿è¯å¤šä¸ªäº‹åŠ¡çš„éš”ç¦»æ€§ï¼Œ&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;redisä¸­çš„åŸå­æ€§&#34;&gt;Redisä¸­çš„åŸå­æ€§&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;æ›´å¤šçš„æ˜¯ä¸ºäº†å‡å°‘å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯çš„é€šä¿¡æ¬¡æ•°ã€‚Redisæœ¬èº«ä¸æä¾›å›æ»šæœºåˆ¶ï¼Œå¦‚æœä¸€æ¬¡æ€§ä¼ è¾“å¤šä¸ªå‘½ä»¤æ—¶ï¼Œå½“æœ‰ä¸€ä¸ªå‘½ä»¤æ‰§è¡Œå¤±è´¥äº†ï¼Œå‰©ä¸‹çš„å‘½ä»¤è¿˜æ˜¯ä¼šç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œæ— æ³•å®ç°äº‹åŠ¡çš„åŸå­æ€§ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœå‘½ä»¤æœ¬èº«æœ‰é”™ï¼Œåªæœ‰åˆ°äº†EXECå‘½ä»¤æ—¶æ‰ä¼šæŠ¥é”™ï¼Œæ•´ä¸ªMULTIæœŸé—´çš„å‘½ä»¤éƒ½ä¸ä¼šæ‰§è¡Œï¼Œæ­¤æ—¶æ‰ä¿è¯äº†åŸå­æ€§ã€‚&lt;/li&gt;
&lt;li&gt;RDBä¸ä¼šåœ¨äº‹åŠ¡æ‰§è¡Œçš„æ—¶å€™æ‰§è¡Œï¼Œæ‰€ä»¥å¯ä»¥ä¿è¯åŸå­æ€§ã€‚&lt;/li&gt;
&lt;li&gt;äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­çš„å‘½ä»¤ï¼ŒAOFæ—¥å¿—ä¼šè®°å½•ï¼Œæ‰€ä»¥å¦‚æœäº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­å®•æœºäº†ï¼Œé‡å¯å‰éœ€è¦ä½¿ç”¨&lt;code&gt;redis-check-aofå·¥å…·&lt;/code&gt;æ£€æŸ¥AOFæ—¥å¿—ï¼Œå»é™¤æ‰§è¡Œåˆ°ä¸€åŠçš„äº‹åŠ¡å‘½ä»¤ï¼Œæ‰èƒ½ä¿è¯åŸå­æ€§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;Redisä¸­çš„åŸå­æ“ä½œ&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Redisçš„ incr / decr å‘½ä»¤ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª&lt;code&gt;è¯»å– -ã€‹ä¿®æ”¹ -ã€‹å†™å…¥&lt;/code&gt; çš„è¿‡ç¨‹ï¼›&lt;/li&gt;
&lt;li&gt;ä¸ºRediså®šä¹‰æ–°çš„æ•°æ®ç»“æ„å®ç°åŸå­æ“ä½œï¼Œæ¯•ç«ŸRedisæœ¬èº«æ˜¯å•çº¿ç¨‹çš„ï¼Œæœ¬èº«ä¸ä¼šæœ‰å…¶ä»–çº¿ç¨‹çš„å½±å“ï¼›&lt;/li&gt;
&lt;li&gt;Luaè„šæœ¬ï¼Œæ‰èƒ½å®ç°å¤æ‚é€»è¾‘çš„åŸå­æ“ä½œï¼Œä½¿ç”¨æ—¶ä¼šå…ˆé€šè¿‡script loadå‘½ä»¤æŠŠè„šæœ¬åŠ è½½åˆ°Redisä¸­ï¼Œå¾—åˆ°å”¯ä¸€æ‘˜è¦ï¼Œå†é€šè¿‡å‘½ä»¤evalsha + æ‘˜è¦çš„æ–¹å¼æ‰§è¡Œè„šæœ¬ï¼Œé¿å…æ¯æ¬¡æ‰§è¡Œè„šæœ¬éƒ½è¦å…ˆä¼ è¾“ï¼Œå‡å°‘ç½‘ç»œIOï¼›å¦å¤–Luaè„šæœ¬çš„æ—¶é—´å¤æ‚åº¦ä¸æ˜“è¿‡é•¿ï¼Œå¦åˆ™ä¼šé˜»å¡ä¸»çº¿ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Demoï¼šé™åˆ¶å®¢æˆ·ç«¯æ¯åˆ†é’Ÿè®¿é—®æ¬¡æ•°ä¸èƒ½è¶…è¿‡20æ¬¡ çš„Luaè„šæœ¬ï¼Œè¯¥è„šæœ¬åŒ…å«äº†è®¡æ•°ã€è®¿é—®æ¬¡æ•°åˆ¤æ–­å’Œè¿‡æœŸæ—¶é—´è®¾ç½®ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-lua&#34; data-lang=&#34;lua&#34;&gt;&lt;span class=&#34;o&#34;&gt;//&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;å®¢æˆ·ç«¯å…ˆè·å–&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ipå¯¹åº”çš„è®¿é—®æ¬¡æ•°&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;current&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;redis.call&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;get&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;KEYS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;//&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;å¦‚æœè¶…è¿‡è®¿é—®æ¬¡æ•°è¶…è¿‡&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;20&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;æ¬¡ï¼Œåˆ™æŠ¥é”™ï¼Œè¿™ä¸¤æ­¥ä¸æ¶‰åŠä¸´ç•Œå€¼çš„ä¿®æ”¹ï¼Œå› æ­¤å¯ä»¥ä¸æ”¾åœ¨è„šæœ¬ä¸­åŸå­æ‰§è¡Œã€‚&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;IF&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;current&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;NULL&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AND&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;current&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;20&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;THEN&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;ERROR&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;exceed 20 accesses per second&amp;#34;&lt;/span&gt;

&lt;span class=&#34;n&#34;&gt;Luaè„šæœ¬åç§°&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ï¼š&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;visit_restrict.script&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;è„šæœ¬å†…å®¹&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;//&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;å¦‚æœè®¿é—®æ¬¡æ•°ä¸è¶³&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;20&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;æ¬¡ï¼Œå¢åŠ ä¸€æ¬¡è®¿é—®è®¡æ•°&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;value&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;redis.call&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;incr&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;KEYS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;//&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡è®¿é—®ï¼Œå°†é”®å€¼å¯¹çš„è¿‡æœŸæ—¶é—´è®¾ç½®ä¸º&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;60&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;så&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;IF&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;value&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;THEN&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;redis.call&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;expire&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;KEYS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;],&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;60&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;END&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;//&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;æ‰§è¡Œå…¶ä»–æ“ä½œ&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;DO&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;THINGS&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;END&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;æ‰§è¡Œå‘½ä»¤ï¼š&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;redis&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cli&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;--eval visit_restrict.script keys , args&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id=&#34;redisä¸­çš„éš”ç¦»æ€§&#34;&gt;Redisä¸­çš„éš”ç¦»æ€§&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;éœ€è¦ä¾èµ–WATCHæœºåˆ¶ï¼Œå› ä¸ºRedisæµæ°´çº¿å‘½ä»¤æ˜¯åœ¨EXECå‘½ä»¤æ‰§è¡Œåå¼€å§‹çš„ï¼Œåœ¨EXECå‘½ä»¤è¿˜æœªæ‰§è¡Œå‰ï¼Œå¦‚æœè¦ä¿è¯éš”ç¦»æ€§ï¼Œéœ€è¦ä½¿ç”¨WATCHç›‘æ§æŸä¸ªkeyï¼Œå½“EXECå‘½ä»¤æ‰§è¡Œæ—¶ï¼ŒWATCHæœºåˆ¶å°±ä¼šè§¦å‘ï¼Œå¦‚æœç›‘æ§çš„æ•°æ®è¢«ä¿®æ”¹äº†ï¼Œå°±æ”¾å¼ƒæ­¤æ¬¡äº‹åŠ¡çš„æ‰§è¡Œã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœæ˜¯åœ¨EXECå‘½ä»¤æ‰§è¡Œåçš„ï¼Œç”±äºRedisæ˜¯å•çº¿ç¨‹çš„ï¼Œæ‰€ä»¥å¹¶å‘æƒ…å†µä¸‹ä¸ä¼šç ´åäº‹åŠ¡éš”ç¦»æ€§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å› æ­¤è°ƒç”¨æ–¹å¯ä»¥åˆ©ç”¨è¿™ä¸ªç‰¹æ€§ï¼Œä¸æ–­çš„é‡è¯•è¿™ä¸ªæ“ä½œï¼ŒçŸ¥é“æˆåŠŸä¸ºæ­¢ã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨Watchçš„å®ç°ç›‘æ§ï¼šåœ¨ä½¿ç”¨MULTIå‘½ä»¤ä¹‹å‰ä½¿ç”¨WATCHç›‘æ§æŸäº›é”®å€¼å¯¹ï¼Œç„¶åä½¿ç”¨MULTIå‘½ä»¤å¼€å¯äº‹åŠ¡ï¼Œæ‰§è¡Œå„ç§æ•°æ®ç»“æ„çš„æ“ä½œå‘½ä»¤ï¼Œæ­¤æ—¶è¿™äº›å‘½ä»¤å…¥é˜Ÿåˆ—ï¼›å½“ä½¿ç”¨EXECæ‰§è¡Œäº‹åŠ¡æ—¶ï¼Œé¦–å…ˆä¼šå¯¹æ¯”WATCHæ‰€ç›‘æ§çš„é”®å€¼å¯¹ï¼Œå¦‚æœæ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œå®ƒä¼šæ‰§è¡Œäº‹åŠ¡é˜Ÿåˆ—ä¸­çš„å‘½ä»¤ï¼Œæäº¤äº‹åŠ¡ï¼Œå¦‚æœå‘ç”Ÿå˜åŒ–ï¼Œåˆ™ä¸æ‰§è¡Œäº‹åŠ¡ä¸­çš„ä»»ä½•å‘½ä»¤ï¼ŒåŒæ—¶äº‹åŠ¡å›æ»šï¼Œç„¶åå–æ¶ˆæ‰§è¡Œäº‹åŠ¡å‰çš„WATCHå‘½ä»¤ã€‚&lt;/p&gt;
&lt;h2 id=&#34;redisä¸­çš„ä¸€è‡´æ€§&#34;&gt;Redisä¸­çš„ä¸€è‡´æ€§&lt;/h2&gt;
&lt;p&gt;åœ¨å‘½ä»¤æ‰§è¡Œé”™è¯¯æˆ– Redis å‘ç”Ÿæ•…éšœçš„æƒ…å†µä¸‹ï¼ŒRedis äº‹åŠ¡æœºåˆ¶å¯¹ä¸€è‡´æ€§å±æ€§æ˜¯æœ‰ä¿è¯çš„ã€‚&lt;/p&gt;
&lt;h2 id=&#34;redisä¸­çš„æŒä¹…æ€§&#34;&gt;Redisä¸­çš„æŒä¹…æ€§&lt;/h2&gt;
&lt;p&gt;å°½ç®¡æœ‰RDBå’ŒAOFæ—¥å¿—çš„æ”¯æŒï¼Œä½†æ˜¯ä»ç„¶æœ‰ä¸¢æ•°æ®çš„å¯èƒ½ã€‚æ¯”å¦‚ä½¿ç”¨RDBæ¨¡å¼ï¼Œåœ¨ä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œåï¼Œè€Œä¸‹ä¸€æ¬¡çš„ RDB å¿«ç…§è¿˜æœªæ‰§è¡Œå‰ï¼Œå¦‚æœå‘ç”Ÿäº†å®ä¾‹å®•æœºï¼Œæ­¤æ—¶ï¼Œäº‹åŠ¡ä¿®æ”¹çš„æ•°æ®ä¹Ÿæ˜¯ä¸èƒ½ä¿è¯æŒä¹…åŒ–çš„ã€‚&lt;/p&gt;
&lt;h1 id=&#34;åº”ç”¨åœºæ™¯&#34;&gt;åº”ç”¨åœºæ™¯&lt;/h1&gt;
&lt;h2 id=&#34;èšåˆç»Ÿè®¡---ç»Ÿè®¡æ¯æ—¥æ–°å¢ç”¨æˆ·&#34;&gt;èšåˆç»Ÿè®¡ - ç»Ÿè®¡æ¯æ—¥æ–°å¢ç”¨æˆ·&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨Setç±»å‹&lt;/li&gt;
&lt;li&gt;ä¸€ä¸ªSetè®°å½•æ‰€æœ‰ç™»å½•è¿‡çš„ç”¨æˆ·IDï¼š&lt;code&gt;[keyï¼šuser:idï¼Œvalueï¼šSet&amp;lt;userId&amp;gt;]&lt;/code&gt;ï¼Œå¦ä¸€ä¸ªSetè®°å½•æ¯æ—¥ç™»å½•è¿‡çš„ç”¨æˆ·ID&lt;code&gt;[keyï¼šuser:id :æ—¥æœŸï¼Œvalueï¼šSet&amp;lt;userId&amp;gt;]&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;ç»Ÿè®¡æ¯æ—¥æ–°å¢ç”¨æˆ·ï¼Œè®¡ç®—æ¯æ—¥ç”¨æˆ· Set å’Œç´¯è®¡ç”¨æˆ· Set çš„å·®é›†ï¼Œä½¿ç”¨å‘½ä»¤&lt;code&gt;SDIFFSTORE [ç»“æœkey] [user:id :æ—¥æœŸ] [user:id]&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;å¼Šç«¯ï¼šSetçš„å·®é›†ã€å¹¶é›†ã€äº¤é›†è®¡ç®—å¤æ‚åº¦è¾ƒé«˜ï¼Œå½“æ•°æ®é‡è¾ƒå¤§æ—¶è®¡ç®—å¤ªæ…¢ä¼šé˜»å¡ä¸»çº¿ç¨‹ï¼Œä¸€èˆ¬è¿™ç§è®¡ç®—ä¼šåœ¨ä»åº“ä¸Šåšã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;æ’åºç»Ÿè®¡---ç»Ÿè®¡æœ€æ–°è¯„è®ºæ’è¡Œæ¦œæ—¶é—´æ®µå†…åœ¨çº¿æ•°ç­‰&#34;&gt;æ’åºç»Ÿè®¡ - ç»Ÿè®¡æœ€æ–°è¯„è®ºã€æ’è¡Œæ¦œã€æ—¶é—´æ®µå†…åœ¨çº¿æ•°ç­‰&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨Listï¼Œå½“æœ‰æ–°å…ƒç´ LPushæˆ–RPushæ’å…¥æ—¶ï¼ŒåŸå…ˆæ‰€æœ‰å…ƒç´ éƒ½ä¼šåç§»ä¸€ä½ï¼Œä½¿ç”¨Lrangeè¯»å–å…ƒç´ æ—¶å¯èƒ½ä¼šè¯»åˆ°æ—§æ•°æ®ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ZSetï¼Œä¸ºæ¯ä¸ªå…ƒç´ è®¾ç½®æƒé‡ï¼ŒæŒ‰æƒé‡æ’åºï¼Œä½¿ç”¨Zrangebyscoreåˆ™ä¸ä¼šè¯»åˆ°æ—§æ•°æ®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;äºŒå€¼çŠ¶æ€ç»Ÿè®¡---ç»Ÿè®¡æ˜¯å¦ç­¾åˆ°å­˜ä¸å­˜åœ¨æœ‰æ²¡æœ‰é—®é¢˜&#34;&gt;äºŒå€¼çŠ¶æ€ç»Ÿè®¡ - ç»Ÿè®¡æ˜¯å¦ç­¾åˆ°ã€å­˜ä¸å­˜åœ¨ã€æœ‰æ²¡æœ‰é—®é¢˜&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;é’ˆå¯¹å€¼åªæœ‰0 æˆ–1çš„åœºæ™¯ï¼Œä½¿ç”¨bitmapï¼Œæ˜¯Redisçš„æ‰©å±•æ•°æ®ç±»å‹ï¼Œæœ¬èº«æ˜¯Stringç±»å‹çš„ä¸€ç§ç‰¹æ®Šåº”ç”¨ã€‚&lt;/li&gt;
&lt;li&gt;bitmapåˆ©ç”¨çš„æ˜¯å­˜å‚¨çš„String valueçš„ä½ã€‚å¹¶ä¸”bitmapæ”¯æŒBitopå‘½ä»¤å¯¹å¤šä¸ªbitmapè¿›è¡ŒæŒ‰ä½ä¸ã€æˆ–ã€å¼‚æˆ–æ“ä½œï¼Œbitcountç»Ÿè®¡ä½ä¸­1çš„ä¸ªæ•°ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;åŸºæ•°ç»Ÿè®¡---ç»Ÿè®¡ä¸€ä¸ªé›†åˆä¸­ä¸é‡å¤çš„å…ƒç´ &#34;&gt;åŸºæ•°ç»Ÿè®¡ - ç»Ÿè®¡ä¸€ä¸ªé›†åˆä¸­ä¸é‡å¤çš„å…ƒç´ &lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨Setæˆ–Hashï¼Œä½†æ˜¯å¯èƒ½ä¼šæ¯”è¾ƒè€—å†…å­˜&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨HyperLogLogï¼Œä¸“é—¨ç”¨äºåŸºæ•°ç»Ÿè®¡ï¼Œä¼˜åŠ¿åœ¨äºæ‰€éœ€ç©ºé—´æ€»æ˜¯å›ºå®šï¼Œä½¿ç”¨&lt;code&gt;PFAdd key v1 v2 v3&lt;/code&gt;å‘½ä»¤åšæ·»åŠ ï¼Œ&lt;code&gt;PFCount key&lt;/code&gt;ç»Ÿè®¡keyçš„valueæ•°é‡ï¼Œä½†æ˜¯å­˜åœ¨è¯¯å·®ï¼Œè¯¯å·®ç‡çº¦ä¸º0.81%&lt;/li&gt;
&lt;li&gt;ä¸€èˆ¬ç”¨äºç»Ÿè®¡æ³¨å†Œçš„IPæ•°ã€æ¯æ—¥è®¿é—®IPæ•°ã€é¡µé¢å®æ—¶UVæ•°ã€åœ¨çº¿ç”¨æˆ·æ•°ã€æœç´¢çš„å…³é”®è¯æ•°&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;geo---lbsåº”ç”¨&#34;&gt;GEO - LBSåº”ç”¨&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;åº•å±‚å®ç°æ˜¯ZSetï¼Œæƒé‡å€¼æ˜¯ç»çº¬åº¦ï¼Œä½†æ˜¯ç”±äºZSetçš„æƒé‡å€¼åªèƒ½æ˜¯æµ®ç‚¹ç±»å‹ï¼Œå› æ­¤ä¸€èˆ¬ä¼šå¯¹ç»çº¬åº¦åšGeoHashç¼–ç ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;GeoHashç¼–ç çš„åŸºæœ¬åŸç†æ˜¯ï¼šäºŒåˆ†åŒºé—´ï¼ŒåŒºé—´ç¼–ç ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;äºŒåˆ†åŒºé—´ï¼šæ¯”å¦‚æŠŠç»åº¦èŒƒå›´[-180,180]ä¼šè¢«åˆ†æˆä¸¤ä¸ªå­åŒºé—´ï¼š[-180,0) å’Œ[0,180]ï¼Œå¦‚æœè¦ç¼–ç çš„ç»åº¦å€¼è½åœ¨å·¦åŒºé—´ï¼Œåˆ™ç”¨0è¡¨ç¤ºï¼Œå³åŒºé—´ç”¨1è¡¨ç¤ºï¼Œé€šè¿‡ä¸æ–­çš„å¯¹åŒºé—´è¿›è¡Œåˆ†åŒºï¼Œç»è¿‡Næ¬¡ä¹‹åï¼Œå¾—åˆ°ä¸€ä¸ªNä½æ•°çš„01ç»„åˆã€‚çº¬åº¦åŒç†ã€‚&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚æœ‰ä¸€ä¸ªç‚¹ï¼ˆ39.923201ï¼Œ116.390705ï¼‰ï¼Œä»¥çº¬åº¦ä¸ºä¾‹ï¼Œï¼ˆ-90ï¼Œ90ï¼‰ä¸­é—´å€¼ä¸º0ï¼Œ39.923201åœ¨ï¼ˆ0ï¼Œ90ï¼‰å¾—åˆ°1ï¼Œï¼ˆ0ï¼Œ90ï¼‰çš„ä¸­é—´å€¼æ˜¯45ï¼Œåœ¨ï¼ˆ0ï¼Œ45ï¼‰å¾—åˆ°0ï¼Œç»§ç»­å¯¹åˆ†åŒºè¿›è¡ŒäºŒåˆ†å’Œæ¯”è¾ƒï¼Œæœ€ç»ˆå¾—åˆ°ä¸€ä¸ªäºŒè¿›åˆ¶æ•°ï¼Œç»åº¦ä¹Ÿæ˜¯ä»¥åŒæ ·çš„æ–¹å¼è¿›è¡Œè®¡ç®—&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åŒºé—´ç¼–ç ï¼šæŠŠè®¡ç®—è¿‡åçš„ç»çº¬åº¦ç¼–ç è¿›è¡Œç»„åˆï¼Œè§„åˆ™ï¼šå¶æ•°ä½æ˜¯ç»åº¦ç¼–ç å€¼ï¼Œå¥‡æ•°ä½æ˜¯çº¬åº¦ç¼–ç å€¼ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;base32è¿›è¡Œç¼–ç &lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;é€šè¿‡GeoHashç¼–ç ï¼Œåœ°å›¾ä¸Šçš„æ¯ä¸ªæ–¹æ ¼éƒ½èƒ½ç”¨æ•°å­—è¿›è¡Œè¡¨ç¤ºï¼Œåˆ†åŒºè¶Šå¤šè¶Šç²¾å‡†ã€‚&lt;strong&gt;é€šè¿‡èŒƒå›´æŸ¥è¯¢ + æ–¹æ ¼å‘¨å›´æ–¹æ ¼çš„ç¼–ç ï¼Œå³å¯å®ç°æœç´¢é™„è¿‘çš„äººåŠŸèƒ½&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;GeoHashè¡¨ç¤ºä¸€ä¸ªçŸ©å½¢çš„åŒºåŸŸï¼Œç²¾åº¦å–å†³äºäºŒåˆ†çš„æ¬¡æ•°ï¼Œæ¬¡æ•°è¶Šå¤šè¶Šç²¾ç¡®ï¼Œç»è¿‡base32ç¼–ç åå¾—åˆ°ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œç¼–ç è¶Šé•¿ï¼ŒèŒƒå›´è¶Šå°ï¼Œä½ç½®æ›´ç²¾ç¡®ï¼›ä¸¤ä¸ªç›¸åŒå‰ç¼€çš„å­—ç¬¦ä¸²ï¼Œé•¿åº¦è¶ŠçŸ­è¡¨ç¤ºèŒƒå›´æ›´å¤§ï¼Œå¯ä»¥é€šè¿‡æ­¤ç‰¹æ€§æ¥è¡¨ç¤ºä¸¤ä¸ªç‚¹ä¹‹é—´çš„å¤§æ¦‚è·ç¦»ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Redisä¹Ÿæä¾›äº†Geoçš„æ•°æ®ç±»å‹&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;ä¿å­˜æ—¶é—´åºåˆ—æ•°æ®&#34;&gt;ä¿å­˜æ—¶é—´åºåˆ—æ•°æ®&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;æ—¶é—´åºåˆ—æ•°æ®çš„ç‰¹ç‚¹æ˜¯æ’å…¥é€Ÿåº¦è¦å¿«ï¼Œæ•°æ®ä¸€æ—¦æ’å…¥å°±ä¸å˜ã€æŸ¥è¯¢æ¨¡å¼è¾ƒå¤šã€‚&lt;/li&gt;
&lt;li&gt;å¯ä»¥åŸºäºHashå’ŒZSetå®ç°ã€‚Hashå®ç°æ’å…¥å¿«é€Ÿå’Œç‚¹æŸ¥è¯¢ï¼ŒZSetå®ç°èŒƒå›´æŸ¥è¯¢ï¼Œä½†ç”±äºæ’å…¥ä¸€æ¡æ•°æ®çš„æ—¶å€™éœ€è¦åŒæ—¶æ“ä½œHashå’ŒZSetï¼Œå› æ­¤è¦æ±‚è¿™ä¸ªæ“ä½œæ˜¯åŸå­çš„ã€‚&lt;/li&gt;
&lt;li&gt;ZSetåªèƒ½æä¾›èŒƒå›´æŸ¥è¯¢ï¼ŒèšåˆæŸ¥è¯¢åªèƒ½åœ¨è®©å®¢æˆ·ç«¯æŸ¥å›å»ä¹‹åè‡ªå·±åšï¼Œä½†æ˜¯å¤§é‡æ•°æ®æŸ¥è¯¢ä¼ è¾“æ¯”è¾ƒä¾èµ–ç½‘ç»œèµ„æºï¼Œå¯èƒ½ä¼šå¯¼è‡´å…¶ä»–æ“ä½œå“åº”é€Ÿåº¦å˜æ…¢ï¼Œå¦‚æœæƒ³è¦Rediså®ç°çš„è¯ï¼Œå°±å¾—ä¾é RedisTimeSeriesã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;æ¶ˆæ¯é˜Ÿåˆ—&#34;&gt;æ¶ˆæ¯é˜Ÿåˆ—&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;æ¶ˆæ¯é˜Ÿåˆ—ä¸€èˆ¬è¦è§£å†³ä¸‰ä¸ªé—®é¢˜ï¼šé¡ºåºæ¶ˆè´¹ã€å¹‚ç­‰æ¶ˆè´¹ã€æ¶ˆæ¯å¯é æ€§ä¿è¯&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä½¿ç”¨List&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Listçš„æ¯ä¸ªå…ƒç´ é™¤äº†æ¶ˆæ¯çš„å†…å®¹å¤–è¿˜è¦ä¿å­˜æ¶ˆæ¯çš„å”¯ä¸€idï¼Œç”¨äºè§£å†³é‡å¤æ€§æ¶ˆè´¹ï¼›&lt;/li&gt;
&lt;li&gt;Listç±»å‹æœ‰æä¾›BRPOPä¾›æ¶ˆè´¹è€…é˜»å¡è¯»å–ï¼Œé¿å…å¾ªç¯è¯»å–å¸¦æ¥çš„æ¶ˆè€—ï¼›&lt;/li&gt;
&lt;li&gt;Listç±»å‹æœ‰æä¾›BRPOPLPUSHå‘½ä»¤ï¼Œè®©æ¶ˆè´¹è€…è¯»å–æ—¶ä¼šæŠŠæ•°æ®å­˜å…¥å¦ä¸€å¤‡ä»½Listä¸­ï¼Œç”¨äºé¿å…æ¶ˆè´¹è€…ä»Listä¸­ç§»é™¤æ¶ˆæ¯è¯»å–æ—¶å®•æœºï¼Œé‡å¯åå¯é‡æ–°è¯»å–æ¶ˆæ¯ã€‚&lt;/li&gt;
&lt;li&gt;Listä¸æ”¯æŒæ¶ˆè´¹ç»„å®ç°ï¼Œæ— æ³•é¿å…ç”Ÿäº§é€Ÿåº¦å¤§äºæ¶ˆè´¹é€Ÿåº¦çš„åœºæ™¯ã€‚&lt;/li&gt;
&lt;li&gt;é€šè¿‡ BLPOP å‘½ä»¤ï¼Œåœ¨æ²¡æœ‰æ¶ˆæ¯çš„æ—¶å€™ï¼Œå®ƒä¼šä¸€ç›´é˜»å¡ï¼Œç›´è‡³æœ‰æ¶ˆæ¯åˆ°æ¥ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å®ç°å»¶è¿Ÿé˜Ÿåˆ—ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ZSetï¼Œæ‹¿æ—¶é—´æˆ³å½“scoreï¼Œè°ƒç”¨ZADDå‘½ä»¤ç”Ÿäº§æ¶ˆæ¯ï¼ŒZRANGEBYSOCREå‘½ä»¤è·å–Nç§’å‰çš„æ•°æ®è¿›è¡Œè½®è¯¢å¤„ç†ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä½¿ç”¨Streamç±»å‹ï¼Œè§£å†³å¤šç«¯æ¶ˆè´¹é—®é¢˜ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Streamçš„XADDå‘½ä»¤ï¼Œå¯ä»¥ä¸ºå…¶ç”Ÿæˆå…¨å±€å”¯ä¸€IDã€‚&lt;/li&gt;
&lt;li&gt;è¯»å–æ—¶ä½¿ç”¨å‘½ä»¤XReadï¼Œå¯æ”¯æŒæŒ‡å®šIDè¯»å–ï¼Œä¹Ÿæ”¯æŒè¶…æ—¶é˜»å¡è¯»å–ã€‚&lt;/li&gt;
&lt;li&gt;å‘½ä»¤XGroupåˆ›å»ºæ¶ˆè´¹ç»„ï¼ŒXREADGROUPæŒ‡å®šç»„å†…å“ªä¸ªæ¶ˆè´¹è€…è¿›è¡Œæ¶ˆè´¹ã€‚&lt;/li&gt;
&lt;li&gt;Streams ä¼šè‡ªåŠ¨ä½¿ç”¨å†…éƒ¨é˜Ÿåˆ—ï¼ˆä¹Ÿç§°ä¸º PENDING Listï¼‰ç•™å­˜æ¶ˆè´¹ç»„é‡Œæ¯ä¸ªæ¶ˆè´¹è€…è¯»å–çš„æ¶ˆæ¯ï¼Œç›´åˆ°æ¶ˆè´¹è€…ä½¿ç”¨ XACK å‘½ä»¤è¿›è¡Œå›å¤ã€‚å¦‚æœæ¶ˆè´¹ä¸æˆåŠŸï¼Œå®ƒå°±ä¸ä¼šç»™ Streams å‘é€ XACK å‘½ä»¤ï¼Œæ¶ˆæ¯ä»ç„¶ä¼šç•™å­˜ã€‚å½“æ¶ˆè´¹è€…é‡å¯åï¼Œç”¨ XPENDING å‘½ä»¤æŸ¥çœ‹å·²è¯»å–ã€ä½†å°šæœªç¡®è®¤å¤„ç†å®Œæˆçš„æ¶ˆæ¯ã€‚&lt;/li&gt;
&lt;li&gt;Streamæ˜¯Redis5.0ä»¥åæ‰æœ‰çš„ä¸“é—¨ç”¨æ¥å¤„ç†æ¶ˆæ¯é˜Ÿåˆ—çš„ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;ç¼“å­˜å¯èƒ½å¼•å‘çš„é—®é¢˜ä»¥åŠåº”å¯¹æ–¹æ³•&#34;&gt;ç¼“å­˜å¯èƒ½å¼•å‘çš„é—®é¢˜ä»¥åŠåº”å¯¹æ–¹æ³•&lt;/h1&gt;
&lt;p&gt;ä½¿ç”¨Redisæ¥æ„å»ºç¼“å­˜æœ‰ä¸¤ç§æ¨¡å¼&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åªè¯»ç¼“å­˜ï¼šåŠ é€Ÿè¯»è¯·æ±‚ã€‚åº”ç”¨è¯»å–æ•°æ®ï¼Œå…ˆå‘RedisæŸ¥è¯¢ï¼ŒæŸ¥ä¸åˆ°å†æŸ¥åº“ï¼Œç„¶åä¿å­˜åˆ°ç¼“å­˜ä¸­ã€‚åº”ç”¨å†™æ•°æ®ï¼Œå…ˆæ”¹åº“ï¼Œåˆ æ‰æ—§ç¼“å­˜æ•°æ®ã€‚è¿™ç§æ–¹å¼å¯ä»¥å¾ˆå¥½çš„ä¿è¯äº†ä¸€è‡´æ€§ã€‚&lt;/li&gt;
&lt;li&gt;è¯»å†™ç¼“å­˜ï¼šåŒæ—¶åŠ é€Ÿè¯»å†™è¯·æ±‚ã€‚è¯»å†™éƒ½ä¼šåœ¨ç¼“å­˜é‡Œå‘ç”Ÿï¼Œæœ€æ–°çš„æ•°æ®æ˜¯åœ¨Redisä¸­ï¼Œä½†éœ€è¦ä¸¥é‡ä¾èµ–Redisçš„æŒä¹…åŒ–ã€‚è¿™ç§æ–¹å¼å¯¹ä¸€è‡´æ€§çš„ä¿è¯å°±å·®äº†ç‚¹ï¼Œç‰¹åˆ«æ˜¯åœ¨é«˜å¹¶å‘ä¸‹ã€‚
&lt;ul&gt;
&lt;li&gt;åŒæ­¥ç›´å†™ï¼šä¼˜å…ˆä¿è¯æ•°æ®å¯é ã€‚å†™è¯·æ±‚ä¼šåŒæ—¶ä¿®æ”¹ç¼“å­˜å’Œåº“ï¼Œç­‰åˆ°éƒ½å®Œæˆäº†æ‰è¿”å›ï¼Œéœ€è¦ä¿è¯åŸå­æ€§ã€‚&lt;/li&gt;
&lt;li&gt;å¼‚æ­¥å†™å›ï¼šä¼˜å…ˆä¿è¯å¿«é€Ÿå“åº”ã€‚å†™è¯·æ±‚ä¼šå…ˆåœ¨ç¼“å­˜ä¸­å¤„ç†ï¼Œç­‰åˆ°è¿™äº›å¢æ”¹æ•°æ®è¦ä»ç¼“å­˜ä¸­æ·˜æ±°ï¼Œæ‰ä¼šå†™å›æ•°æ®åº“ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;ç¼“å­˜é›ªå´©&#34;&gt;ç¼“å­˜é›ªå´©&lt;/h2&gt;
&lt;p&gt;ç°è±¡ï¼šç¼“å­˜å¤§é¢ç§¯å¤±æ•ˆå¯¼è‡´è¯·æ±‚åˆ°è¾¾æ•°æ®åº“&lt;/p&gt;
&lt;p&gt;åº”å¯¹æ–¹æ¡ˆï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç¼“å­˜è¿‡æœŸæ—¶é—´è®¾ç½®å‡åŒ€ï¼Œä¸èƒ½è®©ä¸€å¤§ç‰‡ç¼“å­˜åœ¨æŸä¸€æ—¶é—´å…¨éƒ¨å¤±æ•ˆï¼Œæ¯”å¦‚è®¾ç½®è¿‡æœŸæ—¶é—´æ—¶åŠ å…¥éšæœºæ•°ï¼Œè®©è¿‡æœŸæ—¶é—´åœ¨ä¸€ä¸ªèŒƒå›´å†…æ³¢åŠ¨ã€‚&lt;/li&gt;
&lt;li&gt;è¯·æ±‚æ—¶åŠ é”(æ¯”å¦‚åˆ©ç”¨redissionçš„rlock)ï¼Œåç»­è¯·æ±‚åªèƒ½ç­‰åˆ°å‰é¢çš„æŸ¥å®Œæ•°æ®åº“ï¼Œè¿›è¡Œç¼“å­˜åï¼Œæ‰èƒ½ç»§ç»­ï¼Œä½†ä¼šé€ æˆååé‡é™ä½ï¼Œå“åº”æ—¶é—´å˜é•¿ï¼Œæˆ–è€…å¯ä»¥ä½¿ç”¨semaphoreè®¾ç½®ä¸€å®šçš„ä¿¡å·é‡ï¼Œä¸è‡³äºåªæœ‰ä¸€ä¸ªè¯·æ±‚å»å›æºæ•°æ®åº“ã€‚&lt;/li&gt;
&lt;li&gt;ä¸è®¾ç½®keyçš„è¿‡æœŸæ—¶é—´ï¼Œå¦å¼€ä¸€ä¸ªå®šæ—¶ä»»åŠ¡å®šæœŸå…¨é‡æ›´æ–°ç¼“å­˜ï¼›æˆ–è€…å®šæ—¶ä»»åŠ¡å®šæœŸæ‰«æï¼Œå°†å¿«è¦è¿‡æœŸçš„keyå»¶è¿Ÿè¿‡æœŸæ—¶é—´ï¼›è®¾ç½®å¤šçº§ç¼“å­˜ã€‚&lt;/li&gt;
&lt;li&gt;ç°åº¦å‘å¸ƒï¼Œå¯¹ç¼“å­˜è¿›è¡Œé¢„çƒ­ã€‚&lt;/li&gt;
&lt;li&gt;æœåŠ¡é™çº§ï¼Œå½“è®¿é—®çš„æ•°æ®æ˜¯éæ ¸å¿ƒæ•°æ®ï¼Œç›´æ¥è¿”å›é¢„å®šä¹‰æ•°æ®æˆ–ç©ºå€¼ï¼›å½“è®¿é—®çš„æ•°æ®æ˜¯æ ¸å¿ƒæ•°æ®ï¼Œä»å…è®¸æŸ¥ç¼“å­˜ï¼ŒæŸ¥åº“ã€‚&lt;/li&gt;
&lt;li&gt;ç¼“å­˜æ ‡è®°ï¼Œæ¯”å¦‚ï¼Œç»™æ•°æ®è®¾ç½®ç¼“å­˜è¿‡æœŸæ—¶é—´ä¸º60åˆ†é’Ÿï¼Œæ ‡è®°ç¼“å­˜è¿‡æœŸæ—¶é—´ä¸º30åˆ†é’Ÿï¼Œå½“æ—¶é—´è¶…è¿‡ç¼“å­˜æ ‡è®°æ—¶é—´åï¼Œè§¦å‘ç¼“å­˜æ›´æ–°ï¼Œä½†æ­¤æ—¶å®é™…ç¼“å­˜è¿˜èƒ½è¿”å›æ—§æ•°æ®ï¼Œç›´åˆ°ç¼“å­˜æ›´æ–°å®Œæˆï¼Œæ‰ä¼šè¿”å›æ–°ç¼“å­˜ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœæ˜¯Rediså®ä¾‹å‘ç”Ÿå®•æœºï¼Œåªèƒ½åœ¨åº”ç”¨å±‚ä¸­å®ç°æœåŠ¡ç†”æ–­æˆ–è¯·æ±‚é™æµã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;ç¼“å­˜å‡»ç©¿&#34;&gt;ç¼“å­˜å‡»ç©¿&lt;/h2&gt;
&lt;p&gt;ç°è±¡ï¼šå¤§é‡è¯·æ±‚è®¿é—®çƒ­ç‚¹æ•°æ®æ—¶ï¼Œä½†&lt;strong&gt;çƒ­ç‚¹æ•°æ®åˆšå¥½è¿‡æœŸ&lt;/strong&gt;ï¼Œæ­¤æ—¶è¯·æ±‚å‡»ç©¿ç¼“å­˜å±‚ï¼Œç›´æ¥åˆ°è¾¾æ•°æ®åº“&lt;/p&gt;
&lt;p&gt;åº”å¯¹æ–¹æ¡ˆï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸ç»™çƒ­ç‚¹æ•°æ®çš„ç¼“å­˜è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œä¸€ç›´ä¿ç•™ï¼Œæˆ–è€…çƒ­ç‚¹æ•°æ®å¿«è¦åˆ°æœŸå‰ï¼Œå¼‚æ­¥åˆ·æ–°ç¼“å­˜ï¼Œé‡æ–°è®¾ç½®è¿‡æœŸæ—¶é—´ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨äº’æ–¥é”æˆ–è€…ä¿¡å·é‡ï¼Œå½“æœ‰å¤§é‡è¯·æ±‚è®¿é—®ä¸€ä¸ªè¿‡æœŸçš„çƒ­ç‚¹æ•°æ®æ—¶ï¼Œåªæœ‰ä¸€å®šæ•°é‡çš„è¯·æ±‚ä¼šåˆ°è¾¾æ•°æ®åº“æŸ¥è¯¢æ•°æ®å¹¶ç¼“å­˜ï¼Œå…¶ä»–è¯·æ±‚ç­‰å¾…ç¼“å­˜åŠ è½½å³å¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;ç¼“å­˜ç©¿é€&#34;&gt;ç¼“å­˜ç©¿é€&lt;/h2&gt;
&lt;p&gt;ç°è±¡ï¼š&lt;strong&gt;æŸ¥è¯¢ä¸€ä¸ªä¸€å®šä¸å­˜åœ¨çš„æ•°æ®&lt;/strong&gt;ï¼Œå¯¼è‡´è¯·æ±‚ä¸€ç›´åˆ°è¾¾æ•°æ®åº“ï¼Œæ•°æ®ä¹Ÿä¸åœ¨æ•°æ®åº“ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;åº”å¯¹æ–¹æ¡ˆï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨ï¼Œå°†å¯èƒ½å‡ºç°æŸ¥è¯¢çš„å€¼å“ˆå¸Œåˆ°ä¸€ä¸ªbitMapä¸­ï¼Œè¿›è¡Œæ‹¦æˆªï¼Œè™½ç„¶å¸ƒéš†è¿‡æ»¤æœ‰ä¸€å®šçš„è¯¯æŠ¥å‡ ç‡ï¼Œä½†ä¹Ÿèƒ½ä¸€å®šç¨‹åº¦çš„å‡å°‘ç©¿é€çš„å½±å“ï¼Œå¸¸è§çš„æ–¹æ¡ˆæ˜¯é…åˆ2ä¸€èµ·é™ä½ç©¿é€å¸¦æ¥çš„å½±å“ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœæŸ¥è¯¢ç»“æœä¸ºç©ºï¼Œä¹ŸåŠ å…¥ç¼“å­˜ä¸­ï¼ˆå¯ä»¥ç›´æ¥è®¾ç½®ä¸ºç©ºï¼Œæˆ–è€…ä½¿ç”¨ç‰¹æ®Šæ ‡è¯†æ¥è¡¨ç¤ºï¼‰ï¼Œå¹¶è®¾ç½®è¿‡æœŸæ—¶é—´ã€‚&lt;/li&gt;
&lt;li&gt;é€šè¿‡å¼‚æ­¥æ›´æ–°æœåŠ¡ + æ¶ˆæ¯é˜Ÿåˆ—çš„æ–¹å¼è¿›è¡Œå…¨é‡ç¼“å­˜çš„æ›´æ–°ã€‚ç¼“å­˜çš„è®¾ç½®è¿˜æ˜¯ç…§æ—§ï¼Œåªæ˜¯å½“æœ‰æ•°æ®æ›´æ–°æ—¶ï¼Œè§¦å‘æ¶ˆæ¯äº¤ç»™æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå†ç”±å¼‚æ­¥æ›´æ–°æœåŠ¡æ¶ˆè´¹æ¶ˆæ¯ï¼Œå®ç°ç¼“å­˜æ›´æ–°ã€‚&lt;/li&gt;
&lt;li&gt;åˆ©ç”¨æ•°æ®åº“çš„Bin Logï¼Œå½“æ•°æ®åº“æ‰§è¡Œæ›´æ–°æ“ä½œæ—¶ï¼Œä»æ•°æ®åº“æ¥æ”¶åˆ°Bin Logä¹‹åæ ¹æ®Bin Logæ›´æ–°Redisç¼“å­˜ï¼Œé“ç†è·Ÿæ¶ˆæ¯é˜Ÿåˆ—ç±»ä¼¼ï¼Œåªæ˜¯ä¸ç”¨æ‹…å¿ƒæ¶ˆæ¯å‘é€å¤±è´¥é—®é¢˜ã€‚&lt;/li&gt;
&lt;li&gt;å‰ç«¯é¢„é˜²ï¼Œå¯¹è¯·æ±‚è¿›è¡Œæ£€æµ‹ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;ç¼“å­˜æ— åº•æ´&#34;&gt;ç¼“å­˜æ— åº•æ´&lt;/h2&gt;
&lt;p&gt;ç°è±¡ï¼šå¢åŠ ç¼“å­˜èŠ‚ç‚¹ï¼Œæ€§èƒ½ä¸å‡åé™ï¼ŒåŸå› æ˜¯å®¢æˆ·ç«¯è¦ç»´æŠ¤å¤§é‡çš„è¿æ¥ï¼Œå¦‚æœkeyåˆ†å¸ƒåœ¨ä¸åŒæœºå™¨ï¼Œéœ€è¦æŸ¥å¤šæ¬¡&lt;/p&gt;
&lt;p&gt;åº”å¯¹æ–¹æ¡ˆï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å‡å°‘ç½‘ç»œè¯·æ±‚ï¼Œèƒ½æ‰¹é‡æŸ¥å°½é‡æ‰¹é‡æŸ¥&lt;/li&gt;
&lt;li&gt;å°†keyè¿›è¡Œåˆ†ç±»ï¼Œå­˜åˆ°æŒ‡å®šèŠ‚ç‚¹ï¼ŒæŸ¥è¯¢åŒç±»çš„keyæ—¶åªéœ€è¦ç‰¹å®šçš„èŠ‚ç‚¹å»æŸ¥&lt;/li&gt;
&lt;li&gt;å¹¶å‘æŸ¥è¯¢&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;ç¼“å­˜æ±¡æŸ“&#34;&gt;ç¼“å­˜æ±¡æŸ“&lt;/h2&gt;
&lt;p&gt;ç°è±¡ï¼šå¯¹äºé‚£äº›è®¿é—®æ¬¡æ•°å¾ˆå°‘çš„æ•°æ®ï¼Œä¸€ç›´ç•™å­˜åœ¨ç¼“å­˜ä¸­ï¼Œå ç”¨ç¼“å­˜ç©ºé—´ã€‚&lt;/p&gt;
&lt;p&gt;åº”å¯¹æ–¹æ¡ˆï¼šRedisçš„æ·˜æ±°ç­–ç•¥ï¼Œä¸€èˆ¬ä¼šä½¿ç”¨LRUã€LFUã€TTLçš„æ·˜æ±°ç­–ç•¥ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä¸»åŠ¨æ›´æ–°ç¼“å­˜è¦æ³¨æ„çš„ç‚¹&#34;&gt;ä¸»åŠ¨æ›´æ–°ç¼“å­˜è¦æ³¨æ„çš„ç‚¹&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;ä¸æ¨èå…ˆæ›´æ–°ç¼“å­˜å†æ›´æ–°æ•°æ®åº“ï¼ˆä¹Ÿç§° Write Behind Caching æ¨¡å¼ï¼Œæ›´æ–°æ•°æ®æ—¶ï¼Œåªæ›´æ–°ç¼“å­˜ï¼Œå¼‚æ­¥ / åŒæ­¥ æ›´æ–°æ•°æ®åº“ï¼‰åŸå› æ˜¯æ•°æ®åº“æ“ä½œå¯èƒ½å¤±è´¥ï¼Œå¯¼è‡´ç¼“å­˜ä¸æ•°æ®åº“ä¸ä¸€è‡´ï¼›&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªæ¨¡å¼ä¹Ÿæœ‰ç‚¹åƒLinuxçš„PageCacheç®—æ³•ï¼Œå¥½å¤„æ˜¯å› ä¸ºç›´æ¥æ“ä½œå†…å­˜ï¼Œå¼‚æ­¥ï¼Œwrite backå¯ä»¥åˆå¹¶åŒä¸€ä¸ªæ•°æ®çš„å¤šæ¬¡æ“ä½œï¼ŒIOæ€§èƒ½æé«˜ï¼Œä½†å› ä¸ºè¦ä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼Œwrite backçš„å®ç°å°±ä¼šå¾ˆå¤æ‚ï¼Œå®ƒéœ€è¦çŸ¥é“å“ªäº›æ•°æ®è¢«æ›´æ–°äº†ï¼Œç„¶åè¿˜è¦æŒä¹…åŒ–åˆ°ç£ç›˜ä¸Šï¼Œæ¯”å¦‚æ“ä½œç³»ç»Ÿçš„write backä»…ä¼šåœ¨å½“è¿™ä¸ªç¼“å­˜éœ€è¦å¤±æ•ˆã€å†…å­˜ä¸å¤Ÿã€è¿›ç¨‹é€€å‡ºæ—¶ï¼Œæ‰ä¼šçœŸæ­£æŒä¹…åŒ–ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¸æ¨èå…ˆæ›´æ–°æ•°æ®åº“å†æ›´æ–°ç¼“å­˜ï¼ˆä¹Ÿç§° Write Through æ¨¡å¼ï¼‰ï¼ŒåŸå› æ˜¯å½“ABä¸¤ä¸ªæ“ä½œåŒæ—¶å†™ï¼Œä¸¤è€…çš„æ“ä½œé¡ºåºæ— æ³•ä¿è¯ï¼Œå¯¼è‡´æ•°æ®ä¸ä¸€è‡´ï¼Œå³å¹¶å‘å†™å¯¼è‡´è„æ•°æ®ï¼›å¦å¤–ï¼Œæ›´æ–°åˆ°ç¼“å­˜çš„æ•°æ®ä¹Ÿä¸ä¸€å®šè¢«è®¿é—®ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¸æ¨èå…ˆåˆ ç¼“å­˜å†æ›´æ–°æ•°æ®åº“ï¼Œè®¿é—®æ—¶å†è¿›è¡ŒåŠ è½½ï¼ŒåŸå› æ˜¯å¹¶å‘æƒ…å†µä¸‹ï¼Œåˆ é™¤ç¼“å­˜åæ¥ä¸åŠæ›´æ–°æ•°æ®åº“ï¼Œä½†æ—§å€¼å·²ç»è¢«å…¶ä»–çº¿ç¨‹è¯»åˆ°äº†ï¼Œæ›´æ–°åˆ°ç¼“å­˜äº†ï¼›æˆ–è€…æ•°æ®åº“æ“ä½œå¤±è´¥äº†ï¼Œä½†ç¼“å­˜å·²ç»æ²¡äº†ï¼Œå¯¼è‡´å…¶ä»–è¯·æ±‚è¿˜è¦å†è¯»ä¸€æ¬¡æ•°æ®åº“ï¼Œåº”å¯¹çš„æ–¹æ¡ˆæ˜¯å»¶è¿ŸåŒåˆ ï¼š&lt;code&gt;å…ˆåˆ ç¼“å­˜ -ã€‹æ›´æ–°æ•°æ®åº“ -ã€‹sleep -ã€‹å†åˆ é™¤ç¼“å­˜&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ¨èå…ˆæ›´æ–°æ•°æ®åº“å†åˆ é™¤ç¼“å­˜ï¼ˆä¹Ÿç§°ä¸ºCache Aside æ¨¡å¼ï¼‰ï¼Œè®¿é—®æ—¶å†è¿›è¡ŒåŠ è½½ï¼Œè™½ç„¶ä¹Ÿå¯èƒ½å‡ºç°3ä¸­çš„æƒ…å†µï¼Œæ¯”å¦‚è¯»ç¼“å­˜æ—¶ç¼“å­˜å¤±æ•ˆï¼Œç´§æ¥ç€ä¸€ä¸ªå¹¶å‘å†™æ“ä½œï¼Œå°±æœ‰å¯èƒ½å‡ºç°è¯»æ“ä½œè¦†ç›–äº†å†™æ“ä½œåçš„æ•°æ®æ›´æ–°ï¼Œå¯¼è‡´æ•°æ®ä¸ä¸€è‡´ï¼Œä½†å®é™…ä¸Šå‘ç”Ÿçš„æ¦‚ç‡ä¸å¤§ï¼Œå¸¦æ¥çš„å½±å“ä¼šç›¸å¯¹å°ä¸€äº›ï¼Œå› ä¸ºå†™æ“ä½œé€šå¸¸ä¼šæ¯”è¯»æ“ä½œæ…¢ï¼Œå†åŠ ä¸Šè¦é”è¡¨ï¼Œè€Œè¯»æ“ä½œå¿…é¡»åœ¨å†™æ“ä½œå‰è¿›å…¥æ•°æ®åº“æ“ä½œï¼Œè€Œåˆè¦æ™šäºå†™æ“ä½œæ›´æ–°ç¼“å­˜ï¼Œæ¡ä»¶å°±å¾ˆè‹›åˆ»äº†ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœåˆ é™¤ç¼“å­˜å¤±è´¥äº†ï¼Œå¯ä»¥å»¶è¿Ÿä»»åŠ¡è¿›è¡Œåˆ é™¤é‡è¯•ï¼Œå› ä¸ºåˆ é™¤æ“ä½œä¸€èˆ¬æ˜¯å¹‚ç­‰çš„ï¼Œæ‰€ä»¥å³ä½¿é‡å¤åˆ é™¤ä¹Ÿæ²¡å…³ç³»ï¼Œå¦å¤–ï¼Œç›¸æ¯”Read/Write Throughæ¨¡å¼ï¼ˆæ›´æ–°æ•°æ®åº“åæ›´æ–°ç¼“å­˜æ“ä½œï¼‰ï¼Œä¸ä¼šå› ä¸ºå¹¶å‘è¯»å†™äº§ç”Ÿè„æ•°æ®ã€‚è¿˜æœ‰ç”±äºä¼šåˆ é™¤ç¼“å­˜ï¼Œæ‰€ä»¥è¦æ³¨æ„ç¼“å­˜å‡»ç©¿é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;å¦å¤–ï¼Œå³ä½¿ä½¿ç”¨äº†å…ˆæ›´æ–°æ•°æ®åº“å†åˆ é™¤ç¼“å­˜çš„æ¨¡å¼ï¼Œåœ¨ä¸»ä»åŒæ­¥å»¶è¿Ÿçš„åœºæ™¯ä¹Ÿä¼šå¯¼è‡´ä¸ä¸€è‡´(å¯¹äºå…¶ä»–æ¨¡å¼ä¹Ÿæ˜¯)ï¼Œè§£å†³æ–¹æ¡ˆä»ç„¶æ˜¯å»¶è¿ŸåŒåˆ ï¼Œåªæ˜¯sleepçš„æ—¶é—´æœ€å¥½ç­‰äºå»¶è¿Ÿæ—¶é—´ï¼›&lt;/p&gt;
&lt;p&gt;å¦‚æœè¿˜è¦å¼ºä¸€è‡´ï¼Œå°±åªèƒ½ä½¿ç”¨2PCã€3PCã€Raftä¹‹ç±»çš„ä¸€è‡´æ€§åè®®æˆ–è€…åˆ†å¸ƒå¼é”ç­‰æ–¹æ¡ˆæ¥è§£å†³äº†ï¼Œä½†æ˜¯æ€§èƒ½å°±ä¿è¯ä¸äº†äº†ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¦å¤–çš„æ–¹æ¡ˆæ˜¯åˆ©ç”¨æ•°æ®åº“çš„èƒ½åŠ› + æ¶ˆæ¯é˜Ÿåˆ—çš„æ–¹å¼ï¼Œå¦‚æ ¹æ®MySQLçš„Bin logæ¥æ›´æ–°ç¼“å­˜ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/Redis%e7%bc%93%e5%ad%98%e6%96%b9%e6%a1%88%e6%93%8d%e4%bd%9c.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/Redis%e7%bc%93%e5%ad%98%e6%96%b9%e6%a1%88%e6%93%8d%e4%bd%9c.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			alt=&#34;Redisç¼“å­˜æ–¹æ¡ˆæ“ä½œ - æå®¢æ—¶é—´Redisæ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜&#34;&gt;
	&lt;/a&gt;
	
	&lt;figcaption&gt;Redisç¼“å­˜æ–¹æ¡ˆæ“ä½œ - æå®¢æ—¶é—´Redisæ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜&lt;/figcaption&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;h1 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h1&gt;
&lt;p&gt;æå®¢æ—¶é—´ - Redisæ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜ï¼šè®²å¾—å¾ˆä¸é”™ï¼Œæ¨èã€‚&lt;/p&gt;
&lt;p&gt;è¿˜æœ‰å…¶ä»–çœ‹è¿‡çš„åˆ«äººåšå®¢ï¼Œä½†æ˜¯å½“æ—¶å¿˜è®°æŠŠé“¾æ¥è´´ä¸‹æ¥ã€‚&lt;/p&gt;
</description>
        </item>
        <item>
        <title>etcdå’ŒZooKeeper</title>
        <link>http://nixum.cc/p/etcd%E5%92%8Czookeeper/</link>
        <pubDate>Wed, 23 Sep 2020 00:00:00 +0000</pubDate>
        
        <guid>http://nixum.cc/p/etcd%E5%92%8Czookeeper/</guid>
        <description>&lt;p&gt;[TOC]&lt;/p&gt;
&lt;h1 id=&#34;zookeeper&#34;&gt;ZooKeeper&lt;/h1&gt;
&lt;p&gt;ZooKeeperä¿è¯çš„æ˜¯CPï¼Œä¸ä¿è¯æ¯æ¬¡æœåŠ¡è¯·æ±‚çš„å¯ç”¨æ€§ï¼Œåœ¨æç«¯ç¯å¢ƒä¸‹ï¼ŒZooKeeperå¯èƒ½ä¼šä¸¢å¼ƒä¸€äº›è¯·æ±‚ï¼Œæ¶ˆè´¹è€…ç¨‹åºéœ€è¦é‡æ–°è¯·æ±‚æ‰èƒ½è·å¾—ç»“æœã€‚å¦å¤–åœ¨è¿›è¡Œleaderé€‰ä¸¾æ—¶é›†ç¾¤éƒ½æ˜¯ä¸å¯ç”¨ï¼Œæ‰€ä»¥è¯´ï¼ŒZooKeeperä¸èƒ½ä¿è¯æœåŠ¡å¯ç”¨æ€§ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä½¿ç”¨åœºæ™¯&#34;&gt;ä½¿ç”¨åœºæ™¯&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;é›†ç¾¤ç®¡ç†ï¼Œç›‘æ§èŠ‚ç‚¹å­˜æ´»çŠ¶æ€&lt;/li&gt;
&lt;li&gt;ä¸»èŠ‚ç‚¹é€‰ä¸¾ï¼Œå½“æœåŠ¡ä»¥master-salveæ¨¡å¼è¿›è¡Œéƒ¨ç½²ï¼Œå½“ä¸»èŠ‚ç‚¹æŒ‚æ‰åé€‰å‡ºæ–°çš„ä¸»èŠ‚ç‚¹&lt;/li&gt;
&lt;li&gt;æœåŠ¡å‘ç°&lt;/li&gt;
&lt;li&gt;åˆ†å¸ƒå¼é”ï¼Œæä¾›ç‹¬å é”ã€å…±äº«é”&lt;/li&gt;
&lt;li&gt;åˆ†å¸ƒå¼è‡ªå¢id&lt;/li&gt;
&lt;li&gt;æ­é…Kafkaã€dubboç­‰ä½¿ç”¨&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;ç‰¹ç‚¹&#34;&gt;ç‰¹ç‚¹&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;é¡ºåºä¸€è‡´æ€§ï¼šåŒä¸€å®¢æˆ·ç«¯å‘èµ·çš„äº‹åŠ¡è¯·æ±‚ï¼Œæœ€ç»ˆå°†ä¼šä¸¥æ ¼åœ°æŒ‰ç…§é¡ºåºè¢«åº”ç”¨åˆ° ZooKeeper ä¸­å»ã€‚&lt;/li&gt;
&lt;li&gt;åŸå­æ€§ï¼šæ‰€æœ‰äº‹åŠ¡è¯·æ±‚çš„å¤„ç†ç»“æœåœ¨æ•´ä¸ªé›†ç¾¤ä¸­æ‰€æœ‰æœºå™¨ä¸Šçš„åº”ç”¨æƒ…å†µæ˜¯ä¸€è‡´çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¦ä¹ˆæ•´ä¸ªé›†ç¾¤ä¸­æ‰€æœ‰çš„æœºå™¨éƒ½æˆåŠŸåº”ç”¨äº†æŸä¸€ä¸ªäº‹åŠ¡ï¼Œè¦ä¹ˆéƒ½æ²¡æœ‰åº”ç”¨ã€‚&lt;/li&gt;
&lt;li&gt;å•ä¸€ç³»ç»Ÿæ˜ åƒï¼šæ— è®ºå®¢æˆ·ç«¯è¿åˆ°å“ªä¸€ä¸ª ZooKeeper æœåŠ¡å™¨ä¸Šï¼Œå…¶çœ‹åˆ°çš„æœåŠ¡ç«¯æ•°æ®æ¨¡å‹éƒ½æ˜¯ä¸€è‡´çš„ã€‚&lt;/li&gt;
&lt;li&gt;å¯é æ€§ï¼šä¸€æ—¦ä¸€æ¬¡æ›´æ”¹è¯·æ±‚è¢«åº”ç”¨ï¼Œæ›´æ”¹çš„ç»“æœå°±ä¼šè¢«æŒä¹…åŒ–ï¼Œç›´åˆ°è¢«ä¸‹ä¸€æ¬¡æ›´æ”¹è¦†ç›–ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;æ•°æ®æ¨¡å‹&#34;&gt;æ•°æ®æ¨¡å‹&lt;/h2&gt;
&lt;p&gt;ç±»ä¼¼æ–‡ä»¶ç³»ç»Ÿï¼Œæ ¹èŠ‚ç‚¹ä¸º / ï¼Œæ¯åˆ›å»ºä¸€ä¸ªèŠ‚ç‚¹ä¼šä»æ ¹èŠ‚ç‚¹å¼€å§‹æŒ‚ï¼Œæ ‘å½¢ç»“æ„ï¼Œæ¯ä¸ªæ•°æ®èŠ‚ç‚¹ç§°ä¸ºznodeï¼Œå¯ä»¥å­˜å‚¨æ•°æ®ï¼Œæ¯ä¸ªznodeè¿˜æœ‰è‡ªå·±æ‰€å±çš„èŠ‚ç‚¹ç±»å‹å’ŒèŠ‚ç‚¹çŠ¶æ€&lt;/p&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;æŒä¹…èŠ‚ç‚¹ï¼šä¸€æ—¦åˆ›å»ºå°±ä¸€ç›´å­˜åœ¨ï¼Œç›´åˆ°å°†å…¶åˆ é™¤ã€‚&lt;/li&gt;
&lt;li&gt;æŒä¹…é¡ºåºèŠ‚ç‚¹ï¼šä¸€ä¸ªçˆ¶èŠ‚ç‚¹å¯ä»¥ä¸ºå…¶å­èŠ‚ç‚¹ &lt;strong&gt;ç»´æŠ¤ä¸€ä¸ªåˆ›å»ºçš„å…ˆåé¡ºåº&lt;/strong&gt; ï¼Œè¿™ä¸ªé¡ºåºä½“ç°åœ¨ &lt;strong&gt;èŠ‚ç‚¹åç§°&lt;/strong&gt; ä¸Šï¼Œæ˜¯èŠ‚ç‚¹åç§°åè‡ªåŠ¨æ·»åŠ ä¸€ä¸ªç”± 10 ä½æ•°å­—ç»„æˆçš„æ•°å­—ä¸²ï¼Œä» 0 å¼€å§‹è®¡æ•°ã€‚&lt;/li&gt;
&lt;li&gt;ä¸´æ—¶èŠ‚ç‚¹ï¼šä¸´æ—¶èŠ‚ç‚¹çš„ç”Ÿå‘½å‘¨æœŸæ˜¯ä¸ &lt;strong&gt;å®¢æˆ·ç«¯ä¼šè¯&lt;/strong&gt; ç»‘å®šçš„ï¼Œ&lt;strong&gt;ä¼šè¯æ¶ˆå¤±åˆ™èŠ‚ç‚¹æ¶ˆå¤±&lt;/strong&gt; ã€‚ä¸´æ—¶èŠ‚ç‚¹ &lt;strong&gt;åªèƒ½åšå¶å­èŠ‚ç‚¹&lt;/strong&gt; ï¼Œä¸èƒ½åˆ›å»ºå­èŠ‚ç‚¹ã€‚&lt;/li&gt;
&lt;li&gt;ä¸´æ—¶é¡ºåºèŠ‚ç‚¹ï¼šçˆ¶èŠ‚ç‚¹å¯ä»¥åˆ›å»ºä¸€ä¸ªç»´æŒäº†é¡ºåºçš„ä¸´æ—¶èŠ‚ç‚¹(å’Œå‰é¢çš„æŒä¹…é¡ºåºæ€§èŠ‚ç‚¹ä¸€æ ·)ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;zabåè®®&#34;&gt;ZABåè®®&lt;/h2&gt;
&lt;p&gt;é€šè¿‡ZABåè®®ä¿è¯æ³¨å†Œåˆ°ZooKeeperä¸Šçš„ä¸»ä»èŠ‚ç‚¹çŠ¶æ€åŒæ­¥ï¼Œè¯¥åè®®æœ‰ä¸¤ç§æ¨¡å¼&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å´©æºƒæ¢å¤&lt;/p&gt;
&lt;p&gt;å½“æ•´ä¸ª Zookeeper é›†ç¾¤åˆšåˆšå¯åŠ¨æˆ–è€…LeaderæœåŠ¡å™¨å®•æœºã€é‡å¯æˆ–è€…ç½‘ç»œæ•…éšœå¯¼è‡´&lt;strong&gt;ä¸å­˜åœ¨è¿‡åŠçš„æœåŠ¡å™¨ä¸ Leader æœåŠ¡å™¨ä¿æŒæ­£å¸¸é€šä¿¡æ—¶ï¼Œæ‰€æœ‰æœåŠ¡å™¨è¿›å…¥å´©æºƒæ¢å¤æ¨¡å¼&lt;/strong&gt;ï¼Œé¦–å…ˆé€‰ä¸¾äº§ç”Ÿæ–°çš„ Leader æœåŠ¡å™¨ï¼Œç„¶åé›†ç¾¤ä¸­ Follower æœåŠ¡å™¨å¼€å§‹ä¸æ–°çš„ Leader æœåŠ¡å™¨è¿›è¡Œæ•°æ®åŒæ­¥ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ¶ˆæ¯å¹¿æ’­&lt;/p&gt;
&lt;p&gt;å½“é›†ç¾¤ä¸­è¶…è¿‡åŠæ•°æœºå™¨ä¸è¯¥ Leader æœåŠ¡å™¨å®Œæˆæ•°æ®åŒæ­¥ä¹‹åï¼Œé€€å‡ºæ¢å¤æ¨¡å¼è¿›å…¥æ¶ˆæ¯å¹¿æ’­æ¨¡å¼ï¼ŒLeader æœåŠ¡å™¨å¼€å§‹æ¥æ”¶å®¢æˆ·ç«¯çš„äº‹åŠ¡è¯·æ±‚ç”Ÿæˆäº‹ç‰©ææ¡ˆï¼ˆè¶…è¿‡åŠæ•°åŒæ„ï¼‰æ¥è¿›è¡Œäº‹åŠ¡è¯·æ±‚å¤„ç†ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;é€‰ä¸¾ç®—æ³•å’Œæµç¨‹&#34;&gt;é€‰ä¸¾ç®—æ³•å’Œæµç¨‹&lt;/h3&gt;
&lt;p&gt;ZooKeeperé›†ç¾¤æœºå™¨è¦æ±‚è‡³å°‘ä¸‰å°æœºå™¨ï¼Œæœºå™¨çš„è§’è‰²åˆ†ä¸ºLeaderã€Followerã€Observerï¼›å½“ Leader æœåŠ¡å™¨å‡ºç°ç½‘ç»œä¸­æ–­ã€å´©æºƒé€€å‡ºä¸é‡å¯ç­‰å¼‚å¸¸æƒ…å†µæ—¶ï¼ŒZAB åè®®å°±ä¼šè¿›å…¥æ¢å¤æ¨¡å¼å¹¶é€‰ä¸¾äº§ç”Ÿæ–°çš„LeaderæœåŠ¡å™¨ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Leaderé€‰ä¸¾ï¼šèŠ‚ç‚¹åœ¨ä¸€å¼€å§‹éƒ½å¤„äºé€‰ä¸¾é˜¶æ®µï¼Œä¸€ä¸ªèŠ‚ç‚¹åªè¦æ±‚è·å¾—åŠæ•°ä»¥ä¸ŠæŠ•ç¥¨ï¼Œå°±å¯ä»¥å½“é€‰ä¸ºå‡†Leaderï¼›&lt;/li&gt;
&lt;li&gt;Discoveryå‘ç°ï¼šå‡†Leaderæ”¶é›†å…¶ä»–èŠ‚ç‚¹çš„æ•°æ®ï¼ŒåŒæ­¥ Followers æœ€è¿‘æ¥æ”¶çš„æ•°æ®ï¼Œå¹¶å°†æœ€æ–°çš„æ•°æ®å¤åˆ¶åˆ°è‡ªèº«ï¼›&lt;/li&gt;
&lt;li&gt;SynchronizationåŒæ­¥ï¼šå‡†Leaderå°†è‡ªèº«æœ€æ–°æ•°æ®åŒæ­¥ç»™å…¶ä»–è½åçš„FollowerèŠ‚ç‚¹ï¼ŒåŒæ­¥å®Œæˆåï¼Œå‘ŠçŸ¥å…¶ä»–èŠ‚ç‚¹è‡ªå·±æ­£å¼å½“é€‰ä¸ºLeaderï¼›&lt;/li&gt;
&lt;li&gt;Broadcastå¹¿æ’­ï¼šLeaderæ­£å¼å¯¹å¤–æœåŠ¡ï¼Œå¤„ç†clientè¯·æ±‚ï¼Œå¯¹æ¶ˆæ¯è¿›è¡Œå¹¿æ’­ï¼Œå½“æ”¶åˆ°ä¸€ä¸ªå†™è¯·æ±‚åï¼Œä¼šç”ŸæˆProposalå¹¿æ’­ç»™å„ä¸ªFollowerèŠ‚ç‚¹ï¼Œä¸€åŠä»¥ä¸ŠFollowerèŠ‚ç‚¹åº”ç­”åï¼ŒLeaderå†å‘é€Commitå‘½ä»¤ç»™å„ä¸ªFollowerï¼Œå‘ŠçŸ¥ä»–ä»¬æäº¤ç›¸å…³ææ¡ˆã€‚å¦‚æœæœ‰æ–°çš„èŠ‚ç‚¹åŠ å…¥ï¼Œè¿˜éœ€è¦å¯¹æ–°èŠ‚ç‚¹è¿›è¡ŒåŒæ­¥ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;é»˜è®¤ä½¿ç”¨FastLeaderElectionç®—æ³•ï¼Œæ¯”å¦‚ç°åœ¨æœ‰5å°æœåŠ¡å™¨ï¼Œæ¯å°æœåŠ¡å™¨å‡æ²¡æœ‰æ•°æ®ï¼Œå®ƒä»¬çš„ç¼–å·åˆ†åˆ«æ˜¯1, 2, 3, 4, 5æŒ‰ç¼–å·ä¾æ¬¡å¯åŠ¨ï¼Œå®ƒä»¬çš„é€‰æ‹©ä¸¾è¿‡ç¨‹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æœåŠ¡å™¨1å¯åŠ¨ï¼Œç»™è‡ªå·±æŠ•ç¥¨ï¼Œç„¶åå‘æŠ•ç¥¨ä¿¡æ¯ï¼Œç”±äºå…¶å®ƒæœºå™¨è¿˜æ²¡æœ‰å¯åŠ¨æ‰€ä»¥å®ƒæ”¶ä¸åˆ°åé¦ˆä¿¡æ¯ï¼ŒæœåŠ¡å™¨1çš„çŠ¶æ€ä¸€ç›´å±äºLookingã€‚&lt;/li&gt;
&lt;li&gt;æœåŠ¡å™¨2å¯åŠ¨ï¼Œç»™è‡ªå·±æŠ•ç¥¨ï¼ŒåŒæ—¶ä¸ä¹‹å‰å¯åŠ¨çš„æœåŠ¡å™¨1äº¤æ¢ç»“æœï¼Œç”±äºæœåŠ¡å™¨2çš„ç¼–å·å¤§æ‰€ä»¥æœåŠ¡å™¨2èƒœå‡ºï¼Œä½†æ­¤æ—¶æŠ•ç¥¨æ•°æ²¡æœ‰å¤§äºåŠæ•°ï¼Œæ‰€ä»¥ä¸¤ä¸ªæœåŠ¡å™¨çš„çŠ¶æ€ä¾ç„¶æ˜¯Lookingã€‚&lt;/li&gt;
&lt;li&gt;æœåŠ¡å™¨3å¯åŠ¨ï¼Œç»™è‡ªå·±æŠ•ç¥¨ï¼ŒåŒæ—¶ä¸ä¹‹å‰å¯åŠ¨çš„æœåŠ¡å™¨1,2äº¤æ¢ä¿¡æ¯ï¼Œç”±äºæœåŠ¡å™¨3çš„ç¼–å·æœ€å¤§æ‰€ä»¥æœåŠ¡å™¨3èƒœå‡ºï¼Œæ­¤æ—¶æŠ•ç¥¨æ•°æ­£å¥½å¤§äºåŠæ•°ï¼Œæ‰€ä»¥æœåŠ¡å™¨3æˆä¸ºleaderï¼ŒæœåŠ¡å™¨1,2æˆä¸ºFollowerã€‚&lt;/li&gt;
&lt;li&gt;æœåŠ¡å™¨4å¯åŠ¨ï¼Œç»™è‡ªå·±æŠ•ç¥¨ï¼ŒåŒæ—¶ä¸ä¹‹å‰å¯åŠ¨çš„æœåŠ¡å™¨1,2,3äº¤æ¢ä¿¡æ¯ï¼Œå°½ç®¡æœåŠ¡å™¨4çš„ç¼–å·å¤§ï¼Œä½†ä¹‹å‰æœåŠ¡å™¨3å·²ç»èƒœå‡ºï¼Œæ‰€ä»¥æœåŠ¡å™¨4åªèƒ½æˆä¸ºFollowerã€‚&lt;/li&gt;
&lt;li&gt;æœåŠ¡å™¨5å¯åŠ¨ï¼Œåé¢çš„é€»è¾‘åŒæœåŠ¡å™¨4æˆä¸ºFollowerã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;é€šçŸ¥æœºåˆ¶&#34;&gt;é€šçŸ¥æœºåˆ¶&lt;/h2&gt;
&lt;p&gt;å®¢æˆ·ç«¯ä¼šå¯¹æŸä¸ªznodeå»ºç«‹ä¸€ä¸ªwatcheräº‹ä»¶ï¼Œå½“è¯¥znodeå‘ç”Ÿå˜åŒ–æ—¶ï¼Œè¿™äº›å®¢æˆ·ç«¯ä¼šæ”¶åˆ°ZooKeeperçš„é€šçŸ¥ï¼Œç„¶åå®¢æˆ·ç«¯æ ¹æ®znodeçš„å˜åŒ–æ¥åšå‡ºç›¸åº”çš„æ”¹å˜ï¼Œç±»ä¼¼è§‚å¯Ÿè€…æ¨¡å¼&lt;/p&gt;
&lt;h1 id=&#34;etcd&#34;&gt;ETCD&lt;/h1&gt;
&lt;h2 id=&#34;æ€»ä½“&#34;&gt;æ€»ä½“&lt;/h2&gt;
&lt;p&gt;æ˜¯ä¸€ä¸ªCPç³»ç»Ÿï¼Œåˆ†ä¸ºä¸‰ä¸ªç‰ˆæœ¬ï¼ŒV1ã€V2å’ŒV3&lt;/p&gt;
&lt;p&gt;å…±è¯†ç®—æ³•ä½¿ç”¨Raftã€‚å°†å¤æ‚çš„ä¸€è‡´æ€§é—®é¢˜åˆ†è§£æˆLeaderé€‰ä¸¾ã€æ—¥å¿—åŒæ­¥ã€å®‰å…¨æ€§ä¸‰ä¸ªç‹¬ç«‹å­é—®é¢˜ï¼Œåªæœ‰é›†ç¾¤ä¸€åŠä»¥ä¸ŠèŠ‚ç‚¹å­˜æ´»å³å¯æä¾›æœåŠ¡ï¼Œå…·å¤‡è‰¯å¥½å¯ç”¨æ€§ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/ETCD%e6%9e%b6%e6%9e%84.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/ETCD%e6%9e%b6%e6%9e%84.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;etcdctlæ”¯æŒè´Ÿè½½å‡è¡¡ã€å¥åº·æ£€æµ‹ã€æ•…éšœè½¬ç§»ï¼Œ3.4ç‰ˆæœ¬ä¸­è´Ÿè½½å‡è¡¡ä½¿ç”¨è½®è¯¢ç®—æ³•ï¼Œè½®è¯¢endpointsçš„æ¯ä¸ªèŠ‚ç‚¹å»ºç«‹é•¿è¿æ¥ï¼Œå°†è¯·æ±‚å‘é€ç»™etcd serverã€‚clientå’Œserverä¹‹é—´ä½¿ç”¨HTTP/2.0åè®®é€šä¿¡ã€‚&lt;/p&gt;
&lt;p&gt;etcd serveråœ¨å¤„ç†ä¸€ä¸ªè¯·æ±‚æ—¶ä¼šå…ˆå°†ä¸€ç³»åˆ—çš„æ‹¦æˆªå™¨ä¸²è”æˆä¸€ä¸ªæ‰§è¡Œï¼Œå¸¸è§çš„æ‹¦æˆªå™¨æœ‰debugæ—¥å¿—ã€metricsç»Ÿè®¡ã€etcd learnerèŠ‚ç‚¹è¯·æ±‚æ¥å£å’Œå‚æ•°é™åˆ¶ç­‰èƒ½åŠ›ï¼Œå¦å¤–è¿˜è¦æ±‚æ‰§è¡Œä¸€ä¸ªæ“ä½œå‰é›†ç¾¤å¿…é¡»æœ‰Leaderï¼Œè‹¥è¯·æ±‚å»¶æ—¶è¶…è¿‡æŒ‡å®šé˜ˆå€¼ï¼Œä¼šæ‰“å°æ¥æºIPçš„æ…¢æŸ¥è¯¢æ—¥å¿—ã€‚&lt;/p&gt;
&lt;h3 id=&#34;v2ç‰ˆæœ¬&#34;&gt;V2ç‰ˆæœ¬&lt;/h3&gt;
&lt;p&gt;æ•°æ®æ¨¡å‹å‚è€ƒZooKeeperï¼Œä½¿ç”¨åŸºäºç›®å½•çš„å±‚æ¬¡æ¨¡å¼ï¼Œä½¿ç”¨Restful é£æ ¼çš„APIï¼Œæä¾›å¸¸ç”¨çš„Get/Set/Delete/Watchç­‰APIï¼Œå®ç°å¯¹key-valueæ•°æ®çš„æŸ¥è¯¢ã€æ›´æ–°ã€åˆ é™¤ã€ç›‘å¬ç­‰æ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;Keyâ€”Valueå­˜å‚¨ä¸Šä½¿ç”¨ç®€å•å†…å­˜æ ‘ï¼Œä¸€ä¸ªèŠ‚ç‚¹åŒ…å«èŠ‚ç‚¹è·¯å¾„ã€çˆ¶äº²èŠ‚ç‚¹ã€å­©å­èŠ‚ç‚¹ã€è¿‡æœŸæ—¶é—´ã€Valueçš„å€¼ï¼Œæ˜¯å…¸å‹çš„ä½å®¹é‡è®¾è®¡ï¼Œæ•°æ®å…¨æ”¾å†…å­˜ï¼Œæ— éœ€è€ƒè™‘æ•°æ®åˆ†ç‰‡ï¼Œåªä¿å­˜Keyçš„æœ€æ–°ç‰ˆæœ¬ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨Kubernetesä¸­çš„ä½¿ç”¨åœºæ™¯ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ä½¿ç”¨Kuberneteså£°æ˜å¼APIéƒ¨ç½²æœåŠ¡çš„æ—¶å€™ï¼ŒKubernetes çš„æ§åˆ¶å™¨é€šè¿‡etcd Watch æœºåˆ¶ï¼Œä¼šå®æ—¶ç›‘å¬èµ„æºå˜åŒ–äº‹ä»¶ï¼Œå¯¹æ¯”å®é™…çŠ¶æ€ä¸æœŸæœ›çŠ¶æ€æ˜¯å¦ä¸€è‡´ï¼Œå¹¶é‡‡å–åè°ƒåŠ¨ä½œä½¿å…¶ä¸€è‡´ã€‚Kubernetes æ›´æ–°æ•°æ®çš„æ—¶å€™ï¼Œé€šè¿‡CAS æœºåˆ¶ä¿è¯å¹¶å‘åœºæ™¯ä¸‹çš„åŸå­æ›´æ–°ï¼Œå¹¶é€šè¿‡å¯¹key è®¾ç½®TTLæ¥å­˜å‚¨Eventäº‹ä»¶ï¼Œæå‡Kubernetes é›†ç¾¤çš„å¯è§‚æµ‹æ€§ï¼ŒåŸºäºTTLç‰¹æ€§ï¼ŒEventäº‹ä»¶keyåˆ°æœŸåå¯è‡ªåŠ¨åˆ é™¤ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ç¼ºç‚¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åŠŸèƒ½å±€é™ï¼šä¸æ”¯æŒèŒƒå›´æŸ¥è¯¢ã€åˆ†é¡µæŸ¥è¯¢ã€å¤škeyäº‹åŠ¡&lt;/li&gt;
&lt;li&gt;Watchæœºåˆ¶å¯é æ€§é—®é¢˜ï¼šV2æ˜¯å†…å­˜å‹ï¼Œä¸ä¿å­˜keyå†å²ç‰ˆæœ¬çš„æ•°æ®åº“ï¼Œåªåœ¨å†…å­˜ä¸­ä½¿ç”¨æ»‘åŠ¨çª—å£ä¿å­˜æœ€è¿‘1000æ¡å˜æ›´äº‹ä»¶ï¼Œå½“å†™è¯·æ±‚æ¯”è¾ƒå¤šã€ç½‘ç»œæ³¢åŠ¨ç­‰å®¹æ˜“äº§ç”Ÿäº‹ä»¶ä¸¢å¤±é—®é¢˜&lt;/li&gt;
&lt;li&gt;æ€§èƒ½é—®é¢˜ï¼šä½¿ç”¨HTTP/1.xåè®®ï¼Œå½“è¯·æ±‚å“åº”è¾ƒå¤§æ—¶æ— æ³•è¿›è¡Œå‹ç¼©ï¼›Jsonè§£ææ¶ˆè€—CPUï¼›å½“watcherè¾ƒå¤šæ—¶ï¼Œç”±äºä¸æ”¯æŒå¤šè·¯å¤ç”¨ï¼Œä¼šåˆ›å»ºå¤§é‡çš„è¿æ¥ï¼›å¤§é‡çš„TTLä¸€æ ·ä¹Ÿéœ€è¦ä¸ºæ¯ä¸ªkeyå‘èµ·ç»­æœŸï¼Œæ— æ³•æ‰¹é‡æ“ä½œ&lt;/li&gt;
&lt;li&gt;å†…å­˜å¼€é”€é—®é¢˜ï¼šç®€å•å†…å­˜æ ‘ä¿å­˜keyå’Œvalueï¼Œé‡å¤§æ—¶ä¼šå¯¼è‡´è¾ƒå¤§çš„å†…å­˜å¼€é”€ï¼Œä¿è¯å¯é è¿˜éœ€è¦å…¨é‡å†…å­˜æ ‘æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œæ¶ˆè€—å¤§é‡CPUå’Œç£ç›˜IO&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;v3ç‰ˆæœ¬&#34;&gt;V3ç‰ˆæœ¬&lt;/h3&gt;
&lt;p&gt;ä¸ºäº†è§£å†³V2ç‰ˆæœ¬çš„ç¼ºç‚¹ï¼Œæ‰è¯ç”Ÿäº†V3ç‰ˆæœ¬&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;åœ¨å†…å­˜å¼€é”€ã€Watch äº‹ä»¶å¯é æ€§ã€åŠŸèƒ½å±€é™ä¸Šï¼Œå®ƒé€šè¿‡å¼•å…¥B-treeã€ boltdb å®ç°ä¸€ä¸ªMVCCæ•°æ®åº“ï¼Œæ•°æ®æ¨¡å‹ä»å±‚æ¬¡å‹ç›®å½•ç»“æ„æ”¹æˆæ‰å¹³çš„key-valueï¼Œæä¾›ç¨³å®šå¯é çš„äº‹ä»¶é€šçŸ¥ï¼Œå®ç°äº†äº‹åŠ¡ï¼Œæ”¯æŒå¤škeyåŸå­æ›´æ–°ï¼ŒåŒæ—¶åŸºäºboltdbçš„æŒä¹…åŒ–å­˜å‚¨ï¼Œæ˜¾è‘—é™ä½äº†etcd çš„å†…å­˜å ç”¨ã€é¿å…äº†etcd v2 å®šæœŸç”Ÿæˆå¿«ç…§æ—¶çš„æ˜‚è´µçš„èµ„æºå¼€é”€ã€‚&lt;/p&gt;
&lt;p&gt;æ€§èƒ½ä¸Šï¼Œé¦–å…ˆetcd v3 ä½¿ç”¨äº† gRPC APIï¼Œä½¿ç”¨protobuf å®šä¹‰æ¶ˆæ¯ï¼Œæ¶ˆæ¯ç¼–è§£ç æ€§èƒ½ç›¸æ¯”JSON è¶…è¿‡2å€ä»¥ä¸Šï¼Œå¹¶é€šè¿‡ HTTP/ 2.0 å¤šè·¯å¤ç”¨æœºåˆ¶ï¼Œå‡å°‘äº†å¤§é‡ watcher ç­‰åœºæ™¯ä¸‹çš„è¿æ¥æ•°ã€‚&lt;/p&gt;
&lt;p&gt;å…¶æ¬¡ä½¿ç”¨ Leaseä¼˜åŒ–TTLæœºåˆ¶ï¼Œæ¯ä¸ªLeaseå…·æœ‰ä¸€ ä¸ª TTLï¼Œç›¸åŒçš„TTL çš„keyå…³è”ä¸€ ä¸ªLeaseï¼ŒLeaseè¿‡æœŸçš„æ—¶å€™è‡ªåŠ¨åˆ é™¤ç›¸å…³è”çš„æ‰€æœ‰keyï¼Œä¸å†éœ€è¦ä¸ºæ¯ä¸ªkeyå•ç‹¬ç»­æœŸã€‚&lt;/p&gt;
&lt;p&gt;æœ€åæ˜¯etcd v3æ”¯æŒèŒƒå›´ã€åˆ†é¡µæŸ¥è¯¢ï¼Œå¯é¿å…å¤§åŒ…ç­‰ expensive requestã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;åº”ç”¨&#34;&gt;åº”ç”¨&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;æœåŠ¡å‘ç°&lt;/li&gt;
&lt;li&gt;æ¶ˆæ¯å‘å¸ƒè®¢é˜…ï¼Œåˆ©ç”¨Watcheræœºåˆ¶&lt;/li&gt;
&lt;li&gt;è´Ÿè½½å‡è¡¡&lt;/li&gt;
&lt;li&gt;åˆ†å¸ƒå¼é”ï¼šæ”¯æŒç‹¬å é”å’Œé¡ºåºé”&lt;/li&gt;
&lt;li&gt;é›†ç¾¤ç›‘æ§å’ŒLeaderé€‰ä¸¾&lt;/li&gt;
&lt;li&gt;é…ç½®å­˜å‚¨&lt;/li&gt;
&lt;li&gt;å„ç§è¯»å¤šå†™å°‘çš„åœºæ™¯&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;è¯»æ“ä½œ&#34;&gt;è¯»æ“ä½œ&lt;/h2&gt;
&lt;p&gt;å®¢æˆ·ç«¯é€šè¿‡etcdctlå‘é€getè¯·æ±‚&lt;code&gt;etcdctl get [keyåç§°] --endpoints [å¤šä¸ªetcdèŠ‚ç‚¹åœ°å€]&lt;/code&gt;ï¼Œetcdctlé€šè¿‡è´Ÿè½½å‡è¡¡ç®—æ³•é€‰æ‹©ä¸€ä¸ªetcdèŠ‚ç‚¹ï¼Œå‘èµ·gRpcè°ƒç”¨ï¼Œetcd serveræ”¶åˆ°è¯·æ±‚åç»è¿‡ä¸€ç³»åˆ—gRpcæ‹¦æˆªå™¨åï¼Œè¿›å…¥KV Serveræ¨¡å—ã€‚ä¹‹åæ ¹æ®è¯»çš„è¡Œä¸ºï¼Œè¿›è¡Œå¯¹åº”çš„æ“ä½œ&lt;/p&gt;
&lt;p&gt;è¯»æ“ä½œä¹‹å‰ï¼Œå¦‚æœæœ‰ä¸€ä¸ªå†™æ“ä½œï¼šclientå‘å‡ºä¸€ä¸ªå†™è¯·æ±‚åï¼Œè‹¥Leaderæ”¶åˆ°å†™è¯·æ±‚ï¼Œä¼šå°†æ­¤è¯·æ±‚æŒä¹…åŒ–åˆ°WALæ—¥å¿—ï¼Œå¹¶ä¼ æ’­åˆ°å„ä¸ªèŠ‚ç‚¹ï¼Œè‹¥ä¸€åŠä»¥ä¸Šçš„èŠ‚ç‚¹æŒä¹…åŒ–æˆåŠŸï¼Œåˆ™è¯¥è¯·æ±‚å¯¹åº”çš„æ—¥å¿—æ¡ç›®è¢«æ ‡è¯†ä¸ºå·²æäº¤ï¼Œetcd serveræ¨¡å—å¼‚æ­¥ä»Raftæ¨¡å—è·å–å·²æäº¤çš„æ—¥å¿—ï¼Œåº”ç”¨åˆ°çŠ¶æ€æœº(boltdbç­‰)ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ä¸²è¡Œè¯»&#34;&gt;ä¸²è¡Œè¯»&lt;/h3&gt;
&lt;p&gt;ç›´æ¥è¯»çŠ¶æ€æœºï¼ˆboltdbç­‰ï¼‰çš„æ•°æ®è¿”å›ï¼Œæ— éœ€é€šè¿‡Raftåè®®ä¸é›†ç¾¤è¿›è¡Œäº¤äº’çš„æ¨¡å¼ï¼Œå¯èƒ½ä¼šè¯»åˆ°æ—§æ•°æ®ã€‚å³ï¼šå†™è¯·æ±‚å¹¿æ’­åˆ°å„ä¸ªèŠ‚ç‚¹ï¼Œä½†ä¸²è¡Œè¯»å¯èƒ½è¯»åˆ°æŸä¸ªè¿˜æ²¡è¿›è¡Œå†™è¯·æ±‚æäº¤çš„èŠ‚ç‚¹(ä½†å¯èƒ½å…¶ä»–èŠ‚ç‚¹å·²æäº¤)ï¼Œä»è€Œè¯»åˆ°æ—§æ•°æ®ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ç§è¯»å–æ–¹å¼ä½å»¶æ—¶ï¼Œé«˜ååï¼Œé€‚ç”¨äºè¯»å–æ•°æ®æ•æ„Ÿåº¦ä½ã€å¯¹æ•°æ®ä¸€è‡´æ€§è¦æ±‚ä¸é«˜çš„åœºæ™¯ã€‚&lt;/p&gt;
&lt;h3 id=&#34;çº¿æ€§è¯»é»˜è®¤&#34;&gt;çº¿æ€§è¯»ï¼ˆé»˜è®¤ï¼‰&lt;/h3&gt;
&lt;p&gt;ä¸€æ—¦ä¸€ä¸ªå€¼æ›´æ–°æˆåŠŸåï¼ˆæŒ‡æœ‰è¶…è¿‡åŠæ•°èŠ‚ç‚¹æ›´æ–°æäº¤æˆåŠŸï¼‰ï¼Œä»»ä½•çº¿æ€§è¯»çš„clientéƒ½èƒ½åŠæ—¶è®¿é—®åˆ°ã€‚&lt;/p&gt;
&lt;h4 id=&#34;readindexä¿è¯æ•°æ®ä¸€è‡´æ€§&#34;&gt;ReadIndexï¼šä¿è¯æ•°æ®ä¸€è‡´æ€§&lt;/h4&gt;
&lt;ol&gt;
&lt;li&gt;èŠ‚ç‚¹Cæ”¶åˆ°ä¸€ä¸ªçº¿æ€§è¯»è¯·æ±‚åï¼Œé¦–å…ˆä¼šä»Leaderè·å–é›†ç¾¤æœ€æ–°çš„å·²æäº¤çš„æ—¥å¿—ç´¢å¼•(committed index)ï¼›&lt;/li&gt;
&lt;li&gt;Leaderæ”¶åˆ°ReadIndexè¯·æ±‚åï¼Œä¸ºé˜²æ­¢è„‘è£‚å¼‚å¸¸ï¼Œä¼šå‘å„ä¸ªFollowerèŠ‚ç‚¹å‘é€å¿ƒè·³ç¡®è®¤ï¼Œå¾…ä¸€åŠä»¥ä¸ŠèŠ‚ç‚¹ç¡®è®¤Leaderèº«ä»½åï¼Œæ‰èƒ½å°†å·²æäº¤çš„ç´¢å¼•(committed index))è¿”å›ç»™èŠ‚ç‚¹Cã€‚&lt;/li&gt;
&lt;li&gt;CèŠ‚ç‚¹ç»§ç»­ç­‰å¾…ï¼Œç›´åˆ°çŠ¶æ€æœºä¸Šå·²åº”ç”¨ç´¢å¼•(applied index)å¤§äºç­‰äºLeaderçš„å·²æäº¤ç´¢å¼•(committed index)æ—¶ï¼Œé€šçŸ¥è¯»è¯·æ±‚ï¼Œæ•°æ®å·²èµ¶ä¸ŠLeaderï¼Œå¯ä»¥ä»çŠ¶æ€æœºä¸­è®¿é—®æ•°æ®&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æ—¢ç„¶FollowerèŠ‚ç‚¹éƒ½å·²ç»å‘é€ReadIndexè¯·æ±‚äº†ï¼Œä¸ºå•¥ä¸ç›´æ¥æŠŠè¯»è¯·æ±‚è½¬å‘ç»™Leaderï¼ŸåŸå› æ˜¯ReadIndexæ¯”è¾ƒè½»é‡ï¼Œè€Œè¯»è¯·æ±‚ä¸è½»ï¼Œå¤§é‡çš„è¯»è¯·æ±‚ä¼šé€ æˆLeaderèŠ‚ç‚¹æœ‰æ¯”è¾ƒå¤§çš„è´Ÿè½½ã€‚&lt;/p&gt;
&lt;h4 id=&#34;mvccæ”¯æŒkeyå¤šå†å²ç‰ˆæœ¬å¤šäº‹åŠ¡åŠŸèƒ½&#34;&gt;MVCCï¼šæ”¯æŒKeyå¤šå†å²ç‰ˆæœ¬ï¼Œå¤šäº‹åŠ¡åŠŸèƒ½&lt;/h4&gt;
&lt;p&gt;æ ¸å¿ƒæ˜¯å†…å­˜æ ‘å½¢ç´¢å¼•æ¨¡å‹treeIndex + åµŒå…¥å¼KVæŒä¹…åŒ–å­˜å‚¨åº“boltdbç»„æˆã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;boltdb&lt;/strong&gt;ä¼šå¯¹keyçš„æ¯ä¸€æ¬¡ä¿®æ”¹ï¼Œéƒ½ç”Ÿæˆä¸€ä¸ªæ–°çš„ç‰ˆæœ¬å·å¯¹è±¡ï¼Œä»¥&lt;strong&gt;ç‰ˆæœ¬å·ä¸ºkeyï¼Œvalueä¸ºç”¨æˆ·key-value&lt;/strong&gt;ç­‰ä¿¡æ¯ç»„æˆçš„ç»“æ„ä½“ã€‚ç‰ˆæœ¬å·å…¨å±€é€’å¢ï¼Œé€šè¿‡&lt;strong&gt;treeIndexæ¨¡å—ä¿å­˜ç”¨æˆ·keyå’Œç‰ˆæœ¬å·çš„æ˜ å°„&lt;/strong&gt;ã€‚æŸ¥è¯¢æ—¶ï¼Œå…ˆå»treeIndexæ¨¡å—æŸ¥è¯¢keyå¯¹åº”çš„ç‰ˆæœ¬å·ï¼Œæ ¹æ®ç‰ˆæœ¬å·åˆ°boltdbé‡ŒæŸ¥è¯¢å¯¹åº”çš„valueä¿¡æ¯ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;treeIndexåŸºäºBæ ‘å®ç°ï¼Œåªä¼šä¿å­˜ç”¨æˆ·çš„keyå’Œç‰ˆæœ¬å·çš„æ˜ å°„ï¼Œå…·ä½“çš„valueä¿¡æ¯åˆ™ä¿å­˜å†boltdbé‡Œã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;boltdbåŸºäºB+æ ‘å®ç°çš„kvé”®å€¼åº“ï¼Œæ”¯æŒäº‹åŠ¡ï¼Œæä¾›Get/Putç­‰APIï¼Œetcdé€šè¿‡boltdbå®ç°ä¸€ä¸ªkeyçš„å¤šå†å²ç‰ˆæœ¬ã€‚åœ¨è¯»å–boltdbå‰ï¼Œä¼šä»ä¸€ä¸ªå†…å­˜è¯»äº‹åŠ¡bufferä¸­ï¼ŒäºŒåˆ†æŸ¥æ‰¾è¦è®¿é—®çš„keyæ˜¯å¦åœ¨bufferé‡Œï¼Œæé«˜æŸ¥è¯¢é€Ÿåº¦ã€‚&lt;/p&gt;
&lt;p&gt;è‹¥bufferæœªå‘½ä¸­ï¼Œå°±è¿›åˆ°boltdbä¸­æŸ¥è¯¢ã€‚boltdbé€šè¿‡bucketéš”ç¦»é›†ç¾¤å…ƒæ•°æ®äºç”¨æˆ·æ•°æ®ï¼Œæ¯ä¸ªbucketå¯¹åº”ä¸€å¼ è¡¨ï¼ˆä¸€é¢—B+æ ‘ï¼‰ï¼Œç”¨æˆ·æ•°æ®çš„keyçš„å€¼ç­‰äºbucketåå­—ï¼Œetcd MVCCå…ƒæ•°æ®å­˜æ”¾çš„bucketæ˜¯metaã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;å†™æ“ä½œ&#34;&gt;å†™æ“ä½œ&lt;/h2&gt;
&lt;p&gt;å®¢æˆ·ç«¯é€šè¿‡etcdctlå‘é€putè¯·æ±‚&lt;code&gt;etcdctl put [keyå€¼] [valueå€¼] --endpoints [å¤šä¸ªectdèŠ‚ç‚¹åœ°å€]&lt;/code&gt;ï¼Œetcdctlé€šè¿‡è´Ÿè½½å‡è¡¡ç®—æ³•é€‰æ‹©ä¸€ä¸ªetcdèŠ‚ç‚¹ï¼Œå‘èµ·gRpcè°ƒç”¨ï¼Œetcd serveræ”¶åˆ°è¯·æ±‚åç»è¿‡ä¸€ç³»åˆ—gRpcæ‹¦æˆªå™¨ã€Quotaæ¨¡å—åï¼Œè¿›å…¥KV Serveræ¨¡å—ï¼ŒKV Serveræ¨¡å—å‘Raftæ¨¡å—æäº¤ä¸€ä¸ªå†™æ“ä½œçš„ææ¡ˆã€‚éšåï¼ŒRaftæ¨¡å—é€šè¿‡HTTPç½‘ç»œæ¨¡å—è½¬å‘åˆ°é›†ç¾¤çš„å¤šæ•°èŠ‚ç‚¹æŒä¹…åŒ–ï¼ŒçŠ¶æ€å˜æˆå·²æäº¤ï¼Œetcd serverä»Raftæ¨¡å—è·å–å·²æäº¤çš„æ—¥å¿—æ¡ç›®ï¼Œä¼ é€’ç»™Applyæ¨¡å—ï¼ŒApplyæ¨¡å—é€šè¿‡MVCCæ¨¡å—æ‰§è¡Œå‘½ä»¤å†…å®¹ï¼Œæ›´æ–°çŠ¶æ€æœºã€‚&lt;/p&gt;
&lt;p&gt;etcdå†™å…¥çš„valueå¤§å°é»˜è®¤ä¸è¶…è¿‡1.5MB&lt;/p&gt;
&lt;h3 id=&#34;quotaæ¨¡å—&#34;&gt;Quotaæ¨¡å—&lt;/h3&gt;
&lt;p&gt;etcdçš„dbæ–‡ä»¶é…é¢åªæœ‰2Gï¼Œå½“è¶…è¿‡æ—¶ï¼Œæ•´ä¸ªé›†ç¾¤å˜æˆåªè¯»ï¼Œæ— æ³•å†™å…¥ï¼Œè¿™ä¸ªé™åˆ¶ä¸»è¦æ˜¯ä¸ºäº†ä¿è¯etcdçš„æ€§èƒ½ï¼Œå®˜æ–¹å»ºè®®æœ€å¤§ä¸è¶…è¿‡8Gï¼Œä¸ç¦ç”¨é…é¢ã€‚&lt;/p&gt;
&lt;p&gt;å½“etcd serveræ”¶åˆ°å†™è¯·æ±‚æ—¶ï¼Œä¼šå…ˆæ£€æµ‹dbå¤§å° + ä¸Šè¯·æ±‚æ—¶çš„key-valueå¤§å°ï¼Œåˆ¤æ–­æ˜¯å¦è¶…è¿‡é…é¢ï¼Œå¦‚æœè¶…è¿‡ï¼Œä¼šäº§ç”Ÿä¸€ä¸ªNO SPACEçš„å‘Šè­¦ï¼Œå¹¶é€šè¿‡Raftæ—¥å¿—åŒæ­¥ç»™å…¶ä»–èŠ‚ç‚¹ï¼Œå‘ŠçŸ¥dbæ— ç©ºé—´ï¼Œå¹¶å°†å‘Šè­¦æŒä¹…åŒ–å­˜å‚¨åˆ°dbä¸­ï¼Œä½¿å¾—é›†ç¾¤å†…å…¶ä»–èŠ‚ç‚¹ä¹Ÿéƒ½æ‹’ç»å†™å…¥ï¼Œå˜æˆåªè¯»ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœè¾¾åˆ°é…é¢åï¼Œå†æ¬¡å»ä¿®æ”¹é…é¢å¤§å°ï¼Œè¿˜éœ€è¦é¢å¤–å‘é€ä¸€ä¸ªå–æ¶ˆè­¦å‘Šï¼Œæ¶ˆé™¤NO SPACEå‘Šè­¦å¸¦æ¥çš„å½±å“ã€‚&lt;/p&gt;
&lt;p&gt;å…¶æ¬¡æ˜¯è¦æ£€æµ‹etcdçš„å‹ç¼©é…ç½®ï¼Œå¦‚æœæ²¡æœ‰æœºåˆ¶å»å›æ”¶æ—§ç‰ˆæœ¬ï¼Œä¼šå¯¼è‡´å†…å­˜å’Œdbå¤§å°ä¸€ç›´è†¨èƒ€ã€‚&lt;/p&gt;
&lt;p&gt;å›æ”¶æœºåˆ¶æœ‰å¤šç§ï¼Œå¸¸è§çš„æ˜¯ä¿ç•™æœ€è¿‘ä¸€æ®µæ—¶é—´çš„å†å²ç‰ˆæœ¬ï¼Œç»™æ—§ç‰ˆæœ¬æ•°æ®æ‰“ä¸Šfreeæ ‡è®°ï¼Œåç»­æ–°å†™å…¥çš„æ•°æ®ç›´æ¥è¦†ç›–è€Œæ— éœ€ç”³è¯·æ–°ç©ºé—´ã€‚å¦ä¸€ç§å›æ”¶æœºåˆ¶æ˜¯å›æ”¶ç©ºé—´ï¼Œå‡å°‘dbå¤§å°ï¼Œä½†ä¼šäº§ç”Ÿç¢ç‰‡ï¼Œäº§ç”Ÿç¢ç‰‡å°±éœ€è¦æ•´ç†ï¼Œæ—§çš„dbæ–‡ä»¶æ•°æ®ä¼šå†™å…¥æ–°çš„dbæ–‡ä»¶ï¼Œå¯¹æ€§èƒ½å½±å“è¾ƒå¤§ã€‚&lt;/p&gt;
&lt;h3 id=&#34;kvserveræ¨¡å—&#34;&gt;KVServeræ¨¡å—&lt;/h3&gt;
&lt;p&gt;å†™è¯·æ±‚åœ¨é€šè¿‡Raftç®—æ³•å®ç°èŠ‚ç‚¹é—´çš„æ•°æ®å¤åˆ¶å‰ï¼Œç”±KVServerè¿›è¡Œä¸€ç³»åˆ—çš„æ£€æŸ¥ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;é™é€Ÿåˆ¤æ–­ï¼Œä¿è¯é›†ç¾¤ç¨³å®šï¼Œé¿å…é›ªå´©ã€‚æ¯”å¦‚Raftæ¨¡å—å·²æäº¤çš„æ—¥å¿—ç´¢å¼•(committed index)æ¯”å·²åº”ç”¨åˆ°çŠ¶æ€æœºçš„æ—¥å¿—ç´¢å¼•(applied index)è¶…è¿‡äº†5000ã€‚&lt;/li&gt;
&lt;li&gt;å°è¯•è·å–è¯·æ±‚ä¸­çš„é‰´æƒä¿¡æ¯ï¼Œè‹¥ä½¿ç”¨äº†é‰´æƒï¼Œåˆ™åˆ¤æ–­è¯·æ±‚ä¸­çš„å¯†ç ã€tokenæ˜¯å¦æ­£ç¡®ã€‚&lt;/li&gt;
&lt;li&gt;æ£€æŸ¥å†™å…¥çš„åŒ…å¤§å°æ˜¯å¦è¶…è¿‡é»˜è®¤çš„1.5MBã€‚&lt;/li&gt;
&lt;li&gt;é€šè¿‡æ£€æŸ¥åï¼Œç”Ÿæˆä¸€ä¸ªå”¯ä¸€çš„IDï¼Œå¹¶å°†è¯¥è¯·æ±‚å…³è”åˆ°ä¸€ä¸ªå¯¹åº”çš„æ¶ˆæ¯é€šçŸ¥channelï¼Œå‘Raftæ¨¡å—å‘èµ·ä¸€ä¸ªææ¡ˆï¼Œä¹‹åKV Serverä¼šç­‰å¾…å†™è¯·æ±‚çš„è¿”å›ï¼Œå†™å…¥ç»“æœé€šè¿‡æ¶ˆæ¯é€šçŸ¥channelè¿”å›ï¼Œæˆ–è€…è¶…æ—¶ï¼Œé»˜è®¤è¶…æ—¶æ—¶é—´æ˜¯7ç§’ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;walæ¨¡å—&#34;&gt;WALæ¨¡å—&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;Raftæ¨¡å—æ”¶åˆ°ææ¡ˆåï¼Œå¦‚æœå½“å‰èŠ‚ç‚¹æ˜¯FollowerèŠ‚ç‚¹ï¼Œåˆ™è½¬å‘ç»™Leaderï¼Œåªæœ‰Leaderæ‰èƒ½å¤„ç†å†™è¯·æ±‚ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Leaderæ”¶åˆ°ææ¡ˆåï¼Œé€šè¿‡Raftæ¨¡å—è¾“å‡ºå¾…è½¬å‘ç»™FollowerèŠ‚ç‚¹çš„æ¶ˆæ¯å’Œå¾…æŒä¹…åŒ–çš„æ—¥å¿—æ¡ç›®ï¼Œæ—¥å¿—æ¡ç›®è®°å½•äº†å†™æ“ä½œçš„å†…å®¹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;LeaderèŠ‚ç‚¹ä»Raftæ¨¡å—è·å–åˆ°ä»¥ä¸Šæ¶ˆæ¯å’Œæ—¥å¿—æ¡ç›®åï¼Œå°†å†™è¯·æ±‚ææ¡ˆæ¶ˆæ¯å¹¿æ’­ç»™é›†ç¾¤å„ä¸ªèŠ‚ç‚¹ï¼ŒåŒæ—¶éœ€è¦æŠŠé›†ç¾¤Leaderä»»æœŸå·ã€æŠ•ç¥¨ä¿¡æ¯ã€å·²æäº¤ç´¢å¼•ã€ææ¡ˆå†…å®¹æŒä¹…åŒ–å¾…ä¸€ä¸ªWALæ—¥å¿—æ–‡ä»¶ä¸­ï¼Œç”¨äºä¿è¯é›†ç¾¤ä¸€è‡´æ€§ã€å¯æ¢å¤æ€§ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å½“ä¸€åŠä»¥ä¸ŠèŠ‚ç‚¹æŒä¹…åŒ–æ­¤æ—¥å¿—æ¡ç›®åï¼ŒRaftæ¨¡å—é€šè¿‡channelå‘ŠçŸ¥etcd serveræ¨¡å—ï¼Œå†™è¯·æ±‚ææ¡ˆå·²è¢«è¶…åŠæ•°èŠ‚ç‚¹ç¡®è®¤ï¼Œææ¡ˆçŠ¶æ€è½¬ä¸ºå·²æäº¤ï¼Œä»channelä¸­å–å‡ºææ¡ˆå†…å®¹ï¼Œæ·»åŠ åˆ°FIFOé˜Ÿåˆ—ä¸­ï¼Œç­‰å¾…Applyæ¨¡å—é¡ºåºã€å¼‚æ­¥ä¾æ¬¡æ‰§è¡Œææ¡ˆå†…å®¹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;WALæŒä¹…åŒ–æœºåˆ¶&lt;/strong&gt;ï¼šå…ˆå°†Raftæ—¥å¿—æ¡ç›®å†…å®¹åºåˆ—åŒ–åä¿å­˜åˆ°WALè®°å½•çš„Dataå­—æ®µï¼Œè®¡ç®—Dataçš„CRCå€¼ï¼Œè®¾ç½®Typeä¸ºEntryTypeï¼Œç»„æˆä¸€ä¸ªå®Œæˆçš„WALè®°å½•ï¼Œæœ€åè®°å½•WALè®°å½•çš„é•¿åº¦ï¼Œé¡ºåºå†™å…¥WALé•¿åº¦ï¼Œå†å†™å…¥è®°å½•å†…å®¹ï¼Œè°ƒç”¨fsyncæŒä¹…åŒ–åˆ°ç£ç›˜ã€‚&lt;/p&gt;
&lt;p&gt;ä¸»è¦ä½œç”¨æ˜¯ä¸ºäº†ä¿è¯etcdé‡å¯æ—¶ï¼Œé‡æ”¾æ—¥å¿—ææ¡ˆï¼Œä¿è¯å‘½ä»¤çš„æ‰§è¡Œã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;WALæ—¥å¿—ç»“æ„
LenField -------- æ•°æ®é•¿åº¦
Type ------------ WALè®°å½•ç±»å‹ï¼Œæœ‰5ç§ï¼Œåˆ†åˆ«æ˜¯æ–‡ä»¶å…ƒæ•°æ®è®°å½•ã€æ—¥å¿—æ¡ç›®è®°å½•ã€çŠ¶æ€ä¿¡æ¯è®°å½•ã€CRCã€å¿«ç…§
CRC ------------- æ ¡éªŒç 
Data ------------ WALè®°å½•å†…å®¹

Raftæ—¥å¿—æ¡ç›®Dataçš„ç»“æ„
Term ----------- uint64ï¼ŒLeaderä»»æœŸå·ï¼ŒéšLeaderé€‰ä¸¾å¢åŠ 
Index ---------- æ—¥å¿—æ¡ç›®çš„ç´¢å¼•ï¼Œå•è°ƒé€’å¢ï¼ŒåŒæ—¶ä¹Ÿç”¨äºç¡®ä¿å¹‚ç­‰æ“ä½œ
Type ----------- æ—¥å¿—ç±»å‹ï¼Œå¦‚ æ™®é€šçš„å‘½ä»¤æ—¥å¿—è¿˜æ˜¯é›†ç¾¤é…ç½®å˜æ›´æ—¥å¿—
Data ----------- ææ¡ˆå†…å®¹
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;applyæ¨¡å—&#34;&gt;Applyæ¨¡å—&lt;/h3&gt;
&lt;p&gt;ä»FIFOé˜Ÿåˆ—å–å‡ºææ¡ˆæ‰§è¡Œï¼ŒåŒæ—¶ä¼šä¿è¯å¯é æ€§ï¼ŒåŒ…æ‹¬crashé‡å¯ï¼Œæ¶ˆè´¹æ¶ˆæ¯çš„å¹‚ç­‰ï¼Œé˜²æ­¢é‡å¤æäº¤ã€‚é€šè¿‡consistent indexå­—æ®µå­˜å‚¨ç³»ç»Ÿå½“å‰å·²æ‰§è¡Œè¿‡çš„æ—¥å¿—æ¡ç›®ç´¢å¼• + æ—¥å¿—æ¡ç›®ä¸­çš„Indexå­—æ®µä¿è¯å¹‚ç­‰ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;ä»FIFOé˜Ÿåˆ—å–å‡ºææ¡ˆåï¼Œå¦‚æœä¹‹å‰æ²¡è¢«æ‰§è¡Œè¿‡ï¼Œåˆ™è¿›å…¥åˆ°MVCCæ¨¡å—&lt;/p&gt;
&lt;p&gt;etcdå†è¿›è¡Œæ›´æ–°æ—¶ä¼šä¸ºkeyç”Ÿæˆä¸€ä¸ªç‰ˆæœ¬å·ï¼Œç‰ˆæœ¬å·çš„ç”Ÿæˆå•è°ƒé€’å¢ï¼Œå¯åŠ¨æ—¶é»˜è®¤æ˜¯1ï¼Œå¦‚æœæœ‰æŒä¹…åŒ–çš„æ•°æ®ï¼Œåˆ™è¯»å–boltdbä¸­çš„æ•°æ®çš„æœ€å¤§å€¼ï¼Œä½œä¸ºå½“å‰ç‰ˆæœ¬å·ï¼Œç‰ˆæœ¬å·æ ¼å¼&lt;code&gt;{[ç‰ˆæœ¬å·],[å­ç‰ˆæœ¬å·]}&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å†™æ“ä½œæ‰§è¡Œæ—¶ï¼ŒMVCCä¼šé€’å¢å½“å‰ç‰ˆæœ¬å·ä½œä¸ºkeyçš„ç‰ˆæœ¬å·ï¼Œå­˜å‚¨åˆ°treeIndexä¸­ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å°†æ–°ç”Ÿæˆçš„ç‰ˆæœ¬å·åšä¸ºkeyï¼Œå†™æ“ä½œå¯¹åº”çš„valueå†™å…¥boltdbï¼Œæ¯ä¸ªkeyå¯¹åº”ä¸€ä¸ªbucketï¼Œboltdbçš„valueåŒ…æ‹¬å†™æ“ä½œçš„keyåï¼Œkeyåˆ›å»ºæ—¶çš„ç‰ˆæœ¬å·ï¼Œæœ€åä¸€æ¬¡ä¿®æ”¹æ—¶çš„ç‰ˆæœ¬å·ï¼Œkeyè‡ªèº«ä¿®æ”¹çš„æ¬¡æ•°ï¼Œå†™æ“ä½œçš„valueå€¼ï¼Œç§Ÿçº¦ä¿¡æ¯ã€‚å°†è¿™äº›ä¿¡æ¯åºåˆ—åŒ–æˆä¸€ä¸ªäºŒè¿›åˆ¶æ•°æ®ï¼Œå†™å…¥boltdbä¸­ï¼Œæ­¤æ—¶è¿˜åªåœ¨boltdbçš„å†…å­˜bucket bufferä¸­ã€‚æ­¤æ—¶å¦‚æœæœ‰è¯»è¯·æ±‚ï¼Œä¼šä¼˜å…ˆä»bucket bufferä¸­è¯»å–ï¼Œå…¶æ¬¡æ‰ä»boltdbè¯»ã€‚&lt;/p&gt;
&lt;p&gt;boltdbä¸æ˜¯æ¯ä¸ªvalueéƒ½æ˜¯ç›´æ¥å†™åˆ°ç£ç›˜çš„ï¼Œå› ä¸ºkeyé€’å¢ï¼Œä¼šé¡ºåºå†™å…¥ï¼Œæ‰€ä»¥ä¼šåˆå¹¶å¤šä¸ªå†™äº‹åŠ¡è¯·æ±‚ï¼Œå¼‚æ­¥(é»˜è®¤æ¯ä¸ª100ms)ï¼Œæ‰¹é‡äº‹åŠ¡ä¸€æ¬¡æ€§æäº¤ï¼Œæé«˜ååé‡ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;raftåè®®&#34;&gt;Raftåè®®&lt;/h2&gt;
&lt;p&gt;Raftåè®®ä¿è¯äº†etcdåœ¨èŠ‚ç‚¹æ•…éšœã€ç½‘ç»œåˆ†åŒºç­‰å¼‚å¸¸åœºæ™¯ä¸‹çš„é«˜å¯ç”¨å’Œæ•°æ®å¼ºä¸€è‡´æ€§ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†é¿å…å•ç‚¹æ•…éšœï¼Œå¸¸è§çš„å¤šå‰¯æœ¬å¤åˆ¶æ–¹æ¡ˆæœ‰ä¸¤ç§ï¼šä¸»ä»å¤åˆ¶å’Œå»ä¸­å¿ƒåŒ–å¤åˆ¶ã€‚&lt;/p&gt;
&lt;p&gt;é™¤äº†å¤åˆ¶æ–¹æ¡ˆï¼Œå¦ä¸€ç§æ˜¯å…±è¯†ç®—æ³•å¦‚Paxosæˆ–Raftã€‚&lt;/p&gt;
&lt;p&gt;Raftå°†å…±è¯†ç®—æ³•æ‹†åˆ†æˆä¸‰ä¸ªå­é—®é¢˜ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Leaderé€‰ä¸¾ï¼ŒLeaderæ•…éšœåé›†ç¾¤å¿«é€Ÿé€‰å‡ºæ–°Leaderã€‚&lt;/li&gt;
&lt;li&gt;æ—¥å¿—å¤åˆ¶ï¼Œé›†ç¾¤åªæœ‰Leaderèƒ½å†™å…¥æ—¥å¿—ï¼ŒLeaderè´Ÿè´£å¤åˆ¶æ—¥å¿—åˆ°FollowerèŠ‚ç‚¹ï¼Œå¼ºåˆ¶FollowerèŠ‚ç‚¹ä¸è‡ªå·±ä¿æŒä¸€è‡´ã€‚&lt;/li&gt;
&lt;li&gt;å®‰å…¨æ€§ï¼Œä¸€ä¸ªä»»æœŸå†…é›†ç¾¤åªèƒ½äº§ç”Ÿä¸€ä¸ªLeaderï¼›å·²æäº¤çš„æ—¥å¿—æ¡ç›®åœ¨å‘ç”ŸLeaderé€‰ä¸¾æ—¶ï¼Œä¸€å®šä¼šå­˜åœ¨æ›´é«˜ä»»æœŸçš„æ–°Leaderæ—¥å¿—ä¸­ï¼›å„ä¸ªèŠ‚ç‚¹çš„çŠ¶æ€æœºåº”ç”¨çš„ä»»æ„ä½ç½®çš„æ—¥å¿—æ¡ç›®å†…å®¹ä¸€æ ·ï¼›å‘èµ·ç«é€‰æŠ•ç¥¨æ—¶ï¼Œä»»æœŸå€¼å°çš„èŠ‚ç‚¹ä¸ä¼šç«é€‰æˆåŠŸï¼›å¦‚æœé›†ç¾¤ä¸å‡ºç°æ•…éšœï¼Œé‚£ä¹ˆä¸€ä¸ªä»»æœŸå°†æ— é™å»¶ç»­ä¸‹å»ï¼›æŠ•ç¥¨å‡ºç°å†²çªä¹Ÿæœ‰å¯èƒ½ç›´æ¥è¿›å…¥ä¸‹ä¸€ä»»å†æ¬¡ç«é€‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;å½“æœ‰èŠ‚ç‚¹å®•æœºæ—¶ï¼š&lt;/p&gt;
&lt;p&gt;å¦‚æœæ˜¯ Follower èŠ‚ç‚¹å®•æœºï¼Œå¦‚æœå‰©ä½™å¯ç”¨èŠ‚ç‚¹æ•°é‡è¶…è¿‡åŠæ•°ï¼Œé›†ç¾¤å¯ä»¥å‡ ä¹æ²¡æœ‰å½±å“çš„æ­£å¸¸å·¥ä½œã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœæ˜¯ Leader èŠ‚ç‚¹å®•æœºï¼Œé‚£ä¹ˆ Follower å°±æ”¶ä¸åˆ°å¿ƒè·³è€Œè¶…æ—¶ï¼Œå‘èµ·ç«é€‰è·å¾—æŠ•ç¥¨ï¼Œæˆä¸ºæ–°ä¸€è½® ä»»æœŸ çš„ Leaderï¼Œç»§ç»­ä¸ºé›†ç¾¤æä¾›æœåŠ¡ã€‚&lt;strong&gt;éœ€è¦æ³¨æ„çš„æ˜¯ï¼šetcd ç›®å‰æ²¡æœ‰ä»»ä½•æœºåˆ¶ä¼šè‡ªåŠ¨å»å˜åŒ–æ•´ä¸ªé›†ç¾¤æ€»å…±çš„èŠ‚ç‚¹æ•°é‡&lt;/strong&gt;ï¼Œå³å¦‚æœæ²¡æœ‰äººä¸ºçš„è°ƒç”¨ APIï¼Œetcd å®•æœºåçš„èŠ‚ç‚¹ä»ç„¶è¢«è®¡ç®—ä¸ºæ€»èŠ‚ç‚¹æ•°ä¸­ï¼Œä»»ä½•è¯·æ±‚è¢«ç¡®è®¤éœ€è¦è·å¾—çš„æŠ•ç¥¨æ•°éƒ½æ˜¯è¿™ä¸ªæ€»æ•°çš„åŠæ•°ä»¥ä¸Šã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;leaderé€‰ä¸¾&#34;&gt;Leaderé€‰ä¸¾&lt;/h3&gt;
&lt;p&gt;Raftåè®®å®šä¹‰é›†ç¾¤ä¸­èŠ‚ç‚¹çš„çŠ¶æ€ï¼Œä»»ä½•æ—¶åˆ»ï¼Œæ¯ä¸ªèŠ‚ç‚¹è‚¯å®šå¤„äºæŸä¸€çŠ¶æ€&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Followerï¼šåŒæ­¥Leaderæ”¶åˆ°çš„æ—¥å¿—ï¼Œetcdå¯åŠ¨æ—¶çš„é»˜è®¤çŠ¶æ€ï¼Œç­‰å¾… Leader å‘æ¥å¿ƒè·³ä¿¡æ¯ã€‚è‹¥ç­‰å¾…è¶…æ—¶ï¼Œåˆ™çŠ¶æ€ç”± Follower åˆ‡æ¢åˆ° Candidate è¿›å…¥ä¸‹ä¸€è½® term å‘èµ·ç«é€‰ï¼Œç­‰åˆ°æ”¶åˆ°é›†ç¾¤å¤šæ•°èŠ‚ç‚¹çš„æŠ•ç¥¨æ—¶ï¼Œè¯¥èŠ‚ç‚¹è½¬å˜ä¸º Leaderã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Candidateï¼šå¯ä»¥å‘èµ·Leaderé€‰ä¸¾ã€‚å½“Followeræ¥æ”¶Leaderçš„å¿ƒè·³ä¿¡æ¯è¶…æ—¶æ—¶ï¼Œè½¬ä¸ºæ­¤çŠ¶æ€ï¼Œå¹¶ç«‹å³å‘èµ·ç«é€‰LeaderæŠ•ç¥¨ï¼Œè‡ªå¢ä»»æœŸå·ï¼ŒæŠ•ç¥¨ç»™è‡ªå·±ï¼Œå¹¶å‘å…¶ä»–èŠ‚ç‚¹å‘é€ç«é€‰LeaderæŠ•ç¥¨çš„æ¶ˆæ¯ï¼Œå½“è·å¾—å¤šæ•°èŠ‚ç‚¹çš„æ”¯æŒåï¼Œå³å¯å˜æˆLeaderèŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;èŠ‚ç‚¹æ”¶åˆ°ç«é€‰æ¶ˆæ¯åå¯èƒ½å‡ºç°ä¸¤ç§æƒ…å†µï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;èŠ‚ç‚¹åˆ¤æ–­&lt;strong&gt;å‘å‡ºç«é€‰æ¶ˆæ¯çš„èŠ‚ç‚¹çš„æ•°æ®è‡³å°‘å’Œè‡ªå·±ä¸€æ ·æ–°ï¼Œå¹¶ä¸”ä»»æœŸå·å¤§äºè‡ªå·±çš„&lt;/strong&gt;ï¼Œå¹¶ä¸”è‡ªå·±è¿˜æ²¡æŠ•ç¥¨ç»™å…¶ä»–èŠ‚ç‚¹ï¼Œå°±å¯ä»¥æŠ•ç¥¨ç»™å‘å‡ºç«é€‰æ¶ˆæ¯çš„èŠ‚ç‚¹äº†ã€‚&lt;/li&gt;
&lt;li&gt;èŠ‚ç‚¹æ­¤æ—¶ä¹Ÿå‘å‡ºäº†ç«é€‰ï¼Œå¹¶æŠ•ç¥¨ç»™è‡ªå·±ï¼Œæ­¤æ—¶å°†æ‹’ç»æŠ•ç¥¨ç»™å‘å‡ºç«é€‰æ¶ˆæ¯çš„èŠ‚ç‚¹ï¼Œç›¸äº’ç­‰å¾…ç›´è‡³ç«é€‰è¶…æ—¶ï¼Œå¼€å¯æ–°ä¸€è½®ç«é€‰ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;3.4ç‰ˆæœ¬åï¼ŒèŠ‚ç‚¹åœ¨è¿›å…¥Candidateå‰ï¼Œä¼šå…ˆè¿›å…¥PreCandidateçŠ¶æ€ï¼Œæ­¤æ—¶ä¸è‡ªå¢ä»»æœŸå·ï¼Œè€Œæ˜¯ç›´æ¥å‘èµ·é¢„æŠ•ç¥¨ï¼Œè‹¥å¯ä»¥è·å¾—å¤šæ•°èŠ‚ç‚¹æ”¯æŒï¼Œæ‰èƒ½å˜æˆCandidateï¼Œè‡ªå¢ä»»æœŸå·å‘èµ·é€‰ä¸¾ã€‚&lt;/p&gt;
&lt;p&gt;Candidate åœ¨ç­‰å¾…å…¶å®ƒèŠ‚ç‚¹æŠ•ç¥¨çš„è¿‡ç¨‹ä¸­å¦‚æœå‘ç°åˆ«çš„èŠ‚ç‚¹å·²ç»ç«é€‰æˆåŠŸæˆä¸º Leader äº†ï¼Œå°±ä¼šåˆ‡æ¢ä¸º Follower èŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;ä¸ºäº†ç¡®ä¿åœ¨æœ€çŸ­æ—¶é—´å†…é€‰å‡ºLeaderï¼Œé˜²æ­¢ç«é€‰å†²çª&lt;/strong&gt;ï¼Œå½“èŠ‚ç‚¹å¤„äºCandidateçŠ¶æ€æ—¶ï¼Œæœ‰ä¸€ä¸ªç«é€‰çš„è¶…æ—¶æ—¶é—´ï¼Œä¸”è¯¥è¶…æ—¶æ—¶é—´æ˜¯ä¸€ä¸ªéšæœºå€¼ï¼Œæ¯ä¸€ä¸ª Candidate çš„è¶…æ—¶æ—¶é—´éƒ½ä¸ä¸€è‡´ï¼Œæ‰€ä»¥ä¼šæœ‰æ—¶é—´å·®ã€‚åœ¨è¿™ä¸ªæ—¶é—´å·®å†…ï¼Œå¦‚æœ Candidate1 æ”¶åˆ°çš„ç«é€‰ä¿¡æ¯æ¯”è‡ªå·±å‘èµ·çš„ç«é€‰ä¿¡æ¯çš„ä»»æœŸå·å¤§ï¼ˆå³å¯¹æ–¹ä¸ºæ–°ä¸€è½® termï¼‰ï¼Œå¹¶ä¸”æ–°ä¸€è½®æƒ³è¦æˆä¸º Leader çš„ Candidate2 åŒ…å«äº†æ‰€æœ‰æäº¤çš„æ•°æ®ï¼Œé‚£ä¹ˆ Candidate1 å°±ä¼šæŠ•ç¥¨ç»™ Candidate2ï¼Œè¿™æ ·å°±ä¿è¯äº†åªæœ‰å¾ˆå°çš„æ¦‚ç‡ä¼šå‡ºç°ç«é€‰å†²çªã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ä¸ºäº†é˜²æ­¢åˆ«çš„ Candidate åœ¨é—æ¼éƒ¨åˆ†æ•°æ®çš„æƒ…å†µä¸‹å‘èµ·æŠ•ç¥¨æˆä¸º Leader&lt;/strong&gt;ï¼Œå½“ç«é€‰è¶…æ—¶æ—¶ï¼Œä¼šé‡æ–°å‘èµ·æ–°ä¸€è½®é€‰ä¸¾ï¼Œæ­¤æ—¶ä»»æœŸå·æå‡ï¼Œå‘èµ·æ–°ä¸€è½®æŠ•ç¥¨ï¼ŒæŠ•ç¥¨æ—¶ï¼Œå¦‚æœåˆ«çš„èŠ‚ç‚¹å‘ç°å‘èµ·ç«é€‰çš„èŠ‚ç‚¹çš„æ•°æ®ä¸å®Œæ•´ï¼Œå°±ä¸ä¼šæŠ•ç¥¨ç»™ä»–ï¼Œä»¥æ­¤æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Leaderï¼šå”¯ä¸€æ€§ï¼Œæ‹¥æœ‰åŒæ­¥æ—¥å¿—çš„ç‰¹æƒï¼Œé€šè¿‡å®šæ—¶å¹¿æ’­å¿ƒè·³ç»™FollowerèŠ‚ç‚¹ï¼Œä»¥ç»´æŒLeaderèº«ä»½ã€‚LeaderèŠ‚ç‚¹æœ‰ä¸€ä¸ªä»»æœŸå·ï¼Œå……å½“Raftç®—æ³•çš„é€»è¾‘æ—¶é’Ÿï¼Œå¯ä»¥æ¯”è¾ƒå„ä¸ªèŠ‚ç‚¹çš„æ•°æ®æ–°æ—§ã€è¯†åˆ«è¿‡æœŸLeaderç­‰ã€‚&lt;/p&gt;
&lt;p&gt;é»˜è®¤çš„å¿ƒè·³é—´éš”æ—¶é—´æ˜¯100msï¼Œé»˜è®¤çš„ç«é€‰è¶…æ—¶æ—¶é—´æ˜¯1000msï¼Œå½“è¶…æ—¶æ—¶é—´å¤§äºç«é€‰æ—¶é—´æ—¶ï¼ŒèŠ‚ç‚¹ä»FollowerçŠ¶æ€è½¬ä¸ºCandidateçŠ¶æ€ã€‚&lt;/p&gt;
&lt;p&gt;å½“ç°æœ‰Leaderå‘ç°æ–°çš„Leaderä»»æœŸå·åï¼Œå°±ä¼šè½¬ä¸ºFollowerèŠ‚ç‚¹ï¼›å½“ç°æœ‰Leaderå› ä¸ºcrashé‡å¯åï¼Œä¼šå…ˆå˜æˆFollowerï¼Œè‹¥æ­¤æ—¶æ— æ³•ä¸å…¶ä»–èŠ‚ç‚¹é€šä¿¡ï¼Œä¹Ÿä¼šè¿›å…¥é€‰ä¸¾æµç¨‹ï¼Œä¸è¿‡ä¼šå…ˆè½¬ä¸ºPreCandidateå‘èµ·é¢„æŠ•ç¥¨ï¼Œé¿å…å› æ•°æ®è½åä¸”åœ¨CandidateçŠ¶æ€å› è‡ªå¢ä»»æœŸå·ï¼Œåœ¨æ¢å¤é€šä¿¡åé€ æˆé€‰ä¸¾å¼‚å¸¸ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;æ—¥å¿—å¤åˆ¶&#34;&gt;æ—¥å¿—å¤åˆ¶&lt;/h3&gt;
&lt;p&gt;LeaderèŠ‚ç‚¹é€šè¿‡NextIndexå­—æ®µæ ‡è¯†è¦å‘é€ç»™FollowerèŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªæ—¥å¿—æ¡ç›®ç´¢å¼•ï¼ŒMatchIndexå­—æ®µæ ‡è¯†FollowerèŠ‚ç‚¹å·²å¤åˆ¶çš„æœ€å¤§æ—¥å¿—æ¡ç›®ç´¢å¼•ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€ä¸ªæ—¥å¿—æ¡ç›®è¢«ç¡®è®¤ä¸ºå·²æäº¤çš„å‰ææ˜¯å®ƒéœ€è¦è¢«LeaderåŒæ­¥åˆ°ä¸€åŠä»¥ä¸ŠèŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å®¢æˆ·ç«¯å‘é€å†™æ“ä½œæ¶ˆæ¯msgç»™etcdï¼Œè¿›å…¥LeaderèŠ‚ç‚¹çš„Raftæ¨¡å—&lt;/li&gt;
&lt;li&gt;LeaderèŠ‚ç‚¹çš„etcd serveræ¨¡å—é€šè¿‡channelä»Raftæ¨¡å—è·å–Readyç»“æ„ï¼Œé€šè¿‡HTTPåè®®çš„ç½‘ç»œæ¨¡å—å°†è¿½åŠ æ—¥å¿—æ¡ç›®æ¶ˆæ¯å¹¿æ’­ç»™Followerï¼Œå¹¶åŒæ—¶å°†å¾…æŒä¹…åŒ–çš„æ—¥å¿—æŒä¹…åŒ–åˆ°WALæ–‡ä»¶ä¸­ï¼Œæœ€åå°†æ—¥å¿—æ¡ç›®è¿½åŠ åˆ°ç¨³å®šçš„Raftæ—¥å¿—å­˜å‚¨ä¸­ã€‚Raftæ—¥å¿—å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œå³ä½¿ä¸¢å¤±ä¹Ÿå¯ä»¥é€šè¿‡WALæ–‡ä»¶é‡å»ºã€‚&lt;/li&gt;
&lt;li&gt;å„ä¸ªFolloweræ”¶åˆ°è¿½åŠ æ—¥å¿—æ¡ç›®æ¶ˆæ¯ï¼Œé€šè¿‡å®‰å…¨æ£€æŸ¥åï¼Œä¼šæŒä¹…åŒ–æ¶ˆæ¯åˆ°WALæ—¥å¿—ä¸­ï¼Œå¹¶å°†æ¶ˆæ¯è¿½åŠ åˆ°Raftæ—¥å¿—å­˜å‚¨ï¼Œéšåå‘Leaderå›å¤ä¸€ä¸ªåº”ç­”è¿½åŠ æ—¥å¿—æ¡ç›®çš„æ¶ˆæ¯ï¼Œå‘ŠçŸ¥Leaderå½“å‰å·²å¤åˆ¶çš„æ—¥å¿—æœ€å¤§ç´¢å¼•ã€‚&lt;/li&gt;
&lt;li&gt;Leaderæ”¶åˆ°åº”ç­”è¿½åŠ æ—¥å¿—æ¡ç›®æ¶ˆæ¯åï¼Œå°†Followerå›å¤çš„å·²å¤åˆ¶æ—¥å¿—æœ€å¤§ç´¢å¼•æ›´æ–°åˆ°è¿½è¸ªFollowerè¿›å±•çš„MatchIndexå­—æ®µï¼Œæ ¹æ®è¯¥å­—æ®µä¿¡æ¯ï¼Œè®¡ç®—å‡ºä¸€ä¸ªä½ç½®ï¼Œå¦‚æœè¿™ä¸ªä½ç½®å·²ç»è¢«ä¸€åŠä»¥ä¸ŠèŠ‚ç‚¹æŒä¹…åŒ–ï¼Œé‚£ä¹ˆè¿™ä¸ªä½ç½®ä¹‹å‰çš„æ—¥å¿—æ¡ç›®éƒ½å¯ä»¥è¢«æ ‡è®°æˆå·²æäº¤ã€‚Leaderé€šè¿‡å¿ƒè·³ä¿¡æ¯å‘ŠçŸ¥å·²æäº¤çš„æ—¥å¿—ç´¢å¼•ä½ç½®ç»™Followerã€‚&lt;/li&gt;
&lt;li&gt;å„ä¸ªèŠ‚ç‚¹çš„etcd serveræ¨¡å—ï¼Œé€šè¿‡channelä»Raftæ¨¡å—è·å–å·²æäº¤çš„æ—¥å¿—æ¡ç›®ï¼Œåº”ç”¨æ—¥å¿—æ¡ç›®å†…å®¹åˆ°å­˜å‚¨çŠ¶æ€æœºï¼Œè¿”å›ç»™å®¢æˆ·ç«¯ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;Raft ä¸ºäº†ä¿è¯æ•°æ®çš„å¼ºä¸€è‡´æ€§ï¼Œæ‰€æœ‰çš„æ•°æ®æµå‘éƒ½æ˜¯ä» Leader æµå‘ Followerï¼Œæ‰€æœ‰ Follower çš„æ•°æ®å¿…é¡»ä¸ Leader ä¿æŒä¸€è‡´ï¼Œå¦‚æœä¸ä¸€è‡´ä¼šè¢«è¦†ç›–ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€ä¸ªæ›´æ–°æ•°æ®çš„è¯·æ±‚éƒ½æœ€å…ˆç”± Leader æ¥æ”¶ï¼ŒWALå­˜ä¸‹æ¥ï¼Œç„¶ååŒæ­¥åˆ°å…¶ä»–èŠ‚ç‚¹ï¼›å½“LeaderèŠ‚ç‚¹æ”¶åˆ°å¤§å¤šæ•°Follower èŠ‚ç‚¹çš„åé¦ˆåï¼Œæäº¤æ•°æ®ï¼Œç„¶åå¼‚æ­¥é€šçŸ¥å…¶ä»– Followerä¹Ÿè¿›è¡Œæ•°æ®æäº¤ã€‚æ‰€ä»¥å†™è¯·æ±‚è‚¯å®šæ˜¯å‘é€åˆ°Leaderé‡Œï¼Œè€Œè¯»è¯·æ±‚å¯ä»¥å‘é€åˆ°ä»»ä¸€èŠ‚ç‚¹ï¼Œä½†è¦æ³¨æ„æ˜¯è¦ä¸²è¡Œè¯»è¿˜æ˜¯çº¿æ€§è¯»ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;å®‰å…¨æ€§&#34;&gt;å®‰å…¨æ€§&lt;/h3&gt;
&lt;p&gt;Rafté€šè¿‡ç»™é€‰ä¸¾å’Œæ—¥å¿—å¤åˆ¶å¢åŠ è§„åˆ™ï¼Œä¿è¯å½“Leader crashåï¼Œèƒ½åœ¨ä¼—å¤šFollowerä¸­é€‰ä¸¾å‡ºæœ‰æœ€æ–°æ—¥å¿—æ¡ç›®çš„Followeræˆä¸ºæ–°Leaderã€‚&lt;/p&gt;
&lt;p&gt;å½“èŠ‚ç‚¹æ”¶åˆ°é€‰ä¸¾æŠ•ç¥¨æ—¶ï¼Œéœ€æ£€æŸ¥å‘å‡ºé€‰ä¸¾æ¶ˆæ¯çš„èŠ‚ç‚¹çš„æœ€åä¸€æ¡æ—¥å¿—çš„ä»»æœŸå·ï¼Œè‹¥å°äºè‡ªå·±åˆ™æ‹’ç»æŠ•ç¥¨ï¼Œå¦‚æœç›¸åŒï¼Œæ—¥å¿—æ¯”è‡ªå·±çŸ­ï¼Œä¹Ÿæ‹’ç»æŠ•ç¥¨ã€‚èŠ‚ç‚¹éœ€å°†æŠ•ç¥¨ä¿¡æ¯æŒä¹…åŒ–ï¼Œé˜²æ­¢å¼‚å¸¸é‡å¯åå†æŠ•ç¥¨ç»™å…¶ä»–èŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨å¤åˆ¶ä¸Šï¼Œé€šè¿‡Leaderå®Œå…¨ç‰¹æ€§ã€åªé™„åŠ åŸåˆ™å’Œæ—¥å¿—åŒ¹é…ä¿è¯Leaderæäº¤æ¶ˆæ¯å¹¶å¹¿æ’­ç»™å…¶ä»–èŠ‚ç‚¹åcrashï¼Œè¿™æ¡æ–°æ¶ˆæ¯ä¸ä¼šè¢«å…¶ä»–èŠ‚ç‚¹åˆ é™¤çš„é—®é¢˜å’Œå„ä¸ªèŠ‚ç‚¹çš„åŒRaftæ—¥å¿—ä½ç½®å«æœ‰ç›¸åŒçš„æ—¥å¿—æ¡ç›®ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å®Œå…¨ç‰¹æ€§ï¼šæŸä¸ªæ—¥å¿—æ¡ç›®åœ¨æŸä¸ªä»»æœŸå·ä¸­å·²è¢«æäº¤ï¼Œé‚£ä¹ˆè¿™ä¸ªæ¡ç›®å¿…ç„¶å‡ºç°åœ¨æ›´å¤§ä»»æœŸå·çš„æ‰€æœ‰Leaderä¸­&lt;/li&gt;
&lt;li&gt;åªé™„åŠ åŸåˆ™ï¼šLeaderåªèƒ½è¿½åŠ æ—¥å¿—æ¡ç›®ï¼Œä¸èƒ½åˆ é™¤&lt;/li&gt;
&lt;li&gt;æ—¥å¿—åŒ¹é…ï¼šè¿½åŠ æ—¥å¿—æ—¶ä¼šè¿›è¡Œä¸€è‡´æ€§æ£€æŸ¥ï¼ŒLeaderå‘é€è¿½åŠ æ—¥å¿—çš„æ¶ˆæ¯æ—¶ï¼Œä¼šæŠŠæ–°çš„æ—¥å¿—æ¡ç›®ç´§æ¥ä¹‹å‰çš„æ¡ç›®çš„ç´¢å¼•ä½ç½®å’Œä»»æœŸå·åŒ…å«åœ¨é‡Œé¢ï¼ŒFollowerèŠ‚ç‚¹ä¼šæ£€æŸ¥ç›¸åŒç´¢å¼•ä½ç½®çš„ä»»æœŸå·æ˜¯å¦ä¸Leaderä¸€è‡´ï¼Œä¸€è‡´æ‰è¿½åŠ ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å½“Followeræ—¥å¿—å’ŒLeaderå†²çªæ—¶ï¼Œä¼šå¯¼è‡´ä¸¤è€…çš„æ—¥å¿—ä¸ä¸€è‡´ï¼Œæ­¤æ—¶Leaderä¼šå¼ºåˆ¶Followerç›´æ¥å¤åˆ¶è‡ªå·±çš„æ—¥å¿—æ¥è§£å†³ï¼Œå› æ­¤åœ¨Followerä¸­å†²çªçš„æ—¥å¿—æ¡ç›®ä¼šè¢«Leaderçš„æ—¥å¿—è¦†ç›–ï¼ŒLeaderä¼šè®°å½•Followerå¤åˆ¶è¿›åº¦çš„nextIndexï¼Œå¦‚æœFolloweråœ¨è¿½åŠ æ—¥å¿—æ—¶ä¸€è‡´æ€§æ£€æŸ¥å¤±è´¥ï¼Œå°±ä¼šæ‹’ç»è¯·æ±‚ï¼Œæ­¤æ—¶Leaderä¼šå‡å°nextIndexå€¼å¹¶é‡è¯•ï¼Œæœ€ç»ˆåœ¨æŸä¸ªä½ç½®è®©Followerè·ŸLeaderä¸€è‡´ã€‚å°½ç®¡WALæ—¥å¿—æ¨¡å—åªèƒ½è¿½åŠ ï¼Œå¯¹äºé‚£äº›æƒ³è¦åˆ é™¤çš„æŒä¹…åŒ–æ—¥å¿—æ¡ç›®ï¼ŒWALæ¨¡å—ç¡®å®æ²¡æœ‰åˆ é™¤ï¼Œå½“å‘ç°ä¸€ä¸ªraft log indexä½ç½®ä¸Šæœ‰å¤šä¸ªæ—¥å¿—æ¡ç›®æ—¶ï¼Œä¼šé€šè¿‡è¦†ç›–çš„æ–¹å¼ï¼Œå°†æœ€åå†™å…¥çš„æ—¥å¿—æ¡ç›®è¿½åŠ åˆ°raft logä¸­ï¼Œé€šè¿‡è¦†ç›–å®ç°åˆ é™¤ã€‚&lt;/p&gt;
&lt;h2 id=&#34;é‰´æƒ&#34;&gt;é‰´æƒ&lt;/h2&gt;
&lt;p&gt;etcdé‰´æƒä½“ç³»ç”±æ§åˆ¶é¢å’Œæ•°æ®é¢ç»„æˆã€‚&lt;/p&gt;
&lt;p&gt;æ§åˆ¶é¢ï¼šé€šè¿‡etcdctlå’Œé‰´æƒAPIåŠ¨æ€è°ƒæ•´è®¤è¯ã€é‰´æƒè§„åˆ™ï¼ŒAuthServeræ”¶åˆ°è¯·æ±‚åï¼Œä¸ºäº†ç¡®ä¿å„ä¸ªèŠ‚ç‚¹é—´é‰´æƒå…ƒæ•°æ®ä¸€è‡´æ€§ï¼Œä¼šé€šè¿‡Raftæ¨¡å—è¿›è¡Œæ•°æ®åŒæ­¥ã€‚å½“å¯¹åº”çš„Raftæ—¥å¿—æ¡ç›®è¢«é›†ç¾¤åŠæ•°ä»¥ä¸ŠèŠ‚ç‚¹ç¡®è®¤åï¼ŒApplyæ¨¡å—é€šè¿‡é‰´æƒå­˜å‚¨AuthStoreæ¨¡å—ï¼Œæ‰§è¡Œæ—¥å¿—æ¡ç›®å†…å®¹ï¼Œå°†è§„åˆ™å­˜å‚¨åˆ°boltdbçš„é‰´æƒè¡¨é‡Œã€‚&lt;/p&gt;
&lt;p&gt;æ•°æ®é¢ï¼šç”±è®¤è¯å’Œæˆæƒç»„æˆã€‚ç›®å‰æœ‰ä¸¤ç§è®¤è¯æœºåˆ¶ï¼šå¯†ç è®¤è¯å’Œè¯ä¹¦è®¤è¯ã€‚é€šè¿‡è®¤è¯åï¼Œåœ¨è®¿é—®MVCCæ¨¡å—å‰ï¼Œè¿˜éœ€è¦è¿›è¡Œæˆæƒï¼Œæ£€æŸ¥clientæ˜¯å¦æœ‰æƒé™æ“ä½œä½ è¯·æ±‚çš„æ•°æ®è·¯å¾„ï¼Œä½¿ç”¨çš„æ˜¯RBACæœºåˆ¶ã€‚&lt;/p&gt;
&lt;h3 id=&#34;è®¤è¯&#34;&gt;è®¤è¯&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å¯†ç è®¤è¯ï¼šetcdé‰´æƒæ¨¡å—ä½¿ç”¨bcrptåº“çš„blowfishç®—æ³•ï¼ŒåŸºäºæ˜æ–‡å¯†ç ã€éšæœºåˆ†é…çš„saltã€è‡ªå®šä¹‰çš„costã€è¿­ä»£å¤šæ¬¡è®¡ç®—å¾—åˆ°ä¸€ä¸ªhashå€¼ï¼Œå¹¶å°†åŠ å¯†ç®—æ³•ç‰ˆæœ¬ã€saltå€¼ã€costã€hashå€¼ç»„æˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä½œä¸ºåŠ å¯†åçš„å¯†ç ã€‚ä»¥ç”¨æˆ·åä¸ºkeyï¼Œç”¨æˆ·åã€åŠ å¯†åçš„å¯†ç ä½œä¸ºvalueï¼Œå­˜å‚¨åˆ°boltdbçš„authUsers bucketé‡Œã€‚&lt;/p&gt;
&lt;p&gt;éªŒè¯å¯†ç æˆåŠŸåï¼Œè¿”å›ä¸€ä¸ªtokenç»™clientï¼Œåç»­è¯·æ±‚æºå¸¦æ­¤tokenè€Œæ— éœ€è¿›è¡Œå¯†ç æ ¡éªŒäº†ã€‚é»˜è®¤çš„tokenè¿‡æœŸæ—¶é—´æ˜¯5åˆ†é’Ÿï¼Œä»…åœ¨å¼€å‘æˆ–æµ‹è¯•ç¯å¢ƒä¸­ä½¿ç”¨ã€‚æ­£å¼ç¯å¢ƒä¸€èˆ¬ä½¿ç”¨JWTã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è¯ä¹¦è®¤è¯ï¼šç±»ä¼¼HTTPSï¼Œè¯ä¹¦è®¤è¯åœ¨ç¨³å®šæ€§å’Œæ€§èƒ½ä¸Šéƒ½ä¼˜äºå¯†ç è®¤è¯ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;æˆæƒ&#34;&gt;æˆæƒ&lt;/h3&gt;
&lt;p&gt;ä½¿ç”¨RBACæˆæƒæ¨¡å‹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç§Ÿçº¦-lease&#34;&gt;ç§Ÿçº¦ Lease&lt;/h2&gt;
&lt;p&gt;etcdé€šè¿‡Leaseå®ç°æ´»æ€§æ£€æµ‹ï¼Œå¯ä»¥æ£€æµ‹å„ä¸ªå®¢æˆ·ç«¯çš„å­˜æ´»èƒ½åŠ›ï¼Œä¸šåŠ¡clientéœ€è¦å®šæœŸå‘etcdå‘é€å¿ƒè·³è¯·æ±‚æ±‡æŠ¥è®²è¯¾çŠ¶æ€ï¼Œå±äºä¸»åŠ¨å‹ä¸ŠæŠ¥ï¼Œè®©etcd serverä¿è¯åœ¨çº¦å®šçš„æœ‰æ•ˆæœŸå†…ï¼Œä¸åˆ é™¤clientå…³è”åˆ°æ­¤leaseä¸Šçš„key-valueï¼Œè‹¥æœªåœ¨æœ‰æ•ˆæœŸå†…ç»­ç§Ÿï¼Œå°±ä¼šåˆ é™¤Leaseå’Œå…¶å…³è”çš„key-valueã€‚&lt;/p&gt;
&lt;p&gt;åŸºäºLeaseçš„TTLç‰¹æ€§ï¼Œå¯ä»¥è§£å†³ç±»ä¼¼Leaderé€‰ä¸¾ã€Kubernetes Eventè‡ªåŠ¨æ·˜æ±°ã€æœåŠ¡å‘ç°åœºæ™¯ä¸­æ•…éšœèŠ‚ç‚¹è‡ªåŠ¨å‰”é™¤ç­‰é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;æ£€æŸ¥Leaseæ˜¯å¦è¿‡æœŸã€ç»´æŠ¤æœ€å°å †ã€é’ˆå¯¹è¿‡æœŸLeaseå‘èµ·revokeæ“ä½œï¼Œéƒ½ç”±LeaderèŠ‚ç‚¹è´Ÿè´£ã€‚&lt;/p&gt;
&lt;p&gt;åˆ›å»ºLeaseæ—¶ï¼Œetcdä¼šä¿å­˜Leaseä¿¡æ¯åˆ°boltdbçš„lease bucketä¸­ï¼Œä¸è¯¥Leaseå…³è”çš„èŠ‚ç‚¹éœ€è¦å®šæœŸå‘é€KeepAliveè¯·æ±‚ç»™etcd serverç»­çº¦Leaseã€‚&lt;/p&gt;
&lt;p&gt;etcdåœ¨å¯åŠ¨æ—¶ï¼Œä¼šåˆ›å»ºLessoræ¨¡å—ï¼Œé€šè¿‡ä¸¤ä¸ªå¼‚æ­¥ä»»åŠ¡ç®¡ç†Leaseï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä¸€ä¸ªRevokeExpiredLeaseä»»åŠ¡å®šæ—¶æ£€æµ‹æ˜¯å¦æœ‰è¿‡æœŸçš„Leaseï¼Œä½¿ç”¨æœ€å°å †ç®¡ç†Leaseï¼Œæ¯éš”500msè¿›è¡Œæ£€æŸ¥ï¼Œå‘èµ·æ’¤é”€è¿‡æœŸLeaseçš„æ“ä½œï¼Œè·å–åˆ°LeaseIdåé€šçŸ¥æ•´ä¸ªé›†ç¾¤åˆ é™¤Leaseå’Œå…³è”çš„æ•°æ®ï¼›è¿‡æœŸé»˜è®¤æ·˜æ±°é™é€Ÿæ˜¯æ¯ç§’1000ä¸ªã€‚&lt;/li&gt;
&lt;li&gt;å¦ä¸€ä¸ªæ˜¯CheckpointScheduledLeaseï¼Œå®šæ—¶(é»˜è®¤5min)è§¦å‘æ›´æ–°Leaseçš„å‰©ä½™åˆ°æœŸæ—¶é—´çš„æ“ä½œï¼Œå®šæœŸæ‰¹é‡å°†Leaseå‰©ä½™çš„TTLåŸºäºRaft LogåŒæ­¥ç»™FollowerèŠ‚ç‚¹ï¼Œæ›´æ–°å…¶LeaseMapä¸­å‰©ä½™çš„TTLä¿¡æ¯ï¼›å¦å¤–ï¼ŒLeaderèŠ‚ç‚¹æ”¶åˆ°KeepAliveè¯·æ±‚åï¼Œé‡ç½®TTLï¼Œå¹¶åŒæ­¥ç»™FollowerèŠ‚ç‚¹è¿›è¡Œæ›´æ–°ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Leaseç»­çº¦æ˜¯ä¸€ä¸ªé«˜é¢‘ç‡çš„æ“ä½œï¼Œå½“å®ŒæˆLeaseçš„åˆ›å»ºå’ŒèŠ‚ç‚¹æ•°æ®çš„å…³è”ï¼Œåœ¨æ­£å¸¸æƒ…å†µä¸‹ï¼ŒèŠ‚ç‚¹å­˜æ´»æ—¶ï¼Œéœ€è¦å®šæ—¶å‘é€KeepAliveè¯·æ±‚ç»™etcdç»­æœŸå¥åº·çŠ¶æ€çš„Leaseã€‚TTLæ—¶é—´è¿‡é•¿ä¼šå¯¼è‡´èŠ‚ç‚¹å¼‚å¸¸æ— æ³•ä»etcdä¸­åˆ é™¤ï¼Œè¿‡çŸ­ä¼šå¯¼è‡´clienté¢‘ç¹å‘é€ç»­çº¦è¯·æ±‚ã€‚å¦å¤–ï¼ŒLeaseçš„æ•°ç›®å¯èƒ½ä¼šå¾ˆå¤§ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œetcdåœ¨v3ç‰ˆæœ¬ä¸Šï¼Œä¸€ä¸ªæ˜¯é‡‡ç”¨grpcè§£å†³è¿æ¥å¤ç”¨é—®é¢˜ï¼Œå‡å°‘è¿æ¥æ•°ï¼Œå¦ä¸€ä¸ªæ˜¯å½“æœ‰ä¸åŒçš„keyçš„TTLç›¸åŒï¼Œä¼šå¤ç”¨åŒä¸€ä¸ªLeaseï¼Œå‡å°‘Leaseæ•°ç›®ã€‚&lt;/p&gt;
&lt;p&gt;Leaseæœ€å°çš„TTLæ—¶é—´æ˜¯ æ¯”é€‰ä¸¾çš„æ—¶é—´é•¿ï¼Œé»˜è®¤æ˜¯2s&lt;/p&gt;
&lt;h2 id=&#34;mvcc&#34;&gt;MVCC&lt;/h2&gt;
&lt;p&gt;MVCCç‰¹æ€§ç”±treeIndexã€Backend/boltdbç»„æˆï¼Œå®ç°å¯¹key-valueçš„å¢åˆ æŸ¥æ”¹åŠŸèƒ½ã€‚MVCCæ¨¡å—å°†è¯·æ±‚åˆ’åˆ†ä¸ºä¸¤ä¸ªç±»åˆ«ï¼Œåˆ†åˆ«æ˜¯è¯»äº‹åŠ¡ï¼ˆReadTxnï¼‰å’Œå†™äº‹åŠ¡ï¼ˆWriteTxnï¼‰ã€‚è¯»äº‹åŠ¡è´Ÿè´£å¤„ç†rangeè¯·æ±‚ï¼Œå†™äº‹åŠ¡è´Ÿè´£put/deleteæ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;TreeIndexä¸­keyçš„ç‰ˆæœ¬å·ä¸boltdbä¸­çš„valueå…³è”ã€‚&lt;/p&gt;
&lt;h3 id=&#34;treeindexæ¨¡å—&#34;&gt;TreeIndexæ¨¡å—&lt;/h3&gt;
&lt;p&gt;åŸºäºå†…å­˜ç‰ˆæœ¬çš„B-treeå®ç°Keyç´¢å¼•ç®¡ç†ï¼Œä¿å­˜ç”¨æˆ·keyä¸ç‰ˆæœ¬å·revisionçš„æ˜ å°„å…³ç³»ã€‚ä¹‹æ‰€ä»¥ä½¿ç”¨B-treeï¼Œæ˜¯å› ä¸ºetcdæ”¯æŒèŒƒå›´æŸ¥è¯¢ï¼ŒBæ ‘æ¯ä¸ªèŠ‚ç‚¹å¯ä»¥å®¹çº³æ¯”è¾ƒå¤šçš„æ•°æ®ï¼Œæ ‘é«˜åº¦ä½ï¼ŒæŸ¥æ‰¾æ¬¡æ•°å°‘ï¼Œsoä¸ç”¨å“ˆå¸Œè¡¨æˆ–å¹³è¡¡äºŒå‰æ ‘ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;keyIndex&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt;         &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;     &lt;span class=&#34;c1&#34;&gt;// keyå€¼
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;modified&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;revision&lt;/span&gt;   &lt;span class=&#34;c1&#34;&gt;// æœ€åä¸€æ¬¡ä¿®æ”¹keyæ—¶çš„etcdç‰ˆæœ¬å·
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;generations&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;generation&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;// ä¿å­˜ä¸€ä¸ªkeyè‹¥å¹²ä»£ç‰ˆæœ¬å·ä¿¡æ¯ï¼Œæ¯ä»£åŒ…å«å¯¹keyçš„å¤šæ¬¡ä¿®æ”¹ç‰ˆæœ¬å·åˆ—è¡¨
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;generation&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;ver&lt;/span&gt;      &lt;span class=&#34;kt&#34;&gt;int64&lt;/span&gt;         &lt;span class=&#34;c1&#34;&gt;// keyçš„ä¿®æ”¹æ¬¡æ•° 
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;created&lt;/span&gt;  &lt;span class=&#34;nx&#34;&gt;revision&lt;/span&gt;      &lt;span class=&#34;c1&#34;&gt;// generationç»“æ„åˆ›å»ºæ—¶çš„ç‰ˆæœ¬å·
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;revs&lt;/span&gt;     &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;revision&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// æ¯æ¬¡ä¿®æ”¹keyæ—¶çš„revisionè¿½åŠ åˆ°æ­¤æ•°ç»„
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;revision&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;main&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int64&lt;/span&gt;   &lt;span class=&#34;c1&#34;&gt;// å…¨å±€é€’å¢ä¸»ç‰ˆæœ¬å·ï¼Œéšput/txn/deleteäº‹åŠ¡é€’å¢ï¼Œä¸€ä¸ªäº‹åŠ¡å†…çš„key mainç‰ˆæœ¬å·ä¸€è‡´ï¼Œç©ºé›†ç¾¤æ—¶å¯åŠ¨æ—¶é»˜è®¤ä¸º1
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;sub&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;int64&lt;/span&gt;   &lt;span class=&#34;c1&#34;&gt;// äº‹åŠ¡å†…çš„å­ç‰ˆæœ¬å·ï¼Œä»0å¼€å§‹éšäº‹åŠ¡å†…put/deleteé€’å¢
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h3 id=&#34;backendboltdbæ¨¡å—&#34;&gt;Backend/boltdbæ¨¡å—&lt;/h3&gt;
&lt;p&gt;è´Ÿè´£etcdçš„key-valueæŒä¹…åŒ–å­˜å‚¨ï¼Œä¸»è¦ç”±ReadTxã€BatchTxã€Bufferç»„æˆï¼ŒReadTxå®šä¹‰äº†æŠ½è±¡çš„è¯»å†™äº‹åŠ¡æ¥å£ï¼ŒBatchTxåœ¨ReadTxä¹‹ä¸Šå®šä¹‰äº†æŠ½è±¡çš„å†™äº‹åŠ¡æ¥å£ï¼ŒBufferæ˜¯æ•°æ®ç¼“å­˜åŒºã€‚Backendæ”¯æŒå¤šç§å®ç°ï¼Œå½“å‰ä½¿ç”¨boltdbï¼ŒåŸºäºB+ treeå®ç°ï¼Œæ”¯æŒäº‹åŠ¡çš„key-valueåµŒå…¥å¼æ•°æ®åº“ã€‚&lt;/p&gt;
&lt;p&gt;valueçš„æ•°æ®ç»“æ„ï¼Œç‰ˆæœ¬å·æ ¼å¼&lt;code&gt;{main, sub}&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ï¼š&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ç”¨æˆ·çš„key&lt;/span&gt;
&lt;span class=&#34;nx&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ï¼š&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ç”¨æˆ·çš„value&lt;/span&gt;
&lt;span class=&#34;nx&#34;&gt;create_revision&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ï¼š&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;keyåˆ›å»ºæ—¶çš„ç‰ˆæœ¬å·&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ï¼Œ&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ä¸treeIndexä¸­generateçš„createdå¯¹åº”&lt;/span&gt;
&lt;span class=&#34;nx&#34;&gt;mod_revision&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ï¼š&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;keyæœ€åä¸€æ¬¡ä¿®æ”¹æ—¶çš„ç‰ˆæœ¬å·&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ï¼Œ&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;putæ“ä½œæ—¶çš„å…¨å±€ç‰ˆæœ¬å·&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ä½œä¸ºè¯¥å€¼&lt;/span&gt;
&lt;span class=&#34;nx&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ï¼š&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;keyçš„ä¿®æ”¹æ¬¡æ•°&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ï¼Œ&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;æ¯æ¬¡ä¿®æ”¹æ—¶&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ï¼Œ&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ä¸treeIndexä¸­generateçš„verå€¼&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;
&lt;span class=&#34;nx&#34;&gt;lease&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ï¼š&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ä¸€èˆ¬æƒ…å†µä¸‹ä¸ºäº†etcdçš„å†™æ€§èƒ½ï¼Œé»˜è®¤å †ç§¯çš„å†™äº‹åŠ¡æ•°å¤§äº1ä¸‡æ‰åœ¨äº‹åŠ¡ç»“æŸæ—¶åŒæ­¥æŒä¹…åŒ–ï¼Œç”±backendçš„ä¸€ä¸ªgoroutineå®Œæˆï¼Œé€šè¿‡äº‹åŠ¡æ‰¹é‡æäº¤ï¼Œå®šæ—¶å°†boltdbé¡µç¼“å­˜ä¸­çš„è„æ•°æ®æäº¤åˆ°æŒä¹…åŒ–å­˜å‚¨ç£ç›˜ä¸­ã€‚&lt;/p&gt;
&lt;h3 id=&#34;åˆ›å»ºæ›´æ–°æ“ä½œ&#34;&gt;åˆ›å»º/æ›´æ–°æ“ä½œ&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;åœ¨treeIndexä¸­è·å–keyçš„KeyIndexä¿¡æ¯&lt;/li&gt;
&lt;li&gt;å¡«å……boltdbçš„valueæ•°æ®ï¼Œå†™å…¥æ–°çš„key-valueåˆ°blotdbå’Œbufferä¸­&lt;/li&gt;
&lt;li&gt;åˆ›å»º/æ›´æ–°KeyIndexåˆ°treeIndexä¸­&lt;/li&gt;
&lt;li&gt;backendå¼‚æ­¥äº‹åŠ¡æäº¤ï¼Œå°†boltdbä¸­çš„æ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜ä¸­&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;æŸ¥è¯¢æ“ä½œ&#34;&gt;æŸ¥è¯¢æ“ä½œ&lt;/h3&gt;
&lt;p&gt;åˆ›å»ºä¸€ä¸ªè¯»äº‹åŠ¡å¯¹è±¡(TxnRead / ConcurrentReadTx)ï¼Œå…¨é‡æ‹·è´å½“å‰å†™äº‹åŠ¡æœªæäº¤çš„bufferæ•°æ®ï¼Œè¯»ä¸åˆ°åˆ™ä»boltdbä¸­æŸ¥è¯¢&lt;/p&gt;
&lt;h3 id=&#34;åˆ é™¤æ“ä½œ&#34;&gt;åˆ é™¤æ“ä½œ&lt;/h3&gt;
&lt;p&gt;åˆ é™¤æ“ä½œæ˜¯è½¯åˆ é™¤ï¼ŒåŸç†ç±»ä¼¼æ›´æ–°ï¼Œä¼šåœ¨è¢«åˆ é™¤çš„keyç‰ˆæœ¬å·è¿½åŠ åˆ é™¤æ ‡å¿—tï¼Œå¯¹åº”çš„boltdb valueä¹Ÿå˜æˆäº†åªåŒ…å«ç”¨æˆ·keyçš„KeyValueç»“æ„ï¼ŒtreeIndexæ¨¡å—ä¹Ÿä¼šç»™æ­¤keyçš„KeyIndexç»“æ„è¿½åŠ ä¸€ä¸ªç©ºçš„generationå¯¹è±¡ï¼Œæ ‡è¯†æ­¤ç´¢å¼•å¯¹åº”çš„keyè¢«åˆ é™¤ï¼Œå½“æŸ¥è¯¢æ—¶å‘ç°å…¶å­˜åœ¨ç©ºçš„generationå¯¹è±¡ï¼Œå¹¶ä¸”æŸ¥è¯¢çš„ç‰ˆæœ¬å·å¤§äºç­‰äºè¢«åˆ é™¤çš„ç‰ˆæœ¬å·æ—¶ï¼Œè¿”å›ç©ºã€‚&lt;/p&gt;
&lt;p&gt;åˆ é™¤keyæ—¶ä¼šç”Ÿæˆeventsï¼ŒWatchæ¨¡å—ä¼šæ ¹æ®keyçš„åˆ é™¤æ ‡è¯†ï¼Œç”Ÿæˆå¯¹åº”çš„Deleteäº‹ä»¶ï¼›æˆ–è€…å½“é‡å¯etcdï¼Œéå†boltdbä¸­çš„keyæ„å»ºtreeIndexå†…å­˜æ ‘æ—¶ï¼Œæœªè¿™äº›keyä¸Šæ¬¡tombstoneæ ‡è¯†ã€‚&lt;/p&gt;
&lt;p&gt;çœŸæ­£åˆ é™¤treeIndexä¸­çš„KeyIndexã€boltdbçš„valueæ˜¯é€šè¿‡å‹ç¼©ç»„ä»¶å¼‚æ­¥å®Œæˆï¼Œä¹‹æ‰€ä»¥è¦å»¶è¿Ÿåˆ é™¤ï¼Œä¸€ä¸ªæ˜¯ä¸ºäº†watcherèƒ½å¤Ÿæœ‰ç›¸åº”çš„å¤„ç†ï¼Œå¦ä¸€ä¸ªæ˜¯å‡å°‘B treeå¹³è¡¡å½±å“è¯»å†™æ€§èƒ½ã€‚&lt;/p&gt;
&lt;h2 id=&#34;watch&#34;&gt;Watch&lt;/h2&gt;
&lt;p&gt;å®¢æˆ·ç«¯è®¢é˜…etcdçš„æŸä¸ªkeyï¼Œå½“keyå‘ç”Ÿå˜åŒ–æ—¶ï¼Œå®¢æˆ·ç«¯èƒ½å¤Ÿæ„ŸçŸ¥ã€‚è¿™ä¹Ÿæ˜¯Kubernetesæ§åˆ¶å™¨çš„å·¥ä½œåŸºç¡€ã€‚&lt;/p&gt;
&lt;h3 id=&#34;clientè·å–äº‹ä»¶çš„æ–¹å¼&#34;&gt;clientè·å–äº‹ä»¶çš„æ–¹å¼&lt;/h3&gt;
&lt;p&gt;V2ç‰ˆæœ¬ï¼šä½¿ç”¨è½®è¯¢æ¨é€ï¼Œæ¯ä¸€ä¸ªwatcherå¯¹åº”ä¸€ä¸ªTCPè¿æ¥ï¼Œclienté€šè¿‡HTTP/1.1åè®®é•¿è¿æ¥å®šæ—¶è½®è¯¢serverï¼Œè·å–æœ€æ–°æ•°æ®å˜åŒ–äº‹ä»¶ã€‚ä½†æ˜¯å¤§é‡çš„è½®è¯¢ä¼šäº§ç”Ÿä¸€å®šçš„QPSï¼Œserverç«¯ä¼šæ¶ˆè€—å¤§é‡çš„socketã€å†…å­˜ç­‰èµ„æºã€‚&lt;/p&gt;
&lt;p&gt;V3ç‰ˆæœ¬ï¼šä½¿ç”¨æµå¼æ¨é€ï¼Œå› ä¸ºä½¿ç”¨çš„æ˜¯åŸºäºHTTP/2çš„gRpcåè®®ï¼Œå®ç°äº†ä¸€ä¸ªTCPè¿æ¥æ”¯æŒå¤šgRPC streamï¼Œä¸€ä¸ªgRPC streamåˆæ”¯æŒå¤šä¸ªwatcherï¼Œé™ä½äº†ç³»ç»Ÿèµ„æºçš„æ¶ˆè€—ã€‚&lt;/p&gt;
&lt;h3 id=&#34;äº‹ä»¶çš„å­˜å‚¨å’Œä¿ç•™&#34;&gt;äº‹ä»¶çš„å­˜å‚¨å’Œä¿ç•™&lt;/h3&gt;
&lt;p&gt;V2ç‰ˆæœ¬ï¼šæ»‘åŠ¨çª—å£ï¼Œä½¿ç”¨ç¯å½¢æ•°ç»„å­˜å‚¨å†å²äº‹ä»¶ç‰ˆæœ¬ï¼Œå½“keyè¢«ä¿®æ”¹åï¼Œç›¸å…³çš„äº‹ä»¶å°±ä¼šè¢«æ·»åŠ åˆ°æ•°ç»„ä¸­æ¥ï¼Œè‹¥è¶…è¿‡ä¸€å®šå®¹é‡ï¼ˆé»˜è®¤1000ï¼‰ï¼Œåˆ™ä¼šæ·˜æ±°æ—§äº‹ä»¶ï¼Œå®¹æ˜“å¯¼è‡´äº‹ä»¶ä¸¢å¤±ï¼Œå½“äº‹ä»¶ä¸¢å¤±æ—¶ï¼Œclientéœ€è¦è·å–æœ€æ–°çš„ç‰ˆæœ¬å·æ‰èƒ½ç»§ç»­ç›‘å¬ï¼ŒæŸ¥è¯¢æˆæœ¬æ¯”è¾ƒå¤§ã€‚&lt;/p&gt;
&lt;p&gt;V3ç‰ˆæœ¬ï¼šMVCCï¼Œå°†äº‹ä»¶ä¿å­˜åˆ°boltdbä¸­ï¼ŒæŒä¹…åŒ–åˆ°ç£ç›˜ä¸­ï¼Œé€šè¿‡é…ç½®å‹ç¼©ç­–ç•¥æ§åˆ¶å†å²ç‰ˆæœ¬æ•°ã€‚&lt;/p&gt;
&lt;p&gt;ç‰ˆæœ¬å·æ˜¯etcdçš„é€»è¾‘æ—¶é’Ÿï¼Œå½“clientå› ç½‘ç»œç­‰å¼‚å¸¸è¿æ¥æ–­å¼€åï¼Œé€šè¿‡ç‰ˆæœ¬å·å¯ä»¥ä»serverçš„boltdbè·å–é”™è¿‡çš„å†å²äº‹ä»¶ï¼Œè€Œæ— éœ€å…¨é‡åŒæ­¥ï¼Œå®ƒæ˜¯etcd Watchæœºåˆ¶æ•°æ®é‡å¢é‡åŒæ­¥çš„æ ¸å¿ƒã€‚&lt;/p&gt;
&lt;h3 id=&#34;äº‹ä»¶æ¨é€æœºåˆ¶&#34;&gt;äº‹ä»¶æ¨é€æœºåˆ¶&lt;/h3&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/etcd%e4%ba%8b%e4%bb%b6%e6%8e%a8%e9%80%81%e6%9e%b6%e6%9e%84.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/etcd%e4%ba%8b%e4%bb%b6%e6%8e%a8%e9%80%81%e6%9e%b6%e6%9e%84.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;clientå¯¹æ¯ä¸€ä¸ªkeyå‘èµ·çš„watchè¯·æ±‚ï¼Œetcdçš„gRPCWatchServeræ”¶åˆ°watchè¯·æ±‚åï¼Œä¼šåˆ›å»ºä¸€ä¸ªserverWatchStreamï¼Œå®ƒè´Ÿè´£æ¥æ”¶clientçš„gRPC Streamçš„create/cancel watcherè¯·æ±‚ï¼ˆrecvLoop goroutine)ï¼Œå¹¶å°†ä»MVCCæ¨¡å—æ¥æ”¶çš„watchäº‹ä»¶è½¬å‘ç»™clientï¼ˆsendLoop goroutineï¼‰&lt;/p&gt;
&lt;p&gt;å½“serverWatchStreamæ”¶åˆ°create watcherè¯·æ±‚åï¼ŒserverWatchStreamä¼šè°ƒç”¨MVCCæ¨¡å—çš„WatchStreamå­æ¨¡å—åˆ†é…ä¸€ä¸ªwatcher idï¼Œå¹¶å°†watcheræ³¨å†Œåˆ°MVCCçš„WatchableKVæ¨¡å—ã€‚&lt;/p&gt;
&lt;p&gt;watchableStoreå°†watcheråˆ’åˆ†ä¸ºsynced / unsynced / victimä¸‰ç±»&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;synced watcherï¼šå¦‚æœåˆ›å»ºçš„watcheræœªæŒ‡å®šç‰ˆæœ¬å·æˆ–ç‰ˆæœ¬å·ä¸º0æˆ–æŒ‡å®šç‰ˆæœ¬å·å¤§äºetcd serverå½“å‰çš„æœ€æ–°ç‰ˆæœ¬å·ï¼Œé‚£å®ƒå°±ä¼šä¿å­˜åœ¨ synced watcherGroupä¸­ï¼Œè¡¨ç¤ºæ­¤ç±»watcherç›‘å¬çš„æ•°æ®éƒ½å·²ç»åŒæ­¥å®Œæ¯•ï¼Œç­‰å¾…æ–°çš„å˜æ›´ã€‚&lt;/li&gt;
&lt;li&gt;unsynced watcherï¼šå¦‚æœåˆ›å»ºçš„watcheræŒ‡å®šçš„ç‰ˆæœ¬å·å°äºetcd serverå½“å‰æœ€æ–°ç‰ˆæœ¬å·ï¼Œé‚£å®ƒå°±ä¼šä¿å­˜åœ¨ unsynced watcherGroupä¸­ï¼Œè¡¨ç¤ºæ­¤ç±»watcherç›‘å¬çš„æ•°æ®è¿˜æœªåŒæ­¥å®Œæˆï¼Œè½åäºå½“å‰æœ€æ–°æ•°æ®çš„å˜æ›´ï¼Œæ­£åœ¨ç­‰å¾…åŒæ­¥ã€‚&lt;/li&gt;
&lt;li&gt;victimï¼šå½“æ¥æ”¶watchäº‹ä»¶çš„channelçš„bufferæ»¡äº†ï¼Œè¯¥watcherä¼šä»synced watcherGroupä¸­åˆ é™¤ï¼Œç„¶åä¿å­˜åˆ°victimçš„watcherBatchä¸­ï¼Œé€šè¿‡å¼‚æ­¥æœºåˆ¶é‡è¯•ä¿è¯äº‹ä»¶å¯é æ€§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å½“etcdå¯åŠ¨æ—¶ï¼ŒWatchableKVæ¨¡å—ä¼šè¿è¡ŒsyncWatcherLoopå’ŒsyncVictimsLoop goroutineï¼Œåˆ†åˆ«è´Ÿè´£ä¸åŒåœºæ™¯ä¸‹çš„äº‹ä»¶æ¨é€ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;syncWatcherLoopï¼šéå†unsynced watcherGroupä¸­çš„æ¯ä¸ªwatcherï¼Œè·å–keyçš„æ‰€æœ‰å†å²ç‰ˆæœ¬ï¼Œè½¬æˆäº‹ä»¶ï¼Œæ¨é€ç»™æ¥æ”¶çš„channelï¼Œå®Œæˆåå°†watcherä»unsynced watcherGroupè½¬ç§»åˆ°synced watcherGroupã€‚&lt;/li&gt;
&lt;li&gt;syncVictimsLoopï¼šéå†victim watcherBatchï¼Œå°è¯•å°†å †ç§¯çš„äº‹ä»¶å†æ¬¡æ¨é€åˆ°watcherçš„æ¥æ”¶channelä¸­ï¼Œè‹¥æ¨é€å¤±è´¥åˆ™å†æ¬¡åŠ å…¥ç­‰å¾…é‡è¯•ï¼›è‹¥æ¨é€æˆåŠŸï¼Œwatcherç›‘å¬çš„æœ€å°ç‰ˆæœ¬å·å°äºå½“å‰ç‰ˆæœ¬å·ï¼Œåˆ™åŠ å…¥unsynced watcherGroupä¸­ï¼Œå¤§äºåˆ™åŠ å…¥synced watcherGroupä¸­ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;é«˜æ•ˆçš„æ‰¾åˆ°ç›‘å¬keyçš„æ‰€æœ‰watcher&#34;&gt;é«˜æ•ˆçš„æ‰¾åˆ°ç›‘å¬keyçš„æ‰€æœ‰watcher&lt;/h3&gt;
&lt;p&gt;ç”±äºwatcherå¯ä»¥ç›‘å¬keyèŒƒå›´ã€keyå‰ç¼€ï¼Œ&lt;/p&gt;
&lt;p&gt;å½“æ”¶åˆ°åˆ›å»ºwatcherè¯·æ±‚æ—¶ï¼Œä¼šæŠŠwatcherç›‘å¬çš„keyçš„èŒƒå›´æ’å…¥åˆ°åŒºé—´æ ‘ä¸­ï¼Œå½“äº§ç”Ÿä¸€ä¸ªäº‹ä»¶æ—¶ï¼Œetcdé¦–å…ˆä¼šä»mapä¸­æ‰¾åˆ°æ˜¯å¦æœ‰watcherç›‘å¬äº†è¯¥keyï¼Œå…¶æ¬¡è¿˜è¦ä»åŒºé—´æ ‘ä¸­æ‰¾åˆ°ä¸keyç›¸äº¤çš„æ‰€æœ‰åŒºé—´ï¼Œå¾—åˆ°æ‰€æœ‰watcherã€‚&lt;/p&gt;
&lt;h2 id=&#34;äº‹åŠ¡&#34;&gt;äº‹åŠ¡&lt;/h2&gt;
&lt;p&gt;etcdäº‹åŠ¡APIç”±IFã€Thenã€Elseè¯­å¥ç»„æˆã€‚&lt;/p&gt;
&lt;p&gt;etcdé€šè¿‡WALæ—¥å¿— + consistent index + boltdbä¿è¯åŸå­æ€§ï¼›&lt;/p&gt;
&lt;p&gt;WALæ—¥å¿—+boltdbä¿è¯æŒä¹…æ€§ï¼›&lt;/p&gt;
&lt;p&gt;æ•°æ®åº“å’Œä¸šåŠ¡ç¨‹åºä¿è¯ä¸€è‡´æ€§ï¼›&lt;/p&gt;
&lt;p&gt;é€šè¿‡MVCCæœºåˆ¶å®ç°è¯»å†™ä¸é˜»å¡ï¼Œè§£å†³éš”ç¦»æ€§çš„è„è¯»é—®é¢˜ï¼›MVCCå¿«ç…§è¯»è§£å†³éš”ç¦»æ€§çš„ä¸å¯é‡å¤è¯»é—®é¢˜ï¼›MVCCç‰ˆæœ¬å·å®ç°å†²çªæ£€æµ‹æœºåˆ¶ï¼Œåœ¨ä¸²è¡Œæäº¤äº‹åŠ¡æ—¶ä¿è¯è¯»å†™çš„æ•°æ®éƒ½æ˜¯æœ€æ–°çš„ï¼Œæœªè¢«ä»–äººä¿®æ”¹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;boltdb&#34;&gt;boltdb&lt;/h2&gt;
&lt;h3 id=&#34;ç£ç›˜å¸ƒå±€&#34;&gt;ç£ç›˜å¸ƒå±€&lt;/h3&gt;
&lt;p&gt;boltdbæ–‡ä»¶å­˜æ”¾åœ¨etcdæ•°æ®ç›®å½•ä¸‹çš„member/snap/dbæ–‡ä»¶ï¼Œetcdå¯åŠ¨æ—¶ï¼Œä¼šé€šè¿‡mmapæœºåˆ¶å°†dbæ–‡ä»¶æ˜ å°„åˆ°å†…å­˜ï¼Œåç»­ä»å†…å­˜ä¸­å¿«é€Ÿè¯»å–æ–‡ä»¶ä¸­çš„æ•°æ®ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/etcd_boltdb%e6%96%87%e4%bb%b6%e5%b8%83%e5%b1%80.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/etcd_boltdb%e6%96%87%e4%bb%b6%e5%b8%83%e5%b1%80.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;å¼€å¤´ä¸¤ä¸ªæ˜¯å›ºå®šçš„dbå…ƒæ•°æ®meta pageï¼›freeList pageè®°å½•dbä¸­å“ªäº›é¡µæ˜¯ç©ºé—²çš„ï¼Œå¯ä½¿ç”¨çš„ï¼›&lt;/p&gt;
&lt;p&gt;å†™æ“ä½œæ—¶ï¼Œä¼šå…ˆæ‰“å¼€dbæ–‡ä»¶å¹¶å¢åŠ æ–‡ä»¶é”ï¼Œé˜²æ­¢å…¶ä»–è¿›ç¨‹ä»¥è¯»å†™æ¨¡å¼æ‰“å¼€åæ“ä½œmetaå’Œfree pageï¼Œå¯¼è‡´dbæ–‡ä»¶æŸåï¼›ç„¶åé€šè¿‡mmapæœºåˆ¶å°†dbæ–‡ä»¶æ˜ å°„åˆ°å†…å­˜ä¸­ï¼Œå¹¶è¯»å–ä¸¤ä¸ªmeta pageåˆ°dbå¯¹è±¡å®ä¾‹ï¼Œæ ¡éªŒmeta pageçš„magic versionã€checksumæ˜¯å¦æœ‰æ•ˆï¼Œè‹¥ä¸¤ä¸ªmeta pageéƒ½æ— æ•ˆï¼Œè¯´æ˜dbæ–‡ä»¶æŸåï¼Œå°†å¼‚å¸¸é€€å‡ºã€‚&lt;/p&gt;
&lt;p&gt;æ‰§è¡Œputè¯·æ±‚å‰ä¼šå…ˆæ‰§è¡Œbucketè¯·æ±‚ï¼Œå…ˆæ ¹æ®meta pageä¸­è®°å½•root bucketçš„root pageï¼ŒæŒ‰ç…§B+æ ‘çš„æŸ¥æ‰¾ç®—æ³•ï¼Œä»root pageé€’å½’æœç´¢åˆ°å¯¹åº”å¶å­èŠ‚ç‚¹pageé¢ï¼Œè¿”å›keyåç§°ï¼Œleafç±»å‹ï¼›å¦‚æœleafç±»å‹æœªbucketLeafFlagï¼Œä¸”keyç›¸ç­‰ï¼Œè¯´æ˜å·²ç»åˆ›å»ºè¿‡ï¼Œä¸å…è®¸bucketé‡å¤åˆ›å»ºï¼Œå¦åˆ™å¾€B+æ ‘ç§æ·»åŠ ä¸€ä¸ªflagä¸ºbucketLeafFlagçš„keyï¼Œkeyçš„åç§°ä¸ºbucket nameï¼Œvalueä¸ºbucketç»“æ„ï¼›&lt;/p&gt;
&lt;p&gt;æ‰§è¡Œå®Œbucketè¯·æ±‚ï¼Œå°±ä¼šè¿›è¡Œputè¯·æ±‚ï¼Œè·Ÿåˆ›å»ºbucketç±»ä¼¼ï¼Œæ ¹æ®å­bucketçš„root pageï¼Œä»root pageé€’å½’æœç´¢æ­¤keyåˆ°leaf pageï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™åœ¨è¿”å›çš„ä½ç½®æ’å…¥æ–°keyå’Œvalueï¼Œæ’å…¥ä½ç½®çš„æŸ¥æ‰¾ä½¿ç”¨äºŒåˆ†æ³•ã€‚&lt;/p&gt;
&lt;p&gt;å½“æ‰§è¡Œå®Œä¸€ä¸ªputè¯·æ±‚æ—¶ï¼Œå€¼åªæ˜¯æ›´æ–°åˆ°boltdbçš„å†…å­˜nodeæ•°æ®ç»“æ„é‡Œï¼Œæ­¤æ—¶è¿˜æœªæŒä¹…åŒ–ã€‚å½“ä»£ç æ‰§è¡Œåˆ°tx.commit apiæ—¶ï¼Œæ‰ä¼šå°†nodeå†…å­˜æ•°æ®ç»“æ„ä¸­çš„æ•°æ®æŒä¹…åŒ–åˆ°boltdbä¸­ã€‚ä¸€èˆ¬æ˜¯ç»è¿‡ åˆ é™¤èŠ‚ç‚¹åé‡å¹³è¡¡æ“ä½œã€åˆ†è£‚æ“ä½œã€æŒä¹…åŒ–freelistã€æŒä¹…åŒ–dirty pageã€æŒä¹…åŒ–meta pageã€‚&lt;/p&gt;
&lt;h2 id=&#34;å‹ç¼©&#34;&gt;å‹ç¼©&lt;/h2&gt;
&lt;p&gt;ç”±äºæ›´æ–°å’Œåˆ é™¤éƒ½ä¼šå¢åŠ ç‰ˆæœ¬å·ï¼Œå†…å­˜å ç”¨å’Œdbæ–‡ä»¶å°±ä¼šè¶Šæ¥è¶Šå¤§ï¼Œå½“è¾¾åˆ°etcd OOMå’Œdbå¤§å°çš„æœ€å¤§é…é¢æ—¶ï¼Œæœ€ç»ˆä¸å¯å†™å…¥ï¼Œå› æ­¤éœ€è¦é€‚åˆçš„å‹ç¼©ç­–ç•¥ï¼Œé¿å…dbå¤§å°å¢é•¿å¤±æ§ã€‚&lt;/p&gt;
&lt;p&gt;å‹ç¼©æ˜¯ä½¿ç”¨Compactæ¥å£ï¼Œå¯ä»¥è®¾ç½®è‡ªåŠ¨ä¹Ÿå¯é€šè¿‡ä¸šåŠ¡æœåŠ¡æ‰‹åŠ¨è°ƒç”¨ï¼Œå‹ç¼©æ—¶é¦–å…ˆä¼šæ£€æŸ¥è¯·æ±‚çš„ç‰ˆæœ¬å·revæ˜¯å¦è¢«å‹ç¼©è¿‡ï¼Œç„¶åæ›´æ–°å½“å‰serverå·²å‹ç¼©çš„ç‰ˆæœ¬å·ï¼Œå¹¶å°†è€—æ—¶çš„å‹ç¼©ä»»åŠ¡ä¿å­˜åœ¨FIFOé˜Ÿåˆ—ç§å¼‚æ­¥æ‰§è¡Œã€‚å‹ç¼©ä»»åŠ¡æ‰§è¡Œæ—¶ï¼Œé¦–å…ˆä¼šå‹ç¼©treeIndexæ¨¡å—ä¸­çš„keyIndexç´¢å¼•ï¼Œå…¶æ¬¡ä¼šéå†boltdbä¸­çš„keyï¼Œåˆ é™¤å·²åºŸå¼ƒçš„keyï¼Œéå†boltdbæ—¶ä¼šæ§åˆ¶åˆ é™¤çš„keyæ•°100ä¸ªï¼Œæ¯æ‰¹é—´éš”10msï¼Œåˆ†æ‰¹å®Œæˆåˆ é™¤æ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;å‹ç¼©è¿‡ç¨‹ä¸­ï¼Œcompactæ¥å£ä¼šæŒä¹…åŒ–å­˜å‚¨å½“å‰å·²è°ƒåº¦çš„å‹ç¼©ç‰ˆæœ¬å·åˆ°boltdbï¼Œä¿è¯å½“å‘ç”Ÿcrashåå„ä¸ªèŠ‚ç‚¹é—´çš„æ•°æ®ä¸€è‡´æ€§ã€‚&lt;/p&gt;
&lt;p&gt;å‹ç¼©æ—¶ä¼šä¿ç•™keyIndexä¸­çš„æœ€å¤§ç‰ˆæœ¬å·(ä¸ºäº†ä¿è¯keyä»å­˜åœ¨)ï¼Œç§»é™¤å°äºç­‰äºå½“å‰å‹ç¼©çš„ç‰ˆæœ¬å·ï¼Œé€šè¿‡ä¸€ä¸ªmapè®°å½•treeIndexä¸­æœ‰æ•ˆçš„ç‰ˆæœ¬å·è¿”å›ç»™boltdbæ¨¡å—ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;éå†åˆ é™¤boltdbä¸­çš„æ•°æ®åï¼Œdbæ–‡ä»¶ä¸ä¼šå˜å°ï¼Œè€Œæ˜¯é€šè¿‡freelist pageè®°å½•å“ªäº›é¡µæ˜¯ç©ºé—²çš„ï¼Œè¦†ç›–ä½¿ç”¨&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨å‚æ•°&lt;code&gt;--auto-compaction-retention &#39;[0|1]&#39;&lt;/code&gt;0è¡¨ç¤ºå…³é—­è‡ªåŠ¨å‹ç¼©ï¼Œ1 è¡¨ç¤ºå¼€å¯è‡ªåŠ¨å‹ç¼©ç­–ç•¥ï¼Œä½¿ç”¨å‚æ•°&lt;code&gt;--auto-compaction-mode &#39;[periodic|revision]&#39;&lt;/code&gt;ï¼Œperiodicè¡¨ç¤ºå‘¨æœŸæ€§å‹ç¼©ï¼Œrevisionè¡¨ç¤ºç‰ˆæœ¬å·å‹ç¼©&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;æ—¶é—´å‘¨æœŸæ€§å‹ç¼©ï¼šåªä¿ç•™æœ€è¿‘ä¸€æ®µæ—¶é—´å†™å…¥çš„å†å²ç‰ˆæœ¬ï¼Œperiodic compactorä¼šæ ¹æ®è®¾ç½®çš„å‹ç¼©æ—¶é—´é—´éš”ï¼Œåˆ’åˆ†ä¸º10ä¸ªåŒºé—´ï¼Œé€šè¿‡etcd MVCCæ¨¡å—è·å–å½“å‰çš„serverç‰ˆæœ¬å·ï¼Œè¿½åŠ åˆ°revæ•°ç»„ä¸­ï¼Œé€šè¿‡å½“å‰æ—¶é—´å‡å»ä¸Šä¸€æ¬¡æ‰§è¡Œcompactæ“ä½œçš„æ—¶é—´ï¼Œå¦‚æœé—´éš”å¤§äºè®¾ç½®çš„å‹ç¼©æ—¶é—´ï¼Œåˆ™å–å‡ºrevæ•°ç»„é¦–å…ƒç´ ï¼Œå‘èµ·å‹ç¼©ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç‰ˆæœ¬å·å‹ç¼©ï¼šä¿ç•™æœ€è¿‘å¤šå°‘ä¸ªå†å²ç‰ˆæœ¬ï¼Œrevision compactorä¼šæ ¹æ®è®¾ç½®çš„ä¿ç•™ç‰ˆæœ¬å·æ•°ï¼Œæ¯éš”5åˆ†é’Ÿå®šæ—¶è·å–å½“å‰serveræœ€å¤§ç‰ˆæœ¬å·ï¼Œå‡å»æƒ³ä¿ç•™çš„å†å²ç‰ˆæœ¬æ•°ï¼Œå¾—åˆ°è¦å‹ç¼©çš„å†å²ç‰ˆæœ¬ï¼Œå‘èµ·å‹ç¼©ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h1&gt;
&lt;p&gt;æå®¢æ—¶é—´ - etcdå®æˆ˜è¯¾&lt;/p&gt;
</description>
        </item>
        <item>
        <title>æ¶ˆæ¯é˜Ÿåˆ—</title>
        <link>http://nixum.cc/p/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/</link>
        <pubDate>Tue, 22 Sep 2020 00:00:00 +0000</pubDate>
        
        <guid>http://nixum.cc/p/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/</guid>
        <description>&lt;p&gt;[TOC]&lt;/p&gt;
&lt;h1 id=&#34;ä½¿ç”¨åœºæ™¯&#34;&gt;ä½¿ç”¨åœºæ™¯&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;ç§’æ€ç³»ç»Ÿï¼Œä¸€èˆ¬ç§’æ€ç³»ç»Ÿå¤„ç†åŒ…å«å‡ ä¸ªæ­¥éª¤ï¼šé£é™©æ§åˆ¶ã€åº“å­˜é”å®šã€ç”Ÿæˆè®¢å•ã€çŸ­ä¿¡é€šçŸ¥ã€æ›´æ–°ç»Ÿè®¡æ•°æ®ç­‰ï¼Œè€Œå†³å®šç§’æ€æ˜¯å¦æˆåŠŸåªåœ¨å‰ä¸¤ä¸ªæ­¥éª¤ï¼Œåç»­çš„æ“ä½œå°±å¯ä»¥é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—&lt;strong&gt;å¼‚æ­¥&lt;/strong&gt;å¤„ç†å®Œæˆï¼ŒåŠ å¿«æ•´ä¸ªæµç¨‹çš„å¤„ç†ï¼Œ&lt;strong&gt;å‡å°‘ç­‰å¾…æ—¶é—´ï¼Œæå‡å¹¶å‘é‡&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;éš”ç¦»ç½‘å…³å’Œåç«¯æœåŠ¡ï¼Œå®ç°&lt;strong&gt;æµé‡æ§åˆ¶ï¼Œä¿æŠ¤&lt;/strong&gt;åç«¯æœåŠ¡ï¼Œä½†ä¼šå¢åŠ ç³»ç»Ÿè°ƒç”¨é“¾ï¼Œå¯¼è‡´æ€»ä½“å“åº”å˜é•¿ï¼Œå¼‚æ­¥å¢åŠ ç³»ç»Ÿå¤æ‚æ€§ã€‚&lt;/li&gt;
&lt;li&gt;ä»¤ç‰Œæ¡¶ï¼Œç›®çš„ä¹Ÿæ˜¯è¿›è¡Œæµé‡æ§åˆ¶ã€‚&lt;/li&gt;
&lt;li&gt;æœåŠ¡è§£è€¦ï¼Œæ•°æ®åŒæ­¥ï¼Œæ¯”å¦‚è®¢å•ç³»ç»Ÿåœ¨è®¢å•çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶å‘å‡ºæ¶ˆæ¯é€šçŸ¥ï¼Œå…¶ä»–æœåŠ¡è®¢é˜…ååšç›¸åº”å¤„ç†ã€‚&lt;/li&gt;
&lt;li&gt;è¿æ¥æµè®¡ç®—ä»»åŠ¡å’Œæ•°æ®ï¼Œæ¯”å¦‚é›†ç¾¤æ—¥å¿—å¤„ç†ï¼Œå¤§æ•°æ®ç»Ÿè®¡&lt;/li&gt;
&lt;li&gt;å°†æ¶ˆæ¯å¹¿æ’­ç»™å…¶ä»–æ¥æ”¶è€…&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;å¥½å¤„&#34;&gt;å¥½å¤„&lt;/h2&gt;
&lt;p&gt;æµé‡å‰Šå³°å’Œæµé‡æ§åˆ¶ã€å¼‚æ­¥å¤„ç†ã€è§£è€¦ã€å¹¿æ’­ã€æœ€ç»ˆä¸€è‡´æ€§&lt;/p&gt;
&lt;h2 id=&#34;ç¼ºç‚¹&#34;&gt;ç¼ºç‚¹&lt;/h2&gt;
&lt;p&gt;å¯ç”¨æ€§é™ä½ã€å¤æ‚åº¦æé«˜ã€ä¸€è‡´æ€§é—®é¢˜ã€æ¶ˆæ¯å»¶è¿Ÿ&lt;/p&gt;
&lt;h1 id=&#34;å¸¸è§æ¶ˆæ¯é˜Ÿåˆ—&#34;&gt;å¸¸è§æ¶ˆæ¯é˜Ÿåˆ—&lt;/h1&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç‰¹æ€§&lt;/th&gt;
&lt;th&gt;ActiveMQ&lt;/th&gt;
&lt;th&gt;RabbitMQ&lt;/th&gt;
&lt;th&gt;RocketMQ&lt;/th&gt;
&lt;th&gt;Kafaka&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;å•æœºååé‡&lt;/td&gt;
&lt;td&gt;ä¸‡çº§ï¼Œååé‡æ¯”RocketMQå’ŒKafkaè¦ä½äº†ä¸€ä¸ªæ•°é‡çº§&lt;/td&gt;
&lt;td&gt;ä¸‡çº§ï¼Œååé‡æ¯”RocketMQå’ŒKafkaè¦ä½äº†ä¸€ä¸ªæ•°é‡çº§&lt;/td&gt;
&lt;td&gt;10ä¸‡çº§ï¼ŒRocketMQä¹Ÿæ˜¯å¯ä»¥æ”¯æ’‘é«˜ååçš„ä¸€ç§MQ&lt;/td&gt;
&lt;td&gt;10ä¸‡çº§åˆ«ï¼Œè¿™æ˜¯kafkaæœ€å¤§çš„ä¼˜ç‚¹ï¼Œå°±æ˜¯ååé‡é«˜ã€‚ä¸€èˆ¬é…åˆå¤§æ•°æ®ç±»çš„ç³»ç»Ÿæ¥è¿›è¡Œå®æ—¶æ•°æ®è®¡ç®—ã€æ—¥å¿—é‡‡é›†ç­‰åœºæ™¯&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;topicæ•°é‡å¯¹ååé‡çš„å½±å“&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;ä½¿ç”¨é˜Ÿåˆ—æ¨¡å‹ï¼Œé€šè¿‡Exchangeæ¨¡å—å®ç°å‘å¸ƒ-è®¢é˜…æ¨¡å‹ï¼ŒExchangeä½äºç”Ÿäº§è€…å’Œé˜Ÿåˆ—ä¹‹é—´ï¼Œç”±Exchangeå†³å®šå°†è¯¦ç»†æŠ•é€’åˆ°å“ªä¸ªé˜Ÿåˆ—ã€‚&lt;/td&gt;
&lt;td&gt;topicå¯ä»¥è¾¾åˆ°å‡ ç™¾ï¼Œå‡ åƒä¸ªçš„çº§åˆ«ï¼Œååé‡ä¼šæœ‰è¾ƒå°å¹…åº¦çš„ä¸‹é™è¿™æ˜¯RocketMQçš„ä¸€å¤§ä¼˜åŠ¿ï¼Œåœ¨åŒç­‰æœºå™¨ä¸‹ï¼Œå¯ä»¥æ”¯æ’‘å¤§é‡çš„topic&lt;/td&gt;
&lt;td&gt;topicä»å‡ åä¸ªåˆ°å‡ ç™¾ä¸ªçš„æ—¶å€™ï¼Œååé‡ä¼šå¤§å¹…åº¦ä¸‹é™ã€‚æ‰€ä»¥åœ¨åŒç­‰æœºå™¨ä¸‹ï¼Œkafkaå°½é‡ä¿è¯topicæ•°é‡ä¸è¦è¿‡å¤šã€‚å¦‚æœè¦æ”¯æ’‘å¤§è§„æ¨¡topicï¼Œéœ€è¦å¢åŠ æ›´å¤šçš„æœºå™¨èµ„æº&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å¯ç”¨æ€§&lt;/td&gt;
&lt;td&gt;é«˜ï¼ŒåŸºäºä¸»ä»æ¶æ„å®ç°é«˜å¯ç”¨æ€§&lt;/td&gt;
&lt;td&gt;é«˜ï¼ŒåŸºäºä¸»ä»æ¶æ„å®ç°é«˜å¯ç”¨æ€§&lt;/td&gt;
&lt;td&gt;éå¸¸é«˜ï¼Œåˆ†å¸ƒå¼æ¶æ„&lt;/td&gt;
&lt;td&gt;éå¸¸é«˜ï¼Œkafkaæ˜¯åˆ†å¸ƒå¼çš„ï¼Œä¸€ä¸ªæ•°æ®å¤šä¸ªå‰¯æœ¬ï¼Œå°‘æ•°æœºå™¨å®•æœºï¼Œä¸ä¼šä¸¢å¤±æ•°æ®ï¼Œä¸ä¼šå¯¼è‡´ä¸å¯ç”¨&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æ¶ˆæ¯å¯é æ€§&lt;/td&gt;
&lt;td&gt;æœ‰è¾ƒä½çš„æ¦‚ç‡ä¸¢å¤±æ•°æ®&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;ç»è¿‡å‚æ•°ä¼˜åŒ–é…ç½®ï¼Œå¯ä»¥åšåˆ°0ä¸¢å¤±&lt;/td&gt;
&lt;td&gt;ç»è¿‡å‚æ•°ä¼˜åŒ–é…ç½®ï¼Œæ¶ˆæ¯å¯ä»¥åšåˆ°0ä¸¢å¤±&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æ—¶æ•ˆæ€§&lt;/td&gt;
&lt;td&gt;msçº§&lt;/td&gt;
&lt;td&gt;å¾®ç§’çº§ï¼Œè¿™æ˜¯rabbitmqçš„ä¸€å¤§ç‰¹ç‚¹ï¼Œå»¶è¿Ÿæ˜¯æœ€ä½çš„&lt;/td&gt;
&lt;td&gt;msçº§&lt;/td&gt;
&lt;td&gt;å»¶è¿Ÿåœ¨msçº§ä»¥å†…&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;åŠŸèƒ½æ”¯æŒ&lt;/td&gt;
&lt;td&gt;MQé¢†åŸŸçš„åŠŸèƒ½æå…¶å®Œå¤‡&lt;/td&gt;
&lt;td&gt;åŸºäºerlangå¼€å‘ï¼Œæ‰€ä»¥å¹¶å‘èƒ½åŠ›å¾ˆå¼ºï¼Œæ€§èƒ½æå…¶å¥½ï¼Œå»¶æ—¶å¾ˆä½&lt;/td&gt;
&lt;td&gt;MQåŠŸèƒ½è¾ƒä¸ºå®Œå–„ï¼Œè¿˜æ˜¯åˆ†å¸ƒå¼çš„ï¼Œæ‰©å±•æ€§å¥½&lt;/td&gt;
&lt;td&gt;åŠŸèƒ½è¾ƒä¸ºç®€å•ï¼Œä¸»è¦æ”¯æŒç®€å•çš„MQåŠŸèƒ½ï¼Œåœ¨å¤§æ•°æ®é¢†åŸŸçš„å®æ—¶è®¡ç®—ä»¥åŠæ—¥å¿—é‡‡é›†è¢«å¤§è§„æ¨¡ä½¿ç”¨ï¼Œæ˜¯äº‹å®ä¸Šçš„æ ‡å‡†&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ä¼˜åŠ£åŠ¿æ€»ç»“&lt;/td&gt;
&lt;td&gt;éå¸¸æˆç†Ÿï¼ŒåŠŸèƒ½å¼ºå¤§ï¼Œåœ¨ä¸šå†…å¤§é‡çš„å…¬å¸ä»¥åŠé¡¹ç›®ä¸­éƒ½æœ‰åº”ç”¨ã€‚å¶å°”ä¼šæœ‰è¾ƒä½æ¦‚ç‡ä¸¢å¤±æ¶ˆæ¯ï¼Œè€Œä¸”ç°åœ¨ç¤¾åŒºä»¥åŠå›½å†…åº”ç”¨éƒ½è¶Šæ¥è¶Šå°‘ï¼Œå®˜æ–¹ç¤¾åŒºç°åœ¨å¯¹ActiveMQ 5.xç»´æŠ¤è¶Šæ¥è¶Šå°‘ï¼Œå‡ ä¸ªæœˆæ‰å‘å¸ƒä¸€ä¸ªç‰ˆæœ¬è€Œä¸”ç¡®å®ä¸»è¦æ˜¯åŸºäºè§£è€¦å’Œå¼‚æ­¥æ¥ç”¨çš„ï¼Œè¾ƒå°‘åœ¨å¤§è§„æ¨¡ååçš„åœºæ™¯ä¸­ä½¿ç”¨&lt;/td&gt;
&lt;td&gt;erlangè¯­è¨€å¼€å‘ï¼Œæ€§èƒ½æå…¶å¥½ï¼Œå»¶æ—¶å¾ˆä½ï¼›ååé‡åˆ°ä¸‡çº§ï¼›æ‹¥æœ‰çµæ´»çš„è·¯ç”±é…ç½®ï¼›MQåŠŸèƒ½æ¯”è¾ƒå®Œå¤‡è€Œä¸”å¼€æºæä¾›çš„ç®¡ç†ç•Œé¢éå¸¸æ£’ï¼Œç”¨èµ·æ¥å¾ˆå¥½ç”¨ï¼›ç¤¾åŒºç›¸å¯¹æ¯”è¾ƒæ´»è·ƒï¼›RabbitMQç¡®å®ååé‡ä¸å…¶ä»–å‡ ä¸ªç›¸æ¯”ä¼šä½ä¸€äº›ï¼Œè¿™æ˜¯å› ä¸ºä»–åšçš„å®ç°æœºåˆ¶æ¯”è¾ƒé‡ï¼›å¯¹æ¶ˆæ¯çš„å †ç§¯æ”¯æŒä¸æ˜¯å¾ˆå¥½ï¼Œå½“æœ‰å¤§é‡æ¶ˆæ¯ç§¯å‹æ—¶ï¼Œä¼šå¯¼è‡´RabbitMQæ€§èƒ½æ€¥å‰§ä¸‹é™ï¼›erlangå¼€å‘ï¼Œæ¯”è¾ƒå°ä¼—ï¼Œå¾ˆéš¾è¯»æºç ï¼Œå¾ˆéš¾å®šåˆ¶å’ŒæŒæ§ã€‚&lt;/td&gt;
&lt;td&gt;æ¥å£ç®€å•æ˜“ç”¨ï¼Œæ—¥å¤„ç†æ¶ˆæ¯ä¸Šç™¾äº¿ä¹‹å¤šï¼Œå¯ä»¥åšåˆ°å¤§è§„æ¨¡ååï¼Œæ€§èƒ½ä¹Ÿéå¸¸å¥½ï¼Œåˆ†å¸ƒå¼æ‰©å±•ä¹Ÿå¾ˆæ–¹ä¾¿ï¼Œç¤¾åŒºç»´æŠ¤è¿˜å¯ä»¥ï¼Œå¯é æ€§å’Œå¯ç”¨æ€§éƒ½æ˜¯okçš„ï¼Œè¿˜å¯ä»¥æ”¯æ’‘å¤§è§„æ¨¡çš„topicæ•°é‡ï¼Œæ”¯æŒå¤æ‚MQä¸šåŠ¡åœºæ™¯ã€‚javaå®ç°ï¼Œæºç æ˜“è¯»ï¼›ä¸­æ–‡ç¤¾åŒºæ´»è·ƒåº¦ï¼Œæ–‡æ¡£ç›¸å¯¹æ¥è¯´ç®€å•ï¼Œæ¥å£è¿™å—ä¸æ˜¯æŒ‰ç…§æ ‡å‡†JMSè§„èŒƒèµ°çš„æœ‰äº›ç³»ç»Ÿè¦è¿ç§»éœ€è¦ä¿®æ”¹å¤§é‡ä»£ç ã€‚&lt;/td&gt;
&lt;td&gt;kafkaçš„ç‰¹ç‚¹å…¶å®å¾ˆæ˜æ˜¾ï¼Œå°±æ˜¯ä»…ä»…æä¾›è¾ƒå°‘çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œä½†æ˜¯æä¾›è¶…é«˜çš„ååé‡ï¼Œmsçº§çš„å»¶è¿Ÿï¼Œæé«˜çš„å¯ç”¨æ€§ä»¥åŠå¯é æ€§ï¼Œè€Œä¸”åˆ†å¸ƒå¼å¯ä»¥ä»»æ„æ‰©å±•ã€‚åŒæ—¶kafkaæœ€å¥½æ˜¯æ”¯æ’‘è¾ƒå°‘çš„topicæ•°é‡å³å¯ï¼Œä¿è¯å…¶è¶…é«˜ååé‡ã€‚è€Œä¸”kafkaå”¯ä¸€çš„ä¸€ç‚¹åŠ£åŠ¿æ˜¯æœ‰å¯èƒ½æ¶ˆæ¯é‡å¤æ¶ˆè´¹ï¼Œé‚£ä¹ˆå¯¹æ•°æ®å‡†ç¡®æ€§ä¼šé€ æˆæå…¶è½»å¾®çš„å½±å“ï¼Œåœ¨å¤§æ•°æ®é¢†åŸŸä¸­ä»¥åŠæ—¥å¿—é‡‡é›†ä¸­ï¼Œè¿™ç‚¹è½»å¾®å½±å“å¯ä»¥å¿½ç•¥è¿™ä¸ªç‰¹æ€§å¤©ç„¶é€‚åˆå¤§æ•°æ®å®æ—¶è®¡ç®—ä»¥åŠæ—¥å¿—æ”¶é›†ã€‚å¼‚æ­¥æ‰¹é‡æ“ä½œæ€§èƒ½æä½³ï¼Œä½†æ˜¯åŒæ­¥æ”¶å‘ä¿¡æ¯å› ä¸ºè¦æ”’ä¸€æ‰¹æ¶ˆæ¯æ‰è¿›è¡Œå¤„ç†ä¼šå¯¼è‡´å“åº”å»¶æ—¶æ¯”è¾ƒé«˜ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id=&#34;rabbitmq&#34;&gt;RabbitMQ&lt;/h2&gt;
&lt;p&gt;æ¨¡å‹ï¼šç”Ÿäº§è€… -ã€‹exchangeäº¤æ¢å™¨ -ã€‹é˜Ÿåˆ— -ã€‹æ¶ˆè´¹è€…&lt;/p&gt;
&lt;p&gt;ç”Ÿäº§è€…é€šè¿‡æŒ‡å®šä¸€ä¸ªRoutingKeyæ¥é€‰æ‹©å¯¹åº”çš„äº¤æ¢å™¨ï¼Œä¸€ä¸ªäº¤æ¢å™¨å¯ä»¥å¯¹æ¥å¤šä¸ªé˜Ÿåˆ—ï¼Œé˜Ÿåˆ—é€šè¿‡BindingKeyç»‘å®šå¯¹åº”çš„äº¤æ¢å™¨ã€‚&lt;/p&gt;
&lt;p&gt;ç”Ÿäº§è€…åªèƒ½æŠŠæ¶ˆæ¯å‘é€ç»™äº¤æ¢å™¨ï¼Œå‘é€æ—¶æŒ‡å®šRoutingKeyï¼Œå½“æ¶ˆæ¯çš„RoutingKeyä¸æŸä¸ªé˜Ÿåˆ—çš„BindingKeyåŒ¹é…æ—¶ï¼Œæ¶ˆæ¯ä»äº¤æ¢å™¨è·¯ç”±åˆ°é˜Ÿåˆ—ï¼Œé˜Ÿåˆ—æ‰æ˜¯çœŸæ­£å­˜å‚¨æ¶ˆæ¯çš„åœ°æ–¹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;äº¤æ¢å™¨çš„4ç§ç±»å‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;fanoutï¼šæ‰‡å½¢å‘å‡ºï¼ŒæŠŠæ‰€æœ‰å‘é€åˆ°è¯¥äº¤æ¢å™¨çš„æ¶ˆæ¯è·¯ç”±åˆ°æ‰€æœ‰ä¸å…¶ç»‘å®šçš„é˜Ÿåˆ—ä¸­ï¼Œæ­¤æ—¶RoutingKeyä¸èµ·ä½œç”¨ï¼›&lt;/li&gt;
&lt;li&gt;directï¼šæŠŠæ¶ˆæ¯è·¯ç”±åˆ°BindingKeyå’ŒRoutingKeyå®Œå…¨åŒ¹é…çš„é˜Ÿåˆ—ä¸­ï¼›&lt;/li&gt;
&lt;li&gt;headersï¼šä¸ä¾èµ–è·¯ç”±é”®åŒ¹é…è§„åˆ™è·¯ç”±æ¶ˆæ¯ã€‚æ˜¯æ ¹æ®å‘é€æ¶ˆæ¯å†…å®¹ä¸­çš„headerså±æ€§è¿›è¡ŒåŒ¹é…ã€‚æ€§èƒ½å·®ï¼ŒåŸºæœ¬ç”¨ä¸åˆ°ï¼›&lt;/li&gt;
&lt;li&gt;topicï¼šè™½ç„¶ä¹Ÿæ˜¯BindingKeyå’ŒRoutingKeyè¿›è¡ŒåŒ¹é…æ‰èƒ½è½¬å‘åˆ°å¯¹åº”çš„é˜Ÿåˆ—ï¼Œä½†æ˜¯æ”¯æŒæ¨¡ç³ŠåŒ¹é…ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;RabbitMQæœ‰ä¸ªé»˜è®¤çš„äº¤æ¢å™¨ï¼Œåå­—æ˜¯ç©ºä¸²ï¼Œç±»å‹ä¸ºdirectï¼Œæ‰€æœ‰é˜Ÿåˆ—ä»¥è‡ªå·±çš„åå­—ä¸ºBindingKeyç»‘å®šåˆ°è¯¥é»˜è®¤çš„äº¤æ¢å™¨ä¸Šï¼Œè¿™æ ·ç”Ÿäº§è€…å¦‚æœè¦å‘é€æ¶ˆæ¯åˆ°é»˜è®¤çš„äº¤æ¢å™¨ä¸Šæ—¶ï¼ŒæŒ‡å®šRoutingKeyä¸ºå¯¹åº”é˜Ÿåˆ—çš„åå­—å³å¯ï¼Œçœ‹èµ·æ¥å°±å¥½åƒæ˜¯ç›´æ¥å‘ç»™æŸä¸ªé˜Ÿåˆ—ä¸€æ ·äº†ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ¶ˆæ¯ä¼ è¾“&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;æ¶ˆæ¯åŸºäºä¿¡é“channelä¼ è¾“ï¼Œä¿¡é“æ˜¯å»ºç«‹åœ¨çœŸå®çš„TCPè¿æ¥å†…çš„è™šæ‹Ÿè¿æ¥ï¼Œä¸”æ¯æ¡TCPè¿æ¥ä¸Šçš„ä¿¡é“æ•°é‡æ²¡æœ‰é™åˆ¶ã€‚pushæ¨¡å¼ä¸‹ï¼Œè‹¥ä¸€ä¸ªé˜Ÿåˆ—æœ‰å¤šä¸ªæ¶ˆè´¹è€…ï¼ŒRabbitMQé»˜è®¤å°†ä»¥è½®è¯¢çš„æ–¹å¼å‘é€ç»™æ¶ˆè´¹è€…ï¼Œè¿˜æœ‰å¦ä¸€ç§æ¨¡å¼æ˜¯æ ¹æ®æ¶ˆè´¹è€…çš„æ¶ˆè´¹èƒ½åŠ›æ¥åšåˆ†å‘ï¼Œç©ºé—²çš„æ¶ˆè´¹è€…å°†å¤„ç†æ›´å¤šçš„æ¶ˆæ¯ã€‚&lt;/p&gt;
&lt;p&gt;é»˜è®¤æƒ…å†µä¸‹ï¼Œæ— æ³•è¢«è·¯ç”±çš„æ¶ˆæ¯ä¼šè¢«ç›´æ¥ä¸¢å¼ƒï¼Œå¦‚æœè®¾ç½®äº†&lt;code&gt;mandatory=true&lt;/code&gt;å¹¶é…åˆReturnListenerï¼Œå¯ä»¥å®ç°æ¶ˆæ¯å›å‘ç»™å¤‡ç”¨äº¤æ¢å™¨ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ¶ˆæ¯å»é‡&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸€èˆ¬æ˜¯ä¿è¯æ¶ˆè´¹è€…æ¶ˆè´¹æ—¶å¹‚ç­‰ï¼Œæ¯”å¦‚ï¼šåœ¨æ¶ˆæ¯ä½“åŠ å…¥ä¸€ä¸ªä¸šåŠ¡idæ¥å®ç°&lt;/li&gt;
&lt;li&gt;æ¶ˆæ¯ç”±ç”Ÿäº§è€…äº§ç”Ÿæ—¶ï¼ŒMQå†…éƒ¨ä¼šå¯¹æ¯æ¡æ¶ˆæ¯ç”Ÿäº§ä¸€ä¸ªinner-msg-idï¼Œä½œä¸ºå»é‡çš„ä¾æ®ï¼Œé¿å…é‡å¤æ¶ˆæ¯è¿›å…¥é˜Ÿåˆ—&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;RabbitMQäº‹åŠ¡&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;ç”Ÿäº§è€…åœ¨å‘é€æ•°æ®ä¹‹å‰ï¼Œå¼€å¯RabbitMQäº‹åŠ¡ï¼Œç„¶åå‘é€æ¶ˆæ¯ï¼Œå¦‚æœæ¶ˆæ¯æ²¡æœ‰è¢«RabbitMQæ¥æ”¶åˆ°ï¼Œç”Ÿäº§è€…å°±ä¼šæ”¶åˆ°å¼‚å¸¸æŠ¥é”™ï¼Œæ­¤æ—¶ä¼šå›æ»šæ¶ˆæ¯æˆ–è€…é‡è¯•ï¼›&lt;/p&gt;
&lt;p&gt;äº‹åŠ¡æœºåˆ¶æ˜¯åŒæ­¥çš„ï¼Œå› æ­¤ååé‡ä¸é«˜ï¼Œå¤ªè€—æ€§èƒ½ï¼Œä¸€èˆ¬ä½¿ç”¨ç”Ÿäº§è€…ç¡®è®¤æ¨¡å¼ä¿è¯æ¶ˆæ¯ä¸ä¸¢ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç”Ÿäº§è€…ç¡®è®¤æ¨¡å¼&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç”Ÿäº§è€…ç¡®è®¤æ¨¡å¼åªç¡®ä¿æ¶ˆæ¯æ­£ç¡®åˆ°è¾¾äº¤æ¢å™¨ï¼Œå¯¹äºä»äº¤æ¢å™¨è·¯ç”±åˆ°é˜Ÿåˆ—å¤±è´¥çš„æ¶ˆæ¯ï¼Œåˆ™ä¼šè¢«ä¸¢å¼ƒæ‰ï¼Œå¯¼è‡´æ¶ˆæ¯ä¸¢å¤±ï¼Œso å¯¹äºä¸å¯è·¯ç”±çš„æ¶ˆæ¯ï¼Œåˆ™æœ‰Returnæ¶ˆæ¯æœºåˆ¶ï¼ˆé€šè¿‡åœ¨äº¤æ¢å™¨è®¾ç½®å›è°ƒå‡½æ•°å¤„ç†ï¼Œç›‘å¬è·¯ç”±ä¸å¯è¾¾æ¶ˆæ¯ï¼‰å’Œå¤‡ä»½äº¤æ¢å™¨ï¼ˆè·¯ç”±ä¸å¯è¾¾çš„æ¶ˆæ¯éƒ½å‘å¾€è¿™ä¸ªäº¤æ¢å™¨ï¼‰æ¥è§£å†³ï¼›&lt;/li&gt;
&lt;li&gt;å°†ä¿¡é“è®¾ç½®æˆconfirmæ¨¡å¼ï¼Œæ­¤æ—¶éœ€è¦å‘é€æ–¹ç¡®è®¤ï¼Œæ‰€æœ‰åœ¨ä¿¡é“ä¸Šå‘å¸ƒçš„æ¶ˆæ¯éƒ½ä¼šè¢«æŒ‡å®šä¸€ä¸ªå”¯ä¸€çš„IDï¼Œä¸€æ—¦æ¶ˆæ¯è¢«æŠ•é€’åˆ°ç›®æ ‡é˜Ÿåˆ—ã€æˆ–è€…æ¶ˆæ¯è¢«å†™å…¥ç£ç›˜åï¼Œä¿¡é“ä¼šå‘é€ä¸€ä¸ªackç»™ç”Ÿäº§è€…ï¼›&lt;/li&gt;
&lt;li&gt;å¦‚æœRabbitMQå‘ç”Ÿå†…éƒ¨é”™è¯¯è€Œå¯¼è‡´æ¶ˆæ¯ä¸¢å¤±ï¼Œä¼šå‘ç”Ÿä¸€æ¡ nackï¼ˆnot ackï¼‰æ¶ˆæ¯ç»™ç”Ÿäº§è€…è¡¨ç¤ºæœªç¡®è®¤ï¼›&lt;/li&gt;
&lt;li&gt;å‘é€æ–¹ç¡®è®¤æ¨¡å¼æ˜¯å¼‚æ­¥çš„ï¼Œç”Ÿäº§è€…åœ¨ç­‰å¾…ç¡®è®¤çš„åŒæ—¶ï¼Œå¯ä»¥ç»§ç»­å‘é€æ¶ˆæ¯ï¼Œå½“ç”Ÿäº§è€…æ¥æ”¶åˆ°ç¡®è®¤æ¶ˆæ¯åï¼Œç”Ÿäº§è€…çš„å›è°ƒæ–¹æ³•å°±ä¼šè§¦å‘æ¥å¤„ç†ç¡®è®¤æ¶ˆæ¯ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;æ¶ˆè´¹è€…ç¡®è®¤æ¨¡å¼&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ¶ˆè´¹è€…æ¥æ”¶çš„æ¯ä¸€æ¡æ¶ˆæ¯åéƒ½å¿…é¡»è¿›è¡Œç¡®è®¤ï¼Œæ¶ˆè´¹è€…åªæœ‰ç¡®è®¤äº†æ¶ˆæ¯ï¼ŒRabbitMQæ‰ä¼šå®‰å…¨åœ°æŠŠæ¶ˆæ¯ä»é˜Ÿåˆ—ä¸­åˆ é™¤ï¼›&lt;/li&gt;
&lt;li&gt;RabbitMQä»…é€šè¿‡æ¶ˆè´¹è€…çš„è¿æ¥ä¸­æ–­æ¥ç¡®è®¤æ˜¯å¦éœ€è¦é‡æ–°å‘é€æ¶ˆæ¯ï¼Œåªè¦è¿æ¥ä¸ä¸­æ–­ï¼ŒRabbitMQä¼šç»™æ¶ˆè´¹è€…è¶³å¤Ÿé•¿çš„æ—¶é—´æ¥å¤„ç†æ¶ˆæ¯ï¼Œä¿è¯æ•°æ®çš„æœ€ç»ˆä¸€è‡´æ€§ï¼›&lt;/li&gt;
&lt;li&gt;å¦‚æœæ¶ˆè´¹è€…æ¥æ”¶åˆ°æ¶ˆæ¯åæ²¡æ³•å‘é€ç¡®è®¤æ¶ˆæ¯ï¼Œè¿æ¥ä¹Ÿæœªæ–­å¼€ï¼ŒRabbitMQä¼šè®¤ä¸ºè¯¥æ¶ˆè´¹è€…ç¹å¿™ï¼Œä¹‹åä¸ä¼šå†ç»™è¯¥æ¶ˆè´¹è€…å‘æ”¾æ›´å¤šçš„æ¶ˆæ¯ï¼›&lt;/li&gt;
&lt;li&gt;ä¸è®¾ç½®è‡ªåŠ¨ackï¼Œæ¶ˆè´¹è€…åœ¨å¤„ç†å®Œæ¶ˆæ¯ä¹‹åæ”¶åˆ°å‘é€ackç»™RabbitMQï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;RabbitMQæŒä¹…åŒ–æœºåˆ¶&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;RabbitMQæŒä¹…åŒ–æ¶ˆæ¯åï¼Œå¦‚æœRabbitMQæŒ‚äº†ï¼Œæ¢å¤åªä¼šä¼šè‡ªåŠ¨è¯»å–ä¹‹å‰å­˜å‚¨çš„æ•°æ®ï¼ŒæŒä¹…åŒ–è®¾ç½®æœ‰ä¸¤ä¸ªæ­¥éª¤ï¼Œå¿…é¡»åŒæ—¶è®¾ç½®æ‰èƒ½ä¿è¯æ¶ˆæ¯ä¸ä¸¢ï¼ŒæŒä¹…åŒ–æœºåˆ¶ä¸€èˆ¬é…åˆç”Ÿäº§è€…ç¡®è®¤æ¨¡å¼ï¼Œåªæœ‰æ¶ˆæ¯è¢«æŒä¹…åŒ–åˆ°ç£ç›˜äº†ï¼Œæ‰ä¼šç»™ç”Ÿäº§è€…å‘é€ackã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åˆ›å»ºé˜Ÿåˆ—æ—¶ï¼Œè®¾ç½®æŒä¹…åŒ–ï¼Œç¡®ä¿RabbitMQèƒ½æŒä¹…åŒ–é˜Ÿåˆ—çš„å…ƒæ•°æ®ï¼Œä½†å®ƒå¹¶ä¸ä¼šæŒä¹…åŒ–æ¶ˆæ¯çš„æ•°æ®ï¼›&lt;/li&gt;
&lt;li&gt;ç”Ÿäº§è€…å‘é€æ¶ˆæ¯æ—¶è®¾ç½® &lt;code&gt;deliberyMode = 2&lt;/code&gt; ï¼Œæ­¤æ—¶RabbitMQæ‰ä¼šå°†æ¶ˆæ¯æ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜ä¸Šï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ¶ˆè´¹è€…ä¸€æ—¦ä»é˜Ÿåˆ—ä¸­æ¶ˆè´¹äº†ä¸€æ¡æ¶ˆæ¯å¹¶å›å¤ackï¼ŒRabbitMQå°±ä¼šä»æŒä¹…åŒ–æ—¥å¿—ä¸­ç§»é™¤è¿™æ¡æ¶ˆæ¯ï¼Œso åœ¨æ¶ˆè´¹æ¶ˆæ¯å‰ï¼Œå¦‚æœRabbitMQé‡å¯ï¼ŒæœåŠ¡å™¨ä¼šè‡ªåŠ¨é‡å»ºäº¤æ¢å™¨å’Œé˜Ÿåˆ—ï¼ŒåŠ è½½æŒä¹…åŒ–æ—¥å¿—ä¸­çš„æ¶ˆæ¯åˆ°å¯¹åº”çš„é˜Ÿåˆ—æˆ–äº¤æ¢å™¨ä¸Šï¼Œä¿è¯æ¶ˆæ¯ä¸ä¼šä¸¢å¤±ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;é«˜å¯ç”¨&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;éƒ½æ˜¯åŸºäºä¸»ä»éƒ¨ç½²ï¼Œæœ‰æ™®é€šé›†ç¾¤æ¨¡å¼å’Œé•œåƒé›†ç¾¤æ¨¡å¼ï¼Œ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ™®é€šé›†ç¾¤æ¨¡å¼ï¼šå¤šå°æœºå™¨ï¼Œæ¯å°éƒ¨ç½²ä¸€ä¸ªRabbitMQå®ä¾‹ï¼Œæˆ‘ä»¬åˆ›å»ºçš„é˜Ÿåˆ—ï¼Œ&lt;strong&gt;åªä¼šæ”¾åœ¨ä¸€ä¸ªå®ä¾‹ä¸Šï¼Œä½†æ¯ä¸ªå®ä¾‹éƒ½ä¼šåŒæ­¥é˜Ÿåˆ—é‡Œçš„å…ƒæ•°æ®&lt;/strong&gt;ï¼ˆå…ƒæ•°æ®æ˜¯é˜Ÿåˆ—çš„ä¸€äº›é…ç½®ä¿¡æ¯ï¼Œå¯ä»¥é€šè¿‡å…¶æ‰¾åˆ°é˜Ÿåˆ—æ‰€åœ¨çš„å®ä¾‹ï¼‰ï¼Œæ¶ˆè´¹çš„æ—¶å€™ï¼Œå¦‚æœ&lt;strong&gt;è¿æ¥åˆ°äº†å¦ä¸€ä¸ªå®ä¾‹ï¼Œé‚£ä¹ˆè¯¥å®ä¾‹ä¼šä»é˜Ÿåˆ—æ‰€åœ¨å®ä¾‹ä¸Šæ‹‰å»æ•°æ®è¿‡æ¥æ¶ˆè´¹&lt;/strong&gt;ï¼Œå®ç°å¤šä¸ªèŠ‚ç‚¹æœåŠ¡æŸä¸ªé˜Ÿåˆ—çš„è¯»å†™æ“ä½œï¼›&lt;/li&gt;
&lt;li&gt;é•œåƒé›†ç¾¤æ¨¡å¼ï¼šæˆ‘ä»¬æ‰€åˆ›å»ºçš„é˜Ÿåˆ—ï¼Œ&lt;strong&gt;æ— è®ºå…ƒæ•°æ®è¿˜æ˜¯é˜Ÿåˆ—é‡Œçš„æ¶ˆæ¯éƒ½ä¼šå­˜åœ¨å¤šä¸ªå®ä¾‹ä¸Š&lt;/strong&gt;ï¼Œå³æ¯ä¸ªRabbitMQèŠ‚ç‚¹éƒ½æœ‰è¿™ä¸ªé˜Ÿåˆ—çš„ä¸€ä¸ªå®Œæ•´é•œåƒï¼ŒåŒ…å«é˜Ÿåˆ—é‡Œçš„å…¨éƒ¨æ•°æ®ã€‚&lt;strong&gt;é˜Ÿåˆ—æ¯æ¬¡æ”¶åˆ°æ¶ˆæ¯æ—¶ï¼Œéƒ½ä¼šè‡ªåŠ¨æŠŠæ¶ˆæ¯åŒæ­¥åˆ°å¤šä¸ªå®ä¾‹çš„é˜Ÿåˆ—ä¸Šï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰è¿™ä¸ªé˜Ÿåˆ—çš„å®Œæ•´æ•°æ®&lt;/strong&gt;ï¼Œæ‰€ä»¥ä»»æ„ä¸€å°æœºå™¨å®•æœºäº†ï¼Œè¿˜å¯ä»¥ä»åˆ«çš„æœºå™¨è¿›è¡Œæ¶ˆè´¹ï¼Œä½†è¿™ç§æ–¹å¼å¯¹å¸¦å®½å‹åŠ›æ¯”è¾ƒå¤§ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;kafka&#34;&gt;Kafka&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Topicï¼šä¸»é¢˜ï¼Œä¸€ä¸ªä¸»é¢˜å¯ä»¥åˆ†ä¸ºä¸€ä¸ªæˆ–å¤šä¸ªåˆ†åŒºï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Brokerï¼šä¸€å°Kafkaå°±æ˜¯ä¸€ä¸ªBrokerï¼Œä¸€ä¸ªé›†ç¾¤ç”±å¤šä¸ªBrokerç»„æˆï¼Œä¸€ä¸ªBrokerå¯ä»¥å®¹çº³å¤šä¸ªTopicï¼›Brokerè´Ÿè´£æ¥æ”¶å’Œå¤„ç†ç”Ÿäº§è€…å‘é€çš„æ¶ˆæ¯ï¼Œ&lt;strong&gt;Brokerå†…å¯ä»¥å°†æ¯ä¸ªä¸»é¢˜topicé…ç½®æˆMä¸ªåˆ†åŒº&lt;/strong&gt;ï¼ˆç±»ä¼¼mongoçš„åˆ†ç‰‡ï¼‰ï¼Œæ¯ä¸ªåˆ†åŒºæ˜¯ä¸€ç»„æœ‰åºçš„æ¶ˆæ¯æ—¥å¿—ï¼Œæ¯æ¡æ¶ˆæ¯çš„ä½ç§»ä»0å¼€å§‹ï¼Œä¾æ¬¡é€’å¢ï¼›&lt;/p&gt;
&lt;p&gt;BrokeræŒä¹…åŒ–æ—¶ï¼Œä½¿ç”¨æ¶ˆæ¯æ—¥å¿—æ¥ä¿å­˜æ•°æ®ï¼Œæ—¥å¿—æ˜¯è¿½åŠ å†™å…¥çš„ç‰©ç†æ–‡ä»¶ï¼Œé¿å…çš„éšæœºIOï¼Œæå‡ååé‡ï¼›ä¸€ä¸ªTopicä¸­çš„ä¸€ä¸ªåˆ†åŒºå¤§æ–‡ä»¶ä¼šè¢«åˆ†æˆå¤šä¸ªå°çš„æ–‡ä»¶ç«¯ï¼Œå³ä¸€ä¸ªæ—¥å¿—ä¼šè¢«ç»†åˆ†æˆå¤šä¸ªæ—¥å¿—æ®µï¼Œæ¶ˆæ¯è¢«è¿½åŠ å†™åˆ°å½“å‰æœ€æ–°çš„æ—¥å¿—æ®µä¸­ï¼Œå†™æ»¡ä¸€ä¸ªæ—¥å¿—æ®µåï¼ŒBrokerä¼šè‡ªåŠ¨åˆ‡åˆ†å‡ºä¸€ä¸ªæ–°çš„æ—¥å¿—æ®µï¼Œå¹¶å°†è€çš„æ—¥å¿—æ®µå°å­˜ï¼Œåå°æœ‰å®šæ—¶ä»»åŠ¡å®šæœŸæ£€æŸ¥è€çš„æ—¥å¿—æ®µæ˜¯å¦èƒ½è¢«åˆ é™¤ï¼Œå›æ”¶ç£ç›˜ç©ºé—´ï¼›&lt;/p&gt;
&lt;p&gt;æ¯ä¸ªæ—¥å¿—æ®µçš„é»˜è®¤å¤§å°æ˜¯1Gï¼Œå½“æ–‡ä»¶å¤§äº1Gæ—¶ï¼Œä¼šæ»šåŠ¨ä¸€ä¸ªæ–°çš„æ—¥å¿—æ®µï¼Œå¹¶ä¸”ä»¥ä¸Šä¸€ä¸ªæ—¥å¿—æ®µæœ€åä¸€æ¡æ¶ˆæ¯çš„ä½ç§»å‘½ä»¤ï¼›&lt;/p&gt;
&lt;p&gt;é€šè¿‡ç´¢å¼•ä¿¡æ¯å°†å…ƒæ•°æ®å…¨éƒ¨æ˜ å°„åˆ°å†…å­˜ï¼›é€šè¿‡ç´¢å¼•ä¿¡æ¯å°±èƒ½å¿«é€Ÿå®šä½æ¶ˆæ¯å’Œç¡®å®šresponseçš„æœ€å¤§å¤§å°ï¼›é€šè¿‡ç´¢å¼•æ–‡ä»¶ç¨€ç–å­˜å‚¨ï¼Œå¤§å¹…é™ä½ç´¢å¼•æ–‡ä»¶å…ƒæ•°æ®å ç”¨ç©ºé—´å¤§å°ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Partitionï¼šåˆ†åŒºï¼Œ&lt;strong&gt;ä¸€ä¸ªTopicå¯ä»¥åˆ†å¸ƒåˆ°å¤šä¸ªBrokerä¸Š&lt;/strong&gt;ï¼Œæ¯ä¸ªåˆ†åŒºæ˜¯ä¸€ä¸ªæœ‰åºé˜Ÿåˆ—ï¼Œç”Ÿäº§è€…ç”Ÿäº§çš„&lt;strong&gt;æ¯æ¡æ¶ˆæ¯åªä¼šè¢«å‘é€åˆ°ä¸€ä¸ªåˆ†åŒº&lt;/strong&gt;ä¸­ï¼Œåˆ†åŒºä¸­çš„æ¯æ¡æ¶ˆæ¯éƒ½ä¼šè¢«åˆ†é…ä¸€ä¸ªæœ‰åºçš„idï¼ˆoffsetï¼‰ï¼›&lt;/p&gt;
&lt;p&gt;Kafkaåªä¿è¯ä¸€ä¸ªåˆ†åŒºä¸­çš„æ¯æ¡æ¶ˆæ¯æŒ‰é¡ºåºæ¶ˆè´¹ï¼Œä¸ä¿è¯ä¸€ä¸ªTopicä¸­å¤šä¸ªåˆ†åŒºé—´çš„æ¶ˆè´¹é¡ºåºï¼›&lt;/p&gt;
&lt;p&gt;ç¬¬ä¸€ä¸ªåˆ†åŒºï¼ˆç¼–å·ä¸º0ï¼‰çš„ç¬¬ä¸€ä¸ªå‰¯æœ¬æ”¾ç½®çš„ä½ç½®æ˜¯éšæœºä»Brokeråˆ—è¡¨ä¸­é€‰æ‹©çš„ï¼Œå…¶ä»–åˆ†åŒºçš„ç¬¬ä¸€ä¸ªå‰¯æœ¬æ”¾ç½®ä½ç½®ç›¸å¯¹äºç¬¬0ä¸ªåˆ†åŒºä¾æ¬¡å¾€åç§»ï¼Œå‰©ä½™çš„å‰¯æœ¬ç›¸å½“äºç¬¬ä¸€ä¸ªå‰¯æœ¬æ”¾ç½®ä½ç½®ç”±&lt;code&gt;nextReplicacShift&lt;/code&gt;å†³å®šï¼Œè¯¥æ•°ä¹Ÿæ˜¯éšæœºäº§ç”Ÿçš„ï¼›&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ¯ä¸ªåˆ†åŒºå¯ä»¥é…ç½®å¤šä¸ªå‰¯æœ¬ï¼Œæ¯ä¸ªåˆ†åŒºçš„å‰¯æœ¬åªèƒ½æœ‰ä¸€ä¸ªå¯¹å¤–æä¾›æœåŠ¡ï¼Œå…¶ä»–çš„å‰¯æœ¬ä»…ä½œå¤‡ä»½&lt;/strong&gt;ï¼Œå³å…¶ä¸å…è®¸è¯»å†™åˆ†ç¦»ï¼ŒåŸå› æ˜¯kafkaä¸»ä»åŒæ­¥æ¯”è¾ƒè€—æ—¶ï¼Œä¼šäº§ç”Ÿå»¶æ—¶ï¼Œå¯¼è‡´æ•°æ®ä¸€è‡´æ€§é—®é¢˜ï¼›&lt;/p&gt;
&lt;p&gt;åˆ†åŒºä»…æ”¯æŒå¢åŠ ï¼Œä¸å…è®¸å‡å°‘ï¼Œä¸ç„¶åˆ†åŒºå‡å°‘æ—¶ï¼ŒåŸæœ‰çš„æ•°æ®ä¸å¥½åˆ†é…ï¼Œä¸”ç ´åäº†åˆ†åŒºæœ‰åºï¼Œå®ç°èµ·æ¥å¾ˆå¤æ‚ï¼›&lt;/p&gt;
&lt;p&gt;åˆ†åŒºçš„å¥½å¤„æ˜¯å®ç°è´Ÿè½½å‡è¡¡ï¼Œå¯¹äºæ¶ˆè´¹è€…æ¥è¯´ï¼Œæé«˜å¹¶å‘åº¦ï¼Œæå‡ååé‡ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Consumer Groupï¼šæ¶ˆè´¹ç»„ï¼Œæ˜¯Kafkaå®ç°å¹¿æ’­å’Œå•æ’­çš„æ‰‹æ®µï¼Œç”±å¤šä¸ªæ¶ˆè´¹è€…å®ä¾‹å…±åŒç»„æˆä¸€ä¸ªæ¶ˆè´¹ç»„æ¥æ¶ˆè´¹æŸä¸€ç»„ä¸»é¢˜ï¼Œè¿™ç»„ä¸»é¢˜ä¸­çš„æ¯ä¸ªåˆ†åŒºéƒ½åªä¼šè¢«ç»„å†…ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ï¼Œç»„å†…çš„å…¶ä»–æ¶ˆè´¹è€…éƒ½ä¸èƒ½æ¶ˆè´¹ï¼›é€šè¿‡åŒä¸€æ¶ˆè´¹ç»„å†…å¤šæ¶ˆè´¹è€…åŒæ—¶æ¶ˆè´¹ï¼ŒåŠ é€Ÿæ¶ˆè´¹ååé‡ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Offsetï¼šKafkaå­˜åœ¨ä¸¤ç§ä½ç§»å­—æ®µï¼Œä¸€ä¸ªæ˜¯æ¶ˆæ¯ä½ç§»ï¼Œè¡¨ç¤ºåˆ†åŒºä¸­æ¯æ¡æ¶ˆæ¯çš„ä½ç½®ï¼Œå•è°ƒé€’å¢ï¼›å¦ä¸€ä¸ªæ˜¯æ¶ˆè´¹è€…ä½ç§»ï¼Œè¡¨ç¤ºæ¯ä¸ªæ¶ˆè´¹è€…åœ¨æ¶ˆè´¹è¿‡ç¨‹ä¸­ä¼šè®°å½•å®ƒå½“å‰æ¶ˆè´¹åˆ°åˆ†åŒºçš„å“ªä¸ªä½ç½®ä¸Šï¼Œä»£è¡¨æ¶ˆè´¹è€…çš„æ¶ˆè´¹è¿›åº¦ï¼›&lt;/p&gt;
&lt;p&gt;Kafkaçš„å­˜å‚¨æ–‡ä»¶é€šè¿‡ &lt;code&gt;[offset].kafka&lt;/code&gt; æ¥å‘½åï¼Œæ–¹ä¾¿æ ¹æ®offsetè¿›è¡ŒæŸ¥æ‰¾ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Rebalanceï¼šæ¶ˆè´¹ç»„æœ‰é‡å¹³è¡¡åŠŸèƒ½ï¼Œå½“ç»„å†…æŸä¸ªæ¶ˆè´¹è€…æŒ‚æ‰åï¼Œå…¶ä»–æ¶ˆè´¹è€…ä¼šè‡ªåŠ¨é‡æ–°åˆ†é…è®¢é˜…ä¸»é¢˜çš„åˆ†åŒºè¿›è¡Œæ¶ˆè´¹ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Kafkaå‚æ•°topicçº§åˆ«çš„å‚æ•°çš„ä¼˜å…ˆçº§ä¼šå¤§äºbrokerçº§åˆ«çš„å‚æ•°ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Kafkaæ˜¯åŸºäºæ—¥å¿—ç»“æ„çš„æ¶ˆæ¯å¼•æ“ï¼Œæ¶ˆè´¹è€…åœ¨æ¶ˆè´¹æ¶ˆæ¯æ—¶ï¼Œåªæ˜¯ä»ç£ç›˜æ–‡ä»¶ä¸Šè¯»å–æ•°æ®è€Œå·²ï¼Œæ¶ˆè´¹è€…ä¸ä¼šåˆ é™¤æ¶ˆæ¯ï¼Œåªæ˜¯ä¿®æ”¹å¯¹åº”çš„ä½ç§»ï¼Œè€ŒRabbitMQå’ŒActivityMQåœ¨æ¶ˆæ¯æ¶ˆè´¹æˆåŠŸåï¼Œæ˜¯ç›´æ¥åˆ é™¤æ¶ˆæ¯çš„ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ZooKeeperåœ¨Kafkaä¸­çš„ä½œç”¨ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Brokeræ³¨å†Œï¼Œæ¯ä¸ªBrokerå¯åŠ¨æ—¶ï¼Œéƒ½ä¼šåœ¨&lt;code&gt;/brokers/ids&lt;/code&gt;åˆ›å»ºè‡ªå·±çš„èŠ‚ç‚¹ï¼Œè®°å½•è‡ªå·±çš„IPåœ°å€å’Œç«¯å£ï¼›&lt;/li&gt;
&lt;li&gt;Topicæ³¨å†Œï¼Œç”±äº&lt;strong&gt;åŒä¸€ä¸ªTopicçš„æ¶ˆæ¯ä¼šè¢«åˆ†æˆå¤šä¸ªåˆ†åŒºå¹¶å°†å…¶åˆ†å¸ƒåœ¨å¤šä¸ªBrokerä¸Š&lt;/strong&gt;ï¼Œåˆ†åŒºä¸Brokerçš„æ˜ å°„ç”±ZooKeeperç»´æŠ¤ï¼›&lt;/li&gt;
&lt;li&gt;æä¾›è´Ÿè½½å‡è¡¡èƒ½åŠ›ï¼ŒZooKeeperä¼šå°½åŠ›å°†åˆ†åŒºåˆ†å¸ƒåˆ°ä¸åŒçš„BrokerèŠ‚ç‚¹ä¸Šï¼Œç”Ÿäº§è€…äº§ç”Ÿæ¶ˆæ¯åä¹Ÿä¼šå°½é‡æŠ•é€’åˆ°ä¸åŒBrokerçš„åˆ†åŒºé‡Œï¼Œå½“æ¶ˆè´¹è€…æ¶ˆè´¹æ—¶ï¼ŒZooKeeperä¼šæ ¹æ®å½“å‰çš„åˆ†åŒºæ•°é‡å’Œæ¶ˆè´¹è€…æ•°é‡å®ç°åŠ¨æ€è´Ÿè½½å‡è¡¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Kafkaåˆ¤æ–­èŠ‚ç‚¹æ˜¯å¦å­˜æ´»çš„æ¡ä»¶ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;èŠ‚ç‚¹å¿…é¡»å¯ä»¥ç»´æŠ¤å’ŒZooKeeperçš„è¿æ¥ï¼ŒZooKeeperé€šè¿‡å¿ƒè·³æœºåˆ¶æ£€æŸ¥æ¯ä¸ªèŠ‚ç‚¹çš„è¿æ¥ï¼›&lt;/li&gt;
&lt;li&gt;å¦‚æœèŠ‚ç‚¹æ˜¯Followerï¼Œå®ƒå¿…é¡»èƒ½åŠæ—¶åŒæ­¥Leaderçš„å†™æ“ä½œï¼Œä¿æŒåœ¨ä¸€å®šçš„å»¶æ—¶å†…ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ€»ç»“èµ·æ¥Kafkaå®ç°é«˜ååç‡çš„åŸå› ï¼šé¡ºåºè¯»å†™ã€é›¶æ‹·è´ã€æ–‡ä»¶åˆ†æ®µã€æ‰¹é‡å‘é€ã€æ•°æ®å‹ç¼©ã€åˆ†åŒºã€é«˜æ•ˆçš„æ—¥å¿—åˆ†æ®µåŠç´¢å¼•è®¾è®¡ã€é‡å¤åˆ©ç”¨page cacheã€reactorç½‘ç»œæ¨¡å‹ã€æ”¯æŒå¤šç£ç›˜é©±åŠ¨ã€mmapæ“ä½œå†…å­˜å¾ˆå¿«ï¼Œå‡å°‘ç”¨æˆ·ç©ºé—´åˆ°å†…æ ¸ç©ºé—´çš„æ‹·è´ç­‰ï¼›&lt;/p&gt;
&lt;p&gt;ç¼ºç‚¹ï¼šç”±äºæ˜¯æ‰¹é‡å‘é€ï¼Œæ•°æ®å¹¶éçœŸæ­£å®æ—¶ã€ä¸æ”¯æŒMQTTåè®®ã€ä»…æ”¯æŒåˆ†åŒºå†…æ¶ˆæ¯æœ‰åºï¼Œæ— æ³•å®ç°å…¨å±€æ¶ˆæ¯æœ‰åºã€éœ€è¦ä¾èµ–Zookeeperè¿›è¡Œå…ƒæ•°æ®ç®¡ç†ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;åˆ†åŒºæœºåˆ¶&#34;&gt;åˆ†åŒºæœºåˆ¶&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ç”Ÿäº§è€…å‘é€æ¶ˆæ¯ç»™åˆ°æŸä¸€ä¸»é¢˜çš„Brokerï¼Œæœ€ååœ¨ä¿å­˜åˆ°è¯¥ä¸»é¢˜ä¸‹çš„æŸä¸€ä¸ªåˆ†åŒºï¼Œè€Œä¸ä¼šåœ¨å¤šä¸ªåˆ†åŒºä¸­è¢«ä¿å­˜å¤šä»½ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åˆ†åŒºçš„ä½œç”¨æ˜¯æä¾›è´Ÿè½½å‡è¡¡çš„èƒ½åŠ›ï¼Œä¸åŒçš„åˆ†åŒºèƒ½è¢«æ”¾ç½®åœ¨ä¸åŒçš„èŠ‚ç‚¹Brokerä¸Š&lt;/strong&gt;ï¼Œå¯¹æ•°æ®çš„è¯»å†™æ“ä½œä¹Ÿæ˜¯ä»¥åˆ†åŒºä¸ºç²’åº¦è€Œè¿›è¡Œçš„ï¼Œä½¿å¾—æ¯ä¸ªèŠ‚ç‚¹çš„æœºå™¨éƒ½èƒ½ç‹¬ç«‹åœ°æŒ‡å‘å„è‡ªåˆ†åŒºçš„è¯»å†™è¯·æ±‚ï¼Œ&lt;strong&gt;ä»¥æ­¤æé«˜ååé‡å’Œä¼¸ç¼©æ€§&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åˆ†åŒºä¹Ÿèƒ½å®ç°æ¶ˆæ¯çš„é¡ºåºæ€§ï¼Œæ¯”å¦‚ä¸€ä¸ªä¸»é¢˜è®¾ç½®ä¸€ä¸ªåˆ†åŒºï¼Œæˆ–è€…ç”Ÿäº§è€…å‘é€æ¶ˆæ¯æ—¶æŒ‡å®škeyæˆ–è€…åˆ†åŒºï¼Œæ¶ˆæ¯çš„é¡ºåºæ€§åªä¿è¯åœ¨ä¸€ä¸ªåˆ†åŒºå†…æœ‰åºï¼Œé€šè¿‡ä½ç§»å®ç°ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åˆ†åŒºç­–ç•¥ï¼Œè¦åˆç†ä½¿ç”¨åˆ†åŒºç­–ç•¥ï¼Œé¿å…æ¶ˆæ¯æ•°æ®äº§ç”Ÿå€¾æ–œï¼Œå¯¹æŸäº›åˆ†åŒºäº§ç”Ÿæ€§èƒ½ç“¶é¢ˆï¼Œå¯¼è‡´ä¸‹æ¸¸æ¶ˆè´¹èƒ½åŠ›ä¸‹é™&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è½®è¯¢ç­–ç•¥ï¼Œé¡ºåºåˆ†é…ï¼šæ¯”å¦‚ä¸€ä¸ªä¸»é¢˜ä¸‹æœ‰3ä¸ªåˆ†åŒºï¼Œç”Ÿäº§è€…å‘é€æ¶ˆæ¯æ—¶ä¼šè¢«ä¾æ¬¡åˆ†é…åˆ°æ¯ä¸ªåˆ†åŒºï¼Œé»˜è®¤çš„åˆ†åŒºç­–ç•¥ï¼Œå…·æœ‰éå¸¸é«˜çš„è´Ÿè½½å‡è¡¡èƒ½åŠ›ï¼Œæœ€å¤§é™åº¦ä¿è¯æ¶ˆæ¯è¢«å¹³å‡åˆ†é…åˆ°æ‰€æœ‰åˆ†åŒºä¸­ï¼›&lt;/li&gt;
&lt;li&gt;éšæœºç­–ç•¥ï¼šæ¶ˆæ¯ä¼šè¢«éšæœºåˆ†é…åˆ°æŸä¸€åˆ†åŒºä¸Šï¼›&lt;/li&gt;
&lt;li&gt;æŒ‰æ¶ˆæ¯çš„keyä¿åºç­–ç•¥ï¼šæ ¹æ®ä¸åŒçš„keyåˆ†é…åˆ°ä¸åŒçš„åˆ†åŒºä¸Šï¼Œæœ‰ç‚¹åƒRabbitMQçš„RoutingKeyï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;æ¶ˆæ¯å‹ç¼©&#34;&gt;æ¶ˆæ¯å‹ç¼©&lt;/h3&gt;
&lt;p&gt;Kafkaæ¶ˆæ¯åˆ†ä¸ºä¸¤å±‚ï¼šæ¶ˆæ¯é›†åˆ å’Œ æ¶ˆæ¯ï¼Œä¸€ä¸ªæ¶ˆæ¯é›†åˆåŒ…å«è‹¥å¹²æ¡æ—¥å¿—é¡¹ï¼Œæ—¥å¿—é¡¹æ‰æ˜¯çœŸæ­£å°è£…æ¶ˆæ¯çš„åœ°æ–¹ï¼ŒKafkaä¸ä¼šç›´æ¥æ“ä½œå…·ä½“çš„ä¸€æ¡æ¡æ¶ˆæ¯ï¼Œè€Œæ˜¯åœ¨æ¶ˆæ¯é›†åˆè¿™ä¸ªå±‚é¢è¿›è¡Œå†™å…¥æ“ä½œã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å‹ç¼©æ˜¯æ—¶é—´æ¢ç©ºé—´ï¼Œç›®çš„æ˜¯ç”¨è¾ƒå°çš„CPUèµ„æºæ¢æ›´å°‘çš„ç£ç›˜å ç”¨å’Œå¸¦å®½ã€ç½‘ç»œIOä¼ è¾“ï¼›&lt;/li&gt;
&lt;li&gt;å‹ç¼©çš„åœ°æ–¹æœ‰ä¸¤å¤„ï¼šç”Ÿäº§è€…ç«¯å’ŒBrokerç«¯ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œç”Ÿäº§è€…åœ¨å‘é€æ¶ˆæ¯æ—¶ä¼šæŒ‡å®šå‹ç¼©ç®—æ³•ï¼Œæ¯”å¦‚GZipï¼›å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼ŒBrokeråªæ˜¯åŸæ ·ä¿å­˜æ¶ˆæ¯ï¼Œä½†ä¼šåœ¨ä¸¤ç§æƒ…å†µä¸‹å¯¹æ¶ˆæ¯é‡æ–°å‹ç¼©ï¼Œæ¯”å¦‚Brokerç«¯å’Œç”Ÿäº§è€…ç«¯ä½¿ç”¨ä¸åŒçš„å‹ç¼©ç®—æ³•ï¼Œæ­¤æ—¶Brokeræ¥æ”¶åˆ°æ¶ˆæ¯åä¼šå…ˆè§£å‹åœ¨é‡æ–°è¿›è¡Œå‹ç¼©ï¼›æˆ–è€…Brokerä¸ºäº†å…¼å®¹ V1 æˆ– V2 ä¸¤ä¸ªç‰ˆæœ¬çš„æ¶ˆæ¯ï¼Œæ­¤æ—¶ä¹Ÿä¼šå‘ç”Ÿæ¶ˆæ¯æ ¼å¼è½¬æ¢ï¼Œè¿™ç§åœºæ™¯ä¸‹å¯¹æ€§èƒ½çš„å½±å“å¾ˆå¤§ï¼Œè¿˜ä¼šç”¨ä¸ä¸Š é›¶æ‹·è´ ç‰¹æ€§ï¼›&lt;/li&gt;
&lt;li&gt;è§£å‹çš„åœ°æ–¹æœ‰ä¸¤å¤„ï¼šæ¶ˆè´¹è€…ç«¯å’ŒBrokerç«¯ï¼Œæ¶ˆè´¹ç»„ç«¯ä¼šæ ¹æ®æ¶ˆæ¯é›†åˆä¸­æŒ‡å®šçš„å‹ç¼©ç®—æ³•è¿›è¡Œè§£å‹ï¼›Brokerè§£å‹åˆ™æ˜¯å› ä¸ºéœ€è¦å¯¹æ¶ˆæ¯è¿›è¡Œæ ¡éªŒï¼Œä½†è¿™ç§åœºæ™¯è¦åŒºåˆ«äºä¸Šé¢ä¸¤ç§ï¼›&lt;/li&gt;
&lt;li&gt;å‹ç¼©ç®—æ³•ä¸­ï¼Œååé‡æ–¹é¢ï¼šLZ4 &amp;gt; Snappy &amp;gt; zstdã€GZipï¼Œå‹ç¼©æ¯”æ–¹é¢ï¼šzstd &amp;gt; LZ4 &amp;gt; GZip &amp;gt; Snappyï¼ŒSnappyæ¯”è¾ƒè€—CPUèµ„æºï¼Œå…¶ä»–å·®åˆ«ä¸å¤§ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;æ¶ˆæ¯å¯é æ€§&#34;&gt;æ¶ˆæ¯å¯é æ€§&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Kafkaåªå¯¹ å·²æäº¤ çš„æ¶ˆæ¯åš æœ‰é™åº¦ çš„æŒä¹…åŒ–ä¿è¯ã€‚&lt;/p&gt;
&lt;p&gt;å·²æäº¤ï¼šBrokeræˆåŠŸåœ°æ¥æ”¶åˆ°ä¸€æ¡æ¶ˆæ¯å¹¶å†™å…¥åˆ°æ—¥å¿—æ–‡ä»¶åï¼Œå‘Šè¯‰ç”Ÿäº§è€…è¿™æ¡æ¶ˆæ¯å·²æˆåŠŸæäº¤ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‡å®šæ˜¯ä¸€ä¸ªBrokeræˆåŠŸä¿å­˜ç®—å·²æäº¤æˆ–è€…å¤šä¸ªBrokeréƒ½ä¿å­˜æˆåŠŸæ‰ç®—æˆåŠŸã€‚&lt;/p&gt;
&lt;p&gt;æœ‰é™åº¦çš„æŒä¹…åŒ–ä¿è¯ï¼šåªè¦ä¸æ˜¯æ‰€æœ‰çš„Brokeréƒ½æŒ‚æ‰ï¼Œå°±èƒ½ä¿è¯æ¶ˆæ¯æ°¸è¿œä¸ä¼šä¸¢ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç”Ÿäº§è€…å‘é€æ¶ˆæ¯ç»™Brokeræ—¶æ˜¯å¼‚æ­¥çš„ï¼ŒKafka sdkä¼šåœ¨ç”Ÿäº§è€…é‚£æ”’ä¸€æ‰¹æ¶ˆæ¯åœ¨ä¸€èµ·å‘é€ï¼Œå¦‚æœæ­¤æ—¶å‡ºç°é—®é¢˜å°±ä¼šä¸¢æ¶ˆæ¯ï¼Œæ‰€ä»¥ä¸€èˆ¬è¦é…åˆå›è°ƒå‡½æ•°ï¼Œç­‰Brokeré€šçŸ¥ç”Ÿäº§è€…æ¶ˆæ¯å‘é€æˆåŠŸï¼›æˆ–è€…ä½¿ç”¨åŒæ­¥å‘é€çš„æ–¹æ³•å‘é€æ¶ˆæ¯ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ¯ä¸€ä¸ªæ¶ˆè´¹è€…åœ¨æ¶ˆè´¹æ¶ˆæ¯æ—¶ï¼Œåœ¨Brokerä¸Šæœ‰ä¸€ä¸ªä½ç§»æ ‡è¯†ï¼Œè¡¨ç¤ºå½“å‰æ¶ˆè´¹åˆ° topicåˆ†åŒºçš„å“ªä¸ªä½ç½®ï¼Œæ‰€ä»¥æ¶ˆè´¹è€…åœ¨æ¶ˆè´¹æ—¶è¦ä¿è¯å…ˆæ¶ˆè´¹æ¶ˆæ¯ï¼Œå†æ›´æ–°ä½ç§»æ ‡è¯†ï¼Œé¿å…æ›´æ–°æ ‡è¯†åæ¶ˆæ¯æ¶ˆè´¹è¢«ä¸­æ–­ï¼Œå¯¼è‡´æ¶ˆæ¯ä¸¢å¤±ï¼Œsoä¸€èˆ¬æœ€å¥½æ‰‹åŠ¨æäº¤ä½ç§»æ›´æ–°ï¼Œä¸å¼€å¯è‡ªåŠ¨ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;è¿æ¥ç®¡ç†&#34;&gt;è¿æ¥ç®¡ç†&lt;/h3&gt;
&lt;p&gt;ç”Ÿäº§è€…ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å»ºç«‹TCPè¿æ¥ï¼šKafka Java SDKä¸­ï¼Œç”Ÿäº§è€…ä¼šåœ¨å¯åŠ¨æ—¶ï¼Œè¯»å–&lt;code&gt;bootstrap.servers&lt;/code&gt;å¾—åˆ°Brokerçš„åœ°å€ï¼Œç„¶åä¸è¿™äº›åœ°å€ä¸Šçš„Brokerå»ºç«‹TCPè¿æ¥ï¼Œé€šå¸¸&lt;code&gt;bootstrap.servers&lt;/code&gt;ä¸éœ€è¦é…ç½®å¤ªå¤šçš„Brokeråœ°å€ï¼Œ3~4ä¸ªè¶³ä»¥ï¼Œä¸€æ—¦ç”Ÿäº§è€…è¿æ¥åˆ°é›†ç¾¤ä¸­å…¶ä¸­ä¸€å°Brokerï¼Œå°±èƒ½æ‹¿åˆ°æ•´ä¸ªé›†ç¾¤çš„Brokerä¿¡æ¯ï¼Œæ­¤æ—¶å†é‡æ–°å»ºç«‹TCPè¿æ¥ï¼Œæ­¤å¤–ï¼Œç”Ÿäº§è€…ä¹Ÿä¼šæ¯5åˆ†é’Ÿè·å–é›†ç¾¤çš„metadataæ¥æ›´æ–°Brokerä¿¡æ¯ï¼Œåˆ›å»ºæ–°çš„TCPè¿æ¥ã€‚&lt;/li&gt;
&lt;li&gt;å…³é—­TCPè¿æ¥ï¼šç”¨æˆ·ä¸»åŠ¨å…³é—­ï¼›Kafkaé»˜è®¤è®¾å®šï¼Œåœ¨9åˆ†é’Ÿå†…å¦‚æœæ²¡æœ‰ä»»ä½•è¯·æ±‚ç»è¿‡è¯¥TCPè¿æ¥ï¼Œå°±ä¼šä¸»åŠ¨å…³é—­ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ¶ˆè´¹è€…ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å»ºç«‹TCPè¿æ¥ï¼šæ¶ˆè´¹è€…pollæ‹¿æ¶ˆæ¯çš„æ—¶å€™ï¼Œæ¶ˆè´¹è€…é¦–æ¬¡å¯åŠ¨åè°ƒç”¨pollæ–¹æ³•ï¼Œä¼šä¸ä»»ä¸€Brokerå»ºç«‹è¿æ¥ï¼Œè·å¾—å®ƒçš„åè°ƒè€…å¯¹åº”çš„Brokerï¼Œå†ä¸è¯¥Brokerå»ºç«‹è¿æ¥ã€‚æ­¤æ—¶æ¶ˆè´¹è€…å°±çŸ¥é“ä¹‹åæ¶ˆæ¯è·å–è¦é€šè¿‡å“ªä¸ªBrokeräº†ï¼Œå½“æ¶ˆè´¹çš„è¿æ¥æ–­å¼€åï¼Œä¸‹æ¬¡ä¼šç›´æ¥å‘è¯¥Brokerå‘èµ·è¿æ¥ã€‚&lt;/p&gt;
&lt;p&gt;æ€»å…±ä¼šå»ºç«‹3ç§è¿æ¥ï¼š1. ç¡®å®šåè°ƒè€…å’Œè·å–é›†ç¾¤å…ƒæ•°æ®ï¼›2. è¿æ¥åè°ƒè€…ï¼Œä½¿å…¶å¯ä»¥è¿›è¡Œç®¡ç†æ“ä½œï¼›3. æ‹‰å–æ¶ˆæ¯è¿›è¡Œæ¶ˆè´¹ï¼Œä¹‹ååŸºæœ¬ä¸Šå°±åªæœ‰2å’Œ3ä¸¤ç§TCPè¿æ¥äº†&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å…³é—­TCPè¿æ¥ï¼šç”¨æˆ·ä¸»åŠ¨å…³é—­ï¼›Kafkaé»˜è®¤è®¾å®šï¼Œåœ¨9åˆ†é’Ÿå†…å¦‚æœæ²¡æœ‰ä»»ä½•è¯·æ±‚ç»è¿‡è¯¥TCPè¿æ¥ï¼Œå°±ä¼šä¸»åŠ¨å…³é—­ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ— è®ºæ˜¯ç”Ÿäº§è€…çš„PRODUCEè¯·æ±‚è¿˜æ˜¯æ¶ˆè´¹è€…FETCHè¯·æ±‚å‘é€åˆ°Brokerï¼ŒBrokeréƒ½ä¼šé‡‡ç”¨Reactoræ¨¡å‹å¤„ç†è¯·æ±‚ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œ&lt;code&gt;num.network.threads = 3&lt;/code&gt;ï¼Œå³æ¯å°Brokerå¯åŠ¨æ—¶ä¼šåˆ›å»º3ä¸ªç½‘ç»œçº¿ç¨‹å¤„ç†å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œå½“ç½‘ç»œçº¿ç¨‹æ‹¿åˆ°è¯·æ±‚åï¼Œå°†è¯·æ±‚æ”¾åˆ°ä¸€ä¸ªå…±äº«è¯·æ±‚é˜Ÿåˆ—ä¸­ï¼Œæ¥ä¸‹æ¥ï¼ŒBrokeræœ‰ä¸ªIOçº¿ç¨‹æ± ï¼Œä¸“é—¨ä»å…±äº«è¯·æ±‚é˜Ÿåˆ—ä¸­å–å‡ºè¯·æ±‚ï¼Œæ‰§è¡ŒçœŸæ­£çš„å¤„ç†ï¼Œé»˜è®¤çš„IOçº¿ç¨‹æ•°æ˜¯&lt;code&gt;num.io.threads = 8&lt;/code&gt;ï¼ŒIOçº¿ç¨‹å¤„ç†å®Œæˆåï¼Œå°†ç”Ÿæˆçš„å“åº”å‘é€åˆ°ç½‘ç»œçº¿ç¨‹æ± çš„å“åº”é˜Ÿåˆ—ä¸­ï¼Œç”±å¯¹åº”çš„ç½‘ç»œçº¿ç¨‹å°†Responseè¿”å›ç»™å®¢æˆ·ç«¯ï¼Œå³ç½‘ç»œçº¿ç¨‹åªå¤„ç†è¯·æ±‚çš„æ¥æ”¶å’Œå“åº”ï¼ŒçœŸæ­£å¤„ç†é€»è¾‘åœ¨IOçº¿ç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;æ‰€æœ‰ç½‘ç»œçº¿ç¨‹å…±äº«åŒä¸€ä¸ªè¯·æ±‚é˜Ÿåˆ—ï¼Œä½†æ¯ä¸ªç½‘ç»œçº¿ç¨‹æ‹¥æœ‰è‡ªå·±çš„è¯·æ±‚å“åº”é˜Ÿåˆ—ã€‚&lt;/p&gt;
&lt;p&gt;Purgatoryç»„ä»¶ç”¨äºç¼“å­˜å»¶æ—¶è¯·æ±‚ï¼Œæ¯”å¦‚è®¾ç½®äº†&lt;code&gt;acks=all&lt;/code&gt;çš„ç”Ÿäº§è€…è¯·æ±‚ï¼Œæ­¤æ—¶è¯·æ±‚å¿…é¡»ç­‰å¾…ISRä¸­æ‰€æœ‰å‰¯æœ¬éƒ½æ¥æ”¶åˆ°äº†æ¶ˆæ¯åæ‰èƒ½è¿”å›ï¼Œæ­¤æ—¶å¤„ç†è¯¥è¯·æ±‚çš„IOçº¿ç¨‹å°±å¿…é¡»ç­‰å¾…å…¶ä»–Brokerçš„å†™å…¥ç»“æœï¼Œå› ä¸ºè¦ç­‰å¾…ç»“æœï¼Œè¯·æ±‚ä¸èƒ½ç«‹å³è¢«å¤„ç†ï¼Œå°±ä¼šæš‚å­˜åœ¨Purgatoryä¸­ï¼Œç›´åˆ°è·å–åˆ°ç»“æœï¼Œæ‰å°†å“åº”æ”¾åˆ°å¯¹åº”çš„ç½‘ç»œçº¿ç¨‹çš„å“åº”é˜Ÿåˆ—ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;ç”Ÿäº§è€…çš„PRODUCEè¯·æ±‚å’Œæ¶ˆè´¹è€…çš„FETCHè¯·æ±‚ï¼Œéƒ½å±äºæ•°æ®ç±»è¯·æ±‚ï¼ŒLeaderAndIsrã€StopReplicaè¯·æ±‚ç§°ä¸ºæ§åˆ¶ç±»è¯·æ±‚ï¼Œæ§åˆ¶ç±»è¯·æ±‚å¯ä»¥ç›´æ¥ä»¤æ•°æ®ç±»è¯·æ±‚å¤±æ•ˆï¼Œä¼˜å…ˆçº§è¾ƒé«˜ï¼ŒKafkaå†…éƒ¨ä½¿ç”¨ä¸¤å¥—ç½‘ç»œçº¿ç¨‹æ± å’ŒIOçº¿ç¨‹æ± å¤„ç†è¿™ä¸¤ç±»è¯·æ±‚ã€‚ä¹‹æ‰€ä»¥è¦è¿™æ ·åšï¼Œæ˜¯ä¸ºäº†è§£å†³å½“æœ‰æ¶ˆæ¯ç§¯å‹åœ¨Brokerä¸­ï¼Œä½†æ­¤æ—¶å‘ç”Ÿå‰¯æœ¬åˆ‡æ¢æˆ–åˆ é™¤ä¸»é¢˜æ—¶ï¼Œå¯¼è‡´è¯·æ±‚ä¸èƒ½è¢«ç«‹é©¬æ„ŸçŸ¥ï¼Œåªèƒ½ç­‰åˆ°è¶…æ—¶çš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/Kafka%e5%a4%84%e7%90%86%e8%af%b7%e6%b1%82.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/Kafka%e5%a4%84%e7%90%86%e8%af%b7%e6%b1%82.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;h3 id=&#34;å®ç°-ç²¾ç¡®ä¸€æ¬¡-qos&#34;&gt;å®ç° ç²¾ç¡®ä¸€æ¬¡ QoS&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å¹‚ç­‰æ€§ï¼šç”Ÿäº§è€…åœ¨å‘é€æ¶ˆæ¯æ—¶ï¼Œä¼šå¤šå¸¦ä¸€äº›ä¿¡æ¯ç»™Brokerï¼Œä½¿å¾—Brokerå¯ä»¥é€šè¿‡è¿™äº›ä¿¡æ¯å¯¹é‡å¤æ€§æ¶ˆæ¯å»é‡ï¼›&lt;/p&gt;
&lt;p&gt;ç”Ÿäº§è€…çš„å¹‚ç­‰æ€§åªèƒ½ä¿è¯æŸä¸€ä¸»é¢˜ä¸‹çš„ä¸€ä¸ªåˆ†åŒºã€å•ä¼šè¯ä¸Šä¸ä¼šå‡ºç°é‡å¤æ€§æ¶ˆæ¯ï¼Œæ— æ³•å®ç°å¤šä¸ªåˆ†åŒºã€è·¨ä¼šè¯å¹‚ç­‰ï¼Œå¤šåˆ†åŒºæˆ–è·¨ä¼šè¯å¹‚ç­‰åªèƒ½ä¾èµ–äº‹åŠ¡ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;äº‹åŠ¡æ€§ï¼šKafkaæ”¯æŒæäº¤è¯»éš”ç¦»çº§åˆ«çš„äº‹åŠ¡ï¼Œä¿è¯å¤šæ¡æ¶ˆæ¯åŸå­æ€§å†™å…¥ç›®æ ‡åˆ†åŒºï¼Œä¸”ä¿è¯æ¶ˆè´¹è€…åªèƒ½çœ‹åˆ°äº‹åŠ¡æäº¤æˆåŠŸçš„æ¶ˆæ¯ï¼›å¤šæ¡æ¶ˆæ¯åœ¨ä¸€ä¸ªäº‹åŠ¡å†…è¢«æäº¤åˆ°Brokerï¼Œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ï¼Œå°±ç®—å†™å…¥å¤±è´¥ï¼ŒBrokerä¹Ÿä¼šæŠŠå®ƒä»¬å†™å…¥åº•å±‚çš„æ—¥å¿—ä¸­ï¼Œæ¶ˆè´¹è€…å¯ä»¥é€‰æ‹©è¯»æˆ–è€…ä¸è¯»è¿™äº›æ¶ˆæ¯ï¼Œè¯»å–æ˜¯éš”ç¦»çº§åˆ«çš„æœªæäº¤è¯»ï¼Œä¸è¯»å–åˆ™æ˜¯æäº¤è¯»ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;æ¶ˆè´¹ç»„&#34;&gt;æ¶ˆè´¹ç»„&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;æ˜¯ä¸€ç§å¯æ‰©å±•ä¸”å…·æœ‰å®¹é”™æ€§çš„æ¶ˆè´¹æœºåˆ¶ï¼Œä¸€ä¸ªæ¶ˆè´¹ç»„å†…æœ‰å¤šä¸ªæ¶ˆè´¹è€…æˆ–å®ä¾‹ï¼Œå…±äº«ä¸€ä¸ªå…¬å…±çš„Group IDï¼Œç»„å†…çš„æ‰€æœ‰æ¶ˆè´¹è€…åè°ƒåœ¨ä¸€èµ·æ¶ˆè´¹æŸä¸ªæˆ–å¤šä¸ªä¸»é¢˜ä¸‹æ‰€æœ‰åˆ†åŒºï¼Œæ¯ä¸ªåˆ†åŒºå¯ä»¥è¢«å¤šä¸ªæ¶ˆè´¹ç»„æ¶ˆè´¹ï¼Œä½†åªèƒ½ç”±åŒä¸€ä¸ªæ¶ˆè´¹ç»„å†…çš„ä¸€ä¸ªæ¶ˆè´¹è€…æ¥æ¶ˆè´¹ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¦‚æœæ‰€æœ‰æ¶ˆè´¹è€…éƒ½å±äºåŒä¸€ä¸ªæ¶ˆè´¹ç»„ï¼Œé‚£å°±æ˜¯ç‚¹å¯¹ç‚¹æ¨¡å‹ï¼Œå¦‚æœæ‰€æœ‰æ¶ˆè´¹è€…è¢«åˆ†æ•£åœ¨ä¸åŒçš„æ¶ˆè´¹ç»„ï¼Œåˆ™æ˜¯å‘å¸ƒ/è®¢é˜…æ¨¡å¼ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ¶ˆè´¹è€…å®ä¾‹çš„æ•°é‡ç­‰äºè¯¥æ¶ˆè´¹ç»„è®¢é˜…ä¸»é¢˜çš„åˆ†åŒºæ€»æ•°ï¼Œå¦‚æœå¤§äºåˆ†åŒºæ€»æ•°ï¼Œå¤šä½™çš„å®ä¾‹å¹¶ä¸ä¼šè¢«åˆ†é…ä»»ä½•åˆ†åŒºï¼Œä¼šæ°¸è¿œç©ºé—²ï¼Œæ¯”è¾ƒæµªè´¹ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Brokerä¼šä¿å­˜æ¯ä¸ªæ¶ˆè´¹ç»„æ¶ˆè´¹åˆ†åŒºçš„ä½ç§»ï¼Œè€ç‰ˆæœ¬ä¸­ï¼Œæ¯ä¸ªæ¶ˆè´¹ç»„çš„ä½ç§»æ˜¯ä¿å­˜åœ¨ZooKeeperä¸­ï¼Œä½†æ˜¯ç”±äºä½ç§»çš„æ›´æ–°æ¯”è¾ƒé¢‘ç¹ï¼Œè€ŒZooKeeperæ˜¯ä¸ªCPè¦ä¿å­˜æ•°æ®ä¸€è‡´æ€§ï¼Œå¹¶ä¸é€‚åˆé¢‘ç¹æ›´æ–°ï¼Œä¼šæœ‰æ€§èƒ½é—®é¢˜ï¼Œæ‰€ä»¥æ–°ç‰ˆæœ¬åˆ†åŒºä½ç§»æ˜¯ä¿å­˜åœ¨Brokerçš„ä¸»é¢˜ä¸­ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;é‡å¹³è¡¡rebalance&#34;&gt;é‡å¹³è¡¡Rebalance&lt;/h3&gt;
&lt;p&gt;æ˜¯ä¸€ç§åè®®ï¼Œä¼šå¯¹ä¸€ä¸ªä¸»é¢˜ä¸‹çš„æ‰€æœ‰åˆ†åŒºå¹³å‡åˆ†ç»™ä¸€ä¸ªç»„é‡Œçš„æ‰€æœ‰æ¶ˆè´¹è€…ï¼Œç”±Brokeré€šè¿‡ä¸€å®šçš„åˆ†é…è§„åˆ™è¿›è¡Œåè°ƒï¼Œ&lt;strong&gt;ä¸ºæ¶ˆè´¹ç»„å†…çš„æ¯ä¸ªæ¶ˆè´¹è€…åˆ†é…è¯¥ä¸»é¢˜ä¸‹è¦æ¶ˆè´¹çš„åˆ†åŒº&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;é‡å¹³è¡¡è§¦å‘æ¡ä»¶ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç»„å†…æ¶ˆè´¹è€…æ•°é‡å˜æ›´ï¼Œå¦‚ç»„æˆå‘˜çš„åŠ å…¥ã€ç¦»å¼€æˆ–è€…ç»„æˆå‘˜å´©æºƒï¼›&lt;/li&gt;
&lt;li&gt;ä¸»é¢˜çš„æ•°é‡å˜æ›´ï¼›&lt;/li&gt;
&lt;li&gt;ä¸»é¢˜å†…åˆ†åŒºæ•°é‡å˜æ›´ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é‡å¹³è¡¡æ—¶ï¼Œæ‰€æœ‰æ¶ˆè´¹è€…ä¼šåœæ­¢æ¶ˆè´¹ï¼Œç±»ä¼¼STWï¼Œç›´åˆ°é‡å¹³è¡¡ç»“æŸï¼Œå› ä¸ºé‡å¹³è¡¡åï¼Œæ¶ˆè´¹è€…å¯èƒ½éœ€è¦é‡æ–°ä¸Brokerå»ºç«‹TCPè¿æ¥ï¼Œä¼šæ¯”è¾ƒè€—æ—¶é—´å’Œèµ„æºï¼›&lt;/p&gt;
&lt;p&gt;é‡å¹³è¡¡ç”±åè°ƒè€…Coordinatorç®¡ç†ï¼Œå®ƒå­˜åœ¨äºBrokerä¸­ï¼Œæ¶ˆè´¹è€…æäº¤ä½ç§»æ—¶ï¼Œæ˜¯å‘åè°ƒè€…æ‰€åœ¨çš„Brokeræäº¤ä½ç§»ï¼Œç„¶åç”±åè°ƒè€…è´Ÿè´£æ‰§è¡Œæ¶ˆè´¹ç»„çš„æ³¨å†Œã€æˆå‘˜ç®¡ç†ç­‰å…ƒæ•°æ®çš„æ“ä½œï¼›&lt;/p&gt;
&lt;p&gt;æ¶ˆè´¹ç»„é€šè¿‡ä½ç§»ä¸»é¢˜ï¼Œç¡®å®šåè°ƒè€…åœ¨å“ªä¸ªBrokerä¸Šï¼Œè®¡ç®—æ–¹æ³•ï¼šé€šè¿‡å¯¹GroupIdåšå“ˆå¸Œè®¡ç®—ï¼Œå¯¹ä½ç§»ä¸»é¢˜åˆ†åŒºæ•°å–æ¨¡ï¼Œå¾—åˆ°åˆ†åŒºå·ï¼Œåœ¨æ‰¾åˆ°è¯¥åˆ†åŒºå‰¯æœ¬ä¸­çš„Leaderï¼Œè¯¥Brokerå°±æ˜¯åè°ƒè€…äº†ã€‚&lt;/p&gt;
&lt;p&gt;æ¯ä¸ªæ¶ˆè´¹è€…é»˜è®¤æƒ…å†µä¸‹æ¯10sä¼šå‘é€å¿ƒè·³ç»™åè°ƒè€…ï¼Œè¡¨æ˜å­˜æ´»ï¼Œå¦‚æœåè°ƒè€…æ”¶ä¸åˆ°ï¼Œå°±ä¼šè®¤å®šè¯¥æ¶ˆè´¹ç»„å·²æŒ‚ï¼Œè§¦å‘é‡å¹³è¡¡ï¼›å¦å¤–ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¸‹ï¼Œå¦‚æœæ¶ˆè´¹è€…åœ¨5åˆ†é’Ÿå†…æ— æ³•æ‹‰å–æ¶ˆæ¯å¹¶å¤„ç†å®Œï¼Œä¹Ÿä¼šè¢«è®¤å®šå·²æŒ‚ï¼Œè§¦å‘é‡å¹³è¡¡ï¼›&lt;/p&gt;
&lt;p&gt;ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå¿ƒè·³å‘é€æ—¶é—´é—´éš”è®¾ç½®ä¸º&lt;code&gt;heartbeat.interval.ms = 2s&lt;/code&gt;ï¼Œä¼šè¯è¶…æ—¶æ—¶é—´ä¸º&lt;code&gt;session.timeout.ms = 6s&lt;/code&gt;ï¼Œå³éœ€è¦3æ¬¡å¿ƒè·³éƒ½æ²¡è¢«æ¥æ”¶åˆ°ï¼Œå°±ç®—æ¶ˆè´¹è€…æŒ‚æ‰ï¼›&lt;code&gt;max.poll.interval.ms&lt;/code&gt; è¡¨æ˜æ¶ˆè´¹è€…å¤„ç†ä¸€æ‰¹æ¶ˆæ¯çš„æœ€è¿Ÿæ—¶é—´ï¼›&lt;/p&gt;
&lt;p&gt;é‡å¹³è¡¡è¿‡ç¨‹ä¸­ï¼Œé€šè¿‡æ¶ˆè´¹è€…çš„å¿ƒè·³çº¿ç¨‹é€šçŸ¥å…¶ä»–æ¶ˆè´¹è€…ï¼ŒBrokeré€šè¿‡åœ¨å¿ƒè·³ä¸­è®¾ç½®&lt;code&gt;REBALANCE_IN_PROCESS&lt;/code&gt;ï¼Œå“åº”ç»™æ¶ˆè´¹è€…ï¼Œé€šçŸ¥æ¶ˆè´¹è€…è¦å¼€å§‹é‡å¹³è¡¡äº†ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/Kakfa%e9%87%8d%e5%b9%b3%e8%a1%a1%e7%8a%b6%e6%80%81%e6%b5%81%e8%bd%ac.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/Kakfa%e9%87%8d%e5%b9%b3%e8%a1%a1%e7%8a%b6%e6%80%81%e6%b5%81%e8%bd%ac.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;å¯¹äºæ¶ˆè´¹è€…æ¥è¯´ï¼Œé‡å¹³è¡¡åˆ†ä¸ºä¸¤ä¸ªæ­¥éª¤ï¼š1. åŠ å…¥ç»„ï¼ŒJoinGroupè¯·æ±‚ï¼› 2. ç­‰å¾…é¢†å¯¼è€…æ¶ˆè´¹è€…åˆ†é…æ–¹æ¡ˆï¼ŒSyncGroupè¯·æ±‚ï¼›&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;å½“ç»„æˆå‘˜åŠ å…¥ç»„æ—¶ï¼Œä¼šå‘åè°ƒè€…å‘é€JoinGroupè¯·æ±‚ï¼Œåœ¨è¯¥è¯·æ±‚ä¸­ï¼Œæ¯ä¸ªæˆå‘˜éƒ½å°†è‡ªå·±è®¢é˜…çš„ä¸»é¢˜ä¸ŠæŠ¥ï¼Œåè°ƒè€…æ”¶é›†æ‰€æœ‰æˆå‘˜çš„è®¢é˜…ä¿¡æ¯ï¼Œæ”¶é›†å®Œæˆåï¼Œé€‰å‡ºé¢†å¯¼è€…æ¶ˆè´¹è€…ï¼Œå¹¶æŠŠç»„æˆå‘˜ä¿¡æ¯ä»¥åŠè®¢é˜…ä¿¡æ¯å‘é€ç»™Leaderï¼›&lt;/p&gt;
&lt;p&gt;ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œç¬¬ä¸€ä¸ªå‘é€JoinGroupè¯·æ±‚çš„æˆå‘˜è‡ªåŠ¨æˆä¸ºé¢†å¯¼è€…ï¼Œä¹‹åç”±é¢†å¯¼è€…åˆ¶å®šåˆ†åŒºåˆ†é…æ–¹æ¡ˆï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;é¢†å¯¼è€…å‘åè°ƒè€…å‘é€SyncGroupè¯·æ±‚ï¼Œé¢†å¯¼è€…å°† 1 ä¸­åˆ¶å®šçš„åˆ†é…æ–¹æ¡ˆå‘é€ç»™åè°ƒè€…ï¼Œå…¶ä»–æˆå‘˜ä¹Ÿä¼šå‘åè°ƒè€…å‘é€SyncGroupè¯·æ±‚ï¼Œåªæ˜¯è¯·æ±‚ä¸­æ²¡æœ‰å®é™…å†…å®¹ï¼Œè¿™ä¸€æ­¥ä¸»è¦æ˜¯è®©åè°ƒè€…æ¥æ”¶åˆ†é…æ–¹æ¡ˆåï¼Œç»Ÿä¸€ä»¥SyncGroupå“åº”çš„æ–¹å¼åˆ†å‘ç»™æ‰€æœ‰æˆå‘˜ä»¬ï¼Œä½¿å¾—ç»„å†…æ‰€æœ‰æˆå‘˜éƒ½çŸ¥é“è‡ªå·±è¯¥æ¶ˆè´¹å“ªäº›åˆ†åŒºã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;ä½ç§»ä¸»é¢˜&#34;&gt;ä½ç§»ä¸»é¢˜&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ä¸ºäº†è§£å†³è€ç‰ˆæœ¬&lt;strong&gt;æ¶ˆè´¹ç»„æ¶ˆè´¹ä½ç§»ç®¡ç†ä¾èµ–&lt;/strong&gt;ZooKeeperå¯¼è‡´æ€§èƒ½ä¸é«˜çš„é—®é¢˜ï¼Œæ–°ç‰ˆæœ¬çš„ä½ç§»ç®¡ç†æ–¹æ¡ˆæ˜¯é€šè¿‡&lt;code&gt;__consumer_offsets&lt;/code&gt;è¿™ä¸ªä¸»é¢˜æ¥å®ç°çš„ï¼Œä»¥è¾¾åˆ°æ”¯æŒé«˜æŒä¹…æ€§å’Œé«˜é¢‘å†™æ“ä½œçš„ç›®çš„ã€‚&lt;/p&gt;
&lt;p&gt;è¯¥ä¸»é¢˜åªæ˜¯Kafkaä¸€ä¸ªæ™®é€šä¸»é¢˜ï¼ŒåŒæ ·å¯ä»¥å¯¹å®ƒè¿›è¡Œæ“ä½œï¼Œåªæ˜¯æ¶ˆæ¯çš„æ ¼å¼ç”±Kafkaå®šä¹‰ï¼Œç”¨æˆ·æ— æ³•ä¿®æ”¹ï¼Œæ— æ³•éšæ„å‘è¿™ä¸ªä¸»é¢˜å†™æ¶ˆæ¯ï¼Œå±äºå†…éƒ¨ä¸»é¢˜ï¼Œä¸€èˆ¬ä¸éœ€è¦å»ç®¡ç†å®ƒã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ¶ˆæ¯ä½“ç±»å‹åˆ†ä¸º3ç§ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸€èˆ¬ä½ç§»æ¶ˆæ¯ï¼šæ¶ˆæ¯ä½“æ ¼å¼æ˜¯Key-Valueå½¢å¼çš„ï¼Œkeyä¸º&lt;code&gt;&amp;lt;GroupIdï¼Œä¸»é¢˜åï¼Œåˆ†åŒºå·&amp;gt;&lt;/code&gt;ï¼Œæ¶ˆæ¯ä½“é™¤äº†ä¿å­˜ä½ç§»å€¼ï¼Œè¿˜ä¿å­˜æ—¶é—´æˆ³ã€ç”¨æˆ·è‡ªå®šä¹‰æ•°æ®ç­‰å…ƒæ•°æ®ä¾›Kafkaåšå…¶ä»–æ“ä½œ&lt;/li&gt;
&lt;li&gt;ç”¨äºä¿å­˜Consumer Groupä¿¡æ¯çš„æ¶ˆæ¯&lt;/li&gt;
&lt;li&gt;ç”¨äºåˆ é™¤Groupè¿‡æœŸä½ç§»æˆ–è€…åˆ é™¤Groupçš„æ¶ˆæ¯ï¼Œä¸€æ—¦æŸä¸ªæ¶ˆè´¹ç»„ä¸‹çš„æ‰€æœ‰æ¶ˆè´¹è€…éƒ½åœæ­¢ï¼Œä¸”å®ƒä»¬çš„ä½ç§»æ•°æ®éƒ½å·²ç»è¢«åˆ é™¤æ—¶ï¼Œå°±ä¼šå‘ä½ç§»ä¸»é¢˜å†™å…¥è¿™æ¡æ¶ˆæ¯ï¼Œè¡¨æ˜è¦åˆ é™¤è¿™ä¸ªæ¶ˆè´¹ç»„çš„ä¿¡æ¯&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åˆ›å»ºæ—¶æœºï¼šé»˜è®¤æƒ…å†µä¸‹ï¼Œç¬¬ä¸€ä¸ªæ¶ˆè´¹è€…å¯åŠ¨æ—¶ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºä½ç§»ä¸»é¢˜ï¼Œé»˜è®¤é…ç½®æ˜¯50ä¸ªåˆ†åŒºï¼Œ3ä¸ªå‰¯æœ¬ï¼Œä¹Ÿå¯ä»¥æ‰‹åŠ¨é€šè¿‡APIåˆ›å»º&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä½ç§»æäº¤åˆ†ä¸ºè‡ªåŠ¨æäº¤å’Œæ‰‹åŠ¨æäº¤ï¼Œç±»ä¼¼ACK&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Brokerä¼šåœ¨åå°å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹ï¼Œä½¿ç”¨Compactç­–ç•¥æ¥å®šæ—¶åˆ é™¤ä½ç§»ä¸»é¢˜ä¸­çš„è¿‡æœŸæ¶ˆæ¯ï¼Œé¿å…ç£ç›˜è¢«å æ»¡ï¼Œåˆ¤æ–­çš„ä¾æ®æ˜¯æ¶ˆæ¯çš„æ—¶é—´&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;æ¶ˆè´¹ç»„æ¶ˆè´¹ä½ç§»&#34;&gt;æ¶ˆè´¹ç»„æ¶ˆè´¹ä½ç§»&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;æ¶ˆè´¹ä½ç§»è®°å½•çš„æ˜¯ä¸‹ä¸€æ¡æ¶ˆæ¯çš„ä½ç§»ï¼Œè€Œä¸æ˜¯å½“å‰æœ€æ–°æ¶ˆè´¹çš„ä½ç§»ï¼Œæ¶ˆè´¹è€…ä¼šä¸ºåˆ†é…ç»™ä»–çš„æ¯ä¸ªåˆ†åŒºæäº¤è‡ªå·±çš„ä½ç§»æ•°æ®ï¼Œé€šè¿‡æ¶ˆè´¹ä½ç§»æ¥è¡¨æ˜æ¶ˆè´¹è€…çš„æ¶ˆè´¹é€Ÿåº¦å’Œè®°å½•ï¼Œå½“æ¶ˆè´¹è€…æ•…éšœé‡å¯åï¼Œè¿˜èƒ½ç»§ç»­æ¶ˆè´¹ï¼Œé¿å…é‡å¤ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ¶ˆè´¹è€…å¤„ç†æ¶ˆæ¯æ—¶æ˜¯ä¸€æ‰¹ä¸€æ‰¹å¤„ç†çš„ï¼Œå¤„ç†å®Œæˆåæ›´æ–°è¿™ä¸€æ‰¹æ¶ˆæ¯çš„ä½ç§»ï¼Œå¦‚æœè¿™ä¸€æ‰¹æ¶ˆæ¯é‡å¤ªå¤§ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©å¤„ç†ä¸€å®šæ•°é‡åå°±æ›´æ–°ä½ç§»ï¼Œé¿å…ä¸€æ¬¡å¤±è´¥åè¦é‡æ–°å…¨éƒ¨æ¶ˆè´¹ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;é»˜è®¤å¼€å¯è‡ªåŠ¨æäº¤ï¼Œè®¾ç½®è‡ªåŠ¨æäº¤ä½ç§»æ—¶ï¼Œæ˜¯æ¯5sè‡ªåŠ¨æäº¤ä¸€æ¬¡ï¼Œå¯èƒ½å‡ºç°é‡å¤æ¶ˆè´¹ï¼›&lt;/p&gt;
&lt;p&gt;åŒæ­¥æ‰‹åŠ¨æäº¤æ—¶ï¼Œè™½ç„¶æ¯”è¾ƒç²¾å‡†ï¼Œä½†æ˜¯æäº¤æ—¶æ˜¯åŒæ­¥çš„ï¼Œä¼šé˜»å¡ç­‰å¾…Brokerçš„è¿”å›ï¼Œæ­¤æ—¶æ¶ˆè´¹è€…æ— æ³•ç»§ç»­æ¶ˆè´¹ï¼›&lt;/p&gt;
&lt;p&gt;å¼‚æ­¥æ‰‹åŠ¨æäº¤ï¼Œéœ€è¦æ³¨å†Œå›è°ƒå‡½æ•°ï¼Œå¤„ç†Brokerè¿”å›çš„ç»“æœï¼Œä½†ä¹Ÿå› ä¸ºå¼‚æ­¥ï¼Œæ— æ³•è¿›è¡Œé‡è¯•ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;å‰¯æœ¬&#34;&gt;å‰¯æœ¬&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Kafkaæ¯ä¸ªä¸»é¢˜åˆ’åˆ†æˆè‹¥å¹²åˆ†åŒºï¼Œ&lt;strong&gt;æ¯ä¸ªåˆ†åŒºå¯ä»¥æœ‰å¤šä¸ªå‰¯æœ¬ï¼Œå‰¯æœ¬ä»…æä¾›æ•°æ®å†—ä½™ï¼Œæé«˜æ¶ˆæ¯å­˜å‚¨çš„å®‰å…¨æ€§ï¼Œæé«˜å®¹ç¾èƒ½åŠ›ï¼ŒåŒä¸€ä¸ªåˆ†åŒºçš„å¤šä¸ªå‰¯æœ¬åªå…è®¸æœ‰ä¸€ä¸ªè¿›è¡Œè¯»å†™&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å‰¯æœ¬æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªåªèƒ½è¿½åŠ å†™æ¶ˆæ¯çš„æäº¤æ—¥å¿—ï¼ŒåŒä¸€ä¸ªåˆ†åŒºä¸‹çš„æ‰€æœ‰å‰¯æœ¬ä¿å­˜ç›¸åŒçš„æ¶ˆæ¯åºåˆ—ï¼Œå‰¯æœ¬åˆ†æ•£åœ¨ä¸åŒçš„Brokerä¸Šï¼Œä»è€Œåˆ†æ‘Šéƒ¨åˆ†Brokerå®•æœºå¸¦æ¥çš„æ•°æ®ä¸å¯ç”¨é—®é¢˜ï¼Œæ‰€ä»¥ï¼Œ&lt;strong&gt;æ¯å°Brokeréƒ½å¯èƒ½ä¿å­˜æœ‰å„ä¸ªä¸»é¢˜ä¸‹ä¸åŒåˆ†åŒºçš„ä¸åŒå‰¯æœ¬&lt;/strong&gt;ï¼Œå•ä¸ªBrokerå¯ä»¥ä¿å­˜æˆç™¾ä¸Šåƒä¸ªå‰¯æœ¬ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Kafkaé€šè¿‡åŸºäºé¢†å¯¼è€…çš„å‰¯æœ¬æœºåˆ¶ï¼Œä¿è¯æ‰€æœ‰å‰¯æœ¬çš„æ•°æ®ä¸€è‡´æ€§ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ¯ä¸ªåˆ†åŒºåœ¨åˆ›å»ºæ—¶è¦é€‰ä¸¾ä¸€ä¸ªå‰¯æœ¬ï¼Œä½œä¸ºLeaderï¼Œå…¶ä»–å‰¯æœ¬ä½œä¸ºFollowerï¼›&lt;/li&gt;
&lt;li&gt;Followerå‰¯æœ¬ä¸å¯¹å¤–æä¾›æœåŠ¡ï¼Œå³ä¸å“åº”ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çš„ä»»ä½•è¯»å†™è¯·æ±‚ï¼Œæ‰€æœ‰è¯»å†™è¯·æ±‚éƒ½ç”±Leaderå‰¯æœ¬å¤„ç†ï¼Œå³Leaderå‰¯æœ¬æ‰€åœ¨çš„Brokerï¼ŒFollowerå‰¯æœ¬å”¯ä¸€çš„ä»»åŠ¡æ˜¯ä»Leaderå‰¯æœ¬ä¸­å¼‚æ­¥æ‹‰å–æ¶ˆæ¯ï¼Œå†™å…¥åˆ°è‡ªå·±çš„æäº¤æ—¥å¿—ä¸­ï¼Œå®ç°æ—¥å¿—åŒæ­¥ï¼›&lt;/li&gt;
&lt;li&gt;å¦‚æœLeaderå‰¯æœ¬æŒ‚æ‰ï¼Œå³å¯¹åº”çš„Brokerå®•æœºï¼ŒKafkaä¾èµ–ZooKeeperæä¾›çš„Watchç›‘æ§åŠŸèƒ½å®æ—¶æ„ŸçŸ¥ï¼Œå¼€å¯æ–°Leaderçš„é€‰ä¸¾ï¼Œä»Followerå‰¯æœ¬ä¸­é€‰å‡ºä¸€ä¸ªLeaderï¼Œè€Leaderå›å½’åï¼Œé™çº§ä¸ºFollowerå‰¯æœ¬åŠ å…¥ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è¿™ç§å‰¯æœ¬æœºåˆ¶çš„å¥½å¤„ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç¡®ä¿ç”Ÿäº§è€…å†™å…¥çš„æ¶ˆæ¯ï¼Œæ¶ˆè´¹è€…èƒ½ç«‹å³è¯»åˆ°ï¼Œå› ä¸ºå¦‚æœæ˜¯è¯»Followerå‰¯æœ¬ï¼Œå¯èƒ½å­˜åœ¨å»¶è¿Ÿï¼›&lt;/li&gt;
&lt;li&gt;ç¡®ä¿æ¶ˆè´¹è€…è¯»å–æ—¶ï¼Œä¸ä¼šå› ä¸ºè´Ÿè½½å‡è¡¡ä¹‹ç±»çš„åŸå› ï¼Œå¯¼è‡´ä¸€ä¼šèƒ½è¯»åˆ°æ¶ˆæ¯ä¸€ä¼šè¯»ä¸åˆ°ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Leaderå‰¯æœ¬å’ŒFollowerå‰¯æœ¬ç»„æˆçš„é›†åˆå«ISR&lt;/strong&gt;ï¼ŒISRç”±åˆ†åŒºLeaderç»´æŠ¤ï¼ŒKafkaç¡®ä¿Followerå‰¯æœ¬çš„è¿›åº¦è·ŸLeaderå‰¯æœ¬çš„å·®è·ï¼Œä¸çœ‹ä¸¤è€…ä¹‹é—´ç›¸å·®å¤šå°‘æ¶ˆæ¯ï¼Œè€Œæ˜¯çœ‹Followerå‰¯æœ¬åœ¨å¤åˆ¶æ¶ˆæ¯æ—¶å¯è¢«å…è®¸çš„æœ€å¤§å»¶è¿Ÿæ—¶é—´ï¼š&lt;code&gt;replica.lag.time.max.ms&lt;/code&gt;ï¼Œåªè¦è¶…è¿‡è¿™ä¸ªæ•°ï¼Œå°±è¯´æ˜FolloweråŒæ­¥è½åäº†ï¼Œå¦‚æœè½åå¤ªå¤šï¼Œè¿™ä¸ªFollowerå‰¯æœ¬å°±ä¼šè¢«è¸¢å‡ºISRï¼Œå¦‚æœåé¢è¿›åº¦è¿½ä¸Šäº†ï¼Œæ‰ä¼šåŠ å›ISRï¼›ISRä¸­è‡³å°‘æœ‰ä¸€ä¸ªå‰¯æœ¬ï¼Œä¸”è¯¥å‰¯æœ¬ä¸ºLeaderï¼›&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;è¢«è¸¢å‡ºISRçš„åˆ†åŒºå‰¯æœ¬ç»„æˆçš„é›†åˆå«OSR&lt;/strong&gt;ï¼Œæ–°åŠ å…¥çš„Followerä¹Ÿä¼šå­˜å…¥OSRåˆ—è¡¨ï¼ŒISRåˆ—è¡¨ + OSRåˆ—è¡¨ = ARï¼ˆassigned ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å½“ISRä¸ºç©ºæ—¶ï¼Œè¯´æ˜Leaderå‰¯æœ¬ä¹ŸæŒ‚æ‰äº†ï¼Œæ­¤æ—¶éœ€è¦é€‰ä¸¾&lt;/strong&gt;ï¼ŒKafkaæŠŠæ‰€æœ‰ä¸åœ¨ISRä¸­çš„å­˜æ´»å‰¯æœ¬ç§°ä¸ºéåŒæ­¥å‰¯æœ¬ï¼Œé€šè¿‡&lt;code&gt;unclean.leader.election.enable&lt;/code&gt;æ§åˆ¶æ–°Leaderæ˜¯å¦è¦ä»è¿™äº›éåŒæ­¥å‰¯æœ¬ä¸­é€‰ä¸¾ï¼Œå¦‚æœé€‰ä¸¾ï¼Œç”±äºå®ƒä»¬è¿›åº¦è½åå‰Leaderï¼Œæ˜¯ä¼šé€ æˆä¸¢æ•°æ®çš„é—®é¢˜ï¼Œè¿™é‡Œå°±æ¶‰åŠåˆ°Cå’ŒAçš„é€‰æ‹©äº†ï¼Œä¸€èˆ¬æ˜¯ä¸å¼€å¯å®ƒï¼Œ&lt;strong&gt;Cæ¯”è¾ƒé‡è¦&lt;/strong&gt;ï¼Œæ‰€ä»¥ä¸€èˆ¬é€‰æ‹©åŒæ­¥è¿›åº¦æœ€é«˜çš„Followerä½œä¸ºLeaderï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å‰¯æœ¬ä¸­çš„&lt;strong&gt;é«˜æ°´ä½&lt;/strong&gt;ï¼ˆHight Waterï¼‰ï¼šè¡¨ç¤ºæ¶ˆæ¯çš„ä½ç½®ï¼Œå³ä½ç§»ï¼Œå–å€¼æ¥è‡ªåˆ†åŒºä¸­å¯¹åº”çš„ISRåˆ—è¡¨ä¸­æœ€å°çš„LEOä½œä¸ºé«˜æ°´ä½ï¼Œæ¶ˆè´¹è€…æœ€å¤šåªèƒ½æ¶ˆè´¹åˆ°é«˜æ°´ä½æ‰€åœ¨ä½ç½®çš„ä¸Šä¸€æ¡ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;p&gt;å½“æ¶ˆæ¯ä½ç§»å°äºé«˜æ°´ä½ï¼Œå±äºå·²æäº¤çš„æ¶ˆæ¯ï¼Œæ¶ˆè´¹è€…åªèƒ½æ¶ˆè´¹å·²æäº¤çš„æ¶ˆæ¯ï¼Œå½“æ¶ˆæ¯ä½ç§»å¤§äºç­‰äºé«˜æ°´ä½ï¼Œå±äºæœªæäº¤çš„æ¶ˆæ¯ï¼Œå³å¤„äºå·²æäº¤çš„æ¶ˆæ¯å’Œæœªæäº¤çš„æ¶ˆæ¯çš„è¾¹ç•Œå°±æ˜¯é«˜æ°´ä½ã€‚&lt;strong&gt;é«˜æ°´ä½ä¸»è¦æ˜¯å®šä¹‰æ¶ˆæ¯çš„å¯è§æ€§ï¼Œç”¨æ¥æ ‡è¯†åˆ†åŒºä¸‹å“ªäº›æ¶ˆæ¯å¯ä»¥è¢«æ¶ˆè´¹&lt;/strong&gt;ï¼Œå¸®åŠ©Kafkaå®Œæˆå‰¯æœ¬åŒæ­¥ã€‚&lt;strong&gt;æäº¤æŒ‡çš„æ˜¯æ¶ˆæ¯æˆåŠŸå†™å…¥åˆ°Leaderå‰¯æœ¬ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å‰¯æœ¬ä¸­çš„&lt;strong&gt;LEO&lt;/strong&gt;ï¼ˆLog End Offsetï¼‰ï¼š&lt;strong&gt;è¡¨ç¤ºå‰¯æœ¬å†™å…¥çš„æ—¥å¿—æ–‡ä»¶ä¸­ä¸‹ä¸€æ¡æ¶ˆæ¯çš„ä½ç§»å€¼&lt;/strong&gt;ï¼ŒåŒä¸€å‰¯æœ¬ä¸‹ï¼Œå…¶é«˜æ°´ä½çš„å€¼ä¸ä¼šå¤§äºLEOçš„å€¼ã€‚æ¯ä¸€ä¸ªå‰¯æœ¬éƒ½æœ‰å¯¹åº”çš„é«˜æ°´ä½å’ŒLEOçš„å€¼ï¼Œ**åˆ†åŒºçš„é«˜æ°´ä½å°±æ˜¯å…¶Leaderå‰¯æœ¬çš„é«˜æ°´ä½ï¼Œ**Leaderå‰¯æœ¬æ‰€åœ¨çš„Brokerï¼Œè¿˜ä¿å­˜äº†å…¶ä»–Followerå‰¯æœ¬çš„LEOå€¼ã€‚æ›´æ–°æ—¶ï¼ŒKafkaä¼šæ›´æ–°æ‰€æœ‰å‰¯æœ¬çš„é«˜æ°´ä½å’ŒLEOå€¼ï¼ŒåŒæ—¶ä¹Ÿä¼šæ›´æ–°Leaderå‰¯æœ¬ä¸Šæ‰€æœ‰å…¶ä»–Followerå‰¯æœ¬çš„LEOå€¼ï¼Œä½†ä¸æ›´æ–°å…¶é«˜æ°´ä½ï¼Œç›®çš„æ˜¯å¸®åŠ©Leaderå‰¯æœ¬ç¡®å®šå…¶é«˜æ°´ä½ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;LSOï¼ˆLast Stable Offsetï¼‰ï¼šå¯¹æœªå®Œæˆçš„äº‹åŠ¡è€Œè¨€ï¼ŒLSOçš„å€¼ç­‰äºäº‹åŠ¡ä¸­ç¬¬ä¸€æ¡æ¶ˆæ¯çš„ä½ç½®ï¼Œå¯¹äºå·²å®Œæˆçš„äº‹åŠ¡è€Œè¨€ï¼Œå®ƒçš„å€¼ä¸é«˜æ°´ä½ç›¸åŒã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;æ€»ç»“&lt;/strong&gt;ï¼šæ¶ˆæ¯å‘é€ç»™åˆ†åŒºçš„Leaderåï¼Œä¼šåŒæ­¥ç»™Followerï¼Œæ¶ˆè´¹è€…æ¶ˆè´¹æ—¶ï¼Œåªèƒ½æ ¹æ®ISRåˆ—è¡¨ï¼ŒæŸ¥çœ‹å“ªäº›æ¶ˆæ¯åœ¨é«˜æ°´ä½ä¸Šï¼Œæ‰èƒ½è¢«è¯»å–ï¼Œ&lt;strong&gt;é«˜æ°´ä½å–å†³äºISRåˆ—è¡¨é‡Œåç§»é‡æœ€å°çš„åˆ†åŒº&lt;/strong&gt;ï¼Œç±»ä¼¼æœ¨æ¡¶åŸç†ï¼Œä»è€Œä¿è¯ä¸€è‡´æ€§ï¼Œå¦åˆ™ï¼Œå¦‚æœæ¶ˆæ¯æ²¡æœ‰åŒæ­¥åˆ°å¤šä¸ªFollowerï¼ŒLeaderå°±å®•æœºäº†ï¼Œå¦‚æœæœ‰è½åçš„Followerè¢«é€‰ä¸¾ä¸ºLeaderï¼Œåˆè¢«æ¶ˆè´¹è€…æ¶ˆè´¹äº†ï¼Œå°±ç ´åä¸€è‡´æ€§äº†ï¼›å¼•å…¥é«˜æ°´ä½æœºåˆ¶ï¼Œå¦‚æœBrokeré—´æ¶ˆæ¯çš„å¤åˆ¶æ…¢äº†ï¼Œé‚£ä¹ˆæ¶ˆæ¯åˆ°è¾¾æ¶ˆè´¹è€…çš„æ—¶é—´å°±ä¼šéšä¹‹å˜é•¿ã€‚&lt;/p&gt;
&lt;h4 id=&#34;å‰¯æœ¬åŒæ­¥æœºåˆ¶&#34;&gt;å‰¯æœ¬åŒæ­¥æœºåˆ¶&lt;/h4&gt;
&lt;p&gt;æµç¨‹æ€»ç»“ï¼š1. ç”Ÿäº§è€…å‘é€æ¶ˆæ¯ï¼›2. Zookeeperæ‰¾åˆ°åˆ†åŒºLeaderï¼›3. æ¨é€æ¶ˆæ¯ï¼›4. é€šè¿‡ISRåˆ—è¡¨é€šçŸ¥ç»™Followerï¼›5. Followerä»Leaderæ‹‰å–æ¶ˆæ¯ï¼Œå‘é€ackï¼›6. Leaderæ”¶åˆ°æ‰€æœ‰å‰¯æœ¬çš„ackï¼Œæ›´æ–°Offsetï¼Œå¹¶å‘ç”Ÿäº§è€…å‘é€ackï¼Œè¡¨ç¤ºæ¶ˆæ¯å†™å…¥æˆåŠŸã€‚&lt;/p&gt;
&lt;p&gt;å…·ä½“æµç¨‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ç”Ÿäº§è€…å‘é€æ¶ˆæ¯ç»™Brokeræ—¶ï¼Œ Leaderå‰¯æœ¬ï¼Œå¤„ç†ç”Ÿäº§è€…è¯·æ±‚æµç¨‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;å†™å…¥æ¶ˆæ¯åˆ°æœ¬åœ°ç£ç›˜&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ›´æ–°åˆ†åŒºé«˜æ°´ä½å€¼&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;è·å–Leaderå‰¯æœ¬æ‰€åœ¨çš„Brokerç«¯ä¿å­˜çš„æ‰€æœ‰è¿œç¨‹Followerå‰¯æœ¬LEOå€¼ï¼ŒLEO-1ã€LEO-2&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è·å–Leaderå‰¯æœ¬é«˜æ°´ä½å€¼ï¼šcurrentHW&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ›´æ–°å½“å‰é«˜æ°´ä½å€¼ï¼šcurrentHW = max{currentHWï¼Œ minï¼ˆLEO-1ã€LEO-2 &amp;hellip;ï¼‰}&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Leaderå‰¯æœ¬ï¼Œå¤„ç†Followerå‰¯æœ¬æ‹‰å–æ¶ˆæ¯çš„è¯·æ±‚ï¼Œæµç¨‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;è¯»å–ç£ç›˜æˆ–é¡µç¼“å­˜ä¸­çš„æ¶ˆæ¯æ•°æ®&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä½¿ç”¨Followerå‰¯æœ¬å‘é€è¯·æ±‚ä¸­çš„ä½ç§»å€¼æ›´æ–°è¿œç¨‹Followerå‰¯æœ¬LEOå€¼&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ›´æ–°åˆ†åŒºé«˜æ°´ä½ï¼Œæµç¨‹åŒä¸Š&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Followerå‰¯æœ¬ï¼Œä»Leaderå‰¯æœ¬æ‹‰å–æ¶ˆæ¯åçš„æµç¨‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;å†™å…¥æ¶ˆæ¯åˆ°æœ¬åœ°ç£ç›˜&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ›´æ–°LEOå€¼&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ›´æ–°é«˜æ°´ä½å€¼&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;è·å–Leaderå‘é€çš„é«˜æ°´ä½å€¼ï¼šcurrentHW&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è·å–æ­¥éª¤2ä¸­æ›´æ–°è¿‡çš„LEOå€¼ï¼šcurrentLEO&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ›´æ–°é«˜æ°´ä½ä¸ºï¼šminï¼ˆcurrentHWï¼ŒcurrentLEOï¼‰&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/Kafka%e5%88%86%e5%8c%ba%e5%90%8c%e6%ad%a5%e6%9c%ba%e5%88%b6%e6%b5%81%e7%a8%8b.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/Kafka%e5%88%86%e5%8c%ba%e5%90%8c%e6%ad%a5%e6%9c%ba%e5%88%b6%e6%b5%81%e7%a8%8b.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;å¯ä»¥çœ‹åˆ°ï¼ŒFollowerå‰¯æœ¬æ‹‰å–äº†ä¸¤æ¬¡ï¼Œä¸€æ¬¡æ˜¯æ›´æ–°LEOçš„å€¼ï¼Œä¸€æ¬¡æ˜¯æ›´æ–°é«˜æ°´ä½ï¼ŒLeaderå‰¯æœ¬é«˜æ°´ä½çš„æ›´æ–°å’ŒFollowerå‰¯æœ¬é«˜æ°´ä½çš„æ›´æ–°åœ¨æ—¶é—´ä¸Šæ˜¯é”™é…çš„ã€‚åœ¨&lt;code&gt;min.insync.replicas=1&lt;/code&gt;çš„æƒ…å†µä¸‹ï¼Œå½“Followerå‰¯æœ¬æ›´æ–°é«˜æ°´ä½æ—¶ï¼Œå¦‚æœæ­¤æ—¶å…ˆæ˜¯Followerå‰¯æœ¬å®•æœºï¼Œé‡å¯åä¼šæ ¹æ®é«˜æ°´ä½è¿›è¡Œæ—¥å¿—æˆªæ–­ï¼Œé€ æˆåŒæ­¥è¿›åº¦ä¸¢å¤±ï¼Œæ­¤æ—¶Leaderä¹Ÿå®•æœºï¼Œä¼šè¿›è¡ŒLeaderé€‰ä¸¾ï¼Œä¹‹å‰çš„Followerå¯èƒ½ä¼šä¸ºLeaderï¼Œå°±ä¼šå‡ºç°æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µï¼Œå› æ­¤å¼•å…¥Leader Epochæœºåˆ¶è§£å†³ã€‚&lt;/p&gt;
&lt;p&gt;Leader Epochæœºåˆ¶ï¼Œå®é™…ä¸Šå°±æ˜¯Leaderç‰ˆæœ¬å·+èµ·å§‹ä½ç§»å€¼ï¼ŒLeaderç‰ˆæœ¬å·åœ¨Leaderæ¯æ¬¡é‡å¯åéƒ½ä¼šå¢åŠ ï¼ŒLeaderå‰¯æœ¬æ¯æ¬¡å°†æ¶ˆæ¯å†™å…¥ç£ç›˜åï¼Œéƒ½ä¼šæ›´æ–°èµ·å§‹ä½ç§»å€¼ï¼Œå¹¶ä¿å­˜åœ¨checkpointæ–‡ä»¶ä¸­ã€‚å½“æœ‰Followerå®•æœºæˆ–é‡å¯æ—¶ï¼Œä»è¯·æ±‚Leaderå‰¯æœ¬è·å–Leader Epochçš„æ•°æ®è¿›è¡Œä¿å­˜ï¼Œé¿å…ä¹‹åå¦‚æœLeaderå®•æœºåï¼Œé€‰å‡ºçš„çš„æ–°Leaderä¸¢å¤±åŒæ­¥è¿›åº¦ï¼Œé¿å…æ•°æ®ä¸ä¸€è‡´ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ§åˆ¶å™¨&#34;&gt;æ§åˆ¶å™¨&lt;/h3&gt;
&lt;p&gt;Kafkaçš„æ§åˆ¶å™¨ä¾èµ–ZooKeeperdçš„ä¸´æ—¶èŠ‚ç‚¹æœºåˆ¶å’ŒWatchæœºåˆ¶ï¼Œå®ç°å¯¹æ•´ä¸ªé›†ç¾¤çš„ç®¡ç†å’Œåè°ƒï¼Œé›†ç¾¤ä¸­åªèƒ½æœ‰ä¸€ä¸ªBrokerèƒ½æˆä¸ºæ§åˆ¶å™¨ï¼Œç¬¬ä¸€ä¸ªåœ¨ZooKeeperä¸­æˆåŠŸåˆ›å»ºcontrollerèŠ‚ç‚¹çš„Brokerä¼šè¢«æŒ‡å®šä¸ºæ§åˆ¶å™¨ã€‚è™½ç„¶æ§åˆ¶å™¨åªæœ‰ä¸€ä¸ªï¼Œä½†æ˜¯ä¾èµ–ZooKeeperçš„Watchæœºåˆ¶ï¼Œå½“è¿è¡Œä¸­çš„æ§åˆ¶å™¨çªç„¶å®•æœºæˆ–ç»ˆæ­¢æ—¶ï¼ŒKafkaèƒ½å¿«é€Ÿæ„ŸçŸ¥å¹¶å¯åŠ¨å¤‡ç”¨æ§åˆ¶å™¨è¿›è¡Œæ›¿æ¢ã€‚&lt;/p&gt;
&lt;p&gt;æ§åˆ¶å™¨å†…éƒ¨ä¹Ÿæ˜¯é€šè¿‡äº‹ä»¶é©±åŠ¨ + çŠ¶æ€æœºçš„æ–¹å¼ï¼Œå»å¤„ç†çŠ¶æ€ï¼Œè§£å†³å¤šçº¿ç¨‹å¹¶å‘è®¿é—®é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;æ§åˆ¶å™¨çš„èŒè´£ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸»é¢˜ç®¡ç† - åˆ›å»ºã€åˆ é™¤ã€å¢åŠ åˆ†åŒºï¼›&lt;/li&gt;
&lt;li&gt;åˆ†åŒºé‡åˆ†é…ï¼›&lt;/li&gt;
&lt;li&gt;Preferredé¢†å¯¼è€…é€‰ä¸¾ï¼Œä¸»è¦æ˜¯ä¸ºäº†é¿å…éƒ¨åˆ†Brokerè´Ÿè½½è¿‡é‡è€Œæé«˜çš„ä¸€ç§æ›´æ¢Leaderçš„æ–¹æ¡ˆï¼›&lt;/li&gt;
&lt;li&gt;é›†ç¾¤æˆå‘˜ç®¡ç† - æ–°å¢Brokerã€Brokerä¸»åŠ¨å…³é—­ã€Brokerå®•æœºï¼›&lt;/li&gt;
&lt;li&gt;ä¿å­˜äº†æœ€å…¨çš„é›†ç¾¤å…ƒæ•°æ®ï¼Œå‘å…¶ä»–Brokeræä¾›æ•°æ®æœåŠ¡ï¼Œå…¶ä»–Brokerä¼šå®šæœŸæ¥æ”¶æ§åˆ¶å™¨å‘é€è¿‡æ¥çš„å…ƒæ•°æ®æ›´æ–°è¯·æ±‚ï¼Œæ›´æ–°å†…å­˜ä¸­çš„ç¼“å­˜æ•°æ®ã€‚æ¯”è¾ƒé‡è¦çš„å…ƒæ•°æ®ï¼šä¸»é¢˜ä¿¡æ¯ã€åˆ†åŒºä¿¡æ¯ã€æ‰€æœ‰Brokerçš„ä¿¡æ¯ã€å½“å‰æ­£åœ¨è¿›è¡ŒPreferredé¢†å¯¼è€…é€‰æ‹©çš„åˆ†åŒºåˆ—è¡¨ã€åˆ†åŒºé‡åˆ†é…çš„åˆ†åŒºåˆ—è¡¨ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;kafkaä¸­çš„æ—¶é—´è½®&#34;&gt;Kafkaä¸­çš„æ—¶é—´è½®&lt;/h3&gt;
&lt;p&gt;é€šè¿‡DelayQueueï¼ˆä¼˜å…ˆçº§é˜Ÿåˆ—å®ç°ï¼Œé˜Ÿåˆ—é‡Œçš„æ¯ä¸ªå…ƒç´ ï¼Œéƒ½æ˜¯æŸä¸€ä¸ªå…·ä½“æ—¶é—´çš„listï¼‰ + ç¯å½¢æ•°ç»„ï¼ˆæ•°ç»„çš„æ¯ä¸ªå…ƒç´ æ˜¯ä¸ªlistï¼Œç´¢å¼•ä»£è¡¨æ—¶é—´æ ¼ï¼‰&lt;/p&gt;
&lt;p&gt;DelayQueueä¼šæ ¹æ®ç¯å½¢æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ è¿›è¡Œæ’åºï¼›&lt;/p&gt;
&lt;p&gt;æ·»åŠ ä»»åŠ¡æ—¶ï¼Œåˆ¤æ–­ä»»åŠ¡æ‰§è¡Œæ—¶é—´ï¼ŒåŠ å…¥ç¯å½¢æ•°ç»„ä¸­ï¼Œå¯¹åº”çš„ç¯å½¢æ•°ç»„çš„å…ƒç´ ï¼ˆlistï¼‰ï¼ŒåŠ å…¥DelayQueueä¸­ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/Kafka%e6%97%b6%e9%97%b4%e8%bd%ae%e7%ae%80%e5%8d%95%e5%ae%9e%e7%8e%b0.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/Kafka%e6%97%b6%e9%97%b4%e8%bd%ae%e7%ae%80%e5%8d%95%e5%ae%9e%e7%8e%b0.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;h1 id=&#34;æ¶ˆæ¯æ¨¡å‹&#34;&gt;æ¶ˆæ¯æ¨¡å‹&lt;/h1&gt;
&lt;p&gt;1.ç‚¹å¯¹ç‚¹ï¼šé˜Ÿåˆ—ã€ç›‘å¬å™¨&lt;/p&gt;
&lt;p&gt;2.å‘å¸ƒè®¢é˜…ï¼šç›‘å¬å™¨ã€ç›‘å¬å™¨ã€è§‚å¯Ÿè€…æ¨¡å¼&lt;/p&gt;
&lt;h2 id=&#34;ä¸€èˆ¬æ¶ˆæ¯é˜Ÿåˆ—æ¶æ„&#34;&gt;ä¸€èˆ¬æ¶ˆæ¯é˜Ÿåˆ—æ¶æ„&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;ä¸»è¦æ˜¯è®¾è®¡ä¸­é—´çš„æ¶ˆæ¯è½¬å‘ï¼Œå°†ä¸€æ¬¡RPCè½¬åŒ–æˆä¸¤æ¬¡RPCï¼›&lt;/li&gt;
&lt;li&gt;é€‰æ‹©é€šä¿¡åè®®ï¼›&lt;/li&gt;
&lt;li&gt;æ¶ˆæ¯çš„å¯é æ€§ç¡®è®¤ï¼›&lt;/li&gt;
&lt;li&gt;æ¶ˆæ¯æŒä¹…åŒ–ï¼›&lt;/li&gt;
&lt;li&gt;æ¶ˆæ¯æ¨¡å‹ï¼›&lt;/li&gt;
&lt;li&gt;äº‹åŠ¡ç‰¹æ€§ï¼›&lt;/li&gt;
&lt;li&gt;åˆ†å¸ƒå¼é›†ç¾¤ç‰¹æ€§ï¼›&lt;/li&gt;
&lt;li&gt;æ¶ˆæ¯é˜Ÿåˆ—ä¸€èˆ¬æœ‰ä¸¤ç§æ¨¡å¼ï¼Œpullæ¨¡å¼ï¼ˆæ¶ˆè´¹æ–¹ä¸»åŠ¨å‘é˜Ÿåˆ—æ‹‰å–æ•°æ®ï¼‰ï¼Œæ¯”å¦‚kafkaï¼Œpushæ¨¡å¼ï¼ˆç”±é˜Ÿåˆ—å‘æ¶ˆè´¹æ–¹æ¨é€æ•°æ®ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/%e6%b6%88%e6%81%af%e9%98%9f%e5%88%97%e6%9e%b6%e6%9e%84.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/%e6%b6%88%e6%81%af%e9%98%9f%e5%88%97%e6%9e%b6%e6%9e%84.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			alt=&#34;æ¶ˆæ¯é˜Ÿåˆ—æ¶æ„&#34;&gt;
	&lt;/a&gt;
	
	&lt;figcaption&gt;æ¶ˆæ¯é˜Ÿåˆ—æ¶æ„&lt;/figcaption&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;ä¸€èˆ¬æ¥è¯´ï¼Œä¸€ä¸ªä¸»é¢˜å¯ä»¥åˆ†é…ç»™å¤šä¸ªBrokerï¼Œæ¯ä¸ªBrokerå¯ä»¥æœ‰å¤šä¸ªé˜Ÿåˆ—ï¼›&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å¤šä¸ªç”Ÿäº§è€…å¯¹äºåŒä¸€ä¸ªä¸»é¢˜çš„æ¶ˆæ¯ï¼Œå¯ä»¥å‘é€åˆ°ä¸åŒçš„é˜Ÿåˆ—ï¼ˆè½®è¯¢å‘ï¼ŒéšæœºæŒ‘ä¸€ä¸ªå‘ï¼Œåªå¾€æŸä¸ªä¸€ä¸ªå‘ï¼‰ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ¶ˆè´¹ç»„è®¢é˜…çš„æ˜¯ä¸»é¢˜ï¼Œæ¶ˆè´¹ä¸»é¢˜é‡Œçš„æ‰€æœ‰é˜Ÿåˆ—çš„æ¶ˆæ¯ï¼Œæ¶ˆè´¹æ¶ˆæ¯æ—¶ï¼Œå¯ä»¥åªæ˜¯å»è¯»é˜Ÿåˆ—é‡Œçš„æ¶ˆæ¯ï¼Œä¸ä¸€å®šä¼šåˆ æ‰ï¼Œä½†æ˜¯ä¸€èˆ¬ä¼šè®¾ç½®æ¶ˆæ¯å¯è§æ€§ï¼Œç»„é‡Œçš„æ¶ˆè´¹è€…è¯»å–é˜Ÿåˆ—é‡Œçš„æ¶ˆæ¯æ—¶ï¼Œå…¶ä»–æ¶ˆè´¹è€…å¯¹æ­¤æ¶ˆæ¯ä¸å¯è§ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¤šä¸ªæ¶ˆè´¹ç»„åœ¨æ¶ˆè´¹åŒä¸€ä¸»é¢˜æ—¶ï¼Œæ¶ˆè´¹ç»„ä¹‹é—´äº’ä¸å½±å“ï¼Œå³æ¶ˆæ¯å¯ä»¥åŒæ—¶è¢«å¤šä¸ªæ¶ˆè´¹ç»„æ¶ˆè´¹ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ¶ˆè´¹ç»„å†…éƒ¨å¯ä»¥åŒ…å«å¤šä¸ªæ¶ˆè´¹è€…ï¼ŒåŒä¸€æ¶ˆè´¹ç»„å†…ï¼Œæ¯ä¸ªé˜Ÿåˆ—åªèƒ½è¢«ä¸€ä¸ªæ¶ˆè´¹è€…å ç”¨ï¼Œä¸€ä¸ªæ¶ˆæ¯åªä¼šè¢«ç»„å†…ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ¯ä¸ªæ¶ˆè´¹ç»„å†…éƒ¨ç»´æŠ¤è‡ªå·±çš„æ¶ˆè´¹ä½ç½®ï¼Œè®°å½•æ¶ˆè´¹æŸä¸€é˜Ÿåˆ—ä¸­æ¶ˆæ¯çš„ä½ç½®ï¼Œæ¶ˆè´¹ä½ç½®ä¸æ¶ˆè´¹è€…æ— å…³&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;å…³äºæ¶ˆæ¯çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–&#34;&gt;å…³äºæ¶ˆæ¯çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–&lt;/h2&gt;
&lt;p&gt;é™¤äº†å¸¸è§çš„jsonã€XMLã€protobufã€Kryoã€Hessionç­‰æ–¹æ¡ˆï¼Œè¿˜èƒ½è‡ªä¸»è®¾è®¡&lt;/p&gt;
&lt;p&gt;å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ç»´æŠ¤ä¸€ä»½å­—æ®µé¡ºåºï¼Œåœ¨åºåˆ—åŒ–æ—¶åªå­˜å¯¹åº”å¯¹è±¡çš„å€¼ï¼Œä»è€Œå‡å°‘åºåˆ—åŒ–å¯¹è±¡çš„é•¿åº¦ï¼Œæ¯”å¦‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;03   | 08 7a 68 61 6e 67 73 61 6e | 17 | 01
User |    z h a n g s a n         | 23 | true
03è¡¨ç¤ºå¯¹è±¡ç±»å‹ï¼Œ08è¡¨ç¤ºåå­—çš„é•¿åº¦ï¼Œç„¶åå­—æ®µå€¼ä»¥åå­—ã€å¹´é¾„ã€æ˜¯å¦yi&#39;wei
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;å…³äºæ¶ˆæ¯çš„æ–­å¥&#34;&gt;å…³äºæ¶ˆæ¯çš„æ–­å¥&lt;/h2&gt;
&lt;p&gt;æ•°æ®ä¼ è¾“è¿‡ç¨‹ä¸­ï¼Œæ”¶åˆ°çš„åˆ†æ®µä¸ä¸€å®šæ˜¯å‘å‡ºå»çš„åˆ†æ®µï¼Œå› æ­¤éœ€è¦åˆç†çš„åˆ†æ®µï¼Œæ¥è®©æ•°æ®è¯­ä¹‰æ˜ç¡®ã€‚æ¯”å¦‚åœ¨æ¯ä¸ªåˆ†æ®µå‰åŠ æ•°æ®çš„é•¿åº¦&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;03ä¸‹é›¨å¤© 03ç•™å®¢å¤© 02å¤©ç•™ 03æˆ‘ä¸ç•™
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;å…³äºæ¶ˆæ¯çš„å­˜å‚¨&#34;&gt;å…³äºæ¶ˆæ¯çš„å­˜å‚¨&lt;/h2&gt;
&lt;p&gt;æ¶ˆæ¯é˜Ÿåˆ—çš„å­˜å‚¨ä¸€èˆ¬æ¯”è¾ƒç®€å•ï¼Œæ¯ä¸ªä¸»é¢˜åŒ…å«è‹¥å¹²åˆ†åŒºï¼Œæ¯ä¸ªåˆ†åŒº(é˜Ÿåˆ—)éƒ½æ˜¯WALï¼Œå†™å…¥æ—¶å°¾éƒ¨è¿½åŠ ï¼Œä¸å…è®¸ä¿®æ”¹ï¼Œè¯»å–çš„æ—¶å€™ï¼Œæ ¹æ®ä¸€ä¸ªç´¢å¼•åºå·è¿›è¡ŒæŸ¥è¯¢ï¼Œè¿ç»­é¡ºåºå¾€ä¸‹è¯»ã€‚&lt;/p&gt;
&lt;h3 id=&#34;kafka-1&#34;&gt;Kafka&lt;/h3&gt;
&lt;p&gt;ä»¥åˆ†åŒºä¸ºå•ä½ï¼Œæ¯ä¸ªåˆ†åŒºåŒ…å«ä¸€ç»„æ¶ˆæ¯æ–‡ä»¶å’Œä¸€ç»„ç´¢å¼•æ–‡ä»¶ï¼Œæ¶ˆæ¯æ–‡ä»¶å’Œç´¢å¼•æ–‡ä»¶ä¸€ä¸€å¯¹åº”ï¼Œå…·æœ‰ç›¸åŒçš„æ–‡ä»¶åï¼Œä½†æ–‡ä»¶æ‰©å±•åä¸ä¸€æ ·ï¼Œæ–‡ä»¶åå°±æ˜¯è¿™ä¸ªæ–‡ä»¶ä¸­ç¬¬ä¸€æ¡æ¶ˆæ¯çš„ç´¢å¼•åºå·ï¼›æ¯ä¸ªç´¢å¼•ä¸­ä¿å­˜ç´¢å¼•åºå·ï¼ˆè¡¨ç¤ºè¿™æ¡æ¶ˆæ¯æ˜¯è¿™ä¸ªåˆ†åŒºä¸­çš„ç¬¬å‡ æ¡æ¶ˆæ¯ï¼‰ï¼Œå’Œ å¯¹åº”çš„æ¶ˆæ¯åœ¨æ¶ˆæ¯æ–‡ä»¶ä¸­çš„ç»å¯¹ä½ç½®ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥åˆ†åŒºä¸ºå•ä½ï¼Œç²’åº¦æ›´ç»†ï¼Œæ¯”è¾ƒçµæ´»ï¼Œå®¹æ˜“è¿›è¡Œæ•°æ®è¿ç§»å’Œæ‰©å®¹ã€‚&lt;/p&gt;
&lt;p&gt;Kafkaä¸ºäº†èŠ‚çœå­˜å‚¨ç©ºé—´ï¼Œé‡‡ç”¨ç¨€ç–ç´¢å¼•ï¼Œæ¯éš”å‡ æ¡æ¶ˆæ¯åˆ›å»ºä¸€æ¡ç´¢å¼•ã€‚&lt;/p&gt;
&lt;p&gt;å†™å…¥æ¶ˆæ¯æ—¶ï¼Œåœ¨æ–‡ä»¶å°¾éƒ¨è¿½åŠ å†™å…¥ï¼Œä¸€ä¸ªæ–‡ä»¶æ»¡äº†å†å†™ä¸‹ä¸€ä¸ªæ–‡ä»¶ï¼›&lt;/p&gt;
&lt;p&gt;æŸ¥æ‰¾æ¶ˆæ¯æ—¶ï¼Œå…ˆæ ¹æ®æ–‡ä»¶åæ‰¾åˆ°æ‰€åœ¨ç´¢å¼•çš„ç´¢å¼•æ–‡ä»¶ï¼Œç„¶åäºŒåˆ†æ³•éå†ç´¢å¼•æ–‡ä»¶å†…çš„ç´¢å¼•ï¼Œæ‰¾åˆ°ç¦»ç›®æ ‡æœ€è¿‘çš„ç´¢å¼•ï¼Œå†å»æ¶ˆæ¯æ–‡ä»¶ä¸­æ‰¾åˆ°è¿™æ¡ç´¢å¼•å¯¹åº”çš„ä½ç½®ï¼Œé¡ºåºéå†æ¶ˆæ¯æ–‡ä»¶ï¼Œæ‰¾åˆ°ç›®æ ‡æ¶ˆæ¯ã€‚&lt;/p&gt;
&lt;h3 id=&#34;rocketmq&#34;&gt;RocketMQ&lt;/h3&gt;
&lt;p&gt;ä»¥Brokerä¸ºå•ä½ï¼Œæ¯ä¸ªBrokeråªåŒ…å«ä¸€ç»„æ¶ˆæ¯æ–‡ä»¶å’Œç´¢å¼•æ–‡ä»¶ï¼Œåœ¨è¯¥Brokerä¸Šçš„æ‰€æœ‰ä¸»é¢˜çš„æ¶ˆæ¯éƒ½å­˜æ”¾åœ¨è¿™ä¸€ç»„æ¶ˆæ¯æ–‡ä»¶ä¸­ï¼Œç´¢å¼•æ–‡ä»¶åˆ™æŒ‰ç…§ä¸»é¢˜å’Œé˜Ÿåˆ—åˆ†åˆ«å»ºç«‹ï¼Œæ¯ä¸ªé˜Ÿåˆ—å¯¹åº”ä¸€ç»„ç´¢å¼•æ–‡ä»¶ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥Brokerä¸ºå•ä½ï¼Œç²’åº¦è¾ƒç²—ï¼Œä½†åœ¨å†™å…¥æ—¶æ–‡ä»¶æ›´å°‘ï¼Œæœ‰æ›´å¥½çš„æ‰¹é‡å’Œé¡ºåºå†™å…¥ã€‚&lt;/p&gt;
&lt;p&gt;ç´¢å¼•é‡‡ç”¨å®šé•¿ç¨ å¯†ç´¢å¼•ï¼Œä¸ºæ¯æ¡æ¶ˆæ¯éƒ½åˆ›å»ºç´¢å¼•ï¼Œæ¯ä¸ªç´¢å¼•çš„é•¿åº¦å›ºå®š20ä¸ªå­—èŠ‚ã€‚&lt;/p&gt;
&lt;p&gt;å†™å…¥æ¶ˆæ¯æ—¶ï¼ŒBrokerä¸Šæ‰€æœ‰ä¸»é¢˜ã€æ‰€æœ‰é˜Ÿåˆ—çš„æ¶ˆæ¯éƒ½æŒ‰ç…§è‡ªç„¶é¡ºåºè¿½åŠ å†™å…¥åŒä¸€ä¸ªæ¶ˆæ¯æ–‡ä»¶ä¸­ï¼Œä¸€ä¸ªæ–‡ä»¶æ»¡äº†å†å†™ä¸‹ä¸€ä¸ªï¼›æŸ¥æ‰¾æ¶ˆæ¯æ—¶ï¼Œç›´æ¥æ ¹æ®é˜Ÿåˆ—çš„æ¶ˆæ¯åºå·ï¼Œè®¡ç®—å‡ºç´¢å¼•çš„å…¨å±€ä½ç½®ï¼ˆç´¢å¼•åºå· ä¹˜ å›ºå®šé•¿åº¦20ï¼‰ï¼Œç›´æ¥è¯»å–ç´¢å¼•ï¼Œå†æ ¹æ®ç´¢å¼•åœ¨æ¶ˆæ¯æ–‡ä»¶ä¸­æ‰¾åˆ°å¯¹åº”çš„æ¶ˆæ¯ï¼ŒæŸ¥æ‰¾é€Ÿåº¦æ¯”Kafkaå¿«ï¼Œä½†è€—å­˜å‚¨ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ¶ˆæ¯é˜Ÿåˆ—æœåŠ¡è´¨é‡qos&#34;&gt;æ¶ˆæ¯é˜Ÿåˆ—æœåŠ¡è´¨é‡QoS&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;at-most-onceï¼šæœ€å¤šä¸€æ¬¡ï¼Œæ¶ˆæ¯å¯èƒ½ä¸¢å¤±ï¼Œä¸ä¼šé‡å¤å‘é€ï¼Œå³æ¶ˆæ¯è¦ä¹ˆè¢«å‘é€ä¸€æ¬¡ï¼Œè¦ä¹ˆä¸ä¼šè¢«å‘é€ï¼›
&lt;ul&gt;
&lt;li&gt;ç”Ÿäº§è€…å®Œå…¨ä¾èµ–TCP/IPçš„ä¼ è¾“å¯é æ€§ï¼Œå‘é€ä¸€æ¬¡å°±ç»“æŸã€‚kafkaä¸­è®¾ç½®&lt;code&gt;acks=0&lt;/code&gt;æ‰“å¼€æ­¤æ¨¡å¼ï¼›&lt;/li&gt;
&lt;li&gt;æ¶ˆè´¹è€…æ¶ˆè´¹æ—¶å…ˆä¿å­˜æ¶ˆæ¯ï¼Œå†è¿›è¡Œå¤„ç†ã€‚kafkaä¸­è®¾ç½®æ¶ˆè´¹è€…è‡ªåŠ¨æäº¤åç§»é‡å¹¶è®¾ç½®è¾ƒçŸ­çš„æäº¤æ—¶é—´é—´éš”ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;at-least-onceï¼šæœ€å°‘ä¸€æ¬¡ï¼Œæ¶ˆæ¯ç»ä¸ä¼šä¸¢ï¼Œä½†å¯èƒ½é‡å¤å‘é€ï¼Œè§£å†³ä¸Šä¸€ä¸ªçº§åˆ«æ¶ˆæ¯å‘é€å¤±è´¥çš„é—®é¢˜ï¼›ä¸€èˆ¬ä½¿ç”¨æ­¤ç­‰çº§ã€‚
&lt;ul&gt;
&lt;li&gt;ç”Ÿäº§è€…å‘é€æ¶ˆæ¯æ—¶è¦åšé˜²ä¸¢ä¿è¯ï¼Œæ£€æŸ¥å‘é€ç»“æœï¼Œå¹¶åœ¨å¤±è´¥æˆ–è¶…æ—¶æ—¶é‡æ–°å‘é€æ¶ˆæ¯ï¼Œç›´åˆ°brokeç¡®è®¤æ”¶åˆ°ï¼Œsoå¯èƒ½ä¼šé‡å¤å‘é€ã€‚kafkaä¸­è®¾ç½®&lt;code&gt;acks=1æˆ–all&lt;/code&gt;å¹¶è®¾ç½®&lt;code&gt;retries&amp;gt;0&lt;/code&gt;æ‰“å¼€æ­¤æ¨¡å¼ï¼›&lt;/li&gt;
&lt;li&gt;æ¶ˆè´¹è€…å…ˆå¤„ç†æ¶ˆæ¯ï¼Œå†ä¿å­˜æ¶ˆè´¹è¿›åº¦ï¼Œå¤„ç†æ¶ˆæ¯æ—¶å¹‚ç­‰ã€‚kafkaä¸­è®¾ç½®æ¶ˆè´¹è€…è‡ªåŠ¨æäº¤åç§»é‡å¹¶è®¾ç½®å¾ˆé•¿çš„æäº¤æ—¶é—´é—´éš”ï¼Œæˆ–è€…ç›´æ¥å…³é—­è‡ªåŠ¨æäº¤åç§»é‡ï¼Œå¤„ç†æ¶ˆæ¯åæ‰‹åŠ¨è°ƒç”¨åŒæ­¥æ¨¡å¼çš„åç§»é‡æäº¤ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;exactly-onceï¼šæ­£å¥½ä¸€æ¬¡ï¼Œæ¯æ¡æ¶ˆæ¯æœ‰ä¸”åªæœ‰ä¸€æ¬¡è¢«ä¼ è¾“ï¼›
&lt;ul&gt;
&lt;li&gt;ç”Ÿäº§è€…å‘é€æ¶ˆæ¯è¦ä¿è¯é˜²ä¸¢ï¼Œ å¯èƒ½éœ€è¦å€ŸåŠ©å¤–éƒ¨ç»„ä»¶å®ç°åªå‘é€ä¸€æ¬¡ã€‚&lt;/li&gt;
&lt;li&gt;æ¶ˆè´¹è€…å¤„ç†æ¶ˆæ¯æ—¶è¦å¹‚ç­‰ï¼Œæˆ–è€…å¯¹æ¥æ”¶çš„æ¶ˆæ¯è¿›è¡Œå»é‡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿™ä¸‰ä¸ªçº§åˆ«çš„å¯é æ€§ä¾æ¬¡å¢åŠ ï¼Œä½†ç›¸åº”çš„ä¹Ÿä¼šå¢åŠ å»¶è¿Ÿå’Œå¸¦å®½å ç”¨ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ¡ˆä¾‹ä¸€---å¼‚æ­¥æ¶ˆæ¯çš„å¤„ç†&#34;&gt;æ¡ˆä¾‹ä¸€ - å¼‚æ­¥æ¶ˆæ¯çš„å¤„ç†&lt;/h2&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/JD_JMQ%e6%b6%88%e6%81%af%e6%8e%a5%e6%94%b6%e7%ba%bf%e7%a8%8b%e6%a8%a1%e5%9e%8b.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/JD_JMQ%e6%b6%88%e6%81%af%e6%8e%a5%e6%94%b6%e7%ba%bf%e7%a8%8b%e6%a8%a1%e5%9e%8b.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;ol&gt;
&lt;li&gt;æ”¶åˆ°è¯·æ±‚åï¼Œæˆ‘ä»¬åœ¨Handlerä¸­ä¸åšè¿‡å¤šçš„å¤„ç†ï¼Œæ‰§è¡Œå¿…è¦çš„æ£€æŸ¥åï¼Œå°†è¯·æ±‚æ”¾åˆ°ä¸€ä¸ªå†…å­˜é˜Ÿåˆ—ä¸­ï¼Œä¹Ÿå°±æ˜¯å›¾ä¸­çš„RequestsQueueã€‚è¯·æ±‚è¢«æ”¾å…¥é˜Ÿåˆ—åï¼ŒHandlerçš„æ–¹æ³•å°±ç»“æŸäº†ã€‚å¯ä»¥çœ‹åˆ°ï¼Œåœ¨Handlerä¸­åªæ˜¯æŠŠè¯·æ±‚æ”¾åˆ°äº†é˜Ÿåˆ—ä¸­ï¼Œæ²¡æœ‰å¤ªå¤šçš„ä¸šåŠ¡é€»è¾‘ï¼Œè¿™ä¸ªæ‰§è¡Œè¿‡ç¨‹æ˜¯éå¸¸å¿«çš„ï¼Œæ‰€ä»¥å³ä½¿æ˜¯å¤„ç†æµ·é‡çš„è¯·æ±‚ï¼Œä¹Ÿä¸ä¼šè¿‡å¤šçš„å ç”¨IOçº¿ç¨‹ã€‚&lt;/li&gt;
&lt;li&gt;ç”±äºè¦ä¿è¯æ¶ˆæ¯çš„æœ‰åºæ€§ï¼Œæ•´ä¸ªæµç¨‹çš„å¤§éƒ¨åˆ†è¿‡ç¨‹æ˜¯ä¸èƒ½å¹¶å‘çš„ï¼Œåªèƒ½å•çº¿ç¨‹æ‰§è¡Œã€‚æ‰€ä»¥ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹WriteThreadä»è¯·æ±‚é˜Ÿåˆ—ä¸­æŒ‰ç…§é¡ºåºæ¥è·å–è¯·æ±‚ï¼Œä¾æ¬¡è¿›è¡Œè§£æè¯·æ±‚ç­‰å…¶ä»–çš„å¤„ç†é€»è¾‘ï¼Œæœ€åå°†æ¶ˆæ¯åºåˆ—åŒ–å¹¶å†™å…¥å­˜å‚¨ã€‚åºåˆ—åŒ–åçš„æ¶ˆæ¯ä¼šè¢«å†™å…¥åˆ°ä¸€ä¸ªå†…å­˜ç¼“å­˜ä¸­ï¼Œå°±æ˜¯å›¾ä¸­çš„JournalCacheï¼Œç­‰å¾…åç»­çš„å¤„ç†ã€‚&lt;/li&gt;
&lt;li&gt;æ‰§è¡Œåˆ°è¿™é‡Œï¼Œä¸€æ¡ä¸€æ¡çš„æ¶ˆæ¯å·²ç»è¢«è½¬æ¢æˆä¸€ä¸ªè¿ç»­çš„å­—èŠ‚æµï¼Œæ¯ä¸€æ¡æ¶ˆæ¯éƒ½åœ¨è¿™ä¸ªå­—èŠ‚æµä¸­æœ‰ä¸€ä¸ªå…¨å±€å”¯ä¸€èµ·æ­¢ä½ç½®ï¼Œä¹Ÿå°±æ˜¯è¿™æ¡æ¶ˆæ¯çš„Offsetã€‚åç»­çš„å¤„ç†å°±ä¸ç”¨å…³å¿ƒå­—èŠ‚æµä¸­çš„å†…å®¹äº†ï¼Œåªè¦ç¡®ä¿è¿™ä¸ªå­—èŠ‚æµèƒ½å¿«é€Ÿæ­£ç¡®çš„è¢«ä¿å­˜å’Œå¤åˆ¶å°±å¯ä»¥äº†ã€‚&lt;/li&gt;
&lt;li&gt;è¿™é‡Œé¢è¿˜æœ‰ä¸€ä¸ªå·¥ä½œéœ€è¦å®Œæˆï¼Œå°±æ˜¯ç»™ç”Ÿäº§è€…å›å“åº”ï¼Œä½†åœ¨è¿™ä¸€æ­¥ï¼Œæ¶ˆæ¯æ—¢æ²¡æœ‰è½ç›˜ï¼Œä¹Ÿæ²¡æœ‰å®Œæˆå¤åˆ¶ï¼Œè¿˜ä¸èƒ½ç»™å®¢æˆ·ç«¯è¿”å›å“åº”ï¼Œæ‰€ä»¥æˆ‘ä»¬æŠŠå¾…è¿”å›çš„å“åº”æŒ‰ç…§é¡ºåºæ”¾åˆ°ä¸€ä¸ªå†…å­˜çš„é“¾è¡¨PendingCallbacksä¸­ï¼Œå¹¶è®°å½•æ¯ä¸ªè¯·æ±‚ä¸­çš„æ¶ˆæ¯å¯¹åº”çš„Offsetã€‚&lt;/li&gt;
&lt;li&gt;ç„¶åï¼Œæˆ‘ä»¬æœ‰2ä¸ªçº¿ç¨‹ï¼ŒFlushThreadå’ŒReplicationThreadï¼Œè¿™ä¸¤ä¸ªçº¿ç¨‹æ˜¯å¹¶è¡Œæ‰§è¡Œçš„ï¼Œåˆ†åˆ«è´Ÿè´£æ‰¹é‡å¼‚æ­¥è¿›è¡Œåˆ·ç›˜å’Œå¤åˆ¶ï¼Œåˆ·ç›˜å’Œå¤åˆ¶åˆåˆ†åˆ«æ˜¯2ä¸ªæ¯”è¾ƒå¤æ‚çš„æµç¨‹ã€‚åˆ·ç›˜çº¿ç¨‹ä¸åœåœ°å°†æ–°å†™å…¥JournalCacheçš„å­—èŠ‚æµå†™åˆ°ç£ç›˜ä¸Šï¼Œå®Œæˆä¸€æ‰¹æ•°æ®çš„åˆ·ç›˜ï¼Œå®ƒå°±ä¼šæ›´æ–°ä¸€ä¸ªåˆ·ç›˜ä½ç½®çš„å†…å­˜å˜é‡ï¼Œç¡®ä¿è¿™ä¸ªåˆ·ç›˜ä½ç½®ä¹‹å‰æ•°æ®éƒ½å·²ç»å®‰å…¨çš„å†™å…¥ç£ç›˜ä¸­ã€‚å¤åˆ¶çº¿ç¨‹çš„é€»è¾‘ä¹Ÿæ˜¯ç±»ä¼¼çš„ï¼ŒåŒæ ·ç»´æŠ¤äº†ä¸€ä¸ªå¤åˆ¶ä½ç½®çš„å†…å­˜å˜é‡ã€‚&lt;/li&gt;
&lt;li&gt;æœ€åï¼Œæˆ‘ä»¬è®¾è®¡äº†ä¸€ç»„ä¸“é—¨ç”¨äºå‘é€å“åº”çš„çº¿ç¨‹ReponseThreadsï¼Œåœ¨åˆ·ç›˜ä½ç½®æˆ–è€…å¤åˆ¶ä½ç½®æ›´æ–°åï¼Œå»æ£€æŸ¥å¾…è¿”å›çš„å“åº”é“¾è¡¨PendingCallbacksï¼Œæ ¹æ®QOSçº§åˆ«çš„è®¾ç½®ï¼ˆå› ä¸ºä¸åŒQOSåŸºæœ¬å¯¹å‘é€æˆåŠŸçš„å®šä¹‰ä¸ä¸€æ ·ï¼Œæœ‰çš„è®¾ç½®éœ€è¦æ¶ˆæ¯å†™å…¥ç£ç›˜æ‰ç®—æˆåŠŸï¼Œæœ‰çš„éœ€è¦å¤åˆ¶å®Œæˆæ‰ç®—æˆåŠŸï¼‰ï¼Œå°†åˆ·ç›˜ä½ç½®æˆ–è€…å¤åˆ¶ä½ç½®ä¹‹å‰æ‰€æœ‰å“åº”ï¼Œä»¥åŠå·²ç»è¶…æ—¶çš„å“åº”ï¼Œåˆ©ç”¨è¿™ç»„çº¿ç¨‹ReponseThreadså¼‚æ­¥å¹¶è¡Œçš„å‘é€ç»™å„ä¸ªå®¢æˆ·ç«¯ã€‚&lt;/li&gt;
&lt;li&gt;è¿™æ ·å°±å®Œæˆäº†æ¶ˆæ¯ç”Ÿäº§è¿™ä¸ªæµç¨‹ã€‚æ•´ä¸ªæµç¨‹ä¸­ï¼Œé™¤äº†JournalCacheçš„åŠ è½½å’Œå¸è½½éœ€è¦å¯¹æ–‡ä»¶åŠ é”ä»¥å¤–ï¼Œæ²¡æœ‰ç”¨åˆ°å…¶ä»–çš„é”ã€‚æ¯ä¸ªå°æµç¨‹éƒ½ä¸ä¼šç­‰å¾…å…¶ä»–æµç¨‹çš„å…±äº«èµ„æºï¼Œä¹Ÿå°±ä¸ç”¨äº’ç›¸ç­‰å¾…èµ„æºï¼ˆæ²¡æœ‰æ•°æ®éœ€è¦å¤„ç†æ—¶ç­‰å¾…ä¸Šæ¸¸æµç¨‹æä¾›æ•°æ®çš„æƒ…å†µé™¤å¤–ï¼‰ï¼Œå¹¶ä¸”åªè¦æœ‰æ•°æ®å°±èƒ½ç¬¬ä¸€æ—¶é—´å¤„ç†ã€‚&lt;/li&gt;
&lt;li&gt;è¿™ä¸ªæµç¨‹ä¸­ï¼Œæœ€æ ¸å¿ƒçš„éƒ¨åˆ†åœ¨äºWriteThreadæ‰§è¡Œå¤„ç†çš„è¿™ä¸ªæ­¥éª¤ï¼Œå¯¹æ¯æ¡æ¶ˆæ¯è¿›è¡Œå¤„ç†çš„è¿™äº›ä¸šåŠ¡é€»è¾‘ï¼Œéƒ½åªèƒ½åœ¨WriteThreadä¸­å•çº¿ç¨‹æ‰§è¡Œï¼Œè™½ç„¶è¿™é‡Œé¢å¹²äº†å¾ˆå¤šçš„äº‹å„¿ï¼Œä½†æ˜¯æˆ‘ä»¬ç¡®ä¿è¿™äº›é€»è¾‘ä¸­ï¼Œæ²¡æœ‰ç¼“æ…¢çš„ç£ç›˜å’Œç½‘ç»œIOï¼Œä¹Ÿæ²¡æœ‰ä½¿ç”¨ä»»ä½•çš„é”æ¥ç­‰å¾…èµ„æºï¼Œå…¨éƒ¨éƒ½æ˜¯å†…å­˜æ“ä½œï¼Œè¿™æ ·å³ä½¿å•çº¿ç¨‹å¯ä»¥éå¸¸å¿«é€Ÿåœ°æ‰§è¡Œæ‰€æœ‰çš„ä¸šåŠ¡é€»è¾‘ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;è¿™ä¸ªé‡Œé¢æœ‰å¾ˆé‡è¦çš„å‡ ç‚¹ä¼˜åŒ–ï¼š&lt;/p&gt;
&lt;p&gt;ç¬¬ä¸€æ˜¯ä½¿ç”¨å¼‚æ­¥è®¾è®¡ï¼ŒæŠŠåˆ·ç›˜å’Œå¤åˆ¶è¿™ä¸¤éƒ¨åˆ†æ¯”è¾ƒæ…¢çš„æ“ä½œä»è¿™ä¸ªæµç¨‹ä¸­åˆ†ç¦»å‡ºå»å¼‚æ­¥æ‰§è¡Œï¼›&lt;/p&gt;
&lt;p&gt;ç¬¬äºŒæ˜¯ä½¿ç”¨äº†ä¸€ä¸ªå†™ç¼“å­˜JournalCacheå°†ä¸€ä¸ªå†™ç£ç›˜çš„æ“ä½œï¼Œè½¬æ¢æˆäº†ä¸€ä¸ªå†™å†…å­˜çš„æ“ä½œï¼Œæ¥æå‡æ•°æ®å†™å…¥çš„æ€§èƒ½ï¼›&lt;/p&gt;
&lt;p&gt;ç¬¬ä¸‰æ˜¯è¿™ä¸ªå¤„ç†çš„å…¨æµç¨‹æ˜¯è¿‘ä¹æ— é”çš„è®¾è®¡ï¼Œé¿å…äº†çº¿ç¨‹å› ä¸ºç­‰å¾…é”å¯¼è‡´çš„é˜»å¡ï¼›&lt;/p&gt;
&lt;p&gt;ç¬¬å››æ˜¯æŠŠå›å¤å“åº”è¿™ä¸ªéœ€è¦ç­‰å¾…èµ„æºçš„æ“ä½œï¼Œä¹Ÿå¼‚æ­¥æ”¾åˆ°å…¶ä»–çš„çº¿ç¨‹ä¸­å»æ‰§è¡Œã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;æ¡ˆä¾‹äºŒ---kafkaé«˜æ€§èƒ½io&#34;&gt;æ¡ˆä¾‹äºŒ - Kafkaé«˜æ€§èƒ½IO&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Kafkaçš„SDKï¼Œç”Ÿäº§è€…è°ƒç”¨SDKå‘é€æ¶ˆæ¯æ—¶ï¼Œçœ‹èµ·æ¥åªå‘äº†ä¸€æ¡ï¼Œä½†æ˜¯SDKå¤„ç†æ—¶ä¸æ˜¯ä¸€æ¡ä¸€æ¡å‘çš„ï¼Œè€Œæ˜¯å…ˆæŠŠæ¶ˆæ¯æ”¾åˆ°å†…å­˜ä¸­ç¼“å­˜èµ·æ¥ï¼Œæ”’ä¸€æ‰¹ï¼Œå¼‚æ­¥ä¸€å—å‘ç»™brokerï¼Œbrokerä¼šæŠŠè¿™ä¸€æ‰¹æ¶ˆæ¯å½“æˆä¸€æ¡å¤„ç†ï¼Œæ¶ˆè´¹è€…pullæ¶ˆæ¯ï¼Œä¹Ÿæ˜¯ä¸€æ¬¡æ€§æ‹‰å–è¿™ä¸€æ‰¹æ¶ˆæ¯è¿›è¡Œå¤„ç†ï¼Œä»è€Œå‡å°‘Brokerå¤„ç†è¯·æ±‚çš„æ¬¡æ•°ï¼Œå‡è½»å‹åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;Kafkaæœ‰ä¸€ä¸ªå‚æ•°å¯ä»¥è®©æ¶ˆè´¹è€…é˜»å¡ç›´åˆ°æœ‰æ–°æ¶ˆæ¯åˆ°è¾¾ æˆ–è€… æ¶ˆæ¯å †ç§¯åˆ°ä¸€å®šæ•°é‡ä¹‹åæ‰æ¥æ”¶ ï¼Œé¿å…Brokeræ²¡æœ‰æ¶ˆæ¯æ—¶ï¼Œæ¶ˆè´¹è€…ä¸æ–­è½®è¯¢ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;é¡ºåºè¯»å†™ï¼ŒBrokeræ”¶åˆ°æ¶ˆæ¯åï¼Œé¡ºåºå†™å…¥å¯¹åº”çš„logæ–‡ä»¶ï¼Œä¸€ä¸ªæ–‡ä»¶å†™æ»¡å°±å¼€å¯æ–°æ–‡ä»¶é¡ºåºå†™ä¸‹å»ï¼Œæ¶ˆè´¹æ—¶ä¹Ÿæ˜¯ä»logæ–‡ä»¶çš„æŸä¸€ä½ç½®å¼€å§‹ï¼Œé¡ºåºçš„è¯»å‡ºæ¥ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åˆ©ç”¨PageCacheåŠ é€Ÿè¯»å†™ï¼Œæ•°æ®å†™å…¥æ–‡ä»¶æ—¶ï¼Œå…ˆå†™å…¥PageCacheï¼Œå†ä¸€æ‰¹ä¸€æ‰¹å†™å…¥ç£ç›˜ï¼Œè¯»å–æ–‡ä»¶æ—¶ï¼Œä¹Ÿæ˜¯å…ˆä»PageCacheä¸­è¯»å–æ•°æ®ï¼Œå½“PageCacheä¸­æ²¡æœ‰æ•°æ®ï¼Œä¼šå¼•å‘osçš„ç¼ºé¡µä¸­æ–­ï¼Œè¯»å–å…ˆä»ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°æ•°æ®ä»æ–‡ä»¶ä¸­å¤åˆ¶åˆ°PageCacheï¼Œå†ä»PageCacheä¸­è¯»å–æ•°æ®ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;é›¶æ‹·è´æå‡æ¶ˆè´¹æ€§èƒ½ï¼šä¸€èˆ¬æ¥è¯´ï¼ŒBrokerå¤„ç†æ¶ˆè´¹æ—¶ï¼Œä¼šå…ˆä»æ–‡ä»¶å¤åˆ¶æ•°æ®åˆ°PageCacheï¼Œä»PageCacheå¤åˆ¶æ•°æ®åˆ°åº”ç”¨å†…å­˜ï¼Œä»åº”ç”¨å†…å­˜å¤åˆ¶åˆ°Socketçš„ç¼“å†²åŒºï¼Œå‘é€æ•°æ®ã€‚å¦‚æœæ–‡ä»¶ä¸­çš„æ•°æ®æ— éœ€å…¶ä»–å¤„ç†ï¼Œå¯ä»¥ä½¿ç”¨é›¶æ‹·è´ï¼Œç›´æ¥å°†æ•°æ®ä»PageCacheå¤åˆ¶åˆ°socketç¼“å†²åŒºï¼Œå‡å°‘å¤åˆ¶æ¬¡æ•°&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;å¸¸è§é—®é¢˜&#34;&gt;å¸¸è§é—®é¢˜&lt;/h1&gt;
&lt;p&gt;ä»¥ä¸‹é—®é¢˜éƒ½æ˜¯éœ€è¦åˆ†å…·ä½“çš„MQçš„ï¼Œè¿™é‡Œç®€å•è¯´ä¸‹é€šç”¨æ–¹æ³•ã€‚ä¸€èˆ¬å¼‚å¸¸ä¼šå‡ºç°çš„åœºæ™¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç”Ÿäº§è€…ï¼šç½‘ç»œæˆ–å†…éƒ¨é—®é¢˜å¯¼è‡´æ¶ˆæ¯å‘é€å¤±è´¥ï¼Œæ²¡å‘å‡ºå»ï¼›æˆ–è€…æ˜¯å‘å‡ºå»äº†ï¼Œä½†æ˜¯æ²¡æœ‰æ¥å—æˆåŠŸå“åº”å¯¼è‡´é‡å¤å‘é€ã€‚&lt;/li&gt;
&lt;li&gt;æ¶ˆè´¹è€…ï¼šæ¶ˆè´¹è€…è·å–äº†æ¶ˆæ¯ï¼Œå¤„ç†æ¶ˆæ¯çš„è¿‡ç¨‹ä¸­å®•æœºï¼Œæ¢å¤æ—¶æ¶ˆæ¯å¦‚ä½•å¤„ç†ã€‚&lt;/li&gt;
&lt;li&gt;æ¶ˆæ¯é˜Ÿåˆ—ï¼šå®•æœºé‡å¯æ—¶ä¼šä¸¢æ•°æ®&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;å¦‚ä½•åˆ©ç”¨äº‹åŠ¡æ¶ˆæ¯å®ç°åˆ†å¸ƒå¼äº‹åŠ¡&#34;&gt;å¦‚ä½•åˆ©ç”¨äº‹åŠ¡æ¶ˆæ¯å®ç°åˆ†å¸ƒå¼äº‹åŠ¡&lt;/h2&gt;
&lt;p&gt;ä»¥RocketMQä¸ºä¾‹ï¼Œç”Ÿäº§è€…å…ˆå‘é€ä¸€ä¸ªåŠæ¶ˆæ¯ç»™MQï¼Œæ­¤æ—¶çš„åŠæ¶ˆæ¯å¯¹æ¶ˆè´¹è€…ä¸å¯è§ï¼Œå®Œæˆä¹‹åæ‰§è¡Œæœ¬åœ°äº‹åŠ¡ï¼Œæ ¹æ®æœ¬åœ°äº‹åŠ¡çš„æ‰§è¡Œç»“æœï¼Œå¯¹åˆšåˆšå‘é€çš„åŠæ¶ˆæ¯è¿›è¡Œcommitæˆ–rollbackï¼Œåªæœ‰commitä¹‹åï¼Œæ¶ˆè´¹è€…æ‰èƒ½æ¶ˆè´¹æ­¤æ¶ˆæ¯ã€‚å¦‚æœç”Ÿäº§è€…æœ¬åœ°äº‹åŠ¡æäº¤æˆåŠŸåå®•æœºï¼ŒMQä¼šè°ƒç”¨ç”Ÿäº§è€…æä¾›çš„åæŸ¥æ–¹æ³•ç¡®è®¤åŠæ¶ˆæ¯çš„ä¹‹åçš„æ‰§è¡ŒçŠ¶æ€ï¼ŒåæŸ¥æ–¹æ³•ä¼šæœ‰ä¸‰ä¸ªç»“æœï¼šæäº¤ã€å›æ»šã€ä¸ç¡®å®šï¼Œå¦‚æœæŸ¥è¯¢ç»“æœæ˜¯ä¸ç¡®å®šï¼ŒMQåˆ™ä¼šè¿›è¡Œé‡è¯•ï¼Œç›´åˆ°æŸ¥åˆ°ç¡®å®šçš„ç»“æœæˆ–è€…è¶…é‡è¯•æ¬¡æ•°ã€‚è¿™ç§åœºæ™¯å…¶å®æ˜¯é»˜è®¤æ¶ˆè´¹è€…ä¸€å®šä¼šæ¶ˆè´¹æˆåŠŸçš„ï¼Œå¦‚æœè¦è®©æ¶ˆè´¹è€…æ¶ˆè´¹ä¸æˆåŠŸæ—¶ï¼Œç”Ÿäº§è€…ä¹Ÿå›æ»šï¼Œé‚£å°±ä¸èƒ½ç”¨è¿™ç§æ–¹æ¡ˆäº†ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å¦‚ä½•ä¿è¯é«˜å¯ç”¨æ€§&#34;&gt;å¦‚ä½•ä¿è¯é«˜å¯ç”¨æ€§&lt;/h2&gt;
&lt;p&gt;é›†ç¾¤ + zookeeper + è´Ÿè½½å‡è¡¡&lt;/p&gt;
&lt;p&gt;ä»¥ActiveMQä¸ºä¾‹ï¼ˆå› ä¸ºæ˜¯ä¸»ä»æ¶æ„ï¼‰&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ZooKeeperï¼ˆé›†ç¾¤ï¼‰æ³¨å†Œæ‰€æœ‰çš„ActiveMQ Brokerã€‚åªæœ‰å…¶ä¸­çš„ä¸€ä¸ªBrokerå¯ä»¥æä¾›æœåŠ¡ï¼Œè¢«è§†ä¸º Masterï¼Œå…¶ä»–çš„ Broker å¤„äºå¾…æœºçŠ¶æ€ï¼Œè¢«è§†ä¸ºSlaveã€‚å¦‚æœMasterå› æ•…éšœè€Œä¸èƒ½æä¾›æœåŠ¡ï¼ŒZookeeperä¼šä»Slaveä¸­é€‰ä¸¾å‡ºä¸€ä¸ªBrokerå……å½“Masterã€‚
Slaveè¿æ¥Masterå¹¶åŒæ­¥ä»–ä»¬çš„å­˜å‚¨çŠ¶æ€ï¼ŒSlaveä¸æ¥å—å®¢æˆ·ç«¯è¿æ¥ã€‚æ‰€æœ‰çš„å­˜å‚¨æ“ä½œéƒ½å°†è¢«å¤åˆ¶åˆ° è¿æ¥è‡³ Masterçš„Slavesã€‚å¦‚æœMasteræŒ‚äº†ï¼Œå¾—åˆ°äº†æœ€æ–°æ›´æ–°çš„Slaveä¼šæˆä¸º Masterã€‚æ•…éšœèŠ‚ç‚¹åœ¨æ¢å¤åä¼šé‡æ–°åŠ å…¥åˆ°é›†ç¾¤ä¸­å¹¶è¿æ¥Masterè¿›å…¥Slaveæ¨¡å¼&lt;/p&gt;
&lt;p&gt;æ¶ˆæ¯æ•°æ®å¯ä»¥æŒä¹…åŒ–æˆ–éæŒä¹…åŒ–ï¼Œåœ¨é›†ç¾¤å†…å…±äº«ï¼Œå½“æœ‰èŠ‚ç‚¹æŒ‚æ‰åï¼Œå…¶ä»–èŠ‚ç‚¹ä¹Ÿå¯ä»¥é€šè¿‡è¿™äº›å…±äº«çš„æ•°æ®é¡¶ä¸Šã€‚å¦å¤–ï¼Œä¹Ÿå¯é€šè¿‡å®šæ—¶ä»»åŠ¡å®šæ—¶å¯¹å¤±è´¥çš„æ¶ˆæ¯è¿›è¡Œè¡¥å¿ã€‚&lt;/p&gt;
&lt;p&gt;æ•°æ®çš„æŒä¹…åŒ–å­˜å‚¨å¯ä»¥å­˜å‚¨åœ¨æ–‡ä»¶ç³»ç»Ÿ &amp;gt; åˆ†å¸ƒå¼KV &amp;gt; åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ &amp;gt; æ•°æ®åº“ï¼ˆé€Ÿåº¦ä¸Šçš„æ’åˆ—ï¼Œä½†å¯é æ€§å°±è¦åè¿‡æ¥äº†ï¼‰&lt;/p&gt;
&lt;h2 id=&#34;å¦‚ä½•è§£å†³æ¶ˆæ¯é‡å¤é—®é¢˜ä¿è¯æ¶ˆæ¯å¹‚ç­‰æ€§&#34;&gt;å¦‚ä½•è§£å†³æ¶ˆæ¯é‡å¤é—®é¢˜ï¼Œä¿è¯æ¶ˆæ¯å¹‚ç­‰æ€§&lt;/h2&gt;
&lt;p&gt;æ¶ˆæ¯å¹‚ç­‰ï¼Œå¯ä»¥ä¿è¯å³ä½¿æ¶ˆæ¯è¢«é‡å¤æ¶ˆè´¹ä¹Ÿæ— æ‰€è°“ï¼Œä¸€èˆ¬æ¥è®²ï¼Œé‡å¤å‘é€æ€»æ˜¯å­˜åœ¨çš„ï¼Œè¦é¿å…çš„æ˜¯å³ä½¿é‡å¤æ¶ˆè´¹ä¹Ÿèƒ½ä¿è¯ä¸šåŠ¡æ­£ç¡®ã€‚è¦è§£å†³æ¶ˆæ¯é‡å¤å‘é€ï¼Œé™¤éå…è®¸æ¶ˆæ¯ä¸¢å¤±ï¼Œä½†å¾ˆæ˜æ˜¾ï¼Œæ¶ˆæ¯ä¸ä¸¢çš„ä¼˜å…ˆçº§è‚¯å®šæ›´é«˜ã€‚&lt;/p&gt;
&lt;p&gt;æ¶ˆæ¯é‡å¤æ¶ˆè´¹éœ€è¦è§£å†³3ä¸ªé—®é¢˜ï¼š1.ç¬¬ä¸€æ¡æ¶ˆæ¯å·²ç»æ¶ˆè´¹æˆåŠŸäº†ï¼Œç¬¬äºŒæ¡æ¶ˆæ¯å°†ç›´æ¥æˆåŠŸï¼›2.å¹¶å‘åœºæ™¯ä¸‹ï¼Œæ¶ˆæ¯é‡å¤ï¼Œå‡»ç©¿å¹‚ç­‰æŒ¡æ¿çš„é—®é¢˜ï¼›3.ç”Ÿäº§è€…å‘é€é‡å¤çš„æ¶ˆæ¯ï¼šé‡å¤çš„æ¶ˆæ¯idä¸€è‡´æˆ–è€…ä¸ä¸€è‡´&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å¸¸è§å®ç°å¹‚ç­‰æ€§æ–¹æ³•&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;ä¿è¯æ¶ˆæ¯å¹‚ç­‰ä¸€èˆ¬æ˜¯åœ¨æ¶ˆè´¹è€…åšï¼Œæ¯”å¦‚ä¸šåŠ¡æ“ä½œæœ¬èº«å°±æ˜¯å¹‚ç­‰çš„ï¼Œä¸ç„¶å°±æ˜¯åœ¨æ¶ˆæ¯æœ¬èº«ä¸Šåšæ–‡ç« ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;æ¶ˆè´¹è€…å¤„ç†æ¶ˆæ¯çš„æ—¶å€™å°†æ¶ˆæ¯å…¥åº“è®°å½•ï¼Œåˆ©ç”¨æ•°æ®åº“çš„å”¯ä¸€é”®çº¦æŸ + äº‹åŠ¡æ¥å®ç°ï¼Œæ¯”å¦‚äº‹åŠ¡å¼€å¯æ—¶ï¼Œå…ˆæŠŠæ¶ˆæ¯å…¥åº“ï¼Œå†è¿›è¡Œå…¶ä»–ä¸šåŠ¡æ“ä½œï¼Œç„¶åå†æäº¤äº‹åŠ¡ï¼Œä¿è¯æ¶ˆæ¯åªè¢«æ¶ˆè´¹ä¸€æ¬¡ï¼›&lt;/p&gt;
&lt;p&gt;è¿™ç§æ–¹æ¡ˆæœ‰å±€é™æ€§ï¼Œä¸€ä¸ªå®ƒéœ€è¦ä¾èµ–å…³ç³»å‹æ•°æ®åº“ï¼Œå¦ä¸€ä¸ªæ˜¯éœ€è¦æ‰€æœ‰çš„æ“ä½œéƒ½åœ¨åŒä¸€ä¸ªåº“é‡Œï¼Œä¿è¯åœ¨åŒä¸€ä¸ªåº“å†…ï¼Œä¸å…è®¸è·¨åº“æ“ä½œã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åŸºäºä¸Šé¢é‚£ç§æ–¹æ¡ˆï¼Œå¦‚æœæ¶‰åŠåˆ°è·¨æœåŠ¡ã€åº“çš„è°ƒç”¨ï¼Œåˆ™å¯ä»¥å°†è·¨æœåŠ¡çš„æ“ä½œä¹ŸæŠ½æˆä¸€ä¸ªæ¶ˆæ¯ï¼Œé€šè¿‡å°†å¯¹ä¸åŒæœåŠ¡æˆ–åº“çš„æ“ä½œä¹Ÿæ”¹æˆäº‹åŠ¡+æ¶ˆæ¯çš„æ–¹å¼æ¥åšï¼Œå°±å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯ä¼šå¯¼è‡´å¢åŠ ä¸šåŠ¡çš„å¤æ‚åº¦ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ¶ˆæ¯å…¥åº“ + æ¶ˆæ¯TTLå»é‡è¡¨ + æ¶ˆæ¯çŠ¶æ€çš„æ–¹æ¡ˆï¼šæ¶ˆè´¹è€…æ¥æ”¶åˆ°æ¶ˆæ¯ï¼Œæ’å…¥æ¶ˆæ¯å»é‡è¡¨ï¼Œå¹¶è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œå¦‚æœæ’å…¥æˆåŠŸï¼Œæ­¤æ—¶æ¶ˆæ¯çš„çŠ¶æ€ä¸ºæ¶ˆè´¹ä¸­ï¼Œæ‰§è¡Œä¸šåŠ¡ä»£ç ï¼ŒæˆåŠŸåæ›´æ–°æ¶ˆæ¯çŠ¶æ€ä¸ºå·²æ¶ˆè´¹ï¼Œç„¶åå‘é€ackï¼Œå¦‚æœä¸šåŠ¡ä»£ç æ‰§è¡Œå¤±è´¥ï¼Œåˆ™å°†æ¶ˆæ¯ä»æ¶ˆæ¯è¡¨åˆ é™¤ï¼Œé‡æ–°æŠ•é€’ï¼›å¦‚æœæ¶ˆæ¯ä¸€å¼€å§‹å°±æ’å…¥å¤±è´¥äº†ï¼Œåˆ¤æ–­æ¶ˆæ¯çš„çŠ¶æ€ï¼Œå¦‚æœæ¶ˆæ¯çŠ¶æ€æ˜¯å·²æ¶ˆè´¹ï¼Œåˆ™è¿”å›ackï¼Œå¦‚æœçŠ¶æ€æ˜¯æ¶ˆè´¹ä¸­ï¼Œåˆ™é‡æ–°æŠ•é€’ï¼Œä¹‹æ‰€ä»¥è¦å¤šè¿™ä¸€æ­¥æ˜¯ä¸ºäº†è§£å†³å¹¶å‘æ—¶å€™é‡å¤æ¶ˆæ¯çš„é—®é¢˜ï¼›æ’å…¥æ—¶è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œæ˜¯ä¸ºäº†è§£å†³æ¶ˆæ¯é‡å¤æŠ•é€’æ—¶ï¼Œæ¯æ¬¡éƒ½æ˜¯çœ‹åˆ°æ¶ˆæ¯æ˜¯æ¶ˆè´¹ä¸­çš„çŠ¶æ€ï¼Œå¯¼è‡´æ¶ˆæ¯æœ€ç»ˆå»äº†æ­»ä¿¡çš„é—®é¢˜ï¼›&lt;/p&gt;
&lt;p&gt;å½“ç„¶æ­¤æ–¹æ¡ˆä¸­å¦‚æœæ¶‰åŠåˆ°è·¨æœåŠ¡ã€åº“çš„è°ƒç”¨ï¼Œéœ€è¦ä¿è¯è¿™ä¸€æ¬¡è°ƒç”¨ä¹Ÿæ˜¯å¹‚ç­‰çš„ï¼Œè¯¥æ–¹æ¡ˆä»…ä»…æ˜¯è§£å†³ä¸Šé¢çš„æ–¹æ¡ˆä¸­ä¾èµ–å…³ç³»å‹æ•°æ®åº“å’Œäº‹åŠ¡çš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ›´æ–°æ•°æ®æ—¶è®¾ç½®å‰ç½®æ¡ä»¶ï¼Œå¦‚æœæ»¡è¶³è¯¥æ¡ä»¶åˆ™æ›´æ–°æ•°æ®ï¼Œå¦åˆ™æ‹’ç»æ›´æ–°æ•°æ®ï¼Œåœ¨æ›´æ–°æ•°æ®çš„åŒæ—¶ï¼Œå˜æ›´å‰ç½®æ¡ä»¶ä¸­éœ€è¦åˆ¤æ–­çš„æ•°æ®ï¼Œè¿™æ ·å½“é‡å¤æ‰§è¡Œè¿™ä¸ªæ“ä½œæ—¶ï¼Œç”±äºç¬¬ä¸€æ¬¡æ›´æ–°å·²ç»ä¿®æ”¹äº†å‰ç½®æ¡ä»¶ï¼Œä¸æ»¡è¶³å‰ç½®æ¡ä»¶æ—¶ï¼Œåˆ™ä¸ä¼šé‡å¤æ‰§è¡Œæ›´æ–°æ•°æ®çš„æ“ä½œï¼Œæ¯”å¦‚ç»™æ•°æ®å¢åŠ ä¸€ä¸ªç‰ˆæœ¬å·ï¼Œæ¯æ¬¡æ›´æ–°æ•°æ®å‰ï¼Œæ¯”è¾ƒå½“å‰æ•°æ®çš„ç‰ˆæœ¬å·æ˜¯å¦å’Œæ¶ˆæ¯ä¸­çš„ç‰ˆæœ¬å·ä¸€è‡´ï¼Œå¦‚æœä¸ä¸€è‡´å°±æ‹’ç»æ›´æ–°æ•°æ®ï¼Œæ›´æ–°æ•°æ®çš„åŒæ—¶ï¼Œç‰ˆæœ¬å·+1ï¼Œå®ç°å¹‚ç­‰æ›´æ–°ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åœ¨å‘é€æ¶ˆæ¯æ—¶ï¼Œç»™æ¶ˆæ¯æŒ‡å®šä¸€ä¸ªå…¨å±€å”¯ä¸€çš„IDï¼Œæ¶ˆè´¹æ—¶ï¼Œå…ˆæ ¹æ®è¿™ä¸ªIDæ£€æŸ¥è¿™æ¡æ¶ˆæ¯æ˜¯å¦è¢«æ¶ˆè´¹è¿‡ï¼Œå¦‚æœæ²¡æ¶ˆè´¹è¿‡ï¼Œæ‰æ›´æ–°æ•°æ®ï¼Œç„¶åæ ‡è®°æ¶ˆæ¯ä¸ºå·²æ¶ˆè´¹ã€‚ä½†è¯¥æ–¹æ¡ˆåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­æ¯”è¾ƒå¤æ‚ï¼Œé«˜å¯ç”¨ï¼Œé«˜æ€§èƒ½éƒ½æœ‰ä¸€å®šçš„å½±å“ï¼Œéœ€è¦ä½¿ç”¨åˆ†å¸ƒå¼é”æˆ–è€…åˆ†å¸ƒå¼äº‹åŠ¡&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¯¹äºæ— æ³•å¤„ç†çš„æ¶ˆæ¯å¯¼è‡´MQé‡å¤å‘é€ï¼Œå¯ä»¥è®¾ç½®é‡å¤æ¬¡æ•°ï¼Œè¿‡äº†é‡å¤æ¬¡æ•°å°†æ¶ˆæ¯æŒä¹…åŒ–åˆ°å…¶ä»–åœ°æ–¹ï¼Œæ¯”å¦‚æ­»ä¿¡é˜Ÿåˆ—ï¼Œä»¥åå¤„ç†ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;å¦‚ä½•ä¿è¯æ¶ˆæ¯é¡ºåº&#34;&gt;å¦‚ä½•ä¿è¯æ¶ˆæ¯é¡ºåº&lt;/h2&gt;
&lt;p&gt;100%çš„é¡ºåºæ¶ˆæ¯çš„æ¡ä»¶æ¯”è¾ƒè‹›åˆ»ï¼Œéœ€è¦å…è®¸æ¶ˆæ¯ä¸¢å¤±ä¸”ç”Ÿäº§è€…åˆ°æ¶ˆè´¹è€…éƒ½æ˜¯å•ç‚¹å•çº¿ç¨‹ï¼Œä¸€èˆ¬æ˜¯ä¿è¯åœ¨ä¸ä¸¢æ¶ˆæ¯çš„å‰æä¸‹ï¼Œå°½é‡å‡å°‘é‡å¤æ¶ˆæ¯ï¼Œä¸ä¿è¯æŠ•é€’é¡ºåºã€‚ã€‚&lt;/p&gt;
&lt;p&gt;å…è®¸é‡å¤æ¶ˆæ¯æ—¶ï¼Œå¯ä»¥é€šè¿‡&lt;strong&gt;åºåˆ—å·&lt;/strong&gt;æˆ–è€…&lt;strong&gt;çŠ¶æ€æœº&lt;/strong&gt;æ¥è§£å†³æ¶ˆæ¯å¹‚ç­‰å¤„ç†å’Œæ¶ˆæ¯é¡ºåºçš„é—®é¢˜&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åºåˆ—å·&lt;/strong&gt;ï¼šæ¶ˆè´¹è€…æ¥æ”¶æ¶ˆæ¯æ—¶ï¼Œåªæ¥æ”¶æ¯”æœ€æ–°åºåˆ—å·å¤§çš„æ¶ˆæ¯ï¼Œé‡å¤æ¶ˆæ¯å› ä¸ºåºåˆ—å·æ¯”å½“å‰åºåˆ—å·å°ï¼Œæ‰€ä»¥å¯ä»¥æŠ›å¼ƒï¼Œæ¯”å¦‚æ¶ˆæ¯é¡ºåºæ˜¯123ï¼Œæ¶ˆè´¹è€…å½“å‰ä¹Ÿæ”¶åˆ°123äº†ï¼Œå†æ”¶åˆ°123å…¶ä¸­ä¸€ä¸ªå°±å¯ä»¥ä¸è¿›è¡Œå¤„ç†äº†ï¼›å¦‚æœæ¶ˆæ¯é¡ºåºä¸ä¸€è‡´ï¼Œæ¯”å¦‚æ¶ˆæ¯é¡ºåºæ˜¯123ï¼Œä½†å…ˆæ¥æ”¶åˆ°çš„æ˜¯3ï¼Œ1å’Œ2è¿˜æ²¡æ”¶åˆ°ï¼Œé‚£å°±åªèƒ½å…ˆæŠŠ3å­˜èµ·æ¥ï¼Œç­‰å¾…12çš„åˆ°æ¥ï¼Œå…·ä½“å¯ä»¥å‚è€ƒTCPåè®®çš„é€šä¿¡æœºåˆ¶ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;çŠ¶æ€æœº&lt;/strong&gt;ï¼šå°†ä¸šåŠ¡æµç¨‹è®¾å®šæˆä¸€ç³»åˆ—çš„çŠ¶æ€æ‰­è½¬ï¼Œä¸åŒçš„çŠ¶æ€åªèƒ½å¤„ç†ä¸åŒçš„æ¶ˆæ¯ï¼Œå°±å¯ä»¥ä¾é çŠ¶æ€æµçš„æ‰­è½¬æ¥å®ç°é¡ºåºæ¶ˆæ¯&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;å‡å°‘é‡å¤æ¶ˆæ¯çš„å¤„ç†&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æ¶ˆæ¯é˜Ÿåˆ—æ”¶åˆ°æ¶ˆè´¹è€…çš„ç¡®è®¤ä¿¡å·åï¼Œå°†æ¶ˆæ¯idæ¸…é™¤æˆ–è¿›è¡Œæ ‡è®°ï¼›&lt;/p&gt;
&lt;p&gt;å‘é€æ–¹è¦è¿›è¡Œé‡å‘å‰å¯¹æ¶ˆè´¹è€…è¿›è¡Œè¯¢é—®è¯·æ±‚&lt;/p&gt;
&lt;h2 id=&#34;å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„å¯é æ€§ä¼ è¾“&#34;&gt;å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„å¯é æ€§ä¼ è¾“&lt;/h2&gt;
&lt;p&gt;æ¶ˆæ¯ä¼ è¾“æœ‰3ä¸ªé˜¶æ®µï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ¶ˆæ¯çš„ä¼ è¾“åŒ…æ‹¬ç”Ÿäº§è€…å‘é€æ¶ˆæ¯ç»™æ¶ˆæ¯é˜Ÿåˆ—&lt;/li&gt;
&lt;li&gt;æ¶ˆæ¯åœ¨Brokerç«¯å­˜å‚¨ï¼Œå¦‚æœæ˜¯é›†ç¾¤ï¼Œæ¶ˆæ¯ä¼šå¤åˆ¶åˆ°å…¶ä»–å‰¯æœ¬&lt;/li&gt;
&lt;li&gt;æ¶ˆè´¹è€…é€šè¿‡pullæ¨¡å¼æ‹‰å–æ•°æ® æˆ–è€… æ¶ˆæ¯é˜Ÿåˆ—é€šè¿‡pushæ¨¡å¼å‘æ¶ˆè´¹è€…å‘é€æ¶ˆæ¯&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä¿è¯æ¶ˆæ¯å¯é ï¼Œä¸€èˆ¬æ˜¯ä½¿ç”¨ &lt;strong&gt;æŒä¹…åŒ–æœºåˆ¶ æˆ– äº‹åŠ¡ + ackæœºåˆ¶&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æŒä¹…åŒ–ä¸ä¸€å®šå¸¦æœ‰äº‹åŠ¡ç‰¹æ€§ï¼Œæ¯”å¦‚ç›´æ¥æ—¥å¿—è½åœ°ï¼Œå¦‚æœæŒä¹…åŒ–è¦å®ç°äº‹åŠ¡ç‰¹æ€§ï¼Œå¯ä»¥ä½¿ç”¨åˆ†å¸ƒå¼äº‹åŠ¡æˆ–è€…æœ¬åœ°æ•°æ®åº“äº‹åŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;æ¶ˆæ¯çš„ç¡®è®¤æœºåˆ¶ï¼ˆackæœºåˆ¶ï¼‰ï¼Œæ¶ˆæ¯å‘é€å®Œæˆåï¼Œéœ€è¦æ”¶åˆ°æ¥æ”¶æ–¹çš„ç¡®è®¤ä¿¡å·ï¼Œç¡®è®¤ä¿¡å·çš„è¿”å›å¯ä»¥æ˜¯æ”¶åˆ°åæ¶ˆæ¯åå°±ç«‹å³è¿”å›ï¼Œæ¯”å¦‚é»˜è®¤auto ackæœºåˆ¶ï¼Œæˆ–è€…æ˜¯æ¥æ”¶æ–¹æ³•æ¥æ”¶åˆ°æ¶ˆæ¯ï¼Œå¤„ç†å®Œè¯¥æ¶ˆæ¯åæ‰å‘é€ç¡®è®¤ä¿¡å·ã€‚å¦å¤–ï¼Œå½“æ¥æ”¶æ–¹æ— æ³•å¤„ç†æ¶ˆæ¯ï¼Œæ¯”å¦‚æ¶ˆè´¹èƒ½åŠ›ä¸å¤Ÿï¼Œç½‘ç»œä¸ä½³ç­‰æƒ…å†µï¼Œæ¥æ”¶æ–¹ä¹Ÿå¯ä»¥ç›´æ¥æ‹’ç»æ¶ˆæ¯ï¼Œç­‰å¾…å‘é€æ–¹é‡æ–°å‘é€ï¼Œæ‰€ä»¥è¿™é‡Œå°±æ¶‰åŠåˆ°æ¶ˆæ¯çš„é‡å¤å‘é€äº†ï¼Œé€šè¿‡ç›´æ¥æ‹’ç»æ¶ˆæ¯æ¥å‡å°‘ä¸šåŠ¡è´Ÿæ‹…ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ACKæ¨¡å¼æè¿°äº†Consumerä¸brokerç¡®è®¤æ¶ˆæ¯çš„æ–¹å¼(æ—¶æœº),æ¯”å¦‚å½“æ¶ˆæ¯è¢«Consumeræ¥æ”¶ä¹‹å,Consumerå°†åœ¨ä½•æ—¶ç¡®è®¤æ¶ˆæ¯ã€‚å¯¹äºbrokerè€Œè¨€ï¼Œåªæœ‰æ¥æ”¶åˆ°ACKæŒ‡ä»¤,æ‰ä¼šè®¤ä¸ºæ¶ˆæ¯è¢«æ­£ç¡®çš„æ¥æ”¶æˆ–è€…å¤„ç†æˆåŠŸäº†,é€šè¿‡ACKï¼Œå¯ä»¥åœ¨consumerï¼ˆproducerï¼‰ä¸Brokerä¹‹é—´å»ºç«‹ä¸€ç§ç®€å•çš„â€œæ‹…ä¿â€æœºåˆ¶.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;æ¶ˆæ¯å‘é€é˜¶æ®µï¼šç”Ÿäº§è€…å¾€Brokerå‘é€æ¶ˆæ¯å‰ï¼Œå¯ä»¥åšä¸€æ¬¡æ¶ˆæ¯æŒä¹…åŒ–ï¼Œæ”¶åˆ°Brokerçš„ackå“åº”åï¼Œè¦æ­£ç¡®å¤„ç†ï¼Œä»¥æ­¤ä¿è¯æ¶ˆæ¯åœ¨ç”Ÿäº§é˜¶æ®µä¸ä¼šä¸¢å¤±ã€‚åœ¨æ­¤é˜¶æ®µï¼ŒBrokerå¹¶ä¸å…³å¿ƒç”Ÿäº§è€…æ˜¯å¦æ”¶åˆ°ackå“åº”ï¼Œå› ä¸ºåœ¨ç”Ÿäº§è€…çš„è§’åº¦ï¼Œæ¶ˆæ¯å·²ç»æŒä¹…åŒ–åæˆåŠŸå‘å‡ºäº†ï¼Œå¦‚æœæ²¡æœ‰æ”¶åˆ°ackï¼Œæœ€å¤šå°±é‡å¤å‘é€ï¼Œé‚£å°±ä¼šæ”¶åˆ°é‡å¤çš„ackï¼Œä¿è¯æ¶ˆæ¯ä¸€å®šè½åˆ°äº†Brokerï¼Œå½“ç„¶å‰ææ˜¯Brokerèƒ½å¹‚ç­‰å¤„ç†ã€‚&lt;/p&gt;
&lt;p&gt;å‘é€æ–¹åªæœ‰åœ¨æ¶ˆæ¯å…¥åº“æˆåŠŸï¼Œäº‹åŠ¡æäº¤åï¼Œæ‰ä¼šå‘é€æ¶ˆæ¯ï¼Œå¦‚æœå‘é€å¤±è´¥ï¼Œå¯ä»¥é å®šæ—¶ä»»åŠ¡é‡è¯•ã€‚æ³¨æ„æœ¬åœ°äº‹åŠ¡åšçš„æ˜¯ä¸šåŠ¡è½åœ°å’Œæ¶ˆæ¯è½åœ°çš„äº‹åŠ¡ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ¶ˆæ¯åˆ°è¾¾Brokeré˜¶æ®µï¼šå¯¹äºå•èŠ‚ç‚¹Brokerï¼Œåœ¨æ”¶åˆ°æ¶ˆæ¯åï¼Œå°†æ¶ˆæ¯æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œå†ç»™ç”Ÿäº§è€…è¿”å›ackå“åº”ï¼›å¯¹äºé›†ç¾¤Brokerï¼Œåœ¨æ”¶åˆ°æ¶ˆæ¯åï¼Œè‡³å°‘è¦æŠŠæ¶ˆæ¯å‘é€åˆ°ä¸¤ä¸ªä»¥ä¸ŠèŠ‚ç‚¹ï¼Œå†ç»™ç”Ÿäº§è€…è¿”å›ackå“åº”ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ¶ˆæ¯æ¶ˆè´¹é˜¶æ®µï¼šå¯¹äºpullæ¨¡å¼ï¼Œæ¶ˆè´¹è€…æ‹‰å–æ¶ˆæ¯åï¼Œå…ˆæˆåŠŸæ‰§è¡Œå®Œä¸šåŠ¡é€»è¾‘åï¼Œæ‰ç»™Brokerå‘é€æ¶ˆè´¹ackå“åº”ï¼Œå¦‚æœBrokeræ²¡æœ‰æ”¶åˆ°æ¶ˆè´¹è€…çš„ç¡®è®¤å“åº”ï¼Œä¸‹æ¬¡æ‹‰å–çš„ä»ç„¶æ˜¯åŒä¸€æ¡æ¶ˆæ¯ã€‚&lt;/p&gt;
&lt;p&gt;æ”¯æŒå¹¿æ’­çš„æ¶ˆæ¯é˜Ÿåˆ—éœ€è¦å¯¹æ¯ä¸ªå¾…å‘é€çš„endpointï¼ŒæŒä¹…åŒ–ä¸€ä¸ªå‘é€çŠ¶æ€ï¼Œç›´åˆ°æ‰€æœ‰endpointçŠ¶æ€éƒ½OKæ‰å¯åˆ é™¤æ¶ˆæ¯ã€‚&lt;/p&gt;
&lt;p&gt;æ— è®ºæ˜¯pullæ¨¡å¼è¿˜æ˜¯pushæ¨¡å¼ï¼Œåœ¨å…è®¸é‡å¤æ¶ˆæ¯çš„æƒ…å†µä¸‹ï¼Œè¿˜å¯é€šè¿‡å®šæ—¶ä»»åŠ¡è½®è¯¢æœªæ¶ˆè´¹æ¶ˆæ¯å‘é€ç»™æ¶ˆè´¹è€…å¤„ç†æ¥ä¿è¯æœ€ç»ˆä¸€è‡´æ€§ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä¿è¯æ¶ˆæ¯ä»ç”Ÿäº§è€…åˆ°MQæˆ–è€…MQåˆ°æ¶ˆè´¹è€…çš„è¿‡ç¨‹åœ¨åŒä¸€ä¸ªä¼šè¯ä¸­ï¼Œä¿è¯åŸå­æ€§ï¼›åœ¨äº‹åŠ¡æ€§ä¼šè¯ä¸­ï¼Œå½“ä¸€ä¸ªäº‹åŠ¡è¢«æäº¤çš„æ—¶å€™ï¼Œç¡®è®¤è‡ªåŠ¨å‘ç”Ÿï¼›äº‹åŠ¡å›æ»šï¼Œæ¶ˆæ¯å†æ¬¡ä¼ é€ï¼›ä¸€ä¸ªäº‹åŠ¡æäº¤æ‰èƒ½è¿›è¡Œä¸‹ä¸ªäº‹åŠ¡ï¼Œæ•ˆç‡è¾ƒå·®ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨éäº‹åŠ¡æ€§ä¼šè¯ä¸­ï¼Œæ¶ˆæ¯ä½•æ—¶è¢«ç¡®è®¤å–å†³äºåˆ›å»ºä¼šè¯æ—¶çš„åº”ç­”æ¨¡å¼ACKæ¨¡å¼ï¼Œåˆ†ä¸ºè‡ªåŠ¨ç¡®è®¤(onMessageæ–¹æ³•æˆåŠŸè¿”å›ï¼Œå¦‚æœæŠ›å¼‚å¸¸ä¼šäº¤ç”±å¼‚å¸¸æ¶ˆæ¯ç›‘å¬å™¨ï¼Œæˆ–è€…é‡å¤æ¬¡æ•°å‘é€)ã€æ‰‹åŠ¨ç¡®è®¤ã€ä¸å¿…é¡»ç¡®è®¤,æ‰¹é‡(é‡å¤æœ‰æ ‡è®°)ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ£€æµ‹æ¶ˆæ¯ä¸¢å¤±çš„æ–¹æ³•&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—çš„æœ‰åºæ€§æ¥éªŒè¯æ˜¯å¦æœ‰æ¶ˆæ¯ä¸¢å¤±ã€‚ç”Ÿäº§è€…å‘å‡ºæ¶ˆæ¯æ—¶é™„åŠ ä¸€ä¸ªè¿ç»­é€’å¢çš„åºå·ï¼Œç”±æ¶ˆè´¹è€…æ¥æ£€æŸ¥è¿™ä¸ªåºå·çš„è¿ç»­æ€§ã€‚åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸Šï¼Œåœ¨å‘é€æ¶ˆæ¯æ—¶å¿…é¡»æŒ‡å®šåˆ†åŒºï¼Œæ¶ˆè´¹è€…åœ¨æ¯ä¸ªåˆ†åŒºå•ç‹¬æ£€æŸ¥æ¶ˆæ¯åºå·çš„è¿ç»­æ€§ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ¶ˆæ¯çš„ä¸¢å¤±å¤„ç†&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ç”Ÿäº§è€…æ¶ˆæ¯ä¸¢å¤±å¤„ç†ï¼šå‘é€æ¶ˆæ¯æ—¶äº§ç”Ÿä¸€ä¸ªidï¼ŒMQæ¥æ”¶åˆ°æ¶ˆæ¯åå›ä¼ idï¼Œè¶…è¿‡ä¸€å®šæ—¶é—´æ²¡æ”¶åˆ°åˆ™é‡å‘&lt;/p&gt;
&lt;p&gt;MQæ¶ˆæ¯ä¸¢å¤±å¤„ç†ï¼šå¼€å¯æ¶ˆæ¯é˜Ÿåˆ—æŒä¹…åŒ– å’Œ æ¶ˆæ¯æŒä¹…åŒ–ï¼ŒæŒä¹…åŒ–åæ‰å›ä¼ idç»™ç”Ÿäº§è€…&lt;/p&gt;
&lt;p&gt;æ¶ˆè´¹è€…æ¶ˆæ¯ä¸¢å¤±å¤„ç†ï¼šå–æ¶ˆè‡ªåŠ¨ackï¼Œåœ¨æ–¹æ³•å¤„ç†å®Œä¹‹åè°ƒç”¨æ–¹æ³•ï¼Œå‘é€ç¡®è®¤ackç»™MQï¼Œå¦‚æœæ¶ˆæ¯å¤„ç†çš„æ—¶é—´å¤ªé•¿ï¼Œä½†å¯èƒ½å¯¼è‡´é‡å¤å‘é€&lt;/p&gt;
&lt;h2 id=&#34;å…³äºpullæ¨¡å¼å’Œpushæ¨¡å¼&#34;&gt;å…³äºpullæ¨¡å¼å’Œpushæ¨¡å¼&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;pushæ¨¡å¼çš„å¼Šç«¯ï¼Œå¦‚æœæ¶ˆè´¹è€…æ¶ˆè´¹èƒ½åŠ›ä¸å¤Ÿï¼Œå°±ä¼šå¯¼è‡´æ¶ˆæ¯åœ¨æ¶ˆæ¯é˜Ÿåˆ—ä¸­å †ç§¯ï¼Œæ¶ˆæ¯é˜Ÿåˆ—ä¹Ÿéœ€è¦ä¿å­˜è¿™äº›æ¶ˆæ¯ï¼Œè®°å½•è¿™äº›æ¶ˆæ¯çš„çŠ¶æ€ï¼›è€Œpullæ¨¡å¼æ˜¯æ¶ˆè´¹è€…æŒ‰èƒ½åŠ›æ¶ˆè´¹ï¼Œæ‰€ä»¥æ²¡æœ‰è¿™æ ·é—®é¢˜ã€‚&lt;/li&gt;
&lt;li&gt;pushæ¨¡å¼ä¸‹è¦ä¿è¯é¡ºåºæ¶ˆæ¯ä¹Ÿæ¯”è¾ƒéº»çƒ¦ï¼Œéœ€è¦ç­‰å¾…æ¶ˆè´¹è€…ç¡®è®¤ä¸€ä¸ªæ¶ˆæ¯åæ‰èƒ½å‘é€ä¸‹ä¸€ä¸ªï¼Œååé‡å°±ä¸å¤ªè¡Œäº†&lt;/li&gt;
&lt;li&gt;pullæ¨¡å¼çš„å¼Šç«¯ï¼Œå› ä¸ºæ¶ˆè´¹è€…æ‹‰å–æ¶ˆæ¯çš„æ—¶é—´é—´éš”æ¯”è¾ƒéš¾æŠŠæ¡ï¼Œé—´éš”æ—¶é—´ä¸åˆç†å°±ä¼šå¯¼è‡´æ¶ˆæ¯æ¶ˆè´¹å­˜åœ¨å»¶è¿Ÿå’Œå¿™ç­‰ï¼Œå¸¸è§çš„ä½œæ³•æ˜¯æ¶ˆè´¹è€…å»ºç«‹è¿æ¥åholdä½ä¸€æ®µæ—¶é—´ï¼Œä¿å­˜ä¸€ä¸ªé•¿è¿æ¥ï¼Œè®¾ç½®ç­‰å¾…æ—¶é—´è¿›è¡Œæ–­å¼€ï¼Œåœ¨è¿™æ®µæ—¶é—´å†…è¿›è¡Œæ¶ˆæ¯æ¶ˆè´¹&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;å¦‚ä½•è§£å†³æ¶ˆæ¯é˜Ÿåˆ—çš„å»¶æ—¶ä»¥åŠè¿‡æœŸå¤±æ•ˆé—®é¢˜&#34;&gt;å¦‚ä½•è§£å†³æ¶ˆæ¯é˜Ÿåˆ—çš„å»¶æ—¶ä»¥åŠè¿‡æœŸå¤±æ•ˆé—®é¢˜ï¼Ÿ&lt;/h2&gt;
&lt;p&gt;æ‰‹åŠ¨æŸ¥è¯¢ä¸¢å¤±æ¶ˆæ¯ï¼Œé‡æ–°å¯¼å…¥&lt;/p&gt;
&lt;p&gt;å¯ä»¥è®¾ç½®æ­»ä¿¡é˜Ÿåˆ—ï¼Œè¿‡æœŸæˆ–è€…é‡å¤å¤šæ¬¡ä¸ºè¢«æ¶ˆè´¹çš„æ¶ˆæ¯ä¼šè¿›å…¥æ­»ä¿¡é˜Ÿåˆ—&lt;/p&gt;
&lt;h2 id=&#34;å¦‚ä½•è§£å†³æ¶ˆæ¯ç§¯å‹é—®é¢˜&#34;&gt;å¦‚ä½•è§£å†³æ¶ˆæ¯ç§¯å‹é—®é¢˜ï¼Ÿ&lt;/h2&gt;
&lt;p&gt;ä¸€èˆ¬æ¶ˆæ¯ç§¯å‹ï¼Œè¦ä¸å°±æ˜¯å‘é€å¿«äº†ï¼Œè¦ä¸å°±æ˜¯æ¶ˆè´¹æ…¢äº†ï¼Œä¸€èˆ¬å…ˆæŸ¥MQç›‘æ§ï¼Œåˆ¤æ–­ç”Ÿäº§é€Ÿåº¦å’Œæ¶ˆè´¹é€Ÿåº¦æ˜¯å¦å¼‚å¸¸ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ç”Ÿäº§è€…å‘é€æ¶ˆæ¯å¤ªæ…¢ä¹Ÿä¼šå¯¼è‡´ç§¯å‹ï¼Œæ¯”å¦‚ï¼Œç”Ÿäº§è€…åœ¨ä¸€ä¸ªäº‹åŠ¡å†…å…ˆå‘é€åŠæ¶ˆæ¯ï¼Œå¤„ç†ä¸šåŠ¡é€»è¾‘ï¼Œæäº¤äº‹åŠ¡ï¼Œäº‹åŠ¡æˆåŠŸåæ‰ä¼šæäº¤åŠæ¶ˆæ¯ï¼Œæ­¤æ—¶è¯¥æ¶ˆæ¯æ‰ä¼šè¢«æ¶ˆè´¹è€…æ‰€è§ï¼Œå¦‚æœäº‹åŠ¡å¤„ç†å¾—å¤ªæ…¢ï¼Œä¹Ÿä¼šé€ æˆæ¶ˆæ¯å †ç§¯ã€‚&lt;/p&gt;
&lt;p&gt;so ç”Ÿäº§è€…æœ€å¥½å¯ä»¥æ”¯æŒæ‰¹é‡å‘é€æˆ–è€…å¹¶è¡Œå‘é€ä¸¤ç§å‘é€æ–¹å¼ï¼›å¯¹äºå®æ—¶æ€§ä¸å¼ºçš„ä¸šåŠ¡ï¼Œç”Ÿäº§è€…å¯ä»¥ç§¯ç´¯ä¸€å®šé‡çš„æ¶ˆæ¯æ‰å‘é€ç»™MQï¼›å¯¹äºæ‰¹é‡å‘é€çš„æ¶ˆæ¯ï¼Œæ¶ˆè´¹æ—¶ä¹Ÿè¦æ‰¹é‡æ¶ˆè´¹&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¿®å¤æ¶ˆè´¹è€…ï¼Œæ£€æŸ¥æ¶ˆè´¹è€…æ˜¯ä¸æ˜¯å¯¹æŸä¸€æ¶ˆæ¯è¿›è¡Œé‡å¤æ¶ˆè´¹ï¼Œæ¢å¤æ¶ˆè´¹é€Ÿåº¦ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ‰©å……åŸæ¥çš„æ•°é‡ï¼Œæ¶ˆè´¹ä¹‹åå†æ¢å¤åŸæ¥æ¶æ„ã€‚æ¯”å¦‚æ–°é”®ä¸€ä¸ªtopicï¼Œå»ºç«‹æ¯”åŸå…ˆå¤šnå€çš„é˜Ÿåˆ—ï¼Œå¤šnå€çš„æ¶ˆè´¹è€…å¤„ç†ï¼Œæ¯æ‰¹æ¶ˆè´¹è€…å¯¹åº”ä¸€ä¸ªé˜Ÿåˆ—ï¼ˆåˆ†åŒºï¼‰ï¼Œç¡®ä¿æ¶ˆè´¹è€…çš„å®ä¾‹æ•°å’Œé˜Ÿåˆ—(åˆ†åŒº)æ•°ç›¸ç­‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¦‚æœå¯ä»¥æŒä¹…åŒ–æ¶ˆæ¯ï¼Œä¹Ÿå¯ä»¥å…ˆä¸¢å¼ƒæ¶ˆæ¯ï¼Œä¹‹åå†å°†æŒä¹…åŒ–æ¶ˆæ¯å¯¼å…¥é˜Ÿåˆ—å†å¤„ç†&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æœåŠ¡é™çº§ï¼Œå‡å°‘ç”Ÿäº§è€…çš„å‘é€æ¶ˆæ¯çš„æ•°é‡&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;å»¶è¿Ÿé˜Ÿåˆ—&#34;&gt;å»¶è¿Ÿé˜Ÿåˆ—&lt;/h1&gt;
&lt;p&gt;ä»»æ„å»¶è¿Ÿæ¶ˆæ¯æœ‰ä¸¤ä¸ªéš¾ç‚¹ï¼Œä¸€ä¸ªæ˜¯æ¶ˆæ¯å› ä¸ºæœ‰ä¸åŒçš„è¿‡æœŸæ—¶é—´ï¼Œä¸”æŠ•é€’é¡ºåºä¸å®šï¼Œå› æ­¤å¤„ç†æ¶ˆæ¯æ—¶éœ€è¦æ’åºï¼Œå¦ä¸€ä¸ªæ˜¯å»¶è¿Ÿæ¶ˆæ¯çš„å­˜å‚¨ï¼Œå› ä¸ºå¦‚æœMQåŸºäºWALæ–¹å¼å®ç°ï¼Œæ—¥å¿—æ–‡ä»¶ä¼šè¢«è¿‡æœŸåˆ é™¤ï¼Œå…¶æœ€å¤šåªèƒ½ä¿å­˜ä¸€æ®µæ—¶é—´çš„æ•°æ®ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;é€šè¿‡RabbitMQçš„TTLæ¶ˆæ¯ + æ­»ä¿¡é˜Ÿåˆ—å®ç°ï¼Œæ¶ˆæ¯çš„TTLè¿‡æœŸä¹‹åï¼Œä¼šè¢«è½¬å‘åˆ°æ­»ä¿¡ï¼Œæ¶ˆè´¹è€…ç›´æ¥æ¶ˆè´¹æ­»ä¿¡é˜Ÿåˆ—é‡Œçš„æ¶ˆæ¯å³å¯ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åŸºäºKafkaï¼Œç”±äºKafkaæœ¬èº«ä¸æ”¯æŒå»¶è¿Ÿæ¶ˆæ¯ï¼Œåªèƒ½é€šè¿‡é¢å¤–æ–¹æ¡ˆå®ç°ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å®ç°å›ºå®šè¿‡æœŸæ—¶é—´çš„å»¶è¿Ÿæ¶ˆæ¯&lt;/strong&gt;ï¼šè®¾ç½®ä¸¤ä¸ªTopicï¼Œä¸€ä¸ªç”¨äºç”Ÿäº§è€…æŠ•é€’è®¾å®šå¥½è¿‡æœŸæ—¶é—´çš„æ¶ˆæ¯ï¼Œå¦ä¸€ä¸ªæ˜¯ç”¨äºç«‹å³æ¶ˆè´¹æ¶ˆæ¯ã€‚ç”Ÿäº§è€…è®¾å®šæ¶ˆæ¯è¿‡æœŸæ—¶é—´åï¼ŒæŠ•é€’åˆ°ç¬¬ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆæ¯ååˆ¤æ–­æ˜¯å¦éœ€è¦ç«‹å³æ‰§è¡Œï¼Œå¦‚æœéœ€è¦åˆ™æŠŠæ¶ˆæ¯æŠ•é€’åˆ°ç¬¬ä¸€ä¸ªTopicï¼Œç”±çœŸæ­£çš„æ¶ˆè´¹è€…æ‰§è¡Œæ¶ˆè´¹ã€‚æ¶ˆè´¹ç¬¬ä¸€ä¸ªé˜Ÿåˆ—çš„æ¶ˆè´¹è€…å¦‚æœåˆ¤æ–­å‡ºæ¶ˆæ¯ä¸èƒ½è¢«æŠ•é€’åˆ°ç¬¬äºŒä¸ªé˜Ÿåˆ—ï¼Œéœ€è¦ä½¿ç”¨Kafkaæä¾›çš„ å¼€å§‹/æš‚åœ API æ¥æ¶ˆè´¹æ¶ˆæ¯ï¼Œä¸èƒ½ä½¿ç”¨sleepæš‚åœæ¶ˆè´¹æ¶ˆæ¯ï¼Œä¹Ÿä¸èƒ½é‡æ–°æŠ•é€’ï¼ˆå› ä¸ºæ¶ˆæ¯çš„é¡ºåºæ€§ï¼‰ï¼Œå¦åˆ™ä¼šå¯¼è‡´Brokerè®¤ä¸ºæ¶ˆè´¹è€…ä¸å¯ç”¨ï¼Œè§¦å‘ é‡å¹³è¡¡æœºåˆ¶ã€‚&lt;/p&gt;
&lt;p&gt;ç¼ºç‚¹ï¼šæ¶ˆæ¯åªèƒ½æ˜¯å›ºå®šçš„å»¶è¿Ÿï¼Œå¦‚æœæ¯æ¡æ¶ˆæ¯çš„å»¶è¿Ÿæ—¶é—´ä¸åŒï¼Œå°±å¾—ä½¿ç”¨å¤šç§Topicå’Œå¯¹åº”çš„æ¶ˆè´¹è€…ï¼›å»¶è¿Ÿæ—¶é—´ä¸å®œè¿‡é•¿ï¼Œå› ä¸ºWALæœºåˆ¶ï¼Œæ¶ˆæ¯å †ç§¯å¯èƒ½ä¼šå¯¼è‡´æ—¥å¿—æ–‡ä»¶è¢«åˆ é™¤&lt;/p&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/Kafka%e5%bb%b6%e8%bf%9f%e9%98%9f%e5%88%97%e5%ae%9e%e7%8e%b0.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/Kafka%e5%bb%b6%e8%bf%9f%e9%98%9f%e5%88%97%e5%ae%9e%e7%8e%b0.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¤šçº§æ—¶é—´è½®ä¼˜åŒ–æ’åºï¼›å°†æ™®é€šæ¶ˆæ¯å’Œå»¶è¿Ÿæ¶ˆæ¯çš„commitLogåˆ†å¼€ä¿å­˜ï¼Œä»¥ä¿å­˜è¾ƒé•¿æ—¶é—´ï¼›å»¶è¿Ÿæ¶ˆæ¯æ•°æ®æŒ‰å›ºå®šå»¶è¿Ÿåˆ’åˆ†ï¼Œåˆ†æ®µåŠ è½½ï¼Œæ—¶é—´è½®åªåŠ è½½ä¸´è¿‘åˆ°æœŸçš„æ¶ˆæ¯ï¼Œæ¯”å¦‚æ¯30åˆ†é’Ÿä¸€ä¸ªå—å†™å…¥æ–‡ä»¶ï¼Œæ•´ç‚¹æ—¶è®¡ç®—ä¸‹ä¸€ä¸ª30åˆ†é’Ÿçš„æ¶ˆæ¯hashåˆ°å¯¹åº”çš„æ—¶é—´è½®ä¸Šï¼Œè€Œè¶…è¿‡æ—¶é—´è½®é™åˆ¶çš„ï¼Œç›´æ¥è½ç›˜ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/%e6%97%b6%e9%97%b4%e8%bd%ae%e5%bb%b6%e8%bf%9f%e9%98%9f%e5%88%97.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/%e6%97%b6%e9%97%b4%e8%bd%ae%e5%bb%b6%e8%bf%9f%e9%98%9f%e5%88%97.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;æ¶ˆæ¯å†™å…¥WAL&lt;/li&gt;
&lt;li&gt;Dispatcherå¤„ç†å»¶è¿Ÿæ¶ˆæ¯
&lt;ul&gt;
&lt;li&gt;å»¶è¿Ÿæ¶ˆæ¯ä¸€å®šæ—¶é—´çš„ç›´æ¥å†™å…¥TimeWheel&lt;/li&gt;
&lt;li&gt;å»¶è¿Ÿè¶…è¿‡ä¸€å®šæ—¶é—´å†™å…¥DelayMessageStorage&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;DelayMessageStorageå¯¹DelayMsgFileæ„å»ºä¸€å±‚ç´¢å¼•ï¼Œè¿™æ ·åœ¨æ˜ å°„åˆ°TimeWheelæ—¶åªéœ€è¦åšä¸€æ¬¡Hashæ“ä½œ&lt;/li&gt;
&lt;li&gt;é€šè¿‡TimeWheelå°†æ¶ˆæ¯æŠ•é€’åˆ°ConsumeQueueä¸­å®Œæˆå¯¹Consumerçš„å¯è§&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://zhuanlan.zhihu.com/p/266156267&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;å‡ ç§å»¶è¿Ÿé˜Ÿåˆ—å®ç°&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://developer.aliyun.com/article/660438&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;å¦‚ä½•åœ¨MQä¸­å®ç°æ”¯æŒä»»æ„å»¶è¿Ÿçš„æ¶ˆæ¯ï¼Ÿ&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h1&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;http://xuyangyang.club/articles/2018/07/23/1532348839398.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;æ¶ˆæ¯é˜Ÿåˆ—å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;http://youzhixueyuan.com/design-the-message-queue.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;å¦‚ä½•ä»0åˆ°1è®¾è®¡ä¸€ä¸ªMQæ¶ˆæ¯é˜Ÿåˆ—&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://shift-alt-ctrl.iteye.com/blog/2020182&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;ActiveMQæ¶ˆæ¯ä¼ é€æœºåˆ¶ä»¥åŠACKæœºåˆ¶è¯¦è§£&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://blog.csdn.net/zhaobryant/article/details/80557103&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;æ¶æ„æ–‡æ‘˜ï¼šæ¶ˆæ¯é˜Ÿåˆ—è®¾è®¡ç²¾è¦&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://tech.meituan.com/2016/07/01/mq-design.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;æ¶ˆæ¯é˜Ÿåˆ—è®¾è®¡ç²¾è¦&lt;/a&gt;ï¼Œè¿™ä¸ªè®²çš„ä¸é”™&lt;/p&gt;
&lt;p&gt;æå®¢æ—¶é—´ - æ¶ˆæ¯é˜Ÿåˆ—é«˜æ‰‹è¯¾ - æç¥&lt;/p&gt;
</description>
        </item>
        <item>
        <title>ç½‘ç»œ</title>
        <link>http://nixum.cc/p/%E7%BD%91%E7%BB%9C/</link>
        <pubDate>Sun, 22 Sep 2019 00:00:00 +0000</pubDate>
        
        <guid>http://nixum.cc/p/%E7%BD%91%E7%BB%9C/</guid>
        <description>&lt;p&gt;[TOC]&lt;/p&gt;
&lt;h1 id=&#34;åŸºæœ¬&#34;&gt;åŸºæœ¬&lt;/h1&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;OSIä¸ƒå±‚æ¨¡å‹&lt;/th&gt;
&lt;th&gt;å¯¹åº”ç½‘ç»œåè®®&lt;/th&gt;
&lt;th&gt;ä½œç”¨&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;åº”ç”¨å±‚&lt;/td&gt;
&lt;td&gt;HTTPã€TFTPã€FTPã€NFSã€SMTPã€Telnet&lt;/td&gt;
&lt;td&gt;åº”ç”¨ç¨‹åºé—´é€šä¿¡çš„ç½‘ç»œåè®®&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;è¡¨ç¤ºå±‚&lt;/td&gt;
&lt;td&gt;Rloginã€SNMPã€Gopher&lt;/td&gt;
&lt;td&gt;æ•°æ®æ ¼å¼åŒ–ã€åŠ å¯†ã€è§£å¯†&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ä¼šè¯å±‚&lt;/td&gt;
&lt;td&gt;SMTPã€DNS&lt;/td&gt;
&lt;td&gt;å»ºç«‹ã€ç»´æŠ¤ã€ç®¡ç†ä¼šè¯è¿æ¥&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ä¼ è¾“å±‚&lt;/td&gt;
&lt;td&gt;TCPã€UDP&lt;/td&gt;
&lt;td&gt;å»ºç«‹ã€ç»´æŠ¤ã€ç®¡ç†ç«¯åˆ°ç«¯è¿æ¥&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ç½‘ç»œå±‚&lt;/td&gt;
&lt;td&gt;IPã€ICMPã€ARPã€RARPã€AKPã€UUCP&lt;/td&gt;
&lt;td&gt;IPå¯»å€å’Œè·¯ç”±é€‰æ‹©&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æ•°æ®é“¾è·¯å±‚&lt;/td&gt;
&lt;td&gt;FDDIã€Ethernetã€Arpanetã€PDNã€SLIPã€PPP&lt;/td&gt;
&lt;td&gt;æ§åˆ¶ç½‘ç»œå±‚ä¸ç‰©ç†å±‚é—´çš„é€šä¿¡&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ç‰©ç†å±‚&lt;/td&gt;
&lt;td&gt;IEEE 802.1Aã€IEEE 802.2åˆ°802.11&lt;/td&gt;
&lt;td&gt;æ¯”ç‰¹æµä¼ è¾“&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;æ•°æ®é“¾è·¯å±‚ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ•°æ®åŒ…å«Frameï¼Œâ€œå¸§â€ï¼›&lt;/li&gt;
&lt;li&gt;ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼šæ ‡å¤´å’Œæ•°æ®ï¼Œæ ‡å¤´æ ‡æ˜æ•°æ®å‘é€è€…ã€æ¥æ”¶è€…ã€æ•°æ®ç±»å‹ï¼›&lt;/li&gt;
&lt;li&gt;ç”¨MACåœ°å€å®šä½æ•°æ®åŒ…è·¯å¾„ï¼›&lt;/li&gt;
&lt;li&gt;ç›¸å…³è®¾å¤‡æ˜¯äº¤æ¢æœºï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç½‘ç»œå±‚ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;æ•°æ®åŒ…å«packetï¼Œâ€œåŒ…â€ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;IPv4ï¼š32ä¸ªäºŒè¿›åˆ¶ï¼Œ4å­—èŠ‚*8ä½ï¼›IPv6ï¼š1åŒä¸€å­ç½‘28ä¸ªäºŒè¿›åˆ¶ï¼Œ8å­—èŠ‚*16ä½ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å­ç½‘æ©ç ä¸IPçš„andè¿ç®—åˆ¤æ–­æ˜¯å¦ä¸ºåŒä¸€å­ç½‘ä¸‹ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è·¯ç”±ï¼šæŠŠæ•°æ®ä»åŸåœ°å€è½¬å‘åˆ°ç›®æ ‡åœ°å€ï¼ŒåŒä¸€å±€åŸŸç½‘å†…ï¼Œé€šè¿‡å¹¿æ’­çš„æ–¹å¼æ‰¾åˆ°ï¼Œä¸åŒå±€åŸŸç½‘å†…ï¼ŒåŸä¸»æœºå…ˆå°†åŒ…æ ¹æ®ç½‘å…³æ·»åŠ è·¯ç”±å™¨/ä¸»æœºåœ°å€ï¼Œé€šè¿‡äº¤æ¢æœºçš„å¹¿æ’­æ–¹å¼å‘ç»™ç›®æ ‡ä¸»æœºï¼ŒåŸä¸»æœºå°†æ•°æ®åŒ…ä¼ è¾“ç»™ç›®æ ‡ä¸»æœºï¼Œå†ç”±ç›®æ ‡ä¸»æœºæ ¹æ®MACå¹¿æ’­äº¤ç»™å¯¹åº”ç›®æ ‡&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ping ipï¼Œä½¿ç”¨ICMPåè®®å¯ä»¥ç¡®è®¤ IP åŒ…æ˜¯å¦æˆåŠŸé€è¾¾ç›®æ ‡åœ°å€ã€æŠ¥å‘Šå‘é€è¿‡ç¨‹ä¸­ IP åŒ…è¢«åºŸå¼ƒçš„åŸå› å’Œæ”¹å–„ç½‘ç»œè®¾ç½®ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ARPåè®®ï¼šIPä¸MACåœ°å€çš„æ˜ å°„ï¼ŒARPä¼šåœ¨ä»¥å¤ªç½‘ä¸­ä»¥å¹¿æ’­çš„å½¢å¼ï¼Œè·å–IPå¯¹åº”çš„MACåœ°å€ï¼›&lt;/p&gt;
&lt;p&gt;ä»…é™IPv4ï¼ŒIPv6ä½¿ç”¨ Neighbor Discovery Protocolæ›¿ä»£ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç›¸å…³è®¾å¤‡æ˜¯è·¯ç”±å™¨ï¼Œç½‘å…³&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¼ è¾“å±‚ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;æ•°æ®åŒ…å«segmentï¼Œâ€œæ®µâ€ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Socketã€UDPã€TCPè§ä¸‹&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åº”ç”¨å±‚ä½¿ç”¨TCPä¼ è¾“æ•°æ®æ—¶ï¼Œä¼šå…ˆå°†æ•°æ®æ‰“åˆ°TCPçš„Segmentä¸­ï¼Œç„¶åTCPçš„Segmentä¼šæ‰“åˆ°IPçš„Packetä¸­ï¼Œç„¶åå†æ‰“åˆ°ä»¥å¤ªç½‘Ethernetçš„Frameä¸­ï¼Œä¼ è¾“åˆ°ç›®æ ‡ä¸»æœºåï¼Œå†ä¸€å±‚å±‚è§£æï¼Œå¾€ä¸Šä¼ é€’ã€‚&lt;/p&gt;
&lt;h1 id=&#34;ä»æµè§ˆå™¨è¾“å…¥urlä¹‹åéƒ½å‘ç”Ÿäº†ä»€ä¹ˆ&#34;&gt;ä»æµè§ˆå™¨è¾“å…¥URLä¹‹åéƒ½å‘ç”Ÿäº†ä»€ä¹ˆ&lt;/h1&gt;
&lt;p&gt;æµè§ˆå™¨è¾“å…¥URLï¼ŒæŒ‰å›è½¦ï¼Œ&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;æµè§ˆå™¨æ ¹æ®è¾“å…¥å†…å®¹ï¼ŒåŒ¹é…å¯¹åº”çš„URLå’Œå…³é”®è¯ï¼Œæ ¡éªŒURLçš„åˆæ³•æ€§ï¼Œä»å†å²è®°å½•ã€ä¹¦ç­¾ç­‰åœ°æ–¹ï¼Œæ‰¾åˆ°å¯èƒ½å¯¹åº”çš„URLï¼Œè¿›è¡Œè¡¥å…¨ï¼Œä½¿å…¶ç¬¦åˆé€šç”¨URIçš„è¯­æ³•ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å‘èµ·è¯·æ±‚ï¼Œä»URLä¸­è§£æå‡ºåŸŸåï¼Œé¦–å…ˆæŸ¥çœ‹æœ¬åœ°hostsæ–‡ä»¶ï¼Œåˆ¤æ–­æ˜¯å¦æœ‰è¿™ä¸ªåŸŸåå¯¹åº”çš„ipï¼Œå¦‚æœæ²¡æœ‰ï¼Œè¯·æ±‚æœ¬åœ°DNSæœåŠ¡å™¨ï¼Œå…ˆæŸ¥è¯¢æœ¬åœ°DNSæœåŠ¡çš„ç¼“å­˜ï¼Œå¦‚æœæ²¡æœ‰å†å‘ä¸Šçº§DNSæœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œé€’å½’æŸ¥è¯¢ï¼Œç›´åˆ°æ‰¾åˆ°å¯¹åº”çš„IPåœ°å€ï¼Œç„¶åæœ¬åœ°DNSæœåŠ¡å™¨å°±æŠŠå¯¹åº”å…³ç³»ä¿å­˜åœ¨ç¼“å­˜ä¸­&lt;/p&gt;
&lt;p&gt;æ³¨æ„æ ¹DNSæœåŠ¡å™¨æ²¡æœ‰è®°å½•å…·ä½“çš„åŸŸåå’ŒIPçš„å¯¹åº”å…³ç³»ï¼Œè€Œæ˜¯å‘Šè¯‰æœ¬åœ°DNSæœåŠ¡å™¨å¯ä»¥åˆ°åŸŸæœåŠ¡å™¨ä¸Šç»§ç»­æŸ¥è¯¢ï¼Œç»™å‡ºçš„æ˜¯åŸŸæœåŠ¡å™¨çš„åœ°å€ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ‹¿åˆ°åŸŸåå¯¹åº”çš„IPåï¼Œåº”ç”¨å±‚ç¨‹åºå‡†å¤‡å¥½æ•°æ®åï¼Œå§”æ‰˜ç»™æ“ä½œç³»ç»Ÿï¼Œå¤åˆ¶åº”ç”¨å±‚æ•°æ®åˆ°å†…æ ¸çš„å†…å­˜ç©ºé—´ä¸­ï¼Œäº¤ç»™ç½‘ç»œåè®®æ ˆï¼ˆå°†å…¶æ‰“åŒ…ä¸ºtcpåŒ…(ä¼ è¾“å±‚)ï¼Œå¸§(æ•°æ®é“¾è·¯å±‚)ï¼Œå¹¶å°†æ•°æ®ä»å†…æ ¸æ‹·è´åˆ°ç½‘å¡ï¼Œåç»­ç”±ç½‘å¡è´Ÿè´£æ•°æ®çš„å‘é€ï¼‰ï¼Œä¸WebæœåŠ¡å™¨å»ºç«‹ TCP/IP è¿æ¥ï¼ˆä¸‰æ¬¡æ¡æ‰‹å…·ä½“è¿‡ç¨‹ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å»ºç«‹è¿æ¥åï¼Œå‘èµ·ä¸€ä¸ªHTTP è¯·æ±‚ï¼Œç»è¿‡è·¯ç”±å™¨çš„è½¬å‘ï¼Œé€šè¿‡WebæœåŠ¡å™¨ï¼ˆCDNã€åå‘ä»£ç†ä¹‹ç±»çš„ï¼‰çš„é˜²ç«å¢™ï¼Œè¯¥ HTTP è¯·æ±‚åˆ°è¾¾äº†WebæœåŠ¡å™¨ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æœåŠ¡å™¨å¤„ç†è¯¥ HTTP è¯·æ±‚ï¼Œè¿”å›ä¸€ä¸ª HTML æ–‡ä»¶ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æµè§ˆå™¨è§£æè¯¥ HTML æ–‡ä»¶ï¼Œè§£æHTMLæ–‡ä»¶åï¼Œæ„å»ºdomæ ‘ -ã€‹æ„å»ºrenderæ ‘ -ã€‹å¸ƒå±€renderæ ‘ -ã€‹ç»˜åˆ¶ renderæ ‘ï¼Œè‡ªä¸Šè€Œä¸‹åŠ è½½ï¼Œè¾¹åŠ è½½è¾¹è§£ææ¸²æŸ“ï¼Œæ˜¾ç¤ºåœ¨æµè§ˆå™¨ç«¯ï¼Œå¯¹äºå›¾ç‰‡éŸ³é¢‘ç­‰åˆ™æ˜¯å¼‚æ­¥åŠ è½½ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æœ¬è´¨ä¸Šæ˜¯OSIä¸ƒå±‚æ¨¡å‹ + ç›¸åº”åè®®ã€ç»„ä»¶å®ç°ï¼›å»ºç«‹ä¸€æ¬¡TCPåï¼Œåœ¨HTTP 1.1è¯·æ±‚å¤´é…ç½®keep-alive=trueåï¼Œé»˜è®¤ä¿æŒä¸¤å°æ—¶çš„è¿æ¥ï¼Œå¯ä»¥ä¸€ç›´è¿›è¡Œhttpè¯·æ±‚ï¼Œä½†åŒæ—¶åªå¤„ç†ä¸€ä¸ªhttpè¯·æ±‚ï¼ŒHTTP 2.0æ‰å…è®¸å¹¶è¡Œå¤šä¸ªï¼›&lt;/p&gt;
&lt;h1 id=&#34;httpæ–¹æ³•&#34;&gt;HTTPæ–¹æ³•&lt;/h1&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;http://www.runoob.com/http/http-methods.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;èœé¸ŸHTTPæ•™ç¨‹/HTTPè¯·æ±‚æ–¹æ³•&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;getå’Œpostçš„åŒºåˆ«&#34;&gt;Getå’ŒPostçš„åŒºåˆ«&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;è¯­ä¹‰ä¸Šçš„åŒºåˆ«ï¼ŒGetä¸€èˆ¬è¡¨ç¤ºæŸ¥è¯¢ã€è·å–ï¼ŒPostæ˜¯æ›´æ–°ï¼Œåˆ›å»º&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Getå…·æœ‰å¹‚ç­‰æ€§ï¼ŒPostæ²¡æœ‰&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å‚æ•°ä¼ é€’æ–¹é¢ï¼ŒGetä¸€èˆ¬å‚æ•°æ¥åœ¨Urlä¸Šï¼Œå¯¹å¤–æš´éœ²ï¼Œæœ‰é•¿åº¦é™åˆ¶ï¼ˆ1024ä¸ªå­—èŠ‚å³256ä¸ªå­—ç¬¦ï¼‰ï¼Œåªæ¥æ”¶ASCIIå­—ç¬¦ï¼Œéœ€è¦è¿›è¡Œurlç¼–ç &lt;/p&gt;
&lt;p&gt;Postå‚æ•°æ”¾åœ¨request bodyé‡Œï¼Œæ”¯æŒå¤šç§ç¼–ç &lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;GETè¯·æ±‚ä¼šè¢«æµè§ˆå™¨ä¸»åŠ¨cacheï¼Œè€ŒPOSTä¸ä¼šï¼Œé™¤éæ‰‹åŠ¨è®¾ç½®&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;GETäº§ç”Ÿçš„URLåœ°å€å¯ä»¥åŠ å…¥ä¹¦ç­¾ï¼Œè€ŒPOSTä¸å¯ä»¥&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;GETè¯·æ±‚å‚æ•°ä¼šè¢«å®Œæ•´ä¿ç•™åœ¨æµè§ˆå™¨å†å²è®°å½•é‡Œï¼Œè€ŒPOSTä¸­çš„å‚æ•°ä¸ä¼šè¢«ä¿ç•™&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;GETåœ¨æµè§ˆå™¨å›é€€æ—¶æ˜¯æ— å®³çš„ï¼Œè€ŒPOSTä¼šå†æ¬¡æäº¤è¯·æ±‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å…¶å®æœ¬è´¨éƒ½æ˜¯ä¸€ç§åè®®çš„è§„èŒƒï¼Œè§„å®šå‚æ•°çš„å­˜æ”¾ä½ç½®ï¼Œå‚æ•°é•¿åº¦å¤§å°ç­‰ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥åç€æ¥ï¼Œåªè¦æœåŠ¡å™¨èƒ½å¤Ÿç†è§£å³å¯&lt;/p&gt;
&lt;p&gt;å¹‚ç­‰æ€§ï¼šåŒæ ·çš„è¯·æ±‚è¢«æ‰§è¡Œä¸€æ¬¡ä¸è¿ç»­æ‰§è¡Œå¤šæ¬¡çš„æ•ˆæœæ˜¯ä¸€æ ·çš„ï¼ŒæœåŠ¡å™¨çš„çŠ¶æ€ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œæ¯æ¬¡è¿”å›çš„ç»“æœä¸€æ ·ï¼Œä¸äº§ç”Ÿå‰¯ä½œç”¨ï¼›&lt;/p&gt;
&lt;p&gt;æ ¹æ®è¯­ä¹‰ï¼Œç®€å•çš„æŠŠgetçœ‹æˆæŸ¥è¯¢ï¼Œåªè¦æœåŠ¡å™¨çš„æ•°æ®æ²¡å˜ï¼Œæ¯æ¬¡æŸ¥è¯¢å¾—åˆ°çš„ç»“æœæ˜¯ä¸€æ ·çš„ï¼Œè€ŒæŠŠpostçœ‹æˆæ·»åŠ ï¼Œæ¯æ¬¡postè¯·æ±‚éƒ½ä¼šåˆ›å»ºæ–°èµ„æºï¼ŒæœåŠ¡å™¨çŠ¶æ€æ”¹å˜&lt;/p&gt;
&lt;p&gt;å…·æœ‰å¹‚ç­‰æ€§çš„æ–¹æ³•ï¼šGETã€HEADã€OPTIONSã€DELETEã€PUT&lt;/p&gt;
&lt;p&gt;æ²¡æœ‰å¹‚ç­‰æ€§çš„æ–¹æ³•ï¼šPOST&lt;/p&gt;
&lt;p&gt;å®‰å…¨æ€§ï¼šå®‰å…¨çš„ HTTP æ–¹æ³•ä¸ä¼šæ”¹å˜æœåŠ¡å™¨çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒåªæ˜¯å¯è¯»çš„ã€‚&lt;/p&gt;
&lt;h1 id=&#34;å¸¸è§çŠ¶æ€ç &#34;&gt;å¸¸è§çŠ¶æ€ç &lt;/h1&gt;
&lt;p&gt;å‚è€ƒ&lt;a class=&#34;link&#34; href=&#34;http://www.runoob.com/http/http-status-codes.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;HTTPçŠ¶æ€ç &lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;301ï¼šæ°¸ä¹…ç§»åŠ¨è¯·æ±‚çš„ç½‘é¡µå·²æ°¸ä¹…ç§»åŠ¨åˆ°æ–°ä½ç½®ï¼Œå³æ°¸ä¹…é‡å®šå‘ï¼›è¿”å›ä¿¡æ¯ä¼šåŒ…æ‹¬æ–°çš„URIï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨å®šå‘åˆ°æ–°URIã€‚ä»Šåä»»ä½•æ–°çš„è¯·æ±‚éƒ½åº”ä½¿ç”¨æ–°çš„URIä»£æ›¿ï¼Œæ–°çš„URIä¼šæ”¾åœ¨å“åº”headerçš„Locationå­—æ®µä¸­ï¼›æœç´¢å¼•æ“ä¼šæŠ“å–æ–°å†…å®¹åŒæ—¶ä¹Ÿå°†æ—§åœ°å€ä¿®æ”¹ä¸ºæ–°åœ°å€ã€‚301è°ƒæ•´é»˜è®¤ä¼šè¢«æµè§ˆå™¨cacheï¼Œç”¨æˆ·åç»­å¤šæ¬¡è®¿é—®è¯¥urlæ—¶ä¼šï¼Œæµè§ˆå™¨ä¼šç›´æ¥è¯·æ±‚è·³è½¬åœ°å€ã€‚&lt;/li&gt;
&lt;li&gt;302ï¼šä¸´æ—¶ç§»åŠ¨è¯·æ±‚çš„ç½‘é¡µæš‚æ—¶è·³è½¬åˆ°å…¶ä»–é¡µé¢ï¼Œå³æš‚æ—¶é‡å®šå‘ï¼›æ—§åœ°å€çš„èµ„æºè¿˜åœ¨ï¼Œåªæ˜¯é‡å®šå‘åˆ°ä¸´æ—¶çš„æ–°åœ°å€ä¸­ï¼Œå¯¹SEOæœ‰åˆ©ï¼Œæœç´¢å¼•æ“ä¼šæŠ“å–æ–°å†…å®¹ä¿å­˜æ—§åœ°å€ã€‚å¦‚æœåœ¨å“åº”å¤´ä¸­é€šè¿‡Cache-Controlæˆ–Expiresï¼Œä¹Ÿå¯ä»¥å®ç°301ä¸­æµè§ˆå™¨ç¼“å†²çš„æ•ˆæœã€‚&lt;/li&gt;
&lt;li&gt;405ï¼šè¯·æ±‚çš„Methodè¢«ç¦æ­¢ï¼Œæ¯”å¦‚Postçš„æ¥å£ç”¨æˆäº†Get&lt;/li&gt;
&lt;li&gt;502ï¼šBad Gatewayï¼Œä½œä¸ºç½‘å…³æˆ–è€…ä»£ç†å·¥ä½œçš„æœåŠ¡å™¨å°è¯•æ‰§è¡Œè¯·æ±‚æ—¶ï¼Œä»ä¸Šæ¸¸æœåŠ¡å™¨æ¥æ”¶åˆ°æ— æ•ˆçš„å“åº”&lt;/li&gt;
&lt;li&gt;503ï¼šService Unavailableï¼ŒæœåŠ¡ä¸å¯ç”¨&lt;/li&gt;
&lt;li&gt;504ï¼šGateway Time-outï¼Œå……å½“ç½‘å…³æˆ–ä»£ç†çš„æœåŠ¡å™¨ï¼ŒæœªåŠæ—¶ä»ä¸Šæ¸¸æœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;httpå¤´&#34;&gt;HTTPå¤´&lt;/h1&gt;
&lt;h2 id=&#34;connection-keep-alive&#34;&gt;Connection: keep-alive&lt;/h2&gt;
&lt;p&gt;ä¿æŒé•¿è¿æ¥ï¼Œè¿æ¥å¤ç”¨ï¼Œé¿å…é¢‘ç¹å»ºç«‹è¿æ¥å¸¦æ¥çš„æ€§èƒ½æŸè€—ã€‚HTTP1.0é»˜è®¤æ˜¯å…³é—­çš„ï¼ŒHTTP1.1é»˜è®¤æ˜¯å¼€å¯çš„ã€‚å¯¹åº”çš„keyæ˜¯Connectionã€‚å¯ä»¥è®¾ç½®å‚æ•°&lt;code&gt;Keep-Alive: max=5, timeout=120&lt;/code&gt;è¡¨ç¤ºä¸€æ¬¡keep-aliveå¯ä»¥å‘é€çš„è¯·æ±‚æ¬¡æ•°æ˜¯5ï¼Œè¿æ¥ä¿æŒæ—¶é—´æ˜¯120sï¼Œ&lt;strong&gt;é»˜è®¤æ˜¯2å°æ—¶&lt;/strong&gt;ï¼Œå¯ä»¥ä¸€ç›´è¿›è¡ŒHTTPè¯·æ±‚ï¼Œä½†&lt;strong&gt;ä¸€ä¸ªTCPè¿æ¥åŒä¸€æ—¶é—´åªæ”¯æŒä¸€ä¸ªHTTPè¯·æ±‚&lt;/strong&gt;ï¼Œå³ä¸€æ¬¡è¿æ¥ä¸­ï¼Œè¯·æ±‚æ˜¯ä¸€ä¸ªä¸ªå¤„ç†çš„ï¼Œå¦‚æœå‰ä¸€ä¸ªæ²¡å¤„ç†å®Œï¼Œæ²¡åŠæ³•å¤„ç†ä¸‹ä¸€ä¸ªï¼Œä¹Ÿå°±æ˜¯ä¸‹ä¸€ä¸ªä¸è¿”å›ã€‚&lt;/p&gt;
&lt;p&gt;ä¸åŒçš„æµè§ˆå™¨å¯¹åŒä¸€Hostå»ºç«‹çš„TCPè¿æ¥æ•°é‡çš„é™åˆ¶å–å†³äºæµè§ˆå™¨æœ¬èº«ï¼ŒåƒChromeæœ€å¤šå…è®¸åŒæ—¶å»ºç«‹6ä¸ªTCPè¿æ¥ï¼Œå‡å¦‚ä¸€ä¸ªHTMLé¡µé¢æœ‰å¾ˆå¤šå›¾ç‰‡éœ€è¦åŠ è½½ï¼Œä¸”è¿™äº›å›¾ç‰‡éƒ½æ˜¯åŒä¸€Hostï¼Œä¸”HTTPsï¼Œé‚£æµè§ˆå™¨åœ¨TLS åä¼šå’ŒæœåŠ¡å™¨ç¡®è®¤æ˜¯å¦å¯ç”¨HTTP2ï¼Œå¦‚æœå¯ç”¨å°±å¯ä»¥åŒä¸€è¿æ¥ä¸‹åŒæ—¶ä¸‹è½½å¤šä¸ªï¼Œå¦‚æœä¸å¯ç”¨ï¼Œå°±ä»ç„¶ç”¨é‚£å‡ ä¸ªè¿æ¥ï¼Œæ’é˜Ÿå»ç­‰äº†ã€‚&lt;/p&gt;
&lt;p&gt;å¦å¤–å¤šä¸ªHTTPè¿æ¥ï¼Œæ˜¯å¯ä»¥å»ºç«‹åœ¨ä¸€ä¸ªTCPè¿æ¥ä¸Šçš„ã€‚&lt;/p&gt;
&lt;p&gt;ä¸TCPçš„keep-aliveä¸åŒï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;TCP çš„ keep-alive æ˜¯ç”±æ“ä½œç³»ç»Ÿå†…æ ¸æ¥æ§åˆ¶ï¼Œå­˜åœ¨äºå†…æ ¸æ€ï¼Œé€šè¿‡ &lt;code&gt;keep-alive&lt;/code&gt; æŠ¥æ–‡æ¥é˜²æ­¢ TCP è¿æ¥è¢«å¯¹ç«¯ã€é˜²ç«å¢™æˆ–å…¶ä»–ä¸­é—´è®¾å¤‡æ„å¤–ä¸­æ–­ï¼Œä¸»è¦çš„ä½œç”¨æ˜¯ä¿æ´»ï¼Œå’Œä¸Šå±‚åº”ç”¨æ²¡æœ‰ä»»ä½•å…³ç³»ï¼Œåªè´Ÿè´£ç»´æŠ¤å•ä¸ª TCP è¿æ¥çš„çŠ¶æ€ï¼Œå…¶ä¸Šå±‚åº”ç”¨å¯ä»¥å¤ç”¨è¯¥ TCP é•¿è¿æ¥ï¼Œä¹Ÿå¯ä»¥å…³é—­è¯¥ TCP é•¿è¿æ¥ã€‚&lt;/li&gt;
&lt;li&gt;HTTP çš„ keep-aliveæ˜¯ç”±åº”ç”¨å±‚æ§åˆ¶ï¼Œå­˜åœ¨äºç”¨æˆ·æ€ï¼Œ æœºåˆ¶åˆ™æ˜¯å’Œè‡ªå·±çš„ä¸šåŠ¡å¯†åˆ‡ç›¸å…³çš„ï¼Œæµè§ˆå™¨é€šè¿‡å¤´éƒ¨å‘ŠçŸ¥æœåŠ¡å™¨è¦&lt;strong&gt;å¤ç”¨è¿™ä¸ª TCP è¿æ¥ï¼Œè¯·ä¸è¦éšæ„å…³é—­&lt;/strong&gt;ã€‚åªæœ‰åˆ°äº† &lt;code&gt;keep-alive&lt;/code&gt; å¤´éƒ¨è§„å®šçš„ &lt;code&gt;timeout&lt;/code&gt; æ‰ä¼šå…³é—­è¯¥ TCP è¿æ¥ï¼Œä¸è¿‡è¿™å…·ä½“ä¾èµ–åº”ç”¨æœåŠ¡å™¨ï¼Œåº”ç”¨æœåŠ¡å™¨ä¹Ÿå¯ä»¥æ ¹æ®è‡ªå·±çš„è®¾ç½®åœ¨å“åº”åä¸»åŠ¨å…³é—­è¿™ä¸ª TCP è¿æ¥ï¼Œåªè¦åœ¨å“åº”çš„æ—¶å€™æºå¸¦ &lt;code&gt;Connection: Close&lt;/code&gt; å‘ŠçŸ¥å¯¹æ–¹&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä½†æ˜¯å¯è§ï¼Œä¸¤ç§keep-aliveéƒ½æ˜¯ä¸ºäº†è¿æ¥å¤ç”¨&lt;/p&gt;
&lt;h2 id=&#34;content-length&#34;&gt;Content-Length&lt;/h2&gt;
&lt;p&gt;è¡¨ç¤ºæœ¬æ¬¡å“åº”çš„æ•°æ®é•¿åº¦ï¼Œåé¢çš„å­—èŠ‚å°±å±äºä¸‹ä¸€ä¸ªå“åº”çš„äº†ï¼Œå› ä¸ºHTTPæ˜¯åŸºäºTCPè¿›è¡Œé€šä¿¡çš„ï¼Œåº”ç”¨å±‚éœ€è¦è§£å†³ç²˜åŒ…çš„é—®é¢˜ï¼ŒHTTPä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæœ‰ä¸¤ç§è§£å†³æ–¹æ¡ˆï¼š1. è®¾ç½®Content-Lengthä½œä¸ºå“åº”çš„è¾¹ç•Œï¼›2. å“åº”ä½“è®¾ç½®å›è½¦ç¬¦ã€æ¢è¡Œç¬¦ä½œä¸ºå“åº”çš„è¾¹ç•Œï¼Œå¸¸è§äº&lt;code&gt;Transfer-Encoding=chunked&lt;/code&gt;&lt;/p&gt;
&lt;h2 id=&#34;upgrade&#34;&gt;Upgrade&lt;/h2&gt;
&lt;p&gt;ä¸€èˆ¬æ˜¯ç”¨äºåè®®å‡çº§ï¼Œæ¯”å¦‚WebSocketï¼Œæµè§ˆå™¨ä¸æœåŠ¡å™¨ä½¿ç”¨WebSocketé€šä¿¡æ—¶ï¼Œä¼šå…ˆé€šè¿‡æ™®é€šçš„HTTPå»ºç«‹è¿æ¥ï¼Œåœ¨è¯·æ±‚å¤´é‡Œå¸¦ä¸Š&lt;code&gt;Upgrade: WebSocket; Connection: Upgrade; Sec-WebSocket-Key: éšæœºç”Ÿæˆçš„base64ç &lt;/code&gt;ï¼Œå‘é€ç»™æœåŠ¡å™¨ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœæœåŠ¡å™¨æ”¯æŒWebSocketåè®®ï¼Œå°±ä¼šèµ°WebSocketæ¡æ‰‹æµç¨‹ï¼Œæ ¹æ®å®¢æˆ·ç«¯ç”Ÿæˆçš„basae64ç ï¼Œä½¿ç”¨å…¬é’¥å˜æˆå¦ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ”¾åœ¨&lt;code&gt;Set-WebSocket-Accept&lt;/code&gt;å“åº”å¤´ä¸­ï¼Œå¹¶å¸¦ä¸Š101å“åº”ç ï¼Œè¡¨ç¤ºåè®®åˆ‡æ¢ï¼Œè¦å»ºç«‹èµ·WebSocketè¿æ¥ã€‚&lt;/p&gt;
&lt;h2 id=&#34;httpç¼“å­˜&#34;&gt;HTTPç¼“å­˜&lt;/h2&gt;
&lt;p&gt;å¯¹äºä¸€äº›é‡å¤æ€§çš„HTTPè¯·æ±‚ï¼Œæ¯”å¦‚æ¯æ¬¡è¯·æ±‚å¾—åˆ°çš„æ•°æ®éƒ½æ˜¯ä¸€æ ·çš„ï¼Œå°±å¯ä»¥æŠŠè¿™å¯¹è¯·æ±‚å“åº”ç¼“å­˜åœ¨æœ¬åœ°ï¼Œä»è€Œæå‡æ€§èƒ½ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å¼ºåˆ¶ç¼“å­˜&#34;&gt;å¼ºåˆ¶ç¼“å­˜&lt;/h3&gt;
&lt;p&gt;ç”±ä¸¤ä¸ªå“åº”å¤´å­—æ®µå®ç°ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;Cache-Control: å€¼å¯ä»¥æ˜¯max-age=xç§’ï¼Œæˆ–è€… s-maxage=xç§’ï¼ˆä»£ç†ç¼“å­˜ï¼Œå¦‚CDNï¼‰ï¼Œæˆ–è€…publicã€privateè¡¨ç¤ºç¼“å­˜æ˜¯å¦å…±äº«ï¼Œæˆ–è€…no-cacheè¡¨æ˜ä¸ç¼“å­˜ï¼Œæˆ–è€…no-storeè¡¨ç¤ºç¦æ­¢ç¼“å­˜&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;Expires: å€¼å¯ä»¥æ˜¯ max-age+è¯·æ±‚æ—¶é—´ï¼Œä½†éœ€è¦é…åˆLast-modifiedä½¿ç”¨ï¼Œæˆ–è€…ç›´æ¥æ˜¯ç»å¯¹æ—¶é—´ï¼Œè¡¨ç¤ºç¼“å­˜ä»€ä¹ˆæ—¶å€™åˆ°æœŸ&lt;/code&gt;ï¼Œ&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;code&gt;Cache-Control&lt;/code&gt;çš„ä¼˜å…ˆçº§é«˜äº&lt;code&gt;Expires&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;å®¢æˆ·ç«¯æ¥æ”¶åˆ°çš„å“åº”å¤´åŒ…æ‹¬è¿™ä¸¤ä¸ªå­—æ®µä¸­çš„ä¸€ä¸ªæ—¶ï¼Œåœ¨ä¹‹åçš„æ—¶é—´é‡Œå°±ä¸ä¼šå»è¯·æ±‚æœåŠ¡ç«¯è·å–æ•°æ®ï¼Œç›´æ¥ä½¿ç”¨æœ¬åœ°ç¼“å­˜ï¼Œæœ¬åœ°ç¼“å­˜ä¸€èˆ¬æ˜¯ç›´æ¥å­˜åœ¨ç£ç›˜ï¼Œå“åº”ç åé¢ä¼šç›´æ¥æ ‡è¯† &lt;code&gt;200ï¼ˆfrom dish cacheï¼‰&lt;/code&gt;&lt;/p&gt;
&lt;h3 id=&#34;åå•†ç¼“å­˜&#34;&gt;åå•†ç¼“å­˜&lt;/h3&gt;
&lt;p&gt;å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯åå•†ï¼Œæ ¹æ®ç»“æœåˆ¤æ–­æ˜¯å¦ä½¿ç”¨æœ¬åœ°ç¼“å­˜ï¼Œæœ‰ä¸¤ç§å¤´éƒ¨&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;è¯·æ±‚å¤´ä¸­çš„If-Modified-Sinceï¼Œè¡¨ç¤ºç”¨æ¥ä¸å“åº”èµ„æºæ¯”è¾ƒï¼Œåˆ¤æ–­æ˜¯å¦ç¼“å­˜æ˜¯å¦è¢«ä¿®æ”¹è¿‡ï¼Œå•ä½æ˜¯ç§’&lt;/code&gt;é…åˆ&lt;code&gt;å“åº”å¤´ä¸­çš„Last-Modifiedï¼Œè¡¨ç¤ºå“åº”èµ„æºçš„æœ€åä¿®æ”¹æ—¶é—´ï¼Œå•ä½æ˜¯ç§’&lt;/code&gt;å­—æ®µå®ç°ï¼Œå¦‚æœç¼“å­˜è¢«ä¿®æ”¹è¿‡ï¼Œè¿”å›&lt;code&gt;HTTP 200&lt;/code&gt;ï¼Œå¦‚æœæ²¡è¢«ä¿®æ”¹è¿‡ï¼Œè¿”å›&lt;code&gt;HTTP 304&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;å“åº”å¤´ä¸­çš„ETagï¼Œè¡¨ç¤ºç¼“å­˜å“åº”æ ‡è¯†&lt;/code&gt;é…åˆ&lt;code&gt;è¯·æ±‚å¤´ä¸­çš„If-None-Matchï¼Œè¡¨ç¤ºèµ„æºè¿‡æœŸæ—¶ï¼Œå¦‚æœå“åº”å¤´é‡Œæœ‰Etagï¼Œåˆ™å†æ¬¡å‘æœåŠ¡å™¨å‘èµ·è¯·æ±‚æ—¶ï¼Œä¼šè®¾ç½®If-None-Matchçš„å€¼ä½Etag&lt;/code&gt;ï¼ŒæœåŠ¡å™¨ä¼šå¯¹æ¯”&lt;code&gt;If-None-Match&lt;/code&gt;çš„å€¼ï¼Œå¦‚æœæœ‰ç¼“å­˜æœ‰ä¿®æ”¹ï¼Œè¿”å›304ï¼Œå¦åˆ™è¿”å›200&lt;/p&gt;
&lt;p&gt;&lt;code&gt;ETag&lt;/code&gt;çš„ä¼˜å…ˆçº§é«˜äº&lt;code&gt;Last-Modified&lt;/code&gt;ï¼ŒETagå¯ä»¥è§£å†³é‚£ç§æ–‡ä»¶å†…å®¹ä¸å˜ï¼Œä½†æ–‡ä»¶ä¿®æ”¹æ—¶é—´æ”¹å˜çš„åœºæ™¯ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;https&#34;&gt;HTTPS&lt;/h1&gt;
&lt;p&gt;HTTPSä¸»è¦è§£å†³HTTPçš„å®‰å…¨é—®é¢˜ï¼Œå¦‚æŠ¥æ–‡å†…å®¹å®‰å…¨ï¼ˆåŠ å¯†è§£å†³ï¼‰ï¼Œé˜²ç¯¡æ”¹ï¼ˆç­¾åè§£å†³ï¼‰ï¼Œé˜²å†’å……ï¼ˆCAè®¤è¯è§£å†³ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;HTTPS = HTTP + SSL/TLSï¼ŒSSLæ˜¯ä»‹äºHTTPä¹‹ä¸‹TCPä¹‹ä¸Šçš„åè®®å±‚ï¼Œæä¾› åŠ å¯†æ˜æ–‡ï¼ŒéªŒè¯èº«ä»½ï¼Œä¿è¯æŠ¥æ–‡å®Œæ•´ çš„ä¿éšœã€‚TLSæ˜¯å‡çº§ç‰ˆçš„SSLï¼Œä½œç”¨ç±»ä¼¼ï¼Œæ¯”SSLå¤šäº†äº›å…¶ä»–åŠŸèƒ½ï¼Œç°åœ¨ç»å¤§å¤šæ•°æµè§ˆå™¨éƒ½ä¸æ”¯æŒSSLäº†ï¼Œè€Œæ˜¯æ”¯æŒTLSã€‚&lt;/p&gt;
&lt;p&gt;HTTP å…ˆå’Œ TLS é€šä¿¡ï¼Œå†ç”± TLS å’Œ TCP é€šä¿¡ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒTLSéœ€è¦å…ˆç»è¿‡TCPä¸‰æ¬¡æ¡æ‰‹ï¼Œå»ºç«‹å¯é è¿æ¥ä¹‹åï¼Œæ‰èƒ½åšTLSæ¡æ‰‹çš„äº‹ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;åŠ å¯†&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ å¯¹ç§°åŠ å¯† åŠ å¯† æŠ¥æ–‡ï¼ˆç§é’¥åŠ å¯†ç§é’¥è§£å¯†ï¼‰&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ éå¯¹ç§°åŠ å¯† åŠ å¯† å¯¹ç§°åŠ å¯†çš„å¯†é’¥ï¼Œä¿è¯è¯¥å¯†é’¥çš„ä¼ è¾“å®‰å…¨ï¼ˆå®¢æˆ·ç«¯å…¬é’¥åŠ å¯†ï¼ŒæœåŠ¡ç«¯ç§é’¥è§£å¯†ï¼›æˆ–è€… æœåŠ¡ç«¯ç§é’¥åŠ å¯†ï¼Œå®¢æˆ·ç«¯å…¬é’¥è§£å¯†ï¼‰&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;éªŒè¯èº«ä»½&lt;/p&gt;
&lt;p&gt;é€šè¿‡ç¬¬ä¸‰æ–¹ï¼ˆCAï¼‰å‘å¸ƒTLS è¯ä¹¦ï¼Œå¯¹é€šä¿¡æ–¹è¿›è¡Œè®¤è¯&lt;/p&gt;
&lt;p&gt;æœåŠ¡å™¨çš„è¿è¥äººå‘˜å‘ CA æå‡ºå…¬å¼€å¯†é’¥çš„ç”³è¯·ï¼ŒCA åœ¨åˆ¤æ˜æå‡ºç”³è¯·è€…çš„èº«ä»½ä¹‹åï¼Œä¼šå¯¹å·²ç”³è¯·çš„å…¬å¼€å¯†é’¥åšæ•°å­—ç­¾åï¼Œç„¶ååˆ†é…è¿™ä¸ªå·²ç­¾åçš„å…¬å¼€å¯†é’¥ï¼Œå¹¶å°†è¯¥å…¬å¼€å¯†é’¥æ”¾å…¥å…¬å¼€å¯†é’¥è¯ä¹¦åç»‘å®šåœ¨ä¸€èµ·ã€‚&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥è¿™é‡Œæ¶‰åŠåˆ°ä¸¤ä¸ªå…¬é’¥ï¼Œä¸€ä¸ªæ˜¯æœåŠ¡ç«¯ç”¨äº TLS çš„å…¬é’¥ï¼Œä¸€ä¸ªæ˜¯CAè¯ä¹¦çš„å…¬é’¥ï¼›&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥ï¼Œ&lt;strong&gt;TLS è¯ä¹¦ä¸»è¦æ˜¯è¡¨æ˜äº†è¯¥åŸŸåå½’å±ï¼Œæ—¥æœŸç­‰ä¿¡æ¯ï¼Œè¿˜åŒ…å«äº†ç”¨äºæŠ¥æ–‡åŠ å¯†çš„å…¬é’¥å’Œç§é’¥ä»¥åŠæ•°å­—ç­¾åï¼ŒTLS è¯ä¹¦è¢«æœåŠ¡ç«¯æŒæœ‰&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;è¿›è¡Œ HTTPs é€šä¿¡æ—¶ï¼ŒæœåŠ¡å™¨ä¼šæŠŠè¯ä¹¦å‘é€ç»™å®¢æˆ·ç«¯ã€‚å®¢æˆ·ç«¯å–å¾—å…¶ä¸­çš„å…¬å¼€å¯†é’¥ä¹‹åï¼Œå…ˆä½¿ç”¨æ•°å­—ç­¾åè¿›è¡ŒéªŒè¯ï¼Œå¦‚æœéªŒè¯é€šè¿‡ï¼Œå°±å¯ä»¥å¼€å§‹é€šä¿¡äº†ï¼Œé€šä¿¡æ—¶ä½¿ç”¨ä¸Šè¿°çš„åŠ å¯†æœºåˆ¶ä¿æŠ¤æŠ¥æ–‡ï¼›&lt;/p&gt;
&lt;p&gt;è¯ä¹¦ä¿¡ä»»çš„æ–¹å¼ï¼šæ“ä½œç³»ç»Ÿå’Œæµè§ˆå™¨å†…ç½®ï¼›CAé¢å‘ï¼›æ‰‹åŠ¨å¯¼å…¥è¯ä¹¦&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¿æŠ¤æŠ¥æ–‡å®Œæ•´&lt;/p&gt;
&lt;p&gt;TLS æä¾›&lt;strong&gt;æŠ¥æ–‡æ‘˜è¦&lt;/strong&gt;åŠŸèƒ½ï¼ˆå³ç­¾åï¼‰ç»“åˆåŠ å¯†å’Œè®¤è¯æ¥è¿›è¡Œå®Œæ•´æ€§ä¿æŠ¤&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;åœ¨HTTPçš„åŸºç¡€ä¸Šï¼Œä»¥TLS 1.2ç‰ˆæœ¬ä¸ºä¾‹ï¼ŒRSAç®—æ³•çš„æ¡æ‰‹æµç¨‹ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;å®¢æˆ·ç«¯è®¿é—®æœåŠ¡ç«¯çš„ç½‘é¡µï¼Œé¦–å…ˆç»è¿‡æµè§ˆå™¨å†…ç½®çš„å—ä¿¡ä»»çš„CAæœºæ„åˆ—è¡¨ï¼ŒæŸ¥çœ‹è¯¥æœåŠ¡å™¨æ˜¯å¦å‘CAæœºæ„æä¾›äº†è¯ä¹¦ï¼›CAä¼šå¯¹æœåŠ¡ç«¯æä¾›çš„å…¬é’¥å’ŒæœåŠ¡ç«¯çš„ç›¸å…³ä¿¡æ¯è¿›è¡ŒHashï¼Œç„¶åç”¨CAçš„ç§é’¥è¿›è¡Œç­¾åï¼Œå°†ç­¾åçš„å…¬é’¥å’ŒæœåŠ¡ç«¯æä¾›çš„å…¬é’¥å’Œä¿¡æ¯ä¸€èµ·æ•´æˆä¸€ä»½è¯ä¹¦ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¦‚æœæœåŠ¡å™¨è¯ä¹¦ä¸­çš„ä¿¡æ¯ä¸å½“å‰æ­£åœ¨è®¿é—®çš„ç½‘ç«™ï¼ˆåŸŸåç­‰ï¼‰ä¸€è‡´ï¼Œé‚£ä¹ˆæµè§ˆå™¨å°±è®¤ä¸ºæœåŠ¡ç«¯æ˜¯å¯ä¿¡çš„ï¼Œå¹¶ä»æœåŠ¡å™¨è¯ä¹¦ä¸­å–å¾—æœåŠ¡å™¨å…¬é’¥ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¦‚æœè¿˜æ²¡æœ‰å–å¾—æœåŠ¡å™¨ä¸­çš„è¯ä¹¦ï¼Œåˆ™ä¸æœåŠ¡å™¨å»ºç«‹TCPè¿æ¥ï¼Œä¹‹åå¼€å§‹TLSçš„æµç¨‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€è¯·æ±‚ï¼ŒæŠŠè‡ªå·±æ”¯æŒçš„TLSç‰ˆæœ¬ï¼ŒåŠ å¯†å¥—ä»¶ã€ä¸€ä¸ªéšæœºæ•° å‘ç»™æœåŠ¡ç«¯ï¼›&lt;/li&gt;
&lt;li&gt;æœåŠ¡ç«¯æ”¶åˆ°è¯·æ±‚åï¼Œç¡®è®¤å®¢æˆ·ç«¯çš„TLSç‰ˆæœ¬ï¼ŒåŠ å¯†å¥—ä»¶ï¼Œç„¶åä¹Ÿç”Ÿæˆä¸€ä¸ªéšæœºæ•°ï¼Œä¸è¯ä¹¦å’Œå…¬é’¥ä¸€èµ·å‘ç»™å®¢æˆ·ç«¯ï¼›&lt;/li&gt;
&lt;li&gt;å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡ç«¯çš„è¯ä¹¦ã€å…¬é’¥ï¼Œéœ€è¦éªŒè¯è¯¥è¯ä¹¦æ˜¯å¦çœŸå®æœ‰æ•ˆï¼šå…ˆé€šè¿‡æµè§ˆå™¨æˆ–æ“ä½œç³»ç»Ÿå†…ç½®çš„æ‹¿åˆ°CAè¯ä¹¦ï¼Œä½¿ç”¨CAè¯ä¹¦çš„å…¬é’¥å¯¹CAè¯ä¹¦è¿›è¡Œè§£å¯†ï¼Œå¾—åˆ°çš„CAè¯ä¹¦çš„Hashå€¼ï¼Œç„¶åä¸ä»æœåŠ¡ç«¯æ”¶åˆ°çš„è¯ä¹¦çš„Hashå€¼è¿›è¡Œæ¯”è¾ƒï¼Œåˆ¤æ–­æ˜¯å¦ä¸€è‡´ï¼Œä¸€è‡´è¯´æ˜æœåŠ¡ç«¯å¯ä¿¡ï¼›&lt;/li&gt;
&lt;li&gt;å®¢æˆ·ç«¯åœ¨éªŒè¯æœåŠ¡ç«¯çš„è¯ä¹¦æ˜¯æœ‰æ•ˆçš„ä¹‹åï¼Œå†ç”Ÿæˆä¸€ä¸ªéšæœºæ•°ï¼ˆä¹Ÿç§°é¢„ä¸»å¯†é’¥ï¼‰ï¼Œä½¿ç”¨åˆšåˆšæ”¶åˆ°çš„æœåŠ¡ç«¯å…¬é’¥è¿›è¡ŒåŠ å¯†åå‘é€å‡ºå»ï¼›&lt;/li&gt;
&lt;li&gt;æœåŠ¡ç«¯æ”¶åˆ°é¢„ä¸»å¯†é’¥åï¼Œç”¨ç§é’¥è¿›è¡Œè§£å¯†ï¼Œå¾—åˆ°é¢„ä¸»å¯†é’¥çš„å€¼ï¼›&lt;/li&gt;
&lt;li&gt;æœ€åï¼Œå®¢æˆ·ç«¯ç”¨é¢„ä¸»å¯†é’¥ï¼Œä½¿ç”¨ç¬¬1æ­¥å’Œç¬¬2æ­¥çš„éšæœºæ•°è®¡ç®—å‡ºä¼šè¯å¯†é’¥ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å»ºç«‹ä¼šè¯å¯†é’¥ï¼šå®¢æˆ·ç«¯é€šè¿‡æœåŠ¡å™¨å…¬é’¥åŠ å¯†ä¼šè¯å¯†é’¥å‘é€ç»™æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯ç”¨è‡ªå·±ç§é’¥è§£å¯†å¾—åˆ°ä¼šè¯å¯†é’¥ï¼Œç”¨äºæ¥æ”¶å’Œå‘é€æ•°æ®ï¼Œä¹‹åä¼ è¾“çš„httpæ•°æ®éƒ½æ˜¯ç»è¿‡åŠ å¯†çš„ã€‚&lt;/p&gt;
&lt;p&gt;æ¯ä¸ªä¼šè¯ä¼šç”Ÿæˆä¸€ä¸ªä¼šè¯å¯†é’¥ï¼Œæ¯ä¸ªä¼šè¯çš„ä¼šè¯å¯†é’¥å‡ä¸åŒã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æ€»ç»“ï¼šéå¯¹ç§°åŠ å¯†çš„æ‰‹æ®µä¼ é€’å¯†é’¥ï¼Œç„¶åç”¨å¯†é’¥è¿›è¡Œå¯¹ç§°åŠ å¯†ä¼ é€’æ•°æ®ï¼Œå¯¹ç§°åŠ å¯†çš„å¯†é’¥ç”±å®¢æˆ·ç«¯ç”Ÿæˆï¼Œæ¯æ¬¡ä¼šè¯å¯†é’¥éƒ½ä¸ä¸€æ ·ï¼ŒCAä¼šä¿å­˜æœåŠ¡ç«¯æä¾›çš„éå¯¹ç§°åŠ å¯†çš„å…¬é’¥å¹¶ç­¾åï¼›&lt;/p&gt;
&lt;p&gt;è¿‡ç¨‹ä¸­ï¼Œå®¢æˆ·ç«¯ä¼šäº§ç”Ÿä¸¤ä¸ªéšæœºæ•°ï¼Œç¬¬ä¸€ä¸ªç”¨äºåˆ¶ä½œä¼šè¯å¯†é’¥(å¯¹æŠ¥æ–‡åšå¯¹ç§°åŠ å¯†æ—¶ä½¿ç”¨)ï¼Œç¬¬äºŒä¸ªç”¨äºéªŒè¯å…¬é’¥æ˜¯å¦å¯ç”¨ï¼›æœåŠ¡ç«¯ä¼šç”Ÿæˆä¸€ä¸ªéšæœºæ•°ï¼Œç»™å®¢æˆ·ç«¯åˆ¶ä½œä¼šè¯å¯†é’¥ï¼›&lt;/p&gt;
&lt;h1 id=&#34;rsaéå¯¹ç§°åŠ å¯†&#34;&gt;RSAéå¯¹ç§°åŠ å¯†&lt;/h1&gt;
&lt;p&gt;ä¾‹å­ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;å…¬é’¥ä¸ºï¼ˆ7ï¼Œ33ï¼‰
å‡è®¾æºæ•°æ®ç¿»è¯‘æˆåè¿›åˆ¶ä¸ºï¼š3ï¼Œ1ï¼Œ15
å¯¹å…¶æ±‚7æ¬¡å¹‚ä¸ºï¼š2187ï¼Œ1ï¼Œ170859375
å¯¹å…¶æ±‚33çš„ä½™ï¼š9ï¼Œ1ï¼Œ27
å¾—åˆ°å¯†æ–‡ï¼š9ï¼Œ1ï¼Œ27

ç§é’¥ä¸ºï¼ˆ3ï¼Œ33ï¼‰
å¾—åˆ°å¯†æ–‡ï¼š9ï¼Œ1ï¼Œ27
å¯¹å…¶æ±‚3æ¬¡å¹‚ä¸ºï¼š729ï¼Œ1ï¼Œ19683
å¯¹å…¶æ±‚33çš„ä½™ï¼š3ï¼Œ1ï¼Œ15
å¾—åˆ°æ˜æ–‡ï¼š3ï¼Œ1ï¼Œ15

è®¾å…¬é’¥ä¸ºï¼ˆe,nï¼‰ï¼Œç§é’¥ä¸ºï¼ˆd,nï¼‰
å³ æ˜æ–‡^e%n=å¯†æ–‡ï¼Œå¯†æ–‡^d%n=æ˜æ–‡
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;å…¬é’¥å’Œç§é’¥çš„åˆ¶ä½œè¿‡ç¨‹&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ç”Ÿæˆä¸¤ä¸ªè´¨æ•°ï¼špå’Œq&lt;/li&gt;
&lt;li&gt;ä¸¤ä¸ªè´¨æ•°ç›¸ä¹˜ï¼šN = p * q&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨æ¬§æ‹‰å‡½æ•°è®¡ç®—ï¼šT = (p-1) * (q-1)&lt;/li&gt;
&lt;li&gt;é€‰å‡ºå…¬é’¥ï¼Œæ¡ä»¶ï¼šè´¨æ•° &amp;amp;&amp;amp; 1 &amp;lt; å…¬é’¥ &amp;lt; Tï¼Œä¸æ˜¯Tçš„å› å­ï¼Œå³E&lt;/li&gt;
&lt;li&gt;è®¡ç®—ç§é’¥ï¼Œæ¡ä»¶ï¼šï¼ˆD * Eï¼‰% T = 1&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å½“på’Œqç‰¹åˆ«å¤§æ—¶ï¼Œç”Ÿæˆçš„Tå’ŒNéƒ½éå¸¸å¤§ï¼Œå³ä½¿å…¬å¼€Nï¼Œä¹Ÿå¾ˆéš¾æš´åŠ›ç®—å‡ºpå’Œqï¼Œæ‰€ä»¥ç ´è§£éå¸¸å›°éš¾&lt;/p&gt;
&lt;h1 id=&#34;http-20&#34;&gt;HTTP 2.0&lt;/h1&gt;
&lt;p&gt;è®¾å¤‡å˜å¥½ï¼Œå†…å®¹å½¢å¼å¤šæ ·ï¼Œé¡µé¢èµ„æºå˜å¤šï¼Œå®æ—¶æ€§è¦æ±‚å˜é«˜ä½¿å¾—HTTP1.1å»¶æ—¶å˜é«˜ï¼Œåƒåœ¨Chromeè¿æ¥æœ€å¤§å¹¶å‘é‡æ˜¯6ä¸ªï¼Œä¸”æ¯ä¸€ä¸ªè¿æ¥éƒ½éœ€è¦ç»è¿‡TCPå’ŒTLSæ¡æ‰‹è€—æ—¶ï¼ŒHTTP1.1æœ¬èº«ä¸€ä¸ªè¿æ¥åªèƒ½å¤„ç†ä¸€ä¸ªè¯·æ±‚ï¼Œæ‰èƒ½ç»§ç»­å¤„ç†ï¼Œæ¯æ¬¡è¯·æ±‚å¤´éƒ¨éƒ½å·¨å¤§ä¸”é‡å¤ï¼Œä¸æ”¯æŒæœåŠ¡ç«¯æ¶ˆæ¯æ¨é€ï¼›&lt;/p&gt;
&lt;p&gt;HTTP2.0å»ºç«‹åœ¨Httpsåè®®çš„åŸºç¡€ä¸Šï¼Œæ”¯æŒäºŒè¿›åˆ¶æµè€Œä¸æ˜¯æ–‡æœ¬ï¼Œæ”¯æŒå¤šè·¯å¤ç”¨è€Œä¸æ˜¯æœ‰åºé˜»å¡ï¼Œæ”¯æŒæ•°æ®å‹ç¼©å‡å°‘åŒ…å¤§å°ï¼Œæ”¯æŒserver pushç­‰ç‰¹æ€§ï¼Œå®ç°ä½å»¶æ—¶ï¼Œé«˜æ€§èƒ½ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å¤´éƒ¨å‹ç¼©&#34;&gt;å¤´éƒ¨å‹ç¼©&lt;/h2&gt;
&lt;p&gt;http1.xçš„å¤´å¸¦æœ‰å¤§é‡ä¿¡æ¯ï¼Œè€Œä¸”æ¯æ¬¡éƒ½è¦é‡å¤å‘é€ï¼Œå­—æ®µæ˜¯ASCIIç¼–ç ï¼Œæ•ˆç‡è¾ƒä½ã€‚http/2ä½¿ç”¨HPACKç®—æ³•æ¥å‹ç¼©headerã€‚&lt;/p&gt;
&lt;p&gt;HPACKç®—æ³•åŒ…å«ä¸‰ä¸ªç»„æˆéƒ¨åˆ†ï¼šé™æ€å­—å…¸ã€åŠ¨æ€å­—å…¸ã€å“ˆå¤«æ›¼ç¼–ç (ç”¨äºå‹ç¼©)ï¼›é€šè¿‡å­—å…¸é•¿åº¦è¾ƒå°çš„ç´¢å¼•è¡¨ç¤ºå¯¹äºçš„å­—æ®µã€å†ä½¿ç”¨å“ˆå¤«æ›¼ç¼–ç è¿›è¡Œå‹ç¼©ï¼Œå¯é«˜è¾¾50%~90%çš„å‹ç¼©ç‡ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;é™æ€å­—å…¸è¡¨&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å­˜å‚¨é«˜é¢‘çš„å­—æ®µå’Œå¯¹åº”çš„ç´¢å¼•ï¼Œæ¯”å¦‚ä¸€äº›å¸¸è§çš„HTTPè¯·æ±‚å¤´å­—æ®µå’Œå€¼ä»¥åŠå¯¹åº”çš„ç´¢å¼•ï¼Œç´¢å¼•ä»1å¼€å§‹è‡ªå¢ï¼Œä»£è¡¨å¯¹åº”çš„å­—æ®µï¼›&lt;/p&gt;
&lt;p&gt;HTTP2.0å¤´éƒ¨åŸºäºäºŒè¿›åˆ¶ç¼–ç ï¼ˆæŠŠç´¢å¼•å€¼ç¿»è¯‘æˆäºŒè¿›åˆ¶æ•°ï¼‰ï¼Œä¸éœ€è¦ä½¿ç”¨å†’å·ã€ç©ºæ ¼ã€æˆ–è€…\r\nä½œä¸ºåˆ†éš”ç¬¦ï¼Œç›´æ¥ä½¿ç”¨å­—ç¬¦ä¸²é•¿åº¦æ¥åˆ†å‰²ç´¢å¼•å’Œå€¼ï¼›&lt;/p&gt;
&lt;p&gt;å„è‡ªç¼“å­˜ä¹‹åï¼Œä¹‹åå‘é€çš„è¯·æ±‚å¦‚æœä¸åŒ…å«é¦–éƒ¨ï¼Œå°±ä¼šè‡ªåŠ¨ä½¿ç”¨ä¹‹å‰è¯·æ±‚å‘é€çš„é¦–éƒ¨ï¼Œå¦‚æœé¦–éƒ¨å‘ç”Ÿå˜åŒ–ï¼Œåˆ™åªéœ€å°†å˜åŒ–çš„éƒ¨åˆ†åŠ å…¥åˆ°headerå¸§ä¸­ï¼Œæ”¹å˜çš„éƒ¨åˆ†ä¼šåŠ å…¥åˆ°å¤´éƒ¨å­—æ®µè¡¨ä¸­ï¼Œé¦–éƒ¨è¡¨åœ¨HTTP2.0çš„è¿æ¥å­˜ç»­æœŸå†…å§‹ç»ˆå­˜åœ¨ï¼Œç”±å®¢æˆ·ç«¯å–æœåŠ¡ç«¯å…±åŒæ¸è¿›å¼æ›´æ–°ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;åŠ¨æ€å­—å…¸è¡¨&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;é™æ€è¡¨åªåŒ…å«äº† 61 ç§é«˜é¢‘å‡ºç°åœ¨å¤´éƒ¨çš„å­—ç¬¦ä¸²ï¼Œä¸åœ¨é™æ€è¡¨èŒƒå›´å†…çš„å¤´éƒ¨å­—ç¬¦ä¸²å°±è¦è‡ªè¡Œæ„å»ºåŠ¨æ€è¡¨ï¼Œå®ƒçš„ Index ä» &lt;code&gt;62&lt;/code&gt; èµ·æ­¥ï¼Œä¼šåœ¨ç¼–ç è§£ç çš„æ—¶å€™éšæ—¶æ›´æ–°ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æ¯”å¦‚æœ‰æ–°çš„ä¸å­˜åœ¨é™æ€å­—å…¸è¡¨çš„å­—æ®µå‡ºç°åœ¨åŒæ–¹çš„é€šä¿¡ä¸­ï¼ŒåŒæ–¹å°±ä¼šä¸ºè¿™ä¸ªæ–°çš„å­—æ®µæ›´æ–°ä¸€ä¸ªå¯¹åº”çš„ç´¢å¼•ï¼Œè®°å½•åˆ°åŠ¨æ€å­—å…¸è¡¨ä¸­ã€‚åŠ¨æ€å­—å…¸è¡¨ç”Ÿæ•ˆæœ‰ä¸€ä¸ªå‰ææ˜¯ï¼Œå¿…é¡»åœ¨åŒä¸€è¿æ¥ä¸Šï¼Œé‡å¤ä¼ è¾“å®Œæˆç›¸åŒçš„HTTPå¤´éƒ¨ï¼Œå¦‚æœåœ¨ä¸€ä¸ªè¿æ¥ä¸Šåªå‘é€äº†ä¸€æ¬¡ï¼Œæˆ–è€…é‡å¤ä¼ è¾“æ—¶æ€»æ˜¯ç•¥æœ‰å˜åŒ–ï¼ŒåŠ¨æ€å­—å…¸è¡¨å°±æ— æ³•å……åˆ†åˆ©ç”¨äº†ã€‚&lt;/p&gt;
&lt;p&gt;åŠ¨æ€å­—å…¸è¡¨ä¼šéšç€é€šä¿¡æ—¶é—´çš„ç´¯ç§¯ï¼Œè¶Šå˜è¶Šå¤§ï¼Œå ç”¨çš„å†…å­˜ä¹Ÿè¶Šå¤§ï¼Œä¼šå½±å“æœåŠ¡å™¨æ€§èƒ½ï¼Œå› æ­¤ä¸€èˆ¬æœåŠ¡å™¨ä¼šæä¾›ç±»ä¼¼&lt;code&gt;http2_max_requests&lt;/code&gt;çš„é…ç½®ï¼Œé™åˆ¶ä¸€ä¸ªè¿æ¥èƒ½ä¼ è¾“çš„è¯·æ±‚æ•°é‡ï¼Œé¿å…åŠ¨æ€å­—å…¸è¡¨æ— é™å¢å¤§ï¼Œå½“è¾¾åˆ°ä¸Šé™åï¼Œå°±ä¼šå…³é—­è¿æ¥æ¥é‡Šæ”¾å†…å­˜ï¼Œç­‰ä¸‹æ¬¡è¿æ¥å†é‡æ–°å»ºç«‹åŠ¨æ€å­—å…¸è¡¨ã€‚&lt;/p&gt;
&lt;h2 id=&#34;äºŒè¿›åˆ¶åˆ†å±‚å¸§&#34;&gt;äºŒè¿›åˆ¶åˆ†å±‚å¸§&lt;/h2&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/HTTP2%e4%ba%8c%e8%bf%9b%e5%88%b6%e5%b8%a7%e7%9a%84%e7%bb%93%e6%9e%84.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/HTTP2%e4%ba%8c%e8%bf%9b%e5%88%b6%e5%b8%a7%e7%9a%84%e7%bb%93%e6%9e%84.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å¸§ç±»å‹æœ‰10ç§ï¼Œåˆ†ä¸ºæ•°æ®å¸§å’Œæ§åˆ¶å¸§ä¸¤å¤§ç±»ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ ‡å¿—ä½ç”¨äºæºå¸¦ç®€å•çš„æ§åˆ¶ä¿¡æ¯ï¼Œæ¯”å¦‚END_HEADERSè¡¨ç¤ºæ•°æ®ç»“æŸæ ‡å¿—ï¼Œç›¸å½“äºHTTP1.xé‡Œçš„ç©ºè¡Œæˆ–è€…/r/nï¼›END_Streamè¡¨ç¤ºå•å‘æ•°æ®å‘é€ç»“æŸï¼Œåç»­ä¸ä¼šæœ‰æ•°æ®å¸§ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æµæ ‡è¯†ç¬¦ï¼Œç”¨æ¥æ ‡è¯†å¸§å±äºå“ªä¸ªStreamï¼Œç”¨äºæ¥æ”¶åŒæ–¹åœ¨ä¹±åºçš„å¸§é‡Œæ‰¾åˆ°ç›¸åŒçš„StreamIDï¼Œä»è€Œæœ‰åºçš„ç»„è£…ä¿¡æ¯ï¼›ä¸ºäº†é˜²æ­¢ä¸¤ç«¯æµIDå†²çªï¼Œå®¢æˆ·ç«¯å‘èµ·çš„æµå…·æœ‰å¥‡æ•°IDï¼ŒæœåŠ¡å™¨ç«¯å‘èµ·çš„æµå…·æœ‰å¶æ•°IDï¼›&lt;/p&gt;
&lt;p&gt;æ¯ä¸ªStreamæ˜¯ä¸€ä¸ªé€»è¾‘è”ç³»ï¼Œä¸€ä¸ªç‹¬ç«‹çš„åŒå‘çš„frameå­˜åœ¨äºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯ä¹‹é—´çš„HTTP2.0è¿æ¥ä¸­ã€‚ä¸€ä¸ªHTTP2.0è¿æ¥ä¸Šå¯åŒ…å«å¤šä¸ªå¹¶å‘æ‰“å¼€çš„Streamï¼Œè¿™ä¸ªå¹¶å‘Streamçš„æ•°é‡èƒ½å¤Ÿç”±å®¢æˆ·ç«¯è®¾ç½®ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¸§æ•°æ®ï¼šç”±HPACKç®—æ³•å‹ç¼©è¿‡çš„HTTPå¤´å’ŒåŒ…ä½“ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ¶ˆæ¯ï¼šä¸€ä¸ªå®Œæ•´çš„è¯·æ±‚æˆ–å“åº”ï¼Œç”±ä¸€ä¸ªæˆ–å¤šä¸ªå¸§ç»„æˆã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;åœ¨äºŒè¿›åˆ¶åˆ†å¸§å±‚ä¸Šï¼Œhttp2.0ä¼šå°†æ‰€æœ‰ä¼ è¾“ä¿¡æ¯åˆ†å‰²ä¸ºæ›´å°çš„æ¶ˆæ¯å’Œå¸§ï¼Œå¹¶å¯¹å®ƒä»¬é‡‡ç”¨äºŒè¿›åˆ¶æ ¼å¼çš„ç¼–ç å°†å…¶å°è£…ï¼Œæ–°å¢çš„äºŒè¿›åˆ¶åˆ†å¸§å±‚åŒæ—¶ä¹Ÿèƒ½å¤Ÿä¿è¯httpçš„å„ç§åŠ¨è¯ï¼Œæ–¹æ³•ï¼Œé¦–éƒ¨éƒ½ä¸å—å½±å“ï¼Œå…¼å®¹ä¸Šä¸€ä»£httpæ ‡å‡†ã€‚å…¶ä¸­ï¼Œhttp1.Xä¸­çš„é¦–éƒ¨ä¿¡æ¯headerå°è£…åˆ°Headerså¸§ä¸­ï¼Œè€Œrequest bodyå°†è¢«å°è£…åˆ°Dataå¸§ä¸­ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;å¤šè·¯å¤ç”¨&#34;&gt;å¤šè·¯å¤ç”¨&lt;/h2&gt;
&lt;p&gt;HTTP2.0é€šè¿‡å¤šè·¯å¤ç”¨å®ç°å¹¶å‘ä¼ è¾“ï¼Œå¤šä¸ªStreamå¤ç”¨åŒä¸€æ¡TCPè¿æ¥ï¼Œè¾¾åˆ°å¹¶å‘çš„æ•ˆæœï¼Œè§£å†³HTTP1.1é˜Ÿå¤´é˜»å¡é—®é¢˜ï¼Œé¿å…é¢‘ç¹å»ºç«‹TCPã€TLSæ¡æ‰‹çš„æ—¶é—´ï¼Œå‡å°‘TCPæ…¢å¯åŠ¨å¯¹æµé‡çš„å½±å“ï¼Œæé«˜HTTPä¼ è¾“çš„ååé‡ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å¤šä¸ª Stream è·‘åœ¨ä¸€æ¡ TCP è¿æ¥ï¼ŒåŒä¸€ä¸ª HTTP è¯·æ±‚ä¸å“åº”æ˜¯è·‘åœ¨åŒä¸€ä¸ª Stream ä¸­ï¼ŒHTTP æ¶ˆæ¯å¯ä»¥ç”±å¤šä¸ª Frame æ„æˆï¼Œ ä¸€ä¸ª Frame å¯ä»¥ç”±å¤šä¸ª TCP æŠ¥æ–‡æ„æˆã€‚&lt;strong&gt;ä¸åŒ Stream çš„å¸§æ˜¯å¯ä»¥ä¹±åºå‘é€çš„ï¼ˆå› æ­¤å¯ä»¥å¹¶å‘ä¸åŒçš„ Stream ï¼‰&lt;/strong&gt;ï¼Œå› ä¸ºæ¯ä¸ªå¸§çš„å¤´éƒ¨ä¼šæºå¸¦ Stream ID ä¿¡æ¯ï¼Œæ‰€ä»¥æ¥æ”¶ç«¯å¯ä»¥é€šè¿‡ Stream ID æœ‰åºç»„è£…æˆ HTTP æ¶ˆæ¯ï¼Œè€Œ&lt;strong&gt;åŒä¸€ Stream å†…éƒ¨çš„å¸§å¿…é¡»æ˜¯ä¸¥æ ¼æœ‰åºçš„&lt;/strong&gt;ï¼›å³å¤šä¸ªStreamä¼ è¾“æ—¶æ˜¯å¹¶è¡Œäº¤é”™çš„ï¼Œä½†æ˜¯åŒä¸€ä¸ªStreamçš„å¸§æ˜¯æœ‰åºçš„ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;è¿æ¥æ˜¯æŒä¹…çš„ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´åªéœ€è¦ä¸€ä¸ªè¿æ¥ï¼Œæ¯ä¸ªæ•°æ®æµå¯ä»¥æ‹†åˆ†æˆå¾ˆå¤šä¸ä¾èµ–çš„å¸§ï¼Œè¿™äº›å¸§å¯ä»¥ä¹±åºå‘é€ï¼Œä¹Ÿå¯ä»¥åˆ†ä¼˜å…ˆçº§ï¼Œå¤šä¸ªæµçš„æ•°æ®åŒ…èƒ½å¤Ÿæ··åˆåœ¨ä¸€èµ·é€šè¿‡åŒæ ·çš„è¿æ¥ä¼ è¾“ï¼ŒæœåŠ¡ç«¯åœ¨æ ¹æ®ä¸åŒå¸§é¦–éƒ¨çš„æµæ ‡è¯†è¿›è¡ŒåŒºåˆ†å’Œç»„è£…ã€‚&lt;/p&gt;
&lt;h2 id=&#34;è¯·æ±‚ä¼˜å…ˆçº§&#34;&gt;è¯·æ±‚ä¼˜å…ˆçº§&lt;/h2&gt;
&lt;p&gt;å°†HTTPæ¶ˆæ¯åˆ†ä¸ºå¾ˆå¤šç‹¬ç«‹å¸§ä¹‹åï¼Œå°±å¯ä»¥é€šè¿‡ä¼˜åŒ–è¿™äº›å¸§çš„äº¤é”™å–ä¼ è¾“é¡ºåºè¿›ä¸€æ­¥ä¼˜åŒ–æ€§èƒ½ï¼ŒæœåŠ¡ç«¯ä¹Ÿå¯ä»¥æ ¹æ®æµçš„ä¼˜å…ˆçº§ï¼Œä¼˜å…ˆå°†æœ€é«˜ä¼˜å…ˆçº§çš„å¸§å‘é€ç»™å®¢æˆ·ç«¯ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æœåŠ¡ç«¯æ¨é€&#34;&gt;æœåŠ¡ç«¯æ¨é€&lt;/h2&gt;
&lt;p&gt;æœåŠ¡ç«¯å¯ä»¥å¯¹ä¸€ä¸ªå®¢æˆ·ç«¯è¯·æ±‚å‘é€å¤šä¸ªå“åº”ï¼Œè€Œæ— éœ€å®¢æˆ·ç«¯æ˜ç¡®åœ°è¯·æ±‚ï¼Œçœå»å®¢æˆ·ç«¯é‡å¤è¯·æ±‚çš„æ­¥éª¤ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;æœåŠ¡å™¨æ¨é€èµ„æºæ—¶ï¼Œä¼šå…ˆå‘é€ PUSH_PROMISE å¸§ï¼Œå‘Šè¯‰å®¢æˆ·ç«¯æ¥ä¸‹æ¥åœ¨å“ªä¸ª Stream å‘é€èµ„æºï¼Œç„¶åç”¨å¶æ•°å· Stream å‘é€èµ„æºç»™å®¢æˆ·ç«¯ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;ä½¿ç”¨é•¿è¿æ¥éœ€è¦è€ƒè™‘çš„ç‚¹&#34;&gt;ä½¿ç”¨é•¿è¿æ¥éœ€è¦è€ƒè™‘çš„ç‚¹&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„æ•°é‡ï¼Œå› ä¸ºè¦ä¿æŒè¿æ¥ï¼Œå¦‚æœå®¢æˆ·ç«¯çš„æ•°é‡è¿œè¶…æœåŠ¡ç«¯çš„æ•°é‡ï¼ŒæœåŠ¡ç«¯ä¸æ¯ä¸ªå®¢æˆ·ç«¯éƒ½ç»´æŒä¸€ä¸ªé•¿è¿æ¥ï¼Œå¯¹æœåŠ¡ç«¯æ¥è¯´è´Ÿæ‹…æ¯”è¾ƒå¤§ï¼Œæ­¤æ—¶éœ€è¦è®¾ç½®ä¸€ä¸ªåˆç†çš„è¶…æ—¶æ—¶é—´ï¼Œåœ¨ç©ºé—²æ—¶é—´è¿‡é•¿æ—¶æ–­å¼€è¿æ¥ï¼Œé‡Šæ”¾æœåŠ¡ç«¯èµ„æºï¼›&lt;/li&gt;
&lt;li&gt;å› ä¸ºé•¿è¿æ¥çš„å¤šè·¯å¤ç”¨ï¼Œè¿æ¥ä¸€æ—¦å»ºç«‹ä¾¿ä¸ä¼šæ–­å¼€ï¼Œæµé‡ä¼šè¢«åˆ†åˆ°åŒä¸€ä¸ªæœåŠ¡ç«¯ï¼Œä¼šå¯¼è‡´è´Ÿè½½ä¸å‡è¡¡ï¼Œéœ€è¦è¿æ¥æ± èƒ½åˆ†è¾¨å‡ºæœåŠ¡ç«¯çš„å¤šä¸ªå®ä¾‹ï¼Œè‡ªå·±å®ç°ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;tcptransmission-control-protocol-ä¼ è¾“æ§åˆ¶åè®®&#34;&gt;TCPï¼ˆTransmission Control Protocol ä¼ è¾“æ§åˆ¶åè®®ï¼‰&lt;/h1&gt;
&lt;h2 id=&#34;ç‰¹ç‚¹&#34;&gt;ç‰¹ç‚¹&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;é¢å‘è¿æ¥çš„ï¼Œæä¾›å¯é äº¤ä»˜ï¼ˆåªä¿è¯ä¼ è¾“å±‚å¯é ï¼‰ï¼Œä¸¢åŒ…é‡ä¼ ï¼Œæœ‰çŠ¶æ€æœåŠ¡&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æœ‰æµé‡æ§åˆ¶ï¼Œæ‹¥å¡æ§åˆ¶&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æä¾›å…¨åŒå·¥é€šä¿¡&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;é¢å‘å­—èŠ‚æµï¼ˆæŠŠåº”ç”¨å±‚ä¼ ä¸‹æ¥çš„æŠ¥æ–‡çœ‹æˆå­—èŠ‚æµï¼ŒæŠŠå­—èŠ‚æµç»„ç»‡æˆå¤§å°ä¸ç­‰çš„æ•°æ®å—ï¼‰&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¤´éƒ¨20å­—èŠ‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ¯ä¸€æ¡ TCP è¿æ¥åªèƒ½æ˜¯ç‚¹å¯¹ç‚¹çš„ï¼ˆä¸€å¯¹ä¸€ï¼‰&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç¼ºç‚¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;TCPåè®®åœ¨å†…æ ¸ä¸­å®ç°ï¼Œå‡çº§èµ·æ¥æ¯”è¾ƒéº»çƒ¦ï¼Œè¿˜éœ€è¦clientç«¯å’Œserverç«¯åŒæ—¶æ”¯æŒï¼›&lt;/li&gt;
&lt;li&gt;TCPå»ºç«‹è¿æ¥æœ‰å»¶æ—¶ï¼Œå¯åŠ¨æ—¶æ…¢å¯åŠ¨ï¼Œæ‹¥å¡é¿å…ï¼Œæ¯”å¦‚åº”ç”¨å±‚HTTPè¦å»ºç«‹è¿æ¥ï¼Œéœ€è¦å…ˆå»ºç«‹TCPè¿æ¥ï¼Œæ— æ³•æ•´åˆåœ¨ä¸€èµ·ï¼›&lt;/li&gt;
&lt;li&gt;TCPå­˜åœ¨é˜Ÿå¤´é˜»å¡é—®é¢˜ï¼Œå› ä¸ºè¦ä¿è¯æ”¶åˆ°çš„å­—èŠ‚æ•°æœ‰åºä¸”å®Œæ•´ï¼Œå†…æ ¸è¦ä¿è¯æ”¶åˆ°è¿ç»­çš„åŒ…æ‰å…è®¸åº”ç”¨å±‚è¯»å–ï¼Œå¦‚æœä¸­é—´æœ‰ä¸€ä¸ªåŒ…è¶…æ—¶é‡ä¼ äº†ï¼Œå°±ä¼šé˜»å¡åº”ç”¨å±‚;&lt;/li&gt;
&lt;li&gt;IPå˜åŠ¨ï¼Œç«¯å£å˜åŠ¨éœ€è¦é‡æ–°å»ºç«‹TCPè¿æ¥ï¼Œæ¯”å¦‚åˆ‡æ¢wifiå’Œ4G&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å…³äºTCPçš„Keep-Aliveï¼š&lt;/p&gt;
&lt;p&gt;è¿æ¥çš„åŒæ–¹åœ¨ç‰©ç†å±‚é¢æ²¡æœ‰è¿æ¥çš„æ¦‚å¿µï¼Œè¿æ¥ä¹Ÿä¸æ˜¯ä¸€ç›´å­˜åœ¨æ•°æ®äº¤äº’ï¼Œæ‰€ä»¥åŒæ–¹æ˜¯æ„ŸçŸ¥ä¸åˆ°å¯¹æ–¹çš„è¿æ¥æœ‰æ²¡æœ‰å…³æ‰çš„ï¼ŒTCP keep-alive ä¹Ÿæ˜¯TCPçš„ä¿æ´»æœºåˆ¶ï¼Œå…¶åŸºæœ¬åŸç†æ˜¯ï¼Œåœ¨ä¸€æ®µæ—¶é—´å†…æ²¡æœ‰æ•°æ®ä¼ è¾“ï¼Œå°±ä¼šç»™è¿æ¥å¯¹ç«¯å‘é€ä¸€ä¸ªæ¢æµ‹åŒ…ï¼Œå¦‚æœæ”¶åˆ°å¯¹æ–¹å›åº”çš„ ACKï¼Œåˆ™è®¤ä¸ºè¿æ¥è¿˜æ˜¯å­˜æ´»çš„ï¼Œåœ¨è¶…è¿‡ä¸€å®šé‡è¯•æ¬¡æ•°ä¹‹åè¿˜æ˜¯æ²¡æœ‰æ”¶åˆ°å¯¹æ–¹çš„å›åº”ï¼Œåˆ™ä¸¢å¼ƒè¯¥ TCP è¿æ¥ï¼Œé€šè¿‡è¿™ç§æ–¹å¼ï¼Œæ¥å®ç°è¿æ¥çš„æ¦‚å¿µã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;åº”ç”¨åœºæ™¯&#34;&gt;åº”ç”¨åœºæ™¯&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;HTTPã€FTPæ–‡ä»¶ä¼ è¾“ã€SSHã€SMTP&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;åŒ…å¤´&#34;&gt;åŒ…å¤´&lt;/h2&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/TCP%e5%8c%85%e5%a4%b4.jpg&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/TCP%e5%8c%85%e5%a4%b4.jpg&#34;
			
			
			
			loading=&#34;lazy&#34;
			alt=&#34;TCPåŒ…å¤´&#34;&gt;
	&lt;/a&gt;
	
	&lt;figcaption&gt;TCPåŒ…å¤´&lt;/figcaption&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç«¯å£å·&lt;/strong&gt;ï¼šç”¨äºæ‰¾åˆ°ç›®æ ‡ä¸»æœºä¸Šçš„åº”ç”¨ç¨‹åºè¿›ç¨‹ï¼ŒTCPåŒ…æ˜¯æ²¡æœ‰IPåœ°å€çš„ï¼Œå› ä¸ºIPæ•°æ®æ˜¯ç½‘ç»œå±‚çš„äº‹ï¼Œæ‰€ä»¥è¿™ä¸€å±‚åªæœ‰ç«¯å£å·ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åºå·&lt;/strong&gt;ï¼šè®©åŒ…èƒ½é¡ºåºå‘é€å’Œæ¥æ”¶ï¼Œ&lt;strong&gt;è§£å†³ä¹±åºé—®é¢˜ï¼Œä¹Ÿå¯ä»¥åŒºåˆ†è¿æ¥çš„é˜¶æ®µï¼ŒåŒºåˆ†ä¸åŒçš„è¿æ¥&lt;/strong&gt;ã€‚ä¸‰æ¬¡æ¡æ‰‹é™¤äº†ç¡®ç«‹åŒæ–¹å»ºç«‹è¿æ¥ï¼Œæœ€é‡è¦çš„æ˜¯ç¡®ç«‹åŒæ–¹åŒ…çš„åºåˆ—å·ï¼Œæ¯ä¸€æ¬¡è¿æ¥éƒ½è¦æœ‰ä¸åŒçš„åºåˆ—å·ç”¨äºåŒºåˆ«ï¼Œåºåˆ—å·çš„èµ·å§‹é€šå¸¸æ˜¯éšæ—¶é—´ï¼Œå¦‚æœæ¯æ¬¡è¿æ¥çš„åºåˆ—å·ç›¸åŒï¼Œå¯èƒ½ä¼šå¯¼è‡´å‰ä¸€æ¬¡è¿æ¥çš„åŒ…å‘é€åˆ°äº†ä¸‹ä¸€æ¬¡è¿æ¥é‡Œï¼›åºå·çš„å¢åŠ å’Œä¼ è¾“çš„å­—èŠ‚æ•°ç›¸å…³ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¡®è®¤åºåˆ—å·&lt;/strong&gt;ï¼šå‘å‡ºå»çš„æ•°æ®åŒ…æ—¶è¿›è¡Œç¡®è®¤çš„æ ‡è®°ï¼Œ&lt;strong&gt;è§£å†³ä¸¢åŒ…é—®é¢˜&lt;/strong&gt;ï¼Œæ¥æ”¶æ–¹å›å¤çš„ACKåŒ…çš„ç¡®è®¤åºå· = å‘é€æ–¹æ•°æ®åŒ…çš„åºå· + TCPçš„æ•°æ®è½½è·å­—èŠ‚æ•°ï¼Œæ³¨æ„æ­¤æ—¶çš„è½½è·æ•°æ®å¯èƒ½æ˜¯è¿™ä¸€æ¬¡æŠ¥æ–‡çš„å®Œæ•´æ•°æ®ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯åŒ…å«äº†ä¸Šä¸€æ¬¡æŠ¥æ–‡çš„éƒ¨åˆ†æ•°æ®å’Œæ­¤æ¬¡æŠ¥æ–‡çš„éƒ¨åˆ†æ•°æ®ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;çŠ¶æ€ä½&lt;/strong&gt;ï¼šå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯è¿æ¥çš„çŠ¶æ€ï¼Œå³åŒ…çš„ç±»å‹ï¼Œæ“æ§TCPçš„çŠ¶æ€æœºï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;çª—å£å¤§å°&lt;/strong&gt;ï¼š&lt;strong&gt;è§£å†³æµé‡æ§åˆ¶é—®é¢˜&lt;/strong&gt;ï¼Œæ ‡è¯†è‡ªå·±å½“å‰çš„å¤„ç†èƒ½åŠ›ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;TCPé€šè¿‡å››å…ƒç»„å¯ä»¥å”¯ä¸€çš„ç¡®å®šä¸€ä¸ªè¿æ¥&lt;/strong&gt;ï¼Œå››å…ƒç»„ï¼šæºåœ°å€ã€æºç«¯å£ã€ç›®çš„åœ°å€ã€ç›®çš„ç«¯å£ï¼Œå…¶ä¸­ï¼Œæºåœ°å€ã€ç›®æ ‡åœ°å€åœ¨IPå¤´éƒ¨ä¸­ï¼Œå‘Šè¯‰IPåè®®å‘é€æŠ¥æ–‡ç»™ç›®æ ‡ä¸»æœºï¼Œæºç«¯å£å’Œç›®æ ‡ç«¯å£åœ¨TCPå¤´éƒ¨ä¸­ï¼Œå‘Šè¯‰TCPåè®®è¦æŠŠæŠ¥æ–‡å‘ç»™å“ªä¸ªè¿›ç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;TCPå’ŒUDPå¯ä»¥ä½¿ç”¨åŒä¸€ä¸ªç«¯å£&lt;/strong&gt;ï¼Œå› ä¸ºTCPå’ŒUDPåœ¨å†…æ ¸ä¸­æ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„æ¨¡å—ï¼Œ&lt;strong&gt;ä¸»æœºæ”¶åˆ°æ•°æ®åŒ…åï¼Œå¯ä»¥åœ¨IPåŒ…å¤´çš„åè®®å·é‡Œåˆ¤æ–­æ•°æ®åŒ…æ˜¯TCPè¿˜æ˜¯UDP&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨å®¢æˆ·ç«¯ä¸­ï¼Œé’ˆå¯¹åŒä¸€ä¸ªç«¯å£ï¼Œå¯ä»¥ä¸å¤šä¸ªä¸åŒçš„æœåŠ¡ç«¯å»ºç«‹TCPè¿æ¥ï¼ŒåŸå› æ˜¯TCPæ˜¯é€šè¿‡å››å…ƒç»„ç¡®å®šä¸€ä¸ªå”¯ä¸€è¿æ¥çš„ï¼Œ&lt;strong&gt;å¯¹å®¢æˆ·ç«¯æ¥è¯´ï¼Œåªè¦å¤šä¸ªæœåŠ¡ç«¯çš„IPä¸åŒï¼Œå°±å¯ä»¥å¤ç”¨åŒä¸€ä¸ªç«¯å£&lt;/strong&gt;ï¼Œä¸ä¼šå¯¼è‡´è¿æ¥å†²çªçš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;åŒç†ï¼Œåœ¨æœåŠ¡ç«¯ä¸­ï¼Œåªè¦ç»‘å®šçš„IPä¸æ˜¯åŒä¸€ä¸ªï¼Œå°±å¯ä»¥å¤ç”¨åŒä¸€ä¸ªç«¯å£ï¼Œä¸€èˆ¬é’ˆå¯¹æœåŠ¡ç«¯ç»‘å®šIPæ¥è¯´ï¼Œæœ‰å‡ ç§å¯èƒ½ï¼Œæ¯”å¦‚æœ¬èº«æœºå™¨çš„IPï¼Œæˆ–è€… 127.0.0.1 æˆ–è€… 0.0.0.0ï¼ˆæ¯”è¾ƒç‰¹æ®Šï¼Œåœ¨æ²¡è®¾ç½®&lt;code&gt;SO_REUSEPORT&lt;/code&gt;æƒ…å†µä¸‹ï¼Œè¡¨ç¤ºç»‘å®šè¯¥ä¸»æœºä¸Šçš„æ‰€æœ‰IPï¼Œå°±ä¼šå‡ºç°å†²çªï¼‰&lt;/p&gt;
&lt;p&gt;ç†è®ºä¸Šï¼ŒæœåŠ¡ç«¯å•æœºTCPçš„æœ€å¤§è¿æ¥æ•° = å®¢æˆ·ç«¯IPæ•° x å®¢æˆ·ç«¯ç«¯å£æ•°ï¼Œå³ 2^32 * 2^16 = 2^48ï¼Œä½†ä¼šå—æ“ä½œç³»ç»Ÿèµ„æºå½±å“ï¼Œæ‰€ä»¥æœ‰ä¸€å®šçš„ä¸Šé™ï¼Œä»¥Linuxä¸ºä¾‹ï¼Œå½±å“å› ç´ æœ‰ï¼šæ–‡ä»¶æè¿°ç¬¦é™åˆ¶ã€å†…å­˜é™åˆ¶ï¼›&lt;/p&gt;
&lt;h2 id=&#34;æœ¯è¯­&#34;&gt;æœ¯è¯­&lt;/h2&gt;
&lt;p&gt;SYNï¼šå‘èµ·ä¸€ä¸ªæ–°è¿æ¥ï¼Œå¹¶åœ¨å…¶åºå·è¿›è¡Œåˆå§‹å€¼çš„è®¾å®š&lt;/p&gt;
&lt;p&gt;ACKï¼šå›å¤ï¼Œç¡®è®¤åºå·æœ‰æ•ˆ&lt;/p&gt;
&lt;p&gt;ackï¼šå›å¤ï¼Œç¡®è®¤åºå·ï¼Œ=å‘é€æ–¹seq+1&lt;/p&gt;
&lt;p&gt;FINï¼šé‡Šæ”¾ä¸€ä¸ªè¿æ¥&lt;/p&gt;
&lt;p&gt;RSTï¼šå¤ä½æ ‡å¿—ï¼Œè¡¨ç¤ºTCPè¿æ¥ä¸­å‡ºç°å¼‚å¸¸ï¼Œéœ€è¦é‡æ–°è¿æ¥&lt;/p&gt;
&lt;p&gt;FINï¼šè¡¨ç¤ºä»Šåä¸å†æœ‰æ•°æ®å‘é€ï¼Œå¸Œæœ›æ–­å¼€è¿æ¥&lt;/p&gt;
&lt;p&gt;MTUï¼šä¸€ä¸ªç½‘ç»œåŒ…çš„æœ€å¤§é•¿åº¦ï¼Œä¸€èˆ¬æ˜¯1500å­—èŠ‚&lt;/p&gt;
&lt;p&gt;MSSï¼šé™¤å»IPå’ŒTCPå¤´éƒ¨åï¼Œä¸€ä¸ªç½‘ç»œåŒ…èƒ½å®¹çº³çš„TCPæ•°æ®çš„æœ€å¤§é•¿åº¦&lt;/p&gt;
&lt;h2 id=&#34;å»ºç«‹è¿æ¥---ä¸‰æ¬¡æ¡æ‰‹&#34;&gt;å»ºç«‹è¿æ¥ - ä¸‰æ¬¡æ¡æ‰‹&lt;/h2&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/%e4%b8%89%e6%ac%a1%e6%8f%a1%e6%89%8b.jpg&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/%e4%b8%89%e6%ac%a1%e6%8f%a1%e6%89%8b.jpg&#34;
			
			
			
			loading=&#34;lazy&#34;
			alt=&#34;ä¸‰æ¬¡æ¡æ‰‹&#34;&gt;
	&lt;/a&gt;
	
	&lt;figcaption&gt;ä¸‰æ¬¡æ¡æ‰‹&lt;/figcaption&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;ç¬¬ä¸€æ¬¡æ¡æ‰‹ï¼šClientå°†æ ‡å¿—ä½SYNç½®ä¸º1ï¼Œéšæœºäº§ç”Ÿä¸€ä¸ªå€¼seq=jï¼Œå¹¶å°†è¯¥æ•°æ®åŒ…å‘é€ç»™Serverï¼ŒClientè¿›å…¥SYN_SENTçŠ¶æ€ï¼Œç­‰å¾…Serverç¡®è®¤ã€‚ æ¯ä¸€ç«¯å…ˆå‘å‡ºå»çš„éƒ½ä¼šæœ‰SYNï¼Œæ”¶åˆ°ä¹‹åä¼šå‘å‡ºACKã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœclientå‘é€å¤±è´¥ï¼Œä¼šå‘¨æœŸæ€§è¿›è¡Œè¶…æ—¶é‡ä¼ ï¼Œç›´åˆ°æ”¶åˆ°serverçš„ç¡®è®¤ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç¬¬äºŒæ¬¡æ¡æ‰‹ï¼šServeræ”¶åˆ°æ•°æ®åŒ…åç”±æ ‡å¿—ä½SYN=1çŸ¥é“Clientè¯·æ±‚å»ºç«‹è¿æ¥ï¼ŒServerå°†æ ‡å¿—ä½SYNå’ŒACKéƒ½ç½®ä¸º1ï¼Œack=j+1ï¼Œéšæœºäº§ç”Ÿä¸€ä¸ªå€¼seq=Kï¼Œå¹¶å°†è¯¥æ•°æ®åŒ…å‘é€ç»™Clientä»¥ç¡®è®¤è¿æ¥è¯·æ±‚ï¼ŒServerè¿›å…¥SYN_RCVDçŠ¶æ€ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœserverå‘é€å“åº”å¤±è´¥ï¼Œä¼šå‘¨æœŸæ€§è¿›è¡Œè¶…æ—¶é‡ä¼ ï¼Œç›´åˆ°æ”¶åˆ°clientçš„ç¡®è®¤ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼šClientæ”¶åˆ°ç¡®è®¤åï¼Œæ£€æŸ¥ackæ˜¯å¦ä¸ºj+1ï¼ŒACKæ˜¯å¦ä¸º1ï¼Œå¦‚æœæ­£ç¡®åˆ™å°†æ ‡å¿—ä½ACKç½®ä¸º1ï¼Œack=k+1ï¼Œå¹¶å°†è¯¥æ•°æ®åŒ…å‘é€ç»™Serverï¼ŒServeræ£€æŸ¥ackæ˜¯å¦ä¸ºk+1ï¼ŒACKæ˜¯å¦ä¸º1ï¼Œå¦‚æœæ­£ç¡®åˆ™è¿æ¥å»ºç«‹æˆåŠŸï¼ŒClientå’ŒServerè¿›å…¥ESTABLISHEDçŠ¶æ€ï¼Œå¯ä»¥å¼€å§‹ä¼ è¾“æ•°æ®äº†ã€‚&lt;/p&gt;
&lt;p&gt;ç¬¬ä¸‰æ¬¡æ¡æ‰‹å¯ä»¥é¡ºä¾¿æºå¸¦æ•°æ®ï¼Œå‰ä¸¤æ¬¡åˆ™ä¸è¡Œã€‚&lt;/p&gt;
&lt;p&gt;clientç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼Œæ­¤æ—¶clientä¼šè®¤ä¸ºè‡ªå·±å·²ç»ESTABLISHEDï¼Œserverè¿˜æœªæ”¶åˆ°ï¼Œæ­¤æ—¶ä»ç„¶ä¸ºactiveçŠ¶æ€ï¼šå¦‚æœserverä¸€ç›´æ²¡æ”¶åˆ°è¿æ¥è¯·æ±‚ï¼Œserverä¼šé‡å¤ç¬¬äºŒæ¬¡æ¡æ‰‹ï¼Œç›´åˆ°è‡ªå·±æ”¶åˆ°ç¬¬ä¸‰æ¬¡æ¡æ‰‹çš„è¯·æ±‚ï¼Œæ­¤æ—¶serveræ‰æ˜¯ESTABLISHEDï¼›å¦‚æœæ­¤æ—¶clientå‘é€äº†dataæ•°æ®ä¸”åŠ ä¸Šäº†ACKï¼Œserverä¹Ÿä¼šåˆ‡æ¢ä¸ºestablishedï¼›å¦‚æœserveræœ‰æ•°æ®å‘é€å´å‘é€ä¸å‡ºï¼Œä¹Ÿä¼šé‡å¤ç¬¬äºŒæ¬¡æ¡æ‰‹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å…³äºåŠè¿æ¥é˜Ÿåˆ—ã€å…¨è¿æ¥é˜Ÿåˆ—ï¼Œå¦‚æœé˜Ÿåˆ—æ»¡äº†ï¼Œåç»­çš„è¿æ¥ä¼šè¢«ä¸¢æ‰ã€‚&lt;/p&gt;
&lt;p&gt;åŠè¿æ¥é˜Ÿåˆ—æ˜¯ä¸€ä¸ªå“ˆå¸Œè¡¨ï¼Œå› ä¸ºé˜Ÿåˆ—é‡Œéƒ½æ˜¯ä¸å®Œæ•´çš„è¿æ¥ï¼Œä¾¿äºåœ¨ç¬¬ä¸‰æ¬¡æ¡æ‰‹æ—¶é€šè¿‡å“ˆå¸Œè¡¨ï¼Œå¿«é€Ÿå–å‡ºå¯¹åº”çš„è¿æ¥ï¼›&lt;/p&gt;
&lt;p&gt;å…¨è¿æ¥é˜Ÿåˆ—æ˜¯ä¸€ä¸ªé“¾è¡¨ï¼Œå› ä¸ºå­˜åœ¨æ­¤é˜Ÿåˆ—é‡Œçš„è¿æ¥å·²ç»æ˜¯å¯ç”¨çš„äº†ï¼Œç›´æ¥ä»å¤´èŠ‚ç‚¹é‡Œè·å–å³å¯ï¼›&lt;/p&gt;
&lt;h3 id=&#34;ä½œç”¨&#34;&gt;ä½œç”¨&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;ä¸‰æ¬¡æ¡æ‰‹ååˆå§‹åŒ–socketï¼Œåºå·å’Œçª—å£å¤§å°ï¼Œå¹¶å»ºç«‹TCPè¿æ¥ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¡®å®šåŒæ–¹TCPåŒ…çš„èµ·å§‹åºå·ï¼Œä¿è¯è¿æ¥åçš„å¯é æœ‰åºä¼ è¾“&lt;/strong&gt;ï¼šæ¯”å¦‚æ¥æ”¶æ–¹å¯ä»¥å»é™¤é‡å¤çš„æ•°æ®ã€æ¥æ”¶æ–¹å¯ä»¥æŒ‰åºå·è¿›è¡Œé¡ºåºæ¥æ”¶ã€æˆ–è€…ç”¨äºæ ‡è¯†å·²å‘é€çš„æ•°æ®åŒ…ä¸­ï¼Œå“ªäº›å·²è¢«å¯¹æ–¹æ¥æ”¶ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¡®å®šäº†åºå·å°±å¯ä»¥åŒºåˆ†æ–°è€è¿æ¥ï¼Œé˜²æ­¢æ—§çš„é‡å¤è¿æ¥åˆå§‹åŒ–é€ æˆæ··ä¹±&lt;/strong&gt;ï¼šç”±äºå¯èƒ½å‡ºç°clientä¸serverå»ºç«‹è¿æ¥å¹¶è¿›è¡Œé€šä¿¡åæ–­å¼€é‡è¿ï¼Œå¦‚æœæ¯æ¬¡è¿æ¥æ²¡æœ‰æ–°çš„èµ·å§‹åºå·ï¼Œä¼šå¯¼è‡´serveråˆ†è¾¨ä¸å‡ºæ”¶åˆ°çš„åŒ…æ˜¯è¿™æ¬¡è¿æ¥çš„è¿˜æ˜¯ä¸Šæ¬¡è¿æ¥çš„ï¼Œè¿™ä¸ªå·ä¼šä½œä¸ºä»¥åçš„æ•°æ®é€šä¿¡åºå·ï¼Œä»¥ä¿è¯åº”ç”¨å±‚æ¥æ”¶åˆ°çš„æ•°æ®ä¸ä¼šå› ç½‘ç»œä¼ è¾“é—®é¢˜è€Œä¹±åºã€‚&lt;/p&gt;
&lt;p&gt;å¦å¤–ï¼Œæ¯ä¸ªè¿æ¥éƒ½ä¼šæœ‰ä¸åŒçš„åºå·ï¼Œåºå·çš„èµ·å§‹å·éšæ—¶é—´å˜åŒ–ï¼Œæ¯4å¾®ç§’åŠ ä¸€ï¼Œå¦‚æœæœ‰é‡å¤ï¼Œéœ€è¦4.55ä¸ªå°æ—¶åæ‰ä¼šå‡ºç°ï¼Œå› ä¸ºIPåŒ…å¤´é‡Œæœ‰TTL(ç”Ÿå­˜æ—¶é—´)ï¼Œè¶…è¿‡4å°æ—¶æ—©è¿‡æœŸäº†ã€‚&lt;/p&gt;
&lt;p&gt;åºå·æœ‰å›ç»•é—®é¢˜ï¼Œæ‰€ä»¥åªèƒ½æœ€å¤§ç¨‹åº¦çš„é¿å…ï¼Œæ¯”å¦‚Linux&lt;strong&gt;ä½¿ç”¨PAWSæœºåˆ¶æ¥è§£å†³åºå·å›ç»•çš„é—®é¢˜&lt;/strong&gt;(éœ€è¦å¼€å¯&lt;code&gt;tcp_timestamps&lt;/code&gt;)ï¼Œå…¶å®å°±æ˜¯åŒ…åºå·é…åˆä¸Šæ—¶é—´æˆ³ï¼Œåˆ¤æ–­æ—¶é—´æˆ³æ˜¯å¦æ˜¯é€’å¢çš„ï¼Œæ¥è§£å†³åºå·å›ç»•é—®é¢˜ï¼Œæ¯”å¦‚å›ç»•æ—¶ï¼Œæ–°è€åºå·ä¸ä¸€æ ·ï¼Œæ–°åºå·ä»0å¼€å§‹ï¼Œè€åºå·æ˜¯æœ€å¤§å€¼ï¼Œæ­¤æ—¶é…åˆä¸Šæ—¶é—´æˆ³ï¼Œå°±èƒ½æ£€æŸ¥å‡ºæ¥åŒ…æ˜¯å¦å¯ä»¥è¢«æ¥æ”¶ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;serverç«¯å¤šå‡ºä¸€ä¸ªçŠ¶æ€ï¼Œç”¨æ¥æ£€æŸ¥clientç«¯æ˜¯å¦æ¥æ”¶åˆ°è‡ªå·±çš„æŠ¥æ–‡ï¼Œä»è€Œ&lt;strong&gt;é¿å…å®¢æˆ·ç«¯é‡å¤å»ºç«‹è¿æ¥ï¼Œé€ æˆä¸å¿…è¦çš„èµ„æºæµªè´¹&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;ä¸ä½¿ç”¨ä¸¤æ¬¡æ¡æ‰‹è¿›è¡Œè¿æ¥çš„åŸå› &#34;&gt;ä¸ä½¿ç”¨ä¸¤æ¬¡æ¡æ‰‹è¿›è¡Œè¿æ¥çš„åŸå› &lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å› ä¸ºä¸¤æ¬¡æ¡æ‰‹ï¼Œåªä¿è¯ä¸€æ–¹çš„åˆå§‹åºå·èƒ½è¢«å¯¹æ–¹æˆåŠŸæ¥æ”¶ï¼ŒåŒæ–¹æ— æ³•ç¡®è®¤å¯¹æ–¹æ”¶åˆ°äº†è‡ªå·±çš„åºå·&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;å¦‚æœä¸¤æ¬¡æ¡æ‰‹ç¡®å®šè¿æ¥ï¼Œclientå‘é€è¿æ¥è¯·æ±‚ç»™serverï¼Œserveræ¥æ”¶åå‘é€å“åº”ç»™clientï¼Œæ­¤æ—¶è¿æ¥å»ºç«‹ï¼Œclientå¯ä»¥æ­£å¸¸çš„å‘é€å’Œæ¥æ”¶ï¼Œä½†æ˜¯serverå¹¶ä¸çŸ¥é“è‡ªå·±å‘é€çš„è¯·æ±‚clientæœ‰æ²¡æœ‰æ”¶åˆ°ï¼Œæ­¤æ—¶serverç«¯æ— æ³•ç¡®è®¤è‡ªå·±çš„åºå·ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å› ä¸ºä¸¤æ¬¡æ¡æ‰‹ï¼Œserverç«¯æ²¡æœ‰ä¸­é—´çŠ¶æ€ç»™å®¢æˆ·ç«¯æ¥é˜»æ­¢å†å²è¿æ¥&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;å¦‚æœclientå‘é€è¿æ¥è¯·æ±‚ç»™serverï¼Œserveræ”¶åˆ°è¿æ¥è¯·æ±‚ï¼Œå“åº”å›å»åå°±å»ºç«‹è¿æ¥ï¼Œæ„å‘³ç€è¿™æ—¶åŒæ–¹å¯ä»¥äº’å‘æ•°æ®ï¼Œä½†å¦‚æœæ­¤æ—¶å®¢æˆ·ç«¯æ²¡æœ‰è¿›å…¥ESTABLISHEDçŠ¶æ€ï¼Œé‡å¤å‘èµ·è¿æ¥ï¼Œserverç«¯æ— æ³•åˆ†è¾¨æ˜¯æ•°æ®åŒ…è¿˜æ˜¯è¿æ¥åŒ…ã€‚ï¼ˆå› ä¸ºæ­¤æ—¶serverç«¯å·²ç»è®¤ä¸ºåŒæ–¹å¯ä»¥äº’å‘æ•°æ®åŒ…äº†ï¼Œserverç«¯åªæœ‰åœ¨æ”¶åˆ°RSTæŠ¥æ–‡æ‰ä¼šæ–­å¼€è¿æ¥ï¼Œæœ¬è´¨ä¸Šè¿˜æ˜¯æ²¡æœ‰ç¡®è®¤åŒ…åºå·å¯¼è‡´çš„é—®é¢˜ï¼‰&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å› ä¸ºä¸¤æ¬¡æ¡æ‰‹ï¼Œå¦‚æœserverç«¯æ¯æ”¶åˆ°SYNå°±å»ºç«‹è¿æ¥ï¼Œä¼šå¯¼è‡´å»ºç«‹å¤šä¸ªå†—ä½™çš„æ— æ•ˆè¿æ¥ï¼Œé€ æˆèµ„æºæµªè´¹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;å› ä¸ºserverç«¯æ²¡æœ‰ä¸­é—´çŠ¶æ€æ¥æ£€æµ‹clientç«¯æ˜¯å¦æ¥æ”¶åˆ°è‡ªå·±å›å¤çš„ACKï¼Œå¦‚æœclientç«¯é‡å¤å‘é€å¤šä¸ªSYNæŠ¥æ–‡ï¼Œè€Œserverç«¯æ¯æ¬¡æ”¶åˆ°SYNå°±å»ºç«‹è¿æ¥ï¼Œå°±ä¼šå»ºç«‹å¤šä¸ªå†—ä½™çš„æ— æ•ˆè¿æ¥ï¼Œé€ æˆèµ„æºæµªè´¹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦å¤–ï¼Œä¸‰æ¬¡æ¡æ‰‹æ˜¯å› ä¸ºç¬¬äºŒæ¬¡æ¡æ‰‹çš„æ—¶å€™ï¼Œserveræ”¶åˆ°clientçš„è¯·æ±‚å’Œè‡ªå·±çš„è¯·æ±‚ä¸€æ¬¡æ€§å“åº”å›äº†clientï¼Œä¹Ÿå¯ä»¥æŠŠè¿™ä¸€æ­¥æ‹†å‡ºæ¥ï¼Œå˜æˆå››æ¬¡æ¡æ‰‹ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œä¸‰æ¬¡æ˜¯è‡³å°‘çš„è¦æ±‚ã€‚å››æ¬¡æŒ¥æ‰‹çš„ç¬¬äºŒå’Œä¸‰æ¬¡ä¸èƒ½åˆå¹¶æ˜¯å› ä¸ºæ­¤å‰è¿æ¥å·²å»ºç«‹ï¼Œè´¸ç„¶å…³é—­ä¼šå¯¼è‡´éƒ¨åˆ†æŠ¥æ–‡æ²¡æœ‰æ¥å—å®Œæˆã€‚&lt;/p&gt;
&lt;h3 id=&#34;ä¼ è¾“æ—¶tcpå±‚ä½¿ç”¨mssåˆ†åŒ…çš„åŸå› &#34;&gt;ä¼ è¾“æ—¶ï¼ŒTCPå±‚ä½¿ç”¨MSSåˆ†åŒ…çš„åŸå› &lt;/h3&gt;
&lt;p&gt;MSSç”¨äºTCPåˆ†ç‰‡ï¼Œæè¿°ä¸€ä¸ªç½‘ç»œåŒ…èƒ½å®¹çº³çš„TCPæ•°æ®çš„æœ€å¤§é•¿åº¦ï¼Œä¸€èˆ¬æ¥è¯´ï¼ŒTCPå»ºç«‹è¿æ¥æ—¶ï¼Œä¼šåå•†åŒæ–¹çš„MSSå€¼ï¼Œå¦‚æœæ•°æ®åŒ…è¶…è¿‡MSSå€¼ï¼Œå°±éœ€è¦è¿›è¡Œåˆ†ç‰‡ï¼Œç”±å®ƒå½¢æˆçš„IPåŒ…é•¿åº¦ä¹Ÿä¸ä¼šå¤§äºMTUï¼ˆ1500å­—èŠ‚ï¼‰ï¼Œä»¥MSSä¸ºå•ä½è¿›è¡Œåˆ†ç‰‡ä¼ è¾“ï¼Œè¿™æ ·çš„å¥½å¤„æ˜¯é‡ä¼ æ—¶åªéœ€é‡ä¼ ç‰¹å®šåˆ†ç‰‡ï¼Œä¸ç”¨é‡ä¼ æ‰€æœ‰åˆ†ç‰‡ï¼Œå¢åŠ é‡ä¼ çš„æ•ˆç‡ã€‚è™½ç„¶æœ¬èº«IPå±‚ä¹Ÿèƒ½åˆ†åŒ…ï¼Œä½†æ˜¯ç”±äºIPå±‚å¹¶æ²¡æœ‰è¶…æ—¶é‡ä¼ æœºåˆ¶ï¼Œå¦‚æœä¸€ä¸ªIPåˆ†ç‰‡ä¸¢å¤±ï¼Œä¼šå¯¼è‡´æ•´ä¸ªIPæŠ¥æ–‡çš„æ‰€æœ‰åˆ†ç‰‡éƒ½éœ€è¦é‡ä¼ ã€‚&lt;/p&gt;
&lt;h3 id=&#34;è¿æ¥è¿‡ç¨‹ä¸­è¶…æ—¶æˆ–è€…æ¡æ‰‹ä¸¢å¤±æ€ä¹ˆåŠ&#34;&gt;è¿æ¥è¿‡ç¨‹ä¸­è¶…æ—¶æˆ–è€…æ¡æ‰‹ä¸¢å¤±æ€ä¹ˆåŠï¼Ÿ&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;ç¬¬ä¸€æ¬¡æ¡æ‰‹è¶…æ—¶æˆ–ä¸¢å¤±ï¼Œæ­¤æ—¶serverç«¯æ²¡æœ‰å“åº”SYN-ACKå›å»ï¼Œclientç«¯è‹¦è‹¦ç­‰å¾…ï¼Œå°±ä¼šè§¦clientç«¯çš„è¶…æ—¶é‡ä¼ æœºåˆ¶ï¼Œé‡ä¼ SYNæŠ¥æ–‡ï¼Œé‡ä¼ çš„SYNæŠ¥æ–‡åºå·è·Ÿä¹‹å‰ä¸€æ ·ã€‚Linuxä¸‹é‡è¯•æ¬¡æ•°æ˜¯5æ¬¡ï¼Œç¬¬ä¸€æ¬¡è¶…æ—¶é‡ä¼ æ˜¯1ç§’åï¼Œç¬¬äºŒæ¬¡ä¸¤ç§’ï¼Œ&lt;strong&gt;æ¯æ¬¡è¶…æ—¶çš„æ—¶é—´æ˜¯ä¸Šä¸€æ¬¡çš„ 2 å€&lt;/strong&gt;ï¼Œå¦‚æœ5æ¬¡éƒ½è¶…æ—¶ï¼Œæ€»å…±è¦ç­‰ç­‰63sï¼ŒTCPæ‰ä¼šæ–­å¼€è¿æ¥ï¼›&lt;/li&gt;
&lt;li&gt;ç¬¬äºŒæ¬¡æ¡æ‰‹è¶…æ—¶æˆ–ä¸¢å¤±ï¼Œè™½ç„¶serverç«¯å“åº”äº†SYN-ACKç»™å®¢æˆ·ç«¯äº†ï¼Œä½†æ˜¯clientç«¯æ”¶ä¸åˆ°ï¼Œæ­¤æ—¶clientä¼šè·Ÿä¸Šé¢çš„ä¸€æ ·ï¼Œè¿›è¡Œè¶…æ—¶é‡ä¼ SYNæŠ¥æ–‡ï¼ˆç»§ç»­ç¬¬ä¸€æ¬¡æ¡æ‰‹ï¼‰ï¼›è€Œserverç«¯å› ä¸ºè¿Ÿè¿Ÿæ”¶ä¸åˆ°clientç«¯çš„ACKï¼Œä¹Ÿä¼šè§¦å‘è¶…æ—¶é‡ä¼ ï¼Œé‡ä¼ SYN-ACKæŠ¥æ–‡ï¼ˆç»§ç»­ç¬¬äºŒæ¬¡æ¡æ‰‹ï¼‰ã€‚Linuxä¸‹ä¹Ÿæ˜¯é‡è¯•5æ¬¡ï¼Œæœºåˆ¶è·Ÿä¸Šé¢ä¸€æ ·ï¼›&lt;/li&gt;
&lt;li&gt;ç¬¬ä¸‰æ¬¡æ¡æ‰‹è¶…æ—¶æˆ–ä¸¢å¤±ï¼Œç”±äºACKä¸ä¼šé‡ä¼ ï¼Œæ­¤æ—¶æ˜¯serverç«¯è§¦å‘è¶…æ—¶é‡ä¼ ï¼Œé‡ä¼ SYN-ACKï¼Œç›´åˆ°æ”¶åˆ°ç¬¬ä¸‰æ¬¡æ¡æ‰‹æˆ–è¾¾åˆ°æœ€å¤§é‡ä¼ æ¬¡æ•°ï¼ˆç»§ç»­ç¬¬äºŒæ¬¡æ¡æ‰‹ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;SYNæŠ¥æ–‡è¢«ä¸¢å¼ƒå¯èƒ½çš„åŸå› ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;PAWSæœºåˆ¶ + NATç¯å¢ƒä¸‹ï¼Œå› ä¸ºclientç«¯Aå’ŒBé€šè¿‡NATç½‘å…³ä¸serverç«¯å»ºç«‹è¿æ¥ï¼Œåœ¨serverç«¯çœ‹æ¥ï¼Œclientç«¯å…¶å®æ˜¯åŒä¸€ä¸ªï¼Œæ­¤æ—¶å¦‚æœclientç«¯Aå’ŒBéƒ½å¼€å¯äº†PAWSæœºåˆ¶ï¼Œæ•°æ®åŒ…å¸¦æœ‰æ—¶é—´æˆ³æœ‰å…ˆåé¡ºåºï¼Œå°±ä¼šå¯¼è‡´serverç«¯ä¸¢å¼ƒclientçš„æ•°æ®åŒ…äº†ï¼›&lt;/li&gt;
&lt;li&gt;åŠè¿æ¥é˜Ÿåˆ— / å…¨è¿æ¥é˜Ÿåˆ— æ»¡äº†ï¼Œæ­¤æ—¶åæ¥çš„SYNåŒ…éƒ½ä¼šè¢«ä¸¢å¼ƒï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;å·²å»ºç«‹è¿æ¥ä½†é‡å¤æ¥æ”¶synåŒ…ä¼šæ€ä¹ˆæ ·&#34;&gt;å·²å»ºç«‹è¿æ¥ä½†é‡å¤æ¥æ”¶SYNåŒ…ä¼šæ€ä¹ˆæ ·&lt;/h3&gt;
&lt;p&gt;å½“clientç«¯ä¸serverç«¯å»ºç«‹è¿æ¥åï¼Œclientç«¯å®•æœºé‡å¯ï¼Œå†æ¬¡å‘èµ·SYNè¿æ¥ï¼ˆå››å…ƒç»„ç›¸åŒï¼‰ï¼Œä½†serverç«¯ä»ç„¶å¤„äºä¸Šä¸€ä¸ªè¿æ¥çš„ESTABLISHEDçŠ¶æ€ï¼Œå› ä¸ºæŠ¥æ–‡åºå·çš„åŸå› ï¼Œæ­¤æ—¶serverç«¯èƒ½çŸ¥é“æ­¤æŠ¥æ–‡å·ä¸æ˜¯è‡ªå·±æœŸæœ›çš„ï¼Œé‚£å°±ä¼šå›å¤ä¸€ä¸ªæºå¸¦äº†æ­£ç¡®åºå·å’Œç¡®è®¤å·çš„ACKæŠ¥æ–‡ï¼ˆChallenge ACKï¼Œæºå¸¦äº†serverç«¯ä¸‹ä¸€æ¬¡æƒ³è¦æ¥æ”¶çš„åºå·ï¼‰ï¼Œclientç«¯æ”¶åˆ°è¿™ä¸ªChallenge ACKåï¼Œå‘ç°ç¡®è®¤å·ä¸æ˜¯è‡ªå·±æœŸæœ›çš„ï¼Œå°±ä¼šå›å¤RSTæŠ¥æ–‡ï¼Œserverç«¯æ”¶åˆ°åå°±ä¼šé‡Šæ”¾æ‰è¯¥è¿æ¥ã€‚&lt;/p&gt;
&lt;p&gt;Challenge ACKçš„ä½œç”¨æ˜¯å‘Šè¯‰å‘é€æ–¹æŠ¥æ–‡çš„åºå·æ˜¯é”™è¯¯çš„ï¼Œå¹¶ç»™å‘é€æ–¹æ­£ç¡®çš„åŒ…åºå·ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å¦‚ä½•å…³é—­è¿æ¥&#34;&gt;å¦‚ä½•å…³é—­è¿æ¥&lt;/h3&gt;
&lt;p&gt;serverç«¯å…³é—­è¿æ¥æ—¶ï¼Œå¦‚æœè´¸ç„¶å…³é—­æ•´ä¸ªserverç«¯ï¼Œä¼šå¯¼è‡´æ‰€æœ‰è¿æ¥åˆ°æ­¤serverç«¯çš„clientç«¯éƒ½æ–­å¼€ï¼Œæœ€ä½³å®è·µæ˜¯å¯ä»¥å•ç‹¬å…³é—­æ¯ä¸€æ¡TCPè¿æ¥ï¼ŒåŸç†å°±æ˜¯ä¼ªé€ ä¸€ä¸ªSYNåŒ…å‘é€ç»™serverç«¯ï¼Œè·å–Challenge ACKï¼Œåå‘åˆ¶ä½œå‡ºRSTæŠ¥æ–‡ï¼Œåˆ†åˆ«å‘é€ç»™clientç«¯å’Œserverç«¯ï¼Œè®©åŒæ–¹æ–­å¼€è¿æ¥ã€‚&lt;/p&gt;
&lt;p&gt;TCPå¦‚æœå‘ç°åˆ°è¾¾çš„æŠ¥æ–‡åºå·å¯¹äºå½“å‰çš„è¿æ¥æ˜¯ä¸æ­£ç¡®çš„ï¼Œå°±ä¼šå‘é€ä¸€ä¸ªRSTé‡ç½®æŠ¥æ–‡ï¼Œä»è€Œä½¿å¾—è¿æ¥æ–­å¼€ï¼Œå› æ­¤ï¼ŒTCPå¯¹RSTé‡ç½®æŠ¥æ–‡çš„åºå·è¦æ±‚å¾ˆä¸¥æ ¼ï¼Œä¸€å®šè¦ç­‰äºä¸‹ä¸€ä¸ªé¢„æœŸæ¥æ”¶åŒ…çš„åºå·ï¼ˆå¯ä»¥åˆ©ç”¨challenge ACKå®ç°ï¼‰ï¼Œæ‰èƒ½è¿›è¡Œé‡ç½®ï¼Œæ–­å¼€è¿æ¥ã€‚TCPé‡ç½®æ”»å‡»çš„åŸç†ï¼Œå°±æ˜¯ä¸æ–­å‘TCPå‘é€RSTåŒ…ï¼Œè®©æ­£å¸¸çš„TCPè¿æ¥æ–­å¼€ï¼Œè§£å†³æ–¹æ¡ˆæ˜¯IPå±‚ä½¿ç”¨IPsecåè®®ï¼Œé€šè¿‡åŠ å¯†å’Œè®¤è¯çš„æ–¹å¼åˆ¤æ–­æ•°æ®æ¥æºã€‚&lt;/p&gt;
&lt;h3 id=&#34;å»ºç«‹è¿æ¥åå‡ºæ•…éšœäº†æ€ä¹ˆåŠ&#34;&gt;å»ºç«‹è¿æ¥åå‡ºæ•…éšœäº†æ€ä¹ˆåŠï¼Ÿ&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;TCPè®¾æœ‰ä¸€ä¸ªä¿æ´»è®¡æ—¶å™¨ï¼Œæ¯æ”¶åˆ°ä¸€æ¬¡è¯·æ±‚éƒ½ä¼šå¤ä½è¿™ä¸ªè®¡æ—¶å™¨ï¼Œserverç«¯åœ¨ä¸€æ®µæ—¶é—´å†…æ²¡æœ‰è¿›è¡Œæ•°æ®äº¤äº’æ—¶ï¼Œå°±ä¼šè§¦å‘è¿™å¥—keep-aliveæœºåˆ¶ï¼Œå¦‚æœè§„å®šæ—¶é—´(2å°æ—¶)å†…æ²¡æ”¶åˆ°ï¼Œåˆ™å‘é€æ¢æµ‹æŠ¥æ–‡æµ‹è¯•å¯¹æ–¹æ˜¯å¦å‡ºç°æ•…éšœï¼Œè¿ç»­10æ¬¡/75åˆ†é’Ÿï¼Œä»æ²¡ååº”ï¼Œè¯´æ˜å¯¹æ–¹æ•…éšœï¼›&lt;/p&gt;
&lt;p&gt;å¦‚æœæ²¡æœ‰å¼€å¯è¿™ä¸ªæœºåˆ¶ï¼Œserverç«¯å°±è¿˜æ˜¯ä¸€ç›´ä¿æŒåœ¨ESTABLESHEDçŠ¶æ€ï¼›&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªæœºåˆ¶ä¸»è¦æ˜¯æ¢æµ‹å¯¹ç«¯ä¸»æœºæ˜¯å¦å®•æœºé‡å¯çš„åœºæ™¯ï¼Œå¦‚æœæ˜¯å¯¹ç«¯åº”ç”¨è¿›ç¨‹å´©æºƒçš„ï¼Œå› ä¸ºTCPè¿æ¥æ˜¯ç”±æ“ä½œç³»ç»Ÿå†…æ ¸ç»´æŠ¤çš„ï¼Œèƒ½æ„ŸçŸ¥åˆ°å¹¶è¿›è¡Œèµ„æºå›æ”¶ï¼Œè¿›å…¥å››æ¬¡æŒ¥æ‰‹æµç¨‹æ–­å¼€è¿æ¥ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¦‚æœclientç«¯å®•æœºåé‡å¯ï¼Œè¿˜æ”¶åˆ°äº†ä¹‹å‰TCPè¿æ¥çš„æŠ¥æ–‡ï¼Œå°±ä¼šå›å¤RSTæŠ¥æ–‡ï¼Œæ–­å¼€è¿æ¥ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¦‚æœclientç«¯å®•æœºåæ²¡æœ‰é‡å¯ï¼Œserverç«¯å‘é€æ•°æ®æ”¶ä¸åˆ°ACKï¼Œä¼šè¿›è¡Œè¶…æ—¶é‡ä¼ ï¼Œç›´è‡³è¾¾åˆ°ä¸Šé™ï¼Œæ–­å¼€è¿æ¥ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;syn-floodæ”»å‡»çš„å…³ç³»&#34;&gt;SYN Floodæ”»å‡»çš„å…³ç³»&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;TCPä¸‰æ¬¡æ¡æ‰‹æ—¶ï¼Œå®¢æˆ·ç«¯å‘é€SYNåˆ°æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯æ”¶åˆ°ä¹‹åï¼Œä¾¿å›å¤&lt;strong&gt;ACKå’ŒSYN&lt;/strong&gt;ï¼ŒçŠ¶æ€ç”±&lt;strong&gt;LISTENå˜ä¸ºSYN_RCVD&lt;/strong&gt;ï¼Œæ­¤æ—¶è¿™ä¸ªè¿æ¥å°±è¢«æ¨å…¥äº†åŠè¿æ¥é˜Ÿåˆ—ã€‚&lt;/p&gt;
&lt;p&gt;å½“å®¢æˆ·ç«¯å›å¤ACK, æœåŠ¡ç«¯æ¥æ”¶åï¼Œä¸‰æ¬¡æ¡æ‰‹å°±å®Œæˆäº†ã€‚è¿™æ—¶è¿æ¥ä¼šç­‰å¾…è¢«å…·ä½“çš„åº”ç”¨å–èµ°ï¼Œåœ¨è¢«å–èµ°ä¹‹å‰ï¼Œå®ƒè¢«æ¨å…¥ACCEPTé˜Ÿåˆ—ï¼Œå³å…¨è¿æ¥é˜Ÿåˆ—ã€‚&lt;/p&gt;
&lt;p&gt;SYN Floodæ”»å‡»ï¼Œåœ¨çŸ­æ—¶é—´å†…ï¼Œä¼ªé€ &lt;strong&gt;ä¸å­˜åœ¨çš„IPåœ°å€&lt;/strong&gt;ï¼Œå‘æœåŠ¡å™¨å¤§é‡å‘èµ·SYNæŠ¥æ–‡ã€‚å½“æœåŠ¡å™¨å›å¤SYN+ACKæŠ¥æ–‡åï¼Œä¸ä¼šæ”¶åˆ°ACKå›åº”æŠ¥æ–‡ï¼Œå¯¼è‡´æœåŠ¡å™¨ä¸Šå»ºç«‹å¤§é‡çš„åŠè¿æ¥åŠè¿æ¥é˜Ÿåˆ—æ»¡äº†ï¼Œæ­¤æ—¶æœåŠ¡å™¨å°±æ— æ³•å¤„ç†æ­£å¸¸çš„TCPè¯·æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;åº”å¯¹æ–¹æ¡ˆï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è°ƒå¤§&lt;code&gt;netdev_max_baklog&lt;/code&gt;&lt;/strong&gt;ï¼Œè¯¥å‚æ•°ç”¨äºå½“ç½‘å¡æ¥æ”¶æ•°æ®åŒ…çš„é€Ÿåº¦å¤§äºå†…æ ¸å¤„ç†é€Ÿåº¦æ—¶ï¼Œç”¨ä¸€ä¸ªé˜Ÿåˆ—ä¿å­˜è¿™äº›æ•°æ®åŒ…ï¼Œé»˜è®¤æ˜¯1000ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¢å¤§TCPåŠè¿æ¥é˜Ÿåˆ—çš„é•¿åº¦&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å‡å°‘SYN+ACKé‡ä¼ çš„æ¬¡æ•°&lt;/strong&gt;ï¼šå—åˆ°SYN Floodæ”»å‡»ï¼Œä¼šæœ‰å¤§é‡å¤„äºSYN_REVCçŠ¶æ€çš„TCPè¿æ¥ï¼Œå¤„äºè¿™ä¸ªçŠ¶æ€ä¼šé‡ä¼ SYN+ACKï¼Œé€šè¿‡å‡å°‘å…¶é‡è¯•æ¬¡æ•°ä¸Šé™ï¼Œæ¥å¿«é€Ÿå…³é—­è¿æ¥ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¼€å¯&lt;code&gt;net.ipv4.tcp_syncookies&lt;/code&gt;&lt;/strong&gt;ï¼šåœ¨æ”¶åˆ°SYNåŒ…åï¼ŒæœåŠ¡å™¨æ ¹æ®ä¸€å®šçš„æ–¹æ³•ï¼Œä»¥æ•°æ®åŒ…çš„æºåœ°å€ã€ç«¯å£ç­‰ä¿¡æ¯ä¸ºå‚æ•°è®¡ç®—å‡ºä¸€ä¸ªcookieå€¼ä½œä¸ºè‡ªå·±çš„SYNACKåŒ…çš„åºåˆ—å·ï¼Œå›å¤SYN+ACKåï¼ŒæœåŠ¡å™¨å¹¶ä¸ç«‹å³åˆ†é…èµ„æºè¿›è¡Œå¤„ç†ï¼Œç­‰æ”¶åˆ°å‘é€æ–¹çš„ACKåŒ…åï¼Œé‡æ–°æ ¹æ®æ•°æ®åŒ…çš„æºåœ°å€ã€ç«¯å£è®¡ç®—è¯¥åŒ…ä¸­çš„ç¡®è®¤åºåˆ—å·æ˜¯å¦æ­£ç¡®ï¼Œå¦‚æœæ­£ç¡®åˆ™å»ºç«‹è¿æ¥ï¼Œå¦åˆ™ä¸¢å¼ƒè¯¥åŒ…ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;SYN Proxyé˜²ç«å¢™&lt;/strong&gt;ï¼šæœåŠ¡å™¨é˜²ç«å¢™ä¼šå¯¹æ”¶åˆ°çš„æ¯ä¸€ä¸ªSYNæŠ¥æ–‡è¿›è¡Œä»£ç†å’Œå›åº”ï¼Œå¹¶ä¿æŒåŠè¿æ¥ã€‚ç­‰å‘é€æ–¹å°†ACKåŒ…è¿”å›åï¼Œå†é‡æ–°æ„é€ SYNåŒ…å‘åˆ°æœåŠ¡å™¨ï¼Œå»ºç«‹çœŸæ­£çš„TCPè¿æ¥ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;å…³é—­è¿æ¥---å››æ¬¡æŒ¥æ‰‹&#34;&gt;å…³é—­è¿æ¥ - å››æ¬¡æŒ¥æ‰‹&lt;/h2&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/%e5%9b%9b%e6%ac%a1%e6%8c%a5%e6%89%8b.jpg&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/%e5%9b%9b%e6%ac%a1%e6%8c%a5%e6%89%8b.jpg&#34;
			
			
			
			loading=&#34;lazy&#34;
			alt=&#34;å››æ¬¡æŒ¥æ‰‹&#34;&gt;
	&lt;/a&gt;
	
	&lt;figcaption&gt;å››æ¬¡æŒ¥æ‰‹&lt;/figcaption&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ç¬¬ä¸€æ¬¡æŒ¥æ‰‹ï¼šClientå‘é€ä¸€ä¸ªFINã€ä¸€ä¸ªseqï¼Œç”¨æ¥å…³é—­Clientåˆ°Serverçš„æ•°æ®ä¼ é€ï¼ŒClientè¿›å…¥FIN_WAIT_1çŠ¶æ€ã€‚&lt;/li&gt;
&lt;li&gt;ç¬¬äºŒæ¬¡æŒ¥æ‰‹ï¼šServeræ”¶åˆ°FINåï¼Œå‘é€ä¸€ä¸ªACKç»™Clientï¼Œç¡®è®¤åºå·ackä¸ºæ”¶åˆ°seq+1ï¼ˆä¸SYNç›¸åŒï¼Œä¸€ä¸ªFINå ç”¨ä¸€ä¸ªåºå·ï¼‰ï¼ŒServerè¿›å…¥CLOSE_WAITçŠ¶æ€ã€‚&lt;/li&gt;
&lt;li&gt;ç¬¬ä¸‰æ¬¡æŒ¥æ‰‹ï¼šServerå‘é€ä¸€ä¸ªFINã€ä¸€ä¸ªACKã€ackä¸ºä¸Šé¢çš„seq+1ã€ä¸€ä¸ªseqï¼Œç”¨æ¥å…³é—­Serveråˆ°Clientçš„æ•°æ®ä¼ é€ï¼ŒServerè¿›å…¥LAST_ACKçŠ¶æ€ã€‚&lt;/li&gt;
&lt;li&gt;ç¬¬å››æ¬¡æŒ¥æ‰‹ï¼šClientæ”¶åˆ°FINåï¼ŒClientè¿›å…¥TIME_WAITçŠ¶æ€ï¼ˆç­‰å¾…æ—¶é—´è®¾ä¸º2MSLï¼Œå³æŠ¥æ–‡æœ€å¤§ç”Ÿå­˜æ—¶é—´ï¼‰ï¼Œæ¥ç€å‘é€ä¸€ä¸ªACKç»™Serverï¼Œç¡®è®¤åºå·ä¸ºæ”¶åˆ°åºå·+1ï¼ŒServerè¿›å…¥CLOSEDçŠ¶æ€ï¼Œå®Œæˆå››æ¬¡æŒ¥æ‰‹ï¼ŒServerä¼šæ¯”Clientæ—©ä¸€ç‚¹å…³é—­TCPè¿æ¥ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ç”±äºTCPè¿æ¥æ˜¯å…¨åŒå·¥çš„ï¼Œå› æ­¤ï¼Œæ¯ä¸ªæ–¹å‘éƒ½å¿…é¡»è¦å•ç‹¬è¿›è¡Œå…³é—­ã€‚è¿™ä¸€åŸåˆ™æ˜¯å½“ä¸€æ–¹å®Œæˆæ•°æ®å‘é€ä»»åŠ¡åï¼Œå‘é€ä¸€ä¸ªFINæ¥ç»ˆæ­¢è¿™ä¸€æ–¹å‘çš„è¿æ¥ï¼Œ&lt;strong&gt;æ”¶åˆ°ä¸€ä¸ªFINåªæ˜¯æ„å‘³ç€è¿™ä¸€æ–¹å‘ä¸Šæ²¡æœ‰æ•°æ®æµåŠ¨äº†ï¼Œå³ä¸ä¼šå†æ”¶åˆ°æ–°æ•°æ®äº†ï¼ˆä½†ä»ç„¶å¯èƒ½æ”¶åˆ°åœ¨é€”çš„æ•°æ®ï¼‰&lt;/strong&gt;ï¼Œä½†æ˜¯åœ¨è¿™ä¸ªTCPè¿æ¥ä¸Šä»ç„¶èƒ½å¤Ÿå‘é€æ•°æ®ï¼Œç›´åˆ°è¿™ä¸€æ–¹å‘ä¹Ÿå‘é€äº†FINã€‚é¦–å…ˆè¿›è¡Œå…³é—­çš„ä¸€æ–¹å°†æ‰§è¡Œä¸»åŠ¨å…³é—­ï¼Œè€Œå¦ä¸€æ–¹åˆ™æ‰§è¡Œè¢«åŠ¨å…³é—­ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å…³é—­è¿æ¥éœ€è¦å››æ¬¡æŒ¥æ‰‹çš„åŸå› &#34;&gt;å…³é—­è¿æ¥éœ€è¦å››æ¬¡æŒ¥æ‰‹çš„åŸå› &lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å››æ¬¡æŒ¥æ‰‹ï¼šç¬¬ä¸€æ¬¡æŒ¥æ‰‹Clientå‘é€æ¶ˆæ¯ç¡®å®šClientæƒ³å…³é—­è¿æ¥ï¼Œç¬¬äºŒæ¬¡æŒ¥æ‰‹Serverå‘é€æ¶ˆæ¯ç¡®å®šClientå¯ä»¥å…³é—­è¿æ¥ï¼Œç¬¬ä¸‰æ¬¡æŒ¥æ‰‹Serverå‘é€æ¶ˆæ¯ç¡®å®šServeræƒ³å…³é—­è¿æ¥ï¼Œç¬¬å››æ¬¡æŒ¥æ‰‹Clientå‘é€æ¶ˆæ¯ç¡®å®šServerå¯ä»¥å…³é—­è¿æ¥ï¼Œå°‘äº†å“ªä¸€æ¬¡éƒ½å¯èƒ½å¯¼è‡´æ²¡æœ‰å®Œå…¨å…³é—­ï¼Œé€ æˆä¸€æ–¹å¯å‘é€æˆ–è€…æ¥æ”¶ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¹‹æ‰€ä»¥è¦å››æ¬¡ï¼Œæ˜¯å› ä¸ºserveræ”¶åˆ°FINåï¼Œä¸èƒ½åŒæ—¶å‘é€ACKç¡®è®¤ä¿¡å·å’ŒFINï¼Œ&lt;strong&gt;æœ‰å¯èƒ½æ­¤æ—¶clientæœ‰ä¸€äº›æŠ¥æ–‡è¿˜æ²¡æ”¶å®Œï¼Œå¦‚æœclientæ²¡æœ‰æ”¶åˆ°ï¼Œserveræ‰æœ‰èƒ½é‡å‘&lt;/strong&gt;ï¼Œæ‰€ä»¥ç¬¬äºŒã€ä¸‰æ¬¡æŒ¥æ‰‹ä¸èƒ½åˆå¹¶ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å…³é—­è¿æ¥æ—¶ï¼Œ&lt;strong&gt;å½“æ”¶åˆ°å¯¹æ–¹çš„FINæŠ¥æ–‡æ—¶ï¼Œä»…ä»…è¡¨ç¤ºå¯¹æ–¹ä¸å†å‘é€æ–°æ•°æ®&lt;/strong&gt;ï¼Œä½†å¯¹æ–¹è¿˜èƒ½å‘é€æ—§æ•°æ®æˆ–æ¥æ”¶æ•°æ®ï¼Œå·±æ–¹ä¹Ÿæœªå¿…æŠŠå…¨éƒ¨æ•°æ®éƒ½å‘é€ç»™å¯¹æ–¹äº†ï¼Œæ‰€ä»¥å·±æ–¹å…ˆå‘é€ACKï¼Œå‘ŠçŸ¥å¯¹æ–¹æˆ‘çŸ¥é“ä½ ä¸ä¼šå†å‘é€æ–°æ•°æ®ï¼Œä¹‹åå·±æ–¹è¿˜ä»ç„¶å¯ä»¥å‘é€ä¸€äº›æ•°æ®ç»™å¯¹æ–¹ï¼Œå†å‘é€FINæŠ¥æ–‡ç»™å¯¹æ–¹æ¥è¡¨ç¤ºåŒæ„ç°åœ¨å…³é—­è¿æ¥ï¼Œå› æ­¤ï¼Œå·±æ–¹çš„ACKå’ŒFINä¸€èˆ¬éƒ½ä¼šåˆ†å¼€å‘é€ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ­£å¸¸æƒ…å†µä¸‹ï¼Œæ˜¯å¦å‘é€ç¬¬ä¸‰æ¬¡æŒ¥æ‰‹çš„æ§åˆ¶æƒä¸åœ¨å†…æ ¸ï¼Œè€Œåœ¨è¢«åŠ¨å…³é—­æ–¹çš„åº”ç”¨å±‚ï¼Œå–å†³äºå…¶ä»€ä¹ˆæ—¶å€™è°ƒç”¨å…³é—­å‡½æ•°ï¼Œè°ƒç”¨äº†å…³é—­å‡½æ•°ï¼Œæ‰ä¼šå‘ç¬¬äºŒä¸ªFINï¼Œåœ¨å…³é—­ä¹‹å‰ï¼Œè¿˜å¯ä»¥ç»§ç»­å‘é€æ•°æ®ï¼Œæ‰€ä»¥äºŒä¸‰æ¬¡æŒ¥æ‰‹çš„ACKå’ŒFINæ˜¯åˆ†å¼€å‘çš„ã€‚&lt;/p&gt;
&lt;p&gt;å…³é—­å‡½æ•°æœ‰ä¸¤ç§ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;close()å‡½æ•°&lt;/code&gt;ï¼Œä¼šä½¿å¾—socketä¸å†æœ‰å‘é€å’Œæ¥æ”¶çš„èƒ½åŠ›ï¼Œå½“ä½¿ç”¨&lt;code&gt;close()å‡½æ•°&lt;/code&gt;å…³é—­è¿æ¥æ—¶ï¼Œç”±äºä¸å†å…·æœ‰å‘é€å’Œæ¥æ”¶çš„èƒ½åŠ›ï¼Œä¼šç›´æ¥è¿”å›RSTæŠ¥æ–‡ç»™å¯¹æ–¹ï¼Œç„¶åå†…æ ¸é‡Šæ”¾è¿æ¥ï¼Œå±äºç²—æš´å…³é—­ã€‚å½“å®¢æˆ·ç«¯è°ƒç”¨äº†&lt;code&gt;closeå‡½æ•°&lt;/code&gt;ï¼ŒæœåŠ¡ç«¯ç»§ç»­è¯»æ“ä½œï¼Œå°±ä¼šæŠ¥&lt;code&gt;Connection reset by peer&lt;/code&gt;ï¼Œå¦‚æœæ˜¯å†™æ“ä½œï¼Œåˆ™ç¨‹åºä¼šäº§ç”Ÿ&lt;code&gt;SIGPIPE&lt;/code&gt;ä¿¡å·ï¼Œäº¤ç”±åº”ç”¨å±‚ç¨‹åºçš„ä¿¡å·å¤„ç†å™¨å¤„ç†ï¼Œé»˜è®¤æ˜¯è¿›ç¨‹ç»ˆæ­¢é€€å‡ºã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;shutdown()å‡½æ•°&lt;/code&gt;ï¼Œä¼šä½¿socketåªå…³é—­å‘é€æ–¹å‘è€Œä¸å…³é—­è¯»å–æ–¹å‘ï¼Œæ­¤æ—¶ä¼šç»å†å®Œæ•´çš„å››æ¬¡æŒ¥æ‰‹ï¼Œå±äºä¼˜é›…å…³é—­ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åªæœ‰åœ¨ç‰¹å®šåœºæ™¯ä¸‹ï¼Œæ‰ä¼šå‡ºç°ä¸‰æ¬¡æŒ¥æ‰‹ï¼šå½“è¢«åŠ¨å…³é—­æ–¹åœ¨TCPæŒ¥æ‰‹è¿‡ç¨‹ä¸­ï¼Œæ²¡æœ‰æ•°æ®è¦å‘é€ï¼ŒåŒæ—¶æ²¡æœ‰å¼€å¯&lt;code&gt;TCP_QUICKACK, å³å¼€å¯äº†TCPå»¶æ—¶ç¡®è®¤æœºåˆ¶ï¼ˆè¯¥æœºåˆ¶å¯ä»¥ä½¿å¾—ACKå’Œæ•°æ®æŠ¥æ–‡ä¸€èµ·å‘é€ï¼Œæå‡æ•ˆç‡ï¼‰&lt;/code&gt;ï¼Œé‚£ä¹ˆç¬¬äºŒä¸‰æ¬¡æŒ¥æ‰‹å¯ä»¥åˆå¹¶ä¼ è¾“ï¼Œæ­¤æ—¶æ˜¯ä¸‰æ¬¡æŒ¥æ‰‹ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ–­å¼€è¿æ¥è¿‡ç¨‹ä¸­è¶…æ—¶æˆ–è€…æŒ¥æ‰‹ä¸¢å¤±æ€ä¹ˆåŠ&#34;&gt;æ–­å¼€è¿æ¥è¿‡ç¨‹ä¸­è¶…æ—¶æˆ–è€…æŒ¥æ‰‹ä¸¢å¤±æ€ä¹ˆåŠï¼Ÿ&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;ç¬¬ä¸€æ¬¡æŒ¥æ‰‹æ—¶è¶…æ—¶æˆ–ä¸¢å¤±ï¼Œå½“é‡è¯•åˆ°è¾¾ä¸Šé™åï¼Œclientç«¯ä¼šç›´æ¥æ–­å¼€è¿æ¥ï¼›&lt;/li&gt;
&lt;li&gt;ç¬¬äºŒæ¬¡æŒ¥æ‰‹æ—¶è¶…æ—¶æˆ–ä¸¢å¤±ï¼Œç”±äºACKä¸ä¼šé‡ä¼ ï¼Œæ‰€ä»¥æ˜¯clientç«¯è¿›è¡Œç¬¬ä¸€æ¬¡æŒ¥æ‰‹çš„è¶…æ—¶é‡ä¼ ï¼Œå½“é‡è¯•åˆ°è¾¾ä¸Šé™åï¼Œclientç«¯ä¼šç›´æ¥æ–­å¼€è¿æ¥ï¼›&lt;/li&gt;
&lt;li&gt;ç¬¬ä¸‰æ¬¡æŒ¥æ‰‹æ—¶è¶…æ—¶æˆ–ä¸¢å¤±ï¼Œæ­¤æ—¶clientç«¯å¤„äºFIN_WAIT2çŠ¶æ€ï¼Œå¦‚æœclientç«¯æ˜¯è°ƒç”¨closeå‡½æ•°ï¼Œåˆ™è¯¥çŠ¶æ€æœ€å¤šæŒç»­60sï¼Œåˆ°æ—¶ç›´æ¥å…³é—­ï¼›å¦‚æœclientç«¯è°ƒç”¨çš„æ˜¯shutdownå‡½æ•°ï¼Œåˆ™åªå…³é—­äº†å‘é€æ–¹å‘ï¼Œæ­¤æ—¶ä»ç„¶å¯ä»¥æ¥å—æ•°æ®ï¼Œä½†çŠ¶æ€ä¼šä¸€ç›´å¤„äºFIN_WAIT2ï¼›è€Œserverç«¯ä¼šé‡ä¼ FINï¼Œç›´åˆ°åˆ°è¾¾ä¸Šé™ï¼Œserveræ–­å¼€è¿æ¥ï¼›&lt;/li&gt;
&lt;li&gt;ç¬¬å››æ¬¡æŒ¥æ‰‹æ—¶è¶…æ—¶æˆ–ä¸¢å¤±ï¼Œserverç«¯ä¼šè¿›è¡Œè¶…æ—¶é‡ä¼ ï¼Œå½“é‡è¯•åˆ°è¾¾ä¸Šé™åï¼Œserverç«¯ä¼šç›´æ¥æ–­å¼€è¿æ¥ï¼›clientæ­¤æ—¶çš„çŠ¶æ€æ˜¯TIME_WAITï¼Œåœ¨å®šæ—¶2MSLåï¼ˆæ¯æ¬¡æ”¶åˆ°ç¬¬ä¸‰æ¬¡æŒ¥æ‰‹ä¼šè¿›è¡Œé‡ç½®ï¼‰ï¼Œè¶…æ—¶clientç«¯å°±ä¼šæ–­å¼€è¿æ¥ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;ä¸»åŠ¨å…³é—­è¿æ¥çš„é‚£ä¸€æ–¹éœ€è¦time_waitçŠ¶æ€çš„åŸå› &#34;&gt;ä¸»åŠ¨å…³é—­è¿æ¥çš„é‚£ä¸€æ–¹éœ€è¦TIME_WAITçŠ¶æ€çš„åŸå› &lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¿è¯è¢«åŠ¨å…³é—­è¿æ¥çš„é‚£ä¸€æ–¹èƒ½æ­£ç¡®çš„å…³é—­è¿æ¥&lt;/strong&gt;ï¼šclientç«¯å‘é€çš„æœ€åä¸€ä¸ªACKæŠ¥æ–‡ç»™serverç«¯ï¼Œè¿™ä¸ªACKæŠ¥æ–‡æ˜¯å¯èƒ½ä¸¢å¤±ï¼Œæ­¤æ—¶serveræ¥æ”¶ä¸åˆ°ï¼Œé‚£ä»–å°±ä¼šé‡æ–°å‘é€FINæŠ¥æ–‡ï¼Œclientç«¯å°±èƒ½åœ¨è¿™2MSLå†…æ”¶åˆ°è¿™ä¸ªé‡ä¼ çš„æŠ¥æ–‡ï¼Œå†æ¬¡è¿›å…¥2MSLç­‰å¾…æ—¶é—´ï¼Œå‘é€ACKç»™serverç«¯ï¼Œç›´åˆ°ä¸¤è€…éƒ½è¿›å…¥closedçŠ¶æ€ã€‚å¦‚æœæ²¡æœ‰2MSLç­‰å¾…æ—¶é—´ï¼Œè€Œæ˜¯clientç«¯å‘é€å®ŒæŠ¥æ–‡ç›´æ¥å…³é—­ï¼Œå°±ä¼šå‡ºç°serverç«¯æ— æ³•æ¥æ”¶è€Œå¯¼è‡´æ— æ³•è¿›å…¥closedçŠ¶æ€ï¼›&lt;/li&gt;
&lt;li&gt;å¦‚æœserverè¶…è¿‡äº†2MSLæ—¶é—´ä¾ç„¶æ²¡æ”¶åˆ°clientçš„ACKï¼Œä¼šå†æ¬¡é‡å‘ç¬¬ä¸‰æ¬¡æŒ¥æ‰‹ï¼Œä½†æ­¤æ—¶clientä¼šå‘é€RSTæ ‡å¿—ï¼Œè¡¨ç¤ºå¼‚å¸¸å…³é—­è¿æ¥ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é˜²æ­¢å†å²è¿æ¥ä¸­çš„æ•°æ®ï¼Œè¢«åé¢ç›¸åŒçš„å››å…ƒç»„è¿æ¥é”™è¯¯çš„æ¥æ”¶&lt;/strong&gt;ï¼šclientç«¯åœ¨å‘é€å®Œæœ€åä¸€ä¸ªACKæŠ¥æ–‡æ®µåï¼Œåœ¨ç»è¿‡2MSLï¼Œå¯ä»¥ä½¿æœ¬è¿æ¥æŒç»­çš„æ—¶é—´å†…æ‰€äº§ç”Ÿçš„æ‰€æœ‰æŠ¥æ–‡éƒ½ä»ç½‘ç»œæ¶ˆå¤±ï¼Œç”¨è¿™ä¸ªæ—¶é—´è®©è¿™ä¸ªè¿æ¥ä¸ä¼šå’Œåé¢çš„è¿æ¥æ··åœ¨ä¸€èµ·ï¼Œä½¿å¾—ä¸‹ä¸€ä¸ªæ–°çš„è¿æ¥ä¸ä¼šå‡ºç°æ—§çš„è¿æ¥è¯·æ±‚æŠ¥æ–‡ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;time_waitç­‰å¾…æ—¶é—´æ˜¯2mslçš„åŸå› &#34;&gt;TIME_WAITç­‰å¾…æ—¶é—´æ˜¯2MSLçš„åŸå› &lt;/h3&gt;
&lt;p&gt;MSLï¼ˆMaximum Segment Lifetimeï¼ŒæŠ¥æ–‡æœ€å¤§ç”Ÿå­˜æ—¶é—´ï¼Œå•ä½æ˜¯æ—¶é—´ï¼‰ï¼Œä¸IPå¤´ä¸­çš„TTLçš„åŒºåˆ«ï¼ŒTTLæ˜¯æŒ‡IPæ•°æ®åŒ…å¯ä»¥ç»è¿‡çš„æœ€å¤§è·¯ç”±æ•°ï¼Œæ¯ç»è¿‡ä¸€æ¬¡å¤„ç†å®ƒçš„è·¯ç”±ï¼Œæ¬¡æ•°å°±å‡ä¸€ï¼Œå€¼ä¸º0æ—¶ä¼šè¿›è¡Œä¸¢å¼ƒï¼ŒåŒæ—¶å‘é€ICMPæŠ¥æ–‡é€šçŸ¥æºä¸»æœºï¼Œè€ŒMSLä¼šè®¾ç½®ä¸€ä¸ªå¤§äºç­‰äºTTLè¢«æ¶ˆè€—ä¸º0çš„æ—¶é—´ï¼Œç¡®ä¿æŠ¥æ–‡å·²è¢«è‡ªç„¶æ¶ˆäº¡ã€‚&lt;/p&gt;
&lt;p&gt;TTLå€¼ä¸€èˆ¬æ˜¯64ï¼ŒLinuxå°†MSLè®¾ç½®ä¸º30ç§’ï¼ŒTIME_WAITè®¾ç½®ä¸º2MSLï¼Œè¡¨ç¤ºä¸€æ¥ä¸€å›çš„æ—¶é—´ï¼Œç›¸å½“äºè‡³å°‘å…è®¸æŠ¥æ–‡ä¸¢å¤±ä¸€æ¬¡ï¼Œå³serverç«¯å¯ä»¥åœ¨clientç«¯å¤„äºTIME_WAITçŠ¶æ€ä¸‹é‡è¯•ä¸¤æ¬¡ã€‚&lt;/p&gt;
&lt;p&gt;2MSLçš„æ—¶é—´ä»clientç«¯æ”¶åˆ°FINåå‘é€ACKå¼€å§‹è®¡æ—¶ï¼Œé‡å¤æ”¶åˆ°FINæŠ¥æ–‡åˆ™ä¼šè¿›è¡Œé‡ç½®ã€‚&lt;/p&gt;
&lt;h3 id=&#34;time_waitçŠ¶æ€ä¸‹clientç«¯æ”¶åˆ°ç›¸åŒå››å…ƒç»„çš„synåŒ…ä¼šæ€ä¹ˆæ ·&#34;&gt;TIME_WAITçŠ¶æ€ä¸‹ï¼Œclientç«¯æ”¶åˆ°ç›¸åŒå››å…ƒç»„çš„SYNåŒ…ï¼Œä¼šæ€ä¹ˆæ ·&lt;/h3&gt;
&lt;p&gt;æ­¤æ—¶è¦çœ‹SYNåŒ…æ˜¯å¦åˆæ³•ï¼ˆåˆæ³•çš„SYNåŒ…ï¼Œå…¶åºå·å’Œæ—¶é—´æˆ³ä¼šæ¯”æœŸæœ›ä¸‹ä¸€ä¸ªæ”¶åˆ°çš„åºå·æˆ–æ—¶é—´æˆ³è¦å¤§ï¼‰:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚æœæ˜¯åˆæ³•çš„SYNåŒ…ï¼Œå°±ä¼šé‡ç”¨æ­¤å››å…ƒç»„è¿æ¥ï¼Œè·³è¿‡2MSLè¿›å…¥SYN_RECVçŠ¶æ€ï¼Œè¿›å…¥ä¸‰æ¬¡æ¡æ‰‹å»ºç«‹è¿æ¥ï¼›&lt;/li&gt;
&lt;li&gt;å¦‚æœæ”¶åˆ°éæ³•çš„SYNåŒ…ï¼Œå°±ä¼šå†å›å¤ä¸€ä¸ªç¬¬å››æ¬¡æ¡æ‰‹çš„ACKæŠ¥æ–‡ï¼ˆChallenge ACKï¼‰ï¼Œserverç«¯æ”¶åˆ°åï¼Œå‘ç°ä¸æ˜¯è‡ªå·±æœŸæœ›æ”¶åˆ°çš„ACKï¼Œå°±ä¼šå›å¤RSTæŠ¥æ–‡ç»™clientç«¯ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;é«˜å¹¶å‘ä¸‹å­˜åœ¨å¤§é‡time_waitçŠ¶æ€çš„è¿æ¥çš„åŸå› -åŠ-è§£å†³åŠæ³•&#34;&gt;é«˜å¹¶å‘ä¸‹å­˜åœ¨å¤§é‡TIME_WAITçŠ¶æ€çš„è¿æ¥çš„åŸå›  åŠ è§£å†³åŠæ³•&lt;/h3&gt;
&lt;p&gt;TIME_WAITçŠ¶æ€æ˜¯ &lt;strong&gt;ä¸»åŠ¨å‘èµ·è¿æ¥å…³é—­çš„é‚£ä¸€æ–¹&lt;/strong&gt; æ‰ä¼šå­˜åœ¨ï¼Œå¯ä»¥æ˜¯å®¢æˆ·ç«¯ï¼Œä¹Ÿå¯ä»¥æ˜¯æœåŠ¡ç«¯&lt;/p&gt;
&lt;p&gt;å¯èƒ½äº§ç”Ÿçš„åŸå› ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;çŸ­è¿æ¥åœºæ™¯ä¸‹ï¼Œæ— è®ºæ˜¯å®¢æˆ·ç«¯è¿˜æ˜¯æœåŠ¡ç«¯ï¼Œè¯·æ±‚å¤´é‡Œå¸¦&lt;code&gt;Connection: close&lt;/code&gt;ï¼Œéƒ½æ˜¯æœåŠ¡ç«¯åœ¨å¤„ç†å®Œè¿™æ¬¡è¯·æ±‚åï¼Œä¸»åŠ¨å…³é—­è¿æ¥ï¼›å› ä¸ºå¦‚æœç”±å®¢æˆ·ç«¯æ¥å…³é—­ï¼ŒæœåŠ¡ç«¯è¿˜å¾—å¤„ç†ä¸€æ¬¡è¿™æ¬¡å…³é—­çš„socketï¼›&lt;/li&gt;
&lt;li&gt;é•¿è¿æ¥è¶…æ—¶ï¼ŒåŒæ–¹å»ºç«‹é•¿è¿æ¥ä¹‹åï¼Œåœ¨ä¸€æ®µæ—¶é—´æ²¡æœ‰æ•°æ®é€šä¿¡ï¼ŒæœåŠ¡ç«¯å°±ä¼šå…³é—­è¿æ¥ï¼›&lt;/li&gt;
&lt;li&gt;HTTPé•¿è¿æ¥çš„è¯·æ±‚æ•°é‡è¾¾åˆ°ä¸Šé™ï¼ŒæœåŠ¡ç«¯å°±ä¼šå…³é—­è¿æ¥ï¼Œæ¯”å¦‚åœ¨ä¸€äº›QPSæ¯”è¾ƒé«˜çš„åœºæ™¯&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¯èƒ½äº§ç”Ÿçš„å½±å“ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å¦‚æœåœ¨å®¢æˆ·ç«¯ï¼Œå­˜åœ¨å¤§é‡TIME_WAITçŠ¶æ€çš„è¿æ¥ï¼Œå¯èƒ½å¯¼è‡´ç«¯å£å ç”¨ï¼ˆæ­¤æ—¶æ— æ³•å¯¹åŒä¸€å››å…ƒç»„å»ºç«‹è¿æ¥ï¼Œå¯¹å…¶ä»–å››å…ƒç»„å»ºç«‹è¿æ¥è¿˜æ˜¯æ²¡é—®é¢˜ï¼‰ï¼Œè¿æ¥æœªèƒ½åŠæ—¶å›æ”¶ï¼Œå¯¼è‡´æ— æ³•åˆ›å»ºæ–°è¿æ¥ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¦‚æœåœ¨æœåŠ¡ç«¯ï¼Œå­˜åœ¨å¤§é‡TIME_WAITçŠ¶æ€çš„è¿æ¥ï¼Œå¯èƒ½å¯¼è‡´ç³»ç»Ÿèµ„æºå ç”¨ï¼Œå¦‚æ–‡ä»¶æè¿°ç¬¦ã€å†…å­˜èµ„æºã€CPUèµ„æºã€çº¿ç¨‹èµ„æºç­‰ã€‚ç«¯å£èµ„æºå€’æ˜¯ä¸ä¼šå—é™ï¼Œå› ä¸ºæœåŠ¡ç«¯åªç›‘å¬ä¸€ä¸ªç«¯å£ï¼Œæ­¤æ—¶åªä¼šå¯¼è‡´æ— æ³•ä¸å®¢æˆ·ç«¯åŒä¸€å››å…ƒç»„å»ºç«‹è¿æ¥è€Œå·²ï¼Œå¯¹å…¶ä»–å®¢æˆ·ç«¯è¿æ¥æ²¡æœ‰å½±å“ï¼Œåªè¦åŒä¸€ä¸ªå®¢æˆ·ç«¯ä½¿ç”¨æ–°ç«¯å£ï¼Œä¹Ÿä¸ä¼šæœ‰å½±å“ï¼Œæ‰€ä»¥æ›´å¤šæ˜¯å¯¹ç³»ç»Ÿèµ„æºçš„å ç”¨ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è§£å†³åŠæ³•ï¼š&lt;/p&gt;
&lt;p&gt;TIME_WAITçš„çŠ¶æ€æ˜¯å¿…å®šå­˜åœ¨çš„ï¼Œæ‰€ä»¥ä¸€èˆ¬æ¥è¯´ï¼Œåªèƒ½å°½é‡å‡å°‘ï¼ˆé™ä½ç­‰å¾…æ—¶é—´ï¼Œé™ä½å‡ºç°çš„æ¬¡æ•°ï¼‰TIME_WAITå¸¦æ¥çš„å±å®³ï¼Œæ¯”å¦‚ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å¯ä»¥è®¾ç½®&lt;code&gt;tcp_tw_reuseï¼ˆè¿æ¥å¤ç”¨ï¼‰&lt;/code&gt;å’Œ&lt;code&gt;tcp_timestampsï¼ˆæŠ¥æ–‡å¸¦ä¸Š æ—¶é—´æˆ³ï¼Œé˜²æ­¢å›ç»•ï¼‰&lt;/code&gt;å‚æ•°è§£å†³ï¼Œè¯¥å‚æ•°çš„ä½œç”¨æ˜¯è®©clientç«¯èƒ½å¿«é€Ÿå¤ç”¨å¤„äºTIME_WAITçš„ç«¯å£ï¼Œå¦‚æœåœ¨TIME_WAITæœŸé—´ï¼Œclientç«¯ä»¥ç›¸åŒå››å…ƒç»„å†æ¬¡å»ºç«‹è¿æ¥ï¼Œä¼šåˆ¤æ–­TIME_WAITæ˜¯å¦è¶…è¿‡ä¸€ç§’ï¼Œè¶…è¿‡åˆ™å¯ä»¥æ­£å¸¸ä½¿ç”¨è¿™ä¸ªç«¯å£ï¼Œä½†æ˜¯å¯èƒ½ä¼šè¯¯æ¥æ”¶ä¸Šæ¬¡è¿æ¥çš„RSTï¼Œå¯¼è‡´è¿æ¥æ–­å¼€ï¼Œå¦‚æœç¬¬å››æ¬¡æŒ¥æ‰‹çš„ACKä¸¢äº†ï¼Œæ­¤æ—¶è¢«åŠ¨å…³é—­çš„é‚£ä¸€æ–¹å¯èƒ½ä¸èƒ½è¢«æ­£å¸¸å…³é—­ï¼›&lt;/p&gt;
&lt;p&gt;è¿™ç§æ–¹æ¡ˆæœ‰ä¸ªé£é™©ç‚¹ï¼Œå¿«é€Ÿå¤ç”¨ TIME_WAIT çŠ¶æ€çš„ç«¯å£ï¼Œå¯¼è‡´æ–°è¿æ¥å¯èƒ½è¢«å›ç»•åºå·çš„RSTæŠ¥æ–‡æ–­å¼€ï¼Œå› ä¸ºRSTæŠ¥æ–‡æ¯”è¾ƒç‰¹æ®Šï¼ŒTCPåœ¨å¤„ç†çš„æ—¶å€™ï¼Œå‘ç”Ÿå³ä½¿RSTæŠ¥æ–‡çš„æ—¶é—´æˆ³è¿‡æœŸäº†ï¼Œåºå·æ­£ç¡®ï¼Œè¿˜æ˜¯èƒ½è¢«æ¥æ”¶ï¼›å¦‚æœæ²¡æ‰“å¼€&lt;code&gt;tcp_tw_reuse&lt;/code&gt;ï¼Œåœç•™2MSLï¼Œé‚£è¿™ä¸ªRSTæŠ¥æ–‡å°±ä¸ä¼šå‡ºç°åœ¨è¿™ä¸ªæ–°è¿æ¥é‡Œäº†ï¼›&lt;/p&gt;
&lt;p&gt;å¦å¤–ï¼Œæ­¤æ–¹æ¡ˆåªé€‚ç”¨äºå®¢æˆ·ç«¯ï¼Œå³æœåŠ¡å‘èµ·ç«¯ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¿®æ”¹&lt;code&gt;tcp_max_tw_buckets&lt;/code&gt;å‚æ•°ï¼Œè°ƒå°TIME_WAITçš„ç­‰å¾…æ—¶é—´ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å°†çŸ­é“¾æ¥æ”¹æˆé•¿è¿æ¥ï¼Œæ¯”å¦‚HTTPï¼ŒæŠŠå“åº”å¤´çš„&lt;code&gt;Connection: close&lt;/code&gt;æ”¹æˆ&lt;code&gt;Connection: keep-alive&lt;/code&gt;ï¼Œå‘Šè¯‰æœåŠ¡ç«¯ä¸è¦å…³é—­ï¼Œå°½é‡å¤ç”¨é“¾æ¥ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å°½é‡ä¸åœ¨æœåŠ¡ç«¯å…³é—­è¿æ¥ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¢åŠ å¯ç”¨ç«¯å£çš„èŒƒå›´ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;æœåŠ¡ç«¯å‡ºç°å¤§é‡close_waitçŠ¶æ€çš„åŸå› &#34;&gt;æœåŠ¡ç«¯å‡ºç°å¤§é‡CLOSE_WAITçŠ¶æ€çš„åŸå› &lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;CLOSE_WAITçŠ¶æ€æ˜¯ &lt;strong&gt;è¢«åŠ¨å…³é—­è¿æ¥çš„é‚£ä¸€æ–¹&lt;/strong&gt; æ‰ä¼šå­˜åœ¨ï¼Œä¸€èˆ¬æ˜¯åœ¨æœåŠ¡ç«¯ï¼Œå¦‚æœ è¢«åŠ¨å…³é—­æ–¹ æ²¡æœ‰åŠæ—¶å…³é—­è¿æ¥ï¼Œé‚£å°±æ— æ³•å‘å‡º FIN æŠ¥æ–‡ï¼Œä»è€Œæ— æ³•ä½¿å¾— CLOSE_WAITçŠ¶æ€çš„è¿æ¥è½¬å˜ä¸º LAST_ACK çŠ¶æ€ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å‘ç”Ÿè¿™ç§æƒ…å†µé€šå¸¸æ˜¯ä»£ç é—®é¢˜ï¼Œæ²¡æœ‰åŠæ—¶è°ƒç”¨closeæ–¹æ³•å…³é—­è¿æ¥å¯¼è‡´ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;æ»‘åŠ¨çª—å£&#34;&gt;æ»‘åŠ¨çª—å£&lt;/h2&gt;
&lt;p&gt;TCPåè®®è§„å®šåœ¨å»ºç«‹è¿æ¥åï¼Œä¼šç¡®å®šåŒ…çš„åºå·çš„èµ·å§‹IDï¼ŒæŒ‰ç…§IDä¸€ä¸ªä¸ªå‘é€ï¼Œåªæœ‰ä¸Šä¸€ä¸ªæ•°æ®åŒ…æ”¶åˆ°åº”ç­”ï¼Œæ‰èƒ½å‘é€ä¸‹ä¸€ä¸ªï¼Œè¿™æ ·å°±ä¼šå¯¼è‡´æ•ˆç‡æ¯”è¾ƒä½ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¼•å…¥äº†æ»‘åŠ¨çª—å£ï¼Œé€šè¿‡çª—å£æ¥å®ç°ç´¯è®¡ç¡®è®¤æˆ–ç´¯è®¡åº”ç­”çš„ç›®çš„ï¼Œåº”ç­”æŸä¸ªIDçš„åŒ…å°±è¡¨ç¤ºåœ¨è¿™ä¸ªIDä¹‹å‰çš„åŒ…éƒ½æ”¶åˆ°äº†ï¼Œæ‰å…è®¸å‘é€ä¸‹ä¸€ä¸ªï¼ˆå¯ä»¥ç†è§£æˆæ‰¹é‡æ‰¹é‡çš„ACKï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;çª—å£å¤§å°å³è‡ªå·±çš„æ•°æ®æ¥æ”¶ç¼“å†²æ± çš„å¤§å°ï¼Œç”±æ¥æ”¶ç«¯å†³å®šï¼Œçª—å£æ ‡è¯†äº†æ— éœ€ç­‰å¾…ç¡®è®¤åº”ç­”ï¼Œè¿˜å¯ä»¥ç»§ç»­å‘é€æ•°æ®çš„æœ€å¤§å€¼ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å‘é€çª—å£å’Œæ¥æ”¶çª—å£æ‰€å­˜æ”¾çš„å­—èŠ‚æ•°ï¼Œéƒ½æ˜¯æ”¾åœ¨æ“ä½œç³»ç»Ÿå†…å­˜ç¼“å†²åŒºçš„ï¼Œä¼šå—æ“ä½œç³»ç»Ÿå½±å“ï¼Œå¦‚æœæ¥æ”¶ç«¯ä¸èƒ½åŠæ—¶æ¥æ”¶æ•°æ®ï¼Œå¯èƒ½å¯¼è‡´çª—å£å˜å°ï¼Œå‘é€ç«¯æ— æ³•å‘é€æ•°æ®ï¼›å¦‚æœå…ˆå‘ç”Ÿå‡å°‘ç¼“å­˜ï¼Œå†æ”¶ç¼©çª—å£ï¼Œåˆ™å¯èƒ½å‡ºç°ä¸¢åŒ…é—®é¢˜ï¼Œå› æ­¤TCPè§„å®šåªèƒ½å…ˆæ”¶ç¼©çª—å£ï¼Œå†å‡å°‘ç¼“å­˜æ¥é¿å…ä¸¢åŒ…é—®é¢˜ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ç”±äºå‘é€ç¼“å†²åŒºå¤§å°å†³å®šäº†å‘é€çª—å£çš„ä¸Šé™ï¼Œè€Œå‘é€çª—å£åˆå†³å®šäº†ã€Œå·²å‘é€æœªç¡®è®¤ã€çš„é£è¡ŒæŠ¥æ–‡çš„ä¸Šé™ã€‚å› æ­¤ï¼Œå‘é€ç¼“å†²åŒºä¸èƒ½è¶…è¿‡ã€Œå¸¦å®½æ—¶å»¶ç§¯ã€ï¼Œå°½é‡é è¿‘æœ€å¥½ã€‚å¸¦å®½æ—¶å»¶ç§¯ = RTT * å¸¦å®½ï¼Œå¦‚æœå‘é€ç¼“å†²åŒºè¶…è¿‡å¸¦å®½æ—¶å»¶ç§¯ï¼Œæ­¤æ—¶ç½‘ç»œè¿‡è½½ï¼Œå®¹æ˜“ä¸¢åŒ…ï¼Œå¦‚æœå°äºå¸¦å®½æ—¶å»¶ç§¯ï¼Œå¸¦å®½ç”¨ä¸æ»¡ï¼Œæ¯”è¾ƒæµªè´¹ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/TCP%e6%bb%91%e5%8a%a8%e7%aa%97%e5%8f%a3.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/TCP%e6%bb%91%e5%8a%a8%e7%aa%97%e5%8f%a3.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;åœ¨å‘é€ç«¯å’Œæ¥æ”¶ç«¯ä¼šåˆ†åˆ«ä½¿ç”¨ç¼“å­˜æ¥ä¿å­˜è¿™äº›åŒ…çš„è®°å½•ï¼Œä¸€èˆ¬åˆ†ä¸ºå››ä¸ªï¼š1. å·²å‘é€å¹¶ç¡®è®¤çš„ã€2. å·²å‘é€æœªç¡®è®¤çš„ã€3. æ²¡æœ‰å‘é€ä½†å‡†å¤‡å‘é€çš„ï¼Œä¸”å¤§å°åœ¨æ¥æ”¶æ–¹å¤„ç†èŒƒå›´å†…çš„ã€4. æ²¡æœ‰å‘é€ä¸”æš‚æ—¶ä¸ä¼šå‘é€çš„ï¼Œ&lt;strong&gt;æ»‘åŠ¨çª—å£å°±æ˜¯å¤„ç†ç¬¬äºŒã€ä¸‰éƒ¨åˆ†çš„æ•°æ®åŒ…&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ç”±å‘é€æ–¹å’Œæ¥æ”¶æ–¹åœ¨ä¸‰æ¬¡æ¡æ‰‹é˜¶æ®µï¼Œäº’ç›¸é€šçŸ¥è‡ªå·±çš„æœ€å¤§å¯æ¥æ”¶çš„å­—èŠ‚æ•°ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å½“å‘é€æ–¹çª—å£å·¦éƒ¨å­—èŠ‚å·²å‘é€ä¸”æ”¶åˆ°ç¡®è®¤ï¼Œçª—å£å³æ»‘ç›´åˆ°å·¦éƒ¨ç¬¬ä¸€ä¸ªå­—èŠ‚ä¸æ˜¯å·²å‘é€å¹¶ä¸”å·²ç¡®è®¤çš„çŠ¶æ€ï¼Œæ¥å—æ–¹çª—å£ç§»åŠ¨åŒç†ï¼Œæ­¤æ—¶å¯ç”¨çª—å£å˜å¤§ï¼Œè¡¨ç¤ºå¯ä»¥ç»§ç»­å‘é€æ•°æ®ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ¥æ”¶çª—å£åªä¼šå¯¹çª—å£å†…æœ€åä¸€ä¸ªæŒ‰åºåˆ°è¾¾çš„å­—èŠ‚è¿›è¡Œç¡®è®¤ï¼Œç¡®è®¤ä¹‹åè¡¨ç¤ºä¹‹å‰çš„æ‰€æœ‰å­—èŠ‚éƒ½æ¥æ”¶åˆ°äº†ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å‘é€çª—å£ä¸º0ï¼Œè¡¨æ˜å¯ç”¨çª—å£è€—å°½ï¼Œåœ¨æœªæ”¶åˆ°ACKç¡®è®¤ä¹‹å‰æ— æ³•ç»§ç»­å‘é€æ•°æ®ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åœ¨å¤„ç†è¿‡ç¨‹ä¸­ï¼Œå½“æ¥æ”¶ç¼“å†²æ± çš„å¤§å°å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¼šç»™å¯¹æ–¹å‘é€æ›´æ–°çª—å£å¤§å°çš„é€šçŸ¥ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ç²˜åŒ…é—®é¢˜&#34;&gt;ç²˜åŒ…é—®é¢˜&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;å®é™…ä¸Šå› ä¸ºTCPæ˜¯é¢å‘å­—èŠ‚æµï¼Œè€Œå­—èŠ‚æµæœ¬èº«æ²¡æœ‰ç²˜åŒ…/æ‹†åŒ…çš„æ¦‚å¿µï¼ŒTCPå±‚åªç®¡æä¾›å¯é æ€§æ¶ˆæ¯ä¼ è¾“ï¼Œä¸ç„¶ä¸ºä»€ä¹ˆä¼šå¯¹ç½‘ç»œåˆ†å±‚å‘¢ï¼Œç²˜åŒ…æ˜¯åº”ç”¨å±‚æ²¡æœ‰å¤„ç†å¥½å¯¼è‡´&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å‘é€æ–¹å‘é€çš„è‹¥å¹²åŒ…æ•°æ®åˆ°æ¥æ”¶æ–¹æ¥æ”¶æ—¶ç²˜æˆä¸€åŒ…ï¼Œä»æ¥æ”¶ç¼“å†²åŒºçœ‹ï¼Œåä¸€åŒ…æ•°æ®çš„å¤´ç´§æ¥ç€å‰ä¸€åŒ…æ•°æ®çš„å°¾ã€‚&lt;/p&gt;
&lt;p&gt;åªæœ‰TCPä¼šï¼ˆé€šè¿‡çª—å£å¤§å°æ¥æ¥æ”¶æ•°æ®ï¼Œçª—å£å¤§å°åˆæ˜¯åŠ¨æ€çš„ï¼‰ï¼Œè€ŒUDPå› ä¸ºæœ‰æ¶ˆæ¯è¾¹ç•Œï¼ˆå¤´éƒ¨æœ‰è§„å®šæŠ¥æ–‡çš„å¤§å°ï¼‰ï¼Œæ‰€ä»¥ä¸ä¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;äº§ç”Ÿçš„åŸå› &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å‘é€ç«¯ç²˜åŒ…ï¼šå‘é€ç«¯ç­‰åˆ°ç¼“å†²åŒºæ»¡äº†æ‰å‘é€å‡ºå»ï¼Œé€ æˆç²˜åŒ…ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æœ‰æ—¶ä¸ºäº†æé«˜å‘é€æ•°æ®çš„æ•ˆç‡ï¼ŒæœåŠ¡ç«¯ä¼šæŠŠå¤šä¸ªæ•°æ®å—åˆå¹¶æˆä¸€ä¸ªå¤§çš„æ•°æ®å—åå°åŒ…å‘é€ï¼Œä½†ç”±äºé¢å‘æµçš„é€šä¿¡æ˜¯æ— æ¶ˆæ¯ä¿æŠ¤è¾¹ç•Œçš„ï¼Œæ¥æ”¶ç«¯å°±å¾ˆéš¾åˆ†è¾¨å‡ºå®Œæˆçš„æ•°æ®åŒ…ã€‚&lt;/p&gt;
&lt;p&gt;å½“è¦å‘é€çš„æ•°æ®å¤§äºTCPå‘é€ç¼“å†²åŒºå‰©ä½™å¤§å°ï¼Œå°†ä¼šå‘ç”Ÿæ‹†åŒ…ï¼›å½“å¾…å‘é€æ•°æ®å¤§äºï¼ˆæœ€å¤§æŠ¥æ–‡é•¿åº¦ï¼‰ï¼ŒTCPåœ¨ä¼ è¾“å‰å°†è¿›è¡Œæ‹†åŒ…ã€‚å³TCPæŠ¥æ–‡é•¿åº¦-TCPå¤´éƒ¨é•¿åº¦&amp;gt;MSSã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ¥æ”¶ç«¯ç²˜åŒ…ï¼šæ¥æ”¶ç«¯ä¸åŠæ—¶æ¥æ”¶ç¼“å†²åŒºçš„åŒ…ï¼Œé€ æˆå¤šä¸ªåŒ…æ¥æ”¶ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è§£å†³æ–¹æ³•&lt;/p&gt;
&lt;p&gt;ç²˜åŒ…ä¸»è¦å°±æ˜¯æ²¡æœ‰å¤„ç†å¥½æ•°æ®åŒ…çš„è¾¹ç•Œï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å‘é€å›ºå®šé•¿åº¦çš„æ¶ˆæ¯ï¼›æ¶ˆæ¯å°ºå¯¸å’Œæ¶ˆæ¯ä¸€å—å‘é€ï¼›ç‰¹æ®Šæ ‡è®°æ ‡è®°æ¶ˆæ¯åŒºé—´ï¼›&lt;/li&gt;
&lt;li&gt;é€šä¿¡åŒæ–¹è§„å®šå¥½åè®® + ç¼–è§£ç å™¨ï¼ˆæ¯”å¦‚è§„å®šå®šé•¿çš„è¯·æ±‚å¤´ã€è¯·æ±‚ä½“ï¼‰ï¼ŒæŒ‰åè®®çš„æ ¼å¼è¿›è¡Œè§£æï¼›æ¯”å¦‚å°†æ•°æ®åˆ†æˆä¸¤éƒ¨åˆ†ï¼Œä¸€éƒ¨åˆ†æ˜¯å¤´éƒ¨ï¼Œä¸€éƒ¨åˆ†æ˜¯å†…å®¹ä½“ï¼Œå…¶ä¸­å¤´éƒ¨ç»“æ„å¤§å°å›ºå®šï¼Œä¸”æœ‰ä¸€ä¸ªå­—æ®µå£°æ˜å†…å®¹ä½“çš„å¤§å°ã€‚&lt;/li&gt;
&lt;li&gt;ç¨‹åºæ§åˆ¶å‘é€å’Œæ¥æ”¶é¢‘ç‡ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.cnblogs.com/kex1n/p/6502002.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;TCPç²˜åŒ…é—®é¢˜åˆ†æå’Œè§£å†³ï¼ˆå…¨ï¼‰&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;æµé‡æ§åˆ¶&#34;&gt;æµé‡æ§åˆ¶&lt;/h2&gt;
&lt;p&gt;TCP&lt;strong&gt;éœ€è¦è§£å†³å¯é ä¼ è¾“å’ŒåŒ…çš„ä¹±åºé—®é¢˜ï¼Œå°±éœ€è¦çŸ¥é“ç½‘ç»œå®é™…çš„æ•°æ®å¤„ç†å¸¦å®½æˆ–æ•°æ®å¤„ç†é€Ÿåº¦ï¼Œæ‰ä¸ä¼šå¼•èµ·ç½‘ç»œæ‹¥å¡ï¼Œå¯¼è‡´ä¸¢åŒ…ï¼Œsoéœ€è¦åšæµé‡æ§åˆ¶&lt;/strong&gt;ã€‚åœ¨TCPçš„åŒ…å¤´ä¸­é€šè¿‡Windowå­—æ®µæ§åˆ¶ï¼Œè¿™ä¸ªå­—æ®µæ˜¯æ¥æ”¶ç«¯æ¯æ¬¡ACKæ—¶ä¼šå‘Šè¯‰å‘é€ç«¯è‡ªå·±è¿˜æœ‰å¤šå°‘ç¼“å†²åŒºå¯ä»¥æ¥æ”¶æ•°æ®ï¼Œäºæ˜¯å‘é€ç«¯å°±å¯ä»¥æ ¹æ®è¿™ä¸ªæ¥æ”¶ç«¯çš„å¤„ç†èƒ½åŠ›æ¥å‘é€æ•°æ®ï¼Œè€Œä¸ä¼šå¯¼è‡´æ¥æ”¶ç«¯å¤„ç†ä¸è¿‡æ¥ï¼Œä»è€Œå®ç°æµé‡æ§åˆ¶ã€‚&lt;/p&gt;
&lt;p&gt;å®ç°æ»‘åŠ¨çª—å£ï¼Œå‘é€ç«¯å’Œæ¥æ”¶ç«¯åœ¨è¿›è¡Œæ•°æ®äº¤äº’æ—¶ï¼Œä¼šå•†å®šæ»‘åŠ¨çª—å£çš„å¤§å°ï¼Œ&lt;strong&gt;åœ¨å¯¹äºåŒ…çš„ç¡®è®¤æ—¶ä¼šæºå¸¦ä¸€ä¸ªçª—å£çš„å¤§å°ï¼ˆé€šè¿‡ACKé€šçŸ¥ï¼‰&lt;/strong&gt;ï¼Œé€šè¿‡è¯¥çª—å£å¤§å°æ¥å®ç°æµé‡æ§åˆ¶ï¼ˆæˆ–è€…æ—¶ä¸æ—¶å‘é€ä¸€ä¸ªçª—å£æ¢æµ‹çš„æ•°æ®æ®µæ¥ç¡®è®¤åŒæ–¹çš„çª—å£å¤§å°ï¼‰ï¼Œå½“å‘é€æ–¹å’Œæ¥æ”¶æ–¹çš„æ»‘åŠ¨çª—å£å¤§å°ä¸º0æ—¶ï¼Œå‘é€æ–¹ä¼šå®šæ—¶å‘é€çª—å£æ¢æµ‹æ•°æ®åŒ…ï¼Œæ¥æ›´æ–°çª—å£å¤§å°ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;çª—å£å…³é—­&lt;/strong&gt;ï¼ˆZero Windowï¼‰ï¼šå½“æ»‘åŠ¨çª—å£çš„å¤§å°å˜æˆ0ï¼Œæ„å‘³ç€å‘é€ç«¯ä¸å‘æ•°æ®äº†ï¼Œå½“æ¥æ”¶æ–¹çš„æ»‘åŠ¨çª—å£å¯ä»¥æ›´æ–°æ—¶ï¼Œä¼šé€šè¿‡ACKé€šçŸ¥å‘é€ç«¯ï¼Œä½†æ˜¯è¿™ä¸ªçª—å£å¤§å°çš„ACKæŠ¥æ–‡æ˜¯å¯èƒ½ä¸¢å¤±çš„ï¼Œä¸¢å¤±ä¼šå¯¼è‡´åŒæ–¹äº’ç›¸ç­‰å¾…ï¼Œå¯¼è‡´æ­»é”ã€‚&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥æ”¶åˆ°Zero Windowçš„é‚£ä¸€æ–¹ï¼ˆå³æ»‘åŠ¨çª—å£å˜ä¸º0ï¼‰ï¼Œä¼šå¯åŠ¨ä¸€ä¸ªæŒç»­è®¡æ—¶å™¨ï¼Œå¦‚æœè®¡æ—¶å™¨è¶…æ—¶ï¼Œå°±ä¼šå‘é€Zero Window ProbeæŠ¥æ–‡è¿›è¡Œæ¢æµ‹ï¼Œæ›´æ–°è‡ªå·±çš„çª—å£å¤§å°ï¼Œè¿™ä¸ªå€¼ä¼šè¢«è®¾ç½®æˆ3æ¬¡ï¼Œæ¯æ¬¡å¤§çº¦30-60sï¼Œå¦‚æœ3æ¬¡è¿‡åè¿˜æ˜¯0ï¼Œå¯èƒ½å°±ä¼šæ–­å¼€è¿æ¥äº†ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç³Šæ¶‚çª—å£ç»¼åˆå¾&lt;/strong&gt;ï¼ˆSilly Window Syndromeï¼‰ï¼šå¦‚æœæ¥æ”¶æ–¹å¤ªå¿™ï¼Œæ¥ä¸åŠå–èµ°æ»‘åŠ¨çª—å£é‡Œçš„æ•°æ®ï¼Œå°±ä¼šå¯¼è‡´å‘é€æ–¹å¯å‘é€çš„æ•°æ®è¶Šæ¥è¶Šå°ï¼Œå¦‚æœæ¯æ¬¡å‘é€çš„æ•°æ®å¤ªå°ï¼Œå¸¦å®½æ²¡æœ‰å ç”¨ï¼Œå®é™…ä¸Šæ˜¯å¾ˆäºçš„ï¼Œè¿™ç§ç°è±¡å°±å«Silly Window Syndromeã€‚&lt;/p&gt;
&lt;p&gt;è§£å†³æ–¹æ³•æœ‰å¤šç§ï¼Œä¸€ç§æ˜¯å¦‚æœè¿™ä¸ªé—®é¢˜æ˜¯æ¥æ”¶ç«¯å¼•èµ·çš„ï¼Œå½“æ”¶åˆ°çš„æ•°æ®å¯¼è‡´æ»‘åŠ¨çª—å£çš„å¤§å°å°äºæŸä¸ªå€¼ï¼Œå°±ç›´æ¥å›æ»‘åŠ¨çª—å£ä¸º0çš„ACKç»™å‘é€ç«¯ï¼ŒæŠŠæ»‘åŠ¨çª—å£å…³é—­ï¼Œç­‰æ¥æ”¶æ–¹çš„æ»‘åŠ¨çª—å£å¤§äºæŸä¸ªå€¼æ˜¯ï¼Œæ‰æŠŠæ»‘åŠ¨çª—å£æ‰“å¼€ï¼Œè®©å‘é€ç«¯å‘æ•°æ®è¿‡æ¥ï¼›å¦ä¸€ç§æ˜¯å¦‚æœè¿™ä¸ªé—®é¢˜æ˜¯å‘é€ç«¯å¼•èµ·çš„ï¼Œå°±å»¶æ—¶å¤„ç†ï¼Œæ”’å¤šç‚¹æ•°æ®ä¸€å—å‘ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;é‡ä¼ æœºåˆ¶&#34;&gt;é‡ä¼ æœºåˆ¶&lt;/h2&gt;
&lt;p&gt;**ä¸¢åŒ…é—®é¢˜ï¼š**å‘é€æ–¹æŒ‰é¡ºåºå‘é€ä¸€ç³»åˆ—çš„åŒ…ï¼Œæ¥æ”¶æ–¹æ¥æ”¶è¿™äº›åŒ…æ˜¯ä¸­é—´ä¸€éƒ¨åˆ†åŒ…æ²¡æ”¶åˆ°&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;äº§ç”ŸåŸå› 
&lt;ul&gt;
&lt;li&gt;ä¸­é—´è¿™äº›åŒ…ç»è¿‡å…¶ä»–é“¾è·¯å¯¼è‡´å»¶æ—¶æ¥æ”¶æ–¹è¿˜æ²¡æ”¶åˆ°ï¼›&lt;/li&gt;
&lt;li&gt;æ¥æ”¶æ–¹æ”¶åˆ°ä¸”å‘é€äº†ACKç»™å‘é€æ–¹ï¼Œä½†æ˜¯å‘é€æ–¹æ²¡æœ‰æ”¶åˆ°ACKï¼›&lt;/li&gt;
&lt;li&gt;ç½‘å¡ä¸¢åŒ…ï¼Œæ•°æ®é“¾è·¯æœ‰ç‚¹é—®é¢˜ï¼Œæˆ–è€…ç½‘å¡æ€§èƒ½ä¸è¶³ï¼Œæ•°æ®åŒ…çœŸçš„ä¸¢äº†ï¼›&lt;/li&gt;
&lt;li&gt;å› ä¸ºé¡ºåºå‘é€å’Œæ¥æ”¶é—®é¢˜ï¼Œæ¥æ”¶æ–¹åé¢çš„åŒ…æ”¶åˆ°äº†ï¼Œä½†æ˜¯å‰é¢çš„åŒ…è¿˜æ²¡æ”¶åˆ°ï¼Œå¯¼è‡´åé¢çš„åŒ…æ”¶åˆ°äº†ä¹Ÿä¸èƒ½å‘é€ACKç»™å‘é€ç«¯ï¼›&lt;/li&gt;
&lt;li&gt;å»ºç«‹è¿æ¥æ—¶ï¼ŒåŠè¿æ¥é˜Ÿåˆ— æˆ–è€… å…¨è¿æ¥é˜Ÿåˆ— æ»¡äº†ï¼Œæ–°æ¥çš„åŒ…å°±ä¼šè¢«ä¸¢æ‰ï¼›&lt;/li&gt;
&lt;li&gt;æµé‡æ§åˆ¶æœºåˆ¶äº§ç”Ÿçš„ä¸¢åŒ…ï¼›&lt;/li&gt;
&lt;li&gt;æ¥æ”¶æ•°æ®æ—¶ï¼Œæ•°æ®ä¼šå…ˆæš‚å­˜åœ¨å†…æ ¸ç¼“å†²åŒºï¼Œå¦‚æœç¼“å†²åŒºè¿‡å°ï¼Œå‘é€é€Ÿåº¦åˆè¿‡å¿«ï¼Œäº§ç”Ÿæº¢å‡ºè€Œä¸¢åŒ…ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ‰€ä»¥ï¼Œä¸ºäº†ä¿è¯å¯é ä¼ è¾“ï¼Œè§£å†³ä¸¢åŒ…é—®é¢˜ï¼Œå°±éœ€è¦ä¿è¯å½“æŠ¥æ–‡ä¸¢å¤±ï¼Œåœ¨ä¸€å®šæ¬¡æ•°å†…æŒç»­é‡è¯•ï¼Œç›´åˆ°æˆåŠŸï¼Œåˆè¦ç¡®ä¿å¦‚æœé‡ä¼ éƒ½å¤±è´¥äº†ï¼ŒåŠæ—¶æ”¾å¼ƒä¼ è¾“ï¼Œé¿å…æ­»å¾ªç¯çš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;è§£å†³æ–¹æ³•&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è¶…æ—¶é‡ä¼ &lt;/strong&gt;ï¼ˆRetransmission Timeoutï¼ŒRTOï¼‰ï¼Œè¶…æ—¶é‡ä¼ æœ‰ä¸€ä¸ªè®¡æ—¶å™¨ï¼Œåœ¨æŠ¥æ–‡å‘é€å‡ºå»åå¼€å§‹è®¡æ—¶ï¼Œå¦‚æœåœ¨æ—¶é™å†…æ”¶åˆ°å›å¤çš„ACKï¼Œè®¡æ—¶å™¨å°±æ¸…é›¶ï¼Œå¦‚æœåœ¨æ—¶é™å†…è¿˜æ²¡æ”¶åˆ°ACKï¼Œå°±è§¦å‘é‡ä¼ ã€‚&lt;/p&gt;
&lt;p&gt;è¶…æ—¶æ—¶é—´ç”±è‡ªé€‚åº”é‡ä¼ ç®—æ³•æ¥å†³å®šï¼Œå¦å¤–æ˜¯æ¯æ¬¡é‡è¯•çš„æ—¶é—´é—´éš”ä¼šåŠ å€ï¼Œè¶…è¿‡ä¸¤æ¬¡è®¤ä¸ºç½‘ç»œç¯å¢ƒå·®ï¼Œå–æ¶ˆé‡ä¼ ã€‚&lt;strong&gt;è¶…æ—¶é‡ä¼ ä¸»è¦è§£å†³ä¸¢åŒ…æ—¶å¹²ç­‰å›å¤ACKçš„é—®é¢˜&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;RTOåˆå§‹å€¼æ˜¯1ç§’ï¼Œå»ºç«‹è¿æ¥åï¼ŒRTOä¼šè¢«åŠ¨æ€è®¡ç®—ï¼Œä¸Šé™æ˜¯2minï¼Œä¸‹é™æ˜¯200msã€‚RTOçš„è®¾ç½®å°¤ä¸ºå…³é”®ï¼Œè®¾ç½®è¿‡é•¿ï¼Œé‡å‘å°±æ…¢ï¼Œæ•ˆç‡ä½æ€§èƒ½å·®ï¼›è®¾ç½®è¿‡çŸ­ï¼Œå°±ä¼šå¯¼è‡´æ²¡æœ‰ä¸¢å°±é‡å‘ï¼Œé‡å‘è¿‡å¿«ï¼Œå°±ä¼šå¢åŠ ç½‘ç»œæ‹¥å¡ï¼Œå¯¼è‡´æ›´å¤šçš„è¶…æ—¶ï¼Œä»è€Œåˆå¯¼è‡´æ›´å¤šçš„é‡å‘ï¼Œå› æ­¤æ— æ³•è®¾ç½®æˆä¸€ä¸ªå†™æ­»çš„å€¼ï¼Œè€Œæ˜¯é€šè¿‡RTTç®—æ³•åŠ¨æ€è°ƒæ•´ã€‚ä¸€èˆ¬è¶…æ—¶é‡ä¼ æ—¶é—´RTOä¼šç•¥å¤§äºæŠ¥æ–‡å¾€è¿”æ—¶é—´RTTçš„å€¼ã€‚&lt;/p&gt;
&lt;p&gt;ç”±äºACKæœ¬èº«æ²¡æœ‰ACKäº†ï¼Œå¦‚æœACKå‘ç”Ÿä¸¢å¤±ï¼ŒACKä¼šè§†æƒ…å†µé‡ä¼ ï¼Œæ¯”å¦‚ï¼Œå¦‚æœå‘é€æ–¹æ”¶åˆ°äº†åç»­çš„ACKï¼Œå°±è¯´æ˜å‰é¢çš„å†…å®¹éƒ½æ¥æ”¶åˆ°äº†ï¼Œå°±ä¸ä¼šé‡ä¼ ï¼›å¦‚æœæ²¡æ”¶åˆ°åç»­çš„ACKï¼Œåˆ™è§¦å‘è¶…æ—¶é‡ä¼ æœºåˆ¶ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¿«é€Ÿé‡ä¼ æœºåˆ¶&lt;/strong&gt;ï¼Œå› ä¸ºåŒ…æ˜¯æœ‰é¡ºåºçš„ï¼Œæ‰€ä»¥å®¢æˆ·ç«¯å¯ä»¥æ£€æµ‹å‡ºç¼ºå¤±çš„åŒ…ï¼Œç„¶åå‘é€å¯¹åº”çš„å†—ä½™ACKï¼ˆç§°ä¸ºDupAckï¼‰ç»™æœåŠ¡ç«¯ï¼Œé€šè¿‡åœ¨æœåŠ¡ç«¯è®¾ç½®æ”¶åˆ°è§„å®šé€šè¿‡å‘é€/æ¥æ”¶å†—ä½™çš„ACKåŒ…çš„æ¬¡æ•°ï¼ˆä¸€èˆ¬æ˜¯3ä¸ªï¼‰ï¼Œå¦‚æœè¾¾åˆ°äº†è§„å®šæ¬¡æ•°å°±æŠŠåºå·ç­‰äºè¿™ä¸ªACKå·çš„åŒ…è¿›è¡Œé‡ä¼ ï¼Œä¸ç­‰è¶…æ—¶æ—¶é—´ï¼Œso &lt;strong&gt;å¿«é€Ÿé‡ä¼ ä¸»è¦æ˜¯è§£å†³è¶…æ—¶ç­‰å¾…è¿‡ä¹…çš„é—®é¢˜&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å¿«é€Ÿé‡ä¼ çš„è§¦å‘æ¡ä»¶æ˜¯ï¼šæ”¶åˆ°3ä¸ªæˆ–ä»¥ä¸Šçš„é‡å¤ACKï¼Œå³DupACK&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚ï¼šæ¥æ”¶ç«¯ä¸­é—´æ¼æ”¶äº†Seq2ï¼Œåé¢åˆæ¥æ”¶åˆ°äº†Seq3ã€4ã€5ï¼Œé‚£å°±ä¼šåœ¨æ¥æ”¶æ—¶é‡å¤å‘é€ACK2ï¼Œå‘é€ç«¯æ”¶åˆ°é‡å¤çš„ACKåå°±ä¼šé‡æ–°å‘é€Seq2äº†ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/TCP%e5%bf%ab%e9%80%9f%e9%87%8d%e4%bc%a0%e6%9c%ba%e5%88%b6.jpeg&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/TCP%e5%bf%ab%e9%80%9f%e9%87%8d%e4%bc%a0%e6%9c%ba%e5%88%b6.jpeg&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯å¿«é€Ÿé‡ä¼ æœ‰ä¸€ä¸ªé—®é¢˜ï¼ŒACKåªå‘å‘é€ç«¯å‘ŠçŸ¥æœ€å¤§çš„æœ‰åºæŠ¥æ–‡æ®µï¼Œå¹¶ä¸ç¡®å®šæ˜¯å“ªä¸€ä¸ªæŠ¥æ–‡ä¸¢å¤±äº†ï¼Œæ­¤æ—¶å‘é€ç«¯ä¸çŸ¥é“è¦é‡ä¼ å“ªäº›åŒ…ï¼Œæ˜¯é‡ä¼ ä¸€ä¸ªï¼Œè¿˜æ˜¯é‡ä¼ æ‰€æœ‰ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ä¸Šå›¾ä¸ºä¾‹ï¼Œç”±äºæŠ¥æ–‡çš„é¡ºåºæ€§ï¼Œæ¥æ”¶ç«¯æ”¶ä¸åˆ°Seq2ï¼Œä½†Seq3ã€Seq4ã€Seq5éƒ½æ¥æ”¶åˆ°äº†ï¼Œä½†æ˜¯ACKçš„æ—¶å€™åªé‡å¤äº†ACK2ï¼Œæ­¤æ—¶å‘é€ç«¯åªçŸ¥é“å¿…å®šè¦é‡ä¼ Seq2ï¼Œä½†æ˜¯å¹¶ä¸æ¸…æ¥šæ˜¯å¦è¦é‡ä¼ Seq3ã€Seq4ã€Seq5ã€‚&lt;/p&gt;
&lt;p&gt;SACKå°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;åœ¨Linuxä¸­çš„SACKæœºåˆ¶ï¼Œå®ƒä¼šåœ¨TCPå¤´é‡ŒåŠ ä¸€ä¸ªSACKï¼ˆSelective ACKï¼‰çš„ä¸œè¥¿ï¼ŒSACKè¿˜æ˜¯åŸºäºå¿«é€Ÿé‡ä¼ çš„ACKï¼Œåªæ˜¯SACKä¼šæŠŠæ¥æ”¶ç«¯æ”¶åˆ°çš„æ‰€æœ‰åŒ…çš„åºåˆ—ï¼Œéƒ½åé¦ˆç»™å‘é€ç«¯ï¼Œå‘é€ç«¯æ ¹æ®é—æ¼çš„ACKåºå·ï¼Œè¿›è¡Œé‡ä¼ ã€‚SACKéƒ¨åˆ†æœ€å¤šåªèƒ½å®¹çº³4ä¸ªå—ã€‚&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚åœ¨ä¸Šé¢çš„åœºæ™¯ä¸­ï¼Œæ¥æ”¶ç«¯åœ¨å‘é€ACKæ—¶ï¼Œå¸¦ä¸ŠSACKï¼ŒSACKä¸Šå¸¦æœ‰Seq3ã€4ã€5çš„ä¿¡æ¯ï¼Œè¿™æ ·å‘é€ç«¯å°±çŸ¥é“åªéœ€é‡ä¼ Seq2äº†ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;å¦å¤–ï¼Œè¿˜æœ‰ä¸ªD-SACKï¼ˆDuplicate SACKï¼‰ï¼Œåœ¨SACKä¸Šåšæ‰©å±•ï¼ŒDSACKä½¿ç”¨SACKçš„ç¬¬ä¸€ä¸ªæ®µä½œä¸ºæ ‡è¯†ï¼Œè¿™ä¸ªæ®µè¡¨ç¤ºæ¥æ”¶èŒƒå›´ï¼Œé€šè¿‡æ¯”è¾ƒè¿™ä¸ªæ®µçš„å€¼å’ŒSACKçš„å›å¤èŒƒå›´ï¼Œè¿›è¡Œåˆ¤æ–­ï¼Œè®©å‘é€æ–¹çŸ¥é“æ˜¯å‘å‡ºå»çš„åŒ…ä¸¢äº†ï¼Œè¿˜æ˜¯æ¥æ”¶æ–¹å›åº”çš„ACKåŒ…ä¸¢äº†ï¼›è¿˜æ˜¯å‘é€æ–¹çš„è¶…æ—¶å¤ªçŸ­ï¼Œå¯¼è‡´é‡ä¼ ï¼›è¿˜æ˜¯å…ˆå‘å‡ºå»çš„åŒ…ååˆ°çš„æƒ…å†µï¼Œè¿˜æ˜¯æ•°æ®åŒ…è¢«å¤åˆ¶äº†ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;SACKå’ŒD-SACKçš„åŒºåˆ«åœ¨äºæ¬¡æ•°å’Œç›®çš„ï¼ŒSACKé€šè¿‡é‡å¤é‡ä¼ æ¥å‘Šè¯‰å‘é€æ–¹è¦é‡ä¼ ä»€ä¹ˆæ•°æ®ï¼ŒD-SACKç”¨æ¥å‘Šè¯‰å‘é€æ–¹å“ªäº›æ•°æ®è¢«é‡å¤æ¥æ”¶ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/Linux-SACK%e5%bf%ab%e9%80%9f%e9%87%8d%e4%bc%a0%e6%9c%ba%e5%88%b6.jpeg&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/Linux-SACK%e5%bf%ab%e9%80%9f%e9%87%8d%e4%bc%a0%e6%9c%ba%e5%88%b6.jpeg&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;æ‹¥å¡æ§åˆ¶&#34;&gt;æ‹¥å¡æ§åˆ¶&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;äº§ç”ŸåŸå› ï¼šå¯¹èµ„æºçš„éœ€æ±‚è¶…è¿‡äº†å¯ç”¨çš„èµ„æºï¼Œç½‘ç»œååé‡ä¸‹é™ï¼Œå¦‚æœç½‘ç»œå‡ºç°æ‹¥å¡ï¼Œæ•°æ®åŒ…å°†ä¼šä¸¢å¤±æˆ–å»¶è¿Ÿåˆ°è¾¾ï¼Œå‘é€æ–¹ä»¥ä¸ºå‘é€å¤±è´¥åˆä¼šç»§ç»­é‡ä¼ ï¼Œä»è€Œå¯¼è‡´ç½‘ç»œæ‹¥å¡ç¨‹åº¦æ›´é«˜ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åˆ¤å®šæ–¹å¼ï¼šåªè¦å‘é€ç«¯æ²¡æœ‰åœ¨è§„å®šæ—¶é—´æ”¶åˆ°ACKåº”ç­”æŠ¥æ–‡ï¼Œå°±ä¼šå‘ç”Ÿè¶…æ—¶é‡ä¼ ï¼Œæ­¤æ—¶ä¼šè®¤å®šç½‘ç»œå‡ºç°æ‹¥å¡ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;TCPé€šè¿‡æ•°æ®åŒ…å‘é€å’Œç¡®è®¤çš„å¾€è¿”æ—¶é—´RTTï¼Œä¸¢åŒ…ç‡æ¥åˆ¤æ–­æ˜¯å¦æ‹¥å¡ï¼Œä½¿ç”¨æ»‘åŠ¨çª—å£æ¥è¿›è¡Œæ‹¥å¡æ§åˆ¶&lt;/strong&gt;ï¼Œæ§åˆ¶å‘é€æ–¹çš„å‘é€é€Ÿç‡ï¼Œé¿å…åŒ…ä¸¢å¤±å’Œè¶…æ—¶é‡ä¼ ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è§£å†³æ–¹æ³•ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ…¢å¼€å§‹ + æ‹¥å¡é¿å…ï¼Œä¸€å¼€å§‹æ…¢æ…¢çš„å‘é€ï¼Œé€æ¸å¢å¤§å‘é€é€Ÿç‡ï¼ˆçº¿æ€§ä¸Šå‡ç›´è‡³ç½‘ç»œæœ€ä½³å€¼ï¼‰ï¼Œå†æ…¢ä¸‹æ¥ä¾æ¬¡é‡å¤ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æ…¢å¼€å§‹é˜¶æ®µï¼ŒTCPè¿æ¥æ¯æ”¶åˆ°ä¸€ä¸ªæ•°æ®çš„ACKï¼ˆä¸åŒ…æ‹¬é‡å¤çš„ACKï¼‰ï¼Œæ‹¥å¡çª—å£å°±ç¿»å€å¢åŠ ä¸€ä¸ªMSS(æœ€å¤§æŠ¥æ–‡å¤§å°)ï¼Œå½“è¾¾åˆ°äº†æ…¢å¼€å§‹çš„é˜ˆå€¼ï¼Œå¢é•¿é€Ÿåº¦å°±ä¼šæ”¾ç¼“ï¼Œè¿›å…¥æ‹¥å¡é¿å…é˜¶æ®µï¼Œå˜æˆäº†æ¯è¿‡ä¸€ä¸ªRTTï¼Œæ‹¥å¡çª—å£å°±ä¼šå¢é•¿ä¸€ä¸ªMSSï¼›&lt;/p&gt;
&lt;p&gt;æ¯ä¸€ä¸ªTCPè¿æ¥ç‹¬ç«‹ç»´æŠ¤è‡ªå·±çš„æ‹¥å¡çª—å£ï¼Œæ‹¥å¡çª—å£ä¸€èˆ¬æ¯”MSSå¤§ï¼Œä¸€èˆ¬æ˜¯MSSçš„æŸä¸ªå€æ•°ï¼ŒMSSçš„ä¸Šé™ä¸€èˆ¬æ˜¯1460å­—èŠ‚ï¼Œä¸€ä¸ªçª—å£å°±æ˜¯nä¸ªMSSï¼›å‘é€çª—å£å¤§å° = min(æ‹¥å¡çª—å£å¤§å°ï¼Œæ¥æ”¶çª—å£å¤§å°)ï¼›&lt;/p&gt;
&lt;p&gt;æ‹¥å¡çª—å£ç”±å‘é€æ–¹ç»´æŠ¤ï¼Œä¸æ”¾åœ¨TCPå¤´éƒ¨ä¸­ï¼›&lt;/p&gt;
&lt;p&gt;æ‹¥å¡é¿å…æ—¶ä¼šé‡å¤æ…¢å¼€å§‹ï¼Œæ¯æ¬¡æ”¶åˆ°ä¸€ä¸ªæ•°æ®çš„ACKï¼Œæ‹¥å¡çª—å£å¢åŠ é‡ä¼šè¿›è¡Œå‡åŠï¼Œåœ¨å†æ¬¡è¿›å…¥æ…¢å¼€å§‹+æ‹¥å¡é¿å…ï¼Œæ‰€ä»¥ï¼Œæ…¢å¼€å§‹ä¸æ­¢åœ¨TCPè¿æ¥å¯åŠ¨æ—¶å‘ç”Ÿï¼Œä¹Ÿæœ‰å¯èƒ½åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­åå¤å‘ç”Ÿã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/TCP_%e6%85%a2%e5%bc%80%e5%a7%8b&amp;#43;%e6%8b%a5%e5%a1%9e%e9%81%bf%e5%85%8d.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/TCP_%e6%85%a2%e5%bc%80%e5%a7%8b&amp;#43;%e6%8b%a5%e5%a1%9e%e9%81%bf%e5%85%8d.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			alt=&#34;æ…¢å¼€å§‹&amp;#43;æ‹¥å¡é¿å…&#34;&gt;
	&lt;/a&gt;
	
	&lt;figcaption&gt;æ…¢å¼€å§‹+æ‹¥å¡é¿å…&lt;/figcaption&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¿«é‡ä¼  + å¿«æ¢å¤ï¼Œå½“æ‹¥å¡å‘ç”Ÿæ—¶ï¼Œå‡å°‘è¶…æ—¶é‡ä¼ çš„ä½¿ç”¨ï¼Œè€Œæ˜¯ä½¿ç”¨å¿«é€Ÿé‡ä¼ æœºåˆ¶&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;TCPæ¯å‘é€ä¸€ä¸ªæŠ¥æ–‡ï¼Œå°±ä¼šå¯åŠ¨ä¸€ä¸ªè¶…æ—¶è®¡æ—¶å™¨ï¼Œå¦‚æœåœ¨é™å®šæ—¶é—´å†…æ²¡æœ‰æ”¶åˆ°è¿™ä¸ªæŠ¥æ–‡çš„ACKï¼Œå‘é€æ–¹å°±ä¼šè®¤ä¸ºæŠ¥æ–‡ä¸¢å¤±ï¼Œæ­¤æ—¶å°±ä¼šè¿›è¡Œè¶…æ—¶é‡ä¼ ï¼Œä¸€èˆ¬æœ€å°çš„è¶…æ—¶é‡ä¼ æ—¶é—´æ˜¯200msï¼Œä¸ºäº†è§£å†³æ¯æ¬¡ä¸¢åŒ…éƒ½è¦ç­‰å¾…200msæˆ–è€…æ›´é•¿çš„æ—¶é—´æ‰ä¼šé‡ä¼ çš„é—®é¢˜ï¼ŒTCPå°±ä¼šé‡‡ç”¨å¿«é€Ÿé‡ä¼ ï¼Œä¸€æ—¦å‘é€æ–¹æ”¶åˆ°3æ¬¡é‡å¤ç¡®è®¤ï¼Œå°±ä¸ç”¨ç­‰è¶…æ—¶è®¡æ—¶å™¨äº†ï¼Œä¼šç›´æ¥é‡ä¼ è¿™ä¸ªæŠ¥æ–‡ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨Renoæ‹¥å¡æ§åˆ¶ç®—æ³•ä¸­ï¼ŒTCPåœ¨é‡åˆ°æ‹¥å¡ç‚¹åï¼Œä¸ä¼šåå¤è¿›è¡Œæ…¢å¼€å§‹+æ‹¥å¡é¿å…ï¼Œè€Œæ˜¯æ‹¥å¡çª—å£å‡åŠï¼Œç›´æ¥è¿›å…¥å¿«é€Ÿé‡ä¼ ï¼Œä¸è¿›å…¥æ…¢å¼€å§‹ï¼Œä¿æŒè·Ÿæ‹¥å¡é¿å…ä¸€æ ·çš„çº¿æ€§å¢é•¿ï¼Œç›´åˆ°ä¸‹ä¸€ä¸ªæ‹¥å¡ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;ç½‘ç»œä¸Šçš„é™é€Ÿï¼ŒåŸç†å…¶å®å°±æ˜¯è®¾ç½®æ‹¥å¡çª—å£çš„ä¸Šé™ï¼Œå½“è¶…è¿‡é™åˆ¶ï¼Œå°±ä¼šä¸¢å¼ƒè¿™äº›æŠ¥æ–‡ï¼Œä¸»åŠ¨è¿›å…¥æ‹¥å¡é¿å…é˜¶æ®µï¼Œç¡®ä¿ä¼ è¾“é€Ÿåº¦ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/TCP%e6%8b%a5%e5%a1%9e_%e5%bf%ab%e9%80%9f%e6%81%a2%e5%a4%8d.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/TCP%e6%8b%a5%e5%a1%9e_%e5%bf%ab%e9%80%9f%e6%81%a2%e5%a4%8d.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			alt=&#34;å¿«æ¢å¤&#34;&gt;
	&lt;/a&gt;
	
	&lt;figcaption&gt;å¿«æ¢å¤&lt;/figcaption&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸ºäº†å®ç°ä¸Šé¢ä¸¤ç§æœºåˆ¶ï¼ŒTCPä½¿ç”¨BBRæ‹¥å¡ç®—æ³•ï¼Œæ¥è¾¾åˆ°é«˜å¸¦å®½å’Œä½å»¶æ—¶çš„å¹³è¡¡&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;æµé‡æ§åˆ¶å’Œæ‹¥å¡æ§åˆ¶çš„åŒºåˆ«ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æµé‡æ§åˆ¶é’ˆå¯¹æ¥æ”¶æ–¹ï¼Œä¸ºäº†è®©æ¥æ”¶æ–¹èƒ½æ¥å¾—åŠæ¥æ”¶ï¼Œæ ¹æ®æ¥æ”¶æ–¹è‡ªå·±çš„èƒ½åŠ›ï¼Œæ§åˆ¶å‘é€é€Ÿåº¦ï¼Œé˜²æ­¢åˆ†ç»„ä¸¢å¤±ï¼›&lt;/p&gt;
&lt;p&gt;è€Œæ‹¥å¡æ§åˆ¶æ˜¯ä¸ºäº†é˜²æ­¢è¿‡å¤šçš„æ•°æ®åŒ…æ³¨å…¥åˆ°ç½‘ç»œä¸­ï¼Œé™ä½æ•´ä¸ªç½‘ç»œçš„æ‹¥å¡ç¨‹åº¦ï¼Œé¿å…å‡ºç°ç½‘ç»œè´Ÿè½½è¿‡è½½ï¼›&lt;/p&gt;
&lt;h2 id=&#34;ä¼˜åŒ–&#34;&gt;ä¼˜åŒ–&lt;/h2&gt;
&lt;p&gt;å‚è€ƒï¼šhttps://xiaolincoding.com/network/3_tcp/tcp_optimize.html&lt;/p&gt;
&lt;h1 id=&#34;udpuser-datagram-protocol-ç”¨æˆ·æ•°æ®æŠ¥åè®®&#34;&gt;UDPï¼ˆUser Datagram Protocol ç”¨æˆ·æ•°æ®æŠ¥åè®®ï¼‰&lt;/h1&gt;
&lt;h2 id=&#34;ç‰¹ç‚¹-1&#34;&gt;ç‰¹ç‚¹&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;ä¸å¯é çš„ã€æ— è¿æ¥çš„ï¼Œå°½æœ€å¤§å¯èƒ½äº¤ä»˜ï¼Œåªè´Ÿè´£å‘é€æ•°æ®ï¼Œæ— çŠ¶æ€æœåŠ¡&lt;/li&gt;
&lt;li&gt;æ²¡æœ‰æ‹¥å¡æ§åˆ¶ï¼Œæµé‡æ§åˆ¶&lt;/li&gt;
&lt;li&gt;é¢å‘æŠ¥æ–‡ï¼ˆå¯¹äºåº”ç”¨ç¨‹åºä¼ ä¸‹æ¥çš„æŠ¥æ–‡ä¸åˆå¹¶ä¹Ÿä¸æ‹†åˆ†ï¼Œåªæ˜¯æ·»åŠ  UDP é¦–éƒ¨ï¼‰ï¼Œä¸€ä¸ªä¸€ä¸ªåœ°å‘ï¼Œä¸€ä¸ªä¸€ä¸ªåœ°æ”¶&lt;/li&gt;
&lt;li&gt;å¤´éƒ¨åªæœ‰8å­—èŠ‚&lt;/li&gt;
&lt;li&gt;æ”¯æŒä¸€å¯¹ä¸€ã€ä¸€å¯¹å¤šã€å¤šå¯¹ä¸€å’Œå¤šå¯¹å¤šçš„äº¤äº’é€šä¿¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;åº”ç”¨åœºæ™¯-1&#34;&gt;åº”ç”¨åœºæ™¯&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;é’ˆå¯¹ç½‘ç»œèµ„æºå°‘ï¼Œå¯¹ä¸¢åŒ…ä¸æ•æ„Ÿçš„åº”ç”¨ï¼Œæ¯”å¦‚åº”ç”¨å±‚çš„DHCPï¼Œåœ¨è·å–IPåœ°å€å’Œå­ç½‘æ©ç çš„ä½¿ç”¨ï¼ŒDNSã€SNMPç­‰&lt;/li&gt;
&lt;li&gt;éœ€è¦å¹¿æ’­çš„åº”ç”¨ï¼Œæ¯”å¦‚DHCPã€VXLAN&lt;/li&gt;
&lt;li&gt;éœ€è¦å¤„ç†é€Ÿåº¦å¿«ï¼Œæ—¶å»¶ä½ï¼Œå®¹å¿ä¸¢åŒ…ã€ç½‘ç»œæ‹¥å¡çš„åº”ç”¨ï¼Œæ¯”å¦‚ç›´æ’­ã€è§†é¢‘ï¼Œå…è®¸ä¸¢åŒ…ï¼Œè™½ç„¶ä¸¢åŒ…ä¼šå¯¼è‡´ä¸¢å¸§ï¼Œä½†å½±å“ä¸ä¼šå¾ˆå¤§ï¼›å®æ—¶æ¸¸æˆã€ç‰©è”ç½‘ç»ˆç«¯çš„æ•°æ®æ”¶é›†ï¼Œå…¶å®å¤§å¤šæ•°ä¼šåŸºäºUDPåšä¸€å®šçš„æ”¹è¿›ï¼Œå‡å°‘UDPåŠ£åŠ¿çš„å½±å“&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;åŒ…å¤´-1&#34;&gt;åŒ…å¤´&lt;/h2&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/UDP%e5%8c%85%e5%a4%b4.jpg&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/UDP%e5%8c%85%e5%a4%b4.jpg&#34;
			
			
			
			loading=&#34;lazy&#34;
			alt=&#34;UDPåŒ…å¤´&#34;&gt;
	&lt;/a&gt;
	
	&lt;figcaption&gt;UDPåŒ…å¤´&lt;/figcaption&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;UDPåŒ…å¤´æ¯”è¾ƒç®€å•ï¼Œä¸¤ç«¯é€šä¿¡æ—¶ï¼Œé€šè¿‡ç½‘ç»œå±‚é‡Œçš„IPï¼Œå°†æ•°æ®åŒ…å‘é€ç»™å¯¹åº”çš„æœºå™¨ï¼ŒIPå¤´é‡Œæœ‰ä¸ª8ä½åè®®ï¼Œè¡¨æ˜è¯¥æ•°æ®æ˜¯UDPåè®®çš„ï¼Œè§£æåˆ°ä¼ è¾“å±‚ï¼Œé€šè¿‡UDPåŒ…å¤´æä¾›ç«¯å£å·ï¼Œè®©ç›®æ ‡æœºå™¨ç›‘å¬è¯¥ç«¯å£å·çš„åº”ç”¨ç¨‹åºè¿›è¡Œå¤„ç†&lt;/p&gt;
&lt;h2 id=&#34;ä½¿ç”¨åœºæ™¯&#34;&gt;ä½¿ç”¨åœºæ™¯&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;ç½‘ç»œç¯å¢ƒè¾ƒå¥½ï¼Œå¦‚å†…ç½‘åº”ç”¨ï¼Œæˆ–è€…å¯¹äºä¸¢åŒ…ä¸æ•æ„Ÿçš„åº”ç”¨&lt;/li&gt;
&lt;li&gt;éœ€è¦å¹¿æ’­æˆ–å¤šæ’­&lt;/li&gt;
&lt;li&gt;éœ€è¦å¤„ç†é€Ÿåº¦å¿«ï¼Œæ—¶å»¶ä½ï¼Œå®¹å¿ä¸¢åŒ…å’Œç½‘ç»œæ‹¥å¡&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;udpå¦‚ä½•å®ç°tcp&#34;&gt;UDPå¦‚ä½•å®ç°TCP&lt;/h1&gt;
&lt;p&gt;å»ºç«‹è¿æ¥ï¼Œæ˜¯ä¸ºäº†åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ç»´æŠ¤è¿æ¥ï¼Œè€Œå»ºç«‹ä¸€å®šçš„æ•°æ®ç»“æ„æ¥ç»´æŠ¤åŒæ–¹äº¤äº’çš„çŠ¶æ€ï¼Œé€šè¿‡è¿™æ ·çš„æ•°æ®ç»“æ„æ¥ä¿è¯é¢å‘è¿æ¥çš„ç‰¹æ€§ã€‚&lt;/p&gt;
&lt;p&gt;UDPå±äºä¼ è¾“å±‚ï¼Œåè®®å·²ç»å®šæ­»äº†ï¼Œè¦å®ç°TCPçš„åŠŸèƒ½åªèƒ½åœ¨åº”ç”¨å±‚å®ç°ï¼Œæ¨¡æ‹ŸTCPæœ‰çš„é‚£äº›åŠŸèƒ½ï¼šç¡®è®¤æœºåˆ¶ã€é‡ä¼ æœºåˆ¶ã€çª—å£ç¡®è®¤æœºåˆ¶ã€æµé‡æ§åˆ¶ã€æ‹¥å¡æ§åˆ¶ç­‰é‚£äº›åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;p&gt;UDPå®ç°å¯é æ€§ï¼Œå¯ä»¥ç®€å•ç†è§£æˆï¼Œå°†TCPçš„ä¸‰æ¬¡æ¡æ‰‹å‘é€æ•°æ®å…¨ç¨‹ç”¨UDPå»å‘é€ï¼Œæ¨¡æ‹ŸTCPçš„åŒ…å¤´&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;seq/ackæœºåˆ¶ï¼Œç¡®ä¿æ•°æ®å‘é€åˆ°å¯¹ç«¯&lt;/li&gt;
&lt;li&gt;æ•°æ®åŒ… + åºå·ï¼Œç¡®ä¿æœ‰åºæ€§&lt;/li&gt;
&lt;li&gt;æ•°æ®åŒ… + ç¡®è®¤åºå·ï¼Œç¡®ä¿ä¸ä¸¢åŒ…&lt;/li&gt;
&lt;li&gt;æ·»åŠ å‘é€å’Œæ¥æ”¶ç¼“å†²åŒºï¼Œä¸»è¦æ˜¯ç”¨æˆ·è¶…æ—¶é‡ä¼ ã€‚&lt;/li&gt;
&lt;li&gt;å®šæ—¶ä»»åŠ¡å®ç°è¶…æ—¶é‡ä¼ æœºåˆ¶ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å‘é€ç«¯å‘é€æ•°æ®æ—¶ï¼Œç”Ÿæˆä¸€ä¸ªéšæœºseq=xï¼Œç„¶åæ¯ä¸€ç‰‡æŒ‰ç…§æ•°æ®å¤§å°åˆ†é…seqã€‚æ•°æ®åˆ°è¾¾æ¥æ”¶ç«¯åæ¥æ”¶ç«¯æ”¾å…¥ç¼“å­˜ï¼Œå¹¶å‘é€ä¸€ä¸ªack=xçš„åŒ…ï¼Œè¡¨ç¤ºå¯¹æ–¹å·²ç»æ”¶åˆ°äº†æ•°æ®ã€‚å‘é€ç«¯æ”¶åˆ°äº†ackåŒ…åï¼Œåˆ é™¤ç¼“å†²åŒºå¯¹åº”çš„æ•°æ®ã€‚æ—¶é—´åˆ°åï¼Œå®šæ—¶ä»»åŠ¡æ£€æŸ¥æ˜¯å¦éœ€è¦é‡ä¼ æ•°æ®&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://blog.csdn.net/AaronHyk/article/details/81505562&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;å¦‚ä½•å®ç°UDPçš„å¯é ä¼ è¾“&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚æœ‰QUICåè®®ï¼Œå°±æ˜¯åŸºäºUDPå®ç°çš„å¯é ä¼ è¾“åè®®ï¼Œä¹Ÿæ˜¯åœ¨åº”ç”¨å±‚å®ç°çš„ã€‚&lt;/p&gt;
&lt;h1 id=&#34;å¥—æ¥å­—socket&#34;&gt;å¥—æ¥å­—Socket&lt;/h1&gt;
&lt;p&gt;Socketæ˜¯å¯¹TCPæˆ–UDPåè®®çš„å°è£…ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªè°ƒç”¨æ¥å£ï¼Œè€Œéåè®®ï¼Œå·¥ä½œåœ¨OISæ¨¡å‹çš„ç¬¬äº”å±‚ï¼ˆä¼šè¯å±‚ï¼‰&lt;/p&gt;
&lt;h2 id=&#34;åŸºäºtcpåè®®çš„socket&#34;&gt;åŸºäºTCPåè®®çš„Socket&lt;/h2&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/%e5%9f%ba%e4%ba%8eTCP%e7%9a%84Socket.jpg&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/%e5%9f%ba%e4%ba%8eTCP%e7%9a%84Socket.jpg&#34;
			
			
			
			loading=&#34;lazy&#34;
			alt=&#34;åŸºäºTCPçš„Socket&#34;&gt;
	&lt;/a&gt;
	
	&lt;figcaption&gt;åŸºäºTCPçš„Socket&lt;/figcaption&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æœåŠ¡ç«¯åªè°ƒç”¨bind()æ–¹æ³•ï¼Œä¸è°ƒç”¨listen()æ–¹æ³•ï¼Œå¦‚æœå®¢æˆ·ç«¯ç›´æ¥æ ¹æ®è¿™ä¸ªipå’Œç«¯å£è¿›è¡Œè¿æ¥ï¼Œæ­¤æ—¶æ— æ³•è”é€šï¼ŒæœåŠ¡ç«¯ä¼šç›´æ¥è¿”å›RSTæŠ¥æ–‡ï¼›&lt;/li&gt;
&lt;li&gt;ä½†æ˜¯ä¸è°ƒç”¨listen()ï¼Œæ˜¯å¯ä»¥å»ºç«‹TCPè¿æ¥çš„ï¼Œè€Œsocketä¸è¡Œè€Œå·²ã€‚åœ¨TCPä¸­ï¼Œå­˜åœ¨è‡ªè¿æ¥ï¼Œå³å®¢æˆ·ç«¯è‡ªå·±è¿è‡ªå·±ï¼Œä¸èƒ½æœ‰æœåŠ¡ç«¯å‚ä¸ï¼Œæ­¤æ—¶æ˜¯å¯ä»¥å»ºç«‹è¿æ¥çš„ã€‚è™½ç„¶ä¸è°ƒç”¨listen()æ–¹æ³•ï¼Œä¸ä¼šåˆ›å»ºåŠè¿æ¥é˜Ÿåˆ—å’Œå…¨è¿æ¥é˜Ÿåˆ—ï¼Œä½†å†…æ ¸æœ‰ä¸ªå…¨å±€çš„hashè¡¨ï¼Œå¯ä»¥å­˜æ”¾socketè¿æ¥çš„ä¿¡æ¯ï¼Œè¿æ¥ä¿¡æ¯é€šè¿‡å›ç¯åœ°å€ä»è¿™ä¸ªå…¨å±€hashè¡¨ä¸­å–å‡ºï¼Œæœ€åæˆåŠŸå»ºç«‹è¿æ¥ï¼›&lt;/li&gt;
&lt;li&gt;ä¸è°ƒç”¨accept()æ–¹æ³•ï¼Œä¹Ÿèƒ½è¿›è¡Œä¸‰æ¬¡æ¡æ‰‹ï¼Œå»ºç«‹è¿æ¥ï¼Œç”šè‡³ï¼ŒæœåŠ¡ç«¯åœ¨æ‰§è¡Œaccept()æ–¹æ³•å‰ï¼Œå¦‚æœå®¢æˆ·ç«¯å‘é€æ¶ˆæ¯ç»™æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯èƒ½æ­£å¸¸å›å¤ACKç¡®è®¤åŒ…çš„ã€‚å› ä¸ºaccept()æ–¹æ³•æœ¬èº«ä¸å‚ä¸æ¡æ‰‹ï¼Œæ‰§è¡Œaccept()åªæ˜¯ä¸ºäº†ä»å…¨è¿æ¥é˜Ÿåˆ—é‡Œå–å‡ºä¸€æ¡å¯ç”¨è¿æ¥è€Œå·²ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;åŸºäºudpåè®®çš„socket&#34;&gt;åŸºäºUDPåè®®çš„Socket&lt;/h2&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/%e5%9f%ba%e4%ba%8eUDP%e7%9a%84Socket.jpg&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/%e5%9f%ba%e4%ba%8eUDP%e7%9a%84Socket.jpg&#34;
			
			
			
			loading=&#34;lazy&#34;
			alt=&#34;åŸºäºUDPçš„Socket&#34;&gt;
	&lt;/a&gt;
	
	&lt;figcaption&gt;åŸºäºUDPçš„Socket&lt;/figcaption&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æœåŠ¡ç«¯å¦‚ä½•ç®¡ç†è¿™äº›è¿æ¥å’Œèµ„æºï¼Ÿ&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;çˆ¶è¿›ç¨‹ä½¿ç”¨å­è¿›ç¨‹æ¥ç®¡ç†è¿æ¥å’Œèµ„æºï¼Œå­è¿›ç¨‹åœ¨å®Œæˆè¿æ¥å’Œæ•°æ®é€šä¿¡åå‘Šè¯‰çˆ¶è¿›ç¨‹è¿›è¡Œå›æ”¶&lt;/li&gt;
&lt;li&gt;çº¿ç¨‹æ±  + è¿æ¥æ± ï¼Œæ¯ä¸ªçº¿ç¨‹ç®¡ç†ä¸€ä¸ªsocketï¼Œè¿æ¥æ± å®ç°socketå¤ç”¨&lt;/li&gt;
&lt;li&gt;IOå¤šè·¯å¤ç”¨ï¼Œä¸€ä¸ªçº¿ç¨‹ç»´æŠ¤å¤šä¸ªsocketï¼Œå¦‚Java NIOã€Nettyçš„ç½‘ç»œæ¨¡å‹&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;è¿æ¥æ± å®ç°&#34;&gt;è¿æ¥æ± å®ç°&lt;/h1&gt;
&lt;p&gt;å†™å¾—çœŸä¸é”™ï¼Œæ¸…æ™°æ˜“æ‡‚ &lt;a class=&#34;link&#34; href=&#34;https://yusank.space/posts/conn-pool/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://yusank.space/posts/conn-pool/&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h1&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://blog.csdn.net/jungle_hello/article/details/51465119&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;TCP/IPå‚è€ƒ1&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://blog.csdn.net/qq_18425655/article/details/52163228&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;TCP/IPå‚è€ƒ2&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;&#34; &gt;æå®¢æ—¶é—´ - è¶£è°ˆç½‘ç»œåè®®&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://coolshell.cn/articles/11564.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;TCP çš„é‚£äº›äº‹å„¿&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://juejin.cn/post/6983639186146328607&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;é¢è¯•å¿…å¤‡ï¼TCPåè®®ç»å…¸åäº”è¿é—®ï¼&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://xiaolincoding.com/network/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;å°æ—coding - å›¾è§£ç½‘ç»œ&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://coolshell.cn/articles/11564.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://coolshell.cn/articles/11564.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://coolshell.cn/articles/11609.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://coolshell.cn/articles/11609.html&lt;/a&gt;&lt;/p&gt;
</description>
        </item>
        <item>
        <title>åˆ†å¸ƒå¼ç›¸å…³</title>
        <link>http://nixum.cc/p/%E5%88%86%E5%B8%83%E5%BC%8F%E7%9B%B8%E5%85%B3/</link>
        <pubDate>Fri, 14 Aug 2020 00:00:00 +0000</pubDate>
        
        <guid>http://nixum.cc/p/%E5%88%86%E5%B8%83%E5%BC%8F%E7%9B%B8%E5%85%B3/</guid>
        <description>&lt;p&gt;[TOC]&lt;/p&gt;
&lt;h1 id=&#34;åˆ†å¸ƒå¼ç†è®º&#34;&gt;åˆ†å¸ƒå¼ç†è®º&lt;/h1&gt;
&lt;p&gt;ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿæœ€å¤šåªèƒ½æ»¡è¶³ Cã€Aã€P è¿™ä¸‰é¡¹ä¸­çš„ä¸¤é¡¹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;capç†è®º&#34;&gt;CAPç†è®º&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Cï¼šConsistencyï¼Œä¸€è‡´æ€§ï¼Œæ•°æ®çŠ¶æ€è½¬åŒ–ä¸€è‡´ï¼Œå†™æ“ä½œå®Œæˆåçš„è¯»æ“ä½œï¼Œå¯ä»¥&lt;strong&gt;è·å–åˆ°æœ€æ–°çš„å€¼&lt;/strong&gt;ï¼›&lt;/li&gt;
&lt;li&gt;Aï¼šAvailabilityï¼Œå¯ç”¨æ€§ï¼ŒæŒ‡çš„æ˜¯æœåŠ¡ä¸€ç›´å¯ç”¨ï¼Œå¯ä»¥&lt;strong&gt;æ­£å¸¸å“åº”&lt;/strong&gt;ï¼Œæˆ–è€…åœ¨è§„å®šæ—¶é—´å†…å¯ä»¥è·å–åˆ°å“åº”ï¼›&lt;/li&gt;
&lt;li&gt;Pï¼šPartition toleranceï¼Œåˆ†åŒºå®¹é”™ï¼ŒæŒ‡çš„æ˜¯å½“æœ‰èŠ‚ç‚¹æ•…éšœä¸è¿é€šæ—¶(æ¯”å¦‚ç½‘ç»œå‡ºé—®é¢˜)ï¼Œå°±ä¼š&lt;strong&gt;åˆ†åŒºï¼Œä½†ä»ç„¶èƒ½å¯¹å¤–æä¾›æœåŠ¡&lt;/strong&gt;ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;çŸ›ç›¾åœ¨äºè¿™ä¸‰ä¸ªç‰¹æ€§ä¸èƒ½åŒæ—¶æ»¡è¶³ï¼Œæ¯”å¦‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å½“åˆ†å¸ƒå¼é›†ç¾¤å†…æœ‰ä¸¤ä¸ªä¸»ä»æœåŠ¡å‘ç”Ÿç½‘ç»œæ•…éšœï¼Œä½†æ­¤æ—¶æœåŠ¡ä»ç„¶å¯ä»¥è®¿é—®ï¼Œæ­¤æ—¶å…·æœ‰åˆ†åŒºå®¹é”™æ€§ã€‚&lt;/p&gt;
&lt;p&gt;å½“å¯¹ä¸»æœåŠ¡å¯¹æ•°æ®è¿›è¡Œä¿®æ”¹æ—¶ï¼Œç”±äºç½‘ç»œé—®é¢˜ï¼Œæ— æ³•åŒæ­¥åˆ°ä»æœåŠ¡ï¼Œå½“è®¿é—®åˆ°ä»æœåŠ¡æ—¶ï¼Œæ— æ³•è·å–åˆ°æœ€æ–°çš„å€¼ï¼Œæ­¤æ—¶æ»¡è¶³å¯ç”¨æ€§ï¼Œä½†æ˜¯æ— æ³•æ»¡è¶³ä¸€è‡´æ€§ã€‚&lt;/p&gt;
&lt;p&gt;å½“ä¸»ä»æœåŠ¡é—´ç½‘ç»œæ¢å¤ï¼Œå†™æ“ä½œçš„æ•°æ®è™½ç„¶èƒ½åœ¨æœåŠ¡é—´åŒæ­¥äº†ï¼Œä½†è¿˜æœªåŒæ­¥å®Œæˆï¼Œæ­¤æ—¶è®¿é—®ä»æœåŠ¡æ— æ³•è·å–æœ€æ–°å€¼ï¼Œæ­¤æ—¶æ»¡è¶³äº†ä¸€è‡´æ€§ï¼Œä½†æ˜¯æ— æ³•æ»¡è¶³å¯ç”¨æ€§ã€‚&lt;/p&gt;
&lt;p&gt;ç®€å•æ¦‚æ‹¬ï¼Œåªè¦æ»¡è¶³åˆ†åŒºå®¹é”™ï¼Œå°±ä¼šè®¾ç½®å¤åˆ¶é›†ï¼Œå¤åˆ¶é›†åŒæ—¶ä¹Ÿä¿è¯äº†å¯ç”¨ï¼Œä½†æ˜¯å¤åˆ¶é›†åˆä¼šæœ‰æ•°æ®åŒæ­¥ï¼Œæ­¤æ—¶åˆæœ‰ä¸€è‡´æ€§é—®é¢˜&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æ‰€ä»¥ï¼Œä¸€èˆ¬åªä¼šæ»¡è¶³å…¶ä¸­ä¸¤ä¸ª&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;1ã€æ»¡è¶³CAèˆå¼ƒPï¼Œä¹Ÿå°±æ˜¯æ»¡è¶³ä¸€è‡´æ€§å’Œå¯ç”¨æ€§ï¼Œèˆå¼ƒå®¹é”™æ€§ã€‚ä½†æ˜¯è¿™ä¹Ÿå°±æ„å‘³ç€ä½ çš„ç³»ç»Ÿä¸æ˜¯åˆ†å¸ƒå¼çš„äº†ï¼Œå› ä¸ºæ¶‰åŠåˆ†å¸ƒå¼çš„æƒ³æ³•å°±æ˜¯æŠŠåŠŸèƒ½åˆ†å¼€ï¼Œéƒ¨ç½²åˆ°ä¸åŒçš„æœºå™¨ä¸Šï¼Œè€Œä¸”å¦‚æœå‡ºç°äº†åˆ†åŒºé”™è¯¯ï¼Œå¿…å®šä¼šå¯¼è‡´éƒ¨åˆ†åŠŸèƒ½ä¸å¯ç”¨ï¼Œæ­¤æ—¶ä¹Ÿæ— æ³•æ»¡è¶³Aï¼Œæ‰€ä»¥ P å…¶å®æ˜¯å¿…ç„¶å­˜åœ¨çš„ï¼Œåªæœ‰å•æœºæ˜¯CAã€‚&lt;/p&gt;
&lt;p&gt;2ã€æ»¡è¶³CPèˆå¼ƒAï¼Œä¹Ÿå°±æ˜¯æ»¡è¶³ä¸€è‡´æ€§å’Œå®¹é”™æ€§ï¼Œèˆå¼ƒå¯ç”¨æ€§ã€‚å¦‚æœä½ çš„ç³»ç»Ÿå…è®¸æœ‰æ®µæ—¶é—´çš„è®¿é—®å¤±æ•ˆç­‰é—®é¢˜ï¼Œè¿™ä¸ªæ˜¯å¯ä»¥æ»¡è¶³çš„ã€‚å°±å¥½æ¯”å¤šä¸ªäººå¹¶å‘ä¹°ç¥¨ï¼Œåå°ç½‘ç»œå‡ºç°æ•…éšœï¼Œä½ ä¹°çš„æ—¶å€™ç³»ç»Ÿå°±å´©æºƒäº†ã€‚çœŸæ­£çš„å¼ºä¸€è‡´æ€§åœ¨åšåŒæ­¥çš„è¿‡ç¨‹ä¸­ä¼šé˜»å¡æ‰€æœ‰è¯·æ±‚ï¼Œå¯¼è‡´æ€§èƒ½ä¼šç‰¹åˆ«å·®ï¼Œæ­¤æ—¶å¯ç”¨æ€§å°±é™ä½äº†ï¼Œæ‰€ä»¥åƒZooKeeperè¿™ç§å…è®¸åŒæ­¥åˆ°ä¸€åŠèŠ‚ç‚¹ä»¥ä¸Šå°±ç®—æˆåŠŸçš„ï¼Œä¸ç®—æ˜¯çœŸæ­£çš„å¼ºä¸€è‡´æ€§ã€‚&lt;/p&gt;
&lt;p&gt;3ã€æ»¡è¶³APèˆå¼ƒCï¼Œä¹Ÿå°±æ˜¯æ»¡è¶³å¯ç”¨æ€§å’Œå®¹é”™æ€§ï¼Œèˆå¼ƒä¸€è‡´æ€§ã€‚è¿™ä¹Ÿå°±æ˜¯æ„å‘³ç€ä½ çš„ç³»ç»Ÿåœ¨å¹¶å‘è®¿é—®çš„æ—¶å€™å¯èƒ½ä¼šå‡ºç°æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æ‰€ä»¥ä¸ºäº†åˆ†å¸ƒå¼æœåŠ¡èƒ½æ­£å¸¸ä½¿ç”¨ï¼Œä¸€èˆ¬æ—¶ä¼šæ»¡è¶³åˆ†åŒºå®¹é”™æ€§å’Œå¯ç”¨æ€§ï¼Œåœ¨ä¸€è‡´æ€§ä¸Šä¸è¿½æ±‚å¼ºä¸€è‡´æ€§ï¼Œè€Œæ˜¯ä¸€ä¸ªé€æ¸ä¸€è‡´çš„è¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;baseç†è®º&#34;&gt;BASEç†è®º&lt;/h2&gt;
&lt;p&gt;BASEç†è®ºæ˜¯å¯¹CAPä¸‰è€…å‡è¡¡çš„ç»“æœï¼ŒåŸºäºCAPç†è®ºæ¼”åŒ–è€Œæ¥ï¼Œé€šè¿‡ç‰ºç‰²å¼ºä¸€è‡´æ€§æ¥è·å¾—é«˜å¯ç”¨ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Basically Availableï¼ˆåŸºæœ¬å¯ç”¨ï¼‰: å…è®¸æš‚æ—¶ä¸å¯ç”¨ï¼Œæ¯”å¦‚è®¿é—®æ—¶å¯ä»¥ç­‰å¾…è¿”å›ï¼ŒæœåŠ¡é™çº§ï¼Œä¿è¯æ ¸å¿ƒå¯ç”¨ç­‰ã€‚&lt;/li&gt;
&lt;li&gt;Soft stateï¼ˆè½¯çŠ¶æ€ï¼‰: å…è®¸ç³»ç»Ÿå­˜åœ¨ä¸­é—´çŠ¶æ€ï¼Œè€Œè¯¥ä¸­é—´çŠ¶æ€ä¸ä¼šå½±å“ç³»ç»Ÿæ•´ä½“å¯ç”¨æ€§ï¼Œæ¯”å¦‚å…è®¸å¤åˆ¶é›†å‰¯æœ¬é—´çš„æ•°æ®å­˜åœ¨å»¶æ—¶ï¼Œæ•°æ®åº“çš„æ•°æ®åŒæ­¥è¿‡ç¨‹ã€‚&lt;/li&gt;
&lt;li&gt;Eventually consistentï¼ˆæœ€ç»ˆä¸€è‡´æ€§ï¼‰: ç³»ç»Ÿä¸­çš„æ‰€æœ‰æ•°æ®å‰¯æœ¬ç»è¿‡ä¸€å®šæ—¶é—´åï¼Œæœ€ç»ˆèƒ½å¤Ÿè¾¾åˆ°ä¸€è‡´çš„çŠ¶æ€ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸æ•°æ®åº“ACIDç±»ä¼¼ï¼Œåªæ˜¯å¼ºåº¦å‡å¼±äº†&lt;/p&gt;
&lt;p&gt;å‚è€ƒï¼š&lt;a class=&#34;link&#34; href=&#34;&#34; &gt;CAP å®šç†çš„å«ä¹‰&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;å…³äºå¯é æ€§å¯ç”¨æ€§ç¨³å®šæ€§&#34;&gt;å…³äºå¯é æ€§ã€å¯ç”¨æ€§ã€ç¨³å®šæ€§&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¯é æ€§Reliability&lt;/strong&gt;ï¼šä¸å‡ºäº‹æ•…ï¼Œæ•…éšœç‡ä½ï¼Œå…³æ³¨çš„æ˜¯ç³»ç»Ÿæ— æ•…éšœåœ°æŒç»­è¿è¡Œçš„æ¦‚ç‡ï¼Œæ¯”å¦‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;MTBFï¼ˆMean Time Between Failureï¼‰ï¼šå³å¹³å‡æ— æ•…éšœæ—¶é—´ï¼Œæ˜¯æŒ‡ä»æ–°çš„äº§å“åœ¨è§„å®šçš„å·¥ä½œç¯å¢ƒæ¡ä»¶ä¸‹å¼€å§‹å·¥ä½œåˆ°å‡ºç°ç¬¬ä¸€ä¸ªæ•…éšœçš„æ—¶é—´çš„å¹³å‡å€¼ã€‚MTBFè¶Šé•¿è¡¨ç¤ºå¯é æ€§è¶Šé«˜ï¼Œæ­£ç¡®å·¥ä½œèƒ½åŠ›è¶Šå¼º ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;MTTRï¼ˆMean Time To Repairï¼‰ï¼šå³å¹³å‡ä¿®å¤æ—¶é—´ï¼Œæ˜¯æŒ‡å¯ä¿®å¤äº§å“çš„å¹³å‡ä¿®å¤æ—¶é—´ï¼Œå°±æ˜¯ä»å‡ºç°æ•…éšœåˆ°ä¿®å¤ä¸­é—´çš„è¿™æ®µæ—¶é—´ã€‚MTTRè¶ŠçŸ­è¡¨ç¤ºæ˜“æ¢å¤æ€§è¶Šå¥½ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;MTTFï¼ˆMean Time To Failureï¼‰ï¼šå³å¹³å‡å¤±æ•ˆæ—¶é—´ã€‚ç³»ç»Ÿå¹³å‡èƒ½å¤Ÿæ­£å¸¸è¿è¡Œå¤šé•¿æ—¶é—´ï¼Œæ‰å‘ç”Ÿä¸€æ¬¡æ•…éšœã€‚ç³»ç»Ÿçš„å¯é æ€§è¶Šé«˜ï¼Œå¹³å‡æ— æ•…éšœæ—¶é—´è¶Šé•¿ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸å¯ç”¨æ€§çš„å…³ç³»ï¼šAvailability = UpTime/(UpTime+DownTime) = MTBF / (MTBF + MTTR)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¯ç”¨æ€§Availability&lt;/strong&gt;ï¼šä¸å‡ºäº‹æ•…ï¼Œå¦‚æœå‡ºäº‹æ•…å¯ä»¥å¿«é€Ÿæ¢å¤ï¼Œå…³æ³¨çš„æ˜¯æœåŠ¡è¿è¡ŒæŒç»­æ—¶é—´ï¼Œæ¯”å¦‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;é€šä¿—å«æ³•&lt;/th&gt;
&lt;th&gt;å¯ç”¨æ€§çº§åˆ«&lt;/th&gt;
&lt;th&gt;å¹´åº¦å®•æœºæ—¶é—´&lt;/th&gt;
&lt;th&gt;å‘¨å®•æœºæ—¶é—´&lt;/th&gt;
&lt;th&gt;æ¯å¤©å®•æœºæ—¶é—´&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1ä¸ª9&lt;/td&gt;
&lt;td&gt;90%&lt;/td&gt;
&lt;td&gt;36.5å¤©&lt;/td&gt;
&lt;td&gt;16.8å°æ—¶&lt;/td&gt;
&lt;td&gt;2.4å°æ—¶&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2ä¸ª9&lt;/td&gt;
&lt;td&gt;99%&lt;/td&gt;
&lt;td&gt;87.6å°æ—¶&lt;/td&gt;
&lt;td&gt;1.68å°æ—¶&lt;/td&gt;
&lt;td&gt;14åˆ†é’Ÿ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;3ä¸ª9&lt;/td&gt;
&lt;td&gt;99.9%&lt;/td&gt;
&lt;td&gt;8.76å°æ—¶&lt;/td&gt;
&lt;td&gt;10.1åˆ†é’Ÿ&lt;/td&gt;
&lt;td&gt;86ç§’&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;4ä¸ª9&lt;/td&gt;
&lt;td&gt;99.99%&lt;/td&gt;
&lt;td&gt;52.6åˆ†é’Ÿ&lt;/td&gt;
&lt;td&gt;1.01åˆ†é’Ÿ&lt;/td&gt;
&lt;td&gt;8.6ç§’&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;5ä¸ª9&lt;/td&gt;
&lt;td&gt;99.999%&lt;/td&gt;
&lt;td&gt;5.26åˆ†é’Ÿï¼Œ315.36ç§’&lt;/td&gt;
&lt;td&gt;6.05ç§’&lt;/td&gt;
&lt;td&gt;0.86ç§’&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¨³å®šæ€§Stability&lt;/strong&gt;ï¼šæœåŠ¡æ€§èƒ½ç¨³å®šï¼Œä¸æ—¶å¿«æ—¶æ…¢ï¼Œå…³æ³¨çš„æ˜¯åœ¨ä¸€ä¸ªè¿è¡Œå‘¨æœŸå†…ï¼Œä¸€å®šå‹åŠ›ä¸‹ï¼ŒæŒç»­æ“ä½œæ—¶é—´å†…çš„å‡ºé”™æ¦‚ç‡ï¼Œæ€§èƒ½ä¼˜åŠ£ç­‰&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;åˆ†å¸ƒå¼äº‹åŠ¡&#34;&gt;åˆ†å¸ƒå¼äº‹åŠ¡&lt;/h1&gt;
&lt;h2 id=&#34;ä¸€2pc&#34;&gt;ä¸€ã€2PC&lt;/h2&gt;
&lt;p&gt;äºŒé˜¶æ®µæäº¤å…¶å®å°±æ˜¯å®ç°&lt;strong&gt;XAåˆ†å¸ƒå¼äº‹åŠ¡&lt;/strong&gt;çš„å…³é”®&lt;/p&gt;
&lt;p&gt;éœ€è¦æœ‰åè°ƒè€…å’Œå‚ä¸è€…ï¼Œåè°ƒè€…è´Ÿè´£è°ƒåº¦ï¼Œå‚ä¸è€…è´Ÿè´£æ‰§è¡Œï¼Œåˆ†ä¸¤æ­¥å®Œæˆï¼Œ1ï¼šprepareé˜¶æ®µ 2ï¼šcommité˜¶æ®µã€‚&lt;/p&gt;
&lt;p&gt;2PCæ˜¯&lt;strong&gt;å¼ºä¸€è‡´æ€§&lt;/strong&gt;çš„ï¼Œä¿è¯åŸå­æ€§å’Œéš”ç¦»æ€§ã€‚åœ¨æ‰§è¡Œé˜¶æ®µï¼ŒèŠ‚ç‚¹æ˜¯å¤„äºé˜»å¡çŠ¶æ€ï¼Œç›´åˆ°commité˜¶æ®µå®Œæˆï¼Œæœ¬åœ°äº‹åŠ¡æ‰ä¼šé‡Šæ”¾èµ„æºï¼Œå› æ­¤æ€§èƒ½ä¸ä½³ï¼Œä¸€èˆ¬ç”¨åœ¨å¼ºä¸€è‡´æ€§ã€å¹¶å‘é‡ä¸å¤§çš„åœºæ™¯ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ­£å¸¸æƒ…å†µä¸‹&#34;&gt;æ­£å¸¸æƒ…å†µä¸‹&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;prepareé˜¶æ®µ&lt;/strong&gt;ï¼šåè°ƒè€…å‘å‚ä¸è€…Aã€Bå‘é€è¯·æ±‚æ‰§è¡Œæ“ä½œï¼Œå‚ä¸è€…Aã€Bå¼€å¯äº‹åŠ¡ï¼Œæ‰§è¡Œæ“ä½œï¼Œä½†ä¸commitï¼Œæ“ä½œå®Œæˆåï¼Œå‘Šè¯‰åè°ƒè€…å·²ç»å®Œæˆã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;commité˜¶æ®µ&lt;/strong&gt;ï¼šåè°ƒè€…æ”¶åˆ°å‚ä¸è€…çš„å®Œæˆå“åº”ï¼Œå‘å‚ä¸è€…Aã€Bå‘é€commitè¯·æ±‚ï¼Œå‚ä¸è€…Aã€Bæ”¶åˆ°commitè¯·æ±‚åï¼Œæäº¤äº‹åŠ¡ï¼Œå®Œæˆæ“ä½œï¼›å¦‚æœæ”¶åˆ°æ‰§è¡Œå¤±è´¥çš„å“åº”ï¼Œåˆ™å‘é€å›æ»šè¯·æ±‚ç»™å‚ä¸è€…Aã€Bï¼Œæ‰§è¡Œå›æ»šã€‚&lt;/p&gt;
&lt;h3 id=&#34;å¼‚å¸¸æƒ…å†µä¸‹&#34;&gt;å¼‚å¸¸æƒ…å†µä¸‹&lt;/h3&gt;
&lt;p&gt;åœ¨åè°ƒè€…ç­‰å¾…å‚ä¸è€…çš„å®Œæˆå“åº”æ—¶ï¼Œåè°ƒè€…æˆ–å‚ä¸è€…å¯èƒ½å®•æœºï¼Œæœ€ç»ˆä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´æˆ–é˜»å¡ï¼Œä¾‹å¦‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;ï¼šprepareé˜¶æ®µï¼Œåè°ƒè€…æ­£å¸¸ï¼Œå‚ä¸è€…å®•æœºï¼Œå‚ä¸è€…æ²¡æœ‰æ”¶åˆ°è¯¢é—®è¯·æ±‚ï¼Œæˆ–è€…åè°ƒè€…æ²¡æœ‰æ”¶åˆ°å‚ä¸è€…çš„å›åº”&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;è§£å†³åŠæ³•&lt;/strong&gt;ï¼šåè°ƒè€…åšè¶…æ—¶å¤„ç†ï¼Œä¸€æ—¦è¶…æ—¶ï¼Œå½“ä½œå¤±è´¥ï¼Œå‘æ‰€æœ‰èŠ‚ç‚¹å‘é€äº‹åŠ¡ç»ˆæ­¢è¯·æ±‚ï¼Œæˆ–è€…å‘é€é‡è¯•è¯·æ±‚ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;ï¼šcommité˜¶æ®µï¼Œæ­£å¼æäº¤å‘å‡ºåï¼Œå¦‚æœæœ‰çš„å‚ä¸è€…æ²¡æœ‰æ”¶åˆ°ï¼Œæˆ–è€…å‚ä¸è€…æäº¤/å›æ»šçš„ç¡®è®¤ä¿¡æ¯æ²¡æœ‰è¿”å›ï¼Œå³å‚ä¸è€…çš„å›åº”è¶…æ—¶&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;è§£å†³æ–¹æ³•&lt;/strong&gt;ï¼šåè°ƒè€…æˆ–è€…å‚ä¸è€…è¿›è¡Œé‡è¯•ï¼Œæˆ–è€…æŠŠå‚ä¸è€…æ ‡è®°ä¸ºé—®é¢˜èŠ‚ç‚¹ç§»é™¤é›†ç¾¤åå›æ»š&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;ï¼šå½“å¤„äºcommité˜¶æ®µæ—¶ï¼Œåè°ƒè€…æŒ‚æ‰æˆ–é‡å¯ï¼Œä¼šå¯¼è‡´åè°ƒè€…æ”¶ä¸åˆ°å‚ä¸è€…çš„å“åº”ï¼Œæ­¤æ—¶åè°ƒè€…å°±ä¸æ¸…æ¥šcommité˜¶æ®µè¦å‘é€ä»€ä¹ˆè¯·æ±‚è¿‡å»ï¼Œæˆ–è€…å°±ä¸å‘è¯·æ±‚è¿‡å»äº†ï¼Œå¯¼è‡´å‚ä¸è€…ä¸€ç›´é˜»å¡&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;è§£å†³åŠæ³•&lt;/strong&gt;ï¼šåè°ƒè€…ç»´æŠ¤ä¸€ä»½äº‹åŠ¡æ—¥å¿—ï¼Œä»¥æ–¹ä¾¿å®•æœºé‡å¯åæ¢å¤åŸæ¥çš„çŠ¶æ€ï¼Œæ¯”å¦‚é‡æ–°å‘å‚ä¸è€…æŸ¥è¯¢ç»“æœï¼Œä½†æ— æ³•ä¸ºå‚ä¸è€…è®¾ç½®è¶…æ—¶è‡ªåŠ¨æ“ä½œï¼Œå› ä¸ºå®ƒå¹¶ä¸çŸ¥é“commité˜¶æ®µè‡ªå·±è¦è¿›è¡Œcommitè¿˜æ˜¯å›æ»š&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;ï¼šå½“å¤„äºcommité˜¶æ®µæ—¶ï¼Œå‚ä¸è€…æŒ‚æ‰åï¼Œæ¥æ”¶ä¸åˆ°åè°ƒè€…çš„è¯·æ±‚ï¼Œä¸çŸ¥é“æ¥ä¸‹æ¥è¦æ‰§è¡Œcommitè¿˜æ˜¯å›æ»šï¼Œåè°ƒè€…ä¹Ÿæ— æ³•åœ¨å‚ä¸è€…æŒ‚æ‰åè¿›è¡Œå›æ»šæ“ä½œï¼Œå› ä¸ºä¹Ÿä¸çŸ¥é“å‚ä¸è€…äº‹åŠ¡æ˜¯å¦å·²ç»å¤„ç†äº†&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;è§£å†³åŠæ³•&lt;/strong&gt;ï¼šä¸æ–­é‡è¯•ï¼Œæˆ–è€… 3pc&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;ç¼ºç‚¹&#34;&gt;ç¼ºç‚¹&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;æ€§èƒ½é—®é¢˜ï¼Œå‚ä¸è€…å’Œåè°ƒè€…éœ€è¦äº’ç›¸ç­‰å¾…ï¼Œåªæœ‰å½“æ‰€æœ‰èŠ‚ç‚¹å‡†å¤‡å®Œæ¯•ï¼Œåè°ƒè€…æ‰ä¼šè¿›è¡Œå…¨å±€æäº¤ï¼Œå‚ä¸è€…è¿›è¡Œæœ¬åœ°äº‹åŠ¡åæ‰ä¼šé‡Šæ”¾èµ„æºï¼Œé˜»å¡æ—¶é—´é•¿ï¼›&lt;/li&gt;
&lt;li&gt;å•ç‚¹æ•…éšœï¼Œåè°ƒè€…ä¸€æ—¦å‘ç”Ÿæ•…éšœï¼Œå‚ä¸è€…ä¼šä¸€ç›´é˜»å¡ï¼›&lt;/li&gt;
&lt;li&gt;æ•°æ®ä¸€è‡´æ€§é—®é¢˜ï¼Œåœ¨commité˜¶æ®µï¼Œå¦‚æœä¸€éƒ¨åˆ†å‚ä¸è€…æ”¶åˆ°æäº¤è¯·æ±‚ï¼Œä¸€éƒ¨åˆ†æ”¶ä¸åˆ°ï¼Œæ­¤æ—¶æ•°æ®ä¸ä¸€è‡´ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;äºŒ3pc&#34;&gt;äºŒã€3PC&lt;/h2&gt;
&lt;p&gt;3PCå®é™…ä¸Šå°±æ˜¯å°†prepareé˜¶æ®µæ‹†æˆä¸¤æ­¥ï¼ŒpreCommitç›¸å½“äºä¸€æ¬¡ä¿é™©é˜¶æ®µï¼Œä½œç”¨ç±»ä¼¼äº2PCçš„äºŒé˜¶æ®µï¼Œä½†æ˜¯å®ƒä¸æ˜¯çœŸæ­£çš„æäº¤ã€‚2PCåªæœ‰åè°ƒè€…è¶…æ—¶æœºåˆ¶ï¼Œå‚ä¸è€…ä¸¥é‡ä¾èµ–åè°ƒè€…ï¼Œè€Œ3PCå¼•å…¥äº†å‚ä¸è€…è¶…æ—¶çš„æœºåˆ¶ï¼Œä½¿å¾—å‚ä¸è€…ä¸ç”¨å¤ªè¿‡ä¾èµ–åè°ƒè€…ï¼Œè‡ªå·±æœ‰ä¸€å®šçš„å¤„ç†æƒé™ï¼Œè§£å†³2PCåœ¨commité˜¶æ®µï¼Œåè°ƒè€…åœ¨ä¸èƒ½å¤„ç†è¯·æ±‚æ—¶ï¼Œå‚ä¸è€…ä¸€ç›´é˜»å¡çš„é—®é¢˜ï¼Œ3PCåªæ˜¯ç¼“è§£äº†2PCé˜»å¡æ—¶é—´è¿‡é•¿çš„é—®é¢˜ï¼Œæœ¬èº«ä¹Ÿæ²¡æœ‰å®Œå…¨è§£å†³æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ï¼›&lt;/p&gt;
&lt;h3 id=&#34;æ­£å¸¸æƒ…å†µä¸‹-1&#34;&gt;æ­£å¸¸æƒ…å†µä¸‹&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;canCommité˜¶æ®µ&lt;/strong&gt;ï¼šåè°ƒè€…å‘æ‰€æœ‰å‚ä¸è€…å‘é€è¯·æ±‚ï¼Œå‚ä¸è€…å¼€å¯äº‹åŠ¡æ‰§è¡Œæ“ä½œï¼Œå°†ç»“æœè¿”å›ç»™åè°ƒè€…ï¼ŒæˆåŠŸå®Œæˆåå“åº”Yesï¼Œè¿›å…¥ä¸‹ä¸€é˜¶æ®µï¼Œå¦åˆ™å“åº”Noï¼Œç»“æŸã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;preCommité˜¶æ®µ&lt;/strong&gt;ï¼šåè°ƒè€…æ”¶åˆ°æ‰€æœ‰å‚ä¸è€…çš„Yeså“åº”ï¼Œè¿›è¡Œæœ¬åœ°äº‹åŠ¡ï¼Œè®°å½•æ—¥å¿—ï¼Œç„¶åå‘é€å¤„ç†ç»“æœçš„è¯·æ±‚ç»™æ‰€æœ‰å‚ä¸è€…ï¼Œå‘Šè¯‰æ‰€æœ‰å‚ä¸è€…è¿›è¡Œé¢„æäº¤çŠ¶æ€ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœå‚ä¸è€…èƒ½æ”¶åˆ°PreCommitè¯·æ±‚ï¼Œæ„å‘³ç€å®ƒçŸ¥é“å¤§å®¶éƒ½åŒæ„æäº¤äº†ï¼Œå³ä½¿åœ¨commité˜¶æ®µå‡ºç°é—®é¢˜ï¼Œå‚ä¸è€…ä¹Ÿå¯ä»¥åœ¨è¶…æ—¶ä¹‹åè¿›è¡Œäº‹åŠ¡æäº¤ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;commité˜¶æ®µ&lt;/strong&gt;ï¼šåè°ƒè€…æ”¶åˆ°æ‰€æœ‰å‚ä¸è€…çš„åº”ç­”å“åº”ï¼Œå‘æ‰€æœ‰å‚ä¸è€…å‘é€commitè¯·æ±‚ï¼Œå‚ä¸è€…æ”¶åˆ°åæäº¤äº‹åŠ¡ï¼Œå¦‚æœåè°ƒè€…å‘ç°éƒ¨åˆ†å‚ä¸è€…æ— æ³•æ‰§è¡Œäº‹åŠ¡ï¼Œåˆ™å‘æ‰€æœ‰å‚ä¸è€…å‘ç”Ÿrollbackè¯·æ±‚ï¼Œå›æ»šäº‹åŠ¡ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å¼‚å¸¸æƒ…å†µä¸‹-1&#34;&gt;å¼‚å¸¸æƒ…å†µä¸‹&lt;/h3&gt;
&lt;p&gt;å¦‚æœåœ¨preCommité˜¶æ®µåˆ°commité˜¶æ®µä¹‹é—´ï¼Œåè°ƒè€…æŒ‚äº†ï¼Œå‚ä¸è€…ä¼šåœ¨è¶…æ—¶åè¿›è¡Œäº‹åŠ¡æäº¤ï¼Œå¦‚æœåè°ƒè€…çš„æœ¬æ„æ˜¯è¦rollbackï¼Œåˆ™ä¼šäº§ç”Ÿæ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä¸‰tcc&#34;&gt;ä¸‰ã€TCC&lt;/h2&gt;
&lt;p&gt;è¡¥å¿äº‹åŠ¡ï¼Œæ¯ä¸€ä¸ªæ“ä½œéƒ½è¦æœ‰å¯¹åº”çš„ç¡®è®¤å’Œè¡¥å¿ï¼Œç±»ä¼¼äº2pcï¼Œä½†2pcåœ¨äºDBå±‚é¢ï¼ŒTCCåœ¨äºä¸šåŠ¡å±‚é¢ï¼Œæ¯ä¸ªä¸šåŠ¡é€»è¾‘éƒ½éœ€è¦å®ç°try-confirm-cancelçš„æ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Tryé˜¶æ®µ&lt;/strong&gt;ï¼šå¯¹äºæ“ä½œçš„æ•°æ®è¡Œï¼Œå¢åŠ å­—æ®µè¡¨ç¤ºå…¶çŠ¶æ€ï¼Œè¡¨ç¤ºæ­£åœ¨æ“ä½œï¼Œé¢„ç•™å¿…é¡»çš„èµ„æºï¼›&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Confirmé˜¶æ®µ&lt;/strong&gt;ï¼šåªæ“ä½œé¢„ç•™èµ„æºï¼Œå°†tryé˜¶æ®µä¸­è¡¨ç¤ºæ•°æ®çŠ¶æ€çš„å­—æ®µä¿®æ”¹ä¸ºç¡®è®¤çŠ¶æ€ï¼Œè¡¨ç¤ºå·²ç»å®Œæˆæ“ä½œï¼Œ&lt;strong&gt;æ“ä½œéœ€è¦å¹‚ç­‰ï¼›&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Cancelé˜¶æ®µ&lt;/strong&gt;ï¼šå°†tryé˜¶æ®µè¿›è¡Œçš„æ“ä½œè¿›è¡Œå›æ»šï¼Œ&lt;strong&gt;æ“ä½œéœ€è¦å¹‚ç­‰ï¼›&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;é€šè¿‡ä¸æ–­é‡è¯•ï¼Œå¹¶å‘çš„æ—¶å€™è¿˜æ˜¯éœ€è¦åˆ†å¸ƒå¼é”ï¼ŒTCCä¸»è¦æ˜¯ä¿è¯ä¸šåŠ¡é€»è¾‘çš„å®Œæ•´æ€§ã€‚&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚ï¼Œåœ¨è®¢å•åˆ›å»ºå¹¶å‡åº“å­˜çš„åœºæ™¯ä¸­ï¼Œ&lt;/p&gt;
&lt;p&gt;Tryé˜¶æ®µï¼šè®¢å•åˆ›å»ºæ—¶å‘å‡ºè®¢å•åˆ›å»ºçš„äº‹ä»¶ï¼Œæ­¤æ—¶è®¢å•çŠ¶æ€æ˜¯åˆ›å»ºä¸­ï¼Œåº“å­˜æœåŠ¡æ¥æ”¶åˆ°åï¼Œå¹¶ä¸æ˜¯ç›´æ¥å‡åº“å­˜ï¼Œè€Œæ˜¯å…ˆå†»ç»“åº“å­˜ï¼Œå°†è¦æ‰£å‡çš„åº“å­˜æ•°å†»ç»“èµ·æ¥ï¼Œè®¢å•åˆ›å»ºå®Œæˆï¼›&lt;/p&gt;
&lt;p&gt;Confirmé˜¶æ®µï¼šè®¢å•æ”¯ä»˜å®Œæˆåï¼Œå‘å‡ºè®¢å•æ”¯ä»˜å®Œæˆçš„äº‹ä»¶ï¼Œåº“å­˜æœåŠ¡æ¥æ”¶åˆ°åï¼Œæ‰æ˜¯çœŸæ­£çš„å‡åº“å­˜&lt;/p&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/TCC_Try-Confirm%e6%b5%81%e7%a8%8b.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/TCC_Try-Confirm%e6%b5%81%e7%a8%8b.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;Cancelé˜¶æ®µï¼šå¦‚æœåœ¨Tryé˜¶æ®µå‡ºé”™ï¼Œåˆ™å¯¹å·²æ‰§è¡ŒTryè¯·æ±‚çš„æœåŠ¡æ‰§è¡Œå›æ»šï¼Œå¯¹åº“å­˜è¿›è¡Œå›æ»š&lt;/p&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/TCC_Try-Cancel%e6%b5%81%e7%a8%8b.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/TCC_Try-Cancel%e6%b5%81%e7%a8%8b.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;h3 id=&#34;tccå¯èƒ½å­˜åœ¨çš„é—®é¢˜&#34;&gt;TCCå¯èƒ½å­˜åœ¨çš„é—®é¢˜&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;å› ä¸ºé‡è¯•çš„å­˜åœ¨ï¼Œconfirmå’Œcanceléœ€è¦ä¿è¯å¹‚ç­‰ï¼Œå¯ä»¥ä½¿ç”¨äº‹åŠ¡è®°å½•è¡¨ + çŠ¶æ€æ¥å®ç°ï¼Œconfirmå’Œcancelåªæœ‰åœ¨å­˜åœ¨äº‹åŠ¡è®°å½•ï¼Œä¸”çŠ¶æ€ä¸ºtryæ—¶æ‰èƒ½æ‰§è¡Œï¼›&lt;/li&gt;
&lt;li&gt;tryæ—¶ï¼Œéœ€è¦ä¸Šé”ä¿è¯å¹¶å‘å®‰å…¨ï¼Œä¹‹åconfirmå’Œcancelå°±å¯ä»¥ä¸ç”¨åŠ é”ç›´æ¥å®Œæˆï¼Œå› ä¸ºtryæ—¶å·²ç»ä¿è¯äº†æ•°æ®çš„ä¸€è‡´æ€§ï¼›&lt;/li&gt;
&lt;li&gt;ç©ºå›æ»šï¼šå¯èƒ½ç½‘ç»œæˆ–è€…å…¶ä»–åŸå› ï¼Œå¯¼è‡´å‚ä¸è€…cancelæ—©äºtryä¹‹å‰è¢«æ¥æ”¶åˆ°ï¼ˆconfirmåˆ™ä¸ä¼šï¼Œå› ä¸ºconfirmå¿…å®šæ˜¯tryæ‰§è¡Œæˆæœä¹‹åæ‰ä¼šå‡ºç°ï¼‰ï¼Œæ­¤æ—¶å¯èƒ½äº§ç”Ÿç©ºå›æ»šï¼ŒåŒæ ·ä¹Ÿå¯ä»¥ä½¿ç”¨äº‹åŠ¡è®°å½•è¡¨ + çŠ¶æ€æ¥ä¿è¯cancelæ—¶å¯ä»¥è¯†åˆ«å‡ºæ˜¯å¦å·²ç»æ‰§è¡Œè¿‡tryæ“ä½œï¼›&lt;/li&gt;
&lt;li&gt;æ‚¬æŒ‚ï¼šå¯èƒ½å› ä¸ºç½‘ç»œè¶…æ—¶ç­‰åŸå› ï¼Œå‚ä¸è€…å…ˆcanceläº†ï¼Œæ­¤æ—¶äº‹åŠ¡å·²ç»è¢«åˆ¤å®šç»“æŸï¼Œç„¶åæ‰æ¥æ”¶åˆ°tryï¼Œå¯¼è‡´äº‹åŠ¡é˜¶æ®µä¸€ç›´å¤„äºtryé˜¶æ®µï¼Œé€ æˆèµ„æºæ‚¬æŒ‚ï¼ŒåŒæ ·ä¹Ÿå¯ä»¥ä½¿ç”¨äº‹åŠ¡è®°å½•è¡¨ + çŠ¶æ€æ¥è§£å†³ï¼Œä¿è¯å·²ç»“æŸçš„äº‹åŠ¡ä¸ä¼šæ‰§è¡Œtryæ“ä½œï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;å››æœ¬åœ°æ¶ˆæ¯è¡¨&#34;&gt;å››ã€æœ¬åœ°æ¶ˆæ¯è¡¨&lt;/h2&gt;
&lt;p&gt;é€‚åˆè§£å†³åˆ†å¸ƒå¼æœ€ç»ˆä¸€è‡´æ€§é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;äº‹åŠ¡æ€§æ¶ˆæ¯ï¼šæœ¬åœ°äº‹åŠ¡å’Œå‘é€æ¶ˆæ¯æ˜¯åŸå­æ€§æ“ä½œï¼›&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ­£å¸¸æƒ…å†µä¸‹&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å‚ä¸è€…Aæ­£å¸¸è¿›è¡Œæ•°æ®åº“äº‹åŠ¡å¹¶æäº¤ï¼Œå°†æ¶‰åŠåˆ°å¯¹å‚ä¸è€…Bçš„æ“ä½œè®°å½•åˆ°æœ¬åœ°æ¶ˆæ¯è¡¨ä¸­ï¼Œç›¸å½“äºä¸€æ¡æ—¥å¿—ï¼Œç„¶åå†ç”¨ä¸€ä¸ªå¼‚æ­¥æœåŠ¡ï¼Œè¯»å–è¯¥æ¡æ—¥å¿—ï¼Œæ§åˆ¶å‚ä¸è€…Bè¿›è¡Œç›¸å…³æ“ä½œï¼Œå®Œæˆä¹‹åæ›´æ–°è¿™æ¡æœ¬åœ°æ¶ˆæ¯çš„çŠ¶æ€ã€‚&lt;/p&gt;
&lt;p&gt;å¼‚æ­¥æ¶ˆè´¹æ“ä½œå¯ä»¥åˆ©ç”¨RocketMQäº‹åŠ¡ï¼›&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ³¨æ„ï¼šå‚ä¸è€…Açš„æ•°æ®åº“æ“ä½œä¸æ—¥å¿—è®°å½•æ˜¯ä¸€ä¸ªåŸå­æ€§æ“ä½œ&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å¼‚å¸¸æƒ…å†µä¸‹&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å¦‚æœå¤±è´¥äº†ç›´æ¥é‡è¯•å³å¯ï¼Œä¿è¯å‚ä¸è€…Aä¸Bæ•°æ®æœ€ç»ˆä¸€è‡´æ€§ã€‚&lt;/p&gt;
&lt;p&gt;æ¶ˆè´¹è€…åœ¨å¤„ç†çš„æ—¶å€™è¦ä¿è¯å¹‚ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.jianshu.com/p/53324ea2df92&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://www.jianshu.com/p/53324ea2df92&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;http://blog.itpub.net/31556438/viewspace-2649246/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;http://blog.itpub.net/31556438/viewspace-2649246/&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;äº”saga&#34;&gt;äº”ã€SAGA&lt;/h2&gt;
&lt;p&gt;åˆ©ç”¨çŠ¶æ€æœºå®ç°ï¼Œå®ƒå°†ä¸€ç³»åˆ—åˆ†å¸ƒå¼æ“ä½œè½¬åŒ–æˆä¸€ç³»åˆ—çš„æœ¬åœ°äº‹åŠ¡ï¼Œåœ¨æ¯ä¸€ä¸ªæœ¬åœ°äº‹åŠ¡ä¸­æˆ‘ä»¬éƒ½ä¼šæ›´æ–°æ•°æ®åº“å¹¶ä¸”å‘é›†ç¾¤ä¸­çš„å…¶ä»–æœåŠ¡å‘é€ä¸€æ¡æ–°çš„æ¶ˆæ¯æ¥è§¦å‘ä¸‹ä¸€ä¸ªæœ¬åœ°äº‹åŠ¡ï¼›ä¸€æ—¦æœ¬åœ°äº‹åŠ¡å› è¿æ³•ä¸šåŠ¡é€»è¾‘è€Œå¤±è´¥ï¼Œé‚£å°±ä¼šç«‹å³è§¦å‘ä¸€ç³»åˆ—å›æ»šæ“ä½œæ¥æ’¤å›ä¹‹å‰æœ¬åœ°äº‹åŠ¡é€ æˆçš„å‰¯ä½œç”¨ã€‚&lt;/p&gt;
&lt;p&gt;SAGAåˆ†ä¸ºååŒå’Œç¼–æ’ä¸¤ç§æ¨¡å¼ï¼ŒååŒæ˜¯éä¸­å¿ƒåŒ–çš„ï¼Œé€šè¿‡å„ä¸ªæœåŠ¡çš„æœ¬åœ°äº‹åŠ¡è§¦å‘ä¸‹ä¸€ä¸ªæœåŠ¡çš„æœ¬åœ°äº‹åŠ¡æ¥å®ç°ï¼›ç¼–æ’æ˜¯é€šè¿‡ä¸€ä¸ªä¸­å¿ƒåŒ–çš„åè°ƒèŠ‚ç‚¹ï¼Œæ¥è¿½è¸ªæ‰€æœ‰å­ä»»åŠ¡çš„è°ƒç”¨æƒ…å†µï¼Œæ ¹æ®ä»»åŠ¡çš„è°ƒç”¨æƒ…å†µæ¥å†³å®šè°ƒç”¨å¯¹åº”çš„è¡¥å¿æ–¹æ¡ˆï¼Œå¹¶åœ¨ç½‘ç»œè¯·æ±‚å‡ºç°è¶…æ—¶æ—¶è¿›è¡Œé‡è¯•ï¼›&lt;/p&gt;
&lt;h2 id=&#34;å…­ç®€å•é€šè¿‡å¯é æ¶ˆæ¯å’Œæœ€ç»ˆä¸€è‡´æ€§æ–¹æ¡ˆå®ç°&#34;&gt;å…­ã€ç®€å•é€šè¿‡å¯é æ¶ˆæ¯å’Œæœ€ç»ˆä¸€è‡´æ€§æ–¹æ¡ˆå®ç°&lt;/h2&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/%e5%8f%af%e9%9d%a0%e6%80%a7%e6%b6%88%e6%81%af&amp;#43;%e6%9c%80%e7%bb%88%e4%b8%80%e8%87%b4%e6%80%a7%e7%9a%84%e5%88%86%e5%b8%83%e5%bc%8f%e4%ba%8b%e5%8a%a1.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/%e5%8f%af%e9%9d%a0%e6%80%a7%e6%b6%88%e6%81%af&amp;#43;%e6%9c%80%e7%bb%88%e4%b8%80%e8%87%b4%e6%80%a7%e7%9a%84%e5%88%86%e5%b8%83%e5%bc%8f%e4%ba%8b%e5%8a%a1.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;å¦å¤–ï¼Œ&lt;strong&gt;åœ¨å¯é æ¶ˆæ¯æœåŠ¡ä¸­ï¼Œæ›´æ–°æ•°æ®åº“é‡Œçš„æ¶ˆæ¯å’Œå°†æ¶ˆæ¯å‘é€ç»™MQè¿™ä¸€ä¸ªæ­¥éª¤å¿…é¡»ä¿è¯åŸå­&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€èˆ¬å¯é æ¶ˆæ¯æœåŠ¡å¯ä»¥å’ŒMQä¸€èµ·ç»„åˆï¼Œå¾…ç¡®è®¤æ¶ˆæ¯ç®—åŠæ¶ˆæ¯ï¼Œå…¶å®è¿™ç§å®ç°å°±æ˜¯RocketMQ&lt;/p&gt;
&lt;p&gt;æ³¨æ„ç‚¹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;ä¸Šæ¸¸æœåŠ¡ç»™å¯é æ¶ˆæ¯æœåŠ¡å‘é€å¾…ç¡®è®¤æ¶ˆæ¯çš„è¿‡ç¨‹ä¸­å‡ºç°é—®é¢˜ï¼Œæ­¤æ—¶ä¸Šæ¸¸æœåŠ¡å¯ä»¥æ„ŸçŸ¥è°ƒç”¨å¼‚å¸¸ï¼Œå°±å¯ä»¥ç›´æ¥ä¸æ‰§è¡Œä¹‹åçš„æµç¨‹äº†ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¸Šæ¸¸æœåŠ¡æ“ä½œå®Œæœ¬åœ°æ•°æ®åº“åï¼Œé€šçŸ¥å¯é æ¶ˆæ¯æœåŠ¡ç¡®è®¤æ¶ˆæ¯æˆ–åˆ é™¤æ¶ˆæ¯æ—¶å‡ºç°é—®é¢˜ï¼Œæ­¤æ—¶è¯¥æ¶ˆæ¯åœ¨å¯é æ¶ˆæ¯æœåŠ¡é‡Œæ˜¯å¾…ç¡®è®¤çŠ¶æ€ï¼Œåœ¨å¯é æ¶ˆæ¯æœåŠ¡é‡Œ&lt;strong&gt;å®šæ—¶è½®è¯¢å¾…ç¡®è®¤çŠ¶æ€çš„æ¶ˆæ¯ï¼Œè°ƒç”¨ä¸Šæ¸¸æœåŠ¡çš„æ¥å£åˆ¤æ–­è¿™ä¸ªæ¶ˆæ¯çš„çŠ¶æ€å³å¯&lt;/strong&gt;ï¼›&lt;/p&gt;
&lt;p&gt;å¦‚æœä¸Šæ¸¸å“åº”è¯¥æ¶ˆæ¯æˆåŠŸï¼Œå¯é æ¶ˆæ¯æœåŠ¡å°†æ¶ˆæ¯æŠ•é€’åˆ°MQå³å¯ï¼Œå¦åˆ™ï¼Œå°†è¯¥æ¶ˆæ¯åˆ é™¤ã€‚&lt;/p&gt;
&lt;p&gt;åƒRocketMQå°±æŠŠè¿™ä¸ªæ“ä½œåšè¿›äº†MQé‡Œï¼Œè¿™ç§å¾…ç¡®è®¤çš„æ¶ˆæ¯å°±å«&lt;strong&gt;åŠæ¶ˆæ¯&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¸‹æ¸¸æœåŠ¡ä¸€ç›´æ¶ˆè´¹æ¶ˆæ¯ä¸€ç›´å¤±è´¥ï¼Œæœ‰ä¸¤ç§æ–¹æ¡ˆï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code&gt; 1. å¯ä»¥è®¾ç½®æ¶ˆæ¯å¯è¢«æ¶ˆè´¹çš„æ¬¡æ•°ï¼Œè¶…è¿‡è¿™ä¸ªæ¬¡æ•°è¿›æ­»ä¿¡é˜Ÿåˆ—ï¼Œåé¢äººå·¥å¹²é¢„å³å¯ï¼›
 2. ç”±äºè¯¥æ¡æ¶ˆæ¯åœ¨å¯é æ¶ˆæ¯æœåŠ¡é‡Œä¸€ç›´æ˜¯å·²å‘é€çŠ¶æ€ï¼Œå§‹ç»ˆæœªå®Œæˆï¼Œæ­¤æ—¶å¯é æ¶ˆæ¯æœåŠ¡åœ¨åå°å¯ä»¥æœ‰å®šæ—¶ä»»åŠ¡ï¼Œå°†è¿™äº›æ¶ˆæ¯é‡æ–°ä¸¢åˆ°MQé‡Œè®©ä¸‹æ¸¸æ¶ˆè´¹å³å¯ï¼Œå½“ç„¶ä¸‹æ¸¸æœåŠ¡æ¶ˆæ¯æ˜¯éœ€è¦ä¿è¯å¹‚ç­‰çš„ï¼›
&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒï¼š&lt;/h2&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://zhuanlan.zhihu.com/p/21994882&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;2pcã€3pc&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://juejin.im/post/5bf201f7f265da610f63528a&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;TCC&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://yemablog.com/posts/tcc-1&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;TCC&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://blog.csdn.net/weixin_42075590/article/details/89236625&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;åä¸ºçš„servicecomb&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.sofastack.tech/blog/sofa-meetup-3-seata-retrospect/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;èš‚èšé‡‘æœçš„seataåˆ†å¸ƒå¼äº‹åŠ¡æ¶æ„&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://segmentfault.com/a/1190000040321750&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;åˆ†å¸ƒå¼äº‹åŠ¡æœ€ç»å…¸çš„ä¸ƒç§è§£å†³æ–¹æ¡ˆ&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://github.com/yedf/dtm&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;ä¸€ä¸ªgoçš„åˆ†å¸ƒå¼äº‹åŠ¡æ¡†æ¶DTM&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;http://www.ruanyifeng.com/blog/2018/07/cap.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;http://www.ruanyifeng.com/blog/2018/07/cap.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.cnblogs.com/jajian/p/10014145.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://www.cnblogs.com/jajian/p/10014145.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.jianshu.com/p/f98e8a8dae6d&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://www.jianshu.com/p/f98e8a8dae6d&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;åˆ†å¸ƒå¼ç®—æ³•&#34;&gt;åˆ†å¸ƒå¼ç®—æ³•&lt;/h1&gt;
&lt;p&gt;ä¸ºäº†é¿å…å•ç‚¹æ•…éšœï¼Œå¸¸è§çš„å¤šå‰¯æœ¬å¤åˆ¶æ–¹æ¡ˆæœ‰ä¸¤ç§ï¼š&lt;/p&gt;
&lt;h2 id=&#34;å»ä¸­å¿ƒåŒ–å¤åˆ¶å¦‚gossip&#34;&gt;å»ä¸­å¿ƒåŒ–å¤åˆ¶ï¼Œå¦‚Gossip&lt;/h2&gt;
&lt;p&gt;ä¸€ä¸ªnä¸ªå¤åˆ¶é›†èŠ‚ç‚¹çš„é›†ç¾¤ä¸­ï¼Œä»»æ„èŠ‚ç‚¹éƒ½å¯ä»¥æ¥æ”¶å†™è¯·æ±‚ï¼Œä½†ä¸€ä¸ªæˆåŠŸçš„å†™è¯·æ±‚éœ€è¦wä¸ªèŠ‚ç‚¹ç¡®è®¤ï¼Œè¯»æ“ä½œä¹Ÿå¿…é¡»æŸ¥è¯¢è‡³å°‘rä¸ªèŠ‚ç‚¹ã€‚å¯ç”¨æ€§é«˜ï¼Œä½†å®¹æ˜“é€ æˆå†™å†²çªã€‚&lt;/p&gt;
&lt;p&gt;ç®€å•æ¥è®²ï¼Œå°±æ˜¯ä¸€ä¸ªèŠ‚ç‚¹ä¼šå‘¨æœŸã€éšæœºçš„å°†äº‹ä»¶å¹¿æ’­ç»™å…¶ä»–èŠ‚ç‚¹ï¼Œå…¶ä»–èŠ‚ç‚¹æ”¶åˆ°åä¹Ÿä¼šå‘¨æœŸæ€§çš„å¹¿æ’­ç»™å…¶ä»–èŠ‚ç‚¹ï¼Œæœ€ç»ˆé›†ç¾¤ä¸Šæ‰€æœ‰èŠ‚ç‚¹éƒ½èƒ½æ”¶åˆ°æ¶ˆæ¯ï¼Œæ˜¯ä¸€ç§å»ä¸­å¿ƒåŒ–ï¼Œæœ€ç»ˆä¸€è‡´æ€§çš„ç®—æ³•ï¼Œå‹åŠ›ä¸åœ¨æ¥è‡ªä¸»èŠ‚ç‚¹ï¼Œè€Œæ˜¯æ‰€æœ‰èŠ‚ç‚¹éƒ½å‡è¡¡è´Ÿè½½ï¼Œæ‰©å±•æ€§å¾ˆå¥½ï¼Œå³ä½¿æœ‰æ–°èŠ‚ç‚¹åŠ å…¥ï¼Œæœ€ç»ˆä¹Ÿä¼šè¢«å¹¿æ’­åˆ°ã€‚&lt;/p&gt;
&lt;p&gt;å½“ä¼šæœ‰ä¸ªæ‹œå åº­é—®é¢˜ï¼Œå°±æ˜¯å¦‚æœæœ‰ä¸€ä¸ªæ¶æ„ä¼ æ’­èŠ‚ç‚¹ï¼Œå°†ä¼šæ‰“ä¹±åŸæœ¬çš„ä¼ æ’­&lt;/p&gt;
&lt;p&gt;é™¤äº†å¤åˆ¶æ–¹æ¡ˆï¼Œå¦ä¸€ç§æ˜¯å…±è¯†ç®—æ³•å¦‚Paxosæˆ–Raftï¼Œä¿è¯é›†ç¾¤èŠ‚ç‚¹é«˜å¯ç”¨å’Œæ•°æ®ä¸€è‡´æ€§ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä¸»ä»å¤åˆ¶å¦‚mysqlredis&#34;&gt;ä¸»ä»å¤åˆ¶ï¼Œå¦‚MySQLã€Redis&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;å…¨åŒæ­¥å¤åˆ¶ï¼šä¸»èŠ‚ç‚¹æ”¶åˆ°ä¸€ä¸ªå†™è¯·æ±‚åï¼Œå¿…é¡»ç­‰åˆ°å…¨éƒ¨ä»èŠ‚ç‚¹ç¡®è®¤è¿”å›åï¼Œæ‰èƒ½è¿”å›ç»™å®¢æˆ·ç«¯æˆåŠŸï¼Œä¸€ä¸ªèŠ‚ç‚¹æ•…éšœå°†å¯¼è‡´æ•´ä¸ªç³»ç»Ÿä¸å¯ç”¨ã€‚ä¿è¯ä¸€è‡´æ€§ï¼Œä½†å¯ç”¨æ€§ä¸é«˜ã€‚&lt;/li&gt;
&lt;li&gt;å¼‚æ­¥å¤åˆ¶ï¼šä¸»èŠ‚ç‚¹æ”¶åˆ°ä¸€ä¸ªå†™è¯·æ±‚ï¼Œç«‹é©¬è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œå¼‚æ­¥å°†è¯·æ±‚è½¬å‘ç»™å„ä¸ªä»èŠ‚ç‚¹ï¼Œä½†ä¸»èŠ‚ç‚¹å¦‚æœè¿˜æœªå°†è¯·æ±‚è¿›è¡Œè½¬å‘å°±æ•…éšœäº†ï¼Œå°±ä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚ä¿è¯å¯ç”¨æ€§ï¼Œä½†ä¸€è‡´æ€§ä¸é«˜ã€‚&lt;/li&gt;
&lt;li&gt;åŠåŒæ­¥å¤åˆ¶ï¼šä¸»èŠ‚ç‚¹æ”¶åˆ°ä¸€ä¸ªå†™è¯·æ±‚åï¼Œè‡³å°‘æœ‰ä¸€ä¸ªä»èŠ‚ç‚¹æˆ–è€…è¶…è¿‡åŠæ•°èŠ‚ç‚¹æ”¶åˆ°æ•°æ®ï¼Œå°±å¯ä»¥è¿”å›å®¢æˆ·ç«¯ï¼Œåœ¨ä¸€è‡´æ€§å’Œå¯ç”¨æ€§ä¸Šæ¯”è¾ƒå¹³è¡¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;paxosç®—æ³•&#34;&gt;Paxosç®—æ³•&lt;/h2&gt;
&lt;h2 id=&#34;raftç®—æ³•&#34;&gt;Raftç®—æ³•&lt;/h2&gt;
&lt;p&gt;æ„Ÿè§‰åƒä¸ZABåè®®ç±»ä¼¼ï¼Œå…·ä½“æœ‰æ—¶é—´å†æ•´ç†&lt;/p&gt;
&lt;p&gt;å½“Leaderå®•æœºä¹‹åï¼Œåªæœ‰æ‹¥æœ‰æœ€æ–°æ—¥å¿—çš„Followeræ‰æœ‰èµ„æ ¼ç§°ä¸ºLeaderã€‚&lt;/p&gt;
&lt;p&gt;å…³äºæ—¥å¿—æ£€æŸ¥ï¼Œå½“Followerä¸Šçš„æ—¥å¿—ä¸leaderä¸ä¸€è‡´æ—¶ï¼ŒLeaderå…ˆæ‰¾åˆ°FolloweråŒå®ƒæ—¥å¿—ä¸€è‡´çš„indexï¼Œå°†å…¶åè¾¹çš„æ—¥å¿—ä¸€æ¡æ¡è¦†ç›–åœ¨Followerä¸Šã€‚&lt;/p&gt;
&lt;p&gt;å‚è€ƒï¼š&lt;a class=&#34;link&#34; href=&#34;https://zhuanlan.zhihu.com/p/32052223&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Raftç®—æ³•è¯¦è§£&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://raft.github.io/raftscope/index.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;RaftåŠ¨ç”»æ¼”ç¤º&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;åˆ†å¸ƒå¼é”&#34;&gt;åˆ†å¸ƒå¼é”&lt;/h1&gt;
&lt;h2 id=&#34;åˆ©ç”¨æ•°æ®åº“å”¯ä¸€çº¦æŸ&#34;&gt;åˆ©ç”¨æ•°æ®åº“å”¯ä¸€çº¦æŸ&lt;/h2&gt;
&lt;p&gt;åœ¨æ•°æ®åº“æ–°å»ºä¸€ä¸ªé”è¡¨ï¼Œç„¶åé€šè¿‡æ“ä½œè¯¥è¡¨ä¸­çš„æ•°æ®æ¥å®ç°ï¼Œè¡¨çš„å­—æ®µä¸ºå®¢æˆ·ç«¯IDã€åŠ é”æ¬¡æ•°ã€èµ„æºçš„keyï¼ŒåŠ é”æ¬¡æ•° + å®¢æˆ·ç«¯IDå¯ä»¥åˆ¤æ–­æ˜¯å¦å¯é‡å…¥ã€‚&lt;/p&gt;
&lt;p&gt;å½“æˆ‘ä»¬è¦é”ä½æŸä¸ªæ–¹æ³•æˆ–èµ„æºçš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±åœ¨è¯¥è¡¨ä¸­å¢åŠ ä¸€æ¡è®°å½•ï¼Œæƒ³è¦é‡Šæ”¾é”çš„æ—¶å€™å°±åˆ é™¤è¿™æ¡è®°å½•ã€‚åœ¨insertå‰å…ˆqueryåˆ¤æ–­æ˜¯å¦å­˜åœ¨è¯¥è®°å½•ã€‚&lt;/p&gt;
&lt;p&gt;ä¼˜ç‚¹ï¼šç®€å•ï¼Œæ–¹ä¾¿ç†è§£ï¼Œä¸”ä¸éœ€è¦ç»´æŠ¤é¢å¤–çš„ç¬¬ä¸‰æ–¹ä¸­é—´ä»¶(æ¯”å¦‚Redis,Zk)ã€‚&lt;/p&gt;
&lt;p&gt;ç¼ºç‚¹ï¼šè™½ç„¶å®¹æ˜“ç†è§£ä½†æ˜¯å®ç°èµ·æ¥è¾ƒä¸ºç¹çï¼Œéœ€è¦è‡ªå·±è€ƒè™‘é”è¶…æ—¶ï¼ŒåŠ äº‹åŠ¡ç­‰ç­‰ã€‚æ€§èƒ½å±€é™äºæ•°æ®åº“ï¼Œä¸€èˆ¬å¯¹æ¯”ç¼“å­˜æ¥è¯´æ€§èƒ½è¾ƒä½ã€‚å¯¹äºé«˜å¹¶å‘çš„åœºæ™¯å¹¶ä¸æ˜¯å¾ˆé€‚åˆã€‚&lt;/p&gt;
&lt;h2 id=&#34;etcdå®ç°&#34;&gt;etcdå®ç°&lt;/h2&gt;
&lt;p&gt;etcdé‡‡ç”¨raftç®—æ³•ï¼Œä¸€ä¸ªå†™è¯·æ±‚è¦ç»è¿‡é›†ç¾¤å¤šæ•°èŠ‚ç‚¹ç¡®è®¤ï¼Œæ‰€ä»¥ä¸€æ—¦åˆ†å¸ƒå¼é”ç”³è¯·æˆåŠŸè¿”å›ç»™clientæ—¶ï¼Œé”æ•°æ®ä¸€å®šæ˜¯æŒä¹…åŒ–äº†é›†ç¾¤å¤šæ•°èŠ‚ç‚¹ä¸Šï¼Œä¸ä¼šå‡ºç°Redisé‚£ç§ä¸»å¤‡å¼‚æ­¥å¤åˆ¶ï¼Œå½“ä¸»æœºå®•æœºï¼Œä»æœºå’Œä¸»æœºæ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;äº‹åŠ¡åŠŸèƒ½ï¼šetcdäº‹åŠ¡ç”±IFã€THENã€ELSEè¯­å¥ç»„æˆï¼Œå¯ä»¥æ¯”è¾ƒkeyçš„ä¿®æ”¹ç‰ˆæœ¬å·mod_revisionå’Œåˆ›å»ºç‰ˆæœ¬å·create_revisionï¼Œå› æ­¤å¯ä»¥é€šè¿‡åˆ›å»ºç‰ˆæœ¬å·create_revisionæ£€æŸ¥keyæ˜¯å¦å·²å­˜åœ¨ï¼Œå½“keyä¸å­˜åœ¨æ—¶ï¼Œåˆ›å»ºç‰ˆæœ¬å·ä¸º0ï¼Œæ­¤æ—¶å¯ä»¥è¿›è¡Œputæ“ä½œã€‚&lt;/li&gt;
&lt;li&gt;Lease åŠŸèƒ½ï¼šå¯ä»¥ä¿è¯åˆ†å¸ƒå¼é”çš„å®‰å…¨æ€§ï¼Œä¸ºé”å¯¹åº”çš„ key é…ç½®ç§Ÿçº¦ï¼Œå³ä½¿é”çš„æŒæœ‰è€…å› æ•…éšœè€Œä¸èƒ½ä¸»åŠ¨é‡Šæ”¾é”ï¼Œé”ä¹Ÿä¼šå› ç§Ÿçº¦åˆ°æœŸè€Œè‡ªåŠ¨é‡Šæ”¾ï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒç»­çº¦ã€‚æ­¤ç‰¹æ€§è§£å†³äº†clientå‡ºç°crushæ•…éšœï¼Œclientä¸ectdé›†ç¾¤ç½‘ç»œå‡ºç°éš”ç¦»ç­‰åœºæ™¯ä¸‹çš„æ­»é”é—®é¢˜ã€‚ä¸€æ—¦Lease TTLï¼Œkeyå°±ä¼šè‡ªåŠ¨é‡Šæ”¾ï¼Œç¡®ä¿å…¶ä»–clientåœ¨TTLè¿‡æœŸåèƒ½æ­£å¸¸ç”³è¯·é”ã€‚&lt;/li&gt;
&lt;li&gt;watchåŠŸèƒ½ï¼šåœ¨å®ç°åˆ†å¸ƒå¼é”æ—¶ï¼Œå¦‚æœæŠ¢é”å¤±è´¥ï¼Œå¯é€šè¿‡ Prefix æœºåˆ¶è¿”å›çš„ KeyValue åˆ—è¡¨è·å¾— Revision æ¯”è‡ªå·±å°ä¸”ç›¸å·®æœ€å°çš„ keyï¼ˆç§°ä¸º pre-keyï¼‰ï¼Œå¯¹ pre-key è¿›è¡Œç›‘å¬ï¼Œå› ä¸ºåªæœ‰å®ƒé‡Šæ”¾é”ï¼Œè‡ªå·±æ‰èƒ½è·å¾—é”ï¼Œå¦‚æœ Watch åˆ° pre-key çš„ DELETE äº‹ä»¶ï¼Œåˆ™è¯´æ˜pre-keå·²ç»é‡Šæ”¾ï¼Œè‡ªå·±å·²ç»æŒæœ‰é”ã€‚&lt;/li&gt;
&lt;li&gt;prefixåŠŸèƒ½ï¼šä¾‹å¦‚ï¼Œä¸€ä¸ªåä¸º /mylock çš„é”ï¼Œä¸¤ä¸ªäº‰æŠ¢å®ƒçš„å®¢æˆ·ç«¯è¿›è¡Œå†™æ“ä½œï¼Œå®é™…å†™å…¥çš„ key åˆ†åˆ«ä¸ºï¼škey1=â€/mylock/UUID1â€³ï¼Œkey2=â€/mylock/UUID2â€³ï¼Œå…¶ä¸­ï¼ŒUUID è¡¨ç¤ºå…¨å±€å”¯ä¸€çš„ IDï¼Œç¡®ä¿ä¸¤ä¸ª key çš„å”¯ä¸€æ€§ã€‚å¾ˆæ˜¾ç„¶ï¼Œå†™æ“ä½œéƒ½ä¼šæˆåŠŸï¼Œä½†è¿”å›çš„ Revision ä¸ä¸€æ ·ï¼Œé€šè¿‡å‰ç¼€ /mylock æŸ¥è¯¢ï¼Œè¿”å›åŒ…å«ä¸¤ä¸ª key-value å¯¹çš„çš„ KeyValue åˆ—è¡¨ï¼ŒåŒæ—¶ä¹ŸåŒ…å«å®ƒä»¬çš„ Revisionï¼Œé€šè¿‡ Revision å¤§å°ï¼Œå®¢æˆ·ç«¯å¯ä»¥åˆ¤æ–­è‡ªå·±æ˜¯å¦è·å¾—é”ï¼Œå¦‚æœæŠ¢é”å¤±è´¥ï¼Œåˆ™ç­‰å¾…é”é‡Šæ”¾ï¼ˆå¯¹åº”çš„ key è¢«åˆ é™¤æˆ–è€…ç§Ÿçº¦è¿‡æœŸï¼‰ï¼Œç„¶åå†åˆ¤æ–­è‡ªå·±æ˜¯å¦å¯ä»¥è·å¾—é”ã€‚å¹¶é…åˆä¸Šä¸€æ¡çš„watchåŠŸèƒ½ä½¿ç”¨ã€‚&lt;/li&gt;
&lt;li&gt;reversionåŠŸèƒ½ï¼šå¦‚ä¸Šä¸€æ¡æ‰€è¿°ï¼Œæ¯ä¸ª key å¸¦æœ‰ä¸€ä¸ª Revision å·ï¼Œæ¯è¿›è¡Œä¸€æ¬¡äº‹åŠ¡åŠ ä¸€ï¼Œå› æ­¤å®ƒæ˜¯å…¨å±€å”¯ä¸€çš„ï¼Œå¦‚åˆå§‹å€¼ä¸º 0ï¼Œè¿›è¡Œä¸€æ¬¡ put(key, value)ï¼Œkey çš„ Revision å˜ä¸º 1ï¼›åŒæ ·çš„æ“ä½œï¼Œå†è¿›è¡Œä¸€æ¬¡ï¼ŒRevision å˜ä¸º 2ï¼›æ¢æˆ key1 è¿›è¡Œ put(key1, value) æ“ä½œï¼ŒRevision å°†å˜ä¸º 3ã€‚å¤šçº¿ç¨‹è·å–é”æ—¶ï¼Œé€šè¿‡æ¯”è¾ƒreversionçš„å¤§å°å³å¯çŸ¥é“è·å–çš„é¡ºåºï¼Œé¿å…&amp;quot;æƒŠç¾¤æ•ˆåº”&amp;quot;ï¼ˆæŒ‡çš„æ˜¯å½“é”è¢«é‡Šæ”¾ï¼Œä¼šå¯¼è‡´æ‰€æœ‰ç›‘å¬è¯¥keyçš„clientéƒ½å°è¯•å‘èµ·äº‹åŠ¡è·å–é”ï¼Œæ€§èƒ½è¾ƒå·®ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å®ç°çš„æ–¹æ¡ˆï¼šé€šè¿‡å¤šä¸ªclientåˆ›å»ºprefixç›¸åŒï¼Œåç§°ä¸åŒçš„keyï¼Œå“ªä¸ªkeyçš„revisionæœ€å°ï¼Œè°å°±è·å¾—é”ã€‚&lt;/p&gt;
&lt;p&gt;etcdè‡ªå¸¦äº†concurrencyåŒ…ï¼Œç®€åŒ–åˆ†å¸ƒå¼é”ã€åˆ†å¸ƒå¼é€‰ä¸¾ã€åˆ†å¸ƒå¼äº‹åŠ¡çš„å®ç°ã€‚è¯¥åŒ…çš„åˆ†å¸ƒå¼é”å®ç°ï¼šå½“äº‹åŠ¡å‘ç°createRevisionçš„å€¼ä¸º0æ—¶ï¼Œä¼šåˆ›å»ºä¸€ä¸ªprefixä¸º/my-lockçš„keyï¼Œkeyçš„åç§°ä¸º/my-lock+LeaseIdï¼Œå¹¶è·å–/my-lock prefixä¸‹é¢æœ€æ—©åˆ›å»ºçš„ä¸€ä¸ªkeyï¼Œå³revisionæœ€å°ï¼Œåˆ†å¸ƒå¼é”æœ€ç»ˆç”±å†™å…¥è¯¥keyçš„clientè·å¾—ï¼Œå…¶ä»–clientè¿›å…¥ç­‰å¾…æ¨¡å¼ã€‚æœªè·å¾—é”çš„clienté€šè¿‡Watchæœºåˆ¶ç›‘å¬prefixç›¸åŒï¼Œrevisionæ¯”è‡ªå·±å°çš„keyï¼Œåªæœ‰å½“revisionæ¯”è‡ªå·±å°çš„keyé‡Šæ”¾äº†é”ï¼Œæ‰æœ‰æœºä¼šè·å¾—é”ã€‚&lt;/p&gt;
&lt;p&gt;ä¼˜ç‚¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¯ä»¥é€šè¿‡leaseåŠŸèƒ½å’Œç»“ç‚¹å¥åº·ç›‘æµ‹ï¼Œç¡®ä¿å®¢æˆ·ç«¯å´©æºƒæ—¶ï¼Œé”ä¸€å®šä¼šè¢«é‡Šæ”¾ã€‚&lt;/li&gt;
&lt;li&gt;etcdå®¢æˆ·ç«¯etcdæœ‰ç›¸åº”é”å®ç°ï¼Œæ˜¯å¦æ»¡è¶³éœ€æ±‚éœ€è¦è¿›ä¸€æ­¥æŸ¥çœ‹æºç ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç¼ºç‚¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¼ºä¸€è‡´æ€§å¸¦æ¥çš„å¿…å®šæ˜¯å†™æ•ˆç‡ä¸Šçš„é™ä½&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;zookeeperå®ç°&#34;&gt;ZooKeeperå®ç°&lt;/h2&gt;
&lt;p&gt;åŸºäºZooKeeperçš„ä¸´æ—¶èŠ‚ç‚¹å’Œé¡ºåºçš„ç‰¹æ€§ã€‚&lt;/p&gt;
&lt;p&gt;ä¸´æ—¶èŠ‚ç‚¹å…·å¤‡æ•°æ®è‡ªåŠ¨åˆ é™¤åŠŸèƒ½ï¼Œå½“clientä¸ZooKeeperè¿æ¥å’Œsessionæ–­æ‰æ—¶ï¼Œç›¸åº”çš„ä¸´æ—¶èŠ‚ç‚¹å°±ä¼šè¢«åˆ é™¤ã€‚&lt;/p&gt;
&lt;p&gt;å¦å¤–ï¼ŒZooKeeperä¹Ÿæä¾›Watchç‰¹æ€§ç›‘å¬keyçš„å˜åŒ–ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å› ä¸ºåˆ›å»ºèŠ‚ç‚¹çš„å”¯ä¸€æ€§ï¼Œæˆ‘ä»¬å¯ä»¥è®©å¤šä¸ªå®¢æˆ·ç«¯åŒæ—¶åˆ›å»ºä¸€ä¸ªä¸´æ—¶èŠ‚ç‚¹ï¼Œåˆ›å»ºæˆåŠŸçš„å°±è¯´æ˜è·å–åˆ°äº†é” ã€‚ç„¶åæ²¡æœ‰è·å–åˆ°é”çš„å®¢æˆ·ç«¯ä¹Ÿåƒä¸Šé¢é€‰ä¸»çš„éä¸»èŠ‚ç‚¹åˆ›å»ºä¸€ä¸ª watcher è¿›è¡ŒèŠ‚ç‚¹çŠ¶æ€çš„ç›‘å¬ï¼Œå¦‚æœè¿™ä¸ªäº’æ–¥é”è¢«é‡Šæ”¾äº†ï¼ˆå¯èƒ½è·å–é”çš„å®¢æˆ·ç«¯å®•æœºäº†ï¼Œæˆ–è€…é‚£ä¸ªå®¢æˆ·ç«¯ä¸»åŠ¨é‡Šæ”¾äº†é”ï¼‰å¯ä»¥è°ƒç”¨å›è°ƒå‡½æ•°é‡æ–°è·å¾—é”ã€‚&lt;/p&gt;
&lt;p&gt;å…±äº«é”ï¼šè§„å®šæ‰€æœ‰åˆ›å»ºèŠ‚ç‚¹å¿…é¡»æœ‰åºï¼Œå½“ä½ æ˜¯è¯»è¯·æ±‚ï¼ˆè¦è·å–å…±äº«é”ï¼‰çš„è¯ï¼Œå¦‚æœ &lt;strong&gt;æ²¡æœ‰æ¯”è‡ªå·±æ›´å°çš„èŠ‚ç‚¹ï¼Œæˆ–æ¯”è‡ªå·±å°çš„èŠ‚ç‚¹éƒ½æ˜¯è¯»è¯·æ±‚&lt;/strong&gt; ï¼Œåˆ™å¯ä»¥è·å–åˆ°è¯»é”ï¼Œç„¶åå°±å¯ä»¥å¼€å§‹è¯»äº†ã€‚&lt;strong&gt;è‹¥æ¯”è‡ªå·±å°çš„èŠ‚ç‚¹ä¸­æœ‰å†™è¯·æ±‚&lt;/strong&gt; ï¼Œåˆ™å½“å‰å®¢æˆ·ç«¯æ— æ³•è·å–åˆ°è¯»é”ï¼Œåªèƒ½ç­‰å¾…å‰é¢çš„å†™è¯·æ±‚å®Œæˆ&lt;/p&gt;
&lt;p&gt;æ’ä»–é”ï¼šå¦‚æœä½ æ˜¯å†™è¯·æ±‚ï¼ˆè·å–ç‹¬å é”ï¼‰ï¼Œè‹¥ &lt;strong&gt;æ²¡æœ‰æ¯”è‡ªå·±æ›´å°çš„èŠ‚ç‚¹&lt;/strong&gt; ï¼Œåˆ™è¡¨ç¤ºå½“å‰å®¢æˆ·ç«¯å¯ä»¥ç›´æ¥è·å–åˆ°å†™é”ï¼Œå¯¹æ•°æ®è¿›è¡Œä¿®æ”¹ã€‚è‹¥å‘ç° &lt;strong&gt;æœ‰æ¯”è‡ªå·±æ›´å°çš„èŠ‚ç‚¹ï¼Œæ— è®ºæ˜¯è¯»æ“ä½œè¿˜æ˜¯å†™æ“ä½œï¼Œå½“å‰å®¢æˆ·ç«¯éƒ½æ— æ³•è·å–åˆ°å†™é”&lt;/strong&gt; ï¼Œç­‰å¾…æ‰€æœ‰å‰é¢çš„æ“ä½œå®Œæˆ&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;rediså®ç°&#34;&gt;Rediså®ç°&lt;/h2&gt;
&lt;h3 id=&#34;å•æœºrediså®ç°&#34;&gt;å•æœºRediså®ç°&lt;/h3&gt;
&lt;p&gt;ä½¿ç”¨setnxå‘½ä»¤ï¼Œsetnxå‘½ä»¤è¡¨ç¤ºå¦‚æœkeyä¸å­˜åœ¨ï¼Œåˆ™å¯ä»¥setæˆåŠŸï¼Œè¿”å›1ï¼Œå¦åˆ™è¿”å›0ï¼Œæ ¹æ®è¿”å›å€¼æ¥åˆ¤æ–­æ˜¯å¦åŠ é”æˆåŠŸï¼Œæ³¨æ„setnxä¸æ”¯æŒè®¾ç½®keyã€valueçš„åŒæ—¶è¿˜è¦è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œè¿‡æœŸæ—¶é—´ä¸»è¦æ˜¯ä¿è¯èµ„æºå ç”¨æ—¶é—´è¿‡é•¿åå¯ä»¥é‡Šæ”¾é”ï¼Œé¿å…æ­»é”ï¼Œæ‰€ä»¥å¦‚æœè¦ç”¨æ¥åŠ é”ï¼Œå¿…é¡»ä½¿ç”¨Luaè„šæœ¬æ¥ä¿è¯åŸå­æ€§&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-lua&#34; data-lang=&#34;lua&#34;&gt;&lt;span class=&#34;kr&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;redis.call&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;setnx&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;KEYS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;],&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;KEYS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;kr&#34;&gt;then&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;redis.call&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;expire&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;KEYS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;],&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;KEYS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;
&lt;span class=&#34;kr&#34;&gt;end&lt;/span&gt;

&lt;span class=&#34;kr&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ok&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ä¸è¿‡ä»2.6.12èµ·ï¼Œsetæ¶µç›–äº†setexã€setnxåŠŸèƒ½ï¼Œå¹¶ä¸”setæœ¬èº«å¯ä»¥è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿›è¡ŒåŠ é”&lt;/p&gt;
&lt;p&gt;å‘½ä»¤ï¼š&lt;code&gt;SET [key: èµ„æºä»£è¡¨çš„key] [value: å®¢æˆ·ç«¯äº‹åŠ¡Id] NX PX [æ—¶é—´ï¼ŒEXçš„å•ä½æ˜¯ç§’ï¼ŒPXçš„å•ä½æ˜¯æ¯«ç§’] &lt;/code&gt;ï¼Œè¦æ³¨æ„æ—§ç‰ˆæœ¬çš„setnxå‘½ä»¤ä¸æ”¯æŒè®¾ç½®è¿‡æœŸæ—¶é—´&lt;/p&gt;
&lt;p&gt;è§£é”ï¼Œå…ˆåˆ¤æ–­é”æ˜¯ä¸æ˜¯è‡ªå·±åŠ çš„ï¼Œå¦‚æœæ˜¯æ‰å¯ä»¥è§£é”ï¼Œå³åˆ é™¤è¯¥keyï¼Œéœ€è¦ä¿è¯è¿™ä¸¤ä¸ªæ­¥éª¤çš„åŸå­æ€§ï¼Œå¦åˆ™å¯èƒ½ä¼šå‡ºç°å› ä¸ºæŸ¥è¯¢æ—¶é—´è¿‡é•¿å¯¼è‡´åˆ æ‰äº†åˆ«äººçš„é”&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-lua&#34; data-lang=&#34;lua&#34;&gt;&lt;span class=&#34;kr&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;redis.call&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;get&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;KEYS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ARGV&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;kr&#34;&gt;then&lt;/span&gt;
    &lt;span class=&#34;kr&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;redis.call&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;del&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;KEYS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;
&lt;span class=&#34;kr&#34;&gt;else&lt;/span&gt;
    &lt;span class=&#34;kr&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;
&lt;span class=&#34;kr&#34;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ä¸ºäº†ä¿è¯Redisçš„é«˜å¯ç”¨ï¼Œå°±ä¼šéƒ¨ç½²Redisé›†ç¾¤ï¼Œä½†åœ¨é›†ç¾¤ç¯å¢ƒä¸‹è¿˜ä½¿ç”¨ä¸Šè¿°æ–¹æ¡ˆå¯èƒ½ä¼šå‡ºç°é”å¶å°”å¤±æ•ˆã€‚æ¯”å¦‚Redisè®¾ç½®ä¸»ä»èŠ‚ç‚¹ï¼Œä¸€èˆ¬åŠ é”è§£é”ä¼šåœ¨ä¸»èŠ‚ç‚¹ä¸Šè¿›è¡Œï¼Œä½†æ˜¯å½“åŠ é”åï¼Œä¸»èŠ‚ç‚¹å®•æœºï¼Œä»èŠ‚ç‚¹è¿˜æœªè¿›è¡ŒåŒæ­¥ï¼Œä»èŠ‚ç‚¹æå‡ä¸ºä¸»èŠ‚ç‚¹ï¼Œå…¶ä»–æœåŠ¡å°±æœ‰æœºä¼šè·å–åˆ°é”äº†ï¼Œæ­¤æ—¶å°±å‡ºç°äº†å¤šä¸ªæœåŠ¡å¯¹åŒä¸€èµ„æºçš„æ“ä½œé—®é¢˜ï¼›å¦å¤–ï¼Œå½“å‘ç”Ÿç½‘ç»œåˆ†åŒºç°è±¡æ—¶ï¼ŒRediså¯èƒ½å‡ºç°è„‘è£‚ï¼Œå‡ºç°å¤šä¸ªmasterï¼Œä½¿å¾—å¤šä¸ªclientå¯ä»¥è·å¾—é”ã€‚&lt;/p&gt;
&lt;h3 id=&#34;é›†ç¾¤rediså®ç°&#34;&gt;é›†ç¾¤Rediså®ç°&lt;/h3&gt;
&lt;p&gt;RedLockä¸Redissionå®ç°ï¼Œæœ‰ç©ºå†è¿›è¡Œè¡¥å……ï¼Œå…ˆæŠŠRedLockçš„åŸºæœ¬æ€æƒ³ç®€å•æè¿°ä¸€ä¸‹&lt;/p&gt;
&lt;p&gt;å‡è®¾æœ‰5ä¸ªRedisèŠ‚ç‚¹ï¼Œ&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;åŠ é”æ—¶ï¼Œé¡ºåºåœ¨5ä¸ªèŠ‚ç‚¹ä¸Šç”³è¯·é”ï¼Œä½¿ç”¨åŒæ ·çš„keyã€valueã€è¶…æ—¶æ—¶é—´ï¼Œç”³è¯·é”çš„è¶…æ—¶æ—¶é—´ï¼Œå› ä¸ºéœ€è¦åŒæ—¶è¯·æ±‚å¤šä¸ªèŠ‚ç‚¹ï¼Œé¿å…åŠ é”æ—¶é—´èŠ±è´¹è¿‡é•¿&lt;/li&gt;
&lt;li&gt;å½“åœ¨3ä¸ªèŠ‚ç‚¹ä¸ŠæˆåŠŸç”³è¯·åˆ°é”ï¼Œä¸”ç”³è¯·é”æ¶ˆè€—çš„æ—¶é—´ å°äº é”çš„æœ‰æ•ˆæ—¶é—´ï¼Œå°±ç®—ç”³è¯·æˆåŠŸã€‚ç”³è¯·é”æ¶ˆè€—çš„æ—¶é—´é‡‡ç”¨è·å¾—é”çš„å½“ä¸‹æ—¶é—´å‡å»åŠ é”è¯·æ±‚æ—¶çš„æ—¶é—´æˆ³å¾—åˆ°&lt;/li&gt;
&lt;li&gt;é”ç”³è¯·åˆ°åï¼Œé”çš„æœ‰æ•ˆæ—¶é—´ = é”çš„è¿‡æœŸæ—¶é—´ - ç”³è¯·é”è·å¾—çš„æ—¶é—´&lt;/li&gt;
&lt;li&gt;å¦‚æœç”³è¯·é”å¤±è´¥äº†ï¼Œç”³è¯·æˆåŠŸé”çš„èŠ‚ç‚¹ä¼šæ‰§è¡Œè§£é”æ“ä½œï¼Œè¿›è¡Œé‡ç½®&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å‚è€ƒï¼š&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;http://zhangtielei.com/posts/blog-redlock-reasoning.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;RedLockç®—æ³•çš„äº‰è®®&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;åˆ†å¸ƒå¼è‡ªå¢id&#34;&gt;åˆ†å¸ƒå¼è‡ªå¢id&lt;/h1&gt;
&lt;h2 id=&#34;æ•°æ®åº“è‡ªå¢id&#34;&gt;æ•°æ®åº“è‡ªå¢id&lt;/h2&gt;
&lt;p&gt;åˆ©ç”¨MySQLçš„è‡ªå¢idæ¥å®ç°ï¼ŒæœåŠ¡åœ¨éœ€è¦ç”¨åˆ°è‡ªå¢idæ—¶ï¼Œä¼šå‘MySQLå‘é€è¯·æ±‚ã€‚é€šè¿‡äº‹åŠ¡çš„æ–¹å¼ï¼Œå…ˆå¢é•¿idå†è¿›è¡ŒæŸ¥è¯¢&lt;/p&gt;
&lt;p&gt;ä¼˜ç‚¹ï¼šç®€å•æ–¹ä¾¿&lt;/p&gt;
&lt;p&gt;ç¼ºç‚¹ï¼šæ€§èƒ½ä¸æ˜¯å¾ˆå¥½ï¼Œè¿˜æœ‰ä¸€ä¸ªæ˜¯å¯ç”¨æ€§é—®é¢˜ï¼Œå¦‚æœæ•°æ®åº“ä¸å¯ç”¨äº†ï¼Œä¼šå¯¼è‡´å…¶ä»–æœåŠ¡ä¸å¯ç”¨ï¼Œå¦‚æœä½¿ç”¨ä¸»ä»æ–¹å¼éƒ¨ç½²ï¼Œè™½ç„¶å¯é æ€§æå‡äº†ï¼Œä½†å¦‚æœä¸»åº“æŒ‚æ‰åï¼Œä»åº“æ•°æ®æ²¡æœ‰åŠæ—¶åŒæ­¥ï¼Œä¼šå‡ºç°IDé‡å¤&lt;/p&gt;
&lt;p&gt;è§£å†³ï¼šä½¿ç”¨åŒä¸»æ¨¡å¼ï¼Œä¸¤ä¸ªä¸»èŠ‚ç‚¹çš„è‡ªå¢åºåˆ—é”™å¼€ï¼Œæ¯”å¦‚è®¾ç½®èŠ‚ç‚¹Açš„èµ·å§‹å€¼ä¸º1ï¼Œæ­¥é•¿ä¸º2ï¼ŒèŠ‚ç‚¹Bçš„èµ·å§‹å€¼ä¸º2ï¼Œä¸å‡ºä¸º2ã€‚ä½†æ˜¯è¿™ç§æ–¹æ¡ˆåˆæœ‰ä¸€ä¸ªç¼ºç‚¹ï¼Œé‚£å°±æ˜¯æ‰©å±•æ€§ä¸å¥½ï¼Œå‡å¦‚ä¸¤ä¸ªèŠ‚ç‚¹ä¸å¤Ÿç”¨äº†ï¼Œç¬¬ä¸‰ä¸ªèŠ‚ç‚¹åŠ å…¥æ—¶çš„èµ·å§‹å€¼å’Œæ­¥é•¿ä¸å¥½è®¾ç½®&lt;/p&gt;
&lt;p&gt;è§£å†³ï¼šå®¢æˆ·ç«¯é€šè¿‡å·æ®µçš„æ–¹å¼æ¥è·å–è‡ªå¢idï¼Œæ¯æ¬¡ä»æ•°æ®åº“è·å–æ—¶ä¸å†æ˜¯è·å–ä¸€ä¸ªï¼Œè€Œæ˜¯è·å–ä¸€æ®µèŒƒå›´å†…çš„ä¸€æ‰¹idï¼Œç¼“å­˜åœ¨æœ¬åœ°ï¼Œå‡å°‘IOå’Œç«äº‰&lt;/p&gt;
&lt;h2 id=&#34;åˆ†æ®µ--å‘å·å™¨&#34;&gt;åˆ†æ®µ + å‘å·å™¨&lt;/h2&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://tech.meituan.com/2017/04/21/mt-leaf.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;å‚è€ƒç¾å›¢çš„Leafæ–¹æ¡ˆ&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Leafæ˜¯åŸºäºMySQLçš„åˆ†å¸ƒå¼IDç”Ÿæˆæ–¹æ¡ˆï¼Œç®€å•æ€»ç»“å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Leafä¸ºä¸åŒçš„ä¸šåŠ¡è®¾å®šä¸€ä¸ªtagï¼Œå®šä¹‰ä¸åŒçš„å·æ®µé•¿å’Œåˆå§‹å€¼ï¼Œæ¯ä¸ªä¸šåŠ¡è·å–IDéƒ½ç›¸äº’éš”ç¦»ï¼Œäº’ä¸å½±å“ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Leafå‘å·æ—¶æ˜¯å‘ç»™proxyï¼Œæ¯æ¬¡å‘ä¸€ä¸ªå·æ®µï¼Œä»¥å‡å°‘MySQLçš„å†™å‹åŠ›ï¼Œproxyä¼šæŠŠè·å–åˆ°çš„å·æ®µåšç¼“å­˜ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æœ‰äº†proxyä¹‹åå¦‚æœè¦å¯¹å‘å·å™¨(Leaf)åšæ‰©å±•ï¼Œç›´æ¥æ‰©å±•proxyï¼Œå¹¶ä¸”å¤šåˆ†é…ä¸€äº›å·æ®µå³å¯ï¼Œæ— éœ€å˜æ›´MySQLï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;proxyä¼šåœ¨å·æ®µå†…å·çš„æ•°é‡å‰©ä½™10%æ—¶è·å–ä¸‹ä¸€æ‰¹ï¼Œä»¥é¿å…å¹¶å‘è·å–æ—¶å¡é¡¿ï¼Œè¿˜èƒ½åŠæ—¶è¡¥å……å·æºï¼Œä¸æ€•DBå®•æœºï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;proxyæ¶ˆè€—å®Œä¸€ä¸ªå·æ®µåï¼Œä»DBä¸Šæ›´æ–°å·æ®µï¼Œè·å–ä¸‹ä¸€ä¸ªèŒƒå›´çš„å·æ®µï¼›&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;k&#34;&gt;Begin&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;UPDATE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SET&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;max_id&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;max_id&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;step&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;biz_tag&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;test_tag&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;tag&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;max_id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;step&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;biz_tag&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;test_tag&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;Commit&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦ä¸€ç§æ–¹æ¡ˆå¯å‚è€ƒ&lt;a class=&#34;link&#34; href=&#34;https://tech.youzan.com/id_generator/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;æœ‰èµ&lt;/a&gt;ï¼Œæ€»ç»“ä¸€ä¸‹å°±æ˜¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å‘å·å™¨ä¸»å¤‡éƒ¨ç½²ï¼Œå¯¹å¤–åªæœ‰ä¸€ä¸ªå®ä¾‹æä¾›æœåŠ¡ï¼Œå‘å·å™¨æœ¬èº«çš„é«˜å¯ç”¨ä¹Ÿæ˜¯é€šè¿‡etcdæ¥å®ç°ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç”Ÿæˆçš„idå­˜å‚¨åœ¨etcdï¼Œä½¿å¾—å‘å·å™¨æœ¬èº«æ— çŠ¶æ€ï¼Œåˆ©ç”¨etcdçš„cpç‰¹æ€§ï¼Œä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥è§£å†³æ•°æ®åº“ä¸»ä»åŒæ­¥å¯¼è‡´çš„idé‡å¤é—®é¢˜ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å·çš„ç”Ÿæˆæœ‰ä¸¤ç§æ–¹å¼ï¼šå…¨å±€å•è°ƒè‡ªå¢ã€ç±»é›ªèŠ±id ä¸¤ç§æ–¹æ¡ˆï¼Œç”Ÿæˆä¸€æ‰¹idåç¼“å­˜åˆ°æœ¬æœºå†…å­˜ä¸­ï¼Œæœ‰è¯·æ±‚è¿›æ¥å°±å‘ä¸€ä¸ªidï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å‘å·å™¨é¢„å…ˆç”Ÿæˆä¸€æ‰¹idï¼Œå¼‚æ­¥æŒä¹…åŒ–åˆ°etcdï¼Œå¤åˆ¶åˆ°åŠæ•°ä¹ƒè‡³å…¨éƒ¨æœºå™¨ä¸Šï¼›å¦‚æœidæ¶ˆè€—é€Ÿåº¦å¿«äºå¼‚æ­¥æŒä¹…åŒ–é€Ÿåº¦ï¼Œæ­¤æ—¶ä¼šé˜»å¡ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åˆ©ç”¨etcdå®ç°å‘å·å™¨çš„é«˜å¯ç”¨æ–¹æ¡ˆï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;March çš„é«˜å¯ç”¨æ˜¯åˆ©ç”¨ etcd çš„ ttl å’Œ watch å®ç°çš„ã€‚å¯åŠ¨æ—¶ï¼Œå…ˆå°è¯•åˆ›å»ºä¸€ä¸ªæ–°çš„å¸¦ ttl çš„ Nodeã€‚å¦‚æœæˆåŠŸï¼Œå°±æˆä¸ºäº†ä¸»èŠ‚ç‚¹ï¼›å¦‚æœç”±äºå·²å­˜åœ¨è€Œå¤±è´¥ï¼Œå°±æˆä¸ºäº†å¤‡èŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ä¸»èŠ‚ç‚¹&lt;/p&gt;
&lt;p&gt;å®šæ—¶ç”¨å‰ä¸€æ¬¡è¯·æ±‚è¿”å›çš„ index åˆ·æ–° Node çš„ ttlï¼Œä¿æŒè‡ªå·±çš„ä¸»èŠ‚ç‚¹è§’è‰²ã€‚å‘ç°åˆ·æ–°å¤±è´¥æ—¶ï¼Œè¯´æ˜ä¸»èŠ‚ç‚¹è§’è‰²å·²ç»è¢«æŠ¢èµ°ï¼Œä»æŠ¢ä¸»èŠ‚ç‚¹è¿‡ç¨‹é‡æ–°å¼€å§‹ã€‚ä¸æ­¤åŒæ—¶ï¼Œè¿˜ä¼šç­‰å¾… demote è¯·æ±‚ã€‚æ”¶åˆ° demote è¯·æ±‚æ—¶ï¼Œä¼šç­‰å¾…æ–°çš„ä¸»èŠ‚ç‚¹ä¿¡æ¯ï¼Œç„¶åå°†è‡ªå·±ç½®ä¸ºå¤‡èŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¤‡èŠ‚ç‚¹&lt;/p&gt;
&lt;p&gt;å…ˆæŸ¥è¯¢ä¸»èŠ‚ç‚¹çš„ä¿¡æ¯ã€‚åœ¨å¤‡èŠ‚ç‚¹æ”¶åˆ°å‘å·è¯·æ±‚æ—¶ï¼Œä¼šæŒ‰ Redis Cluster åè®®é‡å®šå‘åˆ°ä¸»èŠ‚ç‚¹ã€‚ä¹‹åå°±å¼€å§‹ Watch Node çš„å˜åŒ–ã€‚æ£€æµ‹åˆ°å˜åŒ–åï¼Œä¹Ÿå¼€å§‹æŠ¢ä¸»èŠ‚ç‚¹è¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿™æ ·ï¼Œå¯ä»¥åšåˆ°åœ¨ä¸»èŠ‚ç‚¹å‘ç”Ÿæ•…éšœæ—¶ï¼Œæœ€å¤šç­‰å¾…ä¸€ä¸ª ttl å°±èƒ½æ£€æµ‹åˆ°ï¼Œå¹¶å®Œæˆåˆ‡æ¢ã€‚è€Œåœ¨ä¸»åŠ¨åˆ‡æ¢æ—¶ï¼Œç»“åˆå®¢æˆ·ç«¯ï¼Œå¯ä»¥åšåˆ°å®Œå…¨æ— æŸï¼Œåªæœ‰æ¯«ç§’çº§çš„é˜»å¡ã€‚&lt;/p&gt;
&lt;p&gt;æ­¤å¤–ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½ä¼šå­˜ä¿å­˜å„è‡ªçš„å¸¦ ttl çš„èŠ‚ç‚¹ä¿¡æ¯ï¼ŒåŒæ—¶å®šæ—¶åˆ·æ–°ï¼Œç”¨äºè¿”å›ç»™å®¢æˆ·ç«¯é›†ç¾¤ä¿¡æ¯ã€‚æ¯ä¸ªå‘å·å™¨åœ¨æ¯æ¬¡æŒä¹…åŒ–æ—¶ï¼Œä¹Ÿä¼šæºå¸¦ä¸Šä¸Šä¸€æ¬¡æŒä¹…åŒ–è·å¾—çš„ indexã€‚ä¸€æ—¦ä¸åŒ¹é…å‡ºé”™ï¼Œä¹Ÿä¼šå°†è‡ªèº«é‡ç½®ä¸ºå¤‡èŠ‚ç‚¹ã€‚è¿™å¯ä»¥é¿å…ç½‘ç»œå µå¡æˆ–è¿›ç¨‹åƒµæ­»é€ æˆåŸä¸»å¤±æ•ˆè€Œè‡ªèº«å´ä¸çŸ¥é“ã€‚åœ¨å‘ç”Ÿéé¢„æœŸé”™è¯¯æ—¶ï¼ŒHA goroutine ä¼šç­‰å¾… 2 * ttlï¼Œä»¥å…ä¸æ–­å‡ºé”™é€ æˆæ­»å¾ªç¯ã€‚æ­¤å¤–ï¼Œå¤‡èŠ‚ç‚¹ä¹Ÿéœ€è¦èƒ½å¤Ÿå®Œæˆç”¨æˆ·è®¤è¯ã€‚ä½†å› ä¸ºè®¤è¯æ˜¯ä¸èƒ½é‡å®šå‘çš„ï¼Œæ‰€ä»¥è¿˜éœ€è¦æ£€æµ‹ etcd ä¸Šçš„ç”¨æˆ·ä¿¡æ¯å˜åŒ–ï¼Œé‡æ–°åŒæ­¥ç”¨æˆ·æ•°æ®ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;é›ªèŠ±ç®—æ³•&#34;&gt;é›ªèŠ±ç®—æ³•&lt;/h2&gt;
&lt;p&gt;åˆ†å¸ƒå¼IDå›ºå®šæ˜¯ä¸€ä¸ªlongç±»å‹çš„æ•°å­—ï¼Œå 64ä½ï¼Œé€šè¿‡ä¸€å®šçš„è§„åˆ™ç¼–æ’è¿™64ä½æ¥å®ç°&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;-------------------------------------------------------------------
|  bit   | 66 |           65 ~ 24        |  23 ~ 13  |   12 ~ 1   |
| length | 1  |             41           |    10     |     12     |
|  part  |none|         timestamp        |  machine  |  sequence  |
-------------------------------------------------------------------
41ä½çš„æ—¶é—´æˆ³å¯ä»¥ä½¿ç”¨69å¹´ï¼Œ41ä½çš„æ—¶é—´æˆ³æ˜¯ç²¾ç¡®åˆ°æ¯«ç§’çº§åˆ«çš„
12ä½çš„åºåˆ—å·å¯ä»¥è®©åŒä¸€ä¸ªèŠ‚ç‚¹ä¸€æ¯«ç§’å†…ç”Ÿäº§4096ä¸ªID
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä¸€èˆ¬å¯ä»¥è‡ªå·±è°ƒæ•´æ—¶é—´æˆ³ã€æœºå™¨idã€åºåˆ—å·çš„ä½æ•°æ¥æ§åˆ¶IDçš„å¹¶å‘é‡ã€ä½¿ç”¨å¹´é™ç­‰ï¼Œæ»¡è¶³ä¸åŒçš„åœºæ™¯ï¼Œæœºå™¨IDå¯ä»¥è‡ªå·±é…ç½®åœ¨èŠ‚ç‚¹ä¸Šã€é…ç½®ä¸­å¿ƒã€æ•°æ®åº“ã€‚&lt;/p&gt;
&lt;p&gt;ä¼˜ç‚¹ï¼šç®€å•æ–¹ä¾¿ï¼Œæ•´å‹æ˜“æ“ä½œï¼Œæœ‰éœ€è¦è¿˜å¯ä»¥å°†æ•´å‹è¿›è¡Œè¿›åˆ¶è½¬åŒ–ï¼Œè½¬æˆå­—ç¬¦ä¸²ç±»å‹çš„id&lt;/p&gt;
&lt;p&gt;ç¼ºç‚¹ï¼šå› ä¸ºä½¿ç”¨åˆ°äº†æ—¶é—´ï¼Œå¦‚æœèŠ‚ç‚¹ä¸Šçš„æ—¶é’Ÿå›æ‹¨ï¼Œä¼šå¯¼è‡´IDé‡å¤ï¼›å¦‚æœæœåŠ¡éƒ¨ç½²åœ¨dockerå†…ï¼Œè·å–æ—¶é—´å’Œæœºå™¨idè¦æ³¨æ„ï¼›ç”±äºæœºå™¨ä¸åŒï¼Œç”Ÿæˆçš„idæ˜¯è‡ªå¢çš„ï¼Œä½†æ˜¯ä¸ä¸€å®šè¿ç»­ï¼›è€Œä¸”è¿˜æœ‰ä¸ªé—®é¢˜ï¼Œå‰ç«¯jsæ˜¯æ²¡æœ‰longç±»å‹çš„ï¼Œæ•´å‹æœ€å¤šæ”¯æŒ53ä½ï¼Œæ‰€ä»¥å¦‚æœè¿”å›ç»™å‰ç«¯è¿˜è¦åšä¸€æ¬¡è½¬åŒ–ã€‚&lt;/p&gt;
&lt;p&gt;å¯ä»¥å…è®¸ sequence æ®µæº¢å‡ºï¼Œæº¢å‡ºçš„éƒ¨åˆ†ä¼šåŠ åˆ° timestamp æ®µä¸Šå»ï¼Œè¿™æ ·å³ä½¿åœ¨æ—¶é—´æˆ³ç²¾åº¦èŒƒå›´å†… sequence è€—å°½äº†ï¼Œä¹Ÿä¸ç”¨é˜»å¡è¯·æ±‚ï¼ŒåŒæ—¶ä¹Ÿç¡®ä¿å³ä½¿æœºå™¨æ—¶é’Ÿå›æ‹¨å¯¼è‡´çš„idé‡å¤ï¼Œä½†è¿™ç§æœ‰ä¸ªåå¤„æ˜¯æ— æ³•é€šè¿‡idè§£æå‡ºæ­£ç¡®çš„æ—¶é—´æˆ³ã€‚&lt;/p&gt;
&lt;h2 id=&#34;åˆ©ç”¨etcd&#34;&gt;åˆ©ç”¨ETCD&lt;/h2&gt;
&lt;p&gt;etcd èƒ½æ»¡è¶³ä¸ä¼šä¸¢å¤±çš„ï¼Œå¤šå‰¯æœ¬ï¼Œå¼ºä¸€è‡´çš„å…¨éƒ¨éœ€æ±‚ã€‚ä¸¤ç§æ–¹æ¡ˆï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;åˆ©ç”¨ETCDå®ç°åˆ†å¸ƒå¼é”ï¼Œå¯¹å­˜å‚¨åœ¨ETCDä¸­çš„è‡ªå¢IDåŠ é”å®ç°&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åˆ©ç”¨ETCDçš„boltdbï¼Œboltdbæ˜¯ä¸€ä¸ªå•æœºæ”¯æŒäº‹åŠ¡çš„KVå­˜å‚¨ï¼Œkeyæ˜¯reversionï¼Œvalueæ˜¯key-valueï¼Œboltedä¼šæŠŠæ¯ä¸ªç‰ˆæœ¬éƒ½ä¿å­˜ä¸‹æ¥ï¼Œå®ç°å¤šç‰ˆæœ¬æœºåˆ¶&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;ç”¨etcdctlé€šè¿‡æ‰¹é‡æ¥å£å†™å…¥ä¸¤æ¡è®°å½•ï¼š

etcdctl txn &amp;lt;&amp;lt;&amp;lt;&#39;
  put key1 &amp;quot;v1&amp;quot;
  put key2 &amp;quot;v2&amp;quot;

å†é€šè¿‡æ‰¹é‡æ¥å£æ›´æ–°è¿™ä¸¤æ¡è®°å½•ï¼š
etcdctl txn &amp;lt;&amp;lt;&amp;lt;&#39;
  put key1 &amp;quot;v12&amp;quot;
  put key2 &amp;quot;v22&amp;quot;

boltdbä¸­å…¶å®æœ‰äº†4æ¡æ•°æ®ï¼š
rev={3 0}, key=key1, value=&amp;quot;v1&amp;quot;
rev={3 1}, key=key2, value=&amp;quot;v2&amp;quot;
rev={4 0}, key=key1, value=&amp;quot;v12&amp;quot;
rev={4 1}, key=key2, value=&amp;quot;v22&amp;quot;

æ­¤æ—¶å¯ä»¥å‘ç°reversionç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼Œç¬¬ä¸€éƒ¨åˆ†ä¸ºmain revï¼Œæ¯æ¬¡äº‹åŠ¡è¿›è¡Œä¼šåŠ ä¸€ï¼Œç¬¬äºŒéƒ¨åˆ†sub revï¼ŒåŒä¸€ä¸ªäº‹åŠ¡ä¸­æ¯æ¬¡æ“ä½œåŠ ä¸€ã€‚å¦å¤–ETCDæä¾›äº†å‘½ä»¤å’Œé€‰é¡¹æ¥æ§åˆ¶å­˜å‚¨çš„ç©ºé—´é—®é¢˜
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;åˆ©ç”¨zookeeper&#34;&gt;åˆ©ç”¨ZooKeeper&lt;/h2&gt;
&lt;p&gt;åˆ©ç”¨ZooKeeperçš„é¡ºåºä¸€è‡´æ€§å’ŒåŸå­æ€§ï¼Œå½“å®¢æˆ·ç«¯æ¯æ¬¡éœ€è¦è‡ªå¢idæ—¶ï¼Œåˆ›å»ºä¸€ä¸ªæŒèŠ‚é¡ºåºèŠ‚ç‚¹ï¼ŒZooKeeperä¸ºäº†ä¿è¯æœ‰åºï¼Œä¼šç»™è¿™äº›èŠ‚ç‚¹ç¼–å·ï¼ŒåŒæ—¶ZooKeeperä¼šä¿è¯å¹¶å‘æ—¶ä¸ä¼šäº§ç”Ÿå†²çªï¼Œåˆ›å»ºæˆåŠŸåä¼šè¿”å›ç±»ä¼¼/root/generateid0000000001çš„ç»“æœï¼Œå†è¿›è¡Œæˆªå–å³å¯ï¼Œå¦å¤–ï¼Œä¸ºäº†ä¿è¯ä¸æµªè´¹ç©ºé—´ï¼Œå¯ä»¥ç”¨å®Œè¯¥znodeåè¿›è¡Œåˆ é™¤ã€‚&lt;/p&gt;
&lt;p&gt;ç¼ºç‚¹ï¼šZooKeeperæ˜¯CPï¼Œä¸ä¿è¯å®Œå…¨é«˜å¯ç”¨ï¼Œå¦å¤–ï¼Œç”±äºæ•°æ®éœ€è¦å†ZooKeeperé—´è¿›è¡Œè¿‡åŠæ•°åŒæ­¥å®Œæ‰ç®—å†™å…¥æˆåŠŸï¼Œæ€§èƒ½ä¹Ÿä¸€èˆ¬&lt;/p&gt;
&lt;h2 id=&#34;åˆ©ç”¨redis&#34;&gt;åˆ©ç”¨Redis&lt;/h2&gt;
&lt;p&gt;ä½¿ç”¨Redisçš„incrå‘½ä»¤æ¥å®ç°åŸå­æ€§çš„è‡ªå¢å’Œè¿”å›&lt;/p&gt;
&lt;p&gt;ä¼˜ç‚¹ï¼šç®€å•æ–¹ä¾¿&lt;/p&gt;
&lt;p&gt;ç¼ºç‚¹ï¼šéœ€è¦å¯¹idè¿›è¡ŒæŒä¹…åŒ–ï¼Œè™½ç„¶Redisæœ¬èº«æä¾›äº†RDBå’ŒAOFï¼Œä½†å¦‚æœå®•æœºäº†ï¼Œä»ç„¶æœ‰å¯èƒ½å‡ºç°é‡å¤IDï¼Œå¦‚æœä¸ºRedisæ­å»ºé›†ç¾¤ï¼Œç”±äºRedisä¸»ä»å¤åˆ¶æ—¶å¼‚æ­¥å¤åˆ¶çš„ï¼Œæ— æ³•ä¿è¯masterå®•æœºä¹‹å‰å°†æœ€æ–°çš„idåŒæ­¥ç»™å…¶ä»–å­èŠ‚ç‚¹ï¼Œå¯¼è‡´å®•æœºæ¢å¤ä¹‹åå¯èƒ½ä¼šäº§ç”Ÿé‡å¤çš„idï¼Œéœ€è¦é’ˆå¯¹è¿™ç§æƒ…å†µåšç‰¹æ®Šå¤„ç†ï¼Œæ¯”å¦‚å½“idé‡å¤æ—¶æŠ¥ç‰¹æ®Šé”™è¯¯ç ï¼Œè·³è¿‡è¿™ä¸ªé”™è¯¯çš„idåŒºé—´ã€‚&lt;/p&gt;
</description>
        </item>
        <item>
        <title>å¾®æœåŠ¡</title>
        <link>http://nixum.cc/p/%E5%BE%AE%E6%9C%8D%E5%8A%A1/</link>
        <pubDate>Wed, 20 Oct 2021 00:00:00 +0000</pubDate>
        
        <guid>http://nixum.cc/p/%E5%BE%AE%E6%9C%8D%E5%8A%A1/</guid>
        <description>&lt;p&gt;[TOC]&lt;/p&gt;
&lt;h1 id=&#34;ä¸€äº›æ¦‚å¿µç†è§£&#34;&gt;ä¸€äº›æ¦‚å¿µç†è§£&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å¾®æœåŠ¡ï¼šhttp://dockone.io/article/3687&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¸­é—´ä»¶ï¼ˆMiddlewareï¼‰ï¼šæ˜¯å¤„äºæ“ä½œç³»ç»Ÿå’Œåº”ç”¨ç¨‹åºä¹‹é—´çš„è½¯ä»¶ï¼Œç”¨æ¥å±è”½åº•å±‚çš„æŠ€æœ¯ç»†èŠ‚ï¼Œä»¥è‡ªèº«çš„å¤æ‚æ€§æ¢æ¥äº†åº”ç”¨ç¨‹åºå¼€å‘çš„ç®€å•ã€‚å¹¿ä¹‰ä¸­é—´ä»¶çš„å®šä¹‰æ˜¯éå¸¸å¹¿æ³›çš„ï¼Œæ¯”å¦‚æ¶ˆæ¯ã€æ³¨å†Œé…ç½®ä¸­å¿ƒã€ç½‘å…³ã€æ•°æ®åº“è®¿é—®ã€é›†æˆå¹³å°ç­‰ç­‰ï¼Œéƒ½å±äºä¸­é—´ä»¶çš„èŒƒç•´ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;äº‘åŸç”Ÿï¼šåº”ç”¨ç¨‹åºä»è®¾è®¡ä¹‹åˆå³è€ƒè™‘åˆ°äº‘çš„ç¯å¢ƒï¼ŒåŸç”Ÿä¸ºäº‘è€Œè®¾è®¡ï¼Œåœ¨äº‘ä¸Šä»¥æœ€ä½³çŠ¶æ€è¿è¡Œï¼Œå……åˆ†åˆ©ç”¨å’Œå‘æŒ¥äº‘å¹³å°çš„å¼¹æ€§å’Œåˆ†å¸ƒå¼ä¼˜åŠ¿ã€‚ä»£è¡¨æŠ€æœ¯åŒ…æ‹¬å®¹å™¨ã€æœåŠ¡ç½‘æ ¼ã€å¾®æœåŠ¡ã€ä¸å¯å˜åŸºç¡€è®¾æ–½å’Œå£°æ˜å¼APIï¼ˆå¦‚K8sï¼‰ï¼Œç»„åˆèµ·æ¥å°±ç®—æœåŠ¡å®¹å™¨åŒ–ï¼Œæ•´ä½“ä½¿ç”¨å¾®æœåŠ¡æ¶æ„ï¼Œåº”ç”¨æ”¯æŒå®¹å™¨ç¼–æ’è°ƒåº¦ã€‚&lt;/p&gt;
&lt;p&gt;äº‘åŸç”Ÿçš„æœ¬è´¨å…¶å®æ˜¯&lt;strong&gt;åŸºç¡€è®¾æ–½ä¸ä¸šåŠ¡çš„è§£è€¦ï¼Œä»¥åŠåŸºç¡€è®¾æ–½è‡ªèº«çš„æ ‡å‡†åŒ–&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;IaaSï¼šåŸºç¡€ç»“æ„å³æœåŠ¡ï¼ŒåŸºç¡€è®¾æ–½ï¼Œå¦‚AWSçš„EC2ã€S3ç­‰ï¼Œåªæä¾›æ¯”è¾ƒåŸå§‹çš„ç¡¬ä»¶åŠŸèƒ½ï¼Œç”¨æˆ·ä¸ç”¨ä¹°æœåŠ¡å™¨ï¼Œè‡ªå·±å»æ„å»ºç½‘ç»œï¼Œé˜²ç«å¢™ã€ç¡¬ç›˜å­˜å‚¨ç­‰åŸºç¡€è®¾æ–½ï¼Œå³æä¾›åŸºç¡€ç¯å¢ƒé…å¤‡ã€‚å‰©ä¸‹çš„ç”±ç”¨æˆ·è‡ªå·±å®Œæˆã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;PaaSï¼šå¹³å°å³æœåŠ¡ï¼Œä¸­é—´ä»¶ã€è§£å†³æ–¹æ¡ˆã€å·¥å…·å’ŒæœåŠ¡çš„é›†åˆï¼Œå¦‚AWSçš„DocDBã€Redisã€SQSã€SNSç­‰è®¾æ–½ï¼Œè®©ç”¨æˆ·æ›´ä¸“æ³¨è‡ªå·±ä¸šåŠ¡é€»è¾‘çš„å¼€å‘ï¼Œå¯¹äºä½¿ç”¨çš„å·¥å…·ï¼Œæ‹¿æ¥å³ç”¨ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;FaaSï¼šåŠŸèƒ½å³æœåŠ¡ï¼Œservice lessï¼Œå¦‚AWSçš„lambdaï¼Œç”¨æˆ·åªéœ€è¦å†™å¯¹åº”çš„ä¸šåŠ¡æ–¹æ³•å°±èƒ½æä¾›å¯¹åº”çš„æœåŠ¡ï¼Œå…¶ä»–éƒ½ä¸ç”¨ç®¡&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;SaaSï¼šè½¯ä»¶å³æœåŠ¡ï¼Œåº”ç”¨å±‚é¢äº†ï¼Œæ¯”å¦‚Shopifyã€mokaï¼Œæä¾›æŸä¸€ä¸šåŠ¡é¢†åŸŸçš„è§£å†³æ–¹æ¡ˆï¼Œç›´æ¥æ³¨å†Œä½¿ç”¨å³å¯&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;DevOpsï¼šä¸€ç§æ¨¡å¼ï¼Œä¸æ•æ·æŒ‚é’©ï¼Œé›†æ–‡åŒ–ç†å¿µã€å®è·µå’Œå·¥å…·äºä¸€èº«ï¼Œå¿«é€Ÿè¿­ä»£å’Œéƒ¨ç½²ï¼Œæä¾›ç»„ç»‡å¿«é€Ÿäº¤ä»˜åº”ç”¨çš„èƒ½åŠ›ã€‚è‡ªåŠ¨åŒ–éƒ¨ç½²ã€è‡ªåŠ¨åŒ–è¿ç»´ï¼Œé€‚åˆæ•æ·å¼€å‘å’Œå¿«é€Ÿè¿­ä»£ï¼Œè§£å†³ä¼ ç»Ÿå¼€å‘å’Œè¿ç»´ç›¸äº’ç‹¬ç«‹ï¼Œæ²Ÿé€šé¢‘ç¹ï¼Œæ•ˆç‡ä½ç­‰é—®é¢˜&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;é™æµ&#34;&gt;é™æµ&lt;/h1&gt;
&lt;p&gt;ä¸‹é¢çš„æ–¹æ¡ˆéƒ½æ˜¯å•æœºç‰ˆæœ¬çš„ï¼Œåœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹å¯ä»¥æŠŠé™æµçš„å®ä¾‹æ”¾åˆ°Redisé‡Œï¼Œæˆ–è€…ç›´æ¥ä½¿ç”¨Luaè„šæœ¬å®ç°ï¼Œä¿è¯å¹¶å‘å®‰å…¨ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å›ºå®šçª—å£&#34;&gt;å›ºå®šçª—å£&lt;/h2&gt;
&lt;p&gt;è§„å®šå•ä½æ—¶é—´å†…å¯è®¿é—®çš„æ¬¡æ•°ï¼Œæ¯”å¦‚è§„å®šæ¥å£ä¸€åˆ†é’Ÿå†…åªèƒ½è®¿é—®10æ¬¡ï¼Œä»¥ç¬¬ä¸€æ¬¡è¯·æ±‚ä¸ºèµ·å§‹ï¼Œè®¡æ•°1ï¼Œä¸€åˆ†é’Ÿå†…è®¡æ•°è¶…è¿‡10åï¼Œåç»­çš„è¯·æ±‚ç›´æ¥æ‹’ç»ï¼Œåªèƒ½ç­‰åˆ°è¿™ä¸€åˆ†é’Ÿç»“æŸåï¼Œé‡ç½®è®¡æ•°ï¼Œé‡æ–°å¼€å§‹è®¡æ•°ã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯è¿™æ ·æœ‰ä¸ªé—®é¢˜ï¼Œå¦‚æœåœ¨å¤§éƒ¨åˆ†è¯·æ±‚é›†ä¸­åœ¨ç¬¬ä¸€ä¸ªçª—å£çš„å10så†…ï¼Œå’Œç¬¬äºŒä¸ªçª—å£çš„å‰10så†…ï¼Œè™½ç„¶ä»–ä»¬éƒ½ç¬¦åˆé™æµç­–ç•¥ï¼Œä½†æ˜¯åœ¨ä¸´ç•Œçš„20så†…ï¼Œè¯·æ±‚è¿˜æ˜¯æœ‰å¯èƒ½å‹å®ç³»ç»Ÿã€‚&lt;/p&gt;
&lt;p&gt;ç®—æ³•Demoï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;47
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;fixWinLimiter&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;lock&lt;/span&gt;            &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;sync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Mutex&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;maxLimitCount&lt;/span&gt;    &lt;span class=&#34;kt&#34;&gt;int64&lt;/span&gt;   &lt;span class=&#34;c1&#34;&gt;// æœ€å¤§é™åˆ¶æ•°
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;currentCount&lt;/span&gt;     &lt;span class=&#34;kt&#34;&gt;int64&lt;/span&gt;   &lt;span class=&#34;c1&#34;&gt;// å½“å‰è®¡æ•°
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;fixInterval&lt;/span&gt;      &lt;span class=&#34;kt&#34;&gt;int64&lt;/span&gt;   &lt;span class=&#34;c1&#34;&gt;// ä¸ºäº†ç®€åŒ–ï¼Œå•ä½è®¾ç½®ä¸ºç§’
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;lastReqStartAt&lt;/span&gt;   &lt;span class=&#34;kt&#34;&gt;int64&lt;/span&gt;   &lt;span class=&#34;c1&#34;&gt;// ç§’çº§æ—¶é—´æˆ³
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;NewFixWinLimit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;fixInterval&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int64&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;maxLimitCount&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int64&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;fixWinLimiter&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;fixWinLimiter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;           &lt;span class=&#34;nb&#34;&gt;new&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;sync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Mutex&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;maxLimitCount&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;  &lt;span class=&#34;nx&#34;&gt;maxLimitCount&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;fixInterval&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;fixInterval&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;fixWinLimiter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;IsPass&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;defer&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Unlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;now&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Now&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Unix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;now&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lastReqStartAt&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;fixInterval&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;currentCount&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lastReqStartAt&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;now&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;currentCount&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;maxLimitCount&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;currentCount&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;// æµ‹è¯•
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// 10så†…åªå…è®¸é€šè¿‡10æ¬¡
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;f1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;NewFixWinLimit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;10&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;10&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;20&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;go&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;index&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;f1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;IsPass&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
				&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Sprintf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;pass: %d&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;index&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
				&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Sprintf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;no pass: %d&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;index&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Sleep&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;100&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Second&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id=&#34;æ»‘åŠ¨çª—å£&#34;&gt;æ»‘åŠ¨çª—å£&lt;/h2&gt;
&lt;p&gt;ä¸å›ºå®šçª—å£ç±»ä¼¼ï¼Œåªæ˜¯ä»¥æ—¶é—´ç‰‡åˆ’åˆ†ï¼Œæ¯”å¦‚è§„å®šçª—å£ä¸€ç§’å†…åªèƒ½è¯·æ±‚5æ¬¡ï¼Œæ¯æ¬¡è¯·æ±‚æ—¶ä¼šæŒ‰ç…§å‰ä¸€ç§’å†…çš„è¯·æ±‚æ•°é‡è¿›è¡Œåˆ¤æ–­ï¼Œè¶…è¿‡åˆ™æ‹’ç»ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ç§ç®—æ³•æœ¬è´¨ä¸Šåªæ˜¯æŠŠå›ºå®šçª—å£è®¡æ•°é™æµçš„æ—¶é—´ç‰‡å˜å°äº†ï¼Œä»ç„¶æœ‰å¯èƒ½å‡ºç°å›ºå®šçª—å£è®¡æ•°é™æµçš„ä¸´ç•Œç‚¹é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;ç®—æ³•Demoï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;48
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;49
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;50
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;51
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;52
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;53
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;54
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;55
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;slidingWinLimiter&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;lock&lt;/span&gt;          &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;sync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Mutex&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;limitInterval&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int64&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// é™åˆ¶çš„æ—¶é—´é—´éš”
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;lastReqAt&lt;/span&gt;     &lt;span class=&#34;kt&#34;&gt;int64&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// ä¸Šä¸€æ¬¡è¯·æ±‚çš„æ—¶é—´
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;winCount&lt;/span&gt;           &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int64&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// çª—å£è®¡æ•°
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;currentWinIndex&lt;/span&gt;    &lt;span class=&#34;kt&#34;&gt;int64&lt;/span&gt;   &lt;span class=&#34;c1&#34;&gt;// å½“å‰çª—å£ç´¢å¼•
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;currentWinMaxLimit&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int64&lt;/span&gt;   &lt;span class=&#34;c1&#34;&gt;// å½“å‰çª—å£æœ€å¤§é™åˆ¶æ•°
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;winNum&lt;/span&gt;             &lt;span class=&#34;kt&#34;&gt;int64&lt;/span&gt;   &lt;span class=&#34;c1&#34;&gt;// çª—å£æ•°é‡
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;NewSlidingWinLimiter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;limitInterval&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int64&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;winMaxLimitCount&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int64&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;winNum&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int64&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;slidingWinLimiter&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;slidingWinLimiter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;               &lt;span class=&#34;nb&#34;&gt;new&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;sync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Mutex&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;limitInterval&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;      &lt;span class=&#34;nx&#34;&gt;limitInterval&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;lastReqAt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;          &lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Now&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Unix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;winCount&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;           &lt;span class=&#34;nb&#34;&gt;make&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;([]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int64&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;winNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;currentWinMaxLimit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;winMaxLimitCount&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;winNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;             &lt;span class=&#34;nx&#34;&gt;winNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;slidingWinLimiter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;IsPass&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;defer&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Unlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;now&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Now&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Unix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
	&lt;span class=&#34;c1&#34;&gt;// æ¯ä¸ªçª—å£çš„æ—¶é—´é—´éš”
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;eachWinInterval&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;float64&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;limitInterval&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;/&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;float64&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;winNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;c1&#34;&gt;// åˆ¤æ–­å‰åä¸¤æ¬¡è¯·æ±‚çš„æ—¶é—´å·®æ˜¯å¦åœ¨å½“å‰çª—å£å†…ï¼Œä¸æ˜¯åˆ™é‡ç½®å½“å‰çª—å£ï¼Œä½¿ç”¨ä¸‹ä¸€ä¸ªçª—å£
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;float64&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;now&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lastReqAt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;eachWinInterval&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;winCount&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;currentWinIndex&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;currentWinIndex&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;currentWinIndex&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;%&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;winNum&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lastReqAt&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;now&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;c1&#34;&gt;// åˆ¤æ–­æ˜¯å¦è¶…è¿‡å½“å‰çª—å£çš„é™åˆ¶
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;winCount&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;currentWinIndex&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;currentWinMaxLimit&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;winCount&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;currentWinIndex&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;f1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;NewSlidingWinLimiter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;10&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;20&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;go&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;index&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;f1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;IsPass&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
				&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Sprintf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;pass: %d&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;index&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
				&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Sprintf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;no pass: %d&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;index&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Sleep&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;100&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Second&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id=&#34;æ¼æ¡¶&#34;&gt;æ¼æ¡¶&lt;/h2&gt;
&lt;p&gt;æ§åˆ¶æµæ°´ï¼Œæ°´(è¯·æ±‚)æŒç»­åŠ å…¥æ¡¶ä¸­ï¼Œåº•éƒ¨ä»¥æ’å®šé€Ÿåº¦æµå‡ºï¼Œå¦‚æœåŠ æ°´é€Ÿåº¦å¤§äºæ¼å‡ºé€Ÿåº¦ï¼Œæ°´åˆ™æº¢å‡ºï¼Œè¯·æ±‚æ‹’ç»ã€‚å³å®½è¿›ä¸¥å‡ºï¼Œæ— è®ºè¯·æ±‚å¤šå°‘ï¼Œè¯·æ±‚çš„é€Ÿç‡æœ‰å¤šå¤§ï¼Œéƒ½æŒ‰ç…§å›ºå®šçš„é€Ÿç‡æµå‡ºã€‚&lt;/p&gt;
&lt;p&gt;ä¼˜ç‚¹ï¼šèƒ½å¤Ÿç¡®ä¿èµ„æºä¸ä¼šç¬é—´è€—å°½ï¼Œé¿å…è¯·æ±‚å¤„ç†å‘ç”Ÿé˜»å¡ç°è±¡ï¼Œè¿˜èƒ½ä¿æŠ¤è¢«ç³»ç»Ÿè°ƒç”¨çš„å¤–éƒ¨æœåŠ¡ï¼Œè®©å…¶å…å—çªå‘è¯·æ±‚çš„å†²å‡»ã€‚&lt;/p&gt;
&lt;p&gt;ç¼ºç‚¹ï¼šå¯¹äºçªå‘è¯·æ±‚ä»ç„¶ä¼šä»¥ä¸€ä¸ªæ’å®šçš„é€Ÿç‡è¿›è¡Œå¤„ç†ï¼Œå…¶çµæ´»æ€§ä¼šå¼±ä¸€äº›ï¼Œå®¹æ˜“å‘ç”Ÿçªç„¶è¯·æ±‚è¶…è¿‡æ¼æ¡¶å®¹é‡ï¼Œå¯¼è‡´åç»­è¯·æ±‚è¢«ç›´æ¥ä¸¢å¼ƒã€‚&lt;/p&gt;
&lt;p&gt;ä¸€èˆ¬ç”¨åœ¨å¯¹ç¬¬ä¸‰æ–¹æä¾›æœåŠ¡çš„è¯·æ±‚é™åˆ¶ä¸Šï¼Œæ¯”å¦‚æˆ‘ä»¬æœåŠ¡æ¥å…¥shopifyçš„æœåŠ¡ï¼Œä¸ºäº†ä¸è§¦å‘shopifyçš„é™æµï¼Œå°±å¯ä»¥ä½¿ç”¨æ¼æ¡¶ç®—æ³•ã€‚&lt;/p&gt;
&lt;p&gt;ç®—æ³•Demoï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;48
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;49
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;50
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;51
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;52
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;53
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;54
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;bucketLimiter&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;lock&lt;/span&gt;          &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;sync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Mutex&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;lastReqAt&lt;/span&gt;     &lt;span class=&#34;kt&#34;&gt;int64&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// å•ä½ï¼šç§’
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;bucketCap&lt;/span&gt;     &lt;span class=&#34;kt&#34;&gt;int64&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// æ¡¶çš„å®¹é‡
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;bucketBalance&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int64&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// æ¡¶çš„ä½™é‡
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;rate&lt;/span&gt;          &lt;span class=&#34;kt&#34;&gt;int64&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// æ¯æ—¶é—´å•ä½å†…æ¼æ¡¶çš„æ¼å‡ºé€Ÿç‡
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;NewBucketLimiter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rate&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int64&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;bucketCap&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int64&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;bucketLimiter&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;bucketLimiter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;          &lt;span class=&#34;nb&#34;&gt;new&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;sync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Mutex&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;bucketCap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;     &lt;span class=&#34;nx&#34;&gt;bucketCap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;bucketBalance&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;rate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;          &lt;span class=&#34;nx&#34;&gt;rate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;lastReqAt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;     &lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Now&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Unix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;b&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;bucketLimiter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;IsPass&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;defer&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Unlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;now&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Now&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Unix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
	&lt;span class=&#34;c1&#34;&gt;// è®¡ç®—æ—¶é—´å·®å†…å¯é€šè¿‡çš„è®¡æ•°é‡
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;diffInterval&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;now&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lastReqAt&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;diffCount&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;diffInterval&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rate&lt;/span&gt;
	&lt;span class=&#34;c1&#34;&gt;// è®¡ç®—æ¡¶ä¸­å‰©ä½™çš„é‡
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;bucketBalance&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;diffCount&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;bucketBalance&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;bucketBalance&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lastReqAt&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;now&lt;/span&gt;
	&lt;span class=&#34;c1&#34;&gt;// åˆ¤æ–­æ˜¯å¦åŠ æ°´åæ˜¯å¦æº¢å‡º
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;bucketBalance&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;bucketCap&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;bucketBalance&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;// æµ‹è¯•
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    	&lt;span class=&#34;c1&#34;&gt;// å•ä½æ—¶é—´å†…æ¼å‡ºé€Ÿåº¦æ˜¯2ï¼Œæ¡¶çš„å®¹é‡æ˜¯5
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;f1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;NewBucketLimiter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;20&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;go&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;index&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;f1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;IsPass&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
				&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Sprintf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;pass: %d&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;index&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
				&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Sprintf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;no pass: %d&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;index&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Sleep&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;100&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Second&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id=&#34;ä»¤ç‰Œæ¡¶&#34;&gt;ä»¤ç‰Œæ¡¶&lt;/h2&gt;
&lt;p&gt;ç±»ä¼¼ä¿¡å·é‡ï¼Œä»¤ç‰Œæ¡¶ä¼šå•ç‹¬ç»´æŠ¤ä¸€ä¸ªä»¤ç‰Œçš„å­˜å‚¨æ¡¶ï¼Œä¸ºè¿™ä¸ªæ¡¶è®¾ç½®ä¸€ä¸ªä¸Šé™ï¼ŒåŒæ—¶åˆä¼šæœ‰ä»¤ç‰ŒæŒç»­å°†æ”¾å…¥æ¡¶ä¸­ï¼Œä»¥åº”å¯¹ä¸€å®šçš„çªå‘æµé‡ï¼Œæ¯”å¦‚æ¡¶çš„ä¸Šé™æ˜¯1000ï¼Œæ¯ç§’æŒç»­æ”¾å…¥1000ä¸ªä»¤ç‰Œï¼Œå½“å‰1sæœ‰800ä¸ªè¯·æ±‚å‘ç”Ÿå¹¶æ¶ˆè€—ä»¤ç‰Œï¼Œç”±äºæ¯ç§’ä¼šæ”¾å…¥1000ä¸ªä»¤ç‰Œï¼Œå1så°±æœ‰1200ä¸ªä»¤ç‰Œå¯ä»¥è¢«æ¶ˆè€—ï¼Œå› æ­¤ä¸‹ä¸€ç§’å¯ä»¥åº”å¯¹1200ä¸ªè¯·æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;ä¼˜ç‚¹ï¼šåœ¨é™åˆ¶å¹³å‡æµå…¥é€Ÿç‡çš„åŒæ—¶ï¼Œè¿˜èƒ½é¢å¯¹çªå‘è¯·æ±‚ï¼Œç¡®ä¿èµ„æºè¢«å……åˆ†åˆ©ç”¨ï¼Œä¸ä¼šè¢«é—²ç½®æµªè´¹ã€‚&lt;/p&gt;
&lt;p&gt;ç¼ºç‚¹ï¼šèˆå¼ƒå¤„ç†é€Ÿç‡çš„å¼ºæ§åˆ¶åŠ›ï¼Œå¦‚æœæŸäº›åŠŸèƒ½ä¾èµ–å¤–éƒ¨æœåŠ¡ï¼Œå¯èƒ½ä¼šè®©å¤–éƒ¨æœåŠ¡æ— æ³•æ‰¿å—å‹åŠ›ï¼Œå¯¼è‡´æ— æ³•æ­£å¸¸è¿”å›ï¼Œè¿˜æµªè´¹æ­¤æ¬¡è·å–çš„ä»¤ç‰Œã€‚&lt;/p&gt;
&lt;p&gt;æ¼æ¡¶å’Œä»¤ç‰Œæ¡¶çš„åŒºåˆ«ï¼šæ¼æ¡¶æ˜¯é™åˆ¶æµå‡ºé€Ÿåº¦ï¼Œä»¤ç‰Œæ¡¶æ˜¯é™åˆ¶æµå…¥é€Ÿåº¦ã€‚&lt;/p&gt;
&lt;p&gt;ç®—æ³•Demoï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;48
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;49
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;50
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;51
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;52
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;53
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;54
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;tokenLimiter&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;lock&lt;/span&gt;           &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;sync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Mutex&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;lastReqAt&lt;/span&gt;      &lt;span class=&#34;kt&#34;&gt;int64&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// å•ä½ï¼šç§’
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;availableToken&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int64&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// å¯ç”¨çš„ä»¤ç‰Œæ•°é‡
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;maxTokenLimit&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;int64&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// æœ€å¤§ä»¤ç‰Œæ•°é‡
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;rate&lt;/span&gt;           &lt;span class=&#34;kt&#34;&gt;int64&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// æ¯æ—¶é—´å•ä½å†…tokençš„åŠ å…¥é€Ÿç‡
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;NewTokenLimiter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rate&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int64&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;maxTokenLimit&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int64&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;tokenLimiter&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;tokenLimiter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;           &lt;span class=&#34;nb&#34;&gt;new&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;sync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Mutex&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;lastReqAt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;      &lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Now&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Unix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;maxTokenLimit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;  &lt;span class=&#34;nx&#34;&gt;maxTokenLimit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;availableToken&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;maxTokenLimit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;rate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;           &lt;span class=&#34;nx&#34;&gt;rate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;t&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;tokenLimiter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;IsPass&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;defer&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Unlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;now&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Now&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Unix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
	&lt;span class=&#34;c1&#34;&gt;// è®¡ç®—æ—¶é—´å·®å†…å¯é€šè¿‡çš„è®¡æ•°é‡
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;diffInterval&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;now&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lastReqAt&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;diffCount&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;diffInterval&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rate&lt;/span&gt;
	&lt;span class=&#34;c1&#34;&gt;// æŠŠå¯é€šè¿‡çš„é‡åŠ å…¥ä»¤ç‰Œæ¡¶é‡Œ
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;availableToken&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;diffCount&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;availableToken&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;maxTokenLimit&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;availableToken&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;maxTokenLimit&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lastReqAt&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;now&lt;/span&gt;
	&lt;span class=&#34;c1&#34;&gt;// åˆ¤æ–­æ˜¯å¦æœ‰ä»¤ç‰Œå¯å–
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;availableToken&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;availableToken&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;--&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;// æµ‹è¯•
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    	&lt;span class=&#34;c1&#34;&gt;// å•ä½æ—¶é—´å†…æ¼å‡ºé€Ÿåº¦æ˜¯2ï¼Œæ¡¶çš„å®¹é‡æ˜¯5
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;f1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;NewTokenLimiter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;20&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;go&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;index&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;f1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;IsPass&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
				&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Sprintf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;pass: %d&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;index&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
				&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Sprintf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;no pass: %d&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;index&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Sleep&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;100&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Second&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h1 id=&#34;å®¹é”™&#34;&gt;å®¹é”™&lt;/h1&gt;
&lt;p&gt;ä¸€æ—¦å‘ç°ä¸Šæ¸¸æœåŠ¡è°ƒç”¨å¤±è´¥ï¼Œä¸ºäº†è¿›ä¸€æ­¥å‡å°‘é”™è¯¯çš„å½±å“ï¼Œå¯ä»¥è®¾ç½®å®¹é”™ç­–ç•¥&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;FailFast å¿«é€Ÿå¤±è´¥ï¼šå½“æ¶ˆè´¹è€…è°ƒç”¨è¿œç¨‹æœåŠ¡å¤±è´¥æ—¶ï¼Œç«‹å³æŠ¥é”™ï¼Œæ¶ˆè´¹è€…åªå‘èµ·ä¸€æ¬¡è°ƒç”¨è¯·æ±‚ã€‚&lt;/li&gt;
&lt;li&gt;FailOver å¤±è´¥è‡ªåŠ¨åˆ‡æ¢ï¼šå½“æ¶ˆè´¹è€…è°ƒç”¨è¿œç¨‹æœåŠ¡å¤±è´¥æ—¶ï¼Œé‡æ–°å°è¯•è°ƒç”¨æœåŠ¡ï¼Œé‡è¯•çš„æ¬¡æ•°ä¸€èˆ¬éœ€è¦æŒ‡å®šï¼Œé˜²æ­¢æ— é™æ¬¡é‡è¯•ã€‚&lt;/li&gt;
&lt;li&gt;FailSafe å¤±è´¥å®‰å…¨ï¼šå½“æ¶ˆè´¹è€…è°ƒç”¨è¿œç¨‹æœåŠ¡å¤±è´¥æ—¶ï¼Œç›´æ¥å¿½ç•¥ï¼Œè¯·æ±‚æ­£å¸¸è¿”å›æŠ¥æˆåŠŸã€‚ä¸€èˆ¬ç”¨äºå¯æœ‰å¯æ— çš„æœåŠ¡è°ƒç”¨ã€‚&lt;/li&gt;
&lt;li&gt;FailBack å¤±è´¥è‡ªåŠ¨æ¢å¤ï¼šå½“æ¶ˆè´¹è€…è°ƒç”¨è¿œç¨‹æœåŠ¡å¤±è´¥æ—¶ï¼Œå®šæ—¶é‡å‘è¯·æ±‚ã€‚ä¸€èˆ¬ç”¨äºæ¶ˆæ¯é€šçŸ¥ã€‚&lt;/li&gt;
&lt;li&gt;Forking å¹¶è¡Œè°ƒç”¨ï¼šæ¶ˆè´¹è€…åŒæ—¶è°ƒç”¨å¤šä¸ªè¿œç¨‹æœåŠ¡ï¼Œä»»ä¸€æˆåŠŸå“åº”åˆ™è¿”å›ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;ç†”æ–­&#34;&gt;ç†”æ–­&lt;/h1&gt;
&lt;p&gt;ä½œç”¨ï¼šé˜²æ­¢ä¸‹æ¸¸æœåŠ¡ä¸æ–­åœ°å°è¯•å¯èƒ½è¶…æ—¶å’Œå¤±è´¥çš„æœåŠ¡ï¼Œèƒ½è¾¾åˆ°åº”ç”¨ç¨‹åºæ‰§è¡Œè€Œä¸å¿…ç­‰å¾…ä¸Šæ¸¸æœåŠ¡ä¿®æ­£é”™è¯¯ï¼›ä¸‹æ¸¸æœåŠ¡å¯ä»¥è‡ªæˆ‘è¯Šæ–­ä¸Šæ¸¸æœåŠ¡çš„é”™è¯¯æ˜¯å¦å·²ä¿®æ­£ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™ä¸æ”¾é‡ï¼Œå¦‚æœæœ‰ï¼Œåˆ™ä¼šæ…¢æ…¢å¢åŠ è¯·æ±‚ï¼Œå†æ¬¡å°è¯•è°ƒç”¨ã€‚&lt;/p&gt;
&lt;p&gt;ä¸Šæ¸¸æœåŠ¡æ˜¯æŒ‡é‚£äº›ä¸ä¾èµ–äºä»»ä½•å…¶ä»–æœåŠ¡çš„æœåŠ¡ï¼Œè€Œä¸‹æ¸¸æœåŠ¡ä¾èµ–äºä¸Šæ¸¸æœåŠ¡çš„æœåŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;ç†”æ–­ä¸€èˆ¬åˆ†ä¸ºä¸‰ç§çŠ¶æ€ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Closedå…³é—­ï¼šæœåŠ¡æ­£å¸¸æ—¶ï¼Œç†”æ–­å¤„äºå…³é—­çŠ¶æ€&lt;/li&gt;
&lt;li&gt;Openå¼€å¯ï¼šå½“æˆ‘ä»¬è®¾å®š10sçš„æ»‘åŠ¨çª—å£å†…é”™è¯¯ç‡è¾¾90%ï¼Œåˆ™ä»Closedå˜ä¸ºOpençŠ¶æ€&lt;/li&gt;
&lt;li&gt;HalfOpenåŠå¼€å¯ï¼šå†ç»è¿‡10sçš„çª—å£æœŸï¼Œæ­¤æ—¶ä»OpençŠ¶æ€è½¬ä¸ºHalfOpençŠ¶æ€ï¼ŒæŒ‰ç…§ &lt;code&gt;0.5 * (Now() - Start()) / Duration &lt;/code&gt;çš„å…¬å¼æ”¾é‡ï¼Œç›´åˆ°æˆåŠŸç‡å˜ä¸º90%ï¼Œè½¬ä¸ºClosedçŠ¶æ€ï¼Œå¦åˆ™è½¬ä¸ºOpençŠ¶æ€ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ»‘åŠ¨çª—å£çš„æ—¶é—´ä¸èƒ½è®¾ç½®å¤ªé•¿ï¼Œå¦åˆ™ç†”æ–­æ¢å¤æ—¶é—´ä¹Ÿä¼šå˜é•¿ï¼›é”™è¯¯ç»Ÿè®¡åªç»Ÿè®¡ç³»ç»Ÿå¼‚å¸¸ä¸é€šçŸ¥ä¸šåŠ¡å¼‚å¸¸ã€‚&lt;/p&gt;
&lt;h1 id=&#34;é™çº§&#34;&gt;é™çº§&lt;/h1&gt;
&lt;p&gt;ä½œç”¨ï¼šè§£å†³èµ„æºä¸è¶³å–è®¿é—®é‡å¢åŠ çš„çŸ›ç›¾ã€‚åœ¨æœ‰é™èµ„æºä¸‹ï¼Œæ”¾å¼ƒéƒ¨åˆ†æ— å…³ç´§è¦çš„æœåŠ¡ï¼Œä¿è¯ä¸»ä¸šåŠ¡æµç¨‹èƒ½å¹³ç¨³è¿è¡Œã€‚&lt;/p&gt;
&lt;p&gt;é™çº§ä¸€èˆ¬å¯ä»¥æ˜¯å°†éƒ¨åˆ†åŠŸèƒ½å…³é—­ï¼Œç®€åŒ–ï¼Œæˆ–è€…å°†å¼ºä¸€è‡´æ€§å˜æˆæœ€ç»ˆä¸€è‡´æ€§ã€‚&lt;/p&gt;
&lt;h1 id=&#34;è´Ÿè½½å‡è¡¡&#34;&gt;è´Ÿè½½å‡è¡¡&lt;/h1&gt;
&lt;h2 id=&#34;å¸¸ç”¨ç®—æ³•&#34;&gt;å¸¸ç”¨ç®—æ³•&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;éšæœºè½®è¯¢ï¼šåœ¨å¯ç”¨çš„æœåŠ¡ä¸­ï¼Œéšæœºé€‰æ‹©ä¸€ä¸ªè¿›è¡Œè°ƒç”¨ï¼Œå› ä¸ºæ¯ä¸ªéšæœºæ•°ç”Ÿæˆçš„æ¦‚ç‡æ˜¯ä¸€è‡´çš„ï¼Œæ‰€ä»¥å¯ä»¥ä¿è¯æ¯ä¸ªæœåŠ¡è®¿é—®æ¦‚ç‡ä¸€è‡´ï¼Œä¸€èˆ¬ç”¨åœ¨æœåŠ¡æ€§èƒ½å·®åˆ«ä¸å¤§ï¼Œè¯·æ±‚é‡è¿œè¶…æœåŠ¡èŠ‚ç‚¹æ•°é‡çš„åœºæ™¯ï¼Œä¿è¯å„ä¸ªæœåŠ¡è¢«è®¿é—®çš„æ¦‚ç‡ç›¸åŒ&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;é¡ºåºè½®è¯¢ï¼šæŒ‰è¯·æ±‚çš„é¡ºåºåˆ†é…ç»™å„ä¸ªæœåŠ¡å™¨ï¼Œé€‚ç”¨äºå„å°æœåŠ¡å™¨æ€§èƒ½ç›¸åŒï¼Œé€‚ç”¨äºæœåŠ¡å„ä¸ªå®ä¾‹æ€§èƒ½å¹³ç­‰ä¸”æ— çŠ¶æ€çš„åœºæ™¯ï¼Œå¦‚æœæ¯ä¸ªæœåŠ¡æ€§èƒ½ä¸ä¸€è‡´ï¼Œå¯ä»¥æ”¹æˆåŠ¨æ€åŠ æƒè½®è¯¢çš„æ–¹å¼&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åŠ æƒè½®è¯¢ï¼šç»™å„ä¸ªæœåŠ¡å™¨é™„ä¸Šæƒé‡å€¼ï¼ŒæŒ‰æƒé‡çš„é«˜ä½åˆ†é…è¯·æ±‚ï¼Œé€‚ç”¨äºå„å°æœåŠ¡å™¨æ€§èƒ½ä¸åŒï¼Œæ€§èƒ½é«˜çš„æœåŠ¡å™¨æƒé‡ä¹Ÿé«˜&lt;/p&gt;
&lt;p&gt;é™æ€åŠ æƒè½®è¯¢ï¼šæœåŠ¡å¯åŠ¨æ—¶å°±è®¾å®šå¥½æƒé‡å€¼ï¼ŒæŒ‰æƒé‡å€¼è¿›è¡Œè½®è¯¢&lt;/p&gt;
&lt;p&gt;åŠ¨æ€åŠ æƒè½®è¯¢ï¼šéœ€è¦å®¢æˆ·ç«¯ç»´æŠ¤æ¯ä¸ªæœåŠ¡æ€§èƒ½ç»Ÿè®¡å¿«ç…§ï¼Œå¹¶ä¸”æ¯ä¸ªä¸€æ®µæ—¶é—´æ›´æ–°è¿™ä¸ªå¿«ç…§ï¼Œæ ¹æ®è¿™ä¸ªå¿«ç…§åŠ¨æ€æ›´æ–°æƒé‡å€¼ï¼ŒæŒ‰æƒé‡å€¼è¿›è¡Œè½®è¯¢ï¼Œç¼ºç‚¹æ˜¯ç»Ÿè®¡è¿™äº›æ•°æ®çš„æ—¶å€™å­˜åœ¨ä¸€å®šçš„æ»åæ€§ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åŠ æƒéšæœºè½®è¯¢ï¼šéšæœº + äºŒåˆ†æŸ¥æ‰¾çš„æ–¹å¼è´Ÿè½½å‡è¡¡ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(logn)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æœ€å°‘é“¾æ¥ï¼šå°†è¯·æ±‚å‘é€ç»™å½“å‰æœ€å°‘è¿æ¥æ•°çš„æœåŠ¡å™¨ä¸Šï¼Œä¸€èˆ¬æ¥è¯´ï¼Œè¿æ¥æ•°å°‘ï¼Œè¯´æ˜æœåŠ¡ç©ºé—²ï¼Œå‘ç©ºé—²çš„æœåŠ¡å‘é€è¯·æ±‚ï¼Œè·å–æ›´å¿«å“åº”é€Ÿåº¦ï¼Œé€‚ç”¨äºæœåŠ¡èŠ‚ç‚¹æ€§èƒ½å·®å¼‚è¾ƒå¤§ï¼Œä¸å¥½è®¾ç½®æƒé‡å€¼çš„åœºæ™¯ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åŠ æƒæœ€å°‘é“¾æ¥ï¼šåœ¨æœ€å°‘è¿æ¥çš„åŸºç¡€ä¸Šï¼Œæ ¹æ®æœåŠ¡å™¨çš„æ€§èƒ½ä¸ºæ¯å°æœåŠ¡å™¨åˆ†é…æƒé‡ï¼Œå†æ ¹æ®æƒé‡è®¡ç®—å‡ºæ¯å°æœåŠ¡å™¨èƒ½å¤„ç†çš„è¿æ¥æ•°&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æœ€å°å“åº”æ—¶é—´è½®è¯¢ï¼šå®¢æˆ·ç«¯éœ€è¦è®°å½•æ¯ä¸ªæœåŠ¡æ‰€éœ€çš„è¯·æ±‚ï¼Œå¾—å‡ºå¹³å‡çš„å“åº”æ—¶é—´ï¼Œç„¶åæ ¹æ®å“åº”æ—¶é—´é€‰æ‹©æœ€å°å“åº”æ—¶é—´ï¼Œè¿›è¡Œè½®è¯¢ï¼Œç¼ºç‚¹æ˜¯ç»Ÿè®¡è¿™äº›æ•°æ®çš„æ—¶å€™å­˜åœ¨ä¸€å®šçš„æ»åæ€§ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;IPåœ°å€å“ˆå¸Œï¼šå“ˆå¸Œå‡åŒ€åˆ†å¸ƒ&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;äºŒæ¬¡éšæœºé€‰æ‹©è½®è¯¢ï¼šé€‚åˆåç«¯èŠ‚ç‚¹æƒé‡ä¸€è‡´çš„æƒ…å†µï¼Œé€šè¿‡ä¸¤æ¬¡éšæœºç®—æ³•ï¼Œè·å–åˆ°ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œå¯¹æ¯”èŠ‚ç‚¹CPUç­‰ä¿¡æ¯ï¼Œé€‰æ‹©æœ€ä¼˜èŠ‚ç‚¹ï¼›ï¼ˆæ¯”è¾ƒæµè¡Œï¼‰&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¼šè¯ä¿æŒï¼šæ ¹æ®å®¢æˆ·ç«¯IPæˆ–cookieè¿›è¡Œä¼šè¯ä¿æŒï¼ŒåŒä¸€ä¸ªå®¢æˆ·ç«¯æ¯æ¬¡é€‰å–åç«¯èŠ‚ç‚¹çš„IPä¿æŒä¸€è‡´ï¼Œé€‚ç”¨äºèŠ‚ç‚¹ä¿æŒç™»å½•éªŒè¯ä¼šè¯çš„åœºæ™¯ï¼Œæ¯”è¾ƒå°‘ç”¨ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;è´Ÿè½½ä¸å‡è¡¡å¯èƒ½çš„åŸå› &#34;&gt;è´Ÿè½½ä¸å‡è¡¡å¯èƒ½çš„åŸå› &lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;é•¿è¿æ¥ + å¤šè·¯å¤ç”¨&lt;/li&gt;
&lt;li&gt;å¼€å¯ä¼šè¯ä¿æŒ&lt;/li&gt;
&lt;li&gt;æœåŠ¡ç«¯å¥åº·æ£€æµ‹å¼‚å¸¸ï¼Œå¯¼è‡´å®¢æˆ·ç«¯è¯¯ä»¥ä¸ºæœåŠ¡ç«¯å‡ºç°é—®é¢˜ï¼Œæ²¡æœ‰å‡è¡¡è¯·æ±‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€šå¸¸çš„è§£å†³åŠæ³•æ˜¯æ ¹æ®æœåŠ¡ç«¯çŠ¶æ€åŠ æƒ&lt;/p&gt;
&lt;h2 id=&#34;æ¢æ´»&#34;&gt;æ¢æ´»&lt;/h2&gt;
&lt;p&gt;è´Ÿè½½å‡è¡¡å™¨ä¸Šé¢ä¸€èˆ¬ä¼šæŒ‚ä¸€ä¸ªæœåŠ¡çš„å¤šä¸ªå¤åˆ¶é›†ï¼Œè¿›è¡Œæµé‡çš„è´Ÿè½½å‡è¡¡ï¼Œå› æ­¤éœ€è¦æ£€æŸ¥è¿™å¤šä¸ªå¤åˆ¶é›†çš„å¥åº·æƒ…å†µï¼Œä¿è¯æµé‡èƒ½æ­£ç¡®è·¯ç”±åˆ°å¯ç”¨èŠ‚ç‚¹ä¸Šã€‚&lt;/p&gt;
&lt;h3 id=&#34;ä¸»åŠ¨å¥åº·æ£€æŸ¥&#34;&gt;ä¸»åŠ¨å¥åº·æ£€æŸ¥&lt;/h3&gt;
&lt;p&gt;è®¾å®šä¸€å®šæ—¶é—´é—´éš”å†…å¯¹å„ä¸ªå¤åˆ¶é›†æ‰§è¡Œpingæ“ä½œï¼Œä¸€èˆ¬åœ¨è·å–èŠ‚ç‚¹æ•°é‡è¿‡å°‘çš„åœºæ™¯ä¸‹æ‰è§¦å‘ï¼Œé¿å…é•¿æ—¶é—´é¢‘ç¹çš„pingæ“ä½œå¢åŠ èŠ‚ç‚¹è´Ÿæ‹…ã€‚&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚é€šè¿‡å½“å‰èŠ‚ç‚¹æ•°ä¸15åˆ†é’Ÿå‰çš„èŠ‚ç‚¹æ•°çš„æ¯”è¾ƒï¼Œå½“å°äº80%æ—¶è§¦å‘ä¸»åŠ¨å¥åº·æ£€æŸ¥ã€‚&lt;/p&gt;
&lt;h3 id=&#34;è¢«åŠ¨å¥åº·æ£€æŸ¥&#34;&gt;è¢«åŠ¨å¥åº·æ£€æŸ¥&lt;/h3&gt;
&lt;p&gt;é€šè¿‡æ£€æŸ¥èŠ‚ç‚¹çœŸå®æµé‡çš„å“åº”ç»“æœï¼Œåˆ¤æ–­èŠ‚ç‚¹æ˜¯å¦æ­£å¸¸&lt;/p&gt;
&lt;h1 id=&#34;æœåŠ¡æ³¨å†Œä¸å‘ç°&#34;&gt;æœåŠ¡æ³¨å†Œä¸å‘ç°&lt;/h1&gt;
&lt;h2 id=&#34;è°ƒç”¨æ¨¡å¼&#34;&gt;è°ƒç”¨æ¨¡å¼&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;è°ƒç”¨æ–¹å‘ç°æ¨¡å¼&lt;/p&gt;
&lt;p&gt;ç”±ä¸€ä¸ªæœåŠ¡å‘ç°ç³»ç»Ÿå’Œå…¶æä¾›å¾—SDKç»„æˆï¼ŒSDKç”±è°ƒç”¨æ–¹ä½¿ç”¨ï¼ŒåŒæ—¶SDKä¹Ÿå¯ä»¥æä¾›è´Ÿè½½å‡è¡¡å’Œæ•…éšœè½¬ç§»ç­‰åŠŸèƒ½ï¼›ä»£è¡¨ä¾‹å­ï¼šEureka&lt;/p&gt;
&lt;p&gt;å„ä¸ªè°ƒç”¨æ–¹åœ¨å¯åŠ¨æ—¶ä¼šå‘æœåŠ¡å‘ç°ç³»ç»Ÿæ³¨å†Œå…¶å®ä¾‹ä¿¡æ¯ï¼Œæ¯”å¦‚ipã€portã€serviceNameç­‰ï¼Œå¾…åˆ°è°ƒç”¨æ–¹éœ€è¦è°ƒç”¨å…¶ä»–æœåŠ¡æ—¶ï¼Œä¾¿æ ¹æ®è¢«è°ƒç”¨æ–¹æœåŠ¡çš„åç§°å»æœåŠ¡å‘ç°æœåŠ¡æŸ¥è¯¢å¯¹åº”çš„ipå’Œportï¼Œå‘èµ·è¯·æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ç§æ–¹å¼æœ‰ä¸ªç¼ºç‚¹ï¼Œå°±æ˜¯è°ƒç”¨æ–¹å¯èƒ½æœ‰å¤šä¸ªå®ä¾‹ï¼Œè€ŒSDKåªèƒ½é’ˆå¯¹ä¸€ä¸ªè°ƒç”¨æ–¹åšè´Ÿè½½å‡è¡¡ï¼Œå¤šå®ä¾‹ä¸‹ä»ç„¶æœ‰å¯èƒ½å¯¼è‡´è¯·æ±‚è´Ÿè½½ä¸å‡è¡¡ï¼›å¯èƒ½è¿˜éœ€è¦å‡†å¤‡å¤šç§è¯­è¨€çš„SDKã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æœåŠ¡ç«¯å‘ç°æ¨¡å¼&lt;/p&gt;
&lt;p&gt;ç”±ä¸€ä¸ªä¸“é—¨çš„load balanceræœåŠ¡ä¸æœåŠ¡å‘ç°ç³»ç»Ÿé…åˆï¼Œè¯¥load balanceræœåŠ¡ä¼šå®æ—¶è®¢é˜…æœåŠ¡å‘ç°ç³»ç»Ÿä¸­å„ä¸ªèŠ‚ç‚¹çš„ä¿¡æ¯ï¼Œèµ·åˆ°ä¸€ä¸ªåå‘ä»£ç†çš„ä½œç”¨ï¼Œå°†æ”¶åˆ°çš„è¯·æ±‚åˆ†å‘åˆ°å¯¹åº”çš„æœåŠ¡ã€‚ä»£è¡¨ä¾‹å­ï¼škube-proxyï¼Œåœ¨Kubernetesä¸­ï¼Œå„ä¸ªèŠ‚ç‚¹ä¸Šä¼šè¿è¡Œä¸€ä¸ªkube-proxyï¼Œkube-proxyä¼šå®æ—¶watch Serviceå’ŒEndpointå¯¹è±¡ï¼Œå½“å…¶é…ç½®å‘ç”Ÿå˜åŒ–åï¼Œä¼šåœ¨å„è‡ªçš„NodeèŠ‚ç‚¹è®¾ç½®ç›¸å…³çš„iptablesæˆ–IPVSè§„åˆ™ï¼Œä¾¿äºPodå†…çš„æœåŠ¡é€šè¿‡serviceçš„clusterIPï¼Œç»è¿‡iptablesæˆ–IPCSè®¾ç½®çš„è§„åˆ™è¿›è¡Œè·¯ç”±å’Œè½¬å‘ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ç§æ–¹å¼çš„å¥½å¤„æ˜¯è°ƒç”¨æ–¹æ— éœ€æ„ŸçŸ¥æœåŠ¡å‘ç°ç³»ç»Ÿï¼Œæ‰€æœ‰æœåŠ¡å‘ç°ç›¸å…³çš„åŠŸèƒ½éƒ½è¢«éš”ç¦»åœ¨load balancerå’ŒæœåŠ¡å‘ç°ç³»ç»Ÿä¹‹é—´ï¼Œä½†æ˜¯ä¼šå¤šä¸€å±‚è½¬å‘ï¼Œä¹Ÿå°±å¤šä¸€æ¬¡å»¶è¿Ÿï¼Œå¤šä¸€æ¬¡å‘ç”Ÿæ•…éšœçš„æœºä¼šã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;åŸºæœ¬åŠŸèƒ½&#34;&gt;åŸºæœ¬åŠŸèƒ½&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;æä¾›æœåŠ¡åœ°å€ä¸åŸŸåçš„æ˜ å°„æ³¨å†Œã€æŸ¥æ‰¾å’Œæ›´æ–°&lt;/p&gt;
&lt;p&gt;è®¢é˜…æœºåˆ¶æœ‰ä¸‰ç§ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æœåŠ¡å‘ç°ç³»ç»Ÿpushæ¨é€ï¼Œå¯ä»¥åŸºäºsocketé•¿è¿æ¥æ¨é€ï¼Œæ¯”å¦‚Zookeeperï¼›åŸºäºHTTPè¿æ¥çš„Long Pollingï¼Œå°†å„ä¸ªæœåŠ¡çš„æ³¨å†Œä¿¡æ¯æ¨é€ç»™å„ä¸ªèŠ‚ç‚¹ï¼Œä½†æ˜¯è¿™ç§é•¿è¿æ¥çš„æ–¹å¼ä¼šå­˜åœ¨æ¶ˆæ¯ä¸¢å¤±é—®é¢˜ã€‚&lt;/li&gt;
&lt;li&gt;è°ƒç”¨æ–¹SDKå®šæ—¶è½®è¯¢ï¼Œå‘æœåŠ¡å‘ç°ç³»ç»Ÿæ‹‰å–å„ä¸ªèŠ‚ç‚¹çš„æ³¨å†Œä¿¡æ¯ï¼Œä½†å¯èƒ½å­˜åœ¨å»¶è¿Ÿé—®é¢˜&lt;/li&gt;
&lt;li&gt;ä»¥ä¸Šä¸¤ç§æ–¹å¼ç›¸ç»“åˆï¼Œæ¯”å¦‚Consulï¼Œè°ƒç”¨æ–¹å’ŒæœåŠ¡å‘ç°ç³»ç»Ÿé—´ä¼šå»ºç«‹ä¸€ä¸ªæœ€é•¿30sçš„HTTPé•¿è¿æ¥ï¼Œå¦‚æœå‘ç”Ÿå˜æ›´ï¼Œè°ƒç”¨æ–¹å°±ä¼šç«‹å³æ”¶åˆ°æ¨é€ï¼Œå¦‚æœè¶…è¿‡30sï¼Œè°ƒç”¨æ–¹ä¼šç«‹å³å»ºç«‹æ–°è¿æ¥ï¼Œå¼€å§‹æ–°ä¸€è½®è®¢é˜…ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æä¾›å¤šç§è´Ÿè½½å‡è¡¡æ–¹æ¡ˆ&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¥åº·æ£€æŸ¥ï¼Œæ¯”å¦‚å¿ƒè·³æ£€æµ‹&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æœåŠ¡ä¸»åŠ¨æ¢æ´»&lt;/strong&gt;ï¼šæœåŠ¡æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒåï¼Œå®šæ—¶å‘é€ç»­ç§Ÿè¯·æ±‚åˆ°æ³¨å†Œä¸­å¿ƒï¼Œè¡¨æ˜è‡ªå·±å­˜æ´»&lt;/p&gt;
&lt;p&gt;ä¼˜ç‚¹ï¼šè¯¥æ–¹æ¡ˆå¯æœ€å¤§ç¨‹åº¦&lt;strong&gt;é¿å…IPé‡ç”¨&lt;/strong&gt;å¯¼è‡´çš„èŠ‚ç‚¹åœ¨æ—§æœåŠ¡ä¾ç„¶å­˜æ´»çš„é—®é¢˜(æ¯”å¦‚k8sç¯å¢ƒ)&lt;/p&gt;
&lt;p&gt;ç¼ºç‚¹ï¼šé€ æˆæ³¨å†Œä¸­å¿ƒå†™æ“ä½œå˜å¤šï¼Œç‰¹åˆ«æ˜¯åœ¨å¼ºä¸€è‡´æ€§çš„æ³¨å†Œä¸­å¿ƒä¸Šï¼Œé¢‘ç¹çš„èŠ‚ç‚¹å˜æ›´ä¼šå¯¼è‡´äº§ç”Ÿå¤§é‡çš„é€šçŸ¥äº‹ä»¶ï¼Œåœ¨åŒæ­¥åˆ°å¤šä¸ªæ³¨å†Œä¸­å¿ƒå¤åˆ¶é›†æ—¶æ€§èƒ½ä¸ä½³ï¼›å¦å¤–ï¼Œä»ç„¶å¯èƒ½å‘ç”ŸæœåŠ¡è™½æ— æ³•å¯¹å¤–æä¾›æœåŠ¡äº†ï¼Œä½†ä»ç„¶å¯ä»¥å‘é€ç»­ç§Ÿè¯·æ±‚ï¼›é¢å¯¹ä¸åŒçš„å®¢æˆ·ç«¯éœ€è¦æä¾›ä¸åŒè¯­è¨€çš„SDK&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ³¨å†Œä¸­å¿ƒä¸»åŠ¨æ¢æ´»&lt;/strong&gt;ï¼šæœåŠ¡æä¾›å¥åº·æ£€æŸ¥æ¥å£ï¼Œæ¯”å¦‚/pingï¼Œæ³¨å†Œä¸­å¿ƒå®šæ—¶è®¿é—®éªŒè¯èŠ‚ç‚¹å­˜æ´»ï¼›k8sçš„Podæ¢é’ˆæœºåˆ¶&lt;/p&gt;
&lt;p&gt;ä¼˜ç‚¹ï¼šä¸€å®šç¨‹åº¦ä¸Šè§£å†³æœåŠ¡ä¸»åŠ¨æ¢æ´»ä¸èƒ½è¯´æ˜æœåŠ¡å¥åº·çš„é—®é¢˜&lt;/p&gt;
&lt;p&gt;ç¼ºç‚¹ï¼šIPé‡ç”¨é—®é¢˜ï¼Œæ¯”å¦‚Aã€Bä¸¤ä¸ªæœåŠ¡éƒ½æœ‰ç›¸åŒçš„ç«¯å£å’Œ/pingæ¥å£åšå¥åº·æ£€æŸ¥ï¼Œä½†æ˜¯å½“å‘ç”ŸæœåŠ¡æ›¿æ¢æ—¶ï¼Œæ— æ³•åŒºåˆ†æ˜¯å“ªä¸ªæœåŠ¡ï¼Œé™¤éåŠ ä¸Šåç§°æ£€æŸ¥&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æœåŠ¡&lt;strong&gt;å¤–æŒ‚ä¸€ä¸ªè´Ÿè½½å‡è¡¡å™¨&lt;/strong&gt;å®ç°æœåŠ¡æ¢æ´»ã€ä¸æ³¨å†Œä¸­å¿ƒçš„é€šä¿¡&lt;/p&gt;
&lt;p&gt;ä¼˜ç‚¹ï¼šæ³¨å†Œä¸­å¿ƒå’ŒæœåŠ¡å‡ä¸éœ€è¦ä¸»åŠ¨æ¢æ´»ï¼Œå‡äº¤ç”±è´Ÿè½½å‡è¡¡å™¨å®ç°&lt;/p&gt;
&lt;p&gt;ç¼ºç‚¹ï¼šéœ€è¦å¤–æŒ‚çš„è´Ÿè½½å‡è¡¡å™¨ï¼Œå¢åŠ æˆæœ¬&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ³¨å†Œä¸­å¿ƒéœ€è¦ä¿è¯CPæˆ–è€…APï¼Œä¸€èˆ¬æ¥è¯´ï¼Œæ³¨å†Œä¸­å¿ƒå¯¹ä¸€è‡´æ€§Cçš„è¦æ±‚ä¸æ˜¯å¾ˆé«˜ï¼Œå› ä¸ºèŠ‚ç‚¹çš„æ³¨å†Œå’Œåæ³¨å†Œåé€šçŸ¥åˆ°å®¢æˆ·ç«¯ä¹Ÿéœ€è¦æ—¶é—´ï¼›å¯¹å¯ç”¨æ€§çš„ä¼˜å…ˆçº§è¾ƒé«˜ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å°†ä¸Šè¿°åŠŸèƒ½åŒ…è£…æˆSDKï¼Œç®€åŒ–ä½¿ç”¨&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;å¯èƒ½é‡åˆ°çš„é—®é¢˜&#34;&gt;å¯èƒ½é‡åˆ°çš„é—®é¢˜&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;æ³¨å†Œä¸­å¿ƒ&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;æ³¨å†Œä¸­å¿ƒæŒ‚æ‰æ—¶ï¼Œæ­¤æ—¶å¯ä»¥æŒä¹…åŒ–ä¹‹å‰æ³¨å†Œçš„ProviderèŠ‚ç‚¹ä¿¡æ¯ï¼Œå¹¶åœ¨é‡å¯åè¿›å…¥ä¿æŠ¤æ¨¡å¼ä¸€æ®µæ—¶é—´ï¼Œåœ¨æ­¤æœŸé—´å…ˆä¸å‰”é™¤ä¸å¥åº·çš„ProviderèŠ‚ç‚¹(å› ä¸ºå®•æœºæœŸé—´Providerå¿ƒè·³æ— æ³•ä¸ŠæŠ¥)ï¼Œå¦åˆ™å¯èƒ½å¯¼è‡´åœ¨ä¸€ä¸ªTTLå†…å¤§é‡çš„ProviderèŠ‚ç‚¹å¤±æ•ˆï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;éœ€è¦ç½‘ç»œé—ªæ–­ä¿æŠ¤ï¼Œå½“ç›‘æµ‹åˆ°å¤§é¢ç§¯Providerå¿ƒè·³æ²¡æœ‰ä¸ŠæŠ¥ï¼Œåˆ™è‡ªåŠ¨è¿›å…¥ä¿æŠ¤æ¨¡å¼ï¼Œè¯¥æ¨¡å¼ä¸‹ä¸ä¼šå‰”é™¤å› å¿ƒè·³ä¸ŠæŠ¥å¤±è´¥çš„Providerï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ³¨å†Œä¸­å¿ƒæ•…éšœæ—¶ï¼ŒæœåŠ¡æ³¨å†ŒåŠŸèƒ½å¤±æ•ˆï¼ŒæœåŠ¡ä¹Ÿæ— æ³•æ‰§è¡Œæ‰©å®¹æ“ä½œï¼Œå¯ä»¥åœ¨æœåŠ¡å†…ç¼“å­˜æœåŠ¡æ³¨å†Œè¡¨ï¼Œä¿è¯æœåŠ¡å¯é€šä¿¡ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;è°ƒç”¨æ–¹&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å½“è°ƒç”¨æ–¹è®¿é—®åˆ°æŸä¸ªæœåŠ¡å‘ç°ç³»ç»Ÿä¸å¯ç”¨æ—¶ï¼Œå¯ä»¥ç«‹å³åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªèŠ‚ç‚¹å°è¯•ï¼›&lt;/li&gt;
&lt;li&gt;è°ƒç”¨æ–¹ä¼˜å…ˆä½¿ç”¨ç¼“å­˜çš„æœåŠ¡æ³¨å†Œè¡¨ï¼Œå½“æ¥æ”¶åˆ°çš„æœåŠ¡æ³¨å†Œè¡¨çš„èŠ‚ç‚¹è¿‡å°‘æ—¶ï¼Œæ”¾å¼ƒä½¿ç”¨ï¼›&lt;/li&gt;
&lt;li&gt;å¦‚æœè°ƒç”¨æ–¹é‡å¯äº†ï¼Œå†…å­˜ä¸­çš„æ•°æ®ä¸å­˜åœ¨ï¼Œå¯ä»¥èµ°æœ¬åœ°é…ç½®é™çº§ï¼›&lt;/li&gt;
&lt;li&gt;é€šè¿‡åœ¨load balancerä¸­åŠ å…¥è¢«åŠ¨å¥åº·æ£€æŸ¥å’Œä¸»åŠ¨å¥åº·æ£€æŸ¥æ¥å‰”é™¤æœåŠ¡æ³¨å†Œè¡¨ä¸­å¤±æ•ˆçš„èŠ‚ç‚¹ï¼Œä¿è¯æœåŠ¡æ³¨å†Œè¡¨çš„å¯ç”¨æ€§&lt;/li&gt;
&lt;li&gt;å‚è€ƒService Meshçš„Envoyè®¾è®¡ï¼Œä¸å®Œå…¨ä¿¡ä»»æ³¨å†Œä¸­å¿ƒæ¨é€è¿‡æ¥çš„æœåŠ¡æ³¨å†Œè¡¨ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;å‘ç°çŠ¶æ€&lt;/th&gt;
&lt;th&gt;å¥åº·æ£€æŸ¥æˆåŠŸ&lt;/th&gt;
&lt;th&gt;å¥åº·æ£€æŸ¥å¤±è´¥&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;å‘ç°&lt;/td&gt;
&lt;td&gt;è·¯ç”±&lt;/td&gt;
&lt;td&gt;ä¸è·¯ç”±&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æœªå‘ç°&lt;/td&gt;
&lt;td&gt;è·¯ç”±&lt;/td&gt;
&lt;td&gt;ä¸è·¯ç”±ã€å‰”é™¤å¤±è´¥èŠ‚ç‚¹&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;ul&gt;
&lt;li&gt;é¢å¯¹èŠ‚ç‚¹å’ŒæœåŠ¡é¢‘ç¹å˜æ›´ï¼Œå¯¼è‡´å¹¿æ’­é£æš´çš„åœºæ™¯ï¼Œå¯ä»¥é€šè¿‡åˆå¹¶è®¾å®šæ—¶é—´å†…äº§ç”Ÿçš„æ¶ˆæ¯åå†è¿›è¡Œæ¨é€ï¼Œç›®çš„æ˜¯ä¸ºäº†å‡å°‘å¹¿æ’­æ¬¡æ•°ï¼Œä½†æ˜¯è¿™æ ·ä¼šå½±å“æ¶ˆæ¯çš„æ—¶æ•ˆæ€§ï¼Œè¦æ³¨æ„è®¾å®šçš„æ—¶é—´ä¸å®œè¿‡é•¿ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;å¸¸è§çš„æ³¨å†Œä¸­å¿ƒåŒºåˆ«&#34;&gt;å¸¸è§çš„æ³¨å†Œä¸­å¿ƒåŒºåˆ«&lt;/h2&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç‰¹å¾&lt;/th&gt;
&lt;th&gt;Nacos&lt;/th&gt;
&lt;th&gt;Eureka&lt;/th&gt;
&lt;th&gt;Zookeeper&lt;/th&gt;
&lt;th&gt;Consul&lt;/th&gt;
&lt;th&gt;ETCD&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;ä¸€è‡´æ€§åè®®&lt;/td&gt;
&lt;td&gt;APæˆ–CP&lt;/td&gt;
&lt;td&gt;AP&lt;/td&gt;
&lt;td&gt;CP&lt;/td&gt;
&lt;td&gt;CP&lt;/td&gt;
&lt;td&gt;CP&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å¥åº·æ£€æŸ¥&lt;/td&gt;
&lt;td&gt;TCPã€HTTPã€MySQLã€Client Beat&lt;/td&gt;
&lt;td&gt;TTL&lt;/td&gt;
&lt;td&gt;Keep Alive&lt;/td&gt;
&lt;td&gt;TCPã€HTTPã€gRPCã€Cmd&lt;/td&gt;
&lt;td&gt;TTL&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ç½‘ç»œå¼‚å¸¸ä¿æŠ¤&lt;/td&gt;
&lt;td&gt;æ”¯æŒ&lt;/td&gt;
&lt;td&gt;æ”¯æŒ&lt;/td&gt;
&lt;td&gt;ä¸æ”¯æŒ&lt;/td&gt;
&lt;td&gt;æ”¯æŒ&lt;/td&gt;
&lt;td&gt;ä¸æ”¯æŒ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;é›ªå´©ä¿æŠ¤&lt;/td&gt;
&lt;td&gt;æ”¯æŒ&lt;/td&gt;
&lt;td&gt;æ”¯æŒ&lt;/td&gt;
&lt;td&gt;ä¸æ”¯æŒ&lt;/td&gt;
&lt;td&gt;ä¸æ”¯æŒ&lt;/td&gt;
&lt;td&gt;ä¸æ”¯æŒ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;è‡ªåŠ¨æ³¨é”€å®ä¾‹&lt;/td&gt;
&lt;td&gt;æ”¯æŒ&lt;/td&gt;
&lt;td&gt;æ”¯æŒ&lt;/td&gt;
&lt;td&gt;æ”¯æŒ&lt;/td&gt;
&lt;td&gt;ä¸æ”¯æŒ&lt;/td&gt;
&lt;td&gt;æ”¯æŒ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;è®¿é—®åè®®&lt;/td&gt;
&lt;td&gt;HTTPã€DNS&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;td&gt;TCP&lt;/td&gt;
&lt;td&gt;HTTPã€DNS&lt;/td&gt;
&lt;td&gt;HTTP&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;è·¨æ³¨å†Œä¸­å¿ƒåŒæ­¥&lt;/td&gt;
&lt;td&gt;æ”¯æŒ&lt;/td&gt;
&lt;td&gt;ä¸æ”¯æŒ&lt;/td&gt;
&lt;td&gt;ä¸æ”¯æŒ&lt;/td&gt;
&lt;td&gt;æ”¯æŒ&lt;/td&gt;
&lt;td&gt;ä¸æ”¯æŒ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;K8sé›†æˆ&lt;/td&gt;
&lt;td&gt;æ”¯æŒ&lt;/td&gt;
&lt;td&gt;ä¸æ”¯æŒ&lt;/td&gt;
&lt;td&gt;ä¸æ”¯æŒ&lt;/td&gt;
&lt;td&gt;æ”¯æŒ&lt;/td&gt;
&lt;td&gt;æ”¯æŒ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;è¯­è¨€å®ç°&lt;/td&gt;
&lt;td&gt;Java&lt;/td&gt;
&lt;td&gt;Java&lt;/td&gt;
&lt;td&gt;Java&lt;/td&gt;
&lt;td&gt;GO&lt;/td&gt;
&lt;td&gt;GO&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;è¿™é‡Œå†è¯´ä¸‹K8sæä¾›çš„é»˜è®¤æœåŠ¡å‘ç°ï¼ˆ1.12åé»˜è®¤ä½¿ç”¨coreDNSï¼‰ï¼Œé€šè¿‡ä¸ºPodæŒ‚ä¸€ä¸ª Service æˆ–è€… Pod å®šä¹‰äº†hostname + subdomainï¼ŒCoreDNSä¹Ÿä¼šä¸ºå…¶ç”ŸæˆPodçš„ DNS Aè®°å½•ï¼Œç„¶å CoreDNS ä¼šæŠŠ Service æˆ– Pod äº§ç”Ÿçš„DNSè®°å½•å†™å…¥ CoreDNS çš„ cache æˆ–è€… ETCD ä¸­ï¼ŒåŒæ—¶åœ¨Podçš„&lt;code&gt;/etc/resolv.conf&lt;/code&gt;æ–‡ä»¶ä¸­æ·»åŠ CoreDNSæœåŠ¡çš„è®¿é—®é…ç½®ï¼ŒPodå³å¯é€šè¿‡ service åç§°è¿›è¡Œè®¿é—®ã€‚&lt;/p&gt;
&lt;p&gt;CoreDNSä¼šç›‘å¬é›†ç¾¤å†…æ‰€æœ‰Service APIï¼Œå½“æœåŠ¡ä¸å¯ç”¨æ—¶ç§»é™¤è®°å½•ï¼Œåœ¨æ–°æœåŠ¡åˆ›å»ºæ—¶æ’å…¥æ–°è®°å½•ï¼Œè¿™äº›è®°å½•ä¼šå­˜å‚¨åœ¨CoreDNSçš„cacheæˆ–è€…ETCDä¸­ã€‚&lt;/p&gt;
&lt;p&gt;å‚è€ƒï¼šhttps://github.com/kubernetes/dns/blob/master/docs/specification.md&lt;/p&gt;
&lt;p&gt;å…·ä½“ä¾‹å­æŸ¥çœ‹Kubernetesé‚£ç¯‡æ–‡ç« ServiceæœåŠ¡å‘ç°éƒ¨åˆ†çš„å†…å®¹ã€‚&lt;/p&gt;
</description>
        </item>
        <item>
        <title>æ“ä½œç³»ç»Ÿ</title>
        <link>http://nixum.cc/p/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/</link>
        <pubDate>Mon, 09 Mar 2020 00:00:00 +0000</pubDate>
        
        <guid>http://nixum.cc/p/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/</guid>
        <description>&lt;p&gt;[TOC]&lt;/p&gt;
&lt;h1 id=&#34;å†…æ ¸&#34;&gt;å†…æ ¸&lt;/h1&gt;
&lt;h2 id=&#34;pcæœºå¯åŠ¨æµç¨‹&#34;&gt;PCæœºå¯åŠ¨æµç¨‹&lt;/h2&gt;
&lt;p&gt;ä»¥Ubuntu Linux + GRUBå¼•å¯¼ç¨‹åºä¸ºä¾‹ï¼š&lt;/p&gt;
&lt;p&gt;PCæœºåŠ ç”µåï¼ŒåŠ è½½BIOSå›ºä»¶ï¼Œ è§¦å‘PCæœºBIOSå›ºä»¶å‘é€æŒ‡ä»¤ æ£€æµ‹å’Œåˆå§‹åŒ–CPUã€å†…å­˜åŠä¸»æ¿å¹³å°ï¼ŒåŠ è½½å¼•å¯¼è®¾å¤‡(æ¯”å¦‚ç¡¬ç›˜)ä¸­çš„ç¬¬ä¸€ä¸ªæ‰‡åŒºæ•°æ®åˆ°&lt;a class=&#34;link&#34; href=&#34;http://www.ruanyifeng.com/blog/2015/09/0x7c00.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;0x7c00åœ°å€å¼€å§‹&lt;/a&gt;çš„å†…å­˜ç©ºé—´ï¼Œå†æ¥ç€è·³è½¬åˆ°0x7c00å¤„æ‰§è¡ŒæŒ‡ä»¤ï¼ŒåŠ è½½GRUBå¼•å¯¼ç¨‹åºï¼ŒåŠ è½½ç¡¬ç›˜åˆ†åŒºä¸­çš„OSæ–‡ä»¶ï¼Œå¯åŠ¨æ“ä½œç³»ç»Ÿã€‚&lt;/p&gt;
&lt;h2 id=&#34;å†…æ ¸ç»“æ„åˆ†ç±»&#34;&gt;å†…æ ¸ç»“æ„åˆ†ç±»&lt;/h2&gt;
&lt;p&gt;å†…æ ¸ï¼šè®¡ç®—æœºèµ„æºçš„ç®¡ç†è€…ã€‚è®¡ç®—èµ„æºåˆ†ä¸ºç¡¬ä»¶èµ„æºå’Œè½¯ä»¶èµ„æº&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ç¡¬ä»¶èµ„æºï¼šCPUã€å†…å­˜ã€ç¡¬ç›˜ã€ç½‘å¡ã€æ˜¾å¡ã€IOè®¾å¤‡ã€æ€»çº¿ï¼Œä»–ä»¬ä¹‹é—´é€šè¿‡æ€»çº¿è¿›è¡Œè”ç³»ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è½¯ä»¶èµ„æºï¼šå¯¹ä¸Šè¿°å„ç§ç¡¬ä»¶èµ„æºçš„ç®¡ç†ç¨‹åºã€è®¾å¤‡çš„é©±åŠ¨ç¨‹åº&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;å®å†…æ ¸ç»“æ„---ç±»ä¼¼å•ä½“æœåŠ¡&#34;&gt;å®å†…æ ¸ç»“æ„ - ç±»ä¼¼å•ä½“æœåŠ¡&lt;/h3&gt;
&lt;p&gt;å°†ä¸Šè¿°æ‰€æœ‰è½¯ä»¶èµ„æºè¿›è¡Œæ•´åˆï¼Œé“¾æ¥åœ¨ä¸€èµ·ï¼Œå½¢æˆä¸€ä¸ªå¤§çš„å¯æ‰§è¡Œç¨‹åºï¼Œæ§åˆ¶æ‰€æœ‰ç¡¬ä»¶èµ„æºã€‚è¿™ä¸ªå¤§ç¨‹åºä¼šåœ¨å¤„ç†å™¨çš„ç‰¹æƒæ¨¡å¼ä¸‹è¿è¡Œï¼Œå¯¹å¤–æä¾›ç³»ç»Ÿè°ƒç”¨å‡½æ•°ï¼Œä¾›å…¶ä»–ç¨‹åºã€è¿›ç¨‹è°ƒç”¨ã€‚&lt;/p&gt;
&lt;p&gt;å½“åº”ç”¨å±‚æœ‰ç¨‹åºè¦è°ƒç”¨è¿›è¡Œå†…å­˜åˆ†é…æ—¶ï¼Œå°±ä¼šè°ƒç”¨å®å†…æ ¸è¿›è¡Œå†…å­˜åˆ†é…&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;åº”ç”¨ç¨‹åºè°ƒç”¨å†…æ ¸å†…å­˜åˆ†é…APIå‡½æ•°&lt;/li&gt;
&lt;li&gt;å¤„ç†å™¨åˆ‡æ¢åˆ°ç‰¹æƒæ¨¡å¼ï¼Œå¼€å§‹è¿è¡Œå†…æ ¸ä»£ç &lt;/li&gt;
&lt;li&gt;å†…æ ¸çš„å†…å­˜ç®¡ç†ä»£ç æŒ‰ç…§ç‰¹å®šçš„ç®—æ³•ï¼Œåˆ†é…å†…å­˜&lt;/li&gt;
&lt;li&gt;å†…å­˜åˆ†é…å‡½æ•°æŠŠåˆ†é…çš„å†…å­˜å—çš„é¦–åœ°å€è¿”å›ç»™åº”ç”¨ç¨‹åº&lt;/li&gt;
&lt;li&gt;åº”ç”¨ç¨‹åºæ¥æ”¶åˆ°è¿”å›åï¼Œå¤„ç†å™¨å¼€å§‹è¿è¡Œç”¨æˆ·æ¨¡å¼ä¸‹çš„åº”ç”¨ç¨‹åºï¼Œåº”ç”¨ç¨‹åºä½¿ç”¨å¾—åˆ°çš„å†…å­˜é¦–åœ°å€ï¼Œå¼€å§‹ä½¿ç”¨è¿™å—å†…å­˜&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä¼˜ç‚¹ï¼šç”±äºæ‰€æœ‰ç¡¬ä»¶ç®¡ç†ç¨‹åºéƒ½æ•´åˆåœ¨ä¸€èµ·ï¼Œç›¸äº’è°ƒç”¨æ—¶æ€§èƒ½æé«˜&lt;/p&gt;
&lt;p&gt;ç¼ºç‚¹ï¼šæ‰€æœ‰ç¡¬ä»¶ç®¡ç†ç¨‹åºéƒ½æ•´åˆåœ¨ä¸€èµ·ï¼Œæ²¡æœ‰æ¨¡å—åŒ–ï¼Œæ‰©å±•æ€§å·®ï¼Œç§»æ¤æ€§å·®ï¼Œç‰µä¸€å‘è€ŒåŠ¨å…¨èº«ï¼Œæ¯æ¬¡ä¿®æ”¹éƒ½éœ€è¦é‡æ–°å®‰è£…ï¼Œå…¶ä¸­ä¸€ä¸ªæ¨¡å—æœ‰é—®é¢˜å°±ä¼šå½±å“å…¶ä»–æ¨¡å—ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Linuxå°±å±äºå®å†…æ ¸&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Linux çš„åŸºæœ¬æ€æƒ³æ˜¯ä¸€åˆ‡éƒ½æ˜¯æ–‡ä»¶ï¼šæ¯ä¸ªæ–‡ä»¶éƒ½æœ‰ç¡®å®šçš„ç”¨é€”ï¼ŒåŒ…æ‹¬ç”¨æˆ·æ•°æ®ã€å‘½ä»¤ã€é…ç½®å‚æ•°ã€ç¡¬ä»¶è®¾å¤‡ç­‰å¯¹äºæ“ä½œç³»ç»Ÿå†…æ ¸è€Œè¨€ï¼Œéƒ½è¢«è§†ä¸ºå„ç§ç±»å‹çš„æ–‡ä»¶ã€‚Linux æ”¯æŒå¤šç”¨æˆ·ï¼Œå„ä¸ªç”¨æˆ·å¯¹äºè‡ªå·±çš„æ–‡ä»¶æœ‰è‡ªå·±ç‰¹æ®Šçš„æƒåˆ©ï¼Œä¿è¯äº†å„ç”¨æˆ·ä¹‹é—´äº’ä¸å½±å“ã€‚å¤šä»»åŠ¡åˆ™æ˜¯ç°ä»£æ“ä½œç³»ç»Ÿæœ€é‡è¦çš„ä¸€ä¸ªç‰¹ç‚¹ï¼ŒLinux å¯ä»¥ä½¿å¤šä¸ªç¨‹åºåŒæ—¶å¹¶ç‹¬ç«‹åœ°è¿è¡Œã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/%e6%9e%81%e5%ae%a2%e6%97%b6%e9%97%b4-%e6%93%8d%e4%bd%9c%e7%b3%bb%e7%bb%9f45%e8%ae%b2-Linux.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/%e6%9e%81%e5%ae%a2%e6%97%b6%e9%97%b4-%e6%93%8d%e4%bd%9c%e7%b3%bb%e7%bb%9f45%e8%ae%b2-Linux.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;Linuxä½¿ç”¨å®å†…æ ¸æ¶æ„ï¼Œä¸»è¦åˆ†ä¸ºä¸Šè¿°äº”å¤§æ¨¡å—ï¼Œæ¨¡å—é—´çš„é€šä¿¡é€šè¿‡å‡½æ•°è°ƒç”¨ï¼Œå‡½æ•°é—´çš„è°ƒç”¨æ²¡æœ‰å±‚æ¬¡å…³ç³»ï¼Œæ‰€ä»¥å‡½æ•°çš„è°ƒç”¨è·¯å¾„çºµæ¨ªäº¤é”™ï¼Œå¦‚æœæœ‰å‡½æ•°å‡ºé—®é¢˜ï¼Œé‚£å°±ä¼šå½±å“åˆ°è°ƒç”¨å®ƒçš„æ¨¡å—ï¼Œå­˜åœ¨å®‰å…¨éšæ‚£ï¼Œä½†ä¼˜ç‚¹æ˜¯å­˜å†…æ ¸è°ƒç”¨ï¼Œæ€§èƒ½æé«˜&lt;/p&gt;
&lt;p&gt;Linuxé«˜æ¸…å…¨ç»“æ„å›¾ï¼šhttps://makelinux.github.io/kernel/map/&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;å¾®å†…æ ¸ç»“æ„---ç±»ä¼¼å¾®æœåŠ¡&#34;&gt;å¾®å†…æ ¸ç»“æ„ - ç±»ä¼¼å¾®æœåŠ¡&lt;/h3&gt;
&lt;p&gt;å†…æ ¸ä»…å¤„ç†è¿›ç¨‹è°ƒåº¦ã€ä¸­æ–­ã€å†…å­˜ç©ºé—´æ˜ å°„ã€è¿›ç¨‹é—´é€šä¿¡ç­‰ï¼Œæ§åˆ¶ç¡¬ä»¶èµ„æºçš„è½¯ä»¶èµ„æºï¼Œè½¬æˆä¸€ä¸ªä¸ªæœåŠ¡è¿›ç¨‹ï¼Œæ¯”å¦‚è¿›ç¨‹ç®¡ç†ã€å†…å­˜ç®¡ç†ã€è®¾å¤‡ç®¡ç†ã€æ–‡ä»¶ç®¡ç†ç­‰ï¼Œå’Œç”¨æˆ·è¿›ç¨‹ä¸€æ ·ï¼Œåªæ˜¯å®ƒä»¬æä¾›äº†å®å†…æ ¸çš„é‚£äº›åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;p&gt;å¾®å†…æ ¸å†…ï¼Œè¿›ç¨‹é—´é€šè¿‡æ¶ˆæ¯è¿›è¡Œé€šä¿¡ï¼Œåº”ç”¨ç¨‹åºæ¯æ¬¡è¦ç”³è¯·èµ„æºéƒ½éœ€è¦å‘é€æ¶ˆæ¯åˆ°å¾®å†…æ ¸ï¼Œå¾®å†…æ ¸å†æŠŠè¿™æ¡æ¶ˆæ¯è½¬å‘ç»™ç›¸å…³æœåŠ¡è¿›ç¨‹ï¼Œç›´åˆ°å®Œæˆè¿™æ¬¡è°ƒç”¨ã€‚&lt;/p&gt;
&lt;p&gt;å½“åº”ç”¨å±‚æœ‰ç¨‹åºè¦è°ƒç”¨è¿›è¡Œå†…å­˜åˆ†é…æ—¶&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;åº”ç”¨ç¨‹åºå‘é€å†…å­˜åˆ†é…çš„æ¶ˆæ¯ï¼ˆå‘é€æ¶ˆæ¯è¿™ä¸ªå‡½æ•°ç”±å¾®å†…æ ¸æä¾›ï¼‰&lt;/li&gt;
&lt;li&gt;å¤„ç†å™¨åˆ‡æ¢åˆ°ç‰¹æƒæ¨¡å¼ï¼Œæ‰§è¡Œå†…æ ¸ä»£ç &lt;/li&gt;
&lt;li&gt;å¾®å†…æ ¸è®©å½“å‰è¿›ç¨‹åœæ­¢è¿è¡Œï¼Œå¹¶æ ¹æ®æ¶ˆæ¯åŒ…ä¸­çš„æ•°æ®ï¼Œæ¨é€ç»™å¯¹åº”çš„æ¶ˆæ¯æ¥æ”¶è€…ï¼Œæ¯”å¦‚è¿™é‡Œæ˜¯å†…å­˜ç®¡ç†æœåŠ¡è¿›ç¨‹ã€‚&lt;/li&gt;
&lt;li&gt;å†…å­˜ç®¡ç†æœåŠ¡è¿›ç¨‹æ”¶åˆ°æ¶ˆæ¯ï¼Œåˆ†é…ä¸€å—å†…å­˜&lt;/li&gt;
&lt;li&gt;å†…å­˜ç®¡ç†æœåŠ¡è¿›ç¨‹ï¼Œå¤„ç†å®Œæˆåï¼Œé€šè¿‡æ¶ˆæ¯çš„å½¢å¼è¿”å›åˆ†é…å†…å­˜å—çš„åœ°å€ç»™å†…æ ¸ï¼Œç„¶åç»§ç»­ç­‰å¾…ä¸‹ä¸€æ¡æ¶ˆæ¯ã€‚&lt;/li&gt;
&lt;li&gt;å¾®å†…æ ¸æŠŠåŒ…å«å†…å­˜åœ°å€çš„æ¶ˆæ¯è¿”å›å‘é€ç»™å†…å­˜åˆ†é…æ¶ˆæ¯çš„åº”ç”¨ç¨‹åº&lt;/li&gt;
&lt;li&gt;å¤„ç†å™¨å¼€å§‹è¿è¡Œç”¨æˆ·æ¨¡å¼ä¸‹çš„åº”ç”¨ç¨‹åºï¼Œåº”ç”¨ç¨‹åºæ”¶åˆ°è¿™æ¡æ¶ˆæ¯ï¼Œå¾—åˆ°å†…å­˜é¦–åœ°å€ï¼Œå¼€å§‹ä½¿ç”¨è¿™å—å†…å­˜ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä¼˜ç‚¹ï¼šç³»ç»Ÿç»“æ„æ¸…æ™°ï¼Œç§»æ¤æ€§ã€ä¼¸ç¼©æ€§ã€æ‰©å±•æ€§å¼ºï¼Œå¾®å†…æ ¸ä»£ç å°‘ï¼Œå®¹æ˜“æ›¿æ¢ï¼Œå„ç§ç³»ç»ŸæœåŠ¡è¿›ç¨‹å¯éšæ—¶æ›¿æ¢&lt;/p&gt;
&lt;p&gt;ç¼ºç‚¹ï¼šè¿›ç¨‹é—´æ¶ˆæ¯ä¾èµ–å¾®å†…æ ¸è¿›è¡Œæ¶ˆæ¯ä¼ é€’ï¼Œä¼šé¢‘ç¹è¿›è¡ŒæœåŠ¡è¿›ç¨‹åˆ‡æ¢ï¼Œæ¨¡å¼åˆ‡æ¢ï¼Œå¯¼è‡´æ€§èƒ½è¾ƒå·®ã€‚&lt;/p&gt;
&lt;h3 id=&#34;åˆ†ç¦»ç¡¬ä»¶çš„ç›¸å…³æ€§&#34;&gt;åˆ†ç¦»ç¡¬ä»¶çš„ç›¸å…³æ€§&lt;/h3&gt;
&lt;p&gt;åˆ†ç¦»ç¡¬ä»¶çš„ç›¸å…³æ€§å…¶å®å°±æ˜¯å±è”½åº•å±‚ç¡¬ä»¶æ“ä½œç»†èŠ‚ï¼Œå½¢æˆä¸€ä¸ªç‹¬ç«‹çš„è½¯ä»¶æŠ½è±¡å±‚ï¼Œå¯¹å¤–æä¾›æ¥å£ï¼Œæ–¹ä¾¿åº”ç”¨å±‚æ¥å…¥ã€‚&lt;/p&gt;
&lt;p&gt;æ˜¯å†…æ ¸è®¾è®¡çš„ä¸€ç§æŒ‡å¯¼æ€æƒ³ï¼Œæ‰€ä»¥åœ¨è®¾è®¡æ“ä½œç³»ç»Ÿå†…æ ¸çš„æ—¶å€™ï¼Œå°±å¯ä»¥åˆ†ä¸º&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å†…æ ¸æ¥å£å±‚ï¼šå‘åº”ç”¨å±‚æä¾›ç³»ç»Ÿæ¥å£å‡½æ•°ï¼›&lt;/li&gt;
&lt;li&gt;å†…æ ¸åŠŸèƒ½å±‚ï¼šç³»ç»Ÿå‡½æ•°çš„ä¸»è¦å®ç°ï¼Œå®ç°è¿›ç¨‹ç®¡ç†ã€å†…å­˜ç®¡ç†ã€ä¸­æ–­ç®¡ç†ã€è®¾å¤‡ç®¡ç†ã€é©±åŠ¨ã€æ–‡ä»¶ç³»ç»Ÿç­‰ï¼›&lt;/li&gt;
&lt;li&gt;å†…æ ¸ç¡¬ä»¶å±‚ï¼šå¯¹ç¡¬ä»¶èµ„æºçš„æ“ä½œï¼Œæ¯”å¦‚åˆå§‹åŒ–CPUã€å†…å­˜ã€ä¸­æ–­æ§åˆ¶ã€å…¶ä»–IOè®¾å¤‡&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;æ··åˆå†…æ ¸&#34;&gt;æ··åˆå†…æ ¸&lt;/h3&gt;
&lt;p&gt;æ··åˆå†…æ ¸åœ¨å¾®å†…æ ¸çš„åŸºç¡€ä¸Šè¿›è¡Œæ”¹è¿›ï¼Œå±‚æ¬¡åˆ†æ˜ï¼ŒåŠ¨æ€åŠ è½½æ¨¡å—åˆ°å†…æ ¸ï¼Œå…¼å…·å®å†…æ ¸å’Œå¾®å†…æ ¸çš„ä¼˜ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;Windowså°±å±äºæ··åˆå†…æ ¸ã€‚&lt;/p&gt;
&lt;h1 id=&#34;cpu&#34;&gt;CPU&lt;/h1&gt;
&lt;p&gt;ä¸­æ–­ï¼šä¸­æ–­å³ä¸­æ­¢æ‰§è¡Œå½“å‰ç¨‹åºï¼Œè½¬è€Œè·³è½¬åˆ°å¦ä¸€ä¸ªç‰¹å®šçš„åœ°å€ä¸Šï¼Œå»è¿è¡Œç‰¹å®šçš„ä»£ç ï¼Œå“åº”å¤–éƒ¨äº‹ä»¶ã€‚&lt;/p&gt;
&lt;p&gt;ç¡¬ä»¶ä¸­æ–­ï¼šä¸­æ–­æ§åˆ¶å™¨ç»™CPUå‘é€äº†ä¸€ä¸ªç”µå­ä¿¡å·ï¼ŒCPUå¯¹è¿™ä¸ªä¿¡å·ä½œå‡ºåº”ç­”ï¼Œéšåä¸­æ–­æ§åˆ¶å™¨å°†ä¸­æ–­å·å‘ç»™CPUã€‚&lt;/p&gt;
&lt;p&gt;è½¯ä»¶ä¸­æ–­ï¼šCPUæ‰§è¡ŒINTæŒ‡ä»¤ï¼ŒæŒ‡ä»¤åå¸¦ä¸€ä¸ªå¸¸æ•°ï¼Œè¯¥å¸¸æ•°ä¸ºè½¯ä¸­æ–­å·ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä½å®½&#34;&gt;ä½å®½&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;32 ä½å’Œ 64 ä½ CPU æœ€ä¸»è¦åŒºåˆ«åœ¨äºä¸€æ¬¡èƒ½è®¡ç®—å¤šå°‘å­—èŠ‚æ•°æ®ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;32 ä½ CPU ä¸€æ¬¡å¯ä»¥è®¡ç®— 4 ä¸ªå­—èŠ‚ï¼›&lt;/li&gt;
&lt;li&gt;64 ä½ CPU ä¸€æ¬¡å¯ä»¥è®¡ç®— 8 ä¸ªå­—èŠ‚ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿™é‡Œçš„ 32 ä½å’Œ 64 ä½ï¼Œé€šå¸¸ç§°ä¸º CPU çš„ä½å®½ï¼Œä»£è¡¨çš„æ˜¯ CPU ä¸€æ¬¡å¯ä»¥è®¡ç®—ï¼ˆè¿ç®—ï¼‰çš„æ•°æ®é‡ã€‚&lt;/p&gt;
&lt;p&gt;ä¹‹æ‰€ä»¥ CPU è¦è¿™æ ·è®¾è®¡ï¼Œæ˜¯ä¸ºäº†èƒ½è®¡ç®—æ›´å¤§çš„æ•°å€¼ï¼Œå¦‚æœæ˜¯ 8 ä½çš„ CPUï¼Œé‚£ä¹ˆä¸€æ¬¡åªèƒ½è®¡ç®— 1 ä¸ªå­—èŠ‚ &lt;code&gt;0~255&lt;/code&gt; èŒƒå›´å†…çš„æ•°å€¼ï¼Œè¿™æ ·å°±æ— æ³•ä¸€æ¬¡å®Œæˆè®¡ç®— &lt;code&gt;10000 * 500&lt;/code&gt; ï¼Œäºæ˜¯ä¸ºäº†èƒ½ä¸€æ¬¡è®¡ç®—å¤§æ•°çš„è¿ç®—ï¼ŒCPU éœ€è¦æ”¯æŒå¤šä¸ª byte ä¸€èµ·è®¡ç®—ï¼Œæ‰€ä»¥ CPU ä½å®½è¶Šå¤§ï¼Œå¯ä»¥è®¡ç®—çš„æ•°å€¼å°±è¶Šå¤§ï¼Œæ¯”å¦‚è¯´ 32 ä½ CPU èƒ½è®¡ç®—çš„æœ€å¤§æ•´æ•°æ˜¯ &lt;code&gt;4294967295&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;CPU ä¸­çš„å¯„å­˜å™¨ä¸»è¦ä½œç”¨æ˜¯å­˜å‚¨è®¡ç®—æ—¶çš„æ•°æ®ï¼Œå†…å­˜ç¦» CPU å¤ªè¿œäº†ï¼Œè€Œå¯„å­˜å™¨å°±åœ¨ CPU é‡Œï¼Œè¿˜ç´§æŒ¨ç€æ§åˆ¶å•å…ƒå’Œé€»è¾‘è¿ç®—å•å…ƒï¼Œè‡ªç„¶è®¡ç®—æ—¶é€Ÿåº¦ä¼šå¾ˆå¿«ã€‚&lt;/p&gt;
&lt;p&gt;å¸¸è§çš„å¯„å­˜å™¨ç§ç±»ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;em&gt;é€šç”¨å¯„å­˜å™¨&lt;/em&gt;ï¼Œç”¨æ¥å­˜æ”¾éœ€è¦è¿›è¡Œè¿ç®—çš„æ•°æ®ï¼Œæ¯”å¦‚éœ€è¦è¿›è¡ŒåŠ å’Œè¿ç®—çš„ä¸¤ä¸ªæ•°æ®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;em&gt;ç¨‹åºè®¡æ•°å™¨&lt;/em&gt;ï¼Œç”¨æ¥å­˜å‚¨ CPU è¦æ‰§è¡Œä¸‹ä¸€æ¡æŒ‡ä»¤ã€Œæ‰€åœ¨çš„å†…å­˜åœ°å€ã€ï¼Œæ³¨æ„ä¸æ˜¯å­˜å‚¨äº†ä¸‹ä¸€æ¡è¦æ‰§è¡Œçš„æŒ‡ä»¤ï¼Œæ­¤æ—¶æŒ‡ä»¤è¿˜åœ¨å†…å­˜ä¸­ï¼Œç¨‹åºè®¡æ•°å™¨åªæ˜¯å­˜å‚¨äº†ä¸‹ä¸€æ¡æŒ‡ä»¤ã€Œçš„åœ°å€ã€ã€‚&lt;/li&gt;
&lt;li&gt;&lt;em&gt;æŒ‡ä»¤å¯„å­˜å™¨&lt;/em&gt;ï¼Œç”¨æ¥å­˜æ”¾å½“å‰æ­£åœ¨æ‰§è¡Œçš„æŒ‡ä»¤ï¼Œä¹Ÿå°±æ˜¯æŒ‡ä»¤æœ¬èº«ï¼ŒæŒ‡ä»¤è¢«æ‰§è¡Œå®Œæˆä¹‹å‰ï¼ŒæŒ‡ä»¤éƒ½å­˜å‚¨åœ¨è¿™é‡Œã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä¸€ä¸ªç¨‹åºæ‰§è¡Œçš„æ—¶å€™ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;CPU ä¼šæ ¹æ®ç¨‹åºè®¡æ•°å™¨é‡Œçš„å†…å­˜åœ°å€ï¼ˆå­˜çš„æ˜¯æŒ‡ä»¤çš„åœ°å€ï¼‰ï¼Œä»å†…å­˜é‡Œé¢æŠŠéœ€è¦æ‰§è¡Œçš„æŒ‡ä»¤è¯»å–åˆ°æŒ‡ä»¤å¯„å­˜å™¨é‡Œé¢ï¼ˆCPUé€šè¿‡æ§åˆ¶å•å…ƒæ“ä½œåœ°å€æ€»çº¿è·å–è¦è®¿é—®çš„å†…å­˜åœ°å€ï¼Œé€šè¿‡æ•°æ®æ€»çº¿ä¼ è¾“ï¼‰&lt;/li&gt;
&lt;li&gt;æ‰§è¡ŒæŒ‡ä»¤ï¼ˆåˆ†ææŒ‡ä»¤çš„ç±»å‹å’Œå‚æ•°ï¼Œè®¡ç®—å‹çš„æŒ‡ä»¤äº¤ç»™é€»è¾‘è¿ç®—å•å…ƒæ‰§è¡Œï¼Œå­˜å‚¨ç±»å‹çš„æŒ‡ä»¤äº¤ç»™æ§åˆ¶å•å…ƒæ‰§è¡Œï¼‰&lt;/li&gt;
&lt;li&gt;æ ¹æ®æŒ‡ä»¤é•¿åº¦è‡ªå¢ï¼ˆè‡ªå¢çš„æ­¥é•¿è·ŸCPUçš„ä½å®½æœ‰å…³ï¼Œ32ä½çš„CPUï¼ŒæŒ‡ä»¤æ˜¯4å­—èŠ‚ï¼Œè®¡æ•°å™¨çš„å€¼å°±è‡ªå¢4ï¼‰ï¼Œå¼€å§‹é¡ºåºè¯»å–ä¸‹ä¸€æ¡æŒ‡ä»¤ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;æ€»çº¿&#34;&gt;æ€»çº¿&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;æ€»çº¿æ˜¯ç”¨äº CPU å’Œå†…å­˜ä»¥åŠå…¶ä»–è®¾å¤‡ä¹‹é—´çš„é€šä¿¡ï¼Œæ€»çº¿å¯åˆ†ä¸º 3 ç§ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;em&gt;åœ°å€æ€»çº¿&lt;/em&gt;ï¼Œç”¨äºæŒ‡å®š CPU å°†è¦æ“ä½œçš„å†…å­˜åœ°å€ï¼›&lt;/li&gt;
&lt;li&gt;&lt;em&gt;æ§åˆ¶æ€»çº¿&lt;/em&gt;ï¼Œç”¨äºå‘é€å’Œæ¥æ”¶ä¿¡å·ï¼Œæ¯”å¦‚ä¸­æ–­ã€è®¾å¤‡å¤ä½ç­‰ä¿¡å·ï¼ŒCPU æ”¶åˆ°ä¿¡å·åè‡ªç„¶è¿›è¡Œå“åº”ï¼Œè¿™æ—¶ä¹Ÿéœ€è¦æ§åˆ¶æ€»çº¿ï¼›&lt;/li&gt;
&lt;li&gt;&lt;em&gt;æ•°æ®æ€»çº¿&lt;/em&gt;ï¼Œç”¨äºè¯»å†™å†…å­˜çš„æ•°æ®ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å½“ CPU è¦è¯»å†™å†…å­˜æ•°æ®çš„æ—¶å€™ï¼Œä¸€èˆ¬éœ€è¦é€šè¿‡ä¸‹é¢è¿™ä¸‰ä¸ªæ€»çº¿ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é¦–å…ˆè¦é€šè¿‡ã€Œåœ°å€æ€»çº¿ã€æ¥æŒ‡å®šå†…å­˜çš„åœ°å€ï¼›&lt;/li&gt;
&lt;li&gt;ç„¶åé€šè¿‡ã€Œæ§åˆ¶æ€»çº¿ã€æ§åˆ¶æ˜¯è¯»æˆ–å†™å‘½ä»¤ï¼›&lt;/li&gt;
&lt;li&gt;æœ€åé€šè¿‡ã€Œæ•°æ®æ€»çº¿ã€æ¥ä¼ è¾“æ•°æ®ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/CPU%e4%bb%8e%e5%86%85%e5%ad%98%e8%af%bb%e5%8f%96%e6%95%b0%e6%8d%ae.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/CPU%e4%bb%8e%e5%86%85%e5%ad%98%e8%af%bb%e5%8f%96%e6%95%b0%e6%8d%ae.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;h2 id=&#34;cpuä½å®½ä¸çº¿è·¯ä½å®½&#34;&gt;CPUä½å®½ä¸çº¿è·¯ä½å®½&lt;/h2&gt;
&lt;p&gt;çº¿è·¯é€šè¿‡é«˜ä½ç”µå‹ä¼ è¾“æ•°æ®ï¼Œä¸€ä½ä¸€ä½ä¸²è¡Œä¼ è¾“ï¼Œä¸‹ä¸€ä¸ªbitå¿…é¡»ç­‰å¾…ä¸Šä¸€ä¸ªbitä¼ è¾“å®Œæˆæ‰èƒ½è¿›è¡Œä¸‹ä¸€ä¸ªï¼Œæƒ³è¦ä¸€æ¬¡å¤šä¼ äº›æ•°æ®ï¼Œå°±è¦å¢åŠ çº¿è·¯ï¼Œå®ç°å¹¶è¡Œä¼ è¾“ã€‚&lt;/p&gt;
&lt;p&gt;CPUæƒ³è¦æ“ä½œå†…å­˜åœ°å€ï¼Œå°±éœ€è¦åœ°å€æ€»çº¿ï¼Œæ¯”å¦‚ï¼ŒCPUæƒ³æ“ä½œ4Gå¤§çš„å†…å­˜ï¼Œå°±éœ€è¦32æ¡åœ°å€æ€»çº¿ï¼Œå› ä¸º&lt;code&gt;2^32=4G&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€èˆ¬æ¥è¯´ï¼ŒCPUçš„ä½å®½è¦å¤§äºçº¿è·¯çš„ä½å®½ï¼Œæ“ä½œèµ·æ¥æ‰æ¯”è¾ƒæ–¹ä¾¿ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å¦‚æœç”¨ 32 ä½ CPU å»è®¡ç®—ä¸¤ä¸ª 64 ä½å¤§å°çš„æ•°å­—çš„å’Œï¼Œå°±éœ€è¦æŠŠè¿™ 2 ä¸ª 64 ä½çš„æ•°å­—åˆ†æˆ 2 ä¸ªä½ä½ 32 ä½æ•°å­—å’Œ 2 ä¸ªé«˜ä½ 32 ä½æ•°å­—æ¥è®¡ç®—ï¼Œå…ˆåŠ ä¸ªä¸¤ä¸ªä½ä½çš„ 32 ä½æ•°å­—ï¼Œç®—å‡ºè¿›ä½ï¼Œç„¶åå†è®¡ç®—ä¸¤ä¸ªé«˜ä½çš„ 32 ä½æ•°å­—çš„å’Œï¼Œæœ€åå†åŠ ä¸Šè¿›ä½ï¼Œå°±èƒ½ç®—å‡ºç»“æœäº†ï¼Œå¯ä»¥å‘ç° 32 ä½ CPU å¹¶ä¸èƒ½ä¸€æ¬¡æ€§è®¡ç®—å‡ºåŠ å’Œä¸¤ä¸ª 64 ä½æ•°å­—çš„ç»“æœã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äº 64 ä½ CPU å°±å¯ä»¥ä¸€æ¬¡æ€§ç®—å‡ºåŠ å’Œä¸¤ä¸ª 64 ä½æ•°å­—çš„ç»“æœï¼Œå› ä¸º 64 ä½ CPU å¯ä»¥ä¸€æ¬¡è¯»å…¥ 64 ä½çš„æ•°å­—ï¼Œå¹¶ä¸” 64 ä½ CPU å†…éƒ¨çš„é€»è¾‘è¿ç®—å•å…ƒä¹Ÿæ”¯æŒ 64 ä½æ•°å­—çš„è®¡ç®—ã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯å¹¶ä¸ä»£è¡¨ 64 ä½ CPU æ€§èƒ½æ¯” 32 ä½ CPU é«˜å¾ˆå¤šï¼Œå¾ˆå°‘åº”ç”¨éœ€è¦ç®—è¶…è¿‡ 32 ä½çš„æ•°å­—ï¼Œæ‰€ä»¥&lt;strong&gt;å¦‚æœè®¡ç®—çš„æ•°é¢ä¸è¶…è¿‡ 32 ä½æ•°å­—çš„æƒ…å†µä¸‹ï¼Œ32 ä½å’Œ 64 ä½ CPU ä¹‹é—´æ²¡ä»€ä¹ˆåŒºåˆ«çš„ï¼Œåªæœ‰å½“è®¡ç®—è¶…è¿‡ 32 ä½æ•°å­—çš„æƒ…å†µä¸‹ï¼Œ64 ä½çš„ä¼˜åŠ¿æ‰èƒ½ä½“ç°å‡ºæ¥&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å¦å¤–ï¼Œ32 ä½ CPU æœ€å¤§åªèƒ½æ“ä½œ 4GB å†…å­˜ï¼Œå°±ç®—ä½ è£…äº† 8 GB å†…å­˜æ¡ï¼Œä¹Ÿæ²¡ç”¨ã€‚è€Œ 64 ä½ CPU å¯»å€èŒƒå›´åˆ™å¾ˆå¤§ï¼Œç†è®ºæœ€å¤§çš„å¯»å€ç©ºé—´ä¸º &lt;code&gt;2^64&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;é€šå¸¸æ¥è¯´ 64 ä½ CPU çš„åœ°å€æ€»çº¿æ˜¯ 48 ä½ï¼Œè€Œ 32 ä½ CPU çš„åœ°å€æ€»çº¿æ˜¯ 32 ä½ï¼Œæ‰€ä»¥ 64 ä½ CPU å¯ä»¥&lt;strong&gt;å¯»å€æ›´å¤§çš„ç‰©ç†å†…å­˜ç©ºé—´&lt;/strong&gt;ã€‚å¦‚æœä¸€ä¸ª 32 ä½ CPU çš„åœ°å€æ€»çº¿æ˜¯ 32 ä½ï¼Œé‚£ä¹ˆè¯¥ CPU æœ€å¤§å¯»å€èƒ½åŠ›æ˜¯ 4Gï¼Œå³ä½¿ä½ åŠ äº† 8G å¤§å°çš„ç‰©ç†å†…å­˜ï¼Œä¹Ÿè¿˜æ˜¯åªèƒ½å¯»å€åˆ° 4G å¤§å°çš„åœ°å€ï¼Œè€Œå¦‚æœä¸€ä¸ª 64 ä½ CPU çš„åœ°å€æ€»çº¿æ˜¯ 48 ä½ï¼Œé‚£ä¹ˆè¯¥ CPU æœ€å¤§å¯»å€èƒ½åŠ›æ˜¯ &lt;code&gt;2^48&lt;/code&gt;ï¼Œè¿œè¶…äº 32 ä½ CPU æœ€å¤§å¯»å€èƒ½åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœ 32 ä½æŒ‡ä»¤åœ¨ 64 ä½æœºå™¨ä¸Šæ‰§è¡Œï¼Œéœ€è¦ä¸€å¥—å…¼å®¹æœºåˆ¶ï¼Œå°±å¯ä»¥åšåˆ°å…¼å®¹è¿è¡Œäº†ã€‚ä½†æ˜¯&lt;strong&gt;å¦‚æœ 64 ä½æŒ‡ä»¤åœ¨ 32 ä½æœºå™¨ä¸Šæ‰§è¡Œï¼Œå°±æ¯”è¾ƒå›°éš¾äº†ï¼Œå› ä¸º 32 ä½çš„å¯„å­˜å™¨å­˜ä¸ä¸‹ 64 ä½çš„æŒ‡ä»¤&lt;/strong&gt;ï¼›&lt;/p&gt;
&lt;p&gt;ç¡¬ä»¶çš„ 64 ä½å’Œ 32 ä½æŒ‡çš„æ˜¯ CPU çš„ä½å®½ï¼Œè½¯ä»¶çš„ 64 ä½å’Œ 32 ä½æŒ‡çš„æ˜¯æŒ‡ä»¤çš„ä½å®½ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;æ—¶é’Ÿå‘¨æœŸ&#34;&gt;æ—¶é’Ÿå‘¨æœŸ&lt;/h2&gt;
&lt;p&gt;ç¡¬ä»¶å‚æ•°ï¼Œæ¯”å¦‚2GHzçš„CPUï¼Œæ—¶é’Ÿé¢‘ç‡æ˜¯2Gï¼Œè¡¨ç¤º1ç§’å†…ä¼šäº§ç”Ÿ2Gæ¬¡æ•°çš„è„‰å†²ä¿¡å·ï¼Œæ¯ä¸€æ¬¡è„‰å†²ä¿¡å·é«˜ä½ç”µå¹³çš„è½¬æ¢å°±æ˜¯ä¸€ä¸ªå‘¨æœŸï¼Œç§°ä¸ºæ—¶é’Ÿå‘¨æœŸï¼Œæ—¶é’Ÿå‘¨æœŸæ—¶é—´å°±æ˜¯1/2Gï¼Œå³0.5nsã€‚&lt;code&gt;ç¨‹åºçš„CPUæ‰§è¡Œæ—¶é—´ = æŒ‡ä»¤æ•° x æ¯æ¡æŒ‡ä»¤çš„å¹³å‡æ—¶é’Ÿå‘¨æœŸæ•° x æ—¶é’Ÿå‘¨æœŸæ—¶é—´&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;åœ¨ä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸå†…ï¼ŒCPU ä»…èƒ½å®Œæˆä¸€ä¸ªæœ€åŸºæœ¬çš„åŠ¨ä½œï¼Œæ—¶é’Ÿé¢‘ç‡è¶Šé«˜ï¼Œæ—¶é’Ÿå‘¨æœŸå°±è¶ŠçŸ­ï¼Œå·¥ä½œé€Ÿåº¦ä¹Ÿå°±è¶Šå¿«ã€‚CPUåœ¨ä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸå†…ä¸ä¸€å®šèƒ½æ‰§è¡Œå®Œä¸€æ¡æŒ‡ä»¤ã€‚&lt;/p&gt;
&lt;h2 id=&#34;cpu-cache&#34;&gt;CPU Cache&lt;/h2&gt;
&lt;p&gt;ç¨‹åºå±€éƒ¨æ€§åŸç†ï¼šç¨‹åºä¸€æ—¦ç¼–è¯‘å®Œè£…è½½è¿›å†…å­˜ä¸­ï¼Œå®ƒçš„åœ°å€å°±ç¡®å®šäº†ï¼ŒCPUå¤§å¤šæ•°æ—¶é—´åœ¨æ‰§è¡Œç›¸åŒçš„æŒ‡ä»¤æˆ–è€…ç›¸é‚»çš„æŒ‡ä»¤ã€‚&lt;/p&gt;
&lt;p&gt;å†…å­˜ï¼Œä»é€»è¾‘ä¸Šçœ‹ï¼Œæ˜¯ä¸€ä¸ªå·¨å¤§çš„å­—èŠ‚æ•°ç»„ï¼Œå†…å­˜åœ°å€å°±æ˜¯è¿™ä¸ªæ•°ç»„çš„ä¸‹æ ‡ã€‚ç›¸æ¯”ä¸CPUï¼Œå†…å­˜çš„æ•°æ®é‡ååæ˜¯å¾ˆæ…¢çš„ï¼Œå½“CPUéœ€è¦å†…å­˜æ•°æ®æ—¶ï¼Œå†…å­˜ä¸€æ—¶é—´ç»™ä¸äº†ï¼ŒCPUå°±åªèƒ½ç­‰ï¼Œè®©æ€»çº¿æ’å…¥ç­‰å¾…æ—¶é’Ÿå‘¨æœŸï¼Œç›´åˆ°å†…å­˜å‡†å¤‡å¥½ã€‚å› æ­¤å†…å­˜æ‰æ˜¯å†³å®šç³»ç»Ÿæ•´ä½“æ€§èƒ½çš„å…³é”®ã€‚ä¸ºäº†å¼¥è¡¥CPUã€å†…å­˜ã€ç¡¬ç›˜çš„è¯»å†™é€Ÿåº¦å·®å¼‚ï¼Œä¸è®©CPUæ¯æ¬¡éƒ½è¦ç­‰ï¼Œå› æ­¤åˆ©ç”¨ç¨‹åºå±€éƒ¨æ€§åŸç†ï¼Œå¼•å…¥äº†Cacheï¼Œä¸€èˆ¬CPU Cacheåˆ†æˆäº†ä¸‰çº§L1ï¼ŒL2ï¼ŒL3ï¼š&lt;/p&gt;
&lt;p&gt;Cacheä¸»è¦ç”±é«˜é€Ÿçš„é™æ€å­˜å‚¨å™¨ã€åœ°å€è½¬æ¢æ¨¡å—å’ŒCache Lineæ›¿æ¢æ¨¡å—ç»„æˆã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/CPU_Cache.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/CPU_Cache.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;CPUåœ¨è¯»å–æ•°æ®å’ŒæŒ‡ä»¤æ—¶ï¼Œä¼šä¸€å±‚ä¸€å±‚çš„è¯»ï¼Œè¯»ä¸åˆ°å°±ä»ä¸‹ä¸€å±‚è¿›è¡ŒåŠ è½½ï¼Œä¸ºäº†è®©CPUæ‰§è¡Œä»£ç æ‰§è¡Œå¾—æ›´å¿«ï¼Œå°±éœ€è¦åˆ©ç”¨å¥½CPU Cacheï¼Œä½¿å¾—ç¼“å­˜çš„å‘½ä¸­ç‡æé«˜ï¼Œç¼“å­˜å‘½ä¸­äº†ï¼Œå°±ä¸ç”¨å»åŠ è½½å†…å­˜é‡Œçš„æ•°æ®äº†ã€‚&lt;/p&gt;
&lt;p&gt;CPU Cacheç”±å¾ˆå¤šä¸ªCache Lineç»„æˆï¼Œä¸€è¡Œå¤§å°é€šå¸¸ä¸º32å­—èŠ‚æˆ–64å­—èŠ‚ï¼Œ&lt;strong&gt;Cache Lineæ˜¯CPUä»å†…å­˜è¯»å–æ•°æ®çš„åŸºæœ¬å•ä½&lt;/strong&gt;ï¼Œä»–ä»¬ä¹‹é—´é€šè¿‡ &lt;em&gt;ç›´æ¥æ˜ å°„Cache&lt;/em&gt; æŠŠå†…å­˜é‡Œæ•°æ®çš„åœ°å€æ˜ å°„åˆ°Cache Lineé‡Œã€‚å¤šä¸ªCache Lineåˆä¼šå½¢æˆä¸€ç»„ï¼Œé™¤äº†å­˜å‚¨æ•°æ®ï¼Œè¿˜å­˜å‚¨æ ‡å¿—ä½ï¼Œå¦‚è„ä½ã€å›å†™ä½ã€è®¿é—®ä½ç­‰ï¼›&lt;/p&gt;
&lt;p&gt;CPUè¯»å–çš„æ˜¯å†…å­˜åœ°å€ï¼Œé€šè¿‡å†…å­˜åœ°å€æ ¹æ®æ˜ å°„ç­–ç•¥ï¼Œåœ¨Cacheé‡Œæ‰¾åˆ°å¯¹åº”çš„å€¼ï¼Œé€šè¿‡æ¯”è¾ƒåŒæ–¹çš„ç»„æ ‡è®°ï¼Œåˆ¤æ–­è¿™ä¸ªåœ°å€æ˜¯å¦å¯¹åº”è¿™ä¸ªå€¼ã€‚&lt;/p&gt;
&lt;p&gt;CPU CacheåŠ è½½å†…å­˜æ•°æ®æ—¶ï¼Œä¸æ˜¯ä¸€ä¸ªå­—èŠ‚ä¸€ä¸ªå­—èŠ‚è¯»å–ï¼Œæ˜¯ä¸€æ¬¡æ€§è¯»å–ä¸€å—ä¸€å—çš„æ•°æ®æ”¾åˆ°CPU Cacheé‡Œçš„ï¼Œæ¯”å¦‚CPU L1 Cache Lineçš„å¤§å°æ˜¯64å­—èŠ‚ï¼Œè¡¨ç¤ºL1 Cacheä¸€æ¬¡è½½å…¥æ•°æ®çš„å¤§å°æ˜¯64å­—èŠ‚ï¼ŒåŠ è½½æ•°æ®æ—¶ä¼šé¡ºåºåŠ è½½ï¼Œå½“æœ‰ &lt;code&gt;int array[100]&lt;/code&gt;ï¼Œè½½å…¥&lt;code&gt;array[0]&lt;/code&gt;æ—¶ï¼Œç”±äºintå 4å­—èŠ‚ï¼Œä¸è¶³64å­—èŠ‚ï¼Œå› ä¸ºæ•°ç»„åœ¨å†…å­˜ä¸Šæ˜¯è¿ç»­çš„ï¼Œé‚£CPUå°±ä¼šé¡ºåºåŠ è½½æ•°ç»„å…ƒç´ &lt;code&gt;array[0] ~ array[15]&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å½“CPUæœ‰å¤šæ ¸æ—¶ï¼Œçº¿ç¨‹å¯èƒ½åœ¨ä¸åŒçš„CPUæ ¸å¿ƒæ¥å›åˆ‡æ¢æ‰§è¡Œï¼Œè¿™å¯¹CPU Cacheä¸åˆ©ï¼Œä¼šå¯¼è‡´å„æ ¸å¿ƒç¼“å­˜é‡æ–°åŠ è½½ï¼Œå„ä¸ªæ ¸å¿ƒçš„ç¼“å­˜å‘½ä¸­ç‡å˜ä½ï¼Œæ‰€ä»¥å¯¹äºCPUå¯†é›†å‹çš„ä»»åŠ¡ï¼Œæœ€å¥½å°†çº¿ç¨‹ç»‘å®šåˆ°åŒä¸€ä¸ªæ ¸å¿ƒåŒºå¤„ç†ï¼Œé˜²æ­¢å› ä¸ºåˆ‡æ¢åˆ°ä¸åŒçš„æ ¸å¿ƒï¼Œå¯¼è‡´ç¼“å­˜å‘½ä¸­ç‡ä¸‹é™çš„é—®é¢˜ï¼Œä»¥æ­¤æ¥æå‡æ€§èƒ½ã€‚&lt;/p&gt;
&lt;p&gt;Cacheè™½æå‡äº†æ€§èƒ½ï¼Œä½†ä¼šäº§ç”Ÿæ•°æ®ä¸€è‡´æ€§é—®é¢˜ã€‚Cacheå¯ä»¥æ˜¯ä¸€ä¸ªç‹¬ç«‹ç¡¬ä»¶ï¼Œä¹Ÿå¯ä»¥é›†æˆåœ¨CPUä¸­ï¼ŒCacheé€šå¸¸æœ‰å¤šçº§ï¼Œæ¯ä¸€çº§é—´éƒ½æœ‰å¯èƒ½äº§ç”Ÿæ•°æ®ä¸€è‡´æ€§é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºæ•°æ®çš„å†™å…¥ï¼ŒCPUéƒ½ä¼šå…ˆå†™å…¥åˆ°Cacheé‡Œï¼Œç„¶åå†åœ¨ä¸€ä¸ªåˆé€‚çš„æ—¶é—´å†™å…¥å†…å­˜ï¼Œæœ‰å†™ç›´è¾¾å’Œå†™å›ä¸¤ç§ç­–ç•¥ï¼Œä¿æŒCacheå’Œå†…å­˜çš„æ•°æ®ä¸€è‡´æ€§ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å†™ç›´è¾¾Write Through&lt;/strong&gt;ï¼šåªè¦æœ‰æ•°æ®å†™å…¥ï¼Œéƒ½ä¼šç›´æ¥æŠŠæ•°æ®å†™å…¥å†…å­˜ï¼Œæ€§èƒ½å—é™äºå†…å­˜çš„è®¿é—®é€Ÿåº¦ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å†™å›Write back&lt;/strong&gt;ï¼šå¯¹äºå·²ç¼“å­˜çš„Cacheçš„å†™å…¥ï¼Œå¦‚æœè¦å†™å…¥çš„å†…å­˜åœ°å€æ•°æ®è·Ÿå½“å‰çš„ä¸€è‡´ï¼Œåªéœ€æ›´æ–°å…¶æ•°æ®ï¼Œå¹¶æ ‡è®°ä¸ºè„å³å¯ï¼Œä¸ç”¨å†™å…¥åˆ°å†…å­˜ï¼›&lt;/p&gt;
&lt;p&gt;åªæœ‰åœ¨éœ€è¦æŠŠç¼“å­˜é‡Œçš„è„æ•°æ®äº¤æ¢å‡ºå»çš„æ—¶å€™ï¼Œæ‰æŠŠæ•°æ®åŒæ­¥åˆ°å†…å­˜ï¼Œæ¯”å¦‚å†æ¬¡å†™å…¥çš„æ—¶å€™ï¼Œå‘ç°Cacheé‡Œå­˜çš„æ˜¯åˆ«çš„å†…å­˜åœ°å€çš„æ•°æ®ï¼Œä¸”è¢«æ ‡è®°ä¸ºè„ï¼Œå°±éœ€è¦å…ˆæŠŠè¿™ä¸ªè„æ•°æ®å†™å…¥å†…å­˜ï¼Œå†ä»å†…å­˜è¯»å…¥åˆ°ç¼“å­˜åæ‰è¿›è¡Œå†™å…¥ï¼Œå¹¶æ ‡è®°ä¸ºè„ï¼›&lt;/p&gt;
&lt;p&gt;å½“å†æ¬¡å†™å…¥çš„æ—¶å€™ï¼Œå‘ç°Cacheå­˜çš„æ˜¯åˆ«çš„å†…å­˜åœ°å€æ•°æ®ï¼Œä½†æ²¡æœ‰è¢«æ ‡è®°ä¸ºè„ï¼Œåˆ™å…ˆä»å†…å­˜åŠ è½½è¦æ›´æ–°çš„æ•°æ®çš„å†…å­˜åœ°å€ï¼Œæ›¿æ¢ä¹‹å‰åˆ«çš„å†…å­˜åœ°å€æ•°æ®ï¼Œç„¶åå†™å…¥æ›´æ–°æ•°æ®ï¼Œå¹¶æ ‡è®°ä¸ºè„ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¤šæ ¸åœºæ™¯ä¸‹çš„ä¿æŒç¼“å­˜ä¸€è‡´æ€§ï¼Œéœ€è¦æ»¡è¶³ä¸‹é¢ä¸¤ç‚¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å†™ä¼ æ’­ï¼Œå½“æŸä¸ªCPUæ ¸å¿ƒå‘ç”Ÿå†™æ“ä½œæ—¶ï¼Œå°†è¯¥äº‹ä»¶é€šè¿‡æ€»çº¿å¹¿æ’­é€šçŸ¥å…¶ä»–æ ¸å¿ƒï¼Œå¦‚æœå…¶ä»–æ ¸å¿ƒæœ‰è¯¥ç¼“å­˜ï¼Œåˆ™è¿›è¡Œæ›´æ–°ï¼›&lt;/li&gt;
&lt;li&gt;äº‹åŠ¡ä¸²è¡ŒåŒ–ï¼Œæ¥ä¿è¯æ›´æ–°é¡ºåºï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è§£å†³å¤šæ ¸åœºæ™¯ä¸‹ä¸€è‡´æ€§é—®é¢˜å°±éœ€è¦æ•°æ®åŒæ­¥åè®®ï¼Œå¦‚MESIå’ŒMOESIã€‚&lt;/p&gt;
&lt;p&gt;åŸºäºæ€»çº¿å—…æ¢çš„MESIåè®®ï¼Œå°±æ»¡è¶³ä¸Šé¢ä¸¤ç‚¹ï¼ŒMESIæŒ‡çš„æ˜¯ï¼šå·²ä¿®æ”¹ã€ç‹¬å ã€å…±äº«ã€å·²å¤±æ•ˆï¼Œå®ç°æœ‰é™çŠ¶æ€æœºï¼Œå¯¹Cache Line è¿›è¡Œæ ‡è®°ï¼Œåˆ¤æ–­ç¼“å­˜æ˜¯å¦éœ€è¦ä¼ æ’­æ›´æ–°ã€‚ä¸ºäº†é¿å…ä¸¤ä¸ªä¸åŒçš„æ ¸å¿ƒè¯»å–åˆ°åŒä¸€å—æ•°æ®åˆ°Cache Lineï¼Œä½†æ˜¯å„è‡ªåˆåªç”¨åˆ°äº†å…¶ä¸­ä¸€éƒ¨åˆ†çš„åœºæ™¯ï¼ˆå› ä¸ºè¿™ä¸ªæ—¶å€™å¦‚æœå‘ç”Ÿä¿®æ”¹ï¼Œä¼šå¯¼è‡´ç¼“å­˜ä¸èµ·ä½œç”¨ï¼‰ï¼Œæ­¤æ—¶éœ€è¦å°†ä»–ä»¬æ‰€éœ€çš„æ•°æ®æ”¾åˆ°ä¸¤ä¸ªä¸åŒçš„Cache Lineé‡Œï¼Œé¿å…æ›´æ–°æ—¶çš„ç›¸äº’å¹²æ‰°ï¼Œé€šå¸¸çš„åšæ³•æ˜¯æ ¹æ®Cache Lineå¤§å°ï¼Œä¸ºè¿™ä¸¤éƒ¨åˆ†è¿›è¡Œå¤šä½™çš„æ•°æ®å¡«å……ï¼Œä½¿å…¶è¢«åŠ è½½åˆ°ä¸åŒçš„Cache Lineé‡Œï¼Œå³å†…å­˜å¯¹é½ï¼Œç©ºé—´æ¢æ—¶é—´ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;MESIï¼šMï¼ˆModifiedå·²ä¿®æ”¹ï¼‰ã€Eï¼ˆExclusiveç‹¬å ï¼‰ã€Sï¼ˆSharedå…±äº«ï¼‰ã€Iï¼ˆInvalidaå·²æ— æ•ˆï¼‰&lt;/p&gt;
&lt;p&gt;æœ€å¼€å§‹åªæœ‰ä¸€ä¸ªæ ¸è¯»å–äº†Aæ•°æ®ï¼Œæ­¤æ—¶çŠ¶æ€ä¸ºEç‹¬å ï¼Œæ•°æ®æ˜¯å¹²å‡€çš„ï¼Œ
åæ¥å¦ä¸€ä¸ªæ ¸åˆè¯»å–äº†Aæ•°æ®ï¼Œæ­¤æ—¶çŠ¶æ€ä¸ºSå…±äº«ï¼Œæ•°æ®è¿˜æ˜¯å¹²å‡€çš„ï¼Œ
æ¥ç€å…¶ä¸­ä¸€ä¸ªæ ¸ä¿®æ”¹äº†æ•°æ®Aï¼Œæ­¤æ—¶ä¼šå‘å…¶ä»–æ ¸å¹¿æ’­æ•°æ®å·²è¢«ä¿®æ”¹ï¼Œè®©å…¶ä»–æ ¸çš„æ•°æ®çŠ¶æ€å˜ä¸ºIå¤±æ•ˆï¼Œè€Œæœ¬æ ¸çš„æ•°æ®è¿˜æ²¡å›å†™å†…å­˜ï¼ŒçŠ¶æ€åˆ™å˜ä¸ºMå·²ä¿®æ”¹ï¼Œç­‰å¾…åç»­åˆ·æ–°ç¼“å­˜åï¼Œæ•°æ®å˜å›Eç‹¬å ï¼Œå…¶ä»–æ ¸ç”±äºæ•°æ®å·²å¤±æ•ˆï¼Œè¯»æ•°æ®Aæ—¶éœ€è¦é‡æ–°ä»å†…å­˜è¯»åˆ°é«˜é€Ÿç¼“å­˜ï¼Œæ­¤æ—¶æ•°æ®åˆå…±äº«äº†&lt;/p&gt;
&lt;p&gt;ä»¥ä¸Šè¿™äº›é€»è¾‘éƒ½ç”± Cache ç¡¬ä»¶ç‹¬ç«‹å®ç°ï¼Œè½¯ä»¶ä¸ç”¨åšä»»ä½•å·¥ä½œï¼Œå¯¹è½¯ä»¶æ˜¯é€æ˜çš„ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;å·¥ä½œæ¨¡å¼&#34;&gt;å·¥ä½œæ¨¡å¼&lt;/h2&gt;
&lt;h3 id=&#34;å®æ¨¡å¼&#34;&gt;å®æ¨¡å¼&lt;/h3&gt;
&lt;p&gt;åˆç§°å®åœ°å€æ¨¡å¼ï¼Œè¿è¡ŒçœŸæ­£çš„æŒ‡ä»¤ï¼Œå¯¹æŒ‡ä»¤çš„åŠ¨ä½œä¸ä½œåŒºåˆ†ï¼Œç›´æ¥æ‰§è¡ŒæŒ‡ä»¤çš„çœŸå®åŠŸèƒ½ï¼Œå¦å¤–ï¼Œå‘å¾€å†…å­˜çš„åœ°å€æ˜¯çœŸå®çš„ï¼Œå¯¹ä»»ä½•åœ°å€ä¸åŠ é™åˆ¶åœ°å‘å¾€å†…å­˜ã€‚&lt;/p&gt;
&lt;p&gt;è®¿é—®å†…å­˜ - åˆ†æ®µå†…å­˜ç®¡ç†æ¨¡å¼ï¼šå†…å­˜åœ°å€ç”±æ®µå¯„å­˜å™¨å·¦ç§»4ä½ï¼Œå†åŠ ä¸Šä¸€ä¸ªé€šç”¨å¯„å­˜å™¨ä¸­çš„å€¼æˆ–è€…å¸¸æ•°å½¢æˆåœ°å€ï¼Œç„¶åç”±è¿™ä¸ªåœ°å€å»è®¿é—®å†…å­˜ã€‚ä»…æ”¯æŒ16ä½åœ°å€ç©ºé—´ï¼Œå¯¹æŒ‡ä»¤ä¸åŠ é™åˆ¶åœ°è¿è¡Œï¼Œå¯¹å†…å­˜æ²¡æœ‰ä¿æŠ¤éš”ç¦»ä½œç”¨ã€‚&lt;/p&gt;
&lt;p&gt;ä¸­æ–­å®ç°ï¼Œå†…å­˜ä¸­å­˜æ”¾ä¸€ä¸ªä¸­æ–­å‘é‡è¡¨ï¼Œè¯¥è¡¨çš„åœ°å€å’Œé•¿åº¦ç”±CPUçš„ç‰¹å®šå¯„å­˜å™¨IDTRæŒ‡å‘ï¼Œä¸€ä¸ªæ¡ç›®ç”±ä»£ç æ®µåœ°å€å’Œæ®µå†…åç§»ç»„æˆï¼Œå½“å‡ºç°ä¸­æ–­å·åï¼ŒCPUå°±æ ¹æ®IDTRå¯„å­˜å™¨ä¸­çš„ä¿¡æ¯ï¼Œè®¡ç®—å‡ºä¸­æ–­å‘é‡ä¸­çš„æ¡ç›®ï¼Œè¿›è€Œè£…è½½CSï¼ˆä»£ç æ®µåŸºåœ°å€ï¼‰ã€IPï¼ˆä»£ç æ®µå†…åç§»ï¼‰å¯„å­˜å™¨ï¼Œå“åº”ä¸­æ–­ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ä¿æŠ¤æ¨¡å¼&#34;&gt;ä¿æŠ¤æ¨¡å¼&lt;/h3&gt;
&lt;p&gt;ä¿æŠ¤æ¨¡å¼æ˜¯ä¸ºäº†åº”å¯¹æ›´é«˜çš„è®¡ç®—é‡å’Œå†…å­˜é‡ï¼ŒCPUå¯„å­˜å™¨æ‰©å±•ä¸º32ä½å®½ï¼Œä½¿å…¶èƒ½å¤Ÿå¯»å€32ä½å†…å­˜åœ°å€ç©ºé—´å’Œ32ä½çš„æ•°æ®ï¼Œè¿˜å®ç°æŒ‡ä»¤åŒºåˆ†å’Œè®¿é—®å†…å­˜åœ°å€é™åˆ¶ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†åŒºåˆ†å“ªäº›æŒ‡ä»¤(å¦‚inã€outã€cli)å’Œå“ªäº›èµ„æº(å¦‚å¯„å­˜å™¨ã€IOç«¯å£ã€å†…å­˜åœ°å€)å¯ä»¥è¢«è®¿é—®ï¼Œå®ç°äº†ç‰¹æƒçº§ã€‚ç‰¹æƒçº§åˆ†ä¸º4çº§ï¼ŒR0~R3ï¼ŒR0æœ€å¤§ï¼Œå¯ä»¥æŒ‡å‘æ‰€æœ‰æŒ‡ä»¤ï¼Œä¹‹åä¾æ¬¡é€’å‡ï¼Œä¸‹ä¸€å±‚æ˜¯ä¸Šä¸€å±‚çš„å­é›†ã€‚å†…å­˜è®¿é—®åˆ™é æ®µæè¿°ç¬¦å’Œç‰¹æƒçº§ç›¸äº’é…åˆå®ç°ã€‚&lt;/p&gt;
&lt;p&gt;è®¿é—®å†…å­˜æ—¶ä½¿ç”¨å¹³å¦æ¨¡å‹ï¼šä¸ºäº†åº”å¯¹åˆ†æ®µæ¨¡å‹çš„ç¼ºé™·ï¼Œåœ¨åˆ†æ®µæ¨¡å‹çš„åŸºç¡€ä¸Šå¥—å¤šä¸€å±‚ï¼Œç®€åŒ–åˆ†æ®µæ¨¡å‹ï¼Œå¯¹å†…å­˜æ®µä¸æ®µä¹‹é—´çš„è®¿é—®ä¸¥æ ¼æ£€æŸ¥ï¼Œæ²¡æœ‰æƒé™ä¸ä¼šæ”¾è¡Œã€‚&lt;/p&gt;
&lt;p&gt;ä¸­æ–­æ—¶ç”±äºè¦è¿›è¡Œæƒé™æ£€æµ‹å’Œç‰¹æƒçº§åˆ‡æ¢ï¼Œéœ€è¦æ‰©å±•ä¸­æ–­å‘é‡è¡¨çš„ä¿¡æ¯ï¼Œæ¯ä¸ªä¸­æ–­ç”¨ä¸€ä¸ªä¸­æ–­é—¨æè¿°ç¬¦æ¥è¡¨ç¤ºï¼Œå­˜äºä¸­æ–­å‘é‡è¡¨ä¸­&lt;/p&gt;
&lt;h3 id=&#34;é•¿æ¨¡å¼&#34;&gt;é•¿æ¨¡å¼&lt;/h3&gt;
&lt;p&gt;åˆåAMD64æ¨¡å¼ï¼Œåœ¨ä¿æŠ¤æ¨¡å¼çš„åŸºç¡€ä¸Šï¼Œå¢åŠ ä¸€äº›é€šç”¨å¯„å­˜å™¨ï¼Œæ‰©å±•é€šç”¨å¯„å­˜å™¨çš„ä½å®½ï¼Œæ‰€æœ‰çš„é€šç”¨å¯„å­˜å™¨éƒ½æ˜¯64ä½ï¼Œè¿˜å¯å•ç‹¬ä½¿ç”¨ä½32ä½ã€‚ä½32ä½å¯ä»¥æ‹†åˆ†æˆä¸€ä¸ªä½16ä½å¯„å­˜å™¨ï¼Œä½16ä½åˆå¯ä»¥æ‹†åˆ†ä¸ºä¸¤ä¸ª8ä½å¯„å­˜å™¨ã€‚&lt;/p&gt;
&lt;p&gt;è®¿é—®å†…å­˜æ—¶éœ€è¦å¼€å¯åˆ†é¡µæ¨¡å¼ï¼Œå¼±åŒ–æ®µæ¨¡å¼ç®¡ç†ï¼Œä»…ä¿ç•™æƒé™çº§åˆ«çš„æ£€æŸ¥ï¼Œå¿½ç•¥æ®µåŸºå€å’Œæ®µé•¿åº¦ï¼Œåœ°å€æ£€æŸ¥äº¤ç»™MMUã€‚&lt;/p&gt;
&lt;p&gt;ä¸­æ–­æ—¶çš„ä¸­æ–­å‘é‡è¡¨ä¸­çš„æ¡ç›®ï¼Œä¸­æ–­æè¿°ç¬¦éœ€è¦æ‰©å±•ï¼Œå°†å…¶32ä½æ®µå†…åç§»æ‰©å±•æˆæ”¯æŒ64ä½&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;1ã€x86 CPUçš„ä½æ•°è¶Šæ¥è¶Šé«˜ï¼Œä»16åˆ°32åˆ°64ï¼Œæ¯æ¬¡è¿›æ­¥éƒ½å°½é‡çš„å»å…¼å®¹äº†ä¹‹å‰çš„CPUæ¶æ„ï¼Œæ‰€ä»¥ï¼š
Aã€16ä½æ—¶å¯»å€èƒ½åŠ›ä¸è¶³ï¼Œæ‰€ä»¥è¦å€ŸåŠ©é¢å¤–çš„å¯„å­˜å™¨è¿›è¡Œ1Mç©ºé—´çš„å¯»å€ï¼›32ä½æ—¶ï¼Œæ¯ä¸ªç¨‹åºéƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„4Gå¯»å€ç©ºé—´ï¼Œæ“ä½œç³»ç»Ÿç”¨ä½ä½çš„1G-2Gï¼Œå…¶ä½™ç•™ç»™ç”¨æˆ·ç¨‹åºï¼›64ä½åï¼Œæš‚æ—¶å°±é‡ä¸åˆ°å¯»å€èƒ½åŠ›ä¸è¶³çš„äº‹æƒ…äº†ï¼›
Bã€å‰ä¸€ä»£çš„å¯„å­˜å™¨å°½é‡ä¿ç•™ï¼Œä¸å¤Ÿç”¨å°±æ‰©å±•æ–°çš„
Cã€å¯„å­˜å™¨çš„é•¿åº¦å‡çº§åï¼Œå…¶ä½ä½å¯ä»¥å…¼å®¹ä¸Šä¸€ä»£çš„å¯„å­˜å™¨&lt;/p&gt;
&lt;p&gt;2ã€CPUåŒæ—¶åœ¨å®‰å…¨æ€§ä¸Šä¹Ÿè¦æå‡ï¼Œä»åªæœ‰å®æ¨¡å¼ã€å¯ä»¥éšæ„æ‰§è¡Œå…¨éƒ¨CPUæŒ‡ä»¤ï¼Œå†…å­˜å¯ä»¥ç›´æ¥é€šè¿‡ç‰©ç†åœ°å€è®¿é—®ï¼Œéšæ„è®¿é—®éšæ„è¯»å†™ã€‘ï¼Œåˆ°äº†32çš„ä¿æŠ¤æ¨¡å¼ã€å°†æŒ‡ä»¤åˆ’åˆ†ä¸ºring0åˆ°ring3ï¼ŒCPUæŒ‡ä»¤ä¸æ˜¯ä½ æƒ³è°ƒç”¨å°±èƒ½è°ƒç”¨ï¼›å†…å­˜ä¸æ˜¯ä½ æƒ³è®¿é—®å°±èƒ½è®¿é—®ï¼Œé¦–å…ˆCPUè¦å…è®¸ï¼Œè€Œä¸”æ“ä½œç³»ç»Ÿå…è®¸ã€‘ï¼Œè€Œ64çš„é•¿æ¨¡å¼åœ¨å®‰å…¨æ–¹é¢ä¸32å¹¶æ²¡æœ‰æœ¬è‡³åŒºåˆ«ï¼›&lt;/p&gt;
&lt;p&gt;3ã€ä»å®æ¨¡å¼åˆ°ä¿æŠ¤æ¨¡å¼ï¼Œè®¿é—®å†…å­˜æ—¶ï¼Œéœ€è¦è®¿é—®çš„åœ°å€å˜å¤§äº†ï¼Œéœ€è¦æ§åˆ¶çš„å†…å®¹å˜å¤šäº†ï¼Œäºæ˜¯å¼•å…¥äº†æ®µæè¿°ç¬¦ï¼Œæ‰€æœ‰çš„æ®µæè¿°ç¬¦ç»„æˆäº†æè¿°ç¬¦è¡¨ï¼ŒåŒ…æ‹¬å”¯ä¸€çš„å…¨å±€æè¿°ç¬¦GDTå’Œå¤šä¸ªå±€éƒ¨æè¿°ç¬¦å·LDTã€‚GDTæ˜¯æ“ä½œç³»ç»Ÿç‰¹ä¾›ï¼Œè¦é‡ç‚¹å…³æ³¨ã€‚CPUå¯»å€çš„æ—¶å€™ï¼Œè¦é€šè¿‡æ®µå¯„å­˜å™¨+GDTRå¯„å­˜å™¨å®šä½åˆ°çš„å†…å­˜ä¸­çš„æè¿°ç¬¦ï¼Œåˆ¤æ–­æ˜¯å¦å…è®¸è®¿é—®ã€‚ç„¶åï¼Œå†æ ¹æ®æ®µæè¿°ç¬¦ä¸­åœ°å€è¿›è¡Œè®¿é—®ã€‚&lt;/p&gt;
&lt;p&gt;4ã€åŒæ—¶å†…å­˜ä¸­å†…å­˜ç®¡ç†æœ‰æ®µã€é¡µã€æ®µé¡µä¸‰ç§å¸¸ç”¨æ¨¡å¼ã€‚ä¸€èˆ¬åœ¨åº”ç”¨å±‚ï¼Œç¨‹åºå‘˜æ„Ÿå—ä¸å¤ªåˆ°ï¼Œæ“ä½œç³»ç»Ÿå…¨ç»™å’±ä»¬åšå®Œäº†ã€‚&lt;/p&gt;
&lt;p&gt;5ã€ä¸­æ–­ï¼Œå…¶å®æ˜¯é€šè¿‡ç¡¬ä»¶æˆ–è½¯ä»¶æ–¹å¼å‘Šè¯‰CPUï¼Œæ¥æ‰§è¡Œä¸€æ®µç‰¹æ®Šçš„ä»£ç ã€‚æ¯”å¦‚å’±ä»¬é”®ç›˜è¾“å…¥ï¼Œå°±æ˜¯é€šè¿‡ç¡¬ä»¶ä¸­æ–­çš„æ–¹å¼ï¼Œå‘ŠçŸ¥æ“ä½œç³»ç»Ÿçš„ã€‚åœ¨å®æ¨¡å¼ä¸‹ï¼Œä¸­æ–­æ˜¯ç›´æ¥æ‰§è¡Œçš„ã€‚ä½†åˆ°äº†ä¿æŠ¤æ¨¡å¼å’Œé•¿æ¨¡å¼ä¸‹ï¼Œå°±è¦ç‰¹æƒçº§åˆ«æ ¡éªŒé€šè¿‡æ‰èƒ½æ‰§è¡Œï¼Œæ‰€ä»¥å¼•å…¥äº†ä¸­æ–­é—¨è¿›è¡Œæ§åˆ¶ã€‚åœ¨ring3è°ƒç”¨ä¸­æ–­ä¸€èˆ¬æ˜¯è¦é€šè¿‡æ“ä½œç³»ç»Ÿåˆ‡æ¢åˆ°å†…æ ¸æ€ring0è¿›è¡Œçš„ï¼Œä¸å†…å­˜ç±»ä¼¼ï¼Œè¦é€šè¿‡ä¸­æ–­å‘é‡è¡¨ï¼Œç¡®è®¤ä¸­æ–­é—¨ä¸­æƒé™æ˜¯å¦å…è®¸ï¼Œç„¶åå®šä½åˆ°æŒ‡å®šä»£ç æ‰§è¡Œã€‚&lt;/p&gt;
&lt;p&gt;6ã€BIOSå¼•å¯¼åï¼Œç³»ç»Ÿç›´æ¥è¿›å…¥æœ€ç®€å•ã€ç‰¹æƒæœ€å¤§çš„å®æ¨¡å¼ï¼›è€Œåå‘ŠçŸ¥CPUï¼Œåˆ‡æ¢åˆ°ä¿æŠ¤æ¨¡å¼ï¼Œå¹¶è¿è¡Œåœ¨ring0ã€‚åç»­çš„ç”¨æˆ·è¿›ç¨‹ï¼Œä¸€èˆ¬å°±åœ¨ring3ï¼Œæƒ³æ‰§è¡Œç‰¹æƒæŒ‡ä»¤è¦é€šè¿‡æ“ä½œç³»ç»Ÿæ¥æ‰§è¡Œ&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;å†…æ ¸æ€å’Œç”¨æˆ·æ€&#34;&gt;å†…æ ¸æ€å’Œç”¨æˆ·æ€&lt;/h2&gt;
&lt;p&gt;å¯¹äº32ä½æ“ä½œç³»ç»Ÿæ¥è¯´ï¼Œå¯»å€ç©ºé—´ä¸º4G(2çš„32æ¬¡æ–¹)ï¼Œå³è¿›ç¨‹æœ€å¤§åœ°å€ç©ºé—´æ˜¯4Gã€‚&lt;/p&gt;
&lt;p&gt;å†…æ ¸ç‹¬ç«‹äºæ™®é€šçš„åº”ç”¨ç¨‹åºï¼Œå¯ä»¥è®¿é—®å—ä¿æŠ¤çš„å†…å­˜ç©ºé—´ï¼Œè¿˜æœ‰åº•å±‚ç¡¬ä»¶è®¾å¤‡çš„æ‰€æœ‰æƒé™ï¼Œæ‰€ä»¥ï¼Œä¸ºäº†ä¿æŠ¤å†…æ ¸å®‰å…¨ï¼Œç°åœ¨çš„æ“ä½œç³»ç»Ÿä¸€èˆ¬éƒ½å¼ºåˆ¶ç”¨æˆ·è¿›ç¨‹ä¸èƒ½ç›´æ¥æ“ä½œç³»ç»Ÿå†…æ ¸ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/%e5%86%85%e5%ad%98%e7%a9%ba%e9%97%b4%e5%88%86%e9%85%8d.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/%e5%86%85%e5%ad%98%e7%a9%ba%e9%97%b4%e5%88%86%e9%85%8d.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;æ“ä½œç³»ç»Ÿå°†&lt;strong&gt;è™šæ‹Ÿåœ°å€ç©ºé—´åˆ’åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œä¸€éƒ¨åˆ†ä¸ºå†…æ ¸ç©ºé—´ï¼Œå¦ä¸€éƒ¨åˆ†ä¸ºç”¨æˆ·ç©ºé—´&lt;/strong&gt;ã€‚é’ˆå¯¹ Linux æ“ä½œç³»ç»Ÿè€Œè¨€ï¼Œæœ€é«˜çš„ 1G å­—èŠ‚(ä»è™šæ‹Ÿåœ°å€ 0xC0000000 åˆ° 0xFFFFFFFF)ç”±å†…æ ¸ä½¿ç”¨ï¼Œç§°ä¸ºå†…æ ¸ç©ºé—´ã€‚è€Œè¾ƒä½çš„ 3G å­—èŠ‚(ä»è™šæ‹Ÿåœ°å€ 0x00000000 åˆ° 0xBFFFFFFF)ç”±å„ä¸ªè¿›ç¨‹ä½¿ç”¨ï¼Œç§°ä¸ºç”¨æˆ·ç©ºé—´ï¼›å†…æ ¸æ€åœ¨0~4GèŒƒå›´çš„è™šæ‹Ÿç©ºé—´åœ°å€éƒ½å¯ä»¥æ“ä½œï¼Œåªæ˜¯3~4GèŒƒå›´çš„è™šæ‹Ÿç©ºé—´åœ°å€å¿…é¡»ç”±å†…æ ¸æ€å»æ“ä½œï¼Œæ‰€æœ‰è¿›ç¨‹çš„å†…æ ¸æ€éƒ½å…±äº«3~4Gè¿™ä¸ªèŒƒå›´çš„æ•°æ®ã€‚&lt;/p&gt;
&lt;p&gt;ä¹‹æ‰€ä»¥è¦åˆ†å†…æ ¸ç©ºé—´å’Œç”¨æˆ·ç©ºé—´ï¼Œæ˜¯å› ä¸ºæœ‰äº›CPUæŒ‡ä»¤çš„æƒé™æ¯”è¾ƒå¤§ï¼Œå¯èƒ½å¯¼è‡´ç³»ç»Ÿå´©æºƒï¼Œå¦‚æœå…è®¸æ‰€æœ‰è¿›ç¨‹è®¿é—®ï¼Œå®¹æ˜“å‡ºäº‹ï¼Œå¯¼è‡´æ•…éšœæˆ–å´©æºƒï¼Œæ‰€ä»¥æ“ä½œç³»ç»Ÿå°†CPUæŒ‡ä»¤é›†åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼šç‰¹æƒæŒ‡ä»¤å’Œéç‰¹æƒæŒ‡ä»¤ï¼Œç‰¹æƒæŒ‡ä»¤åªå…è®¸æ“ä½œç³»ç»ŸåŠç›¸å…³æ¨¡å—ä½¿ç”¨ï¼Œéç‰¹æƒæŒ‡ä»¤ç»™æ™®é€šåº”ç”¨ç¨‹åºä½¿ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;Intenelçš„CPUå°†ç‰¹æƒç­‰çº§åˆ†ä¸º4ä¸ªï¼ŒRing0~Ring3ï¼ŒRing0æƒé™æœ€é«˜ï¼Œå¯ä»¥ä½¿ç”¨æ‰€æœ‰CPUæŒ‡ä»¤é›†ï¼ŒRing3æƒé™æœ€ä½ï¼Œåªèƒ½ä½¿ç”¨å¸¸è§„çš„CPUæŒ‡ä»¤é›†ï¼Œä¸èƒ½æ“ä½œç¡¬ä»¶èµ„æºçš„CPUæŒ‡ä»¤é›†ï¼Œæ¯”å¦‚IOè¯»å†™ã€ç½‘å¡è®¿é—®ã€ç”³è¯·å†…å­˜ç­‰æ“ä½œï¼›&lt;/p&gt;
&lt;p&gt;Linuxç³»ç»Ÿåªç”¨äº†Ring0å’ŒRing3ï¼ŒRing3ä¸èƒ½è®¿é—®Ring0çš„åœ°å€ç©ºé—´ï¼Œå½“è¿›ç¨‹è¿è¡Œåœ¨Ring3çº§åˆ«æ—¶è¢«ç§°ä¸ºè¿è¡Œåœ¨ç”¨æˆ·æ€ï¼Œè¿è¡Œåœ¨Ring0çº§åˆ«è¢«ç§°ä¸ºè¿è¡Œåœ¨å†…æ ¸æ€ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨å†…æ ¸æ€ä¸‹ï¼Œè¿›ç¨‹è¿è¡Œåœ¨å†…æ ¸åœ°å€ç©ºé—´ä¸­ï¼Œæ­¤æ—¶ CPU å¯ä»¥æ‰§è¡Œä»»ä½•æŒ‡ä»¤ã€‚è¿è¡Œçš„ä»£ç ä¹Ÿä¸å—ä»»ä½•çš„é™åˆ¶ï¼Œå¯ä»¥è‡ªç”±åœ°è®¿é—®ä»»ä½•æœ‰æ•ˆåœ°å€ï¼Œä¹Ÿå¯ä»¥ç›´æ¥è¿›è¡Œç«¯å£çš„è®¿é—®ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ç”¨æˆ·æ€ä¸‹ï¼Œè¿›ç¨‹è¿è¡Œåœ¨ç”¨æˆ·åœ°å€ç©ºé—´ä¸­ï¼Œè¢«æ‰§è¡Œçš„ä»£ç è¦å—åˆ° CPU çš„è¯¸å¤šæ£€æŸ¥ï¼Œå®ƒä»¬åªèƒ½è®¿é—®æ˜ å°„å…¶åœ°å€ç©ºé—´çš„é¡µè¡¨é¡¹ä¸­è§„å®šçš„åœ¨ç”¨æˆ·æ€ä¸‹å¯è®¿é—®é¡µé¢çš„è™šæ‹Ÿåœ°å€ï¼Œä¸”åªèƒ½å¯¹ä»»åŠ¡çŠ¶æ€æ®µ(TSS)ä¸­ I/O è®¸å¯ä½å›¾(I/O Permission Bitmap)ä¸­è§„å®šçš„å¯è®¿é—®ç«¯å£è¿›è¡Œç›´æ¥è®¿é—®ã€‚&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥ï¼Œå³ä¾¿æ˜¯å•ä¸ªåº”ç”¨ç¨‹åºå‡ºç°é”™è¯¯ä¹Ÿä¸ä¼šå½±å“åˆ°æ“ä½œç³»ç»Ÿçš„ç¨³å®šæ€§ï¼Œè¿™æ ·å…¶å®ƒçš„ç¨‹åºè¿˜å¯ä»¥æ­£å¸¸çš„è¿è¡Œï¼ŒåŒºåˆ†å†…æ ¸ç©ºé—´å’Œç”¨æˆ·ç©ºé—´æœ¬è´¨ä¸Šæ˜¯è¦æé«˜æ“ä½œç³»ç»Ÿçš„ç¨³å®šæ€§åŠå¯ç”¨æ€§ã€‚&lt;/p&gt;
&lt;p&gt;å†…æ ¸ä¼šå¯¹è¿™äº›ç‰¹æƒæŒ‡ä»¤é›†å°è£…æˆä¸€ä¸ªä¸ªæ¥å£ï¼Œä¾›ç”¨æˆ·ç©ºé—´çš„åº”ç”¨ç¨‹åºä½¿ç”¨ï¼Œæ¯”å¦‚è¯»å†™ç£ç›˜ï¼Œåˆ†é…å†…å­˜ã€å›æ”¶å†…å­˜ã€ä»ç½‘ç»œæ¥å£è¯»å†™æ•°æ®ç­‰ã€‚è¿›ç¨‹åœ¨ç”¨æˆ·æ€å’Œå†…æ ¸æ€å„æœ‰ä¸€ä¸ªå †æ ˆï¼Œç”¨æ¥ä¿å­˜åœ¨å¯¹åº”ç©ºé—´æ‰§è¡Œçš„ä¸Šä¸‹æ–‡ã€‚&lt;strong&gt;åº”ç”¨ç¨‹åºè¦è¯»ç£ç›˜æ•°æ®ï¼Œ1. é¦–å…ˆé€šè¿‡ç‰¹æ®ŠæŒ‡ä»¤ï¼Œä»ç”¨æˆ·æ€è¿›å…¥å†…æ ¸æ€ï¼Œæ‰§è¡Œç‰¹æƒæŒ‡ä»¤ï¼Œ2. ä»ç£ç›˜ä¸Šè¯»å–æ•°æ®åˆ°å†…æ ¸ç©ºé—´ä¸­ï¼Œ3. å†æŠŠæ•°æ®æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´ï¼Œå¹¶ä»å†…æ ¸æ€åˆ‡æ¢åˆ°ç”¨æˆ·æ€ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æ€»å…±æœ‰ä¸‰ç§æ–¹å¼å¯ä»¥ä»ç”¨æˆ·æ€åˆ‡æ¢åˆ°å†…æ ¸æ€ï¼šç³»ç»Ÿè°ƒç”¨system callã€è½¯ç¡¬ä¸­æ–­ã€å¼‚å¸¸ã€‚&lt;/p&gt;
&lt;p&gt;ä»ç”¨æˆ·æ€åˆ°å†…æ ¸æ€çš„åˆ‡æ¢å¼€é”€æ¯”è¾ƒå¤§ï¼Œä¸»è¦æ˜¯å› ä¸ºï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¿ç•™ç”¨æˆ·æ€ç°åœºï¼ˆä¸Šä¸‹æ–‡ã€å¯„å­˜å™¨ã€ç”¨æˆ·æ ˆç­‰ï¼‰&lt;/li&gt;
&lt;li&gt;å¤åˆ¶ç”¨æˆ·æ€å‚æ•°ï¼Œç”¨æˆ·æ ˆåˆ‡åˆ°å†…æ ¸æ ˆï¼Œè¿›å…¥å†…æ ¸æ€&lt;/li&gt;
&lt;li&gt;é¢å¤–çš„æ£€æŸ¥ï¼ˆå› ä¸ºå†…æ ¸ä»£ç å¯¹ç”¨æˆ·ä¸ä¿¡ä»»ï¼‰&lt;/li&gt;
&lt;li&gt;æ‰§è¡Œå†…æ ¸æ€ä»£ç &lt;/li&gt;
&lt;li&gt;å¤åˆ¶å†…æ ¸æ€ä»£ç æ‰§è¡Œç»“æœï¼Œå›åˆ°ç”¨æˆ·æ€&lt;/li&gt;
&lt;li&gt;æ¢å¤ç”¨æˆ·æ€ç°åœºï¼ˆä¸Šä¸‹æ–‡ã€å¯„å­˜å™¨ã€ç”¨æˆ·æ ˆç­‰ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;cpuä¸Šä¸‹æ–‡&#34;&gt;CPUä¸Šä¸‹æ–‡&lt;/h2&gt;
&lt;p&gt;Linuxæ˜¯ä¸€ä¸ªå¤šä»»åŠ¡æ“ä½œç³»ç»Ÿï¼Œå¯ä»¥æ”¯æŒè¿œå¤§äºCPUæ•°é‡çš„ä»»åŠ¡åŒæ—¶è¿›è¡Œï¼Œé€šè¿‡åœ¨çŸ­æ—¶é—´å†…åˆ†é…CPUç»™ä»»åŠ¡è¿è¡Œå®ç°å¹¶è¡Œçš„ç›®çš„ï¼Œå› æ­¤CPUéœ€è¦çŸ¥é“æ¯ä¸ªä»»åŠ¡ä»å“ªé‡ŒåŠ è½½ï¼Œå“ªé‡Œå¼€å§‹è¿è¡Œï¼Œéœ€è¦äº‹å…ˆå¸®å®ƒä»¬è®¾ç½®å¥½CPUå¯„å­˜å™¨å’Œç¨‹åºè®¡æ•°å™¨ï¼Œå› æ­¤CPUå¯„å­˜å™¨å’Œç¨‹åºè®¡æ•°å™¨å°±ç®—CPUä¸Šä¸‹æ–‡ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;CPUå¯„å­˜å™¨ï¼šCPUå†…ç½®çš„å®¹é‡å°ï¼Œä½†é€Ÿåº¦å¿«çš„å†…å­˜&lt;/li&gt;
&lt;li&gt;ç¨‹åºè®¡æ•°å™¨ï¼šå­˜å‚¨CPUæ­£åœ¨æ‰§è¡ŒæŒ‡ä»¤çš„ä½ç½®ï¼Œæˆ–è€…å³å°†æ‰§è¡Œçš„ä¸‹ä¸€æ¡æŒ‡ä»¤çš„ä½ç½®&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;CPUä¸Šä¸‹æ–‡åˆ‡æ¢æ—¶ï¼Œå…ˆæŠŠå‰ä¸€ä¸ªä»»åŠ¡çš„ CPU ä¸Šä¸‹æ–‡ï¼ˆä¹Ÿå°±æ˜¯ CPU å¯„å­˜å™¨å’Œç¨‹åºè®¡æ•°å™¨ï¼‰ä¿å­˜èµ·æ¥ï¼Œç„¶ååŠ è½½æ–°ä»»åŠ¡çš„ä¸Šä¸‹æ–‡åˆ°è¿™äº›å¯„å­˜å™¨å’Œç¨‹åºè®¡æ•°å™¨ï¼Œæœ€åå†è·³è½¬åˆ°ç¨‹åºè®¡æ•°å™¨æ‰€æŒ‡çš„æ–°ä½ç½®ï¼Œè¿è¡Œæ–°ä»»åŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;è€Œè¿™äº›ä¿å­˜ä¸‹æ¥çš„ä¸Šä¸‹æ–‡ï¼Œä¼šå­˜å‚¨åœ¨ç³»ç»Ÿå†…æ ¸ä¸­ï¼Œå¹¶åœ¨ä»»åŠ¡é‡æ–°è°ƒåº¦æ‰§è¡Œæ—¶å†æ¬¡åŠ è½½è¿›æ¥ã€‚è¿™æ ·å°±èƒ½ä¿è¯ä»»åŠ¡åŸæ¥çš„çŠ¶æ€ä¸å—å½±å“ï¼Œè®©ä»»åŠ¡çœ‹èµ·æ¥è¿˜æ˜¯è¿ç»­è¿è¡Œã€‚&lt;/p&gt;
&lt;h3 id=&#34;è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢&#34;&gt;è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢&lt;/h3&gt;
&lt;p&gt;å‘ç”Ÿç³»ç»Ÿè°ƒç”¨æ—¶ï¼Œè¿›ç¨‹ä»ç”¨æˆ·æ€è¿›å…¥å†…æ ¸æ€ï¼Œè¿™ä¸ªè¿‡ç¨‹å‘ç”Ÿä¸Šä¸‹æ–‡åˆ‡æ¢ï¼š&lt;/p&gt;
&lt;p&gt;1ã€ä¿å­˜ CPU å¯„å­˜å™¨é‡ŒåŸæ¥ç”¨æˆ·æ€çš„æŒ‡ä»¤ä½
2ã€ä¸ºäº†æ‰§è¡Œå†…æ ¸æ€ä»£ç ï¼ŒCPU å¯„å­˜å™¨éœ€è¦æ›´æ–°ä¸ºå†…æ ¸æ€æŒ‡ä»¤çš„æ–°ä½ç½®ã€‚
3ã€è·³è½¬åˆ°å†…æ ¸æ€è¿è¡Œå†…æ ¸ä»»åŠ¡ã€‚
4ã€å½“ç³»ç»Ÿè°ƒç”¨ç»“æŸåï¼ŒCPU å¯„å­˜å™¨éœ€è¦æ¢å¤åŸæ¥ä¿å­˜çš„ç”¨æˆ·æ€ï¼Œç„¶åå†åˆ‡æ¢åˆ°ç”¨æˆ·ç©ºé—´ï¼Œç»§ç»­è¿è¡Œè¿›ç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥ï¼Œ&lt;strong&gt;ä¸€æ¬¡ç³»ç»Ÿè°ƒç”¨è¿‡ç¨‹ï¼Œå®é™…å‘ç”Ÿäº†ä¸¤æ¬¡CPUä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œç”¨æˆ·æ€ -&amp;gt; å†…æ ¸æ€ -&amp;gt; ç”¨æˆ·æ€ï¼Œä½†ç³»ç»Ÿè°ƒç”¨è¿‡ç¨‹ä¸­ï¼Œä¸ä¼šæ¶‰åŠè™šæ‹Ÿå†…å­˜ç­‰è¿›ç¨‹ç”¨æˆ·æ€çš„èµ„æºï¼Œä¹Ÿä¸ä¼šåˆ‡æ¢è¿›ç¨‹ï¼Œç³»ç»Ÿè°ƒç”¨è¿‡ç¨‹ä¸­ä¸€ç›´æ˜¯åŒä¸€ä¸ªè¿›ç¨‹åœ¨è¿è¡Œ&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ç³»ç»Ÿè°ƒç”¨ é€šå¸¸ä¹Ÿç§°ä¸º ç‰¹æƒæ¨¡å¼åˆ‡æ¢ï¼Œ&lt;strong&gt;ç³»ç»Ÿè°ƒç”¨å±äºåŒè¿›ç¨‹å†…çš„CPUä¸Šä¸‹æ–‡åˆ‡æ¢&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢æŒ‡çš„æ˜¯ä¸¤ä¸ªä¸åŒçš„è¿›ç¨‹é—´çš„åˆ‡æ¢&lt;/strong&gt;ï¼›&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;è¿›ç¨‹æ˜¯ç”±å†…æ ¸æ¥ç®¡ç†å’Œè°ƒåº¦çš„ï¼Œè¿›ç¨‹çš„åˆ‡æ¢åªèƒ½å‘ç”Ÿåœ¨å†…æ ¸æ€ã€‚æ‰€ä»¥ï¼Œè¿›ç¨‹çš„ä¸Šä¸‹æ–‡ä¸ä»…åŒ…æ‹¬äº†è™šæ‹Ÿå†…å­˜ã€æ ˆã€å…¨å±€å˜é‡ç­‰ç”¨æˆ·ç©ºé—´çš„èµ„æºï¼Œè¿˜åŒ…æ‹¬äº†å†…æ ¸å †æ ˆã€å¯„å­˜å™¨ç­‰å†…æ ¸ç©ºé—´çš„çŠ¶æ€ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;è¿›ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å°±æ¯”ç³»ç»Ÿè°ƒç”¨æ—¶å¤šäº†ä¸€æ­¥ï¼šåœ¨ä¿å­˜å†…æ ¸æ€èµ„æºï¼ˆå½“å‰è¿›ç¨‹çš„å†…æ ¸çŠ¶æ€å’Œ CPU å¯„å­˜å™¨ï¼‰ä¹‹å‰ï¼Œéœ€è¦å…ˆæŠŠè¯¥è¿›ç¨‹çš„ç”¨æˆ·æ€èµ„æºï¼ˆè™šæ‹Ÿå†…å­˜ã€æ ˆç­‰ï¼‰ä¿å­˜ä¸‹æ¥ï¼›è€ŒåŠ è½½äº†ä¸‹ä¸€è¿›ç¨‹çš„å†…æ ¸æ€åï¼Œè¿˜éœ€è¦åˆ·æ–°è¿›ç¨‹çš„è™šæ‹Ÿå†…å­˜å’Œç”¨æˆ·æ ˆï¼Œè¿™ä¸ªè¿‡ç¨‹å°±æ¯”è¾ƒè€—èµ„æºäº†ã€‚&lt;/p&gt;
&lt;p&gt;å‘ç”Ÿè¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢çš„åœºæ™¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;CPUå°†æ—¶é—´ç‰‡è½®æµåˆ†é…ç»™å„ä¸ªè¿›ç¨‹ï¼Œå½“æŸä¸ªè¿›ç¨‹çš„æ—¶é—´ç‰‡è¢«è€—å°½ï¼Œå°±ä¼šè¢«ç³»ç»ŸæŒ‚èµ·ï¼Œåˆ‡æ¢åˆ°å…¶ä»–æ­£åœ¨ç­‰å¾…CPUæ‰§è¡Œçš„è¿›ç¨‹ï¼›&lt;/li&gt;
&lt;li&gt;è¿›ç¨‹åœ¨ç³»ç»Ÿèµ„æºä¸è¶³ï¼ˆæ¯”å¦‚å†…å­˜ä¸è¶³ï¼‰æ—¶è¿›è¡Œç­‰å¾…ï¼Œæ­¤æ—¶ä¼šè¢«CPUæŒ‚èµ·ï¼Œå¹¶ç”±ç³»ç»Ÿè°ƒåº¦å…¶ä»–è¿›ç¨‹è¿è¡Œï¼›&lt;/li&gt;
&lt;li&gt;å½“è¿›ç¨‹é€šè¿‡sleepå‡½æ•°ä¸»åŠ¨æŒ‚èµ·ï¼Œæ­¤æ—¶ä¼šé‡æ–°è°ƒåº¦ï¼›&lt;/li&gt;
&lt;li&gt;å½“æœ‰ä¼˜å…ˆçº§æ›´é«˜çš„è¿›ç¨‹è¿è¡Œæ—¶ï¼Œä¸ºäº†ä¿è¯é«˜ä¼˜å…ˆçº§è¿›ç¨‹çš„è¿è¡Œï¼Œå½“å‰è¿›ç¨‹ä¼šè¢«æŒ‚èµ·ï¼Œç”±é«˜ä¼˜å…ˆçº§è¿›ç¨‹æ¥è¿è¡Œï¼›&lt;/li&gt;
&lt;li&gt;å‘ç”Ÿç¡¬ä»¶ä¸­æ–­æ—¶ï¼ŒCPUä¸Šçš„è¿›ç¨‹è¢«ä¸­æ–­æŒ‚èµ·ï¼Œè½¬è€Œæ‰§è¡Œå†…æ ¸ä¸­çš„ä¸­æ–­æœåŠ¡ç¨‹åºï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢&#34;&gt;çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;å†…æ ¸ä¸­çš„ä»»åŠ¡è°ƒåº¦ï¼Œå®é™…ä¸Šè°ƒåº¦çš„æ˜¯çº¿ç¨‹ï¼Œè€Œè¿›ç¨‹åªæ˜¯ç»™çº¿ç¨‹æä¾›äº†å…±äº«çš„è™šæ‹Ÿå†…å­˜ï¼Œå…¨å±€å˜é‡ç­‰èµ„æº&lt;/strong&gt;ï¼Œçº¿ç¨‹æœ¬èº«ä¹Ÿæœ‰è‡ªå·±çš„æ ˆå’Œå¯„å­˜å™¨ï¼Œåœ¨ä¸Šä¸‹æ–‡åˆ‡æ¢æ—¶ä¹Ÿè¦ä¿å­˜ã€‚&lt;/p&gt;
&lt;p&gt;åˆ‡æ¢åœºæ™¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å‰åä¸¤ä¸ªå±äºä¸åŒè¿›ç¨‹çš„çº¿ç¨‹ï¼Œå› ä¸ºèµ„æºä¸å…±äº«ï¼Œåœ¨åˆ‡æ¢è¿‡ç¨‹å°±è·Ÿè¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ä¸€æ ·ï¼›&lt;/li&gt;
&lt;li&gt;å‰åä¸¤ä¸ªå±äºåŒä¸€è¿›ç¨‹çš„çº¿ç¨‹ï¼Œå› ä¸ºè™šæ‹Ÿå†…å­˜æ˜¯å…±äº«çš„ï¼Œåœ¨åˆ‡æ¢æ—¶ï¼Œè™šæ‹Ÿå†…å­˜è¿™äº›èµ„æºä¿å­˜ä¸åŠ¨ï¼Œåªéœ€åˆ‡æ¢çº¿ç¨‹çš„ç§æœ‰æ•°æ®ã€å¯„å­˜å™¨ç­‰ä¸å…±äº«çš„æ•°æ®ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;ä¸­æ–­ä¸Šä¸‹æ–‡åˆ‡æ¢&#34;&gt;ä¸­æ–­ä¸Šä¸‹æ–‡åˆ‡æ¢&lt;/h3&gt;
&lt;p&gt;ç¡¬ä¸­æ–­ï¼šå¤„ç†ç¡¬ä»¶è¯·æ±‚ï¼Œè´Ÿè´£è€—æ—¶çŸ­çš„ä»»åŠ¡ï¼Œå¿«é€Ÿæ‰§è¡Œï¼Œä¼šæ‰“æ–­å½“å‰æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡ï¼Œç«‹å³æ‰§è¡Œä¸­æ–­ï¼›&lt;/p&gt;
&lt;p&gt;è½¯ä¸­æ–­ï¼šç”±å†…æ ¸è§¦å‘ï¼Œè´Ÿè´£ç¡¬ä¸­æ–­ä¸­æœªå®Œæˆçš„å·¥ä½œæˆ–è€…å†…æ ¸å®šä¹‰çš„ä¸€äº›ä¸­æ–­äº‹ä»¶ï¼Œé€šå¸¸æ˜¯è€—æ—¶æ¯”è¾ƒé•¿çš„äº‹æƒ…ï¼Œå»¶è¿Ÿæ‰§è¡Œï¼›Linuxçš„è½¯ä¸­æ–­åŒ…æ‹¬ç½‘ç»œæ”¶å‘ã€å®šæ—¶ã€è°ƒåº¦ã€RCUé”ç­‰å„ç§ç±»å‹&lt;/p&gt;
&lt;p&gt;ä¸ºäº†å¿«é€Ÿå“åº”ç¡¬ä»¶çš„äº‹ä»¶ï¼Œ&lt;strong&gt;ä¸­æ–­å¤„ç†ä¼šæ‰“æ–­è¿›ç¨‹çš„æ­£å¸¸è°ƒåº¦å’Œæ‰§è¡Œï¼Œè½¬è€Œè°ƒç”¨ä¸­æ–­å¤„ç†ç¨‹åºï¼Œå“åº”è®¾å¤‡äº‹ä»¶&lt;/strong&gt;ã€‚è€Œåœ¨æ‰“æ–­å…¶ä»–è¿›ç¨‹æ—¶ï¼Œå°±éœ€è¦å°†è¿›ç¨‹å½“å‰çš„çŠ¶æ€ä¿å­˜ä¸‹æ¥ï¼Œè¿™æ ·åœ¨ä¸­æ–­ç»“æŸåï¼Œè¿›ç¨‹ä»ç„¶å¯ä»¥ä»åŸæ¥çš„çŠ¶æ€æ¢å¤è¿è¡Œã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;è·Ÿè¿›ç¨‹ä¸Šä¸‹æ–‡ä¸åŒï¼Œä¸­æ–­ä¸Šä¸‹æ–‡åˆ‡æ¢å¹¶ä¸æ¶‰åŠåˆ°è¿›ç¨‹çš„ç”¨æˆ·æ€&lt;/strong&gt;ã€‚æ‰€ä»¥ï¼Œå³ä¾¿ä¸­æ–­è¿‡ç¨‹æ‰“æ–­äº†ä¸€ä¸ªæ­£å¤„åœ¨ç”¨æˆ·æ€çš„è¿›ç¨‹ï¼Œä¹Ÿä¸éœ€è¦ä¿å­˜å’Œæ¢å¤è¿™ä¸ªè¿›ç¨‹çš„è™šæ‹Ÿå†…å­˜ã€å…¨å±€å˜é‡ç­‰ç”¨æˆ·æ€èµ„æºã€‚ä¸­æ–­ä¸Šä¸‹æ–‡ï¼Œå…¶å®åªåŒ…æ‹¬å†…æ ¸æ€ä¸­æ–­æœåŠ¡ç¨‹åºæ‰§è¡Œæ‰€å¿…éœ€çš„çŠ¶æ€ï¼ŒåŒ…æ‹¬ CPU å¯„å­˜å™¨ã€å†…æ ¸å †æ ˆã€ç¡¬ä»¶ä¸­æ–­å‚æ•°ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å¯¹åŒä¸€ä¸ª CPU æ¥è¯´ï¼Œä¸­æ–­å¤„ç†æ¯”è¿›ç¨‹æ‹¥æœ‰æ›´é«˜çš„ä¼˜å…ˆçº§&lt;/strong&gt;ï¼Œæ‰€ä»¥ä¸­æ–­ä¸Šä¸‹æ–‡åˆ‡æ¢å¹¶ä¸ä¼šä¸è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢åŒæ—¶å‘ç”Ÿã€‚&lt;/p&gt;
&lt;h2 id=&#34;åŒæ­¥åŸè¯­&#34;&gt;åŒæ­¥åŸè¯­&lt;/h2&gt;
&lt;p&gt;å¸¸è§çš„æœ‰ï¼šåŸå­æ“ä½œã€æ§åˆ¶ä¸­æ–­ã€è‡ªæ—‹é”ã€ä¿¡å·é‡ã€‚åº•å±‚åŸå­æ“ä½œéƒ½æ˜¯ä¾é æ”¯æŒåŸå­æ“ä½œçš„æœºå™¨æŒ‡ä»¤çš„ç¡¬ä»¶å®ç°ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;åŸå­æ“ä½œæ˜¯å¯¹å•ä¸€å˜é‡ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ§åˆ¶ä¸­æ–­ï¼šå¯ä»¥ä½œç”¨å¤æ‚å˜é‡ï¼Œä¸€èˆ¬ç”¨åœ¨å•æ ¸CPUï¼ŒåŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªä»£ç æ‰§è¡Œæµï¼Œå“åº”ä¸­æ–­ä¼šå¯¼è‡´ä»£ç æ‰§è¡Œæµåˆ‡æ¢ï¼Œæ­¤æ—¶å¦‚æœä¸¤ä¸ªä»£ç æ‰§è¡Œæµæ“ä½œåˆ°åŒä¸€ä¸ªå…¨å±€å˜é‡å°±ä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´ï¼Œæ‰€ä»¥éœ€è¦åœ¨æ“ä½œå…¨å±€å˜é‡æ—¶å…³é—­ä¸­æ–­ï¼Œå¤„ç†å®Œå¼€å¯è¿›è¡Œæ§åˆ¶ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è‡ªæ—‹é”è¿˜æœ‰ä¸€ä¸ªä½œç”¨å°±æ˜¯å¯ä»¥åœ¨å¤šæ ¸CPUä¸‹å¤„ç†å…¨å±€å˜é‡ï¼Œå› ä¸ºæ§åˆ¶ä¸­æ–­åªèƒ½æ§åˆ¶æœ¬åœ°CPUçš„ä¸­æ–­ï¼Œæ— æ³•æ§åˆ¶å…¶ä»–CPUæ ¸å¿ƒçš„ä¸­æ–­ï¼Œæ­¤æ—¶å…¶ä»–CPUæ˜¯å¯ä»¥æ“ä½œåˆ°è¯¥å…¨å±€å˜é‡çš„ã€‚è‡ªæ—‹éœ€è¦ä¿è¯è¯»å–é”å˜é‡å’Œåˆ¤æ–­å¹¶åŠ é”æ“ä½œæ˜¯åŸå­çš„ï¼Œä¸”ä¼šå¯¼è‡´CPUç©ºè½¬ä¸€æ®µæ—¶é—´ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¿¡å·é‡çš„ä¸€ä¸ªä½œç”¨å°±æ˜¯è§£å†³è‡ªæ—‹é”ç©ºè½¬é€ æˆCPUèµ„æºæµªè´¹çš„ç¼ºç‚¹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;linuxåˆå§‹åŒ–&#34;&gt;Linuxåˆå§‹åŒ–&lt;/h1&gt;
&lt;h2 id=&#34;å¼•å¯¼-boot&#34;&gt;å¼•å¯¼ boot&lt;/h2&gt;
&lt;p&gt;ä¹Ÿæ˜¯æœºå™¨åŠ ç”µï¼ŒBIOSè‡ªæ£€ï¼ŒBIOSåŠ è½½å¼•å¯¼æ‰‡åŒºï¼ŒåŠ è½½GRUBå¼•å¯¼ç¨‹åºï¼Œæœ€åç”±GRUBåŠ è½½Linuxå†…æ ¸é•œåƒvmlinuzã€‚&lt;/p&gt;
&lt;p&gt;CPUè¢«è®¾è®¡æˆåªèƒ½è¿è¡Œå†…å­˜ä¸­çš„ç¨‹åºï¼Œæ— æ³•ç›´æ¥è¿è¡Œå­˜å‚¨åœ¨ç¡¬ç›˜æˆ–Uç›˜ä¸­çš„æ“ä½œç³»ç»Ÿç¨‹åºï¼Œå› ä¸ºç¡¬ç›˜Uç›˜ç­‰å¤–éƒ¨å­˜å‚¨å¹¶ä¸å’ŒCPUç›´æ¥ç›¸è¿ï¼Œè®¿é—®æœºåˆ¶å’Œå¯»å€æ–¹å¼ä¸å†…å­˜ä¸ä¸€æ ·ã€‚å¦‚æœè¦è¿è¡Œç¡¬ç›˜æˆ–Uç›˜ä¸­çš„ç¨‹åºï¼Œå°±å¿…é¡»å…ˆåŠ è½½åˆ°å†…å­˜ã€‚&lt;/p&gt;
&lt;p&gt;ç”±äºå†…å­˜RAMæ–­ç”µä¼šä¸¢å¤±æ•°æ®ï¼ŒBIOSä¸æ˜¯å­˜å‚¨åœ¨æ™®é€šçš„å†…å­˜ä¸­çš„ï¼Œè€Œæ˜¯å­˜å‚¨åœ¨ä¸»æ¿ä¸Šç‰¹å®šçš„ä¸€å—ROMå†…å­˜ä¸­ï¼Œåœ¨ç¡¬ä»¶è®¾è®¡ä¸Šè§„å®šåŠ ç”µç¬é—´ï¼Œå¼ºåˆ¶å°†CSå¯„å­˜å™¨çš„å€¼è®¾ç½®ä½0xF000ï¼ŒIPå¯„å­˜å™¨çš„å€¼è®¾ç½®ä¸º0xFFF0ï¼Œè¯¥åœ°å€å°±æ˜¯BIOSçš„å¯åŠ¨åœ°å€äº†ã€‚&lt;/p&gt;
&lt;p&gt;BIOSåœ¨åˆå§‹åŒ–CPUå’Œå†…å­˜åè¿›è¡Œæ£€æŸ¥ï¼Œå®Œäº†ä¹‹åå°†è‡ªå·±çš„ä¸€éƒ¨åˆ†å¤åˆ¶åˆ°å†…å­˜ï¼Œæœ€åè·³è½¬åˆ°å†…å­˜ä¸­è¿è¡Œã€‚ä¹‹åæšä¸¾æœ¬åœ°è®¾å¤‡è¿›è¡Œæ£€æŸ¥å’Œåˆå§‹åŒ–ï¼Œè°ƒç”¨è®¾å¤‡çš„å›ºä»¶ç¨‹åºã€‚å½“è®¾å¤‡å®Œæˆæ£€æŸ¥å’Œåˆå§‹åŒ–åï¼ŒBIOSå°±ä¼šåœ¨å†…å­˜ä¸­åˆ’å®šä¸€ä¸ªåœ°å€èŒƒå›´ï¼Œå­˜æ”¾å’Œå»ºç«‹ä¸­æ–­è¡¨å’Œä¸­æ–­æœåŠ¡ç¨‹åºã€‚&lt;/p&gt;
&lt;p&gt;ä¸€èˆ¬æˆ‘ä»¬ä¼šæŠŠLinuxé•œåƒæ”¾åœ¨ç¡¬ç›˜çš„ç¬¬ä¸€ä¸ªæ‰‡åŒºä¸­ï¼ˆMBRä¸»å¯åŠ¨è®°å½•ï¼ŒåŒ…å«åŸºæœ¬çš„GRUBå¯åŠ¨ç¨‹åºå’Œåˆ†åŒºè¡¨ï¼‰ï¼Œç„¶åè®©ç¡¬ç›˜ä½œä¸ºBIOSå¯åŠ¨åæœç´¢åˆ°çš„ç¬¬ä¸€ä¸ªè®¾å¤‡ï¼Œå½“MBRè¢«BIOSè£…è½½åˆ°0x7c00åœ°å€å¼€å§‹çš„å†…å­˜ç©ºé—´ä¸­ï¼ŒBIOSä¼šæŠŠæ§åˆ¶æƒäº¤ç»™MBRï¼Œå³GRUBã€‚&lt;/p&gt;
&lt;p&gt;GRUBæ‰€åœ¨çš„ç¬¬ä¸€ä¸ªæ‰‡åŒºï¼Œåªæœ‰512ä¸ªå­—èŠ‚ï¼Œä¸è¶³ä»¥è£…ä¸‹GRUBè¿™ç§å¤§å‹çš„é€šç”¨å¼•å¯¼å™¨ï¼Œå› æ­¤GRUBçš„åŠ è½½è¢«åˆ†æˆäº†å¤šä¸ªæ­¥éª¤å’Œå¤šä¸ªæ–‡ä»¶ï¼Œåœ¨å¯åŠ¨æ—¶åŠ¨æ€åŠ è½½ï¼Œå…ˆåŠ è½½diskboot.imgï¼Œç„¶åè¯»å–å‰©ä¸‹çš„core.imgï¼Œè¯†åˆ«å‡ºæ–‡ä»¶ç³»ç»Ÿï¼Œä½¿å…¶èƒ½å¤Ÿè®¿é—®/boot/grubç›®å½•ï¼Œæœ€ååŠ è½½vmlinuzå†…æ ¸æ–‡ä»¶ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å¯åŠ¨-startup&#34;&gt;å¯åŠ¨ startup&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;1.GRUB åŠ è½½ vmlinuz æ–‡ä»¶ä¹‹åï¼Œä¼šæŠŠæ§åˆ¶æƒäº¤ç»™ vmlinuz æ–‡ä»¶çš„ setup.bin çš„éƒ¨åˆ†ä¸­ _startï¼Œå®ƒä¼šè®¾ç½®å¥½æ ˆï¼Œæ¸…ç©º bssï¼Œè®¾ç½®å¥½ setup_header ç»“æ„ï¼Œè°ƒç”¨ 16 ä½ main ï¼Œè°ƒç”¨BIOSä¸­æ–­ï¼Œè¿›è¡Œåˆå§‹åŒ–è®¾ç½®ï¼ŒåŒ…æ‹¬consoleã€å †ã€CPUæ¨¡å¼ã€å†…å­˜ã€é”®ç›˜ã€APMã€æ˜¾å¡æ¨¡å¼ç­‰ï¼Œç„¶ååˆ‡æ¢åˆ°ä¿æŠ¤æ¨¡å¼ï¼Œæœ€åè·³è½¬åˆ° 1MB å¤„çš„ vmlinux.bin æ–‡ä»¶ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;2.ä» vmlinux.bin æ–‡ä»¶ä¸­ startup32ã€startup64 å‡½æ•°å¼€å§‹å»ºç«‹æ–°çš„å…¨å±€æ®µæè¿°ç¬¦è¡¨å’Œ MMU é¡µè¡¨ï¼Œåˆ‡æ¢åˆ°é•¿æ¨¡å¼ä¸‹è§£å‹ vmlinux.bin.gzã€‚é‡Šæ”¾å‡º vmlinux æ–‡ä»¶ä¹‹åï¼Œç”±è§£æ elf æ ¼å¼çš„å‡½æ•°è¿›è¡Œè§£æï¼Œé‡Šæ”¾ vmlinux ä¸­çš„ä»£ç æ®µå’Œæ•°æ®æ®µåˆ°æŒ‡å®šçš„å†…å­˜ã€‚ç„¶åè°ƒç”¨å…¶ä¸­çš„ startup_64 å‡½æ•°ï¼Œåœ¨è¿™ä¸ªå‡½æ•°çš„æœ€åè°ƒç”¨ Linux å†…æ ¸çš„ç¬¬ä¸€ä¸ª C å‡½æ•°ã€‚
3.Linux å†…æ ¸ç¬¬ä¸€ä¸ª C å‡½æ•°é‡æ–°è®¾ç½® MMU é¡µè¡¨ï¼Œéšåä¾¿è°ƒç”¨ start_kernel å‡½æ•°ï¼Œ start_kernel å‡½æ•°ä¸­è°ƒç”¨äº†å¤§å¤šæ•° Linux å†…æ ¸åŠŸèƒ½æ€§åˆå§‹åŒ–å‡½æ•°ï¼Œåœ¨æœ€åè°ƒç”¨ rest_init å‡½æ•°å»ºç«‹äº†ä¸¤ä¸ªå†…æ ¸çº¿ç¨‹ï¼Œåœ¨å…¶ä¸­çš„ kernel_init çº¿ç¨‹å»ºç«‹äº†ç¬¬ä¸€ä¸ªç”¨æˆ·æ€è¿›ç¨‹&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/Linux%e5%88%9d%e5%a7%8b%e5%8c%96%e8%a6%81%e7%82%b9.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/Linux%e5%88%9d%e5%a7%8b%e5%8c%96%e8%a6%81%e7%82%b9.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			alt=&#34;Linuxåˆå§‹åŒ–è¦ç‚¹&#34;&gt;
	&lt;/a&gt;
	
	&lt;figcaption&gt;Linuxåˆå§‹åŒ–è¦ç‚¹&lt;/figcaption&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;h1 id=&#34;å†…å­˜ç®¡ç†&#34;&gt;å†…å­˜ç®¡ç†&lt;/h1&gt;
&lt;h2 id=&#34;è™šæ‹Ÿåœ°å€&#34;&gt;è™šæ‹Ÿåœ°å€&lt;/h2&gt;
&lt;p&gt;ç”±äºå„ä¸ªåº”ç”¨ç¨‹åºç”±ä¸åŒçš„å…¬å¸å¼€å‘ï¼Œä¸”æ¯å°è®¡ç®—æœºçš„å†…å­˜å®¹é‡éƒ½ä¸ä¸€æ ·ï¼Œå¦‚æœåº”ç”¨ç¨‹åºåœ¨è¿è¡Œæ—¶ä½¿ç”¨çš„æ˜¯çœŸå®åœ°å€ï¼Œå°†ä¼šå¯¼è‡´å„ä¸ªåº”ç”¨ç¨‹åºåœ¨ä½¿ç”¨å†…å­˜åœ°å€æ—¶äº§ç”Ÿå†²çªã€‚ä¸ºäº†è§£è€¦å†…å­˜çœŸå®åœ°å€å’Œåº”ç”¨ä½¿ç”¨çš„å†…å­˜åœ°å€ï¼Œå¯¹ä¸åŒçš„åº”ç”¨ç¨‹åºä½¿ç”¨çš„å†…å­˜è¿›è¡Œéš”ç¦»å’Œä¿æŠ¤ï¼Œå¼•å‡ºè™šæ‹Ÿåœ°å€æ¦‚å¿µã€‚&lt;/p&gt;
&lt;p&gt;è™šæ‹Ÿåœ°å€ï¼šè®©æ¯ä¸ªåº”ç”¨ç¨‹åºéƒ½å„è‡ªäº«æœ‰ä¸€ä¸ªä»0å¼€å§‹åˆ°æœ€å¤§åœ°å€çš„ç©ºé—´ï¼Œåœ¨æ¯ä¸ªåº”ç”¨ç¨‹åºç‹¬ç«‹ä¸”ç§æœ‰ï¼Œå…¶ä»–åº”ç”¨ç¨‹åºæ— æ³•è§‚å¯Ÿåˆ°ï¼Œå†ç”±æ“ä½œç³»ç»Ÿå°†è™šæ‹Ÿåœ°å€æ˜ å°„æˆçœŸå®çš„ç‰©ç†åœ°å€ï¼Œå®ç°å†…å­˜çš„ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;è™šæ‹Ÿåœ°å€ç”±é“¾æ¥å™¨äº§ç”Ÿï¼Œåº”ç”¨ç¨‹åºç»è¿‡ç¼–è¯‘åé€šè¿‡é“¾æ¥å™¨çš„å¤„ç†å˜æˆå¯æ‰§è¡Œæ–‡ä»¶ï¼Œé“¾æ¥å™¨ä¼šå¤„ç†ç¨‹åºä»£ç é—´çš„åœ°å€å¼•ç”¨ï¼Œå½¢æˆç¨‹åºè¿è¡Œçš„é™æ€å†…å­˜ç©ºé—´è§†å›¾ã€‚&lt;/p&gt;
&lt;p&gt;å®æ¨¡å¼ä¸‹ï¼Œå¤šä¸ªè¿›ç¨‹å…±äº«æ‰€æœ‰åœ°å€ç©ºé—´å¤ªè¿‡å±é™©ï¼Œå› æ­¤æœ‰äº†ä¿æŠ¤æ¨¡å¼ï¼Œä¿æŠ¤æ¨¡å¼ä¸‹ä¸ºäº†è®©å„ä¸ªåº”ç”¨ç¨‹åºèƒ½æ­£ç¡®ä½¿ç”¨å†…å­˜ï¼Œä½¿ç”¨äº†è™šæ‹Ÿåœ°å€æ˜ å°„ï¼Œè®©å„ä¸ªåº”ç”¨ç¨‹åºéƒ½æœ‰è‡ªå·±çš„åœ°å€ç©ºé—´ï¼Œå› æ­¤è®¿é—®å†…å­˜æ—¶ä¸ç”¨è€ƒè™‘å…¶ä»–é—®é¢˜ï¼Œè®¿é—®æ—¶å†ç»è¿‡MMUç¿»è¯‘å¾—åˆ°å¯¹åº”çš„é¡µè¡¨ï¼Œä¸åŒçš„åº”ç”¨ç¨‹åºç”±äºä¸åŒçš„é¡µè¡¨ï¼Œäº§ç”Ÿäº†è¿›ç¨‹åœ°å€ç©ºé—´éš”ç¦»ï¼Œä½†å¤šä¸ªåº”ç”¨ç¨‹åºä¹Ÿå¯ä»¥å…±äº«æŸä¸ªé¡µè¡¨ï¼Œæ­¤æ—¶å°±æ¶‰åŠè¿›ç¨‹é—´çš„é€šä¿¡äº†ã€‚&lt;/p&gt;
&lt;p&gt;å…³äºå†…å­˜å¯¹é½ï¼šå› ä¸ºcpuæ€»æ˜¯ä»¥å¤šä¸ªå­—èŠ‚çš„å—ä¸ºå•ä½è®¿é—®å†…å­˜çš„ï¼Œä¸ä¸å®ƒçš„è®¿é—®å—åœ°å€è¾¹ç•Œå¯¹é½cpuå°±è¦å¤šæ¬¡è®¿é—®ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;è™šæ‹Ÿå†…å­˜æœ‰ä¸‰ä¸ªç‰¹å¾ï¼šå¤šæ¬¡æ€§ã€å¯¹æ¢æ€§ã€è™šæ‹Ÿæ€§ã€‚å®ƒå°†ç¨‹åºåˆ†å¤šæ¬¡è°ƒå…¥å†…å­˜ï¼Œä½¿å¾—åœ¨è¾ƒå°çš„ç”¨æˆ·ç©ºé—´å¯ä»¥æ‰§è¡Œè¾ƒå¤§çš„ç”¨æˆ·ç¨‹åºï¼Œæ‰€ä»¥åŒæ—¶å®¹çº³æ›´å¤šè¿›ç¨‹å¹¶å‘æ‰§è¡Œï¼Œä»è€Œæé«˜ç³»ç»Ÿååé‡ï¼›å‘ç”Ÿç¼ºé¡µæ—¶å–å†³äºå†…å­˜çš„å­˜å‚¨ç®¡ç†æ–¹å¼ï¼Œå¯ä»¥è°ƒå…¥ä¸€ä¸ªæ®µï¼Œä¹Ÿå¯ä»¥è°ƒå…¥ä¸€ä¸ªé¡µï¼›è™šæ‹Ÿæ€§è¡¨ç¤ºè™šæ‹Ÿå†…å­˜å’Œç‰©ç†å†…å­˜çš„æ˜ å°„ã€‚&lt;/p&gt;
&lt;p&gt;è™šæ‹Ÿå†…å­˜çš„æ ¸å¿ƒåŸç†æ˜¯ï¼šä¸ºæ¯ä¸ªç¨‹åºè®¾ç½®ä¸€æ®µ&amp;quot;è¿ç»­&amp;quot;çš„è™šæ‹Ÿåœ°å€ç©ºé—´ï¼ŒæŠŠè¿™ä¸ªåœ°å€ç©ºé—´åˆ†å‰²æˆå¤šä¸ªå…·æœ‰è¿ç»­åœ°å€èŒƒå›´çš„é¡µ (page)ï¼Œå¹¶æŠŠè¿™äº›é¡µå’Œç‰©ç†å†…å­˜åšæ˜ å°„ï¼Œåœ¨ç¨‹åºè¿è¡ŒæœŸé—´åŠ¨æ€æ˜ å°„åˆ°ç‰©ç†å†…å­˜ï¼ˆé€šè¿‡MMUç®¡ç†ï¼‰ã€‚å½“ç¨‹åºå¼•ç”¨åˆ°ä¸€æ®µåœ¨ç‰©ç†å†…å­˜çš„åœ°å€ç©ºé—´æ—¶ï¼Œç”±ç¡¬ä»¶ç«‹åˆ»æ‰§è¡Œå¿…è¦çš„æ˜ å°„ï¼›è€Œå½“ç¨‹åºå¼•ç”¨åˆ°ä¸€æ®µä¸åœ¨ç‰©ç†å†…å­˜ä¸­çš„åœ°å€ç©ºé—´æ—¶ï¼Œç”±æ“ä½œç³»ç»Ÿè´Ÿè´£å°†ç¼ºå¤±çš„éƒ¨åˆ†è£…å…¥ç‰©ç†å†…å­˜å¹¶é‡æ–°æ‰§è¡Œå¤±è´¥çš„æŒ‡ä»¤ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨è¿›ç¨‹è¿è¡ŒæœŸé—´åªåˆ†é…æ˜ å°„å½“å‰ä½¿ç”¨åˆ°çš„å†…å­˜ï¼Œæš‚æ—¶ä¸ä½¿ç”¨çš„æ•°æ®åˆ™å†™å›ç£ç›˜ä½œä¸ºå‰¯æœ¬ä¿å­˜ï¼Œéœ€è¦ç”¨çš„æ—¶å€™å†è¯»å…¥å†…å­˜ï¼ŒåŠ¨æ€åœ°åœ¨ç£ç›˜å’Œå†…å­˜ä¹‹é—´äº¤æ¢æ•°æ®ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœåˆ†é…åçš„è™šæ‹Ÿå†…å­˜æ²¡æœ‰è¢«è®¿é—®çš„è¯ï¼Œè™šæ‹Ÿå†…å­˜æ˜¯ä¸ä¼šæ˜ å°„åˆ°ç‰©ç†å†…å­˜çš„ï¼Œè¿™æ ·å°±ä¸ä¼šå ç”¨ç‰©ç†å†…å­˜äº†ã€‚&lt;/p&gt;
&lt;p&gt;åªæœ‰åœ¨è®¿é—®å·²åˆ†é…çš„è™šæ‹Ÿåœ°å€ç©ºé—´çš„æ—¶å€™ï¼Œæ“ä½œç³»ç»Ÿé€šè¿‡æŸ¥æ‰¾é¡µè¡¨ï¼Œå‘ç°è™šæ‹Ÿå†…å­˜å¯¹åº”çš„é¡µæ²¡æœ‰åœ¨ç‰©ç†å†…å­˜ä¸­ï¼Œå°±ä¼šè§¦å‘ç¼ºé¡µä¸­æ–­ï¼Œç„¶åè¿›ç¨‹ä¼šä»ç”¨æˆ·æ€åˆ‡æ¢åˆ°å†…æ ¸æ€ï¼Œå°†ç¼ºé¡µä¸­æ–­äº¤ç»™å†…æ ¸çš„ç¼ºé¡µä¸­æ–­å‡½æ•°ï¼Œè¯¥å‡½æ•°ä¼šæ£€æŸ¥æ˜¯å¦æœ‰ç©ºé—²çš„ç‰©ç†å†…å­˜ï¼Œå¦‚æœæœ‰ï¼Œå°±è¿›è¡Œåˆ†é…ï¼Œå»ºç«‹è™šæ‹Ÿå†…å­˜å’Œç‰©ç†å†…å­˜ä¹‹é—´çš„æ˜ å°„å…³ç³»ï¼Œå¦‚æœæ²¡æœ‰ï¼Œå°±å›æ”¶ç©ºé—²å†…å­˜ï¼Œå¦‚æœå›æ”¶åä»ç„¶ä¸å¤Ÿåˆ†é…ï¼Œå°±ä¼šè§¦å‘OOMï¼Œè¯¥æœºåˆ¶ä¼šæ€æ­»ç‰©ç†å†…å­˜å ç”¨æœ€é«˜çš„è¿›ç¨‹ï¼Œä»¥é‡Šæ”¾å†…å­˜ï¼Œç›´åˆ°å†…å­˜è¶³å¤Ÿåˆ†é…ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;ä½œç”¨&#34;&gt;ä½œç”¨&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿å¾—è¿›ç¨‹å¯ä»¥å¯¹è¿è¡Œå†…å­˜ä½¿ç”¨è¶…è¿‡ç‰©ç†å†…å­˜çš„å¤§å°ï¼Œå¦‚æœè¶…å‡ºå†…å­˜å¤§å°ï¼Œä¼šä½¿ç”¨swapï¼ŒæŠŠä¸å¸¸ç”¨çš„å†…å­˜æ¢åˆ°ç£ç›˜&lt;/li&gt;
&lt;li&gt;æ¯ä¸ªè¿›ç¨‹æœ‰è‡ªå·±çš„é¡µè¡¨ï¼Œæ¯ä¸ªè¿›ç¨‹çš„è™šæ‹Ÿå†…å­˜å°±æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œè¿›ç¨‹ä¹Ÿæ²¡åŠæ³•è®¿é—®å…¶ä»–è¿›ç¨‹çš„é¡µè¡¨ï¼Œå±äºç§æœ‰é¡µè¡¨ï¼Œè§£å†³å¤šè¿›ç¨‹ä¹‹é—´åœ°å€å†²çªé—®é¢˜&lt;/li&gt;
&lt;li&gt;é¡µè¡¨é‡Œçš„é¡µè¡¨é¡¹é™¤äº†ç‰©ç†åœ°å€å¤–ï¼Œè¿˜æœ‰ä¸€äº›æ ‡è®°å±æ€§çš„æ¯”ç‰¹ï¼Œæ¯”å¦‚æ§åˆ¶ä¸€ä¸ªé¡µçš„è¯»å†™æƒé™ï¼Œæ ‡è®°è¯¥é¡µæ˜¯å¦å­˜åœ¨ï¼Œä¸ºæ“ä½œç³»ç»Ÿæä¾›æ›´å¥½çš„å®‰å…¨æ€§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;æ‰€éœ€è¦çš„æœ€åŸºç¡€çš„ç¡¬ä»¶æ”¯æŒ&#34;&gt;æ‰€éœ€è¦çš„æœ€åŸºç¡€çš„ç¡¬ä»¶æ”¯æŒ&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;ä¸€ä½ï¼Œç”¨äºç‰¹æƒæ¨¡å¼å’Œç”¨æˆ·æ¨¡å¼çš„åˆ‡æ¢&lt;/li&gt;
&lt;li&gt;åŸºå€å¯„å­˜å™¨ï¼šç”¨äºè™šæ‹Ÿåœ°å€ä¸ç‰©ç†åœ°å€çš„è½¬æ¢ï¼›ç•Œé™å¯„å­˜å™¨ï¼šç”¨äºåœ°å€çš„ç•Œé™æ£€æŸ¥ï¼Œé˜²æ­¢ç”¨æˆ·ç¨‹åºè®¿é—®åˆ°ä¸å±äºå®ƒçš„åœ°å€&lt;/li&gt;
&lt;li&gt;èƒ½è½¬æ¢è™šæ‹Ÿåœ°å€å¹¶æ£€æŸ¥å®ƒæ˜¯å¦è¶Šç•Œ&lt;/li&gt;
&lt;li&gt;ä¿®æ”¹åŸºå€/ç•Œé™å¯„å­˜å™¨çš„ç‰¹æƒæŒ‡ä»¤&lt;/li&gt;
&lt;li&gt;æ³¨å†Œå¼‚å¸¸å¤„ç†ç¨‹åºçš„ç‰¹æƒæŒ‡ä»¤&lt;/li&gt;
&lt;li&gt;èƒ½å¤Ÿè§¦å‘å¼‚å¸¸&lt;/li&gt;
&lt;li&gt;æ®µå¯„å­˜å™¨ï¼Œæ¯”å¦‚å‰ä¸¤ä½æ‹¿æ¥è¡¨ç¤ºä»€ä¹ˆç±»å‹çš„æ®µï¼Œæ¯”å¦‚æ ˆã€å †ã€ä»£ç åŒºï¼Œç”¨äºè®¡ç®—æ®µå†…çš„åç§»é‡ï¼Œé…åˆåŸºå€å¯„å­˜å™¨å’Œç•Œé™å¯„å­˜å™¨ï¼Œè®¡ç®—å‡ºè™šæ‹Ÿåœ°å€è¦æ˜ å°„çš„ç‰©ç†åœ°å€ï¼›è®¾ç½®ä¿æŠ¤ä½å®ç°ä»£ç æ®µå…±äº«ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;å†…å­˜åˆ’åˆ†ä¸ç»„ç»‡&#34;&gt;å†…å­˜åˆ’åˆ†ä¸ç»„ç»‡&lt;/h2&gt;
&lt;h3 id=&#34;å†…å­˜ç¢ç‰‡&#34;&gt;å†…å­˜ç¢ç‰‡&lt;/h3&gt;
&lt;p&gt;å†…éƒ¨å†…å­˜ç¢ç‰‡ï¼šç”±äºé‡‡ç”¨å›ºå®šå¤§å°çš„å†…å­˜åˆ†åŒºï¼Œå½“ä¸€ä¸ªè¿›ç¨‹ä¸èƒ½å®Œå…¨ä½¿ç”¨åˆ†ç»™å®ƒçš„å›ºå®šå†…å­˜åŒºåŸŸæ—¶å°±ä¼šäº§ç”Ÿå†…éƒ¨å†…å­˜ç¢ç‰‡ï¼Œè¿™é€šå¸¸éš¾ä»¥é¿å…ï¼›&lt;/p&gt;
&lt;p&gt;å¤–éƒ¨å†…å­˜ç¢ç‰‡ï¼šç”±äºæŸäº›æœªåˆ†é…çš„è¿ç»­å†…å­˜åŒºåŸŸå¤ªå°ï¼Œä»¥è‡³äºä¸èƒ½æ»¡è¶³ä»»æ„è¿›ç¨‹çš„å†…å­˜åˆ†é…è¯·æ±‚ï¼Œä»è€Œä¸èƒ½è¢«è¿›ç¨‹åˆ©ç”¨çš„å†…å­˜åŒºåŸŸï¼›&lt;/p&gt;
&lt;p&gt;å¦‚æœåªæ˜¯ç®€å•çš„é€šè¿‡åŸºå€å’Œç•Œé™å¯„å­˜å™¨ï¼Œå°†åˆ’åˆ†çš„è™šæ‹Ÿå†…å­˜åŒºåŸŸä¸€æ•´å—ç›´æ¥æ˜ å°„åˆ°ç‰©ç†å†…å­˜ï¼Œç”±äºè™šæ‹Ÿå†…å­˜å¹¶ä¸ä¼šå®Œå…¨ç”¨å®Œï¼Œä¸­é—´ä¼šç©ºå‡ºä¸€å°å—ï¼Œå¯¹åº”åˆ°ç‰©ç†å†…å­˜é‡Œä¹Ÿæ˜¯ï¼Œå¯¼è‡´å†…å­˜åˆ©ç”¨ç‡ä¸é«˜ï¼Œå†…å­˜ç¢ç‰‡çš„äº§ç”Ÿï¼Œæ‰€ä»¥æ‰æœ‰äº†åˆ†æ®µã€åˆ†é¡µã€æ®µé¡µå¼ç­‰çš„å†…å­˜åˆ†é…æ–¹æ¡ˆï¼›&lt;/p&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/%e8%99%9a%e6%8b%9f%e5%86%85%e5%ad%98%e7%9b%b4%e6%8e%a5%e6%98%a0%e5%b0%84.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/%e8%99%9a%e6%8b%9f%e5%86%85%e5%ad%98%e7%9b%b4%e6%8e%a5%e6%98%a0%e5%b0%84.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç°åœ¨æ™®éä½¿ç”¨æ®µé¡µå¼å†…å­˜åˆ†é…æ–¹æ¡ˆï¼Œå°†å†…å­˜åˆ†ä¸ºä¸åŒçš„æ®µï¼Œå†å°†æ¯ä¸€æ®µåˆ†æˆå›ºå®šå¤§å°çš„é¡µï¼Œé€šè¿‡é¡µè¡¨æœºåˆ¶ï¼Œä½¿å¾—æ®µå†…çš„é¡µå¯ä»¥ä¸å¿…è¿ç»­å¤„äºåŒä¸€å†…å­˜åŒºåŸŸï¼Œåªåˆ†é…å¿…è¦çš„å†…å­˜ï¼Œæå‡å†…å­˜ç©ºé—´çš„åˆ©ç”¨ç‡&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&#34;åˆ†æ®µ&#34;&gt;åˆ†æ®µ&lt;/h3&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/%e5%86%85%e5%ad%98%e5%88%86%e6%ae%b5.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/%e5%86%85%e5%ad%98%e5%88%86%e6%ae%b5.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;åœ°å€æ˜¯äºŒç»´çš„ï¼Œä¸€ç»´æ˜¯æ®µå·ï¼ŒäºŒç»´æ˜¯æ®µå†…åç§»é‡ï¼Œæ¯ä¸ªæ®µçš„é•¿åº¦ä¸ä¸€æ ·ï¼Œä¸”æ¯ä¸ªæ®µåç§»é‡éƒ½æ˜¯ä»0å¼€å§‹ç¼–å€ï¼Œé€šè¿‡æ®µå·æ‰¾åˆ°å¯¹åº”çš„æ®µå†…æè¿°ç¬¦ï¼Œå†é€šè¿‡æ®µåŸºåœ°å€ + æ®µå†…åç§»é‡ï¼Œæœ€ç»ˆç¡®å®šç‰©ç†å†…å­˜åœ°å€ï¼›&lt;/li&gt;
&lt;li&gt;åœ¨åˆ†æ®µç®¡ç†ä¸­ï¼Œæ¯ä¸ªæ®µå†…éƒ¨æ˜¯è¿ç»­çš„å†…å­˜åˆ†é…ï¼Œä½†æ˜¯æ®µä¸æ®µä¹‹é—´æ˜¯ç¦»æ•£åˆ†é…çš„ï¼Œå­˜åœ¨ä¸€ä¸ªé€»è¾‘åœ°å€åˆ°ç‰©ç†åœ°å€çš„æ˜ å°„ï¼Œå³æ®µè¡¨æœºåˆ¶ï¼›é€šè¿‡æ®µè¡¨å®ç°è™šæ‹Ÿåœ°å€ä¸ç‰©ç†åœ°å€çš„æ˜ å°„ï¼›&lt;/li&gt;
&lt;li&gt;æ®µçš„é•¿åº¦å¤§å°ä¸ä¸€ï¼Œå¯åŠ¨æ€æ”¹å˜ï¼Œå¥½å¤„æ˜¯éœ€è¦å¤šå°‘åˆ†é…å¤šå°‘ï¼Œäº§ç”Ÿè¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œåå¤„æ˜¯ä¸ä¾¿äºç”¨ä¸€ä¸ªç»Ÿä¸€çš„æ•°æ®ç»“æ„è¡¨ç¤ºï¼Œå®¹æ˜“äº§ç”Ÿå¤–éƒ¨å†…å­˜ç¢ç‰‡ï¼›&lt;/li&gt;
&lt;li&gt;äº§ç”Ÿå¤–éƒ¨å†…å­˜ç¢ç‰‡åï¼Œå¦‚æœäº§ç”Ÿå¤šä¸ªä¸è¿ç»­çš„å†…å­˜ç‰‡æ®µï¼Œè€Œæ–°çš„ç¨‹åºæ— æ³•ä½¿ç”¨å®ƒï¼Œå°±éœ€è¦è¿›è¡Œå†…å­˜äº¤æ¢ï¼Œå†…å­˜äº¤æ¢éœ€è¦ç”¨åˆ°ç£ç›˜ï¼Œå°±æ¶‰åŠåˆ°è®¿é—®é€Ÿåº¦çš„é—®é¢˜ï¼Œå†…å­˜äº¤æ¢çš„æ•ˆç‡å°±ä½ï¼›&lt;/li&gt;
&lt;li&gt;å†…å­˜ä¸è¶³æ—¶ï¼Œå†…å­˜æ•°æ®ä¼šå†™å›ç¡¬ç›˜æ¥é‡Šæ”¾å†…å­˜ï¼Œç”±äºæ®µçš„é•¿åº¦å¤§å°ä¸ä¸€ï¼Œæ¯æ®µçš„è¯»å†™æ—¶é—´å°±ä¼šä¸ä¸€æ ·ï¼Œå¯¼è‡´æ€§èƒ½æŠ–åŠ¨ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;åˆ†æ®µä¸»è¦æ˜¯ä¸ºäº†ç¨‹åºå’Œæ•°æ®å¯ä»¥è¢«åˆ’åˆ†ä¸ºé€»è¾‘ä¸Šç‹¬ç«‹çš„åœ°å€ç©ºé—´ï¼ˆæ¯”å¦‚åˆ†æˆä»£ç ã€å †ã€æ ˆè¿™äº›æ®µï¼‰ï¼Œæœ‰åŠ©äºæ•°æ®çš„å…±äº«å’Œä¿æŠ¤ï¼Œæ¯”å¦‚æ•°æ®å…±äº«ã€æ•°æ®ä¿æŠ¤ã€åŠ¨æ€é“¾æ¥ç­‰ï¼Œéœ€è¦ç¨‹åºå‘˜æ˜¾å¼åˆ’åˆ†æ¯ä¸ªæ®µã€‚&lt;/p&gt;
&lt;h3 id=&#34;åˆ†é¡µ&#34;&gt;åˆ†é¡µ&lt;/h3&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/%e5%86%85%e5%ad%98%e5%88%86%e9%a1%b5.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/%e5%86%85%e5%ad%98%e5%88%86%e9%a1%b5.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;é¡µçš„å¤§å°å›ºå®šï¼Œå¯ä»¥ç”¨ä½å›¾è¡¨ç¤ºé¡µçš„åˆ†é…å’Œé‡Šæ”¾ï¼Œä½œä¸ºä¸»å­˜çš„åŸºæœ¬å•ä½ï¼Œåˆ†é¡µå¯ä»¥ä½¿å¾—å†…å­˜åˆ†é…ç²’åº¦å˜å°ï¼Œä»¥æ­¤æ¥å‡å°‘å¤–éƒ¨å†…å­˜ç¢ç‰‡çš„äº§ç”Ÿï¼Œä½†å¦‚æœç¨‹åºéœ€è¦çš„å†…å­˜ä¸è¶³ä¸€é¡µï¼Œç”±äºæœ€å°åˆ†é…å•ä½æ˜¯ä¸€é¡µï¼Œå°±ä¼šé€ æˆå†…éƒ¨å†…å­˜ç¢ç‰‡çš„æƒ…å†µå‡ºç°ï¼›&lt;/p&gt;
&lt;p&gt;é¡µä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡ï¼Œä½†å¯ä»¥é€šè¿‡ä¿®æ”¹é¡µè¡¨çš„æ–¹å¼ï¼Œè®©è¿ç»­çš„è™šæ‹Ÿé¡µé¢æ˜ å°„åˆ°éè¿ç»­çš„ç‰©ç†é¡µé¢ï¼Œå®ç°åˆ†æ®µçš„æ•ˆæœï¼›æ¯”å¦‚æœ‰1ï¼Œ2ï¼Œ3æ˜¯ç©ºé—²ï¼Œ4å·²è¢«åˆ†é…ï¼Œ5æ˜¯ç©ºé—²ï¼Œå¯ä»¥é€šè¿‡æ˜ å°„è®©5æ¥ä¸Š3ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å› ä¸ºç¨‹åºæ•°æ®å­˜å‚¨åœ¨ä¸åŒçš„é¡µä¸­ï¼Œè€Œé¡µåˆç¦»æ•£åˆ†å¸ƒåœ¨å†…å­˜ä¸­ï¼Œå› æ­¤éœ€è¦ä¸€ä¸ªé¡µè¡¨æ¥è®°å½•æ˜ å°„å…³ç³»ï¼Œé¡µè¡¨ä¹Ÿæ˜¯å­˜å‚¨åœ¨å†…å­˜ä¸­çš„ï¼Œé€šè¿‡å†…å­˜ç®¡ç†å•å…ƒMMUå®ç°è™šæ‹Ÿåœ°å€å’Œç‰©ç†åœ°å€çš„è½¬æ¢ï¼›&lt;/p&gt;
&lt;p&gt;é€šè¿‡é™ä½å†…å­˜åˆ†é…çš„ç²’åº¦ + é¡µè¡¨æ˜ å°„ï¼Œè§£å†³åˆ†æ®µå†…å­˜å¸¦æ¥çš„å¤–éƒ¨å†…å­˜ç¢ç‰‡è¿‡å¤§å’Œå†…å­˜äº¤æ¢æ•ˆç‡ä½çš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åˆ†é¡µçš„åœ°å€ç©ºé—´æ˜¯ä¸€ç»´çš„ï¼Œåˆ†é…çš„æœ€å°å•ä½æ˜¯é¡µã€‚é¡µå†…çš„è™šæ‹Ÿåœ°å€æŒ‰ä½åˆ’åˆ†ä¸ºé¡µå·å’Œé¡µå†…åç§»ï¼Œé€šè¿‡é¡µå·æ‰¾åˆ°å¯¹åº”çš„é¡µè¡¨ï¼Œå†é€šè¿‡é¡µè¡¨ä¸Šçš„ç‰©ç†é¡µå·æ‰¾åˆ°å¯¹åº”çš„ç‰©ç†é¡µï¼Œå†é€šè¿‡é¡µå†…åç§»é‡ + ç‰©ç†é¡µçš„åŸºåœ°å€ï¼Œæœ€ç»ˆç¡®å®šç‰©ç†å†…å­˜åœ°å€ï¼›&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥ï¼Œè®¿é—®åˆ†é¡µç³»ç»Ÿä¸­çš„å†…å­˜æ•°æ®éœ€è¦ä¸¤æ¬¡è®¿é—®ï¼Œç¬¬ä¸€æ¬¡ç¡®å®šç‰©ç†å†…å­˜çš„åœ°å€ï¼Œç¬¬äºŒæ¬¡æ ¹æ®ç¬¬ä¸€æ¬¡å¾—åˆ°çš„ç‰©ç†åœ°å€è®¿é—®å†…å­˜å–å‡ºæ•°æ®ï¼›&lt;/p&gt;
&lt;p&gt;å½“è¿›ç¨‹è®¿é—®è™šæ‹Ÿåœ°å€åœ¨é¡µè¡¨ä¸­æŸ¥ä¸åˆ°æ—¶ï¼Œç³»ç»Ÿä¼šäº§ç”Ÿä¸€ä¸ªç¼ºé¡µå¼‚å¸¸ï¼Œè¿›å…¥ç³»ç»Ÿå†…æ ¸ç©ºé—´åˆ†é…ç‰©ç†å†…å­˜ï¼Œæ›´æ–°è¿›ç¨‹é¡µè¡¨ï¼Œæœ€åå†è¿”å›åˆ°ç”¨æˆ·ç©ºé—´ï¼Œæ¢å¤è¿›ç¨‹è¿è¡Œï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ“ä½œç³»ç»Ÿåœ¨å¯¹å†…å­˜ç®¡ç†æ—¶ï¼Œä½¿ç”¨ä¸€ä¸ªæ•°æ®ç»“æ„æè¿°ä¸€ä¸ªå†…å­˜é¡µï¼Œæ¯ä¸ªæ•°æ®ç»“æ„åŒ…å«ç›¸é‚»é¡µçš„æŒ‡é’ˆï¼Œå¤šä¸ªå†…å­˜é¡µå½¢æˆä¸€ä¸ªé“¾è¡¨ï¼ŒLinuxä¸‹æ¯é¡µå¤§å°æ˜¯4KBã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å†…å­˜ä¸è¶³æ—¶ï¼Œå†…å­˜æ•°æ®ä¼šå†™å›ç¡¬ç›˜æ¥é‡Šæ”¾å†…å­˜ï¼ˆé¡µç½®æ¢ç®—æ³•ï¼‰ï¼Œç”±äºæ¯é¡µå¤§å°ä¸€è‡´ï¼Œæ¯é¡µçš„è¯»å†™æ—¶é—´ä¹Ÿä¼šä¸€è‡´ï¼Œå†…å­˜äº¤æ¢æ•ˆç‡ç›¸å¯¹æ¯”è¾ƒç¨³å®šï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åœ¨å®Œæˆè™šæ‹Ÿå†…å­˜å’Œç‰©ç†å†…å­˜é¡µä¹‹é—´çš„æ˜ å°„åï¼Œå¹¶ä¸çœŸçš„æŠŠé¡µåŠ è½½åˆ°ç‰©ç†å†…å­˜é‡Œï¼Œè€Œæ˜¯åªæœ‰åœ¨ç¨‹åºè¿è¡Œä¸­ï¼Œéœ€è¦ç”¨åˆ°çš„å¯¹åº”è™šæ‹Ÿå†…å­˜é¡µé‡Œé¢çš„æŒ‡ä»¤å’Œæ•°æ®æ—¶ï¼Œå†åŠ è½½åˆ°ç‰©ç†å†…å­˜é‡Œï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;å¤šçº§é¡µè¡¨&#34;&gt;å¤šçº§é¡µè¡¨&lt;/h4&gt;
&lt;p&gt;å› ä¸ºæ¯ä¸ªè¿›ç¨‹æœ‰è‡ªå·±çš„è™šæ‹Ÿç©ºé—´åœ°å€ï¼Œå¦‚æœæ¯ä¸ªè¿›ç¨‹éƒ½æ‹¥æœ‰è‡ªå·±çš„é¡µè¡¨ï¼Œé‚£æ•°é‡ä¼šéå¸¸åºå¤§ï¼Œæ¯”å¦‚åœ¨32ä½CPUã€é¡µå¤§å°4KBçš„ç¯å¢ƒä¸‹ï¼Œä¸€ä¸ªè¿›ç¨‹ï¼Œ4GBçš„è™šæ‹Ÿå†…å­˜çš„å•çº§é¡µè¡¨å°±éœ€è¦100ä¸‡ä¸ªï¼Œæ¯ä¸ªé¡µè¡¨éœ€è¦4ä¸ªå­—èŠ‚å­˜å‚¨ï¼Œ4Gçš„è™šæ‹Ÿå†…å­˜å°±éœ€è¦å 4MBï¼Œå½“è¿›ç¨‹æœ‰100ä¸ªï¼Œå°±éœ€è¦åˆ†é…400MBçš„å†…å­˜æ¥å­˜å‚¨é¡µè¡¨ï¼Œä½†å®é™…ä¸Šè¿›ç¨‹ä¸€æ¬¡å¯èƒ½ç”¨ä¸åˆ°è¿™ä¹ˆå¤šè™šæ‹Ÿåœ°å€ï¼Œäºæ˜¯æ“ä½œç³»ç»Ÿä½¿ç”¨å¤šçº§é¡µè¡¨è§£å†³è¿™ä¸ªé—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/%e5%a4%9a%e7%ba%a7%e9%a1%b5%e8%a1%a8.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/%e5%a4%9a%e7%ba%a7%e9%a1%b5%e8%a1%a8.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;å¤šçº§é¡µè¡¨ï¼Œå°±æ˜¯å°†å•çº§é¡µè¡¨è¿›è¡Œåˆ†é¡µï¼Œæ¯”å¦‚åˆ†ä¸º1024ä¸ªä¸€çº§é¡µè¡¨ï¼Œæ¯ä¸ªäºŒçº§é¡µè¡¨å†åˆ†ä¸º1024ä¸ªå•è¡¨é¡¹ï¼ˆç›¸ä¹˜å°±æœ‰100ä¸‡ä¸ªäº†ï¼‰ï¼Œæ˜ å°„è€Œæˆå°±éœ€è¦4KB + 4MBå†…å­˜ç©ºé—´ï¼Œä¸€çº§é¡µè¡¨å¦‚æœæ²¡è¢«ç”¨åˆ°ï¼ŒäºŒçº§é¡µè¡¨å°±ä¸éœ€è¦åˆ›å»ºäº†ï¼Œæ‰€ä»¥å¯ä»¥çœå¾ˆå¤šå†…å­˜ç©ºé—´ï¼›&lt;/p&gt;
&lt;p&gt;é¡µè¡¨çš„ä½œç”¨å°±æ˜¯å°†è™šæ‹Ÿåœ°å€è½¬æ¢ä¸ºç‰©ç†åœ°å€ï¼Œå¦‚æœè™šæ‹Ÿåœ°å€åœ¨é¡µè¡¨ä¸­æ‰¾ä¸åˆ°å¯¹åº”çš„é¡µè¡¨é¡¹ï¼Œå°±ä¼šå‡ºé—®é¢˜ï¼Œæ‰€ä»¥é¡µè¡¨ä¸€å®šè¦è¦†ç›–å…¨éƒ¨è™šæ‹Ÿåœ°å€ï¼›å¯¹äº64ä½çš„ç³»ç»Ÿï¼Œä¸¤çº§é¡µè¡¨å°±ä¸å¤Ÿç”¨äº†ï¼Œéœ€è¦å˜æˆå››çº§é¡µè¡¨ï¼Œä»¥æ­¤ç±»æ¨æˆå¤šçº§é¡µè¡¨ï¼›&lt;/p&gt;
&lt;p&gt;å¤šçº§é¡µè¡¨è§£å†³ç©ºé—´ä¸Šçš„é—®é¢˜ï¼Œä½†æ˜¯è™šæ‹Ÿåœ°å€åˆ°ç‰©ç†åœ°å€çš„è½¬æ¢å°±å¤šäº†æ­¥éª¤ï¼Œå› ä¸ºå¦‚æœé¡µè¡¨ä¹Ÿæ˜¯å­˜åœ¨ç‰©ç†å†…å­˜ï¼Œé‚£åšè™šæ‹Ÿåœ°å€è½¬æ¢æ—¶ï¼Œéœ€è¦å…ˆè¯»é¡µè¡¨æ‰€åœ¨çš„ç‰©ç†å†…å­˜ï¼Œå¾—åˆ°è½¬æ¢åçš„ç‰©ç†åœ°å€ï¼Œè¿›è€Œæ‰èƒ½è¯»åˆ°å¯¹åº”ç‰©ç†åœ°å€çš„å€¼ï¼Œå¤šäº†ä¸€æ¬¡é¢å¤–çš„è¯»å–ï¼Œé™ä½åœ°å€è½¬æ¢æ•ˆç‡ï¼Œå› æ­¤ï¼Œéœ€è¦é¢å¤–çš„ç¡¬ä»¶æ¥åŠ é€Ÿåœ°å€è½¬æ¢ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†åŠ é€Ÿåœ°å€ç¿»è¯‘ï¼Œåœ¨CPUèŠ¯ç‰‡ä¸­åŠ å…¥ä¸€ä¸ªå­˜æ”¾ç¨‹åºæœ€å¸¸è®¿é—®çš„é¡µè¡¨é¡¹çš„Cacheï¼Œå«TLBï¼ˆtranslation lookaside bufferï¼‰ï¼Œåˆå«é¡µè¡¨ç¼“å­˜ã€è½¬å€æ—è·¯ç¼“å­˜ã€å¿«è¡¨ï¼ŒCPUèŠ¯ç‰‡ä¹Ÿä¼šå°è£…MMUï¼ŒCPUå¯»å€æ—¶ï¼Œå…ˆæŸ¥TLBï¼Œæ²¡æ‰¾åˆ°å†å»æŸ¥å¸¸è§„çš„é¡µè¡¨ï¼ŒTLBä¼šåˆ©ç”¨å±€éƒ¨æ€§åŸç†ï¼Œä¼šåŠ è½½ç›¸é‚»çš„åœ°å€ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ®µé¡µå¼&#34;&gt;æ®µé¡µå¼&lt;/h3&gt;
&lt;p&gt;å°†ç¨‹åºåˆ†ä¸ºå¤šä¸ªæœ‰é€»è¾‘æ„ä¹‰çš„æ®µï¼Œæ–¹ä¾¿ç®¡ç†ï¼Œæ¯”å¦‚åœ°å€èŒƒå›´ä¸ºå¤šå°‘å¤šå°‘çš„å†…å­˜åŒºåŸŸå°±ç»™ç¡¬ä»¶ç”¨ï¼Œå¤šå°‘å¤šå°‘çš„ç»™å†…æ ¸åŒºï¼Œå¤šå°‘å¤šå°‘ç»™åº”ç”¨åŒºç­‰ï¼Œå†å¯¹æ®µå†…å†…å­˜è¿›è¡Œåˆ†é¡µï¼Œåˆ’åˆ†æˆå›ºå®šå¤§å°çš„é¡µï¼Œä»è€Œæ›´å¥½çš„åˆ©ç”¨å†…å­˜ï¼Œå‡å°‘å†…å­˜ç¢ç‰‡çš„äº§ç”Ÿã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;æ®µé¡µå¼åœ°å€å˜æ¢ä¸­è¦å¾—åˆ°ç‰©ç†åœ°å€é¡»ç»è¿‡ä¸‰æ¬¡å†…å­˜è®¿é—®ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç¬¬ä¸€æ¬¡è®¿é—®æ®µè¡¨ï¼Œå¾—åˆ°é¡µè¡¨èµ·å§‹åœ°å€ï¼›&lt;/li&gt;
&lt;li&gt;ç¬¬äºŒæ¬¡è®¿é—®é¡µè¡¨ï¼Œå¾—åˆ°ç‰©ç†é¡µå·ï¼›&lt;/li&gt;
&lt;li&gt;ç¬¬ä¸‰æ¬¡å°†ç‰©ç†é¡µå·ä¸é¡µå†…ä½ç§»ç»„åˆï¼Œå¾—åˆ°ç‰©ç†åœ°å€ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¯ç”¨è½¯ã€ç¡¬ä»¶ç›¸ç»“åˆçš„æ–¹æ³•å®ç°æ®µé¡µå¼åœ°å€å˜æ¢ï¼Œè¿™æ ·è™½ç„¶å¢åŠ äº†ç¡¬ä»¶æˆæœ¬å’Œç³»ç»Ÿå¼€é”€ï¼Œä½†æé«˜äº†å†…å­˜çš„åˆ©ç”¨ç‡ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;ç»„ç»‡å†…å­˜é¡µ&#34;&gt;ç»„ç»‡å†…å­˜é¡µ&lt;/h3&gt;
&lt;p&gt;ä¸ºäº†èƒ½é«˜æ•ˆçš„åˆ†é…å†…å­˜ï¼Œéœ€è¦æŠŠå†…å­˜åŒºæ•°æ®ç»“æ„å’Œå†…å­˜é¡µé¢æ•°æ®ç»“æ„å…³è”èµ·æ¥ï¼Œç»„ç»‡æˆä¸€ä¸ªå†…å­˜åˆ†å‰²åˆå¹¶çš„æ•°æ®ç»“æ„ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ä»¥2çš„Næ¬¡æ–¹ä¸ºé¡µé¢æ•°ç»„ç»‡é¡µé¢çš„åŸå› ï¼š&lt;/p&gt;
&lt;p&gt;1ã€å†…å­˜å¯¹é½ï¼Œæå‡CPUå¯»å€é€Ÿåº¦
2ã€å†…å­˜åˆ†é…æ—¶ï¼Œæ ¹æ®éœ€æ±‚å¤§å°å¿«é€Ÿå®šä½è‡³å°‘ä»å“ªä¸€éƒ¨åˆ†å¼€å§‹
3ã€å†…å­˜åˆ†é…æ—¶ï¼Œå¹¶å‘åŠ é”ï¼Œåˆ†ç»„å¯ä»¥æå‡æ•ˆç‡
4ã€å†…å­˜åˆ†é…å›æ”¶æ—¶ï¼Œå¾ˆå¤šè®¡ç®—ä¹Ÿæ›´ç®€å•&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;mmu&#34;&gt;MMU&lt;/h2&gt;
&lt;p&gt;è™šæ‹Ÿåœ°å€è½¬æ¢ä¸ºç‰©ç†åœ°å€é€šè¿‡MMU(å†…å­˜ç®¡ç†å•å…ƒ)å®ç°ï¼Œåªèƒ½åœ¨ä¿æŠ¤æ¨¡å¼æˆ–è€…é•¿æ¨¡å¼ä¸‹å¼€å¯ã€‚&lt;/p&gt;
&lt;p&gt;MMUä½¿ç”¨åˆ†é¡µæ¨¡å‹ï¼Œå³æŠŠè™šæ‹Ÿåœ°å€ç©ºé—´å’Œç‰©ç†åœ°å€ç©ºé—´éƒ½åˆ†æˆåŒç­‰å¤§å°çš„é¡µï¼ŒæŒ‰ç…§è™šæ‹Ÿé¡µå’Œç‰©ç†é¡µè¿›è¡Œè½¬æ¢ï¼Œä¸€ä¸ªè™šæ‹Ÿåœ°å€å¯¹åº”ä¸€ä¸ªç‰©ç†åœ°å€ï¼Œä¸€ä¸ªè™šæ‹Ÿé¡µå¯¹åº”ä¸€ä¸ªç‰©ç†é¡µï¼Œé¡µå¤§å°ä¸€ç»é…ç½®å°±æ˜¯å›ºå®šï¼Œé€šè¿‡å†…å­˜ä¸­å­˜å‚¨çš„ä¸€ä¸ªåœ°å€å…³ç³»è½¬æ¢è¡¨ï¼ˆé¡µè¡¨ï¼‰å®ç°è½¬æ¢ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ä¸ºäº†å¢åŠ çµæ´»æ€§å’ŒèŠ‚çº¦ç‰©ç†å†…å­˜ç©ºé—´ï¼ˆå› ä¸ºé¡µè¡¨æ˜¯æ”¾åœ¨ç‰©ç†å†…å­˜ä¸­çš„ï¼‰ï¼Œæ‰€ä»¥é¡µè¡¨ä¸­å¹¶ä¸å­˜æ”¾è™šæ‹Ÿåœ°å€å’Œç‰©ç†åœ°å€çš„å¯¹åº”å…³ç³»ï¼Œåªå­˜æ”¾ç‰©ç†é¡µé¢çš„åœ°å€ï¼ŒMMU ä»¥è™šæ‹Ÿåœ°å€ä¸ºç´¢å¼•å»æŸ¥è¡¨è¿”å›ç‰©ç†é¡µé¢åœ°å€ï¼Œè€Œä¸”é¡µè¡¨æ˜¯åˆ†çº§çš„ï¼Œæ€»ä½“åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼šä¸€ä¸ªé¡¶çº§é¡µç›®å½•ï¼Œå¤šä¸ªä¸­çº§é¡µç›®å½•ï¼Œæœ€åæ‰æ˜¯é¡µè¡¨ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;åˆ†å±‚çš„ç»“æ„æ˜¯æ ¹æ®é¡µå¤§å°å†³å®šã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†è§£å†³è¿›ç¨‹é€šè¿‡MMUè®¿é—®å†…å­˜æ¯”ç›´æ¥è®¿é—®å†…å­˜å¤šäº†ä¸€æ¬¡å†…å­˜è®¿é—®ï¼Œå¯¼è‡´æ€§èƒ½ä¸‹é™çš„é—®é¢˜ï¼Œå¼•å…¥TLBå¿«è¡¨è¿›è¡ŒåŠ é€Ÿã€‚TLBå¯ä»¥ç®€å•ç†è§£æˆé¡µè¡¨çš„é«˜é€Ÿç¼“å­˜ï¼Œä¿å­˜äº†æœ€é«˜é¢‘æ¬¡è¢«è®¿é—®çš„é¡µè¡¨é¡¹ï¼Œä¸€èˆ¬ç”±ç¡¬ä»¶å®ç°ï¼Œé€Ÿåº¦æå¿«ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç©ºé—²ç©ºé—´ç®¡ç†&#34;&gt;ç©ºé—²ç©ºé—´ç®¡ç†&lt;/h2&gt;
&lt;h3 id=&#34;åŸºæœ¬æœºåˆ¶&#34;&gt;åŸºæœ¬æœºåˆ¶&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;åˆ†å‰²ä¸åˆå¹¶ï¼šæ ¹æ®è¯·æ±‚çš„å¤§å°è¿›è¡Œç©ºé—²ç©ºé—´åˆ†å‰²ï¼Œå›æ”¶æ—¶ï¼Œå¯¹è¢«å›æ”¶ç©ºé—´ç›¸é‚»çš„ç©ºé—´è¿›è¡Œæ£€æŸ¥ï¼Œå¦‚æœä¹Ÿæ˜¯ç©ºé—²ç©ºé—´ï¼Œåˆ™è¿›è¡Œåˆå¹¶ï¼›&lt;/li&gt;
&lt;li&gt;è¿½è¸ªå·²åˆ†é…ç©ºé—´çš„å¤§å°ï¼šåˆ†é…ç©ºé—´æ—¶ï¼Œé™¤äº†åˆ†é…è¯·æ±‚çš„å¤§å°ï¼Œè¿˜ä¼šåˆ†é…ä¸€å—å¤´éƒ¨ï¼Œè®°å½•å·²åˆ†é…ç©ºé—´çš„å…ƒæ•°æ®ä¿¡æ¯ï¼Œæ–¹ä¾¿æŸ¥æ‰¾å’Œé‡Šæ”¾ï¼›&lt;/li&gt;
&lt;li&gt;åµŒå…¥ç©ºé—²åˆ—è¡¨ï¼šåœ¨ç©ºé—²ç©ºé—´æœ¬èº«å»ºç«‹ç©ºé—²ç©ºé—´åˆ—è¡¨ï¼Œå®ç°å¯¹ç©ºé—²ç©ºé—´çš„ç®¡ç†ï¼›&lt;/li&gt;
&lt;li&gt;å†…å­˜å¢é•¿ï¼šå½“å½“å‰çš„ç©ºé—²ç©ºé—´å†…å­˜è€—å°½ï¼Œå‘æ“ä½œç³»ç»Ÿç”³è¯·æ›´å¤§çš„ç©ºé—²ç©ºé—´&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;å†…å­˜åˆ†é…åŸºæœ¬ç­–ç•¥&#34;&gt;å†…å­˜åˆ†é…åŸºæœ¬ç­–ç•¥&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;æœ€ä¼˜åŒ¹é…ï¼šéå†æ•´ä¸ªç©ºé—²åˆ—è¡¨ï¼Œæ‰¾åˆ°å’Œè¯·æ±‚å¤§å°ä¸€æ ·æˆ–æ›´å¤§çš„ç©ºé—²å—ï¼Œè¿”å›è¿™ç»„å€™é€‰è€…ä¸­æœ€å°çš„ä¸€å—ï¼Œç¼ºç‚¹æ˜¯éœ€è¦éå†æŸ¥æ‰¾ï¼Œæ€§èƒ½ä¸é«˜ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æœ€å·®åŒ¹é…ï¼šå°è¯•æ‰¾åˆ°æœ€å¤§çš„ç©ºé—²å—ï¼Œæ ¹æ®è¯·æ±‚å¤§å°è¿›è¡Œåˆ†å‰²ï¼Œç„¶åæŠŠå‰©ä½™çš„ç©ºé—²å—åŠ å…¥ç©ºé—²åˆ—è¡¨ï¼Œç¼ºç‚¹æ˜¯åŒæ ·éœ€è¦éå†ï¼Œä¸”æ›´å®¹æ˜“äº§ç”Ÿå†…å­˜ç¢ç‰‡ï¼Œä¸€èˆ¬ä¸ä½¿ç”¨è¿™ç§ç­–ç•¥ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;é¦–æ¬¡åŒ¹é…ï¼šæ‰¾åˆ°ç¬¬ä¸€å—æ»¡è¶³è¯·æ±‚çš„å—ï¼Œåˆ†é…å®Œåå‰©ä½™ç©ºé—²å—åŠ å…¥ç©ºé—²åˆ—è¡¨ï¼Œè¿™ç§æ–¹æ³•ä¸éœ€è¦éå†æ‰€æœ‰ç©ºé—²å—ï¼Œä½†ä¸ç¨³å®šï¼Œæœ‰æ—¶å€™ä¼šäº§ç”Ÿå¾ˆå¤šå†…å­˜ç¢ç‰‡ï¼Œå¦‚ä½•ç®¡ç†ç©ºé—²åˆ—è¡¨çš„é¡ºåºå°±å˜å¾—é‡è¦ï¼Œä¸€èˆ¬æ˜¯åŸºäºåœ°å€æ’åºï¼Œé€šè¿‡ä¿æŒç©ºé—²å—æŒ‰å†…å­˜åœ°å€æœ‰åºï¼Œæ–¹ä¾¿åˆå¹¶ï¼Œå‡å°‘å†…å­˜ç¢ç‰‡ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¸‹æ¬¡åŒ¹é…ï¼šä¸åŒäºé¦–æ¬¡åŒ¹é…æ¯æ¬¡éƒ½ä»åˆ—è¡¨å¤´éƒ¨å¼€å§‹éå†æŸ¥æ‰¾ï¼Œä¸‹æ¬¡åŒ¹é…æ˜¯ä»ä¸Šæ¬¡ç»“æŸæŸ¥æ‰¾çš„ä½ç½®å¼€å§‹æŸ¥æ‰¾ï¼Œé¿å…å¯¹åˆ—è¡¨å¼€å¤´è¿›è¡Œé¢‘ç¹åˆ†å‰²ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åˆ†ç¦»ç©ºé—²åˆ—è¡¨ï¼šå¦‚æœæŸä¸ªç¨‹åºç»å¸¸ç”³è¯·ä¸€ç§æˆ–å‡ ç§å¤§å°ç›¸åŒçš„å†…å­˜ç©ºé—´ï¼Œå°±ç”¨ä¸€ä¸ªç‹¬ç«‹çš„åˆ—è¡¨ï¼Œåªç®¡ç†è¿™æ ·å¤§å°çš„å¯¹è±¡ï¼Œå…¶ä»–å¤§å°çš„å¯¹è±¡åˆ™äº¤ç»™æ›´é€šç”¨çš„å†…å­˜åˆ†é…ç¨‹åºï¼ŒåƒGoçš„å†…å­˜åˆ†é…å°±ä»mspanã€mcacheã€mcentralé‡Œåˆ†é…å†…å­˜ï¼›&lt;/p&gt;
&lt;p&gt;è¿™ç§åˆ†é…æ–¹å¼çš„å¥½å¤„æ˜¯ä¸ä¼šäº§ç”Ÿå¤šä½™çš„å†…å­˜ç¢ç‰‡ï¼Œä¹Ÿæ²¡æœ‰å¤æ‚çš„åˆ—è¡¨æŸ¥æ‰¾è¿‡ç¨‹ï¼Œå†…å­˜çš„åˆ†é…å’Œé‡Šæ”¾éƒ½å¾ˆå¿«ï¼›&lt;/p&gt;
&lt;p&gt;éš¾ç‚¹åœ¨äºåˆå§‹æ—¶è¦åˆ†é…å¤šå°‘ç©ºé—´ç»™è¿™ç§ç©ºé—²åˆ—è¡¨ï¼Œå¸¸è§çš„åšæ³•æ˜¯å…ˆåˆ†é…ä¸€å°å—å†…å­˜ï¼Œä¸å¤Ÿç”¨æ—¶ï¼Œå‘é€šç”¨å†…å­˜ç”³è¯·ä¸€å—æ€»é‡æ˜¯é¡µå¤§å°å’Œå¯¹è±¡å¤§å°çš„å…¬å€æ•°å†…å­˜åšå—ï¼Œå½“å†…å­˜åšå¿«çš„å¯¹è±¡å¼•ç”¨è®¡æ•°ä¸º0æ—¶ï¼Œåˆ™è¿›è¡Œå›æ”¶ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¼™ä¼´ç³»ç»Ÿï¼šç©ºé—²ç©ºé—´é¦–å…ˆä»æ¦‚å¿µä¸Šè¢«å½“æˆ 2^N çš„å¤§ç©ºé—´ï¼Œå½“æœ‰ä¸€ä¸ªå†…å­˜åˆ†é…è¯·æ±‚æ—¶ï¼Œç©ºé—´ç©ºé—´ç³»ç»Ÿè¢«é€’å½’ä¸€åˆ†ä¸ºäºŒï¼Œç›´åˆ°åˆšå¥½æ»¡è¶³è¯·æ±‚çš„å¤§å°ï¼Œè¿™ç§åˆ†é…ç­–ç•¥åªå…è®¸åˆ†é…2çš„æ•´æ•°æ¬¡å¹‚å¤§å°çš„ç©ºé—²å—ï¼Œå› æ­¤ä¼šæœ‰å†…éƒ¨å†…å­˜ç¢ç‰‡ï¼Œå¥½å¤„æ˜¯å½“å†…å­˜è¢«é‡Šæ”¾æ—¶ï¼Œå¯ä»¥é€’å½’æ£€æŸ¥ï¼Œå¹¶ä¸”æ£€æŸ¥ç›¸é‚»ç©ºé—´ï¼Œå¦‚æœæ˜¯åˆ™åˆäºŒä¸ºä¸€ï¼Œç›´åˆ°åˆå¹¶æ•´ä¸ªå†…å­˜åŒºåŸŸï¼Œæˆ–è€…æŸä¸€å—çš„ä¼™ä¼´è¿˜ä¸èƒ½è¢«é‡Šæ”¾ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;é¡µç½®æ¢ç®—æ³•&#34;&gt;é¡µç½®æ¢ç®—æ³•&lt;/h2&gt;
&lt;p&gt;ç”±äºç¨‹åºæ˜¯åˆ†å¤šæ¬¡è£…å…¥å†…å­˜çš„ï¼Œè¿è¡Œåˆ°ä¸€å®šæ—¶é—´ï¼Œåœ¨åœ°å€æ˜ å°„è¿‡ç¨‹ä¸­å¦‚æœå‘ç°è¦è®¿é—®çš„é¡µä¸å­˜åœ¨å†…å­˜ä¸­ï¼Œä¼šå‘ç”Ÿç¼ºé¡µä¸­æ–­ï¼Œæ­¤æ—¶æ“ä½œç³»ç»Ÿå¿…é¡»åœ¨å†…å­˜é‡Œé€‰æ‹©ä¸€ä¸ªé¡µæŠŠå®ƒç§»é™¤å†…å­˜ï¼Œä¸ºå³å°†è°ƒå…¥çš„é¡µé¢è®©å‡ºç©ºé—´ï¼Œè€Œé€‰æ‹©æ·˜æ±°å“ªä¸€é¡µå°±éœ€è¦é¡µé¢ç½®æ¢ç®—æ³•ã€‚&lt;/p&gt;
&lt;p&gt;ç¼ºé¡µä¸­æ–­ä¸ä¸€èˆ¬ä¸­æ–­çš„åŒºåˆ«ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç¼ºé¡µä¸­æ–­åœ¨æŒ‡ä»¤æ‰§è¡Œã€ŒæœŸé—´ã€äº§ç”Ÿå’Œå¤„ç†ä¸­æ–­ä¿¡å·ï¼Œè€Œä¸€èˆ¬ä¸­æ–­åœ¨ä¸€æ¡æŒ‡ä»¤æ‰§è¡Œã€Œå®Œæˆã€åæ£€æŸ¥å’Œå¤„ç†ä¸­æ–­ä¿¡å·ï¼›&lt;/li&gt;
&lt;li&gt;ç¼ºé¡µä¸­æ–­è¿”å›åˆ°è¯¥æŒ‡ä»¤çš„å¼€å§‹é‡æ–°æ‰§è¡Œã€Œè¯¥æŒ‡ä»¤ã€ï¼Œè€Œä¸€èˆ¬ä¸­æ–­è¿”å›å›åˆ°è¯¥æŒ‡ä»¤çš„ã€Œä¸‹ä¸€ä¸ªæŒ‡ä»¤ã€æ‰§è¡Œã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/%e7%bc%ba%e9%a1%b5%e5%bc%82%e5%b8%b8%e6%b5%81%e7%a8%8b.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/%e7%bc%ba%e9%a1%b5%e5%bc%82%e5%b8%b8%e6%b5%81%e7%a8%8b.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;å¦‚æœç¬¬4æ­¥ä¸èƒ½åœ¨ç‰©ç†å†…å­˜æ‰¾åˆ°ç©ºé—²é¡µæ—¶ï¼Œè¯´æ˜æ­¤æ—¶ç‰©ç†å†…å­˜å·²æ»¡ï¼Œéœ€è¦ä½¿ç”¨é¡µç½®æ¢ç®—æ³•ï¼Œé€‰æ‹©ä¸€ä¸ªç‰©ç†é¡µï¼Œå¦‚æœè¯¥ç‰©ç†é¡µæ˜¯è„é¡µï¼Œåˆ™æŠŠå®ƒswapåˆ°ç£ç›˜ï¼Œå¹¶æŠŠè¢«ç½®æ¢å‡ºå»çš„é¡µè¡¨çš„çŠ¶æ€æ”¹æˆ æ— æ•ˆï¼Œæœ€åæŠŠæ­£åœ¨è®¿é—®çš„é¡µè½¬å…¥è¿™ä¸ªç‰©ç†é¡µä¸­ã€‚&lt;/p&gt;
&lt;p&gt;å¸¸è§çš„é¡µé¢ç½®æ¢ç®—æ³•ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;æœ€ä½³é¡µé¢ç½®æ¢ç®—æ³•OPTï¼š&lt;/p&gt;
&lt;p&gt;å°†å½“å‰é¡µä¸­æœªæ¥æœ€é•¿æ—¶é—´ä¸ä¼šè¢«è®¿é—®çš„é¡µç½®æ¢å‡ºå»ï¼Œè¯¥ç®—æ³•ä¼šè®¡ç®—å†…å­˜ä¸­æ¯ä¸ªé€»è¾‘é¡µé¢çš„ä¸‹ä¸€æ¬¡è®¿é—®æ—¶é—´ï¼Œç„¶åæ¯”è¾ƒï¼Œé€‰æ‹©æœªæ¥æœ€é•¿æ—¶é—´ä¸è®¿é—®çš„é¡µé¢ã€‚ç”±äºå¾ˆéš¾é¢„æµ‹æ¯ä¸ªé¡µé¢åœ¨ä¸‹ä¸€æ¬¡è®¿é—®å‰çš„ç­‰å¾…æ—¶é—´ï¼Œæ‰€ä»¥è¯¥ç®—æ³•åªèƒ½ç”¨æ¥è¡¡é‡ç½®æ¢æ•ˆç‡ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å…ˆè¿›å…ˆå‡ºç½®æ¢ç®—æ³•FIFOï¼š&lt;/p&gt;
&lt;p&gt;é€‰æ‹©åœ¨å†…å­˜é©»ç•™æ—¶é—´å¾ˆé•¿çš„é¡µé¢è¿›è¡Œç½®æ¢ï¼Œæ•ˆç‡ä¸€èˆ¬ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æœ€è¿‘æœ€ä¹…æœªä½¿ç”¨ç®—æ³•LRUï¼š&lt;/p&gt;
&lt;p&gt;é€‰æ‹©æœ€é•¿æ—¶é—´æ²¡æœ‰è¢«è®¿é—®çš„é¡µé¢è¿›è¡Œç½®æ¢ï¼Œå¼€é”€è¾ƒå¤§ï¼Œå› ä¸ºéœ€è¦åœ¨å†…å­˜ä¸­ç»´æŠ¤ä¸€ä¸ªæ‰€æœ‰é¡µé¢çš„é“¾è¡¨ï¼Œè€Œä¸”æ¯æ¬¡è®¿é—®å†…å­˜éƒ½å¿…é¡»æ›´æ–°æ•´ä¸ªé“¾è¡¨ï¼Œæ¯”è¾ƒè€—æ—¶ï¼Œæ‰€ä»¥å®é™…ä¸­æ¯”è¾ƒå°‘ç”¨ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æœ€è¿‘æœ€ä¸å¸¸ç”¨ç®—æ³•LFUï¼š&lt;/p&gt;
&lt;p&gt;å½“å‘ç”Ÿç¼ºé¡µä¸­æ–­æ—¶ï¼Œé€‰æ‹©è®¿é—®æ¬¡æ•°æœ€å°‘çš„é¡µé¢ï¼Œå°†å…¶ç½®æ¢ï¼Œå¾ˆLRUä¸€æ ·ï¼Œå®ç°æˆæœ¬å¾ˆé«˜ï¼Œéœ€è¦ä¸ºæ¯ä¸ªé¡µé¢æ·»åŠ ä¸€ä¸ªè®¡æ•°å™¨ï¼Œè¿˜éœ€è¦æŸ¥æ‰¾é“¾è¡¨ï¼Œæ¯”è¾ƒè€—æ—¶ï¼Œä¹Ÿæ¯”è¾ƒå°‘ç”¨ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ—¶é’Ÿé¡µé¢ç½®æ¢ç®—æ³•NRUï¼ˆæœ€è¿‘æœªä½¿ç”¨ç®—æ³•ï¼‰&lt;/p&gt;
&lt;p&gt;å°†é¡µé¢é“¾æ¥æˆä¸€ä¸ªç¯å½¢åˆ—è¡¨ï¼Œæ¯ä¸ªé¡µæœ‰ä¸€ä¸ªè®¿é—®ä½0/1ï¼Œ1è¡¨ç¤ºæ¸…é™¤è®¿é—®ä½ï¼Œå¹¶æŠŠæŒ‡é’ˆå‰ç§»ï¼Œé‡å¤è¿™ä¸ªè¿‡ç¨‹ç›´åˆ°æ‰¾åˆ°ä½ä¸º0çš„é¡µé¢ï¼›0è¡¨ç¤ºéœ€è¦æ·˜æ±°è¯¥é¡µé¢ï¼Œå¹¶æŠŠæ–°çš„é¡µé¢æ’å…¥åˆ°æ­¤ä½ç½®ï¼Œç„¶åæŒ‡é’ˆå‰ç§»ã€‚&lt;/p&gt;
&lt;p&gt;å‘ç”Ÿç¼ºé¡µä¸­æ–­åï¼ŒæŒ‡é’ˆéå†ç¯å½¢åˆ—è¡¨ï¼Œä¼šæŠŠæ²¿é€”é‡åˆ°çš„è®¿é—®ä½ä¸º1çš„ä¿®æ”¹ä¸º0ï¼Œç›´åˆ°é‡åˆ°è®¿é—®ä½ä¸º0çš„é¡µé¢ï¼Œå°†å…¶æ·˜æ±°ï¼Œç½®æ¢æˆæ–°é¡µï¼Œç„¶åè®¿é—®ä½ç½®ä¸º1ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;å…³äºå †å†…å­˜å’Œæ ˆå†…å­˜&#34;&gt;å…³äºå †å†…å­˜å’Œæ ˆå†…å­˜&lt;/h2&gt;
&lt;p&gt;å †å†…å­˜å’Œæ ˆå†…å­˜æ˜¯åŸºäºå¯¹è±¡ç”Ÿå‘½å‘¨æœŸã€åˆ†é…ã€å›æ”¶çš„æ—¶æœºè¿›è¡Œåˆ’åˆ†&lt;/p&gt;
&lt;p&gt;æ ˆå†…å­˜ï¼šä¸€èˆ¬æ˜¯ä¸€ç§åè¿›å…ˆå‡ºï¼ˆLIFOï¼‰çš„æ•°æ®ç»“æ„ï¼Œå¯¹è¿ç»­å†…å­˜çš„çº¿æ€§åˆ†é…ï¼Œç”¨æ¥å­˜å‚¨å‡½æ•°è°ƒç”¨æ—¶çš„å±€éƒ¨å˜é‡ã€å‡½æ•°å‚æ•°å’Œè¿”å›å€¼ç­‰ä¸´æ—¶æ€§çš„æ•°æ®ç®€å•é«˜æ•ˆï¼Œæ–¹ä¾¿å›æ”¶ã€‚&lt;/p&gt;
&lt;p&gt;å †å†…å­˜ï¼šåŠ¨æ€åˆ†é…çš„å†…å­˜ï¼Œç”¨æ¥å­˜å‚¨ç¨‹åºè¿è¡Œæ—¶åŠ¨æ€åˆ›å»ºçš„å¯¹è±¡ã€æ•°ç»„ç­‰æ•°æ®ï¼Œæ¯”å¦‚æŒ‡é’ˆä¾èµ–ï¼Œå…¨å±€å˜é‡ã€‚ç”±äºå †å†…å­˜çš„å¤§å°å’Œç”Ÿå‘½å‘¨æœŸéƒ½æ¯”è¾ƒä¸ç¡®å®šï¼Œæ‰€ä»¥æ“ä½œç³»ç»Ÿéœ€è¦åŠ¨æ€åœ°ç®¡ç†å®ƒã€‚åœ¨ä½¿ç”¨å †å†…å­˜æ—¶ï¼Œç¨‹åºéœ€è¦æ˜¾å¼åœ°ç”³è¯·å†…å­˜ç©ºé—´ï¼Œå¹¶åœ¨ä¸å†éœ€è¦æ—¶é‡Šæ”¾å®ƒï¼Œå¦åˆ™å°±å¯èƒ½å¯¼è‡´å†…å­˜æ³„æ¼ç­‰é—®é¢˜ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å†…å­˜åˆ†é…ä¸å›æ”¶&#34;&gt;å†…å­˜åˆ†é…ä¸å›æ”¶&lt;/h2&gt;
&lt;h3 id=&#34;ç³»ç»Ÿè°ƒç”¨å‡½æ•°&#34;&gt;ç³»ç»Ÿè°ƒç”¨å‡½æ•°&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;brk()ï¼šä»ç”¨æˆ·æ€çš„å †ä¸­åˆ†é…å†…å­˜ï¼Œåªæ˜¯å°†å †é¡¶æŒ‡é’ˆå‘é«˜åœ°å€ç§»åŠ¨ï¼Œè·å¾—æ–°å†…å­˜ï¼›cè¯­è¨€çš„mallocå‡½æ•°ï¼Œå½“ç”¨æˆ·åˆ†é…çš„å†…å­˜å°äº128KBæ—¶ä¼šè°ƒç”¨æ­¤æ–¹æ³•ï¼›åœ¨freeé‡Šæ”¾å†…å­˜æ—¶ï¼Œå¹¶ä¸ä¼šæŠŠå†…å­˜å½’è¿˜ç»™æ“ä½œç³»ç»Ÿï¼Œè€Œæ˜¯ç¼“å­˜åœ¨mallocçš„å†…å­˜æ± ï¼Œå¾…ä¸‹æ¬¡ä½¿ç”¨ï¼›&lt;/li&gt;
&lt;li&gt;mmap()ï¼šä½¿ç”¨ç§æœ‰åŒ¿åæ˜ å°„çš„æ–¹å¼ï¼Œåœ¨ç”¨æˆ·æ€çš„æ–‡ä»¶æ˜ å°„åŒºåˆ†é…ä¸€å—å†…å­˜ï¼›cè¯­è¨€çš„mallocå‡½æ•°ï¼Œå½“ç”¨æˆ·åˆ†é…çš„å†…å­˜å¤§äº128KBæ—¶ä¼šè°ƒç”¨æ­¤æ–¹æ³•ï¼›åœ¨freeé‡Šæ”¾å†…å­˜æ—¶ï¼Œä¼šæŠŠå†…å­˜å½’è¿˜ç»™æ“ä½œç³»ç»Ÿï¼Œå†…å­˜å¾—åˆ°çœŸæ­£çš„é‡Šæ”¾ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸¤è€…åˆ†é…çš„éƒ½æ˜¯è™šæ‹Ÿå†…å­˜ï¼Œåªæœ‰è¢«è®¿é—®åˆ°çš„æ—¶å€™æ‰ä¼šè§¦å‘ç¼ºé¡µä¸­æ–­è¿›è¡Œåˆ†é…ï¼Œå»ºç«‹æ˜ å°„ï¼Œæ²¡è®¿é—®åˆ°å°±ä¸ä¼šç”³è¯·ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å†…å­˜åˆ†é…è¿‡ç¨‹&#34;&gt;å†…å­˜åˆ†é…è¿‡ç¨‹&lt;/h3&gt;
&lt;p&gt;é€šè¿‡ä¸Šé¢ä¸¤ä¸ªå‡½æ•°ç”³è¯·çš„å†…å­˜éƒ½æ˜¯è™šæ‹Ÿå†…å­˜ï¼Œæ­¤æ—¶å¹¶ä¸ä¼šåˆ†é…ç‰©ç†å†…å­˜ï¼Œå½“åº”ç”¨ç¨‹åºè¯»å†™äº†è¿™å—è™šæ‹Ÿå†…å­˜ï¼ŒCPUå°±ä¼šå»è®¿é—®è¿™ä¸ªè™šæ‹Ÿå†…å­˜ï¼Œç„¶åå‘ç°æ²¡æœ‰æ˜ å°„åˆ°ç‰©ç†å†…å­˜ï¼ŒCPUå°±ä¼šäº§ç”Ÿç¼ºé¡µä¸­æ–­ï¼Œè¿›ç¨‹ä»ç”¨æˆ·æ€åˆ‡æ¢åˆ°å†…æ ¸æ€ï¼Œå¹¶å°†ç¼ºé¡µä¸­æ–­äº¤ç»™å†…æ ¸çš„Page Fault Handlerç¼ºé¡µä¸­æ–­å‡½æ•°å¤„ç†ã€‚è¯¥å‡½æ•°ä¼šåˆ¤æ–­æ˜¯å¦æœ‰ç©ºé—²çš„ç‰©ç†å†…å­˜ï¼Œå¦‚æœæœ‰ï¼Œç›´æ¥åˆ†é…ç‰©ç†å†…å­˜ï¼Œå¹¶å»ºç«‹è™šæ‹Ÿå†…å­˜å’Œç‰©ç†å†…å­˜çš„æ˜ å°„ï¼Œå¦‚æœæ²¡æœ‰ç©ºé—²çš„ç‰©ç†å†…å­˜ï¼Œå†…æ ¸å°±ä¼šå¼€å§‹å†…å­˜å›æ”¶å·¥ä½œï¼›&lt;/p&gt;
&lt;p&gt;ç”±äºç”³è¯·è™šæ‹Ÿå†…å­˜ä½†ä¸ä½¿ç”¨å°±ä¸ä¼šåˆ†é…ç‰©ç†å†…å­˜ï¼Œæ‰€ä»¥å®é™…ä¸Šæ˜¯å¯ä»¥ç”³è¯·è¿œè¶…ç‰©ç†å†…å­˜å¤§å°çš„å†…å­˜ï¼Œå½“ç„¶å…·ä½“è¿˜å¾—çœ‹CPUçš„ä½æ•°ï¼Œçœ‹å…·ä½“èƒ½æ“ä½œçš„æœ€å¤§èŒƒå›´ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨ 32 ä½æ“ä½œç³»ç»Ÿï¼Œå› ä¸ºè¿›ç¨‹æœ€å¤§åªèƒ½ç”³è¯· 3 GB å¤§å°çš„è™šæ‹Ÿå†…å­˜ï¼Œæ‰€ä»¥ç›´æ¥ç”³è¯· 8G å†…å­˜ï¼Œä¼šç”³è¯·å¤±è´¥ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨ 64 ä½æ“ä½œç³»ç»Ÿï¼Œå› ä¸ºè¿›ç¨‹æœ€å¤§åªèƒ½ç”³è¯· 128 TB å¤§å°çš„è™šæ‹Ÿå†…å­˜ï¼Œå³ä½¿ç‰©ç†å†…å­˜åªæœ‰ 4GBï¼Œç”³è¯· 8G å†…å­˜ä¹Ÿæ˜¯æ²¡é—®é¢˜ï¼Œå› ä¸ºç”³è¯·çš„å†…å­˜æ˜¯è™šæ‹Ÿå†…å­˜ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç¨‹åºç”³è¯·çš„è™šæ‹Ÿå†…å­˜ï¼Œå¦‚æœæ²¡æœ‰è¢«ä½¿ç”¨ï¼Œå®ƒæ˜¯ä¸ä¼šå ç”¨ç‰©ç†ç©ºé—´çš„ã€‚å½“è®¿é—®è¿™å—è™šæ‹Ÿå†…å­˜åï¼Œæ“ä½œç³»ç»Ÿæ‰ä¼šè¿›è¡Œç‰©ç†å†…å­˜åˆ†é…ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœç”³è¯·ç‰©ç†å†…å­˜å¤§å°è¶…è¿‡äº†ç©ºé—²ç‰©ç†å†…å­˜å¤§å°ï¼Œå°±è¦çœ‹æ“ä½œç³»ç»Ÿæœ‰æ²¡æœ‰å¼€å¯ Swap æœºåˆ¶ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚æœæ²¡æœ‰å¼€å¯ Swap æœºåˆ¶ï¼Œç¨‹åºå°±ä¼šç›´æ¥ OOMï¼›&lt;/li&gt;
&lt;li&gt;å¦‚æœæœ‰å¼€å¯ Swap æœºåˆ¶ï¼Œç¨‹åºå¯ä»¥æ­£å¸¸è¿è¡Œã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;å†…å­˜å›æ”¶&#34;&gt;å†…å­˜å›æ”¶&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;åå°å†…å­˜å›æ”¶ï¼šç‰©ç†å†…å­˜ç´§å¼ æ—¶ï¼Œå”¤é†’kswapdå†…æ ¸çº¿ç¨‹å¼‚æ­¥å›æ”¶å†…å­˜ï¼Œä¸ä¼šé˜»å¡è¿›ç¨‹çš„æ‰§è¡Œï¼›&lt;/li&gt;
&lt;li&gt;ç›´æ¥å†…å­˜å›æ”¶ï¼šåå°å¼‚æ­¥å›æ”¶è·Ÿä¸ä¸Šè¿›ç¨‹å†…å­˜ç”³è¯·çš„é€Ÿåº¦ï¼Œå°±ä¼šå¼€å§‹ç›´æ¥å›æ”¶ï¼Œæ­¤æ—¶æ˜¯åŒæ­¥çš„ï¼Œä¼šé˜»å¡è¿›ç¨‹çš„æ‰§è¡Œï¼Œå¯èƒ½é€ æˆé•¿æ—¶é—´çš„å»¶è¿Ÿï¼ŒCPUåˆ©ç”¨ç‡è¿‡é«˜ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦‚æœç›´æ¥å†…å­˜å›æ”¶åï¼Œç©ºé—²çš„ç‰©ç†å†…å­˜ä»ç„¶ä¸å¤Ÿç”¨ï¼Œå°±ä¼šè§¦å‘OOMæœºåˆ¶ï¼ŒOOM Killeræœºåˆ¶ä¼šæ ¹æ®ç®—æ³•é€‰æ‹©ä¸€ä¸ªå ç”¨ç‰©ç†å†…å­˜è¾ƒé«˜çš„è¿›ç¨‹ï¼Œå°†å…¶æ€æ­»ï¼Œé‡Šæ”¾å†…å­˜èµ„æºï¼Œå¦‚æœä¸å¤Ÿï¼Œå°±ç»§ç»­æ€ï¼Œç›´åˆ°é‡Šæ”¾è¶³å¤Ÿçš„å†…å­˜ä½ç½®ï¼›&lt;/p&gt;
&lt;p&gt;è¦æƒ³ä¿æŠ¤è¿›ç¨‹ä¸è¢«OOM Killeræ€æ­»ï¼Œå¯ä»¥è°ƒå¤§è¿›ç¨‹çš„&lt;code&gt;oom_score_adjå‚æ•°ï¼ŒèŒƒå›´æ˜¯-1000~1000&lt;/code&gt;å‚æ•°ï¼Œè®©è¯¥è¿›ç¨‹çš„å¾—åˆ†å°½å¯èƒ½çš„ä½ï¼Œæ¯”å¦‚è®¾ç½®ä¸º-1000ï¼Œæ°¸è¿œä¸ä¼šè¢«æ€æ­»ï¼›&lt;/p&gt;
&lt;h3 id=&#34;å¯è¢«å›æ”¶çš„å†…å­˜ç±»å‹&#34;&gt;å¯è¢«å›æ”¶çš„å†…å­˜ç±»å‹&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;æ–‡ä»¶é¡µï¼šå†…æ ¸ç¼“å­˜çš„ç£ç›˜æ•°æ®ï¼ˆBufferï¼‰å’Œå†…æ ¸ç¼“å­˜çš„æ–‡ä»¶æ•°æ®ï¼ˆPage Cacheï¼‰ï¼Œå›æ”¶æ—¶ï¼Œå¦‚æœæ˜¯è„é¡µï¼Œå°±ä¼šåˆ·å›ç£ç›˜ï¼Œå†å›æ”¶å†…å­˜ï¼Œå¦‚æœæ˜¯å¹²å‡€é¡µï¼Œåˆ™ç›´æ¥é‡Šæ”¾å†…å­˜å³å¯ï¼›&lt;/li&gt;
&lt;li&gt;åŒ¿åé¡µï¼šè¿™éƒ¨åˆ†å†…å­˜æ²¡æœ‰å®é™…è½½ä½“ï¼Œæ¯”å¦‚å †ã€æ ˆæ•°æ®ï¼Œè¿™éƒ¨åˆ†å†…å­˜å¾ˆå¯èƒ½è¿˜è¦å†æ¬¡è¢«è®¿é—®ï¼Œæ‰€ä»¥ä¸èƒ½ç›´æ¥é‡Šæ”¾ï¼Œè€Œæ˜¯é€šè¿‡Swapæœºåˆ¶ï¼Œäº¤æ¢åˆ°ç£ç›˜ï¼Œå†é‡Šæ”¾å†…å­˜ï¼Œç­‰åˆ°éœ€è¦å†æ¬¡ä½¿ç”¨æ—¶ï¼Œä»ç£ç›˜åŠ è½½å›å»ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å›æ”¶éƒ½æ˜¯åŸºäºLRUç®—æ³•ï¼Œä¼˜å…ˆå›æ”¶ä¸å¸¸è®¿é—®çš„å†…å­˜ï¼›&lt;/p&gt;
&lt;p&gt;å› ä¸ºå¯èƒ½ä¼šæ¶‰åŠåˆ°ç£ç›˜IOï¼Œå¦‚æœå†…å­˜å›æ”¶å¾ˆé¢‘ç¹ï¼Œå°±å¯èƒ½æœ‰æ€§èƒ½é—®é¢˜ï¼Œå¸¸è§çš„è§£å†³æ–¹å¼æœ‰ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è°ƒæ•´æ–‡ä»¶é¡µå’ŒåŒ¿åé¡µçš„å›æ”¶å€¾å‘ï¼šæ¯”å¦‚å›æ”¶æ–‡ä»¶é¡µå¦‚æœæ˜¯å¹²å‡€é¡µï¼Œä¸æ¶‰åŠç£ç›˜IOï¼Œé‚£å°±å¯ä»¥è®¾ç½®çš„æ¯”ä¾‹å¤§äº›ï¼ŒåŒ¿åé¡µçš„æ¯”ä¾‹å°ä¸€äº›ï¼›&lt;/li&gt;
&lt;li&gt;å°½æ—©è§¦å‘kswapdå†…æ ¸çº¿ç¨‹å¼‚æ­¥å›æ”¶å†…å­˜ï¼Œè°ƒæ•´è¿™ä¸ªçº¿ç¨‹çš„è§¦å‘é…ç½®ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;å…³äºé¢„è¯»å¤±æ•ˆå’Œç¼“å­˜æ±¡æŸ“é—®é¢˜&#34;&gt;å…³äºé¢„è¯»å¤±æ•ˆå’Œç¼“å­˜æ±¡æŸ“é—®é¢˜&lt;/h2&gt;
&lt;p&gt;è¿›ç¨‹è¯»å–æ–‡ä»¶æ•°æ®æ—¶ï¼Œä¼šå¯¹è¯»å–çš„æ–‡ä»¶æ•°æ®è¿›è¡Œç¼“å­˜ï¼Œç¼“å­˜åœ¨æ–‡ä»¶ç³»ç»Ÿçš„PageCacheä¸­ï¼Œèµ·åˆ°åŠ é€Ÿè®¿é—®æ•°æ®çš„ä½œç”¨ã€‚ç”±äºPage Cacheçš„å¤§å°æ˜¯æœ‰é™çš„ï¼Œå¯¹äºä¸€äº›é¢‘ç¹è®¿é—®çš„æ•°æ®å¸Œæœ›å¯ä»¥ä¸€ç›´ç•™åœ¨å†…å­˜ä¸­ï¼Œå¾ˆå°‘è®¿é—®çš„æ•°æ®å¸Œæœ›èƒ½åœ¨æŸäº›æ—¶æœºè¢«æ·˜æ±°æ‰ï¼Œæ‰€ä»¥ä¸€èˆ¬æ˜¯ä½¿ç”¨LRUç®—æ³•æ¥å®ç°ï¼Œä½†æ˜¯ä¼ ç»Ÿçš„LRUç®—æ³•æ— æ³•è§£å†³ä¸¤ä¸ªé—®é¢˜ï¼Œé¢„è¯»å¤±æ•ˆå’Œç¼“å­˜æ±¡æŸ“ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é¢„è¯»å¤±æ•ˆ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åŸºäºå±€éƒ¨æ€§åŸç†ï¼ŒPage Cacheè¯»ç¼“å­˜æœºåˆ¶ä¼šè¿›è¡Œé¢„è¯»ï¼Œå½“é‚£äº›é¢„è¯»è¿›æ¥çš„ï¼Œè¢«æå‰åŠ è½½è¿›æ¥çš„é¡µï¼Œå®é™…ä¸Šå¹¶æ²¡æœ‰è¢«è®¿é—®åˆ°ï¼Œæ­¤æ—¶é¢„è¯»å¤±æ•ˆï¼Œä½†æ˜¯è¿™äº›ä¸ä¼šè¢«è®¿é—®åˆ°çš„é¢„è¯»çš„é¡µå´å ç”¨äº†LRUé“¾è¡¨å‰æ’çš„ä½ç½®ï¼Œè€Œæœ«å°¾æ·˜æ±°çš„é¡µï¼Œå¯èƒ½æ˜¯çƒ­ç‚¹æ•°æ®ï¼Œè¿™æ ·å°±å¤§å¤§é™ä½äº†ç¼“å­˜çš„å‘½ä¸­ç‡ã€‚&lt;/p&gt;
&lt;p&gt;Linuxçš„è§£å†³æ–¹å¼ï¼šä½¿ç”¨ä¸¤ä¸ªLRUé“¾è¡¨ï¼Œä¸€ä¸ªæ´»è·ƒçš„ï¼Œä¸€ä¸ªéæ´»è·ƒçš„ï¼Œé¢„è¯»çš„æ—¶å€™ï¼Œé¢„è¯»é¡µå°±ä¼šåŠ å…¥åˆ°éæ´»è·ƒLRUé“¾è¡¨çš„å¤´éƒ¨ï¼Œå½“é¡µè¢«çœŸæ­£è®¿é—®åˆ°çš„æ—¶å€™ï¼Œæ‰ä¼šæ’å…¥æ´»è·ƒLRUé“¾è¡¨çš„å¤´éƒ¨ï¼Œå¦‚æœé¢„è¯»é¡µä¸€ç›´æ²¡æœ‰è¢«è®¿é—®ï¼Œå°±ä¼šä»éæ´»è·ƒé“¾è¡¨ä¸­ç§»é™¤ï¼Œè¿™æ ·å°±ä¸ä¼šå½±å“æ´»è·ƒé“¾è¡¨ä¸­çš„çƒ­ç‚¹æ•°æ®ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç¼“å­˜æ±¡æŸ“&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦‚æœæ•°æ®è¢«è®¿é—®äº†ä¸€æ¬¡ï¼Œå°±å°†æ•°æ®åŠ å…¥åˆ°æ´»è·ƒLRUé“¾è¡¨ä¸­ï¼Œåªè§£å†³äº†é¢„è¯»å¤±æ•ˆçš„é—®é¢˜ï¼Œç¼“å­˜æ±¡æŸ“çš„é—®é¢˜è¿˜æ²¡è§£å†³ï¼Œæ¯”å¦‚ï¼Œå½“æ‰¹é‡è¯»å–æ•°æ®çš„æ—¶å€™ï¼Œç”±äºè¿™äº›æ•°æ®è¢«è®¿é—®äº†ä¸€æ¬¡ï¼Œè¢«åŠ å…¥åˆ°æ´»è·ƒLRUé“¾è¡¨ä¸­ï¼Œå¯¼è‡´ä¹‹å‰ç¼“å­˜åœ¨æ´»è·ƒé“¾è¡¨ä¸­çš„çƒ­ç‚¹æ•°æ®è¢«æ·˜æ±°äº†ï¼Œä½†æ˜¯è¿™äº›æ–°åŠ å…¥çš„æ•°æ®ï¼Œåªè¢«è¯»å–äº†ä¸€æ¬¡ï¼Œä¹‹åå¾ˆé•¿ä¸€æ®µæ—¶é—´éƒ½ä¸ä¼šè¢«è®¿é—®äº†ï¼Œå°±å¯¼è‡´è¿™ä¸ªæ´»è·ƒLRUé“¾è¡¨ä¸€ç‚¹éƒ½ä¸æ´»è·ƒï¼Œå°±æ˜¯è¢«æ±¡æŸ“äº†ï¼Œå½“ä¹‹å‰çš„çƒ­ç‚¹æ•°æ®è¢«å†æ¬¡è®¿é—®çš„æ—¶å€™ï¼Œåˆä¼šäº§ç”Ÿå¤§é‡çš„ç£ç›˜IOï¼Œå¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚&lt;/p&gt;
&lt;p&gt;Linuxçš„è§£å†³æ–¹å¼ï¼šæé«˜åŠ å…¥åˆ°æ´»è·ƒLRUé“¾è¡¨çš„é—¨æ§›ï¼Œä¿è¯æ´»è·ƒé“¾è¡¨ä¸­çš„çƒ­ç‚¹æ•°æ®ä¸ä¼šè¢«è½»æ˜“æ›¿æ¢æ‰ã€‚æ¯”å¦‚å†…å­˜é¡µç¬¬ä¸€æ¬¡è®¿é—®çš„æ—¶å€™è¿˜æ˜¯åŠ å…¥éæ´»è·ƒé“¾è¡¨ï¼Œç¬¬äºŒæ¬¡è¢«è®¿é—®çš„æ—¶å€™ï¼Œæ‰å°†é¡µä»éæ´»è·ƒé“¾è¡¨ä¸­å‡çº§åˆ°æ´»è·ƒé“¾è¡¨ä¸­ã€‚&lt;/p&gt;
&lt;h2 id=&#34;linuxå†…å­˜ç®¡ç†&#34;&gt;Linuxå†…å­˜ç®¡ç†&lt;/h2&gt;
&lt;h3 id=&#34;è™šæ‹Ÿå†…å­˜ç©ºé—´&#34;&gt;è™šæ‹Ÿå†…å­˜ç©ºé—´&lt;/h3&gt;
&lt;p&gt;32 ä½æœºå™¨ä¸Šè¿›ç¨‹è™šæ‹Ÿå†…å­˜ç©ºé—´åˆ†å¸ƒï¼š&lt;/p&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/32%e4%bd%8d%e6%9c%ba%e5%99%a8%e4%b8%8aLinux%e8%bf%9b%e7%a8%8b%e7%94%a8%e6%88%b7%e6%80%81%e8%99%9a%e6%8b%9f%e5%86%85%e5%ad%98%e7%a9%ba%e9%97%b4%e5%88%86%e5%b8%83.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/32%e4%bd%8d%e6%9c%ba%e5%99%a8%e4%b8%8aLinux%e8%bf%9b%e7%a8%8b%e7%94%a8%e6%88%b7%e6%80%81%e8%99%9a%e6%8b%9f%e5%86%85%e5%ad%98%e7%a9%ba%e9%97%b4%e5%88%86%e5%b8%83.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¿ç•™åŒºï¼šä¸å¯è®¿é—®ï¼Œæ•°å€¼è¾ƒå°çš„åœ°å€é€šå¸¸è®¤ä¸ºæ˜¯ä¸åˆæ³•çš„åœ°å€ï¼Œæ¯”å¦‚è®¾ç½®æ— æ•ˆçš„æŒ‡é’ˆä¸ºNULLï¼Œå°±æŒ‡å‘è¿™é‡Œï¼›&lt;/li&gt;
&lt;li&gt;ä»£ç æ®µã€æ•°æ®æ®µã€BSSæ®µï¼šå­˜å‚¨ç¨‹åºçš„äºŒè¿›åˆ¶æ–‡ä»¶ä¸­çš„æœºå™¨ç ï¼Œä»¥åŠå®šä¹‰çš„æœ‰åˆå§‹å€¼çš„å…¨å±€å˜é‡ã€é™æ€å˜é‡æ”¾åœ¨æ•°æ®æ®µã€æ²¡æœ‰åˆå§‹å€¼çš„æ”¾åœ¨BSSæ®µï¼›&lt;/li&gt;
&lt;li&gt;å †å’Œå¾…åˆ†é…åŒºåŸŸï¼šå †ç©ºé—´åœ°å€å¢é•¿ä»ä½åœ°å€åˆ°é«˜åœ°å€å¢é•¿ï¼Œç”³è¯·æ–°å†…å­˜æ—¶ï¼Œåªéœ€ç§»åŠ¨å †é¡¶æŒ‡é’ˆåˆ°å¾…åˆ†é…åŒºå³å¯ï¼Œä»è€Œå®ç°ç©ºé—´æ‰©å±•ï¼›&lt;/li&gt;
&lt;li&gt;æ–‡ä»¶æ˜ å°„å’ŒåŒ¿åæ˜ å°„åŒºåŸŸï¼šè¿›ç¨‹è¿è¡Œæ‰€ä¾èµ–çš„åŠ¨æ€é“¾æ¥åº“ä¸­çš„ä»£ç æ®µã€æ•°æ®æ®µå’ŒBSSæ®µå°±åŠ è½½åœ¨è¿™é‡Œï¼Œmmapå‡½æ•°æ˜ å°„å‡ºæ¥çš„è™šæ‹Ÿå†…å­˜åœ°å€ä¹Ÿä¿å­˜åœ¨è¿™ï¼›&lt;/li&gt;
&lt;li&gt;æ ˆå’Œå¾…åˆ†é…åŒºåŸŸï¼šç”¨æˆ·ç¨‹åºå‡½æ•°è¿è¡Œè¿‡ç¨‹æ‰€éœ€è¦çš„å±€éƒ¨å˜é‡ï¼Œå‡½æ•°å‚æ•°ç­‰è°ƒç”¨ä¿¡æ¯å­˜æ”¾åœ¨æ­¤ï¼Œæ ˆç©ºé—´åœ°å€å¢é•¿æ–¹å‘æ˜¯ä»é«˜åˆ°ä½å¢é•¿ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;64ä½æœºå™¨ä¸Šè¿›ç¨‹ç”¨æˆ·æ€è™šæ‹Ÿå†…å­˜ç©ºé—´åˆ†å¸ƒç±»ä¼¼ï¼Œç”¨ä½48ä½è¡¨ç¤ºè™šæ‹Ÿåœ°å€ï¼Œé«˜16ä½çš„128Tè¡¨ç¤ºå†…æ ¸è™šæ‹Ÿå†…å­˜ç©ºé—´ï¼Œä½16ä½çš„128Tè¡¨ç¤ºç”¨æˆ·è™šæ‹Ÿå†…å­˜ç©ºé—´ï¼Œä¸­é—´16ä½ç©ºé—²åœ°å€è¢«ç§°ä¸º canonical addressä½œä¸ºç©ºæ´ï¼Œå¯ç”¨æ¥æ‰©å±•æˆ–è€…åšéæ³•è®¿é—®ç”¨ï¼›&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;é€šè¿‡ fork() å‡½æ•°åˆ›å»ºå‡ºçš„å­è¿›ç¨‹ï¼Œå®ƒçš„è™šæ‹Ÿå†…å­˜ç©ºé—´ä»¥åŠç›¸å…³é¡µè¡¨ç›¸å½“äºçˆ¶è¿›ç¨‹è™šæ‹Ÿå†…å­˜ç©ºé—´çš„ä¸€ä»½æ‹·è´ï¼Œç›´æ¥ä»çˆ¶è¿›ç¨‹ä¸­æ‹·è´åˆ°å­è¿›ç¨‹ä¸­ã€‚å­è¿›ç¨‹å…±äº«çˆ¶è¿›ç¨‹çš„è™šæ‹Ÿå†…å­˜ç©ºé—´ï¼Œè¿™æ ·çš„å­è¿›ç¨‹ä¹Ÿå°±æ˜¯çº¿ç¨‹äº†ï¼Œåœ¨Linuxä¸­éƒ½æ˜¯ä½¿ç”¨ &lt;code&gt;task_struct&lt;/code&gt; æ¥è¡¨ç¤ºä»–ä»¬ï¼Œå› ä¸ºå¯¹å†…æ ¸æ¥è¯´ä»–ä»¬æ˜¯ä¸€æ ·çš„ï¼›&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;32ä½æœºå™¨ä¸Šå†…æ ¸è™šæ‹Ÿå†…å­˜ç©ºé—´ï¼Œ&lt;strong&gt;å…¶å‰ 896M åŒºåŸŸæ˜¯ç›´æ¥æ˜ å°„åˆ°ç‰©ç†å†…å­˜ä¸­çš„å‰ 896M åŒºåŸŸä¸­çš„ï¼Œç›´æ¥æ˜ å°„åŒºä¸­çš„æ˜ å°„å…³ç³»æ˜¯ä¸€æ¯”ä¸€æ˜ å°„ã€‚æ˜ å°„å…³ç³»æ˜¯å›ºå®šçš„ä¸ä¼šæ”¹å˜ã€‚ä¸»è¦å­˜æ”¾è¿›ç¨‹çš„è°ƒç”¨é“¾&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/32%e4%bd%8d%e6%9c%ba%e5%99%a8%e4%b8%8aLinux%e8%bf%9b%e7%a8%8b%e5%86%85%e6%a0%b8%e8%99%9a%e6%8b%9f%e5%86%85%e5%ad%98%e7%a9%ba%e9%97%b4%e5%88%86%e5%b8%83.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/32%e4%bd%8d%e6%9c%ba%e5%99%a8%e4%b8%8aLinux%e8%bf%9b%e7%a8%8b%e5%86%85%e6%a0%b8%e8%99%9a%e6%8b%9f%e5%86%85%e5%ad%98%e7%a9%ba%e9%97%b4%e5%88%86%e5%b8%83.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;ç›´æ¥æ˜ å°„åŒºæœ‰896Mï¼Œç”±ä»¥ä¸‹å‡ éƒ¨åˆ†ç»„æˆï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å‰1Mç”±ç³»ç»Ÿå ç”¨ï¼Œå­˜æ”¾å†…æ ¸ä»£ç æ®µã€æ•°æ®æ®µã€BSSæ®µï¼›&lt;/li&gt;
&lt;li&gt;å‰16Mç”±å†…æ ¸ç”¨æ¥ä¸ºDMAåˆ†é…å†…å­˜ï¼Œç§°ä¸ºZONE_DMAï¼›&lt;/li&gt;
&lt;li&gt;16Måˆ°896Mç§°ä¸ºZONE_NORMALåŒºï¼Œæ²¡æœ‰ä»»ä½•é™åˆ¶ï¼›&lt;/li&gt;
&lt;li&gt;ç‰©ç†å†…å­˜896Mä»¥ä¸Šçš„éƒ¨åˆ†ä¸ºé«˜ç«¯å†…å­˜åŒºZONE_HIGHMEMï¼Œè¿™éƒ¨åˆ†ä¼šåŠ¨æ€æ˜ å°„åˆ°è™šæ‹Ÿå†…å­˜å†…æ ¸æ€å‰©ä½™çš„128Mé‡Œï¼›è¿™128Mé‡Œè¿˜ä¼šç»§ç»­åˆ†ï¼š
&lt;ul&gt;
&lt;li&gt;æœ‰8Mçš„å†…å­˜ç©ºæ´ï¼›&lt;/li&gt;
&lt;li&gt;vmallocåŠ¨æ€æ˜ å°„åŒºï¼Œæ˜ å°„å‰©ä½™çš„ç‰©ç†å†…å­˜ï¼›&lt;/li&gt;
&lt;li&gt;æ°¸ä¹…æ˜ å°„åŒºï¼Œå…è®¸è¿™æ®µè™šæ‹Ÿåœ°å€ç©ºé—´ä¸ç‰©ç†é«˜ç«¯å†…å­˜å»ºç«‹é•¿æœŸçš„æ˜ å°„å…³ç³»ï¼›&lt;/li&gt;
&lt;li&gt;å›ºå®šæ˜ å°„åŒºï¼Œåœ¨æ­¤åŒºåŸŸçš„è™šæ‹Ÿå†…å­˜åœ°å€å¯ä»¥è‡ªç”±æ˜ å°„åˆ°ç‰©ç†å†…å­˜çš„é«˜ç«¯åœ°å€ä¸Šï¼Œä½†æ˜¯ä¸åŠ¨æ€æ˜ å°„åŒºä»¥åŠæ°¸ä¹…æ˜ å°„åŒºä¸åŒçš„æ˜¯ï¼Œåœ¨å›ºå®šæ˜ å°„åŒºä¸­è™šæ‹Ÿåœ°å€æ˜¯å›ºå®šçš„ï¼Œè€Œè¢«æ˜ å°„çš„ç‰©ç†åœ°å€æ˜¯å¯ä»¥æ”¹å˜çš„ï¼›&lt;/li&gt;
&lt;li&gt;ä¸´æ—¶æ˜ å°„åŒºï¼Œæ¯”å¦‚ä¸€äº›ç¼“å­˜é¡µä¸´æ—¶æ˜ å°„ï¼Œç”¨å®Œå°±å›æ”¶ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;ä¼™ä¼´ç³»ç»Ÿ&#34;&gt;ä¼™ä¼´ç³»ç»Ÿ&lt;/h3&gt;
&lt;p&gt;Linuxä½¿ç”¨åˆ†é¡µæœºåˆ¶ç®¡ç†ç‰©ç†å†…å­˜ç³»ç»Ÿï¼ŒæŠŠç‰©ç†å†…å­˜åˆ†æˆ4KBå¤§å°çš„é¡µé¢è¿›è¡Œç®¡ç†ï¼Œé€šè¿‡ä¸€ä¸ªPageç»“æ„ä½“è¡¨ç¤ºä¸€ä¸ªç‰©ç†å†…å­˜é¡µé¢ã€‚&lt;/p&gt;
&lt;p&gt;å› ä¸ºç¡¬ä»¶çš„é™åˆ¶ï¼ŒLinuxæŠŠå±æ€§ç›¸åŒçš„ç‰©ç†å†…å­˜é¡µé¢ï¼Œå½’ç»“åˆ°ä¸€ä¸ªåŒºï¼Œä¸åŒçš„ç¡¬ä»¶ï¼Œåˆ’åˆ†ä¸åŒçš„åŒºã€‚åœ¨32ä½çš„x86å¹³å°ä¸­ï¼Œå°†0~16MBåˆ’åˆ†ä½DMAåŒºï¼Œé«˜å†…å­˜åŒºé€‚ç”¨äºè¦è®¿é—®çš„ç‰©ç†åœ°å€ç©ºé—´å¤§äºè™šæ‹Ÿåœ°å€ç©ºé—´ï¼ŒLinuxå†…æ ¸ä¸èƒ½å»ºç«‹ç›´æ¥æ˜ å°„çš„æƒ…å†µã€‚ç‰©ç†å†…å­˜ä¸­å‰©ä½™çš„é¡µé¢å°±åˆ’åˆ†ä½å¸¸è§„å†…å­˜åŒºï¼Œ64ä½çš„x86å¹³å°åˆ™æ²¡æœ‰é«˜å†…å­˜åŒºã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;åœ¨å¾ˆå¤šæœåŠ¡å™¨å’Œå¤§å‹è®¡ç®—æœºä¸Šï¼Œå¦‚æœç‰©ç†å†…å­˜æ˜¯åˆ†å¸ƒå¼çš„ï¼Œç”±å¤šä¸ªè®¡ç®—èŠ‚ç‚¹ç»„æˆï¼Œé‚£ä¹ˆæ¯ä¸ª CPU æ ¸éƒ½ä¼šæœ‰è‡ªå·±çš„æœ¬åœ°å†…å­˜ï¼ŒCPU åœ¨è®¿é—®å®ƒçš„æœ¬åœ°å†…å­˜çš„æ—¶å€™å°±æ¯”è¾ƒå¿«ï¼Œè®¿é—®å…¶ä»– CPU æ ¸å†…å­˜çš„æ—¶å€™å°±æ¯”è¾ƒæ…¢ï¼Œè¿™ç§ä½“ç³»ç»“æ„è¢«ç§°ä¸º Non-Uniform Memory Accessï¼ˆNUMAï¼‰&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;åœ¨å†…å­˜åŒºçš„ä¸Šå±‚ï¼Œé€šè¿‡å®šä¹‰èŠ‚ç‚¹pglist_dataï¼Œæ¥åŒ…å«å¤šä¸ªåŒº&lt;/p&gt;
&lt;p&gt;è¿ç»­ä¸”ç›¸åŒå¤§å°çš„Pageç»„æˆä¼™ä¼´ï¼ŒLinuxåœ¨åˆ†é…ç‰©ç†å†…å­˜é¡µé¢æ—¶ï¼Œé¦–å…ˆæ‰¾åˆ°å†…å­˜èŠ‚ç‚¹ï¼Œæ¥ç€æ‰¾åˆ°å†…å­˜åŒºï¼Œç„¶åæ˜¯åˆé€‚çš„ç©ºé—²é“¾è¡¨ï¼Œæœ€ååœ¨å…¶ä¸­æ‰¾åˆ°é¡µçš„Pageç»“æ„ï¼Œå®Œæˆç‰©ç†å†…å­˜é¡µé¢çš„åˆ†é…ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å†…å­˜å‹ç¼©ä¸æ˜¯æŒ‡å‹ç¼©å†…å­˜ä¸­çš„æ•°æ®ï¼Œè€Œæ˜¯æŒ‡ç§»åŠ¨å†…å­˜é¡µé¢ï¼Œè¿›è¡Œå†…å­˜ç¢ç‰‡æ•´ç†ï¼Œè…¾å‡ºæ›´å¤§çš„è¿ç»­çš„å†…å­˜ç©ºé—´ã€‚å¦‚æœå†…å­˜ç¢ç‰‡æ•´ç†äº†ï¼Œè¿˜æ˜¯ä¸èƒ½æˆåŠŸåˆ†é…å†…å­˜ï¼Œå°±è¦æ€æ­»è¿›ç¨‹ä»¥ä¾¿é‡Šæ”¾æ›´å¤šå†…å­˜é¡µé¢&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;åˆ†é…ç®—æ³•ï¼šå…³é”®å­—ï¼šå¿«é€Ÿåˆ†é…è·¯å¾„ã€æ…¢é€Ÿåˆ†é…è·¯å¾„ï¼Œåªæœ‰åœ¨å¿«é€Ÿåˆ†é…è·¯å¾„å¤±è´¥ä¹‹åï¼Œæ‰ä¼šè¿›å…¥æ…¢é€Ÿåˆ†é…è·¯å¾„ï¼Œæ…¢é€Ÿåˆ†é…è·¯å¾„ä¸­ä¼šè¿›è¡Œå†…å­˜å›æ”¶ç›¸å…³çš„å·¥ä½œã€‚æœ€åï¼Œé€šè¿‡ expand å‡½æ•°åˆ†å‰²ä¼™ä¼´ï¼Œå®Œæˆé¡µé¢åˆ†é…ã€‚&lt;/p&gt;
&lt;h3 id=&#34;slab&#34;&gt;SLAB&lt;/h3&gt;
&lt;p&gt;Linuxä½¿ç”¨SLABæ¥åˆ†é…æ¯”é¡µæ›´å°çš„å†…å­˜å¯¹è±¡ã€‚&lt;/p&gt;
&lt;p&gt;SLABåˆ†é…å™¨ä¼šæŠŠä¸€ä¸ªå†…å­˜é¡µé¢æˆ–è€…ä¸€ç»„è¿ç»­çš„å†…å­˜é¡µé¢ï¼Œåˆ’åˆ†æˆå¤§å°ç›¸åŒçš„å—ï¼Œæ¯ä¸€å°å—å†…å­˜å°±æ˜¯SLABå¯¹è±¡ï¼Œåœ¨è¿™ä¸€ç»„è¿ç»­çš„å†…å­˜é¡µé¢ä¸­é™¤äº†SLABå¯¹è±¡ï¼Œè¿˜æœ‰SLABç®¡ç†å¤´å’Œç€è‰²åŒºã€‚&lt;/p&gt;
&lt;p&gt;ç€è‰²åŒºæ˜¯ä¸€å—åŠ¨æ€çš„å†…å­˜å—ï¼Œå»ºç«‹SLABæ—¶æ‰ä¼šè®¾ç½®å®ƒçš„å¤§å°ï¼Œç›®çš„æ˜¯ä¸ºäº†é”™å¼€ä¸åŒçš„SLABå¯¹è±¡åœ°å€ï¼Œé™ä½ç¡¬ä»¶Cacheè¡Œä¸­åœ°å€çš„äº‰ç”¨ï¼Œé¿å…æŠ–åŠ¨äº§ç”Ÿçš„æ€§èƒ½ä¸‹é™ã€‚&lt;/p&gt;
&lt;p&gt;Linuxä½¿ç”¨kmen_cacheç»“æ„ç®¡ç†pageå¯¹åº”å†…å­˜é¡µé¢ä¸Šçš„å°å—å†…å­˜å¯¹è±¡ï¼Œç„¶åè®©è¯¥ page æŒ‡å‘ kmem_cacheï¼Œç”± kmem_cache_node ç»“æ„ç®¡ç†å¤šä¸ª pageã€‚&lt;/p&gt;
&lt;h1 id=&#34;è¿›ç¨‹&#34;&gt;è¿›ç¨‹&lt;/h1&gt;
&lt;p&gt;è¿›ç¨‹æ˜¯ä¸€ä¸ªåº”ç”¨ç¨‹åºè¿è¡Œæ—¶åˆ»çš„å®ä¾‹ï¼Œæ˜¯åº”ç”¨ç¨‹åºè¿è¡Œæ—¶æ‰€éœ€èµ„æºçš„å®¹å™¨ï¼Œæ˜¯ä¸€å †æ•°æ®ç»“æ„ã€‚æ“ä½œç³»ç»Ÿè®°å½•è¿™ä¸ªåº”ç”¨ç¨‹åºä½¿ç”¨äº†å¤šå°‘å†…å­˜ï¼Œæ‰“å¼€ä»€ä¹ˆæ–‡ä»¶ï¼Œæ§åˆ¶èµ„æºä¸å¯ç”¨æ—¶è¿›è¡Œç¡çœ ï¼Œè¿›ç¨‹è¿è¡Œåˆ°å“ªäº†ç­‰ç­‰è¿™äº›ç»Ÿè®¡ä¿¡æ¯ï¼Œæ”¾åˆ°å†…å­˜ä¸­ï¼ŒæŠ½è±¡æˆè¿›ç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;è¿›ç¨‹ä¸ºäº†è®©æ“ä½œç³»ç»Ÿç®¡ç†ï¼Œéœ€è¦æœ‰ä¸€ä¸ªåœ°å€ç©ºé—´ï¼Œè¯¥åœ°å€ç©ºé—´è‡³å°‘åŒ…å«ä¸¤éƒ¨åˆ†å†…å®¹ï¼šå†…æ ¸å’Œç”¨æˆ·çš„åº”ç”¨ç¨‹åºã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å½“ CPU åœ¨ R0 ç‰¹æƒçº§è¿è¡Œæ—¶ï¼Œå°±è¿è¡Œåœ¨å†…æ ¸çš„åœ°å€ç©ºé—´ä¸­ï¼Œå½“ CPU åœ¨ R3 ç‰¹æƒçº§æ—¶ï¼Œå°±è¿è¡Œåœ¨åº”ç”¨ç¨‹åºåœ°å€ç©ºé—´ä¸­ã€‚å„è¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´æ˜¯ç›¸åŒçš„ï¼Œå®ƒä»¬ä¹‹é—´ç‰©ç†åœ°å€ä¸åŒï¼Œæ˜¯ç”± MMU é¡µè¡¨è¿›è¡Œéš”ç¦»çš„ï¼Œæ‰€ä»¥æ¯ä¸ªè¿›ç¨‹çš„åº”ç”¨ç¨‹åºçš„ä»£ç ç»å¯¹ä¸èƒ½éšæ„è®¿é—®å†…æ ¸çš„ä»£ç å’Œæ•°æ®ã€‚&lt;/p&gt;
&lt;p&gt;æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ä¸€ä¸ªå†…æ ¸æ ˆï¼ŒæŒ‡å‘åŒä¸€ä¸ªå—å†…æ ¸å†…å­˜åŒºåŸŸï¼Œå…±äº«ä¸€ä»½å†…æ ¸ä»£ç å’Œå†…æ ¸æ•°æ®ã€‚å†…æ ¸è¿›ç¨‹ä½¿ç”¨ä¸€ä»½é¡µè¡¨ï¼Œç”¨æˆ·è¿›ç¨‹ä¸¤ä»½é¡µè¡¨ï¼Œç”¨æˆ·è¿›ç¨‹å¤šäº†ä¸€ä»½ç”¨æˆ·ç©ºé—´é¡µè¡¨ï¼Œä¸å…¶å®ƒç”¨æˆ·è¿›ç¨‹äº’ä¸å¹²æ‰°ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ç”±äºåº”ç”¨ç¨‹åºéœ€è¦å†…æ ¸æä¾›èµ„æºï¼Œè€Œå†…æ ¸éœ€è¦æ§åˆ¶åº”ç”¨ç¨‹åºçš„è¿è¡Œï¼Œè®©å…¶èƒ½éšæ—¶ä¸­æ–­æˆ–æ¢å¤æ‰§è¡Œï¼Œå› æ­¤éœ€è¦ä¿å­˜åº”ç”¨ç¨‹åºçš„æœºå™¨ä¸Šä¸‹æ–‡å’Œå®ƒè¿è¡Œæ—¶åˆ»çš„æ ˆã€‚ä½¿ç”¨å†…æ ¸çš„åŠŸèƒ½æ—¶ï¼Œä¼šå…ˆåœæ­¢åº”ç”¨ç¨‹åºä»£ç çš„è¿è¡Œï¼Œè¿›å…¥å†…æ ¸åœ°å€ç©ºé—´è¿è¡Œå†…æ ¸ä»£ç ï¼Œç„¶åè¿”å›ç»“æœã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;è¿›ç¨‹çš„æœºå™¨ä¸Šä¸‹æ–‡åˆ†ä¸ºå‡ ä¸ªéƒ¨åˆ†ï¼Œä¸€éƒ¨åˆ†æ˜¯ CPU å¯„å­˜å™¨ï¼Œä¸€éƒ¨åˆ†æ˜¯å†…æ ¸å‡½æ•°è°ƒç”¨è·¯å¾„ã€‚CPU çš„é€šç”¨å¯„å­˜å™¨ï¼Œæ˜¯ä¸­æ–­å‘ç”Ÿè¿›å…¥å†…æ ¸æ—¶ï¼Œå‹å…¥å†…æ ¸æ ˆä¸­çš„ï¼Œä»ä¸­æ–­å…¥å£å¤„å¼€å§‹è°ƒç”¨çš„å‡½æ•°ï¼Œéƒ½æ˜¯å±äºå†…æ ¸çš„å‡½æ•°ã€‚å‡½æ•°çš„è°ƒç”¨è·¯å¾„å°±åœ¨å†…æ ¸æ ˆä¸­ï¼Œæ•´ä¸ªè¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼šè¿›ç¨‹è°ƒåº¦å™¨å‡½æ•°ä¼šè°ƒç”¨è¿›ç¨‹åˆ‡æ¢å‡½æ•°ï¼Œå®Œæˆåˆ‡æ¢è¿›ç¨‹è¿™ä¸ªæ“ä½œï¼Œè€Œåœ¨è¿›ç¨‹åˆ‡æ¢å‡½æ•°ä¸­ä¼šä¿å­˜æ ˆå¯„å­˜å™¨çš„å€¼ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å»ºç«‹è¿›ç¨‹ï¼Œå…¶å®å°±æ˜¯åˆ›å»ºè¿›ç¨‹ç»“æ„ä½“ï¼Œåˆ†é…è¿›ç¨‹çš„å†…æ ¸æ ˆäºåº”ç”¨ç¨‹åºæ ˆï¼Œå¹¶å¯¹è¿›ç¨‹çš„å†…æ ¸æ ˆè¿›è¡Œåˆå§‹åŒ–ï¼Œæœ€åå°†è¿›ç¨‹åŠ å…¥è°ƒåº¦ç³»ç»Ÿï¼Œä»¥ä¾¿æŠ•å…¥è¿è¡Œã€‚&lt;/p&gt;
&lt;h2 id=&#34;è¿›ç¨‹çš„çŠ¶æ€&#34;&gt;è¿›ç¨‹çš„çŠ¶æ€&lt;/h2&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/%e8%bf%9b%e7%a8%8b%e7%9a%84%e7%8a%b6%e6%80%81.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/%e8%bf%9b%e7%a8%8b%e7%9a%84%e7%8a%b6%e6%80%81.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;å…³äºæŒ‚èµ·çŠ¶æ€ï¼Œæ˜¯&lt;strong&gt;æè¿°è¿›ç¨‹æ²¡æœ‰å ç”¨å®é™…çš„ç‰©ç†å†…å­˜ç©ºé—´çš„æƒ…å†µ&lt;/strong&gt;ï¼Œè€Œé˜»å¡çŠ¶æ€æ˜¯ç­‰å¾…æŸä¸ªäº‹ä»¶çš„è¿”å›ï¼›&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é˜»å¡æŒ‚èµ·çŠ¶æ€ï¼šè¿›ç¨‹åœ¨å¤–å­˜ï¼ˆç¡¬ç›˜ï¼‰å¹¶ç­‰å¾…æŸä¸ªäº‹ä»¶çš„å‡ºç°ï¼›&lt;/li&gt;
&lt;li&gt;å°±ç»ªæŒ‚èµ·çŠ¶æ€ï¼šè¿›ç¨‹åœ¨å¤–å­˜ï¼ˆç¡¬ç›˜ï¼‰ï¼Œä½†åªè¦è¿›å…¥å†…å­˜ï¼Œç«‹åˆ»è¿è¡Œï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¯¼è‡´è¿›ç¨‹æŒ‚èµ·çŠ¶æ€çš„åŸå› ä¸æ­¢æ˜¯æ‰€ç”¨å†…å­˜ç©ºé—´ä¸å†ç‰©ç†å†…å­˜ï¼Œè¿˜å¯èƒ½æ˜¯sleepè®©è¿›ç¨‹é—´æ­‡æ€§æŒ‚èµ·ï¼Œæˆ–è€…ç”¨æˆ·å¸Œæœ›æŒ‚èµ·ï¼Œæ¯”å¦‚ctrl + Zã€‚&lt;/p&gt;
&lt;h2 id=&#34;è¿›ç¨‹çš„é€šä¿¡æ–¹å¼&#34;&gt;è¿›ç¨‹çš„é€šä¿¡æ–¹å¼&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;åŒ¿åç®¡é“ï¼šåŠåŒå·¥ï¼Œå•å‘ï¼Œæ•°æ®åªèƒ½å‘ä¸€ä¸ªæ–¹å‘æµåŠ¨ï¼ŒåŒæ–¹éœ€è¦é€šä¿¡æ—¶ï¼Œéœ€è¦å»ºç«‹èµ·ä¸¤ä¸ªç®¡é“ï¼›ä¸”åªèƒ½ç”¨äºæœ‰çˆ¶å­å…³ç³»çš„è¿›ç¨‹ï¼›æœ¬è´¨æ˜¯ä¸€ä¸ªå†…æ ¸ç¼“å†²åŒºï¼Œå¯ä»¥çœ‹æˆæ˜¯å†…å­˜ä¸­çš„æ–‡ä»¶ï¼Œä½†ä¸å±äºæŸç§æ–‡ä»¶ç³»ç»Ÿï¼Œæ— éœ€æ˜¾ç¤ºæ‰“å¼€ï¼Œåˆ›å»ºæ—¶ç›´æ¥è¿”å›æ–‡ä»¶æè¿°ç¬¦ï¼Œè¯»å†™æ—¶éœ€è¦ç¡®å®šå¯¹æ–¹çš„å­˜åœ¨ï¼Œå¦åˆ™å°†é€€å‡ºï¼›ä»¥å…ˆè¿›å…ˆå‡ºçš„æ–¹å¼å­˜å–æ•°æ®ï¼Œé€šä¿¡çš„åŒæ–¹éœ€åˆ¶å®šå¥½æ•°æ®çš„æ ¼å¼ï¼›&lt;/p&gt;
&lt;p&gt;ç®¡é“ = å†…æ ¸é‡Œä¸€ä¸²ç¼“å­˜ï¼Œç®¡é“å†…æ•°æ®æ²¡æœ‰æ ¼å¼çš„æµå’Œå¤§å°é™åˆ¶ï¼ŒåŒ¿åç®¡é“æ¯”å¦‚Linuxä¸­çš„ &lt;code&gt;å‘½ä»¤A | å‘½ä»¤B&lt;/code&gt;ï¼Œæ­¤æ—¶ä¼šåœ¨shellè¿›ç¨‹ä¸‹åˆ›å»ºä¸¤ä¸ªå­å‘½ä»¤è¿›ç¨‹ï¼Œå½¢æˆçˆ¶å­å…³ç³»ï¼Œå®ç°é€šä¿¡ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æœ‰åç®¡é“ï¼šä¸»è¦è§£å†³åŒ¿åç®¡é“åªèƒ½ä½œç”¨ä¸æœ‰çˆ¶å­å…³ç³»çš„è¿›ç¨‹çš„é—®é¢˜ï¼Œé€šè¿‡ä¸€ä¸ªè·¯å¾„åå…³è”ï¼Œä»¥æ–‡ä»¶å½¢å¼å­˜åœ¨äºæ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œå³ä½¿æ²¡æœ‰äº²ç¼˜å…³ç³»çš„è¿›ç¨‹ä¹Ÿèƒ½é€šè¿‡è®¿é—®è·¯å¾„å®ç°é€šä¿¡ï¼›ç®¡é“åå­—å­˜åœ¨äºæ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œå†…å®¹å­˜åœ¨å†…å­˜ä¸­ï¼›æ‰“å¼€æ—¶å°±å¾—ç¡®å®šå¯¹æ–¹æ˜¯å¦å­˜åœ¨ï¼Œå¦åˆ™å°†é˜»å¡ï¼›&lt;/p&gt;
&lt;p&gt;æœ‰åç®¡é“ä¸å—çˆ¶å­å…³ç³»é™åˆ¶ï¼Œä»–æ˜¯æå‰åˆ›å»ºäº†ä¸€ä¸ªç±»å‹ä¸ºç®¡é“çš„è®¾å¤‡æ–‡ä»¶ï¼Œé€šè¿‡è¿™ä¸ªæ–‡ä»¶å®ç°é€šä¿¡ï¼›&lt;/p&gt;
&lt;p&gt;ç®¡é“é€šä¿¡æ—¶ï¼ŒFIFOï¼Œéœ€è¦æœ‰æ¥æ”¶è€…ï¼Œå¦åˆ™å‘é€è€…ä¼šé˜»å¡ï¼Œæ— æ³•é€€å‡ºï¼Œç”Ÿå‘½å‘¨æœŸéšè¿›ç¨‹ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¿¡å·ï¼šæ“ä½œç³»ç»Ÿæä¾›çš„ä¸€ç§å¼‚æ­¥é€šä¿¡æœºåˆ¶ï¼Œå¯ä»¥åœ¨ä»»ä½•æ—¶å€™å‘ç»™æŸä¸€è¿›ç¨‹ï¼Œè€Œæ— éœ€æŒ‡å®šè¯¥è¿›ç¨‹çš„çŠ¶æ€ï¼Œå¦‚æœè¯¥è¿›ç¨‹å½“å‰å¤„äºæœªæ‰§è¡ŒçŠ¶æ€ï¼Œè¯¥ä¿¡å·å°±ç”±å†…æ ¸ä¿å­˜èµ·æ¥ï¼Œç›´åˆ°è¿›ç¨‹å›å¤æ‰§è¡Œå¹¶ä¼ é€’ä¸ºæ­¢ï¼›ä¿¡å·æ¥æ”¶å¯ä»¥è¢«é˜»å¡ï¼Œç›´åˆ°é˜»å¡è§£é™¤ï¼›æœ¬è´¨æ˜¯å¯¹ä¸­æ–­æœºåˆ¶çš„æ¨¡æ‹Ÿï¼Œå¼‚æ­¥é€šä¿¡ï¼Œåœ¨ç”¨æˆ·æ€å’Œå†…æ ¸æ€ä¹‹é—´äº¤äº’ï¼›èƒ½æºå¸¦çš„ä¿¡æ¯è¾ƒå°‘ã€‚&lt;/p&gt;
&lt;p&gt;ä¿¡å·æ˜¯è¿›ç¨‹é—´é€šä¿¡æœºåˆ¶ä¸­å”¯ä¸€çš„å¼‚æ­¥é€šä¿¡æœºåˆ¶ï¼Œè¿›ç¨‹éœ€è¦æ³¨å†Œå¯¹äºçš„ä¿¡å·å¤„ç†å‡½æ•°ï¼Œè¿›è¡Œä¿¡å·å¤„ç†ï¼Œä¸€èˆ¬æœ‰ä¸‰ç§å“åº”æ–¹å¼ï¼šé»˜è®¤ã€æ•æ‰ã€å¿½ç•¥ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ¶ˆæ¯é˜Ÿåˆ—ï¼šå­˜æ”¾åœ¨å†…æ ¸ä¸­çš„æ¶ˆæ¯é“¾è¡¨ï¼Œæ¶ˆæ¯ä½“ç”±ç”¨æˆ·è‡ªå®šä¹‰ï¼Œæ¯ä¸ªæ¶ˆæ¯ä½“éƒ½æ˜¯å›ºå®šå¤§å°çš„å­˜å‚¨å—ï¼Œåªæœ‰åœ¨å†…æ ¸é‡å¯æˆ–æ˜¾ç¤ºåœ°åˆ é™¤æ—¶ï¼Œæ‰ä¼šè¢«çœŸæ­£çš„åˆ é™¤ï¼Œä¸ç®¡é“ä¸åŒçš„æ˜¯æ¶ˆæ¯é˜Ÿåˆ—ä¸éœ€è¦ç¡®å®šæ¥æ”¶è¿›ç¨‹æ˜¯å¦å­˜åœ¨ï¼›ä¸€èˆ¬æ˜¯FIFOï¼Œä½†ä¹Ÿå¯ä»¥å®ç°æˆéšæœºæŸ¥è¯¢ï¼›å¯¹æ¶ˆæ¯æ ¼å¼ï¼Œç¼“å†²åŒºå¤§å°ç­‰éƒ½èƒ½è¿›è¡Œæ§åˆ¶ï¼Œæ¯”ç®¡é“çµæ´»ï¼›æ¶ˆæ¯é˜Ÿåˆ—é€šä¿¡çš„é€Ÿåº¦ä¸æ˜¯æœ€åŠæ—¶çš„ï¼Œå› ä¸ºæ¯æ¬¡æ•°æ®çš„å†™å…¥å’Œè¯»å–éƒ½éœ€è¦ç»è¿‡ç”¨æˆ·æ€ä¸å†…æ ¸æ€ä¹‹é—´çš„æ‹·è´è¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;æ¶ˆæ¯é˜Ÿåˆ—ä¸é€‚åˆè¾ƒå¤§æ•°æ®çš„ä¼ è¾“ï¼Œä¸”é€šä¿¡ä¸å¤ŸåŠæ—¶ï¼Œå› ä¸ºæ¶ˆæ¯é˜Ÿåˆ—å­˜åœ¨å†…æ ¸ï¼Œsoå­˜åœ¨ç”¨æˆ·æ€å’Œå†…æ ¸æ€æ•°æ®çš„æ‹·è´å¼€é”€ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å…±äº«å†…å­˜ï¼šæ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œåªæ˜¯åœ¨è®¿é—®å…±äº«å†…å­˜æ—¶è¦ä¾é ä¸€äº›åŒæ­¥æˆ–äº’æ–¥æœºåˆ¶ä¿è¯å¹¶å‘è®¿é—®å®‰å…¨ï¼›ä¸¤ä¸ªè¿›ç¨‹åœ¨è™šæ‹Ÿå†…å­˜æ‹¿å‡ºä¸€å—åœ°å€ç©ºé—´ï¼Œæ˜ å°„åˆ°åŒä¸€å—ç‰©ç†å†…å­˜ä¸­ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¿¡å·é‡ï¼šè®¡æ•°å™¨ï¼Œä¸€èˆ¬ç”¨äºå¤šè¿›ç¨‹å¯¹å…±äº«å†…å­˜è®¿é—®çš„ä¿æŠ¤ï¼Œå†…æ ¸ä¸­å®ç°ï¼Œä¿è¯åŸå­æ“ä½œï¼Œä¸»è¦å®ç°è¿›ç¨‹é—´çš„äº’æ–¥å’ŒåŒæ­¥ï¼Œä¸ç”¨äºæ•°æ®é€šä¿¡ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Socketé€šä¿¡ï¼šé€šä¿¡æœºåˆ¶ï¼Œå¯ç”¨åœ¨æœ¬æœºæˆ–è€…è·¨ç½‘ç»œï¼Œç”±åŸŸã€ç«¯å£å·ã€åè®®ç±»å‹ä¸‰ä¸ªå±æ€§ç¡®å®šï¼›åŸŸåˆ†ä¸ºAF_INETï¼Œå³ç½‘ç»œï¼Œå¦ä¸€ä¸ªæ˜¯AF_UNIXï¼Œå³æ–‡ä»¶ç³»ç»Ÿï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;çº¿ç¨‹è¿›ç¨‹åç¨‹&#34;&gt;çº¿ç¨‹ã€è¿›ç¨‹ã€åç¨‹&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è¿›ç¨‹&lt;/strong&gt;ï¼šå¯ä»¥ç®€å•ç†è§£ä¸ºä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œè¿›ç¨‹æ˜¯èµ„æºåˆ†é…çš„åŸºæœ¬å•ä½ã€‚æ¯”å¦‚ä¸€ä¸ªè¿›ç¨‹æ‹¥æœ‰è‡ªå·±çš„å †ã€æ ˆã€è™šå­˜ç©ºé—´ã€æ–‡ä»¶æè¿°ç¬¦ç­‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;çº¿ç¨‹&lt;/strong&gt;ï¼šçº¿ç¨‹æ˜¯ç‹¬ç«‹è°ƒåº¦çš„åŸºæœ¬å•ä½ï¼Œç”±CPUè¿›è¡Œè°ƒåº¦å’Œæ‰§è¡Œçš„å®ä½“ã€‚ä¸€ä¸ªè¿›ç¨‹ä¸­å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹ï¼Œçº¿ç¨‹ä¹‹é—´å…±äº«è¿›ç¨‹èµ„æºï¼Œæ¯ä¸ªçº¿ç¨‹åˆå„è‡ªæœ‰ä¸€å¥—ç‹¬ç«‹çš„å¯„å­˜å™¨å’Œæ ˆï¼Œç¡®ä¿çº¿ç¨‹çš„æ§åˆ¶æµæ˜¯ç›¸å¯¹ç‹¬ç«‹çš„ï¼Œæ˜¯è¿›ç¨‹ä¸­çš„å®é™…è¿ä½œå•ä½ï¼Œç›¸å½“äºè¿›ç¨‹ä¸­çš„ä¸€æ¡æ‰§è¡Œæµç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ä¼˜ç‚¹&lt;/strong&gt;ï¼šä¸€ä¸ªè¿›ç¨‹ä¸­å¯ä»¥åŒæ—¶å­˜åœ¨å¤šä¸ªçº¿ç¨‹ï¼Œå„ä¸ªçº¿ç¨‹å¯ä»¥å¹¶å‘æ‰§è¡Œï¼Œå„ä¸ªçº¿ç¨‹å¯ä»¥å…±äº«åœ°å€ç©ºé—´å’Œæ–‡ä»¶ç­‰èµ„æºï¼›&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç¼ºç‚¹&lt;/strong&gt;ï¼šå¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œå½“è¿›ç¨‹ä¸­çš„ä¸€ä¸ªçº¿ç¨‹å´©æºƒæ—¶ï¼Œä¼šå¯¼è‡´å…¶æ‰€å±è¿›ç¨‹çš„æ‰€æœ‰çº¿ç¨‹å´©æºƒï¼Œå› ä¸ºæ‰€æœ‰çº¿ç¨‹å…±äº«è¿›ç¨‹èµ„æºï¼Œå½“æœ‰çº¿ç¨‹å´©æºƒæ—¶ï¼Œå¯èƒ½æ±¡æŸ“äº†å…±äº«èµ„æºï¼Œä¸ºäº†é¿å…å…¶ä»–çº¿ç¨‹è®¿é—®å‡ºé”™ï¼Œå°±ç›´æ¥ä½¿å¾—æ•´ä¸ªè¿›ç¨‹å´©æºƒï¼Œçº¿ç¨‹å´©æºƒçš„æ—¶å€™é€šè¿‡ä¿¡å·ä¼ é€’ç»™è¿›ç¨‹ï¼›æ‰€ä»¥ï¼Œå¦‚æœä¸æƒ³è®©è¿›ç¨‹å´©æºƒï¼Œé‚£å°±å¾—æœ‰å¯¹åº”çš„ä¿¡å·å¤„ç†å‡½æ•°æ¥å®ç°å´©æºƒåçš„æ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;çº¿ç¨‹é—´çš„é€šä¿¡&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;åŒä¸ªè¿›ç¨‹ä¸‹çš„çº¿ç¨‹ä¹‹é—´éƒ½æ˜¯å…±äº«è¿›ç¨‹çš„èµ„æºï¼Œåªè¦æ˜¯å…±äº«å˜é‡éƒ½å¯ä»¥åšåˆ°çº¿ç¨‹é—´é€šä¿¡ï¼Œæ¯”å¦‚å…¨å±€å˜é‡ï¼Œæ‰€ä»¥å¯¹äºçº¿ç¨‹é—´å…³æ³¨çš„ä¸æ˜¯é€šä¿¡æ–¹å¼ï¼Œè€Œæ˜¯å…³æ³¨å¤šçº¿ç¨‹ç«äº‰å…±äº«èµ„æºçš„é—®é¢˜ï¼Œä¿¡å·é‡ä¹ŸåŒæ ·å¯ä»¥åœ¨çº¿ç¨‹é—´å®ç°äº’æ–¥ä¸åŒæ­¥&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åç¨‹&lt;/strong&gt;ï¼šGoLangä¸­çš„åç¨‹&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨ç”¨æˆ·æ€å±‚é¢ï¼Œç”±çº¿ç¨‹æ§åˆ¶ï¼Œå³ç”¨æˆ·åº”ç”¨å±‚é¢è‡ªå·±æ§åˆ¶ï¼Œå¾ˆéš¾åƒæŠ¢å å¼è°ƒåº¦é‚£æ ·å¼ºåˆ¶CPUåˆ‡æ¢åˆ°å…¶ä»–çº¿ç¨‹/è¿›ç¨‹ï¼Œåªèƒ½æ˜¯åä½œå¼è°ƒåº¦ï¼Œä½†åŒæ—¶ä¹Ÿé¿å…äº†ä¸Šä¸‹æ–‡åˆ‡æ¢&lt;/li&gt;
&lt;li&gt;å†…å­˜æ¶ˆè€—æ¯”çº¿ç¨‹å°ï¼Œæ¯”å¦‚goå¼€å¯åç¨‹æ˜¯å‡ kbï¼Œjavaå¼€å¯ä¸€ä¸ªçº¿ç¨‹è‡³å°‘1MB&lt;/li&gt;
&lt;li&gt;å®ç°åŸç†ï¼šåœ¨ä¸€ä¸ªè¿è¡Œçš„çº¿ç¨‹ä¸Šï¼Œèµ·å¤šä¸ªåç¨‹ï¼Œæ¯ä¸ªåç¨‹ä¼šåŠ å…¥åˆ°è°ƒåº¦é˜Ÿåˆ—ä¸­ï¼Œçº¿ç¨‹ä¼šä»è°ƒåº¦é˜Ÿåˆ—é‡Œå–å‡ºåç¨‹è¿›è¡Œè¿è¡Œã€‚é˜Ÿåˆ—ä¸ªæ•°é»˜è®¤å–å†³äºCPUçš„ä¸ªæ•°ï¼Œåç¨‹é—´çš„åˆ‡æ¢ä¼šçº¿ç¨‹ä½¿ç”¨goæä¾›çš„ioå‡½æ•°è¿›è¡Œæ§åˆ¶ã€‚å½“æœ‰åç¨‹æ‰§è¡Œè¾ƒæ…¢æ—¶ï¼Œä¼šå…ˆå°†å…¶æŒ‚èµ·ï¼Œç„¶åå”¤é†’å…¶ä»–çº¿ç¨‹ï¼Œå°†æœªå¤„ç†çš„åç¨‹é˜Ÿåˆ—è½¬ç§»åˆ°è¯¥çº¿ç¨‹ï¼Œæ¶ˆè´¹é˜Ÿåˆ—é‡Œçš„åç¨‹ï¼Œå½“é˜Ÿåˆ—æ¶ˆè´¹å®Œæˆåï¼Œå†åˆ‡å›åŸæ¥çš„çº¿ç¨‹ï¼Œç»§ç»­æ‰§è¡ŒåˆšåˆšæŒ‚èµ·çš„åç¨‹ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å‚è€ƒï¼š&lt;a class=&#34;link&#34; href=&#34;https://www.cnblogs.com/secondtonone1/p/11803961.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;å›¾è§£Goåç¨‹è°ƒåº¦åŸç†ï¼Œå°ç™½éƒ½èƒ½ç†è§£ &lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.zhihu.com/question/20862617&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Golang çš„ goroutine æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;è¿›ç¨‹ä¸çº¿ç¨‹çš„åŒºåˆ«&#34;&gt;è¿›ç¨‹ä¸çº¿ç¨‹çš„åŒºåˆ«&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;æ‹¥æœ‰èµ„æº&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;è¿›ç¨‹æ˜¯èµ„æºåˆ†é…çš„åŸºæœ¬å•ä½&lt;/strong&gt;ï¼Œçº¿ç¨‹ä¸æ‹¥æœ‰èµ„æºï¼Œçº¿ç¨‹å¯ä»¥è®¿é—®éš¶å±è¿›ç¨‹çš„èµ„æºã€‚&lt;/p&gt;
&lt;p&gt;å…±äº«çš„èµ„æºï¼šå†…å­˜åˆ†é…é¡µè¡¨ï¼Œå…±äº«å†…å­˜åœ°å€ï¼Œæ–‡ä»¶èµ„æºï¼ŒIOè®¾å¤‡èµ„æºï¼Œå…¨å±€å˜é‡&lt;/p&gt;
&lt;p&gt;ç‹¬äº«çš„èµ„æºï¼šå¯„å­˜å™¨ï¼Œæ ˆ&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è°ƒåº¦&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;çº¿ç¨‹æ˜¯ç‹¬ç«‹è°ƒåº¦çš„åŸºæœ¬å•ä½&lt;/strong&gt;ï¼Œåœ¨åŒä¸€è¿›ç¨‹ä¸­ï¼Œçº¿ç¨‹çš„åˆ‡æ¢ä¸ä¼šå¼•èµ·è¿›ç¨‹åˆ‡æ¢ï¼Œä»ä¸€ä¸ªè¿›ç¨‹ä¸­çš„çº¿ç¨‹åˆ‡æ¢åˆ°å¦ä¸€ä¸ªè¿›ç¨‹ä¸­çš„çº¿ç¨‹æ—¶ï¼Œä¼šå¼•èµ·è¿›ç¨‹åˆ‡æ¢ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç³»ç»Ÿå¼€é”€&lt;/p&gt;
&lt;p&gt;ç”±äºåˆ›å»ºæˆ–æ’¤é”€è¿›ç¨‹æ—¶ï¼Œç³»ç»Ÿéƒ½è¦ä¸ºä¹‹åˆ†é…æˆ–å›æ”¶èµ„æºï¼Œå¦‚å†…å­˜ç©ºé—´ã€I/O è®¾å¤‡ç­‰ï¼Œæ‰€ä»˜å‡ºçš„å¼€é”€è¿œå¤§äºåˆ›å»ºæˆ–æ’¤é”€çº¿ç¨‹æ—¶çš„å¼€é”€ã€‚ç±»ä¼¼åœ°ï¼Œåœ¨è¿›è¡Œè¿›ç¨‹åˆ‡æ¢æ—¶ï¼Œæ¶‰åŠå½“å‰æ‰§è¡Œè¿›ç¨‹ CPU ç¯å¢ƒçš„ä¿å­˜åŠæ–°è°ƒåº¦è¿›ç¨‹ CPU ç¯å¢ƒçš„è®¾ç½®ï¼Œè€Œçº¿ç¨‹å› ä¸ºä¼šå…±äº«ä¸€äº›è¿›ç¨‹çš„èµ„æºï¼Œåˆ‡æ¢æ—¶åªéœ€ä¿å­˜å’Œè®¾ç½®å°‘é‡å¯„å­˜å™¨å†…å®¹ï¼Œå¼€é”€å¾ˆå°ï¼Œå…·ä½“ä½“ç°åœ¨ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;çº¿ç¨‹çš„åˆ›å»ºæ—¶é—´æ¯”è¿›ç¨‹å¿«ï¼Œå› ä¸ºè¿›ç¨‹åœ¨åˆ›å»ºçš„è¿‡ç¨‹ä¸­ï¼Œè¿˜éœ€è¦èµ„æºç®¡ç†ä¿¡æ¯ï¼Œæ¯”å¦‚å†…å­˜ç®¡ç†ä¿¡æ¯ã€æ–‡ä»¶ç®¡ç†ä¿¡æ¯ï¼Œè€Œçº¿ç¨‹åœ¨åˆ›å»ºçš„è¿‡ç¨‹ä¸­ï¼Œä¸ä¼šæ¶‰åŠè¿™äº›èµ„æºç®¡ç†ä¿¡æ¯ï¼Œè€Œæ˜¯å…±äº«å®ƒä»¬ï¼›&lt;/li&gt;
&lt;li&gt;çº¿ç¨‹çš„ç»ˆæ­¢æ—¶é—´æ¯”è¿›ç¨‹å¿«ï¼Œå› ä¸ºçº¿ç¨‹é‡Šæ”¾çš„èµ„æºç›¸æ¯”è¿›ç¨‹å°‘å¾ˆå¤šï¼›&lt;/li&gt;
&lt;li&gt;åŒä¸€ä¸ªè¿›ç¨‹å†…çš„çº¿ç¨‹åˆ‡æ¢æ¯”è¿›ç¨‹åˆ‡æ¢å¿«ï¼Œå› ä¸ºçº¿ç¨‹å…·æœ‰ç›¸åŒçš„åœ°å€ç©ºé—´ï¼ˆè™šæ‹Ÿå†…å­˜å…±äº«ï¼‰ï¼Œè¿™æ„å‘³ç€åŒä¸€ä¸ªè¿›ç¨‹çš„çº¿ç¨‹éƒ½å…·æœ‰åŒä¸€ä¸ªé¡µè¡¨ï¼Œé‚£ä¹ˆåœ¨åˆ‡æ¢çš„æ—¶å€™ä¸éœ€è¦åˆ‡æ¢é¡µè¡¨ã€‚è€Œå¯¹äºè¿›ç¨‹ä¹‹é—´çš„åˆ‡æ¢ï¼Œåˆ‡æ¢çš„æ—¶å€™è¦æŠŠé¡µè¡¨ç»™åˆ‡æ¢æ‰ï¼Œè€Œé¡µè¡¨çš„åˆ‡æ¢è¿‡ç¨‹å¼€é”€æ˜¯æ¯”è¾ƒå¤§çš„ï¼›&lt;/li&gt;
&lt;li&gt;ç”±äºåŒä¸€è¿›ç¨‹çš„å„çº¿ç¨‹é—´å…±äº«å†…å­˜å’Œæ–‡ä»¶èµ„æºï¼Œé‚£ä¹ˆåœ¨çº¿ç¨‹ä¹‹é—´æ•°æ®ä¼ é€’çš„æ—¶å€™ï¼Œå°±ä¸éœ€è¦ç»è¿‡å†…æ ¸äº†ï¼Œè¿™å°±ä½¿å¾—çº¿ç¨‹ä¹‹é—´çš„æ•°æ®äº¤äº’æ•ˆç‡æ›´é«˜äº†ï¼›&lt;/li&gt;
&lt;li&gt;çº¿ç¨‹æœ‰ä¸€ä¸ªç¨‹åºè®¡æ•°å™¨ï¼ˆPCï¼‰ï¼Œè®°å½•ç¨‹åºä»å“ªè·å–æŒ‡ä»¤ï¼Œæ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·±çš„ä¸€ç»„ç”¨äºè®¡ç®—çš„å¯„å­˜å™¨ã€‚å¦‚æœæœ‰ä¸¤ä¸ªçº¿ç¨‹è¿è¡Œåœ¨ä¸€ä¸ªCPUä¸Šï¼Œçº¿ç¨‹åˆ‡æ¢å¿…å®šå‘ç”Ÿä¸Šä¸‹æ–‡åˆ‡æ¢ï¼›å¯¹äºè¿›ç¨‹ï¼Œè¿›ç¨‹çŠ¶æ€ä¿å­˜åœ¨è¿›ç¨‹æ§åˆ¶å—ï¼ˆPCBï¼‰ï¼Œæ¯ä¸€ä¸ªçº¿ç¨‹çš„çŠ¶æ€ä¿å­˜åœ¨çº¿ç¨‹æ§åˆ¶å—ï¼ˆTCBï¼‰ï¼Œæ¯ä¸€ä¸ªçº¿ç¨‹æœ‰è‡ªå·±çš„æ ˆç©ºé—´ï¼ˆThreadLocalï¼‰ï¼›ä¸è¿›ç¨‹ç›¸æ¯”ï¼Œçº¿ç¨‹åˆ‡æ¢æ—¶ï¼Œåœ°å€ç©ºé—´ä¿æŒä¸å˜ï¼Œå³ä¸éœ€è¦ä¿æŒåˆ‡æ¢å½“å‰ä½¿ç”¨çš„é¡µè¡¨ï¼Œ&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;é€šä¿¡æ–¹é¢&lt;/p&gt;
&lt;p&gt;çº¿ç¨‹é—´å¯ä»¥é€šè¿‡ç›´æ¥è¯»å†™åŒä¸€è¿›ç¨‹ä¸­çš„æ•°æ®è¿›è¡Œé€šä¿¡ï¼Œæ— éœ€ç»è¿‡å†…æ ¸ã€‚åœ¨javaä¸­å¦‚ä½¿ç”¨å…±äº«å˜é‡ã€wait/notifyæœºåˆ¶ã€é˜»å¡é˜Ÿåˆ—ï¼›ä½†æ˜¯è¿›ç¨‹é€šä¿¡éœ€è¦å€ŸåŠ©ç®¡é“ã€æ¶ˆæ¯é˜Ÿåˆ—ã€å…±äº«å†…å­˜ã€ä¿¡å·é‡ã€ä¿¡å·ã€å¥—æ¥å­—socket&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¸Šä¸‹æ–‡åˆ‡æ¢çš„å¼€é”€&lt;/p&gt;
&lt;p&gt;æ“ä½œç³»ç»Ÿçš„ä»»åŠ¡è°ƒåº¦ï¼Œå®é™…ä¸Šçš„è°ƒåº¦å¯¹è±¡æ˜¯çº¿ç¨‹ï¼Œè€Œè¿›ç¨‹åªæ˜¯ç»™çº¿ç¨‹æä¾›äº†è™šæ‹Ÿå†…å­˜ï¼Œå…¨å±€å˜é‡ç­‰èµ„æºï¼Œå½“ä¸¤ä¸ªçº¿ç¨‹ä¸å±äºåŒä¸€ä¸ªè¿›ç¨‹ï¼Œåˆ‡æ¢è¿‡ç¨‹è·Ÿè¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ä¸€æ ·ï¼›å½“ä¸¤ä¸ªçº¿ç¨‹å±äºåŒä¸€ä¸ªè¿›ç¨‹ï¼Œå› ä¸ºæœ‰å…±äº«èµ„æºå’Œç§æœ‰èµ„æºï¼Œåœ¨åˆ‡æ¢çº¿ç¨‹æ—¶ï¼Œåªéœ€è¦åˆ‡æ¢ç§æœ‰æ•°æ®ã€å¯„å­˜å™¨ç­‰ä¸å…±äº«çš„æ•°æ®å³å¯ï¼Œå¼€é”€å°±ä¼šå°å¾ˆå¤šã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;çº¿ç¨‹ä¸åç¨‹çš„åŒºåˆ«&#34;&gt;çº¿ç¨‹ä¸åç¨‹çš„åŒºåˆ«&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;ä¸€ä¸ªçº¿ç¨‹å¯ä»¥æœ‰å¤šä¸ªåç¨‹ï¼Œä¸€ä¸ªè¿›ç¨‹ä¹Ÿå¯ä»¥æœ‰å¤šä¸ªåç¨‹&lt;/li&gt;
&lt;li&gt;åç¨‹ä¸è¢«æ“ä½œç³»ç»Ÿå†…æ ¸ç®¡ç†ï¼Œå®Œå…¨ç”±ç¨‹åºæ§åˆ¶ï¼›çº¿ç¨‹æ˜¯è¢«åˆ†å‰²çš„CPUèµ„æºï¼Œåç¨‹æ˜¯ç»„ç»‡å¥½çš„ç¨‹åºå†…çš„ä»£ç ï¼Œåç¨‹ä¸ä¼šç›´æ¥ä½¿ç”¨çº¿ç¨‹ï¼Œåç¨‹ç›´æ¥åˆ©ç”¨çš„æ˜¯æ‰§è¡Œå™¨å…³è”ä»»æ„çº¿ç¨‹æˆ–çº¿ç¨‹æ± &lt;/li&gt;
&lt;li&gt;åç¨‹èƒ½ä¿ç•™ä¸Šä¸€æ¬¡è°ƒç”¨æ—¶çš„çŠ¶æ€&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;åç¨‹æœ¬è´¨ä¸Šå¯ä»¥çœ‹ä½œæ˜¯å¯æŒ‚èµ·å’Œæ¢å¤çš„ç”¨æˆ·æ€è½»é‡çº§çº¿ç¨‹ï¼Œå¯ä»¥åœ¨æ²¡æœ‰å¤šçº¿ç¨‹ç¯å¢ƒä¸‹æ¨¡æ‹Ÿå¹¶å‘ï¼Œä¹Ÿå¯ä»¥åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä»£æ›¿ç³»ç»Ÿçº¿ç¨‹é™ä½åˆ‡æ¢æ¶ˆæ¯ï¼Œæ”¯æŒæ›´å¤šå¹¶å‘ã€‚&lt;/p&gt;
&lt;p&gt;æ“ä½œç³»ç»Ÿæœ€å°çš„æ‰§è¡Œå•ä½æ˜¯çº¿ç¨‹ï¼Œè¿›ç¨‹æ˜¯çº¿ç¨‹çš„å®¹å™¨ï¼Œæ“ä½œç³»ç»Ÿæ˜¯è¿›ç¨‹çš„å®¹å™¨ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å¹¶å‘ä¸å¹¶è¡Œ&#34;&gt;å¹¶å‘ä¸å¹¶è¡Œ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;å¹¶å‘ï¼šå¤šä¸ªä»»åŠ¡è¢«å¤„ç†ï¼Œä½†åŒä¸€æ—¶åˆ»ï¼Œåªæœ‰ä¸€ä¸ªä»»åŠ¡åœ¨æ‰§è¡Œã€‚å•æ ¸å¤„ç†å™¨ä¹Ÿå¯ä»¥åšåˆ°å¹¶å‘ï¼Œæ¯”å¦‚CPUæ—¶é—´åˆ†ç‰‡è½®è½¬æ‰§è¡Œã€‚&lt;/li&gt;
&lt;li&gt;å¹¶è¡Œï¼šå¤šä¸ªä»»åŠ¡åœ¨åŒä¸€æ—¶åˆ»åŒæ—¶æ‰§è¡Œï¼Œéœ€è¦å¤šæ ¸å¤„ç†å™¨æ‰èƒ½å®Œæˆã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;ä¸¤ä¸ªçº¿ç¨‹åˆ†åˆ«å¯¹å…¨å±€å˜é‡ i++ 100 æ¬¡ï¼Œå¯èƒ½å‡ºç°ä»€ä¹ˆç»“æœï¼Ÿ&lt;/strong&gt;-&lt;/p&gt;
&lt;h2 id=&#34;è°ƒåº¦æ¨¡å‹&#34;&gt;è°ƒåº¦æ¨¡å‹&lt;/h2&gt;
&lt;p&gt;CPUåŒä¸€æ—¶åˆ»åªèƒ½è¿è¡Œä¸€ä¸ªè¿›ç¨‹ï¼Œå½“ä¸€ä¸ªè¿›ç¨‹ä¸èƒ½è·å–æŸç§èµ„æºå¯¼è‡´å®ƒä¸èƒ½ç»§ç»­è¿è¡Œæ—¶ï¼Œå°±åº”è¯¥è®©å‡ºCPUï¼Œå› æ­¤é¢å¯¹å¤šè¿›ç¨‹å°±éœ€è¦ä¸€ä¸ªåˆç†çš„è°ƒåº¦ã€‚&lt;/p&gt;
&lt;p&gt;è¿›ç¨‹çš„ç­‰å¾…å’Œå”¤é†’å¯ä»¥é€šè¿‡ä¿¡å·é‡å®ç°ã€‚&lt;/p&gt;
&lt;p&gt;æ¯ä¸€ä¸ªCPUéƒ½æœ‰ä¸€ä¸ªç©ºè½¬è¿›ç¨‹ï¼Œä½œä¸ºè¿›ç¨‹è°ƒåº¦å™¨æœ€åçš„é€‰æ‹©ã€‚ç©ºè½¬è¿›ç¨‹ä¼šè°ƒç”¨è¿›ç¨‹è°ƒåº¦å‡½æ•°ï¼Œåœ¨ç³»ç»Ÿæ²¡æœ‰å…¶ä»–è¿›ç¨‹å¯ä»¥è¿è¡Œæ—¶åˆä¼šè°ƒç”¨ç©ºè½¬è¿›ç¨‹ï¼Œå½¢æˆé—­ç¯ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç”¨æˆ·ç©ºé—´çº¿ç¨‹å’Œå†…æ ¸ç©ºé—´çº¿ç¨‹ä¹‹é—´çš„æ˜ å°„å…³ç³»&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;N:1æ¨¡å‹ï¼šå¤šä¸ªç”¨æˆ·ç©ºé—´çº¿ç¨‹åœ¨1ä¸ªå†…æ ¸ç©ºé—´çº¿ç¨‹ä¸Šè¿è¡Œã€‚ä¼˜åŠ¿æ˜¯ä¸Šä¸‹æ–‡åˆ‡æ¢éå¸¸å¿«ï¼Œå› ä¸ºè¿™äº›çº¿ç¨‹éƒ½åœ¨å†…æ ¸æ€è¿è¡Œï¼Œä½†æ˜¯æ— æ³•åˆ©ç”¨å¤šæ ¸ç³»ç»Ÿçš„ä¼˜ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;1:1æ¨¡å‹ï¼š1ä¸ªå†…æ ¸ç©ºé—´çº¿ç¨‹è¿è¡Œä¸€ä¸ªç”¨æˆ·ç©ºé—´çº¿ç¨‹ã€‚è¿™ç§å……åˆ†åˆ©ç”¨äº†å¤šæ ¸ç³»ç»Ÿçš„ä¼˜åŠ¿ä½†æ˜¯ä¸Šä¸‹æ–‡åˆ‡æ¢éå¸¸æ…¢ï¼Œå› ä¸ºæ¯ä¸€æ¬¡è°ƒåº¦éƒ½ä¼šåœ¨ç”¨æˆ·æ€å’Œå†…æ ¸æ€ä¹‹é—´åˆ‡æ¢ã€‚POSIXçº¿ç¨‹æ¨¡å‹(pthread)å°±æ˜¯è¿™ä¹ˆåšçš„ã€‚&lt;/p&gt;
&lt;p&gt;M:Næ¨¡å‹ï¼šå†…æ ¸ç©ºé—´å¼€å¯å¤šä¸ªå†…æ ¸çº¿ç¨‹ï¼Œä¸€ä¸ªå†…æ ¸ç©ºé—´çº¿ç¨‹å¯¹åº”å¤šä¸ªç”¨æˆ·ç©ºé—´çº¿ç¨‹ã€‚æ•ˆç‡éå¸¸é«˜ï¼Œä½†æ˜¯ç®¡ç†å¤æ‚ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;è°ƒåº¦çš„æ—¶æœºå’Œæ–¹å¼&#34;&gt;è°ƒåº¦çš„æ—¶æœºå’Œæ–¹å¼&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;æ—¶æœº&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è¿›ç¨‹ä»ä¸€ä¸ªè¿è¡ŒçŠ¶æ€åˆ°å¦ä¸€ä¸ªçŠ¶æ€å˜åŒ–ï¼Œä¼šè§¦å‘ä¸€æ¬¡è°ƒåº¦ï¼›&lt;/li&gt;
&lt;li&gt;ç¡¬ä»¶æ—¶é’Ÿæä¾›æŸä¸ªé¢‘ç‡çš„å‘¨æœŸæ€§ä¸­æ–­ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;æ–¹å¼&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;éæŠ¢å å¼ï¼šç³»ç»Ÿä¸€æ—¦å¼€å§‹æ‰§è¡ŒæŸä¸€è¿›ç¨‹ï¼Œå°±ä¼šè®©è¯¥çº¿ç¨‹å°±ä¼šä¸€ç›´æ‰§è¡Œä¸‹å»ï¼Œç›´è‡³é˜»å¡ã€å®Œæˆã€é€€å‡ºï¼Œæˆ–è€…å‘ç”Ÿäº†å…¶ä»–äº‹ä»¶å¯¼è‡´ç³»ç»Ÿæ”¾å¼ƒå¯¹è¯¥è¿›ç¨‹çš„æ‰§è¡Œåï¼Œæ‰ä¼šå»æ‰§è¡Œå¦å¤–ä¸€ä¸ªè¿›ç¨‹ï¼›&lt;/li&gt;
&lt;li&gt;æŠ¢å å¼ï¼šç³»ç»Ÿæ‰§è¡ŒæŸä¸€è¿›ç¨‹ï¼Œåœ¨å…¶æ‰§è¡ŒæœŸé—´ï¼Œç³»ç»Ÿå¯ä»¥ç«‹å³åœæ­¢å½“å‰è¿›ç¨‹ï¼Œè½¬è€Œæ‰§è¡Œå¦å¤–ä¸€ä¸ªè¿›ç¨‹ï¼Œå¾…å¤„ç†å®Œåï¼Œé‡æ–°å›æ¥ç»§ç»­æ‰§è¡Œä¹‹å‰åœæ­¢çš„è¿›ç¨‹ã€‚è¿™ç§æŠ¢å å¼è°ƒåº¦å¤„ç†ï¼Œéœ€è¦å†æ—¶é—´é—´éš”æœ«ç«¯å‘ç”Ÿæ—¶é’Ÿä¸­æ–­ï¼Œä»¥ä¾¿æŠŠCPUæ§åˆ¶è¿”å›ç»™è°ƒåº¦ç¨‹åºè¿›è¡Œè°ƒåº¦ï¼Œå³æ—¶é—´ç‰‡æœºåˆ¶ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;è°ƒåº¦åŸåˆ™&#34;&gt;è°ƒåº¦åŸåˆ™&lt;/h2&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;CPU åˆ©ç”¨ç‡&lt;/strong&gt;ï¼šè°ƒåº¦ç¨‹åºåº”ç¡®ä¿ CPU æ˜¯å§‹ç»ˆåŒ†å¿™çš„çŠ¶æ€ï¼Œè¿™å¯æé«˜ CPU çš„åˆ©ç”¨ç‡ï¼›æ¯”å¦‚å‘ç”ŸIOäº‹ä»¶é€ æˆçš„é˜»å¡ï¼Œè°ƒåº¦ç¨‹åºå°±è¦ä»å°±ç»ªé˜Ÿåˆ—é€‰æ‹©å¦ä¸€ä¸ªè¿›ç¨‹æ¥è¿è¡Œï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç³»ç»Ÿååé‡&lt;/strong&gt;ï¼šååé‡è¡¨ç¤ºçš„æ˜¯å•ä½æ—¶é—´å†… CPU å®Œæˆè¿›ç¨‹çš„æ•°é‡ï¼Œé•¿ä½œä¸šçš„è¿›ç¨‹ä¼šå ç”¨è¾ƒé•¿çš„ CPU èµ„æºï¼Œå› æ­¤ä¼šé™ä½ååé‡ï¼Œç›¸åï¼ŒçŸ­ä½œä¸šçš„è¿›ç¨‹ä¼šæå‡ç³»ç»Ÿååé‡ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å‘¨è½¬æ—¶é—´&lt;/strong&gt;ï¼šå‘¨è½¬æ—¶é—´æ˜¯è¿›ç¨‹è¿è¡Œ+é˜»å¡æ—¶é—´+ç­‰å¾…æ—¶é—´çš„æ€»å’Œï¼Œä¸€ä¸ªè¿›ç¨‹çš„å‘¨è½¬æ—¶é—´è¶Šå°è¶Šå¥½ï¼›&lt;/p&gt;
&lt;p&gt;å®Œæˆæ—¶é—´ - åˆ°è¾¾æ—¶é—´ï¼Œå³æœ‰Aã€Bã€Cä¸‰ä¸ªä»»åŠ¡åŒæ—¶åˆ°è¾¾ï¼Œä¸”ä»–ä»¬çš„è¿è¡Œæ—¶é—´éƒ½æ˜¯10sï¼Œåœ¨FIFOè°ƒåº¦ç®—æ³•ä¸‹ï¼Œå‘¨è½¬æ—¶é—´å°±æ˜¯10sï¼Œ20sï¼Œ30s&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç­‰å¾…æ—¶é—´&lt;/strong&gt;ï¼šè¿™ä¸ªç­‰å¾…æ—¶é—´ä¸æ˜¯é˜»å¡çŠ¶æ€çš„æ—¶é—´ï¼Œè€Œæ˜¯è¿›ç¨‹å¤„äºå°±ç»ªé˜Ÿåˆ—çš„æ—¶é—´ï¼Œç­‰å¾…çš„æ—¶é—´è¶Šé•¿ï¼Œç”¨æˆ·è¶Šä¸æ»¡æ„ï¼›ç†è®ºä¸Šå°±ç»ªé˜Ÿåˆ—é‡Œçš„è¿›ç¨‹æ˜¯å¯æ‰§è¡Œï¼Œæ‰€ä»¥å¯ä»¥ä¼˜å…ˆè€ƒè™‘ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å“åº”æ—¶é—´&lt;/strong&gt;ï¼šç”¨æˆ·æäº¤è¯·æ±‚åˆ°ç³»ç»Ÿç¬¬ä¸€æ¬¡äº§ç”Ÿå“åº”æ‰€èŠ±è´¹çš„æ—¶é—´ï¼Œåœ¨äº¤äº’å¼ç³»ç»Ÿä¸­ï¼Œå“åº”æ—¶é—´æ˜¯è¡¡é‡è°ƒåº¦ç®—æ³•å¥½åçš„ä¸»è¦æ ‡å‡†ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;è°ƒåº¦ç®—æ³•&#34;&gt;è°ƒåº¦ç®—æ³•&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;FCFS å…ˆæ¥å…ˆæœåŠ¡è°ƒåº¦ç®—æ³•ï¼Œå…¶å®å°±æ˜¯FIFO&lt;/p&gt;
&lt;p&gt;æ¯æ¬¡ä»å°±ç»ªé˜Ÿåˆ—é€‰æ‹©æœ€å…ˆè¿›å…¥é˜Ÿåˆ—çš„è¿›ç¨‹ï¼Œç„¶åä¸€ç›´è¿è¡Œï¼Œç›´åˆ°è¿›ç¨‹é€€å‡ºæˆ–è¢«é˜»å¡ï¼Œæ‰ä¼šç»§ç»­ä»é˜Ÿåˆ—ä¸­é€‰æ‹©ç¬¬ä¸€ä¸ªè¿›ç¨‹æ¥ç€è¿è¡Œï¼Œä½†ä¼š&lt;strong&gt;å¯¼è‡´æ’åœ¨åé¢çš„çŸ­ä»»åŠ¡ç­‰å¾…æ—¶é—´è¿‡é•¿&lt;/strong&gt;ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;SJF æœ€çŸ­ä½œä¸šä¼˜å…ˆè°ƒåº¦ç®—æ³•&lt;/p&gt;
&lt;p&gt;ä¼˜å…ˆé€‰æ‹©è¿è¡Œæ—¶é—´æœ€çŸ­çš„è¿›ç¨‹æ¥è¿è¡Œï¼Œå¯èƒ½ä¼š&lt;strong&gt;å¯¼è‡´è¿è¡Œæ—¶é—´é•¿çš„ä»»åŠ¡é¥¿æ­»&lt;/strong&gt;ï¼Œç†è®ºä¸Šåªæœ‰å½“ä½œä¸šéƒ½åŒæ—¶åˆ°è¾¾æ—¶ï¼ŒSJFæ˜¯ä¸€ä¸ªæœ€ä¼˜çš„è°ƒåº¦ç®—æ³•ï¼Œä½†æ˜¯äº‹å®ä¸Šä½œä¸šä¸ä¼šåŒæ—¶åˆ°è¾¾ï¼Œå¦‚æœè¿è¡Œæ—¶é—´é•¿çš„ä½œä¸šå…ˆåˆ°ï¼Œå°±é€€åŒ–æˆäº†FIFOï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;STCF æœ€çŸ­å®Œæˆæ—¶é—´ä¼˜å…ˆ&lt;/p&gt;
&lt;p&gt;åŸºäºæ—¶é’Ÿä¸­æ–­å’Œä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œåœ¨SJFçš„åŸºç¡€ä¸Šå®ç°æŠ¢å ï¼Œé¿å…é€€åŒ–æˆFIFOçš„é—®é¢˜ï¼›è™½ç„¶STCFçš„å‘¨è½¬æ—¶é—´æœ€ä¼˜ï¼Œä½†æ˜¯å“åº”æ—¶é—´ä¸æ˜¯ï¼Œé‚£å¯¹äºäº¤äº’ç±»å‹çš„ç¨‹åºå°±ä¸å¤Ÿå‹å¥½ï¼›&lt;/p&gt;
&lt;p&gt;SJFå’ŒSTCFç®—æ³•çš„é—®é¢˜ï¼Œéƒ½æ˜¯å…ˆéœ€è¦çŸ¥é“ä½œä¸šçš„è¿è¡Œæ—¶é—´ï¼Œä½†å®é™…ä¸Šè¿™ä¸ªå¾ˆéš¾è·å¾—ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;RR æ—¶é—´ç‰‡è½®è¯¢è°ƒåº¦ç®—æ³•&lt;/p&gt;
&lt;p&gt;æ¯ä¸ªè¿›ç¨‹è¢«åˆ†é…ä¸€ä¸ªæ—¶é—´æ®µï¼Œç§°ä¸ºæ—¶é—´ç‰‡ï¼Œå…è®¸è¯¥è¿›ç¨‹åœ¨è¯¥æ—¶é—´æ®µä¸­è¿è¡Œï¼Œæ—¶é—´åˆ°äº†å°±åˆ‡æ¢è¿›ç¨‹è¿è¡Œï¼Œè¯¥ç®—æ³•å¯¹æ—¶é—´ç‰‡çš„è®¾å®šæ¯”è¾ƒä¸¥æ ¼ï¼Œå¦‚æœæ—¶é—´ç‰‡è¿‡çŸ­ï¼Œä¼šå¯¼è‡´é¢‘ç¹çš„è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œè¿‡é•¿åˆä¼šå¯¼è‡´çŸ­ä»»åŠ¡ç­‰å¾…æ—¶é—´è¿‡é•¿ï¼›é€šå¸¸æ—¶é—´ç‰‡è®¾å®šä¸º20ms~50msï¼›RRç®—æ³•ä¼˜åŒ–äº†å“åº”æ—¶é—´ï¼Œä½†æ˜¯å‘¨è½¬æ—¶é—´æœ€å·®ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;HPF æœ€é«˜ä¼˜å…ˆçº§è°ƒåº¦ç®—æ³•&lt;/p&gt;
&lt;p&gt;å¯¹è¿›ç¨‹è®¾å®šä¼˜å…ˆçº§ï¼Œæ¯”å¦‚è®¾ç½®é™æ€ä¼˜å…ˆçº§ï¼ˆè¿›ç¨‹è¿è¡Œæ—¶ç¡®å®šï¼‰ï¼ŒåŠ¨æ€ä¼˜å…ˆçº§ï¼ˆéšæ—¶é—´æ›´æ–°ä¼˜å…ˆçº§ï¼‰ï¼Œæ ¹æ®ä¼˜å…ˆçº§è¿›è¡Œè°ƒåº¦ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä½ä¼˜å…ˆçº§çš„ä»»åŠ¡æ°¸è¿œä¸ä¼šè¢«è¿è¡Œåˆ°ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;MLFQ å¤šçº§åé¦ˆé˜Ÿåˆ—è°ƒåº¦ç®—æ³•&lt;/p&gt;
&lt;p&gt;ç»“åˆæ—¶é—´ç‰‡è½®è¯¢ + æœ€é«˜ä¼˜å…ˆçº§è°ƒåº¦çš„ç®—æ³•ï¼Œå…¼é¡¾é•¿åº¦ä»»åŠ¡å’Œå“åº”æ—¶é—´ï¼Œæ¯”è¾ƒå‡è¡¡ï¼Œç®—æ˜¯å¹³è¡¡äº†ä¸Šè¿°ç®—æ³•çš„ä¼˜ç¼ºç‚¹ï¼Œä¸éœ€è¦æå‰çŸ¥é“ä½œä¸šçš„è¿è¡Œæ—¶é—´ï¼Œéš¾ç‚¹åœ¨äºè®¾ç½®é˜Ÿåˆ—çš„æ•°é‡ã€æ¯å±‚é˜Ÿåˆ—çš„æ—¶é—´ç‰‡é…é¢ï¼Œå¤šä¹…æå‡ä¸€æ¬¡è¿›ç¨‹çš„ä¼˜å…ˆçº§ã€‚&lt;/p&gt;
&lt;p&gt;è®¾ç½®å¤šä¸ªé˜Ÿåˆ—ï¼Œæ¯ä¸ªé˜Ÿåˆ—æœ‰ä¸åŒçš„ä¼˜å…ˆçº§ï¼Œæ¯ä¸ªä¼˜å…ˆçº§æœ‰ä¸åŒçš„è¿è¡Œæ—¶é—´ï¼Œä»é«˜åˆ°ä½æ’åºï¼Œä¼˜å…ˆçº§è¶Šé«˜ï¼Œæ—¶é—´ç‰‡è¶Šå°‘ï¼Œæ¯ä¸ªä½œä¸šåªä¼šå­˜åœ¨äºä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼Œä¸€ä¸ªé˜Ÿåˆ—ä¸­çš„ä½œä¸šä½¿ç”¨RRè¿›è¡Œè°ƒåº¦ï¼›&lt;/p&gt;
&lt;p&gt;ä½œä¸šè¿›å…¥ç³»ç»Ÿæ—¶ï¼Œæ”¾åœ¨æœ€é«˜ä¼˜å…ˆçº§é˜Ÿåˆ—ï¼Œå¦‚æœç¬¬ä¸€çº§é˜Ÿåˆ—è§„å®šçš„æ—¶é—´ç‰‡æ²¡è¿è¡Œå®Œæˆï¼Œå°±è½¬å…¥ç¬¬äºŒçº§é˜Ÿåˆ—ï¼Œç›´è‡³å®Œæˆï¼›é«˜ä¼˜å…ˆçº§é˜Ÿåˆ—ä¸ºç©ºï¼Œæ‰å»è°ƒåº¦ä½ä¼˜å…ˆçº§é˜Ÿåˆ—ä¸­çš„è¿›ç¨‹ï¼›&lt;/p&gt;
&lt;p&gt;å¦‚æœä½œä¸šåœ¨å…¶æ—¶é—´ç‰‡å†…ä¸»åŠ¨é‡Šæ”¾CPUï¼Œåˆ™ä¼˜å…ˆçº§ä¸å˜ï¼Œä½†æ˜¯å½“è¿è¡Œçš„æ—¶é—´ç´¯è®¡è¾¾åˆ°è§„å®šçš„é…é¢æ—¶(æ— è®ºä¸­é—´é‡Šæ”¾äº†å¤šå°‘æ¬¡)ï¼Œè¿˜æ˜¯è¦é™çº§ï¼Œä¸»è¦æ˜¯è§£å†³ä¸€äº›äº¤äº’ç¨‹åºæˆ–è€…IOæ“ä½œé€ æˆçš„ä¼˜å…ˆçº§å„æ–­é—®é¢˜ï¼›&lt;/p&gt;
&lt;p&gt;ç»è¿‡ä¸€æ®µæ—¶é—´åï¼Œç³»ç»Ÿå°†æ‰€æœ‰å·¥ä½œé‡æ–°åŠ å…¥æœ€é«˜çº§ä¼˜å…ˆçº§é˜Ÿåˆ—ï¼Œè§£å†³é•¿æ—¶é—´è¿è¡Œçš„ä½œä¸šä¸€ç›´å¤„äºæœ€ä½çº§å¯¼è‡´é¥¿æ­»çš„é—®é¢˜ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ¯”ä¾‹ä»½é¢è°ƒåº¦&lt;/p&gt;
&lt;p&gt;å½©ç¥¨è°ƒåº¦ï¼šä¸ºæ¯ä¸ªè¿è¡Œçš„ä½œä¸šè®¾ç½®ä¸åŒçš„æƒé‡å€¼ï¼Œé€šè¿‡ç”Ÿæˆéšæœºæ•°è½åœ¨å“ªä¸ªèŒƒå›´æ¥å†³å®šè¿è¡Œå“ªä¸ªä½œä¸šï¼Œå¾—ç›Šäºéšæœºæ•°ï¼Œç†è®ºä¸Šåœ¨é•¿æ—¶é—´è¿è¡Œåç»ˆäºè¶‹å‘äºæˆ‘ä»¬ä¸€å¼€å§‹è®¾ç½®çš„æ¯”ä¾‹ï¼Œä¸”ä¸ç”¨éœ€è¦é¢å¤–çš„å˜é‡æ¥å­˜åœ¨è¿›åº¦ï¼Œæ¯”è¾ƒç®€ä¾¿ï¼Œç¼ºç‚¹æ˜¯å¦‚æœåœ¨çŸ­ä½œä¸šæˆ–è€…è¿è¡Œæ¬¡æ•°è¾ƒå°‘çš„åœºæ™¯ï¼Œéšæœºæ•°è°ƒåº¦å°±ä¸æ˜¯å¾ˆå…¬å¹³ï¼›&lt;/p&gt;
&lt;p&gt;æ­¥é•¿è°ƒåº¦ï¼šä¸ºæ¯ä¸ªä½œä¸šè®¾ç½®è¿è¡Œæ­¥é•¿ï¼Œæ¯æ¬¡è¿è¡Œå¯¹æ­¥é•¿è¿›è¡Œç´¯åŠ ï¼Œæ¯æ¬¡è¿è¡Œæ­¥é•¿ç´¯åŠ å€¼æœ€å°çš„é‚£ä¸ªï¼Œé€šè¿‡è¿™ç§æ–¹å¼è§£å†³å½©ç¥¨è°ƒåº¦çš„å…¬å¹³æ€§é—®é¢˜ï¼Œç¼ºç‚¹æ˜¯éœ€è¦é¢å¤–çš„å˜é‡æ¥è®°å½•æ¯ä¸ªä½œä¸šçš„æ­¥é•¿ï¼›&lt;/p&gt;
&lt;p&gt;è¿™ä¸¤ç§è°ƒåº¦éƒ½é¢ä¸´çš„é—®é¢˜æ˜¯å¦‚ä½•è®¾ç½®ä¸€ä¸ªåˆç†çš„æƒé‡å€¼æˆ–è€…æ­¥é•¿å€¼ï¼Œä¸”ä¹Ÿæ— æ³•å¾ˆå¥½çš„åº”ä»˜IOé—®é¢˜&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åœ¨å¤šCPUåœºæ™¯ä¸‹ï¼Œéœ€è¦è€ƒè™‘å¤šCPUçš„cacheå’Œå†…å­˜é—´çš„ä¸€è‡´æ€§ã€äº²å’Œåº¦å’ŒåŒæ­¥é—®é¢˜ï¼Œåˆåˆ†ä¸ºä¸¤ç§ä¸åŒçš„è°ƒåº¦ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;SQMSå•é˜Ÿåˆ—è°ƒåº¦&lt;/p&gt;
&lt;p&gt;å¤šä¸ªCPUå…±äº«ä¸€ä¸ªè°ƒåº¦é˜Ÿåˆ—ï¼Œä¼˜ç‚¹æ˜¯ç®€å•ï¼ŒCPUè´Ÿè½½å‡è¡¡ï¼Œä¸éœ€è¦å¤ªå¤šä¿®æ”¹ï¼Œå°±èƒ½å°†åŸæœ‰çš„ç­–ç•¥ç”¨åœ¨å¤šCPUä¸Šï¼Œç¼ºç‚¹æ˜¯ç¼ºä¹å¯æ‰©å±•æ€§ï¼Œä¸”å¤šCPUåœ¨è®¿é—®é˜Ÿåˆ—æ—¶ï¼Œéœ€è¦åŠ é”ä¿è¯å¹¶å‘å®‰å…¨ï¼Œæ€§èƒ½è¾ƒå·®ï¼Œå¦å¤–ï¼Œå› ä¸ºä½œä¸šæœ‰å¯èƒ½è¢«å¤šæ¬¡è°ƒåº¦åˆ°ä¸åŒçš„CPUä¸Šï¼ŒCPUç¼“å­˜äº²å’Œé—®é¢˜æ²¡æœ‰å¾—åˆ°å¾ˆå¥½çš„ä¿éšœã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;MQMSå¤šé˜Ÿåˆ—è°ƒåº¦ï¼š&lt;/p&gt;
&lt;p&gt;ä¸ºæ¯ä¸ªCPUåˆ†é…ä¸€ä¸ªè°ƒåº¦é˜Ÿåˆ—ï¼Œæ¯ä¸ªCPUè°ƒåº¦ç›¸äº’ç‹¬ç«‹ï¼Œæ¯ä¸ªè°ƒåº¦å¯ä»¥é€‰æ‹©ä¸åŒçš„è°ƒåº¦è§„åˆ™ï¼Œé¿å…å•é˜Ÿåˆ—çš„æ–¹å¼å¯¼è‡´çš„æ•°æ®å…±äº«å’ŒåŒæ­¥é—®é¢˜ï¼›ä½†éœ€è¦è§£å†³è´Ÿè½½ä¸å‡è¡¡çš„é—®é¢˜ï¼Œä¸€èˆ¬æ˜¯ä½¿ç”¨å·¥ä½œçªƒå–ç®—æ³•è§£å†³ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;äº’æ–¥å’ŒåŒæ­¥&#34;&gt;äº’æ–¥å’ŒåŒæ­¥&lt;/h2&gt;
&lt;p&gt;ä¸€äº›å¸¸è§çš„æ“ä½œéœ€è¦å¤šä¸ªæŒ‡ä»¤æ¥å®Œæˆï¼Œå› ä¸ºCPUå­˜åœ¨ä¸­æ–­çš„ç¼˜æ•…ï¼Œå¯èƒ½ä¼šå¯¼è‡´å¤šä¸ªæŒ‡ä»¤æ— æ³•åŸå­æ‰§è¡Œï¼Œäº§ç”Ÿå¹¶å‘å®‰å…¨é—®é¢˜ï¼›&lt;/p&gt;
&lt;p&gt;è¿›ç¨‹çŠ¶æ€çš„è½¬æ¢ï¼Œå…±äº«å˜é‡çš„è®¿é—®ï¼Œéƒ½éœ€è¦PVæ“ä½œ + ä¿¡å·é‡æ¥æ§åˆ¶ï¼ŒPè¡¨ç¤ºè¯·æ±‚èµ„æºï¼ŒVè¡¨ç¤ºé‡Šæ”¾èµ„æºï¼Œä¸¤è€…å¿…é¡»æˆå¯¹å‡ºç°ï¼Œä¸€èˆ¬åˆ©ç”¨ä¿¡å·é‡ + PVæ“ä½œå®ç°è¿›ç¨‹çš„äº’æ–¥å’ŒåŒæ­¥ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;flag + caså®ç°é”ï¼Œcaså¯¹åº”CPUæä¾›çš„åŸå­æ“ä½œæŒ‡ä»¤ Test-and-Setï¼ˆæµ‹è¯•å’Œç½®ä½ï¼‰&lt;/li&gt;
&lt;li&gt;ä¿¡å·é‡ + åŸå­çš„PVå‡½æ•°ï¼Œä¿¡å·é‡ä¸º1å°±æ˜¯ä¸€ä¸ªäº’æ–¥é”äº†&lt;/li&gt;
&lt;li&gt;ç”Ÿäº§è€…-æ¶ˆè´¹è€…ï¼Œç”±ä¸‰ä¸ªä¿¡å·é‡å®ç°ï¼ˆäº’æ–¥ä¿¡å·é‡ã€æ¶ˆè´¹è€…èµ„æºä¿¡å·é‡ï¼Œç”Ÿäº§è€…ä¿¡å·é‡ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;é”çš„å®ç°&#34;&gt;é”çš„å®ç°&lt;/h3&gt;
&lt;p&gt;å®ç°é”éœ€è¦è€ƒè™‘å‡ ä¸ªç‚¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é”çš„åŸºæœ¬åŠŸèƒ½æ˜¯äº’æ–¥ï¼Œèƒ½é˜»æ­¢å¤šä¸ªçº¿ç¨‹è¿›å…¥ä¸´ç•ŒåŒºï¼Œä½†ä¸èƒ½ç®€å•çš„æš‚åœä¸­æ–­ï¼ˆæš‚åœä¸­æ–­åªå¯¹å•CPUæœºå™¨æœ‰ç”¨ï¼Œä½†æ˜¯æš‚åœä¸­æ–­ä¼šå½±å“å…¶ä»–åº”ç”¨ç¨‹åºçš„ä¸­æ–­ä¿¡å·ï¼Œä¹Ÿä¼šå¯¼è‡´å½“å‰çº¿ç¨‹ä¸€ç›´å æœ‰CPUï¼Œå¯¼è‡´æ— æ³•åˆ‡æ¢ï¼‰&lt;/li&gt;
&lt;li&gt;å…¬å¹³æ€§ï¼Œæ¯ä¸ªç«äº‰çº¿ç¨‹é‡Šæ”¾æœ‰å…¬å¹³çš„æœºä¼šæŠ¢åˆ°é”ï¼Œç«äº‰çš„é”æ˜¯å¦ä¼šé¥¿æ­»&lt;/li&gt;
&lt;li&gt;æ€§èƒ½ï¼Œå½“åªæœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œå³æ²¡ç«äº‰çš„æ—¶å€™ï¼ŒæŠ¢é”å’Œè§£é”çš„å¼€é”€ï¼›ä¸€ä¸ªCPUä¸Šæœ‰å¤šä¸ªçº¿ç¨‹ç«äº‰çš„æ€§èƒ½å¼€é”€ï¼›å¤šä¸ªCPUä¸Šæœ‰å¤šä¸ªçº¿ç¨‹ç«äº‰çš„æ€§èƒ½å¼€é”€ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åŸºæœ¬åŸç†ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ç¡¬ä»¶æä¾›åŸå­æŒ‡ä»¤æ”¯æŒï¼Œæœ‰ä¸‰ç§ï¼Œæµ‹è¯•å¹¶è®¾ç½®(test-and-set)ã€æ¯”è¾ƒå¹¶äº¤æ¢(compare-and-swap)ã€è·å–å¹¶å¢åŠ (fetch-and-add)ï¼›&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨è¿™ä¸‰ç§æŒ‡ä»¤å…¶ä¸­ä¹‹ä¸€ï¼Œå³å¯å®ç°ä¸€ä¸ªç®€å•çš„é”ï¼Œæ²¡æœ‰è·å–é”çš„çº¿ç¨‹ä¼šè¿›å…¥è‡ªæ—‹ï¼Œè¿™ç§å®ç°æ–¹å¼åªæ˜¯å®ç°äº†äº’æ–¥ï¼Œä½†ä¸ä¿è¯å…¬å¹³ï¼Œè‡ªæ—‹çš„çº¿ç¨‹åœ¨ç«æ€æ¡ä»¶ä¸‹å¯èƒ½ä¼šæ°¸è¿œè‡ªæ—‹ï¼Œå¯¼è‡´é¥¿æ­»ï¼Œå…¶æ¬¡ï¼Œåœ¨å•CPUåœºæ™¯ä¸‹ï¼Œæ€§èƒ½è¾ƒå·®ï¼Œå½“æœ‰ä¸€ä¸ªçº¿ç¨‹è·å–åˆ°é”åï¼Œå…¶ä»–çº¿ç¨‹è¿è¡Œæ—¶éƒ½è‡ªæ—‹ä¸€ä¸ªæ—¶é—´ç‰‡ï¼Œæµªè´¹CPUå‘¨æœŸï¼Œä½†åœ¨å¤šCPUåœºæ™¯ä¸‹ï¼Œæ€§èƒ½å°±ä¸é”™ï¼Œå› ä¸ºæœ‰å…¶ä»–CPUåˆ†æ‘Šè¿è¡Œå‹åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;å¦å¤–ï¼Œå¦‚æœä½¿ç”¨ è·å–å¹¶å¢åŠ  æŒ‡ä»¤ï¼Œå°±å¯ä»¥å®ç°å…¬å¹³é”ï¼ŒåŸç†æ˜¯æ¯ä¸ªçº¿ç¨‹lockæ—¶ï¼Œä¼šfetch-and-addå¾—åˆ°ä¸€ä¸ªç¼–å·ï¼Œè‡ªæ—‹æ—¶æ¯”è¾ƒè¯¥ç¼–å·åˆ¤æ–­æ˜¯å¦å¯ä»¥è·å–é”ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;é™¤äº†è‡ªæ—‹å¯ä»¥ç­‰å¾…ï¼Œçº¿ç¨‹ä¹Ÿå¯ä»¥ä¸»åŠ¨è®©å‡ºCPUï¼Œæ¯”å¦‚è°ƒç”¨osçš„yield()å‡½æ•°ï¼Œæœ€èµ·ç ä¸ä¼šæµªè´¹CPUæ—¶é—´ç‰‡ï¼Œä½†æ˜¯ä»ç„¶ä¼šå‘ç”Ÿä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œæ€§èƒ½æœ‰æå‡ï¼Œä½†ä¸å¤šï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä½¿ç”¨é˜Ÿåˆ— + çº¿ç¨‹æŒ‚èµ·ä¼‘çœ ï¼Œå®ç°å…¬å¹³ï¼Œé¿å…é¥¿æ­»ï¼ˆå¦‚æœåŒæ—¶å­˜åœ¨æœªå…¥é˜Ÿçš„çº¿ç¨‹å’Œå­˜åœ¨é˜Ÿåˆ—é‡Œçš„çº¿ç¨‹æ—¶ï¼Œéœ€è¦ä¿è¯é˜Ÿé¦–çº¿ç¨‹è¢«å”¤é†’çš„ä¼˜å…ˆæƒé«˜ä¸€äº›ï¼Œé¿å…é˜Ÿåˆ—é‡Œçš„çº¿ç¨‹è¢«é¥¿æ­»ï¼‰ï¼ŒåŒæ—¶ä¹Ÿèƒ½å‡å°‘è‡ªæ—‹å¸¦æ¥çš„æ¶ˆè€—ï¼Œæå‡æ€§èƒ½ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;äºŒé˜¶æ®µé”ï¼Œå®é™…ä¸Šå°±æ˜¯ä¸Šé¢ä¸¤ç§æ–¹æ¡ˆçš„ç»„åˆï¼Œè‡ªæ—‹ä¸æ˜¯æ— é™è‡ªæ—‹ï¼Œè€Œæ˜¯è‡ªæ—‹ä¸€å®šçš„æ¬¡æ•°ï¼Œå¦‚æœè¿˜è·å–ä¸åˆ°é”ï¼Œå°±å°†çº¿ç¨‹æŒ‚èµ·ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;å…¶ä»–åŒæ­¥åŸè¯­&#34;&gt;å…¶ä»–åŒæ­¥åŸè¯­&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;æ¡ä»¶å˜é‡ï¼šAçº¿ç¨‹è¦ç­‰åˆ°Bçº¿ç¨‹æ‰§è¡Œå®Œæ‰èƒ½ç»§ç»­æ‰§è¡Œï¼Œå¯ä»¥ä½¿ç”¨å…¨å±€å˜é‡ + Açº¿ç¨‹è‡ªæ—‹çš„æ–¹å¼å®ç°ï¼Œä½†æ˜¯è¿™ç§æ–¹æ¡ˆä¼šæµªè´¹CPUæ—¶é—´ï¼Œæœ€å¥½çš„æ–¹å¼æ˜¯è®©çº¿ç¨‹Aä¼‘çœ ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨æ¡ä»¶å˜é‡çš„wait()å’Œsignal()ï¼Œæ¡ä»¶å˜é‡çš„åŸç†æ˜¯é˜Ÿåˆ— + é”ï¼Œå½“æœ‰æ¡ä»¶ä¸æ»¡è¶³æ—¶ï¼Œè®©çº¿ç¨‹åŠ å…¥é˜Ÿåˆ—ç­‰å¾…ï¼Œç›´åˆ°è¢«å”¤é†’ï¼Œwait()å’Œsignal()çš„è¯­ä¹‰å‡è¦æ±‚åœ¨ä½¿ç”¨æ—¶éœ€è¦æŒæœ‰é”ï¼›&lt;/li&gt;
&lt;li&gt;ç”Ÿäº§è€…/æ¶ˆè´¹è€…ï¼ˆæœ‰ç•Œç¼“å†²åŒºï¼‰ï¼šé€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—è§£å†³å¹¶å‘é—®é¢˜ï¼Œæœ¬è´¨Broker + é” + æ¡ä»¶å˜é‡å®ç°ï¼Œè¦æ³¨æ„ï¼Œé€šè¿‡æ¡ä»¶å˜é‡è¿›è¡Œå”¤é†’å’Œä¼‘çœ ï¼Œåªæ˜¯æš—ç¤ºäº†æ¡ä»¶å‘ç”Ÿå˜åŒ–ï¼Œä¸ä¿è¯è¿è¡Œå‰åçš„è¿è¡ŒçŠ¶æ€æ˜¯ä¸€è‡´çš„ï¼Œæ‰€ä»¥æœ€å¥½éœ€è¦å†æ¬¡æ£€æŸ¥çŠ¶æ€ï¼›å¦å¤–ï¼Œæ¡ä»¶ä¿¡å·éœ€è¦æœ‰æŒ‡å‘æ€§ï¼Œæ¶ˆè´¹è€…åªèƒ½å”¤é†’ç”Ÿäº§è€…ï¼Œç”Ÿäº§è€…åªèƒ½å”¤é†’æ¶ˆè´¹è€…ï¼›&lt;/li&gt;
&lt;li&gt;ä¿¡å·é‡ï¼šä½¿ç”¨ä¸€ä¸ªä¿¡å·é‡æ—¶ï¼Œä¿¡å·é‡çš„å€¼ä¸º1ï¼Œå¯ä»¥æ¨¡æ‹Ÿé”ï¼›å€¼ä¸º0ï¼Œå¯ä»¥æ¨¡æ‹Ÿjoin()ï¼Œä¹Ÿå¯ä»¥+æ¡ä»¶å®ç°æ¡ä»¶å˜é‡ï¼›ä¿¡å·é‡æœ¬èº«å¯ä»¥é€šè¿‡é” + æ¡ä»¶å˜é‡ + å€¼ æ¥å®ç°ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;å¹¶å‘å®‰å…¨é—®é¢˜çš„äº§ç”Ÿ&#34;&gt;å¹¶å‘å®‰å…¨é—®é¢˜çš„äº§ç”Ÿ&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;éæ­»é”ç¼ºé™·ï¼šå…±äº«å˜é‡æ²¡æœ‰åŸå­æ€§æ“ä½œï¼Œå…±äº«å˜é‡çš„è®¿é—®é¡ºåºé—®é¢˜ï¼Œå‡å®¹æ˜“äº§ç”Ÿå¹¶å‘å®‰å…¨é—®é¢˜&lt;/li&gt;
&lt;li&gt;æ­»é”ç¼ºé™·ï¼šä¸»è¦æ˜¯è¦é¿å…å‡‘é½æ­»é”æ¡ä»¶&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;æ­»é”&#34;&gt;æ­»é”&lt;/h3&gt;
&lt;p&gt;åªæœ‰åŒæ—¶æ»¡è¶³ä»¥ä¸‹å››ä¸ªæ¡ä»¶æ‰ä¼šå‘ç”Ÿï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;äº’æ–¥ï¼šå¯¹èµ„æºçš„è®¿é—®éœ€è¦å…ˆæŒæœ‰é”ï¼Œæ¯”å¦‚ä¸€ä¸ªçº¿ç¨‹æŠ¢åˆ°äº†é”&lt;/li&gt;
&lt;li&gt;æŒæœ‰å¹¶ç­‰å¾…ï¼šåœ¨ç­‰å¾…ä¸‹ä¸€ä¸ªèµ„æºçš„æ—¶å€™ï¼Œä¸ä¼šé‡Šæ”¾å·²æŒæœ‰çš„é”ï¼Œæ¯”å¦‚çº¿ç¨‹å·²ç»æŒæœ‰äº†é”ï¼Œä½†åŒæ—¶åœ¨ç­‰å¾…å…¶ä»–èµ„æº&lt;/li&gt;
&lt;li&gt;éæŠ¢å ï¼šå·²ä¸Šé”çš„èµ„æºï¼Œåœ¨è‡ªå·±ä½¿ç”¨å®Œä¹‹å‰ä¸ä¼šè¢«å…¶ä»–çº¿ç¨‹è·å–åˆ°ï¼Œæ¯”å¦‚çº¿ç¨‹è·å–åˆ°é”åï¼Œè¿™ä¸ªé”ä¸èƒ½è¢«å…¶ä»–çº¿ç¨‹æŠ¢å &lt;/li&gt;
&lt;li&gt;å¾ªç¯ç­‰å¾…ï¼šå¤šä¸ªçº¿ç¨‹è·å–èµ„æºçš„é¡ºåºå½¢æˆäº†ç¯å½¢é“¾&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ­»é”é¿å…ï¼šç ´åæ­»é”çš„ä»»ä¸€æ¡ä»¶ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;äº’æ–¥ç ´åï¼šä½¿ç”¨lock-freeï¼Œä¸ä½¿ç”¨é”ï¼Œæ¯”å¦‚casï¼Œæˆ–è€…é€šè¿‡è°ƒåº¦é¿å…æ­»é”ï¼Œæ¯”å¦‚å°†çº¿ç¨‹å›ºå®šè°ƒåº¦åˆ°æŸä¸€ä¸ªCPU&lt;/li&gt;
&lt;li&gt;æŒæœ‰å¹¶ç­‰å¾…ç ´åï¼šé€šè¿‡åŸå­çš„æŠ¢é”æ¥é¿å…&lt;/li&gt;
&lt;li&gt;éæŠ¢å ç ´åï¼šä½¿ç”¨tryLock()å…ˆåˆ¤æ–­&lt;/li&gt;
&lt;li&gt;å¾ªç¯ç­‰å¾…ç ´åï¼šä½¿ç”¨èµ„æºæ—¶æœ‰åºåˆ†é…ï¼Œä¸è®©å®ƒå½¢æˆç¯ä¾èµ–ï¼ˆæœ€å¸¸è§çš„ç ´åæ¡ä»¶ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é“¶è¡Œå®¶ç®—æ³•é¿å…æ­»é”ï¼šé“¶è¡Œå®¶ç®—æ³•ä¸»è¦æ˜¯é¿å…èµ„æºåˆ†é…ä¸å¯¼è‡´æ­»é”ï¼Œéœ€è¦æå‰çŸ¥é“æ¯ä¸ªçº¿ç¨‹çš„æœ€å¤§èµ„æºéœ€æ±‚ï¼Œå®ç°èµ„æºåˆ†é…è¡¨å’Œè¿›ç¨‹èµ„æºåˆ†é…è¡¨ï¼Œå½“æœ‰çº¿ç¨‹è¯·æ±‚æˆ–é‡Šæ”¾èµ„æºæ—¶ï¼Œé“¶è¡Œå®¶ç®—æ³•é€šè¿‡æŸ¥è¡¨åˆ¤æ–­æ˜¯å¦æœ‰è¶³å¤Ÿçš„èµ„æºå¯ä¾›åˆ†é…ï¼Œæœ‰åˆ™åˆ†é…ï¼Œæ²¡æœ‰åˆ™ç­‰å¾…ï¼Œåªæœ‰é€šè¿‡å®‰å…¨æ£€æŸ¥ï¼Œæ‰å…è®¸æ“ä½œï¼Œå¦åˆ™åˆ†é…ä¼šè¢«æ‹’ç»ã€‚&lt;/p&gt;
&lt;h2 id=&#34;linuxè¿›ç¨‹è°ƒåº¦&#34;&gt;Linuxè¿›ç¨‹è°ƒåº¦&lt;/h2&gt;
&lt;p&gt;Linuxè¿›ç¨‹è°ƒåº¦æ”¯æŒå¤šç§è°ƒåº¦ç®—æ³•ï¼šåŸºäºä¼˜å…ˆçº§çš„è°ƒåº¦ç®—æ³•ã€å®æ—¶è°ƒåº¦ç®—æ³•ã€å®Œå…¨å…¬å¹³è°ƒåº¦ç®—æ³•CFQï¼›ä¹Ÿæ”¯æŒå¤šç§ä¸åŒçš„è¿›ç¨‹è°ƒåº¦å™¨ï¼šRTè°ƒåº¦å™¨ã€Deadlineè°ƒåº¦å™¨ã€CFSè°ƒåº¦å™¨ã€Idleè°ƒåº¦å™¨ã€‚&lt;/p&gt;
&lt;p&gt;è¿›ç¨‹ä¼˜å…ˆçº§è¶Šé«˜ï¼Œå æœ‰CPUæ—¶é—´è¶Šé•¿ï¼›è°ƒåº¦ä¼˜å…ˆçº§è¶Šé«˜ï¼Œè°ƒåº¦ç³»ç»Ÿé€‰ä¸­å®ƒçš„æ¦‚ç‡å°±è¶Šå¤§ã€‚&lt;/p&gt;
&lt;p&gt;Linuxçš„CFSè°ƒåº¦å™¨æ²¡æœ‰æ—¶é—´ç‰‡æ¦‚å¿µï¼Œå®ƒæ˜¯ç›´æ¥åˆ†é…CPUä½¿ç”¨æ—¶é—´çš„æ¯”ä¾‹ã€‚CFSä¼šæŒ‰æƒé‡æ¯”ä¾‹åˆ†é…CPUæ—¶é—´ï¼Œæƒé‡è¡¨ç¤ºè¿›ç¨‹ä¼˜å…ˆçº§ï¼Œ&lt;code&gt;è¿›ç¨‹æ—¶é—´ = CPUæ€»æ—¶é—´ * è¿›ç¨‹æƒé‡ / å°±ç»ªé˜Ÿåˆ—æ‰€æœ‰è¿›ç¨‹æƒé‡ä¹‹å’Œ&lt;/code&gt;ã€‚å¯¹å¤–æ¥å£æä¾›ä¸€ä¸ªniceå€¼ï¼ŒèŒƒå›´ä¸º-20~19ï¼Œæ•°å€¼è¶Šå°ï¼Œæƒé‡è¶Šå¤§ï¼Œæ¯é™ä½ä¸€ä¸ªniceå€¼ï¼Œå°±èƒ½å¤šè·å¾—10%çš„CPUæ—¶é—´ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºéå®æ—¶ï¼Œä¼˜å…ˆçº§ä¸é«˜çš„ä»»åŠ¡ï¼ŒLinuxä½¿ç”¨CFSå®Œå…¨å…¬å¹³è°ƒåº¦ç®—æ³•ï¼Œå®ç°ä»»åŠ¡çš„è°ƒåº¦ï¼›è¿™é‡Œä»»åŠ¡æŒ‡çš„æ˜¯çº¿ç¨‹æˆ–è¿›ç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;CFSåˆ†é…ç»™æ¯ä¸ªä»»åŠ¡çš„CPUæ—¶é—´æ˜¯ä¸€æ ·çš„ï¼Œæ¯ä¸ªä»»åŠ¡å®‰æ’ä¸€æ¬¡è™šæ‹Ÿè¿è¡Œæ—¶é—´vruntimeï¼Œå¦‚æœä¸€ä¸ªä»»åŠ¡è¿è¡Œå¾—è¶Šä¹…ï¼Œè¯¥ä»»åŠ¡çš„vruntimeå€¼è¶Šå¤§ï¼Œè€Œæ²¡æœ‰è¢«è¿è¡Œçš„ä»»åŠ¡ï¼Œvruntimeä¸ä¼šå˜åŒ–ï¼ŒCFSåœ¨è°ƒåº¦çš„æ—¶å€™ï¼Œä¼šæ ¹æ®æƒé‡å€¼ï¼Œä¼˜å…ˆé€‰æ‹©vruntimeå°‘çš„ä»»åŠ¡ï¼Œä»¥ä¿è¯æ¯ä¸ªä»»åŠ¡çš„å…¬å¹³æ€§ã€‚&lt;code&gt;è™šæ‹Ÿè¿è¡Œæ—¶é—´vruntime += å®é™…è¿è¡Œæ—¶é—´ * niceå¸¸é‡ / æƒé‡&lt;/code&gt;ï¼ˆniceå€¼è¶Šä½ï¼Œæƒé‡å€¼è¶Šå¤§ï¼Œè®¡ç®—å‡ºæ¥çš„vruntimeå°±ä¼šè¶Šå°ï¼›ä¼˜å…ˆçº§çš„èŒƒå›´æ˜¯&lt;code&gt;0~139&lt;/code&gt;ï¼Œå…¶ä¸­&lt;code&gt;0~99&lt;/code&gt;æ˜¯ç»™å®æ—¶ä»»åŠ¡ç”¨ï¼Œ&lt;code&gt;100~139&lt;/code&gt;ç»™æ™®é€šä»»åŠ¡ç”¨ï¼Œå€¼è¶Šä½ï¼Œä¼˜å…ˆçº§è¶Šé«˜ï¼Œniceå€¼çš„èŒƒå›´æ˜¯&lt;code&gt;-20~19&lt;/code&gt;ï¼Œæ–°ä¼˜å…ˆçº§ = æ—§ä¼˜å…ˆçº§ + niceå€¼ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;æ¯ä¸ªCPUéƒ½æœ‰è‡ªå·±çš„è¿è¡Œé˜Ÿåˆ—ï¼Œç”¨äºæè¿°æ­¤CPUä¸Šè¿è¡Œçš„æ‰€æœ‰è¿›ç¨‹ï¼Œä¸€èˆ¬åŒ…å«ä¸‰ä¸ªè¿è¡Œé˜Ÿåˆ—ï¼šDeadLineè¿è¡Œé˜Ÿåˆ—ï¼ŒRealTimeå®æ—¶è¿è¡Œé˜Ÿåˆ—ï¼ŒCFSè¿è¡Œé˜Ÿåˆ—ï¼ˆç”¨çº¢é»‘æ ‘æè¿°ï¼‰ï¼Œè°ƒåº¦çš„ä¼˜å…ˆçº§ä»å¤§åˆ°å°&lt;/p&gt;
&lt;h1 id=&#34;è®¾å¤‡io&#34;&gt;è®¾å¤‡I/O&lt;/h1&gt;
&lt;p&gt;æ“ä½œç³»ç»Ÿæœ¬èº«ä¼šå¯¹è®¾å¤‡è¿›è¡Œåˆ†ç±»ï¼Œå®šä¹‰ä¸€å¥—å¯¹åº”è®¾å¤‡çš„æ“ä½œæ¥å£ï¼Œç”±è®¾å¤‡çš„é©±åŠ¨ç¨‹åºå®ç°ï¼Œè€Œé©±åŠ¨ç¨‹åºå®ç°å¯¹åº”è®¾å¤‡çš„æ“ä½œï¼Œä»è€Œè¾¾åˆ°æ“ä½œç³»ç»Ÿä¸è®¾å¤‡è§£è€¦çš„ç›®çš„ã€‚&lt;/p&gt;
&lt;p&gt;è®¾å¤‡å’Œè®¾å¤‡é©±åŠ¨çš„ä¿¡æ¯ä¼šæŠ½è±¡æˆå¯¹åº”çš„æ•°æ®ç»“æ„ï¼Œå†é€šè¿‡è®¾å¤‡è¡¨ç»“æ„ç»„ç»‡é©±åŠ¨å’Œè®¾å¤‡çš„æ•°æ®ç»“æ„ã€‚&lt;/p&gt;
&lt;p&gt;æ€»çº¿æ˜¯è®¾å¤‡çš„åŸºç¡€ï¼Œè¡¨ç¤ºCPUä¸è®¾å¤‡çš„è¿æ¥ï¼Œæ€»çº¿æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªæ•°æ®ç»“æ„ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€ä¸ªé©±åŠ¨ç¨‹åºå¼€å§‹æ˜¯ç”±å†…æ ¸åŠ è½½è¿è¡Œï¼Œç„¶åè°ƒç”¨ç”±å†…æ ¸æä¾›çš„æ¥å£å»ºç«‹è®¾å¤‡ï¼Œæœ€åå‘å†…æ ¸æ³¨å†Œè®¾å¤‡å’Œé©±åŠ¨ï¼Œå®Œæˆé©±åŠ¨å’Œå†…æ ¸çš„æ¡æ‰‹åŠ¨ä½œã€‚&lt;/p&gt;
&lt;p&gt;å†…æ ¸è¦æ±‚è®¾å¤‡æ‰§è¡ŒæŸé¡¹åŠ¨ä½œï¼Œå°±ä¼šè°ƒç”¨è®¾å¤‡çš„é©±åŠ¨ç¨‹åºå‡½æ•°ï¼ŒæŠŠç›¸å…³å‚æ•°ä¼ é€’ç»™è®¾å¤‡çš„é©±åŠ¨ç¨‹åºï¼Œç”±äºå‚æ•°å¾ˆå¤šï¼Œå„ç§æ“ä½œæ‰€éœ€çš„å‚æ•°åˆä¸ç›¸åŒï¼Œå°±ä¼šæŠŠè¿™äº›éœ€è¦çš„å‚æ•°å°è£…åœ¨ä¸€ä¸ªæ•°æ®ç»“æ„ä¸­ï¼Œç§°ä¸ºI/OåŒ…ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨Linuxä¸­ï¼Œå„ç§è®¾å¤‡æ˜¯ä¸€ä¸ªä¸ªæ–‡ä»¶ï¼Œåªæ˜¯å¹¶ä¸å¯¹åº”ç£ç›˜ä¸Šçš„æ•°æ®æ–‡ä»¶ï¼Œè€Œæ˜¯å¯¹åº”ç€å­˜åœ¨å†…å­˜å½“ä¸­çš„è®¾å¤‡æ–‡ä»¶ï¼Œå¯¹è¿™äº›æ–‡ä»¶çš„æ“ä½œç­‰åŒäºå¯¹è®¾å¤‡çš„æ“ä½œã€‚åœ¨ç›®å½• &lt;code&gt;/sys/bus&lt;/code&gt;ç›®å½•ä¸‹èƒ½çœ‹åˆ°æ‰€æœ‰æ€»çº¿ä¸‹çš„æ‰€æœ‰è®¾å¤‡ï¼Œæ€»çº¿ç›®å½•ä¸‹æœ‰è®¾å¤‡ç›®å½•ï¼Œè®¾å¤‡ç›®å½•ä¸‹æ˜¯è®¾å¤‡æ–‡ä»¶ã€‚&lt;/p&gt;
&lt;p&gt;**ä¸­æ–­ï¼š**ä¸­æ–­ç”¨äºå‡å°‘CPUçš„å¼€é”€ï¼Œè®©CPUä¸åœ¨éœ€è¦ä¸æ–­è½®è¯¢è®¾å¤‡ï¼Œè€Œæ˜¯å‘è®¾å¤‡å‘é€ä¸€ä¸ªè¯·æ±‚ï¼Œè®©å¯¹åº”è¿›ç¨‹ç¡çœ ï¼Œåˆ‡æ¢æ‰§è¡Œå…¶ä»–ä»»åŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€èˆ¬ç”¨åœ¨éœ€è¦é•¿æ—¶é—´å¤„ç†çš„æ…¢é€Ÿè®¾å¤‡ä¸Šä½¿ç”¨ï¼Œè®©CPUåœ¨ä¸­æ–­çš„è¿™æ®µæ—¶é—´å¯ä»¥æ‰§è¡Œå…¶ä»–ä»»åŠ¡ï¼Œè€Œä¸ç”¨ä¸€ç›´è½®è¯¢ç­‰å¾…ï¼Œä½†å¦‚æœçŸ­æ—¶é—´å†…å‡ºç°å¤§é‡çš„ä¸­æ–­ï¼ˆæ¯”å¦‚ç½‘ç»œæ¥æ”¶æ•°æ®åŒ…ï¼‰ï¼Œä¼šä½¿å¾—ç³»ç»Ÿè¿‡è½½ï¼ŒCPUä¸æ–­çš„å¤„ç†ä¸­æ–­ï¼Œå¼•å‘æ´»é”ï¼Œå¯¼è‡´æ— æ³•åˆ‡æ¢æ‰§è¡Œå…¶ä»–ä»»åŠ¡ï¼Œä¸€èˆ¬çš„ä¼šä½¿ç”¨ çŸ­æ—¶é—´è½®è¯¢ + ä¸­æ–­ï¼ˆå¤šæ¬¡ä¸­æ–­åˆå¹¶ï¼‰çš„æ··åˆç­–ç•¥ï¼›&lt;/p&gt;
&lt;p&gt;ä¸­æ–­å¤„ç†æµç¨‹ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;ol&gt;
&lt;li&gt;åœ¨ I/O æ—¶ï¼Œè®¾å¤‡æ§åˆ¶å™¨å¦‚æœå·²ç»å‡†å¤‡å¥½æ•°æ®ï¼Œåˆ™ä¼šé€šè¿‡ä¸­æ–­æ§åˆ¶å™¨å‘ CPU å‘é€ä¸­æ–­è¯·æ±‚ï¼›&lt;/li&gt;
&lt;li&gt;ä¿æŠ¤è¢«ä¸­æ–­è¿›ç¨‹çš„ CPU ä¸Šä¸‹æ–‡ï¼›&lt;/li&gt;
&lt;li&gt;è½¬å…¥ç›¸åº”çš„è®¾å¤‡ä¸­æ–­å¤„ç†å‡½æ•°ï¼›&lt;/li&gt;
&lt;li&gt;è¿›è¡Œä¸­æ–­å¤„ç†ï¼›&lt;/li&gt;
&lt;li&gt;æ¢å¤è¢«ä¸­æ–­è¿›ç¨‹çš„ä¸Šä¸‹æ–‡ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;DMAï¼ˆDirect Memory Accessï¼‰&lt;/strong&gt; ï¼šè®©è®¾å¤‡åœ¨ CPU ä¸å‚ä¸çš„æƒ…å†µä¸‹ï¼Œè‡ªè¡Œå®ŒæˆæŠŠè®¾å¤‡ I/O æ•°æ®æ”¾å…¥åˆ°å†…å­˜ï¼Œç›®çš„æ˜¯å‡å°‘CPUå‚ä¸æ•°æ®æ‹·è´çš„æ—¶é—´ï¼Œè®©CPUæ— éœ€å‚ä¸æ•°æ®æ‹·è´ï¼Œå› æ­¤è¿™æ®µæ—¶é—´å¯ä»¥æ‰§è¡Œå…¶ä»–ä»»åŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;éœ€è¦æœ‰ ã€ŒDMA æ§åˆ¶å™¨ã€ç¡¬ä»¶çš„æ”¯æŒã€‚&lt;/p&gt;
&lt;p&gt;DMAå¤„ç†æµç¨‹&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/DMA%e5%b7%a5%e4%bd%9c%e5%8e%9f%e7%90%86.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/DMA%e5%b7%a5%e4%bd%9c%e5%8e%9f%e7%90%86.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä»é”®ç›˜æ•²å…¥å­—æ¯æ—¶ï¼Œæ“ä½œç³»ç»Ÿå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/CPU%e7%a1%ac%e4%bb%b6%e6%80%bb%e7%ba%bf%e5%9b%be.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/CPU%e7%a1%ac%e4%bb%b6%e6%80%bb%e7%ba%bf%e5%9b%be.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;å½“ç”¨æˆ·è¾“å…¥äº†é”®ç›˜å­—ç¬¦ï¼Œ&lt;strong&gt;é”®ç›˜æ§åˆ¶å™¨&lt;/strong&gt;å°±ä¼šäº§ç”Ÿæ‰«æç æ•°æ®ï¼Œå¹¶å°†å…¶ç¼“å†²åœ¨é”®ç›˜æ§åˆ¶å™¨çš„å¯„å­˜å™¨ä¸­ï¼Œç´§æ¥ç€é”®ç›˜æ§åˆ¶å™¨é€šè¿‡æ€»çº¿ç»™ CPU å‘é€&lt;strong&gt;ä¸­æ–­è¯·æ±‚&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;CPU æ”¶åˆ°ä¸­æ–­è¯·æ±‚åï¼Œæ“ä½œç³»ç»Ÿä¼š&lt;strong&gt;ä¿å­˜è¢«ä¸­æ–­è¿›ç¨‹çš„ CPU ä¸Šä¸‹æ–‡&lt;/strong&gt;ï¼Œç„¶åè°ƒç”¨é”®ç›˜çš„&lt;strong&gt;ä¸­æ–­å¤„ç†ç¨‹åº&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;é”®ç›˜çš„ä¸­æ–­å¤„ç†ç¨‹åºæ˜¯åœ¨&lt;strong&gt;é”®ç›˜é©±åŠ¨ç¨‹åº&lt;/strong&gt;åˆå§‹åŒ–æ—¶æ³¨å†Œçš„ï¼Œé‚£é”®ç›˜&lt;strong&gt;ä¸­æ–­å¤„ç†å‡½æ•°&lt;/strong&gt;çš„åŠŸèƒ½å°±æ˜¯ä»é”®ç›˜æ§åˆ¶å™¨çš„å¯„å­˜å™¨çš„ç¼“å†²åŒºè¯»å–æ‰«æç ï¼Œå†æ ¹æ®æ‰«æç æ‰¾åˆ°ç”¨æˆ·åœ¨é”®ç›˜è¾“å…¥çš„å­—ç¬¦ï¼Œå¦‚æœè¾“å…¥çš„å­—ç¬¦æ˜¯æ˜¾ç¤ºå­—ç¬¦ï¼Œé‚£å°±ä¼šæŠŠæ‰«æç ç¿»è¯‘æˆå¯¹åº”æ˜¾ç¤ºå­—ç¬¦çš„ ASCII ç ï¼Œæ¯”å¦‚ç”¨æˆ·åœ¨é”®ç›˜è¾“å…¥çš„æ˜¯å­—æ¯ Aï¼Œæ˜¯æ˜¾ç¤ºå­—ç¬¦ï¼Œäºæ˜¯å°±ä¼šæŠŠæ‰«æç ç¿»è¯‘æˆ A å­—ç¬¦çš„ ASCII ç ã€‚&lt;/p&gt;
&lt;p&gt;å¾—åˆ°äº†æ˜¾ç¤ºå­—ç¬¦çš„ ASCII ç åï¼Œå°±ä¼šæŠŠ ASCII ç æ”¾åˆ°ã€Œè¯»ç¼“å†²åŒºé˜Ÿåˆ—ã€ï¼Œæ¥ä¸‹æ¥å°±æ˜¯è¦æŠŠæ˜¾ç¤ºå­—ç¬¦æ˜¾ç¤ºå±å¹•äº†ï¼Œæ˜¾ç¤ºè®¾å¤‡çš„é©±åŠ¨ç¨‹åºä¼šå®šæ—¶ä»ã€Œè¯»ç¼“å†²åŒºé˜Ÿåˆ—ã€è¯»å–æ•°æ®æ”¾åˆ°ã€Œå†™ç¼“å†²åŒºé˜Ÿåˆ—ã€ï¼Œæœ€åæŠŠã€Œå†™ç¼“å†²åŒºé˜Ÿåˆ—ã€çš„æ•°æ®ä¸€ä¸ªä¸€ä¸ªå†™å…¥åˆ°æ˜¾ç¤ºè®¾å¤‡çš„æ§åˆ¶å™¨çš„å¯„å­˜å™¨ä¸­çš„æ•°æ®ç¼“å†²åŒºï¼Œæœ€åå°†è¿™äº›æ•°æ®æ˜¾ç¤ºåœ¨å±å¹•é‡Œã€‚&lt;/p&gt;
&lt;p&gt;æ˜¾ç¤ºå‡ºç»“æœåï¼Œ&lt;strong&gt;æ¢å¤è¢«ä¸­æ–­è¿›ç¨‹çš„ä¸Šä¸‹æ–‡&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&#34;æ–‡ä»¶ç³»ç»Ÿ&#34;&gt;æ–‡ä»¶ç³»ç»Ÿ&lt;/h1&gt;
&lt;p&gt;æ–‡ä»¶ç³»ç»Ÿæ˜¯æ“ä½œç³»ç»Ÿä¸ºäº†å…¼å®¹ä¸åŒçš„ç‰©ç†å­˜å‚¨è®¾å¤‡è€Œå­˜åœ¨ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å…³äºæ–‡ä»¶å’Œç›®å½•&#34;&gt;å…³äºæ–‡ä»¶å’Œç›®å½•&lt;/h2&gt;
&lt;p&gt;å­˜å‚¨è™šæ‹ŸåŒ–ä¸€ä¸ªæ˜¯æ–‡ä»¶ï¼Œå¦ä¸€ä¸ªæ˜¯ç›®å½•ï¼›&lt;/p&gt;
&lt;p&gt;æ–‡ä»¶å°±æ˜¯ä¸€ä¸ªçº¿æ€§å­—èŠ‚æ•°ç»„ï¼Œæ¯ä¸ªå­—èŠ‚å¯ä»¥è¯»å–æˆ–å†™å…¥ï¼Œæ¯ä¸ªæ–‡ä»¶æœ‰ä¸€ä¸ªä½çº§åç§° inodeï¼Œé€šè¿‡ç¡¬é“¾æ¥å°†æ–‡ä»¶åç§°ä¸inodeå·è¿æ¥èµ·æ¥ï¼›&lt;/p&gt;
&lt;p&gt;è€Œç›®å½•åˆ™åŒ…å«ä¸€ä¸ªå¯¹ï¼ˆinodeå·ï¼Œä¾›ç”¨æˆ·å¯è¯»çš„åç§°ï¼‰çš„åˆ—è¡¨ï¼Œå°†ç”¨æˆ·å¯è¯»çš„åç§°æ˜ å°„åˆ° inode å·ä¸Šï¼Œè¿™ä¸ªå¯¹ä¼šæŒ‡å‘å…¶ä»–æ–‡ä»¶æˆ–ç›®å½•ï¼Œä»è€Œæ„å»ºæˆç›®å½•æ ‘ï¼›&lt;/p&gt;
&lt;h2 id=&#34;å¸¸è§æ–‡ä»¶ç³»ç»Ÿçš„å®ç°&#34;&gt;å¸¸è§æ–‡ä»¶ç³»ç»Ÿçš„å®ç°&lt;/h2&gt;
&lt;p&gt;æ–‡ä»¶ç³»ç»Ÿä¼šæŠŠæ–‡ä»¶æ•°æ®å®šä¹‰æˆä¸€ä¸ªåŠ¨æ€çš„çº¿æ€§å­—èŠ‚æ•°ç»„ï¼Œå°†ä¸€æ®µèŒƒå›´çš„å­—èŠ‚æ•°ç»„æ•´åˆæˆä¸€ä¸ªæ–‡ä»¶æ•°æ®é€»è¾‘å—ï¼Œå†æ˜ å°„æˆå¯¹åº”å­˜å‚¨è®¾å¤‡çš„ç‰©ç†å­˜å‚¨å—ï¼Œä»è€Œè§£å†³ä¸åŒç‰©ç†å­˜å‚¨è®¾å¤‡æœ‰ä¸åŒçš„ç‰©ç†å­˜å‚¨å—çš„é—®é¢˜ã€‚å³ çº¿æ€§å­—èŠ‚æ•°ç»„ -&amp;gt; æ–‡ä»¶æ•°æ®é€»è¾‘å­˜å‚¨å— -&amp;gt; ç‰©ç†å­˜å‚¨å—ã€‚&lt;/p&gt;
&lt;p&gt;å¯ä»¥é€šè¿‡ä½å›¾æ¥æ ‡è¯†å“ªäº›é€»è¾‘å­˜å‚¨å—æ˜¯ç©ºé—²ï¼Œå“ªäº›æ˜¯å·²è¢«åˆ†é…å ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;é€šè¿‡ä¸€ä¸ªåŒ…å«æ–‡ä»¶ç³»ç»Ÿæ ‡è¯†ã€ç‰ˆæœ¬ã€çŠ¶æ€ã€å­˜å‚¨ä»‹è´¨å¤§å°ã€æ–‡ä»¶ç³»ç»Ÿé€»è¾‘å­˜å‚¨å—å¤§å°ã€ä½å›¾æ‰€åœ¨å­˜å‚¨å—ã€æ ¹ç›®å½•ç­‰ä¿¡æ¯çš„æ•°æ®ç»“æ„ï¼Œä½œä¸ºæ–‡ä»¶ç³»ç»Ÿçš„è¶…çº§å—æˆ–æ–‡ä»¶ç³»ç»Ÿæè¿°å—ã€‚&lt;/p&gt;
&lt;p&gt;æ–‡ä»¶ç³»ç»Ÿçš„æ ¼å¼åŒ–ï¼ŒæŒ‡çš„æ˜¯åœ¨å­˜å‚¨è®¾å¤‡ä¸Šé‡å»ºæ–‡ä»¶ç³»ç»Ÿçš„æ•°æ®ç»“æ„ï¼Œä¸€èˆ¬æ˜¯å…ˆè®¾ç½®æ–‡ä»¶ç³»ç»Ÿçš„è¶…çº§å—ã€ä½å›¾ã€æ ¹ç›®å½•ï¼Œä¸‰è€…æ˜¯å¼ºé¡ºåºçš„ã€‚&lt;/p&gt;
&lt;p&gt;Linuxä½¿ç”¨VFSè™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿä½œä¸ºä¸­é—´å±‚ï¼ŒæŠ½è±¡äº†æ–‡ä»¶ç³»ç»Ÿå…±æœ‰çš„æ•°æ®ç»“æ„å’Œæ“ä½œå‡½æ•°é›†åˆï¼Œä¸€ä¸ªç‰©ç†å­˜å‚¨è®¾å¤‡çš„é©±åŠ¨åªè¦å®ç°äº†è¿™äº›å‡½æ•°å°±å¯ä»¥æ’å…¥VFSä¸­ï¼Œä»è€Œå¯ä»¥åŒæ—¶æ”¯æŒå„ç§ä¸åŒçš„æ–‡ä»¶ç³»ç»Ÿã€‚&lt;/p&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/%e7%9b%ae%e5%bd%95%e9%a1%b9%e5%92%8c%e7%b4%a2%e5%bc%95%e5%85%b3%e7%b3%bb%e5%9b%be.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/%e7%9b%ae%e5%bd%95%e9%a1%b9%e5%92%8c%e7%b4%a2%e5%bc%95%e5%85%b3%e7%b3%bb%e5%9b%be.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;VFSåŒ…å«å››å¤§æ•°æ®ç»“æ„ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;è¶…çº§å—ç»“æ„super_blockï¼šç”¨æ¥å­˜å‚¨æ–‡ä»¶ç³»ç»Ÿè¯¦ç»†ä¿¡æ¯ï¼Œå¦‚å—ä¸ªæ•°ã€å—å¤§å°ã€ç©ºé—²å—ã€æ–‡ä»¶ç³»ç»Ÿçš„ä¿¡æ¯ã€inodeè¡¨çš„å¼€å§‹ä½ç½®ç­‰ï¼›å½“æ–‡ä»¶ç³»ç»Ÿè¢«æŒ‚è½½æ—¶è¿›å…¥å†…å­˜ï¼Œåˆå§‹åŒ–å„è‡ªå‚æ•°ï¼Œå°†å·åŠ åˆ°æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œè¿™æ ·ç³»ç»Ÿæ‰çŸ¥é“åœ¨å“ªæŸ¥æ‰¾ç£ç›˜ä¸Šçš„ç»“æ„ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç›®å½•é¡¹dentryï¼šç”¨æ¥è®°å½•æ–‡ä»¶çš„åå­—ï¼Œç´¢å¼•èŠ‚ç‚¹æŒ‡é’ˆï¼Œä»¥åŠå…¶ä»–ç›®å½•é¡¹çš„å±‚çº§å…³ç³»ï¼Œå¤šä¸ªç›®å½•é¡¹å…³è”èµ·æ¥å°±å½¢æˆç›®å½•ç»“æ„ï¼›ç›®å½•é¡¹ç”±å†…æ ¸ç»´æŠ¤ï¼Œç¼“å­˜åœ¨å†…å­˜ä¸­ï¼Œä¸å­˜æ”¾äºç£ç›˜ï¼›&lt;/p&gt;
&lt;p&gt;ç›®å½•ä¸ç›®å½•é¡¹ä¸ä¸€æ ·ï¼Œç›®å½•æ˜¯æ–‡ä»¶ï¼ŒæŒä¹…åŒ–å­˜åœ¨ç£ç›˜ä¸­ï¼Œä¹Ÿé€šè¿‡inodeè®¿é—®ï¼Œå› ä¸ºé¢‘ç¹æŸ¥è¯¢ç›®å½•éœ€è¦è¯»ç£ç›˜ï¼Œæ•ˆç‡ä½ï¼Œæ‰€ä»¥å†…æ ¸å°±ä¼šæŠŠè¯»è¿‡çš„ç›®å½•ç”¨ç›®å½•é¡¹ç¼“å­˜åœ¨å†…å­˜ï¼Œæå‡è¯»å–æ•ˆç‡ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ–‡ä»¶ç´¢å¼•èŠ‚ç‚¹ç»“æ„inodeï¼šè®°å½•æ–‡ä»¶å…ƒä¿¡æ¯ï¼ˆå¦‚inodeç¼–å·ã€æ–‡ä»¶ç±»å‹ã€æ–‡ä»¶å¤§å°ã€åˆ†é…ç»™å®ƒçš„å—æ•°ã€æ—¶é—´ä¿¡æ¯ã€è®¿é—®æƒé™ã€æ•°æ®åœ¨ç£ç›˜çš„ä½ç½®ç­‰ï¼‰ï¼Œæ˜¯æ–‡ä»¶çš„å”¯ä¸€æ ‡è¯†ï¼Œè¢«å­˜å‚¨åœ¨ç£ç›˜ä¸­ï¼Œå¯ä»¥ç†è§£ä¸ºinodeæ˜¯ æ–‡ä»¶å çš„IDï¼Œé€šå¸¸æœ‰ä¸€ä¸ªéšå¼çš„idç”¨äºæ‰¾åˆ°inodeåœ¨ç£ç›˜çš„ä½ç½®ï¼Œå†é€šè¿‡inodeæ‰¾åˆ°å­˜å‚¨çš„æ•°æ®ï¼›&lt;/p&gt;
&lt;p&gt;ä¸ç›®å½•é¡¹æ˜¯ä¸€å¯¹å¤šçš„å…³ç³»ï¼›&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç¡¬é“¾æ¥&lt;/strong&gt;ï¼šä¸æºæ–‡ä»¶æ˜¯åŒä¸€ä»½æ–‡ä»¶ï¼ŒinodeèŠ‚ç‚¹å·ç›¸åŒï¼›ç¡¬é“¾æ¥ç®—æ˜¯æºæ–‡ä»¶çš„ä¸€ä¸ªå…¥å£ï¼›åªæœ‰å½“ç¡¬é“¾æ¥å’Œå¯¹åº”çš„æºæ–‡ä»¶éƒ½åˆ é™¤ï¼Œæ–‡ä»¶å®ä½“æ‰ä¼šè¢«åˆ é™¤ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡è®¾ç½®ç¡¬é“¾æ¥é˜²æ­¢é‡è¦æ–‡ä»¶è¢«åˆ ï¼›å› ä¸ºæ¯ä¸ªæ–‡ä»¶ç³»ç»Ÿéƒ½æœ‰å„è‡ªçš„inodeæ•°æ®ç»“æ„å’Œåˆ—è¡¨ï¼Œæ‰€ä»¥ç¡¬é“¾æ¥ä¸å¯ç”¨äºè·¨æ–‡ä»¶ç³»ç»Ÿã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;è½¯é“¾æ¥&lt;/strong&gt;ï¼šç‹¬ç«‹æ–‡ä»¶ï¼Œä¸æºæ–‡ä»¶ä¸æ˜¯åŒä¸€ä»½æ–‡ä»¶ï¼Œinodeä¸åŒï¼Œç±»ä¼¼å¿«æ·æ–¹å¼ï¼Œå­˜å‚¨æºæ–‡ä»¶çš„ä½ç½®ä¿¡æ¯ï¼ŒæŒ‡å‘æºæ–‡ä»¶ï¼›åˆ é™¤æºæ–‡ä»¶ï¼Œè½¯è¿æ¥ä¾ç„¶å­˜åœ¨ï¼Œè‡³å°‘æ— æ³•è®¿é—®ï¼›è½¯é“¾æ¥å¯ä»¥è·¨æ–‡ä»¶ç³»ç»Ÿï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è¿›ç¨‹æ‰“å¼€æ–‡ä»¶å®ä¾‹ç»“æ„file&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;ç£ç›˜è¯»å†™æœ€å°å•ä½æ˜¯æ‰‡åŒºï¼Œæ¯ä¸ªæ‰‡åŒºåªæœ‰512Bå¤§å°ï¼Œæ–‡ä»¶ç³»ç»ŸæŠŠå¤šä¸ªæ‰‡åŒºç»„æˆä¸€ä¸ªé€»è¾‘å—ï¼Œä½œä¸ºè¯»å†™çš„æœ€å°å•ä½ï¼ŒLinuxä¸­é€»è¾‘å—å¤§å°ä¸º4KBï¼Œä¹Ÿå°±æ˜¯ä¸€æ¬¡æ€§è¯»å†™8ä¸ªæ‰‡åŒº&lt;/strong&gt;ï¼Œæå‡è¯»å†™æ•ˆç‡ï¼›&lt;/p&gt;
&lt;p&gt;ç£ç›˜æ ¼å¼åŒ–æ—¶ï¼Œä¼šåˆ†ä¸ºä¸‰ä¸ªå­˜å‚¨åŒºï¼Œåˆ†åˆ«æ˜¯è¶…çº§å—ï¼Œç´¢å¼•èŠ‚ç‚¹åŒºå’Œæ•°æ®å—åŒºï¼Œè¶…çº§å—å’Œç´¢å¼•èŠ‚ç‚¹åªæœ‰è¢«ä½¿ç”¨æ—¶æ‰ä¼šåŠ è½½è¿›å†…å­˜ï¼›&lt;/p&gt;
&lt;p&gt;Liunx æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿæ—¶ï¼Œä¼šè¯»å–æ–‡ä»¶ç³»ç»Ÿè¶…çº§å—ï¼Œå°†è¶…çº§å—åŠ è½½è¿›å†…å­˜ï¼Œä»è¶…çº§å—å‡ºå‘è¯»å–å¹¶æ„é€ å…¨éƒ¨ç›®å½•ç»“æ„ï¼Œç›®å½•ç»“æ„æŒ‡å‘å­˜å‚¨è®¾å¤‡æ–‡ä»¶æ—¶ï¼Œæ˜¯ä¸€ä¸ªä¸ªæ–‡ä»¶ç´¢å¼•èŠ‚ç‚¹ç»“æ„ï¼Œå½“æ–‡ä»¶è¢«è®¿é—®æ—¶ï¼Œæ‰è¢«åŠ è½½è¿›å†…å­˜ï¼Œæ–‡ä»¶ç³»ç»Ÿçš„åŸºæœ¬æ“ä½œå•ä½æ˜¯æ•°æ®å—ï¼Œç”¨æˆ·è¿›ç¨‹è¯»å†™æ–‡ä»¶æ—¶ä½¿ç”¨å­—èŠ‚ï¼Œé€šè¿‡æ–‡ä»¶ç³»ç»Ÿï¼Œæ“ä½œå¯¹åº”çš„æ•°æ®å—ï¼Œå®ç°æ–‡ä»¶çš„è¯»å†™ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ–‡ä»¶çš„å­˜å‚¨&#34;&gt;æ–‡ä»¶çš„å­˜å‚¨&lt;/h2&gt;
&lt;p&gt;æ–‡ä»¶çš„æ•°æ®å­˜æ”¾åœ¨ç£ç›˜ä¸Šï¼Œå°±åƒç¨‹åºåœ¨å†…å­˜ä¸­å­˜æ”¾çš„æ–¹å¼ä¸€æ ·ï¼Œæœ‰ä¸¤ç§ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;è¿ç»­ç©ºé—´å­˜æ”¾æ–¹å¼&lt;/p&gt;
&lt;p&gt;æ–‡ä»¶å­˜æ”¾åœ¨ç£ç›˜è¿ç»­çš„ç‰©ç†ç©ºé—´ä¸­ï¼Œæ–‡ä»¶æ•°æ®ç´§å¯†ç›¸è¿ï¼Œè¯»å†™æ•ˆç‡é«˜ï¼Œä¸€æ¬¡ç£ç›˜å¯»é“å°±èƒ½è¯»å‡ºæ•´ä¸ªæ–‡ä»¶ï¼Œä½†å­˜æ”¾æ—¶å¿…é¡»å…ˆçŸ¥é“ä¸€ä¸ªæ–‡ä»¶çš„å¤§å°ï¼Œæ‰èƒ½åˆ†é…å¯¹åº”çš„ç©ºé—´ï¼›&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯æœ‰ç£ç›˜ç©ºé—´ç¢ç‰‡å’Œæ–‡ä»¶é•¿åº¦ä¸æ˜“æ‰©å±•çš„ç¼ºç‚¹ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;éè¿ç»­ç©ºé—´å­˜æ”¾æ–¹å¼&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é“¾è¡¨æ–¹å¼ï¼šé€šè¿‡é“¾è¡¨ç¦»æ•£å’Œä¸è¿ç»­çš„ç‰¹ç‚¹ï¼Œè§£å†³ç£ç›˜ç¢ç‰‡é—®é¢˜å’Œæ–‡ä»¶åŠ¨æ€æ‰©å±•é—®é¢˜ï¼Œæå‡ç£ç›˜ç©ºé—´åˆ©ç”¨ç‡ï¼Œä½†ä¸æ”¯æŒç›´æ¥è®¿é—®ã€‚
&lt;ul&gt;
&lt;li&gt;éšå¼é“¾è¡¨ï¼šæ–‡ä»¶å¤´åŒ…å«ç¬¬ä¸€å—å’Œæœ€åä¸€å—çš„ä½ç½®ï¼Œæ¯ä¸ªæ•°æ®å—é‡Œå­˜æ”¾æŒ‡å‘ä¸‹ä¸€ä¸ªæ•°æ®å—çš„æŒ‡é’ˆï¼›ç¼ºç‚¹åœ¨äºæ— æ³•ç›´æ¥è®¿é—®æ•°æ®å—ï¼Œåªèƒ½é€šè¿‡æŒ‡é’ˆé¡ºåºè®¿é—®ï¼ŒåŒæ—¶æ¯ä¸ªæ•°æ®å—è¿˜è¦æ¶ˆè€—ç©ºé—´å­˜å‚¨æŒ‡é’ˆï¼Œå¦‚æœæŒ‡é’ˆä¸¢å¤±æˆ–æŸåï¼Œä¼šå¯¼è‡´æ–‡ä»¶æ•°æ®ä¸¢å¤±ï¼›&lt;/li&gt;
&lt;li&gt;æ˜¾å¼é“¾æ¥ï¼šæŠŠéšå¼é“¾è¡¨é‡Œæ¯ä¸ªæ•°æ®å—çš„æŒ‡é’ˆå­˜åœ¨ä¸€ä¸ªé“¾æ¥è¡¨ä¸­ï¼Œè§£å†³éšå¼é“¾è¡¨çš„ç¼ºç‚¹ï¼›è¿™ä¸ªé“¾æ¥è¡¨ï¼Œç§°ä¸ºæ–‡ä»¶åˆ†é…è¡¨ï¼Œå­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œæå‡æ£€ç´¢é€Ÿåº¦ï¼Œå¤§å¤§å‡å°‘è®¿é—®ç£ç›˜çš„æ¬¡æ•°ï¼Œä½†ä¸ä½¿ç”¨äºå¤§ç£ç›˜ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ç´¢å¼•æ–¹å¼ï¼šé€šè¿‡ä¸ºæ¯ä¸ªæ–‡ä»¶åˆ›å»ºä¸€ä¸ªç´¢å¼•æ•°æ®å—ï¼Œå­˜æ”¾æŒ‡å‘æ–‡ä»¶æ•°æ®å—çš„æŒ‡é’ˆåˆ—è¡¨ï¼Œå­˜æ”¾åœ¨æ–‡ä»¶å¤´ä¸­ï¼Œç›¸å½“äºç›®å½•ï¼Œè§£å†³é“¾è¡¨æ–¹å¼æ— æ³•ç›´æ¥è®¿é—®çš„é—®é¢˜ï¼ŒåŒæ—¶ä¹Ÿè§£å†³ç£ç›˜ç¢ç‰‡å’Œæ–‡ä»¶ä¸æ˜“æ‰©å±•çš„é—®é¢˜ï¼Œå› ä¸ºä¼šä¸ºæ–‡ä»¶è®¾ç½®ç´¢å¼•æ•°æ®ï¼Œå¦‚æœæ–‡ä»¶å¾ˆå¤§ï¼Œç´¢å¼•æ•°æ®å—ä¹Ÿå¾ˆå¤§ï¼Œæ‰€ä»¥åªé€‚ç”¨äºå°æ–‡ä»¶ã€‚&lt;/li&gt;
&lt;li&gt;é“¾è¡¨ + ç´¢å¼• ç»„åˆçš„æ–¹å¼ï¼Œæ¯”å¦‚é“¾å¼ç´¢å¼•å—ï¼ˆåœ¨ç´¢å¼•æ•°æ®å—ç•™ä¸€ä¸ªå­˜æ”¾æŒ‡å‘ä¸‹ä¸€ä¸ªç´¢å¼•å—çš„æŒ‡é’ˆï¼‰ï¼Œå¤šçº§ç´¢å¼•å—ï¼ˆç´¢å¼•ä¹‹ä¸Šå†åˆ›å»ºç´¢å¼•ï¼Œå½¢æˆå¤šçº§ç´¢å¼•ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/%e6%96%87%e4%bb%b6%e5%ad%98%e5%82%a8%e6%96%b9%e5%bc%8f%e6%af%94%e8%be%83.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/%e6%96%87%e4%bb%b6%e5%ad%98%e5%82%a8%e6%96%b9%e5%bc%8f%e6%af%94%e8%be%83.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;ç©ºé—²ç©ºé—´ç®¡ç†-1&#34;&gt;ç©ºé—²ç©ºé—´ç®¡ç†&lt;/h2&gt;
&lt;p&gt;è¿›è¡Œç©ºé—²ç©ºé—´ç®¡ç†ï¼Œä¸»è¦æ˜¯ä¸ºäº†å¿«é€Ÿæ‰¾åˆ°å¯ç”¨ç©ºé—´ï¼Œè¿›è¡Œå†™å…¥ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ç©ºé—²è¡¨æ³•ï¼š&lt;/p&gt;
&lt;p&gt;ä¸ºç©ºé—²ç©ºé—´å»ºç«‹ä¸€å¼ è¡¨ï¼Œè¡¨å†…å®¹åŒ…æ‹¬ç©ºé—²åŒºçš„ç¬¬ä¸€ä¸ªå—å·å’Œè¯¥ç©ºé—²åŒºçš„å—ä¸ªæ•°ã€‚å½“è¯·æ±‚åˆ†é…ç£ç›˜ç©ºé—´æ—¶ï¼Œç³»ç»Ÿä¾æ¬¡æ‰«æç©ºé—²è¡¨é‡Œçš„å†…å®¹ï¼Œç›´åˆ°æ‰¾åˆ°ä¸€ä¸ªåˆé€‚çš„ç©ºé—²åŒºåŸŸï¼›ç”¨æˆ·æ’¤é”€æ–‡ä»¶æ—¶ï¼Œç³»ç»Ÿå›æ”¶æ–‡ä»¶ç©ºé—´ï¼Œä¹Ÿéœ€è¦é¡ºåºæ‰«æç©ºé—²è¡¨ï¼Œå¯»æ‰¾ä¸€ä¸ªç©ºé—²è¡¨æ¡ç›®å¹¶é‡Šæ”¾ç©ºé—´çš„ç¬¬ä¸€ä¸ªç‰©ç†å—ï¼Œä»¥åŠå®ƒå ç”¨çš„å—æ•°å¡«åˆ°è¿™ä¸ªæ¡ç›®ï¼›&lt;/p&gt;
&lt;p&gt;è¿™ç§æ–¹æ³•é‡Šæ”¾å»ºç«‹è¿ç»­æ–‡ä»¶ï¼Œå¦‚æœæ˜¯æœ‰å¤§é‡ç©ºé—²å°ç©ºé—´ï¼Œæ¯”è¾ƒç¢ç‰‡ï¼ŒæŸ¥æ‰¾æ•ˆç‡å°±å¾ˆä½ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç©ºé—²é“¾è¡¨æ³•ï¼š&lt;/p&gt;
&lt;p&gt;é€šè¿‡é“¾è¡¨é˜»æ­¢ç©ºé—²å—ï¼Œä¸€ä¸ªç©ºé—²å—é€šè¿‡æŒ‡é’ˆæŒ‡å‘ä¸‹ä¸€å—ï¼Œä½†æ˜¯è¿™ç§æ–¹å¼æ— æ³•éšæœºè®¿é—®ï¼Œæ¯å½“é“¾ä¸Šå¢åŠ æˆ–ç§»åŠ¨ç©ºé—²å—æ—¶éœ€è¦åšå¾ˆå¤šIOæ“ä½œï¼Œæ¯ä¸ªç©ºé—²å—éœ€è¦å­˜å‚¨æŒ‡é’ˆä¹Ÿæµªè´¹ç©ºé—´ï¼Œä¸é€‚åˆå¤§å‹æ–‡ä»¶ç³»ç»Ÿï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä½å›¾æ³•ï¼š&lt;/p&gt;
&lt;p&gt;ç£ç›˜ä¸Šæ‰€æœ‰ç›˜å—éƒ½æœ‰ä¸€ä¸ªäºŒè¿›åˆ¶ä½ä¸ä¹‹å¯¹åº”ï¼Œ0è¡¨ç¤ºç©ºé—²ï¼Œ1è¡¨ç¤ºå·²åˆ†é…ï¼ŒLinuxå°±é‡‡ç”¨è¿™ç§ï¼Œç©ºé—²å—ä½¿ç”¨ä½å›¾ï¼Œinodeä¹Ÿä½¿ç”¨ä½å›¾ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;ç›®å½•å­˜å‚¨&#34;&gt;ç›®å½•å­˜å‚¨&lt;/h2&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/%e7%9b%ae%e5%bd%95%e5%93%88%e5%b8%8c%e8%a1%a8.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/%e7%9b%ae%e5%bd%95%e5%93%88%e5%b8%8c%e8%a1%a8.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;ç›®å½•æ–‡ä»¶çš„å—é‡Œä¿å­˜çš„æ˜¯ç›®å½•é‡Œé¢ä¸€é¡¹ä¸€é¡¹çš„æ–‡ä»¶ä¿¡æ¯ï¼ˆå¦‚æ–‡ä»¶åã€æ–‡ä»¶inodeã€æ–‡ä»¶ç±»å‹ç­‰ï¼‰ï¼Œç»„åˆæˆåˆ—è¡¨ï¼Œåˆ—è¡¨æ¯ä¸€é¡¹å°±ä»£è¡¨è¯¥ç›®å½•ä¸‹çš„æ–‡ä»¶çš„æ–‡ä»¶åå’Œå¯¹åº”çš„inodeï¼Œé€šè¿‡è¿™ä¸ªinodeï¼Œå°±èƒ½æ‰¾åˆ°çœŸæ­£çš„æ–‡ä»¶ã€‚ä¸ºäº†æŸ¥æ‰¾æ–¹ä¾¿ï¼Œç›®å½•çš„æ ¼å¼æ”¹æˆäº†å“ˆå¸Œè¡¨ã€‚&lt;/p&gt;
&lt;p&gt;ç›®å½•æŸ¥è¯¢å¦‚æœé€šè¿‡åœ¨ç£ç›˜ä¸Šåå¤æœç´¢ï¼Œå°±è¦ä¸æ–­è¿›è¡ŒIOï¼Œå¼€é”€è¾ƒå¤§ï¼Œæ‰€ä»¥ä¸€èˆ¬æ˜¯æŠŠæ–‡ä»¶ç›®å½•ç¼“å­˜åœ¨å†…å­˜ï¼ŒæŸ¥æ‰¾çš„æ—¶å€™åœ¨å†…å­˜ä¸­æŸ¥æ‰¾ï¼Œé™ä½ç£ç›˜æ“ä½œæ¬¡æ•°ï¼Œæé«˜æ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®é€Ÿåº¦ã€‚&lt;/p&gt;
&lt;h2 id=&#34;è®¿é—®å’Œå†™å…¥&#34;&gt;è®¿é—®å’Œå†™å…¥&lt;/h2&gt;
&lt;p&gt;å‡è®¾ä¸€ä¸ªæ–‡ä»¶ç³»ç»ŸåŒ…å«è¿™5ä¸ªéƒ¨åˆ†ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;è¶…çº§å—ï¼šåŒ…å«è¯¥ç‰¹å®šæ–‡ä»¶ç³»ç»Ÿçš„ä¿¡æ¯ï¼Œå¦‚æœ‰å¤šå°‘ä¸ªinodeå’Œæ•°æ®å—ï¼Œinodeè¡¨å¼€å§‹çš„ä½ç½®ï¼Œæ ‡è¯†æ–‡ä»¶ç³»ç»Ÿç±»å‹çš„å¹»æ•°ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ•°æ®ä½å›¾ï¼šè®°å½•æ•°æ®å—åŒºçš„ç©ºé—²å’Œåˆ†é…æ ‡è®°çš„ç©ºé—´ç®¡ç†ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;inodeä½å›¾ï¼šè®°å½•inodeå—åŒºçš„ç©ºé—²å’Œåˆ†é…æ ‡è®°çš„ç©ºé—´ç®¡ç†ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;inodeå—åŒºï¼šæ¯ä¸ªinodeç”±ä¸€ä¸ªæ•°å­— i-number éšå¼å¼•ç”¨ï¼Œä»è€Œè®¡ç®—å‡ºç£ç›˜ä¸Šç›¸åº”èŠ‚ç‚¹çš„ä½ç½®ï¼Œå–åˆ°å¯¹åº”çš„inodeä¿¡æ¯ï¼›æ¯ä¸ªinodeåŒ…å«å…³äºæ–‡ä»¶çš„ä¿¡æ¯ï¼Œå¦‚æ–‡ä»¶ç±»å‹ï¼ˆæ˜¯å¸¸è§„æ–‡ä»¶è¿˜æ˜¯ç›®å½•ï¼‰ã€å¤§å°ã€åˆ†é…ç»™ä»–çš„å—æ•°ã€ä¿æŠ¤ä¿¡æ¯ï¼ˆè°æ‹¥æœ‰ä»¥åŠè°å¯ä»¥è®¿é—®ï¼‰ã€æ—¶é—´ä¿¡æ¯ï¼ˆæ–‡ä»¶åˆ›å»ºã€ä¿®æ”¹ã€ä¸Šæ¬¡è®¿é—®æ—¶é—´ï¼‰ã€æœ‰å…³å…¶æ•°æ®å—é©»ç•™åœ¨ç£ç›˜ä¸Šçš„ä½ç½®ï¼ˆæ¯”å¦‚æ•°æ®æŒ‡å‘ç£ç›˜å¯¹åº”ä½ç½®çš„æŒ‡é’ˆï¼‰ï¼›&lt;/p&gt;
&lt;p&gt;ä¸€ä¸ªinodeæŒ‡å‘çš„æ•°æ®å—å¤§å°æ˜¯æœ‰é™çš„ï¼Œå¦‚æœæ–‡ä»¶ç‰¹åˆ«å¤§ï¼Œé€šå¸¸å¯ä»¥ç»™inodeè®¾ç½®å¤šçº§ç´¢å¼•è§£å†³ï¼Œæ¯”å¦‚æœ‰ä¸€ä¸ªinodeä¸æ˜¯ç›´æ¥æŒ‡å‘ç”¨æˆ·çš„æ•°æ®å—çš„ï¼Œè€Œæ˜¯åŒ…å«è¯¥æ–‡ä»¶æ¶‰åŠåˆ°çš„å¤šä¸ªinodeä½ç½®ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ•°æ®å—åŒºï¼šç”¨æˆ·æ•°æ®ã€ç›®å½•æ•°æ®å­˜å‚¨ã€inodeæ•°æ®å­˜å‚¨çš„ä½ç½®ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æ“ä½œï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;æ‰“å¼€æ–‡ä»¶ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å‡è®¾é€šè¿‡open(&amp;quot;/foo/bar&amp;quot;, O_RDONLY)æ‰“å¼€æ–‡ä»¶ï¼Œé¦–å…ˆä¼šæ‰¾åˆ°ç›®å½•æ–‡ä»¶å¯¹åº”çš„inodeå¯¹åº”çš„i-numberï¼Œä¸€èˆ¬æ¥è¯´ï¼Œä¼šå­˜å‚¨åœ¨è¶…çº§å—ä¸­ï¼Œä¾¿äºæ“ä½œç³»ç»ŸæŒ‚è½½æ–‡ä»¶ç³»ç»Ÿæ—¶å°±èƒ½çŸ¥é“ï¼Œä¸€èˆ¬æ ¹çš„inodeçš„i-numberæ˜¯2ï¼›&lt;/li&gt;
&lt;li&gt;æ ¹æ®è®¿é—®è·¯å¾„ï¼Œä»æ ¹ç›®å½•å¼€å§‹éå†è·¯å¾„åï¼Œæ‰¾åˆ°å¯¹åº”ç›®å½•çš„inodeåŠå…¶ç›®å½•æ•°æ®å—ï¼Œæœ€åæ‰¾åˆ°å¯¹åº”æ–‡ä»¶çš„inodeå·ï¼Œè¯»å…¥å†…å­˜ï¼›&lt;/li&gt;
&lt;li&gt;æ–‡ä»¶ç³»ç»Ÿåšæœ€åçš„æƒé™æ£€æŸ¥ï¼Œåœ¨æ¯ä¸ªè¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶åˆ—è¡¨ä¸­ï¼Œä¸ºæ­¤è¿›ç¨‹åˆ†é…ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œå¹¶è¿”å›ç»™ç”¨æˆ·ï¼›&lt;/li&gt;
&lt;li&gt;openå¯¼è‡´çš„IOé‡ä¸è·¯å¾„åçš„é•¿åº¦æˆæ­£æ¯”ï¼Œæ–‡ä»¶æ‰€åœ¨çš„ä½ç½®è¶Šæ·±ï¼ŒIOé‡è¶Šå¤šï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è¯»å–æ–‡ä»¶ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ‰“å¼€æ–‡ä»¶åï¼Œç¨‹åºå¯ä»¥å‘å‡ºread()ç³»ç»Ÿè°ƒç”¨ï¼Œä»æ–‡ä»¶ä¸­è¯»å–ï¼Œç¬¬ä¸€æ¬¡è¯»å–å°†åœ¨æ–‡ä»¶çš„ç¬¬ä¸€ä¸ªå—ä¸­è¯»å–ï¼ˆç¬¬ä¸€æ¬¡çš„åç§»é‡æ˜¯0ï¼‰ï¼ŒæŸ¥é˜…inodeä»¥æŸ¥æ‰¾è¿™ä¸ªå—çš„ä½ç½®ï¼›&lt;/li&gt;
&lt;li&gt;è¯»å–ä¹Ÿä¼šç”¨æ–°çš„æœ€åè®¿é—®æ—¶é—´æ›´æ–°inodeï¼Œæ›´æ–°æ­¤æ–‡ä»¶æè¿°ç¬¦åœ¨å†…å­˜ä¸­æ‰“å¼€çš„æ–‡ä»¶è¡¨ï¼Œæ›´æ–°æ–‡ä»¶åç§»é‡ï¼Œä»¥ä¾¿ä¸‹ä¸€æ¬¡è¯»å–ç¬¬äºŒä¸ªæ–‡ä»¶å—ï¼Œè¯»å–æ¯ä¸ªå—éœ€è¦æ–‡ä»¶ç³»ç»Ÿé¦–å…ˆæŸ¥è¯¢inodeï¼Œç„¶åè¯»å–è¯¥å—ï¼Œå†å†™å…¥æ›´æ–°inodeçš„æœ€åè®¿é—®æ—¶é—´å­—æ®µï¼Œæ­¤æ—¶ä¼šå‘ç”Ÿå¤šæ¬¡ç£ç›˜IOï¼›&lt;/li&gt;
&lt;li&gt;æ–‡ä»¶æ‰“å¼€åï¼Œæ¯æ¬¡è¯»å–æ—¶ï¼Œä¼šè¯»ä¸€æ¬¡æ–‡ä»¶inodeï¼Œè¯»ä¸€æ¬¡æ–‡ä»¶æ•°æ®ï¼Œå†™ä¸€æ¬¡æ–‡ä»¶inodeï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å†™å…¥æ–‡ä»¶ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;æ‰“å¼€æ–‡ä»¶åï¼Œç¨‹åºå¯ä»¥å‘å‡ºwrite()ç³»ç»Ÿè°ƒç”¨ï¼Œå¾€æ–‡ä»¶å†™å…¥æ•°æ®ï¼Œå†™å…¥åˆ†ä¸ºä¸¤ç§ï¼Œä¸€ç§æ˜¯åˆ›å»ºæ–‡ä»¶å¹¶å†™å…¥ï¼Œå¦ä¸€ç§æ˜¯å†™å…¥è¦†ç›–ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è¦†ç›–å†™å…¥æ¯”è¾ƒç®€å•ï¼Œæ‰“å¼€æ–‡ä»¶åï¼Œè¯»å–ä¸€æ¬¡æ–‡ä»¶inodeï¼Œè¯»å–ä¸€æ¬¡æ•°æ®ä½å›¾ï¼Œå†™å…¥ä¸€æ¬¡æ–‡ä»¶æ•°æ®ï¼Œå†™å…¥ä¸€æ¬¡æ•°æ®ä½å›¾ï¼Œå†™å…¥ä¸€æ¬¡æ–‡ä»¶inodeï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å†™å…¥ä¸€ä¸ªæ–°æ–‡ä»¶æ—¶ï¼Œæ¯æ¬¡å†™å…¥æ“ä½œä¸ä»…éœ€è¦å°†æ•°æ®å†™å…¥ç£ç›˜ï¼Œè¿˜éœ€è¦å†³å®šå°†å“ªä¸ªå—åˆ†é…ç»™æ–‡ä»¶ï¼Œä¸ä»…è¦åˆ†é…ä¸€ä¸ªinodeï¼Œè¿˜è¦åœ¨åŒ…å«æ–°æ–‡ä»¶çš„ç›®å½•ä¸­åˆ†é…ç©ºé—´ï¼Œä»è€Œç›¸åº”çš„æ›´æ–°ç£ç›˜çš„å…¶ä»–ç»“æ„ï¼Œæ‰€ä»¥æ¯æ¬¡å†™å…¥æ–‡ä»¶é€»è¾‘ä¸Šä¼šå‘ç”Ÿ5ä¸ªIOï¼Œå¦‚æœç›®å½•éœ€è¦å¢é•¿ä»¥å®¹çº³æ–°æ¡ç›®ï¼Œåˆ™è¿˜éœ€è¦é¢å¤–çš„IOï¼›&lt;/p&gt;
&lt;p&gt;åˆ›å»ºæ–‡ä»¶åŸºæœ¬çš„5ä¸ªIOï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;è¯»å–inodeä½å›¾ï¼ŒæŸ¥æ‰¾ç©ºé—²çš„inodeï¼›&lt;/li&gt;
&lt;li&gt;å†™å…¥inodeä½å›¾ï¼Œå°†æ–°åˆ†é…çš„å—æ ‡è®°ä¸ºå·²åˆ†é…ï¼›å†™å…¥æ–°çš„inodeï¼ˆå°†å®ƒæœ¬èº«çš„ä¿¡æ¯å†™å…¥æ•°æ®å—åŒºï¼‰ï¼Œè¿›è¡Œåˆå§‹åŒ–ï¼›&lt;/li&gt;
&lt;li&gt;è¯»å–æ–°inodeä¿¡æ¯ï¼Œå†™å…¥æ–°inodeå¯¹åº”çš„ç›®å½•æ•°æ®ï¼Œå°†æ–‡ä»¶çš„é«˜çº§åç§°é“¾æ¥åˆ°å®ƒçš„inodeå·ï¼›&lt;/li&gt;
&lt;li&gt;å†™å…¥è¿™ä¸ªæ–°inodeçš„ç›®å½•inodeï¼Œè¿›è¡Œæ›´æ–°ï¼›&lt;/li&gt;
&lt;li&gt;ä¹‹åæ‰è¯´çœŸæ­£çš„æ•°æ®å—å†™å…¥ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å…³é—­æ–‡ä»¶ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é‡Šæ”¾æ–‡ä»¶æè¿°ç¬¦ï¼Œæ­¤æ—¶ä¸ä¼šæœ‰ç£ç›˜IOå‘ç”Ÿï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸ºäº†è§£å†³è¯»å–å’Œå†™å…¥æ—¶äº§ç”Ÿçš„å¤§é‡IOå¯¼è‡´çš„æ€§èƒ½é—®é¢˜ï¼Œå¼•å…¥ç³»ç»Ÿå†…å­˜æ¥ç¼“å­˜é‡è¦çš„å—ï¼Œä»è€Œæå‡æ€§èƒ½ï¼Œæ¯”å¦‚ç¬¬ä¸€æ¬¡æ‰“å¼€å¯èƒ½ä¼šäº§ç”Ÿå¾ˆå¤šIOæ¥è¯»å–ç›®å½•çš„inodeå’Œæ•°æ®ï¼Œä½†éšåæ‰“å¼€åŒä¸€æ–‡ä»¶æˆ–åŒä¸€ç›®å½•ä¸­çš„æ–‡ä»¶ï¼Œä¼šå‘½ä¸­ç¼“å­˜ï¼Œä¸ç”¨IOï¼Œä»è€Œæå‡æ€§èƒ½ï¼›&lt;/p&gt;
&lt;p&gt;ç³»ç»Ÿå†…å­˜ä¼šåˆ’åˆ†ä¸ºé™æ€å†…å­˜å’ŒåŠ¨æ€å†…å­˜ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é™æ€å†…å­˜ï¼šåˆ’å®šå›ºå®šå¤§å°çš„ç¼“å­˜ï¼Œåœ¨å¯åŠ¨æ—¶è¿›è¡Œåˆ†é…ï¼Œä½†è¿™å¯èƒ½ä¼šå¯¼è‡´æµªè´¹ï¼Œç¼“å­˜ç­–ç•¥è·Ÿè™šæ‹Ÿå†…å­˜å·®ä¸å¤šï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨LRUç­‰è¿›è¡Œç»´æŠ¤ï¼›&lt;/li&gt;
&lt;li&gt;åŠ¨æ€å†…å­˜ï¼šå°†è™šæ‹Ÿå†…å­˜é¡µé¢å’Œæ–‡ä»¶ç³»ç»Ÿé¡µé¢é›†æˆåˆ°ç»Ÿä¸€é¡µé¢ç¼“å­˜ä¸­ï¼Œä»è€Œå¯ä»¥çµæ´»çš„åˆ†é…ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç¼“å­˜å¯¹å†™å…¥çš„å½±å“ï¼š&lt;/p&gt;
&lt;p&gt;é€šè¿‡å»¶è¿Ÿå†™å…¥ï¼Œæ–‡ä»¶ç³»ç»Ÿå¯ä»¥å°†ä¸€æ‰¹æ•°æ®æ”¾å…¥ä¸€ä¸ªIOä¸­å®Œæˆï¼Œæˆ–è€… åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œinodeä½å›¾è¢«æ›´æ–°ï¼Œç¨ååœ¨åˆ›å»ºå¦ä¸€ä¸ªæ–‡ä»¶æ—¶åˆè¢«æ›´æ–°ï¼Œæ–‡ä»¶ç³»ç»Ÿä¼šåœ¨ç¬¬ä¸€æ¬¡æ›´æ–°åå»¶è¿Ÿå†™å…¥ï¼Œä»è€ŒèŠ‚çœä¸€æ¬¡IO ç­‰åœºæ™¯ï¼Œåˆå¹¶IOå†™å…¥ï¼Œä»è€Œæå‡æ€§èƒ½ï¼Œä½†åœ¨æœªå†™å…¥ç£ç›˜æ—¶ï¼Œå¦‚æœç³»ç»Ÿå‘ç”Ÿå´©æºƒï¼Œæ›´æ–°å°±ä¼šä¸¢å¤±ï¼Œæ‰€ä»¥å¯¹äºå¯¹æ•°æ®å®Œæ•´æ€§æ¯”è¾ƒé«˜çš„æ•°æ®ï¼Œå°±éœ€è¦å¼ºåˆ¶å†™å…¥ç£ç›˜ï¼Œé€šè¿‡è°ƒç”¨fsync() æˆ– ä½¿ç”¨ç»•è¿‡ç¼“å­˜çš„ç›´æ¥ IOæ¥å£ æˆ– ä½¿ç”¨åŸå§‹ç£ç›˜æ¥å£å¹¶å®Œå…¨é¿å…ä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿå†™å…¥ï¼›&lt;/p&gt;
&lt;h2 id=&#34;æ–‡ä»¶io&#34;&gt;æ–‡ä»¶IO&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ç¼“å†² I/O ï¼šåˆ©ç”¨æ ‡å‡†åº“çš„ç¼“å­˜å®ç°æ–‡ä»¶åŠ é€Ÿè®¿é—®ï¼Œè€Œæ ‡å‡†åº“å†é€šè¿‡ç³»ç»Ÿè°ƒç”¨è®¿é—®æ–‡ä»¶ï¼›&lt;/p&gt;
&lt;p&gt;éç¼“å†² I/Oï¼šç›´æ¥é€šè¿‡ç³»ç»Ÿè°ƒç”¨è®¿é—®æ–‡ä»¶ï¼Œä¸ç»è¿‡æ ‡å‡†åº“ç¼“å­˜ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç›´æ¥ I/O ï¼šä¸ä½¿ç”¨å†…æ ¸ç¼“å­˜å’Œç”¨æˆ·ç¨‹åºä¹‹é—´çš„æ•°æ®å¤åˆ¶ï¼Œç›´æ¥ç»è¿‡æ–‡ä»¶ç³»ç»Ÿè®¿é—®ç£ç›˜æ–‡ä»¶ï¼›&lt;/p&gt;
&lt;p&gt;éç›´æ¥ I/Oï¼šè¯»æ“ä½œæ—¶ï¼Œæ•°æ®ä»å†…æ ¸ç¼“å­˜ä¸­æ‹·è´ç»™ç”¨æˆ·ç¨‹åºï¼Œå†™æ“ä½œæ—¶ï¼Œæ•°æ®ä»ç”¨æˆ·ç¨‹åºæ‹·è´ç»™å†…æ ¸ç¼“å­˜ï¼Œå†ç”±å†…æ ¸å†³å®šä»€ä¹ˆæ—¶å€™å†™å…¥æ•°æ®åˆ°ç£ç›˜ï¼›&lt;/p&gt;
&lt;p&gt;å†³å®šåˆ·ç›˜çš„æ—¶æœºï¼šå†…æ ¸å‘ç°ç¼“å­˜æ•°æ®å¤ªå¤šï¼›ç”¨æˆ·ä¸»åŠ¨è°ƒç”¨syncå‡½æ•°ï¼›å†…å­˜ä½¿ç”¨ç´§å¼ ï¼›å†…æ ¸ç¼“å­˜ç¼“å­˜æ—¶é—´è¶…è¿‡æŸä¸ªæ—¶é—´ç‚¹ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;é˜»å¡IOï¼šè¯»å–æ•°æ®æ—¶ï¼Œçº¿ç¨‹è¢«é˜»å¡ï¼Œç›´åˆ°å†…æ ¸æ•°æ®å‡†å¤‡å¥½ï¼Œå¹¶æŠŠæ•°æ®ä»å†…æ ¸ç¼“å†²åŒºæ‹·è´åˆ°åº”ç”¨ç¨‹åºç¼“å†²åŒºï¼Œæ‰èƒ½è¢«è¯»å–ï¼›&lt;/p&gt;
&lt;p&gt;é˜»å¡ç­‰å¾…æŒ‡çš„æ˜¯ **ã€Œå†…æ ¸æ•°æ®å‡†å¤‡å¥½ã€å’Œã€Œæ•°æ®ä»å†…æ ¸æ€æ‹·è´åˆ°ç”¨æˆ·æ€ã€**è¿™ä¸¤ä¸ªè¿‡ç¨‹&lt;/p&gt;
&lt;p&gt;éé˜»å¡IOï¼šè¯»å–æ•°æ®æ—¶ï¼Œå½“æ•°æ®æœªå‡†å¤‡å¥½ï¼Œå°±ç«‹å³è¿”å›ï¼Œç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼›å½“æ•°æ®å‡†å¤‡å¥½ï¼Œå†…æ ¸å°†æ•°æ®æ‹·è´åˆ°åº”ç”¨ç¨‹åºç¼“å†²åŒºï¼Œå°±èƒ½è¯»å–æ•°æ®ï¼Œæœ¬è´¨ä¸Šéƒ½è¦åŒæ­¥ç­‰å¾…ï¼Œåªæ˜¯éé˜»å¡IOä¸ä¼šä¸€ç›´ç­‰è€Œå·²ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;page-cache&#34;&gt;Page Cache&lt;/h2&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/PageCache.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/PageCache.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Page Cache çš„&lt;strong&gt;æœ¬è´¨æ˜¯ç”± Linux å†…æ ¸ç®¡ç†çš„å†…å­˜åŒºåŸŸ&lt;/strong&gt;ã€‚æˆ‘ä»¬é€šè¿‡ mmap ä»¥åŠ buffered I/O å°†æ–‡ä»¶è¯»å–åˆ°å†…å­˜ç©ºé—´å®é™…ä¸Šéƒ½æ˜¯è¯»å–åˆ° Page Cache ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;page æ˜¯å†…å­˜ç®¡ç†åˆ†é…çš„åŸºæœ¬å•ä½ï¼Œ Page Cache ç”±å¤šä¸ª page æ„æˆã€‚page åœ¨æ“ä½œç³»ç»Ÿä¸­é€šå¸¸ä¸º 4KB å¤§å°ï¼ˆ32bits/64bitsï¼‰ï¼Œè€Œ Page Cache çš„å¤§å°åˆ™ä¸º 4KB çš„æ•´æ•°å€ã€‚ä½†å¹¶ä¸æ˜¯æ‰€æœ‰ page éƒ½è¢«ç»„ç»‡ä¸º Page Cacheã€‚&lt;/p&gt;
&lt;p&gt;Page Cache ä¸ buffer cache çš„åŒºåˆ«ï¼š&lt;strong&gt;Page Cache ç”¨äºç¼“å­˜æ–‡ä»¶çš„é¡µæ•°æ®ï¼Œæ˜¯é’ˆå¯¹æ–‡ä»¶ç³»ç»Ÿçš„æ–‡ä»¶ç¼“å­˜ï¼Œå±äºé€»è¾‘å±‚ï¼Œæœ€ç»ˆéœ€è¦æ˜ å°„åˆ°å®é™…çš„ç‰©ç†ç£ç›˜ï¼›buffer cache ç”¨äºç¼“å­˜å—è®¾å¤‡ï¼ˆå¦‚ç£ç›˜ï¼‰çš„å—æ•°æ®ï¼Œä¹Ÿå°±æ˜¯åœ¨æ²¡æœ‰æ–‡ä»¶ç³»ç»Ÿçš„æƒ…å†µä¸‹ï¼Œç›´æ¥å¯¹ç£ç›˜è¿›è¡Œæ“ä½œçš„æ•°æ®çš„ç¼“å­˜ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é¡µæ˜¯é€»è¾‘ä¸Šçš„æ¦‚å¿µï¼Œå› æ­¤ Page Cache æ˜¯ä¸æ–‡ä»¶ç³»ç»ŸåŒçº§çš„ï¼›&lt;/li&gt;
&lt;li&gt;å—æ˜¯ç‰©ç†ä¸Šçš„æ¦‚å¿µï¼Œå› æ­¤ buffer cache æ˜¯ä¸å—è®¾å¤‡é©±åŠ¨ç¨‹åºåŒçº§çš„ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä»–ä»¬éƒ½æ˜¯ç”¨æ¥åŠ é€ŸIOï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å†™æ•°æ®æ—¶é¦–å…ˆå†™åˆ°ç¼“å­˜ï¼Œå°†å†™å…¥çš„é¡µæ ‡è®°ä¸º dirtyï¼Œç„¶åå‘å¤–éƒ¨å­˜å‚¨ flushï¼Œä¹Ÿå°±æ˜¯ç¼“å­˜å†™æœºåˆ¶ä¸­çš„ write-backï¼ˆå¦ä¸€ç§æ˜¯ write-throughï¼ŒLinux é»˜è®¤æƒ…å†µä¸‹ä¸é‡‡ç”¨ï¼‰ï¼›&lt;/li&gt;
&lt;li&gt;è¯»æ•°æ®æ—¶é¦–å…ˆè¯»å–ç¼“å­˜ï¼Œå¦‚æœæœªå‘½ä¸­ï¼Œå†å»å¤–éƒ¨å­˜å‚¨è¯»å–ï¼Œå¹¶ä¸”å°†è¯»å–æ¥çš„æ•°æ®ä¹ŸåŠ å…¥ç¼“å­˜ã€‚æ“ä½œç³»ç»Ÿæ€»æ˜¯ç§¯æåœ°å°†æ‰€æœ‰ç©ºé—²å†…å­˜éƒ½ç”¨ä½œ Page Cache å’Œ buffer cacheï¼Œå½“å†…å­˜ä¸å¤Ÿç”¨æ—¶ä¹Ÿä¼šç”¨ LRU ç­‰ç®—æ³•æ·˜æ±°ç¼“å­˜é¡µã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Linux 2.4 ç‰ˆæœ¬ä»¥å‰çš„å†…æ ¸ï¼Œè¿™ä¸¤è€…æ˜¯åˆ†å¼€çš„ï¼Œä½†å› ä¸ºå—è®¾å¤‡å¤§å¤šæ˜¯ç£ç›˜ï¼Œç£ç›˜ä¸Šçš„æ•°æ®åˆå¤§éƒ½é€šè¿‡æ–‡ä»¶ç³»ç»Ÿæ¥ç»„ç»‡ï¼Œå°±ä¼šå¯¼è‡´å¾ˆå¤šæ•°æ®è¢«ç¼“å­˜äº†ä¸¤æ¬¡ï¼Œæµªè´¹å†…å­˜ï¼Œæ‰€ä»¥2.4ä¹‹åçš„ç‰ˆæœ¬å°±èåˆåœ¨ä¸€èµ·ï¼Œå¦‚æœä¸€ä¸ªæ–‡ä»¶çš„é¡µåŠ è½½åˆ°äº†Page Cacheï¼Œé‚£ä¹ˆåŒæ—¶buffer cacheåªéœ€è¦ç»´æŠ¤æŒ‡å‘é¡µçš„æŒ‡é’ˆå³å¯ï¼Œåªæœ‰é‚£äº›æ²¡æœ‰æ–‡ä»¶è¡¨ç¤ºçš„å—ï¼Œæˆ–è€…ç»•è¿‡æ–‡ä»¶ç³»ç»Ÿç›´æ¥æ“ä½œçš„å—ï¼Œæ‰ä¼šçœŸæ­£æ”¾åˆ°buffer cacheé‡Œã€‚&lt;/p&gt;
&lt;p&gt;Page Cacheé¢„è¯»ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç”¨æˆ·çº¿ç¨‹ä»…ä»…è¯·æ±‚è¯»å–ç£ç›˜ä¸Šæ–‡ä»¶ A çš„ offset ä¸º 0-3KB èŒƒå›´å†…çš„æ•°æ®ï¼Œç”±äºç£ç›˜çš„åŸºæœ¬è¯»å†™å•ä½ä¸º blockï¼ˆ4KBï¼‰ï¼Œäºæ˜¯æ“ä½œç³»ç»Ÿè‡³å°‘ä¼šè¯» 0-4KB çš„å†…å®¹ï¼Œè¿™æ°å¥½å¯ä»¥åœ¨ä¸€ä¸ª page ä¸­è£…ä¸‹ã€‚&lt;/li&gt;
&lt;li&gt;ä½†æ˜¯æ“ä½œç³»ç»Ÿå‡ºäºå±€éƒ¨æ€§åŸç†ä¼šé€‰æ‹©å°†ç£ç›˜å— offset [4KB,8KB)ã€[8KB,12KB) ä»¥åŠ [12KB,16KB) éƒ½åŠ è½½åˆ°å†…å­˜ï¼Œäºæ˜¯é¢å¤–åœ¨å†…å­˜ä¸­ç”³è¯·äº† 3 ä¸ª pageï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å…³äºPage Cacheä¸æ–‡ä»¶æŒä¹…åŒ–ä¸€è‡´æ€§ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;Write Throughï¼ˆå†™ç©¿ï¼‰&lt;/strong&gt;ï¼šå‘ç”¨æˆ·å±‚æä¾›ç‰¹å®šæ¥å£ï¼Œåº”ç”¨ç¨‹åºå¯&lt;strong&gt;ä¸»åŠ¨&lt;/strong&gt;è°ƒç”¨æ¥å£æ¥ä¿è¯æ–‡ä»¶ä¸€è‡´æ€§ï¼›åªè¦ä¸Šå±‚ä¸€æ—¦è°ƒç”¨å†™å…¥ï¼Œæ•°æ®è½ç›˜ï¼Œå°±ä¸ä¼šä¸¢å¤±æ•°æ®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Write backï¼ˆå†™å›ï¼‰&lt;/strong&gt;ï¼šç³»ç»Ÿä¸­å­˜åœ¨&lt;strong&gt;å®šæœŸä»»åŠ¡&lt;/strong&gt;ï¼ˆè¡¨ç°å½¢å¼ä¸ºå†…æ ¸çº¿ç¨‹ï¼‰ï¼Œå‘¨æœŸæ€§åœ°åŒæ­¥æ–‡ä»¶ç³»ç»Ÿä¸­æ–‡ä»¶è„æ•°æ®å—ï¼Œè¿™æ˜¯é»˜è®¤çš„ Linux ä¸€è‡´æ€§æ–¹æ¡ˆï¼›å½“ç³»ç»Ÿå®•æœºæ—¶æ— æ³•ä¿è¯æ•°æ®è½ç›˜ï¼Œå°±ä¼šä¸¢å¤±æ•°æ®ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä¼˜åŠ¿ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åŠ å¿«æ•°æ®è¯»å–ï¼Œè¯»å–æ•°æ®æ—¶ï¼Œç›´æ¥è¯»å–å†…å­˜ä¸­çš„ç¼“å­˜ï¼Œä¸éœ€è¦é€šè¿‡ç£ç›˜IOã€‚&lt;/li&gt;
&lt;li&gt;å‡å°‘IOè®¿é—®æ¬¡æ•°ï¼Œæé«˜ç³»ç»Ÿç£ç›˜IOååé‡ï¼Œåˆ©ç”¨Page Cacheç¼“å­˜å’Œé¢„è¯»å¾—èƒ½åŠ›ï¼Œåˆå› ä¸ºç¨‹åºå¾€å¾€ç¬¦åˆå±€éƒ¨æ€§åŸç†ï¼Œä¸€æ¬¡IOå°†å¤šä¸ªpageè£…å…¥Page Cacheæ¥å‡å°‘ç£ç›˜IOæ¬¡æ•°ï¼Œæå‡ç£ç›˜IOååé‡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åŠ£åŠ¿ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Page Cacheéœ€è¦å ç”¨é¢å¤–ç‰©ç†å†…å­˜ç©ºé—´ï¼Œå¯èƒ½ä¼šå¯¼è‡´swapæ“ä½œï¼Œæœ€ç»ˆåè€Œå¯¼è‡´ç£ç›˜IOè´Ÿè½½ä¸Šå‡ã€‚&lt;/li&gt;
&lt;li&gt;Page Cacheåœ¨å†…æ ¸ï¼Œä½†æ˜¯å¯¹åº”ç”¨å±‚æ²¡æœ‰æä¾›å¾ˆå¥½å¾—ç®¡ç†APIï¼Œä½¿å¾—ä¸èƒ½å¾ˆå¥½è¿›è¡Œè‡ªå®šä¹‰ä¼˜åŒ–ï¼Œåªèƒ½åœ¨ç”¨æˆ·ç©ºé—´å®ç°è‡ªå·±çš„pageç®¡ç†ï¼Œåˆ©ç”¨ä¸åˆ°Page Cacgeã€‚&lt;/li&gt;
&lt;li&gt;åœ¨æŸäº›åœºæ™¯ä¸‹ï¼Œä¼šæ¯”Direct IOå¤šä¸€æ¬¡ç£ç›˜è¯»IOå’Œç£ç›˜å†™IOï¼ŒDirect IOå¯ä»¥ä½¿å¾—ç”¨æˆ·æ€è¯»å–æ–‡ä»¶ç›´æ¥ä¸ç£ç›˜äº¤äº’ï¼Œæ— éœ€ä½¿ç”¨Page Cacheå±‚ã€‚ï¼ˆæ¯”å¦‚åˆ©ç”¨DMAæŠ€æœ¯ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å½“è¿›ç¨‹ä½¿ç”¨ç¼“å†²IOå†™æ–‡ä»¶æ—¶ï¼Œå¦‚æœå†™åˆ°ä¸€åŠè¿›ç¨‹å´©æºƒï¼Œå·²å†™å…¥çš„æ•°æ®ä¸ä¼šä¸¢å¤±ï¼Œå› ä¸ºè°ƒç”¨ç³»ç»Ÿè°ƒç”¨å†™å…¥æ–‡ä»¶æ—¶ï¼Œå…ˆå†™åˆ°å†…æ ¸çš„Page Cacheï¼Œå¦‚æœè¿›ç¨‹å´©æºƒï¼Œæ–‡ä»¶æ•°æ®è¿˜ä¿ç•™åœ¨å†…æ ¸çš„Page Cacheä¸­ï¼Œå†…æ ¸ä¼šæ‰¾ä¸ªåˆé€‚çš„æ—¶æœºï¼Œå°†Page Cacheä¸­çš„æ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œä½†æ˜¯å¦‚æœæ˜¯Page Cacheé‡Œçš„æ–‡ä»¶æ•°æ®åœ¨æŒä¹…åŒ–åˆ°ç£ç›˜ä¹‹å‰ï¼Œç³»ç»Ÿå´©æºƒï¼Œ é‚£å°±æœ‰å¯èƒ½ä¸¢å¤±æ–‡ä»¶æ•°æ®äº†ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;å´©æºƒä¸ä¸€è‡´æ€§&#34;&gt;å´©æºƒä¸ä¸€è‡´æ€§&lt;/h2&gt;
&lt;p&gt;ä»¥ä¸€ä¸ªç®€å•æ–‡ä»¶ç³»ç»Ÿä¸ºä¾‹ï¼Œç®€å•æ–‡ä»¶ç³»ç»ŸåŒ…å«è¶…çº§å—ã€æ•°æ®ä½å›¾ã€inodeä½å›¾ã€inodeåŒºå—ã€æ•°æ®å—åŒºï¼Œä¸€æ¬¡å†™å…¥æ¶‰åŠåˆ°å¤šä¸ªIOï¼Œå½“å´©æºƒå‘ç”Ÿæ—¶ï¼Œå¯èƒ½æœ‰å¦‚ä¸‹åœºæ™¯äº§ç”Ÿä¸ä¸€è‡´ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åªæœ‰æ•°æ®å—å†™å…¥ç£ç›˜ï¼Œæ­¤æ—¶ç”±äºå…¶ä»–åŒºå—è¿˜æ²¡å†™å…¥ï¼Œæ‰€ä»¥ä¸ä¼šæœ‰ä»€ä¹ˆå½±å“ï¼›&lt;/li&gt;
&lt;li&gt;åªæœ‰æ›´æ–°åçš„inodeåŒºå—å†™å…¥ç£ç›˜ï¼Œæ­¤æ—¶ç”±äºæ•°æ®åŒºå—è¿˜æ²¡å†™å…¥ï¼ŒinodeæŒ‡é’ˆæŒ‡å‘çš„æ•°æ®åŒºå—å°±æœ‰é—®é¢˜ï¼›&lt;/li&gt;
&lt;li&gt;åªæœ‰æ›´æ–°åçš„æ•°æ®ä½å›¾å†™å…¥ç£ç›˜ï¼Œç”±äºæ²¡æœ‰inodeæŒ‡å‘æ•°æ®åŒºå—ï¼Œæ•°æ®ä½å›¾æŒ‡å‘çš„æ•°æ®åŒºå—æ°¸è¿œä¸ä¼šæœ‰äººä½¿ç”¨ï¼Œæ­¤æ—¶å¯¼è‡´ç©ºé—²ç©ºé—´æ³„éœ²ï¼›&lt;/li&gt;
&lt;li&gt;æ›´æ–°åinodeåŒºå—å’Œæ•°æ®ä½å›¾å†™å…¥ç£ç›˜ï¼Œä½†æ•°æ®åŒºå—æ²¡æœ‰å†™å…¥ç£ç›˜ï¼ŒinodeæŒ‡é’ˆæŒ‡å‘çš„æ•°æ®åŒºå—å°±æœ‰é—®é¢˜ï¼›&lt;/li&gt;
&lt;li&gt;æ›´æ–°åçš„inodeåŒºå—å’Œæ•°æ®å—å†™å…¥ç£ç›˜ï¼Œä½†æ•°æ®ä½å›¾æ²¡æœ‰å†™å…¥ç£ç›˜ï¼Œä¼šå¯¼è‡´æ•°æ®åŒºå—è¢«è¦†ç›–ï¼›&lt;/li&gt;
&lt;li&gt;æ›´æ–°åçš„æ•°æ®ä½å›¾å’Œæ•°æ®åŒºå—å†™å…¥ç£ç›˜ï¼Œä½†inodeåŒºå—æ²¡æœ‰å†™å…¥ç£ç›˜ï¼Œç”±äºæ²¡æœ‰inodeæŒ‡å‘æ•°æ®åŒºå—ï¼Œæ•°æ®ä½å›¾æŒ‡å‘çš„æ•°æ®åŒºå—æ°¸è¿œä¸ä¼šæœ‰äººä½¿ç”¨ï¼Œæ­¤æ—¶å¯¼è‡´ç©ºé—²ç©ºé—´æ³„éœ²ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å´©æºƒæ¢å¤ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;fsckï¼šæ–‡ä»¶ç³»ç»Ÿæ£€æŸ¥ç¨‹åºï¼Œå®ƒæ˜¯ä¸€æ¬¾å·¥å…·ï¼Œä¼šåœ¨æ–‡ä»¶ç³»ç»Ÿå†™å…¥æ•°æ®åˆ°ç£ç›˜çš„å¤šä¸ªé˜¶æ®µè¿è¡Œæ£€æŸ¥ï¼Œæ¯”å¦‚æ£€æŸ¥è¶…çº§å—ã€ç©ºé—²å—ã€inodeçŠ¶æ€ã€inodeé“¾æ¥ã€é‡å¤æŒ‡é’ˆï¼ˆä¸¤ä¸ªä¸å¤ªçš„inodeæŒ‡å‘åŒä¸€ä¸ªæ•°æ®å—ï¼‰ã€åå—ã€ç›®å½•æ£€æŸ¥ç­‰ï¼Œåˆ¤æ–­ä»–ä»¬æ˜¯å¦ä¸ä¸€è‡´ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™ä¼šè¿›è¡Œä¿®å¤ï¼›&lt;/p&gt;
&lt;p&gt;è¿™ç§æ–¹æ¡ˆè™½ç„¶èƒ½è¿›è¡Œå´©æºƒæ¢å¤ï¼Œä½†æ˜¯æ¯”è¾ƒåŸå§‹ï¼Œå®ç°ä¸Šä¹Ÿæ¯”è¾ƒå¤æ‚ï¼Œéœ€è¦çŸ¥é“æ–‡ä»¶ç³»ç»Ÿçš„åº•å±‚åŸç†ï¼Œè€Œä¸”æ¯æ¬¡æ£€æŸ¥éœ€è¦æ‰«ææ­£è§„ç£ç›˜ï¼Œé€Ÿåº¦å¤ªæ…¢ï¼Œç‰¹åˆ«æ˜¯å½“åªæœ‰å°‘æ•°å‡ ä¸ªæ•°æ®æœ‰é—®é¢˜æ—¶ï¼Œæ‰«ææ•´ä¸ªç›˜åªä¸ºä¿®å¤è¿™å‡ ä¸ªæ•°æ®ï¼Œä»£ä»·å°±ç‰¹åˆ«å¤§äº†ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ—¥å¿—ï¼šé€šè¿‡åœ¨å°†ç”¨æˆ·æ•°æ®å†™å…¥ç£ç›˜çš„æ—¶å€™ï¼Œå°†ç›¸å…³ä¿¡æ¯è®°å½•åˆ°æ—¥å¿—å¹¶åˆ·ç›˜ï¼Œä»¥å®ç°å´©æºƒåé€šè¿‡æ—¥å¿—ä¿¡æ¯è¿›è¡Œæ¢å¤ã€‚æ—¥å¿—éœ€è¦è®°å½•å‡ ä¸ªæ–¹é¢çš„å†…å®¹ï¼Œå¦‚äº‹åŠ¡å¼€å§‹æ ‡å¿—ã€inodeä¿¡æ¯ã€ä½å›¾ä¿¡æ¯ã€ç”¨æˆ·æ•°æ®ã€äº‹åŠ¡ç»“æŸæ ‡å¿—ï¼Œä½†æ˜¯ï¼Œæ—¥å¿—å†™å…¥ä¹Ÿæ˜¯è¦åˆ·ç›˜çš„ï¼Œæœ¬èº«ä¹Ÿå­˜åœ¨å´©æºƒå¯¼è‡´ä¸ä¸€è‡´çš„é—®é¢˜ï¼Œæ‰€ä»¥éœ€è¦ä¿è¯äº‹åŠ¡ç»“æŸå†™å…¥æ—¶ï¼Œå‰é¢å››ä¸ªä¿¡æ¯å·²ç»å†™å…¥å®Œæˆï¼ˆå®ƒä»¬ä¹‹é—´çš„é¡ºåºå¯ä»¥ä¸ç”¨ä¿è¯ï¼Œä½†ä¸€å®šè¦å‘ç”Ÿåœ¨äº‹åŠ¡ç»“æŸæ ‡å¿—å†™å…¥ä¹‹å‰å®Œæˆï¼‰ï¼Œå¯ä»¥åˆ©ç”¨ç£ç›˜æä¾›çš„åŸå­æ€§ä¿è¯ï¼ˆç£ç›˜ä¼šä»¥ä¸€å®šå—çš„å¤§å°ä¸€èµ·å†™å…¥ï¼Œæ¯”å¦‚æ¯æ¬¡å†™å…¥512å­—èŠ‚çš„å—ï¼‰ï¼Œä¸ºæ­¤æœ‰ä¸¤ç§æ—¥å¿—æ–¹æ¡ˆï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;æ•°æ®æ—¥å¿—ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ—¥å¿—å†™å…¥ï¼šå°†äº‹åŠ¡å†…å®¹ï¼ˆäº‹åŠ¡å¼€å§‹æ ‡å¿—ã€inodeä¿¡æ¯ã€ä½å›¾ä¿¡æ¯ã€ç”¨æˆ·æ•°æ®ï¼‰å†™å…¥æ—¥å¿—ï¼Œç­‰å¾…å†™å…¥å®Œæˆï¼›&lt;/li&gt;
&lt;li&gt;æ—¥å¿—æäº¤ï¼šå°†äº‹åŠ¡ç»“æŸæ ‡å¿—å†™å…¥æ—¥å¿—ï¼Œç­‰å¾…å†™å…¥å®Œæˆï¼Œæ­¤æ—¶äº‹åŠ¡è¢«è®¤ä¸ºå·²æäº¤ï¼›&lt;/li&gt;
&lt;li&gt;åŠ æ£€æŸ¥ç‚¹ï¼šæ­¤æ—¶å¯ä»¥æŠŠç”¨æˆ·ç›¸å…³çš„å…ƒæ•°æ®å’Œç”¨æˆ·æ•°æ®å†™å…¥æœ€ç»ˆçš„ç£ç›˜ä½ç½®ï¼›&lt;/li&gt;
&lt;li&gt;é‡Šæ”¾å‡ºç©ºé—²ç©ºé—´ï¼šé€šè¿‡æ›´æ–°æ—¥å¿—ä¸­çš„è¶…çº§å—ï¼Œåœ¨æ—¥å¿—ä¸­æ ‡è®°è¯¥äº‹åŠ¡ä¸ºç©ºé—²ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å´©æºƒæ¢å¤æ—¶ï¼Œå°±å¯ä»¥æ‰«ææ—¥å¿—ï¼Œæ¢å¤åŠ æ£€æŸ¥ç‚¹ä¹‹å‰çš„æ•°æ®äº†ï¼Œå°†æ‰«æçš„æ—¥å¿—æŒ‰é¡ºåºé‡æ”¾ï¼Œæ–‡ä»¶ç³»ç»Ÿå°è¯•å°†äº‹åŠ¡ä¸­çš„å—å†™å…¥å®ƒä»¬æœ€ç»ˆçš„ç£ç›˜ä½ç½®ï¼ˆå› ä¸ºæ—¥å¿—æœ¬èº«å·²ç»åŒ…å«äº†ç”¨æˆ·æ•°æ®äº†ï¼‰&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å…ƒæ•°æ®æ—¥å¿—ï¼šæ•°æ®æ—¥å¿—ä¸­ï¼Œè¿˜è¦è®°å½•ç”¨æˆ·æ•°æ®ï¼Œä½†æ£€æŸ¥ç‚¹ä¹‹åï¼Œç”¨æˆ·æ•°æ®åˆ·ç›˜ï¼Œç”¨æˆ·æ•°æ®åˆå­˜å…¥äº†ä¸€æ¬¡ï¼Œå¯¼è‡´é¢å¤–ç©ºé—´æµªè´¹å’Œå¼€é”€åšå‡ºçš„æ”¹è¿›ï¼Œé€šè¿‡åªè°ƒæ•´æ—¥å¿—å†™å…¥é¡ºåºï¼Œåªå†™å…¥ä¸€æ¬¡ç”¨æˆ·æ•°æ®å®ç°ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ç”¨æˆ·æ•°æ®å†™å…¥ï¼šå°†ç”¨æˆ·æ•°æ®å†™å…¥æœ€ç»ˆä½ç½®ï¼Œç­‰å¾…å®Œæˆï¼›&lt;/li&gt;
&lt;li&gt;æ—¥å¿—å…ƒæ•°æ®å†™å…¥ï¼šå°†äº‹åŠ¡å¼€å§‹æ ‡å¿—å’Œå…ƒæ•°æ®å†™å…¥æ—¥å¿—ï¼Œç­‰å¾…å†™å…¥å®Œæˆï¼›&lt;/li&gt;
&lt;li&gt;æ—¥å¿—æäº¤ï¼šå°†äº‹åŠ¡ç»“æŸæ ‡å¿—å†™å…¥æ—¥å¿—ï¼Œç­‰å¾…å†™å…¥å®Œæˆï¼Œæ­¤æ—¶äº‹åŠ¡è¢«è®¤ä¸ºå·²æäº¤ï¼Œå…¶å®åªè¦ä¿è¯1å’Œ2ä¸¤ä¸ªæ­¥éª¤åœ¨3ä¹‹å‰å®Œæˆå³å¯ï¼›&lt;/li&gt;
&lt;li&gt;åŠ æ£€æŸ¥ç‚¹å…ƒæ•°æ®ï¼šå°†å…ƒæ•°æ®æ›´æ–°çš„å†…å®¹å†™å…¥æ–‡ä»¶ç³»ç»Ÿæœ€ç»ˆä½ç½®ï¼›&lt;/li&gt;
&lt;li&gt;é‡Šæ”¾å‡ºç©ºé—²ç©ºé—´ï¼šæ›´æ–°æ—¥å¿—ä¸­çš„è¶…çº§å—ï¼Œåœ¨æ—¥å¿—ä¸­æ ‡è®°è¯¥äº‹åŠ¡ä¸ºç©ºé—²ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;è¿™ç§æ–¹æ¡ˆæœ‰ä¸ªé—®é¢˜å°±æ˜¯æ•°æ®å—åŒºçš„å¤ç”¨ï¼Œå‡å¦‚å…ˆæœ‰äº‹åŠ¡å’Œç”¨æˆ·æ•°æ®æ–‡ä»¶å†™å…¥åŒä¸€ç›®å½•ï¼Œç„¶ååˆåˆ é™¤ï¼Œåˆåˆ›å»ºäº†ä¸€ä¸ªæ–°æ–‡ä»¶ï¼Œæ–°æ–‡ä»¶å¯èƒ½å¤ç”¨äº†ä¹‹å‰ç›®å½•ä¸Šçš„å…¶ä»–æ–‡ä»¶ç›¸åŒçš„å—ï¼ˆå—å·ä¸€æ ·ï¼Œä½†æ—§æ•°æ®å¯èƒ½è¿˜æ²¡è¢«åˆ é™¤ï¼‰ï¼Œç”±äºæ˜¯å…ƒæ•°æ®æ—¥å¿—ï¼Œåªè®°å½•æ–°æ–‡ä»¶çš„å…ƒæ•°æ®ï¼Œå½“å‘ç”Ÿå´©æºƒæ¢å¤æ—¶ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ–°æ–‡ä»¶å…ƒæ•°æ®æŒ‡å‘æ—§æ–‡ä»¶æ•°æ®åŒºå—ï¼Œæ‰€ä»¥ï¼Œåœ¨åˆ é™¤æ“ä½œå‘ç”Ÿåï¼Œå…ƒæ•°æ®æ—¥å¿—ä¹Ÿéœ€è¦å°†åˆ é™¤å¯¼è‡´çš„æ’¤é”€è®°å½•ä¹Ÿå†™å…¥åˆ°æ—¥å¿—ï¼Œé¿å…è¿™ç§é—®é¢˜çš„å‘ç”Ÿï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ—¥å¿—è®°å½•ä¼˜åŒ–ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ‰¹å¤„ç†ï¼šå†™æ—¥å¿—æ—¶ï¼Œä¸ä¼šä¸€æ¬¡ä¸€ä¸ªå‘ç£ç›˜æäº¤æ¯ä¸ªæ›´æ–°ï¼Œè€Œæ˜¯å…ˆå†™è¿›ç¼“å­˜ï¼Œæ”’ä¸€å®šçš„é‡ï¼Œå®šæ—¶æäº¤åˆ·ç›˜ï¼Œä»è€Œé¿å…å¯¹ç£ç›˜å†™å…¥è¿‡å¤šæµé‡ï¼›&lt;/li&gt;
&lt;li&gt;è½®è½¬æ—¥å¿—ï¼Œé¿å…æ—¥å¿—æ–‡ä»¶å¤§å°è†¨èƒ€ï¼Œå¯¼è‡´å´©æºƒæ¢å¤æ—¶æ—¶é—´å˜é•¿ï¼Œä¹Ÿæå‡ç£ç›˜åˆ©ç”¨ç‡ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œä¸€æ—¦äº‹åŠ¡è¢«åŠ æ£€æŸ¥ç‚¹ï¼Œæ£€æŸ¥ç‚¹ä¹‹å‰çš„æ—¥å¿—å°±å…è®¸è¢«è½®è½¬äº†ï¼Œæ­¤æ—¶åœ¨æ—¥å¿—çš„è¶…çº§å—ä¸­æ ‡è®°æ—¥å¿—çš„æœ€æ–°å’Œæœ€æ—§äº‹åŠ¡ç”¨äºåŒºåˆ†å³å¯ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¯¹æ–‡ä»¶ç³»ç»Ÿçš„æ‰€æœ‰å†™å…¥è¿›è¡Œæ’åºï¼Œç¡®ä¿ç£ç›˜ä¸Šçš„ç»“æ„æ°¸è¿œä¸ä¼šå¤„äºä¸ä¸€è‡´çš„çŠ¶æ€ï¼Œæ¯”å¦‚å…ˆå†™å…¥æ•°æ®åŒºå—ï¼Œå†å†™å…¥å¯¹åº”çš„inodeåŒºå—ï¼Œç¡®ä¿inodeæ°¸è¿œä¸ä¼šæŒ‡å‘é”™è¯¯ç­‰è¿™æ ·çš„è§„åˆ™ï¼Œä½†æ˜¯å®ç°ä¸Šä¼šæ¯”è¾ƒå¤æ‚ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å†™æ—¶å¤åˆ¶Copy on Writeï¼Œæ¯”å¦‚æ—¥å¿—æ–‡ä»¶ç³»ç»Ÿçš„å®ç°ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åå‘æŒ‡é’ˆï¼šå†™å…¥ä¹‹é—´ä¸å¼ºåˆ¶æ‰§è¡Œæ’åºï¼Œä½†æ˜¯å†™å…¥çš„æ•°æ®å—éƒ½è¦å¼•ç”¨å®ƒæ‰€å±çš„inodeï¼Œè®¿é—®æ–‡ä»¶æ—¶ï¼Œæ–‡ä»¶ç³»ç»Ÿå¯ä»¥æ£€æŸ¥æ­£å‘æŒ‡é’ˆæ˜¯å¦æŒ‡å‘å¼•ç”¨å®ƒçš„å—ï¼Œä»è€Œç¡®å®šæ–‡ä»¶æ˜¯å¦ä¸€è‡´ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ—¥å¿— + ä¹è§‚å´©æºƒä¸€è‡´æ€§ï¼šå°½å¯èƒ½å¤šåœ°å‘ç£ç›˜å‘å‡ºå†™å…¥ï¼Œäº‹åŠ¡å†™å…¥æ—¥å¿—æ—¶ï¼Œåœ¨å¼€å§‹å’Œç»“æŸå—ä¸­åŒ…å«æ—¥å¿—å†…å®¹çš„æ ¡éªŒå’Œï¼Œä½¿å¾—æ–‡ä»¶ç³»ç»Ÿå¯ä»¥ç«‹å³å†™å…¥æ•´ä¸ªäº‹åŠ¡ï¼Œè€Œä¸ç”¨äº§ç”Ÿç­‰å¾…ï¼Œå´©æºƒæ¢å¤æœŸé—´ï¼Œåˆ©ç”¨äº‹åŠ¡æ ¡éªŒå’Œï¼Œæ£€æµ‹æ–‡ä»¶æ˜¯å¦ä¸€è‡´ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;æ—¥å¿—æ–‡ä»¶ç³»ç»Ÿçš„å®ç°&#34;&gt;æ—¥å¿—æ–‡ä»¶ç³»ç»Ÿçš„å®ç°&lt;/h2&gt;
&lt;p&gt;æ—¥å¿—æ–‡ä»¶ç³»ç»Ÿçš„è¯ç”ŸåŸºäºä»¥ä¸‹å‡ ä¸ªåŸå› ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å†…å­˜å¤§å°ä¸æ–­å¢é•¿ï¼Œå¯ç”¨ç¼“å­˜å˜å¤§ï¼Œç£ç›˜æµé‡æ›´å¤šçš„ç”±å†™å…¥æ“ä½œç»„æˆï¼Œç£ç›˜çš„æ€§èƒ½ç“¶é¢ˆå–å†³äºå†™æ€§èƒ½ï¼›&lt;/li&gt;
&lt;li&gt;è¯»æ—¶å‘ç”ŸéšæœºIOæ— æ³•é¿å…ï¼Œä½†å†™å…¥æ—¶éšæœºIOæ€§èƒ½æ¯”é¡ºåºIOæ€§èƒ½å·®å¤ªå¤šï¼›&lt;/li&gt;
&lt;li&gt;å¦‚æœä½¿ç”¨ä¹‹å‰çš„ä½å›¾ã€inodeåŒºå—ã€æ•°æ®åŒºå—è¿™ç§ç»„æˆï¼Œä¼šå¯¼è‡´ç£ç›˜å‡ºç°å¾ˆå¤šçŸ­å¯»é“å’Œæ—‹è½¬å»¶è¿Ÿï¼Œæ€§èƒ½è¿œä½äºå³°å€¼é¡ºåºå¸¦å®½ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åŸºäºè¿™å‡ ä¸ªåŸå› ï¼Œå¼•å…¥æ—¥å¿—æ–‡ä»¶ç³»ç»Ÿï¼Œç®€å•æ¥è¯´ï¼Œå°±æ˜¯å†™å…¥ç£ç›˜æ—¶ï¼Œé¦–å…ˆå°†æ‰€æœ‰æ›´æ–°ï¼ˆåŒ…æ‹¬å…ƒæ•°æ®ï¼‰ç¼“å­˜åœ¨å†…å­˜æ®µä¸­ï¼Œå½“æ®µæ»¡æ—¶ï¼Œé¡ºåºå†™å…¥ç£ç›˜ï¼Œå¹¶ä¼ è¾“åˆ°ç£ç›˜æœªä½¿ç”¨éƒ¨åˆ†ï¼Œæ—¥å¿—æ–‡ä»¶ç³»ç»Ÿæ°¸è¿œä¸ä¼šè¦†å†™ç°æœ‰æ•°æ®ï¼Œè€Œæ˜¯å§‹ç»ˆå°†æ®µå†™å…¥ç©ºé—²çš„ä½ç½®ï¼Œç”±äºæ®µæ¯”è¾ƒå¤§ï¼Œä½¿å¾—å†™å…¥æ€§èƒ½æ¥è¿‘å³°å€¼ï¼›&lt;/p&gt;
&lt;p&gt;æ–‡ä»¶å†™å…¥ç£ç›˜ä¹‹å‰ï¼Œé¦–å…ˆä¼šå†™å…¥å†…å­˜ï¼Œå†™å…¥çš„å†…å®¹åŒ…æ‹¬ç”¨æˆ·æ•°æ®ã€inodeã€åœ°å€å¼•ç”¨ç­‰å…ƒæ•°æ®ï¼Œä¸æ–­çš„ç´¯ç§¯å†™å…¥çš„å—ï¼Œç›´åˆ°ç¼“å­˜å¤§å°è¾¾åˆ°è§„å®šçš„æ®µå¤§å°æ—¶ï¼Œå°†è¯¥æ®µä¸€æ¬¡æ€§å†™å…¥ç£ç›˜ï¼ˆå½“æœ‰å¤šæ¬¡å†™å…¥æ—¶é€šå¸¸æ˜¯å…ˆæ’ç”¨æˆ·æ•°æ®ã€å†æ’å…ƒæ•°æ®çš„é¡ºåºå†™å…¥ï¼‰ï¼Œæ®µçš„å¤§å°è·Ÿç£ç›˜çš„ä¼ è¾“é€Ÿç‡å’Œå®šä½å¼€é”€æœ‰å…³ï¼Œè®¡ç®—å‡ºä¸€ä¸ªè¶Šæ¥è¿‘å³°å€¼å¸¦å®½çš„å†™å…¥å¤§å°ï¼›&lt;/p&gt;
&lt;p&gt;ç”±äºè¿™ç§å†™å…¥ä¼šå¯¼è‡´inodeåˆ†æ•£å†æ•´ä¸ªç£ç›˜ä¸Šï¼ˆä¸åƒä¸Šé¢çš„æ ¼å¼ï¼Œinodeå­˜å‚¨åœ¨å›ºå®šä½ç½®ï¼Œå¯ä»¥æ¯”è¾ƒç®€å•ç®—å‡ºæ•°æ®çš„ç£ç›˜åœ°å€ï¼‰ï¼Œæ‰€ä»¥é™¤äº†å¿…è¦çš„å…ƒæ•°æ®ä»¥å¤–ï¼Œè¿˜éœ€è¦è®°å½•ä¸€ä¸ªimapï¼Œç”¨äºæ ¹æ®ç»™å®šçš„i-numberå·æ‰¾åˆ°å¯¹åº”çš„inodeï¼Œä»è€Œæ‰¾åˆ°å¯¹åº”çš„ç£ç›˜åœ°å€ï¼›imapå°±å†™åœ¨ç›¸å…³inodeå…ƒæ•°æ®çš„æ—è¾¹ï¼ˆä¸èƒ½å†™åœ¨å›ºå®šä½ç½®ï¼Œå› ä¸ºæ¯æ¬¡å†™å…¥éƒ½è¦æ›´æ–°ï¼Œå¦‚æœå­˜åœ¨å›ºå®šä½ç½®ï¼Œå°±åˆè¦æœ‰æ—‹è½¬å¯»é“å¸¦æ¥çš„æ¶ˆè€—äº†ï¼‰ï¼›&lt;/p&gt;
&lt;p&gt;è€Œä¸ºäº†å¿«é€Ÿæ‰¾åˆ°imapå’Œinodeï¼Œåˆ™ä¼šåœ¨å›ºå®šçš„ä½ç½®ï¼ˆæ£€æŸ¥ç‚¹åŒºåŸŸï¼Œå­˜åœ¨åœ¨ç£ç›˜çš„å¤´éƒ¨å’Œå°¾éƒ¨ä¸¤ä¸ªåœ°æ–¹ï¼Œå†™å…¥æ—¶æ˜¯äº¤æ›¿å†™å…¥ï¼‰å­˜å‚¨inodeèŒƒå›´æ˜ å°„ï¼Œç”¨äºå¿«é€Ÿæ‰¾åˆ°inodeæ‰€åœ¨çš„ç£ç›˜çš„æ˜ å°„ç‰‡æ®µï¼Œæ£€æŸ¥ç‚¹åŒºåŸŸä»…å®šæœŸæ›´æ–°ï¼ˆæ¯”å¦‚æ¯30sï¼‰ï¼Œå› æ­¤æ€§èƒ½ä¸ä¼šå¤ªå—å½±å“ï¼›&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥åœ¨å¹³æ—¶ï¼Œä¼šå…ˆæŸ¥è¯¢æ£€æŸ¥ç‚¹åŒºåŸŸï¼Œå°†æ•´ä¸ªinodeæ˜ å°„ç‰‡æ®µåŠ è½½è¿›ç¼“å­˜ï¼Œå½“å‘ç”Ÿè¯»å–æ“ä½œæ—¶ï¼Œæ ¹æ®i-numberåœ¨ç¼“å­˜é‡ŒæŸ¥æ‰¾inodeæ˜ å°„ç‰‡æ®µï¼Œç£ç›˜é€‰æ‹©åˆ°å¯¹åº”ç‰‡æ®µï¼Œæ ¹æ®i-numberåœ¨imapæ‰¾åˆ°inodeï¼Œæ ¹æ®inodeæ‰¾åˆ°ç”¨æˆ·æ•°æ®çš„ç£ç›˜åœ°å€ï¼Œå¼€å§‹è¯»å–æ–‡ä»¶æ•°æ®ï¼Œç”šè‡³å¯ä»¥ç›´æ¥ç¼“å­˜æ‰€æœ‰imapï¼Œå¿«é€ŸæŸ¥æ‰¾ï¼›&lt;/p&gt;
&lt;p&gt;ç”±äºæ—¥å¿—æ–‡ä»¶ç³»ç»Ÿçš„ç‰¹æ€§ï¼Œæ•°æ®æ€»æ˜¯é¡ºåºå†™å…¥ï¼Œä¸ä¼šè¦†å†™ç°æœ‰æ•°æ®ï¼Œæ‰€ä»¥å¯èƒ½å­˜åœ¨åŒä¸€ä¸ªinodeæŒ‡å‘ä¸¤ä¸ªç”¨æˆ·æ•°æ®å—ï¼Œæ­¤æ—¶å°±æœ‰æ–°æ—§ä¸¤ä¸ªç”¨æˆ·æ•°æ®å—äº†ï¼Œå¯¹äºç”¨æˆ·æ•°æ®å—çš„å†™å…¥ä¼šäº§ç”Ÿç‰ˆæœ¬å·ï¼Œæ‰€ä»¥åœ¨è¿™ç§å¸¸è§ä¸‹ï¼Œå¯ä»¥æ ¹æ®ç‰ˆæœ¬å·è¿›è¡ŒåŒºåˆ†ï¼ŒåŒæ—¶ä¹Ÿæ–¹ä¾¿åˆ é™¤æ¢å¤ï¼Œå¯¹äºæ—§çš„ç”¨æˆ·æ•°æ®å—ï¼Œæ—¥å¿—æ–‡ä»¶ç³»ç»Ÿä¼šæœ‰å®šæ—¶ä»»åŠ¡ï¼Œå®šæ—¶æ¸…ç†è¿™äº›æ—§æ•°æ®ï¼Œæ¸…ç†æ—¶ä¼šæŒ‰æ®µæ¸…ç†ï¼Œå°†é‡Œé¢å­˜æ´»çš„æ•°æ®å—æ‰“åŒ…ç§»åŠ¨åˆ°æ–°ä½ç½®ï¼Œéå­˜æ´»çš„æ•°æ®å—åˆ™é‡Šæ”¾ï¼Œæ¢å¤æˆç©ºé—²ç©ºé—´ï¼›ï¼ˆcopy on writeï¼‰&lt;/p&gt;
&lt;p&gt;å¯¹äºå´©æºƒæ¢å¤ï¼Œæ—¥å¿—æ–‡ä»¶ç³»ç»Ÿæœ¬èº«ä¹Ÿéœ€è¦å†™å…¥æ—¥å¿—æ¥å®ç°å´©æºƒæ¢å¤ï¼ŒåŸç†æ˜¯åˆ©ç”¨å¤´å°¾ä¸¤ä¸ªæ£€æŸ¥ç‚¹åŒºåŸŸï¼Œå¹¶åœ¨æ¯ä¸ªæ®µå†™å…¥æ—¶æŒ‡å‘è¦å†™å…¥çš„ä¸‹ä¸€ä¸ªæ®µï¼Œä¸ºäº†ä¿è¯æ›´æ–°æ£€æŸ¥ç‚¹ä»¥åŸå­çš„æ–¹å¼ï¼Œæ¯æ¬¡å†™å…¥æ—¶ï¼Œäº¤æ›¿å†™å…¥å¤´å°¾ä¸¤ä¸ªæ£€æŸ¥ç‚¹åŒºåŸŸï¼Œå¹¶å¸¦ä¸Šæ—¶é—´æˆ³ï¼Œå½“å´©æºƒæ¢å¤æ—¶ï¼Œæ¯”è¾ƒå¤´å°¾ä¸¤ä¸ªæ£€æŸ¥ç‚¹åŒºåŸŸçš„å†…å®¹æ˜¯å¦ä¸€è‡´ï¼Œæ¥åˆ¤æ–­æ£€æŸ¥ç‚¹åŒºåŸŸçš„ä¸€è‡´æ€§ï¼›å¯¹äºå†™å…¥æ•°æ®æ—¶çš„åŸå­æ€§ï¼Œç”±äºæ£€æŸ¥ç‚¹æ˜¯å®šæ—¶æ›´æ–°ï¼Œå¦‚æœé—´éš”æ—¶é—´å¤ªä¹…ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä¸¢å¤±å¤ªå¤šæ•°æ®ï¼Œå› æ­¤ä½¿ç”¨å‰æ»šæŠ€æœ¯ï¼ŒåŸºæœ¬æ€æƒ³æ˜¯ä»æœ€åä¸€ä¸ªæ£€æŸ¥ç‚¹åŒºåŸŸå¼€å§‹ï¼Œæ‰¾åˆ°æ—¥å¿—å°¾éƒ¨çš„æ£€æŸ¥ç‚¹åŒºåŸŸï¼Œè¯»å–å®ƒçš„ä¸‹ä¸€æ®µï¼Œåˆ¤æ–­å…¶ä¸­æ˜¯å¦åŒ…å«ä»»ä½•æœ‰æ•ˆçš„æ›´æ–°ï¼Œå¦‚æœæœ‰ï¼Œåˆ™æ¢å¤æ¥å½“å‰æ£€æŸ¥ç‚¹ä»¥æ¥å†™å…¥çš„æ•°æ®å’Œå…ƒæ•°æ®ï¼›&lt;/p&gt;
&lt;h2 id=&#34;å…³äºæ•°æ®å®Œæ•´æ€§&#34;&gt;å…³äºæ•°æ®å®Œæ•´æ€§&lt;/h2&gt;
&lt;p&gt;æ•°æ®å­˜å‚¨åœ¨ç£ç›˜ä¸­ï¼Œå¯èƒ½ä¼šå› ä¸ºç£å¤´ç¢°æ’ã€ç£å¤´æ²¡æ¥è§¦åˆ°ç£ç›˜ç­‰é—®é¢˜ï¼Œå¯¼è‡´æ•°æ®ä½ä¸å¯è¯»ï¼›å®‡å®™å°„çº¿ç­‰ä½¿å¾—æ•°æ®ä½ç¿»è½¬ï¼Œå¯¼è‡´å„è‡ªå†…å®¹ä¸æ­£ç¡®ï¼›å› ä¸ºç£ç›˜å›ºä»¶é—®é¢˜ï¼Œå¯¼è‡´æ•°æ®å†™å…¥é”™è¯¯çš„ä½ç½®ç­‰é—®é¢˜&lt;/p&gt;
&lt;p&gt;ä¸€èˆ¬ä½¿ç”¨æ ¡éªŒå’Œçš„æ–¹å¼è¿›è¡ŒéªŒè¯ï¼Œå°†æ ¡éªŒå’Œä¸æ•°æ®å—ä¸€èµ·å­˜åˆ°ç£ç›˜ä¸­ï¼Œä»ç£ç›˜è·å–æ•°æ®æ—¶ï¼Œè®¡ç®—å‡ºæ‘˜è¦ï¼Œä¸å­˜å‚¨çš„æ ¡éªŒå’Œè¿›è¡Œæ¯”è¾ƒï¼Œä»è€Œåˆ¤æ–­æ•°æ®çš„å®Œæ•´æ€§ï¼Œå¸¸è§çš„æ ¡éªŒå’Œå‡½æ•°ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¼‚æˆ–æ–¹æ¡ˆï¼šæ¯”å¦‚å¯¹ä¸€ä¸ªæ•°æ®å—æ¯4ä¸ªå­—èŠ‚è¿›è¡Œå¼‚æˆ–ï¼Œæœ€ç»ˆå¾—åˆ°ä¸€ä¸ªå€¼ä½œä¸ºè¿™å—æ•°æ®çš„æ ¡éªŒå’Œï¼›&lt;/li&gt;
&lt;li&gt;ç´¯åŠ æ–¹æ¡ˆï¼šè®¡ç®—æ¯ä¸ªæ•°æ®å—ä¸ŠæŒ‡å‘äºŒè¿›åˆ¶è¡¥ç åŠ æ³•ï¼Œå¿½ç•¥æº¢å‡ºï¼Œè®¡ç®—å‡ºæ ¡éªŒå’Œï¼›&lt;/li&gt;
&lt;li&gt;CRCå¾ªç¯å†—ä½™æ£€æµ‹ï¼Œä¹Ÿç”¨äºç½‘ç»œä¼ è¾“çš„æ•°æ®æ ¡éªŒï¼šå°†æ•°æ®çš„äºŒè¿›åˆ¶æ•°é™¤äºå¤šé¡¹å¼çš„äºŒè¿›åˆ¶æ•°å¾—åˆ°ä¸€ä¸ªä½™æ•°ï¼Œè¿™ä¸ªä½™æ•°å°±æ˜¯CRCæ ¡éªŒç ï¼›æ¯”å¦‚ç»™å®šæ•°æ®çš„äºŒè¿›åˆ¶æ•°ä¸º&lt;code&gt;10110011&lt;/code&gt;ï¼Œå¤šé¡¹å¼ä¸º &lt;code&gt;G(x)=x^4+x^3+1&lt;/code&gt;ï¼ˆå¤šé¡¹å¼ä¸ºåŒæ–¹äº‹å…ˆçº¦å®šçš„ï¼‰ï¼Œå¤šé¡¹å¼å¯¹åº”çš„äºŒè¿›åˆ¶æ•°æ˜¯ &lt;code&gt;10000+1000+1=11001&lt;/code&gt;ï¼Œä¸¤è€…ç›¸é™¤ï¼Œå–ä½™æ•°ï¼Œè¿™é‡Œæ˜¯å–4ä½ï¼Œå¾—åˆ°0100ï¼Œå³ä¸ºCRCæ•ˆéªŒç ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¯¹äºæ•°æ®å†™é”™ä½ç½®çš„ï¼Œåˆ™å¯ä»¥åœ¨æ•°æ®å†™å…¥æ—¶ï¼Œä¹ŸæŠŠä½ç½®ä¿¡æ¯ä¹Ÿå†™å…¥æ ¡éªŒå’Œä¸­ï¼Œè¯»å–æ—¶ï¼Œå°†è¯»å–ä½ç½®å‚ä¸åˆ°æ‘˜è¦è®¡ç®—ä¸­ï¼Œå¯¹æ¯”æ ¡éªŒå’Œï¼Œä»è€ŒçŸ¥é“è¯»å–çš„æ•°æ®çš„æ­£ç¡®æ€§ï¼›&lt;/p&gt;
&lt;p&gt;å¯¹äºä¸¢å¤±å†™å…¥ï¼Œç»å…¸çš„æ–¹æ³•æ˜¯å†™å…¥åç«‹å³è¯»å–ï¼Œå°±èƒ½åˆ¤æ–­ï¼Œä½†æ˜¯è¿™ç§æ–¹æ¡ˆéå¸¸æ…¢ï¼Œè¿˜ä¼´éšåŒå€çš„IOï¼Œæˆæœ¬å·¨å¤§ï¼›å…¶ä»–æ–¹æ¡ˆçš„ï¼Œæ¯”å¦‚åœ¨æ–‡ä»¶ç³»ç»Ÿçš„æ¯ä¸ªinodeå’Œé—´æ¥å—ä¸­ï¼ŒåŒ…å«æ–‡ä»¶æ¯ä¸ªå—çš„æ ¡éªŒå’Œï¼Œè¿™æ ·å³ä½¿å¯¹æ•°æ®å—æœ¬èº«çš„å†™å…¥ä¸¢å¤±ï¼Œinodeå†…çš„æ ¡éªŒå’Œä¹Ÿä¸ä¼šå’Œæ—§æ•°æ®åŒ¹é…ï¼Œä½†ä¹Ÿä»ç„¶å­˜åœ¨ä¸¤è€…åŒæ—¶ä¸¢å¤±çš„æƒ…å†µï¼›&lt;/p&gt;
&lt;h1 id=&#34;ç½‘ç»œ&#34;&gt;ç½‘ç»œ&lt;/h1&gt;
&lt;p&gt;åœ¨Linuxä¸­ï¼Œæ›¿ä»£ä¼ è¾“å±‚ä»¥ä¸Šåè®®å®ä½“çš„æ ‡å‡†æ¥å£ï¼Œç§°ä¸ºå¥—æ¥å­—ï¼Œè´Ÿè´£å®ç°ä¼ è¾“å±‚ä»¥ä¸Šçš„æ‰€æœ‰åŠŸèƒ½ï¼Œå³å¥—æ¥å­—æ˜¯ä¸€å¥—é€šç”¨çš„ç½‘ç»œAPIï¼Œä¸‹å±‚ç”±å¤šä¸ªåè®®æ ˆå®ç°ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç½‘ç»œioæ¨¡å‹&#34;&gt;ç½‘ç»œIOæ¨¡å‹&lt;/h2&gt;
&lt;p&gt;I / Oæ“ä½œé€šå¸¸åŒ…å«ä»¥ä¸‹ä¸¤ä¸ªæ­¥éª¤ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;ç­‰å¾…ç½‘ç»œæ•°æ®åˆ°è¾¾ç½‘å¡(è¯»å°±ç»ª) / ç­‰å¾…ç½‘å¡å¯å†™(å†™å°±ç»ª) â€“&amp;gt; è¯»å–/å†™å…¥åˆ°å†…æ ¸ç¼“å†²åŒº&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä»å†…æ ¸ç¼“å†²åŒºå¤åˆ¶æ•°æ® â€“&amp;gt; ç”¨æˆ·ç©ºé—´(è¯») / ä»ç”¨æˆ·ç©ºé—´å¤åˆ¶æ•°æ® -&amp;gt; å†…æ ¸ç¼“å†²åŒº(å†™)&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;åˆ¤æ–­ä¸€ä¸ªI/Oæ¨¡å‹æ˜¯åŒæ­¥è¿˜æ˜¯å¼‚æ­¥ï¼Œä¸»è¦çœ‹ç¬¬äºŒæ­¥åœ¨å¤åˆ¶æ•°æ®æ—¶æ˜¯å¦ä¼šé˜»å¡å½“å‰è¿›ç¨‹ï¼Œå³CPUèƒ½ä¸èƒ½å»æ‰§è¡Œå…¶ä»–çº¿ç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;Unixç½‘ç»œä¸­çš„5ç§ I/O æ¨¡å‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;åŒæ­¥é˜»å¡ I / Oï¼šä¸€æ¬¡IOï¼Œå†…æ•°æ®æ²¡æœ‰å‡†å¤‡å¥½æ—¶ï¼Œè°ƒç”¨æ–¹æ³•ä¼šé˜»å¡ç­‰å¾…ï¼Œç›´è‡³å®Œæˆï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åŒæ­¥éé˜»å¡ I / Oï¼šä¸€æ¬¡IOå†…ï¼Œæ•°æ®æ²¡æœ‰å‡†å¤‡å¥½æ—¶ä¸æ–­é—´éš”è½®è¯¢ï¼Œç­‰åˆ°æ•°æ®å‡†å¤‡å¥½çš„ç»“æœåæ‹·è´åˆ°ç”¨æˆ·æ€ï¼Œåœ¨è½®è¯¢çš„é—´éš”æœŸå¯æ‰§è¡Œå…¶ä»–æ“ä½œï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;I / Oå¤šè·¯å¤ç”¨ï¼šä¸€ä¸ªç®¡é“é˜»å¡ç›‘å¬æ‰€æœ‰IOï¼Œå†…æ ¸æ•°æ®æ˜¯å¦å‡†å¤‡å¥½ï¼Œäº‹ä»¶é©±åŠ¨ï¼Œç›‘å¬åˆ°æ•°æ®å‡†å¤‡å¥½åæ‹·è´æ•°æ®åˆ°ç”¨æˆ·æ€ï¼Œå¦‚selectã€pollã€epollï¼›&lt;/p&gt;
&lt;p&gt;I / Oå¤šè·¯å¤ç”¨å®é™…ä¸Šå°±æ˜¯åœ¨éé˜»å¡I/Oçš„åŸºç¡€ä¸Šï¼Œå¢åŠ ä¸€ä¸ªçº¿ç¨‹åŒæ—¶ç›‘å¬å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼ˆI/Oäº‹ä»¶ï¼‰é˜»å¡ç­‰å¾…ï¼Œå¹¶åœ¨æŸä¸ªæ–‡ä»¶æè¿°ç¬¦å¯è¯»å†™æ—¶æ”¶åˆ°é€šçŸ¥ï¼ŒI / Oå¤ç”¨å¹¶ä¸æ˜¯å¤ç”¨IOè¿æ¥ï¼Œè€Œæ˜¯å¤ç”¨çº¿ç¨‹ï¼Œè®©ä¸€ä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶å¤„ç†å¤šä¸ªè¿æ¥ï¼ˆI/Oäº‹ä»¶ï¼‰&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åŒæ­¥ä¿¡å·é©±åŠ¨ I / Oï¼šæ³¨å†Œå›è°ƒå‡½æ•°ï¼Œå†…æ ¸æ•°æ®å‡†å¤‡å¥½åè¿›è¡Œå›è°ƒï¼Œåœ¨æ­¤æœŸé—´ç³»ç»Ÿå¯ä»¥åšå…¶ä»–äº‹æƒ…ï¼Œæ•°æ®å‡†å¤‡é˜¶æ®µæ˜¯å¼‚æ­¥ï¼Œæ•°æ®æ‹·è´é˜¶æ®µæ˜¯åŒæ­¥ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¼‚æ­¥ I / Oï¼šçœŸæ­£çš„å¼‚æ­¥ï¼Œæ•°æ®çš„å‡†å¤‡å’Œæ‹·è´éƒ½æ˜¯è‡ªåŠ¨å®Œæˆï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/%e7%bd%91%e7%bb%9cIO%e6%a8%a1%e5%9e%8b.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/%e7%bd%91%e7%bb%9cIO%e6%a8%a1%e5%9e%8b.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;h3 id=&#34;ioå¤šè·¯å¤ç”¨&#34;&gt;I/Oå¤šè·¯å¤ç”¨&lt;/h3&gt;
&lt;h4 id=&#34;select&#34;&gt;select&lt;/h4&gt;
&lt;blockquote&gt;
&lt;p&gt;ç‰¹ç‚¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¯ç›‘æ§çš„æ–‡ä»¶æè¿°ç¬¦ä¸ªæ•°å–å†³äº sizeof(fd_set) çš„å€¼ï¼Œé»˜è®¤æ˜¯1024ã€‚å‡è®¾æœåŠ¡å™¨ä¸Š sizeof(fd_set)ï¼512ï¼Œæ¯ bit è¡¨ç¤ºä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œåˆ™æœåŠ¡å™¨ä¸Šæ”¯æŒçš„æœ€å¤§æ–‡ä»¶æè¿°ç¬¦æ˜¯ 512*8=4096ã€‚&lt;/li&gt;
&lt;li&gt;å°† fd åŠ å…¥ select ç›‘æ§é›†çš„åŒæ—¶ï¼Œè¿˜è¦å†ä½¿ç”¨ä¸€ä¸ªæ•°æ®ç»“æ„ array ä¿å­˜æ”¾åˆ° select ç›‘æ§é›†ä¸­çš„ fdï¼Œä¸€æ˜¯ç”¨äºåœ¨ select è¿”å›åï¼Œarray ä½œä¸ºæºæ•°æ®å’Œ fd_set è¿›è¡Œ FD_ISSET åˆ¤æ–­ï¼ŒäºŒæ˜¯ select è¿”å›åä¼šæŠŠä»¥å‰åŠ å…¥çš„ä½†å¹¶æ— äº‹ä»¶å‘ç”Ÿçš„ fd æ¸…ç©ºï¼Œåˆ™æ¯æ¬¡å¼€å§‹ select å‰éƒ½è¦é‡æ–°ä» array å–å¾— fd é€ä¸€åŠ å…¥ï¼ˆFD_ZERO æœ€å…ˆï¼‰ï¼Œæ‰«æ array çš„åŒæ—¶å–å¾— fd æœ€å¤§å€¼ maxfdï¼Œç”¨äº select çš„ç¬¬ä¸€ä¸ªå‚æ•°ã€‚&lt;/li&gt;
&lt;li&gt;æ‰€ä»¥select æ¨¡å‹å¿…é¡»åœ¨ select å‰å¾ªç¯ arrayï¼ˆåŠ  fdï¼Œå– maxfdï¼‰ï¼Œselect è¿”å›åå¾ªç¯ arrayï¼ˆFD_ISSET åˆ¤æ–­æ˜¯å¦æœ‰äº‹ä»¶å‘ç”Ÿï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç¼ºç‚¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;fd_setæœ‰ä¸ªæ•°é™åˆ¶ï¼Œæœ€å¤§å¹¶å‘æ•°é™åˆ¶ï¼šä½¿ç”¨ 32 ä¸ªæ•´æ•°çš„ 32 ä½ï¼Œå³ 32*32=1024 æ¥æ ‡è¯† fdï¼›&lt;/li&gt;
&lt;li&gt;æ¯æ¬¡è°ƒç”¨ selectï¼Œéƒ½éœ€è¦æŠŠ fd é›†åˆä»ç”¨æˆ·æ€æ‹·è´åˆ°å†…æ ¸æ€ï¼Œè¿™ä¸ªå¼€é”€åœ¨ fd å¾ˆå¤šæ—¶ä¼šå¾ˆå¤§ï¼›&lt;/li&gt;
&lt;li&gt;æ€§èƒ½è¡°å‡ä¸¥é‡ï¼šæ¯æ¬¡ kernel éƒ½éœ€è¦çº¿æ€§æ‰«ææ•´ä¸ª fd_setï¼Œæ‰€ä»¥éšç€ç›‘æ§çš„æè¿°ç¬¦ fd æ•°é‡å¢é•¿ï¼Œå…¶ I/O æ€§èƒ½ä¼šçº¿æ€§ä¸‹é™ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;æ€»ç»“ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;ç”¨æˆ·æ€æœ‰ä¸€ä¸ªfd_setï¼Œæ˜¯ä¸€ä¸ªbitmapï¼Œè¡¨ç¤ºè¦ç›‘å¬å“ªäº›fdï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è°ƒç”¨selectæ—¶ï¼Œä»ç”¨æˆ·æ€æŠŠfd_setå…¨é‡å¤åˆ¶åˆ°å†…æ ¸æ€ï¼Œç”±å†…æ ¸æ€éå†æ•´ä¸ªfd_setæ¥åˆ¤æ–­æ˜¯å¦æœ‰æ•°æ®åˆ°æ¥ï¼Œç½®ä½è¡¨ç¤ºæœ‰æ•°æ®ï¼ŒæŠŠfd_setè¿”å›ç»™ç”¨æˆ·æ€ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç”¨æˆ·æ€å†éå†æ•´ä¸ªfd_setï¼Œå’ŒåŸå§‹çš„fd_setæ¯”è¾ƒï¼Œæ‰çŸ¥é“å“ªä¸ªç›‘å¬çš„fdæ˜¯æœ‰æ•°æ®çš„ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;fd_setä¸å¯é‡ç”¨ï¼Œå¤„ç†å®Œè¿™ä¸ªfd_setåï¼Œè¿˜å¾—resetæ•´ä¸ªfd_setï¼Œä¹‹æ‰€ä»¥ä¸å¯é‡ç”¨ï¼Œæ˜¯å› ä¸ºfd_setåœ¨selectå‰åæœ‰ä¸¤å±‚è¯­ä¹‰ï¼Œselectå‰æŠŠè¦ç›‘å¬çš„fdç½®ä¸º1ï¼ŒselectåæŠŠæœ‰æ•°æ®fdçš„ç½®ä¸º1ï¼›&lt;/p&gt;
&lt;p&gt;å†…æ ¸éå†åˆ¤æ–­è¿™ä¸ªfd_setæ—¶æ˜¯é˜»å¡çš„ï¼›&lt;/p&gt;
&lt;h4 id=&#34;poll&#34;&gt;poll&lt;/h4&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;poll çš„å®ç°å’Œ select éå¸¸ç›¸ä¼¼ï¼Œåªæ˜¯æè¿° fd é›†åˆçš„æ–¹å¼ä¸åŒï¼Œpoll ä½¿ç”¨ pollfd ç»“æ„è€Œä¸æ˜¯ select çš„ fd_set ç»“æ„ï¼›&lt;/li&gt;
&lt;li&gt;poll è§£å†³äº†æœ€å¤§æ–‡ä»¶æè¿°ç¬¦æ•°é‡é™åˆ¶çš„é—®é¢˜ï¼Œä½†æ˜¯åŒæ ·éœ€è¦ä»ç”¨æˆ·æ€æ‹·è´æ‰€æœ‰çš„ fd åˆ°å†…æ ¸æ€ï¼Œä¹Ÿéœ€è¦çº¿æ€§éå†æ‰€æœ‰çš„ fd é›†åˆï¼Œæ‰€ä»¥å®ƒå’Œ select åªæ˜¯å®ç°ç»†èŠ‚ä¸Šçš„åŒºåˆ†ï¼Œå¹¶æ²¡æœ‰æœ¬è´¨ä¸Šçš„åŒºåˆ«ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;æ€»ç»“ï¼špollå·¥ä½œåŸç†å’Œselectä¸€æ ·ï¼Œåªæ˜¯å¯¹selectåšäº†ä¸€å®šä¼˜åŒ–ï¼Œé‡æ–°å¯¹fdåšäº†ä¸€ä¸ªåŒ…è£…ï¼Œä¸å†ä½¿ç”¨fd_setï¼Œè€Œæ˜¯ä½¿ç”¨pollfdï¼Œé‡Œé¢æœ‰eventsè¡¨ç¤ºè¦ç›‘å¬çš„çŠ¶æ€ï¼Œreventsè¡¨ç¤ºå†…æ ¸å®é™…æ”¶åˆ°çš„çŠ¶æ€ï¼Œè§£å†³fd_setä¸å¯é‡ç”¨çš„é—®é¢˜ï¼›å¦å¤–ï¼Œfd_setæ˜¯ä¸€ä¸ªbitmapï¼Œé•¿åº¦é™åˆ¶åœ¨1024ï¼Œpollfdæ˜¯ä¸ªé“¾è¡¨ï¼Œé•¿åº¦ä¸Šé™å°±é«˜å¾ˆå¤šäº†ï¼›&lt;/p&gt;
&lt;h4 id=&#34;epoll&#34;&gt;epoll&lt;/h4&gt;
&lt;blockquote&gt;
&lt;p&gt;è™½ç„¶åŸç†å·®ä¸å¤šï¼Œä½†select&amp;amp;poll é”™è¯¯é¢„ä¼°äº†ä¸€ä»¶äº‹ï¼Œå½“æ•°åä¸‡å¹¶å‘è¿æ¥å­˜åœ¨æ—¶ï¼Œå¯èƒ½æ¯ä¸€æ¯«ç§’åªæœ‰æ•°ç™¾ä¸ªæ´»è·ƒçš„è¿æ¥ï¼ŒåŒæ—¶å…¶ä½™æ•°åä¸‡è¿æ¥åœ¨è¿™ä¸€æ¯«ç§’æ˜¯éæ´»è·ƒçš„ã€‚å½“è¿›ç¨‹è®¤ä¸ºéœ€è¦æ‰¾å‡ºæœ‰æŠ¥æ–‡åˆ°è¾¾çš„æ´»è·ƒè¿æ¥æ—¶ï¼Œå°±ä¼šè°ƒç”¨select&amp;amp;pollï¼Œæ‰€ä»¥select&amp;amp;pollåœ¨é«˜å¹¶å‘æ—¶ä¼šè¢«é¢‘ç¹è°ƒç”¨ï¼Œå¦‚æœå…¨éƒ¨å¾…ç›‘æ§çš„è¿æ¥æ•°å¾ˆå¤šï¼Œä½†æ´»è·ƒè¿æ¥å¾ˆå°‘ï¼Œå°±ä¼šæœ‰æ•ˆç‡é—®é¢˜äº†ã€‚&lt;/p&gt;
&lt;p&gt;epollä¼˜åŒ–äº†selectæ€§èƒ½å¼€é”€å¾ˆå¤§ï¼Œæ–‡ä»¶æè¿°ç¬¦æ•°é‡å°‘çš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;å®ç°ä¸Šï¼Œepollåˆ†æ¸…äº†é«˜é¢‘å’Œä½é¢‘è°ƒç”¨ï¼Œå†…éƒ¨å­˜å‚¨åˆ†ä¸ºä¸¤ç§ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;ä¸€ä¸ªæ˜¯ç›‘å¬åˆ—è¡¨ï¼Œä½¿ç”¨çº¢é»‘æ ‘å­˜å‚¨æ‰€æœ‰ç›‘å¬çš„fdï¼Œæ¯ä¸ªæ’å…¥æˆ–åˆ é™¤çš„fdæ€§èƒ½ç¨³å®šï¼Œæ’å…¥æ—¶ä¼šä¸ºè¯¥fdæ³¨å†Œä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œä¿è¯äº†æ¯ä¸ªfdåœ¨å…¶ç”Ÿå‘½å‘¨æœŸåªæ‹·è´ä¸€æ¬¡&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¸€ä¸ªæ˜¯å°±ç»ªåˆ—è¡¨ï¼Œä½¿ç”¨é“¾è¡¨å­˜å‚¨ï¼Œé˜»å¡ç›‘å¬ã€‚å½“fdå°±ç»ªæ—¶ï¼Œå°±ä¼šè§¦å‘å›è°ƒå‡½æ•°ç”±å†…æ ¸è°ƒç”¨ï¼ŒæŠŠå°±ç»ªçš„fdæ”¾åˆ°å°±ç»ªé“¾è¡¨é‡Œã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;epollä¼šå»æ£€æŸ¥å°±ç»ªé“¾è¡¨ï¼Œä¿è¯æ¯æ¬¡æ‹¿åˆ°çš„éƒ½æ˜¯å¯ç”¨çš„fdï¼Œæ‰€ä»¥epollä¸éœ€è¦æŠŠå…¨éƒ¨ç›‘å¬çš„fdé›†åˆéƒ½ä»ç”¨æˆ·æ€æ‹·è´åˆ°å†…æ ¸æ€ï¼Œåªéœ€è¦æ‹·è´å·²å°±ç»ªçš„fdã€‚&lt;/p&gt;
&lt;p&gt;select&amp;amp;poll è°ƒç”¨æ—¶ä¼šå°†å…¨éƒ¨ç›‘å¬çš„ fd ä»ç”¨æˆ·æ€ç©ºé—´æ‹·è´è‡³å†…æ ¸æ€ç©ºé—´å¹¶çº¿æ€§æ‰«æä¸€éæ‰¾å‡ºå°±ç»ªçš„ fd å†è¿”å›åˆ°ç”¨æˆ·æ€ï¼Œepoll å†…çš„å®ç°åªä¼šç›´æ¥è¿”å›å·²å°±ç»ª fdï¼Œå› æ­¤ epoll çš„ I/O æ€§èƒ½ä¸ä¼šåƒ select&amp;amp;poll é‚£æ ·éšç€ç›‘å¬çš„ fd æ•°é‡å¢åŠ è€Œå‡ºç°çº¿æ€§è¡°å‡ï¼Œå®ç°é«˜æ•ˆã€‚&lt;/p&gt;
&lt;p&gt;äº‹ä»¶è§¦å‘æ¨¡å¼ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è¾¹ç¼˜è§¦å‘æ¨¡å¼ï¼ˆETï¼‰ï¼Œå½“è¢«ç›‘æ§çš„ Socket æè¿°ç¬¦ä¸Šæœ‰å¯è¯»äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œ&lt;strong&gt;æœåŠ¡å™¨ç«¯åªä¼šä» epoll_wait ä¸­è‹é†’ä¸€æ¬¡&lt;/strong&gt;ï¼Œå³ä½¿è¿›ç¨‹æ²¡æœ‰è°ƒç”¨ read å‡½æ•°ä»å†…æ ¸è¯»å–æ•°æ®ï¼Œä¹Ÿä¾ç„¶åªè‹é†’ä¸€æ¬¡ï¼Œå› æ­¤æˆ‘ä»¬ç¨‹åºè¦ä¿è¯ä¸€æ¬¡æ€§å°†å†…æ ¸ç¼“å†²åŒºçš„æ•°æ®è¯»å–å®Œï¼›&lt;strong&gt;ä¸€èˆ¬å’Œéé˜»å¡ I/O æ­é…ä½¿ç”¨&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;æ°´å¹³è§¦å‘æ¨¡å¼ï¼ˆLTï¼‰ï¼Œå½“è¢«ç›‘æ§çš„ Socket ä¸Šæœ‰å¯è¯»äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œ&lt;strong&gt;æœåŠ¡å™¨ç«¯ä¸æ–­åœ°ä» epoll_wait ä¸­è‹é†’ï¼Œç›´åˆ°å†…æ ¸ç¼“å†²åŒºæ•°æ®è¢« read å‡½æ•°è¯»å®Œæ‰ç»“æŸ&lt;/strong&gt;ï¼Œç›®çš„æ˜¯å‘Šè¯‰æˆ‘ä»¬æœ‰æ•°æ®éœ€è¦è¯»å–ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;epoll æ”¯æŒè¾¹ç¼˜è§¦å‘å’Œæ°´å¹³è§¦å‘çš„æ–¹å¼ï¼Œè€Œ select/poll åªæ”¯æŒæ°´å¹³è§¦å‘ï¼Œä¸€èˆ¬è€Œè¨€ï¼Œè¾¹ç¼˜è§¦å‘çš„æ–¹å¼ä¼šæ¯”æ°´å¹³è§¦å‘çš„æ•ˆç‡é«˜ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;é›¶æ‹·è´&#34;&gt;é›¶æ‹·è´&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;ä¼ ç»Ÿçš„Linuxçš„æ ‡å‡†IOæ¥å£åŸºäºæ•°æ®æ‹·è´æ“ä½œï¼ŒIOæ“ä½œä¼šå¯¼è‡´æ•°æ®åœ¨æ“ä½œç³»ç»Ÿå†…æ ¸åœ°å€ç©ºé—´çš„ç¼“å†²åŒºå’Œç”¨æˆ·è¿›ç¨‹åœ°å€ç©ºé—´å®šä¹‰çš„ç¼“å†²åŒºä¹‹é—´ä¼ è¾“ã€‚è®¾ç½®ç¼“å†²åŒºæœ€å¤§çš„å¥½å¤„æ˜¯å¯ä»¥å‡å°‘ç£ç›˜ I/O çš„æ“ä½œï¼Œè€Œä¼ ç»Ÿçš„ Linux I/O åœ¨æ•°æ®ä¼ è¾“è¿‡ç¨‹ä¸­æ·±åº¦ä¾èµ– CPUå»æ‰§è¡Œæ•°æ®æ‹·è´çš„æ“ä½œï¼Œç³»ç»Ÿå¼€é”€æå¤§ï¼Œé™åˆ¶äº†æ“ä½œç³»ç»Ÿæœ‰æ•ˆè¿›è¡Œæ•°æ®ä¼ è¾“æ“ä½œçš„èƒ½åŠ›ã€‚æ¯”å¦‚ä¸€æ¬¡è¯»å–ç£ç›˜æ–‡ä»¶ï¼Œåˆ°å†™å…¥ç½‘å¡ï¼Œæ•°æ®çš„æ‹·è´å’Œä¸Šä¸‹æ–‡åˆ‡æ¢éƒ½ç”±CPUæ¥å®Œæˆã€‚&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥å‡ºç°äº†DMAæŠ€æœ¯ï¼ŒDMAæŠ€æœ¯å°±æ˜¯ä¸ºäº†è§£å†³CPUè¿‡å¤šå‚ä¸IOå¸¦æ¥èµ„æºæµªè´¹é—®é¢˜ï¼Œè®©æ¯ä¸ªIOè®¾å¤‡éƒ½æœ‰è‡ªå·±çš„DMAæ§åˆ¶å™¨ï¼Œç”±DMAæ§åˆ¶å™¨å‚ä¸æ•°æ®ä¼ è¾“å·¥ä½œï¼ŒCPUä»…ç”¨æ¥æ¥æ”¶é€šçŸ¥ï¼Œ&lt;strong&gt;åœ¨è¿›è¡Œ I/O è®¾å¤‡å’Œå†…å­˜çš„æ•°æ®ä¼ è¾“çš„æ—¶å€™ï¼Œæ•°æ®æ¬è¿çš„å·¥ä½œå…¨éƒ¨äº¤ç»™ DMA æ§åˆ¶å™¨ï¼Œè€Œ CPU ä¸å†å‚ä¸ä»»ä½•ä¸æ•°æ®æ¬è¿ç›¸å…³çš„äº‹æƒ…ï¼Œè¿™æ · CPU å°±å¯ä»¥å»å¤„ç†åˆ«çš„äº‹åŠ¡&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;Linuxä¸­ä¼ ç»Ÿçš„IOè¯»å†™é€šè¿‡&lt;code&gt;read()/write()&lt;/code&gt;ç³»ç»Ÿè°ƒç”¨å®Œæˆã€‚&lt;code&gt;read()&lt;/code&gt;æŠŠæ•°æ®ä»å­˜å‚¨å™¨ï¼ˆç£ç›˜ã€ç½‘å¡ï¼‰ç­‰è¯»å–åˆ°ç”¨æˆ·ç¼“å†²åŒºï¼Œ&lt;code&gt;write()&lt;/code&gt;æŠŠæ•°æ®ä»ç”¨æˆ·ç¼“å†²åŒºå†™åˆ°å­˜å‚¨å™¨ã€‚ä¸€æ¬¡è¯»å–ç£ç›˜æ–‡ä»¶ï¼Œåˆ°å†™å…¥ç½‘å¡ï¼Œä¸­é—´ä¸€å…±è§¦å‘äº†4æ¬¡ç”¨æˆ·æ€å’Œå†…æ ¸æ€çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œåˆ†åˆ«æ˜¯&lt;code&gt;read()/write()&lt;/code&gt;è°ƒç”¨å’Œè¿”å›æ—¶çš„åˆ‡æ¢ï¼Œ2æ¬¡DMAæ‹·è´ï¼ˆç¡¬ä»¶ä¸å†…æ ¸æ€ä¹‹é—´ï¼‰ã€2æ¬¡CPUæ‹·è´ï¼ˆç”¨æˆ·æ€ä¸å†…æ ¸æ€ä¹‹é—´ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;é›¶æ‹·è´å°±æ˜¯æŒ‡åœ¨æ‰§è¡ŒIOæ“ä½œæ—¶ï¼Œè®©æ•°æ®æ‹·è´ç›´æ¥å‘ç”Ÿåœ¨å†…æ ¸ï¼Œä»è€ŒèŠ‚çœCPUå‘¨æœŸå’Œå†…å­˜å¸¦å®½ã€‚é›¶æ‹·è´æŠ€æœ¯åŸºäºPage Cacheï¼Œåˆ©ç”¨å…¶é¢„è¯»æå‡ç¼“å­˜æ•°æ®è®¿é—®æ€§èƒ½ï¼Œè§£å†³æœºæ¢°ç¡¬ç›˜å¯»å€æ…¢çš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;ä½œç”¨ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å‡å°‘ç”šè‡³å®Œå…¨é¿å…æ“ä½œç³»ç»Ÿå†…æ ¸å’Œç”¨æˆ·åº”ç”¨ç¨‹åºåœ°å€ç©ºé—´è¿™ä¸¤è€…ä¹‹é—´è¿›è¡Œæ•°æ®æ‹·è´æ“ä½œï¼Œä»è€Œå‡å°‘ç”¨æˆ·æ€ &amp;ndash; å†…æ ¸æ€ä¸Šä¸‹æ–‡åˆ‡æ¢å¸¦æ¥çš„ç³»ç»Ÿå¼€é”€ã€‚&lt;/li&gt;
&lt;li&gt;å‡å°‘ç”šè‡³å®Œå…¨é¿å…æ“ä½œç³»ç»Ÿå†…æ ¸ç¼“å†²åŒºä¹‹é—´è¿›è¡Œæ•°æ®æ‹·è´æ“ä½œã€‚&lt;/li&gt;
&lt;li&gt;å¸®åŠ©ç”¨æˆ·è¿›ç¨‹ç»•å¼€æ“ä½œç³»ç»Ÿå†…æ ¸ç©ºé—´ç›´æ¥è®¿é—®ç¡¬ä»¶å­˜å‚¨æ¥å£æ“ä½œæ•°æ®ã€‚&lt;/li&gt;
&lt;li&gt;åˆ©ç”¨ DMA è€Œé CPU æ¥å®Œæˆç¡¬ä»¶æ¥å£å’Œå†…æ ¸ç¼“å†²åŒºä¹‹é—´çš„æ•°æ®æ‹·è´ï¼Œä»è€Œè§£æ”¾ CPUï¼Œä½¿ä¹‹èƒ½å»æ‰§è¡Œå…¶ä»–çš„ä»»åŠ¡ï¼Œæå‡ç³»ç»Ÿæ€§èƒ½ã€‚&lt;/li&gt;
&lt;li&gt;é›¶æ‹·è´åªé€‚åˆé‚£äº›æ•°æ®ä¸éœ€è¦åœ¨ç”¨æˆ·æ€åšä¿®æ”¹çš„æ•°æ®ä¼ è¾“ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å®ç°æ–¹å¼ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å‡å°‘ç”šè‡³é¿å…ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´ä¹‹é—´çš„æ•°æ®æ‹·è´ï¼šæ•°æ®æ‹·è´ç›´æ¥åœ¨å†…æ ¸å®Œæˆï¼Œä¸ç»è¿‡ç”¨æˆ·æ€ã€‚åœ¨ä¸€äº›åœºæ™¯ä¸‹ï¼Œç”¨æˆ·è¿›ç¨‹åœ¨æ•°æ®ä¼ è¾“è¿‡ç¨‹ä¸­å¹¶ä¸éœ€è¦å¯¹æ•°æ®è¿›è¡Œè®¿é—®å’Œå¤„ç†ï¼Œé‚£ä¹ˆæ•°æ®åœ¨ Linux çš„ Page Cache å’Œç”¨æˆ·è¿›ç¨‹çš„ç¼“å†²åŒºä¹‹é—´çš„ä¼ è¾“å°±å®Œå…¨å¯ä»¥é¿å…ï¼Œè®©æ•°æ®æ‹·è´å®Œå…¨åœ¨å†…æ ¸é‡Œè¿›è¡Œï¼Œç”šè‡³å¯ä»¥é€šè¿‡æ›´å·§å¦™çš„æ–¹å¼é¿å…åœ¨å†…æ ¸é‡Œçš„æ•°æ®æ‹·è´ã€‚è¿™ä¸€ç±»å®ç°ä¸€èˆ¬æ˜¯é€šè¿‡å¢åŠ æ–°çš„ç³»ç»Ÿè°ƒç”¨æ¥å®Œæˆçš„ï¼Œæ¯”å¦‚ Linux ä¸­çš„ &lt;code&gt;mmap()&lt;/code&gt;ï¼Œ&lt;code&gt;sendfile() &lt;/code&gt;ä»¥åŠ &lt;code&gt;splice()&lt;/code&gt; ç­‰ã€‚&lt;/li&gt;
&lt;li&gt;ç»•è¿‡å†…æ ¸çš„ç›´æ¥ I/Oï¼š&lt;strong&gt;å…è®¸åœ¨ç”¨æˆ·æ€è¿›ç¨‹ç»•è¿‡å†…æ ¸ç›´æ¥å’Œç¡¬ä»¶è¿›è¡Œæ•°æ®ä¼ è¾“&lt;/strong&gt;ï¼Œå†…æ ¸åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­åªè´Ÿè´£ä¸€äº›ç®¡ç†å’Œè¾…åŠ©çš„å·¥ä½œã€‚è¿™ç§æ–¹å¼å…¶å®å’Œç¬¬ä¸€ç§æœ‰ç‚¹ç±»ä¼¼ï¼Œä¹Ÿæ˜¯è¯•å›¾é¿å…ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´ä¹‹é—´çš„æ•°æ®ä¼ è¾“ï¼Œåªæ˜¯ç¬¬ä¸€ç§æ–¹å¼æ˜¯æŠŠæ•°æ®ä¼ è¾“è¿‡ç¨‹æ”¾åœ¨å†…æ ¸æ€å®Œæˆï¼Œè€Œè¿™ç§æ–¹å¼åˆ™æ˜¯ç›´æ¥ç»•è¿‡å†…æ ¸å’Œç¡¬ä»¶é€šä¿¡ï¼Œæ•ˆæœç±»ä¼¼ä½†åŸç†å®Œå…¨ä¸åŒã€‚&lt;/li&gt;
&lt;li&gt;å†…æ ¸ç¼“å†²åŒºå’Œç”¨æˆ·ç¼“å†²åŒºä¹‹é—´çš„ä¼ è¾“ä¼˜åŒ–ï¼šè¿™ç§æ–¹å¼ä¾§é‡äºåœ¨ç”¨æˆ·è¿›ç¨‹çš„ç¼“å†²åŒºå’Œæ“ä½œç³»ç»Ÿçš„é¡µç¼“å­˜ä¹‹é—´çš„ CPU æ‹·è´çš„ä¼˜åŒ–ã€‚è¿™ç§æ–¹æ³•å»¶ç»­äº†ä»¥å¾€é‚£ç§ä¼ ç»Ÿçš„é€šä¿¡æ–¹å¼ï¼Œä½†æ›´çµæ´»ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;h1 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h1&gt;
&lt;p&gt;æå®¢æ—¶é—´ - æ“ä½œç³»ç»Ÿå®æˆ˜45è®²&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://zhuanlan.zhihu.com/p/266950886&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Linuxç³»ç»Ÿä¸­ï¼Œä¸ºä»€ä¹ˆéœ€è¦åŒºåˆ†å†…æ ¸ç©ºé—´ä¸ç”¨æˆ·ç©ºé—´ï¼Ÿ&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æå®¢æ—¶é—´ - Linuxæ€§èƒ½ä¼˜åŒ–å®æˆ˜&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://strikefreedom.top/archives/linux-io-and-zero-copy&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Linux IOåŸç†å’Œé›¶æ‹·è´æŠ€æœ¯å…¨é¢è§£æ&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://zhuanlan.zhihu.com/p/121826927&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Unixç½‘ç»œç¼–ç¨‹çš„5ç§I/Oæ¨¡å‹&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://segmentfault.com/a/1190000022653305&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Unixçš„äº”ç§IOæ¨¡å‹ä»‹ç»&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://xiaolincoding.com/os/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;å°æ—coding - å›¾è§£ç³»ç»Ÿ&lt;/a&gt;ï¼Œå†™å¾—é€šä¿—æ˜“æ‡‚ï¼Œé€‚åˆå¿«é¤å¼é˜…è¯»ï¼Œå¼ºæ¨ï¼&lt;/p&gt;
</description>
        </item>
        <item>
        <title>ç†è´¢æ–¹æ¡ˆæ”¶é›†</title>
        <link>http://nixum.cc/p/%E7%90%86%E8%B4%A2%E6%96%B9%E6%A1%88%E6%94%B6%E9%9B%86/</link>
        <pubDate>Sat, 05 Aug 2023 00:00:00 +0000</pubDate>
        
        <guid>http://nixum.cc/p/%E7%90%86%E8%B4%A2%E6%96%B9%E6%A1%88%E6%94%B6%E9%9B%86/</guid>
        <description>&lt;p&gt;åˆæœŸï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ç†è´¢è½¯ä»¶ï¼šæ”¯ä»˜å®ã€å¾®ä¿¡ã€å„ä¸ªé“¶è¡Œ app (å¦‚æ‹›å•†é“¶è¡Œ)ã€å¾®ä¼—é“¶è¡Œ&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ´»é’±ç†è´¢ï¼Œæ¯”å¦‚ä½™é¢å®ã€ä½™åˆ©å®ã€æ´»æœŸï¼Œé“¶è¡Œappé‡Œçš„å„è‡ªxxå®ã€å„ç§è´§å¸åŸºé‡‘ã€å¾®ä¼—é“¶è¡Œçš„æ´»æœŸã€æ´»æœŸplusï¼Œä¼˜ç‚¹æ˜¯éšæ—¶å¯ä»¥è½¬å…¥è½¬å‡ºï¼Œæ”¶ç›Šç‡å¤§æ¦‚æ˜¯3%&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å®šæœŸç†è´¢ï¼Œè·¨åº¦åœ¨ 1/3/6/12 ä¸ªæœˆ&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;çº¯å€ºåŸºé‡‘ï¼Œä¼šæœ‰çŸ­æœŸæ³¢åŠ¨&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æŒ‡æ•°åŸºé‡‘ã€å€ºåˆ¸åŸºé‡‘ã€é»„é‡‘åŸºé‡‘&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¢ƒå¤–çš„æŒ‡æ•°ï¼Œå¦‚ç¾å›½çš„æ ‡æ™® 500 ã€çº³æ–¯è¾¾å…‹ 100 æŒ‡æ•°ã€å¾·å›½çš„ DAX æŒ‡æ•°ã€è¶Šå—æŒ‡æ•°&lt;/li&gt;
&lt;li&gt;å›½å†…çš„æŒ‡æ•°ï¼Œå¦‚ä¸­è¯ 1000 ã€ä¸­è¯ 500 ã€ä¸Šè¯ 50 ç­‰&lt;/li&gt;
&lt;li&gt;é»„é‡‘ï¼Œé»„é‡‘çš„ ETF æŒ‡æ•°&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
</description>
        </item>
        <item>
        <title>JVM</title>
        <link>http://nixum.cc/p/jvm/</link>
        <pubDate>Tue, 18 Jun 2019 00:00:00 +0000</pubDate>
        
        <guid>http://nixum.cc/p/jvm/</guid>
        <description>&lt;h1 id=&#34;jvm&#34;&gt;JVM&lt;/h1&gt;
&lt;p&gt;[TOC]&lt;/p&gt;
&lt;h2 id=&#34;jvmå†…å­˜æ¨¡å‹&#34;&gt;JVMå†…å­˜æ¨¡å‹&lt;/h2&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/JVM%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/JVM%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			alt=&#34;JVMå†…å­˜æ¨¡å‹&#34;&gt;
	&lt;/a&gt;
	
	&lt;figcaption&gt;JVMå†…å­˜æ¨¡å‹&lt;/figcaption&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ–¹æ³•åŒºä¹Ÿå«æ°¸ä¹…ä»£ï¼ŒæŒä¹…ä»£ï¼Œéå †ï¼Œä¸ç®—åœ¨å †é‡Œé¢&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å¹´è½»ä»£ä¹Ÿå«æ–°ç”Ÿä»£&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æ³¨æ„åŒºåˆ«äºJavaå†…å­˜æ¨¡å‹&lt;/p&gt;
&lt;p&gt;JVMå†…å­˜æ¨¡å‹æè¿°çš„æ˜¯çº¿ç¨‹è¿è¡Œæ—¶çš„æ•°æ®åœ¨å†…å­˜çš„åˆ†å¸ƒ&lt;/p&gt;
&lt;p&gt;Javaå†…å­˜æ¨¡å‹æ˜¯å¤šçº¿ç¨‹æƒ…å†µä¸‹æ•°æ®çš„åˆ†å¸ƒ&lt;/p&gt;
&lt;h2 id=&#34;å¼•ç”¨ç±»å‹&#34;&gt;å¼•ç”¨ç±»å‹&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;å¼ºå¼•ç”¨ï¼šé€šè¿‡newçš„æ–¹å¼åˆ›å»ºï¼Œä¸ä¼šè¢«è½»æ˜“å›æ”¶&lt;/li&gt;
&lt;li&gt;è½¯å¼•ç”¨ï¼ˆSoftReferenceï¼‰ï¼šè¢«è½¯å¼•ç”¨å…³è”çš„å¯¹è±¡åªæœ‰åœ¨å†…å­˜ä¸å¤Ÿæ—¶æ‰ä¼šè¢«å›æ”¶&lt;/li&gt;
&lt;li&gt;å¼±å¼•ç”¨ï¼ˆWeakReferenceï¼‰ï¼šè¢«å¼±å¼•ç”¨å…³è”çš„å¯¹è±¡ä¸€å®šä¼šè¢«å›æ”¶ï¼Œåªèƒ½å­˜æ´»è‡³ä¸‹æ¬¡åƒåœ¾å›æ”¶å‘ç”Ÿä¹‹å‰&lt;/li&gt;
&lt;li&gt;è™šå¼•ç”¨ï¼ˆPhantomReferenceï¼‰ï¼šæ¯”å¦‚å°†å¯¹è±¡å¼•ç”¨è®¾ç½®ä¸ºnullï¼Œè¯¥å¼•ç”¨æŒ‡å‘çš„å¯¹è±¡å°±ä¼šè¢«å›æ”¶ï¼Œç›¸å½“äºå‘ŠçŸ¥JVMå¯ä»¥å›æ”¶è¯¥å¯¹è±¡&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è½¯å¼•ç”¨ã€å¼±å¼•ç”¨ã€è™šå¼•ç”¨å‡å¯ä»¥æ­é…å¼•ç”¨é˜Ÿåˆ—ä½¿ç”¨ï¼Œä¸”è™šå¼•ç”¨å¿…é¡»æ­é…å¼•ç”¨é˜Ÿåˆ—ä½¿ç”¨ã€‚ä½¿ç”¨å¼•ç”¨é˜Ÿåˆ—æ—¶ï¼Œè¿™äº›å¼•ç”¨å¯¹è±¡è¢«åƒåœ¾æ”¶é›†å™¨å›æ”¶ä¹‹åä¼šè¿›å…¥å¼•ç”¨é˜Ÿåˆ—ï¼Œç­‰å¾…äºŒæ¬¡å›æ”¶ã€‚å¼•ç”¨é˜Ÿåˆ—ä¸€èˆ¬ç”¨äºä¸GCäº¤äº’çš„åœºæ™¯ï¼Œæ¯”å¦‚ï¼Œåƒåœ¾å›æ”¶æ—¶è¿›è¡Œé€šçŸ¥ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å¯è¾¾æ€§åˆ†æ&#34;&gt;å¯è¾¾æ€§åˆ†æ&lt;/h2&gt;
&lt;p&gt;ä»¥ GC Roots ä¸ºèµ·å§‹ç‚¹è¿›è¡Œæœç´¢ï¼Œå¯è¾¾çš„å¯¹è±¡éƒ½æ˜¯å­˜æ´»çš„ï¼Œä¸å¯è¾¾çš„å¯¹è±¡å¯è¢«å›æ”¶ï¼Œä¸å¯è¾¾æŒ‡çš„æ˜¯æ¸¸ç¦»åœ¨GC Rootå¤–çš„å¯¹è±¡ã€‚&lt;/p&gt;
&lt;p&gt;GC RootsåŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;javaè™šæ‹Ÿæœºæ ˆä¸­å¼•ç”¨çš„å¯¹è±¡&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æ–¹æ³•æ‰§è¡Œæ—¶ï¼ŒJVMä¼šåˆ›å»ºä¸€ä¸ªç›¸åº”çš„æ ˆå¸§è¿›å…¥javaè™šæ‹Ÿæœºæ ˆï¼Œæ ˆå¸§ä¸­åŒ…æ‹¬æ“ä½œæ•°æ ˆã€å±€éƒ¨å˜é‡è¡¨ã€è¿è¡Œæ—¶å¸¸é‡æ± çš„å¼•ç”¨ã€æ–¹æ³•å†…éƒ¨äº§ç”Ÿçš„å¯¹è±¡çš„å¼•ç”¨ï¼Œå½“æ–¹æ³•æ‰§è¡Œç»“æŸåï¼Œæ ˆå¸§å‡ºæ ˆï¼Œæ–¹æ³•å†…éƒ¨äº§ç”Ÿçš„å¯¹è±¡çš„å¼•ç”¨å°±ä¸å­˜åœ¨äº†ï¼Œæ­¤æ—¶è¿™äº›å¯¹è±¡å°±æ˜¯ä¸å¯è¾¾å¯¹è±¡ï¼Œå› ä¸ºæ— æ³•ä»GC Rootsæ‰¾åˆ°ï¼Œè¿™äº›å¯¹è±¡å°†åœ¨ä¸‹æ¬¡GCæ—¶å›æ”¶ã€‚&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚ï¼Œæ–¹æ³•å†…éƒ¨åˆ›å»ºä¸€ä¸ªå¯¹è±¡Aï¼Œå¹¶æŒæœ‰å¦ä¸€ä¸ªå¯¹è±¡Bï¼Œå¯¹è±¡Bå¼•ç”¨ä¹ŸåŒæ—¶è¢«å…¶ä»–çº¿ç¨‹æŒæœ‰ï¼Œç„¶ååœ¨æ–¹æ³•é‡Œè®¾ç½®å¯¹è±¡A=nullæˆ–è€…æ–¹æ³•ç»“æŸåï¼Œä¸ªäººè®¤ä¸ºå¯¹è±¡Aä¼šè¢«å›æ”¶ï¼Œå¯¹è±¡Bä¸ä¼šè¢«å›æ”¶ï¼Œå¦‚æœæ˜¯æ–¹æ³•å¤–æœ‰ä¸€ä¸ªå¯¹è±¡Cå¼•ç”¨äº†å¯¹è±¡Aï¼Œè®¾ç½®å¯¹è±¡A=nullæˆ–æ–¹æ³•ç»“æŸåï¼Œå¯¹è±¡Aä¸ä¼šè¢«å›æ”¶&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ–¹æ³•åŒºä¸­ç±»é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡ã€å¸¸é‡å¼•ç”¨çš„å¯¹è±¡&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;é™æ€å±æ€§æˆ–è€…é™æ€å˜é‡ï¼Œæ˜¯classçš„å±æ€§ï¼Œä¸å±äºä»»ä½•å®ä¾‹ï¼Œè¯¥å±æ€§ä¼šä½œä¸ºGC Rootsï¼Œåªè¦è¯¥classå­˜åœ¨ï¼Œè¯¥å¼•ç”¨æŒ‡å‘çš„å¯¹è±¡ä¹Ÿä¼šä¸€ç›´å­˜åœ¨ï¼Œåªæœ‰è¯¥classè¢«å¸è½½æ—¶ï¼Œæ‰ä¼šè¢«å›æ”¶ã€‚å¯¹äºå¸¸é‡æ± é‡Œçš„å­—é¢é‡ï¼Œå½“æ²¡æœ‰å…¶ä»–åœ°æ–¹å¼•ç”¨è¿™ä¸ªå­—é¢é‡æ—¶ï¼Œä¹Ÿä¼šè¢«æ¸…é™¤ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æœ¬åœ°æ–¹æ³•æ ˆä¸­Nativeæ–¹æ³•å¼•ç”¨çš„å¯¹è±¡&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;è¿™éƒ¨åˆ†å±äºå…¶ä»–è¯­è¨€å†™çš„æ–¹æ³•æ‰€ä½¿ç”¨åˆ°çš„å¯¹è±¡ï¼Œé“ç†è·Ÿä¸Šé¢æ˜¯javaè™šæ‹Ÿæœºæ ˆæ˜¯ç±»ä¼¼çš„&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;åƒåœ¾å›æ”¶ç®—æ³•&#34;&gt;åƒåœ¾å›æ”¶ç®—æ³•&lt;/h2&gt;
&lt;h3 id=&#34;å¼•ç”¨è®¡æ•°æ³•&#34;&gt;å¼•ç”¨è®¡æ•°æ³•&lt;/h3&gt;
&lt;p&gt;ä¸ºå¯¹è±¡æ·»åŠ ä¸€ä¸ªå¼•ç”¨è®¡æ•°å™¨ï¼Œå½“å¯¹è±¡å¢åŠ ä¸€ä¸ªå¼•ç”¨æ—¶ï¼Œè®¡æ•°å™¨åŠ  1ï¼Œå¼•ç”¨å¤±æ•ˆæ—¶ï¼Œè®¡æ•°å™¨å‡ 1ã€‚å¼•ç”¨è®¡æ•°ä¸º 0 çš„å¯¹è±¡å¯è¢«å›æ”¶ã€‚&lt;/p&gt;
&lt;p&gt;æ¯”è¾ƒè½»ä¾¿ï¼Œæ•ˆç‡è¾ƒé«˜ï¼Œä¸éœ€è¦STWï¼Œå¯ä»¥å¾ˆå¿«è¿›è¡Œå›æ”¶ï¼Œä½†ç»´æŠ¤å¼•ç”¨è®¡æ•°ä¹Ÿæœ‰ä¸€å®šçš„æˆæœ¬&lt;/p&gt;
&lt;p&gt;ä½†æœ‰å¯èƒ½å‡ºç°å¾ªç¯å¼•ç”¨ï¼ŒJVMæ²¡æœ‰ä½¿ç”¨è¯¥åˆ¤æ–­ç®—æ³•ï¼Œå¯èƒ½å› ä¸ºç¼–è¯‘çš„æ—¶å€™å¹¶ä¸ä¼šæ£€æµ‹å¯¹è±¡æ˜¯å¦å­˜åœ¨å¾ªç¯å¼•ç”¨ï¼Ÿgoçš„è¯ä¼šåœ¨ç¼–è¯‘æœŸæ£€æµ‹æ˜¯å¦å­˜åœ¨å¾ªç¯å¼•ç”¨ï¼Œä½†æ˜¯å®ƒåƒåœ¾å›æ”¶ä½¿ç”¨ä¸‰è‰²æ ‡è®°æ³•ï¼Œæœ¬è´¨æ˜¯æ ‡è®°æ¸…é™¤&lt;/p&gt;
&lt;h3 id=&#34;å¤åˆ¶&#34;&gt;å¤åˆ¶&lt;/h3&gt;
&lt;h3 id=&#34;æ ‡è®°-æ¸…ç†&#34;&gt;æ ‡è®°-æ¸…ç†&lt;/h3&gt;
&lt;h3 id=&#34;æ ‡è®°---æ•´ç†&#34;&gt;æ ‡è®° - æ•´ç†&lt;/h3&gt;
&lt;h3 id=&#34;ä¸‰è‰²æ ‡è®°&#34;&gt;ä¸‰è‰²æ ‡è®°&lt;/h3&gt;
&lt;blockquote&gt;
&lt;ol&gt;
&lt;li&gt;æŠŠæ‰€æœ‰å¯¹è±¡æ”¾åˆ°ç™½è‰²çš„é›†åˆä¸­&lt;/li&gt;
&lt;li&gt;ä»æ ¹èŠ‚ç‚¹å¼€å§‹éå†å¯¹è±¡ï¼Œéå†åˆ°çš„ç™½è‰²å¯¹è±¡ä»ç™½è‰²é›†åˆä¸­æ”¾åˆ°ç°è‰²é›†åˆä¸­&lt;/li&gt;
&lt;li&gt;éå†ç°è‰²é›†åˆå¯¹è±¡ï¼ŒæŠŠç°è‰²å¯¹è±¡å¼•ç”¨çš„ç™½è‰²é›†åˆçš„å¯¹è±¡æ”¾å…¥åˆ°ç°è‰²é›†åˆä¸­ï¼ŒåŒæ—¶æŠŠéå†è¿‡çš„ç°è‰²é›†åˆä¸­çš„å¯¹è±¡æ”¾åˆ°é»‘è‰²é›†åˆä¸­&lt;/li&gt;
&lt;li&gt;å¾ªç¯æ­¥éª¤3ï¼Œç›´åˆ°ç°è‰²é›†åˆä¸­æ²¡æœ‰å¯¹è±¡&lt;/li&gt;
&lt;li&gt;æ­¥éª¤4ç»“æŸåï¼Œç™½è‰²é›†åˆä¸­çš„å¯¹è±¡ä¸ºä¸å¯è¾¾å¯¹è±¡ï¼Œè¿›è¡Œå›æ”¶&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;p&gt;å‚è€ƒï¼š&lt;a class=&#34;link&#34; href=&#34;https://segmentfault.com/a/1190000020086769&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;æ·±å…¥ç†è§£Go-åƒåœ¾å›æ”¶æœºåˆ¶&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;åƒåœ¾æ”¶é›†å™¨&#34;&gt;åƒåœ¾æ”¶é›†å™¨&lt;/h2&gt;
&lt;h3 id=&#34;cms&#34;&gt;CMS&lt;/h3&gt;
&lt;h4 id=&#34;æ‰§è¡Œè¿‡ç¨‹&#34;&gt;æ‰§è¡Œè¿‡ç¨‹&lt;/h4&gt;
&lt;blockquote&gt;
&lt;ol&gt;
&lt;li&gt;åˆå§‹æ ‡è®°(&lt;strong&gt;STW&lt;/strong&gt; initial mark)ï¼šè¿™ä¸ªè¿‡ç¨‹ä»åƒåœ¾å›æ”¶çš„&amp;quot;æ ¹å¯¹è±¡&amp;quot;å¼€å§‹ï¼Œåªæ‰«æåˆ°èƒ½å¤Ÿå’Œ&amp;quot;æ ¹å¯¹è±¡&amp;quot;ç›´æ¥å…³è”çš„å¯¹è±¡ï¼Œå¹¶ä½œæ ‡è®°ã€‚æ‰€ä»¥è¿™ä¸ªè¿‡ç¨‹è™½ç„¶æš‚åœäº†æ•´ä¸ªJVMï¼Œä½†æ˜¯å¾ˆå¿«å°±å®Œæˆäº†ã€‚&lt;/li&gt;
&lt;li&gt;å¹¶å‘æ ‡è®°(Concurrent marking)ï¼šè¿™ä¸ªé˜¶æ®µç´§éšåˆå§‹æ ‡è®°é˜¶æ®µï¼Œåœ¨åˆå§‹æ ‡è®°çš„åŸºç¡€ä¸Šç»§ç»­å‘ä¸‹è¿½æº¯æ ‡è®°ã€‚å¹¶å‘æ ‡è®°é˜¶æ®µï¼Œåº”ç”¨ç¨‹åºçš„çº¿ç¨‹å’Œå¹¶å‘æ ‡è®°çš„çº¿ç¨‹å¹¶å‘æ‰§è¡Œï¼Œæ‰€ä»¥ç”¨æˆ·ä¸ä¼šæ„Ÿå—åˆ°åœé¡¿ã€‚&lt;/li&gt;
&lt;li&gt;å¹¶å‘é¢„æ¸…ç†(Concurrent precleaning)ï¼šå¹¶å‘é¢„æ¸…ç†é˜¶æ®µä»ç„¶æ˜¯å¹¶å‘çš„ã€‚åœ¨è¿™ä¸ªé˜¶æ®µï¼Œè™šæ‹ŸæœºæŸ¥æ‰¾åœ¨æ‰§è¡Œå¹¶å‘æ ‡è®°é˜¶æ®µæ–°è¿›å…¥è€å¹´ä»£çš„å¯¹è±¡(å¯èƒ½ä¼šæœ‰ä¸€äº›å¯¹è±¡ä»æ–°ç”Ÿä»£æ™‹å‡åˆ°è€å¹´ä»£ï¼Œ æˆ–è€…æœ‰ä¸€äº›å¯¹è±¡è¢«åˆ†é…åˆ°è€å¹´ä»£)ã€‚é€šè¿‡é‡æ–°æ‰«æï¼Œå‡å°‘ä¸‹ä¸€ä¸ªé˜¶æ®µ&amp;quot;é‡æ–°æ ‡è®°&amp;quot;çš„å·¥ä½œï¼Œå› ä¸ºä¸‹ä¸€ä¸ªé˜¶æ®µä¼šStop The Worldã€‚&lt;/li&gt;
&lt;li&gt;é‡æ–°æ ‡è®°(&lt;strong&gt;STW&lt;/strong&gt; remark)ï¼šè¿™ä¸ªé˜¶æ®µä¼šæš‚åœè™šæ‹Ÿæœºï¼Œæ”¶é›†å™¨çº¿ç¨‹æ‰«æåœ¨CMSå †ä¸­å‰©ä½™çš„å¯¹è±¡ã€‚æ‰«æä»&amp;quot;è·Ÿå¯¹è±¡&amp;quot;å¼€å§‹å‘ä¸‹è¿½æº¯ï¼Œå¹¶å¤„ç†å¯¹è±¡å…³è”ã€‚&lt;/li&gt;
&lt;li&gt;å¹¶å‘æ¸…ç†(Concurrent sweeping)ï¼šæ¸…ç†åƒåœ¾å¯¹è±¡ï¼Œè¿™ä¸ªé˜¶æ®µæ”¶é›†å™¨çº¿ç¨‹å’Œåº”ç”¨ç¨‹åºçº¿ç¨‹å¹¶å‘æ‰§è¡Œã€‚&lt;/li&gt;
&lt;li&gt;å¹¶å‘é‡ç½®(Concurrent reset)ï¼šè¿™ä¸ªé˜¶æ®µï¼Œé‡ç½®CMSæ”¶é›†å™¨çš„æ•°æ®ç»“æ„çŠ¶æ€ï¼Œç­‰å¾…ä¸‹ä¸€æ¬¡åƒåœ¾å›æ”¶ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;g1&#34;&gt;G1&lt;/h3&gt;
&lt;h4 id=&#34;æ‰§è¡Œè¿‡ç¨‹-1&#34;&gt;æ‰§è¡Œè¿‡ç¨‹&lt;/h4&gt;
&lt;blockquote&gt;
&lt;ol&gt;
&lt;li&gt;æ ‡è®°é˜¶æ®µï¼šé¦–å…ˆæ˜¯åˆå§‹æ ‡è®°(Initial-Mark),è¿™ä¸ªé˜¶æ®µä¹Ÿæ˜¯åœé¡¿çš„(stop-the-word)ï¼Œå¹¶ä¸”ä¼šç¨å¸¦è§¦å‘ä¸€æ¬¡yong GCã€‚&lt;/li&gt;
&lt;li&gt;å¹¶å‘æ ‡è®°ï¼šè¿™ä¸ªè¿‡ç¨‹åœ¨æ•´ä¸ªå †ä¸­è¿›è¡Œï¼Œå¹¶ä¸”å’Œåº”ç”¨ç¨‹åºå¹¶å‘è¿è¡Œã€‚å¹¶å‘æ ‡è®°è¿‡ç¨‹å¯èƒ½è¢«yong GCä¸­æ–­ã€‚åœ¨å¹¶å‘æ ‡è®°é˜¶æ®µï¼Œå¦‚æœå‘ç°åŒºåŸŸå¯¹è±¡ä¸­çš„æ‰€æœ‰å¯¹è±¡éƒ½æ˜¯åƒåœ¾ï¼Œé‚£ä¸ªè¿™ä¸ªåŒºåŸŸä¼šè¢«ç«‹å³å›æ”¶(å›¾ä¸­æ‰“X)ã€‚åŒæ—¶ï¼Œå¹¶å‘æ ‡è®°è¿‡ç¨‹ä¸­ï¼Œæ¯ä¸ªåŒºåŸŸçš„å¯¹è±¡æ´»æ€§(åŒºåŸŸä¸­å­˜æ´»å¯¹è±¡çš„æ¯”ä¾‹)è¢«è®¡ç®—ã€‚&lt;/li&gt;
&lt;li&gt;å†æ ‡è®°ï¼šè¿™ä¸ªé˜¶æ®µæ˜¯ç”¨æ¥è¡¥å……æ”¶é›†å¹¶å‘æ ‡è®°é˜¶æ®µäº§æ–°çš„æ–°åƒåœ¾ã€‚ä¸ä¹‹ä¸åŒçš„æ˜¯ï¼ŒG1ä¸­é‡‡ç”¨äº†æ›´å¿«çš„ç®—æ³•:SATBã€‚&lt;/li&gt;
&lt;li&gt;æ¸…ç†é˜¶æ®µï¼šé€‰æ‹©æ´»æ€§ä½çš„åŒºåŸŸ(åŒæ—¶è€ƒè™‘åœé¡¿æ—¶é—´)ï¼Œç­‰å¾…ä¸‹æ¬¡yong GCä¸€èµ·æ”¶é›†ï¼Œå¯¹åº”GC log: [GC pause (mixed)]ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¹Ÿä¼šæœ‰åœé¡¿(STW)ã€‚&lt;/li&gt;
&lt;li&gt;å›æ”¶/å®Œæˆï¼šæ–°çš„yong GCæ¸…ç†è¢«è®¡ç®—å¥½çš„åŒºåŸŸã€‚ä½†æ˜¯æœ‰ä¸€äº›åŒºåŸŸè¿˜æ˜¯å¯èƒ½å­˜åœ¨åƒåœ¾å¯¹è±¡ï¼Œå¯èƒ½æ˜¯è¿™äº›åŒºåŸŸä¸­å¯¹è±¡æ´»æ€§è¾ƒé«˜ï¼Œå›æ”¶ä¸åˆ’ç®—ï¼Œä¹Ÿè‚¯èƒ½æ˜¯ä¸ºäº†è¿åˆç”¨æˆ·è®¾ç½®çš„æ—¶é—´ï¼Œä¸å¾—ä¸èˆå¼ƒä¸€äº›åŒºåŸŸçš„æ”¶é›†ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;å†…å­˜åˆ†é…å’Œå›æ”¶ç­–ç•¥&#34;&gt;å†…å­˜åˆ†é…å’Œå›æ”¶ç­–ç•¥&lt;/h2&gt;
&lt;blockquote&gt;
&lt;h4 id=&#34;1-å¯¹è±¡ä¼˜å…ˆåœ¨-eden-åˆ†é…&#34;&gt;1. å¯¹è±¡ä¼˜å…ˆåœ¨ Eden åˆ†é…&lt;/h4&gt;
&lt;p&gt;å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå¯¹è±¡åœ¨æ–°ç”Ÿä»£ Eden ä¸Šåˆ†é…ï¼Œå½“ Eden ç©ºé—´ä¸å¤Ÿæ—¶ï¼Œå‘èµ· Minor GCã€‚&lt;/p&gt;
&lt;h4 id=&#34;2-å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£&#34;&gt;2. å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£&lt;/h4&gt;
&lt;p&gt;å¤§å¯¹è±¡æ˜¯æŒ‡éœ€è¦è¿ç»­å†…å­˜ç©ºé—´çš„å¯¹è±¡ï¼Œæœ€å…¸å‹çš„å¤§å¯¹è±¡æ˜¯é‚£ç§å¾ˆé•¿çš„å­—ç¬¦ä¸²ä»¥åŠæ•°ç»„ã€‚&lt;/p&gt;
&lt;p&gt;ç»å¸¸å‡ºç°å¤§å¯¹è±¡ä¼šæå‰è§¦å‘åƒåœ¾æ”¶é›†ä»¥è·å–è¶³å¤Ÿçš„è¿ç»­ç©ºé—´åˆ†é…ç»™å¤§å¯¹è±¡ã€‚&lt;/p&gt;
&lt;p&gt;-XX:PretenureSizeThresholdï¼Œå¤§äºæ­¤å€¼çš„å¯¹è±¡ç›´æ¥åœ¨è€å¹´ä»£åˆ†é…ï¼Œé¿å…åœ¨ Eden å’Œ Survivor ä¹‹é—´çš„å¤§é‡å†…å­˜å¤åˆ¶ã€‚&lt;/p&gt;
&lt;h4 id=&#34;3-é•¿æœŸå­˜æ´»çš„å¯¹è±¡è¿›å…¥è€å¹´ä»£&#34;&gt;3. é•¿æœŸå­˜æ´»çš„å¯¹è±¡è¿›å…¥è€å¹´ä»£&lt;/h4&gt;
&lt;p&gt;ä¸ºå¯¹è±¡å®šä¹‰å¹´é¾„è®¡æ•°å™¨ï¼Œå¯¹è±¡åœ¨ Eden å‡ºç”Ÿå¹¶ç»è¿‡ Minor GC ä¾ç„¶å­˜æ´»ï¼Œå°†ç§»åŠ¨åˆ° Survivor ä¸­ï¼Œå¹´é¾„å°±å¢åŠ  1 å²ï¼Œå¢åŠ åˆ°ä¸€å®šå¹´é¾„åˆ™ç§»åŠ¨åˆ°è€å¹´ä»£ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;-XX:MaxTenuringThreshold ç”¨æ¥å®šä¹‰å¹´é¾„çš„é˜ˆå€¼ã€‚&lt;/p&gt;
&lt;h4 id=&#34;4-åŠ¨æ€å¯¹è±¡å¹´é¾„åˆ¤å®š&#34;&gt;4. åŠ¨æ€å¯¹è±¡å¹´é¾„åˆ¤å®š&lt;/h4&gt;
&lt;p&gt;è™šæ‹Ÿæœºå¹¶ä¸æ˜¯æ°¸è¿œè¦æ±‚å¯¹è±¡çš„å¹´é¾„å¿…é¡»è¾¾åˆ° MaxTenuringThreshold æ‰èƒ½æ™‹å‡è€å¹´ä»£ï¼Œå¦‚æœåœ¨ Survivor ä¸­ç›¸åŒå¹´é¾„æ‰€æœ‰å¯¹è±¡å¤§å°çš„æ€»å’Œå¤§äº Survivor ç©ºé—´çš„ä¸€åŠï¼Œåˆ™å¹´é¾„å¤§äºæˆ–ç­‰äºè¯¥å¹´é¾„çš„å¯¹è±¡å¯ä»¥ç›´æ¥è¿›å…¥è€å¹´ä»£ï¼Œæ— éœ€ç­‰åˆ° MaxTenuringThreshold ä¸­è¦æ±‚çš„å¹´é¾„ã€‚&lt;/p&gt;
&lt;h4 id=&#34;5-ç©ºé—´åˆ†é…æ‹…ä¿&#34;&gt;5. ç©ºé—´åˆ†é…æ‹…ä¿&lt;/h4&gt;
&lt;p&gt;åœ¨å‘ç”Ÿ Minor GC ä¹‹å‰ï¼Œè™šæ‹Ÿæœºå…ˆæ£€æŸ¥è€å¹´ä»£æœ€å¤§å¯ç”¨çš„è¿ç»­ç©ºé—´æ˜¯å¦å¤§äºæ–°ç”Ÿä»£æ‰€æœ‰å¯¹è±¡æ€»ç©ºé—´ï¼Œå¦‚æœæ¡ä»¶æˆç«‹çš„è¯ï¼Œé‚£ä¹ˆ Minor GC å¯ä»¥ç¡®è®¤æ˜¯å®‰å…¨çš„ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä¸æˆç«‹çš„è¯è™šæ‹Ÿæœºä¼šæŸ¥çœ‹ HandlePromotionFailure çš„å€¼æ˜¯å¦å…è®¸æ‹…ä¿å¤±è´¥ï¼Œå¦‚æœå…è®¸é‚£ä¹ˆå°±ä¼šç»§ç»­æ£€æŸ¥è€å¹´ä»£æœ€å¤§å¯ç”¨çš„è¿ç»­ç©ºé—´æ˜¯å¦å¤§äºå†æ¬¡æ™‹å‡åˆ°è€å¹´ä»£å¯¹è±¡çš„å¹³å‡å¤§å°ï¼Œå¦‚æœå¤§äºï¼Œå°†å°è¯•ç€è¿›è¡Œä¸€æ¬¡ Minor GCï¼›å¦‚æœå°äºï¼Œæˆ–è€… HandlePromotionFailure çš„å€¼ä¸å…è®¸å†’é™©ï¼Œé‚£ä¹ˆå°±è¦è¿›è¡Œä¸€æ¬¡ Full GCã€‚&lt;/p&gt;
&lt;h3 id=&#34;full-gc-çš„è§¦å‘æ¡ä»¶&#34;&gt;Full GC çš„è§¦å‘æ¡ä»¶&lt;/h3&gt;
&lt;p&gt;å¯¹äº Minor GCï¼Œå…¶è§¦å‘æ¡ä»¶éå¸¸ç®€å•ï¼Œå½“ Eden ç©ºé—´æ»¡æ—¶ï¼Œå°±å°†è§¦å‘ä¸€æ¬¡ Minor GCã€‚è€Œ Full GC åˆ™ç›¸å¯¹å¤æ‚ï¼Œæœ‰ä»¥ä¸‹æ¡ä»¶ï¼š&lt;/p&gt;
&lt;h4 id=&#34;1-è°ƒç”¨-systemgc&#34;&gt;1. è°ƒç”¨ System.gc()&lt;/h4&gt;
&lt;p&gt;åªæ˜¯å»ºè®®è™šæ‹Ÿæœºæ‰§è¡Œ Full GCï¼Œä½†æ˜¯è™šæ‹Ÿæœºä¸ä¸€å®šçœŸæ­£å»æ‰§è¡Œã€‚ä¸å»ºè®®ä½¿ç”¨è¿™ç§æ–¹å¼ï¼Œè€Œæ˜¯è®©è™šæ‹Ÿæœºç®¡ç†å†…å­˜ã€‚&lt;/p&gt;
&lt;h4 id=&#34;2-è€å¹´ä»£ç©ºé—´ä¸è¶³&#34;&gt;2. è€å¹´ä»£ç©ºé—´ä¸è¶³&lt;/h4&gt;
&lt;p&gt;è€å¹´ä»£ç©ºé—´ä¸è¶³çš„å¸¸è§åœºæ™¯ä¸ºå‰æ–‡æ‰€è®²çš„å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£ã€é•¿æœŸå­˜æ´»çš„å¯¹è±¡è¿›å…¥è€å¹´ä»£ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†é¿å…ä»¥ä¸ŠåŸå› å¼•èµ·çš„ Full GCï¼Œåº”å½“å°½é‡ä¸è¦åˆ›å»ºè¿‡å¤§çš„å¯¹è±¡ä»¥åŠæ•°ç»„ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå¯ä»¥é€šè¿‡ -Xmn è™šæ‹Ÿæœºå‚æ•°è°ƒå¤§æ–°ç”Ÿä»£çš„å¤§å°ï¼Œè®©å¯¹è±¡å°½é‡åœ¨æ–°ç”Ÿä»£è¢«å›æ”¶æ‰ï¼Œä¸è¿›å…¥è€å¹´ä»£ã€‚è¿˜å¯ä»¥é€šè¿‡ -XX:MaxTenuringThreshold è°ƒå¤§å¯¹è±¡è¿›å…¥è€å¹´ä»£çš„å¹´é¾„ï¼Œè®©å¯¹è±¡åœ¨æ–°ç”Ÿä»£å¤šå­˜æ´»ä¸€æ®µæ—¶é—´ã€‚&lt;/p&gt;
&lt;h4 id=&#34;3-ç©ºé—´åˆ†é…æ‹…ä¿å¤±è´¥&#34;&gt;3. ç©ºé—´åˆ†é…æ‹…ä¿å¤±è´¥&lt;/h4&gt;
&lt;p&gt;ä½¿ç”¨å¤åˆ¶ç®—æ³•çš„ Minor GC éœ€è¦è€å¹´ä»£çš„å†…å­˜ç©ºé—´ä½œæ‹…ä¿ï¼Œå¦‚æœæ‹…ä¿å¤±è´¥ä¼šæ‰§è¡Œä¸€æ¬¡ Full GCã€‚å…·ä½“å†…å®¹è¯·å‚è€ƒä¸Šé¢çš„ç¬¬ 5 å°èŠ‚ã€‚&lt;/p&gt;
&lt;h4 id=&#34;4-jdk-17-åŠä»¥å‰çš„æ°¸ä¹…ä»£ç©ºé—´ä¸è¶³&#34;&gt;4. JDK 1.7 åŠä»¥å‰çš„æ°¸ä¹…ä»£ç©ºé—´ä¸è¶³&lt;/h4&gt;
&lt;p&gt;åœ¨ JDK 1.7 åŠä»¥å‰ï¼ŒHotSpot è™šæ‹Ÿæœºä¸­çš„æ–¹æ³•åŒºæ˜¯ç”¨æ°¸ä¹…ä»£å®ç°çš„ï¼Œæ°¸ä¹…ä»£ä¸­å­˜æ”¾çš„ä¸ºä¸€äº› Class çš„ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ç­‰æ•°æ®ã€‚&lt;/p&gt;
&lt;p&gt;å½“ç³»ç»Ÿä¸­è¦åŠ è½½çš„ç±»ã€åå°„çš„ç±»å’Œè°ƒç”¨çš„æ–¹æ³•è¾ƒå¤šæ—¶ï¼Œæ°¸ä¹…ä»£å¯èƒ½ä¼šè¢«å æ»¡ï¼Œåœ¨æœªé…ç½®ä¸ºé‡‡ç”¨ CMS GC çš„æƒ…å†µä¸‹ä¹Ÿä¼šæ‰§è¡Œ Full GCã€‚å¦‚æœç»è¿‡ Full GC ä»ç„¶å›æ”¶ä¸äº†ï¼Œé‚£ä¹ˆè™šæ‹Ÿæœºä¼šæŠ›å‡º java.lang.OutOfMemoryErrorã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºé¿å…ä»¥ä¸ŠåŸå› å¼•èµ·çš„ Full GCï¼Œå¯é‡‡ç”¨çš„æ–¹æ³•ä¸ºå¢å¤§æ°¸ä¹…ä»£ç©ºé—´æˆ–è½¬ä¸ºä½¿ç”¨ CMS GCã€‚&lt;/p&gt;
&lt;h4 id=&#34;5-concurrent-mode-failure&#34;&gt;5. Concurrent Mode Failure&lt;/h4&gt;
&lt;p&gt;æ‰§è¡Œ CMS GC çš„è¿‡ç¨‹ä¸­åŒæ—¶æœ‰å¯¹è±¡è¦æ”¾å…¥è€å¹´ä»£ï¼Œè€Œæ­¤æ—¶è€å¹´ä»£ç©ºé—´ä¸è¶³ï¼ˆå¯èƒ½æ˜¯ GC è¿‡ç¨‹ä¸­æµ®åŠ¨åƒåœ¾è¿‡å¤šå¯¼è‡´æš‚æ—¶æ€§çš„ç©ºé—´ä¸è¶³ï¼‰ï¼Œä¾¿ä¼šæŠ¥ Concurrent Mode Failure é”™è¯¯ï¼Œå¹¶è§¦å‘ Full GCã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;ä¸ºä»€ä¹ˆæœ‰äº† å¯¹è±¡è¾¾åˆ°å¹´é¾„é™åˆ¶åæ™‹å‡çš„æœºåˆ¶ è¿˜è¦æœ‰ åŠ¨æ€å¹´é¾„åˆ¤å®šçš„æœºåˆ¶&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚æœMaxTenuringThresholdè®¾ç½®è¿‡å¤§ï¼Œä¼šå¯¼è‡´æœ¬è¯¥æ™‹å‡åˆ°è€å¹´ä»£çš„å¯¹è±¡ä¸€ç›´åœç•™åœ¨SurvivoråŒºï¼Œç›´åˆ°Survivoræº¢å‡ºï¼Œè¿™æ ·å¯¹è±¡è€åŒ–æœºåˆ¶å°±å¤±æ•ˆäº†&lt;/li&gt;
&lt;li&gt;å¦‚æœMaxTenuringThresholdè®¾ç½®è¿‡å°ï¼Œè¿‡æ—©æ™‹å‡çš„å¯¹è±¡ä¸èƒ½åœ¨å¹´è½»ä»£å……åˆ†å›æ”¶ï¼Œå¤§é‡å¯¹è±¡è¿›å…¥è€å¹´ä»£ï¼Œä¼šå¼•èµ·é¢‘ç¹çš„Major GC&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;å…³äºMinorGCã€Majorã€YoungGCã€FullGCçš„è¯´æ˜&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;MinorGCï¼šæ¸…ç†å¹´è½»ä»£ï¼Œç­‰åŒäºYoungGCï¼Œå«æ³•ä¸åŒè€Œå·²&lt;/li&gt;
&lt;li&gt;MajorGCï¼šæ¸…ç†è€å¹´ä»£&lt;/li&gt;
&lt;li&gt;FullGCï¼šæ¸…ç†æ•´ä¸ªå †ç©ºé—´ - åŒ…æ‹¬å¹´è½»ä»£å’Œè€å¹´ä»£&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;è°ƒä¼˜&#34;&gt;è°ƒä¼˜&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;JVMè°ƒä¼˜ï¼Œä¸€èˆ¬æ˜¯ä»£ç å·²ç»ä¼˜åŒ–åˆ°äº†ä¸€å®šç¨‹åº¦äº†ï¼Œåˆ°äº†æœ€åé˜¶æ®µæ‰ä¼šè¿›è¡ŒJVMè°ƒä¼˜&lt;/li&gt;
&lt;li&gt;å¯¹äºMinor GCå’ŒMajor GCé¢‘ç¹çš„ä¼˜åŒ–ï¼Œæ‰©å¤§EdenåŒºï¼Œè™½ç„¶å¯ä»¥é™ä½Minor GCæ¬¡æ•°ï¼Œä½†ç”±äºæ‰«æçš„åŒºåŸŸå˜å¤§äº†ï¼ŒMinor GCæ—¶é—´å¯èƒ½ä¼šå˜é•¿ï¼Œä½†è¿™ç‚¹å½±æ¯” å½“å¯¹è±¡gcåä»ç„¶å­˜æ´»ï¼Œéœ€è¦å¤åˆ¶åˆ°SurvivoråŒºå¸¦æ¥çš„å½±å“è¦å°ï¼Œå½±å“Minor GCæ¬¡æ•°å’Œæ—¶é—´çš„å› ç´ æ˜¯æ¯æ¬¡GCåå¯¹è±¡çš„å­˜æ´»æ•°é‡ï¼Œå› æ­¤å¯¹äºçŸ­æœŸå¯¹è±¡è¾ƒå¤šæ—¶ï¼Œå¢åŠ EdenåŒºå¤§å°ï¼ŒåŒç†ï¼Œå¦‚æœå¯¹è±¡å­˜æ´»æ—¶é—´æ¯”è¾ƒé•¿ã€å¯¹è±¡è¾ƒå¤šæ—¶ï¼Œå¢åŠ è€å¹´ä»£å¤§å°&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;å¸¸ç”¨å‚æ•°&#34;&gt;å¸¸ç”¨å‚æ•°&lt;/h2&gt;
&lt;p&gt;åªåˆ—ä¸¾äº†å¸¸è§çš„ï¼Œå‚æ•°å¤§è‡´åˆ†ä¸ºä¸‰ç±»ï¼š&lt;/p&gt;
&lt;h3 id=&#34;è¡Œä¸ºå‚æ•°æ”¹å˜jvmåŸºç¡€è¡Œä¸º&#34;&gt;è¡Œä¸ºå‚æ•°ï¼šæ”¹å˜JVMåŸºç¡€è¡Œä¸º&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;å‚æ•°&lt;/th&gt;
&lt;th&gt;å«ä¹‰&lt;/th&gt;
&lt;th&gt;è¯´æ˜&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;-XX:+ScavengeBeforeFullGC&lt;/td&gt;
&lt;td&gt;FullGCå‰è§¦å‘ä¸€æ¬¡MinorGC&lt;/td&gt;
&lt;td&gt;é»˜è®¤å¯ç”¨&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;-XX:+UseGCOverheadLimit&lt;/td&gt;
&lt;td&gt;GCè€—æ—¶è¿‡é•¿ï¼Œä¼šè·‘OOM&lt;/td&gt;
&lt;td&gt;é»˜è®¤å¯ç”¨&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;-XX:-UseConcMarkSweepGC&lt;/td&gt;
&lt;td&gt;ä½¿ç”¨CMSä½åœé¡¿åƒåœ¾æ”¶é›†å™¨ï¼Œå‡å°‘FullGCæš‚åœæ—¶é—´&lt;/td&gt;
&lt;td&gt;é»˜è®¤ä¸å¯ç”¨&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;-XX:-UseParallelGC&lt;/td&gt;
&lt;td&gt;å¯ç”¨å¹¶è¡ŒGC&lt;/td&gt;
&lt;td&gt;é»˜è®¤ä¸å¯ç”¨&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;-XX:-UseParallelOldGC&lt;/td&gt;
&lt;td&gt;å¹´è½»ä»£å’Œè€å¹´ä»£éƒ½ä½¿ç”¨å¹¶è¡Œåƒåœ¾æ”¶é›†å™¨&lt;/td&gt;
&lt;td&gt;é»˜è®¤ä¸å¯ç”¨ï¼Œå½“-XX:-UseParallelGCå¯ç”¨æ—¶è¯¥é¡¹è‡ªåŠ¨å¯ç”¨&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;-XX:-UseSerialGC&lt;/td&gt;
&lt;td&gt;å¯ç”¨ä¸²è¡Œåƒåœ¾æ”¶é›†å™¨&lt;/td&gt;
&lt;td&gt;-Clientæ—¶å¯ç”¨ï¼Œé»˜è®¤ä¸å¯ç”¨&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;-XX:+UseThreadPriorities&lt;/td&gt;
&lt;td&gt;å¯ç”¨æœ¬åœ°çº¿ç¨‹ä¼˜å…ˆçº§&lt;/td&gt;
&lt;td&gt;é»˜è®¤å¯ç”¨&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;æ€§èƒ½è°ƒä¼˜jvmæ€§èƒ½è°ƒä¼˜å‚æ•°&#34;&gt;æ€§èƒ½è°ƒä¼˜ï¼šJVMæ€§èƒ½è°ƒä¼˜å‚æ•°&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;å‚æ•°&lt;/th&gt;
&lt;th&gt;å«ä¹‰&lt;/th&gt;
&lt;th&gt;è¯´æ˜ï¼Œæœ‰äº›é»˜è®¤å€¼åœ¨ä¸åŒç¯å¢ƒä¸‹æ˜¯ä¸åŒçš„&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;-Xms&lt;/td&gt;
&lt;td&gt;æ•´ä¸ªå †çš„åˆå§‹å¤§å°&lt;/td&gt;
&lt;td&gt;é»˜è®¤å€¼ï¼šç‰©ç†å†…å­˜çš„1/64&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;-Xmx&lt;/td&gt;
&lt;td&gt;æ•´ä¸ªå †çš„æœ€å¤§å€¼&lt;/td&gt;
&lt;td&gt;é»˜è®¤å€¼ï¼šç‰©ç†å†…å­˜çš„1/4&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;-Xmn&lt;/td&gt;
&lt;td&gt;å¹´è½»ä»£å¤§å°&lt;/td&gt;
&lt;td&gt;è®¾ç½®è¯¥å€¼ç­‰åŒäºè®¾ç½®äº†-XX:NewSizeå’Œ-XX:MaxNewSizeï¼Œä¸”ä¸¤è€…ç›¸ç­‰ï¼Œå®˜æ–¹æ¨èæ˜¯æ•´ä¸ªå †çš„3/8&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;-XX:NewSize&lt;/td&gt;
&lt;td&gt;å¹´è½»ä»£å¤§å°&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;-XX:MaxNewSize&lt;/td&gt;
&lt;td&gt;å¹´è½»ä»£æœ€å¤§å€¼&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;-Xss&lt;/td&gt;
&lt;td&gt;æ¯ä¸ªçº¿ç¨‹çš„æ ˆå¤§å°&lt;/td&gt;
&lt;td&gt;JDK1.5ä»¥åè¯¥å€¼é»˜è®¤ä¸º1M&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;-XX:PermSize&lt;/td&gt;
&lt;td&gt;æ°¸ä¹…ä»£å¤§å°&lt;/td&gt;
&lt;td&gt;é»˜è®¤å€¼ï¼šç‰©ç†å†…å­˜çš„1/64&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;-XX:MaxPermSize&lt;/td&gt;
&lt;td&gt;æ°¸ä¹…ä»£æœ€å¤§å€¼&lt;/td&gt;
&lt;td&gt;é»˜è®¤å€¼ï¼šç‰©ç†å†…å­˜çš„1/4&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;-XX:NewRatio&lt;/td&gt;
&lt;td&gt;å¹´è½»ä»£ä¸è€å¹´ä»£çš„æ¯”å€¼&lt;/td&gt;
&lt;td&gt;é»˜è®¤å€¼ï¼š2ï¼Œå¹´è½»ä»£åŒ…æ‹¬EdenåŒºå’Œä¸¤ä¸ªSurvivoråŒºï¼Œè€å¹´ä»£ä¸åŒ…æ‹¬æ°¸ä¹…ä»£ã€‚æ¯”å¦‚=4ï¼Œè¡¨ç¤ºå¹´è½»ä»£ï¼šè€å¹´ä»£=1ï¼š4ï¼Œå³å¹´è½»ä»£å æ•´ä¸ªå †çš„1/5&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;-XX:SurvivorRatio&lt;/td&gt;
&lt;td&gt;å¹´è½»ä»£é‡ŒEdenåŒºä¸ä¸¤ä¸ªSurvivorçš„æ¯”å€¼&lt;/td&gt;
&lt;td&gt;é»˜è®¤å€¼ï¼š8ï¼Œè¡¨ç¤ºä¸€ä¸ªEdenåŒºï¼šä¸¤ä¸ªSurvivoråŒºçš„æ¯”å€¼æ˜¯8ï¼š2ï¼Œä¸€ä¸ªSurvivoråŒºå æ•´ä¸ªå¹´è½»ä»£çš„1/10&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;-XX:SoftRefLRUPolicyMSPerMB&lt;/td&gt;
&lt;td&gt;æ¯å…†å †ç©ºé—²ç©ºé—´ä¸­è½¯å¼•ç”¨çš„å­˜æ´»æ—¶é—´&lt;/td&gt;
&lt;td&gt;é»˜è®¤å€¼ï¼š1s&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;-XX:MaxTenuringThreshold&lt;/td&gt;
&lt;td&gt;å¯¹è±¡åœ¨å¹´è½»ä»£çš„æœ€å¤§å¹´é¾„&lt;/td&gt;
&lt;td&gt;é»˜è®¤å€¼ï¼š15ï¼Œå³å¯¹è±¡åœ¨å¹´è½»ä»£ç†¬è¿‡äº†15æ¬¡Minor GCï¼Œè¾¾åˆ°é˜ˆå€¼åæ™‹å‡åˆ°è€å¹´ä»£ã€‚=0æ—¶ï¼Œå¯¹è±¡åˆå§‹åŒ–ç›´æ¥è¿›å…¥è€å¹´ä»£&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;-XX:PretenureSizeThreshold&lt;/td&gt;
&lt;td&gt;å¯¹è±¡è¶…è¿‡å¤šå¤§ç›´æ¥åœ¨è€å¹´ä»£ä¸­åˆ†é…&lt;/td&gt;
&lt;td&gt;é»˜è®¤å€¼ï¼š0&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;-XX:TLABWasteTargetPercent&lt;/td&gt;
&lt;td&gt;TLAB(çº¿ç¨‹æœ¬åœ°ç¼“å†²åŒº)å EdenåŒºçš„æ¯”ä¾‹&lt;/td&gt;
&lt;td&gt;é»˜è®¤å€¼ï¼š1%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;-XX:+CollectGen0First&lt;/td&gt;
&lt;td&gt;FullGCæ—¶æ˜¯å¦å…ˆYGC&lt;/td&gt;
&lt;td&gt;é»˜è®¤å€¼ï¼šfalse&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;-XX:MinHeapFreeRatio&lt;/td&gt;
&lt;td&gt;GCåå †ä¸­ç©ºé—²é‡å çš„æœ€å°æ¯”ä¾‹&lt;/td&gt;
&lt;td&gt;é»˜è®¤å€¼ï¼š40&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;-XX:MaxHeapFreeRatio&lt;/td&gt;
&lt;td&gt;GCåå †ä¸­ç©ºé—²é‡å çš„æœ€å¤§æ¯”ä¾‹&lt;/td&gt;
&lt;td&gt;é»˜è®¤å€¼ï¼š70ï¼ŒGCåï¼Œå¦‚æœå‘ç°ç©ºé—²å †å†…å­˜å åˆ°æ•´ä¸ªé¢„ä¼°ä¸Šé™å€¼çš„70%ï¼Œåˆ™æ”¶ç¼©é¢„ä¼°ä¸Šé™å€¼&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;-XX:PreBlockSpin&lt;/td&gt;
&lt;td&gt;è‡ªæ—‹é”è‡ªé€‰æ¬¡æ•°ï¼Œ-XX:+UseSpinningéœ€è¦å…ˆå¯ç”¨&lt;/td&gt;
&lt;td&gt;-XX:+UseSpinningé»˜è®¤å¯ç”¨ï¼Œè‡ªæ—‹æ¬¡æ•°é»˜è®¤å€¼ï¼š10æ¬¡&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;è°ƒè¯•å‚æ•°æ‰“å¼€å †æ ˆè·Ÿè¸ªæ‰“å°è¾“å‡ºjvmå‚æ•°æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯&#34;&gt;è°ƒè¯•å‚æ•°ï¼šæ‰“å¼€å †æ ˆè·Ÿè¸ªã€æ‰“å°ã€è¾“å‡ºJVMå‚æ•°ï¼Œæ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;å‚æ•°&lt;/th&gt;
&lt;th&gt;å«ä¹‰&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;-XX:ErrorFile=æ—¥å¿—è·¯å¾„/æ—¥å¿—æ–‡ä»¶åç§°.log&lt;/td&gt;
&lt;td&gt;ä¿å­˜é”™è¯¯æ—¥å¿—æˆ–è€…æ•°æ®åˆ°æ–‡ä»¶ä¸­&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;-XX:HeapDumpPath=å †ä¿¡æ¯æ–‡ä»¶è·¯å¾„/æ–‡ä»¶åç§°.hprof&lt;/td&gt;
&lt;td&gt;æŒ‡å®šå¯¼å‡ºå †ä¿¡æ¯æ—¶çš„è·¯å¾„æˆ–æ–‡ä»¶å&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;-XX:-HeapDumpOnOutOfMemoryError&lt;/td&gt;
&lt;td&gt;å½“é¦–æ¬¡é­é‡OOMæ—¶å¯¼å‡ºæ­¤æ—¶å †ä¸­ç›¸å…³ä¿¡æ¯&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;-XX:-PrintGC&lt;/td&gt;
&lt;td&gt;æ¯æ¬¡GCæ—¶æ‰“å°ç›¸å…³ä¿¡æ¯&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;-XX:-PrintGCDetails&lt;/td&gt;
&lt;td&gt;æ¯æ¬¡GCæ—¶æ‰“å°è¯¦ç»†ä¿¡æ¯&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;-XX:-PrintGCTimeStamps&lt;/td&gt;
&lt;td&gt;æ‰“å°æ¯æ¬¡GCçš„æ—¶é—´æˆ³&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;-XX:-TraceClassLoading&lt;/td&gt;
&lt;td&gt;è·Ÿè¸ªç±»çš„åŠ è½½ä¿¡æ¯&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;-XX:-TraceClassLoadingPreorder&lt;/td&gt;
&lt;td&gt;è·Ÿè¸ªè¢«å¼•ç”¨åˆ°çš„æ‰€æœ‰ç±»çš„åŠ è½½ä¿¡æ¯&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;-XX:-TraceClassResolution&lt;/td&gt;
&lt;td&gt;è·Ÿè¸ªå¸¸é‡æ± &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;-XX:-TraceClassUnloading&lt;/td&gt;
&lt;td&gt;è·Ÿè¸ªç±»çš„å¸è½½ä¿¡æ¯&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id=&#34;è°ƒä¼˜å·¥å…·&#34;&gt;è°ƒä¼˜å·¥å…·&lt;/h2&gt;
&lt;h3 id=&#34;å‘½ä»¤è¡Œå·¥å…·&#34;&gt;å‘½ä»¤è¡Œå·¥å…·&lt;/h3&gt;
&lt;h4 id=&#34;jpsè™šæ‹Ÿæœºè¿›ç¨‹çŠ¶å†µå·¥å…·&#34;&gt;jpsï¼šè™šæ‹Ÿæœºè¿›ç¨‹çŠ¶å†µå·¥å…·&lt;/h4&gt;
&lt;p&gt;ç”¨æ¥æŸ¥çœ‹æœºå™¨ä¸Šçš„Javaè¿›ç¨‹ï¼Œå¦‚pidï¼Œå¯åŠ¨æ—¶çš„JVMå‚æ•°ï¼Œå¯åŠ¨æ—¶çš„ä¸»ç±»ã€jaråŒ…å…¨è·¯å¾„åç§°ï¼Œç±»ä¼¼pså‘½ä»¤&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;æ— å‚æ•°ï¼šæ˜¾ç¤ºè¿›ç¨‹IDå’Œç±»åç§°
-qï¼šåªè¾“å‡ºè¿›ç¨‹ID
-mï¼šè¾“å‡ºä¼ å…¥ main æ–¹æ³•çš„å‚æ•°ï¼Œå³mainæ–¹æ³•çš„String[] args
-lï¼šè¾“å‡ºå®Œå…¨çš„åŒ…åï¼Œåº”ç”¨ä¸»ç±»åï¼Œjarçš„å®Œå…¨è·¯å¾„å
-vï¼šè¾“å‡ºå¯åŠ¨æ—¶å¸¦çš„jvmå‚æ•°
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id=&#34;jstatè™šæ‹Ÿæœºç»Ÿè®¡ä¿¡æ¯ç›‘è§†å·¥å…·&#34;&gt;jstatï¼šè™šæ‹Ÿæœºç»Ÿè®¡ä¿¡æ¯ç›‘è§†å·¥å…·&lt;/h4&gt;
&lt;p&gt;ä¸€èˆ¬ç”¨æ¥æŸ¥çœ‹å †å†…gcæƒ…å†µï¼Œæ¯”å¦‚å¹´è½»ä»£ã€è€å¹´ä»£å¤§å°ã€YGCæ¬¡æ•°ï¼Œå¹³å‡è€—æ—¶ç­‰&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.jianshu.com/p/213710fb9e40&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://www.jianshu.com/p/213710fb9e40&lt;/a&gt;&lt;/p&gt;
&lt;h4 id=&#34;jmapjavaå†…å­˜å°è±¡å·¥å…·&#34;&gt;jmapï¼šJavaå†…å­˜å°è±¡å·¥å…·&lt;/h4&gt;
&lt;p&gt;ç”¨æ¥æŸ¥çœ‹å †å†…å­˜çš„ä½¿ç”¨æƒ…å†µï¼Œæ¯”å¦‚è¾“å‡ºå†…å­˜ä¸­çš„æ‰€æœ‰å¯¹è±¡ï¼Œå¯ä»¥é…åˆeclipse MATåˆ†æå†…å­˜æ³„æ¼æƒ…å†µ&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.cnblogs.com/huanglog/p/10302901.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://www.cnblogs.com/huanglog/p/10302901.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;å®˜æ–¹çš„ï¼šhttps://docs.oracle.com/javase/7/docs/technotes/tools/share/jstat.html&lt;/p&gt;
&lt;h4 id=&#34;jhatè™šæ‹Ÿæœºå †è½¬å‚¨å¿«ç…§åˆ†æå·¥å…·&#34;&gt;jhatï¼šè™šæ‹Ÿæœºå †è½¬å‚¨å¿«ç…§åˆ†æå·¥å…·&lt;/h4&gt;
&lt;p&gt;åˆ†æç”±jmapå¯¼å‡ºæ¥çš„å †dumpæ–‡ä»¶ï¼Œä½œç”¨ç±»ä¼¼Eclipse MATï¼Œä½†æ˜¯æ²¡MATç›´è§‚&lt;/p&gt;
&lt;h4 id=&#34;jstackjavaå †æ ˆè·Ÿè¸ªå·¥å…·&#34;&gt;jstackï¼šJavaå †æ ˆè·Ÿè¸ªå·¥å…·&lt;/h4&gt;
&lt;p&gt;æŸ¥çœ‹æ–¹æ³•æˆ–çº¿ç¨‹çš„æ‰§è¡Œæƒ…å†µï¼Œçº¿ç¨‹çš„å †æ ˆä¿¡æ¯ï¼Œæ­»é”æ£€æµ‹ï¼Œæ­»é”åŸå› &lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://blog.csdn.net/wufaliang003/article/details/80414267&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://blog.csdn.net/wufaliang003/article/details/80414267&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;å®˜æ–¹ï¼šhttps://docs.oracle.com/javase/7/docs/technotes/tools/share/jstack.html&lt;/p&gt;
&lt;h4 id=&#34;jinfojavaé…ç½®ä¿¡æ¯å·¥å…·&#34;&gt;jinfoï¼šJavaé…ç½®ä¿¡æ¯å·¥å…·&lt;/h4&gt;
&lt;p&gt;å®æ—¶æŸ¥çœ‹å’Œè°ƒæ•´JVMå„é¡¹å‚æ•°é…ç½®ï¼Œè¿›ç¨‹è¿è¡Œæ—¶ä¹Ÿèƒ½æ”¹JVMçš„é…ç½®&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;jinfo -sysprops [pid] æŸ¥çœ‹å½“å‰JVMå…¨éƒ¨ç³»ç»Ÿå±æ€§
jinfo -flags [pid] æŸ¥çœ‹è¿›ç¨‹æ‰€æœ‰JVMå‚æ•°ï¼Œæ¯”jps -væ›´è¯¦ç»†
jinfo -flag [[+ä»£è¡¨æ‰“å¼€ï¼Œ-ä»£è¡¨å…³é—­ï¼Œéƒ½ä¸å†™ä»£è¡¨æŸ¥çœ‹][JVMå‚æ•°][èµ‹å€¼ä½¿ç”¨=][JVMå‚æ•°å€¼]] [pid]
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;å¯è§†åŒ–å·¥å…·&#34;&gt;å¯è§†åŒ–å·¥å…·&lt;/h3&gt;
&lt;h4 id=&#34;jconsole&#34;&gt;JConsole&lt;/h4&gt;
&lt;p&gt;ç›‘æ§Javaåº”ç”¨ç¨‹åºï¼Œå¯æŸ¥çœ‹æ¦‚è¿°ã€å†…å­˜ã€çº¿ç¨‹ã€ç±»ã€VMã€MBeansã€CPUã€å †æ ˆå†…å®¹ã€æ­»é”æ£€æµ‹&lt;/p&gt;
&lt;h4 id=&#34;visualvm&#34;&gt;VisualVM&lt;/h4&gt;
&lt;p&gt;åŠŸèƒ½æ¯”JConsoleæ›´åŠ å¼ºå¤§ï¼Œæ”¯æŒæ’ä»¶ï¼Œè¿˜èƒ½çœ‹åˆ°å¹´è½»ä»£ã€è€å¹´ä»£çš„å†…å­˜å˜åŒ–ï¼Œä»¥åŠgcé¢‘ç‡ã€gcçš„æ—¶é—´&lt;/p&gt;
&lt;h4 id=&#34;eclipse-mat&#34;&gt;Eclipse MAT&lt;/h4&gt;
&lt;p&gt;å·¥å…·è¿›è¡Œå†…å­˜å¿«ç…§çš„åˆ†æï¼Œå›¾è¡¨çš„æ–¹å¼å±•ç¤ºï¼Œå¯ä»¥åˆ†æå†…å­˜æ³„æ¼æˆ–æº¢å‡ºå‡ºç°çš„ä»£ç æ®µ&lt;/p&gt;
&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h2&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://cyc2018.github.io/CS-Notes/#/notes/Java%20%E8%99%9A%E6%8B%9F%E6%9C%BA&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;CS-Note&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æ·±å…¥ç†è§£ Java è™šæ‹Ÿæœº - å‘¨å¿—æ˜&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.cnblogs.com/warehouse/p/9479104.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;JVMï¼ˆä¸‰ï¼‰è°ƒä¼˜å·¥å…·&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.cnblogs.com/ityouknow/p/6437037.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;jvmç³»åˆ—(ä¸ƒ):jvmè°ƒä¼˜-å·¥å…·ç¯‡&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://tech.meituan.com/2017/12/29/jvm-optimize.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;ä»å®é™…æ¡ˆä¾‹èŠèŠJavaåº”ç”¨çš„GCä¼˜åŒ–&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.cnblogs.com/langtianya/p/3898760.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;JVM -XX: å‚æ•°ä»‹ç»&lt;/a&gt;&lt;/p&gt;
</description>
        </item>
        <item>
        <title>RPCä¸å¼‚æ­¥è®¾è®¡</title>
        <link>http://nixum.cc/p/rpc%E4%B8%8E%E5%BC%82%E6%AD%A5%E8%AE%BE%E8%AE%A1/</link>
        <pubDate>Wed, 09 Sep 2020 00:00:00 +0000</pubDate>
        
        <guid>http://nixum.cc/p/rpc%E4%B8%8E%E5%BC%82%E6%AD%A5%E8%AE%BE%E8%AE%A1/</guid>
        <description>&lt;p&gt;[TOC]&lt;/p&gt;
&lt;h1 id=&#34;rpc&#34;&gt;RPC&lt;/h1&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/RPC%e7%ae%80%e5%8d%95%e6%a1%86%e6%9e%b6.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/RPC%e7%ae%80%e5%8d%95%e6%a1%86%e6%9e%b6.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;ä¸€ä¸ªRPCæ¡†æ¶çš„åŸºæœ¬å®ç°ï¼Œé«˜æ€§èƒ½ç½‘ç»œä¼ è¾“ã€åºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€æœåŠ¡æ³¨å†Œå’Œå‘ç°ï¼Œå¦‚æœæ˜¯å®ç°å®¢æˆ·ç«¯çº§åˆ«çš„æœåŠ¡æ³¨å†Œå’Œå‘ç°ï¼Œè¿˜å¯ä»¥åœ¨SDKä¸­æä¾›å®¹é”™ã€è´Ÿè½½å‡è¡¡ã€ç†”æ–­ã€é™çº§ç­‰åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;p&gt;å®¢æˆ·ç«¯å‘èµ·RPCè°ƒç”¨ï¼Œå®é™…ä¸Šæ˜¯è°ƒç”¨è¯¥RPCæ–¹æ³•çš„æ¡©ï¼Œå®ƒå’ŒæœåŠ¡ç«¯æä¾›çš„RPCæ–¹æ³•æœ‰ç›¸åŒçš„æ–¹æ³•ç­¾åï¼Œæˆ–è€…è¯´å®ç°äº†ç›¸åŒçš„æ¥å£ï¼Œåªæ˜¯è¿™ä¸ªæ¡©åœ¨å®¢æˆ·ç«¯æ‰¿æ‹…çš„æ˜¯è¯·æ±‚è½¬å‘çš„åŠŸèƒ½ï¼Œå‘å®¢æˆ·ç«¯å±è”½è°ƒç”¨ç»†èŠ‚ï¼ˆæ¯”å¦‚å‘å‘ç°ä¸æ³¨å†Œä¸­å¿ƒæŸ¥è¯¢è¦è¯·æ±‚çš„æœåŠ¡æ–¹çš„urlï¼‰ï¼Œä½¿å…¶åƒåœ¨ä½¿ç”¨æœ¬åœ°æ–¹æ³•ä¸€æ ·ï¼›æœåŠ¡ç«¯åœ¨æ”¶åˆ°è¯·æ±‚åï¼Œç”±å…¶RPCæ¡†æ¶è§£æå‡ºæœåŠ¡åå’Œè¯·æ±‚å‚æ•°ï¼Œè°ƒç”¨åœ¨RPCæ¡†æ¶ä¸­æ³¨å†Œçš„è¯¥æ¥å£çš„çœŸæ­£å®ç°è€…ï¼Œæœ€åå°†ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€ä¸ªç®€å•çš„RPCå®ç°å¯ä»¥ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼šè§„å®šè¿œç¨‹çš„æ¥å£å’Œå…¶å®ç°ï¼ŒæœåŠ¡ç«¯æä¾›æ¥å£æ³¨å†Œå’ŒIOè¿æ¥ï¼Œå®¢æˆ·ç«¯IOè¿æ¥å’Œæ¥å£ä»£ç†&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;é¦–å…ˆæ˜¯å®šä¹‰è¦æä¾›çš„è¿œç¨‹æ¥å£å’Œå…¶å®ç°ç±»&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æœåŠ¡ç«¯ä½¿ç”¨çº¿ç¨‹æ± å¤„ç†IOï¼Œå®ç°å¤šè·¯å¤ç”¨ï¼Œä½¿ç”¨socketå»å¾ªç¯accept()ï¼Œæ¯ä¸ªè¯·æ±‚å»ºç«‹ä¸€ä¸ªçº¿ç¨‹&lt;/p&gt;
&lt;p&gt;çº¿ç¨‹é‡Œæ³¨å†Œè¿œç¨‹æ¥å£å®ä¾‹ï¼Œä½¿ç”¨InputStreamæ¥æ”¶å®¢æˆ·ç«¯å‘é€çš„å‚æ•°ï¼Œå¦‚æ¥å£çš„å­—èŠ‚æ–‡ä»¶ï¼Œåˆ¤æ–­æ˜¯å“ªä¸ªæ¥å£ï¼Œå“ªä¸ªæ–¹æ³•ï¼Œä»€ä¹ˆå‚æ•°ï¼›æ¥æ”¶ååå°„è°ƒç”¨æ¥å£æ–¹æ³•ï¼Œå°†ç»“æœé€šè¿‡OutputStreamå‘é€å›å®¢æˆ·ç«¯&lt;/p&gt;
&lt;p&gt;å®¢æˆ·ç«¯åœ¨å‘é€å‚æ•°å¯ä»¥åšä¸€ä¸ªå°è£…ï¼ŒåŠ å…¥idï¼ŒæœåŠ¡ç«¯å¤„ç†å¾—åˆ°ç»“æœåä¹ŸåŠ å…¥æ­¤idï¼Œè¿”å›å›å»ï¼Œè¡¨ç¤ºæ­¤æ¬¡è°ƒç”¨å®Œæˆ&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å®¢æˆ·ç«¯ä½¿ç”¨æ¥å£ï¼ŒåŠ¨æ€ä»£ç†çš„æ–¹å¼è°ƒç”¨æ–¹æ³•ï¼Œåœ¨åŠ¨æ€ä»£ç†çš„å®ç°é‡Œä½¿ç”¨IOè¿æ¥æœåŠ¡ç«¯ï¼Œå°†è¿œç¨‹æ¥å£å­—èŠ‚ç ã€æ–¹æ³•å‚æ•°è¿™äº›ä¸œè¥¿åšä¸€ä¸ªå°è£…å‘é€ç»™æœåŠ¡ç«¯ï¼Œç­‰å¾…è¿”å›ç»“æœï¼ŒIOæ¥æ”¶æ˜¯é˜»å¡çš„&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å‚è€ƒ&lt;a class=&#34;link&#34; href=&#34;https://blog.csdn.net/u010900754/article/details/78081428&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;ã€Javaã€‘javaå®ç°çš„è¿œç¨‹è°ƒç”¨ä¾‹å­ rpcåŸç†&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;http://www.importnew.com/22003.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;RPCåŸç†åŠRPCå®ä¾‹åˆ†æ&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;å¼‚æ­¥é€šä¿¡&#34;&gt;å¼‚æ­¥é€šä¿¡&lt;/h1&gt;
&lt;p&gt;ä¼˜ç‚¹ï¼šè§£è€¦ï¼Œå‡å°‘æœåŠ¡é—´çš„ä¾èµ–ï¼Œè·å¾—æ›´å¤§çš„ååé‡ï¼Œå‰Šå³°ï¼ŒæŠŠæŠ–åŠ¨çš„ååé‡å˜å¾—å‡åŒ€ã€‚&lt;/p&gt;
&lt;p&gt;ç¼ºç‚¹ï¼šä¸šåŠ¡å¤„ç†å˜å¾—å¤æ‚ï¼Œæ¯”å¦‚å¼•å…¥æ–°çš„ä¸­é—´ä»¶ï¼Œæ„å‘³ç€è¦ç»´æŠ¤å¤šä¸€å¥—ä¸œè¥¿ï¼Œæœ‰æ—¶å¯èƒ½è¿˜å¾—ä¿è¯æ¶ˆæ¯é¡ºåºï¼Œå¤±è´¥é‡ä¼ ï¼Œå¹‚ç­‰ç­‰å¤„ç†ï¼Œæ¯”è¾ƒéº»çƒ¦ï¼›å¼‚æ­¥ä¹Ÿå¯¼è‡´äº†debugçš„æ—¶å€™æ¯”è¾ƒéº»çƒ¦ï¼›&lt;/p&gt;
&lt;h2 id=&#34;å®šæ—¶è½®è¯¢&#34;&gt;å®šæ—¶è½®è¯¢&lt;/h2&gt;
&lt;p&gt;å‘é€æ–¹è¯·æ±‚æ¥æ”¶æ–¹è¿›è¡Œä¸šåŠ¡å¤„ç†ï¼Œæ¥æ”¶æ–¹å…ˆç›´æ¥è¿”å›ï¼Œä¹‹åæ¥æ”¶æ–¹åœ¨è‡ªå·±å¤„ç†ï¼Œæœ€åå°†ç»“æœä¿å­˜èµ·æ¥ï¼Œå‘é€æ–¹å®šæ—¶è½®è¯¢æ¥æ”¶æ–¹ï¼Œè·å–å¤„ç†ç»“æœã€‚&lt;/p&gt;
&lt;h2 id=&#34;å›è°ƒ&#34;&gt;å›è°ƒ&lt;/h2&gt;
&lt;p&gt;å‘é€æ–¹è¯·æ±‚æ¥æ”¶æ–¹è¿›è¡Œä¸šåŠ¡å¤„ç†æ—¶ï¼Œå¸¦ä¸Šå‘é€æ–¹ç»“æœå›è°ƒçš„urlï¼Œæ¥æ”¶æ–¹æ¥æ”¶åˆ°è¯·æ±‚åå…ˆç«‹åˆ»è¿”å›ï¼Œä¹‹åæ¥æ”¶æ–¹åœ¨è‡ªå·±å¤„ç†ï¼Œå½“å¤„ç†ç»“æœå‡ºæ¥æ—¶ï¼Œè°ƒç”¨å‘é€æ–¹å¸¦è¿‡æ¥çš„å›è°ƒurlï¼Œå°†å¤„ç†ç»“æœå‘é€ç»™å‘é€æ–¹ã€‚&lt;/p&gt;
&lt;p&gt;åŒç†åœ¨äºæœåŠ¡å†…éƒ¨çš„å¼‚æ­¥å›è°ƒï¼Œä¹Ÿæ˜¯å¦‚æ­¤ï¼Œåªæ˜¯æŠŠurlæ¢æˆäº†callbackæ–¹æ³•ï¼Œæ¯”å¦‚Javaä¸­çš„Futureç±»+Callableç±»ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å‘å¸ƒè®¢é˜…&#34;&gt;å‘å¸ƒè®¢é˜…&lt;/h2&gt;
&lt;p&gt;ä¸»è¦é æ¶ˆæ¯é˜Ÿåˆ—å®ç°ï¼Œä¸è¿‡æ¯”è¾ƒé€‚åˆå‘é€æ–¹ä¸å¤ªcareå¤„ç†ç»“æœçš„ï¼Œå¦‚æœcareå¤„ç†ç»“æœï¼Œå¯ä»¥å†é€šè¿‡ä¸€æ¡é˜Ÿåˆ—å°†ç»“æœä¼ é€’ä¸‹å»ï¼Œæ‰§è¡Œåé¢çš„å¤„ç†ã€‚&lt;/p&gt;
&lt;h2 id=&#34;äº‹ä»¶é©±åŠ¨--çŠ¶æ€æœº&#34;&gt;äº‹ä»¶é©±åŠ¨ + çŠ¶æ€æœº&lt;/h2&gt;
&lt;p&gt;å¯ä»¥ä¾é æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæœ¬è´¨è¿˜æ˜¯å‘å¸ƒè®¢é˜…é‚£ä¸€å¥—ï¼Œåªæ˜¯å°†è§¦å‘çš„æ¡ä»¶æ¢æˆäº‹ä»¶ï¼Œæ¶ˆè´¹è€…æ ¹æ®ä¸åŒçš„äº‹ä»¶è§¦å‘ä¸åŒçš„é€»è¾‘ï¼Œç„¶åå†é€šè¿‡çŠ¶æ€æœºä¿è¯å¤„ç†äº‹ä»¶é¡ºåºã€‚&lt;/p&gt;
&lt;p&gt;æ¯”è¾ƒå¸¸è§çš„åœºæ™¯æ˜¯ç”µå•†ä¸šåŠ¡ä¸­å›´ç»•è®¢å•æœåŠ¡çš„ä¸€ç³»åˆ—ä¸šåŠ¡å¤„ç†ï¼Œæ¯”å¦‚è®¢å•åˆ›å»ºå®Œæˆåï¼Œè®¢å•æœåŠ¡å‘å‡ºè®¢å•åˆ›å»ºçš„äº‹ä»¶ï¼Œå¯¹åº”åº“å­˜æœåŠ¡ï¼Œæ”¶åˆ°è¯¥äº‹ä»¶ï¼Œå°±ä¼šè¿›è¡Œé”åº“æ“ä½œç­‰&lt;/p&gt;
&lt;h3 id=&#34;äº‹ä»¶é©±åŠ¨æ¨¡å‹&#34;&gt;äº‹ä»¶é©±åŠ¨æ¨¡å‹&lt;/h3&gt;
&lt;p&gt;å®é™…ä¸Šæ˜¯ä½¿ç”¨äº†è§‚å¯Ÿè€…æ¨¡å¼å’ŒçŠ¶æ€æ¨¡å¼æ¥å®ç°çš„ï¼Œæ¯”è¾ƒç›´è§‚çš„ä¾‹å­å°±æ˜¯androidçš„EventBusï¼Œchromeçš„V8å¼•æ“éƒ½æœ‰ç”¨åˆ°æ­¤æ¨¡å‹ï¼Œè¿™é‡Œä»…æ€»ç»“å¹¶è¿›è¡Œç®€å•ä»‹ç»&lt;/p&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/%e4%ba%8b%e4%bb%b6%e9%a9%b1%e5%8a%a8%e5%9f%ba%e6%9c%ac%e6%a1%86%e6%9e%b6.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/%e4%ba%8b%e4%bb%b6%e9%a9%b1%e5%8a%a8%e5%9f%ba%e6%9c%ac%e6%a1%86%e6%9e%b6.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;è¿™é‡Œçš„demoæ˜¯é¡¹ç›®ä¸­ä½¿ç”¨åˆ°çš„ç»„ä»¶çš„ä¸€ä¸ªç®€åŒ–ï¼ŒçœŸå®çš„ç»„ä»¶è¦æ¯”è¿™ä¸ªå¤æ‚çš„å¤šï¼Œè¿™é‡Œåªç®€å•ç½—åˆ—å‡ºåŸºæœ¬çš„åŸç†å’Œä¼˜ç¼ºç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;åŸç†ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;äº‹ä»¶é©±åŠ¨-çŠ¶æ€æœºçš„å¼‚æ­¥æ¨¡å‹ï¼Œæœ¬è´¨ä¸Šæ˜¯åº•å±‚controllerç»´æŠ¤ä¸€ä¸ªé˜»å¡é˜Ÿåˆ—ï¼Œå°†å¤–éƒ¨è¯·æ±‚è½¬åŒ–ä¸ºäº‹ä»¶ï¼Œé€šè¿‡äº‹ä»¶åœ¨å†…éƒ¨ä¼ é€’ã€‚&lt;/li&gt;
&lt;li&gt;controlleræ¥æ”¶åˆ°è¯·æ±‚ï¼Œä»å¯¹è±¡å¤ç”¨æ± ä¸­è·å–ä¸€ä¸ªä¸Šä¸‹æ–‡contextå¹¶initï¼Œç„¶åå°†äº‹ä»¶äº¤ç”±contextå¤„ç†ã€‚contextå†…æœ‰ä¸€å¥—çŠ¶æ€çš„æ‰­è½¬çš„æ§åˆ¶æµç¨‹ï¼Œåœ¨ä¸åŒçš„çŠ¶æ€æ¥æ”¶äº‹ä»¶å¯¹ä¸šåŠ¡é€»è¾‘è¿›è¡Œå¤„ç†ï¼Œæœ€åå°†å¤„ç†ç»“æœäº¤ç”±æ³¨å†Œçš„å›è°ƒå‡½æ•°å¼‚æ­¥æˆ–è€…åŒæ­¥è¿”å›ã€‚&lt;/li&gt;
&lt;li&gt;æ¯ä¸€ä¸ªçŠ¶æ€åœ¨å¤„ç†å®Œå½“å‰é€»è¾‘æ“ä½œåå°†å‘é€äº‹ä»¶ç»™é˜»å¡é˜Ÿåˆ—ï¼Œå¹¶æ‰­è½¬ä¸ºä¸‹ä¸€ä¸ªçŠ¶æ€ï¼Œç­‰å¾…ä¸‹ä¸€ä¸ªäº‹ä»¶çš„åˆ°æ¥ã€‚&lt;/li&gt;
&lt;li&gt;ç”±äºcontrolleræ˜¯å•çº¿ç¨‹çš„ï¼Œå„ä¸ªçŠ¶æ€åœ¨å¤„ç†çš„æ—¶å€™è¦æ±‚é€Ÿç‡å°½å¯èƒ½çš„å¿«ï¼Œä»¥è‡³äºä¸ä¼šé˜»å¡ä¸»çº¿ç¨‹ï¼Œå› æ­¤åœ¨controllerå†…éƒ¨è¿˜ç»´æŠ¤äº†ä¸€ä¸ªå»¶è¿Ÿé˜Ÿåˆ—ï¼Œç”¨æ¥æ¥æ”¶å»¶è¿Ÿäº‹ä»¶ï¼ŒçŠ¶æ€é€šå¸¸åœ¨è¿›è¡Œä¸šåŠ¡å¤„ç†å‰ä¼šèµ·ä¸€ä¸ªå®šæ—¶å™¨ï¼Œå¦‚æœè¶…æ—¶å°†å‘é€å»¶è¿Ÿäº‹ä»¶ç»™åˆ°å»¶è¿Ÿé˜Ÿåˆ—ï¼Œæ¥é¿å…å½“å‰æ“ä½œè¿‡é•¿å¯¼è‡´é˜»å¡ä¸»çº¿ç¨‹ï¼Œå®šæ—¶å™¨ç”±ä¸‹ä¸€ä¸ªçŠ¶æ€æ¥å–æ¶ˆã€‚&lt;/li&gt;
&lt;li&gt;ä¸€èˆ¬ä¼šä¸ºæ¯ä¸ªè¯·æ±‚åˆ†é…idï¼Œæ¯ä¸ªidå¯¹åº”ä¸€ä¸ªä¸Šä¸‹æ–‡contextï¼Œä¸Šä¸‹æ–‡ä¸€èˆ¬ä½¿ç”¨id + Mapæ¥å®ç°åŒä¸€ä¸ªè¯·æ±‚ä¸‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ã€ä¿å­˜å’Œæ¢å¤ï¼Œä½¿ç”¨å¯¹è±¡å¤ç”¨æ± æ¥é¿å…ä¸Šä¸‹æ–‡å¯¹è±¡é¢‘ç¹åˆå§‹åŒ–&lt;/li&gt;
&lt;li&gt;è¿™å¥—æ¨¡å‹ä¸€èˆ¬åº”ç”¨åœ¨ä¸­é—´ä»¶çš„è®¾è®¡ä¸Šï¼Œå½“ç„¶ä¹Ÿå¯ä»¥æŠ½æˆé€šç”¨æ¡†æ¶ï¼Œåœ¨å†™çš„æ—¶å€™å°±ä¼šå‘ç°ï¼Œå…¶å®å˜åŒ–æœ€å¤šçš„æ˜¯çŠ¶æ€æµç¨‹é‚£ä¸€å—ï¼Œæ‰€ä»¥å®Œå…¨å¯ä»¥æŠŠè¿™å—æŠ½å‡ºæ¥ + nettyè¿›è¡Œç½‘ç»œé€šä¿¡å°±èƒ½æ­å‡ºä¸€å¥—webæ¡†æ¶å‡ºæ¥äº†&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä¼˜ç‚¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;æ˜¯ä¸€ä¸ªå•çº¿ç¨‹çš„æ¨¡å‹ï¼Œæœ¬èº«å°±æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç†è®ºä¸Šä¸€å¥—ä¸šåŠ¡é€»è¾‘æ‹†åˆ†æˆå°é€»è¾‘ï¼Œäº¤ç”±ä¸åŒçš„çŠ¶æ€æ“ä½œï¼Œå„ä¸ªçŠ¶æ€çš„æ“ä½œæ—¶é—´è¦æ±‚å°½å¯èƒ½çš„çŸ­ï¼Œä¸ç„¶ä¼šé˜»å¡ä¸»çº¿ç¨‹&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å„ä¸ªçŠ¶æ€åœ¨è¿›è¡Œé€»è¾‘æ“ä½œæ—¶ï¼Œå¦‚æœå¤„ç†çš„æ—¶é—´è¿‡é•¿ï¼Œä¸€èˆ¬ä¼šä½¿ç”¨çº¿ç¨‹æ± +å›è°ƒ+äº‹ä»¶çš„æ–¹å¼å¤„ç†&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;çŠ¶æ€æœºæ¨¡å¼å¯¹åº”ä¸šåŠ¡é€»è¾‘æµç¨‹æœ‰æ¯”è¾ƒå¼ºçš„æ§åˆ¶ï¼Œå„ä¸ªçŠ¶æ€å¯¹åº”ä¸åŒçš„èŒè´£&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¯¹CPUçš„åˆ©ç”¨ç‡æ¯”è¾ƒé«˜ï¼Œååé‡æ¯”è¾ƒé«˜ï¼Œå› ä¸ºå¯ä»¥ä¸€æ¬¡å¤„ç†å¤šç§ä¸šåŠ¡è¯·æ±‚ï¼Œæ¯ä¸ªä¸šåŠ¡è¯·æ±‚éƒ½èƒ½è¿›è¡Œæ‹†åˆ†è¿›è¡Œå¼‚æ­¥å¤„ç†ï¼Œé€Ÿç‡æ¯”è¾ƒå¿«ï¼Œå› æ­¤æ€§èƒ½ä¼šæ¯”å¸¸ç”¨çš„Springå…¨å®¶æ¡¶å¥½å¾ˆå¤šå§ï¼Œè‡³å°‘åœ¨é¡¹ç›®ä½¿ç”¨ä¸­çš„æ„Ÿå—æ˜¯è¿™æ ·&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç¼ºç‚¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¤„ç†è¯·æ±‚æ—¶ä¼šåˆå§‹åŒ–ä¸€ä¸ªä¸Šä¸‹æ–‡contextæ¥å¤„ç†ï¼Œæ‰€æœ‰å¼‚æ­¥æ“ä½œçš„ç»“æœä¼šæš‚å­˜åœ¨ä¸Šä¸‹æ–‡ä¸­ï¼Œå¯¹å†…å­˜çš„å ç”¨ä¼šæ¯”è¾ƒé«˜ï¼Œå¯¹ä¸Šä¸‹æ–‡é‡Œçš„å‚æ•°å­˜å‚¨ä¹Ÿéœ€è¦ä¸€å¥—è§„èŒƒ&lt;/li&gt;
&lt;li&gt;æ¨¡å‹ç›¸å¯¹æ¥è®²è¿˜æ˜¯æ¯”è¾ƒå¤æ‚ï¼Œè¿ç”¨å¤šç§è®¾è®¡æ¨¡å¼ï¼ŒåŒ…å«äº†ä¸€äº›å›è°ƒï¼Œéœ€è¦æœ‰ä¸€å®šçš„è®¾è®¡æ¨¡å¼åŸºç¡€ï¼Œå®¹æ˜“åŠé€€&lt;/li&gt;
&lt;li&gt;å¯¹è±¡å¤ç”¨æ± ï¼Œå¯¹è±¡å›æ”¶ï¼Œçº¿ç¨‹æ± çš„æ“ä½œï¼Œä¸€ä¸å°å¿ƒä¼šé€ æˆå†…å­˜æ³„æ¼ï¼›è¿˜è¦æ³¨æ„ä¸èƒ½é˜»å¡ä¸»çº¿ç¨‹ï¼Œå› æ­¤éœ€è¦é…åˆå®šæ—¶å™¨è¿›è¡Œå¤„ç†&lt;/li&gt;
&lt;li&gt;å¼‚æ­¥å¤„ç†å¯¼è‡´debugä¼šéº»çƒ¦ä¸€äº›ï¼Œéœ€è¦å®Œå–„çš„æ—¥å¿—è°ƒç”¨é“¾æ¥è¡¥å……&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h1&gt;
</description>
        </item>
        <item>
        <title>Javaå¹¶å‘</title>
        <link>http://nixum.cc/p/java%E5%B9%B6%E5%8F%91/</link>
        <pubDate>Sat, 02 Mar 2019 00:00:00 +0000</pubDate>
        
        <guid>http://nixum.cc/p/java%E5%B9%B6%E5%8F%91/</guid>
        <description>&lt;p&gt;[TOC]&lt;/p&gt;
&lt;h1 id=&#34;javaçº¿ç¨‹çš„çŠ¶æ€&#34;&gt;Javaçº¿ç¨‹çš„çŠ¶æ€&lt;/h1&gt;
&lt;h2 id=&#34;1çŠ¶æ€è½¬æ¢&#34;&gt;1.çŠ¶æ€è½¬æ¢&lt;/h2&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/%e7%ba%bf%e7%a8%8b%e7%8a%b6%e6%80%81%e8%bd%ac%e6%8d%a2.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/%e7%ba%bf%e7%a8%8b%e7%8a%b6%e6%80%81%e8%bd%ac%e6%8d%a2.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			alt=&#34;çº¿ç¨‹çŠ¶æ€è½¬æ¢&#34;&gt;
	&lt;/a&gt;
	
	&lt;figcaption&gt;çº¿ç¨‹çŠ¶æ€è½¬æ¢&lt;/figcaption&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;â€œé˜»å¡â€ä¸â€œç­‰å¾…â€çš„åŒºåˆ«ï¼š
â€œé˜»å¡â€çŠ¶æ€æ˜¯ç­‰å¾…ç€è·å–åˆ°ä¸€ä¸ªæ’ä»–é”ï¼Œè¿›å…¥â€œé˜»å¡â€çŠ¶æ€éƒ½æ˜¯è¢«åŠ¨çš„ï¼Œç¦»å¼€â€œé˜»å¡â€çŠ¶æ€æ˜¯å› ä¸ºå…¶å®ƒçº¿ç¨‹é‡Šæ”¾äº†é”ï¼Œä¸é˜»å¡äº†ï¼›
â€œç­‰å¾…â€çŠ¶æ€æ˜¯åœ¨ç­‰å¾…ä¸€æ®µæ—¶é—´ æˆ–è€… å”¤é†’åŠ¨ä½œçš„å‘ç”Ÿï¼Œè¿›å…¥â€œç­‰å¾…â€çŠ¶æ€æ˜¯ä¸»åŠ¨çš„&lt;/p&gt;
&lt;h2 id=&#34;2-çŠ¶æ€&#34;&gt;2. çŠ¶æ€&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Newï¼ˆæ–°å»ºï¼‰ï¼šé€šè¿‡newåˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹ï¼Œä½†è¿˜æ²¡è¿è¡Œï¼Œè¿˜æœ‰ä¸€äº›å…¶ä»–åŸºç¡€å·¥ä½œè¦åš&lt;/li&gt;
&lt;li&gt;Runnableï¼ˆå¯è¿è¡Œï¼Œå°±ç»ªï¼‰ï¼šçº¿ç¨‹è°ƒç”¨startæ–¹æ³•ï¼Œå¯èƒ½å¤„äºæ­£åœ¨è¿è¡Œä¹Ÿå¯èƒ½å¤„äºæ²¡æœ‰è¿è¡Œï¼Œå–å†³äºæ“ä½œç³»ç»Ÿæä¾›çš„è¿è¡Œæ—¶é—´&lt;/li&gt;
&lt;li&gt;Runningï¼ˆè¿è¡Œï¼‰&lt;/li&gt;
&lt;li&gt;Blockedï¼ˆé˜»å¡ï¼‰ï¼šçº¿ç¨‹å·²ç»è¢«æŒ‚èµ·ï¼Œç­‰å¾…é”çš„é‡Šæ”¾ï¼Œç›´åˆ°å¦ä¸€ä¸ªçº¿ç¨‹èµ°å®Œä¸´ç•ŒåŒºæˆ–å‘ç”Ÿäº†ç›¸åº”é”å¯¹è±¡wait()æ“ä½œåï¼Œå®ƒæ‰æœ‰æœºä¼šå»äº‰å¤ºè¿›å…¥ä¸´ç•ŒåŒºçš„æƒåˆ©
&lt;ol&gt;
&lt;li&gt;ç­‰å¾…é˜»å¡ï¼šè¿è¡Œçš„çº¿ç¨‹æ‰§è¡Œwait()æ–¹æ³•ï¼ŒJVMä¼šæŠŠè¯¥çº¿ç¨‹æ”¾å…¥ç­‰å¾…æ± ä¸­ã€‚&lt;/li&gt;
&lt;li&gt;åŒæ­¥é˜»å¡ï¼šè¿è¡Œçš„çº¿ç¨‹åœ¨è·å–å¯¹è±¡çš„åŒæ­¥é”æ—¶ï¼Œè‹¥è¯¥åŒæ­¥é”è¢«åˆ«çš„çº¿ç¨‹å ç”¨ï¼Œåˆ™JVMä¼šæŠŠè¯¥çº¿ç¨‹æ”¾å…¥é”æ± ä¸­ã€‚&lt;/li&gt;
&lt;li&gt;å…¶ä»–é˜»å¡ï¼šè¿è¡Œçš„çº¿ç¨‹æ‰§è¡Œsleep()æˆ–join()æ–¹æ³•ï¼Œæˆ–è€…å‘å‡ºäº†I/Oè¯·æ±‚æ—¶ï¼ŒJVMä¼šæŠŠè¯¥çº¿ç¨‹ç½®ä¸ºé˜»å¡çŠ¶æ€ã€‚å½“sleep()çŠ¶æ€è¶…æ—¶ã€join()ç­‰å¾…çº¿ç¨‹ç»ˆæ­¢æˆ–è€…è¶…æ—¶ã€æˆ–è€…I/Oå¤„ç†å®Œæ¯•æ—¶ï¼Œçº¿ç¨‹é‡æ–°è½¬å…¥å°±ç»ªçŠ¶æ€ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;Waitingï¼ˆæ— é™æœŸç­‰å¾…ï¼‰ï¼š å¤„äºæ­¤çŠ¶æ€çš„çº¿ç¨‹ä¼šç­‰å¾…å¦å¤–ä¸€ä¸ªçº¿ç¨‹ï¼Œä¸ä¼šè¢«åˆ†é…CPUæ‰§è¡Œæ—¶é—´ï¼Œç›´åˆ°è¢«å…¶ä»–çº¿ç¨‹å”¤é†’
&lt;ol&gt;
&lt;li&gt;æ²¡æœ‰è®¾ç½®timeoutå‚æ•°çš„Object.wait()&lt;/li&gt;
&lt;li&gt;æ²¡æœ‰è®¾ç½®timeoutå‚æ•°çš„Thread.join()&lt;/li&gt;
&lt;li&gt;LockSupport.park() ä»¥ä¸Šæ–¹æ³•ä¼šä½¿çº¿ç¨‹è¿›å…¥æ— é™ç­‰å¾…çŠ¶æ€&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;Timed_waitingï¼ˆé™æœŸç­‰å¾…ï¼‰ï¼šä¸ä¼šè¢«åˆ†é…CPUæ‰§è¡Œæ—¶é—´ï¼Œä¸è¿‡æ— éœ€ç­‰å¾…è¢«å…¶å®ƒçº¿ç¨‹æ˜¾ç¤ºçš„å”¤é†’
&lt;ol&gt;
&lt;li&gt;Thread.sleep()æ–¹æ³•&lt;/li&gt;
&lt;li&gt;è®¾ç½®äº†timeoutå‚æ•°çš„Object.wait()æ–¹æ³•&lt;/li&gt;
&lt;li&gt;è®¾ç½®äº†timeoutå‚æ•°çš„Thread.join()æ–¹æ³•&lt;/li&gt;
&lt;li&gt;LockSupport.parkNanos()æ–¹æ³•&lt;/li&gt;
&lt;li&gt;LockSupport.parkUntil()æ–¹æ³•&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;TERMINATEDï¼ˆç»“æŸï¼Œæ­»äº¡ï¼‰ï¼šå·²ç»ˆæ­¢çº¿ç¨‹çš„çº¿ç¨‹çŠ¶æ€ï¼Œçº¿ç¨‹å·²ç»ç»“æŸæ‰§è¡Œï¼Œrun()æ–¹æ³•èµ°å®Œäº†ï¼Œçº¿ç¨‹å°±å¤„äºè¿™ç§çŠ¶æ€æˆ–è€…å‡ºç°æ²¡æœ‰æ•è·å¼‚å¸¸ç»ˆæ­¢runæ–¹æ³•æ„å¤–æ­»äº¡&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;æ­»é”&#34;&gt;æ­»é”&lt;/h1&gt;
&lt;h2 id=&#34;æ­»é”äº§ç”Ÿçš„æ¡ä»¶&#34;&gt;æ­»é”äº§ç”Ÿçš„æ¡ä»¶&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;äº’æ–¥æ¡ä»¶ï¼šä¸€ä¸ªèµ„æºæ¯æ¬¡åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨ï¼›&lt;/li&gt;
&lt;li&gt;è¯·æ±‚ä¸ä¿æŒæ¡ä»¶ï¼šä¸€ä¸ªçº¿ç¨‹å› è¯·æ±‚èµ„æºè€Œé˜»å¡æ—¶ï¼Œå¯¹å·²è·å¾—çš„èµ„æºä¿æŒä¸æ”¾ï¼›&lt;/li&gt;
&lt;li&gt;ä¸å‰¥å¤ºæ¡ä»¶ï¼šè¿›ç¨‹å·²ç»è·å¾—çš„èµ„æºï¼Œåœ¨æœªä½¿ç”¨å®Œä¹‹å‰ï¼Œä¸èƒ½å¼ºè¡Œå‰¥å¤ºï¼›&lt;/li&gt;
&lt;li&gt;å¾ªç¯ç­‰å¾…æ¡ä»¶ï¼šè‹¥å¹²çº¿ç¨‹ä¹‹é—´å½¢æˆä¸€ç§å¤´å°¾ç›¸æ¥çš„å¾ªç¯ç­‰å¾…èµ„æºå…³ç³»ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;é¿å…æ­»é”&#34;&gt;é¿å…æ­»é”&lt;/h2&gt;
&lt;p&gt;ä¸€èˆ¬åœºæ™¯å‘ç”Ÿåœ¨å…±äº«èµ„æºçš„ä½¿ç”¨ä¸Šï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;çº¿ç¨‹1å¯¹èµ„æºAåŠ é”åï¼Œè¿›è¡Œä¸šåŠ¡æ“ä½œï¼Œçº¿ç¨‹2å¯¹èµ„æºBåŠ é”åè¿›è¡Œä¸šåŠ¡æ“ä½œï¼Œçº¿ç¨‹1ä¸šåŠ¡å¤„ç†éœ€è¦ç”¨åˆ°èµ„æºBï¼Œçº¿ç¨‹2ä¸šåŠ¡å¤„ç†éœ€è¦ç”¨åˆ°èµ„æºAï¼Œæ­¤æ—¶å‘ç”Ÿæ­»é”&lt;/li&gt;
&lt;li&gt;çº¿ç¨‹1å¯¹èµ„æºAåŠ é”åè¿›è¡Œä¸šåŠ¡æ“ä½œï¼Œçº¿ç¨‹2ä¹Ÿéœ€è¦ç”¨åˆ°èµ„æºAï¼Œä½†æ˜¯çº¿ç¨‹1ä¸€ç›´ä¸é‡Šæ”¾é”ï¼Œ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;äº’æ–¥æ¡ä»¶æ˜¯ä¿è¯çº¿ç¨‹å®‰å…¨çš„æ¡ä»¶ï¼Œå› æ­¤ä¸èƒ½ç ´ç¯ï¼Œåªèƒ½å°½é‡ç ´åå…¶ä»–é€ æˆæ­»é”çš„æ¡ä»¶ï¼Œæ¯”å¦‚æå‰åˆ†é…å„ä¸ªçº¿ç¨‹æ‰€éœ€èµ„æºï¼›è®¾ç½®ç­‰å¾…æ—¶é—´æˆ–è€…è‡ªæ—‹æ¬¡æ•°ï¼Œè¶…æ—¶ä¸­æ–­ï¼›åˆ†é…å¥½è·å¾—é”çš„é¡ºåºï¼›é¿å…é€»è¾‘ä¸­å‡ºç°å¤æ•°ä¸ªçº¿ç¨‹ç›¸äº’æŒæœ‰å¯¹æ–¹çº¿ç¨‹æ‰€éœ€çš„ç‹¬å é”çš„æƒ…å†µï¼›&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨åˆé€‚çš„åœºæ™¯ä½¿ç”¨åˆé€‚çš„é”ç±»å‹ï¼Œæ˜¯å¦å…è®¸é”å¯é‡å…¥çš„ï¼Œå…±äº«è¿˜æ˜¯æ’ä»–&lt;/li&gt;
&lt;li&gt;é¿å…å¤šä¸ªçº¿ç¨‹æ“ä½œå¤šä¸ªå…±äº«èµ„æºï¼Œæ³¨æ„é”çš„ç”³è¯·é¡ºåºï¼Œæ¯”å¦‚ç»™èµ„æºè®¾ç½®åºå·ï¼Œé¡ºåºå–æ”¾&lt;/li&gt;
&lt;li&gt;è·å–é”æ—¶è®¾ç½®è¶…æ—¶æ—¶é—´&lt;/li&gt;
&lt;li&gt;å‡å°‘å…±äº«èµ„æºçš„ä½¿ç”¨ï¼Œä½¿ç”¨ThreadLocalï¼Œæ¶ˆæ¯é˜Ÿåˆ—ï¼Œå…±äº«èµ„æºåœ¨æ–¹æ³•å†…å¤åˆ¶(setå›å»çš„æ—¶å€™cas)ï¼Œæˆ–è€…è®¾è®¡ä¸€ç§æ¨¡å¼å¯¹å…±äº«èµ„æºçš„è®¿é—®&lt;/li&gt;
&lt;li&gt;jstackæ£€æŸ¥çº¿ç¨‹ä¸çŠ¶æ€&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;æ­»é”æ£€æµ‹å·¥å…·&#34;&gt;æ­»é”æ£€æµ‹å·¥å…·&lt;/h2&gt;
&lt;p&gt;Jconsole, Jstack, visualVM&lt;/p&gt;
&lt;h1 id=&#34;objectå’Œthreadä¸­å…³äºçº¿ç¨‹çš„ä¸€äº›æ–¹æ³•&#34;&gt;Objectå’ŒThreadä¸­å…³äºçº¿ç¨‹çš„ä¸€äº›æ–¹æ³•&lt;/h1&gt;
&lt;h2 id=&#34;objectç±»ä¸­waitå’Œnotifynotifyall&#34;&gt;Objectç±»ä¸­wait()å’Œnotify()ã€notifyAll()&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;wait()ä½¿å¾—çº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼ŒåŒæ—¶é‡Šæ”¾é”ï¼Œç­‰å¾…å…¶ä»–çº¿ç¨‹notify()ã€notifyAll()çš„å”¤é†’&lt;/p&gt;
&lt;p&gt;å› ä¸ºwait()å’Œnotify()ã€notifyAll()æ˜¯å¯¹è±¡ä¸­çš„æ–¹æ³•ï¼Œå¦‚æœwait()æ²¡æœ‰é‡Šæ”¾é”ï¼Œå…¶ä»–çº¿ç¨‹å°±æ— æ³•è·å¾—é”è¿›å…¥åŒæ­¥ä»£ç å—ä¸­ï¼Œä¹Ÿå°±æ— æ³•æ‰§è¡Œnotify()æˆ–è€…notifyAll()æ–¹æ³•å”¤é†’æŒ‚èµ·çš„çº¿ç¨‹ï¼Œé€ æˆæ­»é”&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è¿™å¥—æ–¹æ³•åªèƒ½åœ¨åŒæ­¥å—synchronizedä¸­ä½¿ç”¨&lt;/strong&gt;ï¼Œå¦åˆ™ä¼šæŠ›IllegalMonitorStateExceptionå¼‚å¸¸ï¼Œå› ä¸ºå¦‚æœæ²¡æœ‰synchronizedï¼Œæœ‰å¯èƒ½ä¼šå¯¼è‡´å¤šçº¿ç¨‹waitæ—¶å¯¹å…±äº«èµ„æºçš„ç«äº‰å¯¼è‡´é—®é¢˜&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;waitã€notifyã€synchronizedéƒ½æ˜¯å¯¹åŒä¸€ä¸ªå¯¹è±¡è¿›è¡Œæ“ä½œ&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;wait() æ–¹æ³•å¯ä»¥è®¾ç½®æ—¶é—´ï¼Œæ—¶é—´åˆ°äº†ä¹Ÿä¼šè¿›å…¥å°±ç»ªçŠ¶æ€&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;notify()æ–¹æ³•åªä¼šéšæœºå”¤é†’æŸä¸ªåœ¨ç­‰å¾…çš„çº¿ç¨‹ï¼ŒnotifyAll()æ–¹æ³•æ˜¯å”¤é†’å…¨éƒ¨ï¼Œä¹‹åè¿›è¡Œç«äº‰ï¼Œæ’é˜Ÿæ‰§è¡Œ&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¯å“åº”ä¸­æ–­&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¼šæŠ›InterruptedExceptionå¼‚å¸¸&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸ºä»€ä¹ˆæ“ä½œçº¿ç¨‹çš„æ–¹æ³•wait()å’Œnotify()ã€notifyAll()æ˜¯Objectç±»ä¸­çš„ï¼Ÿ&lt;/p&gt;
&lt;p&gt;javaæä¾›çš„é”æ˜¯å¯¹è±¡çº§åˆ«çš„ï¼Œç­‰å¾…éœ€è¦é”ï¼ŒæŠŠæ¯ä¸ªå¯¹è±¡çœ‹æˆä¸€ä¸ªé”ï¼ŒåŒä¸€ä¸ªå¯¹è±¡å¯ä»¥æ”¾å…¥ä¸åŒçš„çº¿ç¨‹ä¸­ï¼Œä»è€Œè¾¾åˆ°ä¸åŒçº¿ç¨‹å¯ä»¥ç­‰å¾…æˆ–å”¤é†’ï¼Œå¦‚æœæ˜¯çº¿ç¨‹é‡Œçš„æ–¹æ³•ï¼Œå½“å‰çº¿ç¨‹å¯èƒ½ä¼šç­‰å¾…å¤šä¸ªçº¿ç¨‹çš„é”ï¼Œè¿™æ ·æ“ä½œæ¯”è¾ƒå¤æ‚&lt;/p&gt;
&lt;h2 id=&#34;threadä¸­çš„yield&#34;&gt;Threadä¸­çš„yield()&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;é™æ€æ–¹æ³•&lt;/li&gt;
&lt;li&gt;yield()çš„ä½œç”¨æ˜¯è®©æ­¥ã€‚å®ƒèƒ½è®©å½“å‰çº¿ç¨‹ç”±â€œè¿è¡ŒçŠ¶æ€â€è¿›å…¥åˆ°â€œå°±ç»ªçŠ¶æ€â€ï¼Œä»è€Œ&lt;strong&gt;è®©å…¶å®ƒå…·æœ‰ç›¸åŒä¼˜å…ˆçº§çš„ç­‰å¾…çº¿ç¨‹è·å–æ‰§è¡Œæƒ&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;è¯¥æ–¹æ³•åªæ˜¯å¯¹çº¿ç¨‹è°ƒåº¦å™¨çš„ä¸€ä¸ªå»ºè®®ï¼Œè€Œä¸”ä¹Ÿåªæ˜¯å»ºè®®å…·æœ‰ç›¸åŒä¼˜å…ˆçº§çš„å…¶å®ƒçº¿ç¨‹å¯ä»¥è¿è¡Œï¼Œå¹¶ä¸èƒ½ä¿è¯åœ¨å½“å‰çº¿ç¨‹è°ƒç”¨yield()ä¹‹åï¼Œå…¶å®ƒå…·æœ‰ç›¸åŒä¼˜å…ˆçº§çš„çº¿ç¨‹å°±ä¸€å®šèƒ½è·å¾—æ‰§è¡Œæƒï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯å½“å‰çº¿ç¨‹åˆè¿›å…¥åˆ°â€œè¿è¡ŒçŠ¶æ€â€ç»§ç»­è¿è¡Œ&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;threadä¸­çš„-suspend-å’Œresumeå·²è¿‡æœŸ&#34;&gt;Threadä¸­çš„ suspend() å’Œresume()ï¼Œå·²è¿‡æœŸ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;ä¸æ˜¯é™æ€æ–¹æ³•&lt;/li&gt;
&lt;li&gt;suspend()ç”¨äºæŒ‚èµ·çº¿ç¨‹ï¼Œ resume() ç”¨äºå”¤é†’çº¿ç¨‹ï¼Œéœ€è¦é…å¥—ä½¿ç”¨ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•è¢«æ ‡ä¸º&lt;strong&gt;è¿‡æœŸï¼Œä¸æ¨è&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;suspend() åœ¨å¯¼è‡´çº¿ç¨‹æš‚åœçš„åŒæ—¶ï¼Œå¹¶ä¸ä¼šå»é‡Šæ”¾ä»»ä½•é”èµ„æºã€‚å…¶ä»–çº¿ç¨‹éƒ½æ— æ³•è®¿é—®è¢«å®ƒå ç”¨çš„é”ã€‚ç›´åˆ°å¯¹åº”çš„çº¿ç¨‹æ‰§è¡Œ resume() æ–¹æ³•åï¼Œè¢«æŒ‚èµ·çš„çº¿ç¨‹æ‰èƒ½ç»§ç»­ï¼Œä»è€Œå…¶å®ƒè¢«é˜»å¡åœ¨è¿™ä¸ªé”çš„çº¿ç¨‹æ‰å¯ä»¥ç»§ç»­æ‰§è¡Œ&lt;/li&gt;
&lt;li&gt;å¦‚æœ resume() æ“ä½œå‡ºç°åœ¨ suspend() ä¹‹å‰æ‰§è¡Œï¼Œé‚£ä¹ˆçº¿ç¨‹å°†ä¸€ç›´å¤„äºæŒ‚èµ·çŠ¶æ€ï¼ŒåŒæ—¶ä¸€ç›´å ç”¨é”ï¼Œè¿™å°±äº§ç”Ÿäº†æ­»é”ã€‚è€Œä¸”ï¼Œå¯¹äºè¢«æŒ‚èµ·çš„çº¿ç¨‹ï¼Œå®ƒçš„çº¿ç¨‹çŠ¶æ€å±…ç„¶è¿˜æ˜¯ Runnable&lt;/li&gt;
&lt;li&gt;ä¸ä¼šæŠ›InterruptedExceptionå¼‚å¸¸&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;threadç±»ä¸­çš„sleepæ–¹æ³•&#34;&gt;Threadç±»ä¸­çš„sleep()æ–¹æ³•&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;é™æ€æ–¹æ³•&lt;/li&gt;
&lt;li&gt;ä½¿å½“å‰æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹è¿›å…¥ä¼‘çœ ï¼ˆé˜»å¡ï¼‰ï¼Œä¸ä¼šé‡Šæ”¾é”ï¼Œå•ä½æ˜¯æ¯«ç§’&lt;/li&gt;
&lt;li&gt;sleep() å¯èƒ½ä¼šæŠ›å‡º InterruptedExceptionï¼Œå› ä¸ºå¼‚å¸¸ä¸èƒ½è·¨çº¿ç¨‹ä¼ æ’­å› main() ä¸­ï¼Œå› æ­¤å¿…é¡»åœ¨æœ¬åœ°è¿›è¡Œå¤„ç†ã€‚çº¿ç¨‹ä¸­æŠ›å‡ºçš„å…¶å®ƒå¼‚å¸¸ä¹ŸåŒæ ·éœ€è¦åœ¨æœ¬åœ°è¿›è¡Œå¤„ç†&lt;/li&gt;
&lt;li&gt;å¯å“åº”ä¸­æ–­&lt;/li&gt;
&lt;li&gt;ä¼šæŠ›InterruptedExceptionå¼‚å¸¸&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;threadç±»ä¸­çš„joinæ–¹æ³•&#34;&gt;Threadç±»ä¸­çš„join()æ–¹æ³•&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;ä¸æ˜¯é™æ€æ–¹æ³•&lt;/li&gt;
&lt;li&gt;åœ¨çº¿ç¨‹ä¸­è°ƒç”¨å¦ä¸€ä¸ªçº¿ç¨‹çš„ join() æ–¹æ³•ï¼Œä¼šå°†å½“å‰çº¿ç¨‹æŒ‚èµ·ï¼ˆé˜»å¡ï¼‰ï¼Œè€Œä¸æ˜¯ä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ°ç›®æ ‡çº¿ç¨‹ç»“æŸ&lt;/li&gt;
&lt;li&gt;æ²¡æœ‰é‡Šæ”¾é”&lt;/li&gt;
&lt;li&gt;å¯å“åº”ä¸­æ–­&lt;/li&gt;
&lt;li&gt;ä¼šæŠ›InterruptedExceptionå¼‚å¸¸&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;conditionç±»ä¸­çš„awaitå’Œsignalsignalall&#34;&gt;Conditionç±»ä¸­çš„await()å’Œsignal()ã€signalAll()&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Conditionç±»ä¸­çš„await()å’Œsignal()ã€signalAll()ç”¨æ¥ä»£æ›¿ä¼ ç»ŸObjecté‡Œçš„wait()å’Œnotify()ã€notifyAll()æ–¹æ³•ï¼Œä½œç”¨åŸºæœ¬ç›¸åŒ&lt;/li&gt;
&lt;li&gt;await()å¯ä»¥æŒ‡å®šæ¡ä»¶ï¼ŒConditionç±»ä¸­çš„await()å’Œsignal()ã€signalAll()ä¼šæ›´åŠ çµæ´»&lt;/li&gt;
&lt;li&gt;Conditioné…åˆLock(ReentrantLock)ä½¿ç”¨ï¼ŒLock å¯ä»¥ç”¨æ¥è·å–ä¸€ä¸ª Conditionå¯¹è±¡ã€è¿˜æœ‰åŠ é”è§£é”ï¼Œé˜»å¡é˜Ÿåˆ—ä¸­å°±ä½¿ç”¨äº†Conditionæ¥æ¨¡æ‹Ÿçº¿ç¨‹é—´åä½œ&lt;/li&gt;
&lt;li&gt;ä¼šæŠ›InterruptedExceptionå¼‚å¸¸&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;ä¸­æ–­&#34;&gt;ä¸­æ–­&lt;/h1&gt;
&lt;p&gt;å‚è€ƒ&lt;a class=&#34;link&#34; href=&#34;https://blog.csdn.net/meiliangdeng1990/article/details/80559012&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Javaå¹¶å‘&amp;ndash;InterruptedExceptionæœºåˆ¶&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;å…³é”®å­—&#34;&gt;å…³é”®å­—&lt;/h1&gt;
&lt;h2 id=&#34;synchronized&#34;&gt;synchronized&lt;/h2&gt;
&lt;p&gt;åœ¨è¿›å…¥synchronizedä»£ç å—æ—¶ï¼Œæ‰§è¡Œ monitorenterï¼Œå°†è®¡æ•°å™¨ +1ï¼Œé‡Šæ”¾é” monitorexit æ—¶ï¼Œè®¡æ•°å™¨-1ï¼›å½“ä¸€ä¸ªçº¿ç¨‹åˆ¤æ–­åˆ°è®¡æ•°å™¨ä¸º 0 æ—¶ï¼Œåˆ™å½“å‰é”ç©ºé—²ï¼Œå¯ä»¥å ç”¨ï¼›åä¹‹ï¼Œå½“å‰çº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€ã€‚&lt;/p&gt;
&lt;p&gt;synchronizedæ˜¯å‡ ç§é”çš„å°è£…ï¼šè‡ªæ—‹é”ã€é”æ¶ˆé™¤ã€é”ç²—åŒ–ã€è½»é‡é”ã€åå‘é”ï¼Œåœ¨åŠ å¯¹è±¡é”æ—¶ï¼Œåœ¨å¯¹è±¡çš„å¯¹è±¡å¤´ä¸­çš„Mark Wordè®°å½•å¯¹è±¡çš„çº¿ç¨‹é”çŠ¶æ€ï¼Œæ ¹æ®çº¿ç¨‹çš„ç«äº‰æƒ…å†µåœ¨è¿™å‡ ç§é”ä¸­åˆ‡æ¢&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å½“synchronized(xxx.class)é”ä½çš„æ˜¯ç±»æ—¶ï¼Œå¤šä¸ªçº¿ç¨‹è®¿é—®ä¸åŒå¯¹è±¡(å®ƒä»¬åŒç±»),å°±ä¼šé”ä½ä»£ç æ®µï¼Œå½“ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œè¿™ä¸ªä»£ç æ®µåæ‰è½®åˆ°åˆ«çš„çº¿ç¨‹ï¼Œå¯ä»¥ç†è§£æˆå…¨å±€é”&lt;/li&gt;
&lt;li&gt;å½“synchronized(object)é”ä½çš„æ˜¯å¯¹è±¡æ—¶ï¼Œå¤šä¸ªçº¿ç¨‹è®¿é—®ä¸åŒå¯¹è±¡(å®ƒä»¬åŒç±»),å®ƒä»¬ç›¸äº’ä¹‹é—´å¹¶ä¸å½±å“ï¼Œåªæœ‰å½“å¤šä¸ªçº¿ç¨‹è®¿é—®åŒä¸€å¯¹è±¡æ—¶ï¼Œæ‰ä¼šé”ä½ä»£ç æ®µï¼Œç­‰åˆ°ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œä¹‹åæ‰è½®åˆ°åˆ«çš„çº¿ç¨‹æ‰§è¡Œ&lt;/li&gt;
&lt;li&gt;å½“synchronized(this)é”ä½çš„æ˜¯å½“å‰çš„å¯¹è±¡ï¼Œå½“synchronizedå—é‡Œçš„å†…å®¹æ‰§è¡Œå®Œä¹‹åï¼Œé‡Šæ”¾å½“å‰å¯¹è±¡çš„é”ã€‚åŒä¸€æ—¶åˆ»è‹¥æœ‰å¤šä¸ªçº¿ç¨‹è®¿é—®è¿™ä¸ªå¯¹è±¡ï¼Œåˆ™ä¼šè¢«é˜»å¡&lt;/li&gt;
&lt;li&gt;synchronizedåŠ åœ¨æ–¹æ³•ä¸Šï¼Œä½œç”¨åŒé”ä½thisï¼Œå³å½“å‰å¯¹è±¡&lt;/li&gt;
&lt;li&gt;synchronizedæ‰€åœ¨çš„æ–¹æ³•è¢«staticä¿®é¥°ï¼Œåˆ™é”ä½çš„æ˜¯æ•´ä¸ªç±»&lt;/li&gt;
&lt;li&gt;synchronizedä¸‹ä¸å¯è¢«ä¸­æ–­&lt;/li&gt;
&lt;li&gt;synchronizedæ˜¯éå…¬å¹³é”&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åœ¨ç”¨synchronizedå…³é”®å­—çš„æ—¶å€™ï¼Œå°½é‡ç¼©å°ä»£ç æ®µçš„èŒƒå›´ï¼Œèƒ½åœ¨ä»£ç æ®µä¸ŠåŠ åŒæ­¥å°±ä¸è¦å†æ•´ä¸ªæ–¹æ³•ä¸ŠåŠ åŒæ­¥ï¼Œå‡å°é”çš„ç²’åº¦ï¼Œä½¿ä»£ç æ›´å¤§ç¨‹åº¦çš„å¹¶å‘ï¼Œå¦‚æœé”çš„ä»£ç æ®µå¤ªé•¿äº†ï¼Œåˆ«çš„çº¿ç¨‹ç­‰å¾—å°±ä¹…ä¸€ç‚¹&lt;/p&gt;
&lt;h2 id=&#34;synchronizedå’ŒreentrantlockåŒºåˆ«&#34;&gt;synchronizedå’ŒReentrantLockåŒºåˆ«&lt;/h2&gt;
&lt;p&gt;ç›¸åŒç‚¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;éƒ½æ˜¯åŠ é”å®ç°åŒæ­¥ï¼Œé˜»å¡æ€§åŒæ­¥&lt;/li&gt;
&lt;li&gt;å¯é‡å…¥&lt;/li&gt;
&lt;li&gt;æœ‰ç›¸åŒçš„å¹¶å‘æ€§å’Œå†…å­˜è¯­ä¹‰&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸åŒç‚¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;synchronizedï¼Œæ˜¯å…³é”®å­—ï¼Œåº•å±‚é JVMå®ç°ï¼Œé€šè¿‡æ“ä½œç³»ç»Ÿè°ƒåº¦ï¼›ReentrantLockæ˜¯JDKæä¾›çš„ç±»ï¼Œæºç å¯æŸ¥&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;synchronizedé”çš„èŒƒå›´çœ‹{}ï¼Œèƒ½å¯¹ç±»ã€å¯¹è±¡ã€æ–¹æ³•åŠ é”ï¼Œç”±JVMæ§åˆ¶é”çš„æ·»åŠ å’Œé‡Šæ”¾ï¼›&lt;/p&gt;
&lt;p&gt;ReentrantLocké”ä»£ç å—ï¼Œå¯ä»¥çµæ´»æ§åˆ¶åŠ é”è§£é”çš„ä½ç½®ï¼Œéœ€è¦æ‰‹åŠ¨æ§åˆ¶é”çš„æ·»åŠ å’Œé‡Šæ”¾ï¼Œç›¸å¯¹æ¥è®²é”çš„çµæ´»ï¼Œé”çš„ç»†ç²’åº¦éƒ½æ¯”synchronizedå¥½äº›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;synchronizedæ˜¯éå…¬å¹³é”ï¼ŒReentrantLockæ”¯æŒå…¬å¹³é”å’Œéå…¬å¹³é”ï¼Œé»˜è®¤æ˜¯éå…¬å¹³é”&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;synchronizedä¸å¯ä¸­æ–­ï¼Œé™¤éæŠ›å¼‚å¸¸ï¼Œå¦åˆ™åªèƒ½ç­‰åŒæ­¥çš„ä»£ç æ‰§è¡Œå®Œï¼›ReentrantLockæŒé”åœ¨é•¿æœŸä¸é‡Šæ”¾é”æ—¶ï¼Œæ­£åœ¨ç­‰å¾…çš„çº¿ç¨‹å¯ä»¥é€‰æ‹©æ”¾å¼ƒç­‰å¾…ï¼Œæ–¹æ³•å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;lock(), å¦‚æœè·å–äº†é”ç«‹å³è¿”å›ï¼Œå¦‚æœåˆ«çš„çº¿ç¨‹æŒæœ‰é”ï¼Œå½“å‰çº¿ç¨‹åˆ™ä¸€ç›´å¤„äºä¼‘çœ çŠ¶æ€ï¼Œç›´åˆ°è·å–é”&lt;/li&gt;
&lt;li&gt;tryLock(), å¦‚æœè·å–äº†é”ç«‹å³è¿”å›trueï¼Œå¦‚æœåˆ«çš„çº¿ç¨‹æ­£æŒæœ‰é”ï¼Œç«‹å³è¿”å›falseï¼›&lt;/li&gt;
&lt;li&gt;tryLock (long timeout, TimeUnit unit)ï¼Œ   å¦‚æœè·å–äº†é”å®šç«‹å³è¿”å›trueï¼Œå¦‚æœåˆ«çš„çº¿ç¨‹æ­£æŒæœ‰é”ï¼Œä¼šç­‰å¾…å‚æ•°ç»™å®šçš„æ—¶é—´ï¼Œåœ¨ç­‰å¾…çš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœè·å–äº†é”å®šï¼Œå°±è¿”å›trueï¼Œå¦‚æœç­‰å¾…è¶…æ—¶ï¼Œè¿”å›falseï¼›&lt;/li&gt;
&lt;li&gt;lockInterruptibly: å¦‚æœè·å–äº†é”å®šç«‹å³è¿”å›ï¼Œå¦‚æœæ²¡æœ‰è·å–é”å®šï¼Œå½“å‰çº¿ç¨‹å¤„äºä¼‘çœ çŠ¶æ€ï¼Œç›´åˆ°æˆ–è€…é”å®šï¼Œæˆ–è€…å½“å‰çº¿ç¨‹è¢«åˆ«çš„çº¿ç¨‹ä¸­æ–­&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;synchronizedåœ¨JDK1.6ç‰ˆæœ¬ä¸­è¿›è¡Œäº†ä¼˜åŒ–ï¼Œæ€§èƒ½è·ŸReentrantLockå·®ä¸å¤šï¼ŒReentrantLockä»…æ¯”synchronizedå¤šäº†ä¸€äº›æ–°åŠŸèƒ½&lt;/p&gt;
&lt;p&gt;synchronizedå’ŒReentrantLockéƒ½æä¾›äº†æœ€åŸºæœ¬çš„é”åŠŸèƒ½ï¼ŒReentrantLockå¤šäº†ä¸€äº›é¢å¤–çš„åŠŸèƒ½ï¼šå¯ä»¥æä¾›ä¸€ä¸ªConditionç±»ï¼Œå®ç°åˆ†ç»„å”¤é†’éœ€è¦å”¤é†’çš„çº¿ç¨‹ï¼›æä¾›ä¸€äº›æ–¹æ³•ç›‘å¬å½“å‰é”çš„ä¿¡æ¯&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;volatile&#34;&gt;volatile&lt;/h2&gt;
&lt;p&gt;éœ€è¦å…ˆäº†è§£Javaçš„å†…å­˜æ¨¡å‹ï¼Œç®€å•çš„è¯´å°±æ˜¯ æ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·±çš„å·¥ä½œå†…å­˜ï¼Œå·¥ä½œå†…å­˜å­˜åœ¨é«˜é€Ÿç¼“å­˜ä¸­ï¼Œè€Œå˜é‡å­˜åœ¨äºä¸»å†…å­˜ä¸­ï¼Œçº¿ç¨‹åªèƒ½æ“ä½œå·¥ä½œå†…å­˜ä¸­çš„å˜é‡&lt;/p&gt;
&lt;p&gt;çº¿ç¨‹æ“ä½œå˜é‡çš„æ—¶å€™ï¼Œå˜é‡ä¼šä»ä¸»å†…å­˜ä¸­loadåˆ°å·¥ä½œå†…å­˜ä¸­ï¼Œçº¿ç¨‹å†åœ¨å·¥ä½œå†…å­˜ä¸­ä½¿ç”¨å˜é‡ï¼Œå¤„ç†å®Œä¹‹åå†æŠŠå˜é‡æ›´æ–°åˆ°ä¸»å†…å­˜ä¸­&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ä¿è¯æ­¤å˜é‡å¯¹æ‰€æœ‰çº¿ç¨‹çš„å¯è§æ€§ï¼Œå³å½“ä»¥çº¿ç¨‹ä¿®æ”¹è¿™ä¸ªå˜é‡çš„å€¼ï¼Œæ–°å€¼å¯¹å…¶ä»–çº¿ç¨‹å¯çŸ¥ï¼Œå³å¦‚æœæ­¤å˜é‡å‘é€æ”¹å˜ï¼Œä¼šç«‹å³åŒæ­¥åˆ°ä¸»å†…å­˜ä¸­ï¼Œvolatileåªèƒ½ä¿è¯å¯è§æ€§&lt;/p&gt;
&lt;p&gt;ç”±äºjavaé‡Œçš„è¿ç®—ä¸æ˜¯åŸå­æ€§ï¼Œæ‰€æœ‰volatileå˜é‡çš„è¿ç®—åœ¨å¹¶å‘ä¸‹ä¸€æ ·ä¸å®‰å…¨&lt;br&gt;
å½“å‡ºç°&lt;br&gt;
è¿ç®—ç»“æ„ä¸ä¾èµ–å˜é‡çš„å½“å‰å€¼ï¼Œæˆ–èƒ½ç¡®ä¿åªæœ‰å•ä¸€çš„çº¿ç¨‹ä¿®æ”¹å˜é‡çš„å€¼&lt;br&gt;
å˜é‡ä¸éœ€è¦ä¸å…¶ä»–çš„çŠ¶æ€å˜é‡å…±åŒå‚ä¸ä¸å˜çº¦æŸ&lt;br&gt;
æ­¤æ—¶éœ€è¦åŠ é”&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç¦æ­¢æŒ‡ä»¤é‡æ’åºä¼˜åŒ–ï¼Œæ™®é€šå˜é‡åªä¼šä¿è¯è¯¥æ–¹æ³•æ‰§è¡Œè¿‡ç¨‹ä¸­æ‰€ä¾èµ–èµ‹å€¼çš„ç»“æœéƒ½èƒ½è·å¾—æ­£ç¡®çš„ç»“æœï¼Œä¸èƒ½ä¿è¯å˜é‡èµ‹å€¼æ“ä½œçš„é¡ºåºä¸ç¨‹åºä»£ç çš„æ‰§è¡Œé¡ºåºä¸€è‡´&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å…¸å‹ç”¨æ³•æ˜¯ æ£€æŸ¥æŸä¸ªçŠ¶æ€æ ‡è®°ä»¥åˆ¤æ–­æ˜¯å¦é€€å‡ºå¾ªç¯&lt;/p&gt;
&lt;p&gt;å‚è€ƒ&lt;a class=&#34;link&#34; href=&#34;https://blog.csdn.net/qq_34337272/article/details/79680771&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Javaå¤šçº¿ç¨‹å­¦ä¹ ï¼ˆä¸‰ï¼‰volatileå…³é”®å­—&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://blog.csdn.net/javazejian/article/details/72772461&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;å…¨é¢ç†è§£Javaå†…å­˜æ¨¡å‹(JMM)åŠvolatileå…³é”®å­—&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;ä¸€äº›é”çš„æ¦‚å¿µ&#34;&gt;ä¸€äº›é”çš„æ¦‚å¿µ&lt;/h1&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/java-%e9%94%81.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/java-%e9%94%81.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			alt=&#34;javaä¸­çš„é”&#34;&gt;
	&lt;/a&gt;
	
	&lt;figcaption&gt;javaä¸­çš„é”&lt;/figcaption&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;å‚è€ƒï¼š&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;http://www.importnew.com/19472.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;javaä¸­çš„é”&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://tech.meituan.com/2018/11/15/java-lock.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;ç¾å›¢æŠ€æœ¯å›¢é˜Ÿ - ä¸å¯ä¸è¯´çš„Javaâ€œé”â€äº‹&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;çº¿ç¨‹æ± &#34;&gt;çº¿ç¨‹æ± &lt;/h1&gt;
&lt;p&gt;ä¸ºäº†è§£å†³æ— é™åˆ›å»ºçº¿ç¨‹äº§ç”Ÿçš„é—®é¢˜ï¼Œé‡‡ç”¨çº¿ç¨‹æ± æ¥ç®¡ç†ï¼Œå‡å°‘åœ¨åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹ä¸Šæ‰€æ¶ˆè€—çš„æ—¶é—´ä»¥åŠç³»ç»Ÿèµ„æºçš„å¼€é”€ï¼Œè§£å†³èµ„æºä¸è¶³çš„é—®é¢˜ã€‚å¦‚æœä¸ä½¿ç”¨çº¿ç¨‹æ± ï¼Œæœ‰å¯èƒ½é€ æˆç³»ç»Ÿåˆ›å»ºå¤§é‡åŒç±»çº¿ç¨‹è€Œå¯¼è‡´æ¶ˆè€—å®Œå†…å­˜æˆ–è€…â€œè¿‡åº¦åˆ‡æ¢â€çš„é—®é¢˜&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;çº¿ç¨‹æ±  Executorsé™æ€ç±»&lt;/strong&gt;ï¼Œå·¥å‚æ–¹æ³•ç”Ÿæˆä»¥ä¸‹çº¿ç¨‹æ± &lt;/p&gt;
&lt;h2 id=&#34;çº¿ç¨‹æ± çš„åˆ†ç±»&#34;&gt;çº¿ç¨‹æ± çš„åˆ†ç±»&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;newCachedThreadPoolï¼šæ ¸å¿ƒæ•°æ˜¯0ï¼Œæœ€å¤§æ•°æ˜¯Integer.MAX_VALUEï¼Œä½¿ç”¨SynchronousQueueï¼Œä¸å­˜å‚¨ä»»åŠ¡ã€‚å¯¹äºæ¯ä¸ªä»»åŠ¡ï¼Œå¦‚æœæœ‰ç©ºé—²çº¿ç¨‹å¯ç”¨ï¼Œç«‹å³è®©ä»–æ‰§è¡Œä»»åŠ¡ï¼Œå¦‚æœæ²¡æœ‰å¯ç”¨å¾—ç©ºé—²çº¿ç¨‹ï¼Œåˆ™åˆ›å»ºæ–°çº¿ç¨‹ï¼Œç©ºé—²çº¿ç¨‹è¶…æ—¶è®¾ç½®æ˜¯1åˆ†é’Ÿï¼Œçº¿ç¨‹æ± å¯æ— é™æ‰©å±•ã€‚å®¹æ˜“é€ æˆå †å¤–å†…å­˜æº¢å‡ºï¼Œä¸€èˆ¬ç”¨äºå¤§é‡çŸ­æœŸä»»åŠ¡&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;newFixedThreadPoolï¼šæ„å»ºæœ‰å›ºå®šå¤§å°çš„çº¿ç¨‹æ± ï¼Œä½¿ç”¨LinkedBlockingQueueã€‚å¦‚æœæäº¤çš„ä»»åŠ¡æ•°å¤šäºæ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œåˆ™æŠŠä»»åŠ¡æ”¾åˆ°é˜Ÿåˆ—ä¸­ï¼Œç­‰å…¶ä»–ä»»åŠ¡å®Œæˆåå†è¿è¡Œä»–ï¼Œåˆ›å»ºçš„çº¿ç¨‹ä¸ä¼šè¶…æ—¶&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;newSingleThreadExecutorï¼šå¤§å°ä¸º 1 çš„çº¿ç¨‹æ± ï¼Œä½¿ç”¨LinkedBlockingQueueï¼Œæ¯æ¬¡åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œä»»åŠ¡ï¼Œä»é˜»å¡é˜Ÿåˆ—ä¸­å–ä»»åŠ¡ä¸€ä¸ªæ¥ä¸€ä¸ªæ‰§è¡Œ&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿™ä¸‰ä¸ªé™æ€æ–¹æ³• è¿”å›å®ç°äº†ExecutorServiceæ¥å£çš„ThreadPoolExecutorç±»çš„å¯¹è±¡&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨æ–¹å¼ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;n&#34;&gt;ExecutorService&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;threadPool&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Executors&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;newCachedThreadPool&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;threadPool&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;execute&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;çº¿ç¨‹å®ä¾‹&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// æ— è¿”å›å€¼
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Future&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;T&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;threadPool&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;submit&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;å®ç°äº†Callable&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;T&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;çš„å®ä¾‹&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// æœ‰è¿”å›å€¼
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;threadPool&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;shutdown&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id=&#34;åŸºç¡€&#34;&gt;åŸºç¡€&lt;/h2&gt;
&lt;p&gt;åœ¨é˜¿é‡Œå·´å·´å¼€å‘æ‰‹å†Œä¸­ä¸æå€¡ä½¿ç”¨Executorsåˆ›å»ºï¼Œè€Œæ˜¯é€šè¿‡ ThreadPoolExecutorçš„æ–¹å¼å»å®šåˆ¶çº¿ç¨‹æ± ï¼Œä»è€Œæ˜ç¡®çº¿ç¨‹æ± çš„å‚æ•°&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;9
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;n&#34;&gt;ExecutorService&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;threadPool&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ThreadPoolExecutor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ä¸€ç³»åˆ—å‚æ•°&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ï¼Œ&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;å…·ä½“çœ‹æ„é€ å™¨&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;// æ„é€ å™¨
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;corePoolSize&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt;		&lt;span class=&#34;c1&#34;&gt;// çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°é‡
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;maximumPoolSize&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// çº¿ç¨‹æ± ä¸­å…è®¸çš„æœ€å¤§æ•°é‡ï¼Œå½“å‰é˜»å¡é˜Ÿåˆ—æ»¡äº†ï¼Œä¸”ç»§ç»­æäº¤ä»»åŠ¡ï¼Œåˆ™åˆ›å»ºæ–°çš„çº¿ç¨‹æ‰§è¡Œä»»åŠ¡ï¼Œå‰ææ˜¯å½“å‰çº¿ç¨‹æ•°å°äºmaximumPoolSizeï¼Œå¦‚æœä½¿ç”¨æ— ç•Œé˜Ÿåˆ—ï¼Œè¯¥å‚æ•°å°±æ²¡ä»€ä¹ˆç”¨äº†
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;long&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;keepAliveTime&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// å½“æ´»è·ƒçº¿ç¨‹æ•°å¤§äºcorePoolSizeæ—¶ï¼Œå¤šä½™çš„ç©ºé—²çº¿ç¨‹æœ€å¤§å­˜æ´»æ—¶é—´
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;TimeUnit&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;unit&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt;		&lt;span class=&#34;c1&#34;&gt;// keepAliveTimeå•ä½
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;BlockingQueue&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Runnable&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;workQueue&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// ç”¨æ¥ä¿å­˜ç­‰å¾…è¢«æ‰§è¡Œçš„ä»»åŠ¡çš„é˜»å¡é˜Ÿåˆ—ï¼Œä¸”ä»»åŠ¡å¿…é¡»å®ç°Runableæ¥å£ï¼Œå¸¸è§çš„å¦‚ArrayBlockingQueueã€LinkedBlockingQuene
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ThreadFactory&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;threadFactory&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// å½“çº¿ç¨‹æ± åˆ›å»ºæ–°çº¿ç¨‹æ—¶è°ƒç”¨ï¼Œä¾‹å¦‚ä¸ºæ¯ä¸ªçº¿ç¨‹å®ç°ä¸€ä¸ªåå­—
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;RejectedExecutionHandler&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;handler&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// çº¿ç¨‹æ± çš„é¥±å’Œç­–ç•¥ï¼Œçº¿ç¨‹æ± æä¾›4ç§é¥±å’Œç­–ç•¥ï¼Œé»˜è®¤æ˜¯AbortPolicy
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;é˜»å¡é˜Ÿåˆ—&lt;/p&gt;
&lt;p&gt;å½“çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°é‡å¤§äºç­‰äºcorePoolSizeçš„æ—¶å€™ï¼ŒæŠŠè¯¥ä»»åŠ¡å°è£…æˆä¸€ä¸ªWorkerå¯¹è±¡æ”¾å…¥ç­‰å¾…é˜Ÿåˆ—&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ArrayBlockingQueueï¼šæ˜¯ä¸€ä¸ªåŸºäºæ•°ç»„ç»“æ„çš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ï¼Œæ­¤é˜Ÿåˆ—æŒ‰FIFOï¼ˆå…ˆè¿›å…ˆå‡ºï¼‰åŸåˆ™å¯¹å…ƒç´ è¿›è¡Œæ’åºï¼Œæ­¤æ—¶maximumPoolSizeå°±ä¼šé™åˆ¶ä»»åŠ¡æ•°&lt;/li&gt;
&lt;li&gt;LinkedBlockingQueueï¼šä¸€ä¸ªåŸºäºé“¾è¡¨ç»“æ„çš„é˜»å¡é˜Ÿåˆ—ï¼Œæ­¤é˜Ÿåˆ—æŒ‰FIFOæ’åºå…ƒç´ ï¼Œååé‡é€šå¸¸è¦é«˜äºArrayBlockingQueueã€‚é™æ€å·¥å‚æ–¹æ³•Executors.newFixedThreadPool()ä½¿ç”¨äº†è¿™ä¸ªé˜Ÿåˆ—ã€‚é˜Ÿåˆ—æ— ç•Œæ—¶ï¼ŒmaximumPoolSizeä¹Ÿä¸èµ·ä½œç”¨äº†&lt;/li&gt;
&lt;li&gt;SynchronousQueueï¼šä¸€ä¸ªä¸å­˜å‚¨å…ƒç´ çš„é˜»å¡é˜Ÿåˆ—ã€‚æ¯ä¸ªæ’å…¥æ“ä½œå¿…é¡»ç­‰åˆ°å¦ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨ç§»é™¤æ“ä½œï¼Œå¦åˆ™æ’å…¥æ“ä½œä¸€ç›´å¤„äºé˜»å¡çŠ¶æ€ï¼Œååé‡é€šå¸¸è¦é«˜äºLinkedBlockingQueueï¼Œé™æ€å·¥å‚æ–¹æ³•newCachedThreadPoolä½¿ç”¨äº†è¿™ä¸ªé˜Ÿåˆ—&lt;/li&gt;
&lt;li&gt;PriorityBlockingQueueï¼šä¸€ä¸ªå…·æœ‰ä¼˜å…ˆçº§çš„æ— ç•Œé˜»å¡é˜Ÿåˆ—&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;é¥±å’Œç­–ç•¥&lt;/p&gt;
&lt;p&gt;å½“è¿è¡Œçš„çº¿ç¨‹æ•°é‡å¤§äºç­‰äºmaximumPoolSizeï¼Œä¸”é˜»å¡é˜Ÿåˆ—æ»¡äº†ï¼Œæ‰æ‰§è¡Œé¥±å’Œç­–ç•¥&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;AbortPolicyï¼šæ— æ³•å¤„ç†æ–°ä»»åŠ¡æ—¶æŠ›å‡ºå¼‚å¸¸ï¼Œé»˜è®¤ç­–ç•¥&lt;/li&gt;
&lt;li&gt;CallerRunsPolicyï¼šåªç”¨è°ƒç”¨è€…æ‰€åœ¨çº¿ç¨‹æ¥è¿è¡Œä»»åŠ¡&lt;/li&gt;
&lt;li&gt;DiscardOldestPolicyï¼šä¸¢å¼ƒé˜Ÿåˆ—é‡Œæœ€è¿‘çš„ä¸€ä¸ªä»»åŠ¡ï¼Œå¹¶æ‰§è¡Œå½“å‰ä»»åŠ¡&lt;/li&gt;
&lt;li&gt;DiscardPolicyï¼šä¸å¤„ç†ï¼Œä¸¢å¼ƒæ‰ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;çº¿ç¨‹æ± å¤„ç†è¿‡ç¨‹&#34;&gt;çº¿ç¨‹æ± å¤„ç†è¿‡ç¨‹&lt;/h2&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;RUNNINGï¼šæ­£å¸¸çŠ¶æ€ï¼Œæ¥å—æ–°ä»»åŠ¡ï¼Œå¤„ç†ç­‰å¾…é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡
SHUTDOWNï¼šä¸æ¥æ”¶æ–°ä»»åŠ¡ï¼Œä½†ä¼šå¤„ç†é˜»å¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ï¼›
STOP ï¼šä¸æ¥æ”¶æ–°ä»»åŠ¡ï¼Œä¹Ÿä¸ä¼šå¤„ç†é˜»å¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ï¼Œè€Œä¸”ä¼šä¸­æ–­æ­£åœ¨è¿è¡Œçš„ä»»åŠ¡ï¼›
TIDYING ï¼šæ‰€æœ‰çš„ä»»åŠ¡éƒ½é”€æ¯ï¼Œworkcount=0ï¼Œçº¿ç¨‹æ± åœ¨è½¬æ¢ä¸ºæ­¤çŠ¶æ€æ—¶ä¼šæ‰§è¡Œterminated()
TERMINATEDï¼šterminated()æ–¹æ³•æ‰§è¡Œè¿‡åå˜æˆè¿™ä¸ª
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;çº¿ç¨‹æ± å†…éƒ¨æœ‰ä¸€ä¸ªå˜é‡ï¼ˆprivate final AtomicIntegerå˜é‡ctlï¼Œé«˜3ä½ä¿å­˜è¿è¡ŒçŠ¶æ€runStateï¼Œä½29ä½ä¿å­˜æœ‰æ•ˆçº¿ç¨‹æ•°é‡workerCountï¼‰æ¥è¡¨ç¤ºçº¿ç¨‹çš„çŠ¶æ€ï¼Œæ ¹æ®è¿™ä¸ªå˜é‡è¡¨è¾¾çš„çŠ¶æ€åœ¨æ“ä½œ&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å¦‚æœå½“å‰è¿è¡Œçš„çº¿ç¨‹å°‘äºcorePoolSizeï¼Œåˆ™åˆ›å»ºæ–°çº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ï¼ˆæ³¨æ„ï¼Œæ‰§è¡Œè¿™ä¸€æ­¥éª¤éœ€è¦è·å–å…¨å±€é”ï¼‰&lt;/li&gt;
&lt;li&gt;å¦‚æœè¿è¡Œçš„çº¿ç¨‹ç­‰äºæˆ–å¤šäºcorePoolSizeï¼Œåˆ™å°†ä»»åŠ¡åŠ å…¥BlockingQueue&lt;/li&gt;
&lt;li&gt;å¦‚æœæ— æ³•å°†ä»»åŠ¡åŠ å…¥BlockingQueue(é˜Ÿåˆ—å·²æ»¡)ï¼Œåˆ™åˆ›å»ºæ–°çš„çº¿ç¨‹æ¥å¤„ç†ä»»åŠ¡ï¼ˆæ³¨æ„ï¼Œæ‰§è¡Œè¿™ä¸€æ­¥éª¤éœ€è¦è·å–å…¨å±€é”ï¼‰&lt;/li&gt;
&lt;li&gt;å¦‚æœåˆ›å»ºæ–°çº¿ç¨‹å°†ä½¿å½“å‰è¿è¡Œçš„çº¿ç¨‹è¶…å‡ºmaximumPoolSizeï¼Œä»»åŠ¡å°†è¢«æ‹’ç»ï¼Œå¹¶è°ƒç”¨RejectedExecutionHandler.rejectedExecution()æ–¹æ³•&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å½“corePoolSize  = maximumPoolSizeæ—¶ï¼Œå¤šå‡ºçš„ä»»åŠ¡éƒ½ä¼šäº¤ç»™é˜»å¡é˜Ÿåˆ—å»å¤„ç†ï¼Œå¦‚æœé˜»å¡é˜Ÿåˆ—æ»¡äº†ï¼Œå°±æ‰§è¡Œé¥±å’Œç­–ç•¥ï¼Œå¦‚æœé˜Ÿåˆ—æ— ç•Œï¼Œåˆ™ä»»åŠ¡å †ç§¯&lt;/p&gt;
&lt;p&gt;çº¿ç¨‹æ± é‡Œçº¿ç¨‹çš„é”æ˜¯ä¸å¯é‡å…¥é”&lt;/p&gt;
&lt;p&gt;æ‰§è¡Œä»»åŠ¡çš„æ—¶å€™è¦å¯¹å·¥ä½œçº¿ç¨‹åŠ é”çš„ç†ç”±ï¼šå·¥ä½œçº¿ç¨‹runæ–¹æ³•ä¸­æœ‰ä¸ªåˆ¤æ–­ï¼Œå½“é˜»å¡é˜Ÿåˆ—ä¸­æ²¡ä»»åŠ¡æ—¶ï¼Œä¼šé˜»å¡ï¼Œå¾ªç¯ç­‰å¾…ä»»åŠ¡ï¼›è°ƒç”¨shutdownæ–¹æ³•æ—¶ï¼Œä¼šå°†çº¿ç¨‹æ± çŠ¶æ€è®¾ç½®ä¸ºSHUTDOWNï¼Œå¹¶ä¸”ä¸å…è®¸å°†ä»»åŠ¡åŠ å…¥åˆ°é˜»å¡é˜Ÿåˆ—ä¸­ï¼Œä¸­æ–­å„ä¸ªå·¥ä½œçº¿ç¨‹ï¼›å¦‚æœshutdownæ–¹æ³•ä¸­æ²¡æœ‰å¯¹å·¥ä½œçº¿ç¨‹åŠ é”ï¼Œå¹¶åœ¨é”å†…ä¿®æ”¹çŠ¶æ€ï¼Œä¸­æ–­å·¥ä½œçº¿ç¨‹ï¼Œå¦‚æœæ­¤æ—¶æ“ä½œç³»ç»Ÿåˆ†é…çš„æ—¶é—´ç‰‡ç»™åˆ°å·¥ä½œçº¿ç¨‹çš„åˆ¤æ–­ä¸­ï¼Œé˜»å¡é˜Ÿåˆ—æ²¡æœ‰ä»»åŠ¡ï¼Œå°±ä¸€ç›´é˜»å¡äº†ï¼Œè¿™æ ·çº¿ç¨‹æ± å°±ä¸€ç›´å…³é—­ä¸äº†äº†ã€‚&lt;/p&gt;
&lt;p&gt;åŠ é”æ“ä½œå‘ç”Ÿåœ¨åˆ›å»ºçº¿ç¨‹ã€å·¥ä½œçº¿ç¨‹åœ¨è·å–åˆ°ä»»åŠ¡åã€å·¥ä½œçº¿ç¨‹æ²¡ä»»åŠ¡å¤„ç†åé€€å‡ºã€åˆ¤æ–­æ˜¯å¦ç»“æŸçº¿ç¨‹æ± ã€å…³é—­çº¿ç¨‹æ± ï¼›çº¿ç¨‹æ± çŠ¶æ€(ctl)çš„æ”¹å˜ä½¿ç”¨è‡ªæ—‹+CASåˆ¤æ–­æ“ä½œ&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;çº¿ç¨‹æ± çš„æœ¬è´¨æ˜¯ä¸€ä¸ªç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹ï¼Œè§£è€¦äº†çº¿ç¨‹å’Œä»»åŠ¡ï¼Œè¾¾åˆ°çº¿ç¨‹å¤ç”¨çš„ç›®çš„ã€‚ä»»åŠ¡ç®¡ç†éƒ¨åˆ†å……å½“ç”Ÿäº§è€…çš„è§’è‰²ï¼Œå½“ä»»åŠ¡æäº¤åï¼Œçº¿ç¨‹æ± ä¼šåˆ¤æ–­è¯¥ä»»åŠ¡åç»­çš„æµè½¬ï¼šï¼ˆ1ï¼‰ç›´æ¥ç”³è¯·çº¿ç¨‹æ‰§è¡Œè¯¥ä»»åŠ¡ï¼›ï¼ˆ2ï¼‰ç¼“å†²åˆ°é˜Ÿåˆ—ä¸­ç­‰å¾…çº¿ç¨‹æ‰§è¡Œï¼›ï¼ˆ3ï¼‰æ‹’ç»è¯¥ä»»åŠ¡ã€‚çº¿ç¨‹ç®¡ç†éƒ¨åˆ†æ˜¯æ¶ˆè´¹è€…ï¼Œå®ƒä»¬è¢«ç»Ÿä¸€ç»´æŠ¤åœ¨çº¿ç¨‹æ± å†…ï¼Œæ ¹æ®ä»»åŠ¡è¯·æ±‚è¿›è¡Œçº¿ç¨‹çš„åˆ†é…ï¼Œå½“çº¿ç¨‹æ‰§è¡Œå®Œä»»åŠ¡ååˆ™ä¼šç»§ç»­è·å–æ–°çš„ä»»åŠ¡å»æ‰§è¡Œï¼Œæœ€ç»ˆå½“çº¿ç¨‹è·å–ä¸åˆ°ä»»åŠ¡çš„æ—¶å€™ï¼Œçº¿ç¨‹å°±ä¼šè¢«å›æ”¶ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.cnblogs.com/a8457013/p/7819044.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;çº¿ç¨‹æ± çš„å®ç°åŸç†&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://juejin.im/entry/58fada5d570c350058d3aaad&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;æ·±å…¥ç†è§£Javaçº¿ç¨‹æ± &lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://tech.meituan.com/2020/04/02/java-pooling-pratice-in-meituan.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Javaçº¿ç¨‹æ± å®ç°åŸç†åŠå…¶åœ¨ç¾å›¢ä¸šåŠ¡ä¸­çš„å®è·µ&lt;/a&gt;ï¼Œè¿™ç¯‡æ–‡ç« å†™å¾—ååˆ†è¯¦ç»†æ˜“ç†è§£äº†&lt;/p&gt;
&lt;h2 id=&#34;å¯¹çº¿ç¨‹æ± å¤ç”¨çš„ç®€å•ç†è§£&#34;&gt;å¯¹çº¿ç¨‹æ± å¤ç”¨çš„ç®€å•ç†è§£&lt;/h2&gt;
&lt;p&gt;è¿™é‡Œå…ˆä¸è°ˆå¦‚ä½•ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œåªè¯´å¤ç”¨ã€‚æ¯”å¦‚corePoolSize  = 5ï¼Œå°±æ˜¯å†…éƒ¨æœ‰5ä¸ªçº¿ç¨‹Workerï¼ˆç»§æ‰¿äº†AQSå’ŒRunnableæ¥å£ï¼‰ï¼Œé€šè¿‡ThreadFactoryåˆ›å»ºï¼Œä¿æŒåœ¨ä¸€ä¸ªHashSeté‡Œï¼Œä»»åŠ¡taskå°±æ˜¯å®ç°äº†Runnableæ¥å£çš„ç±»ã€‚å½“ä»»åŠ¡æ•°å¦‚æœå¤§äºcorePoolSize  ï¼Œåˆ™åŠ å…¥åˆ°é˜»å¡é˜Ÿåˆ—workQueueä¸­ï¼›å½“ç„¶å¦‚æœBlockingQueueå­˜æ»¡äº†ï¼ŒcorePoolSize ä¸ªçº¿ç¨‹é‡Œçš„ä»»åŠ¡è¿˜æ²¡æ‰§è¡Œå®Œï¼Œä¼šç»§ç»­åˆ›å»ºçº¿ç¨‹è¾¾åˆ°maximumPoolSizeï¼Œå¤šäºcorePoolSize çš„çº¿ç¨‹æ²¡æœ‰è¢«å¤ç”¨ï¼Œå½“workQueueé‡Œæ²¡æœ‰ä»»åŠ¡äº†ï¼Œå¹¶ä¸”çº¿ç¨‹æ± é‡Œä¹Ÿæ²¡å…¶ä»–ä»»åŠ¡äº†ï¼Œè¿™ä¸ªæ—¶å€™å°±ä¼šç­‰å¾…keepAliveTimeä¹‹åå¯¹çº¿ç¨‹è¿›è¡Œå›æ”¶ã€‚å¤ç”¨æŒ‡çš„æ˜¯å¯¹äºæ¥ä¸‹æ¥è¦æ‰§è¡Œçš„ä¸€ç³»åˆ—ä»»åŠ¡ï¼Œå¯ä»¥é€šè¿‡å‡ ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œï¼Œè€Œä¸ç”¨é‡å¤çš„å¼€å¯çº¿ç¨‹ç»“æŸçº¿ç¨‹ã€ä¸€ä¸ªä»»åŠ¡å¯¹åº”ä¸€ä¸ªçº¿ç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;çº¿ç¨‹workerçš„runæ–¹æ³•é‡Œé€šè¿‡&lt;strong&gt;ç›´æ¥è·å–ä»»åŠ¡&lt;/strong&gt;æˆ–è€…&lt;strong&gt;ä»é˜»å¡é˜Ÿåˆ—workQueueé‡Œè·å–ä»»åŠ¡&lt;/strong&gt;ä½œä¸º&lt;strong&gt;å¾ªç¯&lt;/strong&gt;æ¡ä»¶æ¥æ‰§è¡Œ&lt;strong&gt;ä»»åŠ¡çš„runæ–¹æ³•&lt;/strong&gt;æ¥è¾¾åˆ°çº¿ç¨‹é‡ç”¨ï¼Œæ³¨æ„ä¸æ˜¯startæ–¹æ³•&lt;/p&gt;
&lt;h2 id=&#34;çº¿ç¨‹æ± æ˜¯å¦‚ä½•åšåˆ°å½“çº¿ç¨‹æ•°é‡å¤§äºcorepoolsize-å¤šä½™çš„ç©ºé—²çº¿ç¨‹åœ¨ç­‰å¾…keepalivetimeä¹‹åè¢«å›æ”¶&#34;&gt;çº¿ç¨‹æ± æ˜¯å¦‚ä½•åšåˆ°å½“çº¿ç¨‹æ•°é‡å¤§äºcorePoolSize ï¼Œå¤šä½™çš„ç©ºé—²çº¿ç¨‹åœ¨ç­‰å¾…keepAliveTimeä¹‹åè¢«å›æ”¶&lt;/h2&gt;
&lt;p&gt;åœ¨Workerç±»é‡Œçš„runWorkeræ–¹æ³•é‡Œï¼Œå½“é˜»å¡é˜Ÿåˆ—é‡Œå–ä¸å‡ºä»»åŠ¡task.take()==nullï¼Œå³task.take()æ–¹æ³•é‡Œä¼šæ ¹æ®timedå±æ€§ä½œä¸ºæ˜¯å¦å›æ”¶ç©ºé—²çº¿ç¨‹çš„æ ‡å¿—ï¼Œåœ¨å–é˜»å¡é˜Ÿåˆ—é‡Œçš„ä»»åŠ¡ä¸ºnullæ—¶ï¼Œä¼šç­‰å¾…keepAliveTimeæ—¶é—´ï¼Œè¿”å›nullçš„ä»»åŠ¡ï¼Œç›¸åº”çš„ç©ºé—²çº¿ç¨‹æ•°å°†å‡å°‘ï¼ŒrunWorkeræ–¹æ³•çš„finallyå—é‡Œæ ¹æ®çº¿ç¨‹æ•°ç›®åˆ¤æ–­æ˜¯å¦ç»“æŸæ­¤æ–¹æ³•ï¼Œä»¥æ­¤è¾¾åˆ°å½“å‰çº¿ç¨‹è¢«å›æ”¶çš„ç›®çš„&lt;/p&gt;
&lt;h2 id=&#34;çº¿ç¨‹æ± è°ƒä¼˜&#34;&gt;çº¿ç¨‹æ± è°ƒä¼˜&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;è®¾ç½®æœ€å¤§çº¿ç¨‹æ•°ï¼Œé˜²æ­¢çº¿ç¨‹èµ„æºè€—å°½ï¼›&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨æœ‰ç•Œé˜Ÿåˆ—ï¼Œä»è€Œå¢åŠ ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œé¢„è­¦èƒ½åŠ›(é¥±å’Œç­–ç•¥)ï¼›&lt;/li&gt;
&lt;li&gt;æ ¹æ®ä»»åŠ¡çš„æ€§è´¨è®¾ç½®çº¿ç¨‹æ± å¤§å°ï¼šCPUå¯†é›†å‹ä»»åŠ¡(CPUä¸ªæ•°ä¸ªçº¿ç¨‹)ï¼ŒIOå¯†é›†å‹ä»»åŠ¡(CPUä¸ªæ•°ä¸¤å€çš„çº¿ç¨‹)ï¼Œæ··åˆå‹ä»»åŠ¡(æ‹†åˆ†)ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;jucåŒ…å†…çš„ä¸€äº›ç±»&#34;&gt;JUCåŒ…å†…çš„ä¸€äº›ç±»&lt;/h1&gt;
&lt;h2 id=&#34;blockingqueue&#34;&gt;BlockingQueue&lt;/h2&gt;
&lt;h3 id=&#34;1åˆ†ç±»&#34;&gt;1.åˆ†ç±»&lt;/h3&gt;
&lt;p&gt;æ³¨ï¼šæœ‰ç•ŒæŒ‡çš„æ˜¯ï¼Œå¯¹é˜»å¡é˜Ÿåˆ—åˆå§‹åŒ–æ—¶&lt;strong&gt;å¿…é¡»&lt;/strong&gt;æŒ‡æ˜é˜Ÿåˆ—å¤§å°&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;åç§°&lt;/th&gt;
&lt;th&gt;è¯´æ˜&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;ArrayBlockingQueue&lt;/td&gt;
&lt;td&gt;åº•å±‚æ˜¯æ•°ç»„ï¼Œæœ‰ç•Œï¼Œéœ€è¦åˆå§‹åŒ–æ—¶æŒ‡æ˜å®¹é‡å¤§å°ï¼Œæ”¯æŒå…¬å¹³æ¨¡å¼ï¼Œé»˜è®¤éå…¬å¹³æ¨¡å¼ï¼Œè¯»å†™éƒ½æ˜¯åªæœ‰ä¸€æŠŠé”&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;LinkedBlockingQueue&lt;/td&gt;
&lt;td&gt;åº•å±‚æ˜¯é“¾è¡¨ï¼Œæœ‰ç•Œï¼Œé»˜è®¤å®¹é‡æ˜¯Integer.MAX_VALUEï¼Œä½¿ç”¨è¯»é”å’Œå†™é”ï¼Œå› æ­¤ååé‡æ¯”ArrayBlockingQueueå¤§&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;PriorityBlockingQueue&lt;/td&gt;
&lt;td&gt;åº•å±‚æ˜¯æ•°ç»„ + å †æ’å®ç°æ’åºï¼Œæ— ç•Œï¼Œé»˜è®¤å®¹é‡æ˜¯11ï¼Œæœ€å¤§æ˜¯Integer.MAX_VALUE - 8ï¼Œé»˜è®¤å¯¹å…ƒç´ ä½¿ç”¨è‡ªç„¶é¡ºåºæ’åºï¼Œä¹Ÿå¯æŒ‡å®šæ¯”è¾ƒå™¨&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;DelayQueue&lt;/td&gt;
&lt;td&gt;æ— ç•Œï¼Œæ”¯æŒå»¶æ—¶è·å–ï¼Œä¸å…è®¸takeæˆ–pollç§»é™¤æœªè¿‡æœŸå…ƒç´ ï¼Œsize=è¿‡æœŸå…ƒç´  + éè¿‡æœŸå…ƒç´ &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;SynchronousQueue&lt;/td&gt;
&lt;td&gt;æœ‰ç•Œï¼Œä¸€ä¸ªçº¿ç¨‹çš„æ’å…¥å¿…é¡»ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹çš„åˆ é™¤åæ‰èƒ½å®Œæˆï¼Œåä¹‹äº¦ç„¶ï¼Œä¸èƒ½è¢«è¿­ä»£ï¼Œå®¹é‡å¯ç†è§£ä¸ºåªæœ‰1ï¼Œæ”¯æŒå…¬å¹³å’Œéå…¬å¹³æ¨¡å¼&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;LinkedTransferQueue&lt;/td&gt;
&lt;td&gt;åº•å±‚æ˜¯é“¾è¡¨ï¼Œæ— ç•Œï¼Œç”Ÿäº§è€…ä¼šä¸€ç›´é˜»å¡ç›´åˆ°æ‰€æ·»åŠ åˆ°é˜Ÿåˆ—çš„å…ƒç´ è¢«æŸä¸€ä¸ªæ¶ˆè´¹è€…æ‰€æ¶ˆè´¹ï¼Œä¸»è¦ç”¨äºçº¿ç¨‹é—´æ¶ˆæ¯çš„ä¼ é€’&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;LinkedBlockingDeque&lt;/td&gt;
&lt;td&gt;åº•å±‚æ˜¯é“¾è¡¨ï¼ŒåŒå‘é˜Ÿåˆ—ï¼Œæ— ç•Œ&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;2å¸¸ç”¨æ–¹æ³•&#34;&gt;2.å¸¸ç”¨æ–¹æ³•&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æ“ä½œ&lt;/th&gt;
&lt;th&gt;æ“ä½œå¤±è´¥æ—¶ä¼šæŠ›å¼‚å¸¸&lt;/th&gt;
&lt;th&gt;æ“ä½œåä¼šè¿”å›ç‰¹æ®Šå€¼&lt;/th&gt;
&lt;th&gt;æ“ä½œæ—¶ä¼šé˜»å¡&lt;/th&gt;
&lt;th&gt;è¶…æ—¶é€€å‡ºè¿”å›ç‰¹æ®Šå€¼&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;æ’å…¥&lt;/td&gt;
&lt;td&gt;add(e)&lt;/td&gt;
&lt;td&gt;offer(e)&lt;/td&gt;
&lt;td&gt;put(e)&lt;/td&gt;
&lt;td&gt;offer(e, time, unit)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ç§»é™¤ / è·å–&lt;/td&gt;
&lt;td&gt;remove()&lt;/td&gt;
&lt;td&gt;poll()&lt;/td&gt;
&lt;td&gt;take()&lt;/td&gt;
&lt;td&gt;poll(time, unit)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;3åŸç†&#34;&gt;3.åŸç†&lt;/h3&gt;
&lt;h4 id=&#34;arrayblockingqueue&#34;&gt;ArrayBlockingQueue&lt;/h4&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;9
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// æŠŠæ•°ç»„å½“æˆç¯å½¢é˜Ÿåˆ—ä½¿ç”¨
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// åœ¨æ‰§è¡Œæ’å…¥æˆ–è·å–æ“ä½œå‰ä¼šä¸Šé”ï¼Œä¸Šçš„æ˜¯åŒä¸€æŠŠé”ï¼Œæ–¹æ³•æ‰§è¡Œå®Œè§£é”ï¼Œå…è®¸ä¸­æ–­
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;final&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ReentrantLock&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;// åœ¨takeæ–¹æ³•ä¸­ï¼Œå¦‚æœæ•°ç»„é•¿åº¦ä¸º0ï¼Œåˆ™è°ƒç”¨await()æ–¹æ³•è¿›è¡Œç­‰å¾…ï¼Œå¦åˆ™å°±è·å–ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œè°ƒç”¨singal()æ–¹æ³•å”¤é†’ç­‰å¾…çº¿ç¨‹ç”Ÿäº§
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;final&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Condition&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;notEmpty&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;// åœ¨putæ–¹æ³•ä¸­ï¼Œå¾€æ•°ç»„ä¸­æ·»åŠ ä¸€ä¸ªå…ƒç´ ï¼Œæ›´æ–°ç´¢å¼•ï¼Œå†è°ƒç”¨singal()æ–¹æ³•å”¤é†’ç­‰å¾…çº¿ç¨‹æ¶ˆè´¹ï¼Œå¦‚æœæ•°ç»„æ»¡äº†ï¼Œåˆ™è°ƒç”¨await()æ–¹æ³•è¿›è¡Œç­‰å¾…
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;final&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Condition&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;notFull&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h4 id=&#34;linkedblockingqueue&#34;&gt;LinkedBlockingQueue&lt;/h4&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// æ•´ä½“åˆ†ä¸ºè¯»é”å’Œå†™é”ï¼Œè€Œä¸åƒArrayBlockingQueueåªä½¿ç”¨ä¸€ä¸ªé”ï¼ŒåŸå› æ˜¯LinkedBlockingQueueåº•å±‚æ˜¯é“¾è¡¨çš„ï¼Œåªéœ€è¦å…³å¿ƒå¤´å°¾ä¸¤ä¸ªèŠ‚ç‚¹å°±è¡Œäº†ï¼Œå¤´èŠ‚ç‚¹åŠ è¯»é”ï¼Œå°¾èŠ‚ç‚¹åŠ å†™é”ï¼Œä½¿ç”¨çš„æ˜¯ä¸åŒçš„é”ï¼Œå› æ­¤è¯»å†™æ—¶æ˜¯ä¸é˜»å¡çš„ï¼›å¦å¤–ï¼Œç”±äºèŠ‚ç‚¹æ˜¯é“¾è¡¨å®ä¾‹ï¼Œåœ¨é«˜å¹¶å‘ä¸‹ä¹Ÿä¼šå½±å“GCï¼Œè€ŒArrayBlockingQueueæ˜¯æ•°ç»„ï¼Œä¸ç”¨åŒ…å¤šä¸€å±‚
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;// takeæ“ä½œæ—¶ä¸Šè¯»é”ï¼Œé˜Ÿåˆ—ä¸ºç©ºåˆ™ç­‰å¾…ï¼Œä¸ä¸ºç©ºæ—¶åˆ™ç§»é™¤å¹¶è·å–ï¼Œå†ä¸ä¸ºç©ºåˆ™å”¤é†’å…¶ä»–æ¶ˆè´¹çº¿ç¨‹ï¼Œè§£å¼€è¯»é”ï¼Œå…è®¸ä¸­æ–­
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// ç„¶ååˆ¤æ–­å‡ºæ¶ˆè´¹å…ƒç´ ä¹‹å‰é˜Ÿåˆ—æ˜¯æ»¡çš„(æ­¤æ—¶æ˜¯ä¸´ç•ŒçŠ¶æ€ï¼Œä½†åˆšåˆè¢«æ¶ˆè´¹äº†ä¸€æ¬¡)ï¼Œåˆ™åŠ å†™é”ï¼Œå”¤é†’å…¶ä»–ç”Ÿäº§çº¿ç¨‹ï¼Œè§£å†™é”ï¼Œä¸å…è®¸ä¸­æ–­
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;final&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ReentrantLock&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;takeLock&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ReentrantLock&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;// è¯»é”
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;final&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Condition&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;notEmpty&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;takeLock&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;newCondition&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;// putæ“ä½œæ—¶ä¸Šå†™é”ï¼Œé˜Ÿåˆ—æ»¡åˆ™ç­‰å¾…ï¼Œä¸æ»¡æ—¶åˆ™æ’å…¥ï¼Œæ’å…¥åè¿˜ä¸æ»¡åˆ™å”¤é†’å…¶ä»–ç”Ÿäº§çº¿ç¨‹ï¼Œè§£å¼€å†™é”ï¼Œå…è®¸ä¸­æ–­
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// ç„¶ååˆ¤æ–­å…¥é˜Ÿå‰åªæœ‰ä¸€ä¸ªå…ƒç´ (æ­¤æ—¶çš„è¯¥å…ƒç´ æ˜¯åˆšåˆšåŠ çš„)ï¼Œåˆ™åŠ è¯»é”ï¼Œå”¤é†’å…¶ä»–æ¶ˆè´¹çº¿ç¨‹ï¼Œè§£è¯»é”ï¼Œä¸å…è®¸ä¸­æ–­
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;final&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ReentrantLock&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;putLock&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ReentrantLock&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;   &lt;span class=&#34;c1&#34;&gt;// å†™é”
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;final&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Condition&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;notFull&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;putLock&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;newCondition&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;å…¶å®ArrayBlockingQueueä¹Ÿå¯ä»¥åƒLinkedBlockingQueueä½¿ç”¨è¯»å†™é”ï¼Œä½†æ­¤æ—¶çš„countå’Œindexå°±éœ€è¦ä½¿ç”¨AtomicIntegeræ¥ä¿è¯çº¿ç¨‹å®‰å…¨ï¼ŒåŠ ä¹‹æ•°ç»„ä¸åƒé“¾è¡¨é‚£æ ·è¿˜è¦æ„å»ºèŠ‚ç‚¹ï¼Œä½¿ç”¨è¯»å†™é”å¸¦æ¥çš„æ”¶ç›Šä¸æ˜¯ç‰¹åˆ«å¤§ï¼Œæ‰€ä»¥æ²¡æœ‰ä½¿ç”¨äº†ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h3&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.jianshu.com/p/4028efdbfc35&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;javaé˜»å¡é˜Ÿåˆ—è¯¦è§£&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;aqs&#34;&gt;AQS&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;AbstractQueuedSynchronizedçš„ç¼©å†™ï¼Œå…¨åï¼šæŠ½è±¡é˜Ÿåˆ—åŒæ­¥å™¨ï¼ŒåŸºæœ¬æ˜¯JUCåŒ…ä¸­å„ä¸ªåŒæ­¥ç»„ä»¶çš„åº•å±‚åŸºç¡€äº†&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å†…ç½®ä¸€ä¸ª &lt;code&gt;volatile int state&lt;/code&gt; è®°å½•åŒæ­¥çŠ¶æ€ï¼›&lt;/p&gt;
&lt;p&gt;è¿˜æœ‰ä¸€ä¸ª&lt;code&gt;åŒç«¯é˜Ÿåˆ—ï¼ˆéµå¾ªFIFOï¼‰&lt;/code&gt;ç”¨äºå­˜æ”¾èµ„æºå µå¡çš„çº¿ç¨‹ï¼Œè¢«é˜»å¡çš„çº¿ç¨‹åŠ å…¥é˜Ÿå°¾ï¼Œé˜Ÿåˆ—å¤´ç»“ç‚¹é‡Šæ”¾é”æ—¶ï¼Œå”¤é†’åé¢ç»“ç‚¹&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;AQSæä¾›äº†ä¸€äº›åŒæ­¥ç»„ä»¶ï¼Œå¦‚ä¸‹é¢æåˆ°çš„æ–¹æ³•ï¼Œä½¿æˆ‘ä»¬èƒ½åˆ¶ä½œè‡ªå®šä¹‰åŒæ­¥ç»„ä»¶ï¼Œå…¬å¹³é”å’Œéå…¬å¹³é”æ˜¯é€šè¿‡FairSyncç±»å’ŒNonFairSyncå†…éƒ¨ç±»å®ç°çš„ï¼Œç‹¬å å¼å’Œå…±äº«å¼å°±æ˜¯å®ç°äº†è¿™ä¸¤ä¸ªç±»çš„tryAcquire - tryReleaseæ–¹æ³•æˆ–tryAcquireShared-tryReleaseSharedï¼ŒåƒReentrantLockæ˜¯ç‹¬å å¼å°±åªå®ç°äº†tryAcquire - tryReleaseæ–¹æ³•&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;AQSå†…éƒ¨æœ‰ä¸¤ç§é˜Ÿåˆ—ï¼Œä¸€ç§æ˜¯åŒæ­¥é˜Ÿåˆ—ï¼Œç”¨äºé”çš„è·å–å’Œé‡Šæ”¾æ—¶ä½¿ç”¨ï¼›ä¸€ç§æ˜¯ç­‰å¾…é˜Ÿåˆ—ï¼Œç”¨äºConditionç±»ï¼Œæ¯ä¸ªConditionå¯¹åº”ä¸€ä¸ªé˜Ÿåˆ—&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;AQSå†…æ§åˆ¶çº¿ç¨‹é˜»å¡å’Œå”¤é†’ä½¿ç”¨çš„æ˜¯Unsafeç±»é‡Œnativeæ–¹æ³•ï¼Œå¦‚parkã€unparkæ–¹æ³•&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;åŒæ­¥æ–¹å¼&#34;&gt;åŒæ­¥æ–¹å¼&lt;/h3&gt;
&lt;h4 id=&#34;ç‹¬å å¼å¦‚reentrantlock&#34;&gt;ç‹¬å å¼ï¼šå¦‚ReentrantLock&lt;/h4&gt;
&lt;p&gt;è·å–ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;è°ƒç”¨å…¥å£æ–¹æ³•acquire&lt;/li&gt;
&lt;li&gt;è°ƒç”¨æ¨¡ç‰ˆæ–¹æ³•tryAcquire(arg)å°è¯•è·å–é”ï¼Œè‹¥æˆåŠŸåˆ™è¿”å›ï¼Œè‹¥å¤±è´¥åˆ™èµ°ä¸‹ä¸€æ­¥&lt;/li&gt;
&lt;li&gt;å°†å½“å‰çº¿ç¨‹æ„é€ æˆä¸€ä¸ªNodeèŠ‚ç‚¹ï¼Œå¹¶åˆ©ç”¨CASå°†å…¶åŠ å…¥åˆ°åŒæ­¥é˜Ÿåˆ—åˆ°å°¾éƒ¨ï¼Œç„¶åè¯¥èŠ‚ç‚¹å¯¹åº”åˆ°çº¿ç¨‹è¿›å…¥è‡ªæ—‹çŠ¶æ€&lt;/li&gt;
&lt;li&gt;è‡ªæ—‹æ—¶ï¼Œé¦–å…ˆåˆ¤æ–­å…¶å‰é©±èŠ‚ç‚¹é‡Šæ”¾ä¸ºå¤´èŠ‚ç‚¹&amp;amp;æ˜¯å¦æˆåŠŸè·å–åŒæ­¥çŠ¶æ€ï¼Œä¸¤ä¸ªæ¡ä»¶éƒ½æˆç«‹ï¼Œåˆ™å°†å½“å‰çº¿ç¨‹çš„èŠ‚ç‚¹è®¾ç½®ä¸ºå¤´èŠ‚ç‚¹ï¼Œå¦‚æœä¸æ˜¯ï¼Œåˆ™åˆ©ç”¨&lt;code&gt;LockSupport.park(this)&lt;/code&gt;å°†å½“å‰çº¿ç¨‹æŒ‚èµ·ï¼Œä¸ç„¶å®ƒä¸€ç›´å¾ªç¯ ,ç­‰å¾…è¢«å‰é©±èŠ‚ç‚¹å”¤é†’(é‡Šæ”¾é”çš„æ—¶å€™)&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;é‡Šæ”¾ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;è°ƒç”¨å…¥å£æ–¹æ³•release&lt;/li&gt;
&lt;li&gt;è°ƒç”¨æ¨¡ç‰ˆæ–¹æ³•&lt;code&gt;tryRelease&lt;/code&gt;é‡Šæ”¾åŒæ­¥çŠ¶æ€&lt;/li&gt;
&lt;li&gt;è·å–å½“å‰èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹&lt;/li&gt;
&lt;li&gt;åˆ©ç”¨&lt;code&gt;LockSupport.unpark(currentNode.next.thread)&lt;/code&gt;å”¤é†’åç»§èŠ‚ç‚¹ï¼Œä¹‹åé‡å¤ä¸Šé¢ è·å– ç¬¬4æ­¥&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;å…±äº«å¼å¦‚semaphorecountdownlatch&#34;&gt;å…±äº«å¼ï¼šå¦‚Semaphoreï¼ŒCountDownLatch&lt;/h4&gt;
&lt;p&gt;è·å–ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;è°ƒç”¨å…¥å£æ–¹æ³•acquireShared&lt;/li&gt;
&lt;li&gt;è¿›å…¥tryAcquireShared(arg)æ¨¡ç‰ˆæ–¹æ³•è·å–åŒæ­¥çŠ¶æ€ï¼Œå¦‚æœè¿”å›å€¼&amp;gt;=0ï¼Œåˆ™è¯´æ˜åŒæ­¥çŠ¶æ€(state)æœ‰å‰©ä½™ï¼Œè·å–é”æˆåŠŸç›´æ¥è¿”å›&lt;/li&gt;
&lt;li&gt;å¦‚æœtryAcquireShared(arg)è¿”å›å€¼&amp;lt;0ï¼Œè¯´æ˜è·å–åŒæ­¥çŠ¶æ€å¤±è´¥ï¼Œå‘é˜Ÿåˆ—å°¾éƒ¨æ·»åŠ ä¸€ä¸ªå…±äº«ç±»å‹çš„NodeèŠ‚ç‚¹ï¼Œéšå³è¯¥èŠ‚ç‚¹è¿›å…¥è‡ªæ—‹çŠ¶æ€&lt;/li&gt;
&lt;li&gt;è‡ªæ—‹æ—¶ï¼Œé¦–å…ˆæ£€æŸ¥ (å‰é©±èŠ‚ç‚¹æ˜¯å¦ä¸ºå¤´èŠ‚ç‚¹ &amp;amp; tryAcquireShared()æ˜¯å¦&amp;gt;=0)  (å³æˆåŠŸè·å–åŒæ­¥çŠ¶æ€)&lt;/li&gt;
&lt;li&gt;å¦‚æœæ˜¯ï¼Œåˆ™è¯´æ˜å½“å‰èŠ‚ç‚¹å¯æ‰§è¡Œï¼ŒåŒæ—¶æŠŠå½“å‰èŠ‚ç‚¹è®¾ç½®ä¸ºå¤´èŠ‚ç‚¹ï¼Œå¹¶ä¸”å”¤é†’æ‰€æœ‰åç»§èŠ‚ç‚¹&lt;/li&gt;
&lt;li&gt;å¦‚æœå¦ï¼Œåˆ™åˆ©ç”¨&lt;code&gt;LockSupport.unpark(this)&lt;/code&gt;æŒ‚èµ·å½“å‰çº¿ç¨‹ï¼Œç­‰å¾…è¢«å‰é©±èŠ‚ç‚¹å”¤é†’&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;é‡Šæ”¾ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;è°ƒç”¨releaseShared(arg)æ¨¡ç‰ˆæ–¹æ³•é‡Šæ”¾åŒæ­¥çŠ¶æ€&lt;/li&gt;
&lt;li&gt;å¦‚æœé‡Šæ”¾æˆï¼Œåˆ™éå†æ•´ä¸ªé˜Ÿåˆ—ï¼Œåˆ©ç”¨&lt;code&gt;LockSupport.unpark(nextNode.thread)&lt;/code&gt;å”¤é†’æ‰€æœ‰åç»§èŠ‚ç‚¹&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;åŒºåˆ«&#34;&gt;åŒºåˆ«&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ç‹¬å å¼æ¯æ¬¡é‡Šæ”¾é”åªå”¤é†’åç»§ç»“ç‚¹ï¼›å…±äº«å¼æ¯æ¬¡é‡Šæ”¾é”ä¼šå”¤é†’æ‰€æœ‰åç»§ç»“ç‚¹ï¼Œä½¿å®ƒä»¬åŒæ—¶è·å–åŒæ­¥çŠ¶æ€&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç‹¬å é”çš„åŒæ­¥çŠ¶æ€å€¼ä¸º1ï¼ŒåŒä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹æˆåŠŸè·å–åŒæ­¥çŠ¶æ€ï¼›å…±äº«é”çš„åŒæ­¥çŠ¶æ€&amp;gt;1ï¼Œå–å€¼ç”±ä¸Šå±‚åŒæ­¥ç»„ä»¶ç¡®å®š&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å…¬å¹³é”å’Œéå…¬å¹³é”æ˜¯åˆ†åˆ«é‡å†™tryAcquire()å’ŒtryRelease()æ–¹æ³•å®ç°ï¼Œæ˜¯ä¸¤å¥—æ–¹æ¡ˆï¼Œç‹¬å æ¨¡å¼å’Œå…±äº«æ¨¡å¼éƒ½å¯ä»¥æœ‰å…¬å¹³é”éå…¬å¹³é”çš„å®ç°&lt;/p&gt;
&lt;p&gt;å…¬å¹³é”ï¼Œå½“çº¿ç¨‹è¯·æ±‚åˆ°æ¥æ—¶å…ˆä¼šåˆ¤æ–­åŒæ­¥é˜Ÿåˆ—æ˜¯å¦å­˜åœ¨ç»“ç‚¹ï¼Œå¦‚æœå­˜åœ¨å…ˆæ‰§è¡ŒåŒæ­¥é˜Ÿåˆ—ä¸­çš„ç»“ç‚¹çº¿ç¨‹ï¼Œå½“å‰çº¿ç¨‹å°†å°è£…æˆnodeåŠ å…¥åŒæ­¥é˜Ÿåˆ—ç­‰å¾…ï¼ˆæ–°åŠ å…¥çš„çº¿ç¨‹è·å–é”ï¼Œå¦‚æœé˜Ÿåˆ—ä¸ä¸ºç©ºï¼ŒåŠ å…¥é˜Ÿå°¾ï¼Œæ‰§è¡Œé˜Ÿå¤´çš„çº¿ç¨‹ï¼‰&lt;/p&gt;
&lt;p&gt;éå…¬å¹³é”ï¼Œå½“çº¿ç¨‹è¯·æ±‚åˆ°æ¥æ—¶ï¼Œä¸ç®¡åŒæ­¥é˜Ÿåˆ—æ˜¯å¦å­˜åœ¨çº¿ç¨‹ç»“ç‚¹ï¼Œç›´æ¥å°è¯•è·å–åŒæ­¥çŠ¶æ€ï¼Œè·å–æˆåŠŸç›´æ¥è®¿é—®å…±äº«èµ„æºï¼ˆæ–°åŠ å…¥çš„çº¿ç¨‹è·å–é”ï¼Œç›´æ¥ä¸é˜Ÿåˆ—ä¸­çš„å¤´ç»“ç‚¹ç«äº‰ï¼Œä¸æˆåŠŸåœ¨åŠ å…¥é˜Ÿåˆ—ï¼‰&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;condition&#34;&gt;Condition&lt;/h3&gt;
&lt;p&gt;ä¸€ä¸ªLockå¯ä»¥åˆ›å»ºå¤šä¸ªConditionï¼Œæ¯ä¸ªConditionå¯¹åº”ä¸€ä¸ªç­‰å¾…é˜Ÿåˆ—ï¼Œå•å‘ï¼Œæœ‰å¤´å°¾ä¸¤ä¸ªç»“ç‚¹ï¼Œéµå¾ª FIFO&lt;/p&gt;
&lt;p&gt;å½“ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨äº†await()ç›¸å…³çš„æ–¹æ³•ï¼Œé‚£ä¹ˆè¯¥çº¿ç¨‹å°†ä¼šé‡Šæ”¾é”ï¼Œå¹¶æ„å»ºä¸€ä¸ªNodeèŠ‚ç‚¹å°è£…å½“å‰çº¿ç¨‹çš„ç›¸å…³ä¿¡æ¯åŠ å…¥åˆ°ç­‰å¾…é˜Ÿåˆ—ä¸­è¿›è¡Œç­‰å¾…ï¼Œç›´åˆ°è¢«å”¤é†’ã€ä¸­æ–­ã€è¶…æ—¶æ‰ä»é˜Ÿåˆ—ä¸­ç§»å‡º&lt;/p&gt;
&lt;p&gt;åªæœ‰ç‹¬å å¼æ‰æœ‰Conditionã€ç­‰å¾…é˜Ÿåˆ—è¿™äº›ä¸œè¥¿ï¼Œå…±äº«å¼æ²¡æœ‰&lt;/p&gt;
&lt;p&gt;await()ï¼šå°†å½“å‰çº¿ç¨‹å°è£…æˆç»“ç‚¹åŠ å…¥åˆ°ç­‰å¾…é˜Ÿåˆ—ä¸­ï¼Œé‡Šæ”¾åŒæ­¥çŠ¶æ€ä»¥å”¤é†’åŒæ­¥é˜Ÿåˆ—çš„åç»§ç»“ç‚¹ï¼Œåˆ¤æ–­å½“å‰ç»“ç‚¹æ˜¯å¦åœ¨åŒæ­¥é˜Ÿåˆ—ä¸­ï¼Œä¸æ˜¯å°±æŒ‚èµ·å½“å‰çº¿ç¨‹ï¼Œæ­¤æ—¶ä»ç„¶åœ¨è‡ªæ—‹ä¸­ï¼Œç­‰å¾…è¢«å”¤é†’&lt;/p&gt;
&lt;p&gt;singal()ï¼šåˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦æŒæœ‰é”ï¼Œæ²¡æœ‰åˆ™æŠ›å¼‚å¸¸ï¼Œæœ‰çš„è¯å”¤é†’ç­‰å¾…é˜Ÿåˆ—çš„å¤´ç»“ç‚¹ï¼Œå¦‚æœä¸ºnullåˆ™ç»§ç»­å”¤é†’åé¢çš„ç»“ç‚¹ï¼Œå”¤é†’çš„æ„æ€æ˜¯ç§»é™¤ç­‰å¾…é˜Ÿåˆ—ä¸­çš„å¤´ç»“ç‚¹ï¼ŒåŠ å…¥åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­ï¼Œå¦‚æœè¯¥ç»“ç‚¹çš„å‰é©±ç»“ç‚¹ç»“æŸæˆ–è€…Node.SIGNALçŠ¶æ€è®¾ç½®å¤±è´¥ï¼Œå”¤é†’å®ƒï¼Œè§£é™¤await()æ–¹æ³•ä¸­çš„è‡ªæ—‹ï¼Œç­‰å¾…è·å–é”&lt;/p&gt;
&lt;p&gt;å‚è€ƒ&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://juejin.im/entry/59756e5051882566d86d8a5d&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;æ·±å…¥å‰–æåŸºäºå¹¶å‘AQSçš„é‡å…¥é”(ReetrantLock)åŠå…¶Conditionå®ç°åŸç†&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://zhuanlan.zhihu.com/p/54297968?utm_source=wechat_session&amp;amp;utm_medium=social&amp;amp;utm_oi=632939468966072320&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;(JDK)ReetrantLockæ‰‹æ’•AQS&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://tech.meituan.com/2019/12/05/aqs-theory-and-apply.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;ä»ReentrantLockçš„å®ç°çœ‹AQSçš„åŸç†åŠåº”ç”¨&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;åŸå­æ“ä½œç±»&#34;&gt;åŸå­æ“ä½œç±»&lt;/h2&gt;
&lt;p&gt;å¤šçº¿ç¨‹ä¸‹ï¼Œjava è‡ªå¢è‡ªå‡æ“ä½œæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Œå› æ­¤JUCåŒ…æ‰æä¾›äº†çº¿ç¨‹å®‰å…¨çš„åŸå­æ“ä½œç±»&lt;/p&gt;
&lt;h3 id=&#34;åŸç†&#34;&gt;åŸç†&lt;/h3&gt;
&lt;p&gt;CAS + è‡ªæ—‹ä¿è¯&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://blog.csdn.net/qfycc92/article/details/46489553&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;AtomicIntegeræºç åˆ†æâ€”â€”åŸºäºCASçš„ä¹è§‚é”å®ç°&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;reentrantlock&#34;&gt;ReentrantLock&lt;/h2&gt;
&lt;h3 id=&#34;åŸç†-1&#34;&gt;åŸç†&lt;/h3&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;http://www.blogjava.net/zhanglongsr/articles/356782.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;ReentrantLockæºç ä¹‹ä¸€lockæ–¹æ³•è§£æ(é”çš„è·å–)&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;æ— åŒæ­¥æ–¹æ¡ˆ&#34;&gt;æ— åŒæ­¥æ–¹æ¡ˆ&lt;/h1&gt;
&lt;h2 id=&#34;cas&#34;&gt;CAS&lt;/h2&gt;
&lt;p&gt;Compare-and-Swap, æ˜¯ä¸€ç§ç®—æ³•ï¼ŒCAS æŒ‡ä»¤éœ€è¦æœ‰ 3 ä¸ªæ“ä½œæ•°ï¼Œåˆ†åˆ«æ˜¯å†…å­˜åœ°å€ Vã€æ—§çš„é¢„æœŸå€¼ A å’Œæ–°å€¼ Bã€‚å½“æ‰§è¡Œæ“ä½œæ—¶ï¼Œåªæœ‰å½“ V çš„å€¼ç­‰äº Aï¼Œæ‰å°† V çš„å€¼æ›´æ–°ä¸º Bã€‚&lt;/p&gt;
&lt;h2 id=&#34;threadlocalt&#34;&gt;ThreadLocal&amp;lt;T&amp;gt;&lt;/h2&gt;
&lt;p&gt;æ˜¯java.langåŒ…ä¸­çš„ä¸€ä¸ªç±»ï¼Œä½¿ç”¨ ThreadLocal ç»´æŠ¤å˜é‡æ—¶ï¼Œå…¶ä¸ºæ¯ä¸ªä½¿ç”¨è¯¥å˜é‡çš„çº¿ç¨‹æä¾›ç‹¬ç«‹çš„å˜é‡å‰¯æœ¬ï¼ŒæŠŠå…±äº«æ•°æ®çš„å¯è§èŒƒå›´é™åˆ¶åœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¹‹å†…ï¼Œæ‰€ä»¥æ¯ä¸€ä¸ªçº¿ç¨‹éƒ½å¯ä»¥ç‹¬ç«‹çš„æ”¹å˜è‡ªå·±çš„å‰¯æœ¬ï¼Œè€Œä¸ä¼šå½±å“å…¶ä»–çº¿ç¨‹å¯¹åº”çš„å‰¯æœ¬ã€‚&lt;/p&gt;
&lt;p&gt;æ³¨æ„ï¼šThreadLocal æ— æ³•è§£å†³å…±äº«å¯¹è±¡çš„æ›´æ–°é—®é¢˜ï¼ŒThreadLocal å¯¹è±¡å»ºè®®ä½¿ç”¨ staticä¿®é¥°ã€‚è¿™ä¸ªå˜é‡æ˜¯é’ˆå¯¹ä¸€ä¸ªçº¿ç¨‹å†…æ‰€æœ‰æ“ä½œå…±äº«çš„ï¼Œæ‰€ä»¥è®¾ç½®ä¸ºé™æ€å˜é‡ï¼Œæ‰€æœ‰æ­¤ç±»å®ä¾‹å…±äº«æ­¤é™æ€å˜é‡  ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨ç±»ç¬¬ä¸€æ¬¡è¢«ä½¿ç”¨æ—¶è£…è½½ï¼Œåªåˆ†é…ä¸€å—å­˜å‚¨ç©ºé—´ï¼Œæ‰€æœ‰æ­¤ç±»çš„å¯¹è±¡(åªè¦æ˜¯è¿™ä¸ªçº¿ç¨‹å†…å®šä¹‰çš„)éƒ½å¯ä»¥æ“æ§è¿™ä¸ªå˜é‡&lt;/p&gt;
&lt;h3 id=&#34;åŸç†-2&#34;&gt;åŸç†&lt;/h3&gt;
&lt;p&gt;æ¯ä¸ªçº¿ç¨‹å†…éƒ¨éƒ½ä¼šç»´æŠ¤ä¸€ä¸ª é™æ€çš„ThreadLocalMapå¯¹è±¡ï¼Œè¯¥å¯¹è±¡é‡Œæœ‰ä¸€ä¸ªEntryï¼ˆK-V é”®å€¼å¯¹ï¼‰&lt;strong&gt;æ•°ç»„&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Entryçš„Keyæ˜¯ä¸€ä¸ªThreadLocalå®ä¾‹ï¼ŒValueæ˜¯ä¸€ä¸ªçº¿ç¨‹ç‰¹æœ‰å¯¹è±¡ã€‚ä¹‹æ‰€ä»¥keyæ˜¯ä¸€ä¸ªThreadLocalå®ä¾‹ï¼Œæ˜¯å› ä¸ºåœ¨åŒä¸€çº¿ç¨‹å†…å¯ä»¥æœ‰å¤šä¸ªThreadLocalï¼Œè€Œä¸€ä¸ªçº¿ç¨‹åªæœ‰ä¸€ä¸ªThreadLocalMapï¼Œæ‰€ä»¥ä»¥ä¸€ä¸ªThreadLocalå¯¹åº”ä¸€ä¸ªè¦ä¿å­˜çš„valueå°±æ¯”è¾ƒåˆé€‚äº†&lt;/p&gt;
&lt;p&gt;Entryçš„ä½œç”¨å³æ˜¯ï¼šä¸ºå…¶å±ä¸»çº¿ç¨‹å»ºç«‹èµ·ä¸€ä¸ªThreadLocalå®ä¾‹ä¸ä¸€ä¸ªçº¿ç¨‹ç‰¹æœ‰å¯¹è±¡ä¹‹é—´çš„å¯¹åº”å…³ç³»ï¼›&lt;/p&gt;
&lt;p&gt;Entryå¯¹Keyçš„å¼•ç”¨æ˜¯å¼±å¼•ç”¨ï¼›Entryå¯¹ Valueçš„å¼•ç”¨æ˜¯å¼ºå¼•ç”¨ï¼›&lt;/p&gt;
&lt;p&gt;ThreadLocalMapä¸åŒäºHashMapï¼Œå…¶è§£å†³å“ˆå¸Œå†²çªä¸ä½¿ç”¨æ‹‰é“¾æ³•ï¼Œè€Œæ˜¯ä½¿ç”¨çº¿æ€§æ¢æµ‹æ³•ï¼Œå½“å‡ºç°å“ˆå¸Œå†²çªæ—¶ï¼Œç”±äºkeyæ˜¯å¼±å¼•ç”¨ï¼Œè¿˜ä¼šæœ‰ä¸åŒçš„é€»è¾‘è¿›è¡Œæ’å…¥&lt;/p&gt;
&lt;p&gt;æ¯æ¬¡å¯¹ThreadLocalåšgetã€setæ“ä½œæ—¶ï¼Œä»¥getæ–¹æ³•ä¸ºä¾‹ï¼Œå…ˆé€šè¿‡Thread.currentThread()è·å¾—å½“å‰çº¿ç¨‹ï¼Œåœ¨è·å–è¯¥çº¿ç¨‹å¯¹è±¡é‡Œçš„ThreadLocalMapï¼Œä»¥å½“å‰å¯¹è±¡ä¸ºkey(å½“å‰çº¿ç¨‹çš„ThreadLoacl)åœ¨ThreadLocalMapä¸­æ‰¾åˆ°valueï¼Œå¼ºè½¬è¿”å›&lt;/p&gt;
&lt;p&gt;ThreadLocalæœ¬èº«æœ‰æ¢æµ‹å¼æ¸…ç†å’Œå¯å‘å¼æ¸…ç†è¿‡æœŸçš„keyï¼Œä½†åœ¨ä¸€äº›åœºæ™¯ (å°¤å…¶æ˜¯ä½¿ç”¨çº¿ç¨‹æ± ) ä¸‹ï¼Œç”±äº ThreadLocal.ThreadLocalMap çš„åº•å±‚æ•°æ®ç»“æ„å¯¼è‡´ ThreadLocal æœ‰å†…å­˜æ³„æ¼çš„æƒ…å†µï¼Œåº”è¯¥å°½å¯èƒ½åœ¨æ¯æ¬¡ä½¿ç”¨ ThreadLocal åæ‰‹åŠ¨è°ƒç”¨ remove()ï¼Œä»¥é¿å…å‡ºç° ThreadLocal ç»å…¸çš„å†…å­˜æ³„æ¼ç”šè‡³æ˜¯é€ æˆè‡ªèº«ä¸šåŠ¡æ··ä¹±çš„é£é™©ï¼Œå› ä¸ºThreadLocalé‡Œçš„keyæ˜¯å¼±å¼•ç”¨ï¼Œå½“é‡Šæ”¾æ‰å¯¹threadlocalå¯¹è±¡çš„å¼ºå¼•ç”¨åï¼Œmapé‡Œé¢çš„valueæ²¡æœ‰è¢«å›æ”¶ï¼Œä½†å´æ°¸è¿œä¸ä¼šè¢«è®¿é—®åˆ°äº†&lt;/p&gt;
&lt;p&gt;è¯¦ç»†çš„å¯å‚è€ƒ&lt;a class=&#34;link&#34; href=&#34;https://snailclimb.gitee.io/javaguide/#/docs/java/Multithread/ThreadLocal?id=threadlocalset%e6%96%b9%e6%b3%95%e6%ba%90%e7%a0%81%e8%af%a6%e8%a7%a3&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;threadlocalsetæ–¹æ³•æºç è¯¦è§£&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;å‚è€ƒ-1&#34;&gt;å‚è€ƒ&lt;/h1&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://github.com/CyC2018/CS-Notes/blob/master/docs/notes/Java%20%E5%B9%B6%E5%8F%91.md&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;CyC2018/CS-Notes/å¹¶å‘&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.cnblogs.com/zhengbin/p/6505971.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;è¿‡æœŸçš„suspend()æŒ‚èµ·ã€resume()ç»§ç»­æ‰§è¡Œçº¿ç¨‹&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://blog.csdn.net/qq838642798/article/details/65441415&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;ReenTrantLockå¯é‡å…¥é”ï¼ˆå’Œsynchronizedçš„åŒºåˆ«ï¼‰æ€»ç»“&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://blog.csdn.net/weixin_40792878/article/details/81369385&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;ReentrantLocké”å’ŒSynchronizedé”çš„å¼‚åŒç‚¹&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://zhuanlan.zhihu.com/p/44185603&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Javaç¨‹åºå‘˜å¼€å‘å²—é¢è¯•çŸ¥è¯†ç‚¹è§£æ&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.cnblogs.com/chengxiao/p/7141160.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Javaå¹¶å‘åŒ…åŸºçŸ³-AQSè¯¦è§£&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://blog.csdn.net/zhangdong2012/article/details/79983404&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Javaå¹¶å‘-AQSåŠå„ç§Locké”çš„åŸç†&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.cnblogs.com/daydaynobug/p/6752837.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Javaå¹¶å‘ä¹‹AQSè¯¦è§£&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;http://www.cnblogs.com/chenpi/p/5614290.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Javaå¹¶å‘ç¼–ç¨‹JUCæ€»ç»“&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;é˜¿é‡Œå·´å·´Javaå¼€å‘æ‰‹å†Œ1.40&lt;/p&gt;
&lt;p&gt;Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜&lt;/p&gt;
</description>
        </item>
        <item>
        <title>Java IO</title>
        <link>http://nixum.cc/p/java-io/</link>
        <pubDate>Tue, 22 Sep 2020 00:00:00 +0000</pubDate>
        
        <guid>http://nixum.cc/p/java-io/</guid>
        <description>&lt;p&gt;[TOC]&lt;/p&gt;
&lt;h1 id=&#34;bio&#34;&gt;BIO&lt;/h1&gt;
&lt;p&gt;ç‰¹ç‚¹&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;BIOæ˜¯åŒæ­¥é˜»å¡çš„ï¼Œä»¥æµçš„å½¢å¼å¤„ç†ï¼ŒåŸºäºå­—èŠ‚æµå’Œå­—ç¬¦æµ&lt;/li&gt;
&lt;li&gt;æ¯ä¸ªè¯·æ±‚éƒ½éœ€è¦åˆ›å»ºç‹¬ç«‹çš„çº¿ç¨‹ï¼Œå¤„ç†Readå’ŒWrite&lt;/li&gt;
&lt;li&gt;å¹¶å‘æ•°è¾ƒå¤§æ—¶ï¼Œå°±ç®—æ˜¯ä½¿ç”¨äº†çº¿ç¨‹æ± ï¼Œä¹Ÿéœ€è¦åˆ›å»ºå¤§é‡çš„çº¿ç¨‹æ¥å¤„ç†&lt;/li&gt;
&lt;li&gt;è¿æ¥å»ºç«‹åï¼Œå¦‚æœå¤„ç†çº¿ç¨‹è¢«è¯»æ“ä½œé˜»å¡äº†ï¼Œé‚£å°±é˜»å¡äº†ï¼Œåªèƒ½ç­‰åˆ°è¯»å®Œæ‰èƒ½è¿›è¡Œå…¶ä»–æ“ä½œ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä»¥åŸºäºTCPåè®®çš„Socketï¼Œç¼–å†™æœåŠ¡ç«¯Demo&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;48
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;49
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;50
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;51
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;52
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;53
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;54
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;55
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;kn&#34;&gt;package&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;com.nixum.bio&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;

&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;java.io.InputStream&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;java.io.PrintWriter&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;java.net.ServerSocket&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;java.net.Socket&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;java.util.Date&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;java.util.concurrent.ExecutorService&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;java.util.concurrent.Executors&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;BIOServer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
  &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;throws&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Exception&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;ExecutorService&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;newCachedThreadPool&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Executors&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;newCachedThreadPool&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;//åˆ›å»ºServerSocket
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;ServerSocket&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;serverSocket&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ServerSocket&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;8080&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;while&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;c1&#34;&gt;// ä¸»çº¿ç¨‹è´Ÿè´£å¤„ç†ç›‘å¬
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;kd&#34;&gt;final&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Socket&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;socket&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;serverSocket&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;accept&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
      &lt;span class=&#34;c1&#34;&gt;// åˆ›å»ºçº¿ç¨‹å¤„ç†è¯·æ±‚
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;newCachedThreadPool&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;execute&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;handler&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;socket&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
      &lt;span class=&#34;o&#34;&gt;});&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
  &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;

  &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;handler&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Socket&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;socket&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;try&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;bytes&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;1024&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;];&lt;/span&gt;
      &lt;span class=&#34;c1&#34;&gt;//é€šè¿‡socketè·å–è¾“å…¥æµ
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;InputStream&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;inputStream&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;socket&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getInputStream&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
      &lt;span class=&#34;c1&#34;&gt;//å¾ªç¯çš„è¯»å–å®¢æˆ·ç«¯å‘é€çš„æ•°æ®
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;k&#34;&gt;while&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;read&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;inputStream&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;read&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bytes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;read&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
          &lt;span class=&#34;n&#34;&gt;System&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;out&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;println&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;æ¥æ”¶åˆ°çš„è¯·æ±‚æ˜¯ï¼š&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bytes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;read&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;));&lt;/span&gt;
        &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
          &lt;span class=&#34;k&#34;&gt;break&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
        &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
        &lt;span class=&#34;c1&#34;&gt;// å“åº”ç»™å®¢æˆ·ç«¯
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;n&#34;&gt;PrintWriter&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;out&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PrintWriter&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;socket&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getOutputStream&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;());&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;out&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;println&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;æœåŠ¡ç«¯æ¥æ”¶åˆ°è¯·æ±‚äº†ï¼Œå“åº”æ—¶é—´ï¼š&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Date&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;());&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;out&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;flush&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
      &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;catch&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Exception&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;e&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;e&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;printStackTrace&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;finally&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;k&#34;&gt;try&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;c1&#34;&gt;// å…³é—­è¿æ¥
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;n&#34;&gt;socket&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;close&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
      &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;catch&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Exception&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;e&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;e&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;printStackTrace&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
      &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
  &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;å®¢æˆ·ç«¯Demoï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;kn&#34;&gt;package&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;com.atguigu.bio&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;

&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;java.io.BufferedReader&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;java.io.InputStreamReader&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;java.io.PrintStream&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;java.net.Socket&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;java.util.Scanner&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;BIOClient&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
  &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;throws&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Exception&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;Socket&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;client&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Socket&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;127.0.0.1&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;8080&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;Scanner&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;scan&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Scanner&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;System&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;in&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;PrintStream&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;out&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PrintStream&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;client&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getOutputStream&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;());&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;BufferedReader&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;bufferReader&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;
      &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;BufferedReader&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;InputStreamReader&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;client&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getInputStream&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()));&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;while&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;scan&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;hasNext&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;())&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;c1&#34;&gt;// é”®ç›˜è¾“å…¥ï¼Œå¹¶å‘é€è¯·æ±‚
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;str&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;scan&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;next&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;exit&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;equalsIgnoreCase&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;str&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;))&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
          &lt;span class=&#34;k&#34;&gt;break&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
        &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;out&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;println&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;str&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;out&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;flush&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
        &lt;span class=&#34;c1&#34;&gt;// æ¥æ”¶æœåŠ¡ç«¯çš„å“åº”
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;n&#34;&gt;System&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;out&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;println&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bufferReader&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;readLine&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;());&lt;/span&gt;
      &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;client&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;close&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
  &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h1 id=&#34;nio&#34;&gt;NIO&lt;/h1&gt;
&lt;p&gt;ç‰¹ç‚¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;åŒæ­¥éé˜»å¡ï¼Œé€šè¿‡ç¼“å†²åŒºè¿›è¡Œç¼“å†²å¢åŠ å¤„ç†çš„çµæ´»æ€§ï¼Œå½“æŸä¸€çº¿ç¨‹é‡Œ&lt;strong&gt;æ²¡æœ‰æ•°æ®å¯ç”¨&lt;/strong&gt;æ—¶ï¼Œåˆ™å»å¤„ç†å…¶ä»–äº‹æƒ…ï¼Œä¿è¯çº¿ç¨‹ä¸é˜»å¡&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç”±ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆï¼šChannelã€Bufferã€Selector&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ•°æ®æ€»æ˜¯ä»Channelè¯»åˆ°Bufferä¸­ï¼Œæˆ–ä»Bufferå†™åˆ°Channelä¸­ï¼Œäº‹ä»¶ + Selectorç›‘å¬Channelï¼Œå®ç°ä¸€ä¸ªçº¿ç¨‹å¤„ç†å¤šä¸ªæ“ä½œã€‚æ¯ä¸€ä¸ªChannelä¼šå¯¹åº”ä¸€ä¸ªBufferã€ä¸€ä¸ªSelectorå¯¹åº”å¤šä¸ªChannelï¼ŒSelectoré€šè¿‡äº‹ä»¶å†³å®šä½¿ç”¨å“ªä¸ªChannel&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;buffer&#34;&gt;Buffer&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;å­˜å‚¨æ•°æ®æ—¶ä½¿ç”¨ï¼Œæœ¬è´¨æ˜¯ä¸€ä¸ªæ•°ç»„&lt;/li&gt;
&lt;li&gt;æ¸…é™¤æ—¶æœ¬è´¨åªæ˜¯æŠŠä¸‹åˆ—å„ä¸ªå±æ€§æ¢å¤åˆ°åˆå§‹çŠ¶æ€ï¼Œæ•°æ®æ²¡æœ‰è¢«æ­£å¸¸çš„æ“¦é™¤ï¼Œè€Œæ˜¯ç”±åé¢çš„æ•°æ®è¦†ç›–&lt;/li&gt;
&lt;li&gt;å°†æ•°æ®è¯»å…¥Bufferåï¼Œéœ€è¦è°ƒç”¨flipæ–¹æ³•è¿›è¡Œåè½¬åæ‰èƒ½å°†Bufferé‡Œçš„æ•°æ®å†™å‡ºæ¥&lt;/li&gt;
&lt;li&gt;å¯ä»¥putå„ç§ç±»å‹çš„æ•°æ®è¿›byteBufferåï¼Œflipåï¼Œéœ€è¦æŒ‰é¡ºåºå’Œç±»å‹è¿›è¡Œgetæ“ä½œï¼Œå¦åˆ™ä¼šæŠ›å¼‚å¸¸&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;é‡è¦å±æ€§&#34;&gt;é‡è¦å±æ€§&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;8
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// ä¸‹ä¸€ä¸ªè¦è¯»æˆ–å†™çš„ä½ç½®ç´¢å¼•
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;position&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;// ç¼“å†²åŒºçš„å½“å‰ç»ˆç‚¹ï¼Œ&amp;lt;= limitï¼Œè¯»å†™æ—¶ä½ç½®ç´¢å¼•ä¸èƒ½è¶…å‡ºlimit
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;limit&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;// ç¼“å†²åŒºå®¹é‡
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;capacity&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;// æ ‡è®°ï¼Œæ ‡è®°åç”¨äºé‡æ–°æ¢å¤åˆ°çš„ä½ç½®
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;mark&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h3 id=&#34;å¸¸ç”¨å­ç±»&#34;&gt;å¸¸ç”¨å­ç±»&lt;/h3&gt;
&lt;p&gt;æ¯ä¸ªåŸºæœ¬ç±»å‹éƒ½æœ‰å¯¹åº”çš„Bufferï¼Œæ¯”å¦‚CharBufferã€IntBufferã€DoubleBufferã€ByteBufferï¼ˆæœ€å¸¸ç”¨ï¼‰&lt;/p&gt;
&lt;h2 id=&#34;channel&#34;&gt;Channel&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;ä½œç”¨ç±»ä¼¼æµï¼Œä½†æµæ˜¯å•çº¿çš„ï¼Œåªèƒ½è¯»æˆ–åªèƒ½å†™ï¼Œè€ŒChannelæ˜¯åŒå‘çš„ï¼Œå¯ä»¥åŒæ—¶è¿›è¡Œè¯»å†™&lt;/li&gt;
&lt;li&gt;å¯å¼‚æ­¥&lt;/li&gt;
&lt;li&gt;é€šå¸¸ä¸Bufferé…åˆä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨Bufferæ•°ç»„ï¼Œå½“ä¸€ä¸ªbufferå­˜æ»¡æ—¶ä¼šå–ä¸‹ä¸€ä¸ªbufferå–å¤„ç†&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;å¸¸ç”¨å­ç±»-1&#34;&gt;å¸¸ç”¨å­ç±»&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;FileChannelä¸“é—¨å¤„ç†æ–‡ä»¶ç›¸å…³çš„æ•°æ®ï¼ˆä»FileIn/OutputStreamçš„getChannel()æ–¹æ³•å¾—åˆ°ï¼‰&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ServerSocketChannelå’ŒSocketChannelç”¨äºå¤„ç†TCPè¿æ¥çš„æ•°æ®&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;DatagramChannelç”¨äºå¤„ç†UDPè¿æ¥çš„æ•°æ®&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¯»å†™æ–‡ä»¶çš„Demoï¼Œæ¯”å¦‚ä»ä¸€ä¸ªæ–‡ä»¶é‡Œè¯»å‡ºæ•°æ®å¹¶å†™å…¥å¦ä¸€ä¸ªæ–‡ä»¶&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;kn&#34;&gt;package&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;com.nixum.nio&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;

&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;java.io.FileInputStream&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;java.io.FileOutputStream&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;java.nio.ByteBuffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;java.nio.channels.FileChannel&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;CopyFileAToB&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
  &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;throws&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Exception&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;FileInputStream&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;fileInputStream&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;FileInputStream&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;first.txt&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;FileChannel&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;readFileChannel&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;fileInputStream&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getChannel&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;

    &lt;span class=&#34;n&#34;&gt;FileOutputStream&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;fileOutputStream&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;FileOutputStream&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;second.txt&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;FileChannel&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;writeFileChannel&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;fileOutputStream&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getChannel&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;

    &lt;span class=&#34;c1&#34;&gt;// åªè®¾ç½®æˆ1024çš„å®¹é‡ï¼Œé€šè¿‡å¾ªç¯ + clearè¦†ç›–é‡å†™
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;ByteBuffer&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;byteBuffer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ByteBuffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;allocate&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;1024&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;while&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;byteBuffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;clear&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
      &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;read&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;readFileChannel&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;read&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;byteBuffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
      &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;read&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;k&#34;&gt;break&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
      &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
      &lt;span class=&#34;c1&#34;&gt;// å†™æ“ä½œå‰éœ€è¦å…ˆflip
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;byteBuffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;flip&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;writeFileChannel&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;write&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;byteBuffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// close
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;fileInputStream&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;close&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;fileOutputStream&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;close&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
  &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id=&#34;selector&#34;&gt;Selector&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;ä¸€ä¸ªçº¿ç¨‹å¤„ç†å¤šä¸ªè¿æ¥ï¼Œå°±æ˜¯é Selectorï¼ŒChanneléœ€è¦äº‹å…ˆæ³¨å†Œåˆ°Selectorä¸Šï¼ŒSelectoræ ¹æ®äº‹ä»¶é€‰æ‹©Channelè¿›è¡Œå¤„ç†ã€‚å®é™…ä¸Šæ˜¯ä¸€ä¸ªå‘å¸ƒè®¢é˜…æ¨¡å‹ï¼Œé€šè¿‡äº‹ä»¶è§¦å‘&lt;/li&gt;
&lt;li&gt;åªæœ‰çœŸæ­£æœ‰è¯»å†™äº‹ä»¶æ—¶æ‰ä¼šè¿›è¡Œè¯»å†™ï¼Œå°±ä¸ç”¨ä¸ºæ¯ä¸ªè¿æ¥éƒ½åˆ›å»ºä¸€ä¸ªçº¿ç¨‹äº†&lt;/li&gt;
&lt;li&gt;é¿å…å¤šçº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢çš„å¼€é”€&lt;/li&gt;
&lt;li&gt;selectionKeyï¼Œå¯ä»¥ç†è§£ä¸ºè§¦å‘selectorçš„äº‹ä»¶ï¼Œæœ‰4ç§ï¼ŒOP_ACCEPTï¼šæœ‰æ–°è¿æ¥äº§ç”Ÿï¼Œä¸€èˆ¬ç”¨äºæœåŠ¡ç«¯å»ºç«‹è¿æ¥ã€OP_CONNECTï¼šè¿æ¥å·²å»ºç«‹ï¼Œä¸€èˆ¬ç”¨äºå®¢æˆ·ç«¯å»ºç«‹è¿æ¥ã€OP_READï¼šè¯»æ“ä½œã€OP_WRITEï¼šå†™æ“ä½œ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;NIOåŸºæœ¬ä½¿ç”¨Demoï¼ŒæœåŠ¡ç«¯ï¼Œä¹Ÿå¯ä»¥ä¸ä½¿ç”¨Selectorï¼Œä½†è¿™æ ·å°±è·ŸBIOæ²¡ä»€ä¹ˆå·®åˆ«äº†&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;48
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;49
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;50
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;51
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;52
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;53
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;54
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;55
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;56
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;57
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;58
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;59
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;60
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;61
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;62
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;63
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;64
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;65
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;66
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;67
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;68
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;69
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;70
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;71
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;72
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;73
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;74
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;75
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;76
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;77
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;78
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;79
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;80
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;kn&#34;&gt;package&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;com.nixum.nio&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;

&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;java.net.InetSocketAddress&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;java.nio.ByteBuffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;java.nio.channels.*&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;java.util.Iterator&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;java.util.Set&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;NIOServer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
  &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ServerSocketChannel&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;serverSocketChannel&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
  &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Selector&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;

  &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;NIOServer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;try&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;serverSocketChannel&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ServerSocketChannel&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;open&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;selector&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Selector&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;open&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;serverSocketChannel&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;socket&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;bind&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;InetSocketAddress&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;));&lt;/span&gt;
      &lt;span class=&#34;c1&#34;&gt;// éœ€è¦æ˜¾å¼è®¾ç½®ä¸ºéé˜»å¡
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;serverSocketChannel&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;configureBlocking&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
      &lt;span class=&#34;c1&#34;&gt;// æ³¨å†ŒserverSocketChannelï¼Œè§¦å‘äº‹ä»¶ä¸º OP_ACCEPTï¼Œç”¨äºå»ºç«‹è¿æ¥
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;serverSocketChannel&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;register&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;SelectionKey&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;OP_ACCEPT&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;catch&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Exception&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;e&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;e&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;printStackTrace&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
  &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;

  &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;run&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;throws&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Exception&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;while&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;c1&#34;&gt;// ç­‰å¾…1sè·å–äº‹ä»¶ï¼Œè¿™æ ·ä¸€æ¬¡æ€§å¯ä»¥è·å–å¤šä¸ªäº‹ä»¶è¿›è¡Œå¤„ç†ï¼Œå¦‚æœæ²¡æœ‰åˆ™ç»§ç»­
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;select&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;1000&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;System&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;out&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;println&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;è¿™1ç§’å†…æ²¡æœ‰æ”¶åˆ°æ•°æ®&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
        &lt;span class=&#34;k&#34;&gt;continue&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
      &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
      &lt;span class=&#34;c1&#34;&gt;// ç›‘å¬åˆ°äº‹ä»¶å‘ç”Ÿï¼Œ è·å–å‘ç”Ÿçš„äº‹ä»¶é›†åˆ
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;Set&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;SelectionKey&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;selectionKeys&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;selectedKeys&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;Iterator&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;SelectionKey&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;keyIterator&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;selectionKeys&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;iterator&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;

      &lt;span class=&#34;c1&#34;&gt;// åˆ¤æ–­äº‹ä»¶çš„ç±»å‹
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;k&#34;&gt;while&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;keyIterator&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;hasNext&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;())&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;SelectionKey&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;key&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;keyIterator&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;next&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
        &lt;span class=&#34;c1&#34;&gt;// è§¦å‘çš„æ˜¯OP_ACCEPTäº‹ä»¶
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;isAcceptable&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;())&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
          &lt;span class=&#34;n&#34;&gt;connectionHandler&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;serverSocketChannel&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
        &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
        &lt;span class=&#34;c1&#34;&gt;// è§¦å‘OP_READäº‹ä»¶
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;isReadable&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;())&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
          &lt;span class=&#34;n&#34;&gt;readHandler&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
        &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
        &lt;span class=&#34;c1&#34;&gt;// å°†å¤„ç†å®Œçš„äº‹ä»¶é›†åˆç§»é™¤ï¼Œé˜²æ­¢é‡å¤æ“ä½œ
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;n&#34;&gt;keyIterator&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;remove&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
      &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
      &lt;span class=&#34;c1&#34;&gt;// å¤„ç†å®Œäº‹ä»¶é›†åˆ
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
  &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;

  &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;connectionHandler&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Selector&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ServerSocketChannel&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;serverSocketChannel&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;throws&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Exception&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// å»ºç«‹è¿æ¥
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;SocketChannel&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;socketChannel&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;serverSocketChannel&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;accept&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// å°†SocketChannel è®¾ç½®ä¸ºéé˜»å¡
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;socketChannel&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;configureBlocking&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// å»ºç«‹è¿æ¥åï¼Œå°†socketChannelæ³¨å†Œåˆ°selectorï¼Œåˆå§‹åŒ–ä¸€ä¸ªBufferç”¨æ¥è£…æ•°æ®ï¼Œå‘é€OP_READç»™selectorï¼Œå½“selectoræ”¶åˆ°OP_READäº‹ä»¶åï¼Œå°±ä¼šä½¿ç”¨è¯¥socketChannelå¤„ç†è¯¥Buffer
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;socketChannel&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;register&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;SelectionKey&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;OP_READ&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ByteBuffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;allocate&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;1024&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;));&lt;/span&gt;
  &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;

  &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;readHandler&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;SelectionKey&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;throws&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Exception&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// è·å–å¤„ç†è¯¥äº‹ä»¶çš„channel
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;SocketChannel&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;channel&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;SocketChannel&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;channel&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// è·å–è¯¥channelå…³è”çš„Buffer
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;ByteBuffer&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ByteBuffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;attachment&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// å°†channelé‡Œçš„æ•°æ®è¯»åˆ°bufferé‡Œ
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;channel&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;read&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;System&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;out&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;println&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;æ¥æ”¶åˆ°è¯·æ±‚æ˜¯ï¼š&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;array&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()));&lt;/span&gt;
  &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;

  &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;final&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PORT&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;8080&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
  &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;throws&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Exception&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;NIOServer&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;server&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;NIOServer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PORT&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;server&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;run&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
  &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;å®¢æˆ·ç«¯ï¼Œè¿™é‡Œæ²¡æœ‰ä½¿ç”¨selectorï¼Œç›´æ¥ä½¿ç”¨socketChannelè¿æ¥ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;kn&#34;&gt;package&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;com.nixum.nio&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;

&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;java.net.InetSocketAddress&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;java.nio.ByteBuffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;java.nio.channels.SocketChannel&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;NIOClient&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
  &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;throws&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Exception&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;SocketChannel&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;socketChannel&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;SocketChannel&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;open&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;socketChannel&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;configureBlocking&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;InetSocketAddress&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;inetSocketAddress&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;InetSocketAddress&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;127.0.0.1&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;8080&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(!&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;socketChannel&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;connect&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;inetSocketAddress&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;))&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;c1&#34;&gt;// è¿™é‡Œçš„ä¾‹å­æ˜¯ä¸ºäº†è¯´æ˜å¦‚æœè¿æ¥å’Œå¤„ç†æ˜¯å¼‚æ­¥çš„ï¼Œéé˜»å¡çš„
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;k&#34;&gt;while&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(!&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;socketChannel&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;finishConnect&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;())&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;System&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;out&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;println&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;å½“è¿æ¥è¿˜æ²¡å®Œæˆæ—¶ï¼Œä¼šå¾ªç¯æ‰“å°ï¼Œä½†æ­¤æ—¶ä¹Ÿåœ¨æ‰§è¡Œè¿æ¥ï¼Œè¯·ç¨ç­‰&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
      &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// å¦‚æœè¦ä½¿ç”¨selectorï¼Œåˆ™åœ¨æ­¤å¤„å°†socketChannelæ³¨å†Œè¿›selectorï¼Œå‰©ä¸‹å¤„ç†è·Ÿä¸Šé¢ç±»ä¼¼
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;str&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;hello, world&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;ByteBuffer&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ByteBuffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;wrap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;str&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getBytes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;());&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;// æ ¹æ®strçš„å¤§å°wrapä¸€ä¸ªbuffer
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// å‘é€è¯·æ±‚
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;socketChannel&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;write&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
  &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h1 id=&#34;çº¿ç¨‹æ¨¡å‹&#34;&gt;çº¿ç¨‹æ¨¡å‹&lt;/h1&gt;
&lt;h2 id=&#34;ä¼ ç»Ÿé˜»å¡ioæ¨¡å‹&#34;&gt;ä¼ ç»Ÿé˜»å¡IOæ¨¡å‹&lt;/h2&gt;
&lt;p&gt;å…¸å‹çš„BIOä¾‹å­ï¼Œæœ‰ä¸€ä¸ªServiceSocketåœ¨ç›‘å¬ç«¯å£ï¼Œä¸€ä¸ªçº¿ç¨‹å¤„ç†ä¸€ä¸ªè¿æ¥ï¼Œç›‘å¬ç«¯å£ã€å»ºç«‹è¿æ¥ï¼Œreadæ“ä½œã€ä¸šåŠ¡å¤„ç†ã€writeæ“ä½œè¿™ä¸€æ•´ä¸ªè¿‡ç¨‹éƒ½æ˜¯é˜»å¡çš„&lt;/p&gt;
&lt;h2 id=&#34;reactoræ¨¡å‹&#34;&gt;Reactoræ¨¡å‹&lt;/h2&gt;
&lt;p&gt;reactorå…¶å®å°±æ˜¯é’ˆå¯¹ä¼ ç»Ÿé˜»å¡IOæ¨¡å‹çš„ç¼ºç‚¹ï¼Œå°†ä¸Šè¿°æ“ä½œæ‹†åˆ†å‡ºæ¥å¼‚æ­¥å¤„ç†ï¼Œé€šè¿‡äº‹ä»¶é€šçŸ¥ï¼Œç”±ä¸€ä¸ªä¸­å¿ƒè¿›è¡Œåˆ†å‘ï¼Œæœ¬è´¨å°±ç®—IOå¤ç”¨ + çº¿ç¨‹æ± ï¼Œç”šè‡³å•çº¿ç¨‹ + æ¶ˆæ¯é˜Ÿåˆ—ä¹Ÿå¯ä»¥&lt;/p&gt;
&lt;h3 id=&#34;1-å•reactorå•çº¿ç¨‹&#34;&gt;1. å•Reactorå•çº¿ç¨‹&lt;/h3&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/%e5%8d%95Reactor%e5%8d%95%e7%ba%bf%e7%a8%8b%e6%a8%a1%e5%9e%8b.jpg&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/%e5%8d%95Reactor%e5%8d%95%e7%ba%bf%e7%a8%8b%e6%a8%a1%e5%9e%8b.jpg&#34;
			
			
			
			loading=&#34;lazy&#34;
			alt=&#34;å•Reactorå•çº¿ç¨‹æ¨¡å‹&#34;&gt;
	&lt;/a&gt;
	
	&lt;figcaption&gt;å•Reactorå•çº¿ç¨‹æ¨¡å‹&lt;/figcaption&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Acceptorå®é™…ä¸Šä¹Ÿæ˜¯ä¸€ä¸ªHandlerï¼Œåªæ˜¯å¤„ç†çš„äº‹ä»¶ä¸åŒï¼Œå½“Reactoræ”¶åˆ°(select)è¿æ¥äº‹ä»¶æ—¶è°ƒç”¨&lt;/li&gt;
&lt;li&gt;å½“Reactoræ”¶åˆ°(select)éè¿æ¥äº‹ä»¶ï¼Œæ¯”å¦‚è¯»äº‹ä»¶ã€å†™äº‹ä»¶ã€å¤„ç†å…¶ä»–ä¸šåŠ¡çš„äº‹ä»¶ç­‰ï¼Œä¼šèµ·ä¸€ä¸ªhandleræ¥å¤„ç†&lt;/li&gt;
&lt;li&gt;å½“Handlerå¤„ç†å®Œå½“å‰äº‹ä»¶åï¼Œå°†ä¸‹ä¸€æ¬¡è¦å¤„ç†çš„äº‹ä»¶å’Œç›¸å…³å‚æ•°ä¸¢ç»™Reactorè¿›è¡Œselectå’Œdispatch&lt;/li&gt;
&lt;li&gt;å•çº¿ç¨‹æ¨¡å‹ï¼Œå¤©ç„¶æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä½†æ˜¯å½“handlerå¤„ç†è¿‡æ…¢æ—¶å°±ä¼šé€ æˆäº‹ä»¶å †ç§¯ï¼Œé˜»å¡ä¸»çº¿ç¨‹(Reactor)ï¼Œå¤„ç†èƒ½åŠ›ä¸‹é™ï¼Œå› æ­¤è¦æ±‚handlerå¤„ç†å°½å¯èƒ½çš„å¿«ã€‚&lt;/li&gt;
&lt;li&gt;å¼‚å¸¸å¤„ç†è¦å°å¿ƒï¼Œå¦åˆ™ä¼šå¯¼è‡´æ•´ä¸ªçº¿ç¨‹å®æ‰&lt;/li&gt;
&lt;li&gt;æ¯”å¦‚ä¸Šé¢NIOçš„ä¾‹å­å°±æ˜¯è¿™ä¸ªæ¨¡å‹ï¼Œå½“ä¸šåŠ¡å¤æ‚æ—¶ï¼Œä¹Ÿå¯å°†handleræŠ½å‡ºã€‚ä¸åŒçš„Handlerç±»å®ç°ä¸åŒçš„ä¸šåŠ¡å¤„ç†ï¼Œå†é…åˆå¯¹è±¡æ± å®ç°å¤ç”¨&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;2-å•reactorå¤šçº¿ç¨‹&#34;&gt;2. å•Reactorå¤šçº¿ç¨‹&lt;/h3&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/%e5%8d%95Reactor%e5%a4%9a%e7%ba%bf%e7%a8%8b%e6%a8%a1%e5%9e%8b.jpg&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/%e5%8d%95Reactor%e5%a4%9a%e7%ba%bf%e7%a8%8b%e6%a8%a1%e5%9e%8b.jpg&#34;
			
			
			
			loading=&#34;lazy&#34;
			alt=&#34;å•Reactorå¤šçº¿ç¨‹æ¨¡å‹&#34;&gt;
	&lt;/a&gt;
	
	&lt;figcaption&gt;å•Reactorå¤šçº¿ç¨‹æ¨¡å‹&lt;/figcaption&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨å•Reactorå•çº¿ç¨‹æ¨¡å‹çš„åŸºç¡€ä¸Šï¼Œå› ä¸ºHandlerçš„å¤„ç†æµç¨‹ç›¸å¯¹å›ºå®šï¼Œå°±å°†æ¯”è¾ƒè€—æ—¶çš„ä¸šåŠ¡å¤„ç†åŒ…è£…æˆä»»åŠ¡äº¤ç”±çº¿ç¨‹æ± å¤„ç†ï¼ŒåŠ å¿«Handlerçš„å¤„ç†é€Ÿåº¦&lt;/li&gt;
&lt;li&gt;å®é™…ä¸Šå¦‚æœåªæ˜¯åœ¨Handlerå¤„å°†ä¸šåŠ¡é€»è¾‘äº¤ç»™çº¿ç¨‹æ± å»åšï¼Œå†åŒæ­¥ç­‰å¾…ç»“æœï¼Œåªæ˜¯ä¸€ç§ä¼ªå¼‚æ­¥ï¼Œæœ¬è´¨ä¸ŠHandlerè¿˜æ˜¯è¦ç­‰ä»»åŠ¡æ‰§è¡Œå®Œæ‰èƒ½æ‰§è¡Œsendæ“ä½œã€‚ä¼˜åŒ–çš„æ–¹æ³•æ˜¯å…ˆå°†Handlerå­˜èµ·æ¥ï¼ŒæŠŠä¸šåŠ¡å¤„ç†æäº¤ç»™çº¿ç¨‹æ± åï¼Œå°±ç»“æŸhandlerçš„æ‰§è¡Œäº†ï¼Œè¿™æ ·å°±èƒ½æŠŠä¸»çº¿ç¨‹é‡Šæ”¾å‡ºæ¥ï¼Œå¤„ç†å…¶ä»–äº‹ä»¶ã€‚å½“çº¿ç¨‹æ± é‡Œçš„ä»»åŠ¡æ‰§è¡Œå®Œï¼Œåªéœ€å°†ç»“æœã€handlerIdã€äº‹ä»¶äº¤ç”±Reactorï¼ŒReactoræ ¹æ®äº‹ä»¶å’ŒHandlerIdæ‰¾åˆ°å¯¹åº”çš„Handlerå»å“åº”ç»“æœå°±å¯ä»¥äº†ã€‚&lt;/li&gt;
&lt;li&gt;ç”±äºä¸šåŠ¡å¤„ç†ä½¿ç”¨äº†å¤šçº¿ç¨‹ï¼Œéœ€è¦æ³¨æ„å…±äº«æ•°æ®çš„é—®é¢˜ï¼Œå¤„ç†èµ·æ¥ä¼šæ¯”è¾ƒå¤æ‚ï¼Œçº¿ç¨‹å®‰å…¨åªå­˜åœ¨äºReactoræ‰€åœ¨çš„çº¿ç¨‹&lt;/li&gt;
&lt;li&gt;Reactoréœ€è¦å¤„ç†çš„äº‹ä»¶å˜å¤šï¼Œé«˜å¹¶å‘ä¸‹å®¹æ˜“å‡ºç°æ€§èƒ½ç“¶é¢ˆ&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;3-ä¸»ä»reactorå¤šçº¿ç¨‹&#34;&gt;3. ä¸»ä»Reactorå¤šçº¿ç¨‹&lt;/h3&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/%e5%a4%9aReactor%e5%a4%9a%e7%ba%bf%e7%a8%8b%e6%a8%a1%e5%9e%8b.jpg&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/%e5%a4%9aReactor%e5%a4%9a%e7%ba%bf%e7%a8%8b%e6%a8%a1%e5%9e%8b.jpg&#34;
			
			
			
			loading=&#34;lazy&#34;
			alt=&#34;å¤šReactorå¤šçº¿ç¨‹æ¨¡å‹&#34;&gt;
	&lt;/a&gt;
	
	&lt;figcaption&gt;å¤šReactorå¤šçº¿ç¨‹æ¨¡å‹&lt;/figcaption&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨å•Reactorå¤šçº¿ç¨‹æ¨¡å‹çš„åŸºç¡€ä¸Šï¼Œå°†Handlerä¸‹æ²‰å¤„ç†ï¼Œé€šè¿‡å­Reactoræ¥æé«˜å¹¶å‘å¤„ç†èƒ½åŠ›ã€‚Acceptorå¤„ç†è¿æ¥äº‹ä»¶åï¼Œå°†è¿æ¥åˆ†é…ç»™SubReactorå¤„ç†ï¼Œä¾‹å¦‚ä¸€ä¸ªè¿æ¥å¯¹åº”ä¸€ä¸ªSubReactorï¼ŒSubReactorè´Ÿè´£å¤„ç†è¿æ¥åçš„ä¸šåŠ¡å¤„ç†ï¼Œå¯ä»¥æŠŠè¿™å±‚ç†è§£ä¸ºå•Reactorå¤šçº¿ç¨‹æ¨¡å‹çš„Reactor&lt;/li&gt;
&lt;li&gt;ç”±äºåˆå¤šäº†ä¸€å±‚ï¼Œçº¿ç¨‹å¤„ç†æ›´åŠ å¤æ‚ï¼ŒåŒä¸€Reactorä¸‹æ‰èƒ½ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œä¸åŒReactoré—´è¦æ³¨æ„æ•°æ®å…±äº«é—®é¢˜&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;netty&#34;&gt;Netty&lt;/h1&gt;
&lt;p&gt;å¯¹NIOçš„åŒ…è£…ï¼Œç®€åŒ–NIOçš„ä½¿ç”¨ï¼›å®ç°å®¢æˆ·ç«¯é‡è¿ã€é—ªæ–­ã€åŠåŒ…è¯»å†™ã€å¤±è´¥ç¼“å†²ã€ç½‘ç»œæ‹¥å¡å’Œå¼‚å¸¸æµå¤„ç†ï¼›åŸºäºä¸»ä»Reactorå¤šçº¿ç¨‹æ¨¡å‹ï¼Œäº‹ä»¶é©±åŠ¨&lt;/p&gt;
&lt;h2 id=&#34;serverç«¯çº¿ç¨‹æ¨¡å‹&#34;&gt;Serverç«¯çº¿ç¨‹æ¨¡å‹&lt;/h2&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/netty%e7%ba%bf%e7%a8%8b%e6%a8%a1%e5%9e%8b.jpg&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/netty%e7%ba%bf%e7%a8%8b%e6%a8%a1%e5%9e%8b.jpg&#34;
			
			
			
			loading=&#34;lazy&#34;
			alt=&#34;Nettyçº¿ç¨‹æ¨¡å‹&#34;&gt;
	&lt;/a&gt;
	
	&lt;figcaption&gt;Nettyçº¿ç¨‹æ¨¡å‹&lt;/figcaption&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;h2 id=&#34;demo&#34;&gt;Demo&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;BossGroupä¸“é—¨å¤„ç†è¿æ¥ï¼ŒWorkerGroupä¸“é—¨å¤„ç†è¯»å†™&lt;/li&gt;
&lt;li&gt;NioEventLoopæ˜¯ä¸€ä¸ªæ— é™å¾ªç¯çš„çº¿ç¨‹ï¼Œä¸æ–­çš„å¤„ç†äº‹ä»¶ï¼Œæ¯ä¸€ä¸ªNioEventLoopæœ‰ä¸€ä¸ªselectorï¼Œç”¨äºç›‘å¬äº‹ä»¶&lt;/li&gt;
&lt;li&gt;NioEventLoopå†…éƒ¨ä¸²è¡ŒåŒ–è®¾è®¡ï¼Œè´Ÿè´£æ¶ˆæ¯çš„è¯»å– -&amp;gt; è§£ç  -&amp;gt; å¤„ç† -&amp;gt; ç¼–ç  -&amp;gt; å‘é€&lt;/li&gt;
&lt;li&gt;ä¸€ä¸ªNioEventLoopGroupåŒ…å«å¤šä¸ªNioEventLoopï¼Œæ¯ä¸ªNioEventLoopåŒ…å«ä¸€ä¸ªSelectorï¼Œä¸€ä¸ªtaskQueue&lt;/li&gt;
&lt;li&gt;Selectorå¯ä»¥æ³¨å†Œç›‘å¬å¤šä¸ªNioChannelï¼Œæ¯ä¸ªNioChannelåªä¼šç»‘å®šåœ¨å”¯ä¸€çš„NioEventLoopä¸Šï¼Œæ¯ä¸ªNioChanneléƒ½ç»‘å®šæœ‰ä¸€ä¸ªè‡ªå·±çš„ChannelPipeline&lt;/li&gt;
&lt;li&gt;æ³¨æ„å¦‚æœåœ¨ä¸€æ¬¡è¿æ¥ä¸­å¤šæ¬¡è°ƒç”¨ChannelHandlerContextçš„writeAndFlushå“åº”æ•°æ®å›å»æ—¶ï¼Œæ¯æ¬¡writeAndFlushå†™å‡ºå»çš„æ•°æ®ä¼šæ•´åˆåœ¨ä¸€èµ·åæ‰å“åº”å›å»ï¼Œå³TCPçš„ç²˜åŒ…ï¼Œæ¥æ”¶ç«¯åªä¼šæ¥æ”¶åˆ°åˆå¹¶åçš„æ•°æ®åŒ…ï¼Œéœ€è¦ç‰¹æ®Šå¤„ç†å»æ‹†åŒ…&lt;/li&gt;
&lt;li&gt;nettyä¸­çš„I/Oæ“ä½œæ˜¯å¼‚æ­¥çš„ï¼Œå¦‚ bindã€wirteã€connectæ–¹æ³•éƒ½æ˜¯è¿”å›ä¸€ä¸ªChannelFetureï¼Œå¯ä»¥ä½¿ç”¨ChannelFetureçš„syncæ–¹æ³•å°†å¼‚æ­¥æ”¹ä¸ºåŒæ­¥ï¼Œæˆ–è€…è°ƒç”¨å…¶ä»–æ–¹æ³•æ¥åˆ¤æ–­å…¶çŠ¶æ€å’Œç»“æœ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æœåŠ¡ç«¯&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;48
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;49
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;50
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;51
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;52
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;53
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;54
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;55
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;56
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;57
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;58
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;59
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;60
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;61
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;62
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;63
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;64
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;65
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;kn&#34;&gt;package&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;com.nixum.netty&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;

&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;io.netty.bootstrap.ServerBootstrap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;io.netty.channel.ChannelFuture&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;io.netty.channel.ChannelFutureListener&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;io.netty.channel.ChannelInitializer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;io.netty.channel.ChannelOption&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;io.netty.channel.EventLoopGroup&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;io.netty.channel.nio.NioEventLoopGroup&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;io.netty.channel.socket.SocketChannel&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;io.netty.channel.socket.nio.NioServerSocketChannel&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;NettyServer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
    
  &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;final&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PORT&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;8080&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;

  &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;throws&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Exception&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
  
    &lt;span class=&#34;c1&#34;&gt;// ä¸€ä¸ªBossGroupçº¿ç¨‹æ± å¤„ç†è¿æ¥è¯·æ±‚ï¼Œè®¾ç½®äº†ä¸€ä¸ªçº¿ç¨‹
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;EventLoopGroup&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;bossGroup&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;NioEventLoopGroup&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// ä¸€ä¸ªWorkerGroupçº¿ç¨‹æ± è¿›è¡Œä¸šåŠ¡å¤„ç†ï¼Œé»˜è®¤è®¾ç½®çš„çº¿ç¨‹æ•°æ˜¯ CPUæ ¸æ•° * 2
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;EventLoopGroup&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;workerGroup&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;NioEventLoopGroup&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;

    &lt;span class=&#34;k&#34;&gt;try&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;c1&#34;&gt;// åˆ›å»ºæœåŠ¡ç«¯çš„å¯åŠ¨å¯¹è±¡ï¼Œé…ç½®å‚æ•°
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;ServerBootstrap&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;bootstrap&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ServerBootstrap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;

      &lt;span class=&#34;c1&#34;&gt;// åˆå§‹åŒ–è®¾ç½®
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;bootstrap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;group&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bossGroup&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;workerGroup&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// è®¾ç½®ä¸¤ä¸ªçº¿ç¨‹ç»„
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;               &lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;channel&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;NioServerSocketChannel&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// æŒ‡å®šNioSocketChannelä¸ºä¼ è¾“channel
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;               &lt;span class=&#34;c1&#34;&gt;// .localAddress(new InetSocketAddress(PORT)) // å¯ä»¥åœ¨è¿™é‡Œè®¾ç½®ç›‘å¬ç«¯å£æˆ–è€…è®¾ç½®åˆå§‹åŒ–é…ç½®åä½¿ç”¨bind()æ–¹æ³•è®¾ç½®
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;               &lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;option&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ChannelOption&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;SO_BACKLOG&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;128&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// è®¾ç½®çº¿ç¨‹é˜Ÿåˆ—å¾—åˆ°è¿æ¥ä¸ªæ•°
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;               &lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;childOption&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ChannelOption&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;SO_KEEPALIVE&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;//è®¾ç½®ä¿æŒæ´»åŠ¨è¿æ¥çŠ¶æ€
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;               &lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;handler&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// è¯¥handlerå¯¹åº”bossGroup, childHandlerå¯¹åº” workerGroup
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;               &lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;childHandler&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ChannelInitializer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;SocketChannel&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
                 &lt;span class=&#34;c1&#34;&gt;// å½“ä¸€ä¸ªè¿æ¥è¢«æ¥æ”¶æ—¶ï¼Œç»™channelPipelineæ·»åŠ ä¸€ä¸ªHandler
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;                 &lt;span class=&#34;nd&#34;&gt;@Override&lt;/span&gt;
                 &lt;span class=&#34;kd&#34;&gt;protected&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;initChannel&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;SocketChannel&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ch&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;throws&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Exception&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
                   &lt;span class=&#34;c1&#34;&gt;// å¯ä»¥ä½¿ç”¨ä¸€ä¸ªé›†åˆç®¡ç† SocketChannelï¼Œåœ¨æ¨é€æ¶ˆæ¯æ—¶ï¼Œå¯ä»¥å°†ä¸šåŠ¡åŠ å…¥åˆ°å„ä¸ªchannel å¯¹åº”çš„ NIOEventLoop çš„ taskQueue æˆ–è€… scheduleTaskQueue
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;                   &lt;span class=&#34;c1&#34;&gt;// ç»™workGroupçš„eventLoopå¯¹åº”çš„channelè®¾ç½®handler
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;                   &lt;span class=&#34;n&#34;&gt;ch&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;pipeline&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;addLast&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;NettyServerHandler&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;());&lt;/span&gt;
                 &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
               &lt;span class=&#34;o&#34;&gt;});&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;System&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;out&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;println&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;æœåŠ¡å™¨ is ready...&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
      &lt;span class=&#34;c1&#34;&gt;// åŒæ­¥é˜»å¡ç­‰å¾…ç›´åˆ°ç»‘å®šå®Œæˆï¼Œå¹¶ç›‘å¬ç«¯å£
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;ChannelFuture&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cf&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;bootstrap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;bind&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PORT&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;sync&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
      &lt;span class=&#34;c1&#34;&gt;// è®¾ç½®ç›‘å¬å™¨ï¼Œç›‘å¬è¿æ¥äº‹ä»¶
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;cf&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;addListener&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ChannelFutureListener&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;nd&#34;&gt;@Override&lt;/span&gt;
        &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;operationComplete&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ChannelFuture&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;future&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;throws&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Exception&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
          &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cf&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;isSuccess&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;())&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
            &lt;span class=&#34;n&#34;&gt;System&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;out&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;println&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;ç›‘å¬ç«¯å£ &amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PORT&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34; æˆåŠŸ&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
          &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
            &lt;span class=&#34;n&#34;&gt;System&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;out&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;println&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;ç›‘å¬ç«¯å£ &amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PORT&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34; æˆåŠŸ&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
          &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
        &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
      &lt;span class=&#34;o&#34;&gt;});&lt;/span&gt;
      &lt;span class=&#34;c1&#34;&gt;// è·å–cfChannelçš„CloseFutureï¼Œå¹¶é˜»å¡å½“å‰çº¿ç¨‹ç›´åˆ°å…¶å®Œæˆ
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;cf&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;channel&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;closeFuture&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;sync&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;finally&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;bossGroup&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;shutdownGracefully&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;workerGroup&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;shutdownGracefully&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
  &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;æœåŠ¡ç«¯ä¸šåŠ¡å¤„ç†å™¨NettyServerHandler&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;48
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;49
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;50
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;51
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;52
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;53
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;54
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;55
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;56
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;57
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;58
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;59
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;60
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;61
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;62
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;63
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;kn&#34;&gt;package&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;com.nixum.netty&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;

&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;io.netty.buffer.ByteBuf&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;io.netty.buffer.Unpooled&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;io.netty.channel.Channel&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;io.netty.channel.ChannelHandlerContext&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;io.netty.channel.ChannelInboundHandlerAdapter&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;io.netty.channel.ChannelPipeline&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;io.netty.util.CharsetUtil&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;// nettyé€šè¿‡ä¸€ç³»åˆ—çš„Handleræ¥å®ç°ä¸šåŠ¡å¤„ç†ï¼Œç”¨æˆ·è‡ªå®šä¹‰Handleréœ€è¦ç»§æ‰¿ChannelInboundHandlerAdapteræ‰èƒ½ä½¿ç”¨
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;NettyServerHandler&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;extends&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ChannelInboundHandlerAdapter&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
  &lt;span class=&#34;cm&#34;&gt;/*
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;    è¯»å–å®¢æˆ·ç«¯å‘é€çš„è¯·æ±‚
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;    ChannelHandlerContext ctx: ä¸Šä¸‹æ–‡å¯¹è±¡, å«æœ‰ç®¡é“pipeline, é€šé“channel, åœ°å€
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;    Object msg: å°±æ˜¯å®¢æˆ·ç«¯å‘é€çš„æ•°æ® é»˜è®¤Object
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;  */&lt;/span&gt;
  &lt;span class=&#34;nd&#34;&gt;@Override&lt;/span&gt;
  &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;channelRead&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ChannelHandlerContext&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;msg&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;throws&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Exception&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;c1&#34;&gt;// è¿™é‡Œå‡è®¾æœ‰éœ€è¦æ‰§è¡Œä¸€ä¸ªéå¸¸è€—æ—¶çš„ä»»åŠ¡
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;cm&#34;&gt;/*
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;    // è§£å†³æ–¹æ¡ˆ1: ç”¨æˆ·ç¨‹åºè‡ªå®šä¹‰çš„æ™®é€šä»»åŠ¡
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;    ctx.channel().eventLoop().execute(() -&amp;gt; {
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;      try {
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;        Thread.sleep(5 * 1000);
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;        ctx.writeAndFlush(Unpooled.copiedBuffer(&amp;#34;hello, å®¢æˆ·ç«¯2&amp;#34;, CharsetUtil.UTF_8));
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;      } catch (Exception e) {
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;        System.out.println(&amp;#34;å‘ç”Ÿå¼‚å¸¸&amp;#34; + e.getMessage());
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;      }
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;    });
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;    // è§£å†³æ–¹æ¡ˆ2: ç”¨æˆ·è‡ªå®šä¹‰å®šæ—¶ä»»åŠ¡ -&amp;gt; è¯¥ä»»åŠ¡æ˜¯æäº¤åˆ° scheduleTaskQueueä¸­
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;    ctx.channel().eventLoop().schedule(() -&amp;gt; {
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;      try {
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;        Thread.sleep(5 * 1000);
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;        ctx.writeAndFlush(Unpooled.copiedBuffer(&amp;#34;hello, å®¢æˆ·ç«¯~(&amp;gt;^Ï‰^&amp;lt;)å–µ4&amp;#34;, CharsetUtil.UTF_8));
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;      } catch (Exception e) {
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;        System.out.println(&amp;#34;å‘ç”Ÿå¼‚å¸¸&amp;#34; + e.getMessage());
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;      }
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;    }, 5, TimeUnit.SECONDS);
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;	*/&lt;/span&gt;

    &lt;span class=&#34;n&#34;&gt;Channel&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;channel&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;channel&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// å°† msgå¯¹è±¡è½¬æˆä¸€ä¸ªByteBufï¼Œè¿™é‡ŒByteBufæ˜¯Nettyæä¾›çš„ï¼Œä¸æ˜¯NIOçš„ByteBuffer.
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;ByteBuf&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;buf&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ByteBuf&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;msg&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;System&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;out&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;println&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯æ˜¯: &amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;buf&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;toString&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;CharsetUtil&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;UTF_8&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;));&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;System&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;out&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;println&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;å®¢æˆ·ç«¯åœ°å€: &amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;channel&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;remoteAddress&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;());&lt;/span&gt;
  &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;

  &lt;span class=&#34;c1&#34;&gt;//æ•°æ®è¯»å–å®Œæ¯•ï¼Œä¸€èˆ¬åœ¨è¿™é‡Œéœ€è¦å¯¹è¦å‘é€çš„æ•°æ®è¿›è¡Œç¼–ç 
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;nd&#34;&gt;@Override&lt;/span&gt;
  &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;channelReadComplete&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ChannelHandlerContext&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;throws&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Exception&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// å°†æ•°æ®å†™å…¥åˆ°ç¼“å­˜ï¼Œå¹¶åˆ·æ–°, å“åº”ç»™å®¢æˆ·ç«¯
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;writeAndFlush&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Unpooled&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;copiedBuffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;hello, å®¢æˆ·ç«¯&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;CharsetUtil&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;UTF_8&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;));&lt;/span&gt;
  &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;

  &lt;span class=&#34;c1&#34;&gt;//å¤„ç†å¼‚å¸¸, ä¸€èˆ¬æ˜¯éœ€è¦å…³é—­é€šé“
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;nd&#34;&gt;@Override&lt;/span&gt;
  &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;exceptionCaught&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ChannelHandlerContext&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Throwable&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cause&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;throws&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Exception&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;close&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
  &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;å®¢æˆ·ç«¯ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;kn&#34;&gt;package&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;com.nixum.netty&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;

&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;io.netty.bootstrap.Bootstrap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;io.netty.channel.ChannelFuture&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;io.netty.channel.ChannelInitializer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;io.netty.channel.EventLoopGroup&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;io.netty.channel.nio.NioEventLoopGroup&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;io.netty.channel.socket.SocketChannel&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;io.netty.channel.socket.nio.NioSocketChannel&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;NettyClient&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
  &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;throws&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Exception&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;

    &lt;span class=&#34;n&#34;&gt;EventLoopGroup&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;group&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;NioEventLoopGroup&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;try&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;c1&#34;&gt;// åˆ›å»ºå®¢æˆ·ç«¯å¯åŠ¨å¯¹è±¡ï¼Œè¿™é‡Œä½¿ç”¨çš„æ˜¯BootStrap
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;Bootstrap&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;bootstrap&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Bootstrap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;

      &lt;span class=&#34;c1&#34;&gt;// åˆå§‹åŒ–è®¾ç½®
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;bootstrap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;group&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;group&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;//è®¾ç½®çº¿ç¨‹ç»„
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;               &lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;channel&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;NioSocketChannel&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// è®¾ç½®å®¢æˆ·ç«¯é€šé“çš„å®ç°ç±»
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;               &lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;handler&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ChannelInitializer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;SocketChannel&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
                 &lt;span class=&#34;nd&#34;&gt;@Override&lt;/span&gt;
                 &lt;span class=&#34;kd&#34;&gt;protected&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;initChannel&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;SocketChannel&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ch&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;throws&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Exception&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
                   &lt;span class=&#34;c1&#34;&gt;// æ·»åŠ Handler
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;                   &lt;span class=&#34;n&#34;&gt;ch&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;pipeline&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;addLast&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;NettyClientHandler&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;());&lt;/span&gt;
                 &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
               &lt;span class=&#34;o&#34;&gt;});&lt;/span&gt;

      &lt;span class=&#34;c1&#34;&gt;// å¯åŠ¨å®¢æˆ·ç«¯å»è¿æ¥æœåŠ¡å™¨ç«¯é˜»å¡ç›´è‡³æˆåŠŸ
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;ChannelFuture&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;channelFuture&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;bootstrap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;connect&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;127.0.0.1&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;8080&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;sync&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
      &lt;span class=&#34;c1&#34;&gt;// åŒä¸Š
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;channelFuture&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;channel&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;closeFuture&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;sync&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;finally&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;group&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;shutdownGracefully&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
  &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;å®¢æˆ·ç«¯ä¸šåŠ¡å¤„ç†Handler&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;kn&#34;&gt;package&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;com.nixum.netty&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;

&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;io.netty.buffer.ByteBuf&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;io.netty.buffer.Unpooled&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;io.netty.channel.ChannelHandlerContext&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;io.netty.channel.ChannelInboundHandlerAdapter&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;io.netty.util.CharsetUtil&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;NettyClientHandler&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;extends&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ChannelInboundHandlerAdapter&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;

  &lt;span class=&#34;c1&#34;&gt;// å½“é€šé“å°±ç»ªå°±ä¼šè§¦å‘è¯¥æ–¹æ³•
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;nd&#34;&gt;@Override&lt;/span&gt;
  &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;channelActive&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ChannelHandlerContext&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;throws&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Exception&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;writeAndFlush&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Unpooled&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;copiedBuffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;hello, server&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;CharsetUtil&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;UTF_8&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;));&lt;/span&gt;
  &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;

  &lt;span class=&#34;c1&#34;&gt;//å½“é€šé“æœ‰è¯»å–äº‹ä»¶æ—¶ï¼Œä¼šè§¦å‘
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;nd&#34;&gt;@Override&lt;/span&gt;
  &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;channelRead&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ChannelHandlerContext&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;msg&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;throws&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Exception&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;ByteBuf&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;buf&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ByteBuf&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;msg&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;System&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;out&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;println&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;æœåŠ¡å™¨å›å¤çš„æ¶ˆæ¯: &amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;buf&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;toString&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;CharsetUtil&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;UTF_8&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;));&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;System&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;out&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;println&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;æœåŠ¡å™¨çš„åœ°å€: &amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;channel&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;remoteAddress&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;());&lt;/span&gt;
  &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;

  &lt;span class=&#34;c1&#34;&gt;// å¼‚å¸¸æ—¶çš„å¤„ç†
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;nd&#34;&gt;@Override&lt;/span&gt;
  &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;exceptionCaught&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ChannelHandlerContext&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Throwable&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cause&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;throws&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Exception&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;cause&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;printStackTrace&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;close&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
  &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id=&#34;æ ¸å¿ƒç»„ä»¶&#34;&gt;æ ¸å¿ƒç»„ä»¶&lt;/h2&gt;
&lt;h3 id=&#34;serverbootstrapå’Œbootstrap&#34;&gt;ServerBootstrapå’ŒBootstrap&lt;/h3&gt;
&lt;p&gt;æœåŠ¡å¼•å¯¼ç±»ï¼Œé€šè¿‡å®ƒè®¾ç½®é…ç½®ï¼ˆé“¾å¼è°ƒç”¨ï¼‰å’Œå¯åŠ¨æœåŠ¡ï¼ŒServerBootstrapç”¨äºæœåŠ¡ç«¯ï¼ŒBootstapç”¨äºå®¢æˆ·ç«¯&lt;/p&gt;
&lt;h3 id=&#34;channelchannelpipelinechannelhandlercontextå’Œchannelhandler&#34;&gt;Channelã€ChannelPipelineã€ChannelHandlerContextå’ŒChannelHandler&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Channelï¼šç½‘ç»œé€šä¿¡çš„ç»„ä»¶ï¼Œæä¾›å¼‚æ­¥ç½‘ç»œI/Oæ“ä½œï¼Œæ“ä½œéƒ½æ˜¯å¼‚æ­¥çš„ï¼Œä¼šè¿”å›ä¸€ä¸ªChannelFutureå®ä¾‹ï¼Œé€šè¿‡æ³¨å†Œåœ¨ChannelFutureä¸Šçš„ç›‘å¬å™¨è¿›è¡Œå›è°ƒæ“ä½œã€‚NioServerSocketChannelç”¨äºTCPæœåŠ¡ç«¯ã€NioSocketChannelç”¨äºTCPå®¢æˆ·ç«¯ï¼ŒNioDatagramChannelç”¨äºUDPè¿æ¥&lt;/li&gt;
&lt;li&gt;ChannelHandlerï¼šæ˜¯ä¸€ä¸ªæ¥å£ï¼Œé€šè¿‡å®ç°è¯¥æ¥å£æ¥æ³¨å†Œåˆ°ChannelPipelineä¸Šè¿›è¡Œä½¿ç”¨ã€‚ä¸€èˆ¬ä½¿ç”¨å…¶å‡ºç«™å’Œå…¥ç«™çš„ä¸¤ä¸ªé€‚é…å™¨å¦‚ChannelOutboundHandlerAdapterå’ŒChannelInboundHandlerAdapteræˆ–è€…SimpleChannelInboundHandlerå’ŒSimpleChannelOutboundHandler&lt;/li&gt;
&lt;li&gt;ChannelPipelineï¼šä¿å­˜ChannelHandlerçš„é˜Ÿåˆ—ï¼Œåƒæ˜¯è´£ä»»é“¾æ¨¡å¼
&lt;ul&gt;
&lt;li&gt;æ¯ä¸€ä¸ªChannelå¯¹åº”ä¸€ä¸ªChannelPipelineï¼Œä¸€ä¸ªChannelPipelineç»´æŠ¤äº†ä¸€ä¸ªç”±ChannelHandlerContextç»„æˆçš„åŒå‘é“¾è¡¨ï¼Œæ¯ä¸€ä¸ªChannelHandlerContextå…³è”ä¸€ä¸ªChannelHandler&lt;/li&gt;
&lt;li&gt;å…¥ç«™äº‹ä»¶ä¼šä»é“¾è¡¨çš„headå¾€åä¼ é€’åˆ°æœ€åä¸€ä¸ªå…¥ç«™handlerï¼Œå‡ºç«™äº‹ä»¶ä¼šä»é“¾è¡¨tailå¾€å‰ä¼ é€’åˆ°æœ€å‰ä¸€ä¸ªå‡ºæˆ˜handlerï¼Œä¸¤ç§ç±»å‹çš„handleräº’ä¸å¹²æ‰°&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ChannelHandlerContextï¼šä¸Šä¸‹æ–‡ï¼ŒåŒ…å«ä¸€ä¸ªChannelHandlerï¼Œç»‘å®šChannelPipelineå’ŒChannelçš„ä¿¡æ¯&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;eventloopgroup&#34;&gt;EventLoopGroup&lt;/h3&gt;
&lt;p&gt;åŒ…å«ä¸€ç»„EventLoopï¼Œé»˜è®¤è®¾ç½®çš„EventLoopçº¿ç¨‹æ•°æ˜¯ CPUæ ¸æ•° * 2ï¼Œæ¯ä¸ªEventLoopç»´æŠ¤ä¸€ä¸ªSelector&lt;/p&gt;
&lt;h2 id=&#34;ä¸€èˆ¬æµç¨‹&#34;&gt;ä¸€èˆ¬æµç¨‹&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;BossGropæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªNioEventGroupï¼ŒåªåŒ…å«ä¸€ä¸ªNioEventLoopäº‹ä»¶å¾ªç¯çš„çº¿ç¨‹ã€‚WorkGroupæœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ä¸ªNioEventGroupï¼Œä½†å®ƒåŒ…å«äº† CPU*2 ä¸ªNioEventEventLoopæ¥å¤„ç†è¿æ¥åçš„ä¸šåŠ¡é€»è¾‘ã€‚&lt;/li&gt;
&lt;li&gt;NioEventLoopæ˜¯ä¸€ä¸ªæ­»å¾ªç¯ï¼Œä¸æ–­çš„å¤„ç†äº‹ä»¶å’Œæ¶ˆæ¯é˜Ÿåˆ—çš„ä»»åŠ¡ã€‚&lt;/li&gt;
&lt;li&gt;åˆå§‹åŒ–æ—¶å°†BossGropå’ŒWorkGroupæ³¨å†Œåˆ°ServerBootstrapå¹¶è¿›è¡Œç›¸åº”çš„é…ç½®(å¦‚Channelã€ChannelHandler)ï¼Œä¹‹åé€šè¿‡bind()æ–¹æ³•ç»‘å®šç«¯å£å’ŒServerSocketChannelåå¯åŠ¨ã€‚&lt;/li&gt;
&lt;li&gt;BossGroupè½®è¯¢Acceptäº‹ä»¶ï¼Œè·å–äº‹ä»¶åæ¥å—è¿æ¥ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„NioSocketChannelï¼Œç»‘å®šChannelPipelineï¼Œä¸ºChannelPipelineæ·»åŠ ChannelHandlerï¼Œæ³¨å†Œåˆ°WorkGroupä¸Šï¼Œå‘é€Readäº‹ä»¶ã€‚&lt;/li&gt;
&lt;li&gt;WorkGroupä¸­ä¸€ä¸ªEventLoopè½®è¯¢Readäº‹ä»¶ï¼Œè°ƒç”¨Channelçš„ChannelPipelineè¿›è¡Œå¤„ç†ã€‚&lt;/li&gt;
&lt;li&gt;ChannelPipelineä¸­æ¯ä¸ªèŠ‚ç‚¹æ˜¯ä¸€ä¸ªContextï¼Œç”¨ContextåŒ…è£…Handlerï¼Œç”±Contextç»„æˆåŒå‘é“¾è¡¨ï¼ŒèŠ‚ç‚¹é—´é€šè¿‡AbstractChannelHandlerContext ç±»å†…éƒ¨çš„ fire ç³»åˆ—æ–¹æ³• è¿›è¡Œä¼ é€’ï¼Œå…¥ç«™æ–¹æ³•å«inboundï¼Œä»headèŠ‚ç‚¹å¼€å§‹ï¼Œå‡ºç«™æ–¹æ³•å«outboundï¼Œç”±tailèŠ‚ç‚¹å¼€å§‹ã€‚&lt;/li&gt;
&lt;li&gt;å¯¹äºè€—æ—¶çš„æ–¹æ³•ï¼Œä¸€èˆ¬ä¸¢ç»™çº¿ç¨‹æ± å¤„ç†ï¼Œå¦‚ä¸Šé¢Demoä¸­çš„ä¾‹å­&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒï¼š&lt;/h1&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://segmentfault.com/a/1190000006824196&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Java NIO çš„å‰ç”Ÿä»Šä¸– ä¹‹å›› NIO Selector è¯¦è§£&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.jianshu.com/p/052035037297&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;æ·±å…¥æµ…å‡ºNIOä¹‹Channelã€Buffer&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.cnblogs.com/aspirant/p/8630283.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Java NIOï¼šIOä¸NIOçš„åŒºåˆ«&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.bilibili.com/video/BV1DJ411m7NR&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;å°šç¡…è°·Nettyæ•™ç¨‹&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;&#34; &gt;netty in action&lt;/a&gt;&lt;/p&gt;
</description>
        </item>
        <item>
        <title>Java List Map</title>
        <link>http://nixum.cc/p/java-list-map/</link>
        <pubDate>Mon, 18 Feb 2019 00:00:00 +0000</pubDate>
        
        <guid>http://nixum.cc/p/java-list-map/</guid>
        <description>&lt;p&gt;[TOC]&lt;/p&gt;
&lt;p&gt;ä»¥ä¸‹ç¬”è®°å¦‚æ²¡æŒ‡å®šç‰ˆæœ¬ï¼Œéƒ½æ˜¯åŸºäºJDK1.8&lt;/p&gt;
&lt;h1 id=&#34;collection&#34;&gt;Collection&lt;/h1&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/collection%e7%b1%bb%e5%9b%be.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/collection%e7%b1%bb%e5%9b%be.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			alt=&#34;javaCollectionç±»å›¾ç®€ç‰ˆ&#34;&gt;
	&lt;/a&gt;
	
	&lt;figcaption&gt;javaCollectionç±»å›¾ç®€ç‰ˆ&lt;/figcaption&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;h2 id=&#34;set&#34;&gt;Set&lt;/h2&gt;
&lt;h3 id=&#34;hashset&#34;&gt;HashSet&lt;/h3&gt;
&lt;h4 id=&#34;1åŸºæœ¬&#34;&gt;1.åŸºæœ¬&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;åº•å±‚æ˜¯HashMapï¼Œå› æ­¤åˆå§‹å®¹é‡ï¼Œé»˜è®¤è´Ÿè½½å› å­ã€æ‰©å®¹å€æ•°è¿™äº›éƒ½å’ŒHashMapä¸€æ ·&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç”±äºHashSetåªéœ€è¦keyï¼Œå› æ­¤valueç»Ÿä¸€ä½¿ç”¨é™æ€ä¸å¯å˜çš„Objectå¯¹è±¡æ¥è£…ï¼Œå³æ‰€æœ‰keyå…±äº«è¿™ä¸€ä¸ªå¯¹è±¡&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;transient&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;HashMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;E&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;map&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;final&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PRESENT&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;HashSet&lt;strong&gt;å…è®¸å­˜å…¥null&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„&lt;/li&gt;
&lt;li&gt;ä¸ä¿è¯æ’å…¥å…ƒç´ çš„é¡ºåº&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;list&#34;&gt;List&lt;/h2&gt;
&lt;h3 id=&#34;arraylist&#34;&gt;ArrayList&lt;/h3&gt;
&lt;h4 id=&#34;1åŸºæœ¬-1&#34;&gt;1.åŸºæœ¬&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;åº•å±‚ï¼šObjectæ•°ç»„&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;é»˜è®¤å¤§å°ï¼š10 ï¼ˆè°ƒç”¨ç©ºå‚æ„é€ æ–¹æ³•æ—¶ï¼‰&lt;/p&gt;
&lt;p&gt;æœ€å¤§æ˜¯Integer.MAX_VALUE - 8ï¼ˆ2^31 - 1ï¼Œä¸€äº›è™šæ‹Ÿå™¨éœ€è¦åœ¨æ•°ç»„å‰åŠ ä¸ªå¤´æ ‡ç­¾ï¼Œæ‰€ä»¥å‡å» 8 ï¼‰&lt;/p&gt;
&lt;p&gt;è°ƒç”¨æ­¤æ„é€ æ–¹æ³•æ—¶ï¼Œ&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;ArrayList&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Collection&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;?&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;extends&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;E&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;å…¶ä¸­è¦æ³¨æ„çš„æ˜¯ï¼Œé‡Œé¢æœ‰è¿™æ ·ä¸€å¥è¯&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// c.toArray might (incorrectly) not return Object[] (see 6260652)
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;elementData&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getClass&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[].&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;elementData&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Arrays&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;copyOf&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;elementData&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;size&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[].&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;å¦‚æœä¼ å…¥çš„æ˜¯ å‚æ•°c æ˜¯ç”± List&lt;!-- raw HTML omitted --&gt; asList = Arrays.asList(&amp;ldquo;aaa&amp;rdquo;,&amp;ldquo;bbb&amp;rdquo;); è¿™æ ·æ¥çš„ï¼Œé‚£ä¹ˆè¿™ä¸ªasList.toArray()æ˜¯ä¸€ä¸ªString[].classç±»ï¼Œè€Œä¸æ˜¯Object[].classï¼ŒåŸå› æ˜¯Arraysçš„asList()æ–¹æ³•è¿”å›çš„æ˜¯å†…éƒ¨ç±»Arrays&amp;amp;ArrayListï¼Œå…¶toArray()æ–¹æ³•ä¸ArrayListçš„toArray()æ–¹æ³•ä¸ä¸€æ ·&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¸æ˜¯çº¿ç¨‹å®‰å…¨ï¼Œå› æ­¤ä¸€èˆ¬åœ¨å•çº¿ç¨‹ä¸­ä½¿ç”¨&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å…è®¸å­˜å…¥nullå¯¹è±¡ï¼Œsizeä¹Ÿä¼šè®¡å…¥&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ¯æ¬¡æ‰©å®¹åŸæ¥çš„ 1.5 å€ï¼Œå¦‚æœæ‰©å®¹åä»ç„¶ä¸å¤Ÿç”¨ï¼Œåˆ™é‡‡ç”¨æ»¡è¶³å¤Ÿç”¨æ—¶çš„æ•°é‡&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;2æ‰©å®¹&#34;&gt;2.æ‰©å®¹&lt;/h4&gt;
&lt;p&gt;å› ä¸ºArrayListæ˜¯åº•å±‚æ˜¯æ•°ç»„ï¼Œå½“addæ“ä½œæ—¶ä¼šä½¿ç”¨ ensureCapacityInternal() æ–¹æ³•ä¿è¯å®¹é‡ï¼Œæ ¹æ®sizeä¸æ•°ç»„çš„é•¿åº¦è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœsizeæ¯”æ•°ç»„é•¿åº¦å¤§æ—¶ï¼Œä½¿ç”¨ grow() æ–¹æ³•è¿›è¡Œæ‰©å®¹&lt;/p&gt;
&lt;p&gt;åœ¨ grow(int minCapacity) æ–¹æ³•ä¸­çš„ int newCapacity = oldCapacity + (oldCapacity &amp;raquo; 1); æ–°å®¹é‡çš„å¤§å°ä¸ºåŸæ¥çš„1.5å€ï¼Œä¹‹åä½¿ç”¨è¿™ä¸ªæ–°å®¹é‡ï¼Œè°ƒç”¨ Arrays.copyOf(elementData, newCapacity) æŠŠåŸæ•°ç»„æ•´ä¸ªå¤åˆ¶åˆ°æ–°æ•°ç»„ä¸­ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œå¤åˆ¶çš„æ—¶å€™ä»£ä»·æ˜¯å¾ˆå¤§çš„&lt;/p&gt;
&lt;p&gt;å¦‚æœæ‰©å®¹ä¹‹åçš„å®¹é‡ä»ç„¶ä¸å¤Ÿï¼Œåˆ™å°†å®¹é‡æ‰©å……è‡³å½“å‰éœ€è¦çš„æ•°é‡&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚ List&lt;!-- raw HTML omitted --&gt; list = new ArrayList&amp;lt;&amp;gt;();ï¼Œæ­¤æ—¶ArrayListç±»é‡Œçš„sizeæ˜¯0ï¼Œä½†æ˜¯Objectæ•°ç»„é•¿åº¦æ˜¯10&lt;/p&gt;
&lt;p&gt;ArrayListç±»é‡Œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;boolean&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;add&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;E&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;e&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;ensureCapacityInternal&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;size&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;// Increments modCount!!
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;elementData&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;size&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;e&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;ensureCapacityInternal&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;minCapacity&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;elementData&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;DEFAULTCAPACITY_EMPTY_ELEMENTDATA&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;n&#34;&gt;minCapacity&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Math&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;max&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;DEFAULT_CAPACITY&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;minCapacity&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
	&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;ensureExplicitCapacity&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;minCapacity&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;ensureExplicitCapacity&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;minCapacity&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// è®°å½•æ•°ç»„ä¿®æ”¹(å¢åŠ æˆ–åˆ é™¤æˆ–è°ƒæ•´å†…éƒ¨æ•°ç»„çš„å¤§å°)çš„æ¬¡æ•°
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;n&#34;&gt;modCount&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++;&lt;/span&gt;
	&lt;span class=&#34;c1&#34;&gt;// åˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;minCapacity&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;elementData&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;length&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;n&#34;&gt;grow&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;minCapacity&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;// æ‰©å®¹
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;grow&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;minCapacity&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;c1&#34;&gt;// overflow-conscious code
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;oldCapacity&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;elementData&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;length&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
	&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;newCapacity&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;oldCapacity&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;oldCapacity&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// ç›¸å½“äº old + (old / 2)
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;newCapacity&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;minCapacity&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;n&#34;&gt;newCapacity&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;minCapacity&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;newCapacity&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;MAX_ARRAY_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;n&#34;&gt;newCapacity&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;hugeCapacity&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;minCapacity&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// minCapacity is usually close to size, so this is a win:
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;n&#34;&gt;elementData&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Arrays&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;copyOf&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;elementData&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;newCapacity&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h4 id=&#34;3åˆ é™¤&#34;&gt;3.åˆ é™¤&lt;/h4&gt;
&lt;p&gt;åˆ é™¤æŒ‡å®šä¸‹æ ‡çš„å€¼æ—¶ï¼Œè°ƒç”¨ System.arraycopy() å°† index+1 åé¢çš„å…ƒç´ éƒ½å¤åˆ¶åˆ° index ä½ç½®ä¸Šï¼Œä¸éœ€è¦éå†æ•°ç»„ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(N)ï¼Œå¯ä»¥çœ‹å‡ºï¼Œåˆ é™¤å…ƒç´ çš„ä»£ä»·ä¹Ÿæ˜¯éå¸¸é«˜çš„ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;E&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;remove&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;index&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;rangeCheck&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;index&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;

    &lt;span class=&#34;n&#34;&gt;modCount&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++;&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;E&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;oldValue&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;elementData&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;index&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;

    &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;numMoved&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;size&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;index&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;numMoved&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;System&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;arraycopy&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;elementData&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;index&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;elementData&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;index&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt;
                         &lt;span class=&#34;n&#34;&gt;numMoved&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;elementData&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[--&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;size&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// clear to let GC do its work
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;oldValue&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;åŒç†çš„remove(Object o)ï¼ˆä½†æ˜¯éœ€è¦éå†æ•°ç»„ï¼‰ã€removeAll()éƒ½æ˜¯å·®ä¸å¤šçš„æ“ä½œ&lt;/p&gt;
&lt;h4 id=&#34;4è¯»å–å’Œä¿®æ”¹&#34;&gt;4.è¯»å–å’Œä¿®æ”¹&lt;/h4&gt;
&lt;p&gt;ä¿®æ”¹ï¼šç›´æ¥ä¿®æ”¹æ•°ç»„å¯¹åº”ä¸‹æ ‡çš„å€¼&lt;/p&gt;
&lt;p&gt;è¯»å–ï¼šç›´æ¥è·å–æ•°ç»„å¯¹åº”ä¸‹æ ‡çš„å€¼&lt;/p&gt;
&lt;p&gt;æ³¨æ„åˆ°ä¸¤ä¸ªæ–¹æ³•éƒ½æœ‰ checkForComodification(); çš„åˆ¤æ–­ï¼Œè¯¥æ–¹æ³•çš„åˆ¤æ–­ä¸»è¦æ˜¯æç¤ºå¹¶å‘ä¿®æ”¹å¼‚å¸¸&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;E&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;set&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;index&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;E&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;e&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;rangeCheck&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;index&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;checkForComodification&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;E&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;oldValue&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ArrayList&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;elementData&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;offset&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;index&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;ArrayList&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;elementData&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;offset&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;index&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;e&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;oldValue&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;E&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;get&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;index&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;rangeCheck&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;index&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;checkForComodification&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ArrayList&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;elementData&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;offset&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;index&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h4 id=&#34;5fail-fast&#34;&gt;5.Fail-Fast&lt;/h4&gt;
&lt;p&gt;ä¸€ç§é”™è¯¯æ£€æŸ¥æœºåˆ¶ï¼Œå› ä¸ºArrayListä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå› æ­¤å½“å¤šçº¿ç¨‹ä¿®æ”¹ArrayListå¯¹è±¡æ—¶ï¼Œæˆ–è€…åœ¨è¿­ä»£æ“ä½œä¸­ä¿®æ”¹ArrayListå¯¹è±¡æˆ–è€…åºåˆ—åŒ–æ“ä½œä¸­ï¼Œä¼šè¿›è¡ŒFail-Fastæ£€æŸ¥ã€‚&lt;/p&gt;
&lt;p&gt;æ£€æŸ¥çš„åŸç†å°±æ˜¯ä½¿ç”¨ å…¨å±€å˜é‡ modCount æ¥æ£€æŸ¥ï¼ŒmodCount ç”¨æ¥è®°å½• ArrayList å†…æ•°ç»„ä¿®æ”¹(å¢åŠ ã€åˆ é™¤æˆ–è°ƒæ•´å†…éƒ¨æ•°ç»„çš„å¤§å°)çš„æ¬¡æ•°ï¼Œå½“æ¯”è¾ƒå‰åçš„modCountä¸ä¸€è‡´æ—¶ï¼ŒæŠ›å‡ºConcurrentModificationExceptionå¼‚å¸¸&lt;/p&gt;
&lt;p&gt;å•çº¿ç¨‹ä¸­ï¼Œå¦‚æœéœ€è¦åœ¨è¿­ä»£ä¸­removeå…ƒç´ ï¼Œåº”è¯¥ä½¿ç”¨è¿­ä»£å™¨è¿­ä»£ï¼Œå¹¶ä¸”ä½¿ç”¨è¿­ä»£å™¨æä¾›çš„remove()ï¼ˆé‡Œé¢ä¹Ÿæ˜¯è°ƒç”¨äº†ArrayListçš„removeæ–¹æ³•ï¼Œåªæ˜¯æœ‰ä¿®æ”¹modCountçš„å€¼ï¼‰æ–¹æ³•ï¼Œè€Œä¸æ˜¯ArrayListçš„removeæ–¹æ³•ï¼Œå¤šçº¿ç¨‹çš„æƒ…å†µä¸‹åªèƒ½ä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„é›†åˆç±»äº†&lt;/p&gt;
&lt;h4 id=&#34;6åºåˆ—åŒ–&#34;&gt;6.åºåˆ—åŒ–&lt;/h4&gt;
&lt;p&gt;ArrayListçš„åº•å±‚Objectæ•°ç»„è¢« transient ä¿®é¥°ï¼Œè¯¥å…³é”®å­—å£°æ˜æ•°ç»„é»˜è®¤ä¸ä¼šè¢«åºåˆ—åŒ–&lt;/p&gt;
&lt;p&gt;ä¹‹åé€šè¿‡é‡å†™writeObject() å’Œ readObject() å°†æ•°ç»„é‡Œçš„å…ƒç´ å–å‡ºï¼Œè¿›è¡Œåºåˆ—åŒ–&lt;/p&gt;
&lt;p&gt;ä¹‹æ‰€ä»¥è¿™ä¹ˆåšæ˜¯å› ä¸ºArrayListçš„è‡ªåŠ¨æ‰©å®¹æœºåˆ¶ï¼Œæ•°ç»„å†…å…ƒç´ å®é™…æ•°é‡å¯èƒ½ä¼šæ¯”æ•°ç»„é•¿åº¦å°ï¼Œå¦‚æœä¸€æ•´ä¸ªåºåˆ—åŒ–çš„è¯ä¼šæµªè´¹ç©ºé—´ï¼Œé€šè¿‡æ‰‹åŠ¨åºåˆ—åŒ–çš„æ–¹å¼ï¼Œåªåºåˆ—åŒ–å®é™…å­˜å‚¨çš„å…ƒç´ ï¼Œè€Œä¸æ˜¯æ•´ä¸ªæ•°ç»„&lt;/p&gt;
&lt;p&gt;ç±»å®ç°Serializableæ¥å£ï¼Œåºåˆ—åŒ–æ—¶ä¼šä½¿ç”¨ ObjectOutputStream çš„ writeObject() å°†å¯¹è±¡è½¬æ¢ä¸ºå­—èŠ‚æµå¹¶è¾“å‡ºã€‚è€Œ writeObject() æ–¹æ³•åœ¨ä¼ å…¥çš„å¯¹è±¡å­˜åœ¨ writeObject() çš„æ—¶å€™ä¼šå»åå°„è°ƒç”¨è¯¥å¯¹è±¡çš„ writeObject() æ¥å®ç°åºåˆ—åŒ–ã€‚&lt;/p&gt;
&lt;h4 id=&#34;7ä¸vectorçš„åŒºåˆ«&#34;&gt;7.ä¸Vectorçš„åŒºåˆ«&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;Vectorå®ç°æ–¹å¼è·ŸArrayListç±»ä¼¼ï¼Œä¹Ÿæ˜¯åŸºäºæ•°ç»„å®ç°ï¼Œé»˜è®¤å¤§å°ä¹Ÿæ˜¯10ï¼Œä½†å®ƒæ˜¯çº¿ç¨‹å®‰å…¨çš„&lt;/li&gt;
&lt;li&gt;Vecotræ‰©å®¹æ˜¯æ‰©å®¹åˆ°åŸæ¥çš„2å€ï¼ŒArrayListæ˜¯1.5å€&lt;/li&gt;
&lt;li&gt;Vecotrçš„çº¿ç¨‹å®‰å…¨æ˜¯å› ä¸ºå…¶æ–¹æ³•éƒ½ä½¿ç”¨äº† synchronized å…³é”®å­—è¿›è¡Œä¿®é¥°åŒæ­¥ï¼Œæ•ˆç‡æ¯”ArrayListå·®ï¼Œè¿™ä¹Ÿæ˜¯ä¸æ¨èä½¿ç”¨Vectorçš„åŸå› ï¼Œä¿è¯çº¿ç¨‹å®‰å…¨å¯ä»¥ä½¿ç”¨ juc åŒ…é‡Œå…¶ä»–ç±»&lt;/li&gt;
&lt;li&gt;å½“éœ€è¦çº¿ç¨‹å®‰å…¨çš„ArrayListæ—¶ï¼Œä¸ä½¿ç”¨Vectorï¼Œè€Œæ˜¯ä½¿ç”¨ CopyOnWriteArrayList ç±» æˆ–è€… Collections.synchronizedList(List&lt;!-- raw HTML omitted --&gt; list);&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;linkedlist&#34;&gt;LinkedList&lt;/h3&gt;
&lt;h4 id=&#34;1åŸºæœ¬-2&#34;&gt;1.åŸºæœ¬&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;åº•å±‚æ˜¯é“¾è¡¨ï¼Œä¸”æ˜¯åŒå‘é“¾è¡¨&lt;/li&gt;
&lt;li&gt;é‡‡ç”¨é“¾è¡¨ï¼Œå› æ­¤æ’å…¥ã€åˆ é™¤æ•ˆç‡é«˜(ä½†éœ€è¦çŸ¥é“è¢«åˆ é™¤èŠ‚ç‚¹)ï¼ŒæŸ¥æ‰¾æ•ˆç‡ä½ï¼Œä¸æ”¯æŒéšæœºæŸ¥æ‰¾ï¼Œè€ŒArrayListåº•å±‚æ˜¯æ•°ç»„ï¼Œå› æ­¤æ”¯æŒéšæœºæŸ¥æ‰¾ï¼ŒæŸ¥æ‰¾æ•ˆç‡é«˜ï¼Œä½†æ˜¯æ’å…¥ï¼Œåˆ é™¤æ•ˆç‡ä½&lt;/li&gt;
&lt;li&gt;LinkedListåº•å±‚æ˜¯åŒå‘é“¾è¡¨çš„ç¼˜æ•…ï¼Œå¯ä»¥å½“æˆé˜Ÿåˆ—ä½¿ç”¨ï¼Œåˆ›å»ºé˜Ÿåˆ—Queueæˆ–è€…Dequeæ—¶ï¼Œé‡‡ç”¨LinkedListä½œä¸ºå®ç°&lt;/li&gt;
&lt;li&gt;ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;copyonwritearraylist&#34;&gt;CopyOnWriteArrayList&lt;/h3&gt;
&lt;h4 id=&#34;1åŸºæœ¬-3&#34;&gt;1.åŸºæœ¬&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;çº¿ç¨‹å®‰å…¨çš„ArrayListï¼ŒåŸºæœ¬ä½¿ç”¨åŒArrayList&lt;/li&gt;
&lt;li&gt;åº•å±‚æ˜¯Objectæ•°ç»„ï¼Œä½†æ˜¯æœ‰ volatile ä¿®é¥°ï¼Œè¿˜æœ‰ä¸€æŠŠå¯é‡å…¥é” ReentrantLock ä¿è¯çº¿ç¨‹å®‰å…¨&lt;/li&gt;
&lt;li&gt;ä¿è¯çº¿ç¨‹å®‰å…¨çš„åŸç†æ˜¯ è¯»å†™åˆ†ç¦»ï¼Œè¯»çš„æ—¶å€™ä½¿ç”¨ å…¨å±€å˜é‡é‡Œçš„Objectæ•°ç»„ï¼Œæ¯æ¬¡å†™çš„æ—¶å€™åŠ é”ï¼Œåœ¨æ–¹æ³•é‡Œåˆ›å»ºä¸€ä¸ªæ–°æ•°ç»„ï¼Œå°†å…¨å±€å˜é‡é‡Œçš„Objectæ•°ç»„ é€šè¿‡Arrays.copyOfå¤åˆ¶ ç»™æ–¹æ³•é‡Œçš„æ–°æ•°ç»„ï¼Œä¹‹åè¿›è¡Œå†™æ“ä½œï¼Œå®Œäº†å†æŠŠå…¨å±€å˜é‡çš„Objectæ•°ç»„æŒ‡å‘æ–°æ•°ç»„ã€‚ç”±äºå­˜åœ¨å¤åˆ¶æ“ä½œï¼Œå› æ­¤add()ã€set()ã€remove()çš„å¼€é”€å¾ˆå¤§&lt;/li&gt;
&lt;li&gt;è¯»æ“ä½œä¸èƒ½è¯»å–å®æ—¶æ€§çš„æ•°æ®ï¼Œå› ä¸ºå†™æ“ä½œçš„æ•°æ®å¯èƒ½è¿˜æœªåŒæ­¥&lt;/li&gt;
&lt;li&gt;é€‚åˆè¯»å¤šå†™å°‘çš„åœºæ™¯&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;map&#34;&gt;Map&lt;/h1&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/Map%e7%b1%bb%e5%9b%be.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/Map%e7%b1%bb%e5%9b%be.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			alt=&#34;Mapç±»å›¾&#34;&gt;
	&lt;/a&gt;
	
	&lt;figcaption&gt;Mapç±»å›¾&lt;/figcaption&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;h2 id=&#34;hashmap&#34;&gt;HashMap&lt;/h2&gt;
&lt;h3 id=&#34;1åŸºæœ¬-4&#34;&gt;1.åŸºæœ¬&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;åº•å±‚ï¼šä¸€ä¸ªNodeç±»å‹çš„æ•°ç»„ï¼Œè€Œ1.7çš„æ˜¯Entry ç±»å‹çš„ï¼Œä¸è¿‡åŸºæœ¬ä¹Ÿå·®ä¸å¤š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;kd&#34;&gt;transient&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Node&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;K&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;V&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;[]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;Nodeç±»æ˜¯HashMapé‡Œçš„ä¸€ä¸ªå†…éƒ¨ç±»&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;kd&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;Node&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;K&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;V&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;implements&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Map&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;Entry&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;K&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;V&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;kd&#34;&gt;final&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;hash&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;		&lt;span class=&#34;c1&#34;&gt;// keyçš„hashç 
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;kd&#34;&gt;final&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;K&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
	&lt;span class=&#34;n&#34;&gt;V&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
	&lt;span class=&#34;n&#34;&gt;Node&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;K&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;V&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;next&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;		&lt;span class=&#34;c1&#34;&gt;// å¯¹åº”çš„é“¾è¡¨
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ•°ç»„ä¸­çš„æ¯ä¸ªä½ç½®ç§°ä¸ºä¸€ä¸ªæ¡¶ï¼Œä¸€ä¸ªæ¡¶å­˜æ”¾ä¸€æ¡é“¾è¡¨ï¼ŒåŒä¸€ä¸ªæ¡¶çš„HashCodeä¸€æ ·&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;é»˜è®¤å®¹é‡æ˜¯16ï¼Œæœ€å¤§å®¹é‡æ˜¯2^30ï¼Œå³æ•°ç»„é•¿åº¦&lt;/p&gt;
&lt;p&gt;é»˜è®¤çš„å¡«å……å› å­æ˜¯0.75&lt;/p&gt;
&lt;p&gt;æ¡¶çš„ä¸ªæ•°ï¼Œå³æ•°ç»„çš„é•¿åº¦æ€»æ˜¯ 2çš„næ¬¡å¹‚&lt;/p&gt;
&lt;p&gt;å½“æ¡¶ä¸Šé“¾è¡¨çš„ç»“ç‚¹æ•°å¤§äº 8 æ—¶ï¼Œé“¾è¡¨è½¬çº¢é»‘æ ‘ï¼Œå°äº 6 æ—¶ï¼Œçº¢é»‘æ ‘è½¬é“¾è¡¨&lt;/p&gt;
&lt;p&gt;æ¡¶çš„ä¸ªæ•°ï¼Œå³æ•°ç»„é•¿åº¦å°‘äº 64 æ—¶ï¼Œå…ˆæ‰©å®¹ï¼Œå¤§äº64æ—¶ï¼Œé“¾è¡¨è½¬çº¢é»‘æ ‘ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒæ˜¯å…ˆæ£€æŸ¥é“¾è¡¨ç»“ç‚¹æ•°ï¼Œå¦‚æœå¤§äº8ï¼Œå†æ£€æŸ¥æ•°ç»„é•¿åº¦ï¼Œå†å†³å®šæ˜¯å¦è½¬çº¢é»‘æ ‘&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ä¸¤ä¸ªå˜é‡ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// ä¸´ç•Œå€¼,è¡¡é‡æ•°ç»„æ˜¯å¦éœ€è¦æ‰©å¢çš„ä¸€ä¸ªæ ‡å‡†ï¼Œthreshold=å®¹é‡xå¡«å……å› å­ï¼Œé”®å€¼å¯¹ä¸ªæ•°è¶…è¿‡è¿™ä¸ªé˜ˆå€¼ï¼Œæ‰©å®¹2å€
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;threshold&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;// å¡«å……å› å­,æ§åˆ¶æ•°ç»„å­˜æ”¾æ•°æ®çš„ç–å¯†ç¨‹åº¦
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;final&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;float&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;loadFactor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
&lt;li&gt;æ¯æ¬¡æ‰©å®¹ä¸ºåŸæ¥çš„ 2 å€&lt;/li&gt;
&lt;li&gt;å…è®¸key=nullï¼Œæ­¤æ—¶å°†è¯¥å…ƒç´ æ”¾å…¥Nodeç±»å‹æ•°ç»„ä¸‹æ ‡ä¸º0å¤„&lt;/li&gt;
&lt;li&gt;ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œæ”¯æŒfast-failæœºåˆ¶&lt;/li&gt;
&lt;li&gt;ä¸ä¿è¯æ’å…¥é¡ºåº&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
&lt;li&gt;åŸºæœ¬ç»“æ„ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;1.8ä¹‹å‰ï¼Œæ•°ç»„çš„æ¯ä¸€ä¸ªå…ƒç´ ä¸­å­˜æ”¾ä¸€æ¡é“¾è¡¨ï¼š&lt;/p&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/1.7HashMap.jpg&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/1.7HashMap.jpg&#34;
			
			
			
			loading=&#34;lazy&#34;
			alt=&#34;1.8ä¹‹å‰çš„HashMap&#34;&gt;
	&lt;/a&gt;
	
	&lt;figcaption&gt;1.8ä¹‹å‰çš„HashMap&lt;/figcaption&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;1.8ï¼Œæ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ å­˜æ”¾ä¸€æ¡é“¾è¡¨ï¼Œå½“é“¾è¡¨çš„é•¿åº¦è¶…è¿‡8ï¼ˆé»˜è®¤ï¼‰ä¹‹åï¼Œå°†é“¾è¡¨è½¬æ¢æˆçº¢é»‘æ ‘ï¼Œä»¥å‡å°‘æœç´¢æ—¶é—´&lt;/p&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/1.8HashMap.jpg&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/1.8HashMap.jpg&#34;
			
			
			
			loading=&#34;lazy&#34;
			alt=&#34;1.8HashMap&#34;&gt;
	&lt;/a&gt;
	
	&lt;figcaption&gt;1.8HashMap&lt;/figcaption&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;h3 id=&#34;2åˆ›å»ºè¿‡ç¨‹&#34;&gt;2.åˆ›å»ºè¿‡ç¨‹&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;æ„é€ æ–¹æ³•ï¼šé™¤ç•™ä½™æ•°æ³•&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å“ˆå¸Œå†²çªè§£å†³æ–¹æ³•ï¼šæ‹‰é“¾æ³•&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;n&#34;&gt;Map&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;map&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;HashMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&amp;gt;();&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;é¦–å…ˆåˆ›å»ºä¸€ä¸ªMapï¼Œè°ƒç”¨ç©ºå‚æ„é€ æ–¹æ³•ï¼Œæ­¤æ—¶åªæ˜¯è®¾ç½®äº†é»˜è®¤çš„å¡«å……å› å­ï¼ŒNodeæ•°ç»„è¿˜æ²¡æœ‰åˆå§‹åŒ–ï¼›é™¤äº†public HashMap(Map&amp;lt;? extends K, ? extends V&amp;gt; m) è¿™ä¸ªæ„é€ æ–¹æ³•å¤–ï¼Œå…¶ä»–çš„æ„é€ æ–¹æ³•åŸºæœ¬éƒ½æ˜¯åªè®¾ç½®äº†å¡«å……å› å­å’Œå®¹é‡ï¼Œå¹¶æ²¡æœ‰å¯¹æ•°ç»„åˆå§‹åŒ–ï¼Œå½“ç¬¬ä¸€æ¬¡è°ƒç”¨putæ–¹æ³•æ—¶ï¼Œæ‰å¯¹æ•°ç»„è¿›è¡Œå†…å­˜åˆ†é…ï¼Œå®Œæˆåˆå§‹åŒ–ï¼Œå»¶è¿ŸåŠ è½½&lt;/p&gt;
&lt;p&gt;å…¶ä¸­ä¸€ä¸ªå¯ä»¥æŒ‡å®šå®¹é‡å’Œå¡«å……å› å­çš„æ„é€ æ–¹æ³•ä¸­ï¼Œ&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;HashMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;initialCapacity&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;float&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;loadFactor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;å¦‚æœä¼ å…¥çš„å®¹é‡ä¸æ˜¯ 2çš„næ¬¡å¹‚ï¼ŒHashMapæ€»ä¼šä¿è¯å…¶æ•°ç»„çš„å®¹é‡ä¸º2çš„næ¬¡å¹‚ï¼Œä½¿ç”¨ä¸‹é¢æ–¹æ³•ï¼ŒåŸå› æ˜¯ä¸ºäº†åŠ å¿«å–æ¨¡çš„è¿ç®—é€Ÿåº¦ï¼Œå…·ä½“è§£é‡Šçœ‹ä¸‹ä¸€èŠ‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// ç”¨äºä¿è¯å®¹é‡ä¸º2çš„næ¬¡ï¼ŒåŸç†æ˜¯æ±‚å‡ºä¸€ä¸ªæ•°çš„æ©ç  + 1ï¼Œå³å¯å¾—åˆ°å¤§äºè¯¥æ•°çš„æœ€å°2çš„næ¬¡
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;final&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;tableSizeFor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;n&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cap&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;n&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;n&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;n&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;n&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;n&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;n&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;n&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;n&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;8&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;n&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;n&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;16&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;n&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;?&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;n&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;MAXIMUM_CAPACITY&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;?&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;MAXIMUM_CAPACITY&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;n&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;å½“ç¬¬ä¸€æ¬¡è°ƒç”¨putæ–¹æ³•æ—¶ï¼Œå¯¹æ•°ç»„(æ¡¶)è¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœä¸ºç©ºï¼Œåˆ™ä¸ºæ•°ç»„åˆ†é…å†…å­˜ï¼Œå®Œæˆåˆå§‹åŒ–ï¼Œä¹‹åå†æ ¹æ®keyçš„æƒ…å†µï¼ŒåŠ å…¥åˆ°HashMapä¸­&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;n&#34;&gt;map&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;put&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;key111&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;value111&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;å¯¹putæ–¹æ³•çš„è§£æå…·ä½“è¯·çœ‹&lt;a class=&#34;link&#34; href=&#34;https://juejin.im/post/5ab0568b5188255580020e56&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;é›†åˆæ¡†æ¶æºç å­¦ä¹ ä¹‹HashMap(JDK1.8)&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&#34;3ç¡®å®šé”®å€¼å¯¹æ‰€åœ¨çš„æ¡¶çš„ä¸‹æ ‡&#34;&gt;3.ç¡®å®šé”®å€¼å¯¹æ‰€åœ¨çš„æ¡¶çš„ä¸‹æ ‡&lt;/h3&gt;
&lt;p&gt;å½“å‘mapä¸­putè¿› key-value æ—¶ï¼Œå¯¹keyé‡‡ç”¨å“ˆå¸Œ + é™¤ç•™ä½™æ•°æ³•ï¼Œç¡®å®šè¯¥é”®å€¼å¯¹æ‰€åœ¨çš„æ¡¶çš„ä¸‹æ ‡&lt;/p&gt;
&lt;p&gt;é¦–å…ˆè®¡ç®—keyçš„hashå€¼ï¼Œä¹‹åå¯¹æ•°ç»„çš„å®¹é‡å–æ¨¡ï¼Œå¾—åˆ°çš„ä½™æ•°å°±æ˜¯æ¡¶çš„ä¸‹æ ‡&lt;/p&gt;
&lt;p&gt;JDK1.7&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;kd&#34;&gt;final&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;hash&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;k&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;h&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;hashSeed&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;		&lt;span class=&#34;c1&#34;&gt;// hashSeedçš„å€¼å—å®¹é‡å’Œresizeæ–¹æ³•è€Œå®š
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;h&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;k&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;instanceof&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;sun&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;misc&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;Hashing&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;stringHash32&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;k&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;h&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;^=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;k&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;hashCode&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;

    &lt;span class=&#34;n&#34;&gt;h&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;^=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;h&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;20&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;^&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;h&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;12&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;h&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;^&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;h&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;7&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;^&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;h&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;indexFor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;h&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;length&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// assert Integer.bitCount(length) == 1 : &amp;#34;length must be a non-zero power of 2&amp;#34;;
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;h&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;length&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ä½†æ˜¯è¿™é‡Œå¹¶ä¸ç›´æ¥é‡‡ç”¨å–æ¨¡%æ“ä½œï¼Œ è€Œæ˜¯ä½¿ç”¨äº†ä½è¿ç®—ï¼Œå› ä¸ºä½è¿ç®—çš„ä»£ä»·æ¯”æ±‚æ¨¡è¿ç®—å°çš„å¤šï¼Œå› æ­¤åœ¨è¿›è¡Œè¿™ç§è®¡ç®—æ—¶ç”¨ä½è¿ç®—çš„è¯èƒ½å¸¦æ¥æ›´é«˜çš„æ€§èƒ½&lt;/p&gt;
&lt;p&gt;è€Œå–æ¨¡(%)æ“ä½œä¸­å¦‚æœé™¤æ•°æ˜¯2çš„å¹‚æ¬¡åˆ™ç­‰ä»·äºä¸å…¶é™¤æ•°å‡ä¸€çš„ä¸(&amp;amp;)æ“ä½œï¼Œè¿™ä¹Ÿè§£é‡Šäº†ä¸ºä»€ä¹ˆå®¹é‡æ¯æ¬¡éƒ½æ˜¯2çš„næ¬¡å¹‚&lt;/p&gt;
&lt;p&gt;åœ¨JDK1.8ä¸­ï¼Œæ­¤æ“ä½œè¢«ç®€åŒ–äº†ï¼Œä¹Ÿå–æ¶ˆäº†indexFor(int h, int length)æ–¹æ³•ï¼Œç¡®å®šæ¡¶ä¸‹æ ‡ç›´æ¥ hash &amp;amp; (length-1)&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;kd&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;final&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;hash&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;h&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;key&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;?&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;h&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;hashCode&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;())&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;^&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;h&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;16&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// ^ æŒ‰ä½å¼‚æˆ–
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;å½“è®¡ç®—å¾—åˆ°è¯¥é”®å€¼å¯¹æ‰€åœ¨æ¡¶çš„ä¸‹æ ‡åï¼Œåˆ¤æ–­è¯¥æ¡¶æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ºç©ºï¼Œå°†æ­¤é”®å€¼å¯¹æ’å…¥åˆ°æ¡¶ä¸­&lt;/p&gt;
&lt;p&gt;å½“å®¹é‡æœªè¾¾åˆ°é˜ˆå€¼ï¼Œä¸”å®¹é‡æœªå˜ï¼Œæ­¤æ—¶å‡ºç°æ–°é”®å€¼å¯¹ï¼Œå…¶keyè®¡ç®—å¾—åˆ°çš„æ¡¶çš„ä¸‹æ ‡æ‰€åœ¨ä½ç½®å·²ç»æœ‰ç»“ç‚¹äº†ï¼Œåˆ™é€šè¿‡æ‹‰é“¾æ³•æ¥è§£å†³å†²çª&lt;/p&gt;
&lt;p&gt;å…ˆåˆ¤æ–­æ–°çš„é”®å€¼å¯¹çš„keyçš„hashå€¼ä¸å¤´ç»“ç‚¹çš„keyçš„hashå€¼æ˜¯å¦ä¸€è‡´ï¼Œä¸”keyæ˜¯å¦ç›¸ç­‰ï¼Œå¦‚æœè¿™ä¸¤é¡¹å‡æ»¡è¶³ï¼Œåˆ™è¯´æ˜è¯¥æ–°çš„keyä¸å¤´ç»“ç‚¹çš„ä¸€æ ·ï¼Œå°†valueè¦†ç›–æ‰åŸæ¥çš„ç»“ç‚¹ï¼Œå¦‚æœä¸ç›¸ç­‰ï¼Œåˆ™&lt;/p&gt;
&lt;p&gt;åœ¨JDK1.7ä¸­ï¼Œä½¿ç”¨å¤´æ’æ³•åŠ å…¥é“¾è¡¨ï¼Œåœ¨å¤šçº¿ç¨‹ä¸­ï¼Œå¤´æ’æ³•å¯èƒ½ä¼šå¯¼è‡´hashMapæ‰©å®¹æ—¶é€ æˆæ­»å¾ªç¯ï¼Œå› æ­¤åœ¨1.8ä¿®å¤è¿™ä¸ªé—®é¢˜äº†&lt;/p&gt;
&lt;p&gt;åœ¨JDK1.8ä¸­ï¼Œä½¿ç”¨å°¾æ’æ³•åŠ å…¥é“¾è¡¨ï¼Œå½“ç„¶è¿˜æœ‰ä¸€ç³»åˆ—åˆ¤æ–­æ˜¯å¦éœ€è¦å°†é“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘ï¼Œå…·ä½“æ¡ä»¶çœ‹ä¸Šé¢å·²è¯´æ˜&lt;/p&gt;
&lt;h3 id=&#34;4æ‰©å®¹&#34;&gt;4.æ‰©å®¹&lt;/h3&gt;
&lt;p&gt;å½“åŠ å…¥åˆ°HashMapä¸­çš„å…ƒç´ è¶Šæ¥è¶Šå¤šæ—¶ï¼Œç¢°æ’çš„æ¦‚ç‡ä¹Ÿè¶Šæ¥è¶Šé«˜ï¼Œé“¾è¡¨çš„é•¿åº¦å˜é•¿ï¼ŒæŸ¥æ‰¾æ•ˆç‡é™ä½ï¼Œæ­¤æ—¶å°±éœ€è¦å¯¹æ•°ç»„è¿›è¡Œæ‰©å®¹ã€‚HashMapæ ¹æ®é”®å€¼å¯¹çš„æ•°é‡ï¼Œæ¥è°ƒæ•´æ•°ç»„é•¿åº¦ï¼Œä¿è¯æŸ¥æ‰¾æ•ˆç‡&lt;/p&gt;
&lt;p&gt;åœ¨ä¸¤ç§æƒ…å†µä¸‹ï¼ŒHashMapä¼šè¿›è¡Œæ‰©å®¹&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å½“putæ“ä½œæ—¶ï¼Œæ•°ç»„å¤§å°è¶…è¿‡é˜ˆå€¼ thresholdï¼ˆå®¹é‡ x è´Ÿè½½å› å­ï¼‰ï¼ŒJDK1.7ã€1.8éƒ½æ˜¯&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;kd&#34;&gt;final&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Node&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;K&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;V&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;[]&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;resize&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ï¼›&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;æ‰©å®¹æ—¶ï¼Œå°†æ‰©å®¹åˆ°åŸæ¥çš„2å€ï¼ˆnewThr = oldThr &amp;laquo; 1ï¼‰ï¼Œä¹‹åè¿›è¡Œä¸€æ¬¡é‡æ–°çš„hashåˆ†é…ã€‚&lt;/p&gt;
&lt;p&gt;åˆ›å»ºæ–°æ•°ç»„ï¼Œéå†æ•´ä¸ªæ—§çš„hashMapï¼Œé‡æ–°è®¡ç®—æ¯ä¸ªé”®å€¼å¯¹çš„hashå€¼ä»¥åŠå¯¹åº”çš„æ¡¶ä¸‹æ ‡ï¼Œ&lt;strong&gt;æ‰©å±•åNodeå¯¹è±¡çš„ä½ç½®è¦ä¹ˆåœ¨åŸä½ç½®ï¼Œè¦ä¹ˆç§»åŠ¨åˆ°åŸåç§»é‡ä¸¤å€çš„ä½ç½®&lt;/strong&gt;ï¼Œä¹‹åå°†æ—§hashMapä¸­çš„ç»“ç‚¹åŠ å…¥åˆ°æ–°çš„æ•°ç»„ä¸­&lt;/p&gt;
&lt;p&gt;HashMap ä½¿ç”¨äº†ä¸€ä¸ªç‰¹æ®Šçš„æœºåˆ¶ï¼Œé™ä½é‡æ–°è®¡ç®—æ¡¶ä¸‹æ ‡çš„æ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;å‡è®¾åŸæ•°ç»„é•¿åº¦ capacity ä¸º 16ï¼Œæ‰©å®¹ä¹‹å new capacity ä¸º 32ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;n&#34;&gt;capacity&lt;/span&gt;     &lt;span class=&#34;o&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;00010000&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;capacity&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;00100000&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;å¯¹äºä¸€ä¸ª Keyï¼Œ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å®ƒçš„å“ˆå¸Œå€¼å¦‚æœåœ¨ç¬¬ 5 ä½ä¸Šä¸º 0ï¼Œé‚£ä¹ˆå–æ¨¡å¾—åˆ°çš„ç»“æœå’Œä¹‹å‰ä¸€æ ·ï¼›&lt;/li&gt;
&lt;li&gt;å¦‚æœä¸º 1ï¼Œé‚£ä¹ˆå¾—åˆ°çš„ç»“æœä¸ºåŸæ¥çš„ç»“æœ +16ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;5ä¸hashtableçš„åŒºåˆ«&#34;&gt;5.ä¸HashTableçš„åŒºåˆ«&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;HashMapä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼ŒHashTableæ˜¯çº¿ç¨‹å®‰å…¨çš„(å› ä¸ºå…¶æ–¹æ³•ä½¿ç”¨äº†synchronizedä¿®é¥°æ¥ä¿è¯åŒæ­¥ï¼Œæ•ˆç‡è¾ƒå·®)&lt;/li&gt;
&lt;li&gt;HashMapå…è®¸æ’å…¥keyä¸ºnullçš„é”®å€¼å¯¹ï¼Œè€ŒHashTableä¸å…è®¸&lt;/li&gt;
&lt;li&gt;å¦‚æœä¸æŒ‡å®šå®¹é‡ï¼ŒHashMapé»˜è®¤å®¹é‡æ˜¯16ï¼Œæ¯æ¬¡æ‰©å®¹ä¸ºåŸæ¥çš„ 2 å€ï¼›HashTableé»˜è®¤å®¹é‡æ˜¯11ï¼Œæ¯æ¬¡æ‰©å®¹ä¸ºåŸæ¥çš„ 2n+1 å€&lt;/li&gt;
&lt;li&gt;jdk1.8åå¯¹HashMapé“¾è¡¨çš„æ”¹å˜ï¼ŒHashTableæ²¡æœ‰&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;concurrenthashmap&#34;&gt;ConcurrentHashMap&lt;/h2&gt;
&lt;h3 id=&#34;1åŸºæœ¬-5&#34;&gt;1.åŸºæœ¬&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;çº¿ç¨‹å®‰å…¨çš„HashMapï¼Œä½¿ç”¨æ–¹æ³•åŒHashMap&lt;/li&gt;
&lt;li&gt;ä¸å…è®¸å­˜å…¥keyä¸ºnullçš„é”®å€¼å¯¹&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;2çº¿ç¨‹å®‰å…¨çš„åº•å±‚åŸç†jdk17å’Œjdk18çš„å®ç°ä¸ä¸€æ ·&#34;&gt;2.çº¿ç¨‹å®‰å…¨çš„åº•å±‚åŸç†ï¼ŒJDK1.7å’ŒJDK1.8çš„å®ç°ä¸ä¸€æ ·&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;JDK1.7&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;JDK1.7 é‡‡ç”¨åˆ†æ®µé”ï¼ˆsegmentï¼‰æœºåˆ¶ï¼Œæ¯ä¸ªåˆ†æ®µé”ç»´æŠ¤å‡ ä¸ªæ¡¶ï¼Œå¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶è®¿é—®ä¸åŒåˆ†æ®µé”ä¸Šçš„æ¡¶ï¼Œå¹¶å‘åº¦æŒ‡segmentçš„ä¸ªæ•°&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;é»˜è®¤çš„åˆ†æ®µé”æ˜¯16ï¼Œsegmentçš„æ•°é‡ä¸€ç»æŒ‡å®šå°±ä¸ä¼šå†æ‰©äº†ï¼›æ¯ä¸ªsegmenté‡Œé¢çš„HashEntryæ•°ç»„çš„æœ€å°å®¹é‡æ˜¯2ï¼Œæ¯æ¬¡æ‰©å®¹ 2 å€&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¹Ÿæ˜¯å»¶è¿Ÿåˆå§‹åŒ–ï¼Œå½“ç¬¬ä¸€æ¬¡putçš„æ—¶å€™ï¼Œæ‰§è¡Œç¬¬ä¸€æ¬¡hashå–æ¨¡å®šä½segmentçš„ä½ç½®ï¼Œå¦‚æœsegmentæ²¡æœ‰åˆå§‹åŒ–ï¼Œå› ä¸ºputå¯èƒ½å‡ºç°å¹¶å‘æ“ä½œï¼Œåˆ™é€šè¿‡CASèµ‹å€¼åˆå§‹åŒ–ï¼Œä¹‹åæ‰§è¡Œç¬¬äºŒæ¬¡hashå–æ¨¡å®šä½HashEntryæ•°ç»„çš„ä½ç½®ï¼Œé€šè¿‡ç»§æ‰¿ ReentrantLockçš„tryLock() æ–¹æ³•å°è¯•å»è·å–é”ï¼Œå¦‚æœè·å–æˆåŠŸå°±ç›´æ¥æ’å…¥ç›¸åº”çš„ä½ç½®ï¼Œå¦‚æœå·²ç»æœ‰çº¿ç¨‹è·å–è¯¥segmentçš„é”ï¼Œé‚£å½“å‰çº¿ç¨‹ä¼šä»¥è‡ªæ—‹çš„æ–¹å¼å»ç»§ç»­çš„è°ƒç”¨ tryLock() æ–¹æ³•å»è·å–é”ï¼Œè¶…è¿‡æŒ‡å®šæ¬¡æ•°å°±æŒ‚èµ·ï¼Œç­‰å¾…å”¤é†’&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;sizeï¼ˆç»Ÿè®¡é”®å€¼å¯¹æ•°é‡ï¼‰æ“ä½œï¼šå› ä¸ºå­˜åœ¨å¹¶å‘çš„ç¼˜æ•…ï¼Œsizeçš„å¯èƒ½éšæ—¶ä¼šå˜ï¼ŒConcurrentHashMapé‡‡ç”¨çš„åšæ³•æ˜¯å…ˆé‡‡ç”¨ä¸åŠ é”çš„æ¨¡å¼ï¼Œå°è¯•è®¡ç®—sizeçš„å¤§å°ï¼Œæ¯”è¾ƒå‰åä¸¤æ¬¡è®¡ç®—çš„ç»“æœï¼Œç»“æœä¸€è‡´å°±è®¤ä¸ºå½“å‰æ²¡æœ‰å…ƒç´ åŠ å…¥ï¼Œè®¡ç®—çš„ç»“æœæ˜¯å‡†ç¡®çš„ï¼Œå°è¯•æ¬¡æ•°æ˜¯ 3 æ¬¡ï¼Œå¦‚æœè¶…è¿‡äº† 3 æ¬¡ï¼Œåˆ™ä¼šå¯¹segmentåŠ é”ï¼Œé”ä½å¯¹segmentçš„æ“ä½œï¼Œä¹‹åå†ç»Ÿè®¡ä¸ªæ•°&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/1.7concurrentHashMap.jpg&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/1.7concurrentHashMap.jpg&#34;
			
			
			
			loading=&#34;lazy&#34;
			alt=&#34;1.7concurrentHashMap&#34;&gt;
	&lt;/a&gt;
	
	&lt;figcaption&gt;1.7concurrentHashMap&lt;/figcaption&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;JDK1.8
&lt;ul&gt;
&lt;li&gt;é‡‡ç”¨CASå’Œsynchronizedæ¥ä¿è¯å¹¶å‘å®‰å…¨ï¼Œæ›´æ¥è¿‘HashMap&lt;/li&gt;
&lt;li&gt;synchronizedåªé”å®šå½“å‰é“¾è¡¨æˆ–çº¢é»‘äºŒå‰æ ‘çš„é¦–èŠ‚ç‚¹ï¼Œè¿™æ ·åªè¦hashä¸å†²çªï¼Œå°±ä¸ä¼šäº§ç”Ÿå¹¶å‘&lt;/li&gt;
&lt;li&gt;æ‰©å®¹çš„æ—¶å€™ç”±äºåªæœ‰ä¸€ä¸ªtableæ•°ç»„ï¼Œå°†åœ¨å¤šçº¿ç¨‹ä¸‹å„ä¸ªçº¿ç¨‹éƒ½ä¼šå¸®å¿™æ‰©å®¹ï¼ŒåŠ å¿«æ‰©å®¹é€Ÿåº¦&lt;/li&gt;
&lt;li&gt;sizeæ“ä½œï¼šåœ¨æ‰©å®¹å’ŒaddCount()æ–¹æ³•å°±è¿›è¡Œå¤„ç†ï¼Œè€Œä¸åƒ1.7é‚£æ ·è¦ç­‰è°ƒç”¨çš„æ—¶å€™æ‰è®¡ç®—&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;çº¢é»‘æ ‘çš„ç‰¹æ€§&lt;/strong&gt;:
ï¼ˆ1ï¼‰æ¯ä¸ªèŠ‚ç‚¹è¦ä¹ˆæ˜¯é»‘è‰²ï¼Œè¦ä¹ˆæ˜¯çº¢è‰²ã€‚
ï¼ˆ2ï¼‰æ ¹èŠ‚ç‚¹æ˜¯é»‘è‰²ã€‚
ï¼ˆ3ï¼‰æ¯ä¸ªå¶å­èŠ‚ç‚¹ï¼ˆNILï¼‰æ˜¯é»‘è‰²ã€‚ï¼ˆæ³¨æ„ï¼šè¿™é‡Œå¶å­èŠ‚ç‚¹ï¼Œæ˜¯æŒ‡ä¸ºç©º(NILæˆ–NULL)çš„å¶å­èŠ‚ç‚¹ï¼‰
ï¼ˆ4ï¼‰å¦‚æœä¸€ä¸ªèŠ‚ç‚¹æ˜¯çº¢è‰²çš„ï¼Œåˆ™å®ƒçš„å­èŠ‚ç‚¹å¿…é¡»æ˜¯é»‘è‰²çš„ã€‚
ï¼ˆ5ï¼‰ä»ä¸€ä¸ªèŠ‚ç‚¹åˆ°è¯¥èŠ‚ç‚¹çš„å­å­™èŠ‚ç‚¹çš„æ‰€æœ‰è·¯å¾„ä¸ŠåŒ…å«ç›¸åŒæ•°ç›®çš„é»‘èŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;æ˜¯ä¸€ç§äºŒå‰å¹³è¡¡æ ‘ï¼Œä½†æ˜¯å¹³è¡¡ä¸æ˜¯éå¸¸ä¸¥æ ¼ï¼Œå› æ­¤ç»“ç‚¹çš„æ—‹è½¬æ¬¡æ•°å°‘ï¼Œæ’å…¥ã€åˆ é™¤æ•ˆç‡é«˜ï¼Œæ’å…¥ã€åˆ é™¤ã€æœç´¢éƒ½æ˜¯æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯O(log2 n)&lt;/p&gt;
&lt;p&gt;æ’å…¥å’Œåˆ é™¤æ—¶ï¼Œå…ˆç†è§£ä¸ºäºŒå‰æœç´¢æ ‘çš„æ’å…¥å’Œåˆ é™¤ï¼Œç„¶åå†è¿›è¡Œå˜è‰²ï¼Œä¼˜å…ˆå˜è‰²ï¼Œå˜è‰²åä»æ— æ³•è¾¾åˆ°ä¸Šé¢é‚£äº”ä¸ªç‰¹æ€§æ‰å¼€å§‹æ—‹è½¬ï¼Œæ¥è¾¾åˆ°ä¸Šé¢çš„ç‰¹æ€§ï¼Œæ’å…¥æ—¶èŠ‚ç‚¹ä¸€èˆ¬æ˜¯çº¢è‰²&lt;/p&gt;
&lt;p&gt;å‚è€ƒï¼š&lt;a class=&#34;link&#34; href=&#34;https://baijiahao.baidu.com/s?id=1663270991795039269&amp;amp;wfr=spider&amp;amp;for=pc&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;çº¢é»‘æ ‘æ’å…¥å’Œåˆ é™¤&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;ä½¿ç”¨streamå¤„ç†é›†åˆ&#34;&gt;ä½¿ç”¨Streamå¤„ç†é›†åˆ&lt;/h1&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.ibm.com/developerworks/cn/java/j-lo-java8streamapi/index.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Java 8 ä¸­çš„ Streams API è¯¦è§£&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h1&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.cnblogs.com/nayitian/p/3266090.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Javaï¼šé›†åˆï¼ŒCollectionæ¥å£æ¡†æ¶å›¾&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://github.com/CyC2018/CS-Notes/blob/master/docs/notes/Java%20%E5%AE%B9%E5%99%A8.md&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;CyC2018/CS-Notes/javaå®¹å™¨.md&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.cnblogs.com/liqing-weikeyuan/p/7922306.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;c.toArray might not return Object[]?&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.cnblogs.com/ITtangtang/p/3948555.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Javaé›†åˆ&amp;mdash;ArrayListçš„å®ç°åŸç†&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://juejin.im/post/5ab0568b5188255580020e56&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;é›†åˆæ¡†æ¶æºç å­¦ä¹ ä¹‹HashMap(JDK1.8)&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.cnblogs.com/xiaoxi/p/7233201.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;JDK1.8 HashMapæºç åˆ†æ&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.cnblogs.com/leesf456/p/5547853.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;ã€JUCã€‘JDK1.8æºç åˆ†æä¹‹CopyOnWriteArrayListï¼ˆå…­ï¼‰&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;http://www.cnblogs.com/skywang12345/p/3624343.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;çº¢é»‘æ ‘(ä¸€)ä¹‹ åŸç†å’Œç®—æ³•è¯¦ç»†ä»‹ç»&lt;/a&gt;&lt;/p&gt;
</description>
        </item>
        <item>
        <title>Springå’ŒSpringBoot</title>
        <link>http://nixum.cc/p/spring%E5%92%8Cspringboot/</link>
        <pubDate>Wed, 17 Apr 2019 00:00:00 +0000</pubDate>
        
        <guid>http://nixum.cc/p/spring%E5%92%8Cspringboot/</guid>
        <description>&lt;p&gt;[TOC]&lt;/p&gt;
&lt;h1 id=&#34;springboot&#34;&gt;SpringBoot&lt;/h1&gt;
&lt;h2 id=&#34;spring-å’Œ-spring-bootåŒºåˆ«&#34;&gt;Spring å’Œ Spring BootåŒºåˆ«&lt;/h2&gt;
&lt;p&gt;Spring Bootå®ç°äº†è‡ªåŠ¨é…ç½®ï¼Œé™ä½äº†é¡¹ç›®æ­å»ºçš„å¤æ‚åº¦ã€‚å®ƒä¸»è¦æ˜¯ä¸ºäº†è§£å†³ä½¿ç”¨Springæ¡†æ¶éœ€è¦è¿›è¡Œå¤§é‡çš„é…ç½®å¤ªéº»çƒ¦çš„é—®é¢˜ï¼Œæ‰€ä»¥å®ƒå¹¶ä¸æ˜¯ç”¨æ¥æ›¿ä»£Springçš„è§£å†³æ–¹æ¡ˆï¼Œè€Œæ˜¯å’ŒSpringæ¡†æ¶ç´§å¯†ç»“åˆç”¨äºæå‡Springå¼€å‘è€…ä½“éªŒçš„å·¥å…·ã€‚åŒæ—¶å®ƒé›†æˆäº†å¤§é‡å¸¸ç”¨çš„ç¬¬ä¸‰æ–¹åº“é…ç½®(ä¾‹å¦‚Jackson, JDBC, Mongo, Redis, Mailç­‰ç­‰)ï¼Œåšåˆ°é›¶é…ç½®å³ç”¨ã€‚å†…ç½®Tomcatä½œä¸ºWebæœåŠ¡å™¨ï¼Œä¸åƒä¹‹å‰è¿˜è¦æŠŠæœåŠ¡éƒ¨ç½²åˆ°Tomcatåœ¨è¿›è¡Œå¯åŠ¨ã€‚&lt;/p&gt;
&lt;h2 id=&#34;springbootæ•´ä¸ªå¯åŠ¨æµç¨‹&#34;&gt;SpringBootæ•´ä¸ªå¯åŠ¨æµç¨‹&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;æ„å»ºSpringApplicationå¯¹è±¡ï¼Œæ‰§è¡Œå…¶runæ–¹æ³•&lt;/li&gt;
&lt;li&gt;åŠ è½½properties/yamlç­‰é…ç½®æ–‡ä»¶&lt;/li&gt;
&lt;li&gt;åˆ›å»ºApplicationContextï¼ˆä¹Ÿå¯ä»¥ç§°ä¸ºBeanã€IOCå®¹å™¨ï¼‰&lt;/li&gt;
&lt;li&gt;å°†æ‰«æåˆ°çš„Beanæˆ–è€…xmlä¸­çš„beanï¼Œå…ˆè§£ææˆBeanDefinitionï¼Œæ³¨å†Œåˆ°ApplicationContextä¸­çš„BeanFactoryä¸­ï¼ˆå³è‡ªåŠ¨é…ç½®è¿‡ç¨‹ï¼Œä¹Ÿæ˜¯IOCå®¹å™¨çš„refreshæ–¹æ³•æ‰§è¡Œè¿‡ç¨‹ï¼‰&lt;/li&gt;
&lt;li&gt;å®ä¾‹åŒ–Beanï¼Œè¿›è¡Œä¾èµ–æ³¨å…¥ï¼Œï¼ˆAOPä¹Ÿæ˜¯åœ¨æ­¤å¤„å®ç°ï¼Œåˆ›å»ºä»£ç†å®ä¾‹åŠ å…¥IOCå®¹å™¨ï¼‰&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/SpringBoot%e5%90%af%e5%8a%a8%e6%b5%81%e7%a8%8b.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/SpringBoot%e5%90%af%e5%8a%a8%e6%b5%81%e7%a8%8b.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			alt=&#34;SpringBootå¯åŠ¨æµç¨‹&#34;&gt;
	&lt;/a&gt;
	
	&lt;figcaption&gt;SpringBootå¯åŠ¨æµç¨‹&lt;/figcaption&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;å‚è€ƒ&lt;a class=&#34;link&#34; href=&#34;https://www.cnblogs.com/trgl/p/7353782.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;SpringBootå¯åŠ¨æµç¨‹è§£æ&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.cnblogs.com/lay2017/p/11478237.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;SpringBootå¯åŠ¨æµç¨‹&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;springbootè‡ªåŠ¨é…ç½®æµç¨‹&#34;&gt;SpringBootè‡ªåŠ¨é…ç½®æµç¨‹&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;è‡ªåŠ¨é…ç½®æµç¨‹åªæ˜¯SpringBootå¯åŠ¨ä¸­çš„ä¸€ä¸ªç¯èŠ‚ï¼Œè¯¥ç¯èŠ‚åªæ˜¯åœ¨å‘Šè¯‰Springè¦åœ¨å“ªé‡Œæ‰¾åˆ°Beançš„å£°æ˜ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å¯åŠ¨ç±»mainæ–¹æ³•ä¸ºå…¥å£ï¼Œmainæ–¹æ³•æ‰€åœ¨çš„ç±»ä¼šè¢«**@SpringBootApplication**ä¿®é¥°ï¼Œ é€šè¿‡mainæ–¹æ³•é‡Œæ‰§è¡Œ**SpringApplication.run(Application.class, args)**è¿›è¡Œå¯åŠ¨ï¼ŒSpringå¯åŠ¨æ—¶ä¼šè§£æå‡º@SpringBootApplicationæ³¨è§£ï¼Œè¿›è¡ŒBeançš„åŠ è½½å’Œæ³¨å…¥ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;@SpringBootApplicationé‡ŒåŒ…å«äº†&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;@SpringBootConfiguration&lt;/strong&gt;ï¼šä½œç”¨ç±»ä¼¼äº**@Configuration**ï¼ŒJavaConfigé…ç½®ç±»ï¼Œç›¸å½“ä¸€ä¸ªxmlæ–‡ä»¶ï¼Œé…åˆ@Beanæ³¨è§£è®©IOCå®¹å™¨ç®¡ç†å£°æ˜çš„Bean&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;@ComponentScan&lt;/strong&gt;ï¼šé…ä¸ŠåŒ…è·¯å¾„ï¼Œç”¨äºæ‰«ææŒ‡å®šåŒ…åŠå…¶å­åŒ…ä¸‹æ‰€æœ‰ç±»ï¼Œå¦‚æ‰«æ@Componentã€@Serverã€@Controllerç­‰ï¼Œå¹¶æ³¨å…¥åˆ°IOCå®¹å™¨ä¸­&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;@EnableAutoConfiguration&lt;/strong&gt;ï¼šè‡ªåŠ¨é…ç½®çš„æ ¸å¿ƒæ³¨è§£ï¼Œä¸»è¦ç”¨äºæ‰¾å‡ºæ‰€æœ‰è‡ªåŠ¨é…ç½®ç±»ã€‚è¯¥æ³¨è§£ä¼šä½¿ç”¨**@Import(EnableAutoConfigurationImportSelector.class**)å¸®åŠ©SpringBootåº”ç”¨å°†æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„@Configurationé…ç½®éƒ½åŠ è½½åˆ°å½“å‰SpringBootåˆ›å»ºå¹¶ä½¿ç”¨çš„IoCå®¹å™¨ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;EnableAutoConfigurationImportSelector&lt;/strong&gt;ç±»é‡Œæœ‰ä¸ªSpringFactoriesLoaderå·¥å‚åŠ è½½å™¨ï¼Œé€šè¿‡é‡Œé¢çš„loadFactoryNamesæ–¹æ³•ï¼Œä¼ å…¥&lt;strong&gt;å·¥å‚ç±»åç§°&lt;/strong&gt;å’Œ&lt;strong&gt;å¯¹åº”çš„ç±»åŠ è½½å™¨&lt;/strong&gt;ï¼ŒåŠ è½½è¯¥ç±»åŠ è½½å™¨æœç´¢è·¯å¾„ä¸‹çš„æŒ‡å®šæ–‡ä»¶&lt;strong&gt;spring.factoriesæ–‡ä»¶&lt;/strong&gt;ï¼Œä¼ å…¥çš„å·¥å‚ç±»ä¸ºæ¥å£ï¼Œè€Œæ–‡ä»¶ä¸­å¯¹åº”çš„ç±»åˆ™æ˜¯æ¥å£çš„å®ç°ç±»ï¼Œæˆ–æœ€ç»ˆä½œä¸ºå®ç°ç±»ï¼Œå¾—åˆ°è¿™äº›ç±»åé›†åˆåï¼Œé€šè¿‡&lt;strong&gt;åå°„&lt;/strong&gt;è·å–è¿™äº›ç±»çš„ç±»å¯¹è±¡ã€æ„é€ æ–¹æ³•ï¼Œæœ€ç»ˆç”Ÿæˆå®ä¾‹ã€‚&lt;/p&gt;
&lt;p&gt;å› æ­¤åªè¦åœ¨mavenä¸­åŠ å…¥äº†æ‰€éœ€ä¾èµ–ï¼Œæ ¹æ®&lt;strong&gt;spring.factories&lt;/strong&gt;æ–‡ä»¶é‡Œçš„key-valueï¼Œèƒ½å¤Ÿåœ¨ç±»è·¯å¾„ä¸‹æ‰¾åˆ°å¯¹åº”çš„classæ–‡ä»¶ï¼Œå°±ä¼šè§¦å‘è‡ªåŠ¨é…ç½®&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;è‡ªå®šä¹‰starter&#34;&gt;è‡ªå®šä¹‰starter&lt;/h2&gt;
&lt;p&gt;å®é™…ä¸Šå°±æ˜¯ç¼–å†™è‡ªåŠ¨é…ç½®ç±»ï¼Œä¼šä½¿ç”¨åˆ°ä¸€ç³»åˆ—é…ç½®æ³¨è§£ï¼Œå¦‚@Configurationã€@EnableConfigurationPropertiesã€@Componentã€@Beanã€@ConditionOnXXã€@AutoConfigureOrderç­‰ï¼Œè®©IOCå®¹å™¨åŠ è½½æˆ‘ä»¬è‡ªå®šä¹‰çš„Beanè¿›å»ï¼›&lt;/p&gt;
&lt;p&gt;å¦å¤–å°±æ˜¯å¿…é¡»åœ¨META-INFæ–‡ä»¶å¤¹ä¸‹åˆ›å»ºspring.factoriesï¼Œå‘ŠçŸ¥Springåœ¨å“ªæ‰¾åˆ°é…ç½®ç±»ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;org.springframework.boot.autoconfigure.EnableAutoConfiguration=[è‡ªå®šä¹‰é…ç½®ç±»çš„å…¨é™å®šåç§°]
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;è‡ªå®šä¹‰Starterå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªJaråŒ…ï¼Œè¯¥JaråŒ…åœ¨Mavenæˆ–Gradleæ³¨å†Œåï¼ŒæœåŠ¡å¯åŠ¨æ—¶ï¼ŒIOCå®¹å™¨ä¼šå»è‡ªåŠ¨åŠ è½½ã€‚&lt;/p&gt;
&lt;p&gt;è‡ªå®šä¹‰Starterå†…ä¹Ÿå¯ä»¥ä½¿ç”¨é…ç½®æ–‡ä»¶ï¼Œè®¾å®šé»˜è®¤é…ç½®çš„key-valueï¼Œå½“æœ¬é¡¹ç›®é‡Œæœ‰é…ç½®çš„keyä¸starteré‡Œå®šä¹‰çš„é…ç½®keyé‡å¤æ—¶å¯ä»¥è¢«æ›¿æ¢&lt;/p&gt;
&lt;h2 id=&#34;contextloaderlistener&#34;&gt;ContextLoaderListener&lt;/h2&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.cnblogs.com/weknow619/p/6341395.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;ã€Springã€‘æµ…è°ˆContextLoaderListeneråŠå…¶ä¸Šä¸‹æ–‡ä¸DispatcherServletçš„åŒºåˆ«&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½œä¸ºSpringå¯åŠ¨å…¥å£&lt;/li&gt;
&lt;li&gt;å®ç°äº†ServletContextListener æ¥å£ï¼Œç›‘å¬ServletContextï¼Œå¦‚æœ ServletContext å‘ç”Ÿå˜åŒ–ï¼ˆå¦‚æœåŠ¡å™¨å¯åŠ¨æ—¶ServletContext è¢«åˆ›å»ºï¼ŒæœåŠ¡å™¨å…³é—­æ—¶ ServletContext å°†è¦è¢«é”€æ¯ï¼‰æ—¶ï¼Œæ‰§è¡Œç›‘å¬å™¨é‡Œçš„æ–¹æ³•&lt;/li&gt;
&lt;li&gt;ä¸ºIOCå®¹å™¨æä¾›ç¯å¢ƒï¼Œæ‰«æåŒ…ï¼Œå°†å¸¦æœ‰æ³¨è§£çš„BeanåŠ å…¥åˆ°å®¹å™¨ç”¨äºä¾èµ–æ³¨å…¥ï¼Œæˆ–è€…åŠ è½½xmlæ–‡ä»¶ï¼Œå°†xmlæ³¨å†Œçš„beanåŠ å…¥å®¹å™¨ç”¨äºä¾èµ–æ³¨å…¥&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;å¸¸ç”¨æ³¨è§£&#34;&gt;å¸¸ç”¨æ³¨è§£&lt;/h1&gt;
&lt;h2 id=&#34;controllerä¸restcontroller&#34;&gt;@Controllerä¸@RestController&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;@Controller é»˜è®¤æ˜¯è¿”å›è§†å›¾ï¼Œå³æ–¹æ³•çš„returnè¿”å›çš„æ˜¯è§†å›¾å±‚çš„è·¯å¾„ï¼Œåªæœ‰+@ResponseBodyæ‰ä¼šè¿”å›Jsonæ ¼å¼çš„æ•°æ®&lt;/li&gt;
&lt;li&gt;@RestControllerå®é™…ä¸Šæ˜¯@Controller + @ResponseBodyç»„åˆï¼Œé»˜è®¤è¿”å›jsonæ ¼å¼çš„æ•°æ®&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;autowiredä¸resource&#34;&gt;@Autowiredä¸@Resource&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;@Autowired æ³¨è§£ï¼Œä¿®é¥°ç±»æˆå‘˜å˜é‡ã€æ–¹æ³•åŠæ„é€ æ–¹æ³•ï¼Œå®Œæˆè‡ªåŠ¨è£…é…çš„å·¥ä½œï¼Œé»˜è®¤æŒ‰ byType è‡ªåŠ¨æ³¨å…¥ã€‚åªæœ‰ä¸€ä¸ªrequiredå±æ€§ï¼Œé»˜è®¤æ˜¯trueï¼Œè¡¨ç¤ºå¿…é¡»æ³¨å…¥ï¼Œä¸èƒ½ä¸ºnull&lt;/p&gt;
&lt;p&gt;@Autowired è‡ªåŠ¨æ³¨å…¥æ—¶ï¼ŒSpring å®¹å™¨ä¸­åŒ¹é…çš„å€™é€‰ Bean æ•°ç›®å¿…é¡»æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªã€‚å› ä¸ºå®ƒæ˜¯æŒ‰ç±»å‹æ³¨å…¥çš„ï¼Œå¦‚æœæœ‰å¤šä¸ªåŒç±»å‹çš„Beanä¼šå¯¼è‡´å‡ºé”™ï¼Œæ­¤æ—¶å¯ä»¥é…åˆ@Qualifieræ¥è§„é¿è¿™ç§æƒ…å†µï¼Œé€šè¿‡ @Qualifier(&amp;ldquo;å®ä¾‹åç§°&amp;rdquo;) æŒ‡å®šæ³¨å…¥beançš„åç§°ï¼Œæ¶ˆé™¤æ­§ä¹‰ï¼Œæ­¤æ—¶ä¸ @ResourceæŒ‡å®šnameå±æ€§ä½œç”¨ç›¸åŒã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;@Resource çš„ä½œç”¨ç›¸å½“äº @Autowiredï¼Œåªä¸è¿‡ @Autowired æŒ‰ byType è‡ªåŠ¨æ³¨å…¥ï¼Œé¢@Resource é»˜è®¤æŒ‰ byName è‡ªåŠ¨æ³¨å…¥ï¼Œè¯¥æ³¨è§£æœ‰ä¸¤ä¸ªå±æ€§ï¼Œnameå’Œtypeï¼Œåˆ†åˆ«ä»£è¡¨é€šè¿‡åç§°æŸ¥æ‰¾beanå’Œé€šè¿‡ç±»å‹æŸ¥æ‰¾beanã€‚&lt;/p&gt;
&lt;p&gt;æ­¤å¤–@Resourceè¿˜æœ‰å…¶ä»–å±æ€§ï¼Œå¦‚lookupã€shareableã€mappedNameç­‰&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;componentä¸bean&#34;&gt;@Componentä¸@Bean&lt;/h2&gt;
&lt;p&gt;ä¸¤è€…éƒ½æ˜¯ç”¨äºæ ‡è®°ï¼Œè¢«æ ‡è®°çš„å®ä¾‹ä¼šè¢«Springç®¡ç†&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;@Componentåªèƒ½ä½œç”¨ç±»ï¼Œé…åˆ@ComponentScanæ³¨è§£è®©Springå¯åŠ¨æ—¶è¿›è¡Œæ‰«æï¼Œå½“æ‰«æåˆ°@Componentä¿®é¥°çš„ç±»æ—¶ä¼šè¿›è¡Œå®ä¾‹åŒ–å’Œä¾èµ–æ³¨å…¥&lt;/p&gt;
&lt;p&gt;@Componentæ˜¯ä¸€ä¸ªæ¯”è¾ƒé€šç”¨çš„è¯­ä¹‰ï¼Œ@Serviceã€@Repositoryçš„ä½œç”¨ä¸@Componentç›¸åŒçš„ï¼Œåªæ˜¯è¯­ä¹‰ä¸åŒï¼Œä¿®é¥°çš„ç±»æ‰€åœ¨çš„å±‚æ¬¡ä¸åŒ&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;@Beanåªèƒ½ä½œç”¨äºæ–¹æ³•ï¼Œé€šè¿‡æ–¹æ³•æ¥å®ä¾‹åŒ–Beanï¼ŒBeançš„åç§°ä¸ºæ–¹æ³•çš„åç§°ï¼ˆå¦‚æœæœ‰å‰ç¼€getä¼šè‡ªåŠ¨å¿½ç•¥ï¼‰ï¼Œäº¤ç”±IOCå®¹å™¨ç®¡ç†ï¼Œé€šå¸¸ä¸@Configurationé…åˆä½¿ç”¨ï¼Œç­‰ä»·äºxmlæ–‡ä»¶ä¸­çš„&lt;!-- raw HTML omitted --&gt;é…ç½®ï¼Œæ–¹æ³•åç›¸å½“äº&lt;!-- raw HTML omitted --&gt;ä¸­çš„idï¼Œéœ€è¦å”¯ä¸€&lt;/p&gt;
&lt;p&gt;@Beançš„æ–¹å¼åˆå§‹åŒ–beanä¼šæ›´åŠ çµæ´»ï¼Œå› ä¸ºå¯ä»¥åœ¨æ–¹æ³•å†…éƒ¨è¿›è¡Œé€»è¾‘å¤„ç†ï¼Œæ¯”å¦‚åˆ©ç”¨é…ç½®æ–‡ä»¶ + å·¥å‚æ¨¡å¼å®ä¾‹åŒ–ä¸åŒçš„bean&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;configurationä¸configurationproperties&#34;&gt;@Configurationä¸@ConfigurationProperties&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;@Configurationä½œç”¨äºç±»ï¼Œç›¸å½“äºåŠ è½½beançš„xmlæ–‡ä»¶ï¼Œä¸€èˆ¬é…åˆ@Beanæ³¨è§£ä½¿ç”¨ï¼Œè®©IOCå®¹å™¨ç®¡ç†æˆ‘ä»¬å£°æ˜çš„bean&lt;/li&gt;
&lt;li&gt;@ConfigurationPropertiesç”¨äºè¯»å–key-valueçš„é‚£ç§é…ç½®æ–‡ä»¶ï¼Œå¦‚propertiesã€yamlç­‰ï¼Œç±»ä¼¼äº@Valueï¼Œä¸»è¦ç”¨äºé…ç½®æ–‡ä»¶çš„å­—æ®µæ³¨å…¥ï¼Œæœ‰å±æ€§prefixè¡¨ç¤ºå‰ç¼€ï¼Œkeyä¸ºå±æ€§åç§°ï¼Œå°†é…ç½®æ–‡ä»¶é‡Œçš„é…ç½®ç»‘å®šåˆ°ç±»çš„å±æ€§ä¸Šã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;springbootapplicationä¸componentscanä¸import&#34;&gt;@SpringBootApplicationä¸@ComponentScanä¸@Import&lt;/h2&gt;
&lt;p&gt;ä¸¤è€…éƒ½ç”¨äºå‘ŠçŸ¥Springåœ¨å“ªé‡Œæ‰¾åˆ°beanï¼Œåªæ˜¯æ‰«æçš„è·¯å¾„ä¸åŒ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;@SpringBootApplicationä½œç”¨ä¸mainæ–¹æ³•æ‰€åœ¨çš„ç±»ï¼Œç”¨äºå¯åŠ¨IOCå®¹å™¨ï¼Œé»˜è®¤ä¼šæ‰«æè¯¥ç±»æ‰€åœ¨åŒ…åŠå…¶å­åŒ…ä¸‹ï¼Œè¿›è¡ŒBeançš„å®ä¾‹åŒ–å’Œç®¡ç†&lt;/p&gt;
&lt;p&gt;@SpringBootApplicationå®é™…ä¸ŠåŒ…å«äº†ä¸‰ä¸ªæ³¨è§£ï¼Œ@ComponentScanã€@EnableAutoConfigurationã€@SpringBootConfigurationï¼Œè¯¦æƒ…è§ä¸Šé¢SpringBootå¯åŠ¨æµç¨‹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;@ComponentScan(&amp;ldquo;åŒ…è·¯å¾„&amp;rdquo;)ï¼Œç”¨äºæ‰«ææŒ‡å®šåŒ…åŠå…¶å­åŒ…ä¸‹çš„ç±»ï¼Œå“ªäº›éœ€è¦äº¤ç”±IOCå®¹å™¨ç®¡ç†ï¼Œä¸€èˆ¬ç”¨äºæ‰«æ@SpringBootApplicationæ‰«æä¸åˆ°çš„åŒ…ã€‚åœ¨éSpringBooté¡¹ç›®ä¸‹ï¼Œå¿…é¡»ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;@Importï¼Œç›¸å½“äºxmlä¸­çš„&lt;!-- raw HTML omitted --&gt;ï¼Œä¸»è¦æ˜¯å¯¼å…¥Configurationç±»ï¼Œä½œç”¨ç±»ä¼¼@ComponentScanï¼Œåªä¸è¿‡@ComponentScanæ˜¯é€šè¿‡æ‰«ææ‰¾åˆ°ï¼ŒèŒƒå›´å¹¿ï¼Œ@Importæ˜¯ç›´æ¥æŒ‡å®šæŸä¸ªConfigç±»&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;@ImportResource(&amp;ldquo;classpath*:xmlæ–‡ä»¶&amp;rdquo;)ï¼Œåˆ™æ˜¯ç›´æ¥å¯¼å…¥æŒ‡å®šçš„xmlæ–‡ä»¶&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;iocå’Œdi&#34;&gt;IOCå’ŒDI&lt;/h1&gt;
&lt;p&gt;&lt;strong&gt;æ§åˆ¶åè½¬&lt;/strong&gt;ï¼šå®é™…ä¸Šå°±æ˜¯æŠŠå¼€å‘äººå‘˜å¯¹ç¨‹åºæ‰§è¡Œæµç¨‹çš„æ§åˆ¶ï¼Œåè½¬åˆ°ç”±ç¨‹åºè‡ªå·±æ¥æ‰§è¡Œï¼Œä»£è¡¨æ€§çš„ä¾‹å­å°±æ˜¯ æ¨¡æ¿æ–¹æ³•è®¾è®¡æ¨¡å¼ï¼Œå®é™…ä¸Šæ˜¯ä¸€ç§è®¾è®¡æ€æƒ³ï¼Œå°±åƒspringæŠŠä¾èµ–æ³¨å…¥ç»™æŠ½æˆæ¡†æ¶ï¼Œç”±æ¡†æ¶æ¥è‡ªåŠ¨åˆ›å»ºå¯¹è±¡ã€ç®¡ç†å¯¹è±¡ç”Ÿå‘½å‘¨æœŸã€æ³¨å…¥ç­‰ï¼Œå¼€å‘è€…åªéœ€è¦å…³æ³¨ç±»é—´çš„å…³ç³»å³å¯&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ä¾èµ–æ³¨å…¥&lt;/strong&gt;ï¼šå®é™…ä¸Šå°±æ˜¯å¯¹ç±»æˆå‘˜åˆå§‹åŒ–ï¼Œå¹¶ä¸åœ¨ç±»å†…éƒ¨è¿›è¡Œï¼Œè€Œæ˜¯åœ¨å¤–éƒ¨åˆå§‹åŒ–åé€šè¿‡æ„é€ æ–¹æ³•ã€å‚æ•°ç­‰æ–¹å¼æ‰ä¼ é€’ç»™ç±»ï¼Œå°±åƒspringé‚£å‡ ç§æ³¨å…¥æ–¹å¼ï¼šæ„é€ å™¨æ³¨å…¥ã€setæ–¹æ³•æ³¨å…¥ã€æ³¨è§£æ³¨å…¥&lt;/p&gt;
&lt;h2 id=&#34;beançš„ä½œç”¨åŸŸ&#34;&gt;Beançš„ä½œç”¨åŸŸ&lt;/h2&gt;
&lt;p&gt;Springä¸­çš„beané»˜è®¤éƒ½æ˜¯å•ä¾‹çš„ï¼Œå¯¹äºä¸€äº›å…¬å…±å±æ€§ï¼Œåœ¨å¤šçº¿ç¨‹ä¸‹å¹¶ä¸å®‰å…¨ï¼Œspringæ”¯æŒå°†beanè®¾ç½®ä¸ºå…¶ä»–ä½œç”¨åŸŸ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;prototypeï¼šå¤šä¾‹ï¼Œä½¿ç”¨æ—¶æ‰åˆ›å»ºï¼Œæ¯æ¬¡è·å–çš„beanéƒ½ä¸æ˜¯åŒä¸€ä¸ª&lt;/li&gt;
&lt;li&gt;requestï¼šæ¯æ¬¡è¯·æ±‚åˆ›å»ºæ–°beanï¼Œrequestç»“æŸï¼Œbeané”€æ¯&lt;/li&gt;
&lt;li&gt;sessionï¼šæ¯æ¬¡è¯·æ±‚åˆ›å»ºæ–°beanï¼Œä»…åœ¨å½“å‰HTTP sessionå†…æœ‰æ•ˆ&lt;/li&gt;
&lt;li&gt;globalSessionï¼šåŸºäº portlet çš„ web åº”ç”¨ï¼Œç°åœ¨å¾ˆå°‘ç”¨äº†&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;æ³¨å…¥æ–¹å¼&#34;&gt;æ³¨å…¥æ–¹å¼&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;setteræ³¨å…¥&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ„é€ å™¨æ³¨å…¥ï¼Œæ— æ³•è§£å†³å¾ªç¯ä¾èµ–é—®é¢˜&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è‡ªåŠ¨è£…é…ï¼šxmlä¸‹ä½¿ç”¨â€œautowireâ€å±æ€§ï¼Œæœ‰noã€byNameã€byTypeã€constructorã€autodetectæ–¹å¼å¯é€‰&lt;/p&gt;
&lt;p&gt;æ³¨è§£æ³¨å…¥ï¼š@Resourceé»˜è®¤æ˜¯ä½¿ç”¨byNameè¿›è¡Œè£…é…ï¼Œ@Autowiredé»˜è®¤ä½¿ç”¨byTypeã€‚&lt;/p&gt;
&lt;p&gt;byNameå’ŒbyTypeæŒ‡çš„æ˜¯ä¾èµ–æ³¨å…¥æ—¶å¯»æ‰¾beançš„æ–¹å¼ã€‚@Resourceå’Œ@Autowiredéƒ½å¯ä»¥ä¿®é¥°å±æ€§ã€setteræ–¹æ³•ã€æ„é€ å™¨ï¼Œæ­¤æ—¶è¡¨ç¤ºçš„æ˜¯ä»¥å“ªç§æ–¹å¼è¿›è¡Œæ³¨å…¥&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;beanåŠ è½½æµç¨‹&#34;&gt;BeanåŠ è½½æµç¨‹&lt;/h2&gt;
&lt;p&gt;åˆå§‹åŒ–IOCå®¹å™¨ï¼ˆå·¥å‚å…¥è´§ï¼‰&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è¯»å–xmlæ–‡ä»¶ / æ‰«æåŒ…ç±»ä¸Šçš„æ³¨è§£&lt;/li&gt;
&lt;li&gt;è§£ææˆBeanDefinitionï¼Œåˆ›å»ºäº†Beançš„å®šä¹‰ç±»&lt;/li&gt;
&lt;li&gt;æ³¨å†Œåˆ°BeanFactoryï¼Œæ­¤æ—¶çš„å·¥å‚é‡Œåªä¿å­˜äº†ç±»åˆ›å»ºæ‰€éœ€è¦çš„å„ç§ä¿¡æ¯è¿˜æ²¡æœ‰çœŸæ­£çš„å®ä¾‹åŒ–Beanå¯¹è±¡&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¾èµ–æ³¨å…¥ï¼ˆå·¥å‚å‡ºè´§ï¼‰&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åˆå§‹åŒ–IOCå®¹å™¨&lt;/li&gt;
&lt;li&gt;åˆå§‹åŒ–Beanï¼ˆæ²¡æœ‰è®¾ç½®Lazy-initï¼‰&lt;/li&gt;
&lt;li&gt;åå°„åˆ›å»ºBeanå®ä¾‹&lt;/li&gt;
&lt;li&gt;æ³¨å…¥&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¯¦ç»†æºç åˆ†æï¼Œå‚è€ƒ&lt;a class=&#34;link&#34; href=&#34;https://www.cnblogs.com/ITtangtang/p/3978349.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Spring: æºç è§£è¯»Spring IOC&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://segmentfault.com/a/1190000015221968&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Spring  IOCæºç åˆ†æ&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;å…·ä½“ä¾‹å­ï¼Œå‚è€ƒ&lt;a class=&#34;link&#34; href=&#34;https://yikun.github.io/2015/05/29/Spring-IOC%E6%A0%B8%E5%BF%83%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Spring IOCæ ¸å¿ƒæºç å­¦ä¹ &lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;ä¸‰çº§ç¼“å­˜è§£å†³å¾ªç¯ä¾èµ–&#34;&gt;ä¸‰çº§ç¼“å­˜è§£å†³å¾ªç¯ä¾èµ–&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;ç¬¬ä¸€çº§ç¼“å­˜ï¼šå•ä¾‹ç¼“å­˜æ± singletonObjectsï¼Œå­˜æ”¾å®Œå…¨åˆå§‹åŒ–å®Œçš„å®ä¾‹æˆ–è€…AOPå®ä¾‹å¯¹è±¡ï¼Œæ­¤æ—¶å·²ç»å®Œæˆæ³¨å…¥ï¼Œç›´æ¥å¯ç”¨äº†ã€‚&lt;/li&gt;
&lt;li&gt;ç¬¬äºŒçº§ç¼“å­˜ï¼šæ—©æœŸæå‰æš´éœ²çš„å¯¹è±¡ç¼“å­˜earlySingletonObjectsï¼Œç”¨äºæ£€æµ‹å¾ªç¯å¼•ç”¨ï¼Œä¸singletonFactoriesäº’æ–¥ï¼Œå¦‚æœä¸€çº§ç¼“å­˜è·å–ä¸åˆ°ï¼Œåˆ™åœ¨æ­¤å±‚è·å–å®ä¾‹ï¼Œå¦‚æœè·å–ä¸åˆ°ï¼Œä¸”å…è®¸å»ä¸‰çº§ç¼“å­˜è·å–ï¼Œåˆ™ä»ä¸‰çº§ç¼“å­˜ä¸­è·å–ï¼Œå¹¶removeåŠ å…¥äºŒçº§ç¼“å­˜ã€‚ä¸€èˆ¬ç”¨äºå­˜æ”¾å®Œæˆäº†éƒ¨åˆ†ä¾èµ–æ³¨å…¥çš„Beanã€‚&lt;/li&gt;
&lt;li&gt;ç¬¬ä¸‰çº§ç¼“å­˜ï¼šsingletonFactorieså•ä¾‹å¯¹è±¡å·¥å‚ç¼“å­˜ï¼Œå­˜æ”¾åˆå§‹åŒ–ä¸å®Œå…¨çš„å®ä¾‹ï¼ˆè¿˜æœ‰ä¾èµ–æ²¡æ³¨å…¥ï¼‰ï¼Œå¦‚æœåˆ°äº†ä¸‰çº§ç¼“å­˜éƒ½è·å–ä¸åˆ°ï¼Œå°±ä¼šè¿›è¡Œåˆå§‹åŒ–ï¼Œå¹¶åŠ å…¥ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å½“å‡ºç°å¾ªç¯ä¾èµ–çš„å¯¹è±¡æ³¨å…¥æ—¶ï¼Œä¼šåˆ©ç”¨è¿™ä¸‰çº§ç¼“å­˜æ¥è§£å†³é—®é¢˜ï¼Œä½†æ˜¯Springåªèƒ½è§£å†³Setteræ–¹æ³•çš„æ³¨å…¥ï¼Œæ— æ³•è§£å†³æ„é€ å™¨æ³¨å…¥ï¼ŒåŸå› æ˜¯å¦‚æœé€šè¿‡æ„é€ å™¨æ³¨å…¥ï¼Œéœ€è¦å…ˆå‡†å¤‡å¥½éœ€è¦æ³¨å…¥çš„å±æ€§&lt;/p&gt;
&lt;p&gt;å‡å¦‚ç°åœ¨æœ‰ç±»Aï¼ŒæŒæœ‰å±æ€§Bï¼Œç±»Bï¼ŒæŒæœ‰å±æ€§A&lt;/p&gt;
&lt;p&gt;é€šè¿‡æ„é€ å™¨æ³¨å…¥ï¼šåˆå§‹åŒ–Aï¼Œæ­¤æ—¶éœ€è¦Bï¼Œé‚£åˆå§‹åŒ–Bï¼Œæ­¤æ—¶éœ€è¦Aï¼Œä½†æ˜¯Aå› ä¸ºæ„é€ å™¨æ³¨å…¥éœ€è¦å…ˆæœ‰Bï¼Œæ­¤æ—¶æ— æ³•å®Œæˆåˆå§‹åŒ–ã€‚&lt;/p&gt;
&lt;p&gt;é€šè¿‡Setteræ–¹æ³•æ³¨å…¥ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;åˆå§‹åŒ–Aï¼Œä¼šå…ˆä¾æ¬¡ä»ä¸‰çº§ç¼“å­˜ä¸­è·å–Aå®ä¾‹ï¼Œè·å–ä¸åˆ°ï¼Œè¯´æ˜Aè¿˜æœªåˆå§‹åŒ–ï¼Œåˆå§‹åŒ–Aäº§ç”Ÿå®ä¾‹ï¼Œå°†å®ä¾‹AåŠ å…¥singletonFactoriesä¸­ã€‚&lt;/li&gt;
&lt;li&gt;å¯¹Aè¿›è¡Œä¾èµ–æ³¨å…¥ï¼Œå‘ç°éœ€è¦æ³¨å…¥Bï¼Œä¾æ¬¡ä»ä¸‰çº§ç¼“å­˜é‡Œè·å–Bå®ä¾‹ï¼Œåˆ°äº†ç¬¬ä¸‰å±‚éƒ½è·å–ä¸åˆ°ï¼Œè¯´æ˜è¿˜æœªåˆå§‹åŒ–ï¼Œåˆå§‹åŒ–Bäº§ç”Ÿå®ä¾‹ï¼ŒåŠ å…¥singletonFactoriesï¼Œå¯¹Bè¿›è¡Œä¾èµ–æ³¨å…¥ï¼Œå‘ç°éœ€è¦æ³¨å…¥Aï¼Œä¾æ¬¡ä»ä¸‰çº§ç¼“å­˜é‡Œè·å–Aå®ä¾‹ï¼Œåœ¨singletonFactoriesè·å–åˆ°è¿˜æœªåˆå§‹åŒ–å®Œå…¨çš„å®ä¾‹Aï¼Œä»singletonFactoriesä¸­removeï¼ŒåŠ å…¥åˆ°earlySingletonObjectsï¼Œæ³¨å…¥åˆ°Bä¸­ï¼Œæ­¤æ—¶Bå®Œå…¨åˆå§‹åŒ–å®Œæˆï¼Œä»earlySingletonObjectsä¸­removeï¼Œå°†BåŠ å…¥åˆ°singletonObjectsä¸­ã€‚&lt;/li&gt;
&lt;li&gt;å›åˆ°å¯¹Aè¿›è¡Œä¾èµ–æ³¨å…¥éƒ¨åˆ†ï¼Œç”±äºBåˆšåˆšåˆå§‹åŒ–å®ŒæˆåŠ å…¥äº†singletonObjectsï¼Œæ‰€ä»¥Aè·å–åˆ°Bï¼Œè¿›è¡Œæ³¨å…¥ï¼ŒAåˆå§‹åŒ–å®Œå…¨ï¼ŒåŠ å…¥singletonObjectsä¸­&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;æ€»ç»“&lt;/strong&gt;ï¼šSpringåœ¨å®ä¾‹åŒ–ä¸€ä¸ªbeançš„æ—¶å€™ï¼Œå…ˆå®ä¾‹åŒ–è¯¥beanï¼Œç„¶åé€’å½’çš„å®ä¾‹åŒ–å…¶æ‰€ä¾èµ–çš„æ‰€æœ‰beanï¼Œç›´åˆ°æŸä¸ªbeanæ²¡æœ‰ä¾èµ–å…¶ä»–beanï¼Œæ­¤æ—¶å°±ä¼šå°†è¯¥å®ä¾‹è¿”å›ï¼Œç„¶ååé€’å½’çš„å°†è·å–åˆ°çš„beanè®¾ç½®ä¸ºå„ä¸ªä¸Šå±‚beançš„å±æ€§ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;å®é™…ä¸Šï¼Œçœ‹èµ·æ¥earlySingletonObjectsä¼šæœ‰ç‚¹å¤šä½™ï¼Œè¿™ä¸€å±‚çš„ç¼“å­˜ä¸»è¦æ˜¯æ‰©å±•æ—¶ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;h2 id=&#34;beançš„ç”Ÿå‘½å‘¨æœŸ&#34;&gt;Beançš„ç”Ÿå‘½å‘¨æœŸ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Spring å®¹å™¨å¯ä»¥ç®¡ç† singleton ä½œç”¨åŸŸä¸‹ bean çš„ç”Ÿå‘½å‘¨æœŸï¼Œåœ¨æ­¤ä½œç”¨åŸŸä¸‹ï¼ŒSpring èƒ½å¤Ÿç²¾ç¡®åœ°çŸ¥é“beanä½•æ—¶è¢«åˆ›å»ºï¼Œä½•æ—¶åˆå§‹åŒ–å®Œæˆï¼Œä»¥åŠä½•æ—¶è¢«é”€æ¯ï¼›prototype ä½œç”¨åŸŸçš„beanï¼ŒSpringåªè´Ÿè´£åˆ›å»ºï¼Œä¹‹åå°±ä¸å†ç®¡ç†ï¼Œåªèƒ½ç”±å¼€å‘äººå‘˜é€šè¿‡ä»£ç æ§åˆ¶&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å…³äºxxxAwareç±»å‹çš„æ¥å£ï¼ŒAwareä¹‹å‰çš„åå­—è¡¨ç¤ºIOCå®¹å™¨å¯ä»¥è·å¾—ä»€ä¹ˆèµ„æºï¼ŒAwareæ–¹æ³•éƒ½æ˜¯åœ¨åˆå§‹åŒ–é˜¶æ®µå‰è¢«è°ƒç”¨ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç”Ÿå‘½å‘¨æœŸæ‰§è¡Œè¿‡ç¨‹ï¼Œ&lt;strong&gt;æ€»ç»“ä¸ºï¼šå®ä¾‹åŒ– -&amp;gt; å±æ€§èµ‹å€¼ -&amp;gt; åˆå§‹åŒ– -&amp;gt; é”€æ¯&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å®ä¾‹åŒ–&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Beanå®¹å™¨æ‰¾åˆ°é…ç½®æ–‡ä»¶ä¸­Spring Beançš„å®šä¹‰ã€‚&lt;/li&gt;
&lt;li&gt;Beanå®¹å™¨åˆ©ç”¨åå°„åˆ›å»ºä¸€ä¸ªBeançš„å®ä¾‹ï¼ˆå¯¹scopeä¸ºsingletonä¸”éæ‡’åŠ è½½çš„beanå®ä¾‹åŒ–ï¼Œæ­¤å¤„ä¼š&lt;strong&gt;è§¦å‘AOPCreatorè§£æ@Aspectç±»&lt;/strong&gt;ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;å±æ€§èµ‹å€¼&lt;/strong&gt; - ä¾èµ–æ³¨å…¥&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚æœæ¶‰åŠåˆ°ä¸€äº›å±æ€§å€¼ åˆ©ç”¨setæ–¹æ³•è®¾ç½®ä¸€äº›å±æ€§å€¼ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœBeanå®ç°äº†BeanNameAwareæ¥å£ï¼Œè°ƒç”¨setBeanName()æ–¹æ³•ï¼Œä¼ å…¥Beançš„åå­—ï¼Œç›¸å½“äºxmlä¸­&lt;!-- raw HTML omitted --&gt;ä¸­çš„idæˆ–nameã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœBeanå®ç°äº†BeanClassLoaderAwareæ¥å£ï¼Œè°ƒç”¨setBeanClassLoader()æ–¹æ³•ï¼Œä¼ å…¥ClassLoaderå¯¹è±¡çš„å®ä¾‹ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœBeanå®ç°äº†BeanFactoryAwareæ¥å£ï¼Œè°ƒç”¨setBeanFactory()æ–¹æ³•ï¼Œä¼ å…¥beanFactoryå¯¹è±¡çš„å®ä¾‹ï¼Œå¯ä»¥é€šè¿‡beanFactoryè·å–å…¶ä»–Beanã€‚&lt;/li&gt;
&lt;li&gt;ä¸ä¸Šé¢çš„ç±»ä¼¼ï¼Œå¦‚æœå®ç°äº†å…¶ä»–*Awareæ¥å£ï¼Œå°±è°ƒç”¨ç›¸åº”çš„æ–¹æ³•ï¼Œæ¯”å¦‚å®ç°äº†ApplicationContextAwareæ¥å£ï¼Œå°±å¯ä»¥è·å–ä¸Šä¸‹æ–‡ï¼Œä½œç”¨åŒBeanFactoryï¼Œåªæ˜¯èƒ½è·å–åˆ°å…¶ä»–æ•°æ®ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœBeanå®ç°äº†BeanPostProcessoræ¥å£ï¼Œæ‰§è¡ŒpostProcessBeforeInitialization()æ–¹æ³•ï¼ˆéœ€æ‰‹åŠ¨å®ç°è¯¥æ–¹æ³•ï¼Œ&lt;strong&gt;åˆ©ç”¨è¯¥æ–¹æ³•å®ç°AOPï¼Œåœ¨æ­¤å¤„åˆ›å»ºä»£ç†ç±»&lt;/strong&gt;ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;åˆå§‹åŒ–&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚æœBeanå®ç°äº†InitializingBeanæ¥å£ï¼Œæ‰§è¡ŒafterPropertiesSet()æ–¹æ³•ã€‚ä½œç”¨åŒxmlé…ç½®ä¸­çš„init-methodé…ç½®ä¸€æ ·ï¼Œç”¨äºæŒ‡å®šåˆå§‹åŒ–æ–¹æ³•ï¼Œä½†æ˜¯å…ˆäºinit-methodæ–¹æ³•æ‰§è¡Œã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœBeanåœ¨xmlé…ç½®æ–‡ä»¶ä¸­&lt;!-- raw HTML omitted --&gt;çš„init-methodå±æ€§ï¼Œæ‰§è¡ŒæŒ‡å®šçš„æ–¹æ³•è¿›è¡Œåˆå§‹åŒ–ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœBeanå®ç°äº†BeanPostProcessoræ¥å£ï¼Œæ‰§è¡ŒpostProcessAfterInitialization()æ–¹æ³•ï¼ˆéœ€æ‰‹åŠ¨å®ç°è¯¥æ–¹æ³•ï¼Œ&lt;strong&gt;åˆ©ç”¨è¯¥æ–¹æ³•å®ç°AOPï¼Œåœ¨æ­¤å¤„åˆ›å»ºä»£ç†ç±»&lt;/strong&gt;ï¼‰&lt;/li&gt;
&lt;li&gt;æ­¤æ—¶beanå·²ç»å‡†å¤‡å°±ç»ªï¼Œå¯ä»¥è¢«åº”ç”¨ç¨‹åºä½¿ç”¨äº†ï¼Œä»–ä»¬å°†ä¸€ç›´é©»ç•™åœ¨åº”ç”¨ä¸Šä¸‹æ–‡ä¸­ï¼Œç›´åˆ°è¯¥åº”ç”¨ä¸Šä¸‹æ–‡è¢«é”€æ¯&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;é”€æ¯&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å½“è¦é”€æ¯Beançš„æ—¶å€™ï¼Œå¦‚æœBeanå®ç°äº†DisposableBeanæ¥å£ï¼Œæ‰§è¡Œdestroy()æ–¹æ³•ã€‚&lt;/li&gt;
&lt;li&gt;å½“è¦é”€æ¯Beançš„æ—¶å€™ï¼Œå¦‚æœBeanåœ¨xmlé…ç½®æ–‡ä»¶ä¸­çš„&lt;!-- raw HTML omitted --&gt;çš„destroy-methodå±æ€§ï¼Œæ‰§è¡ŒæŒ‡å®šçš„æ–¹æ³•è¿›è¡Œé”€æ¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å‚è€ƒï¼š&lt;a class=&#34;link&#34; href=&#34;https://www.jianshu.com/p/3944792a5fff&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Spring Beanç”Ÿå‘½å‘¨æœŸ&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.jianshu.com/p/1dec08d290c1&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Spring Beanç”Ÿå‘½å‘¨æœŸ&lt;/a&gt;ï¼šè¿™ç¯‡å†™å¾—ä¸é”™&lt;/p&gt;
&lt;h2 id=&#34;applicationcontextä¸beanfactoryçš„åŒºåˆ«&#34;&gt;ApplicationContextä¸BeanFactoryçš„åŒºåˆ«&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;ApplicationContextä¸BeanFactoryç±»ä¼¼ï¼ŒBeanFactoryåªæä¾›æœ€åŸºæœ¬çš„Beanå¯¹è±¡åˆ›å»ºä¸è·å–ï¼ŒApplicationContextæŒ‡çš„æ˜¯ä¸Šä¸‹æ–‡ï¼ŒåŒ…å«BeanFactoryçš„åŠŸèƒ½ï¼ˆå®ç°äº†BeanFactoryæ¥å£ï¼‰ï¼ŒåŒæ—¶ä¹Ÿæä¾›äº†å…¶ä»–é¢å¤–çš„åŠŸèƒ½ï¼Œæ¯”å¦‚äº‹ä»¶æœºåˆ¶ã€ç›‘å¬ã€æ‹¦æˆªå™¨ã€èµ„æºè®¿é—®ç­‰ã€‚&lt;/li&gt;
&lt;li&gt;BeanFactoryé‡‡ç”¨å»¶è¿ŸåŠ è½½æ¥æ³¨å…¥Beanï¼Œåªæœ‰åœ¨ä½¿ç”¨åˆ°æŸä¸ªBeançš„æ—¶å€™æ‰ä¼šå®ä¾‹åŒ–ï¼ŒApplicationContextåˆ™åœ¨å®¹å™¨å¯åŠ¨æ—¶ï¼Œå°±å®ä¾‹åŒ–Beanï¼Œå¸¸é©»åœ¨å®¹å™¨å†…ï¼Œä¹Ÿå¯ä»¥ä¸ºBeané…ç½®Lazy-init=trueæ¥è®©Beanå»¶è¿Ÿå®ä¾‹åŒ–ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;iocæ¨¡æ‹Ÿ&#34;&gt;IOCæ¨¡æ‹Ÿ&lt;/h2&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.cnblogs.com/weilu2/p/spring_ioc_analysis_principle_bsici_on_reflection_annotation.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Springâ€”â€”åŸç†è§£æ-åˆ©ç”¨åå°„å’Œæ³¨è§£æ¨¡æ‹ŸIoCçš„è‡ªåŠ¨è£…é…&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://zhuanlan.zhihu.com/p/144627581&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;æ ¹æ® Spring æºç å†™ä¸€ä¸ªå¸¦æœ‰ä¸‰çº§ç¼“å­˜çš„ IOC&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;aop&#34;&gt;AOP&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;åˆ‡é¢Aspectï¼šæŒ‡ä»£ç†ç±»ï¼Œå£°æ˜åˆ‡ç‚¹å’Œé€šçŸ¥&lt;/li&gt;
&lt;li&gt;åˆ‡ç‚¹PointCutï¼šæŒ‡è¦æŠŠåˆ‡é¢çš„é€šçŸ¥åœ¨è¢«ä»£ç†ç±»çš„æ–¹æ³•çš„ä½ç½®ï¼Œå³è¡¨è¾¾å¼executionï¼ˆå€¼çš„æ ¼å¼ä¸º [æ–¹æ³•çš„è®¿é—®ä¿®é¥°ç¬¦] [è¢«ä»£ç†ç±»çš„å…¨é™å®šåç§°]å’Œå…¶æ–¹æ³•å(æ–¹æ³•å‚æ•°)]ï¼‰ï¼Œåˆ‡ç‚¹å¯ä»¥æœ‰å¤šä¸ªï¼Œé…åˆé€šçŸ¥ä½¿ç”¨&lt;/li&gt;
&lt;li&gt;é€šçŸ¥Adviceï¼šä»£ç†ç±»çš„å¢å¼ºæ–¹æ³•ï¼Œé€šçŸ¥åˆ†ä¸ºå‰ç½®é€šçŸ¥ã€ç¯ç»•é€šçŸ¥ã€åç½®é€šçŸ¥ã€åç½®è¿”å›é€šçŸ¥ã€åç½®å¼‚å¸¸é€šçŸ¥&lt;/li&gt;
&lt;li&gt;è¿æ¥ç‚¹JoinPointï¼šè¢«ä»£ç†ç±»çš„æ–¹æ³•&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;åŸºæœ¬åŸç†&#34;&gt;åŸºæœ¬åŸç†&lt;/h2&gt;
&lt;p&gt;AOPåŸºäºä»£ç†æ¨¡å¼ï¼Œä»£ç†åˆ†ä¸ºä¸‰ç§ä»£ç†ï¼šé™æ€ä»£ç†ï¼ŒJDKåŠ¨æ€ä»£ç†ï¼ŒCGLibä»£ç†&lt;/p&gt;
&lt;h3 id=&#34;é™æ€ä»£ç†&#34;&gt;é™æ€ä»£ç†&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// æ¥å£
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;A&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;method&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();}&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;// ä»£ç†ç±»
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;BProxy&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;implements&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;A&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
    
    &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;B&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
    
    &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;BProxy&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{}&lt;/span&gt;
    
    &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;BProxy&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;B&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;k&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;b&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
    
    &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;method&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(){&lt;/span&gt;
        &lt;span class=&#34;c1&#34;&gt;// ä¸ºè¢«ä»£ç†ç±»è¿›è¡Œä¸€ç³»åˆ—å‰ç½®æ“ä½œ
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;method&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
        &lt;span class=&#34;c1&#34;&gt;// ä¸ºè¢«ä»£ç†ç±»è¿›è¡Œä¸€ç³»åˆ—åç½®æ“ä½œ
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;// è¢«ä»£ç†ç±»
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;B&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;implements&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;A&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;method&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;c1&#34;&gt;// å…·ä½“çš„å¤„ç†é€»è¾‘
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;B&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;b&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;B&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;BProxy&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;bProxy&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;BProxy&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;bProxy&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;method&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;å¥½å¤„ï¼šåœ¨ä¸ä¿®æ”¹ç›®æ ‡å¯¹è±¡çš„åŠŸèƒ½çš„å‰æä¸‹ï¼Œå¢æ·»æ–°æ–¹æ³•
ç¼ºç‚¹ï¼šæ¯ä¸ªå¯¹è±¡éƒ½éœ€è¦æœ‰ä»£ç†å¯¹è±¡ï¼Œå¯¼è‡´æœ‰å¾ˆå¤šä»£ç†ç±»ï¼›æ¥å£å¢åŠ æ–¹æ³•ï¼Œæ‰€æœ‰çš„å®ç°ç±»éƒ½è¦æ”¹&lt;/p&gt;
&lt;h3 id=&#34;jdkåŠ¨æ€ä»£ç†&#34;&gt;JDKåŠ¨æ€ä»£ç†&lt;/h3&gt;
&lt;p&gt;åŠ¨æ€ä»£ç†æ˜¯ä¸ºäº†è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œé€šè¿‡åå°„ + å¤šæ€çš„æ–¹å¼ï¼ŒåŠ¨æ€ä¸ºä¸€ä¸ªä¸€ä¸ªç±»è®¾ç½®ä»£ç†ï¼Œåªæœ‰çŸ¥é“é‚£ä¸ªç±»çš„æ¥å£æ‰å¯ä»¥ã€‚åˆ©ç”¨ JDK java.lang.reflectåŒ…é‡Œçš„InvocationHandleræ¥å£ï¼Œä»£ç†æ–¹æ³•å…·ä½“é€»è¾‘å†™åœ¨invokeæ–¹æ³•é‡Œ&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;n&#34;&gt;ä»£ç†å¯¹è±¡çš„æ‰§è¡Œæ–¹æ³•&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ï¼&lt;/span&gt;
&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;InvocationHandler&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// proxyï¼šåŠ¨æ€äº§ç”Ÿçš„ä»£ç†å¯¹è±¡ï¼Œmethodï¼šè¢«ä»£ç†ç±»è¦æ‰§è¡Œçš„æ–¹æ³•ï¼Œargsï¼šæ–¹æ³•æ‰€éœ€å‚æ•°
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;invoke&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;proxy&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Method&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;method&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
        &lt;span class=&#34;kd&#34;&gt;throws&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Throwable&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;è¿˜æœ‰java.lang.reflectåŒ…ä¸­çš„Proxyç±»çš„newProxyInstanceæ–¹æ³•,ï¼Œä»–æ˜¯é™æ€çš„ï¼Œä½œç”¨æ˜¯ä¸ºè¢«ä»£ç†ç±»æ„å»ºä»£ç†ç±»ï¼Œå¹¶è¿”å›ï¼Œåœ¨è¿™ä¸ªåŠ¨æ€ç”Ÿæˆçš„ä»£ç†ç±»ä¸­å·²ç»ç»‡å…¥äº†InvocationHandlerï¼Œè€Œå®ƒåˆæŒæœ‰è¢«ä»£ç†ç±»ï¼Œå¯¹ä»£ç†å¯¹è±¡çš„æ‰€æœ‰æ¥å£æ–¹æ³•è°ƒç”¨éƒ½ä¼šè½¬å‘åˆ°InvocationHandler.invoke()æ–¹æ³•&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;n&#34;&gt;è¯¥æ–¹æ³•å°†ä¼šä¸ºè¢«ä»£ç†ç±»ç”Ÿæˆä»£ç†ç±»&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ï¼Œ&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ä»£ç†ç±»æ‰§è¡Œä¸è¢«ä»£ç†ç±»çš„æ¥å£æ—¶&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ï¼Œ&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ä¼šæ‰§è¡ŒinvocationHandlerçš„æ–¹æ³•&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ï¼&lt;/span&gt;
&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;newProxyInstance&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ClassLoader&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;loader&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// è¢«ä»£ç†ç±»çš„ç±»åŠ è½½å™¨ï¼Œå¦‚ä¸Šé¢Bç±»çš„ç±»åŠ è½½å™¨
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;                                      &lt;span class=&#34;n&#34;&gt;Class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;?&amp;gt;[]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;interfaces&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// è¢«ä»£ç†ç±»çš„æ¥å£æ•°ç»„
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;                                      &lt;span class=&#34;n&#34;&gt;InvocationHandler&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;h&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// ä¸Šé¢å®ç°äº†InvocationHandleræ¥å£çš„å®ä¾‹
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;kd&#34;&gt;throws&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;IllegalArgumentException&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;å…·ä½“ä¾‹å­&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;ProxyFactory&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;

    &lt;span class=&#34;c1&#34;&gt;// è¢«ä»£ç†ç±»
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;target&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
	&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;ProxyFactory&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;target&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;){&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;target&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;target&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
	&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;c1&#34;&gt;// åŒ¿åå†…éƒ¨ç±»çš„æ–¹å¼é‡å†™invokeæ–¹æ³•
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getProxyInstance&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(){&lt;/span&gt;
        &lt;span class=&#34;c1&#34;&gt;// è¿”å›ä»£ç†ç±»
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Proxy&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;newProxyInstance&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;target&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getClass&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getClassLoader&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(),&lt;/span&gt;
				&lt;span class=&#34;n&#34;&gt;target&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getClass&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getInterfaces&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(),&lt;/span&gt;
				&lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;InvocationHandler&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
					&lt;span class=&#34;nd&#34;&gt;@Override&lt;/span&gt;
					&lt;span class=&#34;c1&#34;&gt;//å½“ä»£ç†è€…(æ¥å£)æ‰§è¡Œæ¥å£é‡Œçš„æ–¹æ³•çš„æ—¶å€™å°±ä¼šè°ƒç”¨æ­¤æ–¹æ³•
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;					&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;invoke&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;proxy&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Method&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;method&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
							&lt;span class=&#34;kd&#34;&gt;throws&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Throwable&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
						&lt;span class=&#34;n&#34;&gt;System&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;out&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;println&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;ä¸ºè¢«ä»£ç†ç±»è¿›è¡Œä¸€ç³»åˆ—å‰ç½®æ“ä½œ&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
						&lt;span class=&#34;c1&#34;&gt;//æ‰§è¡Œå®ç°äº†è¯¥æ¥å£çš„ç±»ä¸­çš„æ–¹æ³•ï¼Œè¢«ä»£ç†ç±»çš„æ–¹æ³•
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;						&lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;returnValue&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;method&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;invoke&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;target&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
						&lt;span class=&#34;n&#34;&gt;System&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;out&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;println&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;ä¸ºè¢«ä»£ç†ç±»è¿›è¡Œä¸€ç³»åˆ—åç½®æ“ä½œ&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
						&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;returnValue&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;//è¿”å›çš„æ˜¯è°ƒç”¨æ–¹æ³•åçš„ç»“æœ
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;					&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
				&lt;span class=&#34;o&#34;&gt;});&lt;/span&gt;
	&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;A&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;b&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;B&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// B b = new B();ä¹Ÿæ˜¯å¯ä»¥çš„
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;A&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;bProxy&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;A&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ProxyFactory&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getProxyInstance&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// å¿…é¡»è½¬æ¥å£ç±»å‹
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// è°ƒç”¨è¯¥æ¥å£é‡Œçš„æ–¹æ³•éƒ½ä¼šè¢«ä»£ç†
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;bProxy&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;method&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;å¥½å¤„ï¼šåªéœ€å†™ä¸€æ¬¡è¯¥æ¥å£çš„ä»£ç†ç±»å°±å¯ä»¥ä¸ºä»¥åè®¸å¤šå®ç°äº†æ­¤æ¥å£çš„è¢«ä»£ç†ç±»è¿›è¡Œä»£ç†ï¼Œä¸€æ¬¡ç¼–å†™ï¼Œå¤„å¤„ä½¿ç”¨
ç¼ºç‚¹ï¼šåªé’ˆå¯¹ä¸€ä¸ªæ¥å£å®ç°çš„ä»£ç†ï¼Œåªèƒ½é’ˆå¯¹æ¥å£å†™ä»£ç†ç±»&lt;/p&gt;
&lt;h3 id=&#34;cglibä»£ç†&#34;&gt;CGLIBä»£ç†&lt;/h3&gt;
&lt;p&gt;CGLIBä»£ç†å°±å¯ä»¥ç›´æ¥ä»£ç†æ™®é€šç±»ï¼Œä¸éœ€è¦æ¥å£äº†&lt;/p&gt;
&lt;p&gt;åŸç†ï¼šç›´æ¥è¯»å–è¢«ä»£ç†ç±»çš„å­—èŠ‚ç ï¼Œé€šè¿‡ç»§æ‰¿çš„æ–¹å¼å®ç°ï¼Œåœ¨å†…å­˜ä¸­&lt;strong&gt;æ„å»ºè¢«ä»£ç†ç±»çš„å­ç±»å¯¹è±¡&lt;/strong&gt;ä»è€Œå®ç°å¯¹ç›®æ ‡å¯¹è±¡çš„åŠŸèƒ½æ‰©å±•&lt;/p&gt;
&lt;p&gt;å…·ä½“ä¾‹å­ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;ProxyFactory&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;implements&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;MethodInterceptor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;target&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
	&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;ProxyFactory&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;target&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;){&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;target&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;target&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
	&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;c1&#34;&gt;//ç»™ç›®æ ‡å¯¹è±¡åˆ›å»ºä»£ç†å¯¹è±¡
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getProxyInstance&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(){&lt;/span&gt;
		&lt;span class=&#34;n&#34;&gt;Enhancer&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;en&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Enhancer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
		&lt;span class=&#34;c1&#34;&gt;//è®¾ç½®çˆ¶ç±»
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;n&#34;&gt;en&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;setSuperclass&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;target&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getClass&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;());&lt;/span&gt;
		&lt;span class=&#34;c1&#34;&gt;//è®¾ç½®å›è°ƒå‡½æ•°
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;n&#34;&gt;en&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;setCallback&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
		&lt;span class=&#34;c1&#34;&gt;//åˆ›å»ºå­ç±»ä»£ç†
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;en&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;create&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
	&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;nd&#34;&gt;@Override&lt;/span&gt;
	&lt;span class=&#34;c1&#34;&gt;//object ä¸ºCGLibåŠ¨æ€ç”Ÿæˆçš„ä»£ç†å®ä¾‹
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;//Method ä¸ºä¸Šæ–‡å®ä½“ç±»æ‰€è°ƒç”¨çš„è¢«ä»£ç†çš„æ–¹æ³•å¼•ç”¨
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;//Object[] æ–¹æ³•çš„å‚æ•°åˆ—è¡¨
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;//MethodProxy ä¸ºç”Ÿæˆçš„ä»£ç†ç±»å¯¹æ–¹æ³•çš„ä»£ç†å¼•ç”¨
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;intercept&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;obj&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Method&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;method&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;MethodProxy&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;proxy&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;throws&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Throwable&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;n&#34;&gt;System&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;out&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;println&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;ä¸ºè¢«ä»£ç†ç±»è¿›è¡Œä¸€ç³»åˆ—å‰ç½®æ“ä½œ&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
		&lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;returnValue&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;method&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;invoke&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;target&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
		&lt;span class=&#34;c1&#34;&gt;//æˆ–è€…å†™æˆ Object returnValue1 = proxy.invokeSuper(obj, args);
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;n&#34;&gt;System&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;out&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;println&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;ä¸ºè¢«ä»£ç†ç±»è¿›è¡Œä¸€ç³»åˆ—åç½®æ“ä½œ&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;returnValue&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
	&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;B&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;b&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;B&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// Bç±»çš„æ‰€æœ‰éfinalæ–¹æ³•ï¼ŒåŒ…æ‹¬å®ƒçš„çˆ¶ç±»éƒ½ä¼šè¢«ä»£ç†
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;B&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;bProxy&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;B&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;CGlibProxy&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getProxyInstance&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;bProxy&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;method&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id=&#34;springbootä¸­çš„å®ç°&#34;&gt;SpringBootä¸­çš„å®ç°&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;SpringBootä¸­æä¾›@EnableAspectJAutoProxyå¼€å¯å¯¹AOPçš„æ”¯æŒï¼Œå…¶ä¸­å±æ€§proxyTargetClass=trueæ—¶ä½¿ç”¨cglibï¼Œä¸ºfalseä½¿ç”¨JDKçš„åŠ¨æ€ä»£ç†ï¼Œé»˜è®¤ä¸ºfalse&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;@EnableAspectJAutoProxyæ³¨è§£ä¸»è¦æ˜¯ä½¿ç”¨AspectJAutoProxyRegistrarç±»å°†AOPå¤„ç†å·¥å…·æ³¨å†Œåˆ°Beanä¸­ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åœ¨è¿™ä¸ªAOPå¤„ç†å·¥å…·ä¸­æœ‰ä¸€ä¸ªAnnotationAwareAspectJAutoProxyCreatorç±»ï¼Œè¯¥ç±»&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å®ç°äº†ä¸€ç³»åˆ—Awareæ¥å£ï¼Œä½¿ç”¨BeanFactoryï¼šä½¿å¾—Beanå¯ä»¥ç®¡ç†&lt;/li&gt;
&lt;li&gt;å®ç°äº†orderæ¥å£ï¼šç”¨äºè®¾ç½®åˆ‡é¢çš„ä¼˜å…ˆçº§&lt;/li&gt;
&lt;li&gt;ç»§æ‰¿äº†ProxyConfigï¼šè¯¥ç±»å°è£…äº†ä»£ç†çš„é€šç”¨é€»è¾‘ï¼Œcglibæˆ–JDKåŠ¨æ€ä»£ç†å¼€å…³é…ç½®ç­‰&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;BeanåŠ è½½å®ŒAnnotationAwareAspectJAutoProxyCreatorç±»åï¼Œä¼šè§£æå¼€å‘è€…å®šä¹‰çš„åˆ‡é¢ç±»ã€åˆ‡ç‚¹ã€é€šçŸ¥ï¼Œåœ¨BeanFactoryä¸­æ‰¾åˆ°è¢«ä»£ç†ç±»ï¼Œç»“åˆé€šçŸ¥è¿›è¡Œå°è£…ï¼Œåˆ›å»ºå‡ºä»£ç†ç±»ã€‚ç”±äºè¢«ä»£ç†ç±»å¯è¢«è®¾ç½®å¤šé‡ä»£ç†ï¼Œåœ¨åˆ›å»ºä»£ç†ç±»æ—¶ï¼Œä¼šæ ¹æ®åˆ‡é¢çš„ä¼˜å…ˆçº§ï¼Œä¸æ–­å¥—åœ¨è¢«ä»£ç†ç±»ä¸Šï¼Œå½¢æˆæ‹¦æˆªå™¨é“¾ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ‰§è¡Œä»£ç†ç±»çš„æ–¹æ³•æ—¶ï¼Œå°±ä¼šè°ƒç”¨æ–¹æ³•æ‹¦æˆªå™¨é“¾ï¼Œè¿›è¡Œæ–¹æ³•å¢å¼ºã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;AOPçš„å®ç°ä¼šåœ¨åˆ›å»ºBeanå®ä¾‹å¯¹è±¡å‰è§¦å‘@Aspectåˆ‡é¢å¯¹è±¡ï¼Œè·å¾—Advisorã€‚ç”ŸæˆBeanå®ä¾‹å¯¹è±¡ä¹‹åï¼Œæ‰ä¼šå†æ¬¡è§¦å‘å¯¹è¯¥Beanå®ä¾‹å¯¹è±¡åšä»£ç†å¢å¼ºï¼Œå¢å¼ºçš„Advisoræ¥è‡ªä¹‹å‰çš„è§£æç»“æœã€‚&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://blog.csdn.net/JinXYan/article/details/89302126&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;SpringAOPè¯¦ç»†ä»‹ç»&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://blog.csdn.net/fighterandknight/article/details/51209822&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Spring æºç åˆ†æAop&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;äº‹åŠ¡&#34;&gt;äº‹åŠ¡&lt;/h1&gt;
&lt;h2 id=&#34;springäº‹åŠ¡ä¼ æ’­è¡Œä¸º&#34;&gt;Springäº‹åŠ¡ä¼ æ’­è¡Œä¸º&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;PROPERGATION_MANDATORYï¼šæ–¹æ³•å¿…é¡»è¿è¡Œåœ¨äº‹åŠ¡ä¸­ï¼Œå¦‚æœå½“å‰äº‹åŠ¡ä¸å­˜åœ¨ï¼ŒæŠ›å¼‚å¸¸&lt;/li&gt;
&lt;li&gt;PROPAGATION_NESTEDï¼šå½“å‰äº‹åŠ¡å­˜åœ¨ï¼Œåˆ™è¯¥æ–¹æ³•è¿è¡Œåœ¨åµŒå¥—äº‹åŠ¡ä¸­&lt;/li&gt;
&lt;li&gt;PROPAGATION_NEVERï¼šæ–¹æ³•ä¸èƒ½è¿è¡Œäº‹åŠ¡ä¸­ï¼Œå¦åˆ™æŠ›å¼‚å¸¸&lt;/li&gt;
&lt;li&gt;PROPAGATION_REQUIREDï¼šå½“å‰æ–¹æ³•å¿…é¡»è¿è¡Œåœ¨äº‹åŠ¡ä¸­ï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œè¯¥æ–¹æ³•è¿è¡Œå…¶ä¸­ï¼Œå¦åˆ™åˆ›å»ºæ–°äº‹åŠ¡&lt;/li&gt;
&lt;li&gt;PROPAGATION_REQUIRES_NEWï¼šå½“å‰æ–¹æ³•å¿…é¡»è¿è¡Œåœ¨äº‹åŠ¡ä¸­ï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™è¯¥äº‹åŠ¡åœ¨æ–¹æ³•è¿è¡ŒæœŸé—´è¢«æŒ‚èµ·&lt;/li&gt;
&lt;li&gt;PROPAGATION_SUPPORTSï¼šå½“å‰æ–¹æ³•ä¸éœ€è¦è¿è¡Œåœ¨äº‹åŠ¡ä¸­ï¼Œä½†å¦‚æœå­˜åœ¨äº‹åŠ¡ï¼Œä¹Ÿå¯è¿è¡Œåœ¨äº‹åŠ¡ä¸­&lt;/li&gt;
&lt;li&gt;PROPAGATION_NOT_SUPPORTEDï¼šå½“å‰æ–¹æ³•ä¸èƒ½è¿è¡Œåœ¨äº‹åŠ¡ä¸­ï¼Œå¦‚æœå­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŒ‚èµ·è¯¥æ–¹æ³•&lt;/li&gt;
&lt;/ul&gt;
</description>
        </item>
        <item>
        <title>SpringMVC</title>
        <link>http://nixum.cc/p/springmvc/</link>
        <pubDate>Fri, 15 Feb 2019 00:00:00 +0000</pubDate>
        
        <guid>http://nixum.cc/p/springmvc/</guid>
        <description>&lt;h1 id=&#34;springmvcå·¥ä½œåŸç†&#34;&gt;SpringMVCå·¥ä½œåŸç†&lt;/h1&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://github.com/Nixum/JavaGuide/blob/master/%E4%B8%BB%E6%B5%81%E6%A1%86%E6%9E%B6/SpringMVC%20%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3.md&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;SpringMVCå·¥ä½œåŸç†è¯¦è§£&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æµç¨‹å›¾çœ‹é“¾æ¥é‡Œçš„å³å¯&lt;/p&gt;
&lt;p&gt;ç®€å•æ¥è¯´å„ä¸ªç»„ä»¶çš„ä½œç”¨&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å‰ç«¯æ§åˆ¶å™¨DispatcherServlet&lt;/strong&gt;ï¼šè¯·æ±‚çš„å…¥å£ï¼Œå¯ä»¥çœ‹æˆæ˜¯ä¸­å¤®å¤„ç†å™¨ã€è½¬å‘å™¨ï¼Œè´Ÿè´£è°ƒåº¦å…¶ä»–ç»„ä»¶ï¼Œæ¥æ”¶è¯·æ±‚ï¼Œå®Œæˆå“åº”&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤„ç†å™¨æ˜ å°„å™¨HandlerMapping&lt;/strong&gt;ï¼šæ ¹æ®è¯·æ±‚çš„urlæŸ¥æ‰¾Handlerï¼Œæ‰¾åˆ°urlå¯¹åº”çš„controllerç±»ï¼Œè¿”å›ä¸€æ¡æ‰§è¡Œé“¾ï¼Œå…¶ä¸­å°±åŒ…å«æ‹¦æˆªå™¨å’Œå¤„ç†å™¨ï¼ˆå…·ä½“çš„controllerç±»ï¼‰ï¼›æœ‰é…ç½®æ–‡ä»¶æ–¹å¼ï¼Œå®ç°æ¥å£æ–¹å¼ï¼Œæ³¨è§£æ–¹å¼ç­‰æ–¹å¼å®ç°æ˜ å°„&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤„ç†å™¨é€‚é…å™¨HandlerAdapter&lt;/strong&gt;ï¼šHandlerMappingæ‰¾åˆ°å¯¹åº”çš„controllerç±»åï¼Œå†æ ¹æ®urlæ‰¾åˆ°å¯¹åº”çš„æ‰§è¡Œæ–¹æ³•&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤„ç†å™¨Handler&lt;/strong&gt;ï¼šå…·ä½“çš„å¤„ç†æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬æ‰€å†™å…·ä½“çš„Controllerç±»&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è§†å›¾è§£æå™¨View resolver&lt;/strong&gt;ï¼šæ ¹æ®é€»è¾‘Viewåç§°ï¼Œæ‰¾åˆ°å¯¹åº”çš„Viewï¼Œæ ¹æ®å¤„ç†å™¨è¿”å›çš„ModelAndViewï¼Œå°†æ•°æ®æ¸²æŸ“åˆ°Viewä¸Š&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è§†å›¾View&lt;/strong&gt;ï¼šä¾‹å¦‚jspï¼Œfreemarkerä¹‹ç±»çš„è§†å›¾æ¨¡æ¿&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æ‹¦æˆªå™¨åœ¨ä»€ä¹ˆæ—¶å€™æ‰§è¡Œï¼Ÿ&lt;/p&gt;
&lt;p&gt;æ‹¦æˆªå™¨ï¼Œæ˜¯å±äºHandlerMappingçº§åˆ«çš„ï¼Œå¯ä»¥æœ‰å¤šä¸ªHandlerMapping ï¼Œæ¯ä¸ªHandlerMappingå¯ä»¥æœ‰è‡ªå·±çš„æ‹¦æˆªå™¨ï¼Œæ‹¦æˆªå™¨å¯ä»¥è®¾ç½®ä¼˜å…ˆçº§ã€‚ä¸€ä¸ªè¯·æ±‚äº¤ç»™ä¸€ä¸ªHandlerMappingæ—¶ï¼Œè¿™ä¸ªHandlerMappingå…ˆæ‰¾æœ‰æ²¡æœ‰å¤„ç†å™¨æ¥å¤„ç†è¿™ä¸ªè¯·æ±‚ï¼Œå¦‚ä½•æ‰¾åˆ°äº†ï¼Œå°±æ‰§è¡Œæ‹¦æˆªå™¨ï¼Œæ‰§è¡Œå®Œæ‹¦æˆªåï¼Œäº¤ç»™ç›®æ ‡å¤„ç†å™¨ã€‚å¦‚æœæ²¡æœ‰æ‰¾åˆ°å¤„ç†å™¨ï¼Œé‚£ä¹ˆè¿™ä¸ªæ‹¦æˆªå™¨å°±ä¸ä¼šè¢«æ‰§è¡Œã€‚&lt;/p&gt;
&lt;p&gt;å®ç°HandlerInterceptoræ¥å£æˆ–è€…ç»§æ‰¿HandlerInterceptorï¼Œé‡å†™&lt;strong&gt;boolean preHandle()ã€void postHandle()ã€void afterCompletion()æ–¹æ³•&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;preHandle() æ–¹æ³•ï¼šè¯¥æ–¹æ³•ä¼šåœ¨æ§åˆ¶å™¨æ–¹æ³•å‰æ‰§è¡Œï¼Œå…¶è¿”å›å€¼è¡¨ç¤ºæ˜¯å¦ä¸­æ–­åç»­æ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;å½“å…¶è¿”å›å€¼ä¸ºtrueæ—¶ï¼Œè¡¨ç¤ºç»§ç»­å‘ä¸‹æ‰§è¡Œï¼›å½“å…¶è¿”å›å€¼ä¸ºfalseæ—¶ï¼Œä¼šä¸­æ–­åç»­çš„æ‰€æœ‰æ“ä½œï¼ˆåŒ…æ‹¬è°ƒç”¨ä¸‹ä¸€ä¸ªæ‹¦æˆªå™¨å’Œæ§åˆ¶å™¨ç±»ä¸­çš„æ–¹æ³•æ‰§è¡Œç­‰ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;postHandle()æ–¹æ³•ï¼šè¯¥æ–¹æ³•ä¼šåœ¨æ§åˆ¶å™¨æ–¹æ³•è°ƒç”¨ä¹‹åï¼Œä¸”è§£æè§†å›¾ä¹‹å‰æ‰§è¡Œã€‚å¯ä»¥é€šè¿‡æ­¤æ–¹æ³•å¯¹è¯·æ±‚åŸŸä¸­çš„æ¨¡å‹å’Œè§†å›¾åšå‡ºè¿›ä¸€æ­¥çš„ä¿®æ”¹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;afterCompletion()æ–¹æ³•ï¼šè¯¥æ–¹æ³•ä¼šåœ¨æ•´ä¸ªè¯·æ±‚å®Œæˆï¼Œå³è§†å›¾æ¸²æŸ“ç»“æŸä¹‹åæ‰§è¡Œã€‚å¯ä»¥é€šè¿‡æ­¤æ–¹æ³•å®ç°ä¸€äº›èµ„æºæ¸…ç†ã€è®°å½•æ—¥å¿—ä¿¡æ¯ç­‰å·¥ä½œã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;spring-security&#34;&gt;Spring Security&lt;/h1&gt;
&lt;p&gt;ç®€å•å·¥ä½œæµç¨‹&lt;/p&gt;
&lt;p&gt;è¯·æ±‚(åŒ…å«ç”¨æˆ·åï¼Œå¯†ç ä¹‹ç±»)â€”â€”&amp;gt;ç™»é™†ä¿¡æ¯å°è£…æˆä¸€ä¸ªAuthenticationå¯¹è±¡â€”â€”&amp;gt;AuthenticationManagerï¼Œè°ƒç”¨authenticate ()æ–¹æ³•å¤„ç†â€”â€”&amp;gt;è¯¥æ–¹æ³•ä¼šå°†å¯¹è±¡ä¼ é€’ç»™ä¸€ç³»åˆ—AuthenticationAdapterï¼ˆä¸€ç³»åˆ—Filterï¼‰ï¼Œæ¯ä¸€ä¸ªAuthenticationAdapterä¼šè°ƒç”¨å®ƒä»¬é…ç½®çš„UserDetailsServiceå¤„ç†&lt;/p&gt;
</description>
        </item>
        <item>
        <title>Java SE</title>
        <link>http://nixum.cc/p/java-se/</link>
        <pubDate>Mon, 18 Feb 2019 00:00:00 +0000</pubDate>
        
        <guid>http://nixum.cc/p/java-se/</guid>
        <description>&lt;p&gt;[TOC]&lt;/p&gt;
&lt;h1 id=&#34;ä¸€é¢å‘å¯¹è±¡&#34;&gt;ä¸€ã€é¢å‘å¯¹è±¡&lt;/h1&gt;
&lt;p&gt;é¢å‘å¯¹è±¡çš„ç‰¹å¾ï¼š
æŠ½è±¡(æ³¨æ„ä¸å½“å‰ç›®æ ‡æœ‰å…³çš„ï¼Œé€‰æ‹©ä¸€éƒ¨åˆ†ï¼Œæš‚æ—¶ä¸ç”¨éƒ¨åˆ†ç»†èŠ‚ï¼Œåˆ†ä¸ºè¿‡ç¨‹æŠ½è±¡ã€æ•°æ®æŠ½è±¡)
&lt;strong&gt;ç»§æ‰¿&lt;/strong&gt;ï¼šè”ç»“ç±»çš„å±‚æ¬¡æ¨¡å‹ã€å…è®¸å’Œé¼“åŠ±ç±»çš„é‡ç”¨ï¼Œæ´¾ç”Ÿç±»å¯ä»¥ä»å®ƒçš„åŸºç±»é‚£é‡Œç»§æ‰¿æ–¹æ³•å’Œå®ä¾‹å˜é‡ï¼Œè¿›è¡Œä¿®æ”¹å’Œæ–°å¢ä½¿å…¶æ›´é€‚åˆ
&lt;strong&gt;å°è£…&lt;/strong&gt;ï¼šå°è£…æ˜¯æŠŠè¿‡ç¨‹å’Œæ•°æ®åŒ…å›´èµ·æ¥ï¼Œå¯¹æ•°æ®çš„è®¿é—®åªèƒ½é€šè¿‡å·²å®šä¹‰çš„ç•Œé¢ï¼Œè¿™äº›å¯¹è±¡é€šè¿‡ä¸€ä¸ªå—ä¿æŠ¤çš„æ¥å£è®¿é—®å…¶ä»–å¯¹è±¡
&lt;strong&gt;å¤šæ€&lt;/strong&gt;ï¼šå…è®¸ä¸åŒç±»çš„å¯¹è±¡å¯¹åŒä¸€æ¶ˆæ¯ä½œå‡ºå“åº”ï¼ŒåŒ…æ‹¬å‚æ•°åŒ–å¤šæ€æ€§å’ŒåŒ…å«å¤šæ€æ€§ï¼Œçµæ´»ã€æŠ½è±¡ã€è¡Œä¸ºå…±äº«ã€ä»£ç å…±äº«ï¼Œè§£å†³ç¨‹åºå‡½æ•°åŒåé—®é¢˜&lt;/p&gt;
&lt;h1 id=&#34;äºŒåŸºç¡€ç±»å‹åŠå…¶åŒ…è£…ç±»å‹&#34;&gt;äºŒã€åŸºç¡€ç±»å‹åŠå…¶åŒ…è£…ç±»å‹&lt;/h1&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;åŸºæœ¬ç±»å‹&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;boolean&lt;/th&gt;
&lt;th&gt;byte&lt;/th&gt;
&lt;th&gt;char&lt;/th&gt;
&lt;th&gt;short&lt;/th&gt;
&lt;th&gt;int&lt;/th&gt;
&lt;th&gt;float&lt;/th&gt;
&lt;th&gt;long&lt;/th&gt;
&lt;th&gt;double&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;åŒ…è£…ç±»å‹&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Boolean&lt;/td&gt;
&lt;td&gt;Byte&lt;/td&gt;
&lt;td&gt;Character&lt;/td&gt;
&lt;td&gt;Short&lt;/td&gt;
&lt;td&gt;Integer&lt;/td&gt;
&lt;td&gt;Float&lt;/td&gt;
&lt;td&gt;Long&lt;/td&gt;
&lt;td&gt;Double&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ä½æ•°&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;1&lt;/td&gt;
&lt;td&gt;8&lt;/td&gt;
&lt;td&gt;16&lt;/td&gt;
&lt;td&gt;16&lt;/td&gt;
&lt;td&gt;32&lt;/td&gt;
&lt;td&gt;32&lt;/td&gt;
&lt;td&gt;64&lt;/td&gt;
&lt;td&gt;64&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å­—èŠ‚æ•°&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;8&lt;/td&gt;
&lt;td&gt;8&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å­—ç¬¦é›†&lt;/p&gt;
&lt;p&gt;unicodeæ˜¯å­—ç¬¦é›†ï¼Œä¸€ç§æ ‡å‡†ï¼ŒUTF-8ã€UTF-16ã€GBKä¹‹ç±»çš„æ˜¯ç¼–ç æ–¹å¼ï¼Œæ˜¯å­—ç¬¦é›†çš„å…·ä½“å®ç°&lt;/p&gt;
&lt;p&gt;UTF-16ï¼šå®šé•¿,å›ºå®š2å­—èŠ‚ï¼Œ UTF-8ï¼šå˜é•¿,ä¸­æ–‡å 3å­—èŠ‚,è‹±æ–‡å 1å­—èŠ‚&lt;/p&gt;
&lt;p&gt;charå¯ä»¥ä¿å­˜ä¸€ä¸ªä¸­æ–‡å­—ç¬¦&lt;/p&gt;
&lt;p&gt;javaä¸­é‡‡ç”¨unicodeç¼–ç ï¼Œæ— è®ºä¸­æ–‡ã€è‹±æ–‡éƒ½æ˜¯å 2ä¸ªå­—èŠ‚&lt;/p&gt;
&lt;p&gt;javaè™šæ‹Ÿæœºä¸­ä½¿ç”¨UTF-16ç¼–ç æ–¹å¼&lt;/p&gt;
&lt;p&gt;javaçš„å­—èŠ‚ç æ–‡ä»¶(.class)æ–‡ä»¶é‡‡ç”¨çš„æ˜¯UTF-8ç¼–ç ï¼Œä½†æ˜¯åœ¨java è¿è¡Œæ—¶ä¼šä½¿ç”¨UTF-16ç¼–ç ã€‚&lt;/p&gt;
&lt;p&gt;å‚è€ƒ&lt;a class=&#34;link&#34; href=&#34;https://blog.csdn.net/worm0527/article/details/70833531&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Javaä¸­çš„UTF-8ã€UTF-16ç¼–ç å­—ç¬¦æ‰€å å­—èŠ‚æ•°&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è‡ªåŠ¨è½¬æ¢çš„é¡ºåºï¼Œ&lt;/p&gt;
&lt;p&gt;ç”±é«˜åˆ°ä½ï¼šbtye, short, char(è¿™ä¸‰ä¸ªä¹‹é—´æ— æ³•è‡ªåŠ¨è½¬æ¢ï¼Œåªèƒ½å¼ºè½¬) &amp;mdash;&amp;gt; int &amp;mdash;&amp;gt; long &amp;mdash;&amp;gt; float &amp;mdash;&amp;gt; double&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¸ºä»€ä¹ˆ å 8å­—èŠ‚çš„long è½¬å  4å­—èŠ‚float ä¸éœ€è¦å¼ºè½¬è½¬åŒ–ï¼Ÿ&lt;/p&gt;
&lt;p&gt;å› ä¸ºåº•å±‚å®ç°æ–¹å¼ä¸åŒï¼Œæµ®ç‚¹æ•°åœ¨å†…å­˜ä¸­çš„32ä½ä¸æ˜¯ç®€å•åœ°è½¬åŒ–ä¸ºåè¿›åˆ¶ï¼Œè€Œæ˜¯é€šè¿‡å…¬å¼è®¡ç®—å¾—åˆ°ï¼Œæœ€å¤§å€¼è¦æ¯”longçš„èŒƒå›´å¤§&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;è£…ç®±å’Œæ‹†ç®±&#34;&gt;è£…ç®±å’Œæ‹†ç®±&lt;/h2&gt;
&lt;p&gt;ä»¥ int å’Œ Integer ä¸ºä¾‹&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;è£…ç®±çš„æ—¶å€™è‡ªåŠ¨è°ƒç”¨çš„æ˜¯ Integer çš„ valueOf(int) æ–¹æ³•ï¼ŒInteger a = 1; å°±ä¼šè§¦å‘è°ƒç”¨valueOf(int)æ–¹æ³•&lt;/p&gt;
&lt;p&gt;æ‹†ç®±çš„æ—¶å€™è‡ªåŠ¨è°ƒç”¨çš„æ˜¯Integerçš„ intValue() æ–¹æ³•&lt;/p&gt;
&lt;p&gt;parseInt(&amp;quot;&amp;quot;)æ–¹æ³•æ˜¯å°†å­—ç¬¦ä¸²è½¬åŒ–ä¸ºåŸºæœ¬ç±»å‹&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å…¶ä¸­ï¼Œè£…ç®±æ—¶ï¼Œå³è°ƒç”¨ valueOf() æ–¹æ³•æ—¶ï¼Œä¼šå…ˆå»ç¼“å­˜æ± é‡Œæ‰¾ï¼Œçœ‹çœ‹è¯¥å€¼æ˜¯å¦åœ¨ç¼“å­˜æ± çš„èŒƒå›´ä¸­ï¼Œå¦‚æœæ˜¯ï¼Œå¤šæ¬¡è°ƒç”¨æ—¶ä¼šå–å¾—åŒä¸€å¯¹è±¡çš„å¼•ç”¨ï¼Œå±äºåŒä¸€å¯¹è±¡ï¼Œå¦‚æœä¸åœ¨ç¼“å­˜æ± ä¸­ï¼Œåˆ™ä½¿ç”¨new Integer()&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨new Integer()åˆå§‹åŒ–çš„ï¼Œæ— è®ºä¼ å…¥çš„æ•°æ˜¯å¦åœ¨ç¼“å­˜æ± çš„èŒƒå›´å†…ï¼Œéƒ½æ˜¯é‡æ–°åˆ†é…å†…å­˜åˆå§‹åŒ–çš„ï¼Œå±äºä¸åŒå¯¹è±¡&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;8
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;n&#34;&gt;Integer&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;a&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;23&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Integer&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;b&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;23&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;System&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;out&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;println&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;a&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// true
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;Integer&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;a1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Integer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;23&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Integer&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;b1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Integer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;23&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;System&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;out&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;println&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;a1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;b1&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// false
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;Integer&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;c&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;128&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Integer&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;d&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;128&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt; 
&lt;span class=&#34;n&#34;&gt;System&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;out&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;println&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// false
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;åŸºæœ¬ç±»å‹ç¼“å­˜æ± ï¼Œå…¶ä»–ç±»å‹æ²¡æœ‰&lt;/p&gt;
&lt;p&gt;booleanï¼štrueã€false&lt;/p&gt;
&lt;p&gt;short ï¼š -128 ~127&lt;/p&gt;
&lt;p&gt;int ï¼š -128 ~127&lt;/p&gt;
&lt;p&gt;char ï¼š \u0000 ~ \u007F&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;equals å’Œ == å¯¹äº è£…ç®±å’Œæ‹†ç®±&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;== ï¼šæ¯”è¾ƒçš„æ˜¯ä¸¤ä¸ªåŒ…è£…ç±»å‹çš„ï¼ŒåŒåŒ…è£…ç±»å‹ï¼Œæ¯”è¾ƒä¸¤è€…çš„å¼•ç”¨ï¼Œåˆ¤æ–­æ˜¯å¦æŒ‡å‘åŒä¸€å¯¹è±¡ï¼›ä¸åŒåŒ…è£…ç±»å‹ç”¨==æ¯”è¾ƒä¼šå‡ºç°ç¼–è¯‘é”™è¯¯&lt;/p&gt;
&lt;p&gt;æ¯”è¾ƒæ—¶ä¸¤è€…éƒ½æ˜¯åŸºæœ¬ç±»å‹ï¼Œæ— è®ºç±»å‹æ˜¯å¦ä¸€æ ·ï¼Œéƒ½æ˜¯æ¯”è¾ƒæ•°å€¼&lt;/p&gt;
&lt;p&gt;æ¯”è¾ƒæ—¶ä¸€ä¸ªæ˜¯åŒ…è£…ç±»å‹ï¼Œä¸€ä¸ªæ˜¯åŸºæœ¬ç±»å‹ï¼Œæ— è®ºå€¼çš„èŒƒå›´æ˜¯å¦åœ¨ç¼“å­˜æ± å†…ï¼Œåˆ™å°†è‡ªåŠ¨æ‹†ç®±ï¼Œæ¯”è¾ƒåŸºæœ¬ç±»å‹&lt;/p&gt;
&lt;p&gt;æ¯”è¾ƒæ—¶æœ‰ç®—æœ¯è¿ç®—ï¼Œè‡ªåŠ¨æ‹†ç®±ï¼Œè¿ç®—ï¼Œæ¯”è¾ƒæ•°å€¼&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;equalsï¼šçœ‹å…·ä½“ç±»å‹çš„equalsæ–¹æ³•ï¼Œä¸€èˆ¬å…ˆæ¯”è¾ƒç±»å‹ï¼Œç±»å‹ä¸ä¸€æ ·ç›´æ¥è¿”å›falseï¼Œç±»å‹ä¸€æ ·å†æ¯”è¾ƒæ•°å€¼&lt;/p&gt;
&lt;p&gt;æ¯”è¾ƒæ—¶ä¼ å…¥åŸºæœ¬ç±»å‹ï¼Œä¼šè¿›è¡Œè£…ç®±ï¼Œä¹‹åè¿›è¡Œequalsæ¯”è¾ƒ&lt;/p&gt;
&lt;p&gt;æ¯”è¾ƒæ—¶æœ‰ç®—æœ¯è¿ç®—ï¼Œè‡ªåŠ¨æ‹†ç®±ï¼Œè¿ç®—ï¼Œä¹‹åæ ¹æ®è¿ç®—å®Œåçš„ç±»å‹å†è£…ç®±ï¼ˆå¯èƒ½ä¼šå‘ä¸Šè½¬å‹ï¼‰ï¼Œä¹‹åå†è¿›è¡Œequalsæ¯”è¾ƒ&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;è¿ç®—ä¸è½¬å‹&#34;&gt;è¿ç®—ä¸è½¬å‹&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;ä»ä½ä½ç±»å‹åˆ°é«˜ä½ç±»å‹è‡ªåŠ¨è½¬æ¢ï¼›ä»é«˜ä½ç±»å‹åˆ°ä½ä½ç±»å‹éœ€è¦å¼ºåˆ¶ç±»å‹è½¬æ¢&lt;/li&gt;
&lt;li&gt;ç®—æœ¯è¿ç®—ä¸­ï¼ŒåŸºæœ¬å°±æ˜¯å…ˆè½¬æ¢ä¸ºé«˜ä½æ•°æ®ç±»å‹ï¼Œå†å‚åŠ è¿ç®—ï¼Œç»“æœä¹Ÿæ˜¯æœ€é«˜ä½çš„æ•°æ®ç±»å‹&lt;/li&gt;
&lt;li&gt;shortã€byteã€charè®¡ç®—æ—¶éƒ½ä¼šæå‡ä¸ºint&lt;/li&gt;
&lt;li&gt;é‡‡ç”¨ +=ã€*= ç­‰ç¼©ç•¥å½¢å¼çš„è¿ç®—ç¬¦ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å¼ºåˆ¶å°†è¿ç®—ç»“æœè½¬æ¢ä¸ºç›®æ ‡å˜é‡çš„ç±»å‹&lt;/li&gt;
&lt;li&gt;å½“è¿ç®—ç¬¦ä¸ºè‡ªåŠ¨é€’å¢è¿ç®—ç¬¦ï¼ˆ++ï¼‰æˆ–è‡ªåŠ¨é€’å‡è¿ç®—ç¬¦ï¼ˆ&amp;ndash;ï¼‰æ—¶ï¼Œå¦‚æœæ“ä½œæ•°ä¸º byteï¼Œshort æˆ– charç±»å‹ä¸å‘ç”Ÿæ”¹å˜&lt;/li&gt;
&lt;li&gt;è¢«finalä¿®é¥°çš„å˜é‡ä¸ä¼šè‡ªåŠ¨æ”¹å˜ç±»å‹ï¼Œå½“2ä¸ªfinalä¿®é¥°ç›¸æ“ä½œæ—¶ï¼Œç»“æœä¼šæ ¹æ®å·¦è¾¹å˜é‡çš„ç±»å‹è‡ªåŠ¨è½¬åŒ–&lt;/li&gt;
&lt;li&gt;ä¸‰å…ƒè¿ç®—ç¬¦ï¼Ÿï¼Œï¼šä¸¤è¾¹æ˜¯åŸºæœ¬ç±»å‹ä¼šåšè‡ªåŠ¨ç±»å‹æå‡&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;a&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;127&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;b&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;127&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt; 
&lt;span class=&#34;kd&#34;&gt;final&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;c&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;127&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;a&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;a&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;//è¿™ç§å†™æ³•æ˜¯å¯ä»¥çš„ï¼Œä¼šå˜æˆ a = (byte) (a+b) 
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;è€Œ&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;a&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;a&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ï¼›&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;a&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;a&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ï¼›&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;åˆ™ä¼šå› ä¸ºæ²¡æœ‰ç±»å‹è½¬åŒ–è€Œå‡ºé”™&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ï¼Œ&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;intæ— æ³•è½¬æˆbyte&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;d&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;a&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// ä¼šå‡ºé”™ï¼Œaåœ¨è¿ç®—æ—¶ä¸ºè‡ªåŠ¨æå‡ä¸ºint
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;å¦‚æœæ˜¯finalä¿®é¥°&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ã€&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ï¼Œ&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;é‚£ä¹ˆbyte&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;c&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;a&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;b&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;å°±ä¸ä¼šç¼–è¯‘é”™è¯¯&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h1 id=&#34;ä¸‰string&#34;&gt;ä¸‰ã€String&lt;/h1&gt;
&lt;h2 id=&#34;1åŸºæœ¬&#34;&gt;1.åŸºæœ¬&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;åº•å±‚ï¼šprivate final char value[];&lt;/p&gt;
&lt;p&gt;valueæ•°ç»„è¢«finalä¿®é¥°ï¼Œå› æ­¤å½“å®ƒåˆå§‹åŒ–ä¹‹åå°±ä¸èƒ½å†å¼•ç”¨å…¶å®ƒæ•°ç»„&lt;/p&gt;
&lt;p&gt;String å†…éƒ¨æ²¡æœ‰æ”¹å˜ value æ•°ç»„çš„æ–¹æ³•ï¼Œå› æ­¤å¯ä»¥ä¿è¯ String ä¸å¯å˜&lt;/p&gt;
&lt;p&gt;Stringç±»çš„æ–¹æ³•éƒ½ä¸æ˜¯åœ¨åŸæ¥çš„å­—ç¬¦ä¸²ä¸Šè¿›è¡Œæ“ä½œï¼Œè€Œæ˜¯é‡æ–°ç”Ÿæˆæ–°çš„å­—ç¬¦æ•°ç»„&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç±»æœ¬èº«è¢« final ä¿®é¥°ï¼Œä½¿å®ƒä¸å¯è¢«ç»§æ‰¿&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Stringç±»çš„ â€œ+&amp;quot;  æœ¬è´¨æ˜¯ä½¿ç”¨StringBuilderçš„appendæ–¹æ³•ï¼Œæœ€ç»ˆè¿”å›newçš„string&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;JDK9ä¹‹å‰åº•å±‚ä½¿ç”¨charæ•°ç»„ï¼ŒJDK9åº•å±‚æ”¹ä¸ºä½¿ç”¨byteæ•°ç»„+coderæ ‡è¯†ç¬¦ï¼Œä¸»è¦æ˜¯å› ä¸ºæœ‰äº›å­—ç¬¦é›†å¹¶ä¸éœ€è¦ä½¿ç”¨åˆ°2ä¸ªå­—èŠ‚çš„charï¼Œä¸éœ€è¦ç”¨åˆ°2ä¸ªå­—èŠ‚çš„char&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;2ä¸å¯å˜çš„å¥½å¤„&#34;&gt;2.ä¸å¯å˜çš„å¥½å¤„&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å¯ä»¥ç¼“å­˜ hash å€¼&lt;/p&gt;
&lt;p&gt;å› ä¸º String çš„ hash å€¼ç»å¸¸è¢«ä½¿ç”¨ï¼Œä¾‹å¦‚ String ç”¨åš HashMap çš„ keyã€‚ä¸å¯å˜çš„ç‰¹æ€§å¯ä»¥ä½¿å¾— hash å€¼ä¹Ÿä¸å¯å˜ï¼Œå› æ­¤åªéœ€è¦è¿›è¡Œä¸€æ¬¡è®¡ç®—ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;String Pool çš„éœ€è¦&lt;/p&gt;
&lt;p&gt;å¦‚æœä¸€ä¸ª String å¯¹è±¡å·²ç»è¢«åˆ›å»ºè¿‡äº†ï¼Œé‚£ä¹ˆå°±ä¼šä» String Pool ä¸­å–å¾—å¼•ç”¨ã€‚åªæœ‰ String æ˜¯ä¸å¯å˜çš„ï¼Œæ‰å¯èƒ½ä½¿ç”¨ String Poolã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å®‰å…¨&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;String ç»å¸¸ä½œä¸ºå‚æ•°ï¼ŒString ä¸å¯å˜æ€§å¯ä»¥ä¿è¯å‚æ•°ä¸å¯å˜ã€‚ä¾‹å¦‚åœ¨ä½œä¸ºç½‘ç»œè¿æ¥å‚æ•°çš„æƒ…å†µä¸‹å¦‚æœ String æ˜¯å¯å˜çš„ï¼Œé‚£ä¹ˆåœ¨ç½‘ç»œè¿æ¥è¿‡ç¨‹ä¸­ï¼ŒString è¢«æ”¹å˜ï¼Œæ”¹å˜ String å¯¹è±¡çš„é‚£ä¸€æ–¹ä»¥ä¸ºç°åœ¨è¿æ¥çš„æ˜¯å…¶å®ƒä¸»æœºï¼Œè€Œå®é™…æƒ…å†µå´ä¸ä¸€å®šæ˜¯ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¸å¯å˜å¾—ç‰¹æ€§ä½¿å¾—å®ƒå¤©ç”Ÿæ˜¯çº¿ç¨‹å®‰å…¨çš„&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;3å­—ç¬¦ä¸²å¸¸é‡æ± string-pool&#34;&gt;3.å­—ç¬¦ä¸²å¸¸é‡æ± ï¼ˆString Poolï¼‰&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;ä¸€èˆ¬ç”¨äºç¼“å­˜å­—ç¬¦ä¸²å­—é¢é‡å’Œç¬¦å·å¼•ç”¨&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Stringçš„internæ–¹æ³•å¯ä»¥æŠŠç›¸åº”çš„å­—ç¬¦ä¸²ç¼“å­˜èµ·æ¥ï¼Œä¿å­˜åœ¨æ°¸ä¹…ä»£ä¸­ï¼Œä½†æ˜¯ä¸€èˆ¬æ°¸ä¹…ä»£ç©ºé—´æœ‰é™ï¼Œä¸”åªæœ‰FullGCæ‰ä¼šè¿›è¡Œåƒåœ¾å›æ”¶ï¼ˆJDK8åç§»æ°¸ä¹…ä»£ç§»åˆ°äº†å…ƒç©ºé—´ä¸­ï¼Œé»˜è®¤å¤§å°ä¹Ÿå¢åŠ äº†ï¼‰ï¼Œæ‰€ä»¥éœ€è¦è°¨æ…ä½¿ç”¨è¯¥æ–¹æ³•&lt;/p&gt;
&lt;h2 id=&#34;4stringbufferå’Œstringbuilder&#34;&gt;4.StringBufferå’ŒStringBuilder&lt;/h2&gt;
&lt;p&gt;StringBufferæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå› ä¸ºå¤§éƒ¨åˆ†æ–¹æ³•éƒ½ç”¨äº†synchronizedå…³é”®å­—ä¿®é¥°ï¼Œè€ŒStringBuilderæ²¡æœ‰ï¼Œæ‰€ä»¥æ˜¯éçº¿ç¨‹å®‰å…¨çš„ï¼Œä¸¤è€…åœ¨åŠŸèƒ½ä¸Šæ˜¯ç­‰ä»·çš„ï¼Œæ€§èƒ½ä¸Šï¼ŒStringBuilderæ¯”StringBufferå¥½ã€‚&lt;/p&gt;
&lt;p&gt;3å’Œ4å…·ä½“å‚è€ƒ&lt;a class=&#34;link&#34; href=&#34;https://www.cnblogs.com/xiaoxi/p/6036701.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;æ·±å…¥ç†è§£Javaä¸­çš„String&lt;/a&gt;ï¼Œè¿™ç¯‡æ–‡ç« å†™å¾—ç›¸å½“è¯¦ç»†äº†&lt;/p&gt;
&lt;h1 id=&#34;å››equalshashcodeclone&#34;&gt;å››ã€equals()ã€hashCode()ã€clone()&lt;/h1&gt;
&lt;h2 id=&#34;equals&#34;&gt;equals()&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨ä¸é‡å†™çš„æƒ…å†µä¸‹ï¼ŒObjectç±»ä¸‹çš„ equals() æ–¹æ³•æ¯”è¾ƒçš„æ˜¯ä¸¤ä¸ªå¯¹è±¡çš„å¼•ç”¨ï¼Œå³åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡æ˜¯å¦æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œæ­¤æ—¶ç­‰ä»·äº ==&lt;/li&gt;
&lt;li&gt;é‡å†™çš„æƒ…å†µä¸‹ï¼Œçœ‹å…·ä½“ç±»é‡å†™åçš„equalsæ–¹æ³•ï¼ŒåƒStringç±»çš„ equals æ–¹æ³•æ˜¯å…ˆåˆ¤æ–­æ˜¯å¦æ˜¯Stringç±»å‹ï¼Œå†æ¯”è¾ƒå­—ç¬¦çš„å†…å®¹&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;hashcode&#34;&gt;hashCode()&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ä½œç”¨æ˜¯è¿”å›å¯¹è±¡çš„intç±»å‹çš„å“ˆå¸Œç ï¼Œä¸€èˆ¬ç”¨äºå½“ç´¢å¼•ï¼Œä¾‹å¦‚ï¼Œåœ¨HashMapé‡Œï¼ŒåŠ å…¥ä¸€å¯¹é”®å€¼å¯¹ï¼ŒHashMapä¼šå…ˆè®¡ç®—keyçš„å“ˆå¸Œå€¼ï¼Œå–æ¨¡ï¼Œæ‰¾åˆ°å¯¹åº”æ¡¶çš„ä¸‹æ ‡&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;hashCode()ä¸€èˆ¬ä¼šå’Œequals()æœ‰è”ç³»ï¼Œä¾‹å¦‚ï¼ŒHashMapåœ¨æ‰¾åˆ°è¦åŠ å…¥çš„é”®å€¼å¯¹æ‰€åœ¨å¯¹åº”çš„æ¡¶ï¼Œæ¡¶å†…çš„é”®å€¼å¯¹çš„å“ˆå¸Œç è‚¯å®šæ˜¯ä¸€æ ·ï¼Œä¸ºäº†åˆ¤æ–­è¯¥é”®å€¼å¯¹æ˜¯å¦é‡å¤å‡ºç°ï¼Œå°†ä½¿ç”¨keyçš„equalsè¿›è¡Œæ¯”è¾ƒ&lt;/p&gt;
&lt;p&gt;ä¸ºä»€ä¹ˆæœ‰äº†equals()è¿˜è¦hashCodeæ–¹æ³•ï¼Œæœ‰äº†hashCodeæ–¹æ³•è¿˜è¦equalsæ–¹æ³•ï¼Ÿ&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å› ä¸ºequalsæ–¹æ³•çš„å®ç°æ¯”è¾ƒå¤æ‚ï¼Œæ•ˆç‡è¾ƒä½ï¼ŒhashCodeåªéœ€è®¡ç®—hashå€¼å°±èƒ½è¿›è¡Œå¯¹æ¯”ï¼Œæ•ˆç‡é«˜&lt;/li&gt;
&lt;li&gt;hashCodeæ–¹æ³•ä¸ä¸€å®šå¯é ï¼Œä¸åŒå¯¹è±¡ç”Ÿæˆçš„hashCodeå¯èƒ½ä¸€æ ·ï¼Œæ‰€ä»¥éœ€è¦equalsæ–¹æ³•&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;hashCode() ä¸ equals() çš„ç›¸å…³è§„å®š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å¦‚æœä¸¤ä¸ªå¯¹è±¡ç›¸ç­‰ï¼Œåˆ™hashcodeä¸€å®šä¹Ÿæ˜¯ç›¸åŒçš„&lt;/li&gt;
&lt;li&gt;ä¸¤ä¸ªå¯¹è±¡ç›¸ç­‰,å¯¹ä¸¤ä¸ªå¯¹è±¡åˆ†åˆ«è°ƒç”¨equalsæ–¹æ³•éƒ½è¿”å›true&lt;/li&gt;
&lt;li&gt;ä¸¤ä¸ªå¯¹è±¡æœ‰ç›¸åŒçš„hashcodeå€¼ï¼Œå®ƒä»¬ä¹Ÿä¸ä¸€å®šæ˜¯ç›¸ç­‰çš„&lt;/li&gt;
&lt;li&gt;å› æ­¤ï¼Œequals æ–¹æ³•è¢«è¦†ç›–è¿‡ï¼Œåˆ™ hashCode æ–¹æ³•ä¹Ÿå¿…é¡»è¢«è¦†ç›–&lt;/li&gt;
&lt;li&gt;hashCode() çš„é»˜è®¤è¡Œä¸ºæ˜¯å¯¹å †ä¸Šçš„å¯¹è±¡äº§ç”Ÿç‹¬ç‰¹å€¼ã€‚å¦‚æœæ²¡æœ‰é‡å†™ hashCode()ï¼Œåˆ™è¯¥ class çš„ä¸¤ä¸ªå¯¹è±¡æ— è®ºå¦‚ä½•éƒ½ä¸ä¼šç›¸ç­‰ï¼ˆå³ä½¿è¿™ä¸¤ä¸ªå¯¹è±¡æŒ‡å‘ç›¸åŒçš„æ•°æ®ï¼‰&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;clone&#34;&gt;clone()&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;cloneåˆ†ä¸ºæ·±æ‹·è´å’Œæµ…æ‹·è´&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;æµ…æ‹·è´ï¼šå¯¹è±¡çš„å±æ€§æ˜¯åŸºæœ¬ç±»å‹çš„ï¼Œç›´æ¥å¤åˆ¶ä¸€ä»½ï¼›å±æ€§æ˜¯å¼•ç”¨ç±»å‹çš„ï¼ˆå¦‚æ•°ç»„ã€å¯¹è±¡ï¼‰ï¼Œå¤åˆ¶å¼•ç”¨ï¼Œä¹Ÿå°±æ˜¯æ‹·è´è¿‡åçš„ä¸¤ä¸ªå¯¹è±¡é‡Œå¼•ç”¨ç±»å‹çš„å±æ€§ï¼Œéƒ½æ˜¯æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡&lt;/p&gt;
&lt;p&gt;Objectç±»é‡Œçš„cloneæ–¹æ³•å°±æ˜¯æµ…æ‹·è´&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ·±æ‹·è´ï¼šå¯¹è±¡é‡Œçš„å±æ€§æ— è®ºæ˜¯åŸºæœ¬ç±»å‹è¿˜æ˜¯å¼•ç”¨ç±»å‹ï¼Œéƒ½æ˜¯é‡æ–°å¤åˆ¶ä¸€ä»½ï¼Œå³ä¼šä¸ºæ‹·è´å¯¹è±¡é‡Œçš„å¼•ç”¨å±æ€§é‡æ–°å¼€è¾Ÿå†…å­˜ç©ºé—´ï¼Œä¸å†æ˜¯å’Œè¢«æ‹·è´å¯¹è±¡æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Objecté‡Œçš„clone()æ–¹æ³•è¢«protected ä¿®é¥°ï¼Œä¸€èˆ¬ç±»å¦‚æœä¸é‡å†™çš„è¯æ˜¯è°ƒç”¨ä¸äº†çš„ï¼Œå¦‚æœè¦é‡å†™çš„è¯ï¼Œéœ€è¦å®ç°Cloneableæ¥å£ï¼Œä¸ç„¶ä¼šæŠ›å‡ºCloneNotSupportedExceptionå¼‚å¸¸ï¼Œä¹‹åå¯ä»¥é€šè¿‡super.clone()è°ƒç”¨Objectç±»ä¸­çš„åŸcloneæ–¹æ³•&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;å…³é”®å­—&#34;&gt;å…³é”®å­—&lt;/h1&gt;
&lt;h2 id=&#34;finalå’Œstatic&#34;&gt;finalå’Œstatic&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;finalå…³é”®å­—ä¸»è¦ç”¨åœ¨ä¸‰ä¸ªåœ°æ–¹ï¼šå˜é‡ã€æ–¹æ³•ã€ç±»ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;ol&gt;
&lt;li&gt;ä¿®é¥°å˜é‡ï¼Œå¦‚æœæ˜¯åŸºæœ¬æ•°æ®ç±»å‹çš„å˜é‡ï¼Œåˆ™å…¶æ•°å€¼ä¸€æ—¦åœ¨åˆå§‹åŒ–ä¹‹åä¾¿ä¸èƒ½æ›´æ”¹ï¼›å¦‚æœæ˜¯å¼•ç”¨ç±»å‹çš„å˜é‡ï¼Œåˆ™åœ¨å¯¹å…¶åˆå§‹åŒ–ä¹‹åä¾¿ä¸èƒ½å†è®©å…¶æŒ‡å‘å¦ä¸€ä¸ªå¯¹è±¡ï¼Œfinalä¿®é¥°çš„å˜é‡ä¸€å®šè¦åˆå§‹åŒ–ï¼Œè¦ä¸å°±ç›´æ¥åˆå§‹åŒ–ï¼Œä¸ç„¶å°±éœ€è¦åœ¨æ¯ä¸ªæ„é€ æ–¹æ³•é‡Œåˆå§‹åŒ–ï¼Œæˆ–è€…åœ¨ä»£ç å—é‡Œåˆå§‹åŒ–ï¼Œä»£ç å—é‡Œçš„åˆå§‹åŒ–å’Œæ„é€ æ–¹æ³•é‡Œçš„åˆå§‹åŒ–åªèƒ½äºŒé€‰ä¸€ï¼Œå¦åˆ™ä¼šé€ æˆèµ‹å€¼é‡å¤&lt;/li&gt;
&lt;li&gt;ä¿®é¥°ç±»ï¼Œè¡¨æ˜è¿™ä¸ªç±»ä¸èƒ½è¢«ç»§æ‰¿ï¼Œfinalç±»ä¸­çš„æ‰€æœ‰æˆå‘˜æ–¹æ³•éƒ½ä¼šè¢«éšå¼åœ°æŒ‡å®šä¸ºfinalæ–¹æ³•&lt;/li&gt;
&lt;li&gt;ä¿®é¥°æ–¹æ³•ï¼Œè¡¨æ˜è¯¥æ–¹æ³•ä¸èƒ½è¢«å­ç±»é‡å†™&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;å£°æ˜ä¸ºstaticæˆå‘˜ä¸èƒ½è¢«åºåˆ—åŒ–&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;instanceof&#34;&gt;instanceof&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;æ˜¯å…³é”®å­—ï¼Œä¹Ÿæ˜¯è¿ç®—ç¬¦&lt;/li&gt;
&lt;li&gt;ç”¨äºåˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦æ˜¯ ä¸€ä¸ªç±»çš„å®ä¾‹ï¼Œä¸€ä¸ªç±»çš„å­ç±»ï¼Œä¸€ä¸ªæ¥å£çš„å®ç°ç±»&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;æŠ½è±¡ç±»å’Œæ¥å£&#34;&gt;æŠ½è±¡ç±»å’Œæ¥å£&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;æŠ½è±¡ç±»å¯ä»¥æœ‰æ„é€ æ–¹æ³•ï¼ˆä½†ä¸èƒ½å®ä¾‹åŒ–ï¼‰ï¼Œæ¥å£æ²¡æœ‰&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æŠ½è±¡ç±»å¯ä»¥æœ‰æ™®é€šæˆå‘˜å˜é‡ã€é™æ€å˜é‡æˆ–å¸¸é‡ï¼Œè®¿é—®ç±»å‹ä»»æ„ï¼Œæ¥å£åªæœ‰é™æ€å¸¸é‡ï¼Œä¸”é»˜è®¤è¢«public static finalä¿®é¥°&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æŠ½è±¡ç±»å¯ä»¥åŒ…å«éæŠ½è±¡çš„æ™®é€šæ–¹æ³•ï¼Œæ¥å£ä¸­çš„æ–¹æ³•å¿…é¡»æ˜¯æŠ½è±¡çš„ï¼Œä¸èƒ½æœ‰éæŠ½è±¡æ–¹æ³•&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æŠ½è±¡ç±»ä¸­çš„&lt;strong&gt;æŠ½è±¡æ–¹æ³•è®¿é—®ç±»å‹&lt;/strong&gt;å¯ä»¥æ˜¯&lt;strong&gt;publicã€protectedå’Œä¸å†™&lt;/strong&gt;ï¼Œæ¥å£ä¸­çš„æ–¹æ³•é»˜è®¤æ˜¯public abstract&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æŠ½è±¡ç±»ä¸­å¯ä»¥åŒ…å«é™æ€æ–¹æ³•(å¯ä»¥è°ƒç”¨)ï¼Œæ¥å£ä¸è¡Œ&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;JDK1.8ä¹‹å‰æ¥å£ä¸­çš„æ–¹æ³•ä¸èƒ½æœ‰æ–¹æ³•ä½“ï¼Œä¸”ä¸èƒ½è¢«defaultä¿®é¥°ï¼Œä½†æ˜¯å¯ä»¥ä¸å†™è®¿é—®ä¿®é¥°ç¬¦ï¼Œ&lt;/p&gt;
&lt;p&gt;1.8ä¹‹åï¼ˆåŒ…å«1.8ï¼‰æ¥å£ä¸­çš„æ–¹æ³•å¯ä»¥æœ‰æ–¹æ³•ä½“ï¼Œè¡¨ç¤ºé»˜è®¤æ–¹æ³•ä½“ï¼Œä½†éœ€è¦ç”¨defaultä¿®é¥°&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;JDK1.8ä¹‹å‰æ¥å£ä¸­çš„æ–¹æ³•ä¸èƒ½ç”¨staticä¿®é¥°ï¼Œ1.8ä¹‹åï¼ˆåŒ…å«1.8ï¼‰æ‰å¯ä»¥ä½¿ç”¨staticä¿®é¥°ï¼Œæ‰å¯ä»¥é€šè¿‡æ¥å£åè°ƒç”¨é™æ€æ–¹æ³•&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;ç»§æ‰¿&#34;&gt;ç»§æ‰¿&lt;/h1&gt;
&lt;h2 id=&#34;é‡å†™ä¸é‡è½½&#34;&gt;é‡å†™ä¸é‡è½½&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;é‡å†™ï¼ˆOverrideï¼‰&lt;/p&gt;
&lt;p&gt;ç»§æ‰¿ä¸­ï¼Œå­ç±»é‡å†™çˆ¶ç±»æ–¹æ³•&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å­ç±»æ–¹æ³•çš„&lt;strong&gt;è®¿é—®æƒé™&lt;/strong&gt;å¿…é¡»&lt;strong&gt;å¤§äºç­‰äº&lt;/strong&gt;çˆ¶ç±»æ–¹æ³•ï¼›&lt;/li&gt;
&lt;li&gt;å­ç±»æ–¹æ³•çš„è¿”å›ç±»å‹å¿…é¡»æ˜¯&lt;strong&gt;çˆ¶ç±»æ–¹æ³•è¿”å›ç±»å‹æˆ–ä¸ºå…¶å­ç±»å‹&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;å­ç±»æŠ›å‡ºçš„&lt;strong&gt;å¼‚å¸¸&lt;/strong&gt;æ¯”çˆ¶ç±»çš„&lt;strong&gt;å°æˆ–è€…ç›¸ç­‰&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å…³äºé™æ€æ–¹æ³•é‡å†™&lt;/p&gt;
&lt;p&gt;staticæ–¹æ³•ä¸èƒ½è¢«å­ç±»é‡å†™ï¼Œå­ç±»å¦‚æœå®šä¹‰äº†å’Œçˆ¶ç±»å®Œå…¨ç›¸åŒçš„staticæ–¹æ³•ï¼ŒSon.staticmethod()æˆ–new Son().staticmethod()éƒ½æ˜¯è°ƒç”¨å­ç±»çš„ï¼Œå¦‚æœæ˜¯Father.staticmethod()æˆ–Father f = new Son(); f.staticmethod()è°ƒç”¨çš„æ˜¯çˆ¶ç±»çš„&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;é‡è½½ï¼ˆOverloadï¼‰&lt;/p&gt;
&lt;p&gt;å­˜åœ¨äºåŒä¸€ä¸ªç±»ä¸­ï¼ŒæŒ‡ä¸€ä¸ªæ–¹æ³•ä¸å·²ç»å­˜åœ¨çš„æ–¹æ³•åç§°ä¸Šç›¸åŒï¼Œä½†æ˜¯&lt;strong&gt;å‚æ•°ç±»å‹ã€ä¸ªæ•°ã€é¡ºåº&lt;/strong&gt;è‡³å°‘æœ‰ä¸€ä¸ªä¸åŒ&lt;/p&gt;
&lt;p&gt;æ³¨æ„ï¼Œè¿”å›å€¼ä¸åŒï¼Œå…¶å®ƒéƒ½ç›¸åŒä¸ç®—æ˜¯é‡è½½ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;åˆå§‹åŒ–é¡ºåº&#34;&gt;åˆå§‹åŒ–é¡ºåº&lt;/h2&gt;
&lt;p&gt;ï¼ˆæ‹¬å·å†…çš„æŒ‰å‡ºç°å…ˆåè¿›è¡Œåˆå§‹åŒ–ï¼‰&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;çˆ¶ç±»ï¼ˆé™æ€å˜é‡ã€é™æ€ä»£ç å—ï¼‰&lt;/li&gt;
&lt;li&gt;å­ç±»ï¼ˆé™æ€å˜é‡ã€é™æ€ä»£ç å—ï¼‰&lt;/li&gt;
&lt;li&gt;çˆ¶ç±»ï¼ˆå®ä¾‹å˜é‡ã€æ™®é€šä»£ç å—ï¼‰&lt;/li&gt;
&lt;li&gt;çˆ¶ç±»ï¼ˆæ„é€ å‡½æ•°ï¼‰&lt;/li&gt;
&lt;li&gt;å­ç±»ï¼ˆå®ä¾‹å˜é‡ã€æ™®é€šä»£ç å—ï¼‰&lt;/li&gt;
&lt;li&gt;å­ç±»ï¼ˆæ„é€ å‡½æ•°ï¼‰&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;åœ¨æ„é€ æ–¹æ³•ä¸­ï¼Œthis()å’Œsuper()è°ƒç”¨æ„é€ æ–¹æ³•æ—¶ï¼Œåªèƒ½æ”¾åœ¨ç¬¬ä¸€è¡Œï¼Œä¸”ä¸èƒ½åŒæ—¶å‡ºç°&lt;/p&gt;
&lt;h1 id=&#34;å†…éƒ¨ç±»&#34;&gt;å†…éƒ¨ç±»&lt;/h1&gt;
&lt;h2 id=&#34;åŸºç¡€&#34;&gt;åŸºç¡€&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å†…éƒ¨ç±»æ˜¯æŒ‡åœ¨ä¸€ä¸ªå¤–éƒ¨ç±»çš„å†…éƒ¨å†å®šä¹‰ä¸€ä¸ªç±»ã€‚å†…éƒ¨ç±»ä½œä¸ºå¤–éƒ¨ç±»çš„ä¸€ä¸ªæˆå‘˜ï¼Œå¹¶ä¸”ä¾é™„äºå¤–éƒ¨ç±»è€Œå­˜åœ¨çš„ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å†…éƒ¨ç±»å¯ä¸ºé™æ€ï¼Œå¯ç”¨protectedå’Œprivateä¿®é¥°ï¼ˆè€Œå¤–éƒ¨ç±»åªèƒ½ä½¿ç”¨publicå’Œç¼ºçœçš„åŒ…è®¿é—®æƒé™ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å†…éƒ¨ç±»ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç±»ï¼šæˆå‘˜å†…éƒ¨ç±»ã€å±€éƒ¨å†…éƒ¨ç±»ã€é™æ€å†…éƒ¨ç±»ã€åŒ¿åå†…éƒ¨ç±»&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;æˆå‘˜å†…éƒ¨ç±»&#34;&gt;æˆå‘˜å†…éƒ¨ç±»&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;åœ¨å¤–éƒ¨ç±»é‡Œæƒ³è°ƒç”¨å†…éƒ¨ç±»é‡Œçš„æ–¹æ³•å’Œå˜é‡ï¼Œåªèƒ½é€šè¿‡newçš„å½¢å¼åˆ›å»ºå†…éƒ¨ç±»å®ä¾‹æ‰å¯ä»¥ä½¿ç”¨&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å†…éƒ¨ç±»è°ƒç”¨å¤–éƒ¨ç±»çš„æ–¹æ³•ï¼Œæ— è®ºé™æ€éé™æ€ï¼Œç›´æ¥è°ƒç”¨&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å†…éƒ¨ç±»é‡Œçš„æˆå‘˜å¯ä»¥å’Œå¤–éƒ¨ç±»çš„æˆå‘˜çš„åå­—ç›¸åŒï¼Œç›´æ¥ä½¿ç”¨çš„æ—¶å€™è°ƒç”¨çš„æ˜¯å†…éƒ¨çš„ï¼Œå†…éƒ¨ç±»è°ƒç”¨å¤–éƒ¨ç±»åŒåå˜é‡éœ€è¦åŠ ä¸Šå¤–éƒ¨ç±»åï¼Œå¦‚æœæ²¡æœ‰åŒåå˜é‡å°±å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œä¸éœ€è¦åŠ å¤–éƒ¨ç±»å&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åœ¨å…¶ä»–åœ°æ–¹æƒ³è¦è°ƒç”¨æœ‰å†…éƒ¨ç±»çš„ç±»çš„å†…éƒ¨ç±»æ–¹æ³•ï¼Œéœ€è¦å®ä¾‹åŒ–ä¸€ä¸ªå¤–éƒ¨ç±»ï¼Œå†ä½¿ç”¨å¤–éƒ¨ç±»çš„å®ä¾‹å˜é‡å®ä¾‹åŒ–å†…éƒ¨ç±»&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¯ä»¥è¢«abstarctä¿®é¥°ï¼Œä½†æ— æ³•å®ä¾‹åŒ–&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¸èƒ½æœ‰é™æ€æˆå‘˜ã€æ–¹æ³•&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;n&#34;&gt;Outer&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;out&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Outer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;Outer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;Inner&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;outin&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;out&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Inner&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;outin&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;inner_f1&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;å±€éƒ¨å†…éƒ¨ç±»&#34;&gt;å±€éƒ¨å†…éƒ¨ç±»&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;å±€éƒ¨å†…éƒ¨ç±»è°ƒç”¨å¤–éƒ¨ç±»çš„æ–¹æ³•ï¼Œç›´æ¥è°ƒç”¨&lt;/li&gt;
&lt;li&gt;å¤–éƒ¨ç±»è°ƒç”¨å†…éƒ¨ç±»æ–¹æ³•ï¼Œåˆå§‹åŒ–å¤–éƒ¨ç±»å®ä¾‹ï¼Œè°ƒç”¨æœ‰å±€éƒ¨å†…éƒ¨ç±»çš„æ–¹æ³•&lt;/li&gt;
&lt;li&gt;å±€éƒ¨å†…éƒ¨ç±» å¯ä»¥çœ‹æˆæ˜¯ æ–¹æ³•é‡Œçš„æˆå‘˜å˜é‡ï¼Œåªèƒ½åœ¨è¯¥æ–¹æ³•é‡Œå®ä¾‹åŒ–&lt;/li&gt;
&lt;li&gt;å±€éƒ¨å†…éƒ¨ç±» å¯¹äºåŒåå˜é‡çš„è®¿é—®æ–¹å¼åŒæˆå‘˜å†…éƒ¨ç±»&lt;/li&gt;
&lt;li&gt;æ–¹æ³•å¤–çš„å¤–éƒ¨ç±»çš„æˆå‘˜å˜é‡å¯ä»¥ç›´æ¥è®¿é—®ï¼Œä½†åªèƒ½è®¿é—®å†…éƒ¨ç±»æ‰€åœ¨æ–¹æ³•é‡Œçš„finalä¿®é¥°çš„å˜é‡&lt;/li&gt;
&lt;li&gt;ä¸èƒ½è¢«staticè¿˜æœ‰è®¿é—®æ§åˆ¶ç¬¦ä¿®é¥°ï¼Œå¯ä»¥è¢«abstractã€finalä¿®é¥°&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;é™æ€å†…éƒ¨ç±»&#34;&gt;é™æ€å†…éƒ¨ç±»&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;é™æ€å†…éƒ¨ç±»ä¸­å¯ä»¥å®šä¹‰é™æ€æˆ–è€…éé™æ€çš„æˆå‘˜æˆ–æ–¹æ³•&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;é™æ€å†…éƒ¨ç±»åªèƒ½è®¿é—®å¤–éƒ¨ç±»çš„é™æ€æˆå‘˜ï¼Œä¸èƒ½è®¿é—®å¤–éƒ¨ç±»çš„éé™æ€çš„æˆå‘˜&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¤–éƒ¨ç±»æ–¹æ³•è®¿é—®å†…éƒ¨ç±»é™æ€æˆå‘˜ï¼Œç›´æ¥ å†…éƒ¨ç±»å.é™æ€æˆå‘˜å˜é‡&lt;/p&gt;
&lt;p&gt;è®¿é—®å†…éƒ¨éé™æ€æˆå‘˜ï¼Œå®ä¾‹åŒ–å†…éƒ¨ç±»ï¼Œåœ¨è°ƒç”¨&lt;/p&gt;
&lt;p&gt;è¯´ç™½äº†ï¼Œé™æ€å±äºæ•´ä¸ªç±»çš„ï¼Œä¸å±äºæŸä¸ªå¯¹è±¡çš„ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œä¸ä¾èµ–å¤–éƒ¨ç±»ï¼Œå¯ä»¥ç›´æ¥è°ƒç”¨ï¼Œæˆ–è€…å®ä¾‹åŒ–å¤–éƒ¨ç±»é‡Œçš„é™æ€ç±»&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;n&#34;&gt;Outer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;Inner&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;outin&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Outer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;Inner&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;outin&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;staticInner_f1&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;		&lt;span class=&#34;c1&#34;&gt;// æˆ–è€…ç›´æ¥è°ƒç”¨ Outer.Inner.staticInner_f1()
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;outin&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;inner_f1&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;			&lt;span class=&#34;c1&#34;&gt;// ä¸èƒ½ç›´æ¥ Outer.Inner.inner_f1()
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;System&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;out&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;outin&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;staticField&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;outin&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;field&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;// åŒç†åªèƒ½ Outer.Inner.staticField, ä¸èƒ½Outer.Inner.fieldï¼›
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¸å¯ä»¥åªå®ä¾‹åŒ–å¤–éƒ¨ç±»ï¼Œå†ä½¿ç”¨è¿™ä¸ªå®ä¾‹å»å®ä¾‹åŒ–å†…éƒ¨ç±»æˆ–è€…è°ƒç”¨å†…éƒ¨ç±»é‡Œçš„æˆå‘˜ï¼Œè¿™ç‚¹è·Ÿæˆå‘˜å†…éƒ¨ç±»æ˜¯ä¸ä¸€æ ·çš„&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;åŒ¿åå†…éƒ¨ç±»&#34;&gt;åŒ¿åå†…éƒ¨ç±»&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;åŒ¿åå†…éƒ¨ç±»ä¸èƒ½æœ‰æ„é€ æ–¹æ³•&lt;/li&gt;
&lt;li&gt;æ— æ³•è¢«è®¿é—®æ§åˆ¶ç¬¦ã€staticä¿®é¥°&lt;/li&gt;
&lt;li&gt;åŒ¿åå†…éƒ¨ç±»ä¸èƒ½å®šä¹‰ä»»ä½•é™æ€æˆå‘˜ã€æ–¹æ³•å’Œç±»&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åŒ¿åéƒ½æ²¡ç±»åäº†ï¼Œæ„é€ æ–¹æ³•ï¼Œé™æ€æˆå‘˜ä¹‹ç±»çš„æ²¡åŠæ³•è°ƒç”¨äº†&lt;/p&gt;
&lt;p&gt;å‚è€ƒ&lt;a class=&#34;link&#34; href=&#34;https://www.cnblogs.com/ITtangtang/p/3980460.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;æ·±å…¥ç†è§£javaå†…éƒ¨ç±»&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;åå°„å’Œå†…çœ&#34;&gt;åå°„å’Œå†…çœ&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;åå°„ï¼šå¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€è·å–ç±»ä¿¡æ¯æˆ–è€…åŠ¨æ€è°ƒç”¨ç±»æ–¹æ³•ï¼›JVMè¿è¡Œçš„æ—¶å€™ï¼Œè¯»å…¥ç±»çš„å­—èŠ‚ç åˆ° JVM ä¸­ï¼Œå¯¹è¯¥ç±»çš„å±æ€§ã€æ–¹æ³•ã€æ„é€ æ–¹æ³•è¿›è¡Œè·å–å’Œè°ƒç”¨&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç±»åŠ è½½ä¸€æ¬¡ä¹‹åä¼šåœ¨JVMä¸­ç¼“å­˜ï¼Œä½†æ˜¯å¦‚æœæ˜¯&lt;strong&gt;ä¸åŒçš„ç±»åŠ è½½å™¨&lt;/strong&gt;å»åŠ è½½&lt;strong&gt;åŒä¸€ä¸ªclass&lt;/strong&gt;åˆ™ä¼šå¤šæ¬¡åŠ è½½ã€‚&lt;/p&gt;
&lt;p&gt;ä¸¤ä¸ªç±»ç›¸ç­‰éœ€è¦ç±»æœ¬èº«ç›¸ç­‰ï¼Œå¹¶ä¸”ä½¿ç”¨åŒä¸€ä¸ªç±»åŠ è½½å™¨è¿›è¡ŒåŠ è½½ã€‚è¿™æ˜¯å› ä¸ºæ¯ä¸€ä¸ªç±»åŠ è½½å™¨éƒ½æ‹¥æœ‰ä¸€ä¸ªç‹¬ç«‹çš„ç±»åç§°ç©ºé—´ã€‚&lt;/p&gt;
&lt;p&gt;è¿™é‡Œçš„ç›¸ç­‰ï¼ŒåŒ…æ‹¬ç±»çš„ Class å¯¹è±¡çš„ equals() æ–¹æ³•ã€isAssignableFrom() æ–¹æ³•ã€isInstance() æ–¹æ³•çš„è¿”å›ç»“æœä¸º trueï¼Œä¹ŸåŒ…æ‹¬ä½¿ç”¨ instanceof å…³é”®å­—åšå¯¹è±¡æ‰€å±å…³ç³»åˆ¤å®šç»“æœä¸º trueã€‚&lt;/p&gt;
&lt;p&gt;åå°„æ…¢æ˜¯å› ä¸ºJavaæ˜¯é™æ€è¯­è¨€ï¼Œå¦‚æœåœ¨JVMè¿è¡Œæ—¶æ‰è¿›è¡ŒåŠ è½½ï¼Œè¿›è¡Œå‚æ•°å’Œæ–¹æ³•çš„è§£æï¼Œæ­¤æ—¶çš„JVMæ— æ³•å¯¹åå°„åŠ è½½çš„ç±»è¿›è¡Œä¼˜åŒ–ï¼Œè¿˜æœ‰å°±æ˜¯ç±»åŠ è½½éœ€è¦ç»è¿‡éªŒè¯ï¼Œåˆ¤æ–­æ˜¯å¦å¯¹JVMæœ‰å®³ï¼Œåå°„åŠ è½½éªŒè¯ä¼šæ¯”å¹³æ—¶åœ¨è£…è½½æœŸçš„æ—¶é—´é•¿ï¼Œä½†æ˜¯æ€»çš„æ¥è¯´å½±å“ä¸å¤§&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å†…çœï¼šé’ˆå¯¹JavaBeanï¼Œåªèƒ½å¯¹Beançš„å±æ€§è¿›è¡Œæ“ä½œï¼›åŠ è½½ç±»ï¼Œå¾—åˆ°å®ƒçš„å±æ€§ï¼Œå¯¹å±æ€§è¿›è¡Œget/setï¼Œæ˜¯å¯¹åå°„çš„ä¸€å±‚å°è£…&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;æšä¸¾&#34;&gt;æšä¸¾&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ä½¿ç”¨enumå®šä¹‰çš„æšä¸¾ç±»é»˜è®¤ç»§æ‰¿äº†java.lang.Enumï¼Œè€Œä¸æ˜¯ç»§æ‰¿Objectç±»&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æšä¸¾ç±»å¯ä»¥å®ç°ä¸€ä¸ªæˆ–å¤šä¸ªæ¥å£&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä½¿ç”¨enumå®šä¹‰ã€éæŠ½è±¡çš„æšä¸¾ç±»é»˜è®¤ä½¿ç”¨finalä¿®é¥°ï¼Œä¸å¯ä»¥è¢«ç»§æ‰¿ï¼Œå®šä¹‰çš„Enumç±»é»˜è®¤è¢«finalä¿®é¥°ï¼Œæ— æ³•è¢«å…¶ä»–ç±»ç»§æ‰¿&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æšä¸¾ç±»çš„æ‰€æœ‰å®ä¾‹éƒ½å¿…é¡»æ”¾åœ¨ç¬¬ä¸€è¡Œå±•ç¤ºï¼Œä¸éœ€ä½¿ç”¨new å…³é”®å­—ï¼Œä¸éœ€æ˜¾å¼è°ƒç”¨æ„é€ å™¨ã€‚&lt;/p&gt;
&lt;p&gt;è‡ªåŠ¨æ·»åŠ public static finalä¿®é¥°&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æšä¸¾ç±»çš„æ„é€ å™¨åªèƒ½æ˜¯ç§æœ‰çš„&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æšä¸¾ç±»ä¹Ÿèƒ½å®šä¹‰å±æ€§å’Œæ–¹æ³•ï¼Œå¯ä»¥æ˜¯é™æ€å’Œéé™æ€çš„&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å‚è€ƒ &lt;a class=&#34;link&#34; href=&#34;https://www.cnblogs.com/sister/p/4700702.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;javaæµ…è°ˆæšä¸¾ç±»&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;å…·ä½“ä¾‹å­&lt;/p&gt;
&lt;p&gt;åç¼–è¯‘ä¹‹åä¼šå‘ç°ï¼ŒSPRINGã€SUMMERã€FALLè¿™äº›æ˜¯é™æ€å¸¸é‡(public static final ä¿®é¥°)ï¼Œè€Œä¸”æ˜¯åœ¨é™æ€ä»£ç å—é‡Œåˆå§‹åŒ–çš„ï¼ŒåŒæ—¶è¿˜é™„å¸¦æœ‰public static Season[] values()æ–¹æ³•å’Œpublic static Season valueOf(String s)æ–¹æ³•&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;enum&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Season&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// è°ƒç”¨æ— å‚æ„é€ å™¨ã€æ‹¬å·é‡Œçš„å˜é‡ç§°ä¸ºè‡ªå®šä¹‰å˜é‡ï¼Œå¯ä»¥æœ‰å¤šä¸ªï¼Œè¦è·Ÿæ„é€ æ–¹æ³•å¯¹åº”
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;SPRING&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(),&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// è°ƒç”¨æœ‰å‚æ„é€ å™¨
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;SUMMER&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;å¤å¤©&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;),&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// é»˜è®¤è°ƒç”¨æ— å‚æ„é€ å™¨
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;FALL&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ï¼›&lt;/span&gt;

    &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;

    &lt;span class=&#34;c1&#34;&gt;// é»˜è®¤æ˜¯privateçš„
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;Season&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{}&lt;/span&gt;

    &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Season&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;k&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;name&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;// ----------------------------------------------------    
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// å¦‚æœåœ¨enumä¸­å®šä¹‰äº†æŠ½è±¡æ–¹æ³•,æ¯ä¸ªå®ä¾‹éƒ½è¦é‡å†™è¯¥æ–¹æ³•
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;abstract&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;whatSeason&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
    
    &lt;span class=&#34;c1&#34;&gt;// è°ƒç”¨æ— å‚æ„é€ å™¨
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;SPRING&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;c1&#34;&gt;// æ–¹æ³•æ— æ³•è°ƒç”¨enumç±»é‡Œçš„éé™æ€å˜é‡ï¼Œåªèƒ½è°ƒç”¨éé™æ€å˜é‡
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;nd&#34;&gt;@Override&lt;/span&gt;
        &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;whatSeason&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(){&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;chun&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;}&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;},&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// è°ƒç”¨æœ‰å‚æ„é€ å™¨
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;SUMMER&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;å¤å¤©&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;nd&#34;&gt;@Override&lt;/span&gt;
        &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;whatSeason&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(){&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;xia&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;}&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;},&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// é»˜è®¤è°ƒç”¨æ— å‚æ„é€ å™¨
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;FALL&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;nd&#34;&gt;@Override&lt;/span&gt;
        &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;whatSeason&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(){&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;qiu&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;}&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;};&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;åŸç†å‚è€ƒ&lt;a class=&#34;link&#34; href=&#34;https://blog.csdn.net/javazejian/article/details/71333103&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;æ·±å…¥ç†è§£javaç±»å‹&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;æ³›å‹&#34;&gt;æ³›å‹&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;æ³›å‹ä¼šç±»å‹æ“¦é™¤ï¼Œé‚£å®ƒå¦‚ä½•ä¿è¯ç±»å‹çš„æ­£ç¡®ï¼Ÿ&lt;/p&gt;
&lt;p&gt;javaç¼–è¯‘å™¨æ˜¯é€šè¿‡å…ˆæ£€æŸ¥ä»£ç ä¸­æ³›å‹çš„ç±»å‹ï¼Œç„¶åå†è¿›è¡Œç±»å‹æ“¦é™¤ï¼Œåœ¨è¿›è¡Œç¼–è¯‘çš„&lt;/p&gt;
&lt;p&gt;åªèƒ½åœ¨ç¼–è¯‘æœŸä¿è¯ç±»å‹ç›¸åŒ&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ³›å‹è¢«æ“¦é™¤ï¼Œç»Ÿä¸€ä½¿ç”¨åŸå§‹ç±»å‹Objectï¼Œæ³›å‹ç±»å‹å˜é‡æœ€åéƒ½ä¼šè¢«æ›¿æ¢ä¸ºåŸå§‹ç±»å‹ï¼Œé‚£ä¸ºä»€ä¹ˆæˆ‘ä»¬ä½¿ç”¨çš„æ—¶å€™ä¸éœ€è¦å¼ºè½¬è½¬æ¢?&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚ArrayListï¼Œå®ƒä¼šå¸®æˆ‘ä»¬è¿›è¡Œå¼ºè½¬è½¬æ¢ï¼Œå®ƒä¼šåšäº†ä¸€ä¸ªcheckcastæ“ä½œï¼Œæ£€æŸ¥ä»€ä¹ˆç±»å‹ï¼Œä¹‹åè¿›è¡Œå¼ºè½¬&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç±»å‹æ“¦é™¤ä¸å¤šæ€å¯¼è‡´å†²çªï¼Œå¦‚ä½•è§£å†³&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚æœ¬æ„æ˜¯è¿›è¡Œé‡å†™ï¼Œå®ç°å¤šæ€ã€‚å¯æ˜¯ç±»å‹æ“¦é™¤åï¼Œåªèƒ½å˜ä¸ºäº†é‡è½½ã€‚è¿™æ ·ï¼Œç±»å‹æ“¦é™¤å°±å’Œå¤šæ€æœ‰äº†å†²çªï¼ŒJVMé‡‡ç”¨æ¡¥æ–¹æ³•è§£å†³æ­¤é—®é¢˜&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ³›å‹æ“¦é™¤çš„ä¼˜ç‚¹&lt;/p&gt;
&lt;p&gt;ç±»å‹å®‰å…¨ï¼Œç¼–è¯‘å™¨ä¼šå¸®æˆ‘ä»¬æ£€æŸ¥ã€æ¶ˆé™¤å¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œæé«˜ä»£ç å¯è¯»æ€§ã€ä¸ºæœªæ¥ç‰ˆæœ¬çš„ JVM çš„ä¼˜åŒ–å¸¦æ¥å¯èƒ½&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;List&amp;lt;?&amp;gt;ã€List&lt;!-- raw HTML omitted --&gt;ã€Listã€List&amp;lt;? super T&amp;gt;ã€List&amp;lt;? extends T&amp;gt;çš„åŒºåˆ«&lt;/p&gt;
&lt;p&gt;List&amp;lt;? super T&amp;gt;ï¼šTçš„çˆ¶ç±»ï¼ŒåŒ…æ‹¬Tï¼Œè¡¨ç¤ºèŒƒå›´&lt;/p&gt;
&lt;p&gt;List&amp;lt;? extends T&amp;gt;ï¼šTçš„å­ç±»ï¼ŒåŒ…æ‹¬Tï¼Œè¡¨ç¤ºèŒƒå›´&lt;/p&gt;
&lt;p&gt;List&amp;lt;?&amp;gt; è¡¨ç¤ºä»»æ„ç±»å‹ï¼Œå¦‚æœæ²¡æ˜ç¡®ï¼Œå°±æ˜¯Objectæˆ–è€…ä»»æ„ç±»ï¼Œä¸Listã€List&lt;!-- raw HTML omitted --&gt;ä¸€æ ·ï¼Œè¡¨ç¤º ç‚¹&lt;/p&gt;
&lt;p&gt;List ä¹Ÿå¯è¡¨ç¤ºèŒƒå›´&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å‚è€ƒ &lt;a class=&#34;link&#34; href=&#34;https://cloud.tencent.com/developer/article/1033693&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;10 é“ Java æ³›å‹é¢è¯•é¢˜&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;å‚è€ƒ&lt;a class=&#34;link&#34; href=&#34;https://www.cnblogs.com/xll1025/p/6489088.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;javaæ³›å‹ï¼ˆäºŒï¼‰ã€æ³›å‹çš„å†…éƒ¨åŸç†ï¼šç±»å‹æ“¦é™¤ä»¥åŠç±»å‹æ“¦é™¤å¸¦æ¥çš„é—®é¢˜&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;æ³¨è§£&#34;&gt;æ³¨è§£&lt;/h1&gt;
&lt;h1 id=&#34;åºåˆ—åŒ–å’Œååºåˆ—åŒ–&#34;&gt;åºåˆ—åŒ–å’Œååºåˆ—åŒ–&lt;/h1&gt;
&lt;p&gt;åºåˆ—åŒ–ï¼šå°†å¯¹è±¡è½¬æ¢ä¸ºå­—èŠ‚åºåˆ—ï¼Œç”¨äºå°†ä¿å­˜åœ¨JVMå†…å­˜ä¸­çš„å¯¹è±¡æŒä¹…åŒ–ï¼Œä¿å­˜åˆ°æ–‡ä»¶æˆ–è€…ç½‘ç»œä¼ è¾“&lt;/p&gt;
&lt;p&gt;ååºåˆ—åŒ–ï¼šå°†å­—èŠ‚åºåˆ—è¿˜åŸæˆå¯¹è±¡&lt;/p&gt;
&lt;p&gt;ä¸JSONçš„æ¯”è¾ƒï¼Œä¸¤è€…éƒ½å¯ä»¥ç”¨äºç½‘ç»œä¼ è¾“ï¼ŒJSONæ›´ä½¿ç”¨webæ–¹é¢ã€åº”ç”¨æ–¹é¢ï¼Œæ˜“è¯»ï¼Œéœ€è¦å°†JSONè§£ææ‰èƒ½è¿˜åŸæˆå¯¹è±¡ï¼Œè€Œåºåˆ—åŒ–ååºåˆ—åŒ–æ˜¯JAVAæä¾›çš„ï¼Œç”±JVMæ¥è¿˜åŸï¼Œåº”ç”¨èŒƒå›´ä¼šæ›´å¹¿ä¸€äº›&lt;/p&gt;
&lt;p&gt;é™¤æ­¤ä¹‹å¤–ä¹Ÿæœ‰å…¶ä»–åè®®ï¼Œå¦‚åŸºäºXMLæ–‡æœ¬åè®®(åŸºäºSOAPè§„èŒƒ)ï¼šWebServiceã€Burlapï¼ŒäºŒè¿›åˆ¶åè®®ï¼šHessianï¼ŒHessianç”Ÿæˆçš„å­—èŠ‚æµç®€å‡‘ã€è·¨å¹³å°ã€é«˜æ€§èƒ½æ¯”JDKçš„åºåˆ—åŒ–ååºåˆ—åŒ–ä¼˜ç§€&lt;/p&gt;
&lt;h1 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h1&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.cnblogs.com/dolphin0520/p/3780005.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;æ·±å…¥å‰–æJavaä¸­çš„è£…ç®±å’Œæ‹†ç®±&lt;/a&gt;
&lt;a class=&#34;link&#34; href=&#34;https://github.com/CyC2018/CS-Notes/blob/master/docs/notes/Java%20%E5%9F%BA%E7%A1%80.md&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;CyC2018/CS-Notes/javaåŸºç¡€.md&lt;/a&gt;
&lt;a class=&#34;link&#34; href=&#34;https://www.cnblogs.com/xiaoxi/p/6036701.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;æ·±å…¥ç†è§£Javaä¸­çš„String&lt;/a&gt;&lt;/p&gt;
</description>
        </item>
        <item>
        <title>MyBatis</title>
        <link>http://nixum.cc/p/mybatis/</link>
        <pubDate>Tue, 12 Feb 2019 00:00:00 +0000</pubDate>
        
        <guid>http://nixum.cc/p/mybatis/</guid>
        <description>&lt;p&gt;[TOC]&lt;/p&gt;
&lt;h1 id=&#34;orm&#34;&gt;ORM&lt;/h1&gt;
&lt;p&gt;æ™®é€šJDBCä½¿ç”¨sqlçš„prepareStatement + sql + å ä½ç¬¦ + å‚æ•°çš„æ–¹å¼æ‰§è¡Œsqlè¯­å¥&lt;/p&gt;
&lt;p&gt;ORMå…¶å®å°±æ˜¯åœ¨å…ˆç¼–å†™ç±»ä¸æ•°æ®åº“è¡¨å­—æ®µçš„æ˜ å°„ï¼Œå¯ä»¥æ˜¯xmlé…ç½®ï¼Œä¹Ÿå¯ä»¥æ˜¯æ³¨è§£é…ç½®ï¼Œä¹‹åå†ä½¿ç”¨JDBCæ‰§è¡Œsqlæ—¶ï¼Œé€šè¿‡å¯¹ç±»çš„åå°„è·å¾—å…¶å±æ€§çš„å€¼å’Œå¯¹åº”çš„å­—æ®µåï¼Œæ‹¼æ¥sql+å ä½ç¬¦+å±æ€§å€¼ï¼Œæ‰§è¡Œsqlè¯­å¥&lt;/p&gt;
&lt;h1 id=&#34;mybatis&#34;&gt;MyBatis&lt;/h1&gt;
&lt;p&gt;#{}å’Œ${}åŒºåˆ«&lt;/p&gt;
&lt;p&gt;#{}ï¼šé¢„ç¼–è¯‘ï¼Œåº•å±‚æ˜¯PrepareStatement ï¼Œå¯é˜²æ­¢SQLæ³¨å…¥&lt;/p&gt;
&lt;p&gt;${}ï¼šå‚æ•°æ›¿æ¢ï¼Œä¸èƒ½é˜²æ­¢SQLæ³¨å…¥&lt;/p&gt;
&lt;h2 id=&#34;daoæ¥å£ä¸mapperçš„æ˜ å°„&#34;&gt;daoæ¥å£ä¸mapperçš„æ˜ å°„&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;é€šè¿‡åŠ¨æ€ä»£ç†å®ç°&lt;/li&gt;
&lt;li&gt;å®é™…ä¸ŠXMLåœ¨å®šä¹‰Mapperçš„æ—¶å€™å°±ç›¸å½“äºåœ¨ç¼–å†™daoç±»äº†ï¼Œdaoæ¥å£ç±»ç›¸å½“äºç¼–å†™è°ƒç”¨å…¥å£&lt;/li&gt;
&lt;li&gt;XMLä¸­çš„é…ç½®ä¿¡æ¯ä¼šè¢«å­˜æ”¾åœ¨Configurationç±»ä¸­ï¼ŒSqlSessionFactoryBuilderä¼šè¯»å–Configurationç±»ä¸­çš„ä¿¡æ¯åˆ›å»ºSqlSessionFactoryï¼Œä¹‹åç”±SqlSessionFactoryåˆ›å»ºsqlSession&lt;/li&gt;
&lt;li&gt;åœ¨å¯åŠ¨æ—¶å…ˆæ‰«æå¹¶åŠ è½½æ‰€æœ‰å®šä¹‰Mapperçš„XMLï¼Œè§£æXMLï¼Œæ ¹æ®XMLä¸­çš„namespaceæ‰¾åˆ°å¯¹åº”çš„æ¥å£ï¼Œä¸ºè¿™äº›æ¥å£ç”Ÿæˆå¯¹åº”çš„ä»£ç†å·¥å‚MapperProxyFactoryã€‚&lt;/li&gt;
&lt;li&gt;sqlSession.getMapperæ—¶ï¼Œä¼šé€šè¿‡ä¼ å…¥çš„ç±»/æ¥å£åï¼ˆå³è¢«ä»£ç†ç±»ï¼‰æ‰¾åˆ°å¯¹åº”çš„MapperProxyFactoryï¼Œç”Ÿæˆä»£ç†ç±»MapperProxyï¼Œå¹¶æ³¨å…¥sqlSessionï¼ŒMapperProxyå®ç°InvocationHandleræ¥å£è¿›è¡Œä»£ç†ï¼Œé€šè¿‡MapperMethodæ‰§è¡ŒSQLï¼ŒMapperMethodä½¿ç”¨æ³¨å…¥çš„sqlSessionå’Œè§£æXMLä¸­é…ç½®çš„SQLè¯­å¥å¾—åˆ°çš„å‚æ•°ï¼Œè°ƒç”¨å¯¹åº”çš„executoræ‰§è¡ŒSQL&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;ç¼“å­˜&#34;&gt;ç¼“å­˜&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¸€çº§ç¼“å­˜çš„ä½œç”¨åŸŸæ˜¯åŒä¸€ä¸ªSqlSession&lt;/strong&gt;ï¼Œåœ¨åŒä¸€ä¸ªsqlSessionä¸­ä¸¤æ¬¡æ‰§è¡Œç›¸åŒçš„sqlè¯­å¥ï¼Œç¬¬ä¸€æ¬¡æ‰§è¡Œå®Œæ¯•ä¼šå°†æ•°æ®åº“ä¸­æŸ¥è¯¢çš„æ•°æ®å†™åˆ°ç¼“å­˜ï¼ˆå†…å­˜ï¼‰ï¼Œç¬¬äºŒæ¬¡ä¼šä»ç¼“å­˜ä¸­è·å–æ•°æ®å°†ä¸å†ä»æ•°æ®åº“æŸ¥è¯¢ï¼Œä»è€Œæé«˜æŸ¥è¯¢æ•ˆç‡ã€‚å½“ä¸€ä¸ªsqlSessionç»“æŸåè¯¥sqlSessionä¸­çš„ä¸€çº§ç¼“å­˜ä¹Ÿå°±ä¸å­˜åœ¨äº†ã€‚Mybatis&lt;strong&gt;é»˜è®¤å¼€å¯ä¸€çº§ç¼“å­˜&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;äºŒçº§ç¼“å­˜æ˜¯mapperçº§åˆ«çš„ç¼“å­˜&lt;/strong&gt;ï¼Œå¤šä¸ªSqlSessionå»æ“ä½œåŒä¸€ä¸ªMapperçš„sqlè¯­å¥ï¼Œå¤šä¸ªSqlSessionå»æ“ä½œæ•°æ®åº“å¾—åˆ°æ•°æ®ä¼šå­˜åœ¨äºŒçº§ç¼“å­˜åŒºåŸŸï¼Œå¤šä¸ªSqlSessionå¯ä»¥å…±ç”¨äºŒçº§ç¼“å­˜ï¼ŒäºŒçº§ç¼“å­˜æ˜¯è·¨SqlSessionçš„ã€‚ä¸åŒçš„sqlSessionä¸¤æ¬¡æ‰§è¡Œç›¸åŒnamespaceä¸‹çš„sqlè¯­å¥ä¸”å‘sqlä¸­ä¼ é€’å‚æ•°ä¹Ÿç›¸åŒå³æœ€ç»ˆæ‰§è¡Œç›¸åŒçš„sqlè¯­å¥ï¼Œç¬¬ä¸€æ¬¡æ‰§è¡Œå®Œæ¯•ä¼šå°†æ•°æ®åº“ä¸­æŸ¥è¯¢çš„æ•°æ®å†™åˆ°ç¼“å­˜ï¼ˆå†…å­˜ï¼‰ï¼Œç¬¬äºŒæ¬¡ä¼šä»ç¼“å­˜ä¸­è·å–æ•°æ®å°†ä¸å†ä»æ•°æ®åº“æŸ¥è¯¢ï¼Œä»è€Œæé«˜æŸ¥è¯¢æ•ˆç‡ã€‚Mybatisé»˜è®¤æ²¡æœ‰å¼€å¯äºŒçº§ç¼“å­˜éœ€è¦åœ¨settingå…¨å±€å‚æ•°ä¸­é…ç½®å¼€å¯äºŒçº§ç¼“å­˜&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h1&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://blog.csdn.net/qq_40645822/article/details/101844675&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;MyBatisçš„é€šä¿—ç†è§£ï¼šSqlSession.getMapper()æºç åˆ†æ&lt;/a&gt;&lt;/p&gt;
</description>
        </item>
        <item>
        <title>å¸¸è§çš„ä¸šåŠ¡åœºæ™¯è§£å†³æ–¹æ¡ˆæ•´ç†</title>
        <link>http://nixum.cc/p/%E5%B8%B8%E8%A7%81%E7%9A%84%E4%B8%9A%E5%8A%A1%E5%9C%BA%E6%99%AF%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E6%95%B4%E7%90%86/</link>
        <pubDate>Fri, 14 May 2021 00:00:00 +0000</pubDate>
        
        <guid>http://nixum.cc/p/%E5%B8%B8%E8%A7%81%E7%9A%84%E4%B8%9A%E5%8A%A1%E5%9C%BA%E6%99%AF%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E6%95%B4%E7%90%86/</guid>
        <description>&lt;p&gt;[TOC]&lt;/p&gt;
&lt;h1 id=&#34;ç³»ç»Ÿè®¾è®¡çš„æ€è·¯&#34;&gt;ç³»ç»Ÿè®¾è®¡çš„æ€è·¯&lt;/h1&gt;
&lt;p&gt;ç¼“å­˜ã€å¼‚æ­¥ã€å¤šçº¿ç¨‹ã€åˆ†ç‰‡ã€é«˜å¯ç”¨ã€æ‰©å®¹ã€åˆ†å¸ƒå¼é›†ç¾¤ã€å¹¶å‘ã€é”ä¸é”ã€å¯¹æŒä¹…åŒ–ã€å†…å­˜çš„è¦æ±‚ã€é‡å¤§çš„å°±æƒ³åŠæ³•æŠŠé‡è¿‡æ»¤æˆ–è€…æ‹†å°ï¼Œåˆ†æ²»å¤„ç†ã€å¯¹æ•°æ®åº“çš„å†™æ“ä½œé‡å¾ˆå¤§æ—¶ï¼Œå¯ä»¥è€ƒè™‘æ—¶é—´çª—å£åˆå¹¶&lt;/p&gt;
&lt;h1 id=&#34;apiåè®®è®¾è®¡&#34;&gt;APIåè®®è®¾è®¡&lt;/h1&gt;
&lt;p&gt;å…¶å®åˆ†æˆäº†APIå’Œåè®®ä¸¤éƒ¨åˆ†&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸€èˆ¬APIä¼šç¬¦åˆRestfulè§„èŒƒï¼Œç”±è¡Œä¸º + èµ„æºç»„åˆè€Œæˆï¼›&lt;/li&gt;
&lt;li&gt;åè®®ä¸€èˆ¬å°±åŒ…å«äº†è¯·æ±‚/å“åº”å¤´å’Œå“åº”/è¯·æ±‚ä½“çš„å†…å®¹ï¼Œå‚æ•°ç»“æ„åŒ–ï¼Œæ¯”å¦‚å‚æ•°ç±»å‹æ˜¯Hashï¼Œå°±ä¸è¦å­˜æˆStringï¼Œå€¼æ˜¯Hashçš„åºåˆ—åŒ–åçš„å­—ç¬¦ä¸²ï¼›&lt;/li&gt;
&lt;li&gt;å“åº”ç»“æœè¦ç»Ÿä¸€ï¼Œå°½é‡ä¸è¦å› ä¸ºå‚æ•°çš„ä¸åŒè€Œè¿”å›ä¸åŒç±»å‹çš„å“åº”ç»“æ„ï¼Œä¸ªäººæ¯”è¾ƒå–œæ¬¢çš„åšæ³•æ˜¯ï¼Œåœ¨ç½‘ç»œå±‚é¢ï¼Œå¦‚æœæ¥å£æ²¡æœ‰é—®é¢˜ï¼Œç»Ÿä¸€è¿”å›HTTP codeæ˜¯200ï¼Œå“åº”ä½“é‡Œåˆ†ä¸º&lt;code&gt;codeã€msgã€data&lt;/code&gt;æ¥è¡¨ç¤ºä¸šåŠ¡å“åº”ï¼›&lt;/li&gt;
&lt;li&gt;éœ€è¦è€ƒè™‘è®¤è¯å’Œå®‰å…¨ç›¸å…³ï¼Œæ¯”å¦‚æ˜¯å¦éœ€è¦ç­¾åã€ç¥¨æ®ã€tokenç­‰&lt;/li&gt;
&lt;li&gt;å¤šæœåŠ¡ä¹‹é—´ï¼Œä¿è¯é£æ ¼ä¸€è‡´ï¼›&lt;/li&gt;
&lt;li&gt;è€ƒè™‘å¹‚ç­‰ï¼›&lt;/li&gt;
&lt;li&gt;åŠ å…¥ç‰ˆæœ¬æ§åˆ¶ï¼ŒåŠ åœ¨URLä¸Šï¼Œæˆ–è€…è¯·æ±‚å¤´æœ‰ä¸ªå­—æ®µæ ‡è¯†ï¼›&lt;/li&gt;
&lt;li&gt;æ¥å£èŒè´£å•ä¸€ï¼Œä¸€ä¸ªæ¥å£åªå¹²ä¸€ä»¶äº‹ï¼›&lt;/li&gt;
&lt;li&gt;è€ƒè™‘å…¼å®¹æ€§ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;è§£å†³å¤šé‡if-elseåµŒå¥—é—®é¢˜&#34;&gt;è§£å†³å¤šé‡if-elseåµŒå¥—é—®é¢˜&lt;/h1&gt;
&lt;p&gt;æ¯”å¦‚æœ‰ä¸‹é¢è¿™ç§ä»£ç ï¼Œä¼˜åŒ–if-elseé—®é¢˜&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Handle&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
       &lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;
       &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Operation1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(){&lt;/span&gt;
             &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Operation2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(){&lt;/span&gt;
                    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Operation3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(){&lt;/span&gt;
                           &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Operation4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(){&lt;/span&gt;
                                 &lt;span class=&#34;c1&#34;&gt;// do
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;                           &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;else&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
                                 &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;OPERATION4FAILED&lt;/span&gt;
                           &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
                    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;else&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
                           &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;OPERATION3FAILED&lt;/span&gt;
                    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
             &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;else&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
                    &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;OPERATION2FAILED&lt;/span&gt;
             &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
       &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;else&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
             &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;OPERATION1FAILED&lt;/span&gt;
       &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
       &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;æˆ–è€…&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;func Handle() error {
       var err error
       if Operation1(){
             // do something
       } else if Operation2() {
       		// do something
       } else if Operation3() {
       		// do something
       } else if Operation4() {
       		// do something
       } else {
             err = OPERATION1FAILED
       }
       return err
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;è§£å†³æ–¹æ¡ˆï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åˆ†ææ¡ä»¶ï¼Œå¯¹äºäº’æ–¥çš„æ¡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨è¡¨é©±åŠ¨ï¼Œkeyæ˜¯å…¥å‚ï¼Œvalueæ˜¯æ–¹æ³•&lt;/li&gt;
&lt;li&gt;çŸ­è·¯æ¡ä»¶ï¼Œå°½é‡å¹³é“º if-else åˆ¤æ–­ï¼Œæ¯”å¦‚ æŠŠ if-else æ‹†åˆ†ï¼Œæå‰è¿”å›&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨switch-case&lt;/li&gt;
&lt;li&gt;æ¯”å¦‚å¯¹äºå¤šé‡åµŒå¥—çš„if-elseï¼ŒåµŒå¥—æ¡ä»¶å¿…é¡»åŒæ—¶æˆç«‹ï¼Œå¯ä»¥ä½¿ç”¨è´£ä»»é“¾è®¾è®¡æ¨¡å¼ï¼Œå°†å¤šä¸ªæ¡ä»¶å°è£…æˆæ–¹æ³•ï¼Œè£…è¿›æ•°ç»„æˆ–é“¾è¡¨ä¸­ï¼Œéå†åˆ¤æ–­&lt;/li&gt;
&lt;li&gt;ç­–ç•¥æ¨¡å¼ + å·¥å‚æ¨¡å¼ï¼ŒæŠ½è±¡ä¸€ä¸ªå…¬å…±æ¥å£ï¼Œæ‰€æœ‰æ¡ä»¶åˆ¤æ–­å°è£…æˆå¯¹è±¡ï¼Œå®ç°è¿™ä¸ªæ¥å£ï¼›å®šä¹‰å·¥å‚æ–¹æ³•ï¼Œæ ¹æ®å‚æ•°è·å–å¯¹åº”çš„ç­–ç•¥å¯¹è±¡ï¼Œæ‰§è¡Œå¯¹åº”çš„åˆ¤æ–­å‡½æ•°ï¼Œè¿”å›åˆ¤æ–­åçš„ç»“æœ&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;é˜²æ­¢è¡¨å•é‡å¤æäº¤&#34;&gt;é˜²æ­¢è¡¨å•é‡å¤æäº¤&lt;/h1&gt;
&lt;p&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;ï¼šç”¨æˆ·ç‚¹å‡»ä¸‹å•é¡µé¢ï¼Œè·³è½¬è‡³ä¸‹å•é¡µé¢ï¼Œæäº¤è®¢å•ï¼Œæ­¤æ—¶æœ‰å¯èƒ½ç½‘ç»œåŸå› æˆ–è€…ç”¨æˆ·ç‚¹å‡»å¤šæ¬¡ï¼Œå¯¼è‡´è®¢å•é‡å¤æäº¤ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;è§£å†³&lt;/strong&gt;ï¼šç”¨æˆ·è·³è½¬è‡³ä¸‹å•é¡µå‰ï¼Œä¼šå…ˆè·å–è®¢å•å·(ä¹Ÿä½œä¸ºè®¢å•è¡¨ä¸»é”®)ï¼Œå°†è®¢å•å·ç»‘å®šåœ¨ä¸‹å•é¡µï¼Œåˆ©ç”¨æ•°æ®åº“ä¸»é”®å”¯ä¸€çš„ç‰¹æ€§ï¼Œè®©åˆ›å»ºè®¢å•çš„æ“ä½œå˜æˆå¹‚ç­‰æ€§ã€‚&lt;/p&gt;
&lt;p&gt;ä¹Ÿå¯ä»¥å‰ç«¯åœ¨åŒä¸€ä¸ªé¡µé¢å‘é€è®¢å•åˆ›å»ºè¯·æ±‚æ—¶ï¼Œä¸ºé¡µé¢ç”Ÿæˆä¸€ä¸ªrequestIdï¼Œé‡å¤ä¸‹å•åç«¯å³å¯é€šè¿‡è¿™ä¸ªidåˆ¤é‡ï¼›&lt;/p&gt;
&lt;p&gt;è®¢å•åˆ›å»ºæ¥å£ï¼Œä¹Ÿå¯ä»¥å¯¹å‚æ•°è¿›è¡Œæ’åºåMD5çš„æ–¹å¼åˆ¤é‡ï¼›&lt;/p&gt;
&lt;p&gt;è®¢å•åœºæ™¯è¿˜å¥½ï¼Œå¦‚æœæ˜¯IMåœºæ™¯ï¼Œå› ä¸ºæ¯ä¸ªç”¨æˆ·å‘é€ä¿¡æ¯éƒ½æ¯”è¾ƒé¢‘ç¹ï¼Œå¦‚æœéƒ½æ¯æ¡ä¿¡æ¯éƒ½åˆ›å»ºä¸€ä¸ªè¯·æ±‚idï¼Œå¯èƒ½æ¯å¤ªå¿…è¦ï¼Œåç«¯å¯ä»¥å¯¹æ¯æ¡ä¿¡æ¯+user_idè¿›è¡ŒMD5ï¼Œåˆ¤é‡ï¼Œä½†éœ€è¦å¤„ç†ç”¨æˆ·çœŸçš„é‡å¤å‘é€çš„æƒ…å†µï¼›&lt;/p&gt;
&lt;p&gt;è¿˜æœ‰ä¸€ç§å¤„ç†æ–¹å¼ï¼Œä¸ºæ¯æ¡æ¶ˆæ¯ç”Ÿæˆä¸€ä¸ªæ—¶é—´æˆ³ï¼ŒæœåŠ¡ç«¯å¤„ç†æ—¶åˆ¤æ–­ä¸Šä¸‹ä¸¤æ¡æ¶ˆæ¯çš„æ—¶é—´å·®&lt;/p&gt;
&lt;h1 id=&#34;è§£å†³abaé—®é¢˜&#34;&gt;è§£å†³ABAé—®é¢˜&lt;/h1&gt;
&lt;p&gt;**åœºæ™¯ï¼š**ç±»ä¼¼MySQLçš„ä¸¢å¤±æ›´æ–°ï¼Œæ¯”å¦‚æœ‰æ“ä½œ1ï¼Œæ“ä½œ2å…ˆåå¯¹è®°å½•Aè¿›è¡Œæ›´æ–°ï¼Œæ“ä½œ1çš„å“åº”ä¸¢å¤±å¯¼è‡´é‡è¯•ï¼Œæ­¤æ—¶æ“ä½œ2å·²ç»æ›´æ–°æˆåŠŸï¼Œæ“ä½œ1é‡è¯•æ—¶ä¼šè¦†ç›–æ“ä½œ2çš„æ›´æ–°ã€‚&lt;/p&gt;
&lt;p&gt;**è§£å†³ï¼š**é€šè¿‡ç‰ˆæœ¬å·è§£å†³ï¼Œè®¢å•è¡¨å¢åŠ ä¸€åˆ—ä½œç‰ˆæœ¬å·ï¼Œç‰ˆæœ¬å·å¯ä»¥ä½¿ç”¨é€’å¢åºåˆ—ã€æ—¶é—´æˆ³ç­‰ï¼Œé€šè¿‡æ¯”è¾ƒç‰ˆæœ¬å·æ¥ç¡®å®šæ“ä½œçš„å…ˆåé¡ºåºï¼Œæ›´æ–°æˆåŠŸæ—¶ä¹Ÿéœ€è¦æ›´æ–°ç‰ˆæœ¬å·ã€‚&lt;/p&gt;
&lt;h1 id=&#34;æµé‡å¤§æ•°æ®é‡å¤§çš„å•†å“è¯¦æƒ…é¡µæ•°æ®å­˜å‚¨&#34;&gt;æµé‡å¤§ã€æ•°æ®é‡å¤§çš„å•†å“è¯¦æƒ…é¡µæ•°æ®å­˜å‚¨&lt;/h1&gt;
&lt;p&gt;**åœºæ™¯ï¼š**ä¸€èˆ¬å•†å“è¯¦æƒ…é¡µéƒ½æ˜¯è®¿é—®é‡æœ€å¤§çš„é¡µé¢ï¼Œæ¯”å¦‚ç”¨æˆ·åšå•†å“å¯¹æ¯”ã€æŸ¥çœ‹å•†å“è¯¦æƒ…éƒ½éœ€è¦ï¼Œå¦å¤–å°±æ˜¯å•†å“è¯¦æƒ…é¡µä¸€èˆ¬æ¶‰åŠå¾ˆå¤šæ•°æ®ï¼Œå¦‚ä¸‹ï¼Œä¸”åç«¯å­˜å‚¨çš„skué‡ä¹Ÿæ˜¯å·¨å¤§çš„ï¼Œç›´æ¥åˆ†å¤šå¼ è¡¨å»å­˜è™½ç„¶å¯ä»¥å®ç°ï¼Œä½†æ˜¯æ€§èƒ½å°±ä¸€èˆ¬äº†ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;å•†å“
â”œâ”€â”€ åŸºæœ¬ä¿¡æ¯
â”‚    â”œâ”€â”€ æ ‡é¢˜ã€å‰¯æ ‡é¢˜
â”‚    â”œâ”€â”€ ä»·æ ¼ï¼šåŸä»·ã€ä¿ƒé”€ä»·
â”‚    â””â”€â”€ é¢œè‰²ã€è§„æ ¼ç­‰
â”œâ”€â”€ å•†å“å‚æ•°
â”œâ”€â”€ å•†å“ä»‹ç»
â”œâ”€â”€ å›¾ç‰‡è§†é¢‘
æ¥è‡ªå…¶ä»–ç³»ç»Ÿçš„
â”œâ”€â”€ ä¿ƒé”€ä¿¡æ¯
â”œâ”€â”€ æ¨èå•†å“
â”œâ”€â”€ è¯„è®ºã€è¯„ä»·
â”œâ”€â”€ é…é€ä¿¡æ¯
â””â”€â”€ åº—é“ºä¿¡æ¯
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;**è§£å†³ï¼š**åˆ†æä¸åŒçš„æ•°æ®ç‰¹æ€§ï¼Œæ¯”å¦‚æœ‰äº›æ•°æ®æ˜¯çƒ­ç‚¹çš„ã€ç›¸å¯¹å›ºå®šçš„ã€ä¸å¸¸è¢«ä¿®æ”¹çš„ã€éœ€æ±‚å˜åŒ–ä¸å¤§çš„ç­‰å„ç§ç»´åº¦å»åˆ’åˆ†ï¼Œè¿›è¡Œä¸åŒå­˜å‚¨ã€‚åŠ¨æ€æ•°æ®ã€å®æ—¶æ•°æ®è¿˜æ˜¯ç…§æ—§ï¼Œè¯¥æ€ä¹ˆå¤„ç†æ€ä¹ˆå¤„ç†ï¼Œå…¶ä»–çš„å¯ä»¥ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;å¥—ä¸€å±‚ç¼“å­˜åœ¨æ•°æ®åº“å¤–é¢ï¼ŒæŸ¥è¯¢æ•°æ®å…ˆç¼“å­˜åæ•°æ®åº“&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;é’ˆå¯¹æ¯ä¸ªä¸åŒçš„spuæœ‰ä¸åŒçš„å•†å“å±æ€§ï¼Œåˆ™å¯ä»¥ä½¿ç”¨NoSQLæ¥è§£å†³&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;é’ˆå¯¹å›¾ç‰‡ã€è§†é¢‘ç­‰æ•°æ®ï¼Œä½¿ç”¨å¯¹è±¡å­˜å‚¨ã€CDNè§£å†³ï¼Œæ¯”å¦‚AWS S3ï¼Œç›´æ¥é€šè¿‡å…¶æä¾›çš„APIè¿›è¡Œè®¿é—®ï¼Œå°†è¿™éƒ¨åˆ†çš„å‹åŠ›è½¬ç§»åˆ°äº‘æœåŠ¡å‚å•†&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å°†ç›¸å¯¹å›ºå®šçš„æ•°æ®é™æ€åŒ–ï¼Œæ¯”å¦‚å•†å“ä»‹ç»ï¼Œå…¶åŒ…å«äº†å¤§é‡çš„æ–‡å­—ã€å›¾ç‰‡ã€è§†é¢‘ç­‰ï¼Œå¯ç›´æ¥å°†è¿™ä¸€éƒ¨åˆ†ä¿å­˜æˆHTMLæ–‡ä»¶ä¸­ï¼Œè®¿é—®æ—¶ç›´æ¥è¿”å›HTMLæ–‡ä»¶ï¼Œä¿å­˜æˆHTMLè¿˜å¯ä»¥é…åˆCDNè¿›è¡ŒåŠ é€Ÿ&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;æŸ¥è¯¢æ–¹é¢çš„ä¼˜åŒ–&#34;&gt;æŸ¥è¯¢æ–¹é¢çš„ä¼˜åŒ–&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;å¯ä»¥èµ·ä¸€ä¸ªSQLæ£€æŸ¥è„šæœ¬ï¼Œæ£€æŸ¥æ‰§è¡Œæ—¶é—´è¿‡é•¿çš„SQLï¼Œå¦‚æœè¶…è¿‡æŒ‡å®šæ—¶é—´çš„ï¼Œè¿›è¡Œè®°å½•å’Œkillï¼Œå†è¿›è¡Œä¼˜åŒ–ï¼ŒæŠŠæ…¢SQLè§£å†³æ‰ï¼Œé¿å…å¤šä¸ªæ‰§è¡Œæ—¶é—´è¿‡é•¿çš„SQLæ‹–å®æ•´ä¸ªæ•°æ®åº“ã€‚&lt;/li&gt;
&lt;li&gt;ä¸»ä»åˆ†ç¦»ï¼Œè¯»å†™åˆ†ç¦»ï¼ŒæœåŠ¡é™çº§&lt;/li&gt;
&lt;li&gt;åˆ†æSQLæ‰§è¡Œå’Œè®¿é—®é‡é—´çš„å…³ç³»ï¼Œæ•°æ®åº“CPUåˆ©ç”¨ç‡å˜åŒ–&lt;/li&gt;
&lt;li&gt;MySQLå•æ¬¡æŸ¥è¯¢æ‰«æçš„æ•°æ®é‡æ§åˆ¶åœ¨åƒä¸‡çº§åˆ«å†…ï¼Œå•æ¬¡æ‰«æçš„æ•°æ®é‡åœ¨ç™¾ä¸‡çº§åˆ«æ˜¯å¯ä»¥æ¥å—ï¼Œç†è®ºä¸ŠæŸ¥è¯¢éƒ½åº”è¯¥ä½¿ç”¨ç´¢å¼•ï¼Œé¿å…å…¨è¡¨æ‰«æ&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;å¯¹è±¡å­˜å‚¨åŸç†&#34;&gt;å¯¹è±¡å­˜å‚¨åŸç†&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;æœ¬è´¨æ˜¯ä¸€ä¸ªè§„æ¨¡å¾ˆå¤§çš„åˆ†å¸ƒå¼Key-valueé›†ç¾¤ï¼Œå¤–åŠ ä¸€ä¸ªä¿å­˜é›†ç¾¤èŠ‚ç‚¹ä¿¡æ¯ã€æ–‡ä»¶ä¿¡æ¯å’Œæ˜ å°„å…³ç³»(ç»Ÿç§°ä¸ºå…ƒæ•°æ®)çš„èŠ‚ç‚¹é›†ç¾¤ï¼Œåœ¨æœ€å¤–å±‚å†åŠ ä¸Šä¸€ä¸ªGatewayæ¥å¯¹å¤–æä¾›æœåŠ¡å³å¯ã€‚&lt;/li&gt;
&lt;li&gt;é’ˆå¯¹å›¾ç‰‡ã€è§†é¢‘ç­‰å¤§æ–‡ä»¶ï¼Œåœ¨å­˜å‚¨æ—¶ä¼šå°†å…¶æ‹†åˆ†æˆå¤šä¸ªå¤§å°ç›¸ç­‰çš„å—Blockï¼Œä¸€èˆ¬æ˜¯å‡ åKBåˆ°å‡ MBï¼Œä¾¿äºç®¡ç†ï¼Œä¹Ÿå¯ä»¥åˆ†æ•£åˆ°ä¸åŒèŠ‚ç‚¹ï¼Œæå‡å¹¶è¡Œè¯»å†™æ€§èƒ½ã€‚&lt;/li&gt;
&lt;li&gt;ç”±äºåˆ†æˆçš„å—å¤ªå°ï¼Œæ•°é‡å¤šï¼Œä¸€èˆ¬ä¹Ÿä¸æ˜¯ç›´æ¥è¿›è¡Œç®¡ç†çš„ï¼Œè€Œæ˜¯å°†ä¸€äº›å—è¿›è¡Œèšåˆï¼Œæ”¾åˆ°å®¹å™¨é‡Œï¼Œç±»ä¼¼åˆ†ç‰‡çš„æ¦‚å¿µï¼Œä¸»ä»å¤åˆ¶æ—¶ï¼Œä¹Ÿæ˜¯ç›´æ¥å¤åˆ¶è¿™äº›å—å³å¯ï¼Œä¸ç”¨å†å¤åˆ¶å¤šæ—¥å¿—&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;è·¨ç³»ç»Ÿæ•°æ®å®æ—¶åŒæ­¥&#34;&gt;è·¨ç³»ç»Ÿæ•°æ®å®æ—¶åŒæ­¥&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;é‡‡ç”¨Bin Log + MQçš„æ–¹å¼ï¼Œå°†ä¸Šæ¸¸æ•°æ®å®æ—¶åŒæ­¥åˆ°ä¸‹æ¸¸å…¶ä»–ç³»ç»Ÿçš„æ•°æ®åº“ä¸­ï¼Œä¸ºäº†ç¡®ä¿æ•°æ®ä¸€è‡´æ€§ï¼Œå¿…é¡»é¡ºåºè¯»å–Bin Logï¼Œå› æ­¤MQçš„ä¸»é¢˜ä¹Ÿå¿…é¡»è®¾ç½®ä¸ºåªæœ‰ä¸€ä¸ªåˆ†åŒºï¼Œæ‰èƒ½ä¿è¯Bin Logæœ‰åºã€‚&lt;/li&gt;
&lt;li&gt;å½“ä¸‹æ¸¸ç³»ç»Ÿæƒ³è¦æ‰©å±•æ¶ˆè´¹èƒ½åŠ›æ—¶ï¼Œä¸å¯ç›²ç›®å¢åŠ åŒæ­¥çº¿ç¨‹æ•°å’ŒMQä¸»é¢˜åˆ†åŒºï¼Œç”±äºBin Logçš„é¡ºåºæ€§ï¼Œè¦ç¡®ä¿å¤šçº¿ç¨‹æ¶ˆè´¹æ—¶ï¼Œä¸ä¼šå¯¹æ•°æ®äº§ç”Ÿå½±å“ï¼Œæ‰€ä»¥å¯ä»¥å°†å…·æœ‰å› æœä¸€è‡´æ€§çš„Bin Logå‘å¸ƒç»™åŒä¸€ä¸»é¢˜åˆ†åŒºï¼Œæ‰å¯ä»¥å¤šçº¿ç¨‹åŒæ­¥æ¶ˆè´¹ã€‚å…·ä½“å¯å‚è€ƒMySQL 5.6ç‰ˆæœ¬åå¤šçº¿ç¨‹å¤„ç†Bin Logçš„åšæ³•ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;ä¸åœæœºæƒ…å†µä¸‹æ›´æ¢æ•°æ®åº“&#34;&gt;ä¸åœæœºæƒ…å†µä¸‹æ›´æ¢æ•°æ®åº“&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;åˆ©ç”¨Bin Logæˆ–è€…å¤åˆ¶çŠ¶æ€æœºç†è®ºï¼Œå¢åŠ ä¸€ä¸ªæ–°åº“å’ŒåŒæ­¥æœåŠ¡ã€‚å…ˆå°†æ—§åº“ä¸Šçš„æ•°æ®å¿«ç…§åŒæ­¥åˆ°æ–°åº“ï¼Œå¯¹äºæ—§åº“çš„æ–°æ•°æ®ï¼Œä½¿ç”¨åŒæ­¥æœåŠ¡è¿›è¡ŒåŒæ­¥å¤åˆ¶&lt;/li&gt;
&lt;li&gt;æ”¹é€ æ—§æœåŠ¡ï¼Œå¢åŠ åŒå†™æ–°æ—§ä¸¤ä¸ªåº“çš„åŠŸèƒ½ï¼Œæ·»åŠ åŠŸèƒ½å¼€å…³ï¼Œä½¿å…¶èƒ½å¤Ÿåªå†™æ—§åº“ã€åªå†™æ–°åº“ã€åŒæ­¥åŒå†™çš„åŠŸèƒ½&lt;/li&gt;
&lt;li&gt;å¼€å…³æ‰“è‡³åªå†™æ—§æœåŠ¡ï¼Œåˆ©ç”¨åŒæ­¥æœåŠ¡åŒæ­¥æ•°æ®ï¼Œç­‰æ”¹é€ åçš„æ—§æœåŠ¡èƒ½ç¨³å®šè¿è¡Œï¼ŒéªŒè¯æ–°æ—§ä¸¤ä¸ªåº“çš„æ•°æ®æ˜¯å¦ä¸€è‡´ï¼›ä¸€è‡´ä¹‹åå°†æ”¹é€ åçš„æ—§æœåŠ¡çš„å¼€å…³æ‰“è‡³åŒæ­¥åŒå†™ï¼Œå…³é—­åŒæ­¥æœåŠ¡ï¼Œæ­¤æ—¶ä»ç„¶ä»¥æ•°æ®å†™è‡³æ—§åº“ä¸ºä¸»ï¼Œå†™æ–°åº“å¤±è´¥åˆ™è¿›è¡Œäººå·¥å¹²é¢„ï¼Œæ­¤å¤–ï¼ŒåŒå†™æ—¶å¯èƒ½ä¼šå­˜åœ¨æ•°æ®ä¸ä¸€è‡´ï¼Œæ­¤æ—¶éœ€è¦é’ˆå¯¹è¿™ä¸€å°æ®µæ—¶æœŸä¸Šçº¿æ•°æ®å¯¹æ¯”ä¸è¡¥å¿æœåŠ¡ï¼ŒéªŒè¯å’Œè¡¥å……æ–°æ—§æ•°æ®ä¸ä¸€è‡´é—®é¢˜ï¼›å¾…æœ€ç»ˆç¨³å®šåï¼Œæ‰å°†å¼€å…³æ‰“è‡³åªå†™æ–°æœåŠ¡ï¼Œå®ç°æ•°æ®åº“æ›¿æ¢çš„å¹³æ»‘è¿‡æ¸¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;æµ·é‡æ•°æ®å¤„ç†&#34;&gt;æµ·é‡æ•°æ®å¤„ç†&lt;/h1&gt;
&lt;p&gt;é’ˆå¯¹çš„æ˜¯åŸ‹ç‚¹æ•°æ®ã€æ—¥å¿—æ•°æ®ã€è®¿é—®æ•°æ®ã€ç‚¹å‡»æ•°æ®ã€ç›‘æ§æ•°æ®ç­‰ï¼Œä¸€èˆ¬é‡‡ç”¨å…ˆå­˜å‚¨åè®¡ç®—çš„æ–¹å¼&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨Kafkaå­˜å‚¨ï¼Œä¸Šæ¸¸ç³»ç»Ÿå°†æµ·é‡æ•°æ®é‡‡é›†åå‘ç»™KafKaï¼Œåˆ©ç”¨Kafkaæ— é™æ¶ˆæ¯å †ç§¯å’Œè¶…é«˜ååï¼Œå­˜å‚¨æ•°æ®ï¼Œå†ç”±ä¸‹æ¸¸ç³»ç»Ÿè¿›è¡Œè®¢é˜…æ¶ˆè´¹å³å¯ã€‚è¿™ç§æ–¹æ¡ˆé€‚åˆçŸ­æ—¶é—´çš„æµ·é‡æ•°æ®å¤„ç†ã€‚å…³é”®è¯ï¼šåˆ†å¸ƒå¼æµæ•°æ®å­˜å‚¨ã€‚&lt;/li&gt;
&lt;li&gt;HDFSå­˜å‚¨ + HiveæŸ¥è¯¢ æˆ–è€… ESæŸ¥è¯¢&lt;/li&gt;
&lt;li&gt;é’ˆå¯¹ç›‘æ§æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨æ—¶åºæ•°æ®åº“ï¼Œä¾‹å¦‚Prometheus&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;å¤§æ–‡ä»¶åœ¨æœ‰é™å†…å­˜å†…æ’åº&#34;&gt;å¤§æ–‡ä»¶åœ¨æœ‰é™å†…å­˜å†…æ’åº&lt;/h1&gt;
&lt;p&gt;å¤šè·¯å½’å¹¶æ’åºï¼šå°†æ‰€æœ‰åŸæ–‡ä»¶æŒ‰ç…§å†…å­˜æœ€å¤§å¤§å°è¯»å–å¹¶è¿›è¡Œæ’åºï¼Œè¾“å‡ºåˆ°æ–°çš„ã€å¤šä¸ªçš„æ–‡ä»¶ä¸­ï¼Œç„¶åå¯¹è¿™äº›æ–°çš„å·²æ’åºçš„å°æ–‡ä»¶è¿›è¡Œå½’å¹¶æ’åºã€‚&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.cnblogs.com/GarrettWale/p/14478347.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://www.cnblogs.com/GarrettWale/p/14478347.html&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;åº“å­˜&#34;&gt;åº“å­˜&lt;/h1&gt;
&lt;p&gt;è¿™é‡Œä»…è®¨è®ºåˆ†å¸ƒå¼åœºæ™¯ä¸‹çš„&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;åº“å­˜å­—æ®µè®¾ç½®ä¸ºæ— ç¬¦å·æ•´å‹ï¼Œè¿™æ ·åœ¨æ‰£åˆ°è´Ÿæ•°æ—¶ä¼šæŠ¥é”™ï¼Œä¸è¿‡å¾—çœ‹å…·ä½“çš„æ•°æ®åº“å®ç°&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ‚²è§‚é”ï¼Œåˆ©ç”¨æ•°æ®åº“çš„é”æœºåˆ¶ï¼šæ¯”å¦‚MySQLçš„ &lt;code&gt;for update&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;k&#34;&gt;begin&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;-- å¼€å¯äº‹åŠ¡
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;select&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;inventory&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;from&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;product&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;where&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sku_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;1&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;update&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;-- è·å–å¹¶è®¾ç½®æ’ä»–é”
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;update&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;product&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;set&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;inventory&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;inventory&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;æ‰£å‡æ•°é‡&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;where&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sku_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;1&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;commit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;-- æäº¤äº‹åŠ¡
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ä½†è¿™ç§æ–¹æ¡ˆä¼šæŠŠå‹åŠ›è½¬ç§»åˆ°æ•°æ®åº“ï¼Œååé‡å¹¶ä¸é«˜ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¹è§‚é”ï¼Œç‰ˆæœ¬å· + cas + è‡ªæ—‹ï¼Œä¹Ÿå¯ä»¥åˆ©ç”¨æ•°æ®åº“çš„èƒ½åŠ›å®ç°&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;k&#34;&gt;update&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;product&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;set&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;inventory&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;inventory&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;æ‰£å‡æ•°é‡&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;where&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sku_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;1&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;and&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;inventory&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;æ‰£å‡æ•°é‡&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;æˆ–è€…&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;k&#34;&gt;update&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;product&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;set&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;inventory&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;when&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;inventory&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;æ‰£å‡æ•°é‡&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;then&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;inventory&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;æ‰£å‡æ•°é‡&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;else&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;inventory&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;end&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;å¦‚æœè¦è§£å†³ABAé—®é¢˜ï¼Œè¿˜éœ€è¦å…ˆæŸ¥è¯¢ç‰ˆæœ¬å·ï¼Œè·å–åˆ°ç‰ˆæœ¬å·åï¼Œåœ¨åº”ç”¨å±‚è‡ªæ—‹ï¼Œæ‰§è¡Œä»¥ä¸‹è¯­å¥&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;k&#34;&gt;update&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;product&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;set&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;inventory&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;inventory&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;æ‰£å‡æ•°é‡&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;where&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sku_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;1&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;and&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;7&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;å¦‚æœæ›´æ–°æ•°æ®åº“å±‚é¢æœ‰é‡è¯•æœºåˆ¶ï¼Œé‚£åœ¨setçš„æ—¶å€™å°±ä¸èƒ½ä½¿ç”¨&lt;code&gt;inventory = inventory - æ‰£å‡æ•°é‡&lt;/code&gt;è¿™ç§æ–¹æ¡ˆäº†ï¼Œå› ä¸ºè¿™ç§æ“ä½œæ˜¯ä¸å¹‚ç­‰çš„ï¼Œé‡è¯•ä¼šå¯¼è‡´é‡å¤æ‰£å‡ï¼Œæ‰€ä»¥å¾—å…ˆè®¡ç®—å‡ºæ‰£å‡å®Œä¹‹åçš„inventoryå€¼ï¼Œåœ¨setæ‰èƒ½ä¿è¯æ›´æ–°æ—¶å¹‚ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;æ²¡åŠæ³•åœ¨å¼€å¯äº‹åŠ¡åï¼Œé€šè¿‡&lt;code&gt;selectè¯­å¥ + in share mode + updateè¯­å¥&lt;/code&gt;æ¥å®ç°ï¼Œè™½ç„¶ &lt;code&gt;in share mode&lt;/code&gt;ä¸ä¼šé˜»å¡å…¶ä»–è¯·æ±‚çš„è¯»è¯·æ±‚ï¼Œä½†æ˜¯ä¼šå¯¼è‡´ç¬¬äºŒä¸ªåœ¨æ›´æ–°çš„æ—¶å€™æœ‰é—®é¢˜ï¼Œæ¯”å¦‚é˜»å¡æˆ–è€…æ›´æ–°é”™è¯¯ï¼Œé™¤éåŠ ä¸Šåº“å­˜ä½™é‡åˆ¤æ–­ï¼Œä½†æ˜¯å¦‚æœåŠ ä¸Šæ›´æ–°ä½™é‡çš„åˆ¤æ–­ï¼Œè¿˜ä¸å¦‚ä¸€å¼€å§‹å°±ç›´æ¥ä½¿ç”¨è¿™ä¸ªå»æ‰£å‡åº“å­˜ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨è¿™ä¸ªåœºæ™¯ä¸‹ï¼Œä½¿ç”¨è¿™ä¸¤ç§é”çš„å·®åˆ«ï¼Œåƒæ’ä»–é”ï¼Œæ¯”è¾ƒä¸¥æ ¼ï¼Œé”çš„æ¡æ•°ä¼šæ¯”è¾ƒå¤šï¼Œå¯èƒ½ä¼šå½±å“å…¶ä»–è¯·æ±‚çš„è¯»å†™ï¼Œè€Œå…±äº«é”ï¼Œè™½ç„¶é”å®Œä¸å½±å“è¯»ï¼Œé€‚åˆè¯»å¤šå†™å°‘çš„åœºæ™¯ï¼Œä½†æ˜¯ä¹Ÿå¯èƒ½ä¼šå¯¼è‡´ä¸šåŠ¡æ–¹é¢çš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ï¼ˆå»ºè®®ä½¿ç”¨ï¼Œå…¶ä»–æ–¹æ¡ˆéƒ½ä¸å»ºè®®ï¼Œæ•°æ®åº“æ–¹æ¡ˆæ˜¯æ€§èƒ½æ¯”è¾ƒå·®ï¼Œåˆ†å¸ƒå¼é”æ–¹æ¡ˆæ˜¯å¯é æ€§æ¯”è¾ƒå·®ï¼‰åº“å­˜æ‰£å‡ä¸»è¦æ˜¯åŒ…å«ä¸¤éƒ¨åˆ†ï¼Œè¶…å–æ ¡éªŒã€æ‰£å‡æ•°æ®çš„æŒä¹…åŒ–ï¼Œå› æ­¤ï¼Œå¯ä»¥åˆ†ç¦»è¿™ä¸¤éƒ¨åˆ†ï¼Œåªè¦è¶…å–æ ¡éªŒèƒ½é€šè¿‡ï¼Œç›´æ¥æ”¹åº“å³å¯ï¼Œå¯ä»¥åˆ©ç”¨Rediså•çº¿ç¨‹æ“ä½œå¹¶å‘å®‰å…¨çš„èƒ½åŠ›ï¼ŒæŠŠåº“å­˜å­˜åœ¨Redisä¸­å®ç°æ ¡éªŒã€‚&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚æ¯æ¬¡æ‰£å‡åº“å­˜æ—¶ï¼Œå¯¹å­˜åœ¨Redisä¸­çš„æ•°æ®è¿›è¡Œdecrbyæ‰£å‡ï¼ˆæˆ–è€…å…ˆæŸ¥è¯¢åæ‰£å‡ï¼Œéœ€è¦ä½¿ç”¨Luaè„šæœ¬ä¿è¯åŸå­ï¼‰ï¼Œå¦‚æœè¿”å›çš„æ•°é‡å¤§äº0ï¼Œè¯´æ˜åº“å­˜å¤Ÿï¼Œä¹‹åå¯ä»¥åŒæ­¥æˆ–å¼‚æ­¥æŠŠå€¼æ›´æ–°åˆ°æ•°æ®åº“å³å¯ï¼Œä½†è¦æ³¨æ„çš„æ˜¯ï¼Œæœ¬æ–¹æ¡ˆä¸æ”¯æŒå›æ»šï¼›&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;9
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-lua&#34; data-lang=&#34;lua&#34;&gt;&lt;span class=&#34;n&#34;&gt;luaè„šæœ¬çš„æ–¹æ¡ˆ&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ï¼Œé¢„å…ˆå°†è„šæœ¬å­˜åˆ°&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;redis&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ï¼Œè°ƒç”¨æ—¶åªéœ€ä¼ å…¥è¿”å›çš„&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sha1çš„å€¼å³å¯&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ï¼Œæ— éœ€æ¯æ¬¡éƒ½ä¼ ä¸€é&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;luaè„šæœ¬&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;-- æŸ¥è¯¢æ´»åŠ¨åº“å­˜ï¼Œå…¶ä¸­KEYS[1]ä¸ºä¼ å…¥çš„å‚æ•°1ï¼Œå³åº“å­˜key&lt;/span&gt;
&lt;span class=&#34;kd&#34;&gt;local&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;c_s&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;redis.call&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;get&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;KEYS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;-- åˆ¤æ–­æ´»åŠ¨åº“å­˜æ˜¯å¦å……è¶³ï¼Œå…¶ä¸­KEYS[2]ä¸ºä¼ å…¥çš„å‚æ•°2ï¼Œå³å½“å‰æŠ¢è´­æ•°é‡&lt;/span&gt;
&lt;span class=&#34;kr&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;c_s&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;or&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;tonumber&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c_s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;tonumber&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;KEYS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt; &lt;span class=&#34;kr&#34;&gt;then&lt;/span&gt;
   &lt;span class=&#34;kr&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;
&lt;span class=&#34;kr&#34;&gt;end&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;-- å¦‚æœæ´»åŠ¨åº“å­˜å……è¶³ï¼Œåˆ™è¿›è¡Œæ‰£å‡æ“ä½œã€‚å…¶ä¸­KEYS[2]ä¸ºä¼ å…¥çš„å‚æ•°2ï¼Œå³å½“å‰æŠ¢è´­æ•°é‡&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;redis.call&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;decrby&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;KEYS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;],&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;KEYS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åˆ†å¸ƒå¼é”å®ç°ï¼Œåº”ç”¨å±‚å¯¹sku_idä¸Šåˆ†å¸ƒå¼é”ï¼Œå†è¿›è¡Œåº“å­˜åˆ¤æ–­&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åº“å­˜è¯»é€šè¿‡Redisç¼“å­˜ + MySQL bin log + å®šæ—¶ä»»åŠ¡æ›´æ–° æ¥è§£å†³ï¼Œåº“å­˜å†™é€šè¿‡åœ¨ å…ˆæŸ¥å‡ºåº“å­˜å€¼ + ä¸€ç§’å†…çª—å£åˆå¹¶ + ä¼˜å…ˆçº§é˜Ÿåˆ—(ç”¨äºå¤„ç†å¤§æ•°å€¼åº“å­˜æ‰£å‡)  + versionä¹è§‚é”æ‰£å‡åº“å­˜ + é‡è¯•ï¼Œåˆå¹¶å¤±è´¥çš„æ—¶å€™å°±ä¼šæŒ‰æ—¶é—´çª—å£å†…æŒ‰é¡ºåºæ‰£å‡ å®ç°ï¼›æ—¶é—´çª—å£è®¾è®¡ï¼Œä¸»è¦è§£å†³æ—¶é—´çª—å£å†…æ•°æ®åº“é¢‘ç¹æ“ä½œå¯¹ç¼“å­˜çš„å½±å“ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å®é™…åº“å­˜å’Œå†»ç»“åº“å­˜ï¼Œä¸è¿‡è¿™ä¸ªå±äºä¸šåŠ¡ä¸Šçš„å¤„ç†ï¼Œä»å®é™…åº“å­˜è½¬ç§»åˆ°å†»ç»“åº“å­˜ä»ç„¶æœ‰å¯èƒ½å‡ºç°è¶…å–çš„æƒ…å†µï¼Œè¿™ç§ä¸€èˆ¬æ˜¯ä¸ºäº†è§£å†³åœ¨ä¸‹è®¢å•ç›´æ¥æ‰£åº“å­˜ï¼Œå¯èƒ½ä¼šå¯¼è‡´è¢«æ¶æ„ä¸‹å•ï¼Œæˆ–è€…åœ¨æ”¯ä»˜æ—¶æ‰£åº“å­˜æ‰£å¤±è´¥äº†ä½†æ˜¯è®¢å•ä»ç„¶å­˜åœ¨ï¼Œå±äºç”¨æˆ·ä½“éªŒä¸Šçš„é—®é¢˜äº†ï¼Œæ‰€ä»¥æ‰è¡ç”Ÿå‡ºåœ¨ä¸‹è®¢å•æ—¶å°†å®é™…åº“å­˜å€¼æ‰£å‡ï¼ŒåŠ åˆ°å†»ç»“åº“å­˜ï¼Œæ”¯ä»˜æ—¶æ‰çœŸæ­£çš„å‡åº“å­˜ï¼Œå¦åˆ™åœ¨è¿‡æœŸæ—¶å†æŠŠå†»ç»“åº“å­˜è¡¥å›å®é™…åº“å­˜ï¼Œæœ¬è´¨ä¸Šæ˜¯TCCã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;ç§’æ€&#34;&gt;ç§’æ€&lt;/h1&gt;
&lt;p&gt;ç§’æ€ä¸»è¦æ˜¯è¦è§£å†³ä¸¤ä¸ªé—®é¢˜ï¼šå¹¶å‘è¯» å’Œ å¹¶å‘å†™ï¼Œè¿˜æœ‰å°±æ˜¯é’ˆå¯¹æ„å¤–æœ‰ä¸€äº›å…œåº•çš„æ–¹æ¡ˆï¼Œæ¯”å¦‚é«˜å¯ç”¨ï¼Œå¦å¤–å°±æ˜¯é’ˆå¯¹è¿™ç§é«˜å¹¶å‘çš„åœºæ™¯ï¼Œæœ€å¥½çš„åšæ³•å°±æ˜¯å‰Šå‡è¯·æ±‚æ•°ï¼Œåœ¨ä¸šåŠ¡æµç¨‹çš„å‰ç«¯å°½å¯èƒ½çš„æ‹¦æˆªæµé‡ã€å‰Šå³°æ¥è¾¾åˆ°é™ä½åç«¯çš„å‹åŠ›ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ¶æ„åŸåˆ™&#34;&gt;æ¶æ„åŸåˆ™&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;å“åº”çš„æ•°æ®è¦å°½é‡å°‘ï¼šæ¯”å¦‚è¿”å›çš„HTMLé¡µé¢ã€æ¥å£æ•°æ®ï¼Œå› ä¸ºæ¶‰åŠåˆ°ç¼–ç ã€åºåˆ—åŒ–ã€ååºåˆ—åŒ–ã€æ•°æ®åº“çš„æ“ä½œç­‰ï¼Œä¼šæ¯”è¾ƒæ¶ˆè€—èµ„æºï¼›&lt;/li&gt;
&lt;li&gt;è¯·æ±‚æ•°è¦å°½é‡å°‘ï¼šè¯·æ±‚æ•°ä¸€å¤šå°±ä¼šäº§ç”Ÿå¾ˆå¤šè¿æ¥ï¼Œä¸€ä¸ªè¯·æ±‚å¯ä»¥è·å–å®Œæ‰€æœ‰æ•°æ®ï¼Œå°±ä¸è¦åˆ†å¤šæ¬¡è·å–ï¼Œåƒä¸€äº›CSSæ–‡ä»¶å’ŒJSæ–‡ä»¶å¯ä»¥åˆå¹¶è·å–ï¼›&lt;/li&gt;
&lt;li&gt;è¯·æ±‚ç»è¿‡çš„æœåŠ¡æˆ–è€…ä¾èµ–çš„æœåŠ¡è¦å°½é‡å°‘ï¼šè¯·æ±‚æ¯ç»è¿‡ä¸€ä¸ªæœåŠ¡ï¼Œéƒ½ä¼šå¢åŠ ä¸å¯é æ€§ï¼Œä¹Ÿä¼šäº§ç”Ÿç½‘ç»œè¿æ¥ï¼Œæ¶ˆè€—èµ„æºï¼›ä¾èµ–æœåŠ¡æ”¯æŒè¢«é™çº§ï¼Œä»¥æ­¤å‡å°‘å¯¹ä¸»æµç¨‹çš„å½±å“ï¼›&lt;/li&gt;
&lt;li&gt;é¿å…å•ç‚¹ï¼Œæ”¯æŒåŠ¨æ€æ‰©å®¹ï¼šæœåŠ¡æœ€å¥½æ˜¯æ— çŠ¶æ€è®¾è®¡ï¼Œæ–¹ä¾¿è¿ç§»åˆ°ä¸åŒé…ç½®çš„æœºå™¨ï¼Œä¹Ÿæ–¹ä¾¿åŠ¨æ€æ‰©å®¹æ•°é‡ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é’ˆå¯¹ç§’æ€åœºæ™¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å°†ç§’æ€æœåŠ¡ç‹¬ç«‹ï¼Œé¿å…å¯¹å…¶ä»–æœåŠ¡çš„å½±å“&lt;/li&gt;
&lt;li&gt;å¯¹çƒ­ç‚¹æ•°æ®ï¼ˆå¦‚åº“å­˜ã€å•†å“ï¼‰è¿›è¡Œç¼“å­˜ï¼Œæé«˜è¯»æ€§èƒ½&lt;/li&gt;
&lt;li&gt;ç§’æ€ç­”é¢˜ï¼Œé˜²æ­¢ç§’æ€å™¨æŠ¢å•ï¼›é™æµä¿æŠ¤ï¼Œå¯¹åç«¯è¿›è¡Œä¿æŠ¤&lt;/li&gt;
&lt;li&gt;å¯¹ç§’æ€é¡µé¢è¿›è¡ŒåŠ¨é™åˆ†ç¦»ï¼Œç”¨æˆ·åˆ·æ–°ä»…åˆ·æ–°éƒ¨åˆ†æ¨¡å—&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;åŠ¨é™åˆ†ç¦»æ–¹æ¡ˆ&#34;&gt;åŠ¨é™åˆ†ç¦»æ–¹æ¡ˆ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;é™æ€æ•°æ®å¯ä»¥ç¼“å­˜åˆ°CDNã€ç”¨æˆ·æµè§ˆå™¨ã€æœåŠ¡ç«¯ç¼“å­˜ï¼Œç”šè‡³å¯ä»¥ä»¥URLä¸ºkeyï¼Œç¼“å­˜æ•´ä¸ªHTTPå“åº”ï¼›&lt;/p&gt;
&lt;p&gt;ç¼“å­˜é™æ€æ•°æ®æ—¶è¦æ³¨æ„å‡ ä¸ªç‚¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åˆ†ç¦»è·Ÿæµè§ˆå™¨ç›¸å…³çš„æ•°æ®ï¼Œæ¯”å¦‚æ˜¯å¦å·²ç™»å½•ã€ç™»å½•çš„èº«ä»½ç­‰ï¼Œè¿™äº›æ•°æ®å¯ä»¥é€šè¿‡è¯·æ±‚è·å–&lt;/li&gt;
&lt;li&gt;åˆ†ç¦»æ—¶é—´ï¼ŒæœåŠ¡ç«¯è¾“å‡ºçš„æ—¶é—´ä¹Ÿé€šè¿‡åŠ¨æ€è¯·æ±‚è·å–&lt;/li&gt;
&lt;li&gt;å¼‚æ­¥åŒ–åœ°åŸŸå› ç´ ï¼Œé¡µé¢ä¸Šè·Ÿåœ°åŸŸç›¸å…³çš„æ•°æ®ä¹Ÿé€šè¿‡åŠ¨æ€è¯·æ±‚è·å–&lt;/li&gt;
&lt;li&gt;å»æ‰cookieï¼Œç¼“å­˜çš„é™æ€æ•°æ®ä¸èƒ½åŒ…å«æœ‰cookie&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åŠ¨æ€æ•°æ®å¤„ç†æœ‰ä¸¤ç§æ–¹æ¡ˆï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ESIæ–¹æ¡ˆï¼šæœåŠ¡ç«¯æ¸²æŸ“ï¼Œç”±æœåŠ¡ç«¯å°†é™æ€æ•°æ®ä¸åŠ¨æ€æ•°æ®ç»“åˆå®Œæˆä¹‹åè¿”å›ç»™å®¢æˆ·ç«¯&lt;/li&gt;
&lt;li&gt;CSIæ–¹æ¡ˆï¼šå‰ç«¯æ¸²æŸ“ï¼Œå‰ç«¯ajaxè¯·æ±‚è·å–jsonæ•°æ®ï¼Œå†è¿›è¡Œæ•´åˆå‘ˆç°&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç¼“å­˜çš„å­˜å‚¨ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;æœ¬æœºå†…å­˜ï¼šå¥½å¤„æ˜¯æ²¡æœ‰ç½‘ç»œã€åºåˆ—åŒ–ç­‰å¸¦æ¥çš„æŸè€—ï¼Œåå¤„æ˜¯ç¼“å­˜ç®¡ç†ä¸ä¾¿ï¼Œä¼šåŠ å¤§æœåŠ¡çš„å†…å­˜ä½¿ç”¨&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç»Ÿä¸€çš„Cacheå±‚ï¼šå¥½å¤„æ˜¯ç®¡ç†æ–¹ä¾¿ï¼Œå‡å°‘å¤šåº”ç”¨æ¥å…¥Cacheçš„æˆæœ¬ï¼Œå…±äº«å†…å­˜ä¹Ÿèƒ½æœ€å¤§åŒ–åˆ©ç”¨åˆ°å†…å­˜ï¼Œåå¤„æ˜¯ä¼šå¸¦æ¥ç½‘ç»œæŸè€—ï¼ŒCacheæœºå™¨çš„å®•æœºä¼šå¯¼è‡´ç¼“å­˜ä¸å¯ç”¨&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;CDNï¼šä½¿ç”¨CDNè¦æ³¨æ„å‡ ä¸ªé—®é¢˜ï¼šæ¯”å¦‚ç¼“å­˜å¤±æ•ˆæ—¶é—´é—®é¢˜ï¼Œæ•°æ®åˆ†æ•£åˆ°ä¸åŒåœ°åŒºçš„CDNå¸¦æ¥çš„å‘½ä¸­ç‡é—®é¢˜ï¼Œè¿˜æœ‰å°±æ˜¯å½“æ•°æ®æœ‰æ›´æ–°æ—¶ï¼Œå¦‚ä½•å¿«é€Ÿåˆ†å‘åˆ°ä¸åŒåœ°åŒºçš„CDNï¼›&lt;/p&gt;
&lt;p&gt;ä¸€èˆ¬æ¥è¯´ï¼Œåªæœ‰é‚£äº›é è¿‘è®¿é—®é‡æ¯”è¾ƒé›†ä¸­çš„åœ°åŒºï¼Œç¦»ä¸»ç«™æ¯”è¾ƒè¿œï¼ŒCDNèŠ‚ç‚¹åˆ°ä¸»ç«™çš„ç½‘ç»œæ¯”è¾ƒç¨³å®šçš„CDNèŠ‚ç‚¹æ‰é€‚åˆæ”¾ç¼“å­˜æ•°æ®ï¼Œåƒå•†å“è¯¦æƒ…çš„æ•°æ®ï¼Œå°±é€‚åˆæ”¾åˆ°CDNçš„äºŒçº§Cacheï¼Œè®©ç”¨æˆ·è¯·æ±‚å…ˆå›æºCDNçš„äºŒçº§Cacheï¼Œæ²¡å‘½ä¸­å†å›æºä¸»ç«™è·å–æ•°æ®æ¯”è¾ƒåˆé€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨CDNæœ‰å‡ ä¸ªå¥½å¤„ï¼Œå¯ä»¥æŠŠæ•´ä¸ªé¡µé¢ç¼“å­˜åœ¨ç”¨æˆ·æµè§ˆå™¨ä¸­ï¼Œå¼ºåˆ¶åˆ·æ–°é¡µé¢ä¹Ÿä¼šè¯·æ±‚CDNï¼Œæ‰€ä»¥é™æ€æ•°æ®æ¯”è¾ƒé€‚åˆæ”¾åˆ°CDNä¸Šé¢&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;çƒ­ç‚¹æ•°æ®-ä¸-ç¼“å­˜&#34;&gt;çƒ­ç‚¹æ•°æ® ä¸ ç¼“å­˜&lt;/h2&gt;
&lt;p&gt;çƒ­ç‚¹åˆ†ä¸º çƒ­ç‚¹æ“ä½œ å’Œ çƒ­ç‚¹æ•°æ®ï¼Œçƒ­ç‚¹æ•°æ®åˆåˆ†ä¸ºé™æ€çƒ­ç‚¹æ•°æ®å’ŒåŠ¨æ€çƒ­ç‚¹æ•°æ®&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;é™æ€çƒ­ç‚¹æ•°æ®&lt;/p&gt;
&lt;p&gt;æŒ‡èƒ½å¤Ÿè¢«æå‰é¢„æµ‹çš„æ•°æ®ï¼Œæ¯”å¦‚æå‰å¾—çŸ¥è¦ç§’æ€çš„å•†å“ï¼Œæˆ–è€…åˆ†æç”¨æˆ·è¡Œä¸ºã€è®¢å•è®°å½•ã€è´­ç‰©è½¦è®°å½•ã€TopNè¢«æœç´¢çš„å•†å“ç­‰ï¼Œåˆ¤æ–­å“ªäº›æœ‰å¯èƒ½æ˜¯çƒ­ç‚¹å•†å“ï¼Œç»™è¿™äº›å•†å“æ‰“ä¸Šæ ‡ç­¾ï¼›&lt;/p&gt;
&lt;p&gt;å¯¹äºé™æ€çƒ­ç‚¹æ•°æ®ï¼Œå¯ä»¥ç›´æ¥ç¼“å­˜&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åŠ¨æ€çƒ­ç‚¹æ•°æ®&lt;/p&gt;
&lt;p&gt;æŒ‡ä¸èƒ½è¢«æå‰é¢„æµ‹ï¼Œåœ¨ç³»ç»Ÿè¿è¡Œè¿‡ç¨‹ä¸­ä¸´æ—¶äº§ç”Ÿçš„æ•°æ®ï¼Œæ¯”å¦‚æŸå•†å“å› ä¸ºæŸæ¡çŸ­è§†é¢‘ç«äº†ï¼Œå¯¼è‡´å®ƒåœ¨çŸ­æ—¶é—´å†…è¢«å¤§é‡æŠ¢è´­ï¼Œè¿™ç§å•†å“çš„å‘ç°ä¸€èˆ¬æ˜¯å¼‚æ­¥åˆ†æï¼Œé€šè¿‡åˆ†æå•†å“è¢«è®¿é—®çš„è·¯å¾„çš„æ¬¡æ•°ï¼Œæå‰è¯†åˆ«å“ªäº›å•†å“çš„è®¿é—®é‡é«˜ï¼Œæ¥ç»™è¿™äº›å•†å“æ‰“ä¸Šæ ‡ç­¾ï¼›&lt;/p&gt;
&lt;p&gt;å¯¹äºåŠ¨æ€çƒ­ç‚¹æ•°æ®ï¼Œç”±äºå…¶ä¸´æ—¶æ€§ï¼Œå¯ä»¥é‡‡ç”¨LRUï¼Œæˆ–è€…å¯¹åŠ¨æ€çƒ­ç‚¹æ•°æ®ç¼“å­˜åˆ†ç‰‡è§£å†³ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¯¹äºè¿™äº›çƒ­ç‚¹æ•°æ®ï¼Œå¯ä»¥æŠŠå®ƒä»¬ä¸æ™®é€šçš„æ•°æ®è¿›è¡Œéš”ç¦»ï¼Œæ¯”å¦‚ç³»ç»Ÿéš”ç¦»ï¼Œå°†å‚åŠ ç§’æ€æ´»åŠ¨çš„è¯·æ±‚å¯¼å‘ä¸åŒçš„åŸŸåï¼ŒæŒ‡å‘ä¸åŒçš„é›†ç¾¤ï¼Œå¤„ç†è¿™äº›çƒ­ç‚¹æ•°æ®çš„æœåŠ¡ç‹¬ç«‹éƒ¨ç½²ï¼ˆä½†å®é™…ä¸Šä¸ä¼šæŠŠæ•´å¥—ç³»ç»Ÿéƒ½éƒ¨ç½²ï¼Œè¿™æ ·æˆæœ¬å¤ªå¤§ï¼Œç‹¬ç«‹éƒ¨ç½²è¿™äº›æœåŠ¡åï¼Œå¯¹äºå…¬å…±æœåŠ¡å°±éœ€è¦æœ‰èƒ½åŒºåˆ†è¯·æ±‚åˆ†å‘çš„é€»è¾‘äº†ï¼Œæ¯”å¦‚æ ¹æ®å•†å“idï¼ŒçŸ¥é“å®ƒæ˜¯ç§’æ€å•†å“ï¼Œå°±èƒ½æŠŠå®ƒè½¬å‘ç»™ä¸“é—¨å¤„ç†ç§’æ€çš„æœåŠ¡ï¼‰ï¼›æ•°æ®éš”ç¦»ï¼Œä¸ºè¿™äº›çƒ­ç‚¹æ•°æ®å•ç‹¬è®¾ç«‹Cacheå±‚å’Œæ•°æ®åº“ç­‰ï¼Œé¿å…å½±å“æ™®é€šä¸šåŠ¡æµç¨‹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;æµé‡å‰Šå³°&#34;&gt;æµé‡å‰Šå³°&lt;/h2&gt;
&lt;p&gt;æµé‡å‰Šå³°ä¸»è¦æ˜¯ä¸ºäº†è®©æœåŠ¡ç«¯å¤„ç†å˜å¾—æ›´åŠ å¹³ç¨³ï¼ŒèŠ‚çœæœåŠ¡å™¨çš„èµ„æºï¼Œé€šè¿‡å»¶ç¼“ç”¨æˆ·è¯·æ±‚çš„å‘å‡ºï¼Œå‡å°‘å’Œè¿‡æ»¤ä¸€äº›æ— æ•ˆçš„è¯·æ±‚ï¼Œé¿å…åç«¯æœåŠ¡ä¸€ä¸‹å­å¤„ç†å¾ˆå¤šè¯·æ±‚ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;æ¶ˆæ¯é˜Ÿåˆ—ï¼ŒFIFOå¤„ç†è¯·æ±‚ï¼›è¯·æ±‚åºåˆ—åŒ–æˆæ–‡ä»¶ï¼Œå†æŒ‰é¡ºåºè¯»å–ï¼›è¿™é‡Œæ’é˜Ÿä¸»è¦æ˜¯é’ˆå¯¹æœåŠ¡é—´è¯·æ±‚çš„æ’é˜Ÿï¼Œè€Œä¸æ˜¯ç”¨æˆ·è¯·æ±‚ç›´æ¥ç»è¿‡æ¶ˆæ¯é˜Ÿåˆ—ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç”¨æˆ·æ“ä½œå»¶ç¼“ï¼šæ¯”å¦‚è´­ä¹°æ—¶å¢åŠ ç­”é¢˜æœºåˆ¶ï¼ŒéªŒè¯ç ç­‰ï¼Œé€šè¿‡å°†å‘èµ·è¯·æ±‚çš„æ“ä½œæ‹‰é•¿ï¼Œé¿å…çŸ­æ—¶é—´å†…å¤§é‡è¯·æ±‚ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åˆ†å±‚è¿‡æ»¤&lt;/p&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;å°†åŠ¨æ€è¯·æ±‚çš„è¯»æ•°æ®ç¼“å­˜åœ¨Webç«¯ï¼Œè¿‡æ»¤æ‰æ— æ•ˆçš„æ•°æ®ï¼›&lt;/li&gt;
&lt;li&gt;å¯¹è¯·æ±‚è¿›è¡Œæ ¡éªŒï¼Œå¦‚åˆ¤æ–­ç”¨æˆ·æ˜¯å¦å…·æœ‰ç§’æ€èµ„æ ¼ã€å•†å“çŠ¶æ€æ˜¯å¦æ­£å¸¸ã€ç§’æ€æ´»åŠ¨æ˜¯å¦ç»“æŸã€è¯·æ±‚æ˜¯å¦éæ³•ï¼Œåˆ¤æ–­å¯¹ç”¨æˆ·æ˜¯å¦é™è´­ç­‰ï¼›&lt;/li&gt;
&lt;li&gt;å¯¹è¯»æ•°æ®ä¸åšå¼ºä¸€è‡´æ ¡éªŒï¼Œå‡å°‘å› æ ¡éªŒäº§ç”Ÿçš„ç“¶é¢ˆé—®é¢˜ï¼›&lt;/li&gt;
&lt;li&gt;å¯¹å†™æ•°æ®è¿›è¡ŒåŸºäºæ—¶é—´çš„åˆç†åˆ†ç‰‡ï¼Œè¿‡æ»¤æ‰è¿‡æœŸçš„å¤±æ•ˆè¯·æ±‚ï¼›&lt;/li&gt;
&lt;li&gt;å¯¹å†™æ•°æ®è¿›è¡Œé™æµä¿æŠ¤ï¼Œå°†è¶…å‡ºç³»ç»Ÿæ‰¿è½½èƒ½åŠ›çš„è¯·æ±‚è¿‡æ»¤æ‰ï¼›&lt;/li&gt;
&lt;li&gt;å¯¹å†™æ•°æ®è¿›è¡Œå¼ºä¸€è‡´æ ¡éªŒï¼Œæ¯”å¦‚åº“å­˜ï¼Œåªä¿ç•™æœ‰æ•ˆæ•°æ®ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;ç§’æ€ä¸­çš„å‡åº“å­˜&#34;&gt;ç§’æ€ä¸­çš„å‡åº“å­˜&lt;/h2&gt;
&lt;p&gt;å‡åº“å­˜ä¸€èˆ¬æœ‰ä¸‰ç§æ¨¡å¼ï¼šä¸‹å•æˆåŠŸå‡åº“å­˜ï¼›æ”¯ä»˜æˆåŠŸæ—¶å‡åº“å­˜ï¼›ä¸‹å•é¢„æ‰£åº“å­˜ï¼Œæ”¯ä»˜çœŸæ­£å‡åº“å­˜ï¼›&lt;/p&gt;
&lt;p&gt;ä¸‹å•æˆåŠŸå‡åº“å­˜æ–¹å¼é€»è¾‘æ¯”è¾ƒç®€å•ï¼Œæ€§èƒ½ä¹Ÿæ¯”è¾ƒå ä¼˜åŠ¿ï¼Œå¦‚æœæ˜¯è¿½æ±‚æè‡´æ€§èƒ½çš„ç§’æ€æ´»åŠ¨å¯ä»¥é€‰æ‹©è¿™ç§æ¨¡å¼ã€‚&lt;/p&gt;
&lt;p&gt;ç§’æ€æ´»åŠ¨ä¸­ï¼Œåº“å­˜æ˜¯ä¸€ä¸ªçƒ­ç‚¹æ•°æ®ï¼Œäº¤æ˜“çš„å„ä¸ªç¯èŠ‚éƒ½æ¶‰åŠåˆ°å¯¹åº“å­˜çš„æŸ¥è¯¢ï¼Œé’ˆå¯¹è¯»è¯·æ±‚ï¼Œå¯ä»¥ä¸éœ€è¦é‚£ä¹ˆç²¾ç¡®ï¼ŒæŠŠåº“å­˜æ•°æ®æ”¾åˆ°ç¼“å­˜é‡Œå¯ä»¥å¤§å¤§æå‡æŸ¥è¯¢æ€§èƒ½ï¼Œå¯¹åº“å­˜çš„å¤„ç†ä¸»è¦æ˜¯éš¾åœ¨å†™æ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœæ²¡æœ‰å¤æ‚çš„skuåº“å­˜å’Œæ€»åº“å­˜çš„è”åŠ¨å…³ç³»ï¼Œæ‰£åº“å­˜é€»è¾‘å®Œå…¨å¯ä»¥åœ¨ç¼“å­˜é‡Œæ‰§è¡Œï¼Œå¦‚æœè¦ç”¨åˆ°äº‹åŠ¡ï¼Œè¿˜æ˜¯å¾—åœ¨æ•°æ®åº“ä¸­æ‰§è¡Œã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†é¿å…å¯¹æ•°æ®åº“ä¸­å…¶ä»–æ­£å¸¸ä¸šåŠ¡é€»è¾‘çš„å½±å“ï¼Œä¸€èˆ¬ä¼šæŠŠç§’æ€å•†å“ç‹¬ç«‹æˆåº“ï¼Œé’ˆå¯¹å•†å“idè¿›è¡Œåˆ†è¡¨åˆ†åº“ï¼Œå°½é‡å‡å°‘é”å¸¦æ¥çš„å½±å“ï¼Œå…³é”®æœåŠ¡ç‹¬ç«‹éƒ¨ç½²ï¼Œå¯¹äºæ— éœ€ç‹¬ç«‹éƒ¨ç½²çš„æœåŠ¡ï¼Œå¯ä»¥æ ¹æ®å•†å“idè¿›è¡Œhashåˆ†ç»„è½¬å‘åˆ°ç‹¬ç«‹éƒ¨ç½²çš„æœåŠ¡ï¼Œé¿å…å½±å“å…¶ä»–ä¸šåŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;ç„¶åå°±æ˜¯è¦è§£å†³å¹¶å‘é”çš„é—®é¢˜ï¼Œä¸€ç§æ˜¯åœ¨åº”ç”¨å±‚ï¼ŒæŒ‰ç…§å•†å“ç»´åº¦è®¾ç½®é˜Ÿåˆ—é¡ºåºæ‰§è¡Œï¼Œå‡å°‘åŒä¸€å°æœºå™¨å¯¹æ•°æ®åº“åŒä¸€è¡Œè®°å½•è¿›è¡Œæ“ä½œçš„å¹¶å‘åº¦ï¼ŒåŒæ—¶ä¹Ÿèƒ½æ§åˆ¶å•ä¸ªå•†å“å ç”¨æ•°æ®åº“çš„è¿æ¥æ•°ï¼Œé˜²æ­¢çƒ­ç‚¹å•†å“å ç”¨å¤ªå¤šæ•°æ®åº“è¿æ¥ï¼›å¦ä¸€ç§æ˜¯åœ¨æ•°æ®åº“å±‚é¢æ’é˜Ÿï¼Œå¯¹å•è¡Œè®°å½•åšå¹¶å‘æ’é˜Ÿã€‚&lt;/p&gt;
&lt;p&gt;å‰©ä¸‹çš„å°±è·Ÿä¸Šé¢åº“å­˜çš„æ–¹æ¡ˆå·®ä¸å¤šäº†&lt;/p&gt;
&lt;h2 id=&#34;å…œåº•æ–¹æ¡ˆ&#34;&gt;å…œåº•æ–¹æ¡ˆ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;æœåŠ¡é™çº§ï¼šæ¯”å¦‚å½“ç§’æ€çš„TPSè¾¾åˆ°è®¾å®šçš„é‡çº§ä¹‹åï¼Œæˆäº¤è®°å½•çš„è·å–å±•ç¤ºä»20æ¡é™çº§åˆ°åªå±•ç¤º5æ¡ï¼Œä¸ç›¸å¹²çš„ä¸šåŠ¡æœåŠ¡ä¸´æ—¶ä¸å±•ç¤ºï¼Œåªä¿è¯æ ¸å¿ƒä¸šåŠ¡çº¿çš„æ­£å¸¸æµè½¬&lt;/li&gt;
&lt;li&gt;é™æµã€ç†”æ–­&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;çŸ­é“¾&#34;&gt;çŸ­é“¾&lt;/h1&gt;
&lt;p&gt;æœ¬è´¨ä¸Šå°±æ˜¯ç»™é•¿ç½‘å€å‘å·ï¼Œæ˜ å°„æˆçŸ­ç½‘å€ï¼Œè®¿é—®æ—¶é€šè¿‡301è·³è½¬ï¼›&lt;/p&gt;
&lt;p&gt;çŸ­ç ä¸€èˆ¬éƒ½ç”±&lt;code&gt;[a-zA-Z0-9]&lt;/code&gt;è¿™62ä¸ªå­—ç¬¦ç»„æˆï¼Œä¸€èˆ¬ä¸è¶…è¿‡8ä½ï¼Œ6ä½çš„çŸ­ç å°±å¯ä»¥æœ‰&lt;code&gt;(26+26+10)^6 = 56800235584ï¼Œ568äº¿&lt;/code&gt;ä¸ªäº†ã€‚&lt;/p&gt;
&lt;p&gt;çŸ­ç ç”Ÿæˆæ–¹æ¡ˆï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;åˆ©ç”¨æ•°æ®åº“ç”Ÿæˆè‡ªå¢idï¼Œä½†å› ä¸ºæœ‰åºï¼Œå®¹æ˜“è¢«éå†å‡ºæ¥ï¼Œä¸è¿‡å¯ä»¥é€šè¿‡å¯¹ç”Ÿæˆçš„è‡ªå¢idåšç­¾åæˆ–è€…62ä½è¿›åˆ¶ç”Ÿæˆæœ€åçš„çŸ­ç è§£å†³ï¼›&lt;/p&gt;
&lt;p&gt;æˆ–è€…ä½¿ç”¨å¤šä¸ªRedisè‡ªå¢ï¼Œåªè¦å°†è‡ªå¢çš„æ­¥é•¿è®¾ç½®æˆä¸ä¸€æ ·å°±ä¸ä¼šäº§ç”Ÿå†²çªäº†ï¼Œåªæ˜¯è¦ç»´æŠ¤æ•°æ®çš„æŒä¹…åŒ–å’Œå¥”æºƒæ¢å¤ï¼›&lt;/p&gt;
&lt;p&gt;æˆ–è€…å‘å·å™¨é¢„ç”Ÿæˆä¸€æ‰¹åºå·ï¼Œé¢„ç”Ÿæˆä¸»è¦æ˜¯è§£å†³å†²çªé—®é¢˜ï¼Œæ¥ä¸€ä¸ªé•¿ç½‘å€å°±åˆ†é…ä¸€ä¸ªï¼›&lt;/p&gt;
&lt;p&gt;æˆ–è€…ç›´æ¥UUIDã€é›ªèŠ±ç®—æ³•ç”ŸæˆçŸ­ç ï¼›&lt;/p&gt;
&lt;p&gt;æˆ–è€…åˆ©ç”¨æ•°æ®åº“å”¯ä¸€ç´¢å¼•ï¼Œè‡ªå·±é€šè¿‡éšæœºæ•°ç”ŸæˆçŸ­ç å®ç°ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ‘˜è¦ç®—æ³•ç”Ÿæˆï¼Œæ¯”å¦‚å¯¹é•¿ç½‘å€ç›´æ¥md5ï¼Œå“ˆå¸Œç­‰ï¼Œä¸è¿‡è¦è§£å†³å†²çªï¼Œæ¯”å¦‚åˆ©ç”¨æ•°æ®åº“å”¯ä¸€ç´¢å¼•ï¼Œå†²çªçš„æ—¶å€™å¯ä»¥åœ¨åŸå§‹å­—ç¬¦ä¸²ä¸ŠåŠ ä¸Šé¢„å®šä¹‰çš„å­—ç¬¦ä¸²ï¼Œé‡æ–°å“ˆå¸Œå­˜å…¥åˆ¤æ–­ï¼Œç›´åˆ°æ’å…¥å³å¯ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¸¸ç”¨çš„æ–¹æ¡ˆæ˜¯ä½¿ç”¨ è‡ªå¢id + è¿›åˆ¶è½¬æ¢çš„æ–¹å¼è¿›è¡Œï¼Œå¯ä»¥ç›´æ¥æ•°æ®åº“è‡ªå¢ï¼Œä¹Ÿå¯ä»¥ç”¨å‘å·å™¨ç”Ÿæˆidã€åˆ†å¸ƒå¼idç­‰ï¼›&lt;/p&gt;
&lt;p&gt;ç”ŸæˆçŸ­ç ä¹‹åï¼Œå°† åŸå§‹é•¿ç½‘å€ã€çŸ­ç ã€çŸ­ç½‘å€ã€æœ‰æ•ˆæ—¶é—´ å­˜å…¥æ•°æ®åº“ï¼Œä¹‹åæ ¹æ®æ˜ å°„è¿›è¡Œè·³è½¬å³å¯ï¼›&lt;/p&gt;
&lt;p&gt;æå‡æŸ¥è¯¢æ€§èƒ½å°±ä¸Šç¼“å­˜ï¼Œå…¨é‡ä¿å­˜ä¸å¤ªç°å®ï¼Œå¯ä»¥åªä¿å­˜æœ€è¿‘ä¸€æ®µæ—¶é—´çš„ï¼Œç„¶åLRUæ·˜æ±°å³å¯ï¼›&lt;/p&gt;
&lt;p&gt;é•¿é“¾è½¬çŸ­é“¾å¯ä»¥ä¸€å¯¹ä¸€ä¹Ÿå¯ä»¥ä¸€å¯¹å¤šï¼Œä¸€å¯¹ä¸€çš„è¯å¯ä»¥åˆ¤æ–­åº“é‡Œæ˜¯å¦å­˜åœ¨æ—¶å¯ä»¥ä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨ï¼›&lt;/p&gt;
&lt;p&gt;å…³äºè·³è½¬ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;301æ˜¯æ°¸ä¹…é‡å®šå‘ï¼Œ302æ˜¯ä¸´æ—¶é‡å®šå‘ã€‚çŸ­åœ°å€ä¸€ç»ç”Ÿæˆå°±ä¸ä¼šå˜åŒ–ï¼Œæ‰€ä»¥ç”¨301æ˜¯ç¬¦åˆhttpè¯­ä¹‰çš„ã€‚åŒæ—¶æµè§ˆå™¨ä¼šå¯¹301è¯·æ±‚è¿›è¡Œç¼“å­˜ï¼Œå¯ä»¥å‡è½»æœåŠ¡å™¨å‹åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨301æœ‰åˆ©äºSEOï¼Œ Googleï¼Œç™¾åº¦ç­‰æœç´¢å¼•æ“ï¼Œæœç´¢çš„æ—¶å€™ä¼šç›´æ¥å±•ç¤ºçœŸå®åœ°å€ï¼Œä½†æ­¤æ—¶å°±æ— æ³•ç»Ÿè®¡åˆ°çŸ­åœ°å€è¢«ç‚¹å‡»çš„æ¬¡æ•°äº†ï¼Œä¹Ÿæ— æ³•æ”¶é›†ç”¨æˆ·çš„Cookieï¼ŒUser Agent ç­‰ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯å¯ä»¥ç”¨æ¥åšå¾ˆå¤šæœ‰æ„æ€çš„å¤§æ•°æ®åˆ†æï¼Œä¹Ÿæ˜¯çŸ­ç½‘å€æœåŠ¡å•†çš„ä¸»è¦ç›ˆåˆ©æ¥æºï¼Œå¦‚æœéœ€è¦åˆ©ç”¨è¿™äº›ä¿¡æ¯ï¼Œå°±å¾—ä½¿ç”¨302ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&#34;æµ·é‡æ•°æ®è®¡æ•°&#34;&gt;æµ·é‡æ•°æ®è®¡æ•°&lt;/h1&gt;
&lt;p&gt;æ¯”å¦‚ç‚¹èµæ•°ã€è¯„è®ºæ•°ã€è½¬å‘æ•°ã€æµè§ˆé‡ã€ç²‰ä¸æ•°ã€å…³æ³¨æ•°ç­‰&lt;/p&gt;
&lt;p&gt;ä»¥å¾®åšä¸ºä¾‹ï¼Œå­˜å‚¨æ—¶å¯ä»¥æ ¹æ®å¾®åšIdè¿›è¡Œåˆ†åº“åˆ†è¡¨ï¼Œæ¯”å¦‚å“ˆå¸Œåˆ’åˆ†æˆ–è€…æ—¶é—´æˆ³åˆ’åˆ†ï¼Œå¦‚æœå­˜å‚¨ç»“æ„ä¸º å¾®åšIdã€ç‚¹èµæ•°ã€è¯„è®ºæ•°ã€è½¬å‘æ•°ã€æµè§ˆé‡ç­‰ï¼Œè™½ç„¶ä¸€æ¬¡æŸ¥è¯¢å¯ä»¥æŸ¥å‡ºï¼Œä½†æ˜¯åœ¨å†™å…¥çš„æ—¶å€™ï¼Œç”±äºå„ä¸ªå­—æ®µçš„è®¡ç®—æ˜¯ç‹¬ç«‹è®¡ç®—çš„ï¼Œå†™å…¥æ—¶å°±ä¼šæœ‰é”ç«äº‰ï¼Œå¯¼è‡´å†™å…¥æ€§èƒ½ä¸ä½³ï¼›&lt;/p&gt;
&lt;p&gt;å†™å…¥æ—¶å¯ä»¥ä½¿ç”¨MQå‰Šå³°ï¼Œæ…¢æ…¢æ¶ˆè´¹è®¡æ•°ï¼Œæ›´æ–°æ•°æ®ï¼›&lt;/p&gt;
&lt;p&gt;ä»…ä¾é æ•°æ®åº“+ç¼“å­˜çš„æ–¹å¼èƒ½æ‰¿è½½çš„é‡æ¯”è¾ƒæœ‰é™ï¼Œä¹Ÿå¯èƒ½äº§ç”Ÿæ•°æ®ä¸ä¸€è‡´ï¼Œå€’ä¸å¦‚ç›´æ¥ä½¿ç”¨å¤šèŠ‚ç‚¹Redisæ¥å®ç°è®¡æ•° + æŸ¥è¯¢ï¼Œä¸»ä»ä¿è¯é«˜å¯ç”¨ï¼›&lt;/p&gt;
&lt;p&gt;è®¡æ•°ä»ç„¶ä¼šå­˜åœ¨å­˜å‚¨é—®é¢˜ï¼Œå¯¹äºçƒ­ç‚¹æ•°æ®ï¼Œç›´æ¥Rediså†…å­˜å³å¯ï¼Œå¯¹äºéçƒ­ç‚¹æ•°æ®æˆ–æ—¶é—´æ•‘æ´çš„æ•°æ®ï¼Œå¯ç›´æ¥ä½¿ç”¨ç£ç›˜ï¼›å®šåˆ¶Redisæ•°æ®ç»“æ„ï¼Œè®¾è®¡å­˜å‚¨ç©ºé—´æ›´å°çš„ç»“æ„ï¼›&lt;/p&gt;
&lt;p&gt;å¯¹äºæœªè¯»è®¡æ•°ï¼šæ¯”å¦‚ä¸€ç³»ç»Ÿé€šçŸ¥åˆ—è¡¨ï¼Œè®°å½•å…¨é‡ç”¨æˆ·æœªè¯»æ•°ï¼Œå¦‚æœå…¨é‡ç”¨æˆ·ï¼Œæ¯ä¸ªç”¨æˆ·éƒ½å»è®¡ç®—æœªè¯»æ•°æ˜¯å¤šå°‘ï¼Œé‚£æ•ˆç‡å¤ªå·®äº†ï¼Œæ­£ç¡®çš„åšæ³•æ˜¯ï¼šå› ä¸ºè¿™ä¸ªåˆ—è¡¨å¯¹æ‰€æœ‰ç”¨æˆ·å…±äº«ï¼Œæ‰€æœ‰ç”¨æˆ·éƒ½èƒ½çœ‹åˆ°è¿™ä¸€ä»½ç³»ç»Ÿé€šçŸ¥æ•°æ®ï¼Œä¸åŒçš„äººæœ€è¿‘çœ‹åˆ°çš„æ¶ˆæ¯ä¸åŒï¼Œæ‰€ä»¥æ¯ä¸ªäººå°±ä¼šæœ‰ä¸åŒçš„è®¡æ•°ï¼Œå› æ­¤å¯ä»¥é€šè¿‡è®°å½•æ¯ä¸ªäººçœ‹è¿‡çš„æœ€åä¸€æ¡æ¶ˆæ¯çš„IDï¼Œæ¨æ–­å‡ºè¯¥IDä¹‹åè¿˜æœ‰å¤šå°‘æ¶ˆæ¯æœªè¯»ï¼›&lt;/p&gt;
&lt;p&gt;ç”¨æˆ·çº¢ç‚¹è®¡æ•°æ–¹æ¡ˆï¼šåˆ¤æ–­ç”¨æˆ·æ˜¯å¦ç‚¹è¿‡æŸä¸€ä¸ªé¡µé¢æˆ–åŠŸèƒ½ï¼Œå¯ä»¥ä¸ºæ¯ä¸€ä¸ªç”¨æˆ·å­˜å‚¨ä¸€ä¸ªæ—¶é—´æˆ³ï¼Œä»£è¡¨æœ€è¿‘ç‚¹è¿‡è¿™ä¸ªçº¢ç‚¹çš„æ—¶é—´ï¼Œç”¨æˆ·ç‚¹äº†è¿™ä¸ªçº¢ç‚¹ï¼Œå°±æ›´æ–°è¿™ä¸ªæ—¶é—´æˆ³ï¼Œç„¶åæˆ‘ä»¬å†è®°å½•ä¸€ä¸ªå…¨å±€æ—¶é—´æˆ³ï¼Œé€šè¿‡è¿™ä¸ªå…¨å±€æ—¶é—´æˆ³ä¸ç”¨æˆ·ç‚¹å‡»çš„æ—¶é—´æˆ³æ¯”è¾ƒï¼Œåˆ¤æ–­æ˜¯å¦è¦å±•ç¤ºçº¢ç‚¹ï¼›&lt;/p&gt;
&lt;p&gt;åŸºäºå…³ç³»çš„ä¿¡æ¯æµæœªè¯»æ–¹æ¡ˆï¼šé€šç”¨è®¡æ•°å™¨è®°å½•æ¯ä¸€ä¸ªç”¨æˆ·å‘å¸ƒçš„åšæ–‡æ•°ï¼Œåœ¨Redisä¸­è®°å½•ä¸€ä¸ªäººæ‰€æœ‰å…³æ³¨äººçš„åšæ–‡æ•°å¿«ç…§ï¼Œå½“ç”¨æˆ·ç‚¹å‡»æœªè¯»æ¶ˆæ¯æ—¶é‡ç½®æœªè¯»æ•°ä¸º0æ—¶ï¼Œå°†ä»–å…³æ³¨æ‰€æœ‰äººçš„åšæ–‡æ•°æ›´æ–°åˆ°å¿«ç…§ä¸­ï¼Œæ­¤æ—¶ï¼Œä»–å…³æ³¨çš„æ‰€æœ‰äººçš„åšæ–‡æ•°å‡å»å¿«ç…§ä¸­çš„åšæ–‡æ•°å°±æ˜¯ä»–ä¿¡æ¯æµçš„æœªè¯»æ•°äº†ï¼Œä¸è¿‡æ­¤æ–¹æ¡ˆä¼šå­˜åœ¨ä¸€ç‚¹è¯¯å·®ã€‚&lt;/p&gt;
&lt;h2 id=&#34;è®¡æ•°å™¨rediså®ç°&#34;&gt;è®¡æ•°å™¨Rediså®ç°&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;è®°å½•å’Œæ›´æ–°&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨hashè®°å½•è®¡æ•°å€¼ï¼Œkeyä¸º&lt;code&gt;è®¡æ•°å™¨åç§°:æ—¶é—´ç²¾åº¦&lt;/code&gt;ï¼Œfieldæ˜¯ä¸€ä¸ªæ—¶é—´æˆ³ï¼Œè¡¨ç¤ºå½“å‰æ—¶é—´ç‰‡å¼€å§‹æ—¶é—´ï¼ˆ&lt;code&gt;è®¡ç®—æ–¹å¼ å½“å‰æ—¶é—´ / æ—¶é—´ç²¾åº¦ * æ—¶é—´ç²¾åº¦&lt;/code&gt;ï¼‰ï¼Œhash valueæ˜¯è®¡æ•°å€¼ï¼›å‘½ä»¤ï¼š&lt;code&gt;hincrby counter:5 1682045703000 1&lt;/code&gt;ï¼Œè¡¨ç¤ºç»Ÿè®¡5ç§’å†…çš„è®¡æ•°&lt;/p&gt;
&lt;p&gt;å› ä¸ºè¦ä¿å­˜æ‰€æœ‰çš„æ—¶é—´ç²¾åº¦ï¼Œåˆéœ€è¦ä¿è¯ä¸ä¼šé‡å¤ï¼Œæ‰€ä»¥ä½¿ç”¨zsetç”¨äºæ¸…é™¤æ—§æ•°æ®ï¼Œkeyä¸ºéšä¾¿èµ·ï¼Œæ˜¯ä¸€ä¸ªå®šå€¼ï¼Œvalueä¸ºæ—¶é—´ç²¾åº¦+è®¡æ•°å™¨åç§°ï¼Œsocreä¸º0ï¼Œå‘½ä»¤ï¼š&lt;code&gt;zadd countSort 0 counter:5&lt;/code&gt;ï¼Œsocreè®¾ç½®ä¸º0æ˜¯ä¸ºäº†è®©zsetåªæ ¹æ®valueæŒ‰å­—æ¯åºæ’åˆ—ï¼Œæ–¹ä¾¿åç»­è·å–&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æŸ¥è¯¢ï¼š&lt;code&gt;hgetall è®¡æ•°å™¨åç§°:æ—¶é—´ç²¾åº¦&lt;/code&gt;ï¼Œç„¶åæ’åºéå†ï¼Œå³å¯è·å–å„ä¸ªæ—¶é—´ç‰‡çš„è®¡æ•°&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ¸…é™¤æ—§å€¼&lt;/p&gt;
&lt;p&gt;è®¾å®šä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡ï¼Œå¯¹äºæ¯ç§’æ›´æ–°ä¸€æ¬¡æˆ–æ¯5ç§’æ›´æ–°ä¸€æ¬¡çš„è®¡æ•°å™¨ï¼Œå¼‚æ­¥ä»»åŠ¡å¯ä»¥æŒ‰æ¯åˆ†é’Ÿçš„é¢‘ç‡æ¸…é™¤æ—§æ•°æ®ï¼Œä»è€Œä¿è¯åªå­˜å‚¨ä¸€å®šçš„æ•°é‡ï¼Œé¿å…bigkeyé—®é¢˜&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚åˆ†é¡µéå† zsetï¼Œæ ¹æ®valueï¼ŒæŸ¥ hashï¼Œç„¶åç§»é™¤hashé‡Œå¤±æ•ˆæ—¶é—´èŒƒå›´å†…çš„å…ƒç´ ï¼›ç”±äºå­˜åœ¨è¦†ç›–é—®é¢˜ï¼Œå¦‚æœè¦ä¿è¯è®¡æ•°æ­£ç¡®ï¼Œéœ€è¦ä½¿ç”¨luaè„šæœ¬ï¼Œä¿è¯æ•´ä¸ªè¿‡ç¨‹åŸå­ï¼Œå¦‚æœä¸careï¼Œç›´æ¥ç¨‹åºå¤„ç†å³å¯ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;å­˜å‚¨ç»Ÿè®¡æ•°æ®rediså®ç°&#34;&gt;å­˜å‚¨ç»Ÿè®¡æ•°æ®Rediså®ç°&lt;/h2&gt;
&lt;p&gt;åœºæ™¯ï¼šç»Ÿè®¡å‰ä¸€å°æ—¶å’Œå½“å‰ä¸€å°æ—¶å†…çš„æ•°æ®çš„æœ€å€¼&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;è®°å½•å’Œæ›´æ–°&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ ä¸¤ä¸ªstring è®°å½•å½“å‰å°æ—¶æ•°ã€å€¼å’Œä¸Šä¸€ä¸ªå°æ—¶å€¼ï¼Œæ¯”å¦‚ ä¸Šä¸€ä¸ªæ—¶é—´æ˜¯ 12:23 ï¼Œå­˜å‚¨å‘½ä»¤å°±æ˜¯ &lt;code&gt;set lastHour 12&lt;/code&gt;ï¼›&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ä¸¤ä¸ªzsetä¿å­˜ä¸´æ—¶çš„ç»Ÿè®¡æ•°æ®ï¼Œä½¿ç”¨zsetå¹¶éä¸ºäº†æŒ‰socreè¿›è¡Œæ’åºï¼Œè€Œæ˜¯è¦å¯¹è¿™ä¸¤ä¸ªzsetåšå¹¶é›†å’Œèšåˆè¿ç®—ï¼Œä½¿ç”¨redisçš„å†…ç½®å‡½æ•°ï¼Œä½¿ç”¨å‘½ä»¤&lt;code&gt;zunionstore + èšåˆå‡½æ•°ï¼Œæ¯”å¦‚max()ã€min()&lt;/code&gt;ï¼›&lt;/p&gt;
&lt;p&gt;å°†ä¸¤ä¸ªä¸´æ—¶ä¿å­˜ç»Ÿè®¡æ•°æ®çš„zsetåšä¸€å®šçš„è¿ç®—åå¾—åˆ°æœ€ç»ˆç»“æœzsetï¼Œç„¶ååˆ é™¤ä¸´æ—¶çš„ä¸¤ä¸ªzsetï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;feedæµ&#34;&gt;feedæµ&lt;/h1&gt;
&lt;h2 id=&#34;æ¨æ¨¡å¼---å†™æ‰©æ•£&#34;&gt;æ¨æ¨¡å¼ - å†™æ‰©æ•£&lt;/h2&gt;
&lt;p&gt;ç”¨æˆ·å‘é€ä¸€æ¡å¾®åšï¼Œä¸»åŠ¨å°†è¿™æ¡å¾®åšæ¨é€ç»™ä»–çš„ç²‰ä¸ï¼Œå³ï¼Œä¸ºè¯¥ç”¨æˆ·å’Œå…¶ç²‰ä¸insertä¸€æ¡å¾®åšæ•°æ®ï¼Œç²‰ä¸æŸ¥çœ‹å¾®åšæ—¶ï¼Œç›´æ¥ä¸€æ¡sqlå³å¯æŸ¥è¯¢å¾—åˆ°ï¼›å› ä¸ºå†™å…¥å‹åŠ›å’Œå­˜å‚¨å‹åŠ›é—®é¢˜ï¼Œæ¯”è¾ƒé€‚åˆç²‰ä¸æ•°æœ‰é™çš„åœºæ™¯ï¼›&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å­˜åœ¨çš„é—®é¢˜&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å¦‚æœç”¨æˆ·çš„ç²‰ä¸å¾ˆå¤šï¼Œå°½ç®¡å¯ä»¥å¼‚æ­¥æˆ–æ¶ˆæ¯é˜Ÿåˆ—ä¸ºå…¶ç²‰ä¸å†™å…¥å¾®åšæ•°æ®ï¼Œä»ç„¶ä¼šå­˜åœ¨ä¸€å®šçš„å»¶è¿Ÿï¼Œå¯èƒ½å‡ºç°è¯¥ç”¨æˆ·å‘äº†å¾®åšä¹‹åï¼Œå…¶éƒ¨åˆ†ç²‰ä¸è¦å»¶è¿Ÿå¾ˆä¹…æ‰èƒ½çœ‹åˆ°æ•°æ®ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¯¹äºå…¨å¹³å°å¯è§çš„å¾®åšï¼Œå¦‚æœå…¨é‡ä¸ºæ‰€æœ‰ç”¨æˆ·éƒ½insertä¸€æ¡å¾®åšæ•°æ®ï¼Œæ•°æ®é‡å¤ªå¤§ï¼Œå¦‚æœæ¯ä¸ªç”¨æˆ·ä¸‹è¿˜æœ‰åˆ†ç»„ï¼Œå†™å…¥é‡å°±æ›´å¤§äº†ï¼Œå†™å…¥æ€§èƒ½ä¼šæ”¶åˆ°å¾ˆå¤§çš„å½±å“ï¼Œå­˜å‚¨æˆæœ¬å¾ˆé«˜ï¼›&lt;/p&gt;
&lt;p&gt;å°½ç®¡åªéœ€è¦ç»´æŠ¤idçš„å…³ç³»æ˜ å°„ï¼Œä½†è¿˜æ˜¯æ¶ä¸ä½é‡å¤šï¼Œå¾®åšçš„å±•ç¤ºè¿˜æ˜¯æ ¹æ®idå»æ•°æ®åº“æˆ–ç¼“å­˜é‡ŒæŸ¥è¯¢ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¦‚æœå‘ç”Ÿåˆ é™¤å¾®åšã€ç”¨æˆ·å–å…³æ“ä½œï¼Œå¯¹åº”çš„å¾®åšéœ€è¦åˆ é™¤ï¼Œä¹Ÿä¼šäº§ç”Ÿå¤§é‡å†™æ“ä½œï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;è§£å†³æ–¹æ¡ˆ&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å†™å…¥æ—¶é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—æ¶ˆè´¹ï¼Œå¹¶è¡Œå†™å…¥ï¼ŒåŠ å¿«å†™å…¥é€Ÿåº¦ï¼›&lt;/li&gt;
&lt;li&gt;å­˜å‚¨æ—¶ä½¿ç”¨å‹ç¼©ç‡é«˜çš„æ•°æ®åº“/å­˜å‚¨å¼•æ“ï¼Œæ¯”å¦‚MySQLçš„TokuDB(å…¶ä½¿ç”¨åˆ†å½¢æ ‘ç´¢å¼•ï¼Œå¯ä»¥å°†æ•°æ®çš„éšæœºå†™å…¥è½¬æˆé¡ºåºå†™å…¥ï¼Œå†™å…¥é€Ÿåº¦å¿«ï¼Œå‹ç¼©ç‡é«˜ï¼Œä½†æ˜¯åˆ é™¤å’ŒæŸ¥è¯¢çš„æ€§èƒ½å·®å†™)ï¼›&lt;/li&gt;
&lt;li&gt;å†™å…¥æ—¶åˆ†åº“åˆ†è¡¨å‡å°‘å‹åŠ›ï¼›å®šæœŸæ¸…ç†æ—¶é—´å¤ªä¹…çš„æ•°æ®ï¼Œè½¬ç§»åˆ°å…¶ä»–è¡¨ä¸­ï¼Œå‡å°‘å­˜å‚¨å‹åŠ›ï¼›&lt;/li&gt;
&lt;li&gt;å¦‚æœå‘ç”Ÿåˆ é™¤å¾®åšã€ç”¨æˆ·å–å…³æ“ä½œï¼Œå¯¹åº”çš„å¾®åšéœ€è¦åˆ é™¤ï¼Œå‹åŠ›ä¹Ÿä¼šæ¯”è¾ƒå¤§ï¼Œåªèƒ½å…ˆåˆ¤æ–­ç”¨æˆ·æ˜¯å¦å–å…³æˆ–å¾®åšæ˜¯å¦åˆ é™¤æ¥åˆ¤æ–­æ˜¯å¦å±•ç¤ºå³å¯ï¼Œå°½é‡å‡å°‘å¤šä½™çš„å†™æ“ä½œï¼›&lt;/li&gt;
&lt;li&gt;è¯»å–æ—¶é€šè¿‡ç¼“å­˜è¯»å–ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;æ‹‰æ¨¡å¼---è¯»æ‰©æ•£&#34;&gt;æ‹‰æ¨¡å¼ - è¯»æ‰©æ•£&lt;/h2&gt;
&lt;p&gt;ç”¨æˆ·ä¸»åŠ¨æ‹‰å–å…¶å…³æ³¨åˆ—è¡¨ï¼ŒæŸ¥è¯¢æ‰€æœ‰äººçš„å¾®åšï¼Œå†å°†è¿™äº›å¾®åšæŒ‰å‘å¸ƒæ—¶é—´å€’å™æ’åˆ—èšåˆï¼Œå½¢æˆä¿¡æ¯æµã€‚&lt;/p&gt;
&lt;p&gt;ç›¸æ¯”æ¨æ¨¡å¼ï¼Œæ‹‰æ¨¡å¼è§£å†³äº†å†™å…¥å»¶è¿Ÿä»¥åŠå­˜å‚¨é—®é¢˜&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å­˜åœ¨çš„é—®é¢˜ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¯¹æŸ¥è¯¢å‡ºçš„å¾®åšåšèšåˆæ—¶æˆæœ¬æ¯”è¾ƒé«˜ï¼›&lt;/li&gt;
&lt;li&gt;æŸ¥è¯¢æ•°æ®é‡å¤§ï¼Œå¯¼è‡´ç¼“å­˜æŸ¥è¯¢å¸¦å®½å‹åŠ›å¤§ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;è§£å†³æ–¹æ¡ˆï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åˆ†æç”¨æˆ·è¡Œä¸ºï¼Œæ¯”å¦‚å¦‚æœå¤§éƒ¨åˆ†ç”¨æˆ·åªæŸ¥çœ‹æœ€è¿‘5å¤©çš„æ•°æ®ï¼Œå°±å¯ä»¥åªç¼“å­˜æœ€è¿‘5å¤©çš„å¾®åšidï¼Œç”¨äºæŸ¥è¯¢èšåˆï¼›&lt;/li&gt;
&lt;li&gt;åˆ†æ•£ç¼“å­˜èŠ‚ç‚¹ï¼Œè®¾ç½®å¤šçº§ç¼“å­˜ï¼ŒæŸ¥ä¸åˆ°å†æŸ¥ä¸»ç¼“å­˜&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;æ¨æ‹‰ç»“åˆæ¨¡å¼&#34;&gt;æ¨æ‹‰ç»“åˆæ¨¡å¼&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å¯¹äºå¤§Vç”¨æˆ·ï¼Œå‘å¸ƒå¾®åšæ—¶ï¼Œä½¿ç”¨æ¨æ¨¡å¼ï¼Œä½†æ˜¯ä¸å†æ¨é€åˆ°å…¨é‡ç”¨æˆ·ï¼Œè€Œæ˜¯ç»™å¤§Vç”¨æˆ·ç»´æŠ¤ä¸€ä¸ªå®šé•¿çš„æ´»è·ƒç²‰ä¸åˆ—è¡¨ ä»¥åŠ åœ¨çº¿ç”¨æˆ·ï¼Œåªæ¨é€ æˆ– ä¼˜å…ˆæ¨é€ ç»™è¿™ç±»ç”¨æˆ·ï¼Œæ´»è·ƒç²‰ä¸åˆ—è¡¨å’Œç”¨æˆ·åœ¨çº¿çŠ¶æ€ä¼šè¿›è¡Œå®šæ—¶æ›´æ–°ï¼›ä»è€Œè¾¾åˆ°å¯æ§çš„æ¨é€å»¶è¿Ÿï¼Œä¸è¿‡åŒæ—¶å› ä¸ºè¦ç»´æŠ¤æ´»è·ƒç²‰ä¸åˆ—è¡¨å’Œç”¨æˆ·çŠ¶æ€ï¼Œåˆéœ€è¦æ›´å¤šçš„å­˜å‚¨æˆæœ¬ï¼›&lt;/p&gt;
&lt;p&gt;ä¸æ´»è·ƒç”¨æˆ·ï¼Œéåœ¨çº¿ç”¨æˆ·åªæœ‰ä¸Šçº¿åä¸»åŠ¨æ‹‰å–æ¶ˆæ¯ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ™®é€šç”¨æˆ·ä½¿ç”¨æ‹‰æ¨¡å¼å³å¯ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;å¼¹å¹•&#34;&gt;å¼¹å¹•&lt;/h1&gt;
&lt;p&gt;ç”¨æˆ·è¿›å…¥è§†é¢‘ / ç›´æ’­é—´ é¡µé¢ï¼Œæ‹‰å–æ­£åœ¨è§‚çœ‹è§†é¢‘çš„ç”¨æˆ·åˆ—è¡¨ï¼Œæ¥æ”¶æŒç»­å‘å¸ƒçš„å¼¹å¹•æ¶ˆæ¯ï¼Œè‡ªå·±å‘æ¶ˆæ¯ã€‚&lt;/p&gt;
&lt;p&gt;å¼¹å¹•è¦åˆ†æ¸…æ˜¯éœ€è¦å®æ—¶è¿˜æ˜¯å¯æ¥å—å»¶è¿Ÿï¼Œæ˜¯ç›´æ’­çš„æ—¶å€™ç”¨ï¼Œè¿˜æ˜¯è§†é¢‘ã€å½•æ’­çš„æ—¶å€™ç”¨ï¼Œè¿™æ¶‰åŠåˆ°å¼¹å¹•ä¿¡æ¯è¦ä¸è¦ä¿å­˜ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œå®¢æˆ·ç«¯æ¥æ”¶å¼¹å¹•ä¿¡æ¯æœ‰ä»¥ä¸‹ä¸¤ç§æ–¹æ¡ˆï¼š&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å®¢æˆ·ç«¯è½®è¯¢&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ç”¨æˆ·åœ¨å‰ç«¯å†™å…¥æ¶ˆæ¯ï¼Œæ¶ˆæ¯å‘å¾€æœåŠ¡ç«¯ï¼Œä¸ºæ¶ˆæ¯èµ‹å®Œåºå·åï¼Œç›´æ¥ä¸¢ç»™kafkaï¼Œä¸‹æ¸¸æœåŠ¡æ¶ˆè´¹kafaçš„æ¶ˆæ¯ï¼Œå°†æ¶ˆæ¯å­˜å…¥Redisï¼ˆä»¥Zaddçš„æ–¹å¼å†™å…¥ï¼Œscoreæ¶ˆæ¯çš„å°é˜Ÿæ—¶é—´ï¼‰ï¼›&lt;/p&gt;
&lt;p&gt;å‰ç«¯æ¯2så‘åç«¯å‘èµ·è½®è¯¢ï¼Œåç«¯æŸ¥è¯¢Redisè¿”å›ï¼›&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯å®¢æˆ·ç«¯è½®è¯¢çš„æ–¹å¼ï¼Œå§‹ç»ˆå¯¹æœåŠ¡ç«¯çš„å‹åŠ›è¾ƒå¤§ï¼Œä¸€èˆ¬é‡‡ç”¨websocketé•¿è¿æ¥çš„æ–¹å¼è¿›è¡Œæ¨é€å¼¹å¹•ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Websocket&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æ­¤æ–¹æ¡ˆæœ€ä½³ï¼ŒCDN + é•¿è¿æ¥(websocket) å¹¿æ’­ç»™ç”¨æˆ·ï¼ŒåŸç†è·ŸèŠå¤©å®¤å·®ä¸å¤šï¼›&lt;/p&gt;
&lt;p&gt;ä¸ä¸Šé¢çš„æ–¹æ¡ˆå·®ä¸å¤šï¼Œåªæ˜¯æŠŠå‰ç«¯è½®è¯¢éƒ¨åˆ†æ›¿æ¢æˆäº†ç”±åç«¯ä¸å‰ç«¯å»ºç«‹é•¿è¿æ¥åè¿›è¡Œæ¨é€ã€‚&lt;/p&gt;
&lt;p&gt;å¸¸è§ç›´æ’­å¼¹å¹•æ–¹æ¡ˆï¼Œç”±äºéœ€è¦å®æ—¶ï¼šç”¨æˆ·æŠŠå¼¹å¹•ä¿¡æ¯å‘é€åˆ°å¼¹å¹•å¤„ç†æœåŠ¡ï¼Œå¯¹æ•æ„Ÿè¯ç­‰è¿›è¡Œå¤„ç†ï¼Œæ¥æ”¶å¤„ç†åå°†å¼¹å¹•ä¿¡æ¯å‘é€ç»™Kafkaç­‰æ¶ˆæ¯é˜Ÿåˆ—ï¼Œä½¿ç”¨å‘å¸ƒè®¢é˜…çš„æ–¹å¼ï¼Œæ¶ˆè´¹å¼¹å¹•æ¶ˆæ¯çš„æ¶ˆè´¹è€…æœåŠ¡æœ‰å¤šç§ï¼Œæ¯”å¦‚æ˜¯å¼¹å¹•å­˜å‚¨æœåŠ¡ï¼ŒæŒä¹…åŒ–å¼¹å¹•æ•°æ®ï¼›æ¯”å¦‚æœ‰é•¿è¿æ¥æœåŠ¡ï¼Œæ¶ˆè´¹å¼¹å¹•æ¶ˆæ¯ï¼Œæ ¹æ®å¼¹å¹•æ¶ˆæ¯æ•°æ®åˆ¤æ–­å¼¹å¹•è¦æ¨é€åˆ°å“ªä¸ªç›´æ’­é—´ï¼Œé‡å¤§çš„æ—¶å€™ï¼Œé•¿è¿æ¥æœåŠ¡éœ€è¦è®¾ç½®åˆ†ç‰‡ï¼Œæ§åˆ¶æ¯å°é•¿è¿æ¥æœåŠ¡ä¸å®¢æˆ·ç«¯çš„è¿æ¥ï¼›å¦‚æœå¼¹å¹•æ¶ˆæ¯å¤„ç†ä¸è¿‡æ¥ï¼Œå°±éšæœºä¸¢ï¼Œæ§åˆ¶å®¢æˆ·ç«¯æ¥æ”¶å¼¹å¹•æ¥æ”¶æ•°é‡ï¼Œæˆ–è€…é•¿è¿æ¥æœåŠ¡é™æµæ§åˆ¶æ¨é€ç»™å®¢æˆ·ç«¯çš„å¼¹å¹•æ•°é‡ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ¶ˆæ¯çš„å·²è¯»æœªè¯»&#34;&gt;æ¶ˆæ¯çš„å·²è¯»æœªè¯»&lt;/h2&gt;
&lt;p&gt;å…ˆå·²è¯»æœªè¯»å‘é€åœ¨ä¸¤ä¸ªäººå¯¹è¯æˆ–è€…å¤šäººç¾¤é‡Œé¢ï¼Œå½“ç„¶ä¸¤ä¸ªäººä¹Ÿå¯ä»¥ç†è§£æˆä¸€ä¸ªç¾¤ï¼Œä¸€ä¸ªç¾¤å¯¹åº”ä¸€ä¸ªbitmapã€‚åœ¨è¿™ä¸ªç¾¤é‡Œé¢ï¼Œæ‰€æœ‰äººéƒ½è¦å¯¹è¿™æ¡æ¶ˆæ¯å­˜åœ¨å·²è¯»æœªè¯»çš„æƒ…å†µï¼Œå³ä¸€ä¸ªç¾¤å¯¹åº”å¤šæ¡æ¶ˆæ¯ï¼Œæ¯æ¡æ¶ˆæ¯å¯¹åº”å¤šä¸ªäººï¼Œæ¯æ¡æ¶ˆæ¯å¯¹æ¯ä¸ªäººå­˜åœ¨å·²è¯»æœªè¯»çŠ¶æ€ã€‚&lt;/p&gt;
&lt;p&gt;æ•°æ®é‡å°çš„ï¼Œç›´æ¥DBæ“ä½œå³å¯ï¼›&lt;/p&gt;
&lt;p&gt;æ¶ˆæ¯é‡å¤§çš„ï¼Œä½¿ç”¨Redisçš„bitmapå®ç°ï¼Œå‰é¢çš„setå¯ä»¥ç”¨æ¥åˆ¤æ–­å“ªä¸ªç”¨æˆ·è¿›ç¾¤æ²¡è¿›ç¾¤ï¼š&lt;/p&gt;
&lt;p&gt;ç¬¬ä¸€ç§ï¼šä¸€ä¸ªç¾¤å¯¹åº”ä¸€ä¸ªsetï¼Œkeyæ˜¯ç¾¤idï¼Œvalueæ˜¯userIdï¼Œæ¯ä¸ªç”¨æˆ·å¯¹åº”ä¸€ä¸ªbitmapï¼Œkeyæ˜¯ç¾¤id+userIdï¼Œoffsetæ˜¯æ¶ˆæ¯çš„idï¼Œvalueè¡¨ç¤ºå·²è¯»æœªè¯»ï¼Œæˆ–è€…åªè®°å½•å·²è¯»ï¼›&lt;/p&gt;
&lt;p&gt;ç¬¬äºŒç§ï¼šä¸€ä¸ªç¾¤å¯¹åº”ä¸€ä¸ªsetï¼Œkeyæ˜¯ç¾¤idï¼Œvalueæ˜¯userIdï¼Œæ¯æ¡æ¶ˆæ¯å¯¹åº”ä¸€ä¸ªbitmapï¼Œkeyæ˜¯ç¾¤id+æ¶ˆæ¯idï¼Œoffsetæ˜¯userIdï¼Œvalueè¡¨ç¤ºå·²è¯»æœªè¯»ï¼Œæˆ–è€…åªè®°å½•å·²è¯»ï¼›è¿™ç§å†…å­˜æ¶ˆè€—ä¼šå°‘ä¸€ç‚¹&lt;/p&gt;
&lt;p&gt;å½“idä½œä¸ºbitmapçš„offsetæ—¶ï¼Œéœ€è¦ä¿è¯å¹³å‡æ•£è½ï¼Œæ¯”å¦‚è¿›è¡Œå“ˆå¸Œåå†æ”¾åˆ°offseté‡Œï¼Œé˜²æ­¢åªç”¨åˆ°äº†ä¸€éƒ¨åˆ†çš„offsetã€‚&lt;/p&gt;
&lt;h1 id=&#34;ipä¸æ•°å­—çš„è½¬æ¢&#34;&gt;IPä¸æ•°å­—çš„è½¬æ¢&lt;/h1&gt;
&lt;p&gt;ipv4æœ¬è´¨ä¸Šæ˜¯32ä½çš„äºŒè¿›åˆ¶å­—ç¬¦ä¸²ï¼Œä¸€ä¸ªintæ•´æ•°åˆšå¥½æ˜¯4ä¸ªå­—èŠ‚32ä½ï¼Œæ‰€ä»¥ä¸€ä¸ªintæ•´æ•°å¯ä»¥è¡¨ç¤ºä¸€ä¸ªipv4åœ°å€ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;ipåœ°å€ = ç¬¬ä¸€æ®µå·¦ç§»24ä½ + ç¬¬äºŒæ®µå·¦ç§»16ä½ + ç¬¬ä¸‰æ®µå·¦ç§» 8ä½ + ç¬¬å››æ®µ = ç¬¬ä¸€æ®µ * 256 * 256 * 256 + ç¬¬äºŒæ®µ * 256 * 256 + ç¬¬ä¸‰æ®µ * 256 + ç¬¬å››æ®µ&lt;/code&gt;ï¼ŒèŒƒå›´æ˜¯ 0 ~ 4,294,967,295ï¼ˆ2^32 - 1ï¼‰&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// ipå­—ç¬¦ä¸²è½¬æ•´å‹ï¼š
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;result&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;
&lt;span class=&#34;nx&#34;&gt;ips&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;strings&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Split&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;part&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;range&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ips&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;partInt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;strconv&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Atoi&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;part&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;result&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;partInt&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;result&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;8&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;// æ•´å‹è½¬ipå­—ç¬¦ä¸²ï¼š
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;result&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;strconv&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Itoa&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;24&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&#34;mh&#34;&gt;0xff&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;.&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;strconv&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Itoa&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;16&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&#34;mh&#34;&gt;0xff&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;.&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;strconv&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Itoa&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;8&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&#34;mh&#34;&gt;0xff&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;.&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;strconv&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Itoa&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&#34;mh&#34;&gt;0xff&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;æ ¹æ®IPæŸ¥è¯¢å›½å®¶ï¼ˆæ¯”å¦‚ç»™å®šä¸€æ‰¹æ•°æ®æ˜¯ {å¼€å§‹çš„ip, ç»“æŸip, å›½å®¶}ï¼‰ï¼Œä½¿ç”¨Redisåšç¼“å­˜ï¼Œå®ç°æ–¹æ¡ˆï¼š&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨Redisçš„zsetç»“æ„ï¼Œkeyæ˜¯å®šå€¼ï¼Œæ¯”å¦‚å«ip2Countryï¼Œscoreæ˜¯IPè½¬æ•°å­—ï¼Œvalueæ˜¯å›½å®¶äºŒå­—ç +ä¸€å®šçš„æ ‡è¯†ï¼ˆéœ€è¦åŠ æ ‡è¯†æ˜¯å› ä¸ºzsetçš„valueæ˜¯å”¯ä¸€ï¼‰ï¼Œæ¯”å¦‚å¦‚æœipæ˜¯å¼€å§‹ipï¼Œæ ‡è¯†å°±åŠ beginï¼Œç»“æŸipå°±åŠ endï¼Œå¦‚æœä¸€ä¸ªå›½å®¶ä¼šå¯¹åº”å¤šæ¡IPèµ·å§‹èŒƒå›´ï¼Œåˆ™æ ‡è¯†è¿˜è¦åŠ ä¸Šæ•°å­—&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯è¿™ç§æ–¹æ¡ˆæœ‰ä¸ªç¼ºç‚¹ï¼Œå°±æ˜¯æ— æ³•å¤„ç†ipèŒƒå›´é‡å çš„æƒ…å†µï¼Œæ‰€ä»¥æœ€å¥½è¿˜æ˜¯DBå­˜ï¼Œå­˜ipçš„å­—ç¬¦ä¸²ï¼Œè¿˜æœ‰è½¬æˆæ•°å­—åçš„å¼€å§‹ipå’Œç»“æŸip&lt;/p&gt;
&lt;p&gt;å­˜å‚¨æ—¶ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;æ¯”å¦‚æœ‰ä¸€æ¡æ•°æ®æ˜¯ 2.255.1.40, 5.2.255.255, CN
å³ipåœ¨ä»¥ 2.255.1.40 å¼€å§‹ï¼Œä»¥ 5.2.255.255 ç»“æŸ èŒƒå›´å†…ï¼Œå¯¹åº”çš„å›½å®¶äºŒå­—ç æ˜¯ CN
è½¬æˆæ•°å­—å°±æ˜¯ 50266408, 84082687, CN

å­˜åˆ°redisæ—¶ï¼Œå¯¹åº”çš„å‘½ä»¤å°±æ˜¯
zadd ip2Country 50266408 begin_1_CN
zadd ip2Country 84082687 end_1_CN
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æŸ¥è¯¢æ—¶ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;æ¯”å¦‚æœ‰ip 2.255.1.41ï¼Œè½¬æˆæ•°å­—æ˜¯ 50266409ï¼ŒæŸ¥è¯¢redisæ—¶ï¼Œä½¿ç”¨å‘½ä»¤
zrevrangebyscore ip2Country 50266409 0 LIMIT 0 1   
# åé¢çš„LIMITå¾ˆå…³é”®ï¼Œè¿™ä¸ªå‘½ä»¤æ—¶é—´å¤æ‚åº¦æ˜¯ O(log(N)+M)ï¼Œ Næ˜¯zsetçš„æ€»æ•°é‡ï¼ŒMæ˜¯æŸ¥è¯¢åˆ°çš„ç»“æœé›†çš„æ•°é‡

è¯¥å‘½ä»¤è¡¨ç¤ºæŸ¥è¯¢ keyä¸ºip2Countryçš„zsetï¼Œsocreä»é«˜åˆ°ä½æ’åˆ—ï¼Œè¿”å›socreä»0åˆ°50266409èŒƒå›´å†…çš„å…ƒç´ çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œæ‰€ä»¥ä¼šè¿”å›æœ€æ¥è¿‘ä¸”å°äºç­‰äº 50266409 çš„å…ƒç´ ï¼Œç„¶åè¿›è¡Œåˆ¤æ–­ï¼š
1. å¦‚æœè¿”å›å€¼ä¸ºç©ºï¼Œè¯´æ˜æ²¡æ‰¾åˆ°å¯¹åº”çš„ipèŒƒå›´
2. å¦‚æœæ˜¯startå¼€å¤´ï¼Œè¯´æ˜æ‰¾åˆ°äº†å¯¹åº”çš„å›½å®¶äºŒå­—ç 
3. å¦‚æœæ˜¯endå¼€å¤´ï¼Œè¯´æ˜æ²¡æ‰¾åˆ°å¯¹åº”çš„ipèŒƒå›´ 
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;æ‰«ç ç™»å½•&#34;&gt;æ‰«ç ç™»å½•&lt;/h1&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/PC%e7%ab%af%e6%89%ab%e7%a0%81%e7%99%bb%e5%bd%95.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/PC%e7%ab%af%e6%89%ab%e7%a0%81%e7%99%bb%e5%bd%95.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;h1 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h1&gt;
&lt;p&gt;æå®¢æ—¶é—´ - åç«¯å­˜å‚¨å®æˆ˜&lt;/p&gt;
&lt;p&gt;æå®¢æ—¶é—´ - ç§’æ€ç³»ç»Ÿè®¾è®¡&lt;/p&gt;
</description>
        </item>
        <item>
        <title>å…¶ä»–</title>
        <link>http://nixum.cc/p/%E5%85%B6%E4%BB%96/</link>
        <pubDate>Tue, 22 Sep 2020 00:00:00 +0000</pubDate>
        
        <guid>http://nixum.cc/p/%E5%85%B6%E4%BB%96/</guid>
        <description>&lt;p&gt;[TOC]&lt;/p&gt;
&lt;h1 id=&#34;quartz&#34;&gt;Quartz&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼še&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Job&amp;amp;Detial(ä»»åŠ¡)ï¼šå®šæ—¶ä»»åŠ¡çš„æ‰§è¡Œæ–¹æ³•ï¼Œä¸Triggeré…å¥—çš„&lt;/li&gt;
&lt;li&gt;Trigger(è§¦å‘å™¨)ï¼šè§„å®šä»€ä¹ˆæ—¶å€™è§¦å‘ï¼Œä¸Job&amp;amp;Detailé…å¥—çš„&lt;/li&gt;
&lt;li&gt;Scheduler(è°ƒåº¦å™¨)ï¼šå•ä¾‹ï¼ŒæŠŠTriggerä¸¢é‡Œé¢ç”±è°ƒåº¦å™¨è°ƒåº¦ï¼Œåªéœ€è¦ä¸€ä¸ªSchedulerï¼Œé…ç½®ä¸åŒçš„Triggerï¼›å¯ä»¥ç†è§£æˆç±»ä¼¼çº¿ç¨‹æ± çš„ä¸œè¥¿&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åŸç†ï¼šScheduledThreadPoolExecutorçº¿ç¨‹æ±  + é€šè¿‡Objectç±»çš„wait()å’Œnotify()æˆ–è€…Conditionç±»çš„await()\signal()è¿›è¡Œç­‰å¾…å’Œå”¤é†’ã€é”ä¿è¯çº¿ç¨‹å®‰å…¨ æ¥è¿›è¡Œè°ƒåº¦&lt;/p&gt;
&lt;p&gt;Scheduleræœ‰ä¸¤ä¸ªè°ƒåº¦çº¿ç¨‹ï¼šregular Scheduler Threadï¼ˆæ‰§è¡Œå¸¸è§„è°ƒåº¦ï¼‰å’ŒMisfire Scheduler Threadï¼ˆæ‰§è¡Œé”™å¤±çš„ä»»åŠ¡ï¼‰ï¼ŒRegular Thread è½®è¯¢æ‰€æœ‰Triggerï¼Œå¦‚æœæœ‰å°†è¦è§¦å‘çš„Triggerï¼ˆç”¨waitå’ŒnotifyAllå®ç°ï¼‰ï¼Œåˆ™ä»ä»»åŠ¡çº¿ç¨‹æ± ä¸­è·å–ä¸€ä¸ªç©ºé—²çº¿ç¨‹ï¼Œç„¶åæ‰§è¡Œä¸æ”¹Triggerå…³è”çš„jobï¼›Misfire Thraedåˆ™æ˜¯æ‰«ææ‰€æœ‰çš„triggerï¼ŒæŸ¥çœ‹æ˜¯å¦æœ‰é”™å¤±çš„ï¼Œå¦‚æœæœ‰çš„è¯ï¼Œæ ¹æ®ä¸€å®šçš„ç­–ç•¥è¿›è¡Œå¤„ç†&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;é»˜è®¤æ˜¯å¹¶å‘çš„ï¼Œå³å¦‚æœå½“å‰ä»»åŠ¡æ²¡æœ‰å®Œæˆï¼Œä¼šè‡ªåŠ¨å¼€ä¸€ä¸ªä»»åŠ¡æ‰§è¡Œ&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ³¨æ„åœ¨åˆ†å¸ƒå¼é›†ç¾¤çš„æƒ…å†µä¸‹ï¼Œå¤šå°æœºå­æœ‰ç›¸åŒçš„å®šæ—¶ä»»åŠ¡ï¼Œä¼šå‡ºé”™ï¼Œæ­¤æ—¶é€šè¿‡å…±äº«æ•°æ®åº“çš„æ–¹å¼å®ç°&lt;/p&gt;
&lt;p&gt;Quartzçš„è§£å†³æ–¹æ¡ˆï¼š&lt;/p&gt;
&lt;p&gt;quartzé›†ç¾¤åˆ†ä¸ºæ°´å¹³é›†ç¾¤å’Œå‚ç›´é›†ç¾¤ï¼Œæ°´å¹³é›†ç¾¤å³å°†å®šæ—¶ä»»åŠ¡èŠ‚ç‚¹éƒ¨ç½²åœ¨ä¸åŒçš„æœåŠ¡å™¨ï¼Œå…¶æœ€å¤§çš„é—®é¢˜å°±æ˜¯æ—¶é’ŸåŒæ­¥é—®é¢˜ï¼Œè‹¥æ—¶é’Ÿä¸èƒ½åŒæ­¥ï¼Œåˆ™ä¼šå¯¼è‡´é›†ç¾¤ä¸­å„ä¸ªèŠ‚ç‚¹çŠ¶æ€ç´Šä¹±ï¼Œé€ æˆä¸å¯é¢„çŸ¥çš„åæœï¼›å‚ç›´é›†ç¾¤åˆ™æ˜¯é›†ç¾¤å„èŠ‚ç‚¹éƒ¨ç½²åœ¨åŒä¸€å°æœåŠ¡å™¨ï¼Œæ—¶é’ŸåŒæ­¥è‡ªç„¶ä¸æ˜¯é—®é¢˜ï¼Œä½†å­˜åœ¨å•ç‚¹æ•…éšœé—®é¢˜ï¼ŒæœåŠ¡å™¨å®•æœºä¼šä¸¥é‡å½±å“æœåŠ¡çš„å¯ç”¨æ€§&lt;/p&gt;
&lt;p&gt;åœ¨å„ä¸ªèŠ‚ç‚¹ä¼šä¸ŠæŠ¥ä»»åŠ¡ï¼Œå­˜åˆ°æ•°æ®åº“ä¸­ï¼Œæ‰§è¡Œæ—¶ä¼šä»æ•°æ®åº“ä¸­å–å‡ºè§¦å‘å™¨æ¥æ‰§è¡Œï¼Œå¦‚æœè§¦å‘å™¨çš„åç§°å’Œæ‰§è¡Œæ—¶é—´ç›¸åŒï¼Œåˆ™åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹å»æ‰§è¡Œæ­¤ä»»åŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœæ­¤èŠ‚ç‚¹æ‰§è¡Œå¤±è´¥ï¼Œåˆ™æ­¤ä»»åŠ¡åˆ™ä¼šè¢«åˆ†æ´¾åˆ°å¦ä¸€èŠ‚ç‚¹æ‰§è¡Œï¼Œä¸­é€”ä¹Ÿä¼šè‡ªåŠ¨æ£€æŸ¥å¤±æ•ˆçš„å®šæ—¶è°ƒåº¦ï¼Œå‘ç°ä¸æˆåŠŸçš„ï¼Œå…¶ä»–èŠ‚ç‚¹ç«‹é©¬æ¥è¿‡æ¥ç»§ç»­å®Œæˆå®šæ—¶ä»»åŠ¡ã€‚Quartzæœ‰11ä¸ªå®šæ—¶ä»»åŠ¡è°ƒåº¦è¡¨&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å‚è€ƒ&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.cnblogs.com/Dorae/p/9357180.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;QuartzåŸç†è§£å¯†&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://blog.csdn.net/scgyus/article/details/79360316&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;æ·±å…¥è§£è¯»Quartzçš„åŸç†&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://blog.csdn.net/xlxxcc/article/details/52104463&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Quartz 2.2 çš„å®ç°åŸç†å’Œè¿è¡Œè¿‡ç¨‹&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;å…¶ä»–å®šæ—¶å™¨&#34;&gt;å…¶ä»–å®šæ—¶å™¨&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Timerï¼šè¿™æ˜¯javaè‡ªå¸¦çš„java.util.Timerç±»ï¼Œè¿™ä¸ªç±»å…è®¸ä½ è°ƒåº¦ä¸€ä¸ªjava.util.TimerTaskä»»åŠ¡ã€‚ä½¿ç”¨è¿™ç§æ–¹å¼å¯ä»¥è®©ä½ çš„ç¨‹åºæŒ‰ç…§æŸä¸€ä¸ªé¢‘åº¦æ‰§è¡Œï¼Œä½†ä¸èƒ½åœ¨æŒ‡å®šæ—¶é—´è¿è¡Œã€‚ä¸€èˆ¬ç”¨çš„è¾ƒå°‘ã€‚å•çº¿ç¨‹ï¼Œä»»åŠ¡ä¸€å¤šä¼šé˜»å¡ï¼›ä¸€ä¸ªä»»åŠ¡å‡ºå¼‚å¸¸å…¶ä»–ä»»åŠ¡éƒ½å—å½±å“ï¼›å—ç³»ç»Ÿæ—¶é—´å½±å“&lt;/li&gt;
&lt;li&gt;ScheduledExecutorServiceï¼šä¹Ÿjdkè‡ªå¸¦çš„ä¸€ä¸ªç±»ï¼›æ˜¯åŸºäºçº¿ç¨‹æ± è®¾è®¡çš„å®šæ—¶ä»»åŠ¡ç±»,æ¯ä¸ªè°ƒåº¦ä»»åŠ¡éƒ½ä¼šåˆ†é…åˆ°çº¿ç¨‹æ± ä¸­çš„ä¸€ä¸ªçº¿ç¨‹å»æ‰§è¡Œ,ä¹Ÿå°±æ˜¯è¯´,ä»»åŠ¡æ˜¯å¹¶å‘æ‰§è¡Œ,äº’ä¸å½±å“ã€‚çº¿ç¨‹æ± +å»¶æ—¶é˜Ÿåˆ—DelayedQueue(æ•°ç»„ã€æœ€å°å †, æœ€è¿‘è¦æ‰§è¡Œçš„ä»»åŠ¡æ”¾åœ¨å †é¡¶) å®ç°ï¼Œå¦‚æœå †é¡¶ä»»åŠ¡æ—¶é—´æœªåˆ°å°±é˜»å¡ï¼ˆé€šè¿‡è‡ªæ—‹+condition.await\signalå®ç°ï¼‰ã€‚ä¸å—ç³»ç»Ÿæ—¶é—´å½±å“&lt;/li&gt;
&lt;li&gt;Spring ä¸­çš„ @Schedule  æ³¨è§£&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å‚è€ƒï¼š&lt;a class=&#34;link&#34; href=&#34;https://blog.csdn.net/u013332124/article/details/79603943&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Java å®šæ—¶ä»»åŠ¡å®ç°åŸç†è¯¦è§£&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.jianshu.com/p/587901245c95&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Javaä¼˜å…ˆçº§é˜Ÿåˆ—DelayedWorkQueueåŸç†åˆ†æ&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;cors&#34;&gt;CORS&lt;/h1&gt;
&lt;p&gt;æµè§ˆå™¨çš„åŒæºæ”¿ç­–çš„åŒæºæŒ‡çš„æ˜¯ï¼šåè®®ç›¸åŒã€åŸŸåç›¸åŒã€ç«¯å£ç›¸åŒï¼Œå¦‚æœéåŒæºï¼Œæœ‰ä¸‰ç§è¡Œä¸ºä¼šå—åˆ°é™åˆ¶ï¼šCookieã€LocalStorageå’ŒIndexDBæ— æ³•è¯»å–ï¼›DOMæ— æ³•è·å¾—ã€AJAXè¯·æ±‚ä¸èƒ½å‘é€ã€‚&lt;/p&gt;
&lt;p&gt;å‰åç«¯åˆ†ç¦»çš„åœºæ™¯ä¸‹ï¼Œç”±äºæµè§ˆå™¨çš„åŒæºç­–ç•¥ï¼Œå¯¼è‡´æµè§ˆå™¨å†…çš„è¯·æ±‚ä¸åŒçš„æºçš„åç«¯æ˜¯ä¼šå¤±è´¥ï¼Œå¸¸è§çš„è§£å†³è·¨åŸŸæ–¹æ³•æ˜¯ä½¿ç”¨CORSï¼Œç°åœ¨å¸¸è§çš„webæ¡†æ¶éƒ½æ”¯æŒCORSï¼Œå¼€å¯å³å¯ã€‚&lt;/p&gt;
&lt;p&gt;è§£å†³è·¨åŸŸçš„æ–¹æ³•é™¤äº†CORSï¼Œè¿˜æœ‰jsonpï¼Œä¸è¿‡å·²ç»å¾ˆå°‘ä½¿ç”¨äº†ï¼Œjsonpæœ¬è´¨æ˜¯åˆ©ç”¨æµè§ˆå™¨å…è®¸åŠ è½½ä¸åŒæºçš„jsæ–‡ä»¶å³&lt;!-- raw HTML omitted --&gt;æ ‡ç­¾ç­‰ï¼Œå°†è·¨åŸŸè¯·æ±‚&lt;!-- raw HTML omitted --&gt;æ ‡ç­¾é‡Œï¼Œè¿”å›ä¸€æ®µå¯æ‰§è¡Œçš„jsä»£ç ï¼Œå…¶ä¸­åŒ…å«äº†è¯·æ±‚ç»“æœï¼Œé€šå¸¸æ˜¯jsonæ ¼å¼ï¼Œå‰ç«¯é€šè¿‡è¿”å›çš„jsä»£ç æ‰§è¡Œå›è°ƒè·å–ç»“æœã€‚&lt;/p&gt;
&lt;p&gt;è¯¦æƒ…è§ &lt;a class=&#34;link&#34; href=&#34;http://www.ruanyifeng.com/blog/2016/04/cors.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;è·¨åŸŸèµ„æºå…±äº« CORS è¯¦è§£&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;å¯¹äºè·¨åŸŸäº§ç”Ÿçš„é—®é¢˜ï¼Œå¦‚CSRFè·¨åŸŸè¯·æ±‚æ”»å‡»çš„è§£å†³æ–¹æ¡ˆï¼Œå¯å‚è€ƒï¼š&lt;a class=&#34;link&#34; href=&#34;https://tech.meituan.com/2018/10/11/fe-security-csrf.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;ç¾å›¢:å¦‚ä½•é˜²æ­¢csrf&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;sessionå’Œcookie&#34;&gt;sessionå’Œcookie&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;é¦–å…ˆHTTPæ˜¯æ— çŠ¶æ€çš„ï¼Œå› æ­¤éœ€è¦é€šè¿‡sessionã€cookieæ¥è¾¾åˆ°è®°å½•ç”¨æˆ·çŠ¶æ€çš„ç›®çš„ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¼ ç»Ÿçš„sessionã€cookieï¼šsessionå­˜ç”¨æˆ·ä¿¡æ¯ï¼Œä¿å­˜åœ¨æœåŠ¡ç«¯ä¸­ï¼Œcookieé‡Œå­˜sessionå¯¹åº”çš„sessionIdï¼Œä¿å­˜åœ¨å®¢æˆ·ç«¯ä¸­ï¼Œç”¨äºæ‰¾åˆ°å¯¹åº”çš„sessionï¼Œæ¯æ¬¡è¯·æ±‚éƒ½ä¼šå¸¦ä¸Šè¯¥cookieæ¥è¡¨ç¤ºæ­¤ç”¨æˆ·ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœå®¢æˆ·ç«¯ç¦ç”¨æ‰cookieï¼Œå¯ä»¥ä½¿ç”¨LocalStorageå­˜å‚¨ï¼Œæ¯æ¬¡è¯·æ±‚éƒ½ä»¥å‚æ•°çš„å½¢å¼ä¼ é€’ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;cookieå¯è®¾ç½®é•¿æ—¶é—´ä¿æŒï¼Œsessionæœ‰æ•ˆæ—¶é—´é€šå¸¸æ¯”è¾ƒçŸ­ï¼Œå®‰å…¨æ€§ä¸Šæ¥å°†ï¼Œcookieå­˜å‚¨åœ¨å®¢æˆ·ç«¯ï¼Œå®¹æ˜“è¢«çªƒå–ï¼Œsessionå­˜å‚¨åœ¨æœåŠ¡æ®µï¼Œç›¸å¯¹å®‰å…¨ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç”±äºç°åœ¨å®ä¾‹çš„éƒ¨ç½²ä¸å¯èƒ½åªéƒ¨ç½²ä¸€ä¸ªï¼Œä¸€èˆ¬éƒ½æ˜¯é›†ç¾¤éƒ¨ç½²ï¼Œå› æ­¤sessionä¸å¯ä»¥åªå­˜åœ¨ä¸€ä¸ªå®ä¾‹çš„å†…å­˜ä¸­ï¼Œå› æ­¤å¼•å…¥Redisæ¥å­˜ç”¨æˆ·çš„ç™»å½•ä¿¡æ¯&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç°åœ¨ä¸€èˆ¬ä½¿ç”¨ token + Redisæ¥å®ç° cookie - session æœºåˆ¶ï¼Œæœ¬è´¨ä¸Šå·®ä¸å¤šï¼Œå‰ç«¯çš„cookieæ›´å¤šçš„æ˜¯å­˜tokençš„ä¿¡æ¯è€Œå·²ï¼Œtokenä¹Ÿå¯ä»¥å­˜åœ¨LocalStorageæˆ–sessionStorageä¸­ï¼Œå‘é€è¯·æ±‚æ—¶ä¸€èˆ¬æ˜¯æŠŠtokençš„å€¼æ”¾åœ¨è¯·æ±‚å¤´ä¸­ï¼Œè€Œä¸ä¼šæŠŠcookieå‘ç»™åç«¯ï¼Œè¿™æ ·å¯ä»¥é¿å…å½“ç”¨æˆ·ç¦ç”¨cookieå¯¼è‡´åŠŸèƒ½ä¸å¯ç”¨ï¼Œè¿˜æœ‰CSRFé—®é¢˜ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;jwt&#34;&gt;JWT&lt;/h1&gt;
&lt;p&gt;JWT = JSON WEB TOKEN&lt;/p&gt;
&lt;h2 id=&#34;åŸç†&#34;&gt;åŸç†&lt;/h2&gt;
&lt;p&gt;JWTå®é™…ä¸Šæ˜¯ä¸€ä¸ªtoken(ä»¤ç‰Œ)ï¼Œåˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼šHeader(å¤´éƒ¨)ã€Payload(è´Ÿè½½)ã€Signature(ç­¾å)ã€‚&lt;/p&gt;
&lt;p&gt;Header(å¤´éƒ¨) ï¼šä¸¤éƒ¨åˆ†ç»„æˆï¼Œè®°å½•ä»¤ç‰Œç±»å‹å’ŒJWTçš„ç­¾åç®—æ³•ï¼Œä¸€èˆ¬æ˜¯HMACSHA256ã€‚&lt;/p&gt;
&lt;p&gt;Payload(è´Ÿè½½)ï¼š è®°å½•ç”¨æˆ·ç™»å½•ä¿¡æ¯(å®˜æ–¹è§„èŒƒé»˜è®¤æ˜¯ä¸åŠ å¯†çš„ï¼Œåˆ†ä¸ºå®˜æ–¹å­—æ®µå’Œç§æœ‰å­—æ®µï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;Signature(ç­¾å) ï¼šè®°å½•å°† Headerã€Payloadå’ŒæœåŠ¡ç«¯çš„å¯†é’¥ç»„åˆèµ·æ¥ï¼Œä½¿ç”¨Header(å¤´éƒ¨)é‡Œè§„å®šçš„æ–¹å¼åŠ å¯†ã€‚&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚headeré‡Œä¿å­˜çš„åŠ å¯†æ–¹å¼æ˜¯HMACSHA256ï¼Œ&lt;code&gt;ç­¾å Signature = HMACSHA256(base64URL(header) + &amp;quot;.&amp;quot; + base64URL(payload) + &amp;quot;.&amp;quot; + ä¿å­˜åœ¨åç«¯çš„å¯†é’¥)&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;æœ€åçš„JWT = &lt;code&gt;base64URL(Header) + &amp;quot;.&amp;quot; + base64URL(Payload) + &amp;quot;.&amp;quot; + Signature&lt;/code&gt;ï¼Œåç«¯æ”¶åˆ°è¯¥JWTåéªŒè¯è¯¥ç­¾åæ˜¯å¦æ­£ç¡®ï¼Œæ¥åˆ¤æ–­JWTé‡Œçš„ç”¨æˆ·ä¿¡æ¯æ˜¯å¦å¯é ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;base64&lt;/strong&gt;ï¼š64æŒ‡çš„æ˜¯A-Z,a-zï¼Œ0-9ï¼Œ+ï¼Œ/ï¼Œå°†å¾…è½¬æ¢çš„å­—ç¬¦ä¸²è½¬æˆäºŒè¿›åˆ¶æµï¼Œæ¯3ä¸ª8ä½è½¬æˆ4ä¸ª6ä½ï¼Œ6ä½çš„äºŒè¿›åˆ¶æ•°è½¬æˆåè¿›åˆ¶ï¼Œæ ¹æ®ç è¡¨æ‰¾åˆ°å¯¹åº”çš„å­—ç¬¦ï¼Œä»¥=å·åšåç¼€ï¼Œå‡‘é½ä½æ•°&lt;/p&gt;
&lt;p&gt;ä¸€èˆ¬æ˜¯ä¸ºäº†è§£å†³ä¸€äº›å­—ç¬¦ç¼–ç çš„é—®é¢˜ï¼Œå°†éASCIIå­—ç¬¦è½¬åŒ–ä¸ºASCIIå­—ç¬¦ï¼Œè¿˜æœ‰å°±æ˜¯å¯ä»¥å¯¹æ•°æ®åšç®€å•åŠ å¯†ï¼Œbase64URLåœ¨base64çš„åŸºç¡€ä¸Šå¢åŠ å¯¹ä¸€äº›ç¬¦å·çš„ç¼–è§£ç ï¼Œæ¯”å¦‚æŠŠ&amp;quot;-&amp;ldquo;æ›¿æ¢æˆ&amp;rdquo;+&amp;quot;ï¼Œä½¿å¾—å®ƒå¯ä»¥å‡ºç°åœ¨urlä¸­ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;HMACSHA256&lt;/strong&gt;ï¼šæ‘˜è¦ç®—æ³•ï¼Œä¸€èˆ¬ç”¨äºéªŒè¯ç­¾åæ˜¯å¦ä¸€è‡´&lt;/p&gt;
&lt;h2 id=&#34;ä½¿ç”¨&#34;&gt;ä½¿ç”¨&lt;/h2&gt;
&lt;p&gt;å¯ä»¥å­˜å‚¨åœ¨æµè§ˆå™¨çš„æœ¬åœ°ç¼“å­˜localStorageæˆ–è€…cookieä¸­ï¼Œå‘é€è¯·æ±‚çš„æ—¶å€™æ”¾åœ¨cookieé‡Œï¼Œæˆ–è€…æ”¾åœ¨è¯·æ±‚å¤´ä¸­&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;JWTçš„ç›®çš„æ˜¯è®©æœåŠ¡å™¨ä¸ä¿å­˜ä»»ä½•sessionæ•°æ®ï¼Œè®©åç«¯å˜æˆæ— çŠ¶æ€çš„ï¼Œå› æ­¤æ²¡åŠæ³•ä¸»åŠ¨åºŸå¼ƒæŸä¸ªtokenï¼Œä¸€æ—¦ç­¾å‘äº†JWTï¼Œåœ¨åˆ°æœŸä¹‹å‰å°±ä¼šå§‹ç»ˆæœ‰æ•ˆï¼Œå¦‚æœæƒ³è¦å®ç°è¿™ç§åŠŸèƒ½ï¼Œå¿…ç„¶éœ€è¦åœ¨åç«¯ä¿å­˜JWTï¼Œå°±è¿èƒŒäº†JWTçš„è®¾è®¡åˆè¡·äº†ã€‚&lt;/li&gt;
&lt;li&gt;è¦è®©JWTå®ç° ç»­ç­¾ å’Œ ä¸»åŠ¨è¿‡æœŸåŠŸèƒ½ï¼Œå¿…å®šéœ€è¦åœ¨åç«¯ä¿å­˜JWT
&lt;ul&gt;
&lt;li&gt;jwtä¸»åŠ¨è¿‡æœŸé—®é¢˜ï¼Œä½¿ç”¨é»‘åå•å³å¯ï¼›åˆ†æˆä¸¤ç‚¹ï¼Œå®¢æˆ·ç«¯è¦æ±‚å¤±æ•ˆï¼ŒæœåŠ¡ç«¯è®°å½•tokenåˆ°é»‘åå•ï¼›ç”¨æˆ·é‡ç½®å¯†ç ï¼ŒæœåŠ¡ç«¯è®°å½•uid-timeé”®å€¼å¯¹ï¼Œåœ¨æ­¤ä¹‹å‰çš„tokenå…¨éƒ¨å¤±æ•ˆï¼›å®¢æˆ·ç«¯æŠŠä¿å­˜çš„jwtåˆ æ‰æ˜¯æ²¡ç”¨çš„ï¼Œæ­¤æ—¶çš„jwtä¾ç„¶æœ‰æ•ˆï¼Œåªæ˜¯å®¢æˆ·ç«¯æ²¡è®°å½•è€Œå·²&lt;/li&gt;
&lt;li&gt;jwtç»­ç­¾é—®é¢˜ï¼Œä¸€ç§è§£å†³æ–¹å¼æ˜¯jwtä¸­å­˜å‚¨è¿‡æœŸæ—¶é—´ï¼ŒæœåŠ¡ç«¯è®¾ç½®åˆ·æ–°æ—¶é—´ï¼Œè¯·æ±‚æ—¶åˆ¤æ–­æ˜¯å¦åœ¨è¿‡æœŸæ—¶é—´æˆ–åˆ·æ–°æ—¶é—´ï¼Œåœ¨åˆ·æ–°æ—¶é—´å†…è¿›è¡Œtokenåˆ·æ–°ï¼Œå¤±æ•ˆtokenè®°å…¥é»‘åå•ï¼›&lt;/li&gt;
&lt;li&gt;è€Œé»‘åå•è¿‡å¤§é—®é¢˜ï¼Œå¯ä»¥é‡‡ç”¨è®°å½•UID-åˆ·æ–°æ—¶é—´æ–¹å¼è§£å†³ï¼Œåˆ¤æ–­jwtç­¾å‘æ—¶é—´ï¼Œjwtç­¾å‘æ—¶é—´å°äºUID-åˆ·æ–°æ—¶é—´çš„è®°ä¸ºå¤±æ•ˆ&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ä¸ªäººè®¤ä¸ºJWTçš„ç”Ÿæˆæ–¹å¼æœ¬èº«æ˜¯æœ‰ä¸€å¥—è§„èŒƒçš„ï¼Œåœ¨å®é™…ä½¿ç”¨è¿‡ç¨‹ä¸­ä¹Ÿå¯ä»¥å¯¹ä»–è¿›è¡Œæ”¹åŠ¨ï¼Œæœ¬è´¨ä¸Šè¿˜æ˜¯ä¸€ä¸ªç­¾åæ ¡éªŒè€Œå·²ï¼Œä¸€èˆ¬ä¼šå¯¹JWTè¿›è¡Œé­”æ”¹ï¼Œæ¯”å¦‚ä½¿ç”¨Header(å¤´éƒ¨)é‡Œçš„åŠ å¯†æ–¹å¼åŠ å¯†Signature(ç­¾å)ï¼ŒSignature(ç­¾å)åŠ å¯†Header(å¤´éƒ¨) å’ŒPayload(è´Ÿè½½) è¿™ä¸¤éƒ¨åˆ†ï¼ŒæœåŠ¡å™¨é‡Œçš„ç§é’¥è§£å¯†Payload(è´Ÿè½½)ï¼Œå¾—åˆ°éœ€è¦çš„ç™»å½•ä¿¡æ¯ï¼Œä¸é€šè¿‡ç®€å•çš„base64URLç¼–ç ï¼Œä¸å¯¹å¤–æš´éœ²ï¼Œç­¾åç®—æ³•æˆ–è€…ç­¾åé‡Œçš„å¯†é’¥çš„æ–¹å¼å¯ä»¥æ”¹æˆå…¶ä»–ç­‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;JWTå‚è€ƒï¼š&lt;a class=&#34;link&#34; href=&#34;https://learnku.com/articles/17883&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;JWT è¶…è¯¦ç»†åˆ†æ&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;casæ¨¡å‹---ssoå•ç‚¹ç™»å½•&#34;&gt;CASæ¨¡å‹ - SSO(å•ç‚¹ç™»å½•)&lt;/h1&gt;
&lt;p&gt;å¯å‚è€ƒï¼š&lt;a class=&#34;link&#34; href=&#34;https://blog.csdn.net/javaloveiphone/article/details/52439613&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;CASå®ç°å•ç‚¹ç™»å½•SSOæ‰§è¡ŒåŸç†æ¢ç©¶&lt;/a&gt;ï¼Œè®²å¾—ç®—æ˜¯æ¯”è¾ƒæ˜ç™½ï¼Œè¿™é‡Œæ˜¯æ€»ç»“åŸºäºCASæ¨¡å¼æ”¹çš„å•ç‚¹ç™»å½•æ¨¡å¼&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç¬¬ä¸€æ¬¡è®¿é—®æ—¶ï¼Œç”±äºæ²¡æœ‰è®¿é—®çš„tokenï¼Œä¼šå¼•å¯¼è‡³ç™»å½•&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/sso-first-access.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/sso-first-access.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			alt=&#34;ç¬¬ä¸€æ¬¡è®¿é—®&#34;&gt;
	&lt;/a&gt;
	
	&lt;figcaption&gt;ç¬¬ä¸€æ¬¡è®¿é—®&lt;/figcaption&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å†æ¬¡è®¿é—®Web-1æ—¶ï¼Œç”±äºå‰ç«¯å·²å­˜äº†tokenï¼Œç›´æ¥ä½¿ç”¨tokenè¿›è¡Œè¯·æ±‚å³å¯&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å·²ç™»å½•Web-1æ—¶å»è®¿é—®Web-2ï¼Œä¼šé€šè¿‡åç«¯è®¤è¯ä¸­å¿ƒå®ç°å•ç‚¹ç™»å½•&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/sso-second-access.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/sso-second-access.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			alt=&#34;ç¬¬äºŒæ¬¡è®¿é—®&#34;&gt;
	&lt;/a&gt;
	
	&lt;figcaption&gt;ç¬¬äºŒæ¬¡è®¿é—®&lt;/figcaption&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;è¿™é‡Œåœ¨æ€»ç»“ä¸€ä¸‹å…³äºGrantTicketå’ŒServiceTicketï¼Œè·ŸCASæ¨¡å‹ä¸­æåˆ°çš„TGTã€STã€PGTè¿™äº›ä¸œè¥¿æ˜¯ç±»ä¼¼çš„ï¼Œæœ¬è´¨æ˜¯ä½œä¸ºéªŒè¯çš„ç¥¨æ®ï¼Œå›¾ä¸­çš„GrantTicketã€ServiceTicketã€tokenå«ä¹‰å¦‚ä¸‹&lt;/p&gt;
&lt;p&gt;GrantTicketï¼šå…¨å±€ä¼šè¯ç¥¨æ®ï¼Œä¿å­˜åœ¨ç™»å½•é¡µï¼Œé€šè¿‡GrantTicketæ‰èƒ½æ¢å–ServiceTicketï¼›&lt;/p&gt;
&lt;p&gt;ServiceTicketè¡¨ç¤ºè®¿é—®èµ„æºçš„ä¸€æ¬¡æ€§ç¥¨æ®ï¼Œæ ¹æ®ServiceTicketæ¢å–tokenï¼Œæ¢å–åå¤±æ•ˆï¼›&lt;/p&gt;
&lt;p&gt;tokenï¼šç™»å½•å‡­è¯&lt;/p&gt;
&lt;p&gt;GTã€STå’Œtokenéƒ½æ˜¯ä¿å­˜åœ¨Redisä¸­çš„ï¼Œä»–ä»¬åœ¨Redisä¸­çš„å­˜å‚¨ç»“æ„å¦‚ä¸‹&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;keyï¼šTOKEN_${Tokençš„å€¼}
value:
{
    &amp;quot;createTime&amp;quot;: 1565961654807,
    &amp;quot;accountId&amp;quot;: &amp;quot;123&amp;quot;,
    // ç”¨æˆ·å…¶ä»–ä¿¡æ¯
    &amp;quot;grantTicket&amp;quot;: ${GrantTicketçš„å€¼}  // tokenå…³è”GTï¼Œç”¨äºæ³¨é”€æ—¶å®ç°å…¨å±€æ³¨é”€
}

keyï¼šGRANT_TICKET_${GrantTicketçš„å€¼}
value:
{
    &amp;quot;createTime&amp;quot;: 1565961654807,
    &amp;quot;accountId&amp;quot;: &amp;quot;123&amp;quot;,
}

keyï¼šSERVICE_TICKET_${ServiceTicketçš„å€¼}
value:
{
    &amp;quot;createTime&amp;quot;: 1565961654807,
    &amp;quot;grantTicket&amp;quot;: ${GrantTicketçš„å€¼} // STå…³è”GTï¼Œç”¨äºåˆ¤æ–­è¯¥STæ˜¯å¦æœ‰æ•ˆï¼Œæ¢å–tokenååˆ é™¤
}

// tokenä¸grantTicketçš„è®°å½•ï¼Œæ³¨é”€æ—¶ï¼Œæ ¹æ®tokenä¸­å…³è”çš„GTï¼Œæ‰¾åˆ°æ‰€æœ‰ä¸ä¹‹å…³è”çš„tokenï¼Œè¿›è¡Œåˆ é™¤ï¼Œè¿™é‡Œæ¨èä½¿ç”¨Redisçš„scanå‘½ä»¤è¿›è¡Œåˆ†æ®µæŸ¥è¯¢ï¼ŒåŸå› æ˜¯Redisæ˜¯å•çº¿ç¨‹çš„ï¼Œå¦‚æœæ•°æ®é‡å¤ªå¤§ä½¿ç”¨keyså‘½ä»¤éå†å¤ªä¹…ï¼Œé˜»å¡Redisæ¥æ”¶å…¶ä»–å‘½ä»¤
keyï¼š{grantTicket}-{token}
valueï¼šæ— 
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;åŸºäºoauth20çš„ç¬¬ä¸‰æ–¹ç™»å½•&#34;&gt;åŸºäºOAuth2.0çš„ç¬¬ä¸‰æ–¹ç™»å½•&lt;/h1&gt;
&lt;p&gt;å¯å‚è€ƒï¼š&lt;a class=&#34;link&#34; href=&#34;https://www.ruanyifeng.com/blog/2014/05/oauth_2_0.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;ç†è§£OAuth 2.0&lt;/a&gt;ï¼Œè¿™æ ·åŸºæœ¬å°±å…¥é—¨äº†ï¼Œè¿™é‡Œæ˜¯æ€»ç»“é¡¹ç›®ä¸­å¦‚ä½•æ¥å…¥ï¼Œä¸€èˆ¬åœ¨é›†æˆfacebookå’Œgoogleçš„ç¬¬ä¸‰æ–¹ç™»å½•ä¹Ÿæ˜¯ç±»ä¼¼çš„æµç¨‹æœºåˆ¶ï¼Œè¿™é‡Œåªç”¨åˆ°äº†access_tokenï¼Œå¯¹äºrefresh_tokenï¼Œæ˜¯ç”¨æ¥å»¶é•¿access_tokençš„è¿‡æœŸæ—¶é—´çš„ï¼Œå‡å°‘çŸ­æ—¶é—´å†…çš„é‡å¤ç™»å½•ï¼Œè¿™é‡Œå°±æ²¡æœ‰æ¶‰åŠåˆ°äº†&lt;/p&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/%e5%9f%ba%e4%ba%8eoauth2%e7%9a%84%e7%ac%ac%e4%b8%89%e6%96%b9%e7%99%bb%e5%bd%95%e6%b5%81%e7%a8%8b.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/%e5%9f%ba%e4%ba%8eoauth2%e7%9a%84%e7%ac%ac%e4%b8%89%e6%96%b9%e7%99%bb%e5%bd%95%e6%b5%81%e7%a8%8b.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			alt=&#34;åŸºäºOAuth2çš„ç¬¬ä¸‰æ–¹ç™»å½•&#34;&gt;
	&lt;/a&gt;
	
	&lt;figcaption&gt;åŸºäºOAuth2çš„ç¬¬ä¸‰æ–¹ç™»å½•&lt;/figcaption&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;ä¸ºä»€ä¹ˆè¦åç«¯è¦æ ¹æ®code + clientId + secretæ¢æˆaccess_tokenï¼Œå†æ ¹æ®access_tokenæ¢ç”¨æˆ·ä¸ªäººä¿¡æ¯ï¼Ÿ&lt;/p&gt;
&lt;p&gt;ä¸ºä»€ä¹ˆåç«¯ä¸ç›´æ¥code + clientId + secretæ¢ç”¨æˆ·ä¸ªäººä¿¡æ¯å‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;ä¸»è¦è¿˜æ˜¯ä¸ºäº†å®‰å…¨ï¼Œé˜²æ­¢ä¸­é—´äººæ”»å‡»&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;é‡å®šå‘çš„å‚æ•°æ˜¯å¸¦åœ¨urlé‡Œçš„ï¼Œæ˜¯ç›´æ¥æš´éœ²åœ¨å®¢æˆ·ç«¯çš„ï¼Œå¦‚æœç›´æ¥è¿”å›access_tokenå°±ä¸å®‰å…¨ï¼Œå› æ­¤æ‰å¤šäº†codeè¿™ä¸€å±‚ï¼Œä¸ºäº†é™ä½codeè¢«æ‹¦æˆªæ³„æ¼åçš„é£é™©ï¼Œcodeçš„è¿‡æœŸæ—¶é—´ä¸€èˆ¬éƒ½å¾ˆçŸ­ï¼Œä¸”æ˜¯ä¸€æ¬¡æ€§çš„ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¦å¤–å°±æ˜¯åç«¯å¯¹äºå¤–éƒ¨çš„è¯·æ±‚éƒ½æ˜¯ä¸ä¿¡ä»»çš„ï¼Œå› æ­¤æ¥æ”¶åˆ°çš„å‚æ•°(code)é¦–å…ˆè¿˜è¦é…åˆå‡­è¯å»éªŒè¯å…¶åˆæ³•æ€§ï¼Œå¯¹äºéªŒè¯é€šè¿‡åè·å¾—çš„access_tokenä¹Ÿæœ‰æ›´å¤šçš„æ“ä½œç©ºé—´ï¼Œç”±åç«¯æŒæœ‰ï¼Œä¸ä¼šæš´éœ²å‡ºå»&lt;/p&gt;
&lt;p&gt;åƒä¸Šå›¾é‚£ç§ç™»å½•æ–¹æ¡ˆï¼Œåç«¯åªéœ€è¦ç”¨æˆ·ä¸ªäººä¿¡æ¯æ¢å®Œtokenå°±ç®—å®Œäº‹äº†ï¼Œæ‰€ä»¥çœ‹èµ·æ¥å¥½åƒç›´æ¥ä½¿ç”¨code + clientId + secretæ¢ç”¨æˆ·ä¸ªäººä¿¡æ¯å°±è¡Œï¼Œä½†æ˜¯å¦‚æœæ­¤æ—¶éœ€è¦å†è·å–ç”¨æˆ·çš„å…¶ä»–ä¿¡æ¯ï¼Œå°±æ²¡æœ‰æ²¡åŠæ³•å†ç”¨codeå»æ¢äº†ï¼Œåªèƒ½è¦æ±‚ç”¨æˆ·å†æ¬¡ç™»å½•ï¼Œæ­¤æ—¶å¦‚æœæœ‰access_tokenå°±æ˜¾å¾—å¤šä¹ˆé‡è¦äº†&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;å‹æµ‹&#34;&gt;å‹æµ‹&lt;/h1&gt;
&lt;p&gt;æ€»ç»“ä¸€ä¸‹åšè¿‡çš„å‹æµ‹ï¼Œå‹æµ‹å·¥å…·jmetterï¼Œåˆ©ç”¨jmetteå¯ä»¥å¤šçº¿ç¨‹å¹¶å‘è¯·æ±‚å’Œå¯ä»¥å®æ—¶æŸ¥çœ‹ç®€æ˜“æŠ¥å‘Šçš„èƒ½åŠ›&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;å…ˆå¯¹è¢«å‹æµ‹æœåŠ¡çš„æ¥å£é’ˆå¯¹ä¸åŒåœºæ™¯ç¼–å†™å‹æµ‹ç”¨ä¾‹ï¼Œè®¾å®šå¥½TPSçš„èµ·å§‹å’Œç›®æ ‡å€¼ï¼Œä½œä¸ºå‹æµ‹è®¡åˆ’&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç”»å‹æµ‹æœºå™¨éƒ¨ç½²å…³ç³»å›¾ï¼Œéƒ¨ç½²å‹æµ‹ç¯å¢ƒ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å¯¹äºè¢«å‹æµ‹çš„æœåŠ¡ï¼Œä¸€èˆ¬ä¼šmockæ‰ä¸è¯¥æœåŠ¡ç›¸å…³å…³è”çš„æœåŠ¡ï¼Œæ¯”å¦‚è¯¥æœåŠ¡è¿˜è¿äº†æ•°æ®åº“ï¼Œè¯¥æ¥å£è¯·æ±‚ä¾èµ–ä¸€äº›ç‹¬ç«‹éƒ¨ç½²çš„ä¸­é—´ä»¶ï¼Œæˆ–è€…ä¾èµ–å…¶ä»–æœåŠ¡ï¼Œåˆ™ä¼šå¯¹è¿™äº›ç›¸å…³çš„ä¾èµ–ç”¨æ¡©æ¥ä»£æ›¿ï¼Œç”¨äºç»´æŒé€šä¿¡ï¼Œä»¥å‡å°‘è¿™äº›é¢å¤–æœåŠ¡çš„å½±å“ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¸€èˆ¬ä¸€å°æœºå™¨åªéƒ¨ç½²ä¸€ä¸ªæœåŠ¡ï¼Œç‰¹åˆ«æ˜¯è¢«å‹æµ‹æœåŠ¡ï¼Œæ­¤å¤–è¿˜è¦æ³¨æ„è¢«å‹æµ‹æœåŠ¡æ‰€åœ¨çš„æœºå™¨ä¸Šç½‘ç»œè®¾ç½®ç›¸å…³çš„å‚æ•°ï¼Œæ¯”å¦‚TCPæœ€å¤§è¿æ¥æ•°ã€å›æ”¶ç­–ç•¥ä¹‹ç±»çš„è®¾ç½®&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç¼–å†™å‹æµ‹è„šæœ¬ï¼Œå‹æµ‹è„šæœ¬è¶Šç®€å•è¶Šå¥½ï¼Œå°½é‡è®©å‹æµ‹å·¥å…·ä¸å½±å“è¢«å‹æµ‹æœåŠ¡ï¼Œ&lt;strong&gt;è„šæœ¬æœ€é‡è¦çš„å‡ ä¸ªè®¾ç½®&lt;/strong&gt;ï¼š å‘èµ·è¯·æ±‚æ—¶çš„å¹¶å‘çº¿ç¨‹æ•°ã€å“åº”çš„æ–­è¨€ã€TPSæ•°ï¼Œå…¶ä»–é‚£äº›èŠ±é‡Œèƒ¡å“¨çš„è¾“å‡ºæ ‘çŠ¶å›¾ï¼Œé¥¼å›¾å•Šé‚£äº›éƒ½ä¸ç”¨é…äº†ï¼Œç”¨æœ€ç®€å•çš„æŠ¥å‘Šè¾“å‡ºå³å¯&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;éƒ¨ç½²å®Œåï¼Œå°†è„šæœ¬é…ç½®æ”¾åˆ°jmeterçš„æœºå™¨ä¸Šï¼Œå¯åŠ¨å‹æµ‹&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;nohup java -jar bin/ApacheJMeter.jar -n -t jmetterè„šæœ¬è·¯å¾„/config.jmx &amp;gt; test.out &amp;amp;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;è¾“å‡ºåˆ°å½“å‰ç›®å½•ä¸‹çš„test.outæ–‡ä»¶é‡Œï¼Œè¿™é‡Œå¯åŠ¨æ˜¯ä½¿ç”¨é»˜è®¤å‚æ•°å¯åŠ¨ï¼Œå¦‚æœå¯¹jmetterçš„JVMè®¾ç½®æœ‰è¦æ±‚ï¼Œä¹Ÿå¯ä»¥åœ¨å¯åŠ¨æ—¶æŒ‡å®šJVMå‚æ•°ï¼Œå¦‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;nohup java -server -XX:+HeapDumpOnOutOfMemoryError -Xms512m -Xmx512m -XX:+UseG1GC -XX:MaxGCPauseMillis=250 -XX:G1ReservePercent=20 -Djava.security.egd=file:/dev/urandom -jar bin/ApacheJMeter.jar -n -t jmetterè„šæœ¬è·¯å¾„/config.jmx &amp;gt; test.out &amp;amp;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å‹æµ‹å¼€å¯åå¯ä»¥æ‰“å¼€test.outæ–‡ä»¶æŸ¥çœ‹å‹æµ‹æŠ¥å‘Š&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¸€èˆ¬æ˜¯æŒ‰ç…§TPSä»å°å¾€å¤§å‹ï¼Œå°çš„TPSå‹ï¼Œåœ¨æ­£å¸¸å»¶æ—¶çš„æƒ…å†µä¸‹å¯ä»¥å…ˆåˆ¤æ–­ç¨‹åºæ˜¯å¦æœ‰é—®é¢˜ï¼Œæ¯”å¦‚å†…å­˜æ³„æ¼ï¼Œå†…å­˜æº¢å‡ºï¼Œæ²¡é—®é¢˜äº†å†é€æ­¥å¾€å¤§äº†å‹ã€‚å¦‚æœå…ˆä»å¤§å¾€å°å‹ï¼Œå»¶æ—¶åˆä¸Šä¸å»ï¼Œæ­¤æ—¶åˆ¤æ–­ä¸äº†æ˜¯ç¨‹åºå†…éƒ¨é—®é¢˜è¿˜æ˜¯è¿‡å¤§çš„TPSå¯¼è‡´ã€‚å‹æµ‹æ—¶é—´ä¸€èˆ¬æœ€å°‘å‹ä¸€å¤©&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è¾“å‡ºå‹æµ‹æŠ¥å‘Š&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä¸€èˆ¬æœ‰å¦‚ä¸‹å‡ ä¸ªç‚¹è¦æ³¨æ„ï¼Œè¿™äº›ç‚¹åˆ°æ—¶ä¹Ÿè¦è¾“å‡ºåˆ°å‹æµ‹æŠ¥å‘Šä¸Š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç›‘æ§ç‚¹&lt;/th&gt;
&lt;th&gt;è¯´æ˜&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;jmetterç«¯çš„TPSã€å»¶æ—¶ã€é”™è¯¯ç‡&lt;/td&gt;
&lt;td&gt;è§‚å¯ŸTPSæ˜¯å¦ç¬¦åˆé¢„æœŸã€å»¶æ—¶æ˜¯å¦è¾¾åˆ°é¢„æœŸä¸”ç¨³å®šã€é”™è¯¯ç‡è¦ä¸º0ã€‚&lt;strong&gt;å½“ç¨‹åºæ­£å¸¸æ—¶é™ä½RTçš„æ‰‹æ®µ&lt;/strong&gt;ï¼šå‡å°‘ä¸å¿…è¦çš„æ—¥å¿—è¾“å‡ºã€ä¸šåŠ¡é€»è¾‘ç®—æ³•æ˜¯å¦è¿˜æœ‰ä¼˜åŒ–ç©ºé—´ï¼Œæ˜¯å¦æœ‰IOå ç”¨æˆ–è€…é¢‘ç¹åºåˆ—åŒ–ååºåˆ—åŒ–ã€å†…éƒ¨é˜Ÿåˆ—æ˜¯å¦é˜»å¡&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;è¢«å‹æµ‹æœåŠ¡çš„gc&lt;/td&gt;
&lt;td&gt;fgcï¼Œygcä¸è¦å¤ªé¢‘ç¹ï¼Œä¸€èˆ¬æ¥è¯´&lt;strong&gt;fgc ä¸€å°æ—¶è¦å°äº3~4æ¬¡&lt;/strong&gt;ï¼›&lt;strong&gt;ygcä¸€åˆ†é’Ÿè¦å°äº3~4æ¬¡ä¸ºä½³&lt;/strong&gt;ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;jmetterç«¯çš„CPUã€å†…å­˜ä½¿ç”¨ç‡ç­‰&lt;/td&gt;
&lt;td&gt;æ³¨æ„jmetterç«¯çš„CPUæ˜¯å¦è¿‡é«˜æˆ–æ³¢åŠ¨å¾ˆå¤§ï¼Œé¿å…å½±å“å‹æµ‹ç»“è®º&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;è¢«å‹æµ‹æœåŠ¡ç«¯çš„CPUã€ç£ç›˜ã€å†…å­˜ä½¿ç”¨ç‡ç­‰&lt;/td&gt;
&lt;td&gt;å¦‚æœcpuè¿‡é«˜ï¼Œå¦‚æœè¿ç»­è¾¾åˆ°90ä»¥ä¸Šï¼ŒåŸºæœ¬ä¸Šæ˜¯å†…å­˜æ³„æ¼å¯¼è‡´äº†é¢‘ç¹çš„fgcï¼›ç£ç›˜çš„å ç”¨æƒ…å†µï¼Œæ³¨æ„ç”Ÿæˆçš„æ—¥å¿—æ˜¯å¦æŠŠç£ç›˜å æ»¡äº†&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;ä½¿ç”¨ &lt;code&gt;jstat -gcutil [pid] [æ—¶é—´é—´éš”ï¼Œæ¯å‡ ç§’æ‰“å°] [æ‰“å°æ¬¡æ•°]&lt;/code&gt;æŸ¥çœ‹GCæƒ…å†µ&lt;/p&gt;
&lt;p&gt;å½“è¢«å‹æµ‹ç«¯çš„gcä¸æ­£å¸¸æ—¶ï¼Œåº”å°½é‡ä¿å­˜äº‹å‘ç¯å¢ƒ&lt;/p&gt;
&lt;p&gt;â€‹	1ã€æ”¶é›†å†…å­˜ä½¿ç”¨åŸºæœ¬æƒ…å†µç»Ÿè®¡ï¼š&lt;code&gt;jmap -heap [pid] &amp;gt; [æ–‡ä»¶åï¼Œå¦‚heap.log]&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;â€‹	2ã€æ”¶é›†çº¿ç¨‹å †æ ˆè¿è¡Œä¿¡æ¯ï¼š&lt;code&gt;jstack [pid] &amp;gt; [æ–‡ä»¶åï¼Œå¦‚stack.log]&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;â€‹	3ã€æ”¶é›†å†…å­˜è¯¦ç»†ä½¿ç”¨ä¿¡æ¯ï¼Œç”Ÿæˆdumpå†…å­˜å¿«ç…§ï¼š&lt;code&gt;jmap -dump:format=b,file=[æ–‡ä»¶åï¼Œå¦‚heap.dump] [pid]&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;ä¸€èˆ¬ä½¿ç”¨eclipse matå·¥å…·è¿›è¡Œå†…å­˜å¿«ç…§çš„åˆ†æï¼Œæ’æŸ¥å‡ºå†…å­˜æ³„æ¼çš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;matçš„ä½¿ç”¨å‚è§ï¼š&lt;a class=&#34;link&#34; href=&#34;https://www.cnblogs.com/yueshutong/p/9824772.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Eclipse MATå†…å­˜åˆ†æå·¥å…·&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ä¸€èˆ¬å‹æµ‹è„šæœ¬çš„æ¨¡æ¿ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;48
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;49
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;50
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;51
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;52
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;53
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;54
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;55
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;56
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;57
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;58
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;59
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;60
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;61
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;62
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;63
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;64
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;65
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;66
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;67
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;68
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;69
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;70
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;71
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;72
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;73
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;74
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;75
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-xml&#34; data-lang=&#34;xml&#34;&gt;&lt;span class=&#34;cp&#34;&gt;&amp;lt;?xml version=&amp;#34;1.0&amp;#34; encoding=&amp;#34;UTF-8&amp;#34;?&amp;gt;&lt;/span&gt;
&lt;span class=&#34;nt&#34;&gt;&amp;lt;jmeterTestPlan&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;version=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;1.2&amp;#34;&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;properties=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;3.2&amp;#34;&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;jmeter=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;3.2 r1790748&amp;#34;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;gt;&lt;/span&gt;
  &lt;span class=&#34;nt&#34;&gt;&amp;lt;hashTree&amp;gt;&lt;/span&gt;
    &lt;span class=&#34;nt&#34;&gt;&amp;lt;TestPlan&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;guiclass=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;TestPlanGui&amp;#34;&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;testclass=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;TestPlan&amp;#34;&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;testname=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;æµ‹è¯•è®¡åˆ’&amp;#34;&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;enabled=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;true&amp;#34;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;gt;&lt;/span&gt;
        &lt;span class=&#34;c&#34;&gt;&amp;lt;!-- ä¸€èˆ¬å†™å‹æµ‹è®¡åˆ’ä¸­çš„åºå·+åç§° --&amp;gt;&lt;/span&gt;
      &lt;span class=&#34;nt&#34;&gt;&amp;lt;stringProp&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;name=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;TestPlan.comments&amp;#34;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;gt;&amp;lt;/stringProp&amp;gt;&lt;/span&gt;
      &lt;span class=&#34;nt&#34;&gt;&amp;lt;boolProp&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;name=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;TestPlan.functional_mode&amp;#34;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;gt;&lt;/span&gt;false&lt;span class=&#34;nt&#34;&gt;&amp;lt;/boolProp&amp;gt;&lt;/span&gt;
      &lt;span class=&#34;nt&#34;&gt;&amp;lt;boolProp&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;name=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;TestPlan.serialize_threadgroups&amp;#34;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;gt;&lt;/span&gt;false&lt;span class=&#34;nt&#34;&gt;&amp;lt;/boolProp&amp;gt;&lt;/span&gt;
      &lt;span class=&#34;nt&#34;&gt;&amp;lt;elementProp&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;name=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;TestPlan.user_defined_variables&amp;#34;&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;elementType=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Arguments&amp;#34;&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;guiclass=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;ArgumentsPanel&amp;#34;&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;testclass=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Arguments&amp;#34;&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;testname=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;ç”¨æˆ·å®šä¹‰çš„å˜é‡&amp;#34;&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;enabled=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;true&amp;#34;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;gt;&lt;/span&gt;
        &lt;span class=&#34;nt&#34;&gt;&amp;lt;collectionProp&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;name=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Arguments.arguments&amp;#34;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;/&amp;gt;&lt;/span&gt;
      &lt;span class=&#34;nt&#34;&gt;&amp;lt;/elementProp&amp;gt;&lt;/span&gt;
      &lt;span class=&#34;nt&#34;&gt;&amp;lt;stringProp&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;name=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;TestPlan.user_define_classpath&amp;#34;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;gt;&amp;lt;/stringProp&amp;gt;&lt;/span&gt;
    &lt;span class=&#34;nt&#34;&gt;&amp;lt;/TestPlan&amp;gt;&lt;/span&gt;
    &lt;span class=&#34;nt&#34;&gt;&amp;lt;hashTree&amp;gt;&lt;/span&gt;
      &lt;span class=&#34;nt&#34;&gt;&amp;lt;ThreadGroup&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;guiclass=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;ThreadGroupGui&amp;#34;&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;testclass=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;ThreadGroup&amp;#34;&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;testname=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Thread Group&amp;#34;&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;enabled=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;true&amp;#34;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;gt;&lt;/span&gt;
        &lt;span class=&#34;nt&#34;&gt;&amp;lt;stringProp&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;name=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;ThreadGroup.on_sample_error&amp;#34;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;gt;&lt;/span&gt;continue&lt;span class=&#34;nt&#34;&gt;&amp;lt;/stringProp&amp;gt;&lt;/span&gt;
        &lt;span class=&#34;nt&#34;&gt;&amp;lt;elementProp&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;name=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;ThreadGroup.main_controller&amp;#34;&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;elementType=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;LoopController&amp;#34;&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;guiclass=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;LoopControlPanel&amp;#34;&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;testclass=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;LoopController&amp;#34;&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;testname=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;å¾ªç¯æ§åˆ¶å™¨&amp;#34;&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;enabled=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;true&amp;#34;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;gt;&lt;/span&gt;
          &lt;span class=&#34;nt&#34;&gt;&amp;lt;boolProp&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;name=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;LoopController.continue_forever&amp;#34;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;gt;&lt;/span&gt;false&lt;span class=&#34;nt&#34;&gt;&amp;lt;/boolProp&amp;gt;&lt;/span&gt;
          &lt;span class=&#34;nt&#34;&gt;&amp;lt;intProp&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;name=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;LoopController.loops&amp;#34;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;gt;&lt;/span&gt;-1&lt;span class=&#34;nt&#34;&gt;&amp;lt;/intProp&amp;gt;&lt;/span&gt;
        &lt;span class=&#34;nt&#34;&gt;&amp;lt;/elementProp&amp;gt;&lt;/span&gt;
        &lt;span class=&#34;nt&#34;&gt;&amp;lt;stringProp&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;name=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;ThreadGroup.num_threads&amp;#34;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;gt;&lt;/span&gt;500&lt;span class=&#34;nt&#34;&gt;&amp;lt;/stringProp&amp;gt;&lt;/span&gt;                                             &lt;span class=&#34;c&#34;&gt;&amp;lt;!-- å‘èµ·è¯·æ±‚æ—¶çš„å¹¶å‘çº¿ç¨‹æ•°ï¼Œè¿™é‡Œè®¾ç½®ä¸º500ä¸ªå¹¶å‘çº¿ç¨‹ï¼Œè¡¨ç¤ºä½¿ç”¨è¿™ä¹ˆå¤šçš„çº¿ç¨‹æ•°æ¥è¾¾åˆ°ä¸‹é¢è®¾ç½®çš„TPSæ•° --&amp;gt;&lt;/span&gt;
        &lt;span class=&#34;nt&#34;&gt;&amp;lt;stringProp&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;name=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;ThreadGroup.ramp_time&amp;#34;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;gt;&lt;/span&gt;8&lt;span class=&#34;nt&#34;&gt;&amp;lt;/stringProp&amp;gt;&lt;/span&gt;
        &lt;span class=&#34;nt&#34;&gt;&amp;lt;longProp&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;name=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;ThreadGroup.start_time&amp;#34;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;gt;&lt;/span&gt;1509332694000&lt;span class=&#34;nt&#34;&gt;&amp;lt;/longProp&amp;gt;&lt;/span&gt;
        &lt;span class=&#34;nt&#34;&gt;&amp;lt;longProp&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;name=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;ThreadGroup.end_time&amp;#34;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;gt;&lt;/span&gt;1509332694000&lt;span class=&#34;nt&#34;&gt;&amp;lt;/longProp&amp;gt;&lt;/span&gt;
        &lt;span class=&#34;nt&#34;&gt;&amp;lt;boolProp&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;name=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;ThreadGroup.scheduler&amp;#34;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;gt;&lt;/span&gt;false&lt;span class=&#34;nt&#34;&gt;&amp;lt;/boolProp&amp;gt;&lt;/span&gt;
        &lt;span class=&#34;nt&#34;&gt;&amp;lt;stringProp&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;name=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;ThreadGroup.duration&amp;#34;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;gt;&amp;lt;/stringProp&amp;gt;&lt;/span&gt;
        &lt;span class=&#34;nt&#34;&gt;&amp;lt;stringProp&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;name=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;ThreadGroup.delay&amp;#34;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;gt;&amp;lt;/stringProp&amp;gt;&lt;/span&gt;
      &lt;span class=&#34;nt&#34;&gt;&amp;lt;/ThreadGroup&amp;gt;&lt;/span&gt;
      &lt;span class=&#34;nt&#34;&gt;&amp;lt;hashTree&amp;gt;&lt;/span&gt;
        &lt;span class=&#34;nt&#34;&gt;&amp;lt;HTTPSamplerProxy&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;guiclass=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;HttpTestSampleGui&amp;#34;&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;testclass=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;HTTPSamplerProxy&amp;#34;&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;testname=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;click http request&amp;#34;&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;enabled=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;true&amp;#34;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;gt;&lt;/span&gt;
          &lt;span class=&#34;nt&#34;&gt;&amp;lt;elementProp&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;name=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;HTTPsampler.Arguments&amp;#34;&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;elementType=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Arguments&amp;#34;&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;guiclass=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;HTTPArgumentsPanel&amp;#34;&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;testclass=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Arguments&amp;#34;&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;testname=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;ç”¨æˆ·å®šä¹‰çš„å˜é‡&amp;#34;&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;enabled=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;true&amp;#34;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;gt;&lt;/span&gt;
            &lt;span class=&#34;nt&#34;&gt;&amp;lt;collectionProp&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;name=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Arguments.arguments&amp;#34;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;/&amp;gt;&lt;/span&gt;
          &lt;span class=&#34;nt&#34;&gt;&amp;lt;/elementProp&amp;gt;&lt;/span&gt;
          &lt;span class=&#34;nt&#34;&gt;&amp;lt;stringProp&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;name=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;HTTPSampler.domain&amp;#34;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;gt;&lt;/span&gt;192.168.1.123&lt;span class=&#34;nt&#34;&gt;&amp;lt;/stringProp&amp;gt;&lt;/span&gt;         &lt;span class=&#34;c&#34;&gt;&amp;lt;!-- æ­¤å¤„ä¸ºè¢«å‹æµ‹æœåŠ¡çš„host --&amp;gt;&lt;/span&gt;
          &lt;span class=&#34;nt&#34;&gt;&amp;lt;stringProp&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;name=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;HTTPSampler.port&amp;#34;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;gt;&lt;/span&gt;12345&lt;span class=&#34;nt&#34;&gt;&amp;lt;/stringProp&amp;gt;&lt;/span&gt;                    &lt;span class=&#34;c&#34;&gt;&amp;lt;!-- æ­¤å¤„ä¸ºè¢«å‹æµ‹æœåŠ¡çš„port --&amp;gt;&lt;/span&gt;
          &lt;span class=&#34;nt&#34;&gt;&amp;lt;stringProp&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;name=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;HTTPSampler.protocol&amp;#34;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;gt;&lt;/span&gt;http&lt;span class=&#34;nt&#34;&gt;&amp;lt;/stringProp&amp;gt;&lt;/span&gt;
          &lt;span class=&#34;nt&#34;&gt;&amp;lt;stringProp&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;name=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;HTTPSampler.contentEncoding&amp;#34;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;gt;&amp;lt;/stringProp&amp;gt;&lt;/span&gt;
          &lt;span class=&#34;nt&#34;&gt;&amp;lt;stringProp&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;name=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;HTTPSampler.path&amp;#34;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;gt;&lt;/span&gt;${__StringFromFile(/home/urls.log,,,)}&lt;span class=&#34;nt&#34;&gt;&amp;lt;/stringProp&amp;gt;&lt;/span&gt;  &lt;span class=&#34;c&#34;&gt;&amp;lt;!-- å‘èµ·çš„httpè¯·æ±‚uriä»æ–‡ä»¶è¯»å–ï¼Œæ–‡ä»¶è·¯å¾„ --&amp;gt;&lt;/span&gt;
          &lt;span class=&#34;nt&#34;&gt;&amp;lt;stringProp&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;name=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;HTTPSampler.method&amp;#34;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;gt;&lt;/span&gt;GET&lt;span class=&#34;nt&#34;&gt;&amp;lt;/stringProp&amp;gt;&lt;/span&gt;
          &lt;span class=&#34;nt&#34;&gt;&amp;lt;boolProp&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;name=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;HTTPSampler.follow_redirects&amp;#34;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;gt;&lt;/span&gt;false&lt;span class=&#34;nt&#34;&gt;&amp;lt;/boolProp&amp;gt;&lt;/span&gt;
          &lt;span class=&#34;nt&#34;&gt;&amp;lt;boolProp&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;name=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;HTTPSampler.auto_redirects&amp;#34;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;gt;&lt;/span&gt;false&lt;span class=&#34;nt&#34;&gt;&amp;lt;/boolProp&amp;gt;&lt;/span&gt;
          &lt;span class=&#34;nt&#34;&gt;&amp;lt;boolProp&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;name=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;HTTPSampler.use_keepalive&amp;#34;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;gt;&lt;/span&gt;true&lt;span class=&#34;nt&#34;&gt;&amp;lt;/boolProp&amp;gt;&lt;/span&gt;
          &lt;span class=&#34;nt&#34;&gt;&amp;lt;boolProp&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;name=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;HTTPSampler.DO_MULTIPART_POST&amp;#34;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;gt;&lt;/span&gt;false&lt;span class=&#34;nt&#34;&gt;&amp;lt;/boolProp&amp;gt;&lt;/span&gt;
          &lt;span class=&#34;nt&#34;&gt;&amp;lt;stringProp&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;name=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;HTTPSampler.embedded_url_re&amp;#34;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;gt;&amp;lt;/stringProp&amp;gt;&lt;/span&gt;
          &lt;span class=&#34;nt&#34;&gt;&amp;lt;stringProp&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;name=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;HTTPSampler.implementation&amp;#34;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;gt;&lt;/span&gt;Java&lt;span class=&#34;nt&#34;&gt;&amp;lt;/stringProp&amp;gt;&lt;/span&gt;
          &lt;span class=&#34;nt&#34;&gt;&amp;lt;stringProp&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;name=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;HTTPSampler.connect_timeout&amp;#34;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;gt;&amp;lt;/stringProp&amp;gt;&lt;/span&gt;
          &lt;span class=&#34;nt&#34;&gt;&amp;lt;stringProp&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;name=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;HTTPSampler.response_timeout&amp;#34;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;gt;&amp;lt;/stringProp&amp;gt;&lt;/span&gt;
        &lt;span class=&#34;nt&#34;&gt;&amp;lt;/HTTPSamplerProxy&amp;gt;&lt;/span&gt;
        &lt;span class=&#34;nt&#34;&gt;&amp;lt;hashTree/&amp;gt;&lt;/span&gt;
        &lt;span class=&#34;nt&#34;&gt;&amp;lt;ResponseAssertion&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;guiclass=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;AssertionGui&amp;#34;&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;testclass=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;ResponseAssertion&amp;#34;&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;testname=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Response Assertion&amp;#34;&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;enabled=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;true&amp;#34;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;gt;&lt;/span&gt;
          &lt;span class=&#34;nt&#34;&gt;&amp;lt;collectionProp&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;name=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Asserion.test_strings&amp;#34;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;gt;&lt;/span&gt;
            &lt;span class=&#34;nt&#34;&gt;&amp;lt;stringProp&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;name=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;49586&amp;#34;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;gt;&lt;/span&gt;200&lt;span class=&#34;nt&#34;&gt;&amp;lt;/stringProp&amp;gt;&lt;/span&gt;                                       &lt;span class=&#34;c&#34;&gt;&amp;lt;!-- httpè¯·æ±‚çš„å“åº”æ–­è¨€ï¼Œè¦æ±‚è¿”å›çš„http codeä¸º200æ‰åˆ¤å®šä¸ºæˆåŠŸ --&amp;gt;&lt;/span&gt;
          &lt;span class=&#34;nt&#34;&gt;&amp;lt;/collectionProp&amp;gt;&lt;/span&gt;
          &lt;span class=&#34;nt&#34;&gt;&amp;lt;stringProp&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;name=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Assertion.test_field&amp;#34;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;gt;&lt;/span&gt;Assertion.response_code&lt;span class=&#34;nt&#34;&gt;&amp;lt;/stringProp&amp;gt;&lt;/span&gt;
          &lt;span class=&#34;nt&#34;&gt;&amp;lt;boolProp&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;name=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Assertion.assume_success&amp;#34;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;gt;&lt;/span&gt;false&lt;span class=&#34;nt&#34;&gt;&amp;lt;/boolProp&amp;gt;&lt;/span&gt;
          &lt;span class=&#34;nt&#34;&gt;&amp;lt;intProp&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;name=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Assertion.test_type&amp;#34;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;gt;&lt;/span&gt;8&lt;span class=&#34;nt&#34;&gt;&amp;lt;/intProp&amp;gt;&lt;/span&gt;
        &lt;span class=&#34;nt&#34;&gt;&amp;lt;/ResponseAssertion&amp;gt;&lt;/span&gt;
        &lt;span class=&#34;nt&#34;&gt;&amp;lt;hashTree/&amp;gt;&lt;/span&gt;
        &lt;span class=&#34;nt&#34;&gt;&amp;lt;ConstantThroughputTimer&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;guiclass=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;TestBeanGUI&amp;#34;&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;testclass=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;ConstantThroughputTimer&amp;#34;&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;testname=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Constant Throughput Timer&amp;#34;&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;enabled=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;true&amp;#34;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;gt;&lt;/span&gt;
          &lt;span class=&#34;nt&#34;&gt;&amp;lt;intProp&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;name=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;calcMode&amp;#34;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;gt;&lt;/span&gt;1&lt;span class=&#34;nt&#34;&gt;&amp;lt;/intProp&amp;gt;&lt;/span&gt;
          &lt;span class=&#34;nt&#34;&gt;&amp;lt;doubleProp&amp;gt;&lt;/span&gt;
            &lt;span class=&#34;nt&#34;&gt;&amp;lt;name&amp;gt;&lt;/span&gt;throughput&lt;span class=&#34;nt&#34;&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
            &lt;span class=&#34;nt&#34;&gt;&amp;lt;value&amp;gt;&lt;/span&gt;30000.0&lt;span class=&#34;nt&#34;&gt;&amp;lt;/value&amp;gt;&lt;/span&gt;          &lt;span class=&#34;c&#34;&gt;&amp;lt;!-- 1åˆ†é’Ÿå†…å‘èµ·çš„è¯·æ±‚æ•°ï¼Œæ¢ç®—ä¸ºtpsä¸º500 --&amp;gt;&lt;/span&gt;
            &lt;span class=&#34;nt&#34;&gt;&amp;lt;savedValue&amp;gt;&lt;/span&gt;0.0&lt;span class=&#34;nt&#34;&gt;&amp;lt;/savedValue&amp;gt;&lt;/span&gt;
          &lt;span class=&#34;nt&#34;&gt;&amp;lt;/doubleProp&amp;gt;&lt;/span&gt;
        &lt;span class=&#34;nt&#34;&gt;&amp;lt;/ConstantThroughputTimer&amp;gt;&lt;/span&gt;
        &lt;span class=&#34;nt&#34;&gt;&amp;lt;hashTree/&amp;gt;&lt;/span&gt;
      &lt;span class=&#34;nt&#34;&gt;&amp;lt;/hashTree&amp;gt;&lt;/span&gt;
    &lt;span class=&#34;nt&#34;&gt;&amp;lt;/hashTree&amp;gt;&lt;/span&gt;
    &lt;span class=&#34;nt&#34;&gt;&amp;lt;WorkBench&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;guiclass=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;WorkBenchGui&amp;#34;&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;testclass=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;WorkBench&amp;#34;&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;testname=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;å·¥ä½œå°&amp;#34;&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;enabled=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;true&amp;#34;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;gt;&lt;/span&gt;
      &lt;span class=&#34;nt&#34;&gt;&amp;lt;boolProp&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;name=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;WorkBench.save&amp;#34;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;gt;&lt;/span&gt;true&lt;span class=&#34;nt&#34;&gt;&amp;lt;/boolProp&amp;gt;&lt;/span&gt;
    &lt;span class=&#34;nt&#34;&gt;&amp;lt;/WorkBench&amp;gt;&lt;/span&gt;
    &lt;span class=&#34;nt&#34;&gt;&amp;lt;hashTree/&amp;gt;&lt;/span&gt;
  &lt;span class=&#34;nt&#34;&gt;&amp;lt;/hashTree&amp;gt;&lt;/span&gt;
&lt;span class=&#34;nt&#34;&gt;&amp;lt;/jmeterTestPlan&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h1 id=&#34;è°ƒä¼˜&#34;&gt;è°ƒä¼˜&lt;/h1&gt;
&lt;p&gt;å‚è€ƒï¼šhttps://tech.meituan.com/2016/12/02/performance-tunning.html&lt;/p&gt;
&lt;h1 id=&#34;å¸ƒéš†è¿‡æ»¤å™¨&#34;&gt;å¸ƒéš†è¿‡æ»¤å™¨&lt;/h1&gt;
&lt;p&gt;æœ¬è´¨ä¸Šæ˜¯åŸºäºhashçš„æ¦‚ç‡æ€§æ•°æ®ç»“æ„ï¼Œæ˜¯ä¸€ä¸ªå¾ˆé•¿çš„äºŒè¿›åˆ¶æ•°ç»„ï¼Œä¸»è¦ç”¨äºåˆ¤æ–­å…ƒç´ å¯èƒ½å­˜åœ¨é›†åˆä¸­ï¼Œæˆ–è€…ä¸€å®šä¸åœ¨é›†åˆä¸­ã€‚&lt;/p&gt;
&lt;h2 id=&#34;åŸç†-1&#34;&gt;åŸç†&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;æœ‰ä¸€ä¸ªé•¿åº¦ä¸ºmçš„bitæ•°ç»„ï¼Œåˆå§‹æ¯ä¸ªbitéƒ½æ˜¯0ï¼Œå¦å¤–è¿˜æœ‰kä¸ªhashå‡½æ•°ï¼›&lt;/li&gt;
&lt;li&gt;å½“åŠ å…¥ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œå…ˆè°ƒç”¨kä¸ªhashå‡½æ•°å¾—åˆ°kä¸ªç»“æœï¼Œå°†è¿™kä¸ªç»“æœä¸bitæ•°ç»„é•¿åº¦å–æ¨¡å¾—åˆ°kä¸ªæ•°ç»„ä¸‹æ ‡ï¼Œå°†è¿™kä¸ªæ•°ç»„ä¸‹æ ‡å¯¹åº”çš„å€¼ç½®ä¸º 1ï¼›&lt;/li&gt;
&lt;li&gt;æŸ¥è¯¢å…ƒç´ æ—¶ï¼ŒåŒæ ·ç»è¿‡ä¸Šé¢æ­¥éª¤çš„è®¡ç®—ï¼Œæœ€ç»ˆå¾—åˆ°kä¸ªæ•°ç»„ä¸‹æ ‡ï¼Œåˆ¤æ–­è¿™äº›ä¸‹æ ‡å¯¹åº”çš„å€¼æ˜¯å¦ä¸º1ï¼Œå¦‚æœä¸º1ï¼Œè¯´æ˜å…ƒç´ å¯èƒ½å­˜åœ¨ï¼Œå¦‚æœæœ‰ä¸€ä¸ªä¸ä¸º1ï¼Œè¯´æ˜å…ƒç´ ä¸€å®šä¸å­˜åœ¨ï¼Œè¿”å›ç»“æœï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;è¯¯åˆ¤ç‡è®¡ç®—&#34;&gt;è¯¯åˆ¤ç‡è®¡ç®—&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;æ¶‰åŠåˆ°3ä¸ªé‡è¦çš„å‚æ•°ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;m&lt;/code&gt;è¡¨ç¤ºbitæ•°ç»„çš„é•¿åº¦&lt;/li&gt;
&lt;li&gt;&lt;code&gt;k&lt;/code&gt;è¡¨ç¤ºæ•£åˆ—å‡½æ•°çš„ä¸ªæ•°&lt;/li&gt;
&lt;li&gt;&lt;code&gt;n&lt;/code&gt;è¡¨ç¤ºæ’å…¥çš„å…ƒç´ ä¸ªæ•°&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å¸ƒéš†è¿‡æ»¤å™¨ä¸­ï¼Œä¸€ä¸ªå…ƒç´ æ’å…¥åï¼ŒæŸä¸ªbitä¸º0çš„æ¦‚ç‡æ˜¯&lt;code&gt;(1 âˆ’ 1/m)^k&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;nå…ƒç´ æ’å…¥åï¼ŒæŸä¸ªbitä¸º0çš„æ¦‚ç‡æ˜¯&lt;code&gt;(1 âˆ’ 1/m)^(n*k)&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;false positiveçš„æ¦‚ç‡æ˜¯&lt;code&gt;(1âˆ’(1âˆ’1/m)^n*k)^k&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;å› ä¸ºéœ€è¦çš„æ˜¯&lt;code&gt;k&lt;/code&gt;ä¸ªä¸åŒçš„bitè¢«è®¾ç½®æˆ1ï¼Œæ¦‚ç‡æ˜¯å¤§çº¦æ˜¯&lt;code&gt;(1âˆ’e^(âˆ’k*n/m))^k&lt;/code&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;å®ç°&#34;&gt;å®ç°&lt;/h2&gt;
&lt;p&gt;å¯ä»¥åŸºäºrediså®ç°ï¼Œä½†è¿™é‡Œåªç»™å‡ºgoç‰ˆæœ¬çš„å®ç°ï¼Œæ”¯æŒå¹¶å‘å®‰å…¨&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;48
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;49
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;50
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;51
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;52
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;53
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;54
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;55
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;56
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;57
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;58
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;59
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;60
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;61
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;62
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;63
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;64
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;65
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;66
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;kd&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;mod7&lt;/span&gt;       &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;bitPerByte&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;8&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Filter&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;lock&lt;/span&gt;       &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;sync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;RWMutex&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;concurrent&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt;
	&lt;span class=&#34;c1&#34;&gt;// é•¿åº¦ä¹‹æ‰€ä»¥è¦å–2çš„æŒ‡æ•°æ˜¯å› ä¸ºè¦å°†å–æ¨¡æ“ä½œä¼˜åŒ–æˆä¸æ“ä½œï¼Œ % ç­‰äº &amp;amp;(2^n-1)
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;     &lt;span class=&#34;kt&#34;&gt;uint64&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// bit array of m bits, m will be ceiling to power of 2
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;n&lt;/span&gt;     &lt;span class=&#34;kt&#34;&gt;uint64&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// number of inserted elements
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;log2m&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint64&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// log_2 of m
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;k&lt;/span&gt;     &lt;span class=&#34;kt&#34;&gt;uint64&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// the number of hash function
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;keys&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// byte array to store hash value
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;New&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;size&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint64&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;k&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint64&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;race&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Filter&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;log2&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;uint64&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;math&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Ceil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;math&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Log2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;float64&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;size&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))))&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;filter&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Filter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;          &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;log2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;log2m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;      &lt;span class=&#34;nx&#34;&gt;log2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;k&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;          &lt;span class=&#34;nx&#34;&gt;k&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;keys&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;       &lt;span class=&#34;nb&#34;&gt;make&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;([]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;log2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;concurrent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;race&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;filter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;concurrent&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;filter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lock&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;sync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;RWMutex&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;filter&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Filter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Add&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;data&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Filter&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;concurrent&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;defer&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Unlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;h&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;baseHash&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;uint64&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;k&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;loc&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;location&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;h&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;slot&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;mod&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;location&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;loc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;keys&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;slot&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;mod&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;n&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;// location returns the bit position in byte array
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// &amp;amp; (f.m - 1) is the quick way for mod operation
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Filter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;location&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;h&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint64&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint64&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint64&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;slot&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;h&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;/&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;bitPerByte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;mod&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;h&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;mod7&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;slot&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;mod&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;// baseHash returns the murmur3 128-bit hash
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;baseHash&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;data&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint64&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;a1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// to grab another bit of data
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;hasher&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;murmur3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;New128&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;hasher&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Write&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// #nosec
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;v2&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;hasher&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Sum128&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;hasher&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Write&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;a1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// #nosec
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;v3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;v4&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;hasher&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Sum128&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint64&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;v2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;v3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;v4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h1 id=&#34;æ·˜æ±°ç®—æ³•&#34;&gt;æ·˜æ±°ç®—æ³•&lt;/h1&gt;
&lt;h2 id=&#34;lru&#34;&gt;LRU&lt;/h2&gt;
&lt;p&gt;javaå®ç°ï¼Œéçº¿ç¨‹å®‰å…¨&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;  1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 48
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 49
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 50
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 51
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 52
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 53
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 54
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 55
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 56
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 57
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 58
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 59
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 60
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 61
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 62
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 63
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 64
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 65
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 66
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 67
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 68
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 69
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 70
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 71
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 72
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 73
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 74
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 75
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 76
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 77
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 78
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 79
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 80
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 81
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 82
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 83
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 84
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 85
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 86
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 87
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 88
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 89
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 90
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 91
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 92
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 93
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 94
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 95
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 96
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 97
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 98
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 99
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;100
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;101
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;102
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;103
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;104
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;105
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;106
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;107
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;108
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;109
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;110
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;111
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;112
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;113
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;114
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;115
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// æ³¨æ„æ¯ä¸€æ¬¡å¯¹èŠ‚ç‚¹æœ‰æ“ä½œå¯¹éœ€è¦åŒæ—¶æ“ä½œ nodeMapå’ŒlruQueue
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// LRUæœ¬è´¨æ˜¯åˆ©ç”¨ hashMap å’Œ åŒå‘é“¾è¡¨ å®ç°
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;LRUCache&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;

  &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Map&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Node&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;nodeMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
  &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;DoubleLinkedList&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;lruQueue&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
  &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;size&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;

  &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;LRUCache&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
  &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;

  &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;LRUCache&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;size&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;size&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;size&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;nodeMap&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;HashMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&amp;gt;();&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;lruQueue&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;DoubleLinkedList&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
  &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;


  &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;get&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;Node&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;n&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;nodeMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;get&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;n&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// è·å–åç›´æ¥æ”¾åˆ°åˆ°æœ€å‰çš„ä½ç½®
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;put&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;n&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;n&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;n&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
  &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;

  &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;put&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;Node&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;newNode&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Node&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// å¦‚æœåŒ…å«ï¼Œåˆ™æ”¾åˆ°æœ€å‰
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;nodeMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;containsKey&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;))&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;lruQueue&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;remove&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;nodeMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;get&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;));&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;lruQueue&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;addFirst&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;newNode&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
      &lt;span class=&#34;c1&#34;&gt;// è®°å¾—æ›´æ–°map
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;nodeMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;put&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;newNode&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;c1&#34;&gt;// å¦‚æœæ»¡äº†ï¼Œåˆ™ç§»é™¤æœ€åä¸€ä¸ª
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;size&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;lruQueue&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;size&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;())&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;Node&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;last&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;lruQueue&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;removeLast&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;nodeMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;remove&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;last&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
      &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;nodeMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;put&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;newNode&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;lruQueue&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;addFirst&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;newNode&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
  &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;

  &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;Node&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
    &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
    &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Node&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pre&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
    &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Node&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;next&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;

    &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Node&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;k&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;key&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
      &lt;span class=&#34;k&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;value&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
  &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;

  &lt;span class=&#34;c1&#34;&gt;// å°è£…åŒå‘é“¾è¡¨æ–¹æ³•ï¼Œæ„å»ºæ—¶è¦æ³¨æ„å‰åèŠ‚ç‚¹æŒ‡å‘å’Œç©ºæŒ‡é’ˆé—®é¢˜
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;DoubleLinkedList&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Node&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;head&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
    &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Node&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;tail&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
    &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;count&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;

    &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;addFirst&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Node&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;n&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;head&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;tail&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;n&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
      &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;count&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;++;&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;n&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;next&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;head&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
      &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;head&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;head&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;pre&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;n&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
      &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;head&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;n&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;

    &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Node&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;removeLast&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;count&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
      &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;Node&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;result&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;tail&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
      &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;tail&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;pre&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;tail&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;pre&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;next&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
      &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;head&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;tail&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
      &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;count&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;--;&lt;/span&gt;
      &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;result&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;

    &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;remove&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Node&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;n&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;count&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
      &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;count&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;--;&lt;/span&gt;
      &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;n&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;pre&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;n&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;pre&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;next&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;n&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;next&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
      &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;head&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;n&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;next&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
      &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
      &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;n&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;next&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;n&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;next&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;pre&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;n&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;pre&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
      &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;tail&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;n&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;pre&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
      &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;

    &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;size&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;count&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
  &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;golangå®ç°ï¼Œéå¹¶å‘å®‰å…¨ï¼Œä¸‹é¢è¿™ç§å†™æ³•æ˜¯å¹³é“ºäº†åŒå‘é“¾è¡¨ï¼Œé“¾è¡¨çš„é•¿åº¦é€šè¿‡mapçš„é•¿åº¦è®¡ç®—å¾—åˆ°&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;48
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;49
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;50
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;51
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;52
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;53
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;54
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;55
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;56
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;57
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;58
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;59
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;60
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;61
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;62
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;63
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;64
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;65
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;66
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;67
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;68
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;69
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;70
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;71
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;72
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;73
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;74
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;75
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;76
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;77
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;LRUCache&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;nodeMap&lt;/span&gt;  &lt;span class=&#34;kd&#34;&gt;map&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Node&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;head&lt;/span&gt;     &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Node&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;tail&lt;/span&gt;     &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Node&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;cap&lt;/span&gt;      &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Node&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt;   &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;val&lt;/span&gt;   &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;next&lt;/span&gt;  &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Node&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;pre&lt;/span&gt;   &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Node&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;NewLRUCache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;capacity&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;LRUCache&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;LRUCache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;nodeMap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;make&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;map&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;capacity&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lru&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;LRUCache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;existNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;exist&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;lru&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;nodeMap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;];&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;exist&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;nx&#34;&gt;lru&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;remove&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;existNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
        &lt;span class=&#34;nx&#34;&gt;lru&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;addFirst&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;existNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
        &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;existNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;val&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lru&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;LRUCache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Put&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;val&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;existNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;exist&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;lru&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;nodeMap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;];&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;exist&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;nx&#34;&gt;existNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;val&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;val&lt;/span&gt;
        &lt;span class=&#34;nx&#34;&gt;lru&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;remove&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;existNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
        &lt;span class=&#34;nx&#34;&gt;lru&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;addFirst&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;existNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
        &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;nx&#34;&gt;newNode&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;val&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;val&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
        &lt;span class=&#34;nx&#34;&gt;lru&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;nodeMap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;newNode&lt;/span&gt;
        &lt;span class=&#34;nx&#34;&gt;lru&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;addFirst&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;newNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lru&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;nodeMap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;lru&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cap&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;c1&#34;&gt;// ä¸€å®šè¦å…ˆdeleteï¼Œå¦‚æœå…ˆremoveï¼Œä¼šå¯¼è‡´æ‰¾ä¸å›tailçš„keyè¿›è¡Œdeleteï¼Œ
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;nb&#34;&gt;delete&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lru&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;nodeMap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;lru&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;tail&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
        &lt;span class=&#34;nx&#34;&gt;lru&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;remove&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lru&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;tail&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lru&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;LRUCache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;addFirst&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;n&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;n&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pre&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;n&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;next&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;lru&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;head&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;lru&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;head&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;nx&#34;&gt;lru&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;head&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pre&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;n&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;lru&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;head&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;n&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;lru&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;tail&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;nx&#34;&gt;lru&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;tail&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;n&lt;/span&gt;
        &lt;span class=&#34;nx&#34;&gt;lru&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;tail&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;next&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lru&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;LRUCache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;remove&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;n&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// nçš„nextå’Œpreè¦ç½®ä¸ºnullï¼Œé˜²æ­¢å†…å­˜æ³„æ¼
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;n&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;lru&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;head&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;nx&#34;&gt;lru&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;head&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;n&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;next&lt;/span&gt;
        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;n&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;next&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
            &lt;span class=&#34;nx&#34;&gt;n&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;next&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pre&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
        &lt;span class=&#34;nx&#34;&gt;n&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;next&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
        &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;n&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;lru&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;tail&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;nx&#34;&gt;lru&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;tail&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;n&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pre&lt;/span&gt;
        &lt;span class=&#34;nx&#34;&gt;n&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pre&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;next&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
        &lt;span class=&#34;nx&#34;&gt;n&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pre&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
        &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;n&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pre&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;next&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;n&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;next&lt;/span&gt;
    &lt;span class=&#34;nx&#34;&gt;n&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;next&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pre&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;n&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pre&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;å…³äºå¹¶å‘å®‰å…¨ï¼Œæœ€ç®€å•çš„å®ç°å°±æ˜¯åœ¨è°ƒç”¨Getå’ŒPutæ–¹æ³•æ—¶åŠ è¯»å†™é”ï¼Œä½†æ˜¯è¿™ç§åšæ³•é”çš„ç²’åº¦æ¯”è¾ƒå¤§ï¼Œæ¯æ¬¡ä¼šé”ä½æ•´ä¸ªåº•å±‚çš„åŒå‘é“¾è¡¨å’Œmapï¼Œå¯¼è‡´åœ¨é«˜å¹¶å‘æƒ…å†µä¸‹ååé‡ä¸é«˜ï¼Œä¼˜åŒ–çš„æ€è·¯å°±æ˜¯å¯¹mapåˆ†ç‰‡ï¼Œé€šè¿‡åˆ†ç‰‡ä¸Šé”æ¥å‡å°é”çš„ç²’åº¦ï¼Œç„¶åå†åŒå‘é“¾è¡¨èŠ‚ç‚¹çš„æ“ä½œä¸Šè¿›è¡Œä¼˜åŒ–ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;New&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;capacity&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;LRUCache&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;shards&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;make&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;map&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;LRUCacheShard&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;256&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;256&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;shards&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Sprintf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;%02x&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;LRUCacheShard&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;Cap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;  &lt;span class=&#34;nx&#34;&gt;capacity&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;Keys&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;make&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;map&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;list&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Element&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;List&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;list&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;New&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;LRUCache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;shards&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;shards&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;LRUCache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;shard&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;GetShard&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;shard&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;RLock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;defer&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;shard&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;RUnlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
	&lt;span class=&#34;err&#34;&gt;â€¦â€¦&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;LRUCache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Put&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;value&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
  	&lt;span class=&#34;nx&#34;&gt;shard&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;GetShard&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;shard&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;defer&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;shard&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Unlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
	&lt;span class=&#34;err&#34;&gt;â€¦â€¦&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;LRUCache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;GetShard&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;shard&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;LRUCacheShard&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
  &lt;span class=&#34;nx&#34;&gt;hasher&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;sha1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;New&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
  &lt;span class=&#34;nx&#34;&gt;hasher&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Write&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;([]&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
  &lt;span class=&#34;nx&#34;&gt;shardKey&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt;  &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Sprintf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;%x&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;hasher&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Sum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;shards&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;shardKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;å…¶ä¸­ï¼Œåœ¨Getæ–¹æ³•ä¸­ï¼Œå¦‚æœå­˜åœ¨ï¼Œè¿˜éœ€è¦ä¿®æ”¹keyæ‰€åœ¨èŠ‚ç‚¹çš„ä½ç½®ï¼Œç›´æ¥è°ƒputå³å¯ï¼Œå½“ç„¶è¿™ç§æ–¹å¼çš„ç²’åº¦è¿˜æ˜¯æ¯”è¾ƒå¤§ï¼Œå†æ¬¡ä¼˜åŒ–çš„æ€è·¯æ˜¯å¯¹mapçš„æ“ä½œè¿˜æ˜¯å¾—ä¸Šé”ï¼Œä½†å¯¹åŒå‘é“¾è¡¨çš„æ“ä½œæ— éœ€ä¸Šé”ï¼ŒåŒå‘é“¾è¡¨ç§»åŠ¨èŠ‚ç‚¹å’Œåˆ é™¤èŠ‚ç‚¹å¯ä»¥åŒæ—¶æ“ä½œï¼Œå¯ä»¥é€šè¿‡ä¸¤ä¸ªchannelå®ç°ï¼Œ&lt;a class=&#34;link&#34; href=&#34;https://github.com/halfrost/LeetCode-Go/blob/master/template/CLRUCache.go&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;å‚è€ƒ&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;lfu&#34;&gt;LFU&lt;/h2&gt;
&lt;p&gt;javaå®ç°ï¼Œéçº¿ç¨‹å®‰å…¨&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;48
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;49
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;50
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;51
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;52
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;53
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;54
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;55
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;56
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;57
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;58
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;59
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;60
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;61
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;62
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;63
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;64
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;65
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;66
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;67
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;68
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;69
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;70
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;71
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;72
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;73
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;74
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;75
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;cm&#34;&gt;/**
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt; * é¢‘æ¬¡æœ€å°‘ä½¿ç”¨
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt; * è®¾å®šå®¹é‡ï¼Œæ¯æ¬¡get keyä¼šä¿®æ”¹ä½¿ç”¨æ¬¡æ•°å’Œä½¿ç”¨æ—¶é—´ï¼Œå½“æ»¡å®¹é‡æ—¶ï¼Œç§»é™¤æ¬¡æ•°æœ€å°‘çš„é‚£ä¸ª
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt; * å¦‚æœæœ‰å¤šä¸ªkeyçš„ä½¿ç”¨æ¬¡æ•°ä¸€æ ·ï¼Œåˆ™ç§»é™¤ä½¿ç”¨æ—¶é—´æœ€æ—§çš„é‚£ä¸ª
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt; */&lt;/span&gt;
&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;LFUCache&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;

    &lt;span class=&#34;n&#34;&gt;Map&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;keyValMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;Map&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Integer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;key2FreqMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// keyå’Œä½¿ç”¨é¢‘ç‡çš„æ˜ å°„
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// ç”¨LinkHashSetæ¥æ¨¡æ‹Ÿä½¿ç”¨æ—¶é—´ï¼Œä½¿ç”¨LinkHashSetè¿˜æœ‰ä¸€ä¸ªç›®çš„æ˜¯ä¾¿äºæ ¹æ®keyè¿›è¡Œåˆ é™¤
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;Map&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Integer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LinkedHashSet&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;freq2KeysMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// ä½¿ç”¨é¢‘ç‡å’Œkeyçš„æ˜ å°„
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;minFreq&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
    &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;

    &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;LFUCache&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;keyValMap&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;HashMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&amp;gt;();&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;key2FreqMap&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;HashMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&amp;gt;();&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;freq2KeysMap&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;HashMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&amp;gt;();&lt;/span&gt;
        &lt;span class=&#34;k&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;cap&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
        &lt;span class=&#34;k&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;minFreq&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;

    &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;get&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(!&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;keyValMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;containsKey&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;))&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
            &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
        &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;increaseFreq&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
        &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;keyValMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;get&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;

    &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;put&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;val&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;cap&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
            &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
        &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;keyValMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;containsKey&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;))&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
            &lt;span class=&#34;n&#34;&gt;keyValMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;put&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;val&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
            &lt;span class=&#34;n&#34;&gt;increaseFreq&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
            &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
        &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;cap&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;keyValMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;size&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;())&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
            &lt;span class=&#34;n&#34;&gt;removeMinFreqKey&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
        &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;keyValMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;put&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;val&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;key2FreqMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;put&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;freq2KeysMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;putIfAbsent&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LinkedHashSet&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&amp;gt;());&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;freq2KeysMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;get&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;add&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
        &lt;span class=&#34;k&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;minFreq&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;

    &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;increaseFreq&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;freq&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;key2FreqMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;get&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;key2FreqMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;put&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;freq&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;freq2KeysMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;get&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;freq&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;remove&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;freq2KeysMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;putIfAbsent&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;freq&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LinkedHashSet&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&amp;gt;());&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;freq2KeysMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;get&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;freq&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;add&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;freq2KeysMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;get&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;freq&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;isEmpty&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;())&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
            &lt;span class=&#34;n&#34;&gt;freq2KeysMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;remove&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;freq&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
            &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;freq&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;minFreq&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
                &lt;span class=&#34;k&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;minFreq&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++;&lt;/span&gt;
            &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
        &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;

    &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;removeMinFreqKey&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;LinkedHashSet&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;keys&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;freq2KeysMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;get&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;minFreq&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;delKey&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;keys&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;iterator&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;next&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;keys&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;remove&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;delKey&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;keys&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;isEmpty&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;())&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
            &lt;span class=&#34;n&#34;&gt;freq2KeysMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;remove&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;minFreq&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
            &lt;span class=&#34;c1&#34;&gt;// è¿™é‡Œæ— éœ€æ›´æ–° minFreq çš„å€¼ï¼Œå› ä¸ºè¯¥æ–¹æ³•æ˜¯åœ¨æ’å…¥æ–°keyæ—¶ä½¿ç”¨ï¼Œæ­¤æ—¶minFreqä¸€å®šæ˜¯1
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;keyValMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;remove&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;delKey&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;key2FreqMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;remove&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;delKey&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;golangå®ç°ï¼Œéå¹¶å‘å®‰å…¨ï¼Œåˆ©ç”¨ ä¼˜å…ˆçº§é˜Ÿåˆ—ï¼ˆæœ€å°å †ï¼‰ + mapå®ç°ï¼Œä½¿ç”¨çš„æ˜¯goè‡ªå¸¦çš„heapæ•°æ®ç»“æ„ï¼Œé€šè¿‡Itemæ•°ç»„ç»“æ„å®ç°&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;  1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 48
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 49
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 50
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 51
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 52
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 53
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 54
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 55
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 56
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 57
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 58
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 59
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 60
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 61
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 62
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 63
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 64
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 65
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 66
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 67
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 68
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 69
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 70
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 71
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 72
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 73
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 74
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 75
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 76
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 77
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 78
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 79
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 80
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 81
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 82
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 83
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 84
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 85
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 86
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 87
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 88
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 89
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 90
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 91
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 92
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 93
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 94
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 95
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 96
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 97
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 98
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 99
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;100
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;101
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;102
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;103
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;104
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;105
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;container/heap&amp;#34;&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;LFUNode&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
  	&lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt;   &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;val&lt;/span&gt;   &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;freq&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// ç”¨äºä¼˜å…ˆçº§ï¼Œkeyçš„ä½¿ç”¨é¢‘ç‡
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;count&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// ç”¨äºå½“freqç›¸åŒæ—¶çš„æ¯”è¾ƒæ·˜æ±°ï¼Œæ€»çš„è·å–æ¬¡æ•°ï¼Œç±»ä¼¼æ—¶é—´æˆ³çš„æ¦‚å¿µ
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;index&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// æœ€å°å †ä¸­å…ƒç´ çš„ä¸‹æ ‡ï¼Œç”¨äºé‡å»ºæœ€å°å †.
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PriorityQueue&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;LFUNode&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pq&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PriorityQueue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pq&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pq&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PriorityQueue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Less&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;j&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;c1&#34;&gt;// ä¼˜å…ˆæ ¹æ®ä½¿ç”¨é¢‘ç‡æ’åˆ—ï¼Œç›¸ç­‰æ—¶æ‰ä½¿ç”¨countï¼Œä»å°åˆ°å¤§æ’åº
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pq&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;].&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;freq&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pq&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;j&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;].&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;freq&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pq&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;].&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;count&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pq&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;j&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;].&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;count&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pq&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;].&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;freq&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pq&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;j&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;].&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;freq&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pq&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PriorityQueue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Swap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;j&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;pq&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;],&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pq&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;j&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pq&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;j&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;],&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pq&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;pq&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;].&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;index&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;pq&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;j&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;].&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;index&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;j&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pq&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;PriorityQueue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Push&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;x&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{})&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;n&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pq&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;LFUNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;index&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;n&lt;/span&gt;
	&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pq&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;append&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pq&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pq&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;PriorityQueue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Pop&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;old&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pq&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;n&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;old&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;old&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;n&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;old&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;n&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;// é˜²æ­¢å†…å­˜æ³„éœ²
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;index&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// popæ—¶é‡ç½®ä¸‹æ ‡ä¿è¯å®‰å…¨
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pq&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;old&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;n&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;// æ›´æ–°æœ€å°å †é‡Œçš„å…ƒç´ 
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pq&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;PriorityQueue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;update&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;LFUNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;value&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;frequency&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;count&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;val&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;value&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;count&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;count&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;freq&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;frequency&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;heap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Fix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pq&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;index&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;// ==========================================
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;LFUCache&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;cap&lt;/span&gt;      &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;pq&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;PriorityQueue&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;nodeMap&lt;/span&gt;  &lt;span class=&#34;kd&#34;&gt;map&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;LFUNode&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;counter&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;NewLFUCache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;capacity&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;LFUCache&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;LFUCache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;pq&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;PriorityQueue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{},&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;nodeMap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;  &lt;span class=&#34;nb&#34;&gt;make&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;map&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;LFUNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;capacity&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;cap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;      &lt;span class=&#34;nx&#34;&gt;capacity&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lfu&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;LFUCache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;lfu&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cap&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;lfu&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;nodeMap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;];&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;lfu&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;counter&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;lfu&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pq&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;update&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;val&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;freq&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;lfu&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;counter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;val&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lfu&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;LFUCache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Put&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;value&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;lfu&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cap&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;lfu&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;counter&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;
	&lt;span class=&#34;c1&#34;&gt;// å¦‚æœå­˜åœ¨ï¼Œå¢åŠ  frequencyï¼Œå†è°ƒæ•´å †
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;lfu&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;nodeMap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;];&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;lfu&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pq&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;update&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;freq&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;lfu&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;counter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;c1&#34;&gt;// å¦‚æœä¸å­˜åœ¨ä¸”ç¼“å­˜æ»¡äº†ï¼Œéœ€è¦åˆ é™¤ã€‚åœ¨ hashmap å’Œ pq ä¸­åˆ é™¤ã€‚
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lfu&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pq&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;lfu&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cap&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;heap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Pop&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lfu&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pq&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;LFUNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nb&#34;&gt;delete&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lfu&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;nodeMap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;c1&#34;&gt;// æ–°å»ºç»“ç‚¹ï¼Œåœ¨ hashmap å’Œ pq ä¸­æ·»åŠ ã€‚
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;LFUNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;val&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;   &lt;span class=&#34;nx&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;   &lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;count&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;lfu&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;counter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;heap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Push&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lfu&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pq&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;lfu&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;nodeMap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;å¦ä¸€ä¸ªç‰ˆæœ¬å®ç°ï¼Œåˆ©ç”¨goæœ¬èº«æä¾›çš„åŒå‘é“¾è¡¨ï¼Œä½†æ˜¯ç”±äºgoæ²¡æ³›å‹ï¼Œåœ¨ç±»å‹æ¨æ–­æ–¹é¢å¯¼è‡´æ•´ä½“æ€§èƒ½ä¸ä¼šå¾ˆé«˜&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;48
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;49
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;50
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;51
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;52
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;53
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;54
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;55
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;56
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;57
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;58
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;59
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;60
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;61
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;62
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;63
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;64
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;65
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;66
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;67
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;68
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;69
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;70
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;71
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;72
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;73
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;LFUCache2&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;nodeMap&lt;/span&gt;       &lt;span class=&#34;kd&#34;&gt;map&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;list&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Element&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;freq2NodeList&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;map&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;list&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;List&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;cap&lt;/span&gt;           &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;min&lt;/span&gt;           &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt;       &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;value&lt;/span&gt;     &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;freq&lt;/span&gt;      &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;NewLFUCache2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;capacity&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;LFUCache2&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;LFUCache2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;nodeMap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;make&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;map&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;list&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Element&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;freq2NodeList&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;    &lt;span class=&#34;nb&#34;&gt;make&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;map&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;list&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;List&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;cap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;      &lt;span class=&#34;nx&#34;&gt;capacity&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;min&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;      &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lfu&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;LFUCache2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;lfu&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;nodeMap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;currentNode&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;lfu&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;freq2NodeList&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;currentNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;freq&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;].&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Remove&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;currentNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;freq&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;lfu&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;freq2NodeList&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;currentNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;freq&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;];&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;lfu&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;freq2NodeList&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;currentNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;freq&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;list&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;New&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;newList&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;lfu&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;freq2NodeList&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;currentNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;freq&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;newNode&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;newList&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;PushFront&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;currentNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;lfu&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;nodeMap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;newNode&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;currentNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;freq&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;lfu&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;min&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;lfu&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;freq2NodeList&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;currentNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;freq&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;].&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;lfu&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;min&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;currentNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;value&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lfu&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;LFUCache2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Put&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;value&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;lfu&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cap&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;c1&#34;&gt;// å¦‚æœå­˜åœ¨ï¼Œæ›´æ–°è®¿é—®æ¬¡æ•°
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;currentValue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;lfu&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;nodeMap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;];&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;currentNode&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;currentValue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;currentNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;value&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;value&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;lfu&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;c1&#34;&gt;// å¦‚æœä¸å­˜åœ¨ä¸”ç¼“å­˜æ»¡äº†ï¼Œéœ€è¦åˆ é™¤
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;lfu&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cap&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lfu&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;nodeMap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;currentList&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;lfu&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;freq2NodeList&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lfu&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;min&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;backNode&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;currentList&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Back&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
		&lt;span class=&#34;nb&#34;&gt;delete&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lfu&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;nodeMap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;backNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;currentList&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Remove&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;backNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;c1&#34;&gt;// æ–°å»ºç»“ç‚¹ï¼Œæ’å…¥åˆ° 2 ä¸ª map ä¸­
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;lfu&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;min&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;currentNode&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;     &lt;span class=&#34;nx&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;freq&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;      &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;lfu&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;freq2NodeList&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;];&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;lfu&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;freq2NodeList&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;list&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;New&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;newList&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;lfu&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;freq2NodeList&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;newNode&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;newList&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;PushFront&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;currentNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;lfu&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;nodeMap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;newNode&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h1 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h1&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://liangyaopei.github.io/2020/07/29/bloom-filter/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;å¸ƒéš†è¿‡æ»¤å™¨åŸç†åŠgolangå®ç°&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://halfrost.com/lru_lfu_interview/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;LRU / LFU çš„é’é“œä¸ç‹è€…&lt;/a&gt;&lt;/p&gt;
</description>
        </item>
        <item>
        <title>è®¾è®¡æ¨¡å¼</title>
        <link>http://nixum.cc/p/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/</link>
        <pubDate>Tue, 22 Sep 2020 00:00:00 +0000</pubDate>
        
        <guid>http://nixum.cc/p/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/</guid>
        <description>&lt;p&gt;[TOC]&lt;/p&gt;
&lt;p&gt;åªè®°å½•å¸¸ç”¨è®¾è®¡æ¨¡å¼&lt;/p&gt;
&lt;h1 id=&#34;è®¾è®¡æ¨¡å¼å…­å¤§åŸåˆ™&#34;&gt;è®¾è®¡æ¨¡å¼å…­å¤§åŸåˆ™&lt;/h1&gt;
&lt;ol&gt;
&lt;li&gt;å•ä¸€èŒè´£åŸåˆ™(SRP)ï¼šä¸€ä¸ªç±»åªè´Ÿè´£ä¸€ä¸ªåŠŸèƒ½é¢†åŸŸä¸­çš„ç›¸åº”èŒè´£ï¼Œå°±ä¸€ä¸ªç±»è€Œè¨€ï¼Œåº”è¯¥åªæœ‰ä¸€ä¸ªå¼•èµ·å®ƒå˜åŒ–çš„åŸå› ã€‚&lt;/li&gt;
&lt;li&gt;å¼€é—­åŸåˆ™(OCP)ï¼šä¸€ä¸ªè½¯ä»¶å®ä½“åº”å½“å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ã€‚å³è½¯ä»¶å®ä½“åº”å°½é‡åœ¨ä¸ä¿®æ”¹åŸæœ‰ä»£ç çš„æƒ…å†µä¸‹è¿›è¡Œæ‰©å±•ã€‚&lt;/li&gt;
&lt;li&gt;é‡Œæ°ä»£æ¢åŸåˆ™(LSP)ï¼šæ‰€æœ‰å¼•ç”¨åŸºç±»ï¼ˆçˆ¶ç±»ï¼‰çš„åœ°æ–¹å¿…é¡»èƒ½é€æ˜åœ°ä½¿ç”¨å…¶å­ç±»çš„å¯¹è±¡ã€‚&lt;/li&gt;
&lt;li&gt;ä¾èµ–å€’è½¬åŸåˆ™(DIP)ï¼šæŠ½è±¡ä¸åº”è¯¥ä¾èµ–äºç»†èŠ‚ï¼Œç»†èŠ‚åº”å½“ä¾èµ–äºæŠ½è±¡ã€‚æ¢è¨€ä¹‹ï¼Œè¦é’ˆå¯¹æ¥å£ç¼–ç¨‹ï¼Œè€Œä¸æ˜¯é’ˆå¯¹å®ç°ç¼–ç¨‹ã€‚å¦‚ æ§åˆ¶åè½¬å’Œä¾èµ–æ³¨å…¥&lt;/li&gt;
&lt;li&gt;æ¥å£éš”ç¦»åŸåˆ™(ISP)ï¼šä½¿ç”¨å¤šä¸ªä¸“é—¨çš„æ¥å£ï¼Œè€Œä¸ä½¿ç”¨å•ä¸€çš„æ€»æ¥å£ï¼Œå³å®¢æˆ·ç«¯ä¸åº”è¯¥ä¾èµ–é‚£äº›å®ƒä¸éœ€è¦çš„æ¥å£ã€‚&lt;/li&gt;
&lt;li&gt;è¿ªç±³ç‰¹æ³•åˆ™(LoD)ï¼šä¸€ä¸ªè½¯ä»¶å®ä½“åº”å½“å°½å¯èƒ½å°‘åœ°ä¸å…¶ä»–å®ä½“å‘ç”Ÿç›¸äº’ä½œç”¨ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;å¸¸è§è®¾è®¡æ¨¡å¼&#34;&gt;å¸¸è§è®¾è®¡æ¨¡å¼&lt;/h1&gt;
&lt;p&gt;åˆ›å»ºå‹æ¨¡å¼æ˜¯å°†åˆ›å»ºå’Œä½¿ç”¨ä»£ç è§£è€¦&lt;/p&gt;
&lt;p&gt;ç»“æ„å‹æ¨¡å¼æ˜¯å°†ä¸åŒåŠŸèƒ½ä»£ç è§£è€¦&lt;/p&gt;
&lt;p&gt;è¡Œä¸ºå‹æ¨¡å¼æ˜¯å°†ä¸åŒçš„è¡Œä¸ºä»£ç è§£è€¦&lt;/p&gt;
&lt;h2 id=&#34;åˆ›å»ºå‹&#34;&gt;åˆ›å»ºå‹&lt;/h2&gt;
&lt;h3 id=&#34;å•ä¾‹æ¨¡å¼&#34;&gt;å•ä¾‹æ¨¡å¼&lt;/h3&gt;
&lt;p&gt;ä¸»è¦è§£å†³ï¼šä¸€ä¸ªå…¨å±€ä½¿ç”¨çš„ç±»è¢«é¢‘ç¹åˆ›å»ºå’Œé”€æ¯ï¼Œæ•°æ®åœ¨åº”ç”¨ä¸Šåªä¿æŒä¸€ä»½ï¼Œè§£å†³èµ„æºè®¿é—®å†²çªçš„é—®é¢˜ï¼Œå°±å¯ä»¥ä½¿ç”¨å•ä¾‹æ¨¡å¼&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;  1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 48
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 49
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 50
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 51
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 52
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 53
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 54
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 55
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 56
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 57
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 58
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 59
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 60
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 61
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 62
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 63
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 64
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 65
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 66
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 67
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 68
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 69
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 70
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 71
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 72
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 73
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 74
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 75
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 76
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 77
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 78
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 79
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 80
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 81
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 82
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 83
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 84
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 85
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 86
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 87
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 88
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 89
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 90
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 91
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 92
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 93
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 94
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 95
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 96
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 97
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 98
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 99
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;100
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;101
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;102
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;103
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;104
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;105
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;cm&#34;&gt;/** 1.
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt; * æ‡’æ±‰æ¨¡å¼,çº¿ç¨‹ä¸å®‰å…¨ï¼Œåªæœ‰åœ¨è°ƒç”¨æ–¹æ³•çš„æ—¶å€™æ‰å®ä¾‹åŒ–,å¥½å¤„æ˜¯æ²¡ç”¨åˆ°è¯¥ç±»æ—¶å°±ä¸å®ä¾‹åŒ–ï¼ŒèŠ‚çº¦èµ„æº
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt; */&lt;/span&gt;
&lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;LazyInstance&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;

    &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LazyInstance&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;singleton&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;

    &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;LazyInstance&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;//        if (singleton != null)
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;//            throw new RuntimeException();
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;

    &lt;span class=&#34;cm&#34;&gt;/** 1.1
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;     * æƒ³è¦çº¿ç¨‹å®‰å…¨åªéœ€åœ¨æ–¹æ³•ä¸ŠåŠ ä¸Šsynchronizedå…³é”®å­—ï¼Œç¼ºç‚¹æ˜¯ï¼Œå¤šçº¿ç¨‹è®¿é—®æ—¶é”çš„æ“ä½œè€—æ—¶
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;     */&lt;/span&gt;
    &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LazyInstance&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getInstance&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;singleton&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
            &lt;span class=&#34;n&#34;&gt;singleton&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LazyInstance&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
        &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
        &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;singleton&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;cm&#34;&gt;/** 2.
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt; * é¥¿æ±‰æ¨¡å¼ï¼Œç›´æ¥å®ä¾‹åŒ–ï¼Œçº¿ç¨‹å®‰å…¨ï¼Œç¼ºç‚¹æ˜¯ä¸¢å¤±äº†å»¶è¿Ÿå®ä¾‹åŒ–é€ æˆèµ„æºæµªè´¹
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt; */&lt;/span&gt;
&lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;HungryInstance&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;

    &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;final&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;HungryInstance&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;singleton&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;HungryInstance&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;   &lt;span class=&#34;c1&#34;&gt;//åŠ ä¸åŠ finaléƒ½å¯ä»¥
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
    &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;HungryInstance&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getInstance&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;singleton&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;cm&#34;&gt;/** 3.
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt; * åŒé‡é”,å¯åœ¨å¤šçº¿ç¨‹ä¸‹ä½¿ç”¨
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt; */&lt;/span&gt;
&lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;DoubleCheckedLocking&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;

    &lt;span class=&#34;cm&#34;&gt;/**
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;     * æ³¨æ„å˜é‡è¦å£°æ˜volatile,ä¹Ÿéœ€è¦ä¸¤æ¬¡ifåˆ¤æ–­,å¦åˆ™å¯èƒ½å› ä¸ºæŒ‡ä»¤é‡æ’åºå¯¼è‡´åœ¨å¤šçº¿ç¨‹æƒ…å†µä¸‹ä¸å®‰å…¨,è¿™ä¸ªæ¯”è¾ƒéš¾æµ‹è¯•
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;     * singleton = new Singleton()ä¸æ˜¯åŸå­æ“ä½œï¼Œè€Œåˆ†ä¸ºäº†ä¸‰ä¸ªæ­¥éª¤
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;     * 1. ç»™ singleton åˆ†é…å†…å­˜
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;     * 2. è°ƒç”¨ Singleton çš„æ„é€ å‡½æ•°æ¥åˆå§‹åŒ–æˆå‘˜å˜é‡ï¼Œå½¢æˆå®ä¾‹
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;     * 3. å°†singletonå¯¹è±¡æŒ‡å‘åˆ†é…çš„å†…å­˜ç©ºé—´ï¼ˆæ‰§è¡Œå®Œè¿™æ­¥ singletonæ‰æ˜¯é nulläº†ï¼‰
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;     * ç”±äºæœ‰ä¸€ä¸ªã€instanceå·²ç»ä¸ä¸ºnullä½†æ˜¯ä»æ²¡æœ‰å®Œæˆåˆå§‹åŒ–ã€çš„ä¸­é—´çŠ¶æ€ï¼Œè€Œè¿™ä¸ªæ—¶å€™ï¼Œ
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;     * å¦‚æœæœ‰å…¶ä»–çº¿ç¨‹åˆšå¥½è¿è¡Œåˆ°ç¬¬ä¸€å±‚if (instance ==null)è¿™é‡Œï¼Œè¿™é‡Œè¯»å–åˆ°çš„instanceå·²ç»ä¸ä¸ºnulläº†ï¼Œ
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;     * æ‰€ä»¥å°±ç›´æ¥æŠŠè¿™ä¸ªä¸­é—´çŠ¶æ€çš„instanceæ‹¿å»ç”¨äº†ï¼Œå°±ä¼šäº§ç”Ÿé—®é¢˜ã€‚è¿™é‡Œçš„å…³é”®åœ¨äºçº¿ç¨‹T1å¯¹instanceçš„å†™æ“ä½œæ²¡æœ‰å®Œæˆï¼Œ
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;     * çº¿ç¨‹T2å°±æ‰§è¡Œäº†è¯»æ“ä½œ **/&lt;/span&gt;
    &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;volatile&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;DoubleCheckedLocking&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;singleton&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;

    &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;DoubleCheckedLocking&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getInstance&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(){&lt;/span&gt;
        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;singleton&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
            &lt;span class=&#34;kd&#34;&gt;synchronized&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;DoubleCheckedLocking&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
                &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;singleton&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
                    &lt;span class=&#34;n&#34;&gt;singleton&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;DoubleCheckedLocking&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
                &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
            &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
        &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
        &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;singleton&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;cm&#34;&gt;/**4.
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt; * é™æ€å†…éƒ¨ç±»æ¨¡å¼ï¼Œåˆ©ç”¨çš„æ˜¯JVMå¯¹é™æ€å†…éƒ¨ç±»çš„åŠ è½½æœºåˆ¶
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt; * å› ä¸ºé™æ€å†…éƒ¨ç±»åªæœ‰è¢«è°ƒç”¨çš„æ—¶å€™æ‰ä¼šè¢«åˆå§‹åŒ–ï¼Œç›¸å½“äºå»¶æ—¶çš„æœºåˆ¶ï¼Œä¸”JVMèƒ½ä¿è¯åªåˆå§‹åŒ–ä¸€æ¬¡
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt; * ç›¸å½“ä¸ç»“åˆäº†æ‡’æ±‰æ¨¡å¼å’Œé¥¿æ±‰æ¨¡å¼çš„ä¼˜ç‚¹å§
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt; */&lt;/span&gt;
&lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;StaticInnerClassMode&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;

    &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;StaticInnerClassInstance&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;final&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;StaticInnerClassMode&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;SINGLETON&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;StaticInnerClassMode&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;

    &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;StaticInnerClassMode&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getInstance&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;StaticInnerClassInstance&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;SINGLETON&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;cm&#34;&gt;/**5.
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt; * æšä¸¾ç±»åˆ›å»ºå•ä¾‹,åˆ©ç”¨JVMçš„æœºåˆ¶,ä¿è¯åªå®ä¾‹åŒ–ä¸€æ¬¡,åŒæ—¶å¯é˜²æ­¢åå°„å’Œååºåˆ—åŒ–æ“ä½œç ´è§£
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt; */&lt;/span&gt;
&lt;span class=&#34;kd&#34;&gt;enum&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;EnumMode&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;SINGLETON&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
    &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;method&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(){}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;cm&#34;&gt;/**
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt; * é™¤äº†æšä¸¾ç±»å¯é˜²æ­¢åå°„å’Œååºåˆ—åŒ–æ“ä½œç ´è§£å¤–ï¼Œå…¶ä»–å››ç§æ–¹æ³•éƒ½ä¼šè¢«åå°„å’Œååºåˆ—åŒ–ç ´è§£
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt; * 1ï¼Œé˜»æ­¢åå°„ç ´è§£
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt; * åœ¨ç©ºæ„é€ æ–¹æ³•é‡Œï¼Œåˆ¤æ–­singletonæ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ä¸ºç©ºï¼Œåˆ™æŠ›å‡ºRuntimeExceptionï¼Œ
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt; * å› ä¸ºåå°„éœ€è¦é€šè¿‡class.getInstance()è°ƒç”¨ç©ºå‚æ„é€ æ–¹æ³•å®ä¾‹åŒ–å¯¹è±¡ï¼Œå¦‚æœæ­¤æ—¶æŠ›å‡ºå¼‚å¸¸ï¼Œåˆ™ä¼šç»ˆæ­¢ç¨‹åºï¼Œ
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt; * å¦‚æœåœ¨æ‡’æ±‰æ¨¡å¼é‡Œä½¿ç”¨å°±ä¼šå‘ç°ä¼šæŠ›å‡ºå¼‚å¸¸
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt; *
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt; * 2.é˜»æ­¢ååºåˆ—åŒ–ç ´è§£
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt; *  å®ç°Serializableæ¥å£ï¼Œå®šä¹‰readResolve()æ–¹æ³•è¿”å›å¯¹è±¡ï¼Œå…·ä½“åŸç†ä¸å¤ªæ¸…æ¥š
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt; *  åœ¨ååºåˆ—åŒ–çš„æ—¶å€™ç”¨readResolve()ä¸­è¿”å›çš„å¯¹è±¡ç›´æ¥æ›¿æ¢åœ¨ååºåˆ—åŒ–è¿‡ç¨‹ä¸­åˆ›å»ºçš„å¯¹è±¡
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt; *  private Object readResolve() throws ObjectStreamException {
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt; *     return instance;
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt; *  }
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt; */&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h3 id=&#34;ç®€å•å·¥å‚æ¨¡å¼&#34;&gt;ç®€å•å·¥å‚æ¨¡å¼&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;åˆ›å»ºå‹æ¨¡å¼&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¸»è¦è§£å†³æ¥å£é€‰æ‹©é—®é¢˜&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å®šä¹‰ä¸€ä¸ªåˆ›å»ºå¯¹è±¡çš„æ¥å£ï¼Œè®©å…¶å­ç±»è‡ªå·±å†³å®šå®ä¾‹åŒ–å“ªä¸€ä¸ªå·¥å‚ç±»ï¼Œå·¥å‚æ¨¡å¼ä½¿å…¶åˆ›å»ºè¿‡ç¨‹å»¶è¿Ÿåˆ°å­ç±»è¿›è¡Œï¼Œè¿˜æœ‰å¦ä¸€ç§å·¥å‚éœ€è¦ç”¨åˆ°å•ä¾‹ï¼Œé€šè¿‡åœ¨é™æ€ä»£ç å—é‡Œå…ˆåˆå§‹åŒ–å¥½å¯¹è±¡ï¼Œç„¶å+keyæ”¾åˆ°mapé‡Œ&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;util.Calendarã€util.ResourceBundleã€text.NumberFormatã€nio.charset.Charsetã€util.EnumSetã€DIå®¹å™¨&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åº”ç”¨åœºæ™¯ï¼šå½“æœ‰ä¸€æ®µéœ€è¦é€šè¿‡if-elseçš„ä»£ç æ¥åˆ¤æ–­åˆå§‹åŒ–å“ªäº›å¯¹è±¡çš„æ—¶å€™ï¼Œå°±å¯è€ƒè™‘&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¼˜ç‚¹ï¼šè°ƒç”¨è€…åªéœ€è¦çŸ¥é“åå­—å°±èƒ½åˆ›å»ºå¯¹è±¡ï¼Œä¸å…³å¿ƒå¯¹è±¡çš„å…·ä½“å®ç°ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç¼ºç‚¹ï¼šæ•°é‡å¤ªå¤šä¼šå¯¼è‡´ if-else è†¨èƒ€ï¼Œæ¯æ¬¡æœ‰æ–°çš„å¯¹è±¡è¦åŠ å…¥å·¥å‚éœ€è¦éœ€æ”¹å·¥å‚æ–¹æ³•ï¼Œä¸ç¬¦åˆå¼€é—­åŸåˆ™&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/%e5%b7%a5%e5%8e%82%e6%a8%a1%e5%bc%8f.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/%e5%b7%a5%e5%8e%82%e6%a8%a1%e5%bc%8f.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			alt=&#34;å·¥å‚æ¨¡å¼ä¾‹å­ç±»å›¾&#34;&gt;
	&lt;/a&gt;
	
	&lt;figcaption&gt;å·¥å‚æ¨¡å¼ä¾‹å­ç±»å›¾&lt;/figcaption&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;48
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// æ¥å£
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;Shape&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;draw&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;// å®ä½“,å·¥å‚ç”Ÿäº§çš„äº§å“
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;Circle&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;implements&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Shape&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;nd&#34;&gt;@Override&lt;/span&gt;
   &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;draw&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;System&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;out&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;println&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;circle draw&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
   &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;Rectangle&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;implements&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Shape&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;nd&#34;&gt;@Override&lt;/span&gt;
   &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;draw&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;System&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;out&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;println&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Rectangle draw&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
   &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;// å·¥å‚
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;ShapeFactory&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
    
   &lt;span class=&#34;c1&#34;&gt;//ä½¿ç”¨ getShape æ–¹æ³•è·å–å½¢çŠ¶ç±»å‹çš„å¯¹è±¡, ç”Ÿäº§äº§å“çš„æ–¹æ³•
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;   &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Shape&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getShape&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;shapeType&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;){&lt;/span&gt;
      &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;shapeType&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;){&lt;/span&gt;
         &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
      &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;        
      &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;shapeType&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;equalsIgnoreCase&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;CIRCLE&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)){&lt;/span&gt;
         &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Circle&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
      &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;shapeType&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;equalsIgnoreCase&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;RECTANGLE&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)){&lt;/span&gt;
         &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Rectangle&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
      &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
      &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
   &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;// ä¾‹å­
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;FactoryPatternDemo&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;c1&#34;&gt;// åˆ›å»ºå·¥å‚
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;ShapeFactory&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;shapeFactory&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ShapeFactory&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
      &lt;span class=&#34;c1&#34;&gt;//è·å– Circle çš„å¯¹è±¡ï¼Œå¹¶è°ƒç”¨å®ƒçš„ draw æ–¹æ³•ï¼Œ æ¥å£è£…è½½å­ç±»å¯¹è±¡
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;Shape&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;shape1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;shapeFactory&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getShape&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;CIRCLE&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;shape1&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;draw&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// circle draw
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;c1&#34;&gt;//è·å– Rectangle çš„å¯¹è±¡ï¼Œå¹¶è°ƒç”¨å®ƒçš„ draw æ–¹æ³•
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;Shape&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;shape2&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;shapeFactory&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getShape&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;RECTANGLE&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;shape2&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;draw&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;//Rectangle draw
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;   &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h3 id=&#34;å·¥å‚æ¨¡å¼&#34;&gt;å·¥å‚æ¨¡å¼&lt;/h3&gt;
&lt;p&gt;ä¼˜ç‚¹ï¼šè°ƒç”¨æ–¹ä¸éœ€è¦è´Ÿè´£å¯¹è±¡çš„åˆ›å»ºï¼Œæ˜ç¡®äº†å„ä¸ªç±»çš„èŒè´£ï¼›å¦‚æœæœ‰æ–°å¯¹è±¡å¢åŠ ï¼Œåªéœ€è¦å¢åŠ ä¸€ä¸ªå…·ä½“çš„ç±»å’Œå…·ä½“çš„å·¥å‚å³å¯ï¼›è§£å†³ç®€å•å·¥å‚æœ‰å¤§é‡ if-else é—®é¢˜ï¼›&lt;/p&gt;
&lt;p&gt;ç¼ºç‚¹ï¼šæ¯æ¬¡æœ‰æ–°å¯¹è±¡éƒ½è¦å†™ä¸€å¥— ç±» å’Œ å·¥å‚ç±»ï¼Œæ¯ä¸ªç±»éƒ½è¦æœ‰å¯¹åº”çš„å·¥å‚ç±»ï¼Œä»£ç é‡å¾ˆå¤§ï¼›&lt;/p&gt;
&lt;p&gt;æ„Ÿè§‰è·Ÿç®€å•å·¥å‚æ¨¡å¼çš„å·®åˆ«å°±æ˜¯å·¥å‚æ¨¡å¼æ˜¯å…ˆåˆ›å»ºå¯¹è±¡å·¥å‚ï¼Œå†åˆ›å»ºå¯¹è±¡ï¼Œç®€å•å·¥å‚æ¨¡å¼æ˜¯ç›´æ¥é€šè¿‡å·¥å‚åˆ›å»ºå¯¹è±¡ï¼Œå‰è€…éœ€è¦çŸ¥é“å¯¹è±¡å·¥å‚çš„åå­—ï¼Œåè€…éœ€è¦å¯¹è±¡åå­—ï¼›&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;48
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;49
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;50
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;51
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;52
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;53
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;54
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;AnimalFactory&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;c1&#34;&gt;// å¯ä»¥è·å–ä»»ä½•çš„å® ç‰©
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;n&#34;&gt;Animal&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;createAnimal&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;CatFactory&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;implements&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AnimalFactory&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// åˆ›å»ºçŒ«
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nd&#34;&gt;@Override&lt;/span&gt;
    &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Animal&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;createAnimal&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Cat&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;DogFactory&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;implements&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AnimalFactory&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;c1&#34;&gt;// åˆ›å»ºç‹—
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nd&#34;&gt;@Override&lt;/span&gt;
	&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Animal&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;createAnimal&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Dog&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
	&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;// ------------
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;abstract&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;Animal&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;c1&#34;&gt;// æ‰€æœ‰çš„åŠ¨ç‰©éƒ½ä¼šåƒä¸œè¥¿
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;abstract&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;eat&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;Cat&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;extends&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Animal&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;c1&#34;&gt;// çŒ«å–œæ¬¢åƒé±¼
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nd&#34;&gt;@Override&lt;/span&gt;
	&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;eat&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;n&#34;&gt;System&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;out&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;println&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;çŒ«åƒé±¼&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
	&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;Dog&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;extends&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Animal&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;c1&#34;&gt;// ç‹—å–œæ¬¢åƒè‚‰
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nd&#34;&gt;@Override&lt;/span&gt;
	&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;eat&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;n&#34;&gt;System&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;out&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;println&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;ç‹—åƒè‚‰&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
	&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;// ä¾‹å­
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;FactoryPatternDemo&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
       &lt;span class=&#34;c1&#34;&gt;// éœ€è¦äº‹å…ˆçŸ¥é“è¦ç”¨ä»€ä¹ˆå·¥å‚ï¼Œå·¥å‚åªç”Ÿäº§ä¸€ç§å¯¹è±¡
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;       &lt;span class=&#34;n&#34;&gt;AnimalFactory&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;f&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;DogFactory&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
       &lt;span class=&#34;n&#34;&gt;Animal&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;a&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;createAnimal&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
       &lt;span class=&#34;n&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;eat&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
       
       &lt;span class=&#34;n&#34;&gt;AnimalFactory&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ff&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;CatFactory&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
       &lt;span class=&#34;n&#34;&gt;Animal&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;aa&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ff&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;createAnimal&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
       &lt;span class=&#34;n&#34;&gt;aa&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;eat&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
   &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h3 id=&#34;æŠ½è±¡å·¥å‚æ¨¡å¼&#34;&gt;æŠ½è±¡å·¥å‚æ¨¡å¼&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;ä¸å·¥å‚æ¨¡å¼ç±»ä¼¼ï¼Œä¹Ÿåˆ›å»ºå‹æ¨¡å¼&lt;/li&gt;
&lt;li&gt;å·¥å‚æ–¹æ³•æ˜¯ä¸€ä¸ªå·¥å‚ï¼Œæ ¹æ®ä¼ å…¥å‚æ•°ç”Ÿäº§ä¸åŒå®ä¾‹ï¼Œè€ŒæŠ½è±¡å·¥å‚åˆ™åŠ å¤šä¸€å±‚å·¥å‚è·å–ã€‚æŠ½è±¡å·¥å‚å±äºå¤§å·¥å‚ï¼Œæ ¹æ®ä¼ å…¥å‚æ•°äº§ç”Ÿå·¥å‚å®ä¾‹ï¼Œåœ¨é€šè¿‡è¿™ä¸ªå·¥å‚ï¼Œä¼ å…¥å‚æ•°è·å–å¯¹è±¡å®ä¾‹&lt;/li&gt;
&lt;li&gt;è·Ÿå·¥å‚æ¨¡å¼çš„å·®åˆ«ï¼ŒæŠ½è±¡å·¥å‚æ¨¡å¼å…ˆé€šè¿‡æŠ½è±¡å·¥å‚ç”Ÿäº§å·¥å‚ï¼Œå†é€šè¿‡å·¥å‚ç”Ÿäº§å¯¹è±¡&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;48
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;49
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;50
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;51
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;52
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;53
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;54
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;55
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;56
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;57
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;58
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;59
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;60
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;61
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;62
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;63
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;64
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;65
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;66
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;67
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;68
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;69
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;70
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;71
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;72
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;73
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;74
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;75
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;76
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;77
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;78
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;79
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;80
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;81
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;82
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;83
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;84
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;85
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;86
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;87
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;88
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;89
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;90
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;91
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;Shape&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;draw&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;Rectangle&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;implements&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Shape&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;nd&#34;&gt;@Override&lt;/span&gt;
   &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;draw&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;System&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;out&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;println&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Inside Rectangle::draw() method.&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
   &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;Square&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;implements&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Shape&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;nd&#34;&gt;@Override&lt;/span&gt;
   &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;draw&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;System&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;out&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;println&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Inside Square::draw() method.&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
   &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;// ---------------
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;Color&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;fill&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;Red&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;implements&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Color&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;nd&#34;&gt;@Override&lt;/span&gt;
   &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;fill&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;System&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;out&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;println&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Inside Red::fill() method.&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
   &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;Green&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;implements&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Color&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;nd&#34;&gt;@Override&lt;/span&gt;
   &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;fill&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;System&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;out&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;println&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Inside Green::fill() method.&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
   &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;// -------------
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;abstract&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;AbstractFactory&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;abstract&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Color&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getColor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;color&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
   &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;abstract&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Shape&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getShape&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;shape&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;ShapeFactory&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;extends&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AbstractFactory&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;nd&#34;&gt;@Override&lt;/span&gt;
   &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Shape&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getShape&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;shapeType&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;){&lt;/span&gt;
      &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;shapeType&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;){&lt;/span&gt;
         &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
      &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;        
      &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;shapeType&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;equalsIgnoreCase&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;CIRCLE&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)){&lt;/span&gt;
         &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Circle&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
      &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;shapeType&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;equalsIgnoreCase&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;RECTANGLE&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)){&lt;/span&gt;
         &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Rectangle&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
      &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
      &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
   &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
   
   &lt;span class=&#34;nd&#34;&gt;@Override&lt;/span&gt;
   &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Color&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getColor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;color&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
   &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;ColorFactory&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;extends&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AbstractFactory&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;nd&#34;&gt;@Override&lt;/span&gt;
   &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Shape&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getShape&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;shapeType&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;){&lt;/span&gt;
      &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
   &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
   
   &lt;span class=&#34;nd&#34;&gt;@Override&lt;/span&gt;
   &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Color&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getColor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;color&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;color&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;){&lt;/span&gt;
         &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
      &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;        
      &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;color&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;equalsIgnoreCase&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;RED&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)){&lt;/span&gt;
         &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Red&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
      &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;color&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;equalsIgnoreCase&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;GREEN&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)){&lt;/span&gt;
         &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Green&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
      &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
      &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
   &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;FactoryProducer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AbstractFactory&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getFactory&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;choice&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;){&lt;/span&gt;
      &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;choice&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;equalsIgnoreCase&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;SHAPE&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)){&lt;/span&gt;
         &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ShapeFactory&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
      &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;choice&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;equalsIgnoreCase&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;COLOR&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)){&lt;/span&gt;
         &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ColorFactory&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
      &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
      &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
   &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h3 id=&#34;å»ºé€ è€…æ¨¡å¼&#34;&gt;å»ºé€ è€…æ¨¡å¼&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;å…¶å®å°±æ˜¯é“¾å¼è°ƒç”¨ï¼Œä¸»è¦ä¸ºäº†&lt;strong&gt;è§£å†³æ„é€ æ–¹æ³•å‚æ•°è¿‡å¤š&lt;/strong&gt;ï¼Œä¸”éœ€è¦æ ¡éªŒçš„æƒ…å†µä¸‹ï¼Œå¦‚æœå‚æ•°è¿‡å¤šä¸”éœ€è¦æ ¡éªŒï¼Œä½¿ç”¨æ„é€ æ–¹æ³•æˆ–è€…setæ–¹æ³•æ¥å®ä¾‹åŒ–å¯¹è±¡ä¸å¤ªæ–¹ä¾¿ï¼ŒåŒæ—¶ï¼Œä½¿ç”¨å»ºé€ è€…æ¨¡å¼è¿˜å¯ä»¥æŠŠå¯¹è±¡å¤„ç†æˆåˆå§‹åŒ–åå±æ€§ä¸å¯å˜å¾—å¯¹è±¡&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å·¥å‚æ¨¡å¼æ˜¯ç”¨æ¥åˆ›å»ºä¸åŒä½†æ˜¯ç›¸å…³ç±»å‹çš„å¯¹è±¡&lt;/strong&gt;ï¼ˆç»§æ‰¿åŒä¸€çˆ¶ç±»æˆ–è€…æ¥å£çš„ä¸€ç»„å­ç±»ï¼‰ï¼Œç”±ç»™å®šçš„å‚æ•°æ¥å†³å®šåˆ›å»ºå“ªç§ç±»å‹çš„å¯¹è±¡ã€‚å»ºé€ è€…æ¨¡å¼æ˜¯ç”¨æ¥åˆ›å»ºä¸€ç§ç±»å‹çš„å¤æ‚å¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®ä¸åŒçš„å¯é€‰å‚æ•°ï¼Œâ€œå®šåˆ¶åŒ–â€åœ°åˆ›å»ºä¸åŒçš„å¯¹è±¡&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;48
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;49
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;50
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;51
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;52
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;53
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;54
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;55
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;56
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;57
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;58
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;59
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;60
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;61
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;62
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;63
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;64
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;65
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;66
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;67
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;68
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;69
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;70
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;71
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;72
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;73
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;74
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;75
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;76
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;77
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;78
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;79
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;80
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;81
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;ResourcePoolConfig&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
  &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
  &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;maxTotal&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
  &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;maxIdle&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
  &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;minIdle&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
  &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;ResourcePoolConfig&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Builder&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;builder&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;name&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;builder&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;maxTotal&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;builder&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;maxTotal&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;maxIdle&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;builder&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;maxIdle&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;minIdle&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;builder&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;minIdle&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
  &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
  &lt;span class=&#34;c1&#34;&gt;//...çœç•¥getteræ–¹æ³•...
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;// å»ºè®®æ­¤å¤„æŠŠbuilderè®¾ç½®ä¸ºå†…éƒ¨ç±»
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;Builder&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// default value
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;final&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;DEFAULT_MAX_TOTAL&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;8&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
    &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;final&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;DEFAULT_MAX_IDLE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;8&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
    &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;final&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;DEFAULT_MIN_IDLE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
      
    &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
    &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;maxTotal&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;DEFAULT_MAX_TOTAL&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
    &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;maxIdle&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;DEFAULT_MAX_IDLE&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
    &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;minIdle&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;DEFAULT_MIN_IDLE&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
      
    &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ResourcePoolConfig&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;build&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;c1&#34;&gt;// æ ¡éªŒé€»è¾‘æ”¾åˆ°è¿™é‡Œæ¥åšï¼ŒåŒ…æ‹¬å¿…å¡«é¡¹æ ¡éªŒã€ä¾èµ–å…³ç³»æ ¡éªŒã€çº¦æŸæ¡ä»¶æ ¡éªŒç­‰
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;StringUtils&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;isBlank&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;))&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;k&#34;&gt;throw&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;IllegalArgumentException&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;...&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
      &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
      &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;maxIdle&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;maxTotal&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;k&#34;&gt;throw&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;IllegalArgumentException&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;...&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
      &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
      &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;minIdle&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;maxTotal&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;||&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;minIdle&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;maxIdle&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;k&#34;&gt;throw&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;IllegalArgumentException&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;...&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
      &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
      &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ResourcePoolConfig&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
    &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Builder&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;setName&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;StringUtils&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;isBlank&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;))&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;k&#34;&gt;throw&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;IllegalArgumentException&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;...&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
      &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
      &lt;span class=&#34;k&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;name&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
      &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
    &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Builder&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;setMaxTotal&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;maxTotal&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;maxTotal&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;k&#34;&gt;throw&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;IllegalArgumentException&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;...&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
      &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
      &lt;span class=&#34;k&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;maxTotal&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;maxTotal&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
      &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
    &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Builder&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;setMaxIdle&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;maxIdle&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;maxIdle&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;k&#34;&gt;throw&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;IllegalArgumentException&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;...&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
      &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
      &lt;span class=&#34;k&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;maxIdle&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;maxIdle&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
      &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
    &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Builder&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;setMinIdle&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;minIdle&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;minIdle&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;k&#34;&gt;throw&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;IllegalArgumentException&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;...&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
      &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
      &lt;span class=&#34;k&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;minIdle&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;minIdle&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
      &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
  &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;// è°ƒç”¨
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;FactoryPatternDemo&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
 
   &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
   		&lt;span class=&#34;c1&#34;&gt;// è¿™æ®µä»£ç ä¼šæŠ›å‡ºIllegalArgumentExceptionï¼Œå› ä¸ºminIdle&amp;gt;maxIdle
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ResourcePoolConfig&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;config&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ResourcePoolConfig&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;Builder&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt;
        &lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;setName&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;dbconnectionpool&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
        &lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;setMaxTotal&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;16&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
        &lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;setMaxIdle&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;10&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
        &lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;setMinIdle&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;12&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
        &lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;build&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
   &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h3 id=&#34;åŸå‹æ¨¡å¼&#34;&gt;åŸå‹æ¨¡å¼&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;å…¶å®å°±æ˜¯æ‹·è´ï¼ŒæŠŠå¯¹äºé‚£äº›åˆ›å»ºæˆæœ¬è¾ƒå¤§(æ¯”å¦‚åˆ›å»ºè¦è¿›è¡Œå¤æ‚è®¡ç®—ã€IOè¯»å–ç­‰)ä¸”åŒä¸€ç±»ä½†ä¸åŒå¯¹è±¡å¾—å¯¹è±¡ï¼Œåˆ©ç”¨åŸæœ‰å¯¹è±¡è¿›è¡Œæ‹·è´ï¼Œæ¥è¾¾åˆ°åˆ›å»ºæ–°å¯¹è±¡çš„ç›®çš„&lt;/li&gt;
&lt;li&gt;å¸¸è§æ–¹å¼æœ‰åºåˆ—åŒ–å†ååºåˆ—åŒ–ï¼Œæˆ–è€…é€’å½’éå†å¯¹è±¡é‡Œçš„å­—æ®µè¿›è¡Œåˆ›å»ºå’Œèµ‹å€¼ï¼Œæ·±æ‹·è´æˆ–è€…æµ…æ‹·è´ï¼Œè¿™é‡Œè¦æ³¨æ„æµ…æ‹·è´å’Œæ·±æ‹·è´é—®é¢˜&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;ç»“æ„å‹&#34;&gt;ç»“æ„å‹&lt;/h2&gt;
&lt;h3 id=&#34;ä»£ç†æ¨¡å¼&#34;&gt;ä»£ç†æ¨¡å¼&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ç»“æ„å‹æ¨¡å¼&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;é€šè¿‡ä»£ç†ç±»æ‰©å±•è¢«ä»£ç†ç±»çš„èƒ½åŠ›ï¼Œä»£ç†ç±»å’Œè¢«ä»£ç†ç±»å®ç°åŒä¸€æ¥å£ï¼Œé‡å†™å…¶ä¸­çš„æ–¹æ³•ï¼Œåœ¨ä»£ç†ç±»ä¸­ä¼ å…¥è¢«ä»£ç†ç±»çš„å®ä¾‹ï¼Œåœ¨ä¸¤è€…ç›¸åŒçš„æ–¹æ³•ä¸­ï¼Œè°ƒç”¨è¢«ä»£ç†ç±»çš„è¯¥æ–¹æ³•ï¼ŒåŒæ—¶å¯ä»¥å¤„ç†å…¶ä»–é€»è¾‘ï¼Œè¾¾åˆ°æ‰©å±•çš„èƒ½åŠ›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;1ã€å’Œé€‚é…å™¨æ¨¡å¼çš„åŒºåˆ«ï¼šé€‚é…å™¨æ¨¡å¼ä¸»è¦æ˜¯ä¸¤ä¸ªä»£è¡¨ä¸åŒç»´åº¦çš„æ¥å£ï¼Œå®ƒä»¬çš„å®ç°é€šè¿‡ç»„åˆçš„æ–¹å¼æ‰©å±•åŸæ¥çš„åŠŸèƒ½ï¼Œè€Œä»£ç†æ¨¡å¼æ˜¯ä»£ç†ç±»å’Œè¢«ä»£ç†ç±»å®ç°ç›¸åŒçš„æ¥å£ï¼Œé€šè¿‡ä»£ç†ç±»è°ƒç”¨è¢«ä»£ç†ç±»ç›¸åŒçš„æ–¹æ³•æ¥è¾¾åˆ°å¯¹ä»£ç†ç±»è¡¥å……çš„ä½œç”¨ã€‚&lt;/p&gt;
&lt;p&gt;2ã€å’Œè£…é¥°å™¨æ¨¡å¼çš„åŒºåˆ«ï¼šè£…é¥°å™¨æ¨¡å¼ä¸ºäº†å¢å¼ºåŠŸèƒ½ï¼Œè€Œä»£ç†æ¨¡å¼æ˜¯ä¸ºäº†åŠ ä»¥æ§åˆ¶ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¸‹é¢çš„ä¾‹å­å±äºé™æ€ä»£ç†ï¼Œå…¶ä»–ä»£ç†è¯·çœ‹&lt;a class=&#34;link&#34; href=&#34;https://github.com/Nixum/Java-Note/raw/master/Spring.md&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;åŠ¨æ€ä»£ç†å’ŒCGLIBä»£ç†&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/%e4%bb%a3%e7%90%86%e6%a8%a1%e5%bc%8f.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/%e4%bb%a3%e7%90%86%e6%a8%a1%e5%bc%8f.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			alt=&#34;ä»£ç†æ¨¡å¼ä¾‹å­&#34;&gt;
	&lt;/a&gt;
	
	&lt;figcaption&gt;ä»£ç†æ¨¡å¼ä¾‹å­&lt;/figcaption&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;48
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;49
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;50
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;51
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;52
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// ä»£ç†ç±»å’Œè¢«ä»£ç†ç±»çš„æ¥å£
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;Image&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;display&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;// è¢«ä»£ç†ç±»
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;RealImage&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;implements&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Image&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;fileName&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
   &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;RealImage&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;fileName&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;){&lt;/span&gt;
      &lt;span class=&#34;k&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;fileName&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;fileName&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;loadFromDisk&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;fileName&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
   &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
   &lt;span class=&#34;nd&#34;&gt;@Override&lt;/span&gt;
   &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;display&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;System&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;out&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;println&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Displaying &amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;fileName&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
   &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
   &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;loadFromDisk&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;fileName&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;){&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;System&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;out&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;println&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Loading &amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;fileName&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
   &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;// ä»£ç†ç±»
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;ProxyImage&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;implements&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Image&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;RealImage&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;realImage&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
   &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;fileName&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
    
   &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;ProxyImage&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;fileName&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;){&lt;/span&gt;
      &lt;span class=&#34;k&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;fileName&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;fileName&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
   &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt; 
   &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;ProxyImage&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;RealImage&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;realImage&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;){&lt;/span&gt;
      &lt;span class=&#34;k&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;realImage&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;realImage&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
   &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
   &lt;span class=&#34;nd&#34;&gt;@Override&lt;/span&gt;
   &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;display&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;realImage&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;){&lt;/span&gt;
         &lt;span class=&#34;c1&#34;&gt;// å¯ä»¥é€‰æ‹©åœ¨è¿™é‡Œå»¶è¿ŸåŠ è½½ æˆ–è€… åœ¨æ„é€ æ–¹æ³•çš„æ—¶å€™åŠ è½½ è¢«ä»£ç†ç±»
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;         &lt;span class=&#34;n&#34;&gt;realImage&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;RealImage&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;fileName&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
      &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
      &lt;span class=&#34;c1&#34;&gt;// åœ¨è°ƒç”¨è¢«ä»£ç†ç±»åŒåæ–¹æ³•å‰ååšå…¶ä»–æ“ä½œ
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;realImage&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;display&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
   &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;// ä½¿ç”¨æ—¶
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;ProxyPatternDemo&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
    
   &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;Image&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;image&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ProxyImage&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;test_10mb.jpg&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt; 
      &lt;span class=&#34;c1&#34;&gt;// å›¾åƒå°†ä»ç£ç›˜åŠ è½½
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;image&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;display&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt; 		&lt;span class=&#34;c1&#34;&gt;// Loading test_10mb.jpg /n Displaying test_10mb.jpg
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;System&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;out&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;println&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
      &lt;span class=&#34;c1&#34;&gt;// å›¾åƒä¸éœ€è¦ä»ç£ç›˜åŠ è½½
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;image&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;display&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;  	&lt;span class=&#34;c1&#34;&gt;// Displaying test_10mb.jpg
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;   &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h3 id=&#34;è£…é¥°å™¨æ¨¡å¼&#34;&gt;è£…é¥°å™¨æ¨¡å¼&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ç»“æ„å‹æ¨¡å¼&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è£…é¥°ç±»å‘è¢«è£…é¥°ç±»æ·»åŠ æ–°åŠŸèƒ½ï¼ŒåŒæ—¶åˆä¸æ”¹å˜å…¶ç»“æ„ï¼Œä½œä¸ºç°è¢«è£…é¥°ç±»çš„åŒ…è£…ï¼Œç»§æ‰¿çš„ä¸€ç§ä»£æ›¿ï¼Œä¸»è¦è§£å†³å¤šå±‚æ¬¡ç»§æ‰¿çš„é—®é¢˜&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è£…é¥°ç±»å’Œè¢«è£…é¥°ç±»å¯ä»¥ç‹¬ç«‹å‘å±•ï¼Œä¸ä¼šç›¸äº’è€¦åˆ&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è·Ÿä»£ç†æ¨¡å¼å¾ˆåƒï¼Œæœ¬è´¨ä¸Šä»£ç å·®åˆ«ä¸å¤§ï¼Œåªæ˜¯æ„å›¾ä¸å¤ªä¸€æ ·ã€‚&lt;/p&gt;
&lt;p&gt;åŒºåˆ«ï¼š&lt;strong&gt;è£…é¥°å™¨å¯ä»¥ä¸€å±‚ä¸€å±‚è£…é¥°ï¼Œæ¯æ¬¡è£…é¥°å¯ä»¥å¢å¼ºæˆ–æ‰©å±•è¢«è£…é¥°è€…çš„åŠŸèƒ½&lt;/strong&gt;ï¼ŒåŠŸèƒ½æ˜¯ç›¸å…³çš„ï¼Œæ˜¯å¯¹åŠŸèƒ½çš„å¢å¼ºã€‚å¤–éƒ¨æ˜¯çŸ¥é“å…·ä½“çš„è¢«è£…é¥°è€…çš„ï¼ˆå¯¹è£…é¥°å™¨ä¼ å…¥è¢«è£…é¥°å¯¹è±¡ï¼‰ï¼Œç„¶åä¸æ–­é€šè¿‡è£…é¥°è¾¾åˆ°å¯¹åŸæœ‰åŠŸèƒ½çš„å¢å¼ºã€‚&lt;/p&gt;
&lt;p&gt;è€Œ&lt;strong&gt;ä»£ç†æ¨¡å¼æ˜¯ä¸€å±‚&lt;/strong&gt;ï¼Œä»£ç†ç±»æ§åˆ¶è¢«ä»£ç†ç±»ï¼Œæ§åˆ¶è¢«ä»£ç†å¯¹è±¡çš„è®¿é—®ï¼Œå¤–éƒ¨å¹¶ä¸å…³å¿ƒè¢«ä»£ç†çš„å¯¹è±¡æ˜¯è°ï¼ˆè¢«ä»£ç†ç±»æ˜¯åœ¨ä»£ç†ç±»å†…éƒ¨è¿›è¡Œæ„é€ ï¼Œä¸ä»å¤–éƒ¨ä¼ å…¥ï¼‰ï¼ŒåªçŸ¥é“é€šè¿‡ä»£ç†å¯¹è±¡å¯ä»¥å®ç°å¯¹è¢«ä»£ç†å¯¹è±¡çš„åŠŸèƒ½è¡¥å……ï¼Œæ˜¯&lt;strong&gt;å¯¹ä»£ç†å¯¹è±¡çš„åŠŸèƒ½è¡¥å……ï¼Œç›´æ¥åŠ å¼º&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æœ€å…¸å‹çš„ä¾‹å­å°±æ˜¯IOç±»äº†ï¼Œæ¯ä¸ªioç±»éƒ½ç»§æ‰¿äº†in/outputStream(å¸¦äº†é»˜è®¤å®ç°)ï¼ŒåŒæ—¶åˆæŒæœ‰in/outputStreamï¼Œè°ƒç”¨çš„æœ¬è´¨è¿˜æ˜¯åœ¨è°ƒæŒæœ‰çš„in/outputStreamæ–¹æ³•çš„åŸºç¡€ä¸Šè¿›è¡Œå¢å¼º&lt;/p&gt;
&lt;p&gt;é¢˜å¤–è¯ï¼Œä¸ºå•¥BufferedInputStreamä¸ç›´æ¥ç»§æ‰¿InputStreamï¼Œè€Œæ˜¯ç»§æ‰¿FileInputStreamï¼Ÿ&lt;/p&gt;
&lt;p&gt;åŸå› æ˜¯å¦‚æœBufferInputStreamç»§æ‰¿å¹¶åŒæ—¶æŒæœ‰inputStreamï¼Œç”±äºBufferedInputStreamåªå¯¹éƒ¨åˆ†æ–¹æ³•å¢åŠ bufferåŠŸèƒ½ï¼Œå¯¹é‚£äº›ä¸éœ€è¦å¢å¼ºçš„æ–¹æ³•çš„è°ƒç”¨å°±éœ€è¦æ˜¾å¼è°ƒç”¨æŒæœ‰çš„inputStreamï¼Œè€Œå¦‚æœå…ˆé€šè¿‡FileInputStreamç»§æ‰¿å¹¶ç»„åˆInputStreamï¼Œå¹¶è°ƒç”¨æŒæœ‰çš„inputStreamçš„é»˜è®¤å®ç°ï¼Œå°±ä¸ç”¨å†™è¿™éƒ¨åˆ†å¤šä½™çš„ä»£ç äº†&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/%e8%a3%85%e9%a5%b0%e6%a8%a1%e5%bc%8f.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/%e8%a3%85%e9%a5%b0%e6%a8%a1%e5%bc%8f.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			alt=&#34;è£…é¥°æ¨¡å¼ä¾‹å­&#34;&gt;
	&lt;/a&gt;
	
	&lt;figcaption&gt;è£…é¥°æ¨¡å¼ä¾‹å­&lt;/figcaption&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;æ¥å£Shapeè¡¨ç¤ºå½¢çŠ¶ï¼Œå®ƒçš„å®ç°ç±»æ˜¯åœ†Circleç±»ï¼Œç»Ÿä¸€çš„æŠ½è±¡è£…é¥°ç±»ShapeDecoratorï¼Œå¸¦æœ‰Shapeç±»çš„å¼•ç”¨ï¼Œå…¶ å®ç°çš„è£…é¥°ç±»RedShapeDecoratoré€šè¿‡ä¼ å…¥å…·ä½“çš„å½¢çŠ¶å®ä¾‹ï¼Œæ¥å¯¹å…±åŒçš„æ–¹æ³•åšå¢å¼º&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;48
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;49
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;50
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;51
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;52
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;53
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;54
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;55
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;56
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;57
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;58
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;59
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;60
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;61
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;62
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;63
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;64
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;65
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// æ¥å£ï¼Œä½œä¸ºè¢«è£…é¥°ç±»çš„æ¥å£
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;Shape&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;draw&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;// å®ç°ç±»ï¼Œä½œä¸ºè¢«è£…é¥°ç±»
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;Circle&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;implements&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Shape&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt; 
   &lt;span class=&#34;nd&#34;&gt;@Override&lt;/span&gt;
   &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;draw&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;System&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;out&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;println&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Shape: Circle&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
   &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;// æ¥å£çš„æŠ½è±¡è£…é¥°ç±»ï¼Œå¯¹éå¢å¼ºæ–¹æ³•å¸¦æœ‰é»˜è®¤å®ç°
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;abstract&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;ShapeDecorator&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;implements&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Shape&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;kd&#34;&gt;protected&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Shape&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;decoratedShape&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
   &lt;span class=&#34;c1&#34;&gt;// æ¯ä¸€ä¸ªè£…é¥°å™¨éƒ½éœ€è¦ä¸€ä¸ªè¢«è£…é¥°å¼•ç”¨ï¼Œå› æ­¤éœ€è¦ä¸€ä¸ªæŠ½è±¡çˆ¶ç±»
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;   &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;ShapeDecorator&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Shape&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;decoratedShape&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;){&lt;/span&gt;
      &lt;span class=&#34;k&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;decoratedShape&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;decoratedShape&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
   &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt; 
   &lt;span class=&#34;c1&#34;&gt;// è£…é¥°å™¨ç±»å•ç‹¬ä½¿ç”¨çš„é»˜è®¤æ–¹æ³•
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;   &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;draw&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(){&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;decoratedShape&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;draw&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
   &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;  
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;// è£…é¥°ç±»ï¼Œè£…é¥°æˆçº¢è‰²
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;RedShapeDecorator&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;extends&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ShapeDecorator&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;RedShapeDecorator&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Shape&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;decoratedShape&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;kd&#34;&gt;super&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;decoratedShape&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;     
   &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt; 
   &lt;span class=&#34;nd&#34;&gt;@Override&lt;/span&gt;
   &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;draw&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;decoratedShape&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;draw&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;         
      &lt;span class=&#34;n&#34;&gt;setRedBorder&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;decoratedShape&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
   &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
   &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;setRedBorder&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Shape&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;decoratedShape&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;){&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;System&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;out&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;println&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Border Color: Red&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
   &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;// è£…é¥°ç±»ï¼ŒåŠ æ·±é¢œè‰²
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;DarkRedShapeDecorator&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;extends&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ShapeDecorator&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;DarkRedShapeDecorator&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Shape&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;decoratedShape&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;kd&#34;&gt;super&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;decoratedShape&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;     
   &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt; 
   &lt;span class=&#34;nd&#34;&gt;@Override&lt;/span&gt;
   &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;draw&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;decoratedShape&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;draw&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;         
      &lt;span class=&#34;n&#34;&gt;setDarkRedBorder&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;decoratedShape&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
   &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
   &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;setDarkRedBorder&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Shape&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;decoratedShape&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;){&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;System&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;out&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;println&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Border Color: DarkRed&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
   &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;// è°ƒç”¨
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;DecoratorPatternDemo&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
 
      &lt;span class=&#34;n&#34;&gt;Shape&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;circle&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Circle&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt; 
      &lt;span class=&#34;n&#34;&gt;Shape&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;redCircle&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;RedShapeDecorator&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;circle&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;Shape&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;darkRedCircle&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;DarkRedShapeDecorator&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;redCircle&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
       
      &lt;span class=&#34;n&#34;&gt;circle&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;draw&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;		&lt;span class=&#34;c1&#34;&gt;// Shape: Circle
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;redCircle&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;draw&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;		&lt;span class=&#34;c1&#34;&gt;// Border Color: Red
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;darkRedCircle&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;draw&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// Border Color: DarkRed
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
   &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h3 id=&#34;é€‚é…å™¨æ¨¡å¼&#34;&gt;é€‚é…å™¨æ¨¡å¼&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;ç»“æ„å‹æ¨¡å¼&lt;/li&gt;
&lt;li&gt;æ¥å£é€‚é…å™¨ä½¿å¾—å®ç°äº†ä¸åŒæ¥å£çš„ç±»å¯ä»¥é€šè¿‡é€‚é…å™¨çš„é€‰æ‹©è€Œå·¥ä½œï¼Œä¸»è¦æ˜¯è§„é¿æ¥å£ä¸å…¼å®¹çš„é—®é¢˜ï¼Œæœ¬è´¨æ˜¯ä½¿ç”¨ä¸€ç»„ç±»å’Œæ¥å£å……å½“é€‚é…å™¨ï¼ŒåŒ…åœ¨è¢«é€‚é…çš„ç±»å’Œæ¥å£ä¸Šï¼Œå…·ä½“åˆæ˜¯å®ç°æˆ–ç»„åˆ&lt;/li&gt;
&lt;li&gt;å…¸å‹ä¾‹å­ï¼šArrays#asList()ï¼ŒCollections#list()ï¼ŒCollections#enumeration()&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/%e9%80%82%e9%85%8d%e5%99%a8%e6%a8%a1%e5%bc%8f.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/%e9%80%82%e9%85%8d%e5%99%a8%e6%a8%a1%e5%bc%8f.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			alt=&#34;é€‚é…å™¨æ¨¡å¼&#34;&gt;
	&lt;/a&gt;
	
	&lt;figcaption&gt;é€‚é…å™¨æ¨¡å¼&lt;/figcaption&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;æœ‰ä¸¤ä¸ªæ¥å£AdvancedMediaPlayerå’ŒMediaPlayerï¼Œå®ƒä»¬éƒ½æœ‰ä¸åŒçš„ä½œç”¨ï¼Œä½†å®ƒä»¬çš„ä½œç”¨åˆå¾ˆç›¸ä¼¼ï¼ŒAdvancedMediaPlayerå¯ä»¥æ’­æ”¾vlcæ ¼å¼æˆ–è€…mp4æ ¼å¼ï¼Œè€ŒMediaPlayeråªèƒ½å•çº¯çš„æ’­æ”¾ï¼Œå¤šæ¥å£é€‚é…&lt;/p&gt;
&lt;p&gt;å¦‚æœæƒ³è¦è®©MediaPlayerèƒ½æ’­æ”¾ä¸åŒæ ¼å¼çš„éŸ³ä¹ï¼Œå°±éœ€è¦é€‚é…äº†ï¼Œé€‚é…å™¨å®ç°MediaPlayeræ¥å£ï¼Œæ ¹æ®ä¼ å…¥çš„å‚æ•°æ¥åˆ¤æ–­éœ€è¦å®ä¾‹åŒ–å“ªç§æ’­æ”¾å™¨ï¼Œå¹¶åœ¨æ’­æ”¾æ–¹æ³•é‡Œæ‰§è¡Œç›¸åº”æ’­æ”¾å™¨çš„æ’­æ”¾æ–¹æ³•&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;48
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;49
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;50
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;51
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;52
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;53
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;54
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;55
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;56
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;57
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;58
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;59
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;60
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;61
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;62
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;63
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;64
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;65
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;66
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;67
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;68
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;69
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;70
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;71
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;72
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;73
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;74
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;75
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;76
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;77
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;78
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;79
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;80
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;81
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;82
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;83
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;84
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;85
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;86
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;87
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;88
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;89
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;90
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;91
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;92
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;93
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;94
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;95
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// AdvancedMediaPlayeræ¥å£
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;AdvancedMediaPlayer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt; 
   &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;playVlc&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;fileName&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
   &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;playMp4&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;fileName&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;// AdvancedMediaPlayerå®ç°ç±» VlcPlayer
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;VlcPlayer&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;implements&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AdvancedMediaPlayer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;nd&#34;&gt;@Override&lt;/span&gt;
   &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;playVlc&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;fileName&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;System&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;out&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;println&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Playing vlc file. Name: &amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;fileName&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;      
   &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt; 
   &lt;span class=&#34;nd&#34;&gt;@Override&lt;/span&gt;
   &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;playMp4&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;fileName&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;c1&#34;&gt;//ä»€ä¹ˆä¹Ÿä¸åš
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;   &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;// AdvancedMediaPlayerå®ç°ç±» Mp4Player
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;Mp4Player&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;implements&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AdvancedMediaPlayer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;nd&#34;&gt;@Override&lt;/span&gt;
   &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;playVlc&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;fileName&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;c1&#34;&gt;//ä»€ä¹ˆä¹Ÿä¸åš
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;   &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
   &lt;span class=&#34;nd&#34;&gt;@Override&lt;/span&gt;
   &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;playMp4&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;fileName&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;System&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;out&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;println&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Playing mp4 file. Name: &amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;fileName&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;      
   &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;// MediaPlayeræ¥å£
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;MediaPlayer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;play&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;audioType&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;fileName&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;// MediaPlayeré€‚é…å™¨ï¼Œå®ç°äº†ä» AdvancedMediaPlayeræ¥å£ åˆ° MediaPlayeræ¥å£ çš„è½¬æ¢
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;MediaAdapter&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;implements&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;MediaPlayer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
 
   &lt;span class=&#34;n&#34;&gt;AdvancedMediaPlayer&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;advancedMusicPlayer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
 
   &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;MediaAdapter&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;audioType&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;){&lt;/span&gt;
      &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;audioType&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;equalsIgnoreCase&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;vlc&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;){&lt;/span&gt;
         &lt;span class=&#34;n&#34;&gt;advancedMusicPlayer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;VlcPlayer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;       
      &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;audioType&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;equalsIgnoreCase&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;mp4&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)){&lt;/span&gt;
         &lt;span class=&#34;n&#34;&gt;advancedMusicPlayer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Mp4Player&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
      &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;  
   &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
 
   &lt;span class=&#34;nd&#34;&gt;@Override&lt;/span&gt;
   &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;play&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;audioType&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;fileName&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;audioType&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;equalsIgnoreCase&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;vlc&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)){&lt;/span&gt;
         &lt;span class=&#34;n&#34;&gt;advancedMusicPlayer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;playVlc&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;fileName&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
      &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;audioType&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;equalsIgnoreCase&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;mp4&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)){&lt;/span&gt;
         &lt;span class=&#34;n&#34;&gt;advancedMusicPlayer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;playMp4&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;fileName&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
      &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
   &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;// é€‚é…å™¨ä½¿ç”¨ç±»ï¼Œä»è€Œä¸ç”¨å…³å¿ƒ è¢«é€‚é…æ¥å£ çš„å…·ä½“å®ç°ç±»
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;AudioPlayer&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;implements&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;MediaPlayer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;n&#34;&gt;MediaAdapter&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;mediaAdapter&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt; 
 
   &lt;span class=&#34;nd&#34;&gt;@Override&lt;/span&gt;
   &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;play&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;audioType&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;fileName&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;    
      &lt;span class=&#34;c1&#34;&gt;//æ’­æ”¾ mp3 éŸ³ä¹æ–‡ä»¶çš„å†…ç½®æ”¯æŒ
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;audioType&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;equalsIgnoreCase&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;mp3&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)){&lt;/span&gt;
         &lt;span class=&#34;n&#34;&gt;System&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;out&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;println&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Playing mp3 file. Name: &amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;fileName&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;         
      &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt; 
      &lt;span class=&#34;c1&#34;&gt;//mediaAdapter æä¾›äº†æ’­æ”¾å…¶ä»–æ–‡ä»¶æ ¼å¼çš„æ”¯æŒ
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;audioType&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;equalsIgnoreCase&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;vlc&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;||&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;audioType&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;equalsIgnoreCase&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;mp4&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)){&lt;/span&gt;
         &lt;span class=&#34;n&#34;&gt;mediaAdapter&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;MediaAdapter&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;audioType&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
         &lt;span class=&#34;n&#34;&gt;mediaAdapter&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;play&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;audioType&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;fileName&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
      &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
      &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
         &lt;span class=&#34;n&#34;&gt;System&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;out&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;println&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Invalid media. &amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
            &lt;span class=&#34;n&#34;&gt;audioType&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34; format not supported&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
      &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
   &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;   
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;// è°ƒç”¨
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;AdapterPatternDemo&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;AudioPlayer&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;audioPlayer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AudioPlayer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
 
      &lt;span class=&#34;n&#34;&gt;audioPlayer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;play&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;mp3&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;beyond the horizon.mp3&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;	
      &lt;span class=&#34;c1&#34;&gt;// Playing mp3 file. Name: beyond the horizon.mp3
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;       
      &lt;span class=&#34;n&#34;&gt;audioPlayer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;play&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;mp4&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;alone.mp4&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
      &lt;span class=&#34;c1&#34;&gt;// Playing mp4 file. Name: alone.mp4
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;       
      &lt;span class=&#34;n&#34;&gt;audioPlayer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;play&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;vlc&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;far far away.vlc&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
      &lt;span class=&#34;c1&#34;&gt;// Playing vlc file. Name: far far away.vlc
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;       
      &lt;span class=&#34;n&#34;&gt;audioPlayer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;play&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;avi&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;mind me.avi&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
       &lt;span class=&#34;c1&#34;&gt;// Invalid media. avi format not supported
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;   &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;å…¶ä»–ä¾‹å­ï¼Œä»¥ä¸‹ä¾‹å­æ¥è‡ªæå®¢æ—¶é—´-è®¾è®¡æ¨¡å¼ä¹‹ç¾ï¼Œéƒ½æ˜¯å•æ¥å£é€‚é…&lt;/p&gt;
&lt;p&gt;1ã€å°è£…å¤–éƒ¨sdkæ¥å£&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;CD&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;//è¿™ä¸ªç±»æ¥è‡ªå¤–éƒ¨sdkï¼Œæˆ‘ä»¬æ— æƒä¿®æ”¹å®ƒçš„ä»£ç 
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;staticFunction1&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;//... }
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;uglyNamingFunction2&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;//... }
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;tooManyParamsFunction3&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;paramA&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;paramB&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;...)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;//... }
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;lowPerformanceFunction4&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;//... }
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ä½¿ç”¨é€‚é…å™¨æ¨¡å¼è¿›è¡Œé‡æ„&lt;/span&gt;
&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;ITarget&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
  &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;function1&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
  &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;function2&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
  &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;fucntion3&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ParamsWrapperDefinition&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;paramsWrapper&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
  &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;function4&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
  &lt;span class=&#34;c1&#34;&gt;//...
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;// æ³¨æ„ï¼šé€‚é…å™¨ç±»çš„å‘½åä¸ä¸€å®šéå¾—æœ«å°¾å¸¦Adaptor
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;CDAdaptor&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;extends&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;CD&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;implements&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ITarget&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
  &lt;span class=&#34;c1&#34;&gt;//...
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;function1&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
     &lt;span class=&#34;kd&#34;&gt;super&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;staticFunction1&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
  &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
  
  &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;function2&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;kd&#34;&gt;super&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;uglyNamingFucntion2&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
  &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
  
  &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;function3&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ParamsWrapperDefinition&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;paramsWrapper&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
     &lt;span class=&#34;kd&#34;&gt;super&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;tooManyParamsFunction3&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;paramsWrapper&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getParamA&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(),&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;...);&lt;/span&gt;
  &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
  
  &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;function4&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;//...reimplement it...
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;2ã€ç»Ÿä¸€å¤šä¸ªç±»çš„æ¥å£&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;48
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;49
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;50
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;51
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;52
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;53
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;54
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;55
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;56
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;57
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;58
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;59
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;ASensitiveWordsFilter&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// Aæ•æ„Ÿè¯è¿‡æ»¤ç³»ç»Ÿæä¾›çš„æ¥å£
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;//textæ˜¯åŸå§‹æ–‡æœ¬ï¼Œå‡½æ•°è¾“å‡ºç”¨***æ›¿æ¢æ•æ„Ÿè¯ä¹‹åçš„æ–‡æœ¬
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;filterSexyWords&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;text&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// ...
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;BSensitiveWordsFilter&lt;/span&gt;  &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// Bæ•æ„Ÿè¯è¿‡æ»¤ç³»ç»Ÿæä¾›çš„æ¥å£
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;filter&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;text&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;//...
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;CSensitiveWordsFilter&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// Cæ•æ„Ÿè¯è¿‡æ»¤ç³»ç»Ÿæä¾›çš„æ¥å£
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;filter&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;text&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;mask&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;//...
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;// æœªä½¿ç”¨é€‚é…å™¨æ¨¡å¼ä¹‹å‰çš„ä»£ç ï¼šä»£ç çš„å¯æµ‹è¯•æ€§ã€æ‰©å±•æ€§ä¸å¥½
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;RiskManagement&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
  &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ASensitiveWordsFilter&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;aFilter&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ASensitiveWordsFilter&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
  &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;BSensitiveWordsFilter&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;bFilter&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;BSensitiveWordsFilter&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
  &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;CSensitiveWordsFilter&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cFilter&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;CSensitiveWordsFilter&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
  
  &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;filterSensitiveWords&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;text&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;maskedText&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;aFilter&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;filterSexyWords&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;text&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;maskedText&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;bFilter&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;filter&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;maskedText&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;maskedText&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cFilter&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;filter&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;maskedText&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;***&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;maskedText&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
  &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;// ä½¿ç”¨é€‚é…å™¨æ¨¡å¼è¿›è¡Œæ”¹é€ 
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;ISensitiveWordsFilter&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// ç»Ÿä¸€æ¥å£å®šä¹‰
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;filter&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;text&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;ASensitiveWordsFilterAdaptor&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;implements&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ISensitiveWordsFilter&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
  &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ASensitiveWordsFilter&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;aFilter&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
  &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;filter&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;text&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;maskedText&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;aFilter&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;filterSexyWords&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;text&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;maskedText&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;aFilter&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;filterPoliticalWords&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;maskedText&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;maskedText&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
  &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;//...çœç•¥BSensitiveWordsFilterAdaptorã€CSensitiveWordsFilterAdaptor...
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// æ‰©å±•æ€§æ›´å¥½ï¼Œæ›´åŠ ç¬¦åˆå¼€é—­åŸåˆ™ï¼Œå¦‚æœæ·»åŠ ä¸€ä¸ªæ–°çš„æ•æ„Ÿè¯è¿‡æ»¤ç³»ç»Ÿï¼Œ
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// è¿™ä¸ªç±»å®Œå…¨ä¸éœ€è¦æ”¹åŠ¨ï¼›è€Œä¸”åŸºäºæ¥å£è€Œéå®ç°ç¼–ç¨‹ï¼Œä»£ç çš„å¯æµ‹è¯•æ€§æ›´å¥½ã€‚
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;RiskManagement&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt; 
  &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;List&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ISensitiveWordsFilter&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;filters&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ArrayList&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&amp;gt;();&lt;/span&gt;
 
  &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;addSensitiveWordsFilter&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ISensitiveWordsFilter&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;filter&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;filters&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;add&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;filter&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
  &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
  
  &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;filterSensitiveWords&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;text&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;maskedText&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;text&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ISensitiveWordsFilter&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;filter&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;filters&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;maskedText&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;filter&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;filter&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;maskedText&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;maskedText&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
  &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;3ã€æ›¿æ¢ä¾èµ–çš„å¤–éƒ¨ç³»ç»Ÿ&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;å¤–éƒ¨ç³»ç»ŸA&lt;/span&gt;
&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;IA&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
  &lt;span class=&#34;c1&#34;&gt;//...
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;fa&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;A&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;implements&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;IA&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
  &lt;span class=&#34;c1&#34;&gt;//...
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;fa&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;//... }
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;// åœ¨æˆ‘ä»¬çš„é¡¹ç›®ä¸­ï¼Œå¤–éƒ¨ç³»ç»ŸAçš„ä½¿ç”¨ç¤ºä¾‹
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;Demo&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
  &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;IA&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
  &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Demo&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;IA&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;a&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
  &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
  &lt;span class=&#34;c1&#34;&gt;//...
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;Demo&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;d&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Demo&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;A&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;());&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;// å°†å¤–éƒ¨ç³»ç»ŸAæ›¿æ¢æˆå¤–éƒ¨ç³»ç»ŸB
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;BAdaptor&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;implemnts&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;IA&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
  &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;B&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
  &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;BAdaptor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;B&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
  &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
  &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;fa&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;//...
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;fb&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
  &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;// å€ŸåŠ©BAdaptorï¼ŒDemoçš„ä»£ç ä¸­ï¼Œè°ƒç”¨IAæ¥å£çš„åœ°æ–¹éƒ½æ— éœ€æ”¹åŠ¨ï¼Œ
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// åªéœ€è¦å°†BAdaptorå¦‚ä¸‹æ³¨å…¥åˆ°Demoå³å¯ã€‚
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Demo&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;d&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Demo&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;BAdaptor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;B&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()));&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h3 id=&#34;æ¡¥æ¥æ¨¡å¼&#34;&gt;æ¡¥æ¥æ¨¡å¼&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;ç»“æ„å‹æ¨¡å¼&lt;/li&gt;
&lt;li&gt;æŠ½è±¡ä¸å®ç°åˆ†ç¦»ï¼Œæ¡¥æ¥æ¥å£ç±»å’ŒæŠ½è±¡ç±»ï¼Œå®ç°è§£è€¦ï¼Œè¿™é‡Œå…¶å®å¹¶ä¸ä¸€å®šæ˜¯è¦æŠ½è±¡ç±»ï¼ŒæŠ½è±¡ç±»åªæ˜¯ä»£è¡¨ä¸€ç»„ç°å®çš„æŠ½è±¡ï¼Œå³ä¸€ä¸ªç±»å­˜åœ¨ä¸¤ä¸ªï¼ˆæˆ–å¤šä¸ªï¼‰ç‹¬ç«‹å˜åŒ–çš„ç»´åº¦ï¼Œé€šè¿‡ç»„åˆçš„æ–¹å¼ï¼Œè®©è¿™ä¸¤ä¸ªï¼ˆæˆ–å¤šä¸ªï¼‰ç»´åº¦å¯ä»¥ç‹¬ç«‹è¿›è¡Œæ‰©å±•&lt;/li&gt;
&lt;li&gt;å…¸å‹ä¾‹å­ï¼šJDBCï¼Œä»…ä¿®æ”¹Class.forName(&amp;ldquo;com.mysql.jdbc.Driver&amp;rdquo;)ï¼Œå³å¯æŠŠé©±åŠ¨æ¢æˆåˆ«çš„æ•°æ®åº“&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;JDBCçš„åšæ³•æ˜¯æä¾›Driveræ¥å£ï¼Œæ•°æ®åº“å‚å•†å®ç°è¯¥æ¥å£æä¾›ä¸åŒçš„æ•°æ®åº“èƒ½åŠ›ï¼Œå¹¶è°ƒç”¨DriverManagerè¿›è¡Œæ³¨å†Œï¼Œåç»­é€šè¿‡DriverManagerè·å–connectionå¹¶è¿›è¡ŒCRUDæ“ä½œï¼Œéƒ½ç”±DriverManagerå§”æ´¾ç»™å…·ä½“çš„Driveråš&lt;/p&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/%e6%a1%a5%e6%8e%a5%e6%a8%a1%e5%bc%8f.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/%e6%a1%a5%e6%8e%a5%e6%a8%a1%e5%bc%8f.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			alt=&#34;æ¡¥æ¥æ¨¡å¼ä¾‹å­&#34;&gt;
	&lt;/a&gt;
	
	&lt;figcaption&gt;æ¡¥æ¥æ¨¡å¼ä¾‹å­&lt;/figcaption&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;æ¡¥æ¥æ¥å£ç±»å’ŒæŠ½è±¡ç±»ï¼Œæ¥å£ç±»å®ç°ä¸Šè‰²ï¼ŒæŠ½è±¡ç±»å®ç°å½¢çŠ¶ï¼Œåœ¨æŠ½è±¡ç±»ä¸­å¼•å…¥æ¥å£ï¼Œé€šè¿‡ä¸åŒçš„ç»„åˆå®ç°ä¸åŒçš„åŠŸèƒ½&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// æ¡¥æ¥å®ç°æ¥å£ï¼Œ è¿æ¥ ç”» å’Œ ä¸Šè‰²
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;DrawAPI&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;drawCircle&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;radius&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;y&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;// ä¸åŒå®ç°ç±»ï¼Œçº¢è‰²
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;RedCircle&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;implements&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;DrawAPI&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;nd&#34;&gt;@Override&lt;/span&gt;
   &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;drawCircle&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;radius&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;y&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;System&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;out&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;println&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Drawing Circle[ color: red, radius: &amp;#34;&lt;/span&gt;
         &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;radius&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;, x: &amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;x&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;, &amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;y&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;]&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
   &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;// ä½¿ç”¨ DrawAPI æ¥å£åˆ›å»ºæŠ½è±¡ç±» Shape
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;abstract&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;Shape&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;kd&#34;&gt;protected&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;DrawAPI&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;drawAPI&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
   &lt;span class=&#34;kd&#34;&gt;protected&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Shape&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;DrawAPI&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;drawAPI&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;){&lt;/span&gt;
      &lt;span class=&#34;k&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;drawAPI&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;drawAPI&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
   &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
   &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;abstract&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;draw&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;  
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;// Shapeä¸åŒå¾—å®ç°ç±»
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;Circle&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;extends&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Shape&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;y&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;radius&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
    
   &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Circle&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;y&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;radius&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;DrawAPI&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;drawAPI&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;kd&#34;&gt;super&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;drawAPI&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
      &lt;span class=&#34;k&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;x&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;  
      &lt;span class=&#34;k&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;y&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;y&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;  
      &lt;span class=&#34;k&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;radius&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;radius&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
   &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt; 
   &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;draw&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;drawAPI&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;drawCircle&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;radius&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;y&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
   &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;// è°ƒç”¨
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;BridgePatternDemo&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;Shape&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;redCircle&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Circle&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;100&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;100&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;10&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;RedCircle&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;());&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;redCircle&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;draw&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// Drawing Circle[ color: red, radius: 10, x: 100, 100]
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;   &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h3 id=&#34;ä»£ç†æ¨¡å¼æ¡¥æ¥æ¨¡å¼è£…é¥°å™¨æ¨¡å¼é€‚é…å™¨æ¨¡å¼çš„åŒºåˆ«&#34;&gt;ä»£ç†æ¨¡å¼ã€æ¡¥æ¥æ¨¡å¼ã€è£…é¥°å™¨æ¨¡å¼ã€é€‚é…å™¨æ¨¡å¼çš„åŒºåˆ«&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;**ä»£ç†æ¨¡å¼ï¼š**ä»£ç†æ¨¡å¼åœ¨ä¸æ”¹å˜åŸå§‹ç±»æ¥å£çš„æ¡ä»¶ä¸‹ï¼Œä¸ºåŸå§‹ç±»å®šä¹‰ä¸€ä¸ªä»£ç†ç±»ï¼Œä¸»è¦ç›®çš„æ˜¯æ§åˆ¶è®¿é—®ï¼Œè€ŒéåŠ å¼ºåŠŸèƒ½ï¼Œè¿™æ˜¯å®ƒè·Ÿè£…é¥°å™¨æ¨¡å¼æœ€å¤§çš„ä¸åŒã€‚&lt;/p&gt;
&lt;p&gt;**æ¡¥æ¥æ¨¡å¼ï¼š**æ¡¥æ¥æ¨¡å¼çš„ç›®çš„æ˜¯å°†æ¥å£éƒ¨åˆ†å’Œå®ç°éƒ¨åˆ†åˆ†ç¦»ï¼Œä»è€Œè®©å®ƒä»¬å¯ä»¥è¾ƒä¸ºå®¹æ˜“ã€ä¹Ÿç›¸å¯¹ç‹¬ç«‹åœ°åŠ ä»¥æ”¹å˜ã€‚&lt;/p&gt;
&lt;p&gt;**è£…é¥°å™¨æ¨¡å¼ï¼š**è£…é¥°è€…æ¨¡å¼åœ¨ä¸æ”¹å˜åŸå§‹ç±»æ¥å£çš„æƒ…å†µä¸‹ï¼Œå¯¹åŸå§‹ç±»åŠŸèƒ½è¿›è¡Œå¢å¼ºï¼Œå¹¶ä¸”æ”¯æŒå¤šä¸ªè£…é¥°å™¨çš„åµŒå¥—ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;**é€‚é…å™¨æ¨¡å¼ï¼š**é€‚é…å™¨æ¨¡å¼æ˜¯ä¸€ç§äº‹åçš„è¡¥æ•‘ç­–ç•¥ã€‚é€‚é…å™¨æä¾›è·ŸåŸå§‹ç±»ä¸åŒçš„æ¥å£ï¼Œè€Œä»£ç†æ¨¡å¼ã€è£…é¥°å™¨æ¨¡å¼æä¾›çš„éƒ½æ˜¯è·ŸåŸå§‹ç±»ç›¸åŒçš„æ¥å£ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å…¶å®è¿™å‡ ç§è®¾è®¡æ¨¡å¼åœ¨ä»£ç å±‚é¢ä¸Šæ˜¯å¾ˆç›¸ä¼¼çš„ï¼Œæœ¬è´¨åªæ˜¯è®¾è®¡æ„å›¾çš„ä¸åŒï¼Œåº”å¯¹çš„åœºæ™¯ä¸åŒ&lt;/p&gt;
&lt;h3 id=&#34;é—¨é¢å¤–è§‚æ¨¡å¼&#34;&gt;é—¨é¢(å¤–è§‚)æ¨¡å¼&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;ç»“æ„å‹æ¨¡å¼&lt;/li&gt;
&lt;li&gt;æœ¬è´¨æ˜¯å¯¹æ¥å£çš„ç»„åˆï¼Œæ¯”å¦‚æœ‰å­ç³»ç»Ÿæˆ–è€…å­æ¨¡å—æä¾›äº†bã€cã€dæ¥å£ï¼Œéƒ½æ˜¯äº›èŒè´£æ¯”è¾ƒå•ä¸€çš„æ¥å£ï¼Œå¯ä»¥åœ¨ä¸Šå±‚æä¾›ä¸€ä¸ªå¤§è€Œå…¨çš„æ¥å£ï¼Œä½¿ç”¨åˆ°äº†bã€cã€dæ¥å£æä¾›çš„åŠŸèƒ½ï¼Œç®€åŒ–äº†è°ƒç”¨è€…çš„è°ƒç”¨å…³ç³»å¤„ç†&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;ç»„åˆæ¨¡å¼&#34;&gt;ç»„åˆæ¨¡å¼&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ç»“æ„å‹æ¨¡å¼&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æœ¬è´¨æ˜¯å¤šå‰æ ‘ï¼Œæ ¹èŠ‚ç‚¹å’Œå­èŠ‚ç‚¹ç»§æ‰¿æˆ–å®ç°åŒä¸€ä¸ªæ¥å£ï¼Œä»¥æ–¹ä¾¿é€’å½’å¤„ç†æ ‘å½¢ç»“æ„çš„æ•°æ®&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¸»è¦å¤„ç†æ ‘å½¢ç»“æ„æ•°æ®&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;äº«å…ƒæ¨¡å¼&#34;&gt;äº«å…ƒæ¨¡å¼&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;ç»“æ„å‹æ¨¡å¼&lt;/li&gt;
&lt;li&gt;äº«å…ƒï¼Œå³å…±äº«å•å…ƒï¼Œä¸€èˆ¬æ˜¯é€šè¿‡å¤ç”¨ä¸å¯å˜å¯¹è±¡è¾¾åˆ°èŠ‚çœå†…å­˜çš„ä½œç”¨ï¼Œé€šè¿‡map + å·¥å‚æ¨¡å¼æ¥è¾¾åˆ°å¤ç”¨çš„ç›®çš„ï¼Œä½†æ˜¯å¯¹äºGCå¹¶ä¸å‹å¥½ï¼Œå¦‚æœè¯¥å¯¹è±¡å¹¶ä¸å¸¸ç”¨ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å¼±å¼•ç”¨æˆ–è½¯å¼•ç”¨ç›¸å…³çš„hashMapæ¥å­˜å‚¨ï¼Œæ–¹ä¾¿åƒåœ¾å›æ”¶&lt;/li&gt;
&lt;li&gt;å…¸å‹ä¾‹å­ï¼šjavaä¸­çš„Integerç±»ï¼Œå¯¹äºå¤šä¸ª-128~127çš„åŒ…è£…ç±»å‹å¯¹è±¡ï¼Œåº•å±‚çš„å†…å­˜åœ°å€æ˜¯åŒä¸€ä¸ªï¼ŒIntegerç±»é‡Œæœ‰ä¸ªIntegerCacheå†…éƒ¨ç±»ï¼Œç›¸å½“äºäº«å…ƒå¯¹è±¡çš„å·¥å‚ï¼Œç¼“å­˜ç€-128~127ä¹‹é—´çš„æ•°æ®ï¼Œç±»ä¼¼çš„ï¼Œå¦‚ Longã€ Shortã€ ByteåŒ…è£…ç±»å‹ä¹Ÿç”¨åˆ°äº†è¿™ç§æ–¹æ³•ï¼›è¿˜æœ‰Stringç±»çš„å­—ç¬¦ä¸²å¸¸é‡æ± ï¼Œä¼šç¼“å­˜stringå­—é¢é‡ï¼ŒStringç±»ä¹Ÿæä¾›äº†internæ–¹æ³•æ–¹ä¾¿æˆ‘ä»¬å°†å­—ç¬¦ä¸²å­˜å…¥å¸¸é‡æ± &lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;è¡Œä¸ºå‹&#34;&gt;è¡Œä¸ºå‹&lt;/h2&gt;
&lt;h3 id=&#34;è´£ä»»é“¾æ¨¡å¼&#34;&gt;è´£ä»»é“¾æ¨¡å¼&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;è¡Œä¸ºå‹æ¨¡å¼&lt;/li&gt;
&lt;li&gt;æ¯ä¸ªæ¥æ”¶è€…éƒ½åŒ…å«å¯¹å¦ä¸€ä¸ªæ¥æ”¶è€…çš„å¼•ç”¨ã€‚å¦‚æœä¸€ä¸ªå¯¹è±¡ä¸èƒ½å¤„ç†è¯¥è¯·æ±‚ï¼Œé‚£ä¹ˆå®ƒä¼šæŠŠç›¸åŒçš„è¯·æ±‚ä¼ ç»™ä¸‹ä¸€ä¸ªæ¥æ”¶è€…ï¼Œä¾æ­¤ç±»æ¨ï¼Œå³ï¼šå°†æ‰€æœ‰æ¥å—è€…è¿æˆä¸€æ¡é“¾ï¼Œè¯·æ±‚æ²¿ç€è¿™æ¡é“¾ä¼ é€’ï¼Œç›´åˆ°æœ‰å¯¹è±¡å¤„ç†&lt;/li&gt;
&lt;li&gt;å…¸å‹ä¾‹å­ï¼šservlet filterã€spring interceptorã€logger&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/%e8%b4%a3%e4%bb%bb%e9%93%be%e6%a8%a1%e5%bc%8f.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/%e8%b4%a3%e4%bb%bb%e9%93%be%e6%a8%a1%e5%bc%8f.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			alt=&#34;è´£ä»»é“¾æ¨¡å¼ä¾‹å­&#34;&gt;
	&lt;/a&gt;
	
	&lt;figcaption&gt;è´£ä»»é“¾æ¨¡å¼ä¾‹å­&lt;/figcaption&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;è¿™æ˜¯æ¨¡æ‹Ÿæ—¥å¿—çº§åˆ«æ‰“å°çš„ä¾‹å­ï¼šæ—¥å¿—æŠ½è±¡ç±»è§„å®šæ¯ä¸ªç»“ç‚¹çš„æ—¥å¿—ç­‰çº§å’Œéœ€è¦é‡å†™çš„æ–¹æ³•ï¼Œå‚æ•°ä¼ é€’å¤„ç†çš„æ–¹æ³•ï¼Œå¯ä»¥çœ‹æˆä¸€ä¸ªé“¾è¡¨ä¸Šç»“ç‚¹çš„æŠ½è±¡ï¼›å…·ä½“çš„ç±»å®ç°è¯¥æŠ½è±¡ç±»é‡å†™å…±åŒæ–¹æ³•å½“æˆæ¯ä¸€ä¸ªç»“ç‚¹ï¼Œæœ€åå°†è¿™äº›ç»“ç‚¹è¿æˆé“¾å³å¯&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;48
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;49
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;50
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;51
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;52
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;53
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;54
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;55
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;56
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;57
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;58
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;59
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;60
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;61
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;62
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;63
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;64
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;65
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;66
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;67
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;68
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;69
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;70
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;71
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;72
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;73
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;74
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;75
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;76
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;77
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;78
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;79
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;80
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;81
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;82
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;83
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;84
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;85
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;86
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;87
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;88
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;89
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// åˆ›å»ºæŠ½è±¡çš„è®°å½•å™¨ç±»
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;abstract&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;AbstractLogger&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
 
   &lt;span class=&#34;kd&#34;&gt;protected&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;level&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
 
   &lt;span class=&#34;c1&#34;&gt;// è´£ä»»é“¾ä¸­çš„ä¸‹ä¸€ä¸ªå…ƒç´ 
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;   &lt;span class=&#34;kd&#34;&gt;protected&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AbstractLogger&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;nextLogger&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
 
   &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;setNextLogger&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;AbstractLogger&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;nextLogger&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;){&lt;/span&gt;
      &lt;span class=&#34;k&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;nextLogger&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;nextLogger&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
   &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
   &lt;span class=&#34;c1&#34;&gt;// åˆ¤æ–­æ˜¯å¦ç”±å½“å‰ç»“ç‚¹å¤„ç†æˆ–è€…äº¤ç”±ä¸‹ä¸ªç»“ç‚¹å¤„ç†
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;   &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;logMessage&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;level&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;message&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;){&lt;/span&gt;
      &lt;span class=&#34;c1&#34;&gt;// æ ¹æ®leveåˆ¤æ–­
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;level&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;level&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;){&lt;/span&gt;
         &lt;span class=&#34;n&#34;&gt;write&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;message&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
      &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
      &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;nextLogger&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;){&lt;/span&gt;
         &lt;span class=&#34;n&#34;&gt;nextLogger&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;logMessage&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;level&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;message&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
      &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
   &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt; 
   &lt;span class=&#34;kd&#34;&gt;abstract&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;protected&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;write&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;message&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;// æ—¥å¿—ç­‰çº§
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;LoggerLevel&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;final&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;INFO&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
   &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;final&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;DEBUG&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
   &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;final&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ERROR&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;// è®°å½•ç±»çš„å®ç°ç±»ï¼Œé“¾ä¸Šçš„ç»“ç‚¹
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;ConsoleLogger&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;extends&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AbstractLogger&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt; 
   &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;ConsoleLogger&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;level&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;){&lt;/span&gt;
      &lt;span class=&#34;k&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;level&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;level&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
   &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
   &lt;span class=&#34;nd&#34;&gt;@Override&lt;/span&gt;
   &lt;span class=&#34;kd&#34;&gt;protected&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;write&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;message&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;    
      &lt;span class=&#34;n&#34;&gt;System&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;out&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;println&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Standard Console::Logger: &amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;message&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
   &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;FileLogger&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;extends&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AbstractLogger&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;FileLogger&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;level&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;){&lt;/span&gt;
      &lt;span class=&#34;k&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;level&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;level&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
   &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
   &lt;span class=&#34;nd&#34;&gt;@Override&lt;/span&gt;
   &lt;span class=&#34;kd&#34;&gt;protected&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;write&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;message&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;    
      &lt;span class=&#34;n&#34;&gt;System&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;out&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;println&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;File::Logger: &amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;message&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
   &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;ErrorLogger&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;extends&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AbstractLogger&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;ErrorLogger&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;level&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;){&lt;/span&gt;
      &lt;span class=&#34;k&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;level&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;level&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
   &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
   &lt;span class=&#34;nd&#34;&gt;@Override&lt;/span&gt;
   &lt;span class=&#34;kd&#34;&gt;protected&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;write&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;message&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;    
      &lt;span class=&#34;n&#34;&gt;System&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;out&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;println&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Error Console::Logger: &amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;message&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
   &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;// åˆ›å»ºé“¾
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;ChainPatternDemo&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
   
   &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AbstractLogger&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getChainOfLoggers&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(){&lt;/span&gt;
      &lt;span class=&#34;c1&#34;&gt;// åˆ›å»ºæ¯ä¸€ä¸ªç»“ç‚¹ï¼Œè®¾å®šæ¯ä¸ªç»“ç‚¹çš„level
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;AbstractLogger&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;errorLogger&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ErrorLogger&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;LoggerLevel&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;ERROR&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;AbstractLogger&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;fileLogger&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;FileLogger&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;LoggerLevel&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;DEBUG&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;AbstractLogger&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;consoleLogger&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ConsoleLogger&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;LoggerLevel&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;INFO&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
 	  &lt;span class=&#34;c1&#34;&gt;// å½¢æˆé“¾
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;errorLogger&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;setNextLogger&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;fileLogger&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;fileLogger&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;setNextLogger&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;consoleLogger&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
 	  &lt;span class=&#34;c1&#34;&gt;// è¿”å›å¤´ç»“ç‚¹
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;errorLogger&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;  
   &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
 
   &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;AbstractLogger&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;loggerChain&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;getChainOfLoggers&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
      &lt;span class=&#34;c1&#34;&gt;// æ¯ä¸ªç»“ç‚¹æ ¹æ®åˆ›å»ºæ¥çš„å‚æ•°æ¥åˆ¤æ–­æ˜¯å¦æ‰§è¡Œæˆ–è€…äº¤ç”±ä¸‹ä¸€ä¸ªç»“ç‚¹
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;loggerChain&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;logMessage&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;LoggerLevel&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;INFO&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;This is an information.&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
      &lt;span class=&#34;c1&#34;&gt;// è¾“å‡ºï¼š Standard Console::Logger: This is an information.
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;loggerChain&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;logMessage&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;LoggerLevel&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;DEBUG&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;This is an debug level information&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
      &lt;span class=&#34;c1&#34;&gt;// è¾“å‡ºï¼š
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;c1&#34;&gt;// File::Logger: This is an debug level information.
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	  &lt;span class=&#34;c1&#34;&gt;// Standard Console::Logger: This is an debug level information.
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;loggerChain&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;logMessage&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;LoggerLevel&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;ERROR&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;This is an error information.&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
      &lt;span class=&#34;c1&#34;&gt;// è¾“å‡ºï¼š
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	  &lt;span class=&#34;c1&#34;&gt;// Error Console::Logger: This is an error information.
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	  &lt;span class=&#34;c1&#34;&gt;// File::Logger: This is an error information.
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	  &lt;span class=&#34;c1&#34;&gt;// Standard Console::Logger: This is an error information.
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;   &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h3 id=&#34;è¿­ä»£å™¨æ¨¡å¼&#34;&gt;è¿­ä»£å™¨æ¨¡å¼&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;è¡Œä¸ºå‹æ¨¡å¼&lt;/li&gt;
&lt;li&gt;ç”¨äºé¡ºåºè®¿é—®é›†åˆå¯¹è±¡çš„å…ƒç´ ï¼Œä¸éœ€è¦çŸ¥é“é›†åˆå¯¹è±¡çš„åº•å±‚è¡¨ç¤ºï¼Œä¸ä¼šæš´éœ²è¯¥å¯¹è±¡çš„å†…éƒ¨è¡¨ç¤ºï¼Œè¿­ä»£å™¨å†…éƒ¨ä½¿ç”¨æ¸¸æ ‡è®°å½•å½“å‰ä½ç½®ä¿¡æ¯ï¼Œæ¯ä¸ªè¿­ä»£å™¨ç‹¬äº«æ¸¸æ ‡ä¿¡æ¯ï¼Œè¿™æ ·å½“æˆ‘ä»¬åˆ›å»ºä¸åŒçš„è¿­ä»£å™¨å¯¹ä¸åŒçš„å®¹å™¨è¿›è¡Œéå†çš„æ—¶å€™å°±ä¸ä¼šäº’ç›¸å½±å“&lt;/li&gt;
&lt;li&gt;é’ˆå¯¹å¤æ‚çš„æ•°æ®ç»“æ„ï¼Œæ¯”å¦‚æ ‘ã€å›¾çš„éå†ï¼Œä½¿ç”¨è¿­ä»£å™¨æ¨¡å¼ä¼šæ›´åŠ æœ‰æ•ˆ&lt;/li&gt;
&lt;li&gt;å¯¹äºè¿­ä»£è¿‡ç¨‹ä¸­é€šè¿‡å¯¹å®¹å™¨å¢åŠ æˆ–åˆ é™¤å…ƒç´ ä¼šæœ‰é—®é¢˜ï¼Œ javaä½¿ç”¨fail-fastæœºåˆ¶ï¼Œå³éå†æ¯ä¸ªå…ƒç´ çš„æ—¶å€™ä¼šæ¯”è¾ƒmodCountçš„å€¼å’Œè°ƒç”¨è¿­ä»£å™¨æ—¶çš„expectedModCountçš„å€¼æ¯”è¾ƒæ¥å®ç°fail-fastï¼Œè¾¾åˆ°æŠ¥é”™çš„ç›®çš„ã€‚æ­¤å¤–ï¼Œå¦‚æœæƒ³è¦åˆ é™¤ï¼Œéœ€è¦é€šè¿‡è¿­ä»£å™¨æ¥åˆ é™¤æ‰å¯ä»¥ï¼Œjavaä¸­ä½¿ç”¨lastRetå˜é‡æ¥è®°å½•ä¸Šä¸€ä¸ªæ¸¸æ ‡ï¼Œä»¥ä¿è¯åœ¨åˆ é™¤å½“å‰å…ƒç´ åï¼Œæ¸¸æ ‡èƒ½æ­£ç¡®æŒ‡å‘ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/%e8%bf%ad%e4%bb%a3%e5%99%a8%e6%a8%a1%e5%bc%8f.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/%e8%bf%ad%e4%bb%a3%e5%99%a8%e6%a8%a1%e5%bc%8f.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			alt=&#34;è¿­ä»£å™¨æ¨¡å¼ä¾‹å­&#34;&gt;
	&lt;/a&gt;
	
	&lt;figcaption&gt;è¿­ä»£å™¨æ¨¡å¼ä¾‹å­&lt;/figcaption&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;46
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// è¿­ä»£å™¨æ¥å£
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;Iterator&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;boolean&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;hasNext&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
   &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;next&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;// é›†åˆæ¥å£
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;Container&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Iterator&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getIterator&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;// åŒ…å«æœ‰è¿­ä»£å™¨çš„é›†åˆ
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;NameRepository&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;implements&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Container&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;names&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Robert&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;John&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Julie&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;Lora&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;};&lt;/span&gt;
   &lt;span class=&#34;nd&#34;&gt;@Override&lt;/span&gt;
   &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Iterator&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getIterator&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;NameIterator&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
   &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
   &lt;span class=&#34;c1&#34;&gt;// å†…éƒ¨ç±»
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;   &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;NameIterator&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;implements&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Iterator&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;index&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
      &lt;span class=&#34;nd&#34;&gt;@Override&lt;/span&gt;
      &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;boolean&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;hasNext&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
         &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;index&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;names&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;length&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;){&lt;/span&gt;
            &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
         &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
         &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
      &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
      &lt;span class=&#34;nd&#34;&gt;@Override&lt;/span&gt;
      &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;next&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
         &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;hasNext&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()){&lt;/span&gt;
            &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;names&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;index&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++];&lt;/span&gt;
         &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
         &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
      &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;     
   &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;// è°ƒç”¨
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;IteratorPatternDemo&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
       
      &lt;span class=&#34;n&#34;&gt;NameRepository&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;namesRepository&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;NameRepository&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// åˆ›å»ºé›†åˆ
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Iterator&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;iter&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;namesRepository&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getIterator&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;iter&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;hasNext&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();){&lt;/span&gt;
         &lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;name&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;iter&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;next&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
         &lt;span class=&#34;n&#34;&gt;System&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;out&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;println&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Name : &amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
      &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;  
   &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h3 id=&#34;è®¿é—®è€…æ¨¡å¼&#34;&gt;è®¿é—®è€…æ¨¡å¼&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;è¡Œä¸ºå‹&lt;/li&gt;
&lt;li&gt;å…è®¸ä¸€ä¸ªæˆ–è€…å¤šä¸ªæ“ä½œåº”ç”¨åˆ°ä¸€ç»„å¯¹è±¡ä¸Šï¼Œè§£è€¦æ“ä½œå’Œå¯¹è±¡æœ¬èº«ï¼Œæ¯”å¦‚å¯¹äºå¤šç§æ–‡ä»¶ç±»å‹ï¼Œå¯ä»¥ä½¿ç”¨å¤šç§ä¸åŒçš„æ‰§è¡Œå™¨ä½œç”¨åœ¨ä¸åŒçš„æ–‡ä»¶ä¸Š&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;å¤‡å¿˜å½•æ¨¡å¼å¿«ç…§&#34;&gt;å¤‡å¿˜å½•æ¨¡å¼ï¼ˆå¿«ç…§ï¼‰&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;è¡Œä¸ºå‹&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¸€èˆ¬æ ˆæ¥ä¿å­˜å‰¯æœ¬ï¼Œå…¥æ ˆçš„å…ƒç´ éƒ½ä¼šå åŠ ä¸Šä¸€ä¸ªå…ƒç´ çš„å†…å®¹ï¼Œä»¥æ­¤æ¥å®ç°é¡ºåºæ’¤é”€å’Œæ¢å¤åŠŸèƒ½&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¸»è¦æ˜¯ç”¨æ¥é˜²ä¸¢å¤±ã€æ’¤é”€ã€æ¢å¤&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;çŠ¶æ€æ¨¡å¼&#34;&gt;çŠ¶æ€æ¨¡å¼&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;è¡Œä¸ºå‹&lt;/li&gt;
&lt;li&gt;çŠ¶æ€ -&amp;gt; äº‹ä»¶ -&amp;gt; åŠ¨ä½œ -&amp;gt; çŠ¶æ€æ”¹å˜ æˆ–è€… çŠ¶æ€ -&amp;gt; äº‹ä»¶ -&amp;gt; çŠ¶æ€æ”¹å˜ -&amp;gt; åŠ¨ä½œ&lt;/li&gt;
&lt;li&gt;åˆ†æ”¯é€»è¾‘æ³• æˆ–è€… æŸ¥è¡¨æ³• æˆ– é€šè¿‡å°†åˆ†æ”¯åˆ¤æ–­æŠ½æˆç±»æ¥å®ç°ä¸Šè¿° å½“çŠ¶æ€æ¥æ”¶åˆ°äº‹ä»¶åè¿›è¡Œä¸šåŠ¡é€»è¾‘åŠ¨ä½œåæ”¹å˜çŠ¶æ€&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;è§‚å¯Ÿè€…æ¨¡å¼&#34;&gt;è§‚å¯Ÿè€…æ¨¡å¼&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;è¡Œä¸ºå‹&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åœ¨ä¸€å¯¹å¤šå…³ç³»ä¸­ï¼Œå½“ä¸€ä¸ªå¯¹è±¡è¢«ä¿®æ”¹æ—¶ï¼Œåˆ™ä¼šè‡ªåŠ¨é€šçŸ¥å®ƒçš„ä¾èµ–å¯¹è±¡&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å…¸å‹ä¾‹å­ï¼šæ¶ˆæ¯é˜Ÿåˆ—çš„å‘å¸ƒ/è®¢é˜…æ¨¡å‹&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç¡¬è¦è¯´çš„è¯ï¼Œè§‚å¯Ÿè€…æ¨¡å¼å’Œå‘å¸ƒè®¢é˜…æ¨¡å¼è¿˜æ˜¯æœ‰ä¸€å®šå·®åˆ«çš„&lt;/p&gt;
&lt;p&gt;è§‚å¯Ÿè€…æ˜¯å½“è¢«è§‚å¯Ÿè€…æœ‰çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œé€šçŸ¥è§‚å¯Ÿè€…ï¼›è€Œå‘å¸ƒè®¢é˜…æ˜¯å‘å¸ƒè€…æŠŠæ¶ˆæ¯ä¸¢åˆ°æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ¶ˆæ¯é˜Ÿåˆ—æ ¹æ®æ¶ˆæ¯å‘ç»™å¯¹åº”çš„è®¢é˜…è€…ï¼ŒåŒºåˆ«å°±æ˜¯æœ‰æ²¡æœ‰ç¬¬ä¸‰æ–¹å­˜åœ¨ï¼Œæ¶ˆæ¯çš„åŒæ–¹çŸ¥ä¸çŸ¥é“å½¼æ­¤çš„å­˜åœ¨&lt;/p&gt;
&lt;p&gt;å‘å¸ƒè®¢é˜…ï¼š&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/%e8%a7%82%e5%af%9f%e8%80%85%e6%a8%a1%e5%bc%8f.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/%e8%a7%82%e5%af%9f%e8%80%85%e6%a8%a1%e5%bc%8f.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			alt=&#34;è§‚å¯Ÿè€…æ¨¡å¼ä¾‹å­&#34;&gt;
	&lt;/a&gt;
	
	&lt;figcaption&gt;è§‚å¯Ÿè€…æ¨¡å¼ä¾‹å­&lt;/figcaption&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;46
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;47
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;48
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;49
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;50
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;51
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;52
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;53
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;54
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;55
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;56
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;57
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;58
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;59
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;60
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;61
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;62
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;63
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;64
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;65
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;66
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;67
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;68
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;69
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;70
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;71
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// è¢«è§‚å¯Ÿè€…ï¼Œå½“çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œé€šçŸ¥è§‚å¯Ÿè€…
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;Subject&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;c1&#34;&gt;// è§‚å¯Ÿè€…é˜Ÿåˆ—
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;   &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;List&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Observer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;observers&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ArrayList&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Observer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;();&lt;/span&gt;
   &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;state&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// çŠ¶æ€
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt; 
   &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getState&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;state&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
   &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
   &lt;span class=&#34;c1&#34;&gt;// çŠ¶æ€æ”¹å˜æ—¶é€šçŸ¥è§‚å¯Ÿè€…
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;   &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;setState&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;state&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;k&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;state&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;state&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;notifyAllObservers&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
   &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
   &lt;span class=&#34;c1&#34;&gt;// ç»‘å®šè§‚å¯Ÿè€…
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;   &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;attach&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Observer&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;observer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;){&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;observers&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;add&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;observer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;      
   &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
   &lt;span class=&#34;c1&#34;&gt;// é€šçŸ¥è§‚å¯Ÿè€…ï¼Œæ‰§è¡Œè§‚å¯Ÿè€…æ–¹æ³•
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;   &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;notifyAllObservers&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(){&lt;/span&gt;
      &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Observer&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;observer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;observers&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
         &lt;span class=&#34;n&#34;&gt;observer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;update&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
      &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
   &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;  
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;// è§‚å¯Ÿè€…æŠ½è±¡ç±»
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;abstract&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;Observer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;kd&#34;&gt;protected&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Subject&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;subject&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
   &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;abstract&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;update&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;// è§‚å¯Ÿè€…å®ç°ç±»
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;BinaryObserver&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;extends&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Observer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt; 
   &lt;span class=&#34;c1&#34;&gt;// ç»‘å®šè¢«è§‚å¯Ÿè€…
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;   &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;BinaryObserver&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Subject&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;subject&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;){&lt;/span&gt;
      &lt;span class=&#34;k&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;subject&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;subject&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
      &lt;span class=&#34;k&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;subject&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;attach&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
   &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
   &lt;span class=&#34;c1&#34;&gt;// æ‰§è¡Œè§‚å¯Ÿè€…ç±»
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;   &lt;span class=&#34;nd&#34;&gt;@Override&lt;/span&gt;
   &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;update&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;System&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;out&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;println&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Binary String:&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Integer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;toBinaryString&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;subject&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getState&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;));&lt;/span&gt; 
   &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;// è§‚å¯Ÿè€…å®ç°ç±»
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;OctalObserver&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;extends&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Observer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;c1&#34;&gt;// ç»‘å®šè¢«è§‚å¯Ÿè€…
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;   &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;OctalObserver&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Subject&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;subject&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;){&lt;/span&gt;
      &lt;span class=&#34;k&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;subject&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;subject&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
      &lt;span class=&#34;k&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;subject&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;attach&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
   &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
   &lt;span class=&#34;c1&#34;&gt;// æ‰§è¡Œè§‚å¯Ÿè€…ç±»
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;   &lt;span class=&#34;nd&#34;&gt;@Override&lt;/span&gt;
   &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;update&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
     &lt;span class=&#34;n&#34;&gt;System&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;out&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;println&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Octal String:&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Integer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;toOctalString&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;subject&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getState&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()));&lt;/span&gt; 
   &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;// è°ƒç”¨
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;ObserverPatternDemo&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;Subject&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;subject&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Subject&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
      &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;OctalObserver&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;subject&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
      &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;BinaryObserver&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;subject&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
 
      &lt;span class=&#34;n&#34;&gt;System&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;out&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;println&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;First state change: 15&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;   
      &lt;span class=&#34;n&#34;&gt;subject&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;setState&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;15&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;		&lt;span class=&#34;c1&#34;&gt;// Octal String: 17 /n Binary String: 1111
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;System&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;out&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;println&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Second state change: 10&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;  
      &lt;span class=&#34;n&#34;&gt;subject&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;setState&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;10&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;		&lt;span class=&#34;c1&#34;&gt;//Octal String: 12 /n Binary String: 1010
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;   &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h3 id=&#34;æ¨¡æ¿æ–¹æ³•&#34;&gt;æ¨¡æ¿æ–¹æ³•&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;è¡Œä¸ºå‹&lt;/li&gt;
&lt;li&gt;ä¸€ä¸ªæŠ½è±¡ç±»æŠ½å–ä¸€äº›é€šç”¨æ–¹æ³•åˆå¹¶æˆæ–°æ–¹æ³•å¹¶ç”¨finalä¿®é¥°ä½œä¸ºæ¨¡æ¿ï¼Œå®ƒçš„å­ç±»ç»§æ‰¿æ­¤æŠ½è±¡ç±»ï¼Œé€šè¿‡é‡å†™é€šç”¨æ–¹æ³•ï¼Œæ¥å®ç°ä¸ä¸€æ ·çš„æ¨¡æ¿æ–¹æ³•&lt;/li&gt;
&lt;li&gt;å…¸å‹ä¾‹å­ï¼šJUCåŒ…é‡Œçš„AQSå’Œå…¶å­ç±»ã€util.Collections#sort()ã€InputStream#skip()ã€InputStream#read()ã€servletã€junit&lt;/li&gt;
&lt;li&gt;æ¨¡æ¿æ–¹æ³•ä¸å›è°ƒçš„åŒºåˆ«ï¼šå›è°ƒçš„ä½œç”¨ä¸æ¨¡æ¿æ–¹æ³•ç±»ä¼¼ï¼Œéƒ½æ˜¯é€šè¿‡è‡ªç”±æ›¿æ¢æŸä¸ªæ–¹æ³•æ¥å®ç°ä¸åŒçš„åŠŸèƒ½ï¼Œä½†å›è°ƒåŸºäºç»„åˆå…³ç³»ï¼Œè€Œæ¨¡æ¿æ–¹æ³•åŸºäºç»§æ‰¿å…³ç³»ï¼ŒåŒæ­¥å›è°ƒç±»ä¼¼æ¨¡æ¿æ–¹æ³•ï¼Œå¼‚æ­¥å›è°ƒç±»ä¼¼è§‚å¯Ÿè€…æ¨¡å¼&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/%e6%a8%a1%e6%9d%bf%e6%96%b9%e6%b3%95.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/%e6%a8%a1%e6%9d%bf%e6%96%b9%e6%b3%95.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			alt=&#34;æ¨¡æ¿æ–¹æ³•ä¾‹å­&#34;&gt;
	&lt;/a&gt;
	
	&lt;figcaption&gt;æ¨¡æ¿æ–¹æ³•ä¾‹å­&lt;/figcaption&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// æŠ½è±¡æ¨¡æ¿ç±»
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;abstract&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;Game&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;c1&#34;&gt;// ç»™å­ç±»é‡å†™
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;   &lt;span class=&#34;kd&#34;&gt;abstract&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;initialize&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
   &lt;span class=&#34;kd&#34;&gt;abstract&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;startPlay&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
   &lt;span class=&#34;kd&#34;&gt;abstract&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;endPlay&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
    
   &lt;span class=&#34;c1&#34;&gt;//æ¨¡æ¿
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;   &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;final&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;play&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(){&lt;/span&gt;
      &lt;span class=&#34;c1&#34;&gt;//åˆå§‹åŒ–æ¸¸æˆ
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;initialize&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
      &lt;span class=&#34;c1&#34;&gt;//å¼€å§‹æ¸¸æˆ
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;startPlay&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
      &lt;span class=&#34;c1&#34;&gt;//ç»“æŸæ¸¸æˆ
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;endPlay&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
   &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;// å­ç±»ç»§æ‰¿å¹¶é‡å†™
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;Cricket&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;extends&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Game&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;nd&#34;&gt;@Override&lt;/span&gt;
   &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;endPlay&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;System&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;out&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;println&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Cricket Game Finished!&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
   &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
   &lt;span class=&#34;nd&#34;&gt;@Override&lt;/span&gt;
   &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;initialize&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;System&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;out&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;println&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Cricket Game Initialized! Start playing.&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
   &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
   &lt;span class=&#34;nd&#34;&gt;@Override&lt;/span&gt;
   &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;startPlay&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;System&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;out&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;println&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Cricket Game Started. Enjoy the game!&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
   &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;// è°ƒç”¨
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;TemplatePatternDemo&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;Game&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;game&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Cricket&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;game&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;play&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
	  &lt;span class=&#34;c1&#34;&gt;// Cricket Game Initialized! Start playing.
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	  &lt;span class=&#34;c1&#34;&gt;// Cricket Game Started. Enjoy the game!
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	  &lt;span class=&#34;c1&#34;&gt;// Cricket Game Finished!    
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;   &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h3 id=&#34;ç­–ç•¥æ¨¡å¼&#34;&gt;ç­–ç•¥æ¨¡å¼&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;è¡Œä¸ºå‹&lt;/li&gt;
&lt;li&gt;é€šè¿‡å®šä¹‰ä¸€ä¸ªé€šç”¨ç­–ç•¥æ¥å£ + ä¸€ç»„ç­–ç•¥çš„å®ç°ï¼Œç”±è°ƒç”¨è€…åœ¨è¿è¡Œæ—¶åŠ¨æ€é€‰æ‹©æŸä¸€ç­–ç•¥å®Œæˆä¸šåŠ¡é€»è¾‘ï¼Œå¸¸ç”¨æ­é…æ˜¯ ç­–ç•¥ + å·¥å‚æ¨¡å¼ï¼Œæ ¹æ®ä¸åŒç±»å‹é€‰æ‹©ä¸åŒç­–ç•¥&lt;/li&gt;
&lt;li&gt;å¸¸ç”¨çš„åœºæ™¯æ˜¯ä½¿ç”¨ç­–ç•¥æ¨¡å¼æ¥é¿å…è†¨èƒ€çš„åˆ†æ”¯åˆ¤æ–­ï¼Œç¼ºç‚¹æ˜¯ç­–ç•¥ç±»ä¼šå˜å¤šï¼Œå¦å¤–ï¼Œä½¿ç”¨æŸ¥è¡¨æ³•ä¹Ÿå¯é¿å…è†¨èƒ€çš„åˆ†æ”¯åˆ¤æ–­&lt;/li&gt;
&lt;li&gt;ä¸»è¦è§£å†³ï¼šå°†ä¸åŒç®—æ³•å°è£…æˆç­–ç•¥ï¼Œæ ¹æ®æ¡ä»¶é€‰æ‹©åˆé€‚çš„ç­–ç•¥&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;å‘½ä»¤æ¨¡å¼&#34;&gt;å‘½ä»¤æ¨¡å¼&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;è¡Œä¸ºå‹&lt;/li&gt;
&lt;li&gt;å°†å‡½æ•°æ–¹æ³•å°è£…æˆå¯¹è±¡ï¼Œç±»ä¼¼cè¯­è¨€çš„å‡½æ•°æŒ‡é’ˆï¼Œæ•°æ®é©±åŠ¨ï¼Œå°†äº‹ä»¶å’Œæ•°æ®å°è£…æˆå¯¹è±¡ï¼ˆå‘½ä»¤ï¼‰ï¼Œæœ€åæ‰§è¡Œï¼Œæœ‰ç‚¹åƒç­–ç•¥æ¨¡å¼ï¼Œä½†æ˜¯å‘½ä»¤æ¨¡å¼æ›´ä¾§é‡å°†è¡Œä¸ºè¯·æ±‚è€…å’Œå®ç°è€…è§£è€¦&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;è§£é‡Šå™¨æ¨¡å¼&#34;&gt;è§£é‡Šå™¨æ¨¡å¼&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;è¡Œä¸ºå‹&lt;/li&gt;
&lt;li&gt;é’ˆå¯¹æŸç§è¯­è¨€åˆ¶å®šå¯¹åº”çš„è¯­æ³•ï¼Œåœ¨ä»£ç ä¸­çš„ä½“ç°æ˜¯ï¼Œå¯¹æŸç§æ¨¡å¼çš„è§£ææŠ½æˆæ–¹æ³•ï¼Œé™ä½ä»£ç å¤æ‚åº¦&lt;/li&gt;
&lt;li&gt;å…¸å‹ä¾‹å­ï¼šåç¼€è¡¨è¾¾å¼çš„è§£æã€sqlè§£æã€æ­£åˆ™è¡¨è¾¾å¼è§£æ&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;ä¸­ä»‹æ¨¡å¼&#34;&gt;ä¸­ä»‹æ¨¡å¼&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;è¡Œä¸ºå‹&lt;/li&gt;
&lt;li&gt;å¼•å…¥ä¸­é—´å±‚ï¼Œå°†åŸæ¥å¤šå¯¹å¤šçš„å…³ç³»è½¬æ¢ä¸ºä¸€å¯¹å¤šçš„å…³ç³»ï¼Œè§£è€¦å¯¹è±¡é—´çš„å…³ç³»ï¼Œç±»ä¼¼è§‚å¯Ÿè€…æ¨¡å¼ï¼ŒåŒºåˆ«åœ¨äºè§‚å¯Ÿè€…æ¨¡å¼ä¸­ï¼Œæ•°æ®çš„æµå‘ã€å¯¹è±¡é—´çš„å…³ç³»æ˜¯å•å‘çš„ï¼Œè§‚å¯Ÿè€…å°±æ˜¯è§‚å¯Ÿè€…ã€è¢«è§‚å¯Ÿè€…å°±æ˜¯è¢«è§‚å¯Ÿè€…ï¼Œä¸ä¼šè½»æ˜“æ”¹å˜ï¼Œè€Œä¸­ä»‹æ¨¡å¼æ˜¯ç”±ä¸€ä¸ªä¸­é—´å¯¹è±¡æ¥å¤„ç†å„ä¸ªå¯¹è±¡é—´çš„å…³ç³»ï¼Œç±»ä¼¼æ•°æ®æ€»çº¿&lt;/li&gt;
&lt;li&gt;å…¸å‹ä¾‹å­ï¼šèŠå¤©å®¤&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¯¹äºEventBusï¼Œä¸ªäººè®¤ä¸ºå®ƒä¸æ˜¯ä¸­ä»‹æ¨¡å¼ï¼Œç¡¬è¦è¯´è¯ï¼Œå¤„ç†äº‹ä»¶çš„ä¸­å¿ƒç±»ï¼Œä¹Ÿç®—æ˜¯ä¸­ä»‹ï¼Œä½†æ˜¯ä¸»è¦æ˜¯å‘é€äº‹ä»¶çš„å¯¹è±¡å’Œå¤„ç†äº‹ä»¶çš„å¯¹è±¡å¹¶æ²¡æœ‰å¾ˆç›´æ¥çš„å…³ç³»ï¼Œäº‹ä»¶å¤„ç†è€…ä»…å…³å¿ƒæ¥æ”¶åˆ°çš„æ˜¯ä»€ä¹ˆäº‹ä»¶ï¼Œå¹¶ä¸å…³å¿ƒäº‹ä»¶æ˜¯ç”±è°å‘å‡ºçš„&lt;/p&gt;
&lt;h1 id=&#34;é¢†åŸŸé©±åŠ¨æ¨¡å‹-ddd&#34;&gt;é¢†åŸŸé©±åŠ¨æ¨¡å‹ DDD&lt;/h1&gt;
&lt;p&gt;è´«è¡€æ¨¡å‹ï¼Œé¢å‘è¿‡ç¨‹ï¼Œä¸šåŠ¡é€»è¾‘å’Œå®ä½“åˆ†å¼€ï¼Œå®ä½“ä»…å£°æ˜éœ€è¦çš„å±æ€§ï¼Œä¸šåŠ¡é€»è¾‘çš„å¤„ç†å‘ç”Ÿåœ¨serviceç±»ï¼Œå®ä½“åªç”¨æ¥å­˜æ•°æ®ï¼Œæ¯”å¦‚å„ç§voã€boã€do&lt;/p&gt;
&lt;p&gt;é¢†åŸŸé©±åŠ¨æ¨¡å‹æ˜¯ä¸€ç§é¢å‘å¯¹è±¡çš„æ¨¡å‹ã€å……è¡€æ¨¡å‹ï¼Œæ›´å¤šæ˜¯ç”¨åœ¨å¾®æœåŠ¡ã€ä¸šåŠ¡å¤æ‚çš„åœºæ™¯&lt;/p&gt;
&lt;p&gt;å…·ä½“è¡¨ç°åœ¨ ä¸šåŠ¡é€»è¾‘çš„å¤„ç†æ˜¯å‘ç”Ÿåœ¨å®ä½“ç±»é‡Œï¼Œè€Œä¸æ˜¯å‘ç”Ÿåœ¨serviceç±»é‡Œï¼Œserviceç±»åªæ˜¯å¯¹å„ç§voã€boã€doè½¬æ¢æˆéœ€è¦çš„é¢†åŸŸå¯¹è±¡ï¼Œå¯¹å®ƒä»¬è¿›è¡Œè°ƒåº¦ï¼Œæ‰§è¡Œå®ƒä»¬çš„æ–¹æ³•æ¥å®Œæˆä¸šåŠ¡ï¼Œserviceç”šè‡³å¯ä»¥ä¸æ„ŸçŸ¥é¢†åŸŸå¯¹è±¡çš„å±æ€§å˜åŒ–ï¼Œä¸controllerå’Œdaoå±‚æ‰“äº¤é“ï¼Œè§£è€¦æµç¨‹æ€§ä»£ç å’Œä¸šåŠ¡ä»£ç ï¼Œè´Ÿè´£éåŠŸèƒ½æ€§æˆ–è€…ä¸ç¬¬ä¸‰æ–¹ç³»ç»Ÿäº¤äº’çš„å·¥ä½œï¼Œæ¯”å¦‚åˆ†å¸ƒå¼äº‹åŠ¡ã€é‚®ä»¶ã€æ¶ˆæ¯ã€rpcè°ƒç”¨ç­‰ï¼Œä½¿å¾—é¢†åŸŸå¯¹è±¡æ–¹æ³•å’Œå±æ€§å¤ç”¨æ€§æé«˜ï¼Œä¸šåŠ¡æ›´åŠ å†…èš&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.cnblogs.com/dolphin0520/p/3919839.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;è®¾è®¡æ¨¡å¼å…­å¤§åŸåˆ™&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;http://www.runoob.com/design-pattern/design-pattern-tutorial.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;èœé¸Ÿ|è®¾è®¡æ¨¡å¼&lt;/a&gt;&lt;/p&gt;
</description>
        </item>
        <item>
        <title>UML</title>
        <link>http://nixum.cc/p/uml/</link>
        <pubDate>Thu, 11 Jul 2019 00:00:00 +0000</pubDate>
        
        <guid>http://nixum.cc/p/uml/</guid>
        <description>&lt;p&gt;[TOC]&lt;/p&gt;
&lt;h1 id=&#34;ç±»å›¾&#34;&gt;ç±»å›¾&lt;/h1&gt;
&lt;p&gt;ç±»å›¾ä¸­çš„å…³ç³»å…¶å®æœ‰å¤šç§ç‰ˆæœ¬çš„è¡¨ç¤ºæ–¹æ³•ï¼Œè¿™é‡Œä»…æ€»ç»“è‡ªå·±å¸¸ç”¨çš„ç”»æ³•&lt;/p&gt;
&lt;h2 id=&#34;è®¿é—®ä½œç”¨åŸŸ&#34;&gt;è®¿é—®ä½œç”¨åŸŸ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;+ : public&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;- : private&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;# : protocted&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;å…³ç³»&#34;&gt;å…³ç³»&lt;/h2&gt;
&lt;h3 id=&#34;1-ä¾èµ–dependency&#34;&gt;1. ä¾èµ–ï¼ˆdependencyï¼‰&lt;/h3&gt;
&lt;p&gt;ä¾èµ–å…³ç³»æ˜¯äº”ç§å…³ç³»ä¸­è€¦åˆæœ€å°çš„ä¸€ç§å…³ç³»ã€‚&lt;/p&gt;
&lt;p&gt;ä¾èµ–åœ¨ä»£ç ä¸­ä¸»è¦ä½“ç°ä¸ºç±»Açš„æŸä¸ªæˆå‘˜å‡½æ•°çš„è¿”å›å€¼ã€å½¢å‚ã€å±€éƒ¨å˜é‡æˆ–é™æ€æ–¹æ³•çš„è°ƒç”¨ï¼Œåˆ™è¡¨ç¤ºç±»Aå¼•ç”¨äº†ç±»Bã€‚&lt;/p&gt;
&lt;p&gt;A &amp;mdash;-&amp;gt; B ï¼š A use B ï¼ˆè™šçº¿+ç®­å¤´ï¼‰&lt;/p&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/UML-use.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/UML-use.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			alt=&#34;A use B&#34;&gt;
	&lt;/a&gt;
	
	&lt;figcaption&gt;A use B&lt;/figcaption&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;h3 id=&#34;2-å…³è”association&#34;&gt;2. å…³è”ï¼ˆAssociationï¼‰&lt;/h3&gt;
&lt;p&gt;åœ¨ç¨‹åºä»£ç ä¸­ï¼Œå…·æœ‰å…³è”å…³ç³»çš„ç±»å¸¸å¸¸è¢«å£°æ˜ä¸ºç±»çš„å¼•ç”¨ç±»å‹çš„æˆå‘˜å˜é‡ã€‚&lt;/p&gt;
&lt;p&gt;å› ä¸º å…³è” æ˜¯ ä¾èµ– çš„æ›´è¯¦ç»†è¯´æ˜ï¼Œ å…³è” æ˜¯ä¸“é—¨æè¿°æˆå‘˜å±æ€§çš„å…³ç³»ï¼Œæ‰€ä»¥ä¾èµ–ä¸­æ‰€æœ‰æ¶‰åŠæˆå‘˜å±æ€§çš„åœ°æ–¹æ›´é€‚åˆä½¿ç”¨ï¼šå…³è”ã€èšåˆã€ç»„åˆ&lt;/p&gt;
&lt;p&gt;å•å‘å…³è”ï¼š&lt;/p&gt;
&lt;p&gt;A â€”â€”â€”â€”â€”â€”&amp;gt; B ï¼š A has B ï¼ˆå®å¿ƒçº¿ + ç®­å¤´ï¼‰&lt;/p&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/UML-association.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/UML-association.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			alt=&#34;A has B&#34;&gt;
	&lt;/a&gt;
	
	&lt;figcaption&gt;A has B&lt;/figcaption&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;h3 id=&#34;3-èšåˆaggregation&#34;&gt;3. èšåˆï¼ˆAggregationï¼‰&lt;/h3&gt;
&lt;p&gt;èšåˆæ˜¯å…³è”çš„ä¸€ç§ç‰¹æ®Šå½¢å¼ï¼Œæš—å«æ•´ä½“/éƒ¨åˆ†å…³ç³»ï¼Œä½†æ˜¯å¯¹æ–¹å´ä¸æ˜¯å”¯ä¸€å±äºè‡ªå·±çš„é‚£ç§å…³ç³»ã€‚ ç”¨æ¥è¡¨ç¤ºé›†ä½“ä¸ä¸ªä½“ä¹‹é—´çš„å…³è”å…³ç³»ï¼Œä¾‹å¦‚ç­çº§ä¸å­¦ç”Ÿä¹‹é—´å­˜åœ¨èšåˆå…³ç³»ã€‚&lt;/p&gt;
&lt;p&gt;A &amp;lt;&amp;gt;â€”â€”â€”â€”â€”â€” B :   Aæ˜¯é›†ä½“ï¼ŒBæ˜¯ä¸ªä½“ ï¼ˆå®çº¿ + ç©ºå¿ƒè±å½¢ï¼‰&lt;/p&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/UML-aggregation.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/UML-aggregation.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			alt=&#34;Aæ˜¯é›†ä½“ï¼ŒBæ˜¯ä¸ªä½“&#34;&gt;
	&lt;/a&gt;
	
	&lt;figcaption&gt;Aæ˜¯é›†ä½“ï¼ŒBæ˜¯ä¸ªä½“&lt;/figcaption&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;h3 id=&#34;4-ç»„åˆcomposition&#34;&gt;4. ç»„åˆï¼ˆCompositionï¼‰&lt;/h3&gt;
&lt;p&gt;ç»„åˆåˆå«å¤åˆï¼Œç”¨æ¥è¡¨ç¤ºä¸ªä½“ä¸ç»„æˆéƒ¨åˆ†ä¹‹é—´çš„å…³è”å…³ç³»ã€‚ åœ¨ç»„åˆå…³ç³»ä¸­æ•´ä½“å¯¹è±¡å¯ä»¥æ§åˆ¶æˆå‘˜å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸï¼Œä¸€æ—¦æ•´ä½“å¯¹è±¡ä¸å­˜åœ¨ï¼Œæˆå‘˜å¯¹è±¡ä¹Ÿä¸å­˜åœ¨ï¼Œæ•´ä½“å¯¹è±¡å’Œæˆå‘˜å¯¹è±¡ä¹‹é—´å…·æœ‰åŒç”Ÿå…±æ­»çš„å…³ç³»ã€‚&lt;/p&gt;
&lt;p&gt;A &amp;lt;#&amp;gt;â€”â€”â€”â€” Bï¼š Aæ˜¯æ•´ä½“ï¼ŒBæ˜¯éƒ¨åˆ†  ï¼ˆå®çº¿çº¿ + å®å¿ƒè±å½¢ï¼‰&lt;/p&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/UML-composition.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/UML-composition.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			alt=&#34;Aæ˜¯æ•´ä½“ï¼ŒBæ˜¯éƒ¨åˆ†&#34;&gt;
	&lt;/a&gt;
	
	&lt;figcaption&gt;Aæ˜¯æ•´ä½“ï¼ŒBæ˜¯éƒ¨åˆ†&lt;/figcaption&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;h3 id=&#34;5-æ³›åŒ–&#34;&gt;5. æ³›åŒ–&lt;/h3&gt;
&lt;h4 id=&#34;51-ç»§æ‰¿generalization&#34;&gt;5.1 ç»§æ‰¿ï¼ˆGeneralizationï¼‰&lt;/h4&gt;
&lt;p&gt;A â€”â€”â€”â€”â€”â€”|&amp;gt; B : Aç»§æ‰¿äº†B  ï¼ˆå®å¿ƒçº¿ + ç©ºå¿ƒä¸‰è§’ç®­å¤´ï¼‰ï¼ŒA is B&lt;/p&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/UML-generalization.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/UML-generalization.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			alt=&#34;Aç»§æ‰¿äº†B&#34;&gt;
	&lt;/a&gt;
	
	&lt;figcaption&gt;Aç»§æ‰¿äº†B&lt;/figcaption&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;h4 id=&#34;52-å®ç°implementation&#34;&gt;5.2. å®ç°ï¼ˆImplementationï¼‰&lt;/h4&gt;
&lt;p&gt;A &amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;ndash;|&amp;gt; B : Aå®ç°äº†æ¥å£B ï¼ˆè™šå¿ƒçº¿ + ç©ºå¿ƒä¸‰è§’ç®­å¤´ï¼‰ï¼Œ A like B&lt;/p&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/UML-implementation.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/UML-implementation.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			alt=&#34;Aå®ç°äº†æ¥å£B&#34;&gt;
	&lt;/a&gt;
	
	&lt;figcaption&gt;Aå®ç°äº†æ¥å£B&lt;/figcaption&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;PSï¼šä¸ºäº†æ–¹ä¾¿ï¼Œç»§æ‰¿å’Œæ¥å£å®ç°ä¹Ÿéƒ½å¯ä»¥ç”¨å®çº¿åŠ ç©ºå¿ƒä¸‰è§’ç®­å¤´&lt;/p&gt;
</description>
        </item>
        <item>
        <title>git</title>
        <link>http://nixum.cc/p/git/</link>
        <pubDate>Tue, 26 Feb 2019 00:00:00 +0000</pubDate>
        
        <guid>http://nixum.cc/p/git/</guid>
        <description>&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/git_flow.jpg&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/git_flow.jpg&#34;
			
			
			
			loading=&#34;lazy&#34;
			alt=&#34;gitæµç¨‹&#34;&gt;
	&lt;/a&gt;
	
	&lt;figcaption&gt;gitæµç¨‹&lt;/figcaption&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;h2 id=&#34;å¸¸ç”¨å‘½ä»¤&#34;&gt;å¸¸ç”¨å‘½ä»¤&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;git init&lt;/p&gt;
&lt;p&gt;å°†ä¸€ä¸ªæ™®é€šæ–‡ä»¶å¤¹å˜æˆgitä»“åº“ï¼Œæ­¤æ—¶æ–‡ä»¶å¤¹ä¸‹å¤šå‡º.gitæ–‡ä»¶å¤¹ï¼Œè¡¨ç¤ºå¯ä»¥ä½¿ç”¨gitç®¡ç†ï¼Œæ­¤æ—¶è¿™ä¸ªæ–‡ä»¶å¤¹ç§°ä¸ºgitå·¥ä½œåŒº&lt;/p&gt;
&lt;p&gt;æˆ–è€…&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨git clone url(githubä¸Šçš„ä»“åº“é“¾æ¥)å°†ä»“åº“ä»githubä¸Šä¸‹è½½ä¸‹æ¥&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;å½“å¯¹å·¥ä½œåŒºå†…çš„æ–‡ä»¶åšå‡ºä¿®æ”¹å&#34;&gt;å½“å¯¹å·¥ä½œåŒºå†…çš„æ–‡ä»¶åšå‡ºä¿®æ”¹å&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;git add æ–‡ä»¶å&lt;/p&gt;
&lt;p&gt;è¡¨ç¤ºå°†è¯¥æ–‡ä»¶çš„ä¿®æ”¹åŠ å…¥åˆ°æš‚å­˜åŒº&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;git add .&lt;/p&gt;
&lt;p&gt;(æ³¨æ„åé¢æœ‰ä¸ª . )è¡¨ç¤ºå°†å½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶çš„ä¿®æ”¹éƒ½åŠ å…¥åˆ°æš‚å­˜åŒº&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;git commit -m &amp;ldquo;å¤‡æ³¨ä¿¡æ¯&amp;rdquo;&lt;/p&gt;
&lt;p&gt;è¡¨ç¤ºå°†æš‚å­˜åŒºçš„ä¿®æ”¹æäº¤åˆ°å½“å‰åˆ†æ”¯ï¼Œæäº¤ä¹‹åæš‚å­˜åŒºæ¸…ç©º&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;git push -u origin master&lt;/p&gt;
&lt;p&gt;å°†åˆ†æ”¯ä¸Šçš„ä¿®æ”¹æ›´æ–°åˆ°githubä¸Š&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;æ’¤å›ä¿®æ”¹&#34;&gt;æ’¤å›ä¿®æ”¹&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;git log æŸ¥çœ‹æäº¤è®°å½•ï¼Œè·å–commit id&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;git reset &amp;ndash; æ–‡ä»¶å æˆ–è€… commitId&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨å½“å‰åˆ†æ”¯ä¸Šçš„ä¿®æ”¹è¦†ç›–æš‚å­˜åŒºï¼Œç”¨æ¥æ’¤é”€æœ€åä¸€æ¬¡ git add files&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;git checkout &amp;ndash; æ–‡ä»¶å&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨æš‚å­˜åŒºçš„ä¿®æ”¹è¦†ç›–å·¥ä½œç›®å½•ï¼Œç”¨æ¥æ’¤é”€æœ¬åœ°ä¿®æ”¹&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;åˆ é™¤&#34;&gt;åˆ é™¤&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;git rm æ–‡ä»¶å&lt;/p&gt;
&lt;p&gt;åˆ é™¤æš‚å­˜åŒºå’Œåˆ†æ”¯ä¸Šçš„æ–‡ä»¶ï¼ŒåŒæ—¶å·¥ä½œåŒºä¹Ÿä¸éœ€è¦è¿™ä¸ªæ–‡ä»¶ï¼Œä¹‹åcommitä¿å­˜åˆ°åˆ†æ”¯&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;git rm -r &amp;ndash;cached æ–‡ä»¶å¤¹å&lt;/p&gt;
&lt;p&gt;åˆ é™¤æš‚å­˜åŒºçš„ä¿®æ”¹ï¼Œä¹‹åå†commitä¿å­˜åˆ°åˆ†æ”¯ï¼Œå¦‚æœä¸å°å¿ƒæäº¤äº†ä¸æƒ³æäº¤çš„æ–‡ä»¶åˆ°åˆ†æ”¯ä¸Šï¼Œæ­¤æ—¶æƒ³åˆ é™¤åˆšåˆšä¸å°å¿ƒæäº¤çš„æ–‡ä»¶åŒæ—¶ä¿ç•™å·¥ä½œç›®å½•çš„æ–‡ä»¶æ—¶ä½¿ç”¨&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;æ›´æ–°&#34;&gt;æ›´æ–°&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;git pull origin master&lt;/p&gt;
&lt;p&gt;æ›´æ–°çº¿ä¸Šä¿®æ”¹åˆ°æœ¬åœ°åˆ†æ”¯&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;æŸ¥çœ‹çŠ¶æ€&#34;&gt;æŸ¥çœ‹çŠ¶æ€&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;git status&lt;/p&gt;
&lt;p&gt;å¯ä»¥æŸ¥çœ‹æœ¬åœ°å’Œåˆ†æ”¯å“ªäº›æ–‡ä»¶æœ‰ä¿®æ”¹&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;å‡ ä¸ªå®¹æ˜“æ··æ·†çš„å‘½ä»¤&#34;&gt;å‡ ä¸ªå®¹æ˜“æ··æ·†çš„å‘½ä»¤&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;git rebase å’Œ git merge&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ•ˆæœéƒ½æ˜¯åˆå¹¶ï¼Œmergeæ—¶å¯ä»¥çœ‹åˆ°è¢«mergeçš„åˆ†æ”¯ä»¥åŠå…¶æäº¤è®°å½•ï¼Œä¸ç ´åè¢«mergeåˆ†æ”¯çš„ä»£ç æäº¤è®°å½•ï¼›rebaseæ˜¯ç›´æ¥æŠŠä¸¤ä¸ªåˆ†æ”¯åˆå¹¶ï¼Œè¢«åˆå¹¶çš„åˆ†æ”¯å°±åƒåœ¨åŸæ¥çš„åˆ†æ”¯ä¸Šå¼€å‘ä¸€æ ·ï¼Œä¸ä¼šæ–°å¢æäº¤è®°å½•åˆ°ç›®æ ‡åˆ†æ”¯ï¼Œå½¢æˆçº¿æ€§æäº¤çš„å†å²è®°å½•ã€‚&lt;/p&gt;
&lt;p&gt;åˆå¹¶ä»£ç åˆ°å…¬å…±åˆ†æ”¯çš„æ—¶å€™ä½¿ç”¨git merge&lt;/p&gt;
&lt;p&gt;åˆå¹¶ä»£ç åˆ°ä¸ªäºº/åŠŸèƒ½åˆ†æ”¯æ—¶ä½¿ç”¨git rebase&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;git pull å’Œ git fetch&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ•ˆæœéƒ½æ˜¯æ›´æ–°è¿œç¨‹ä»“åº“åˆ°æœ¬åœ°ï¼Œfetchæ˜¯å°†è¿œç¨‹ä»“åº“çš„å†…å®¹æ‹‰åˆ°æœ¬åœ°ï¼Œç”¨æˆ·æ£€æŸ¥åªä¼šå†å†³å®šæ˜¯å¦åˆå¹¶ï¼›pullæ˜¯å°†è¿œç¨‹ä»“åº“çš„å†…å®¹æ‹‰åˆ°æœ¬åœ°åç›´æ¥åˆå¹¶ï¼Œpull = fetch + merge&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;git reset å’Œ git revert&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ•ˆæœéƒ½æ˜¯æ’¤é”€ï¼Œresetå›é€€ç‰ˆæœ¬ä¼šä¸¢å¤±å›é€€å‰çš„æäº¤ä¿¡æ¯ï¼Œrevertåˆ™ä¸ä¼šï¼Œrevertä¼šé‡æ–°åˆ›å»ºä¸€ä¸ªæ–°çš„æäº¤ï¼Œæ–°çš„æäº¤å†…å®¹æ˜¯æŒ‡å®šçš„commitIdå¯¹åº”çš„å†…å®¹ï¼ŒåŸæœ‰çš„æäº¤å¾—åˆ°ä¿ç•™ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å…¶ä»–å¸¸ç”¨å‘½ä»¤&#34;&gt;å…¶ä»–å¸¸ç”¨å‘½ä»¤&lt;/h3&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/git_command.png&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/git_command.png&#34;
			
			
			
			loading=&#34;lazy&#34;
			alt=&#34;gitå‘½ä»¤&#34;&gt;
	&lt;/a&gt;
	
	&lt;figcaption&gt;gitå‘½ä»¤&lt;/figcaption&gt;
	
&lt;/figure&gt;&lt;/p&gt;
&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h2&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.liaoxuefeng.com/wiki/0013739516305929606dd18361248578c67b8067c8c017b000&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;å»–é›ªå³° gitæ•™ç¨‹&lt;/a&gt;&lt;/p&gt;
</description>
        </item>
        <item>
        <title>README</title>
        <link>http://nixum.cc/p/readme/</link>
        <pubDate>Tue, 12 Feb 2019 00:00:00 +0000</pubDate>
        
        <guid>http://nixum.cc/p/readme/</guid>
        <description>&lt;h1 id=&#34;readme&#34;&gt;README&lt;/h1&gt;
&lt;p&gt;&lt;figure 
	&gt;
	&lt;a href=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/cover%5c_book.jpg&#34; &gt;
		&lt;img src=&#34;https://github.com/Nixum/Java-Note/raw/master/picture/cover%5c_book.jpg&#34;
			
			
			
			loading=&#34;lazy&#34;
			&gt;
	&lt;/a&gt;
	
&lt;/figure&gt;\&lt;/p&gt;
&lt;p&gt;ä¸ºäº†æ›´å¥½çš„é˜…è¯»ä½“éªŒï¼Œå¯å‰å¾€ &lt;a class=&#34;link&#34; href=&#34;http://nixum.cc&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;ä¸ªäººbolg&lt;/a&gt;ã€&lt;a class=&#34;link&#34; href=&#34;https://nixum.gitbook.io/note/readme&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;gitbook&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;ç›®å½•&#34;&gt;ç›®å½•&lt;/h2&gt;
&lt;h3 id=&#34;java&#34;&gt;Java&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Java SE&lt;/li&gt;
&lt;li&gt;JUC&lt;/li&gt;
&lt;li&gt;Java IO&lt;/li&gt;
&lt;li&gt;JVM&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;go&#34;&gt;Go&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Go SE&lt;/li&gt;
&lt;li&gt;Go Goroutineå’ŒGC&lt;/li&gt;
&lt;li&gt;Go Contextå’ŒChannel&lt;/li&gt;
&lt;li&gt;Go Sync&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;æ¡†æ¶&#34;&gt;æ¡†æ¶&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Spring&lt;/li&gt;
&lt;li&gt;SpringMVC&lt;/li&gt;
&lt;li&gt;MyBatis&lt;/li&gt;
&lt;li&gt;Gin&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;æ•°æ®å­˜å‚¨&#34;&gt;æ•°æ®å­˜å‚¨&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;MySQL&lt;/li&gt;
&lt;li&gt;MongoDB&lt;/li&gt;
&lt;li&gt;Redis&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;å¾®æœåŠ¡ä¸äº‘åŸç”Ÿ&#34;&gt;å¾®æœåŠ¡ä¸äº‘åŸç”Ÿ&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Kubernetes&lt;/li&gt;
&lt;li&gt;å®¹å™¨&lt;/li&gt;
&lt;li&gt;etcd ä¸ ZooKeeper&lt;/li&gt;
&lt;li&gt;å¾®æœåŠ¡&lt;/li&gt;
&lt;li&gt;åˆ†å¸ƒå¼ç›¸å…³&lt;/li&gt;
&lt;li&gt;RPCä¸å¼‚æ­¥è®¾è®¡&lt;/li&gt;
&lt;li&gt;å…¶ä»–&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;æ¶ˆæ¯é˜Ÿåˆ—&#34;&gt;æ¶ˆæ¯é˜Ÿåˆ—&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;æ¶ˆæ¯é˜Ÿåˆ—åŸºæœ¬åŸç†&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;è®¡ç®—æœºç½‘ç»œ&#34;&gt;è®¡ç®—æœºç½‘ç»œ&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;ç½‘ç»œ&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;æ“ä½œç³»ç»Ÿ&#34;&gt;æ“ä½œç³»ç»Ÿ&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;æ“ä½œç³»ç»Ÿ&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;è®¾è®¡æ¨¡å¼&#34;&gt;è®¾è®¡æ¨¡å¼&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;è®¾è®¡æ¨¡å¼&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;å·¥å…·&#34;&gt;å·¥å…·&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;git&lt;/li&gt;
&lt;li&gt;UMLå›¾&lt;/li&gt;
&lt;/ul&gt;
</description>
        </item>
        <item>
        <title></title>
        <link>http://nixum.cc/p/</link>
        <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
        
        <guid>http://nixum.cc/p/</guid>
        <description>&lt;h1 id=&#34;table-of-contents&#34;&gt;Table of contents&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;README.md&#34; &gt;å…¬å‘Š&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;English%20Learning.md&#34; &gt;è‹±è¯­å­¦ä¹ æ€»ç»“&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;Gin.md&#34; &gt;Ginæ¡†æ¶åŸç†&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;Git.md&#34; &gt;git&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;Go%20Context%e5%92%8cChannel.md&#34; &gt;Go Contextå’ŒChannel&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;Go%20Sync%e5%8c%85.md&#34; &gt;Go SyncåŒ…ç›¸å…³&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;Go%20goroutine%e5%92%8cGC.md&#34; &gt;Go Goroutineå’ŒGC&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;Go.md&#34; &gt;Go&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;JUC.md&#34; &gt;Javaå¹¶å‘&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;JVM.md&#34; &gt;JVM&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;Java%20IO.md&#34; &gt;Java IO&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;Java-List-Map.md&#34; &gt;Java List Map&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;JavaSE.md&#34; &gt;Java SE&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;Kubernetes.md&#34; &gt;Kuberneteså’ŒIstio&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;MongoDB.md&#34; &gt;MongoDB&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;MyBatis.md&#34; &gt;MyBatis&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;MySQL.md&#34; &gt;MySQL&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;README%20%281%29.md&#34; &gt;README&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;RPC%e4%b8%8e%e5%bc%82%e6%ad%a5%e8%ae%be%e8%ae%a1.md&#34; &gt;RPCä¸å¼‚æ­¥è®¾è®¡&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;Redis.md&#34; &gt;Redis&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;Spring.md&#34; &gt;Springå’ŒSpringBoot&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;SpringMVC.md&#34; &gt;SpringMVC&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;UML%e5%9b%be.md&#34; &gt;UML&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;etcd%e5%92%8cZookeeper.md&#34; &gt;etcdå’ŒZooKeeper&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;%e4%b8%9a%e5%8a%a1%e5%9c%ba%e6%99%af%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88.md&#34; &gt;å¸¸è§çš„ä¸šåŠ¡åœºæ™¯è§£å†³æ–¹æ¡ˆæ•´ç†&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;%e5%85%b6%e4%bb%96.md&#34; &gt;å…¶ä»–&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;%e5%88%86%e5%b8%83%e5%bc%8f%e7%9b%b8%e5%85%b3.md&#34; &gt;åˆ†å¸ƒå¼ç›¸å…³&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;%e5%ae%b9%e5%99%a8.md&#34; &gt;å®¹å™¨&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;%e5%b7%a5%e4%bd%9c%e5%9b%9b%e5%b9%b4%e6%80%bb%e7%bb%93.md&#34; &gt;æ¯•ä¸šåå››å¹´å·¥ä½œæ€»ç»“ - ç¬¬ä¸€é˜¶æ®µç»“æŸ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;%e5%be%ae%e6%9c%8d%e5%8a%a1.md&#34; &gt;å¾®æœåŠ¡&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;%e6%93%8d%e4%bd%9c%e7%b3%bb%e7%bb%9f.md&#34; &gt;æ“ä½œç³»ç»Ÿ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;%e6%b6%88%e6%81%af%e9%98%9f%e5%88%97.md&#34; &gt;æ¶ˆæ¯é˜Ÿåˆ—&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;%e7%bd%91%e7%bb%9c.md&#34; &gt;ç½‘ç»œ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;%e8%ae%be%e8%ae%a1%e6%a8%a1%e5%bc%8f.md&#34; &gt;è®¾è®¡æ¨¡å¼&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;Algorithm/README.md&#34; &gt;Algorithm&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;Algorithm/SwordToOffer/README.md&#34; &gt;SwordToOffer&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;Algorithm/SwordToOffer/src/README.md&#34; &gt;src&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;Algorithm/SwordToOffer/src/main/README.md&#34; &gt;main&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;Algorithm/SwordToOffer/src/main/java/README.md&#34; &gt;java&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;Algorithm/SwordToOffer/src/main/java/backtracking/README.md&#34; &gt;backtracking&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
</description>
        </item>
        
    </channel>
</rss>
